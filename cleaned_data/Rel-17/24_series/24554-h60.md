# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible and they
are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
The present document specifies the protocols for Proximity-based Services
(ProSe) in 5G system as specified in 3GPP TS 23.304 [2] for:
a) 5G ProSe direct discovery;
b) 5G ProSe communication over the PC5 interface; and
c) 5G ProSe UE-to-network relay.
The present document defines the associated procedures for 5G ProSe service
authorization and configuration, 5G ProSe direct discovery, 5G ProSe direct
communication, and 5G ProSe UE-to-network relay.
The present document also defines the message format, message contents, error
handling and system parameters applied by the protocols for ProSe in 5GS.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document in the same
Release as the present document.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.304: \"Proximity based Services (ProSe) in the 5G System (5GS);
Stage 2\".
[3] IETF RFC 7230: \"Hypertext Transfer Protocol (HTTP/1.1): Message Syntax
and Routing\".
[4] IETF RFC 7231: \"Hypertext Transfer Protocol (HTTP/1.1): Semantics and
Content\".
[5] 3GPP TS 24.526: \"UE policies for 5G System (5GS); Stage 3\".
[6] OMA-WAP-TS-PushOTA-V2_1-20110405-A: \"Push Over the Air\".
[7] OMA-AD-Push-V2_2-20110809-A: \"Push Architecture\".
[8] WAP-168-ServiceLoad-20010731-a: \"Service Loading\".
[9] 3GPP TS 29.555: \"Inter-5G Direct Discovery Name Management Function
(DDNMF) signalling aspects; Stage 3\".
[10] 3GPP TS 29.503: \"5G System; Unified Data Management Services; Stage 3\".
[11] 3GPP TS 24.501: \"Non-Access-Stratum (NAS) protocol for 5G System (5GS);
Stage 3\".
[12] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[13] 3GPP TS 38.331: \"NR; Radio Resource Control (RRC); Protocol
Specification\".
[14] 3GPP TS 23.122: \"Non-Access-Stratum (NAS) functions related to Mobile
Station (MS) in idle mode\".
[15] 3GPP TS 38.304: \"User Equipment (UE) procedures in Idle mode and RRC
Inactive state\".
[16] 3GPP TS 38.323: \"NR; Packet Data Convergence Protocol (PDCP)
specification\".
[17] 3GPP TS 24.555: \"Proximity-services (ProSe) in 5G System (5GS); User
Equipment (UE) policies; Stage 3\".
[18] 3GPP TS 24.587: \"Vehicle-to-Everything (V2X) services in 5G System
(5GS); Protocol aspects; Stage 3\".
[19] 3GPP TS 29.557: \"5G System; Application Function ProSe Service; Stage
3\".
[20] 3GPP TS 24.007: \"Mobile radio interface signalling layer-3; General
aspects\".
[21] 3GPP TS 38.300: \"NR; NR and NG-RAN Overall Description; Stage 2\".
[22] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[23] IETF RFC 2131: \"Dynamic Host Configuration Protocol\".
[24] IETF RFC 4039: \"Rapid Commit Option for the Dynamic Host Configuration
Protocol version 4 (DHCPv4)\".
[25] IETF RFC 4862: \"IPv6 Stateless Address Autoconfiguration\".
[26] 3GPP TS 24.502: \"Access to the 5G System (5GS) via non-3GPP access
networks; Stage 3\".
[27] ITU-T Recommendation E.212: \"The international identification plan for
mobile terminals and mobile users\".
[28] ISO/IEC 10118-3:2018: \"IT Security techniques -- Hash-functions \-- Part
3: Dedicated hash-functions\".
[29] W3C REC-xmlschema-2-20041028: \"XML Schema Part 2: Datatypes\".
[30] IETF RFC 4122: \"A Universally Unique IDentifier (UUID) URN Namespace\".
[31] 3GPP TS 24.008: \"Mobile Radio Interface Layer 3 specification; Core
Network Protocols; Stage 3\".
[32] IETF RFC 826: \"An Ethernet Address Resolution Protocol\".
[33] 3GPP TS 23.503: \"Policy and Charging Control Framework for the 5G
System; Stage 2\".
[34] 3GPP TS 33.503: \"Security Aspects of Proximity based Services (ProSe) in
the 5G System (5GS)\".
[35] 3GPP TS 23.303: \"Proximity-based services (ProSe); Stage 2\".
[36] 3GPP TS 33.303: \"Proximity-based Services (ProSe); Security aspects\".
[37] 3GPP TS 33.536: \"Security aspects of 3GPP support for advanced Vehicle-
to-Everything (V2X) services\".
[38] IETF RFC 3927: \"Dynamic Configuration of IPv4 Link-Local Addresses\".
[39] IETF RFC 3748: \"Extensible Authentication Protocol (EAP)\".
[40] IETF RFC 20: \"ASCII format for Network Interchange\".
[41] IETF RFC 4288: \"Media Type Specifications and Registration Procedures\".
[42] IETF RFC 7303: \"XML Media Types\".
[43] IETF RFC 7542: \"The Network Access Identifier\".
[44] 3GPP TS 33.223: \"Generic Authentication Architecture (GAA); Generic
Bootstrapping Architecture (GBA) Push function\".
[45] 3GPP TS 32.277: \"Proximity-based Services (ProSe) charging\".
[46] 3GPP TS 33.220: \"Generic Authentication Architecture (GAA); Generic
Bootstrapping Architecture (GBA)\".
[47] 3GPP TS 33.535: \"Authentication and Key Management for Applications
(AKMA) based on 3GPP credentials in the 5G System (5GS)\".
[48] IETF RFC 1166: \"Internet Numbers\".
[49] IETF RFC 5952: \"A Recommendation for IPv6 Address Text Representation\".
[50] 3GPP TS 33.501: \"Security architecture and procedures for 5G system\".
[51] 3GPP TS 23.502: \"Procedures for the 5G System (5GS); Stage 2\".
# 3 Definitions of terms, symbols and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in 3GPP TR 21.905
[1] and the following apply. A term defined in the present document takes
precedence over the definition of the same term, if any, in 3GPP TR 21.905
[1].
**5G ProSe Direct Communication:** A function that supports the communications
between two or more UEs in proximity that are 5G ProSe-enabled, by means of
user plane transmission using NR technology via a path not traversing any
network node.
**5G ProSe Direct Discovery:** A function employed by a 5G ProSe-enabled UE to
discover other 5G ProSe-enabled UEs in its vicinity based on direct radio
transmissions between the two UEs with NR technology.
**5G ProSe UE-to-network relay:** A function employed by a 5G ProSe-enabled UE
to support the communications between a 5G ProSe UE-to-network remote UE and
DN.
**5G ProSe layer-2 UE-to-network relay:** A function employed by a 5G ProSe-
enabled UE to support the communications between a 5G ProSe layer-2 UE-to-
network remote UE and DN.
**5G ProSe layer-3 UE-to-network relay:** A function that supports the
communications between a 5G ProSe layer-3 UE-to-network remote UE and DN.
**5G ProSe UE-to-network relay UE:** A 5G ProSe-enabled UE that provides
functionality to support connectivity to the network for 5G ProSe remote
UE(s).
**5G ProSe layer-2 UE-to-network relay UE:** A 5G ProSe-enabled UE that
provides functionality to support connectivity to the network for 5G ProSe
layer-2 remote UE(s) via layer-2 protocol.
**5G ProSe layer-3 UE-to-network relay UE:** A 5G ProSe-enabled UE that
provides functionality to support connectivity to the network for 5G ProSe
layer-3 remote UE(s) via layer-3 protocol.
**5G ProSe layer-2 remote UE:** A 5G ProSe-enabled UE that communicates with a
DN via a 5G ProSe layer-2 UE-to-network relay UE.
**5G ProSe layer-3 remote UE:** A 5G ProSe-enabled UE that communicates with a
DN via a 5G ProSe layer-3 UE-to-network relay UE.
**Open 5G ProSe direct discovery:** A 5G ProSe direct discovery that takes
place without explicit permission from the 5G ProSe-enabled UE being
discovered**.**
**Restricted 5G ProSe direct discovery:** A 5G ProSe direct discovery that
only takes place with explicit permission from the 5G ProSe-enabled UE being
discovered.
**5G DDNMF CTF (ADF):** Accounting Data Forwarding (ADF) function block of the
Charging Trigger Function (CTF) in the 5G DDNMF.
**Usage information report:** Usage information related to one collection
period.
**Usage information report list:** One or more usage information report(s)
associated with the UE identity of a 5G ProSe-enabled UE.
For the purposes of the present document, the following term and definition
given in TS 23.304 [2] apply:
**5G ProSe-enabled UE**
**5G ProSe remote UE**
**Application layer ID**
**Application layer group ID**
**Destination layer-2 ID**
**Discovery entry ID**
**Discovery filter**
**Discovery query filter**
**Discovery response filter**
**Geographical area**
**Indirect network communication**
**Local PLMN**
**Member ID**
**Metadata index**
**Metadata index mask**
**Model A**
**Model B**
**Mode of communication**
**ProSe application code**
**ProSe application mask**
**ProSe application ID**
**ProSe discovery UE ID**
**ProSe identifier**
**ProSe layer-2 group ID**
**ProSe query code**
**ProSe response code**
**ProSe restricted code**
**ProSe restricted code prefix**
**ProSe restricted code suffix**
**Relay service code**
**Restricted ProSe application user ID**
**Source layer-2 ID**
**NR Tx profile**
**User info ID**
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
5G DDNMF 5G Direct Discovery Name Management Function
5G PKMF 5G ProSe Key Management Function
5G ProSe 5G Proximity-based Services
AA Authentication and Authorization
AKMA Authentication and Key Management for Applications
CP-PRUK Control Plane ProSe Remote User Key
CTF (ADF) Charging Trigger Function (Accounting Data Forwarding)
DN Data Network
DUCK Discovery User Confidentility Key
DUIK Discovery User Integrity Key
DUSK Discovery User Scrambling Key
FQDN Fully Qualified Domain Name
GBA Generic Bootstrapping Architecture
GFBR Guaranteed Flow Bit Rate
GPI GBA Push Information
LSB Least Significant 8 Bits
MSB Most Significant 8 Bits
MFBR Maximum Flow Bit Rate
MIC Message Integrity Check
MOBIKE IKEv2 Mobility and Multihoming Protocol
NAI Network Access Identifier
NCGI NG-RAN Cell Global ID
PC5 LINK-AMBR PC5 Link Aggregated Bit Rate
PDUID ProSe Discovery UE ID
PQI PC5 5QI
ProSeP 5G ProSe Policy
PSDK Public Safety Discovery Key
RPAUID Restricted ProSe Application User ID
RQI Reflective QoS Indication
RSC Relay Service Code
TTL Time-To-Live
UP-PRUK User Plane ProSe Remote User Key
URSP UE Route Selection Policy
# 4 General
## 4.1 Overview
5G Proximity-based Services (ProSe) are services that can be provided by the
3GPP system based on UEs being in proximity to each other. In this release of
the document, the 3GPP system enablers for 5G ProSe include the following
functions:
a) 5G ProSe direct discovery;
b) 5G ProSe direct communication; and
c) 5G ProSe UE-to-network relay.
The above functions are applicable for both public safety UE and commercial
UEs.
The security aspects for 5G ProSe features are specified in 3GPP TS 33.503
[34].
# 5 Provisioning of configuration information for 5G ProSe
## 5.1 Overview
5G ProSe configuration parameters are configured by the related procedures
which allow configuration of necessary 5G ProSe configuration parameters to
UE.
## 5.2 Configuration and precedence of 5G ProSe configuration information
### 5.2.1 General
UE\'s usage of 5G ProSe service is controlled by 5G ProSe configration
information.
The 5G ProSe configuration information consist of the configuration parameters
for 5G ProSe direct discovery, 5G ProSe direct communication, 5G ProSe UE-to-
network relay and 5G ProSe usage reporting.
### 5.2.2 Precedence of 5G ProSe configuration information
The 5G ProSe configuration information for 5G ProSe direct discovery, 5G ProSe
direct communication, 5G ProSe UE-to-network relay and 5G ProSe usage
reporting can be:
a) pre-configured in the ME;
b) configured in the UICC;
c) provided as a ProSeP by PCF;
d) provided by a ProSe application server via PC1 reference point except:
1) the authorization policy for 5G ProSe direct discovery and restricted ProSe
discovery UE ID for restricted direct discovery in parameters for 5G ProSe
direct discovery;
2) the authorization policy in parameters for 5G ProSe direct communication;
3) the following parameters for the role of a 5G ProSe UE-to-network relay UE:
i) authorization policy for acting as a 5G ProSe layer-3 and/or layer-2 UE-to-
network relay when \"served by NG-RAN\";
ii) QoS mapping rules for 5G ProSe layer-3 UE-to-network relay; and
iii) a mapping of ProSe identifier(s) to ProSe application server address
information for 5G ProSe layer-3 UE-to-network relay UE to relay Ethernet or
Unstructured traffic from remote UE by using IP type PDU session;
4) the following parameters for the role of a 5G ProSe remote UE:
i) authorization policy for using a 5G ProSe layer-3 and/or layer-2 UE-to-
network relay; and
5) the following parameters for the role of a 5G ProSe UE-to-network relay as
well as for the role of a 5G ProSe remote UE:
i) radio parameters for 5G ProSe relay discovery when the UE is not \"served
by NG-RAN\";
ii) radio parameters for 5G ProSe relay communication when the UE is not
\"served by NG-RAN\"; and
iii) security related content for 5G ProSe UE-to-network relay; or
e) a combination of case a), b), c) or d) above.
The UE shall use the 5G ProSe configuration information in the following order
of decreasing precedence:
a) the 5G ProSe configuration information provided as a ProSeP by PCF;
b) the 5G ProSe configuration information provided by a ProSe application
server via PC1 reference point;
c) the 5G ProSe configuration information configured in the UICC; and
d) the 5G ProSe configuration information pre-configured in the ME.
NOTE: It is not supported for the UE to request or receive any 5G ProSe
configuration information from the PCF over the indirect network communication
path, when the UE is working as a 5G ProSe remote UE using a 5G ProSe layer-3
UE-to-network relay without involving N3IWF.
### 5.2.3 Configuration parameters for 5G ProSe direct discovery
The configuration parameters for 5G ProSe direct discovery over PC5 reference
point consist of:
a) a validity timer for the validity of the configuration parameter for 5G
ProSe direct discovery over PC5 interface;
b) a list of PLMNs in which the UE is authorised to perform open 5G ProSe
direct discovery Model A monitoring when the UE is served by NG-RAN;
c) a list of PLMNs in which the UE is authorized to perform open 5G ProSe
direct discovery Model A announcing when the UE is served by NG-RAN;
d) a list of PLMNs in which the UE is authorised to perform restricted 5G
ProSe direct discovery Model A monitoring when the UE is served by NG-RAN;
e) a list of PLMNs in which the UE is authorized to perform restricted 5G
ProSe direct discovery Model A announcing when the UE is served by NG-RAN;
f) a list of PLMNs in which the UE is authorized to perform restricted Model B
discoverer operation when the UE is served by NG-RAN;
g) a list of PLMNs in which the UE is authorized to perform restricted Model B
discoveree operation when the UE is served by NG-RAN;
h) an indication of whether the UE is authorized to perform 5G ProSe direct
discovery for Model A or Model B when \"not served by NG-RAN\";
i) radio parameters for ProSe direct discover per NR PC5 applicable per
geographical area(s) with an indication of whether these radio parameters are
\"operator managed\" or \"non-operator managed\" when \"not served by NG-
RAN\";
NOTE 1: Whether a frequency band is \"operator managed\" or \"non-operator
managed\" in a given geographical area is defined by local regulations.
j) a 5G ProSe direct discovery UE ID for restricted direct discovery;
k) a list of group member discovery parameters that enable the group member
discovery. For each group the list consists of, one application layer group
ID, layer-2 group ID and User info ID;
NOTE 2: User info ID is expected to be assigned uniquely to a user within the
discovery group.
l) a list of ProSe identifiers to be used for direct discovery over PC5
interface;
m) a list of ProSe identifiers to default destination layer-2 ID for initial
discovery signalling mapping rule. Each mapping rule contains one or more
ProSe identifiers and the default destination layer-2 ID for the initial
signalling of direct discovery;
NOTE 3: The ProSe identifiers to default destination layer-2 ID for initial
discovery signalling mapping rule can include a default configuration entry
with the lowest priority for the ProSe services that do not have corresponding
configurations in the mapping rule (see 3GPP TS 24.555 [17]).
n) default PC5 DRX configuration as specified in TS 38.331 [13] when the UE is
not served by NG-RAN; and
o) optionally, the 5G DDNMF address information in the HPLMN.
NOTE 4: The security parameters for 5G ProSe direct discovery are provisioned
by 5G DDNMF as defined in clause 6.2.
### 5.2.4 Configuration parameters for 5G ProSe direct communication over PC5
interface
The configuration parameters for 5G ProSe direct communication over PC5
interface consist of:
a) a validity timer for the validity of the configuration parameters for 5G
ProSe direct communication over PC5 interface;
b) a list of PLMNs in which the UE is authorized to use 5G ProSe direct
communication over PC5 interface when the UE is served by NG-RAN. Each entry
of the list contains a PLMN ID in which the UE is authorized to use 5G ProSe
direct communication over PC5 interface;
c) an indication of whether the UE is authorized to use 5G ProSe direct
communication over PC5 interface when the UE is not served by NG-RAN;
d) the radio parameters of the 5G ProSe direct communication over PC5
interface applicable per geographical area with an indication of whether these
radio parameters are \"operator managed\" or \"non-operator managed\" when the
UE is not served by NG-RAN;
e) configuration parameters for groupcast mode 5G ProSe direct communication
for each application layer group, consisting of:
1) application layer group ID;
2) ProSe layer-2 group identifier;
3) ProSe group IP multicast address;
4) an indication of whether the UE is authorized to use IPv4 or IPv6; and
5) optionally, an IPv4 address to be used by the UE as a source address for a
specific group if the UE is authorized to use IPv4;
f) configuration parameters for privacy support, consisting of:
1) a list of ProSe applications requiring privacy. Each entry of the list
contains one or more ProSe identifiers and one or more geographical areas
where the privacy is required; and
2) a privacy timer value as specified in 3GPP TS 24.555 [17];
g) optionally, a list of ProSe identifier to ProSe NR frequency mapping rules.
Each mapping rule contains one or more ProSe identifiers and the ProSe NR
frequencies with associated geographical areas;
h) a list of ProSe identifier to destination layer-2 ID for broadcast mapping
rules. Each mapping rule contains one or more ProSe identifiers and the
destination layer-2 ID for broadcast;
i) a list of ProSe identifier to destination layer-2 ID for groupcast mapping
rules. Each mapping rule contains one or more ProSe identifiers and the
destination layer-2 ID for groupcast;
j) a list of ProSe identifier to default destination layer-2 ID for unicast
initial signalling mapping rules. Each mapping rule contains one or more ProSe
identifiers and the default destination layer-2 ID for initial signalling to
establish unicast connection;
k) a list of ProSe identifier to PC5 QoS parameters mapping rules. The PC5 QoS
parameters are specified in clause 5.7 of 3GPP TS 23.304 [2];
l) an AS configuration, including a list of SLRB mapping rules applicable when
the UE is not served by NG-RAN. Each SLRB mapping rule contains a PC5 QoS
profile and an SLRB. The PC5 QoS profile contains the following parameters:
1) the PC5 QoS profile containing a PQI;
2) if the PQI of the PC5 QoS profile identifies a GBR QoS, the PC5 QoS profile
containing a PC5 flow bit rates consisting of a guaranteed flow bit rate
(GFBR) and a maximum flow bit rate (MFBR);
3) if the PQI of the PC5 QoS profile identifies a non-GBR QoS, the PC5 QoS
profile containing the PC5 link aggregated bit rate consisting of a per link
aggregate maximum bit rate (PC5 LINK-AMBR);
NOTE 1: PC5 link aggregated bit rate is only used for unicast mode
communications over PC5 interface.
4) the PC5 QoS profile containing a range, which is only used for groupcast
mode communications over PC5 interface; and
5) the PC5 QoS profile optionally containing the priority level, the averaging
window and the maximum data burst volume. If one or more of the priority
levels, the averaging window or the maximum data burst volume are not
contained in the PC5 QoS profile, their default values apply;
m) a list of 5G ProSe direct link security policies. Each entry in the list
contains a 5G ProSe direct link security policy composed of:
1) one or more ProSe identifiers;
2) the signalling integrity protection policy for the ProSe identifier(s);
3) the signalling ciphering policy for the ProSe identifier(s);
4) the user plane integrity protection policy for the ProSe identifier(s);
5) the user plane ciphering policy for the ProSe identifier(s); and
6) one or more geographical areas where the 5G ProSe direct link security
policy applies;
n) a list of ProSe identifiers to default mode of communication mapping rules.
Each mapping rule contains one or more ProSe identifiers and the default mode
of communication (one of unicast, groupcast or broadcast);
o) a list of ProSe application to path preference mapping rules (i.e., PC5
preferred, Uu preferred, or no preference) as defined in clause 5.4 in 3GPP TS
24.555 [17]. The list of ProSe application to path preference mapping rules
are in prioritized order according to the local configuration of the network;
p) a list of ProSe identifiers to NR Tx profiles for broadcast and groupcast
mapping rules. Each mapping rule contains one or more ProSe identifiers and
the NR Tx profile for broadcast and groupcast as specified in 3GPP TS 38.300
[21] and 3GPP TS 38.331 [13]; and
q) the PC5 DRX configuration for broadcast, groupcast and initial signalling
of 5G ProSe direct link establishment, as specified in 3GPP TS 38.331 [13],
including the mapping of PC5 QoS profile(s) to PC5 DRX cycle(s) and the
default PC5 DRX configuration when the UE is not served by NG-RAN.
NOTE 2: In this release of specification, the application ID defined in 3GPP
TS 23.303 [35] can be used as the ProSe identifier in 5G ProSe direct
discovery and in a consequent 5G ProSe direct communication.
NOTE 3: Each mapping rule above can include a default configuration entry with
the lowest priority for the ProSe services that do not have corresponding
configurations in the mapping rules (see 3GPP TS 24.555 [17]).
### 5.2.5 Configuration parameters for 5G ProSe UE-to-network relay
The configuration parameters for the role of a ProSe UE-to-network relay UE
over PC5 reference point consist of:
a) a validity timer for the validity of the configuration parameter for 5G
ProSe UE-to-network relay over PC5 interface;
b) a list of PLMNs in which the UE is authorised to relay traffic for 5G ProSe
layer-3 remote UEs when the UE is served by NG-RAN and in each PLMN, where
that authorization also authorizes the use of both 5G ProSe UE-to-network
relay discovery Model A and 5G ProSe UE-to-network relay discovery Model B;
c) a list of PLMNs in which the UE is authorised to relay traffic for 5G ProSe
layer-2 remote UEs when the UE is served by NG-RAN and in each PLMN, where
that authorization also authorizes the use of both 5G ProSe UE-to-network
relay discovery Model A and 5G ProSe UE-to-network relay discovery Model B;
d) the default destination layer-2 ID(s) for sending the discovery signalling
for announcement and additional information and for receiving the discovery
signalling for solicitation;
NOTE 1: Which default destination layer-2 ID is selected is up to UE
implementation when there are more than one default destination layer-2 ID.
e) a User info ID for the UE-to-network relay discovery;
f) one or more relay service code(s) for the UE-to-network relay discovery and
for each relay service code:
1) security related content for 5G ProSe relay discovery that is used when the
security procedure over control plane as specified in 3GPP TS 33.503 [34] is
used, including a validity timer for that security related content;
2) an indication of whether the relay service code is offering 5G ProSe
layer-2 or layer-3 UE-to-network relay service;
3) for 5G ProSe layer-3 UE-to-network relay UE, a set of PDU session
parameters:
i) PDU session type;
ii) DNN;
iii) optionally, SSC mode;
iv) optionally, S-NSSAI; and
v) optionally, access type preference;
4) for 5G ProSe layer-2 UE-to-network relay UE and 5G ProSe layer-3 UE-to-
network relay UE, security policies for 5G ProSe UE-to-network relay direct
communication:
i) the signalling integrity protection policy;
ii) the signalling ciphering policy;
iii) the user plane integrity protection policy; and
iv) the user plane ciphering policy; and
5) for 5G ProSe layer-2 UE-to-network relay UE and 5G ProSe layer-3 UE-to-
network relay UE, a control plane security indication to indicate whether to
use the security procedure over control plane as specified in 3GPP TS 33.503
[34]. If the control plane security indication indicates not to use the
security procedure over control plane, the 5G ProSe UE-to-network relay UE
uses the security procedure over user plane as specified in 3GPP TS 33.503
[34];
NOTE 2: If the control plane security indication indicates to use the security
procedure over control plane and the 5G ProSe UE-to-network relay UE doesn\'t
support the security procedure over control plane, the 5G ProSe UE-to-network
relay UE doesn\'t use that relay service code.
g) for 5G ProSe layer-3 UE-to-network relay UE, QoS mapping rules including:
1) a mapping between a 5QI value and a 5G ProSe PQI value over PC5 for traffic
relayed over the PC5 interface;
2) a PDB adjustment factor of the standardized PDB identified by the PQI; and
3) optionally, the relay service code(s) associated with the QoS mapping rule;
h) the radio parameters of the 5G ProSe UE-to-network relay discovery
applicable per geographical area with an indication of whether these radio
parameters are \"operator managed\" or \"non-operator managed\" when the UE is
not served by NG-RAN;
i) for 5G ProSe layer-3 UE-to-network relay UE, for Ethernet and Unstructured
traffic using IP type PDU session, a list of ProSe identifier(s) to ProSe
application server address mapping rule. Each mapping rule contains one or
more ProSe identifier(s) and IP address/FQDN and transport layer port number;
j) the radio parameters of the 5G ProSe direct communication applicable per
geographical area with an indication of whether these radio parameters are
\"operator managed\" or \"non-operator managed\" when the UE is not served by
NG-RAN;
k) optionally, the 5G PKMF address information;
l) for 5G ProSe UE-to-network relay UE, the default PC5 DRX configuration for
discovery as specified in 3GPP TS 38.331 [13] when the UE is not served by NG-
RAN; and
m) the privacy timer value for changing the source layer-2 ID assigned by the
5G ProSe UE-to-network relay UE for direct communication, as specified in 3GPP
TS 24.555 [17].
The configuration parameters for the role of a 5G ProSe remote UE consist of:
a) a validity timer for the validity of the configuration parameters for 5G
ProSe remote UE;
b) an indication whether the UE is authorized to use a 5G ProSe layer-3 UE-to-
network relay UE, where that authorization also authorizes the use of both 5G
ProSe UE-to-network relay discovery Model A and 5G ProSe UE-to-network relay
discovery Model B;
c) a list of PLMNs in which the UE is authorized to use a 5G ProSe layer-2 UE-
to-network relay UE, where that authorization also authorizes the use of both
5G ProSe UE-to-network relay discovery Model A and 5G ProSe UE-to-network
relay discovery Model B;
d) default destination layer-2 ID(s) for sending the discovery signalling for
solicitation and for receiving the discovery signalling for announcement and
additional information;
NOTE 3: Which default destination layer-2 ID is selected is up to UE
implementation when there are more than one default destination layer-2 ID.
e) a user info ID for the UE-to-network relay discovery;
f) one or more relay service code(s) for the UE-to-network relay discovery and
for each relay service code:
1) security related content for 5G ProSe relay discovery that is used when the
security procedure over control plane as specified in 3GPP TS 33.503 [34] is
used, including a validity timer for that security related content;
2) an indication of whether the relay service code is offering 5G ProSe
layer-2 or layer-3 UE-to-network relay service;
3) for 5G ProSe remote UE using 5G ProSe layer-3 UE-to-network relay, one of
the following:
i) a set of PDU session parameters for the relayed traffic without using N3IWF
access:
A) PDU session type;
B) DNN;
C) optionally, SSC mode;
D) optionally, S-NSSAI; and
E) optionally, access type preference; or
ii) an indication of using N3IWF access for the relayed traffic;
4) for 5G ProSe remote UE using 5G ProSe layer-2 UE-to-network relays or 5G
ProSe layer-3 UE-to-network relay, security policies for 5G ProSe UE-to-
network relay direct communication:
i) the signalling integrity protection policy;
ii) the signalling ciphering policy;
iii) the user plane integrity protection policy; and
iv) the user plane ciphering policy;
5) optionally, for 5G ProSe remote UE using 5G ProSe layer-3 UE-to-network
relay, the ProSe application traffic descriptor(s) (as defined in 3GPP TS
24.526 [5]) to be used for the relayed traffic; and
6) for 5G ProSe remote UE using 5G ProSe layer-2 UE-to-network relay or 5G
ProSe layer-3 UE-to-network relay, a control plane security indication to
indicatewhether to use the security procedure over control plane as specified
in 3GPP TS 33.503 [34]. If the control plane security indication indicates not
to use the security procedure over control plane, the 5G ProSe remote UE uses
the security procedure over user plane as specified in 3GPP TS 33.503 [34];
NOTE 4: If the control plane security indication indicates to use the security
procedure over control plane and the 5G ProSe remote UE doesn\'t support the
security procedure over control plane, the 5G remote UE doesn\'t use the
corresponding relay service code.
g) the radio parameters of the 5G ProSe Relay Discovery applicable per
geographical area with an indication of whether these radio parameters are
\"operator managed\" or \"non-operator managed\" when the UE is not served by
NG-RAN;
h) the radio parameters of the 5G ProSe direct communication applicable per
geographical area with an indication of whether these radio parameters are
\"operator managed\" or \"non-operator managed\" when the UE is not served by
NG-RAN;
NOTE 5: Whether a frequency band is \"operator managed\" or \"non-operator
managed\" in a given Geographical Area is defined by local regulations.
i) if at least one relay service code is configured with the indication of
using N3IWF access for the relayed traffic, the N3IWF selection information
for 5G ProSe layer-3 remote UE:
1) N3IWF identifier configuration (either FQDN or IP address); and
2) 5G ProSe layer-3 UE-to-network relays, access node selection information,
which consists of a prioritized list of PLMNs for N3IWF selection and an
indication that the selection of an N3IWF in a PLMN should be based on
Tracking Area Identity FQDN or on Operator Identifier FQDN;
j) optionally, the 5G PKMF address information;
k) for 5G ProSe remote UE, the default PC5 DRX configuration for discovery as
specified in 3GPP TS 38.331 [13] when the UE is not served by NG-RAN; and
l) the privacy timer value for changing the source layer-2 ID assigned by the
5G ProSe remote UE for direct communication, as specified in 3GPP TS 24.555
[17].
If the 5G ProSe layer-3 remote UE or the 5G ProSe layer-3 UE-to-network relay
UE receives one or more relay service code(s) with spare values, the 5G ProSe
layer-3 remote UE or the 5G ProSe layer-3 UE-to-network relay UE shall ignore
the relay service code(s) together with their associated parameters.
### 5.2.6 Configuration parameters for 5G ProSe usage information reporting
The configuration parameters for 5G ProSe usage information reporting consist
of:
a) a validity timer for the validity of the configuration parameters for 5G
ProSe usage information reporting;
b) the 5G DDNMF CTF (ADF) address information to which the UE uploads the
usage information reports;
c) the collection period;
d) the reporting window;
e) for broadcast and groupcast mode 5G ProSe direct communication, whether or
not the UE reports the group parameters in the usage information;
f) whether or not the UE reports the time stamps of the first
transmission/reception during the collection period in the usage information;
g) whether or not the UE reports the amount of data transmitted during the
collection period in the usage information, and whether with location
information;
h) whether or not the UE reports the amount of data received during the
collection period in the usage information, and whether with location
information;
i) whether or not the UE reports the time stamps when it went in and out of
NG-RAN coverage during the collection period in the usage information;
j) whether or not the UE reports the list of locations of the UE when in NG-
RAN coverage during the reporting period in the usage information;
k) whether or not the UE reports the radio parameters used for 5G ProSe direct
communication (i.e. indicator of which radio resources used and radio
frequency used) during the reporting period in the usage information; and
l) whether or not the UE reports the QoS flow information (i.e. PC5 QoS flow
identifier, PC5 QoS flow descriptions) during the reporting period in the
usage information.
## 5.3 Procedures
### 5.3.1 General
The procedure for provisioning of parameters for 5G ProSe allows the UE to
obtain 5G ProSe policy (ProSeP).
### 5.3.2 UE-requested ProSeP provisioning procedure
#### 5.3.2.1 General
The UE-requested ProSeP policy provisioning procedure enables the UE to
request ProSeP from the PCF in the following cases:
a) if the T5051 for a UE policies for 5G ProSe direct discovery expires;
b) if the T5052 for a UE policies for 5G ProSe direct communications expires;
c) if the T5053 for a UE policies for 5G ProSe UE-to-network relay UE expires;
d) if the T5054 for UE policies for 5G ProSe remote UE expires;
e) if the T5057 for UE policies for 5G ProSe usage information reporting
expires; and
f) if there are no valid configuration parameters, e.g., for the current area,
or due to abnormal situation.
The UE shall follow the principles of PTI handling for UE policy delivery
service procedures defined in 3GPP TS 24.501 [11] clause D.1.2.
#### 5.3.2.2 UE-requested ProSeP policy provisioning procedure initiation
In order to initiate the UE-requested ProSeP policy provisioning procedure,
the UE shall create a UE POLICY PROVISIONING REQUEST message (see example in
figure 5.3.2.2.1). The UE:
a) shall allocate a PTI value currently not used and set the PTI IE to the
allocated PTI value;
b) shall include the Requested UE policies IE indicating whether the UE
policies for 5G ProSe direct discovery, the UE policies for 5G ProSe direct
communications, the UE policies for 5G ProSe UE-to-network relay, the UE
policies for 5G ProSe remote UE, the UE policies for 5G ProSe usage
information reporting, or any combination of them are requested;
c) shall transport the UE POLICY PROVISIONING REQUEST message using the NAS
transport procedure as specified in 3GPP TS 24.501 [11] clause 5.4.5; and
d) shall start timer T5040.
Figure 5.3.2.2.1: UE-requested ProSeP policy provisioning procedure
#### 5.3.2.3 UE-requested ProSeP policy provisioning procedure accepted by the
network
Handling in 3GPP TS 24.587 [18] clause 5.3.2.3 shall apply.
If new UE policies for 5G ProSe direct discovery are included in the MANAGE UE
POLICY COMMAND message, the UE shall stop timer T5051 if it is running and
start timer T5051 with the value included in the UE policies for 5G ProSe
direct discovery and start using the new UE policies for 5G ProSe direct
discovery included in the MANAGE UE POLICY COMMAND message.
If new UE policies for 5G ProSe direct communications are included in the
MANAGE UE POLICY COMMAND message, the UE shall stop timer T5052 if it is
running and start timer T5052 with the value included in the UE policies for
5G ProSe direct communications and start using the new UE policies for 5G
ProSe direct communications included in the MANAGE UE POLICY COMMAND message.
If new UE policies for 5G ProSe UE-to-network relay UE are included in the
MANAGE UE POLICY COMMAND message, the UE shall stop timer T5053 if it is
running and start timer T5053 with the value included in the UE policies for
5G ProSe UE-to-network relay UE and start using the new UE policies for 5G
ProSe UE-to-network relay UE included in the MANAGE UE POLICY COMMAND message.
If the security related parameters for discovery are included in the new UE
policies for 5G ProSe UE-to-network relay UE in the MANAGE UE POLICY COMMAND
message and the security procedure over control plane as specified in 3GPP TS
33.503 [34] is used, the UE shall stop timer T5056 if it is running and start
timer T5056 with the value included in the security related parameters for
discovery, and start using the security related parameters for discovery
included in the new UE policies for 5G ProSe UE-to-network relay UE.
If new UE policies for 5G ProSe remote UE are included in the MANAGE UE POLICY
COMMAND message, the UE shall stop timer T5054 if it is running and start
timer T5054 with the value included in the UE policies for 5G ProSe remote UE
and start using the new UE policies for 5G ProSe remote UE included in the
MANAGE UE POLICY COMMAND message. If the security related parameters for
discovery are included in the new UE policies for 5G ProSe remote UE in the
MANAGE UE POLICY COMMAND message and the security procedure over control plane
as specified in 3GPP TS 33.503 [34] is used, the UE shall stop timer T5056 if
it is running and start timer T5056 with the value included in the security
related parameters for discovery, and start using the security related
parameters for discovery included in the new UE policies for 5G ProSe remote
UE.
If new UE policies for 5G ProSe usage information reporting are included in
the MANAGE UE POLICY COMMAND message, the UE shall stop timer T5057 if it is
running and start timer T5057 with the value included in the UE policies for
5G ProSe usage information reporting, and start using the UE policies for 5G
ProSe usage information reporting included in the MANAGE UE POLICY COMMAND
message.
#### 5.3.2.4 UE-requested ProSeP policy provisioning procedure not accepted by
the network
Handling in 3GPP TS 24.587 [18] clause 5.3.2.4 shall apply.
#### 5.3.2.5 Abnormal cases on the network side
Handling in 3GPP TS 24.587 [18] clause 5.3.2.5 shall apply.
#### 5.3.2.6 Abnormal cases on the UE
Handling in 3GPP TS 24.587 [18] clause 5.3.2.6 shall apply.
# 6 5G ProSe direct discovery
## 6.1 Overview
### 6.1.1 Transport protocol for PC3a control protocol messages for 5G ProSe
direct discovery
The UE and 5G DDNMF shall use HTTP 1.1 as specified in IETF RFC 7230 [3] and
IETF RFC 7231 [4] as the transport protocol for 5G ProSe messages over the
PC3a interface. The 5G ProSe messages described here shall be included in the
body of either an HTTP request message or an HTTP response message.
### 6.1.2 Handling of UE-initiated procedures
#### 6.1.2.1 General
The following rules apply for UE-initiated procedures:
a) the UE initiates 5G ProSe transactions with an HTTP request message
containing the PC3a request(s);
b) the 5G DDNMF responds to the requests with an HTTP response message
containing the PC3a response(s) for the PC3a request(s); and
c) HTTP POST methods are used for PC3a direct discovery procedures.
The UE may use UE local configuration or URSP, as defined in 3GPP TS 24.526
[5], to establish a PDU session for reaching the HPLMN 5G DDNMF:
a) if a PDU session for reaching the HPLMN 5G DDNMF is not established yet,
the UE shall establish the PDU session for reaching the HPLMN 5G DDNMF and
shall send the HTTP request message via the PDU session for reaching the HPLMN
5G DDNMF; and
b) if a PDU session for reaching the HPLMN 5G DDNMF is already established
(e.g., either due to other 5G ProSe feature or due to other application), the
UE shall send the HTTP request message via the PDU session for reaching the
HPLMN 5G DDNMF.
#### 6.1.2.2 5G DDNMF discovery
The IP address or the FQDN of the 5G DDNMF in the HPLMN may be pre-configured
in the UE. The FQDN of the 5G DDNMF in the HPLMN may also be self-constructed
by the UE, i.e. derived from the PLMN ID of the HPLMN. The FQDN of the 5G
DDNMF in the HPLMN may also be provisioned by the PCF as described in clause
5.2.3. The UE may use the pre-configured IP address or the FQDN of the 5G
DDNMF in the HPLMN to discover the 5G DDNMF.
### 6.1.3 Handling of 5G DDNMF-initiated procedures
#### 6.1.3.1 General
The 5G DDNMF address information (i.e. either IP address or FQDN) in the HPLMN
may be pre-configured in the UE. The 5G DDNMF address information (i.e. either
IP address or FQDN) in the HPLMN may also be provisioned by the PCF as
described in clause 5.2.3. The UE may use the IP address or the FQDN of the 5G
DDNMF in the HPLMN to discover the 5G DDNMF.
If the UE has neither the pre-configured 5G DDNMF address information in the
HPLMN nor the 5G DDNMF address information in the HPLMN provisioned by the
PCF, the UE may self-construct the FQDN of the 5G DDNMF in the HPLMN (e.g.
deriving the FQDN from the PLMN ID of the HPLMN).
If the UE supports the HTTP long polling, the UE shall include a Network-
Initiated Transaction Method set to \"HTTP long polling\" in the
DISCOVERY_REQUEST message to the 5G DDNMF.
Upon receiving a DISCOVERY_REQUEST message containing a Network-Initiated
Transaction Method set to \"HTTP long polling\", if the 5G DDNMF supports the
HTTP long polling, the 5G DDNMF shall include a Network-Initiated Transaction
Method set to \"HTTP long polling\" in the DISCOVERY_RESPONSE message.
If the UE receives a DISCOVERY_RESPONSE message including a Network-Initiated
Transaction Method set to \"HTTP long polling\", the UE shall use the HTTP
long polling for network initiated procedures. Otherwise, the UE shall assume
that the 5G DDNMF uses OMA Push for network initiated procedures.
#### 6.1.3.2 HTTP long polling
The HTTP long polling method is described by the following steps:
a) the UE sends an empty HTTP request message as a polling request when it
expects network initiated message(s) over the PC3a interface;
b) the 5G DDNMF defers its response to the UE\'s request until;
1) one or more network-initiated PC3a message(s) for the UE are available. The
5G DDNMF encloses the message(s) in an HTTP response message and send it to
the UE; or
2) a particular timeout for HTTP polling has occurred. The 5G DDNMF then sends
an empty HTTP response message as the polling response to the UE; and
c) after receiving the response from the 5G DDNMF, the UE may keep polling
after some waiting period if:
1) the UE receives an empty polling response; or
2) the UE receives 5G DDNMF-initiated message(s) from the 5G DDNMF but still
expects additional network-initiated message(s).
NOTE: The implementation of the HTTP polling process can be coordinated with
the SUPL (Secure User Plane Location) procedures to synchronize the SUPL
location report procedures and the HTTP polling procedure so as to reduce
unnecessary wait time of polling.
If the UE is trigged to send a PC3a message to the 5G DDNMF while it has a
pending HTTP polling request, the UE shall open another HTTP connection to the
5G DDNMF to send this new request. Alternately the UE may always use a
separate dedicated HTTP connection for polling.
#### 6.1.3.3 OMA Push
The OMA Push method is described by the following steps:
a) if one or more network-initiated PC3a message(s) for the UE are available,
the 5G DDNMF sends a push message containing a particular URL to the UE via
the OMA-Push Architecture as defined in OMA-AD-Push-V2_2-20110809-A [6]. The
URL is linked to the PC3a message(s) to be sent to the UE. The 5G DDNMF
(performing OMA Push Proxy Gateway functionality) generates a Push Message as
specified in OMA-WAP-TS-PushOTA-V2_1-20110405-A [7] with the PDU set according
to WAP-168-ServiceLoad-20010731-a [8]. The URL information shall be included
in the PDU payload;
b) after receiving the push message, the UE retrieves the URL from the payload
of the message and sends an HTTP GET request to the 5G DDNMF with this URL;
and
c) the 5G DDNMF sends an HTTP response message containing the PC3a message(s)
to the UE.
## 6.2 Procedures
### 6.2.1 Types of 5G ProSe direct discovery procedures
The following PC3a control protocol procedures are defined:
a) announce request;
b) monitor request;
c) discoveree request;
d) discoverer request;
e) match report;
f) network initiated direct discovery update;
g) announcing alert request; and
h) 5G PKMF address request procedure.
In the following descriptions of PC3a control protocol procedures, the terms
\"request\" and \"response\" refer to the corresponding PC3a control protocol
messages, not to the HTTP request or response. The following procedure
descriptions use a single PC3a control protocol message for illustration
purposes.
The PC3a control protocol procedures for 5G ProSe direct discovery shall be
integrity protected and confidentiality protected using the security
procedures defined in clause 5.2.3 in 3GPP TS 33.503 [34].
NOTE 1: A single HTTP request message can contain multiple PC3a control
protocol requests and a single HTTP response message can contain multiple PC3a
control protocol responses.
When the TLS tunnel between the UE and the 5G DDNMF for transport of PC3a
messages is established by the UE according to 3GPP TS 33.503 [34], the 5G
DDNMF shall obtain identity of the served UE using the procedures specified in
3GPP TS 33.220 [46] or 3GPP TS 33.535 [47].
### 6.2.2 Announce request procedure for open 5G ProSe direct discovery
#### 6.2.2.1 General
The purpose of the announce request procedure for open 5G ProSe direct
discovery is for the UE:
a) to obtain one or more ProSe application code(s) to be announced over the
PC5 interface, upon a request for announcing from upper layers as defined in
3GPP TS 23.304 [2];
b) to inform the 5G DDNMF that the UE wants to stop announcing a ProSe
application code as defined in 3GPP TS 23.304 [2]; or
c) to upload metadata associated with a ProSe application ID to the 5G DDNMF
as defined in 3GPP TS 23.304 [2].
The UE shall be authorized for open 5G ProSe direct discovery announcing in
the registered PLMN or the local PLMN based on the service authorization
procedure as specified in clause 5, before initiating the announce request
procedure.
The UE includes one of the ProSe application code(s) obtained as a result of a
successful announce request procedure per PROSE PC5 DISCOVERY message and
passes the PROSE PC5 DISCOVERY messages to the lower layers for transmission
over the PC5 interface.
#### 6.2.2.2 Announce request procedure initiation
Before initiating the announce request procedure for open 5G ProSe direct
discovery, the UE is configured with the data structure of the ProSe
application IDs appropriate for its HPLMN. This step is performed using
mechanisms out of scope of 3GPP.
If the UE is authorized to perform open 5G ProSe direct discovery announcing
in the PLMN operating the radio resources signalled from the serving PLMN, it
shall initiate an announce request procedure:
a) when the UE is triggered by an upper layer application to announce a ProSe
application ID and the UE has no valid corresponding ProSe application code
for that upper layer application;
b) when the validity timer T5060 assigned by the 5G DDNMF to a ProSe
application code has expired and the request from upper layers to announce the
ProSe application ID corresponding to that ProSe application code is still in
place;
c) when the UE selects a new PLMN while announcing a ProSe application code
and intends to announce in the new PLMN and the UE is authorized for open 5G
ProSe direct discovery announcing in the new PLMN;
d) when, while announcing a ProSe application ID, the UE intends to switch the
announcing PLMN to a different PLMN without performing PLMN selection and the
UE does not have a valid allocated ProSe application code for this new PLMN
yet;
e) when the UE needs to inform the 5G DDNMF that the UE wants to stop
announcing a ProSe application code; or
f) when the UE needs to update metadata associated with a ProSe application ID
to the 5G DDNMF.
When the UE selects a new PLMN while announcing a ProSe application code and
the UE is not yet authorized for open 5G ProSe direct discovery announcing in
the new PLMN, the UE shall initiate an announce request procedure only after
the UE is authorized for open 5G ProSe direct discovery announcing in the new
PLMN.
NOTE 1: To ensure service continuity if the UE needs to keep announcing a
ProSe application code corresponding to the same ProSe application ID, the UE
can initiate the announce request procedure before the validity timer T5060
assigned by the 5G DDNMF for a Prose application code expires.
The UE shall initiate the announce request procedure for open 5G ProSe direct
discovery by sending a DISCOVERY_REQUEST message with:
a) a new transaction ID;
b) the ProSe application ID set to the ProSe application ID received from
upper layers;
c) the command set to \"metadata_update\" if the UE has a valid ProSe
application code corresponding to the ProSe application ID and intends to
update metadata associated with the ProSe application ID to the 5G DDNMF,
otherwise set to \"announce\";
d) the application identity set to the ProSe identifier of the upper layer
application that requested the announcing as specified in clause 5.2.3;
e) the discovery entry ID set to 0 when this is a new request or set to the
discovery entry ID received from the 5G DDNMF if the announce request is to
update a previously sent announce request;
f) the ACE enabled indicator set to \"application-controlled extension
enabled\" if application-controlled extension is required by the upper layers
or \"normal\" if application-controlled extension is not used;
g) optionally the requested timer set to the length of validity timer
associated with the ProSe application code that the UE expects to receive from
the 5G DDNMF;
h) optionally the Metadata set to the metadata received from upper layers
associated with the ProSe application ID; and
i) optionally the announcing PLMN ID set to the PLMN ID of the local PLMN
operating the radio resources that the UE intends to use for announcing this
ProSe application ID.
If open 5G ProSe direct discovery with application-controlled extension is
requested by upper layers, the DISCOVERY_REQUEST message shall also include
the application level container, which contains application-level data
transparent to the 3GPP network, to be used by the ProSe application server
e.g., to assign ProSe application code suffix(es).
When the UE initiates the announce request procedure to inform the 5G DDNMF
that the UE wants to stop announcing a ProSe application code before the
associated valid timer expires, the UE shall set the requested timer to 0.
NOTE 2: A UE can include one or multiple transactions in one DISCOVERY_REQUEST
message for different ProSe application IDs and receive corresponding
\ element or \ element in a
DISCOVERY_RESPONSE message for each respective transaction. In the following
description of the announce request procedure, only one transaction is
included.
Figure 6.2.2.2.1 illustrates the interaction of the UE and the 5G DDNMF in the
announce request procedure.
Figure 6.2.2.2.1: Announce request procedure
#### 6.2.2.3 Announce request procedure accepted by the 5G DDNMF
Upon receiving a DISCOVERY_REQUEST message with the command set to
\"announce\", if the requested timer is included in the DISCOVERY_REQUEST
message and the requested timer is set to 0, the 5G DDNMF shall check whether
there is an existing UE context containing the discovery entry identified by
the discovery entry ID included in the DISCOVERY_REQUEST message. If the
discovery entry exists in the UE context, the 5G DDNMF shall inform the 5G
DDNMF in the announcing PLMN to remove the corresponding discovery entry as
specified in 3GPP TS 29.555 [9] when the announcing PLMN is not the same as
that of the PLMN to which the 5G DDNMF belongs and remove the discovery entry
identified by the discovery entry ID from the UE\'s context. Then the 5G DDNMF
shall send a DISCOVERY_RESPONSE message containing a \
element with:
a) the transaction ID set to the value of the transaction ID received in the
DISCOVERY_REQUEST message; and
b) the discovery entry ID set to the identifier associated with the
corresponding discovery entry.
Upon receiving a DISCOVERY_REQUEST message with the command set to
\"announce\", if the requested timer is not included in the DISCOVERY_REQUEST
message or the requested timer included in the DISCOVERY_REQUEST message is
not set to 0, the 5G DDNMF shall perform the following procedure.
The 5G DDNMF shall check that the application corresponding to the ProSe
identifier contained in the DISCOVERY_REQUEST message is authorized for open
5G ProSe direct discovery announcing. If the application is authorized for
open 5G ProSe direct discovery announcing, the 5G DDNMF may also check whether
the ProSe application ID contained in the DISCOVERY_REQUEST message is known.
If the ProSe application ID is known or the 5G DDNMF skips the check of the
ProSe application ID, the 5G DDNMF shall check whether there is an existing
context for the UE associated with the requested ProSe application ID.
If there is no associated UE context, the 5G DDNMF checks with the UDM whether
the UE is authorized for open 5G ProSe direct discovery announcing as
described in 3GPP TS 29.503 [10]. If the check indicates that the UE is
authorized then:
a) the 5G DDNMF shall check whether the UE is authorized to announce the ProSe
application ID contained in the DISCOVERY_REQUEST message;
b) if the UE is authorized to announce the ProSe application ID, the ACE
enabled indicator is included and set to \"application-controlled extension
enabled\", the application level container is included in the
DISCOVERY_REQUEST message and the requested application uses application-
controlled extension, the 5G DDNMF shall check whether the UE is authorized to
use ACE. If the UE is authorized for ACE, the 5G DDNMF shall invoke the
procedure described in 3GPP TS 29.557 [19] to check whether the UE is
authorized to announce the requested ProSe application ID with application-
defined suffix(es) and obtain suffix-related information from the ProSe
application server. The 5G DDNMF shall then allocate one ProSe application
code prefix and a value for validity timer T5060 to be used with the ProSe
application code suffix(es) obtained from the ProSe application server for the
given ProSe application ID as specified in 3GPP TS 29.557 [19]. The 5G DDNMF
may take into account the requested timer if contained in the
DISCOVERY_REQUEST message;
c) if the UE is authorized to announce the ProSe application ID, the ACE
enabled indicator is included and set to \"normal\" in the DISCOVERY_REQUEST
message and the requested application does not use application-controlled
extension, the 5G DDNMF shall allocate the corresponding ProSe application
code(s) and a value for validity timer T5060. The 5G DDNMF may take into
account the requested timer if contained in the DISCOVERY_REQUEST message;
d) if the UE is authorized to announce the ProSe application ID, the ACE
enabled indicator is set included and to \"normal\" in the DISCOVERY_REQUEST
message, the application level container is included in the DISCOVERY_REQUEST
and the requested application only uses application-controlled extension, the
5G DDNMF shall check whether the UE is authorized to use ACE. If the UE is
authorized for ACE, 5G DDNMF shall invoke the procedure described in 3GPP TS
29.557 [19] to check whether the UE is authorized to announce the requested
ProSe application ID with application-defined suffix(es) and obtain suffix-
related information from the ProSe application server. The 5G DDNMF shall then
allocate one ProSe application code prefix and a value for validity timer
T5060 to be used with the ProSe application code suffix(es) obtained from the
ProSe application server for the given ProSe application ID as specified in
3GPP TS 29.557 [19]. The 5G DDNMF may take into account the requested timer if
contained in the DISCOVERY_REQUEST message;
e) if the UE is authorized to announce the ProSe application ID, the ACE
enabled indicator is included and set to \"application-controlled-extension
enabled\" and the application level container is included in the
DISCOVERY_REQUEST message but the requested application does not use
application-controlled extension, the 5G DDNMF shall allocate the
corresponding ProSe application code(s) and a value for validity timer T5060.
The 5G DDNMF may consider the requested timer if contained in the
DISCOVERY_REQUEST message; and
f) if the UE is authorized to announce the ProSe application ID and the ACE
enabled indicator is not included in the DISCOVERY_REQUEST message, the 5G
DDNMF shall allocate the corresponding ProSe application code(s) and a value
for validity timer T5060. The 5G DDNMF may consider the requested timer if
contained in the DISCOVERY_REQUEST message.
NOTE: The 5G DDNMF can allocate multiple ProSe application codes for a given
ProSe application ID for instance in the case when one or more labels in the
ProSe application ID name are wild carded as described in clause 24.2.2 of
3GPP TS 23.003 [12].
If the requested ProSe application ID is country-specific or global as
described in clause 24.2 of 3GPP TS 23.003 [12], the 5G DDNMF shall allocate
the corresponding ProSe application code(s) or ProSe application code prefix
according to clause 24.3 of 3GPP TS 23.003 [12]. The temporary identity part
of each ProSe application code or ProSe application code prefix is taken from
the data structure corresponding to the country-specific or global ProSe
application ID namespace according to clause 24.3 of 3GPP TS 23.003 [12]. The
5G DDNMF shall use the MCC and MNC of the PLMN ID of this 5G DDNMF for the
PLMN ID part of the ProSe application code or ProSe application code prefix.
After the ProSe application code(s) or ProSe application code prefix
allocation, the 5G DDNMF then associates the ProSe application code(s) or
ProSe application code prefix with a new discovery entry identified by a non-
zero value discovery entry ID in the new context for the UE that contains the
UE\'s subscription parameters obtained from the UDM and starts timer T5061.
The UDM also provides to the 5G DDNMF the PLMN ID of the PLMN in which the UE
is currently registered. For a given set of ProSe application codes or the
allocated ProSe application code prefix, timer T5061 shall be longer than
timer T5060. By default, the value of timer T5061 is 4 minutes greater than
the value of timer T5060.
If there is an existing context for the UE that contains the UE\'s
subscription parameters obtained from the UDM, but no discovery entry
identified by the discovery entry ID contained in the DISCOVERY_REQUEST
message, the 5G DDNMF shall behave as if the discovery entry ID included in
the DISCOVERY_REQUEST message was set to 0 and the 5G DDNMF shall allocate a
new non-zero discovery entry ID for this entry.
If the metadata is included in the DISCOVERY_REQUEST message, the 5G DDNMF
shall allocate the ProSe application code or ProSe application code prefix
including a metadata index to indicate the current version of the metadata and
store the received metadata in the UE context.
Moreover, if the command is set to \"metadata_update\" in the
DISCOVERY_REQUEST message and there is an existing UE context stored in the 5G
DDNMF, the 5G DDNMF shall update the metadata in the UE context by using the
received metadata in the DISCOVERY_REQUEST message and update the ProSe
application code or ProSe application code prefix in the UE context by
changing the metadata index portion and keeping the rest unchanged.
After the ProSe application code(s) allocation, the 5G DDNMF then associates
the ProSe application code(s) with a new discovery entry identified by a non-
zero value discovery entry ID in the UE context and starts timer T5061.
If there is an existing context for the UE and a discovery entry identified by
the discovery entry ID contained in the DISCOVERY_REQUEST message associated
with the requested ProSe application ID, the 5G DDNMF shall either update the
discovery entry with a new validity timer T5060, or allocate new ProSe
application code(s) or ProSe application code prefix for the requested ProSe
application ID with a new validity timer T5060 and restart timer T5061. The 5G
DDNMF may consider the requested timer if contained in the DISCOVERY_REQUEST
message.
If a new discovery entry was created or an existing discovery entry was
updated and the UE is currently roaming or the Announcing PLMN ID is included
in the DISCOVERY_REQUEST message, the 5G DDNMF checks with the 5G DDNMF of the
VPLMN or in case of open 5G ProSe direct discovery the local PLMN identified
by the Announcing PLMN ID whether the UE is authorized for open 5G ProSe
direct discovery announcing as described in 3GPP TS 29.555 [9].
If the check indicates that the UE is authorized, then the 5G DDNMF shall send
a DISCOVERY_RESPONSE message containing a \ element with:
a) the transaction ID set to the value of the transaction ID received in the
DISCOVERY_REQUEST message from the UE;
b) either the ProSe application code(s) set to the ProSe application code(s)
allocated by the 5G DDNMF, or the ProSe application code ACE parameter set to
include the ProSe-application code- prefix allocated by the 5G DDNMF and one
or more ProSe application code suffix Ranges which contain the suffix(es) for
the ProSe application ID received in the DISCOVERY_REQUEST message from the
UE;
c) validity timer T5060 set to the T5060 timer value assigned by the 5G DDNMF
to the ProSe application code(s):
d) if the ACE enabled indicator was included by the UE in the
DISCOVERY_REQUEST message, the ACE enabled indicator set to:
1) \"application-controlled extension enabled\" if application-controlled
extension is used; or
2) \"normal\" if application-controlled extension is not used;
e) the discovery entry ID set to the identifier associated with the
corresponding discovery entry;
f) the discovery key set to a value provided by the 5G DDNMF; and
g) the current time set to the current UTC-based time at the 5G DDNMF and the
max offset.
If timer T5061 expires, the 5G DDNMF shall remove the discovery entry
identified by the discovery entry ID from the UE\'s context.
The 5G DDNMF uses the information (e.g. ProSe application ID, application
identity) received from the UE in the DISCOVERY_REQUEST message, UE identity
in GBA or AKMA information related to TLS tunnel transporting the
DISCOVERY_REQUEST message, and other information for charging purposes as
specified in 3GPP TS 32.277 [45].
#### 6.2.2.4 Announce request procedure completion by the UE
Upon receipt of the DISCOVERY_RESPONSE message, if only the transaction ID and
the discovery entry ID are contained in the \ element and
the transaction ID and the discovery entry ID match the corresponding values
sent by the UE in a DISCOVERY_REQUEST message, the UE shall:
a) stop the validity timer T5060 corresponding to the ProSe application
code(s) or ProSe application code prefix in the discovery entry identified by
the discovery entry ID;
b) remove the discovery entry identified by the discovery entry ID included;
and
c) instruct the lower layers to stop announcing.
Upon receipt of the DISCOVERY_RESPONSE message, if the transaction ID
contained in the \ element matches the value sent by the UE
in a DISCOVERY_REQUEST message with the command set to \"announce\", the UE
shall create a new discovery entry or update an existing discovery entry with
the received ProSe application code(s) and the PLMN ID of the intended
announcing PLMN. For this discovery entry, the UE shall stop the validity
timer T5060 if running and start the validity timer T5060 with the received
value. Otherwise, the UE shall discard the DISCOVERY_RESPONSE message and
shall not perform the procedures below. The UE shall set a ProSe clock (see
3GPP TS 33.503 [34]) to the value of the received current time parameter and
store the received max offset parameter.
For any one of the received ProSe application codes or ProSe application code
prefix in this discovery entry, the UE may perform open 5G ProSe direct
discovery announcing as described in clause 6.2.14.2.1.1.
#### 6.2.2.5 Announce request procedure not accepted by the 5G DDNMF
If the DISCOVERY_REQUEST message cannot be accepted by the 5G DDNMF, the 5G
DDNMF sends a DISCOVERY_RESPONSE message containing a \
element to the UE including an appropriate PC3a control protocol cause value.
If the application corresponding to the ProSe identifier contained in the
DISCOVERY_REQUEST message is not authorized for open 5G ProSe direct discovery
announcing, the 5G DDNMF shall send the DISCOVERY_RESPONSE message containing
a \ element with PC3a control protocol cause value #1
\"Invalid application\".
If the ProSe application ID contained in the DISCOVERY_REQUEST message is
unknown to the 5G DDNMF, the 5G DDNMF shall send a DISCOVERY_RESPONSE message
containing a \ element with PC3a control protocol cause value
#2 \"Unknown ProSe application ID\".
If the UE is not authorized for open 5G ProSe direct discovery announcing, the
5G DDNMF shall send the DISCOVERY_RESPONSE message containing a \ element with PC3a control protocol cause value #3 \"UE authorization
failure\".
If the UE is not authorized to use the ProSe application ID contained in the
DISCOVERY_REQUEST message, the 5G DDNMF shall send the DISCOVERY_RESPONSE
message containing a \ element with PC3a control protocol
cause value #3 \"UE authorization failure\".
If the UE requests a country-specific ProSe application ID for a country that
does not correspond to the country of its HPLMN and the 5G DDNMF has not
authorized the UE to announce in that country, the 5G DDNMF shall send a
DISCOVERY_RESPONSE message containing a \ element with PC3a
control protocol cause value #8 \"Scope violation in Prose application ID\".
If the UE requests a country-specific ProSe application ID for a country that
does not correspond to the country of its HPLMN and the 5G DDNMF has no
agreement to access the country-wide ProSe application ID database of that
country, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a
\ element with PC3a control protocol cause value #8 \"Scope
violation in Prose application ID\".
If the discovery entry ID contained in the DISCOVERY_REQUEST message is
unknown to the 5G DDNMF and the requested timer is set to zero, the 5G DDNMF
shall send a DISCOVERY_RESPONSE message containing a \
element with PC3a control protocol cause value # 10 \"Unknown or invalid
discovery entry ID\".
If the UE is not authorized to use ACE, but the DISCOVERY_REQUEST message
contains the ACE enabled indicator set to \"application-controlled extension
enabled\", the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a
\ element with PC3a control protocol cause value #12 \"UE
unauthorized for discovery with application-controlled extension\".
If the DISCOVERY_REQUEST message contains the ACE enabled indicator set to
\"application-controlled extension enabled\", but does not contain the
application level container parameter, the 5G DDNMF shall send a
DISCOVERY_RESPONSE message containing a \ element with PC3a
control protocol cause value #14 \"Missing application level container\".
If the ProSe application server indicates to the 5G DDNMF that the application
level container in the DISCOVERY_REQUEST message contains invalid information,
the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a \ element with PC3a control protocol cause value #15 \"Invalid data in
application level container\".
If the DISCOVERY_REQUEST message does not contain the ACE enabled indicator
and the requested application only uses application-controlled extension, the
5G DDNMF shall send a DISCOVERY_RESPONSE message containing a \ element with PC3a control protocol cause value #1 \"Invalid
application\".
#### 6.2.2.6 Abnormal cases
##### 6.2.2.6.1 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Indication from the transport layer of transmission failure of
DISCOVERY_REQUEST message (e.g., after TCP retransmission timeout)
The UE shall close the existing secure connection to the 5G DDNMF, establish a
new secure connection and then restart the announce request procedure.
NOTE 1: The UE can abort this procedure when detecting loss of NG-RAN coverage
in its serving PLMN.
b) No response from the 5G DDNMF after the DISCOVERY_REQUEST message has been
successfully delivered (e.g., TCP ACK has been received for the
DISCOVERY_REQUEST message)
The UE shall retransmit the DISCOVERY_REQUEST message.
NOTE 2: The UE can abort this procedure when detecting loss of NG-RAN coverage
in its serving PLMN.
NOTE 3: The timer to trigger retransmission and the maximum number of allowed
retransmissions are UE implementation specific.
c) Indication from upper layers that the request to announce the ProSe
application ID is no longer in place after sending the DISCOVERY_REQUEST
message, but before the announce request procedure is completed
The UE shall acknowledge the DISCOVERY_RESPONSE message received from the 5G
DDNMF but discard its contents and then abort the procedure.
d) Change of PLMN
If a PLMN change occurs before the announce request procedure is completed,
the procedure shall be aborted. If the UE is authorized to announce in the new
PLMN, the procedure shall be restarted once the UE is registered on the new
PLMN.
e) Absence of discovery entry ID parameter in a DISCOVERY_RESPONSE message
received in response to a DISCOVERY_REQUEST message which contained a
discovery entry ID parameter
If the DISCOVERY_REQUEST message:
1) included a requested timer which is set to 0; or
2) included an Announcing PLMN ID;
the UE shall acknowledge the DISCOVERY_RESPONSE message received from the 5G
DDNMF but discard its content and then abort the procedure.
##### 6.2.2.6.2 Abnormal cases in the 5G DDNMF
The following abnormal cases can be identified:
a) Indication from the lower layer of transmission failure of
DISCOVERY_RESPONSE message
After receiving an indication from lower layer that the DISCOVERY_RESPONSE
message has not been successfully acknowledged (e.g., TCP ACK is not
received), the 5G DDNMF shall abort the procedure and stop any associated
timer(s) T5061, if running.
### 6.2.3 Announce request procedure for restricted 5G ProSe direct discovery
model A
#### 6.2.3.1 General
The purpose of the announce request procedure for restricted 5G ProSe direct
discovery model A is for the UE:
a) to obtain a ProSe restricted code corresponding to the RPAUID to be
announced over the PC5 interface, upon a request for announcing from upper
layers (e.g., application client) as defined in 3GPP TS 23.304 [2]; or
b) to inform the 5G DDNMF that the UE wants to stop announcing a ProSe
restricted code as defined in 3GPP TS 23.304 [2].
Before initiating the announce request procedure, the UE shall be authorized
for restricted 5G ProSe direct discovery model A announcing in the registered
PLMN or local PLMN based on the service authorization procedure as specified
in clause 5.
The UE includes the ProSe restricted code obtained from a successful announce
request procedure in a PROSE PC5 DISCOVERY message and passes the PROSE PC5
DISCOVERY message to the lower layers for transmission over the PC5 interface.
#### 6.2.3.2 Announce request procedure initiation
Before initiating the announce request procedure, the user sets the
permissions for the restricted discovery using application layer mechanisms.
The application client in the UE retrieves the PDUID provisioned to the UE as
part of the service authorization procedure as specified in clause 5 and
obtains an RPAUID associated with the UE\'s PDUID from the ProSe application
server. The UE may provide metadata to be associated with the RPAUID and the
ProSe application server stores the metadata. This step is performed using
mechanisms that are out of scope of the present specification.
If the UE is authorized to perform restricted 5G ProSe direct discovery model
A announcing in the PLMN operating the radio resources signalled from the
serving PLMN, it shall initiate an announce request procedure:
a) when the UE is triggered by an upper layer application to announce an
RPAUID and the UE has no valid corresponding ProSe restricted code for that
RPAUID of the upper layer application;
b) when the validity timer T5062 assigned by the 5G DDNMF to a ProSe
restricted code has expired and the request from upper layers to announce the
RPAUID corresponding to that ProSe restricted code is still in place;
c) when the UE selects a new PLMN while announcing a ProSe restricted code and
intends to announce in the new PLMN and the UE is authorized for restricted 5G
ProSe direct discovery model A announcing in the new PLMN;
d) when, while announcing a RPAUID, the UE intends to switch the announcing
PLMN to a different PLMN without performing PLMN selection and the UE does not
have a valid allocated ProSe restricted code for this new PLMN yet; or
e) when the UE needs to update a previously sent restricted 5G ProSe direct
discovery model A announcing request.
When the UE selects a new PLMN while announcing a ProSe restricted code and
the UE is not yet authorized for restricted 5G ProSe direct discovery model A
announcing in the new PLMN, the UE shall initiate an announce request
procedure only after the UE is authorized for restricted 5G ProSe direct
discovery model A announcing in the new PLMN.
NOTE 1: To ensure service continuity if the UE needs to keep announcing a
ProSe restricted code corresponding to the same RPAUID, the UE can initiate
the announce request procedure before the validity timer T5062 assigned by the
5G DDNMF for a ProSe restricted code expires.
The UE shall initiate the announce request procedure by sending a
DISCOVERY_REQUEST message with:
a) a new transaction ID not used in any other direct discovery procedures in
PC3a interface;
b) the RPAUID set to the RPAUID received from upper layers;
c) the command set to \"announce\";
d) the application identity set to the ProSe identifier of the upper layer
application that requested the announcing as specified in clause 5.2.3;
e) the discovery type set to \"Restricted discovery\";
r) the ACE enabled indicator set to \"application-controlled extension
enabled\" if application-controlled extension is required by the upper layers
or \"normal\" if application-controlled extension is not used;
g) the announcing type set to \"on demand\" if on demand announcing is
requested by upper layers and \"normal\" if on demand announcing is not
requested by upper layers;
h) optionally the requested timer set to the length of validity timer
associated with the ProSe restricted code that the UE expects to receive from
the 5G DDNMF;
i) the discovery entry ID set to a 0 if the announcing request is a new
request and set to the discovery entry ID received from the 5G DDNMF if the
announcing request is to update a previously sent announcing request;
j) optionally the announcing PLMN ID set to the PLMN ID of the local PLMN
operating the radio resources that the UE intends to use for announcing the
RPAUID; and
k) the PC5 UE ciphering algorithm capability set to the UE supported ciphering
algorithm(s) for ciphering the PROSE PC5 DISCOVERY message.
If restricted 5G ProSe direct discovery model A with application-controlled
extension is requested by upper layers, the DISCOVERY_REQUEST message shall
also include the application level container, which contains application-level
data transparent to the 3GPP network, to be used by the ProSe application
server e.g., to assign ProSe restricted code suffix(es).
When the UE initiates the announce request procedure to inform the 5G DDNMF
that the UE wants to stop announcing a ProSe restricted code before the
associated valid timer expires, the UE shall set the requested timer to 0.
NOTE 2: A UE can include one or multiple transactions in one DISCOVERY_REQUEST
message for different RPAUIDs and receive corresponding \ element or \ element in a DISCOVERY_RESPONSE
message for each respective transaction. In the following description of the
announce request procedure, only one transaction is included.
Figure 6.2.3.2.1 illustrates the interaction of the UE and the 5G DDNMF in the
announce request procedure.
Figure 6.2.3.2.1: Announce request procedure for restricted 5G ProSe direct
discovery model A
#### 6.2.3.3 Announce request procedure accepted by the 5G DDNMF
Upon receiving a DISCOVERY_REQUEST message with the command set to
\"announce\" and the discovery type set to \"Restricted discovery\", if the
requested timer is included in the DISCOVERY_REQUEST message and the requested
timer is set to 0, the 5G DDNMF shall check whether there is an existing UE
context containing the discovery entry identified by the discovery entry ID
included in the DISCOVERY_REQUEST message. If the discovery entry exists in
the UE context, the 5G DDNMF shall inform the 5G DDNMF in the announcing PLMN
to remove the corresponding discovery entry as specified in 3GPP TS 29.555 [9]
when the announcing PLMN is not the same as that of the PLMN to which the 5G
DDNMF belongs and remove the discovery entry identified by the discovery entry
ID from the UE\'s context.
Upon receiving a DISCOVERY_REQUEST message with the command set to
\"announce\" and the discovery type set to \"Restricted discovery\", if the
requested timer is not included in the DISCOVERY_REQUEST message or the
requested timer included in the DISCOVERY_REQUEST message is not set to 0, the
5G DDNMF shall perform the following procedure.
The 5G DDNMF shall check that the application corresponding to the ProSe
identifier contained in the DISCOVERY_REQUEST message is authorized for
restricted 5G ProSe direct discovery model A announcing. If the application is
authorized for restricted 5G ProSe direct discovery model A announcing, the 5G
DDNMF shall check whether there is an existing context for the UE.
If there is no associated UE context, the 5G DDNMF checks with the UDM whether
the UE is authorized for restricted 5G ProSe direct discovery model A
announcing as described in 3GPP TS 29.503 [10]. If the check indicates that
the UE is authorized, the 5G DDNMF creates a UE context that contains the
UE\'s subscription parameters obtained from the UDM. The UDM also provides to
the 5G DDNMF the PLMN ID of the PLMN in which the UE is currently registered.
If the UE context exists, the 5G DDNMF shall then check whether the UE is
authorized for restricted 5G ProSe direct discovery model A announcing in the
currently registered PLMN or in the local PLMN identified by the Announcing
PLMN ID included in the DISCOVERY_REQUEST message.
If the UE is authorized and the discovery entry ID included in the
DISCOVERY_REQUEST message is set to 0 then:
a) the 5G DDNMF shall check whether the UE is authorized to announce the
RPAUID contained in the DISCOVERY_REQUEST message. Optionally this can include
checking with the ProSe application server as described in 3GPP TS 29.557 [19]
to obtain the binding between the RPAUID and PDUID and then verifying that the
PDUID belongs to the requesting UE;
b) if the UE is authorized to announce the RPAUID, the ACE enabled indicator
is set to \"application-controlled extension enabled\", the application level
container is included in the DISCOVERY_REQUEST message and the requested
application uses application-controlled extension, the 5G DDNMF shall check
whether the UE is authorized to use ACE. If the UE is authorized for ACE, the
5G DDNMF shall invoke the procedure described in 3GPP TS 29.557 [19] to check
whether the UE is authorized to announce the requested RPAUID with
application-defined suffix(es) and obtain suffix-related information from the
ProSe application server. The 5G DDNMF shall then allocate a ProSe restricted
code prefix and a value for validity timer T5062 to be used with the ProSe
restricted code suffix(es) obtained from the ProSe application server for the
given RPAUID as specified in 3GPP TS 29.557 [19]. The 5G DDNMF may take into
account the requested timer if contained in the DISCOVERY_REQUEST message when
allocating validity timer T5062;
c) if the UE is authorized to announce the RPAUID, the ACE enabled indicator
is set to \"normal\" in the DISCOVERY_REQUEST message and the requested
application does not use application-controlled extension, the 5G DDNMF shall
allocate the corresponding ProSe restricted code and a value for validity
timer T5062. The 5G DDNMF may take into account the requested timer if
contained in the DISCOVERY_REQUEST message when allocating validity timer
T5062;
d) if the UE is authorized to announce the RPAUID, the ACE enabled indicator
is set to \"normal\" in the DISCOVERY_REQUEST message, the application level
container is included in the DISCOVERY_REQUEST and the requested application
only uses application-controlled extension, the 5G DDNMF shall check whether
the UE is authorized to use ACE. If the UE is authorized for ACE, the 5G DDNMF
shall invoke the procedure described in 3GPP TS 29.557 [19] to check whether
the UE is authorized to announce the requested RPAUID with application-defined
suffix(es) and obtain suffix-related information from the ProSe application
server. The 5G DDNMF shall then allocate a ProSe restricted code prefix and a
value for validity timer T5062 to be used with the ProSe restricted code
suffix(es) obtained from the ProSe application server for the given RPAUID as
specified in 3GPP TS 29.557 [19] The 5G DDNMF may consider the requested timer
if contained in the DISCOVERY_REQUEST message when allocating validity timer
T5062;
e) if the UE is authorized to announce the RPAUID, the ACE enabled indicator
is set to \"application-controlled-extension enabled\" and the application
level container is included in the DISCOVERY_REQUEST message but the requested
application does not use application-controlled extension, the 5G DDNMF shall
allocate the corresponding ProSe restricted code and a value for validity
timer T5062. The 5G DDNMF may consider the requested timer if contained in the
DISCOVERY_REQUEST message when allocating validity timer T5062; and
f) the 5G DDNMF associates the allocated ProSe restricted code or ProSe
restricted code prefix with a new discovery entry in the UE\'s context and
starts timer T5063. The UDM also provides to the 5G DDNMF the PLMN ID of the
PLMN in which the UE is currently registered. For a given ProSe restricted
code, timer T5063 shall be longer than timer T5062. By default, the value of
timer T5063 is 4 minutes greater than the value of timer T5062.
If the discovery entry ID included in the DISCOVERY_REQUEST message is not set
to 0 and if there is an existing discovery entry for this discovery entry ID
value in the UE\'s context, the 5G DDNMF shall either update the discovery
entry with a new validity timer T5062, or allocate a new ProSe restricted code
or ProSe restricted code prefix for the requested RPAUID with a new validity
timer T5062, restart timer T5063 and clear any existing on demand announcing
enabled indicator. The 5G DDNMF may consider the requested timer if contained
in the DISCOVERY_REQUEST message when allocating validity timer T5062.
If the discovery entry ID contained in the DISCOVERY_REQUEST message is not
found in the UE context or there is no UE context in the 5G DDNMF, the 5G
DDNMF shall behave as if the discovery entry ID included in the
DISCOVERY_REQUEST message was set to 0 and the 5G DDNMF shall allocate a new
non-zero discovery entry ID for this entry.
If the announcing type is set to \"on demand\" in the DISCOVERY_REQUEST
message, the 5G DDNMF shall check if \"on demand\" announcing is authorized
and enabled based on the ProSe identifier and the operator\'s policy. If \"on
demand\" announcing is authorized and enabled and there is no ongoing
monitoring request for this RPAUID, then the 5G DDNMF shall set the on demand
announcing enabled indicator to 1 for the corresponding discovery entry in the
UE\'s context.
If a new UE context was created or an existing UE context was updated and the
UE is currently roaming or the announcing PLMN ID is included in the
DISCOVERY_REQUEST message and the on demand announcing enabled indicator is
not set to 1 for this discovery entry in the UE\'s context, the 5G DDNMF
checks with the 5G DDNMF of the VPLMN or the local PLMN represented by the
Announcing PLMN ID whether the UE is authorized for restricted 5G ProSe direct
discovery model A announcing as described in 3GPP TS 29.555 [9].
The 5G DDNMF shall then send a DISCOVERY_RESPONSE message containing a
\ element with:
a) the transaction ID set to the value of the transaction ID received in the
DISCOVERY_REQUEST message from the UE;
b) if the on demand announcing enabled indicator is not set to 1 in the UE\'s
context for this discovery entry, either the ProSe restricted code set to the
ProSe restricted code or the ProSe restricted code prefix allocated by the 5G
DDNMF. If restricted Direct Discovery with application-controlled extension
was requested by the announcing UE , the DISCOVERY_RESPONSE message also
contains one or more ProSe restricted code suffix Ranges which contain the
suffix(es) for the RPAUID received in the DISCOVERY_REQUEST message;
c) a validity timer T5062 set to the T5062 timer value assigned by the 5G
DDNMF to the ProSe restricted code;
d) the ACE enabled indicator set to \"application-controlled extension
enabled\" if application-controlled extension is used, or \"normal\" if
application-controlled extension is not used;
e) the code-sending security parameter containing the security-related
information for the UE to protect the transmission of the ProSe restricted
code;
f) the on demand announcing enabled indicator indicating whether the on demand
announcing is enabled or not for this discovery entry if the announcing type
is set to \"on demand\" in the DISCOVERY_REQUEST message;
g) the discovery entry ID set to the ID of the discovery entry associated with
this announce request in the UE\'s context;
h) the current time set to the current UTC-based time at the 5G DDNMF and the
max offset;
i) optionally, the PC5 security policies that are associated with the ProSe
restricted code and used for 5G ProSe direct link establishment procedure
instead of any PC5 security policies configured in the UE as specified in
clause 5; and
j) the selected PC5 ciphering algorithm set to the PC5 ciphering algorithm
selected by the 5G DDNMF based on the received PC5 UE ciphering algorithm
capability and the ProSe restricted code.
If timer T5063 expires, the 5G DDNMF shall remove the discovery entry
associated with the corresponding RPAUID from the UE\'s context.
The 5G DDNMF may associate the ProSe restricted code with the PC5 security
policies.
The 5G DDNMF uses the information (e.g. application identity) received from
the UE in the DISCOVERY_REQUEST message, UE identity in GBA or AKMA
information related to TLS tunnel transporting the DISCOVERY_REQUEST message,
and other information for charging purposes as specified in 3GPP TS 32.277
[45].
#### 6.2.3.4 Announce request procedure completion by the UE
Upon receipt of the DISCOVERY_RESPONSE message, if only the transaction ID and
the discovery entry ID are contained in the \
element and the transaction ID and the discovery entry ID match the
corresponding values sent by the UE in a DISCOVERY_REQUEST message, the UE
shall:
a) stop the validity timer T5062 for the discovery entry corresponding to the
discovery entry ID received in the DISCOVERY_RESPONSE message;
b) remove the discovery entry identified by the discovery entry ID included;
and
c) instruct the lower layers to stop announcing.
Upon receipt of the DISCOVERY_RESPONSE message, if the transaction ID
contained in the \ element matches the value
sent by the UE in a DISCOVERY_REQUEST message with the command set to
\"announce\", the UE shall create a new discovery entry or update an existing
discovery entry with the received ProSe restricted code or ProSe restricted
code prefix and the PLMN ID of the intended announcing PLMN. For this
discovery entry, the UE shall stop the validity timer T5062, if running, for
the discovery entry corresponding to the discovery entry ID received in the
DISCOVERY_RESPONSE message and start the validity timer T5062 for this
discovery entry with the received value in the DISCOVERY_RESPONSE message.
Otherwise, the UE shall discard the DISCOVERY_RESPONSE message and shall not
perform the procedures below. The UE shall set a ProSe clock (see 3GPP TS
33.503 [34]) to the value of the received current time parameter and store the
received max offset parameter.
If the DISCOVERY_RESPONSE message includes new ProSe restricted code or ProSe
restricted code prefix to replace the existing ProSe restricted code being
announced, the UE shall notify lower layer to stop announcing the old ProSe
restricted code in PC5 interface.
The UE shall store the selected PC5 ciphering algorithm received in the
DISCOVERY_RESPONSE message for the received ProSe restricted code and use it
for protection of the restricted 5G ProSe direct discovery messages over the
PC5 interface as specified in clause 6.1.3.2.3 of 3GPP TS 33.503 [34].
If the DISCOVERY_RESPONSE message contains an on demand announcing enabled
indicator set to 1, the UE shall wait for an announcing alert Request message
from the 5G DDNMF of the HPLMN before starting to perform restricted 5G ProSe
direct discovery model A announcing. Otherwise, the UE may perform restricted
5G ProSe direct discovery model A announcing as described in clause
6.2.14.2.1.
#### 6.2.3.5 Announce request procedure not accepted by the 5G DDNMF
If the DISCOVERY_REQUEST message cannot be accepted by the 5G DDNMF, the 5G
DDNMF sends a DISCOVERY_RESPONSE message containing a \
element to the UE including an appropriate PC3a control protocol cause value.
If the application corresponding to the ProSe identifier contained in the
DISCOVERY_REQUEST message is not authorized for ProSe direct discovery
announcing, the 5G DDNMF shall send the DISCOVERY_RESPONSE message containing
a \ element with PC3a control protocol cause value #1
\"Invalid application\".
If the RPAUID contained in the DISCOVERY_REQUEST message is unknown to the 5G
DDNMF or ProSe application server, the 5G DDNMF shall send a
DISCOVERY_RESPONSE message containing a \ element with PC3a
control protocol cause value #9 \"Unknown RPAUID\".
If the RPAUID contained in the DISCOVERY_REQUEST message does not match the
stored RPAUID for the requested discovery entry ID, the 5G DDNMF shall send a
DISCOVERY_RESPONSE message containing a \ element with PC3a
control protocol cause value #10 \"Unknown or invalid discovery entry ID\".
If the UE is not authorized for restricted 5G ProSe direct discovery model A
announcing, the 5G DDNMF shall send the DISCOVERY_RESPONSE message containing
a \ element with PC3a control protocol cause value #3 \"UE
authorization failure\".
If the UE is not authorized for restricted \"on demand\" restricted 5G ProSe
direct discovery model A announcing, the 5G DDNMF shall send the
DISCOVERY_RESPONSE message containing a \ element with PC3a
control protocol cause value #13 \"UE unauthorized for on-demand announcing\".
If the RPAUID contained in the DISCOVERY_REQUEST message is not associated
with the PDUID belonging to the requesting UE, the 5G DDNMF shall send a
DISCOVERY_RESPONSE message containing a \ element with PC3a
control protocol cause value #3 \"UE authorization Failure\".
If the UE is not authorized to use ACE, but the DISCOVERY_REQUEST message
contains the ACE enabled indicator set to \"application-controlled extension
enabled\", the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a
\ element with PC3a control protocol cause value #12 \"UE
unauthorized for discovery with application-controlled extension\".
If the DISCOVERY_REQUEST message contains the ACE enabled indicator set to
\"application-controlled extension enabled\", but does not contain the
application level container parameter, the 5G DDNMF shall send a
DISCOVERY_RESPONSE message containing a \ element with PC3a
control protocol cause value #14 \"Missing application level container\".
If the ProSe application server indicates to the 5G DDNMF that the application
level container in the DISCOVERY_REQUEST message contains invalid information,
the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a \ element with PC3a control protocol cause value #15 \"Invalid data in
application level container\".
If the discovery entry ID contained in the DISCOVERY_REQUEST message is
unknown to the 5G DDNMF and the requested timer is set to zero, the 5G DDNMF
shall send a DISCOVERY_RESPONSE message containing a \
element with PC3a control protocol cause value # 10 \"Unknown or invalid
discovery entry ID\".
If the PC5 UE ciphering algorithm capability contained in the
DISCOVERY_REQUEST message is not compatible with the selected PC5 ciphering
algorithm for the target ProSe restricted code, the 5G DDNMF shall send a
DISCOVERY_RESPONSE message containing a \ element with PC3a
control protocol cause value #19 \"Not compatible PC5 UE ciphering algorithm
capability\".
#### 6.2.3.6 Abnormal cases
##### 6.2.3.6.1 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Indication from the transport layer of transmission failure of
DISCOVERY_REQUEST message (e.g., after TCP retransmission timeout)
The UE shall close the existing secure connection to the 5G DDNMF, establish a
new secure connection and then restart the announce request procedure.
NOTE 1: The UE can abort this procedure when detecting loss of NG-RAN coverage
in its serving PLMN.
b) No response from the 5G DDNMF after the DISCOVERY_REQUEST message has been
successfully delivered (e.g., TCP ACK has been received for the
DISCOVERY_REQUEST message)
The UE shall retransmit the DISCOVERY_REQUEST message.
NOTE 2: The UE can abort this procedure when detecting loss of NG-RAN coverage
in its serving PLMN.
NOTE 3: The timer to trigger retransmission and the maximum number of allowed
retransmissions are UE implementation specific.
c) Indication from upper layers that the request to announce the RPAUID is no
longer in place after sending the DISCOVERY_REQUEST message, but before the
announce request procedure is completed
The UE shall acknowledge the DISCOVERY_RESPONSE message received from the 5G
DDNMF but discard its contents and then abort the procedure.
d) Change of PLMN
If a PLMN change occurs before the announce request procedure is completed,
the procedure shall be aborted. If the UE is authorized to announce in the new
PLMN, the procedure shall be restarted once the UE is registered on the new
PLMN.
##### 6.2.3.6.2 Abnormal cases in the 5G DDNMF
The following abnormal cases can be identified:
a) Indication from the lower layer of transmission failure of
DISCOVERY_RESPONSE message
After receiving an indication from lower layer that the DISCOVERY_RESPONSE
message has not been successfully acknowledged (e.g. TCP ACK is not received),
the 5G DDNMF shall abort the procedure and stop any associated timer(s) T5063,
if running.
### 6.2.4 Monitor request procedure for open 5G ProSe direct discovery
#### 6.2.4.1 General
The purpose of the monitor request procedure for open 5G ProSe direct
discovery is to allow a UE:
a) to receive and process PROSE PC5 DISCOVERY messages upon a request for
monitoring from upper layers as defined in 3GPP TS 23.304 [2]; or
b) to inform the 5G DDNMF that the UE wants to stop using discovery filters
for direct discovery monitoring as defined in 3GPP TS 23.304 [2].
The UE shall only initiate the monitor request procedure if it has been
authorized for open 5G ProSe direct discovery monitoring at least in one PLMN
based on the service authorization procedure.
As a result of the monitor request procedure completing successfully, the UE
obtains one or more discovery filters, along with a TTL (Time-To-Live) timer
T5064 for each discovery filter indicating the time during which the filter is
valid.
#### 6.2.4.2 Monitor request procedure Initiation
Before initiating the monitor request procedure, the UE is configured with the
data structure of the ProSe application IDs it wants to monitor. This step is
performed using mechanisms that are out of scope of 3GPP.
If the UE is authorized to perform open 5G ProSe direct discovery monitoring
in at least one PLMN, it shall initiate a monitor request procedure:
a) when the UE is triggered by an upper layer application to perform open 5G
ProSe direct discovery monitoring corresponding to a ProSe application ID and
the UE has no valid discovery filters corresponding to the requested ProSe
application ID for that upper layer application;
b) when the TTL timer T5064 assigned by the 5G DDNMF to a discovery filter has
expired and the request from upper layers to monitor that ProSe application ID
is still in place; or
c) when the UE needs to inform the 5G DDNMF that the UE wants to stop using
discovery filters for direct discovery monitoring.
NOTE 1: To ensure service continuity if the UE needs to keep monitoring the
same discovery filter, the UE can initiate the monitor request procedure
before the TTL timer T5064 assigned by the 5G DDNMF for a discovery filter
expires.
The UE shall initiate the monitor request procedure for open 5G ProSe direct
discovery by sending a DISCOVERY_REQUEST message with:
a) a new transaction ID;
b) the ProSe application ID set to the ProSe application ID received from
upper layers;
c) the command set to \"monitor\";
d) the application identity set to the ProSe identifier of the upper layer
application that requested the monitoring as specified in clause 5.2.3;
e) the ACE enabled indicator set to \"application-controlled extension
enabled\" if application-controlled extension is required by the upper layers,
or \"normal\" if application-controlled extension is not used;
f) the discovery entry ID set to 0 if this is a new request or set to the
discovery entry ID received from the 5G DDNMF if the monitor request is to
update a previously sent monitor request; and
g) optionally, the requested timer set to 0 only when the UE wants to stop
using discovery filters for direct discovery monitoring.
If open 5G ProSe direct discovery with application-controlled extension is
requested by upper layers, the DISCOVERY_REQUEST message shall also include
the application level container, which contains information corresponding to
the ProSe application code suffix, e.g., group or user-specific information.
NOTE 2: A UE can include one or multiple transactions in one DISCOVERY_REQUEST
message for one or more ProSe application IDs and receive corresponding
\ element or \ element in the
DISCOVERY_RESPONSE message for each respective transaction. In the following
description of the monitor request procedure, only one transaction is
included.
Figure 6.2.4.2.1 illustrates the interaction between the UE and the 5G DDNMF
in the monitor request procedure.
Figure 6.2.4.2.1: Monitor request procedure
#### 6.2.4.3 Monitor request procedure accepted by the 5G DDNMF
Upon receiving a DISCOVERY_REQUEST message with the command set to
\"monitor\", if the requested timer is included in the DISCOVERY_REQUEST
message and the requested timer is set to 0, the 5G DDNMF shall check whether
there is an existing UE context containing the discovery entry identified by
the discovery entry ID included in the DISCOVERY_REQUEST message. If the
discovery entry exists in the UE context, the 5G DDNMF shall remove the
discovery entry identified by the discovery entry ID from the UE\'s context.
When the associated ProSe application ID is PLMN-specific and that PLMN ID
indicated by the ProSe application ID is not the same as that of the PLMN to
which the 5G DDNMF belongs, the 5G DDNMF shall inform the 5G DDNMF in the PLMN
indicated by the ProSe application ID to remove the corresponding discovery
entry as specified in 3GPP TS 29.555 [9]. Then the 5G DDNMF shall send a
DISCOVERY_RESPONSE message containing a \ element with:
a) the transaction ID set to the value of the transaction ID received in the
DISCOVERY_REQUEST message; and
b) the discovery entry ID set to the value of the discovery entry ID received
in the DISCOVERY_REQUEST message.
Upon receiving a DISCOVERY_REQUEST message with the command set to
\"monitor\", if the requested timer is not included in the DISCOVERY_REQUEST
message, the 5G DDNMF shall perform the following procedure.
The 5G DDNMF shall check that the application corresponding to the ProSe
identifier contained in the DISCOVERY_REQUEST message is authorized for open
5G ProSe direct discovery monitoring. If the application is authorized for
open 5G ProSe direct discovery monitoring, the 5G DDNMF checks whether there
is an existing context for the UE associated with the requested ProSe
application ID.
If there is no associated UE context, the 5G DDNMF checks with the UDM whether
the UE is authorized for open 5G ProSe direct discovery monitoring as
described in 3GPP TS 29.503 [10]. The UDM provides to the 5G DDNMF the PLMN ID
of the PLMN in which the UE is currently registered. If the subscription check
indicates that the UE is authorized, the 5G DDNMF creates a new context for
the UE and a new discovery entry identified by a non-zero value discovery
entry ID which is associated with the requested ProSe application ID.
If the ACE enabled indicator in the DISCOVERY_REQUEST message is included and
set to \"application-controlled extension enabled\" and the requested
application uses application-controlled extension, the 5G DDNMF shall check
whether the UE is authorized to use ACE. If the UE is authorized for ACE, the
5G DDNMF shall also use the procedure described in 3GPP TS 29.557 [19] to
obtain the mask(s) for monitoring the ProSe application code suffix (es)
corresponding to the requested ProSe application ID.
If the PLMN ID indicated in the ProSe application ID is PLMN-Specific and that
PLMN ID is not the same as that of the PLMN to which the 5G DDNMF belongs,
then the 5G DDNMF executes the procedures defined in 3GPP TS 29.555 [9] to
obtain the discovery filter(s) for the ProSe application ID. Otherwise, the 5G
DDNMF shall allocate one or more discovery filters for the requested ProSe
application ID if it is known to the 5G DDNMF and at least one corresponding
valid ProSe application code or ProSe application code prefix is available in
the 5G DDNMF. _Each discovery filter consists of a ProSe application code, one
or more ProSe application masks and a TTL timer T5_ 064 _. If application-
controlled extension is used, the allocated Discovery Filter shall be
applicable to match both prefix and suffix portions of the ProSe application
code._
If the requested ProSe application ID is country-specific or global or PLMN-
specific as defined respectively in clause 24.2 of 3GPP TS 23.003 [12], the 5G
DDNMF shall allocate the discovery filter which contains ProSe application
code and ProSe application mask(s) in the corresponding scope. If the ProSe
application ID is country-specific or global, the ProSe application mask(s)
enclosed in the discovery filter hides the PLMN ID part correspondingly and
the temporary identity part is taken from the data structure corresponding to
the global or country-wide ProSe application ID namespace, as specified in
clause 24.3 of 3GPP TS 23.003 [12]. If the requested ProSe application ID is
PLMN-specific, the 5G DDNMF shall allocate one or more PLMN-specific discovery
filters. Each of these discovery filters shall contain a PLMN-specific Prose
application code and the ProSe application mask(s) whose PLMN ID portion shall
be set such that when the mask is applied to the ProSe application code, the
outcome matches the full PLMN ID of that specific PLMN.
_After the discovery filter(s) are allocated, t_ he 5G DDNMF then associates
the discovery filters with the new discovery entry in the UE context and
starts timer T5065 assigned for each discovery filter. For a given discovery
filter timer T5065 shall be longer than timer T5064. By default, the value of
timer T5065 is 4 minutes greater than the value of timer T5064.
If there is an existing context for the UE that contains the UE\'s
subscription parameters obtained from the UDM, but no discovery entry
identified by the discovery entry ID contained in the DISCOVERY_REQUEST
message, the 5G DDNMF shall check whether the UE is authorized for ProSe
direct discovery monitoring. If the UE is authorized, the 5G DDNMF shall
allocate the discovery filter as specified above.
After the discovery filter is allocated, the 5G DDNMF then associates the
discovery filter with a new discovery entry identified by a non-zero value
discovery entry ID in the UE context and starts timer T5065 assigned for each
discovery filter.
Similarly, if there is an existing context and a discovery entry identified by
the discovery entry ID contained in the DISCOVERY_REQUEST message for the UE
associated with the requested ProSe application ID, the 5G DDNMF updates the
content of discovery filter(s), associate the discovery entry with the updated
discovery filter(s) and restart timer T5065 for each filter. The update of a
discovery filter content includes setting new TTL timer(s) and if necessary,
assigning new ProSe application code or ProSe application code prefix and
ProSe application mask(s).
Then the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a
\ element with:
a) the transaction ID set to the value of the transaction ID received in the
DISCOVERY_REQUEST message from the UE;
b) the discovery entry ID set to the identifier associated with the discovery
entry;
c) if the ACE enabled indicator was included by the UE in the
DISCOVERY_REQUEST message, the ACE enabled indicator set to:
1) \"application-controlled extension enabled\" if application-controlled
extension is used; or
2) \"normal\" if application-controlled extension is not used;
d) one or more discovery filters allocated by the 5G DDNMF(s) for the ProSe
application ID received in the DISCOVERY_REQUEST message from the UE; and
e) the current time set to the current UTC-based time at the 5G DDNMF and the
max offset.
If timer T5065 expires, the 5G DDNMF shall remove the UE\'s association with
the corresponding discovery filter. Furthermore, the 5G DDNMF shall remove the
discovery entry from the UE\'s context if there is no discovery filter
corresponding to the ProSe application ID.
The 5G DDNMF uses the information (e.g. application identity) received from
the UE in the DISCOVERY_REQUEST message, UE identity in GBA or AKMA
information related to TLS tunnel transporting the DISCOVERY_REQUEST message,
and other information for charging purposes as specified in 3GPP TS 32.277
[45].
#### 6.2.4.4 Monitor request procedure completion by the UE
Upon receipt of the DISCOVERY_RESPONSE message, if only the transaction ID and
the discovery entry ID are contained in the \ element and
the transaction ID and the discovery entry ID match the corresponding values
sent by the UE in a DISCOVERY_REQUEST message, the UE shall:
a) stop TTL timer T5064 for each discovery filter in the discovery entry
identified by the discovery entry ID;
b) remove the discovery entry identified by the discovery entry ID; and
c) instruct the lower layers to stop monitoring.
Upon receipt of the DISCOVERY_RESPONSE message, if the transaction ID
contained in the \ element matches the value sent by the UE
in a DISCOVERY_REQUEST message with the command set to \"monitor\", the UE
shall, for each discovery filter assigned by the 5G DDNMF, stop TTL timer
T5064 if running and start TTL timer T5064 with the received value. Otherwise,
the UE shall discard the DISCOVERY_RESPONSE message and shall not perform the
procedures below. The UE shall set a ProSe clock (see 3GPP TS 33.503 [34]) to
the value of the received current time parameter and store the received max
offset parameter.
The UE may perform open 5G ProSe direct discovery monitoring for discovery
messages received over the PC5 interface as described in clause 6.2.14.2.1.4.
#### 6.2.4.5 Monitor request procedure not accepted by the 5G DDNMF
If the DISCOVERY_REQUEST message is not accepted by the 5G DDNMF, the 5G DDNMF
shall send a DISCOVERY_RESPONSE message containing a \
element to the UE including an appropriate PC3a control protocol cause value.
If the application corresponding to the ProSe identifier contained in the
DISCOVERY_REQUEST message is not authorized for open 5G ProSe direct discovery
monitoring, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a
\ element with PC3a control protocol cause value #1 \"Invalid
application\".
If the ProSe application ID contained in the DISCOVERY_REQUEST message is
unknown to the 5G DDNMF, the 5G DDNMF shall send a DISCOVERY_RESPONSE message
containing a \ element with PC3a control protocol cause value
#2 \"Unknown ProSe application ID\".
If the UE is not authorized for open 5G ProSe direct discovery monitoring, the
5G DDNMF shall send a DISCOVERY_RESPONSE message containing a \ element with PC3a control protocol cause value #3 \"UE authorization
failure\".
If the UE requests a country-specific ProSe application ID for a country that
does not correspond to the country of its HPLMN and the 5G DDNMF has not
authorized the UE to monitor in that country, it shall send a
DISCOVERY_RESPONSE message containing a \ element with PC3a
control protocol cause value #8 \"Scope violation in Prose application ID\".
If the UE requests a country-specific ProSe application ID for a country that
does not correspond to the country of its HPLMN and the 5G DDNMF has no
agreement to access the country-specific ProSe application ID database of that
country, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a
\ element with PC3a control protocol cause value #8 \"Scope
violation in Prose application ID\".
If the discovery entry ID contained in the DISCOVERY_REQUEST message is
unknown to the 5G DDNMF and the requested timer is set to 0, the 5G DDNMF
shall send a DISCOVERY_RESPONSE message containing a \
element with PC3a control protocol cause value #10 \"Unknown or invalid
discovery entry ID \".
If the 5G DDNMF cannot retrieve a valid ProSe application code corresponding
to the ProSe application ID contained in the DISCOVERY_REQUEST message, the 5G
DDNMF shall send a DISCOVERY_RESPONSE message containing a \
element with PC3a control protocol cause value #17 \"No valid ProSe
application code\".
If the UE is not authorized to use ACE, but the DISCOVERY_REQUEST message
contains the ACE enabled indicator set to \"application-controlled extension
enabled\", the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a
\ element with PC3a control protocol cause value #12 \"UE
unauthorized for discovery with application-controlled extension\".
If the DISCOVERY_REQUEST message does not contain the ACE enabled indicator
and the requested application only uses application-controlled extension, the
5G DDNMF shall send a DISCOVERY_RESPONSE message containing a \ element with PC3a control protocol cause value #1 \"Invalid
application\".
#### 6.2.4.6 Abnormal cases
##### 6.2.4.6.1 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Indication from the transport layer of transmission failure of
DISCOVERY_REQUEST message (e.g., after TCP retransmission timeout)
The UE shall close the existing secure connection to the 5G DDNMF, establish a
new secure connection and then restart the monitor request procedure.
NOTE 1: The UE can abort this procedure when detecting loss of NG-RAN coverage
in its serving PLMN.
b) No response from the 5G DDNMF after the DISCOVERY_REQUEST message has been
successfully delivered (e.g., TCP ACK has been received for the
DISCOVERY_REQUEST message)
The UE shall retransmit the DISCOVERY_REQUEST message.
NOTE 2: The UE can abort this procedure when detecting loss of NG-RAN coverage
in its serving PLMN.
NOTE 3: The timer to trigger retransmission and the maximum number of allowed
retransmissions are UE implementation specific.
c) Indication from upper layers that the request to monitor the ProSe
application ID is no longer in place after sending the DISCOVERY_REQUEST
message, but before the monitor request procedure is completed
The UE shall acknowledge the DISCOVERY_RESPONSE message received from the 5G
DDNMF but discard its contents and then abort the procedure.
d) Change of PLMN
If a PLMN change occurs before the monitor request procedure is completed, the
procedure shall be aborted. If the UE is authorized to monitor in the new
PLMN, the procedures shall be restarted once the UE is registered on the new
PLMN.
##### 6.2.4.6.2 Abnormal cases in the 5G DDNMF
The following abnormal cases can be identified:
a) Indication from the lower layer of transmission failure of
DISCOVERY_RESPONSE message
After receiving an indication from lower layer that the DISCOVEY_RESPONSE
message has not been successfully acknowledged, the 5G DDNMF shall abort the
procedure and stop any associated timer(s) T5065, if running.
### 6.2.5 Monitor request procedure for restricted 5G ProSe direct discovery
model A
#### 6.2.5.1 General
The purpose of the monitor request procedure for restricted 5G ProSe direct
discovery model A is:
a) to allow a UE participating in restricted 5G ProSe direct discovery model A
to receive and process PROSE PC5 DISCOVERY messages upon a request for
monitoring from upper layers as defined in 3GPP TS 23.304 [2]; or
b) to inform the 5G DDNMF that the UE wants to stop using restricted discovery
filter(s) for direct discovery monitoring as defined in 3GPP TS 23.304 [2].
The UE shall only initiate the restricted 5G ProSe direct discovery model A
monitor request procedure if it has been authorized for restricted 5G ProSe
direct discovery model A monitoring in at least in one PLMN based on the
service authorization procedure.
As a result of the monitor request procedure completing successfully, the UE
obtains one or more restricted discovery filters, along with a TTL (Time-To-
Live) timer T5066 for each restricted discovery filter indicating the time
during which the filter is valid.
#### 6.2.5.2 Monitor request procedure Initiation
Before initiating the monitor request procedure, the user sets the permissions
for the restricted discovery using application layer mechanisms. The
application client in the UE retrieves the PDUID provisioned to the UE as part
of the service authorization procedure as specified in clause 5 and obtains an
RPAUID associated with the UE\'s PDUID and the target RPAUID(s) to be
monitored from the ProSe application server. This step is performed using
mechanisms that are out of scope of the present specification.
If the UE is authorized to perform ProSe direct discovery model A monitoring
in at least one PLMN, it shall initiate a monitor request procedure:
a) when the UE is triggered by an upper layer application to perform
restricted 5G ProSe direct discovery model A monitoring corresponding to at
least one RPAUID and the UE has no valid restricted discovery filters
corresponding to the requested RPAUID for that upper layer application;
b) when the TTL timer T5066 assigned by the 5G DDNMF to a Restricted discovery
filter has expired and the request from upper layers to monitor that RPAUID is
still in place; or
NOTE 1: To ensure service continuity if the UE needs to keep monitoring the
same restricted discovery filter, the UE can initiate the monitor request
procedure before the TTL timer T5066 assigned by the 5G DDNMF for a Restricted
discovery filter expires.
c) when the UE needs to update a previously sent restricted 5G ProSe direct
discovery model A monitoring request.
The UE shall initiate the monitor request procedure by sending a
DISCOVERY_REQUEST message with:
a) a new transaction ID;
b) the RPAUID set to the RPAUID received from upper layers;
c) the command set to \"monitor\";
d) the discovery type set to \"Restricted discovery\";
e) the application identity set to the ProSe identifier of the upper layer
application that requested the monitoring as specified in clause 5.2.3;
f) the ACE enabled indicator set to \"application-controlled extension
enabled\" if application-controlled extension is required by the upper layers,
or \"normal\" if application-controlled extension is not used;
g) the application level container set to the target RPAUIDs to monitor;
h) the discovery entry ID set to 0 if the monitoring request is a new request
and set to the discovery entry ID received from the 5G DDNMF if the monitoring
request is to update a previously sent monitoring request;
i) optionally, the requested timer set to 0 only when the UE wants to stop
using restricted discovery filter(s) for direct discovery monitoring; and
j) the PC5 UE ciphering algorithm capability set to the UE supported ciphering
algorithm(s) for ciphering the PROSE PC5 DISCOVERY message.
If restricted direct discovery model A with application-controlled extension
is requested by upper layers, the application level container included in the
DISCOVERY_REQUEST also contains information corresponding to the ProSe
restricted code suffix, e.g., group or user-specific information.
NOTE 2: A UE can include one or multiple transactions in one DISCOVERY_REQUEST
message for one or more different monitoring targets and receive corresponding
\ element or \ element in the
DISCOVERY_RESPONSE message for each respective transaction. In the following
description of the monitor request procedure, only one transaction is
included.
Figure 6.2.5.2.1 illustrates the interaction between the UE and the 5G DDNMF
in the monitor request procedure.
Figure 6.2.5.2.1: Monitor request procedure for restricted 5G ProSe direct
discovery model A
#### 6.2.5.3 Monitor request procedure accepted by the 5G DDNMF
Upon receiving a DISCOVERY_REQUEST message with the command set to \"monitor\"
and the discovery type set to \"Restricted discovery\", if the requested timer
is included in the DISCOVERY_REQUEST message and the requested timer is set to
0, the 5G DDNMF shall check whether there is an existing UE context containing
the discovery entry identified by the discovery entry ID included in the
DISCOVERY_REQUEST message. If the discovery entry exists in the UE context,
the 5G DDNMF shall remove the discovery entry identified by the discovery
entry ID from the UE\'s context. For each of the PDUIDs corresponding to the
target RPAUIDs contained the restricted discovery filters in the discovery
entry, if the PDUID is PLMN-specific and that PLMN ID indicated by the PDUID
is not the same as that of the PLMN to which the 5G DDNMF belongs, the 5G
DDNMF shall inform the 5G DDNMF in the PLMN indicated by the PDUID to remove
the corresponding discovery entry as specified in 3GPP TS 29.555 [9].
Upon receiving a DISCOVERY_REQUEST message with the command set to \"monitor\"
and the discovery type set to \"Restricted discovery\", if the requested timer
is not included in the DISCOVERY_REQUEST message, the 5G DDNMF shall perform
the following procedure.
The 5G DDNMF shall check that the application corresponding to the ProSe
identifier contained in the DISCOVERY_REQUEST message is authorized for ProSe
direct discovery model A monitoring. If the application is authorized for
restricted 5G ProSe direct discovery model A monitoring, the 5G DDNMF shall
check whether there is an existing UE context.
If there is no associated UE context, the 5G DDNMF checks with the UDM whether
the UE is authorized for restricted 5G ProSe direct discovery model A
monitoring as described in 3GPP TS 29.503 [10]. The UDM provides to the 5G
DDNMF the PLMN ID of the PLMN in which the UE is currently registered. If the
subscription check indicates that the UE is authorized, the 5G DDNMF creates a
new UE context containing the UE\'s subscription parameters obtained from the
UDM.
If the discovery entry ID included in the DISCOVERY_REQUEST is set to 0 then:
a) the 5G DDNMF shall use the procedure described in 3GPP TS 29.557 [19] to
pass the application level container included in the DISCOVERY_REQUEST message
to the ProSe application server and obtain a list of PDUID(s) , an application
level container and optionally Metadata Indicator(s) corresponding to the
authorized target RPAUID(s) from the ProSe application server;
b) if the ACE enabled indicator in the DISCOVERY_REQUEST message is set to
\"application-controlled extension enabled\" and the requested application
uses application-controlled extension, the 5G DDNMF shall check whether the UE
is authorized to use ACE. If the UE is authorized for ACE, the 5G DDNMF shall
also use the procedure described in 3GPP TS 29.557 [19] to obtain the mask(s)
for monitoring a ProSe restricted suffix pool corresponding to each of the
Target RPAUIDs.
NOTE 1: The ProSe application server can reject the request for some of the
target RPAUIDs included in the application level container in the
DISCOVERY_REQUEST message because they are ineligible to be monitored by the
requesting UE. Depending on the operator policy and application layer
permissions, it is possible that only a subset of valid RPAUIDs is authorized
by the ProSe application server.
c) for each of the PDUIDs corresponding to an authorized target RPAUID, if the
PLMN ID of the PDUID is not the same as that of the PLMN to which the 5G DDNMF
belongs, then the 5G DDNMF executes the procedures defined in 3GPP TS 29.555
[9] to obtain the ProSe restricted code or ProSe restricted code prefix for
the target RPAUID and creates restricted discovery filter(s). Otherwise, for
each target RPAUID, the 5G DDNMF shall allocate one or more restricted
discovery filter(s). If the ACE enabled indicator in the DISCOVERY_REQUEST
message _does not match the ACE configuration in the_ 5G DDNMF _or ProSe
application server for this application, the ACE configuration in the_ 5G
DDNMF _or ProSe application server shall be used to create Restricted
discovery filter(s). Each Restricted discovery filter consists of a ProSe
restricted code, one or more masks, a TTL timer T5_ 066 _, optionally the_
target RPAUID, optionally a metadata indicator _and optionally metadata
associated with this RPAUID;_
_d) t_ he 5G DDNMF associates the restricted discovery filters with a new
discovery entry in the UE\'s context; and
e) the 5G DDNMF starts timer T5067 assigned for each Restricted discovery
filter. For a given restricted discovery filter, timer T5067 shall be longer
than timer T5066. By default, the value of timer T5067 is 4 minutes greater
than the value of timer T5066.
NOTE 2: For each target RPAUID, the 5G DDNMF either allocates one restricted
discovery filter for full-matching the ProSe restricted code assigned to this
RPAUID, or allocates one or more restricted discovery filter(s) for matching
the ProSe restricted code prefix and suffix pool assigned to this RPAUID.
If the discovery entry ID included in the DISCOVERY_REQUEST message is not set
to 0 and if there is an existing discovery entry for this discovery entry ID
in the UE\'s context, the 5G DDNMF shall check whether the UE is authorized
for restricted 5G ProSe direct discovery model A monitoring. If the UE is
authorized, the 5G DDNMF shall process the request as above-mentioned and
update this discovery entry with the contents of the restricted discovery
filter(s) associated with this discovery entry and restart timer T5067(s) for
each filter. The update of a restricted discovery filter content includes
setting new TTL timer(s) and if necessary, obtaining new ProSe restricted code
and ProSe restricted mask(s) via the procedure defined in 3GPP TS 29.555 [9].
If the discovery entry ID contained in the DISCOVERY_REQUEST message is not
found in the UE context or there is no UE context in the 5G DDNMF, the 5G
DDNMF shall behave as if the discovery entry ID included in the
DISCOVERY_REQUEST message was set to 0 and the 5G DDNMF shall allocate a new
non-zero discovery entry ID for this entry.
Then the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a
\ element with:
a) the transaction ID set to the value of the transaction ID received in the
DISCOVERY_REQUEST message from the UE;
b) one or more restricted discovery filter(s) allocated by the 5G DDNMF(s) for
the authorized target RPAUID(s);
c) the ACE enabled indicator set to \"application-controlled extension
enabled\" if application-controlled extension is used, or \"normal\" if
application-controlled extension is not used;
d) the discovery entry ID set to the ID of the discovery entry associated with
this monitor request;
e) the application level container set to the application-level data received
from the ProSe application server;
f) the coding-receiving security parameter containing the security-related
information needed by the UE to undo the protection applied by the announcing
UE;
g) the current time set to the current UTC-based time at the 5G DDNMF and the
max offset;
h) optionally, the PC5 security policies that are associated with the ProSe
restricted code and used for 5G ProSe direct link establishment procedure
instead of any PC5 security policies configured in the UE as specified in
clause 5; and
i) the selected PC5 ciphering algorithm set to the PC5 ciphering algorithm
selected by the 5G DDNMF if the received PC5 UE ciphering algorithm capability
includes the selected PC5 ciphering algorithm associated with the ProSe
restricted code corresponding to the restricted discovery filter(s).
If T5067 expires, the 5G DDNMF shall remove the corresponding restricted
discovery filter from the discovery entry in the UE\'s context. Furthermore,
if there are no valid restricted discovery filters associated with the
discovery entry (e.g., all restricted discovery filters have expired), the 5G
DDNMF shall delete the discovery entry from the UE\'s context.
The 5G DDNMF uses the information (e.g. application identity) received from
the UE in the DISCOVERY_REQUEST message, UE identity in GBA or AKMA
information related to TLS tunnel transporting the DISCOVERY_REQUEST message,
and other information for charging purposes as specified in 3GPP TS 32.277
[45].
#### 6.2.5.4 Monitor request procedure completion by the UE
Upon receipt of the DISCOVERY_RESPONSE message, if only the transaction ID and
the discovery entry ID are contained in \ element
and the transaction ID and the discovery entry ID match the corresponding
values sent by the UE in a DISCOVERY_REQUEST message with the command set to
\"monitor\", the UE shall:
a) stop TTL timer T5066 for each Restricted discovery filter in the discovery
entry identified by the discovery entry ID;
b) remove the discovery entry identified by the discovery entry ID; and
c) instruct the lower layers to stop monitoring.
Upon receipt of the DISCOVERY_RESPONSE message, if the transaction ID
contained in the \ element matches the value sent
by the UE in a DISCOVERY_REQUEST message with the command set to \"monitor\"
and, the UE shall process as follow:
a) if the DISCOVERY_RESPONSE creates a new discovery entry, start the TTL
timer T5066 with the received value for each restricted discovery filter
information element received in the DISCOVERY_RESPONSE message; or
b) if the DISCOVERY_RESPONSE updates an existing discovery entry, the UE shall
1) stop the T5066 timer(s) of any restricted discovery filter in this
discovery entry which are no longer authorized by the 5G DDNMF, ask lower
layers to stop using those filters in monitoring operation and remove the
corresponding restricted discovery filter from the discovery entry;
2) restart the T5066 timer(s) for those remain eligible; and
3) start the T5066 timer(s) for any new restricted discovery filter(s)
included in the DISCOVERY_RESPONSE message.
Otherwise, the UE shall discard the DISCOVERY_RESPONSE message and shall not
perform the procedures below. The UE shall set a ProSe clock (see 3GPP TS
33.503 [34]) to the value of the received current time parameter and store the
received max offset parameter.
The UE shall store the selected PC5 ciphering algorithm received in the
DISCOVERY_RESPONSE message for the received ProSe restricted code and use it
for decryption of the restricted 5G ProSe direct discovery messages over the
PC5 interface as specified in clause 6.1.3.2.3 of 3GPP TS 33.503 [34].
The UE may perform monitoring for discovery messages received over the PC5
interface as described in clause 6.2.14.2.1.4.
#### 6.2.5.5 Monitor request procedure not accepted by the 5G DDNMF
If the DISCOVERY_REQUEST message is not accepted by the 5G DDNMF, the 5G DDNMF
shall send a DISCOVERY_RESPONSE message containing a \
element to the UE including an appropriate PC3a control protocol cause value.
If the application corresponding to the ProSe identifier contained in the
DISCOVERY_REQUEST message is not authorized for ProSe direct discovery
monitoring, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a
\ element with PC3a control protocol cause value #1 \"Invalid
application\".
If the RPAUID contained in the DISCOVERY_REQUEST message is unknown to the
ProSe application server, the 5G DDNMF shall send a DISCOVERY_RESPONSE message
containing a \ element with PC3a control protocol cause value
#9 \"Unknown RPAUID\".
If none of the RPAUID(s) contained in the application level container in the
DISCOVERY_REQUEST message is eligible to be discovered by the requesting
RPAUID, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a
\ element with PC3a control protocol cause value #11
\"Invalid discovery target\".
If the RPAUID contained in the DISCOVERY_REQUEST message does not match the
stored RPAUID for the requested discovery entry ID, the 5G DDNMF shall send a
DISCOVERY_RESPONSE message containing a \ element with PC3a
control protocol cause value #10 \"Unknown or invalid discovery entry ID\".
If the UE is not authorized for restricted 5G ProSe direct discovery
monitoring, the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a
\ element with PC3a control protocol cause value #3 \"UE
authorization failure\".
If the RPAUID contained in the DISCOVERY_REQUEST message is not associated
with a PDUID belonging to the requesting UE, the 5G DDNMF shall send a
DISCOVERY_RESPONSE message containing a \ element with PC3a
control protocol cause value #3 \"UE authorization failure\".
If the UE is not authorized to use ACE, but the DISCOVERY_REQUEST message
contains the ACE enabled indicator set to \"application-controlled extension
enabled\", the 5G DDNMF shall send a DISCOVERY_RESPONSE message containing a
\ element with PC3a control protocol cause value #12 \"UE
unauthorized for discovery with application-controlled extension\".
If the discovery entry ID contained in the DISCOVERY_REQUEST message is
unknown to the 5G DDNMF and the requested timer is set to 0, the 5G DDNMF
shall send a DISCOVERY_RESPONSE message containing a \
element with PC3a control protocol cause value #10 \"Unknown or invalid
discovery entry ID\".
If the PC5 UE ciphering algorithm capability contained in the
DISCOVERY_REQUEST message is not compatible with the selected PC5 ciphering
algorithm for the target ProSe restricted code, the 5G DDNMF shall send a
DISCOVERY_RESPONSE message containing a \ element with PC3a
control protocol cause value #19 \"Not compatible PC5 UE ciphering algorithm
capability\".
#### 6.2.5.6 Abnormal cases
##### 6.2.5.6.1 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Indication from the transport layer of transmission failure of
DISCOVERY_REQUEST message (e.g., after TCP retransmission timeout)
The UE shall close the existing secure connection to the 5G DDNMF, establish a
new secure connection and then restart the monitor request procedure.
NOTE 1: The UE can abort this procedure when detecting loss of NG-RAN coverage
in its serving PLMN.
b) No response from the 5G DDNMF after the DISCOVERY_REQUEST message has been
successfully delivered (e.g., TCP ACK has been received for the
DISCOVERY_REQUEST message)
The UE shall retransmit the DISCOVERY_REQUEST message.
NOTE 2: The UE can abort this procedure when detecting loss of NG-RAN coverage
in its serving PLMN.
NOTE 3: The timer to trigger retransmission and the maximum number of allowed
retransmissions are UE implementation specific.
c) Indication from upper layers that the request to monitor the targets
contained in application level container is no longer in place after sending
the DISCOVERY_REQUEST message, but before the monitor request procedure is
completed
The UE shall acknowledge the DISCOVERY_RESPONSE message received from the 5G
DDNMF but discard its contents and then abort the procedure.
d) Change of PLMN
If a PLMN change occurs before the monitor request procedure is completed, the
procedure shall be aborted. If the UE is authorized to monitor in the new
PLMN, the procedures shall be restarted once the UE is registered on the new
PLMN.
##### 6.2.5.6.2 Abnormal cases in the 5G DDNMF
The following abnormal cases can be identified:
a) Indication from the lower layer of transmission failure of
DISCOVERY_RESPONSE message
After receiving an indication from lower layer that the DISCOVERY_RESPONSE
message has not been successfully acknowledged, the 5G DDNMF shall abort the
procedure and stop any associated timer(s) T5067, if running.
### 6.2.6 Discoveree request procedure for restricted 5G ProSe direct
discovery model B
#### 6.2.6.1 General
The purpose of the discoveree request procedure for restricted 5G ProSe direct
discovery model B is for the UE to obtain discovery query filter(s) to be used
for monitoring a model B query for a RPAUID over the PC5 interface and a ProSe
response code to be announced over the PC5 interface as a response to a model
B query, as defined in 3GPP TS 23.304 [2].
Before initiating the discoveree request procedure, the UE shall be authorised
for restricted 5G ProSe direct discovery model B discoveree operation in the
registered PLMN or the local PLMN based on the service authorization procedure
as specified in clause 5.
As the result of successful completion of this procedure, the UE obtains one
or more discovery query filters and applies them to the monitoring operation
in PC5 interface. The UE shall also include the ProSe response code in a PROSE
PC5 DISCOVERY message and passes the message to the lower layers for
transmission over the PC5 interface when there is a match of the discovery
query filter(s).
#### 6.2.6.2 Discoveree request procedure initiation
Before initiating the discoveree request procedure, the user sets the
permissions for the restricted discovery using application layer mechanisms.
The application client in the UE retrieves the PDUID provisioned to the UE as
part of the service authorization procedure as specified in clause 5 and
obtains a RPAUID associated with the UE\'s PDUID from the ProSe application
server. The UE can provide metadata to be associated with the RPAUID and the
ProSe application server stores the metadata. This step is performed using
mechanisms that are out of scope of the present specification.
If the UE is authorised to perform restricted 5G ProSe direct discovery model
B discoveree operation in the PLMN operating the radio resources signalled
from the serving PLMN, it shall initiate a discoveree request procedure:
a) when the UE is triggered by an upper layer application to announce a RPAUID
in Model B and the UE has no valid corresponding ProSe response code and
discovery query filter(s) for that RPAUID of the upper layer application;
b) when the validity timer T5068 assigned by the 5G DDNMF to a ProSe response
code and the corresponding discovery query filter(s) has expired and the
request from upper layers to announce the RPAUID corresponding to that ProSe
response code is still in place;
c) when the UE selects a new PLMN while announcing or waiting for announcing a
ProSe response code and intends to announce in the new PLMN and the UE is
authorised for restricted 5G ProSe direct discovery model B discoveree
operation in the new PLMN, and the UE does not have a valid allocated ProSe
response code for this new PLMN yet; or
d) when the UE needs to update a previously sent restricted 5G ProSe direct
discovery model B discoveree request.
When the UE selects a new PLMN while announcing or waiting for announcing a
ProSe response code and the UE is not yet authorised for restricted 5G ProSe
direct discovery model B discoveree operation in the new PLMN, the UE shall
initiate a discoveree request procedure only after the UE is authorised for
restricted 5G ProSe direct discovery model B discoveree operation in the new
PLMN.
NOTE 1: To ensure service continuity if the UE needs to keep announcing in
Model B a ProSe response code corresponding to the same RPAUID, the UE can
initiate the discoveree request procedure before the validity timer T5068
assigned by the 5G DDNMF for a ProSe response code expires.
The UE shall initiate the discoveree request procedure by sending a
DISCOVERY_REQUEST message with:
a) a new transaction ID not used in any other direct discovery procedures in
PC3a interface;
b) the RPAUID set to the RPAUID received from upper layers;
c) the command set to \"response\";
d) the application identity set to the ProSe identifier of the upper layer
application that requested the announcing as specified in clause 5.2.3;
e) the discovery type set to \"Restricted discovery\";
f) the discovery model set to \"Model B\";
g) the discovery entry ID set to a 0 if the discoveree request is a new
request and set to the discovery entry ID received from the 5G DDNMF if the
discoveree request is to update a previously sent discoveree request;
h) optionally the announcing PLMN ID set to the PLMN ID of the local PLMN
operating the radio resources that the UE intends to use for announcing the
RPAUID; and
i) the PC5 UE ciphering algorithm capability set to the UE supported ciphering
algorithm(s) for ciphering the PROSE PC5 DISCOVERY message.
NOTE 2: A UE can include one or multiple transactions in one DISCOVERY_REQUEST
message for different RPAUIDs (e.g., for different applications) and receive
corresponding \ element or \
element in a DISCOVERY_RESPONSE message for each respective transaction. In
the following description of the discoveree request procedure, only one
transaction is included.
Figure 6.2.6.2.1 illustrates the interaction of the UE and the 5G DDNMF in the
discoveree request procedure.
Figure 6.2.6.2.1: Discoveree request procedure for restricted 5G ProSe direct
discovery model B
#### 6.2.6.3 Discoveree request procedure accepted by the 5G DDNMF
Upon receiving a DISCOVERY_REQUEST message, the 5G DDNMF shall check that the
application corresponding to the ProSe identifier contained in the
DISCOVERY_REQUEST message is authorised for restricted 5G ProSe direct
discovery model B discoveree operation. If the application is authorised for
restricted 5G ProSe direct discovery model B discoveree operation, the 5G
DDNMF shall check whether there is an existing context for the UE.
If there is no associated UE context, the 5G DDNMF checks with the UDM whether
the UE is authorised for restricted 5G ProSe direct discovery model B
discoveree operation as described in 3GPP TS 29.503 [10]. If the check
indicates that the UE is authorised, the 5G DDNMF creates a UE context that
contains the UE\'s subscription parameters obtained from the UDM. The UDM also
provides to the 5G DDNMF the PLMN ID of the PLMN in which the UE is currently
registered.
If the UE context exists, the 5G DDNMF shall check whether the UE is
authorized for restricted 5G ProSe direct discovery model B discoveree
operation in the currently registered PLMN or the local PLMN identified by the
Announcing PLMN ID included in the DISCOVERY_REQUEST message.
If the UE is authorized and the discovery entry ID included in the
DISCOVERY_REQUEST message is set to 0 then:
a) the 5G DDNMF shall check whether the UE is authorised to announce the
RPAUID contained in the DISCOVERY_REQUEST message. Optionally this can include
checking with the ProSe application server as described in 3GPP TS 29.557 [19]
to obtain the binding between the RPAUID and PDUID and then verifying that the
PDUID belongs to the requesting UE;
b) if the UE is authorised to announce the RPAUID, the 5G DDNMF shall allocate
the corresponding ProSe response code and ProSe query code for the RPAUID. It
shall also allocate discovery query filter(s) based on the allocated ProSe
query code. Then it shall assign a value for validity timer T5068, which is
associated with the ProSe response code, ProSe query code and discovery query
filter(s); and
c) the 5G DDNMF associates the allocated ProSe response code, ProSe query code
and discovery query filter with a new discovery entry ID in the UE context and
starts timer T5069. For a given ProSe response code, timer T5069 shall be
longer than timer T5068. By default, the value of timer T5069 is 4 minutes
greater than the value of timer T5068.
If the discovery entry ID included in the DISCOVERY_REQUEST message is not set
to 0 and if there is an existing discovery entry for this discovery entry ID
value in the UE context, the 5G DDNMF shall either update the discovery entry
with a new validity timer T5068, or allocate a new ProSe response code, ProSe
query code and the discovery query filter(s) for the requested RPAUID with a
new validity timer T5068, restart timer T5069.
If the discovery entry ID contained in the DISCOVERY_REQUEST message is not
found in the UE context or there is no UE context in the 5G DDNMF, the 5G
DDNMF shall behave as if the discovery entry ID included in the
DISCOVERY_REQUEST message was set to 0 and the 5G DDNMF shall allocate a new
non-zero discovery entry ID for this entry.
If a new UE context was created or an existing UE context was updated and the
UE is currently roaming or the Announcing PLMN ID is included in the
DISCOVERY_REQUEST message, the 5G DDNMF checks with the 5G DDNMF of the VPLMN
or the local PLMN identified by the Announcing PLMN ID whether the UE is
authorised for restricted 5G ProSe direct discovery model B discoveree
operation as described in 3GPP TS 29.555 [9].
The 5G DDNMF shall then send a DISCOVERY_RESPONSE message containing a
\ element with:
a) the transaction ID set to the value of the transaction ID received in the
DISCOVERY_REQUEST message from the UE;
b) the ProSe response code set to the ProSe response code allocated for the
RPAUID received in the DISCOVERY_REQUEST message;
c) one or more discovery query filters set to the ProSe query filter(s) used
to match a query for the RPAUID received in the DISCOVERY_REQUEST message;
d) a validity timer T5068 set to the T5068 timer value assigned by the 5G
DDNMF to the ProSe response code and the discovery query filter(s);
e) the code-sending security parameter containing the security-related
information for the discoveree UE to protect the transmission of the ProSe
response code;
f) the code-receiving security parameter containing the security-related
information needed by the discoveree UE to undo the protection applied by the
discoverer UE;
g) the discovery entry ID set to the ID of the discovery entry associated with
this discoveree request in the UE context;
h) the current time set to the current UTC-based time at the 5G DDNMF and the
max offset;
i) optionally, the PC5 security policies that are associated with the ProSe
response code and used for 5G ProSe direct link establishment procedure
instead of any PC5 security policies configured in the UE as specified in
clause 5; and
j) the selected PC5 ciphering algorithm set to the PC5 ciphering algorithm
selected by the 5G DDNMF if the received PC5 UE ciphering algorithm capability
includes the selected PC5 ciphering algorithm associated with the ProSe
response code corresponding to the discovery query filters.
If timer T5069 expires, the 5G DDNMF shall remove the discovery entry
associated with the corresponding RPAUID from the UE\'s context.
The 5G DDNMF may associate the ProSe response code with the PC5 security
policies.
The 5G DDNMF uses the information (e.g. application identity) received from
the UE in the DISCOVERY_REQUEST message, UE identity in GBA or AKMA
information related to TLS tunnel transporting the DISCOVERY_REQUEST message,
and other information for charging purposes as specified in 3GPP TS 32.277
[45].
#### 6.2.6.4 Discoveree request procedure completion by the UE
Upon receipt of the DISCOVERY_RESPONSE message, if the transaction ID
contained in the \ element matches the value
sent by the UE in a DISCOVERY_REQUEST message with the command set to
\"response\", the UE shall create a new discovery entry or update an existing
discovery entry with the ProSe response code and discovery query filter(s)
received in the DISCOVERY_RESPONSE message and the PLMN ID of the intended
announcing PLMN. For this discovery entry, the UE shall stop the validity
timer T5068 if running and start the validity timer T5068 with the received
value. The UE shall also use the received ProSe response code and discovery
query filter(s) to replace the old counterparts if they are currently used.
This may involve notifying the lower layers to stop announcing the old ProSe
response code or to stop monitoring with the old discovery query filter(s).
Otherwise, the UE shall discard the DISCOVERY_RESPONSE message and shall not
perform the procedures described in clause 6.2.14.2.2.3. The UE shall set a
ProSe clock (see 3GPP TS 33.503 [34]) to the value of the received current
time parameter and store the received max offset parameter.
The UE shall store the selected PC5 ciphering algorithm received in the
DISCOVERY_RESPONSE message for the ProSe response code and the ProSe query
code and the UE shall use it for protection of the restricted 5G ProSe direct
discovery messages over the PC5 interface as specified in clause 6.1.3.2.3 of
3GPP TS 33.503 [34].
#### 6.2.6.5 Discoveree request procedure not accepted by the 5G DDNMF
If the DISCOVERY_REQUEST message cannot be accepted by the 5G DDNMF, the 5G
DDNMF sends a DISCOVERY_RESPONSE message containing a \
element to the UE including an appropriate PC3a control protocol cause value.
If the application corresponding to the ProSe identifier contained in the
DISCOVERY_REQUEST message is not authorised for ProSe direct discovery Model B
discoveree operation, the 5G DDNMF shall send the DISCOVERY_RESPONSE message
containing a \ element with PC3a control protocol cause value
#1 \"Invalid application\".
If the RPAUID contained in the DISCOVERY_REQUEST message is unknown to the 5G
DDNMF or ProSe application server, the 5G DDNMF shall send a
DISCOVERY_RESPONSE message containing a \ element with PC3a
control protocol cause value #9 \"Unknown RPAUID\".
If the RPAUID contained in the DISCOVERY_REQUEST message does not match the
stored RPAUID for the requested discovery entry ID, the 5G DDNMF shall send a
DISCOVERY_RESPONSE message containing a \ element with PC3a
control protocol cause value #10 \"Unknown or invalid discovery entry ID\".
If the UE is not authorised for restricted 5G ProSe direct discovery model B
discoveree operation, the 5G DDNMF shall send the DISCOVERY_RESPONSE message
containing a \ element with PC3a control protocol cause value
#3 \"UE authorization failure\".
If the RPAUID contained in the DISCOVERY_REQUEST message is not associated
with a PDUID belonging to the requesting UE, the 5G DDNMF shall send a
DISCOVERY_RESPONSE message containing a \ element with PC3a
control protocol cause value #3 \"UE authorization failure\".
If the PC5 UE ciphering algorithm capability contained in the
DISCOVERY_REQUEST message is not compatible with the selected PC5 ciphering
algorithm for the ProSe response code and the ProSe query code, the 5G DDNMF
shall send a DISCOVERY_RESPONSE message containing a \
element with PC3a control protocol cause value #19 \"Not compatible PC5 UE
ciphering algorithm capability\".
#### 6.2.6.6 Abnormal cases
##### 6.2.6.6.1 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Indication from the transport layer of transmission failure of
DISCOVERY_REQUEST message (e.g., after TCP retransmission timeout)
The UE shall close the existing secure connection to the 5G DDNMF, establish a
new secure connection and then restart the discoveree request procedure.
NOTE 1: The UE can abort this procedure when detecting loss of NG-RAN coverage
in its serving PLMN.
b) No response from the 5G DDNMF after the DISCOVERY_REQUEST message has been
successfully delivered (e.g., TCP ACK has been received for the
DISCOVERY_REQUEST message)
The UE shall retransmit the DISCOVERY_REQUEST message.
NOTE 2: The UE can abort this procedure when detecting loss of NG-RAN coverage
in its serving PLMN.
NOTE 3: The timer to trigger retransmission and the maximum number of allowed
retransmissions are UE implementation specific.
c) Indication from upper layers that the request to announce the RPAUID in
model B is no longer in place after sending the DISCOVERY_REQUEST message, but
before the discoveree request procedure is completed
The UE shall acknowledge the DISCOVERY_RESPONSE message received from the 5G
DDNMF but discard its contents and then abort the procedure.
d) Change of PLMN
If a PLMN change occurs before the discoveree request procedure is completed,
the procedure shall be aborted. If the UE is authorized to perform restricted
5G ProSe direct discovery model B discoveree operation in the new PLMN, the
procedure shall be restarted once the UE is registered on the new PLMN.
##### 6.2.6.6.2 Abnormal cases in the 5G DDNMF
The following abnormal cases can be identified:
a) Indication from the lower layer of transmission failure of
DISCOVERY_RESPONSE message
After receiving an indication from lower layer that the DISCOVERY_RESPONSE
message has not been successfully acknowledged (e.g. TCP ACK is not received),
the 5G DDNMF shall abort the procedure and stop any associated timer(s) T5069,
if running.
### 6.2.7 Discoverer request procedure for restricted 5G ProSe direct
discovery model B
#### 6.2.7.1 General
The purpose of the discoverer request procedure for restricted 5G ProSe direct
discovery model B is for the UE to obtain ProSe query code(s) and discovery
response filter(s) to be used for sending query and monitoring responses over
the PC5 interface based on the information provided by the upper layer
application, as defined in 3GPP TS 23.304 [2].
Before initiating the discoverer request procedure, the UE shall be authorised
for restricted 5G ProSe direct discovery model B discoverer operation in the
registered PLMN or the local PLMN based on the service authorization procedure
as specified in clause 5.
As the result of successful completion of this procedure, the UE obtains one
or more ProSe query code(s) which can be included in a PROSE PC5 DISCOVERY
message and passes the PROSE PC5 DISCOVERY message to the lower layers for
transmission over the PC5 interface. The UE also obtains discovery response
filter(s) and apply it to the monitoring operation in PC5 interface to match
potential responses for the sent query request for the target RPAUID.
#### 6.2.7.2 Discoverer request procedure initiation
Before initiating the discoverer request procedure, the user sets the
permissions for the restricted discovery using application layer mechanisms.
The application client in the UE retrieves the PDUID provisioned to the UE as
part of the service authorization procedure as specified in clause 5 and
obtains a RPAUID associated with the UE\'s PDUID from the ProSe application
server. The UE can also obtain the target RPAUID(s) from the ProSe application
server. This step is performed using mechanisms that are out of scope of the
present specification.
If the UE is authorised to perform restricted 5G ProSe direct discovery model
B discoverer operation in the PLMN operating the radio resources signalled
from the serving PLMN, it shall initiate a discoverer request procedure:
a) when the UE is triggered by an upper layer application to perform the query
for one or more target RPAUIDs in Model B and the UE has no valid
corresponding ProSe query code and Discovery Response Filter for those target
RPAUIDs of the upper layer application;
b) when the validity timer T5070 assigned by the 5G DDNMF to a ProSe query
codes and the corresponding Discovery Response Filter has expired and the
request from upper layers to announce the RPAUID corresponding to that ProSe
response code is still in place;
c) when the UE selects a new PLMN while announcing a ProSe query code or
waiting for a ProSe response code and intends to announce the ProSe query code
in the new PLMN and the UE is authorised for restricted 5G ProSe direct
discovery model B discoverer operation in the new PLMN, and the UE does not
have a valid allocated ProSe response code for this new PLMN yet; or
d) when the UE needs to update a previously sent restricted 5G ProSe direct
discovery model B discoverer request.
When the UE selects a new PLMN while announcing a ProSe query code or waiting
for a ProSe response code and the UE is not yet authorised for restricted 5G
ProSe direct discovery model B discoverer operation in the new PLMN, the UE
shall initiate a discoverer request procedure only after the UE is authorised
for restricted 5G ProSe direct discovery model B discoverer operation in the
new PLMN.
NOTE 1: To ensure service continuity if the UE needs to keep announcing in
Model B a ProSe query code corresponding to the same RPAUID, the UE can
initiate the discoverer request procedure before the validity timer T5070
assigned by the 5G DDNMF for a ProSe query code expires.
The UE shall initiate the discoverer request procedure by sending a
DISCOVERY_REQUEST message with:
a) a new transaction ID not used in any other direct discovery procedures in
PC3a interface;
b) the RPAUID set to the RPAUID received from upper layers;
c) the application level container set to contain the application-layer
information, e.g., target RPAUID(s) to discover;
d) the command set to \"query\";
e) the application identity set to the ProSe identifier of the upper layer
application that requested the announcing as specified in clause 5.2.3;
f) the discovery type set to \"Restricted discovery\";
g) the discovery model set to \"Model B\";
h) the discovery entry ID set to a 0 if the discoverer request is a new
request and set to the discovery entry ID received from the 5G DDNMF if the
discoverer request is to update a previously sent discoverer request;
i) optionally the Announcing PLMN ID set to the PLMN ID of the local PLMN
operating the radio resources that the UE intends to use for transmitting the
query for the target RPAUID(s); and
j) the PC5 UE ciphering algorithm capability set to the UE supported ciphering
algorithm(s) for ciphering the PROSE PC5 DISCOVERY message.
NOTE 2: A UE can include one or multiple transactions in one DISCOVERY_REQUEST
message for different discovering requests (e.g., for different applications)
and receive corresponding \ element or
\ element in a DISCOVERY_RESPONSE message for each respective
transaction. In the following description of the discoverer request procedure,
only one transaction is included.
Figure 6.2.7.2.1 illustrates the interaction of the UE and the 5G DDNMF in the
discoverer request procedure.
Figure 6.2.7.2.1: Discoverer request procedure for restricted 5G ProSe direct
discovery model B
#### 6.2.7.3 Discoverer request procedure accepted by the 5G DDNMF
Upon receiving a DISCOVERY_REQUEST message, the 5G DDNMF shall check that the
application corresponding to the ProSe identifier contained in the
DISCOVERY_REQUEST message is authorised for restricted 5G ProSe direct
discovery model B discoverer operation. If the application is authorised for
restricted 5G ProSe direct discovery model B discoverer operation, the 5G
DDNMF shall check whether there is an existing context for the UE.
If there is no associated UE context, the 5G DDNMF checks with the UDM whether
the UE is authorised for restricted 5G ProSe direct discovery model B
discoverer operation as described in 3GPP TS 29.503 [10]. If the check
indicates that the UE is authorised, the 5G DDNMF creates a UE context that
contains the UE\'s subscription parameters obtained from the UDM. The UDM also
provides to the 5G DDNMF the PLMN ID of the PLMN in which the UE is currently
registered.
If the UE context exists, the 5G DDNMF shall check whether the UE is
authorized for restricted 5G ProSe direct discovery model B discoveree
operation in the currently registered PLMN or the local PLMN identified by the
Announcing PLMN ID included in the DISCOVERY_REQUEST message.
If the UE is authorized and the discovery entry ID included in the
DISCOVERY_REQUEST message is set to 0 then:
a) the 5G DDNMF uses the procedure described in 3GPP TS 29.557 [19] to pass
the application level container included in the DISCOVERY_REQUEST message to
the ProSe application server and obtain a list of PDUID(s) corresponding to
the authorised target RPAUID(s) from the ProSe application server;
b) for each of the PDUIDs corresponding to an authorised target RPAUID:
1) if the PLMN ID of the PDUID is not the same as that of the PLMN to which
the 5G DDNMF belongs, then the 5G DDNMF executes the procedures defined in
3GPP TS 29.555 [9] to obtain the ProSe query code, the ProSe response code,
the associated validity timer T5070 and _optionally metadata associated with
this_ target RPAUID. Otherwise, the 5G DDNMF shall locate the discoveree UE
context and retrieve the corresponding ProSe query code and ProSe response
code and the validity timer T5070 and _optionally metadata associated with
this RPAUID_. Then, the 5G DDNMF in the HPLMN builds one or more discovery
response filter(s) based on the respective ProSe response code and associate
the discovery response filter(s) and ProSe query code with a new validity
timer T5071 based on the remaining value of T5071; and
NOTE 1: If the 5G DDNMF cannot retrieve the corresponding discoveree UE
context for a target RPAUID, e.g., the target RPAUID has not yet been
requested to be discovered by Model B in a discoveree request procedure, or
the discoveree UE context expires, the 5G DDNMF can skip the processing of
this target RPAUID.
NOTE 2: The 5G DDNMF can choose the value of T5070 to be longer than the
remaining value of T5069, so that the discoverer UE sends a new discoverer
request for renewing the query-related information no earlier than the
discoveree UE renewing its own ProSe response code with the 5G DDNMF.
_2) t_ he 5G DDNMF associates the ProSe query code and corresponding discovery
response filter(s), target RPAUID and optionally metadata associated with the
target RPAUID with a new discovery entry in the discoverer UE\'s context; and
c) the 5G DDNMF starts timer T5071 assigned for each ProSe query code and
discovery response filter(s) (of each target RPAUID) under this discovery
entry of the discoverer UE context. For a given ProSe query code and the
corresponding discovery response filter(s), timer T5071 shall be longer than
timer T5070. By default, the value of timer T5071 is 4 minutes greater than
the value of timer T5070.
If the discovery entry ID included in the DISCOVERY_REQUEST message is not set
to 0 and if there is an existing discovery entry for this discovery entry ID
value in the UE\'s context, the 5G DDNMF shall still process the above steps,
but update the discovery entry instead of creating a new discovery entry.
If the discovery entry ID contained in the DISCOVERY_REQUEST message is not
found in the UE context or there is no UE context in the 5G DDNMF, the 5G
DDNMF shall behave as if the discovery entry ID included in the
DISCOVERY_REQUEST message was set to 0 and the 5G DDNMF shall allocate a new
non-zero discovery entry ID for this entry.
If a new UE context was created or an existing UE context was updated, the UE
is currently roaming or the announcing PLMN ID is included in the
DISCOVERY_REQUEST message, the 5G DDNMF checks with the 5G DDNMF of the VPLMN
or the local PLMN indicated by the announcing PLMN ID whether the UE is
authorised for restricted 5G ProSe direct discovery model B discoverer
operation as described in 3GPP TS 29.555 [9].
The 5G DDNMF shall then send a DISCOVERY_RESPONSE message containing a
\ element with:
a) the transaction ID set to the value of the transaction ID received in the
DISCOVERY_REQUEST message from the UE;
b) one or more Subquery Result information elements, each of which includes:
1) a target RPAUID;
2) the ProSe query code set to the ProSe query code for the target RPAUID;
3) one or more discovery response filters which are set to the discovery
response filter(s) used to match a potential ProSe response code responding to
the ProSe query code;
4) a validity timer T5070 set to the T5070 timer value assigned by the 5G
DDNMF to the ProSe query code and the discovery response filter(s);
5) optionally, the metadata associated with the target RPAUID;
6) the code-sending security parameter containing the security-related
information needed by the discoverer UE to protect the transmission of ProSe
query code; and
7) the code-receiving security parameter containing the security-related
information needed by the discoverer UE to undo the protection applied by the
discoveree UE;
c) the discovery entry ID set to the ID of the discovery entry associated with
this announce request in the UE context;
d) the current time set to the current UTC-based time at the 5G DDNMF and the
max offset;
e) optionally, the PC5 security policies that are associated with the ProSe
response code and used for 5G ProSe direct link establishment procedure
instead of any PC5 security policies configured in the UE as specified in
clause 5; and
f) the selected PC5 ciphering algorithm set to the PC5 ciphering algorithm
selected by the 5G DDNMF if the received PC5 UE ciphering algorithm capability
includes the selected PC5 ciphering algorithm associated with the ProSe
response code corresponding to the discovery response filters.
If T5071 expires, the 5G DDNMF shall remove the corresponding ProSe query code
and ProSe response filter(s) from the discovery entry associated with the
discoverer UE\'s context.
The 5G DDNMF uses the information (e.g. application identity) received from
the UE in the DISCOVERY_REQUEST message, UE identity in GBA or AKMA
information related to TLS tunnel transporting the DISCOVERY_REQUEST message,
and other information for charging purposes as specified in 3GPP TS 32.277
[45].
#### 6.2.7.4 Discoverer request procedure completion by the UE
Upon receipt of the DISCOVERY_RESPONSE message, if the transaction ID
contained in the \ element matches the value
sent by the UE in a DISCOVERY_REQUEST message with the command set to
\"query\" and the discovery model set to \"Model B\", the UE shall, process as
follow:
a) If the DISCOVERY_RESPONSE creates a new discovery entry, start the validity
timer T5070 with the received value for the ProSe query code and the
corresponding Discovery Response Filter(s) included for each SubQuery-Result
information element received in the DISCOVERY_RESPONSE message and the PLMN ID
of the intended announcing PLMN if included in the DISCOVERY_REQUEST message;
or
b) If the DISCOVERY_RESPONSE updates an existing discovery entry, the UE
shall:
1) stop the timer T5070 of any ProSe query code(s) and discovery response
filter(s) in this discovery entry which are no longer authorized by the 5G
DDNMF, ask lower layers to stop announcing the ProSe query code(s) and
monitoring ProSe response filter(s) and remove the ProSe query code(s) and
discovery response filter(s) from the existing discovery entry;
2) restart the T5070 timer(s) for those remain eligible;
3) start the T5070 timer(s) for any new ProSe query codes and their
corresponding discovery response filter(s); and
4) update the PLMN ID of the intended announcing PLMN for this discovery entry
if included in the DISCOVERY_REQUEST message.
Otherwise, the UE shall discard the DISCOVERY_RESPONSE message and shall not
perform the discoverer UE procedure for 5G ProSe direct discovery as described
in clause 6.2.14.2.2.2. The UE shall set a ProSe clock (see 3GPP TS 33.503
[34]) to the value of the received current time parameter and store the
received max offset parameter.
The UE shall store the selected PC5 ciphering algorithm received in the
DISCOVERY_RESPONSE message and use it for protection of the restricted 5G
ProSe direct discovery messages over the PC5 interface as specified in clause
6.1.3.2.3 of 3GPP TS 33.503 [34].
For each ProSe query code in this discovery entry, the UE _performs the
discoverer UE procedure for 5G ProSe direct discovery to announce the ProSe
query code in the PC5 interface, as described in clause 6.2.14.2.2.2._
#### 6.2.7.5 Discoverer request procedure not accepted by the 5G DDNMF
If the DISCOVERY_REQUEST message cannot be accepted by the 5G DDNMF, the 5G
DDNMF sends a DISCOVERY_RESPONSE message containing a \
element to the UE including an appropriate PC3a control protocol cause value.
If the application corresponding to the ProSe identifier contained in the
DISCOVERY_REQUEST message is not authorised for restricted 5G ProSe direct
discovery Model B discoverer operation, the 5G DDNMF shall send the
DISCOVERY_RESPONSE message containing a \ element with PC3a
control protocol cause value #1 \"Invalid application\".
If the RPAUID contained in the DISCOVERY_REQUEST message is unknown to the 5G
DDNMF or ProSe application server, the 5G DDNMF shall send a
DISCOVERY_RESPONSE message containing a \ element with PC3a
control protocol cause value #9 \"Unknown RPAUID\".
If the RPAUID contained in the DISCOVERY_REQUEST message does not match the
stored RPAUID for the requested discovery entry ID, the 5G DDNMF shall send a
DISCOVERY_RESPONSE message containing a \ element with PC3a
control protocol cause value #10 \"Unknown or invalid discovery entry ID\".
If the UE is not authorised for restricted 5G ProSe direct discovery model B
discoverer operation, the 5G DDNMF shall send the DISCOVERY_RESPONSE message
containing a \ element with PC3a control protocol cause value
#3 \"UE authorization failure\".
If the RPAUID contained in the DISCOVERY_REQUEST message is not associated
with a PDUID belonging to the requesting UE, the 5G DDNMF shall send a
DISCOVERY_RESPONSE message containing a \ element with PC3a
control protocol cause value #3 \"UE authorization failure\".
If the 5G DDNMF fails to retrieve any valid target PDUIDs from ProSe
application server based on the application level container contained in the
DISCOVERY_REQUEST message, the 5G DDNMF shall send a DISCOVERY_RESPONSE
message containing a \ element with PC3a control protocol
cause value #11 \"Invalid discovery target\".
If the 5G DDNMF fails to retrieve any valid discoveree UE contexts for the
valid target RPAUIDs contained in the application level container contained in
the DISCOVERY_REQUEST message, the 5G DDNMF shall send a DISCOVERY_RESPONSE
message containing a \ element with PC3a control protocol
cause value #11 \"Invalid discovery target\".
If the PC5 UE ciphering algorithm capability contained in the
DISCOVERY_REQUEST message is not compatible with the selected PC5 ciphering
algorithm for the ProSe response code and the ProSe query code, the 5G DDNMF
shall send a DISCOVERY_RESPONSE message containing a \
element with PC3a control protocol cause value #19 \"Not compatible PC5 UE
ciphering algorithm capability\".
#### 6.2.7.6 Abnormal cases
##### 6.2.7.6.1 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Indication from the transport layer of transmission failure of
DISCOVERY_REQUEST message (e.g., after TCP retransmission timeout)
The UE shall close the existing secure connection to the 5G DDNMF, establish a
new secure connection and then restart the discoverer request procedure.
NOTE 1: The UE can abort this procedure when detecting loss of NG-RAN coverage
in its serving PLMN.
b) No response from the 5G DDNMF after the DISCOVERY_REQUEST message has been
successfully delivered (e.g., TCP ACK has been received for the
DISCOVERY_REQUEST message)
The UE shall retransmit the DISCOVERY_REQUEST message.
NOTE 2: The UE can abort this procedure when detecting loss of NG-RAN coverage
in its serving PLMN.
NOTE 3: The timer to trigger retransmission and the maximum number of allowed
retransmissions are UE implementation specific.
c) Indication from upper layers that the request to discover the target
RPAUID(s) is no longer in place after sending the DISCOVERY_REQUEST message,
but before the discoverer request procedure is completed
The UE shall acknowledge the DISCOVERY_RESPONSE message received from the 5G
DDNMF but discard its contents and then abort the procedure.
d) Change of PLMN
If a PLMN change occurs before the discoverer request procedure is completed,
the procedure shall be aborted. If the UE is authorized to perform restricted
5G ProSe direct discovery discoverer operation Model B in the new PLMN, the
procedure shall be restarted once the UE is registered on the new PLMN.
##### 6.2.7.6.2 Abnormal cases in the 5G DDNMF
The following abnormal cases can be identified:
a) Indication from the lower layer of transmission failure of
DISCOVERY_RESPONSE message
After receiving an indication from lower layer that the DISCOVERY_RESPONSE
message has not been successfully acknowledged (e.g., TCP ACK is not
received), the 5G DDNMF shall abort the procedure and stop any associated
timer(s) T5071, if running.
### 6.2.8 Match report procedure for open 5G ProSe direct discovery
#### 6.2.8.1 General
The purpose of the match report procedure for open 5G ProSe direct discovery
is to allow a UE to send a ProSe application code that was matched during the
monitoring operation and receive the corresponding ProSe application ID or the
updated metadata, if there is no such a mapping stored locally or the metadata
index in the ProSe application code indicates the metadata is updated.
The UE shall only initiate the match report procedure if it has been
authorized for open 5G ProSe direct discovery monitoring in the monitored PLMN
based on the service authorization procedure.
As a result of the match report procedure completing successfully, the UE
obtains a ProSe application ID and potentially other information, which the UE
may store locally and pass to the upper layers.
#### 6.2.8.2 Match report procedure initiation
The UE shall meet the following pre-conditions before initiating this
procedure:
a) a request from upper layers to monitor for the ProSe application ID, which
resulted in the matched ProSe application code, is still in place;
b) the lower layers have provided a \"Monitored PLMN ID\" value and UTC time
information, along with the discovery message containing a ProSe application
code; and
c) the TTL timer T5064 associated with the discovery filter, which resulted in
a match event of the ProSe application code, has not expired.
If the UE is authorized to perform open 5G ProSe direct discovery monitoring
in the monitored PLMN, it should initiate a match report procedure:
a) when there is a match event of one of the ProSe application codes received
from the lower layers and the UE does not have a corresponding ProSe
application ID already locally stored;
b) when the UE has a locally stored mapping for the ProSe application code
that resulted in a match event, but the validity timer T5072 of the ProSe
application ID has expired;
c) when the UE has a locally stored mapping for the ProSe application code
that resulted in a match event, but the match report refresh timer T5074 of
the ProSe application filter has expired;
d) when there is a match event of one of the ProSe application codes received
from the lower layers and the UE has a locally stored ProSe application code
excluding the metadata index portion located by the locally stored metadata
index mask; or
e) when there is a match event of one of the ProSe application codes received
from the lower layer and the UE has not checked the MIC for the discovered
ProSe application code previously.
The UE initiates the match report procedure for open 5G ProSe direct discovery
by sending a MATCH_REPORT message with a new transaction ID and shall set the
message contents as follows:
a) the UE shall include the entire PROSE PC5 DISCOVERY message which contains
the ProSe application code for which there was a match event;
b) the UE shall set the UTC-based counter as follows:
1) the UE shall generate two UTC-based counters with:
i) the first counter composed of:
A) the 27 most significant bits of the UTC-based counter set to the 27 most
significant bits of the UTC time provided by the lower layers for the PROSE
PC5 DISCOVERY message that contained the ProSe application code for which
there was a match event encoded as specified in clause 11.2.5;
B) the 28^th^ most significant bit of the UTC-based counter set to \'0\'; and
C) the 4 least significant bits of the UTC-based counter shall be set to the 4
least significant bits of the UTC-based counter contained in the PROSE PC5
DISCOVERY message that contained the ProSe application code for which there
was a match event, as specified in 3GPP TS 33.503 [34]; and
ii) the second counter composed of:
A) the 27 most significant bits of the UTC-based counter set to the 27 most
significant bits of the UTC time provided by the lower layers for the PROSE
PC5 DISCOVERY message that contained the ProSe application code for which
there was a match event encoded as specified in clause 11.2.5;
B) the 28^th^ most significant bit of the UTC-based counter set to \'1\'; and
C) the 4 least significant bits of the UTC-based counter set to the 4 least
significant bits of the UTC-based counter contained in the PROSE PC5 DISCOVERY
message that contained the ProSe application code for which there was a match
event, as specified in 3GPP TS 33.503 [34]; and
2) then the UE shall select, among the two counters described above, the
counter that is nearest to the UTC time provided by the lower layers for the
PROSE PC5 DISCOVERY message that contained the ProSe application code for
which there was a match event encoded as specified in clause 11.2.5 and set
the UTC-based counter in the MATCH_REPORT message to that counter;
c) the UE shall set the monitored PLMN ID to the PLMN ID of the PLMN where the
PROSE PC5 DISCOVERY message was received, as provided by the lower layers;
d) if the UE was roaming when the match event occurred, the UE shall set the
VPLMN ID to the PLMN ID of the PLMN in which the UE was registered when the
match event occurred; and
e) the UE shall set the metadata flag to indicate whether or not it wishes to
receive metadata information associated with the ProSe application ID in the
MATCH_REPORT_ACK message from the 5G DDNMF.
NOTE 1: A UE can include one or multiple transactions in one MATCH_REPORT
message for different ProSe application codes and receive corresponding
\ element or \ element in the MATCH_REPORT_ACK
message for each respective transaction. In the following description of match
report procedure, only one transaction is included.
NOTE 2: The value of the metadata flag is determined through an indication
from upper layers in the original request to monitor for a ProSe application
ID.
When the 5G DDNMF receives the MATCH_REPORT message from the UE, the 5G DDNMF
checks MIC for the received PROSE PC5 DISCOVERY message as specified in 3GPP
TS 33.503 [34].
Figure 6.2.8.2.1 illustrates the interaction between the UE and the 5G DDNMF
in the match report procedure.
Figure 6.2.8.2.1: Match report procedure
#### 6.2.8.3 Match report procedure accepted by the 5G DDNMF
Upon receiving a MATCH_REPORT message, the 5G DDNMF shall check whether there
is an existing context for the UE identified by its SUPI. If there is no
associated UE context, the 5G DDNMF checks with the UDM whether the UE is
authorized for open 5G ProSe direct discovery monitoring as described in 3GPP
TS 29.503 [10].
The 5G DDNMF shall also check the PLMN ID in the ProSe application code
received from the UE. If the PLMN ID in the ProSe application code is not the
same of that of the PLMN to which the 5G DDNMF belongs, the 5G DDNMF shall
execute the procedures defined in 3GPP TS 29.555 [9]. Otherwise, the 5G DDNMF
shall check whether the received ProSe application code is authorized to be
transmitted on the monitored PLMN indicated in the Monitored PLMN ID in the
received message.
If the ProSe application code is PLMN-specific, the 5G DDNMF shall verify if
the PLMN ID in the ProSe application code is the same as the PLMN of the 5G
DDNMF. If so, the 5G DDNMF shall map the ProSe application code to the
corresponding ProSe application ID from the PLMN-specific database. If the
ProSe application code is country-specific, as specified in clause 24.3 of
3GPP TS 23.003 [4], the 5G DDNMF shall check whether the MCC of the PLMN ID
part of the ProSe application code corresponds to the country of the 5G DDNMF.
If so, the 5G DDNMF shall map the ProSe application code to the corresponding
ProSe application ID from the country-specific database. If the ProSe
application code is global as specified in clause 24.3 of 3GPP TS 23.003 [4],
the 5G DDNMF shall map the ProSe application code to the corresponding ProSe
application ID from the global database. If the ProSe application code
contains a ProSe application code prefix, the 5G DDNMF maps the ProSe
application code prefix to the corresponding ProSe application ID.
The 5G DDNMF shall analyze the ProSe application code received from the UE and
determine the validity of the ProSe application code.
NOTE: This might require the 5G DDNMF to execute procedures defined in 3GPP TS
29.555 [9].
The 5G DDNMF shall check if the MIC value and its corresponding UTC-based
counter are valid, as defined in 3GPP TS 33.503 [34].
The 5G DDNMF uses the information (e.g. ProSe application code, monitored PLMN
ID, VPLMN ID if included) received from the UE in the DISCOVERY_REQUEST
message, UE identity in GBA or AKMA information related to TLS tunnel
transporting the DISCOVERY_REQUEST message, and other information for charging
purposes as specified in 3GPP TS 32.277 [45].
If the outcome of above processing is successful, the 5G DDNMF shall send a
MATCH_REPORT_ACK message containing a \ element with:
a) the transaction ID set to the value of the transaction ID received in the
MATCH_REPORT message from the UE;
b) the ProSe application ID set to the ProSe application ID provided by the 5G
DDNMF and corresponding to the ProSe application code contained in the
MATCH_REPORT message;
c) the validity timer T5072 set to indicate for how long this ProSe
application ID is valid;
d) the match report refresh timer T5074 set to indicate for how long the UE
will wait before sending a new match report for this ProSe application code;
e) the current time set to the current UTC-based time at the 5G DDNMF; and
f) optionally, the metadata set to the metadata information associated with
the ProSe application code received in the MATCH_REPORT message and set the
metadata index mask to the metadata index mask allocated by the 5G DDNMF for
the ProSe application code received in the MATCH_REPORT message, if the UE has
set the metadata flag to indicate that it wishes to receive metadata
information associated with the ProSe application ID.
#### 6.2.8.4 Match report procedure completion by the UE
Upon receipt of the MATCH_REPORT_ACK message, if the transaction ID contained
in the \ element matches the value sent by the UE in a MATCH_REPORT
message, the UE shall store the mapping between the ProSe application code and
ProSe application ID locally, start timers T5072 and T5074 and may inform the
upper layers of this match of the ProSe application ID. If the metadata index
mask is contained in the MATCH_REPORT_ACK message, the UE shall also store the
metadata index mask with the ProSe application code and the ProSe application
ID locally. If there is a locally stored mapping between the ProSe application
ID and a ProSe application code, the UE shall delete the old mapping.
Otherwise, the UE shall discard the MATCH_REPORT_ACK message. The UE shall
update the ProSe clock (see 3GPP TS 33.503 [34]) to the value of the received
current time parameter.
Upon receipt of the MATCH_REPORT_ACK message, if the transaction ID contained
in the \ element matches the value sent by the UE in a
MATCH_REPORT message and if the received PC3a control protocol cause value is
#5 \"Invalid MIC\", as specified in clause 6.2.8.5, the UE shall stop timer
T5072 if it is running.
NOTE 1: It is an implementation specific choice whether the UE informs the
upper layers every time a ProSe application ID triggers a match event, or only
the first time this match occurs.
NOTE 2: The UE can also inform the upper layers if a ProSe application ID is
no longer matched, because the validity timer T5072 of the corresponding ProSe
application code expires.
NOTE 3: The UE can also inform the upper layers if a ProSe application ID is
no longer matched, because the validity timer T5072 of the corresponding ProSe
application code is stopped upon receiving MATCH_REPORT_ACK message with a
\ element with PC3a control protocol cause value #5 \"Invalid
MIC\".
#### 6.2.8.5 Match report procedure not accepted by the 5G DDNMF
If the MATCH_REPORT message is not accepted by the 5G DDNMF, the 5G DDNMF
sends a MATCH_REPORT_ACK message with a \ element to the UE
including an appropriate PC3a control protocol cause value.
If the ProSe application code contained in the MATCH_REPORT message is unknown
by the 5G DDNMF, the 5G DDNMF shall send the MATCH_REPORT_ACK message with a
\ element with PC3a control protocol cause value #4 \"Unknown
ProSe application code\".
If the check of the MIC contained in the MATCH_REPORT message fails, the 5G
DDNMF shall send the MATCH_REPORT_ACK message with a \ element
with PC3a control protocol cause value #5 \"Invalid MIC\".
If the check of the UTC-based counter contained in the MATCH_REPORT message
fails, the 5G DDNMF shall send the MATCH_REPORT_ACK message with a \ element with PC3a control protocol cause value #6 \"Invalid UTC-based
counter\".
If the UE is not authorized for open 5G ProSe direct discovery monitoring in
the monitored PLMN contained in the MATCH_REPORT message, the 5G DDNMF shall
send the MATCH_REPORT_ACK message with a \ element with PC3a
control protocol cause value #3 \"UE authorization failure\".
#### 6.2.8.6 Abnormal cases
##### 6.2.8.6.1 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Indication from the transport layer of transmission failure of MATCH_REPORT
message (e.g., after TCP retransmission timeout)
The UE shall close the existing secure connection to the 5G DDNMF, establish a
new secure connection and then restart the match report procedure.
b) No response from the 5G DDNMF after the MATCH_REPORT message has been
successfully delivered (e.g., TCP ACK has been received for the MATCH_REPORT
message)
If the TTL timer T5064 associated with the discovery filter which resulted in
a match event has not expired, the UE shall retransmit the MATCH_REPORT
message.
NOTE: The timer to trigger retransmission and the maximum number of allowed
retransmissions are UE implementation specific.
c) Change of PLMN
If a PLMN change occurs before the match report procedure is completed, the
procedure shall be aborted.
### 6.2.9 Match report procedure for restricted 5G ProSe direct discovery
model A
#### 6.2.9.1 General
The purpose of the match report procedure is to allow a UE to send a ProSe
restricted code that was matched during the monitoring operation and receive
the corresponding RPAUID, if there is no such a mapping stored locally.
The UE shall only initiate the match report procedure if it has been
authorized for restricted 5G ProSe direct discovery monitoring model A in the
monitored PLMN based on the service authorization procedure.
As a result of the match report procedure completing successfully, the UE
obtains a RPAUID and potentially other information, which the UE may store
locally and pass to the upper layers.
#### 6.2.9.2 Match report procedure initiation
The UE shall meet the following pre-conditions before initiating this
procedure:
a) a request from upper layers to monitor for the target RPAUID, which
resulted in the matched ProSe restricted code, is still in place;
b) the lower layers have provided UTC time information, along with the
discovery message containing the ProSe restricted code; and
c) the TTL timer T5066 associated with the Restricted discovery filter, whose
use resulted in a match event of the ProSe restricted code, has not expired.
If the UE is authorized to perform restricted 5G ProSe direct discovery
monitoring model A in the monitored PLMN, it should initiate a match report
procedure:
a) when there is a match event after applying one of the Restricted discovery
filter(s) to a ProSe restricted code received from the lower layers and the UE
does not have a corresponding RPAUID already locally stored;
b) when the UE has a locally stored mapping for the ProSe restricted code that
resulted in a match event, but the validity timer T5076 of the ProSe
restricted code has expired;
c) when the UE has a locally stored mapping for the ProSe restricted code that
resulted in a match event, but the match report refresh timer T5077 of the
ProSe restricted code has expired;
d) when the UE desires to obtain the metadata associated with the discovered
ProSe restricted code; or
e) when the UE has a locally stored mapping for the ProSe restricted code that
resulted in a match event, but the UE does not have a running match report
refresh timer T5077 for this ProSe restricted code and the UE is directed by
the 5G DDNMF to perform the required MIC check via the match report procedure.
NOTE 1: The 5G DDNMF directs the UE to use the match report procedure to
perform the MIC check by including the MIC Check Indicator parameter in the
DISCOVERY_RESPONSE message.
The UE initiates the match report procedure by sending a MATCH_REPORT message
with a new transaction ID and shall set the message contents as follows:
a) the RPAUID set to the UE\'s RPAUID which has requested the corresponding
monitoring operation that resulted this match event;
b) the discovery type set to \"Restricted discovery\";
c) the application identity set to the ProSe identifier of the upper layer
application that triggered the monitoring operation as specified in clause
5.2.3;
d) if it is not required to check the MIC via the match report procedure, the
ProSe restricted code set to the ProSe restricted code for which there was a
match event;
e) if it is required to check the MIC via the match report procedure, the
entire PROSE PC5 DISCOVERY message that contained the ProSe restricted code
for which there was a match event;
f) if it is required to check the MIC via the match report procedure, the UTC-
based counter set as follows:
1) the UE shall generate two UTC-based counters with:
i) the first counter composed of:
A) the 27 most significant bits of the UTC-based counter set to the 27 most
significant bits of the UTC time provided by the lower layers for the PROSE
PC5 DISCOVERY message that contained the ProSe restricted code for which there
was a match event encoded as specified in clause 11.2.5;
B) the 28^th^ most significant bit of the UTC-based counter set to \'0\'; and
C) the 4 least significant bits of the UTC-based counter set to the 4 least
significant bits of the UTC-based counter contained in the PROSE PC5 DISCOVERY
message that contained the ProSe restricted code for which there was a match
event, as specified in 3GPP TS 33.503 [34]; and
ii) the second counter composed of:
A) the 27 most significant bits of the UTC-based counter set to the 27 most
significant bits of the UTC time provided by the lower layers for the PROSE
PC5 DISCOVERY message that contained the ProSe restricted code for which there
was a match event encoded as specified in clause 11.2.5;
B) the 28^th^ most significant bit of the UTC-based counter set to \'1\'; and
C) the 4 least significant bits of the UTC-based counter set to the 4 least
significant bits of the UTC-based counter contained in the PROSE PC5 DISCOVERY
message that contained the ProSe restricted code for which there was a match
event, as specified in 3GPP TS 33.503 [34]; and
2) then the UE shall select, among the two counters described above, the
counter that is nearest to the UTC time provided by the lower layers for the
PROSE PC5 DISCOVERY message that contained the ProSe restricted code for which
there was a match event encoded as specified in clause 11.2.5 and set the UTC-
based counter in the MATCH_REPORT message to that counter; and
g) the metadata flag set to indicate whether or not the UE wishes to receive
the latest metadata information associated with the RPAUID in the
MATCH_REPORT_ACK message from the 5G DDNMF.
NOTE 2: A UE can include one or multiple transactions in one MATCH_REPORT
message for different ProSe restricted codes and receive a corresponding
\ element or \ element in the
MATCH_REPORT_ACK message for each respective transaction. In the following
description of match report procedure, only one transaction is included.
If it is required to check the MIC via the match report procedure, the 5G
DDNMF checks MIC for the received PROSE PC5 DISCOVERY message included in the
MATCH_REPORT message as specified in 3GPP TS 33.503 [34].
Figure 6.2.9.2.1 illustrates the interaction between the UE and the 5G DDNMF
in the match report procedure.
Figure 6.2.9.2.1: Match report procedure for restricted discovery model A
#### 6.2.9.3 Match report procedure accepted by the 5G DDNMF
Upon receiving a MATCH_REPORT message, the 5G DDNMF shall check whether there
is an existing context for the UE identified by its SUPI.
The 5G DDNMF shall analyze the ProSe restricted code received from the UE in
the MATCH_REPORT message. If the MIC value and its corresponding UTC-based
counter are included, the 5G DDNMF shall check whether the MIC value and the
UTC-based counter are valid and within the acceptable range respectively as
defined in 3GPP TS 33.503 [34]. The 5G DDNMF shall then check in the UE
context if the ProSe restricted code matches any restricted discovery
filter(s) allocated for the particular application identified by the ProSe
identifier received in the MATCH_REPORT message. If such a discovery filter
exists, the target RPAUID associated with the filter(s) shall be identified as
the corresponding RPAUID for this code. Optionally, the 5G DDNMF may further
invoke the procedure defined in 3GPP TS 29.503 [10] to verify if the target
RPAUID is allowed to be discovered by the RPAUID of the requesting UE that has
sent the MATCH_REPORT message, or to retrieve metadata associated for the
target RPAUID if metadata flag is set to \"True\" in the MATCH_REPORT message
and the 5G DDNMF does not have the latest metadata.
If the outcome of the above processing is successful, the 5G DDNMF shall send
a MATCH_REPORT_ACK message containing a \ element with:
a) the transaction ID set to the value of the transaction ID received in the
MATCH_REPORT message from the UE;
b) the RPAUID set to the target RPAUID retrieved from the UE context at the 5G
DDNMF which corresponds to the ProSe restricted code contained in the
MATCH_REPORT message;
c) the validity timer T5076 set to indicate for how long this ProSe restricted
code is valid;
d) the match report refresh timer T5077 to indicate for how long the UE will
wait before sending a new match report for this ProSe restricted code if the
MIC value and the UTC-based counter are included in the MATCH_REPORT message;
e) the current time set to the current UTC-based time at the 5G DDNMF; and
f) the metadata set to the associated metadata information, if there exists
metadata information associated with this target RPAUID and the metadata flag
is set to \"True\" in the MATCH_REPORT message.
If the corresponding PDUID of the target RPAUID does not belong to the HPLMN
of the requesting UE, the 5G DDNMF may optionally invoke the procedure defined
in 3GPP TS 29.555 [9] to inform the 5G DDNMF of the announcing UE about the
match event.
The 5G DDNMF uses the information (e.g. application identity) received from
the UE in the MATCH_REPORT message, UE identity in GBA or AKMA information
related to TLS tunnel transporting the MATCH_REPORT message, and other
information for charging purposes as specified in 3GPP TS 32.277 [45].
#### 6.2.9.4 Match report procedure completion by the UE
Upon receipt of the MATCH_REPORT_ACK message, if the transaction ID contained
in the \ element matches the value sent by the UE in a
MATCH_REPORT message, the UE shall store the mapping between the ProSe
restricted code and RPAUID locally, start timers T5076 and T5077 and may
inform the upper layers of this match of the RPAUID. Otherwise, the UE shall
discard the MATCH_REPORT_ACK message. The UE shall update the ProSe clock (see
3GPP TS 33.503 [34]) to the value of the received current time parameter.
Upon receipt of the MATCH_REPORT_ACK message, if the transaction ID contained
in the \ element matches the value sent by the UE in a
MATCH_REPORT message and if the received PC3a control protocol cause value is
#5 \"Invalid MIC\", as specified in clause 6.2.9.5, the UE shall stop timer
T5016 if it is running.
NOTE 1: It is an implementation specific choice whether the UE informs the
upper layers every time an RPAUID triggers a match event, or only the first
time this match occurs.
NOTE 2: The UE can also inform the upper layers if an RPAUID is no longer
matched, because the validity timer T5076 of the corresponding ProSe
restricted code expires.
NOTE 3: The UE can also inform the upper layers if a ProSe restricted code is
no longer matched, because the validity timer T5016 of the corresponding ProSe
restricted code is stopped upon receiving MATCH_REPORT_ACK message with a
\ element with PC3a control protocol cause value #5 \"Invalid
MIC\".
#### 6.2.9.5 Match report procedure not accepted by the 5G DDNMF
If the MATCH_REPORT message is not accepted by the 5G DDNMF, the 5G DDNMF
sends a MATCH_REPORT_ACK message with a \ element to the UE
including an appropriate PC3a control protocol cause value.
If there is no associated UE context for the SUPI of the UE, the 5G DDNMF
shall send the MATCH_REPORT_ACK message with a \ element with
PC3a control protocol cause value #16 \"Invalid match event\".
If the ProSe restricted code contained in the MATCH_REPORT message does not
match any Restricted discovery filter(s) allocated for the requesting UE for
the corresponding application, the 5G DDNMF shall send the MATCH_REPORT_ACK
message with a \ element with PC3a control protocol cause value
#16 \"Invalid match event\".
If the check of the MIC contained in the MATCH_REPORT message fails, the 5G
DDNMF shall send the MATCH_REPORT_ACK message with a \ element
with PC3a control protocol cause value #5 \"Invalid MIC\".
If the check of the UTC-based counter contained in the MATCH_REPORT message
fails, the 5G DDNMF shall send the MATCH_REPORT_ACK message with a \ element with PC3a control protocol cause value #6 \" Invalid UTC-based
counter\".
If the UE is not authorized for restricted 5G ProSe direct discovery
monitoring, the 5G DDNMF shall send the MATCH_REPORT_ACK message with a
\ element with PC3a control protocol cause value #3 \"UE
authorization failure\".
#### 6.2.9.6 Abnormal cases
##### 6.2.9.6.1 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Indication from the transport layer of transmission failure of MATCH_REPORT
message (e.g., after TCP retransmission timeout)
The UE shall close the existing secure connection to the 5G DDNMF, establish a
new secure connection and then restart the match report procedure.
b) No response from the 5G DDNMF after the MATCH_REPORT message has been
successfully delivered (e.g., TCP ACK has been received for the MATCH_REPORT
message)
If the TTL timer T5066 associated with the restricted discovery filter which
resulted in a match event has not expired, the UE shall retransmit the
MATCH_REPORT message.
NOTE: The timer to trigger retransmission and the maximum number of allowed
retransmissions are UE implementation specific.
### 6.2.10 Match report procedure for restricted 5G ProSe direct discovery
model B
#### 6.2.10.1 General
The purpose of the Match report procedure is to allow a UE to send a ProSe
response code that was matched during the restricted 5G ProSe direct discovery
Model B discoverer operation and receive the corresponding RPAUID, if there is
no such a mapping stored locally.
The UE shall only initiate the match report procedure if it has been
authorized for restricted 5G ProSe direct discovery model B discoverer
operation in the monitored PLMN based on the service authorization procedure.
As a result of the match report procedure completing successfully, the UE
obtains a RPAUID and potentially other information, which the UE may store
locally and pass to the upper layers.
#### 6.2.10.2 Match report procedure initiation
The UE shall meet the following pre-conditions before initiating this
procedure:
a) a request from upper layers to discover the target RPAUID with restricted
discovery model B, which resulted in the matched ProSe response code, is still
in place;
b) the lower layers have provided UTC time information, along with the
discovery message containing the ProSe response code; and
c) the validity timer T5070 associated with the discovery response filter,
whose use resulted in a match event of the ProSe response code, has not
expired.
If the UE is authorized to perform restricted 5G ProSe direct discovery model
B discoverer operation in the monitored PLMN, it should initiate a match
report procedure:
a) when there is a match event when applying one of the discovery response
filter(s) to one of the ProSe response codes received from the lower layers
and the UE does not have a corresponding RPAUID already locally stored;
b) when the UE has a locally stored mapping for the ProSe response code that
resulted in a match event, but the validity timer T5076 of the ProSe response
code has expired;
c) when the UE has a locally stored mapping for the ProSe response code that
resulted in a match event, but the match report refresh timer T5077 of the
ProSe response code has expired;
d) when the UE desires to obtain the metadata associated with the discovered
ProSe response code; or
e) when the UE has a locally stored mapping for the ProSe response code that
resulted in a match event, but the UE does not have a running match report
refresh timer T5077 for this ProSe response code and the UE is directed by the
5G DDNMF to perform the required MIC check via the match report procedure.
NOTE 1: The 5G DDNMF directs the UE to use the match report procedure to
perform the MIC check by including the MIC Check Indicator parameter in the
DISCOVERY_RESPONSE message.
The UE initiates the match report procedure by sending a MATCH_REPORT message
with a new transaction ID and shall set the message contents as follows:
a) the RPAUID set to the UE\'s RPAUID which has requested the corresponding
restricted discovery model B discoverer operation that resulted this match
event;
b) the discovery type set to \"Restricted discovery\";
c) the application identity set to the ProSe identifier of the upper layer
application that triggered the restricted direct discovery Model B discoverer
operation as described in clause 5.2.3;
d) if it is not required to check the MIC via the match report procedure, the
ProSe restricted code set to the ProSe restricted code for which there was a
match event;
e) if it is required to check the MIC via the match report procedure, the
entire PROSE PC5 DISCOVERY message that contained the ProSe restricted code
for which there was a match event;
f) if it is required to check the MIC via the match report procedure, the UTC-
based counter set as follows:
1) the UE shall generate two UTC-based counters with:
i) the first counter composed of:
A) the 27 most significant bits of the UTC-based counter set to the 27 most
significant bits of the UTC time provided by the lower layers for the PROSE
PC5 DISCOVERY message that contained the ProSe response code for which there
was a match event encoded as specified in clause 11.2.5;
B) the 28^th^ most significant bit of the UTC-based counter set to \'0\'; and
C) the 4 least significant bits of the UTC-based counter shall be set to the 4
least significant bits of the UTC-based counter contained in the PROSE PC5
DISCOVERY message that contained the ProSe response code for which there was a
match event, as specified in 3GPP TS 33.503 [34]; and
ii) the second counter composed of:
A) the 27 most significant bits of the UTC-based counter set to the 27 most
significant bits of the UTC time provided by the lower layers for the PROSE
PC5 DISCOVERY message that contained the ProSe response code for which there
was a match event encoded as specified in clause 11.2.5;
B) the 28^th^ most significant bit of the UTC-based counter set to \'1\'; and
C) the 4 least significant bits of the UTC-based counter set to the 4 least
significant bits of the UTC-based counter contained in the PROSE PC5 DISCOVERY
message that contained the ProSe response code for which there was a match
event, as specified in 3GPP TS 33.503 [34]; and
2) then the UE shall select, among the two counters described above, the
counter that is nearest to the UTC time provided by the lower layers for the
PROSE PC5 DISCOVERY message that contained the ProSe response code for which
there was a match event encoded as specified in clause 11.2.5 and set the UTC-
based counter in the MATCH_REPORT message to that counter; and
g) the metadata flag set to indicate whether or not the UE wishes to receive
the latest metadata information associated with the RPAUID in the
MATCH_REPORT_ACK message from the 5G DDNMF.
NOTE 2: A UE can include one or multiple transactions in one MATCH_REPORT
message for different ProSe response codes and receive corresponding
\ element or \ element in the
MATCH_REPORT_ACK message for each respective transaction. In the following
description of match report procedure, only one transaction is included.
If it is required to check the MIC via the match report procedure, the 5G
DDNMF checks MIC for the received PROSE PC5 DISCOVERY message included in the
MATCH_REPORT message as specified in 3GPP TS 33.503 [34].
Figure 6.2.10.2.1 illustrates the interaction between the UE and the 5G DDNMF
in the match report procedure.
Figure 6.2.10.2.1: Match report procedure for restricted discovery model B
#### 6.2.10.3 Match report procedure accepted by the 5G DDNMF
Upon receiving a MATCH_REPORT message, the 5G DDNMF shall check whether there
is an existing discoverer UE context for the UE identified by its SUPI.
The 5G DDNMF shall analyze the ProSe response code received from the UE in the
MATCH_REPORT message. If the MIC value and its corresponding UTC-based counter
are included, the 5G DDNMF shall check whether the MIC value and the UTC-based
counter are valid and within the acceptable range respectively, as defined in
3GPP TS 33.503 [34]. The 5G DDNMF shall then check in the UE context if the
ProSe response code matches any discovery response filter(s) allocated for the
particular application identified by the ProSe identifier received in the
MATCH_REPORT message. If such a discovery filter exists, the target RPAUID
associated with the filter(s) shall be identified as the corresponding RPAUID
for this code. Optionally, the 5G DDNMF may further invoke the procedure
defined in 3GPP TS 29.503 [10] to verify if the target RPAUID is allowed to be
discovered by the RPAUID of the requesting UE that has sent the MATCH_REPORT
message, or to retrieve metadata associated for the target RPAUID if metadata
flag is set to \"True\" in the MATCH_REPORT message and the 5G DDNMF does not
have the latest metadata.
If the outcome of the above processing is successful, the 5G DDNMF shall send
a MATCH_REPORT_ACK message containing a \ element with:
a) the transaction ID set to the value of the transaction ID received in the
MATCH_REPORT message from the UE;
b) the RPAUID set to the target RPAUID retrieved from the UE context at the 5G
DDNMF which corresponds to the ProSe response code contained in the
MATCH_REPORT message;
c) the validity timer T5076 set to indicate for how long the RPAUID is
matched;
d) the match report refresh timer T5077 set to indicate for how long the UE
will wait before sending a new match report for this ProSe response code if
the MIC value and the UTC-based counter are included in the MATCH_REPORT
message;
e) the current time set to the current UTC-based time at the 5G DDNMF; and
f) optionally, the metadata set to the associated metadata information, if
there exists metadata information associated with this target RPAUID.
If the corresponding PDUID of the target RPAUID does not belong to the HPLMN
of the requesting UE, the 5G DDNMF may optionally invoke the procedure defined
in 3GPP TS 29.555 [9] to inform the 5G DDNMF of the discoveree UE about the
match event.
The 5G DDNMF uses the information (e.g. application identity) received from
the UE in the MATCH_REPORT message, UE identity in GBA or AKMA information
related to TLS tunnel transporting the MATCH_REPORT message, and other
information for charging purposes as specified in 3GPP TS 32.277 [45].
#### 6.2.10.4 Match report procedure completion by the UE
Upon receipt of the MATCH_REPORT_ACK message, if the transaction ID contained
in the \ element matches the value sent by the UE in a
MATCH_REPORT message, the UE shall store the mapping between the ProSe
response code and the RPAUID locally, start timers T5076 and T5077 and may
inform the upper layers of this match of the RPAUID. Otherwise, the UE shall
discard the MATCH_REPORT_ACK message. The UE shall update the ProSe clock (see
3GPP TS 33.503 [34]) to the value of the received current time parameter.
Upon receipt of the MATCH_REPORT_ACK message, if the transaction ID contained
in the \ element matches the value sent by the UE in a
MATCH_REPORT message and if the received PC3a control protocol cause value is
#5 \"Invalid MIC\", as specified in clause 6.2.10.5, the UE shall stop timer
T5076 if it is running.
NOTE 1: It is an implementation specific choice whether the UE informs the
upper layers every time a RPAUID triggers a match event, or only the first
time this match occurs.
NOTE 2: The UE can also inform the upper layers if an RPAUID is no longer
matched, because the validity timer T5076 of the corresponding ProSe response
code expires.
NOTE 3: The UE can also inform the upper layers if a ProSe response code is no
longer matched, because the validity timer T5076 of the corresponding ProSe
response code is stopped upon receiving MATCH_REPORT_ACK message with a
\ element with PC3a control protocol cause value #5 \"Invalid
MIC\".
#### 6.2.10.5 Match report procedure not accepted by the 5G DDNMF
If the MATCH_REPORT message is not accepted by the 5G DDNMF, the 5G DDNMF
sends a MATCH_REPORT_ACK message with a \ element to the UE
including an appropriate PC3a control protocol cause value.
If there is no associated UE context for the SUPI of the UE, the 5G DDNMF
shall send the MATCH_REPORT_ACK message with a \ element with
PC3a control protocol cause value #16 \"Invalid match event\".
If the ProSe response code contained in the MATCH_REPORT message does not
match any Discovery Response Filter(s) allocated for the requesting UE for the
corresponding application, the 5G DDNMF shall send the MATCH_REPORT_ACK
message with a \ element with PC3a control protocol cause value
#16 \"Invalid match event\".
If the check of the MIC contained in the MATCH_REPORT message fails, the 5G
DDNMF shall send the MATCH_REPORT_ACK message with a \ element
with PC3a control protocol cause value #5 \"Invalid MIC\".
If the check of the UTC-based counter contained in the MATCH_REPORT message
fails, the 5G DDNMF shall send the MATCH_REPORT_ACK message with a \ element with PC3a control protocol cause value #6 \" Invalid UTC-based
counter\".
If the UE is not authorized for restricted 5G ProSe direct discovery model B
discoverer operation, the 5G DDNMF shall send the MATCH_REPORT_ACK message
with a \ element with PC3a control protocol cause value #3 \"UE
authorization failure\".
#### 6.2.10.6 Abnormal cases
##### 6.2.10.6.1 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Indication from the transport layer of transmission failure of MATCH_REPORT
message (e.g., after TCP retransmission timeout)
The UE shall close the existing secure connection to the 5G DDNMF, establish a
new secure connection and then restart the match report procedure.
b) No response from the 5G DDNMF after the MATCH_REPORT message has been
successfully delivered (e.g., TCP ACK has been received for the MATCH_REPORT
message)
If the validity timer T5070 associated with the Discovery Response Filter
which resulted in a match event has not expired, the UE shall retransmit the
MATCH_REPORT message.
NOTE: The timer to trigger retransmission and the maximum number of allowed
retransmissions are UE implementation specific.
### 6.2.11 Direct discovery update procedure for open discovery
#### 6.2.11.1 General
The direct discovery update procedure is used to update or revoke a previously
allocated ProSe application code, or discovery filter(s) as specified in 3GPP
TS 23.304 [2].
#### 6.2.11.2 Direct discovery update procedure initiation
When triggered to revoke a previously allocated ProSe application code for an
announcing UE or revoke discovery filter(s) for a monitoring UE, the 5G DDNMF
in the HPLMN sends a DISCOVERY_UPDATE_REQUEST message to the UE with:
a) a new DDNMF transaction ID not used in any other direct discovery
procedures in PC3a interface; and
b) the discovery entry ID set to the discovery entry ID of the corresponding
discovery entry that contains the ProSe application code or the discovery
filter(s) to be revoked.
When triggered to update a previously allocated ProSe application code for an
announcing UE, the 5G DDNMF in the HPLMN shall allocate a new ProSe
application code for the ProSe application ID with a new validity timer T5060,
associate the discovery entry with the new ProSe application code and restart
timer T5061.Then the 5G DDNMF sends a DISCOVERY_UPDATE_REQUEST message to the
UE with:
a) a new DDNMF transaction ID not used in any other direct discovery
procedures in PC3a interface;
b) the discovery entry ID set to the discovery entry ID of the corresponding
discovery entry that contains the ProSe application code to be updated; and
c) the Update info containing the ProSe application code set to the new ProSe
application code allocated by the 5G DDNMF and a validity timer T5060 set to
the T5060 timer value assigned by the 5G DDNMF to the new ProSe application
code.
When triggered to update discovery filter(s) for a monitoring UE, the 5G DDNMF
in the HPLMN updates the content of discovery filter(s), associate the
discovery entry with the updated discovery filter(s) and restart timer T5063
for each filter. The update of discovery filter content includes setting new
TTL timer(s) and if necessary, assigning new ProSe application code and ProSe
application mask(s). Then the 5G DDNMF shall send a DISCOVERY_UPDATE_REQUEST
message to the UE with:
a) a new DDNMF transaction ID not used in any other direct discovery
procedures in PC3a interface;
b) the discovery entry ID set to the discovery entry ID of the corresponding
discovery entry that contains the discovery filter(s) to be updated; and
c) the Update info containing the discovery filter(s) set to the new discovery
filter(s) allocated by the 5G DDNMF.
NOTE 1: The 5G DDNMF can include one or multiple transactions in one
DISCOVERY_UPDATE_REQUEST message for ProSe App Codes or discovery filter(s)
contained in different discovery entries and receive corresponding \ element or \ element in a
DISCOVERY_UPDATE_RESPONSE message for each respective transaction. In the
following description of direct discovery update request procedure, only one
transaction is included.
Figure 6.2.11.2.1 illustrates the interaction of the UE and the 5G DDNMF in
the direct discovery update procedure.
Figure 6.2.11.2.1: Direct discovery update procedure for open discovery
NOTE 2: In the figure 6.2.11.2.1, the timers are started only when the
procedure is triggered to update a previously allocated ProSe application code
for an announcing UE or update discovery filter(s) for a monitoring UE.
#### 6.2.11.3 Direct discovery update procedure accepted by the UE
Upon receiving a DISCOVERY_UPDATE_REQUEST message, the UE shall check if the
discovery entry ID contained in the DISCOVERY_UPDATE_REQUEST message is known.
If the discovery entry ID is known, the UE shall proceed with the following
direct discovery update procedure.
If the Update info is not included in the DISCOVERY_UPDATE_REQUEST message,
the UE shall stop running timers corresponding to the discovery entry and
delete the discovery entry corresponding to the discovery entry ID contained
in the DISCOVERY_UPDATE_REQUEST message. The UE informs the lower layers to
stop announcing or monitoring corresponding to the discovery entry ID
contained in the DISCOVERY_UPDATE_REQUEST message.
If the Update info is included in the DISCOVERY_UPDATE_REQUEST message, the UE
shall replace the existing ProSe application code or the discovery filter(s)
with new ProSe application code or the discovery filter(s) contained in the
Update info correspondingly. The announcing UE shall stop the timer T5060,
start the validity timer T5060 with the received value for the new ProSe
application code and perform open 5G ProSe direct discovery announcing with
the new ProSe application code as described in clause 6.2.2.4. The monitoring
UE shall stop TTL timer T5062, start TTL timer T5062 with the received value
for each new discovery filter(s) and perform open 5G ProSe direct discovery
monitoring with each new discovery filter(s) as described in clause 6.2.5.4.
Then the UE shall send a DISCOVERY_UPDATE_RESPONSE message containing a
\ element with:
a) the DDNMF transaction ID set to the value of the DDNMF transaction ID
received in the DISCOVERY_UPDATE_REQUEST message; and
b) the discovery entry ID set to the value of the discovery entry ID received
in the DISCOVERY_UPDATE_REQUEST message.
#### 6.2.11.4 Direct discovery update procedure completed by the 5G DDNMF
Upon receiving a DISCOVERY_UPDATE_RESPONSE message, if the DDNMF transaction
ID contained in the \ element does not match the value sent
by the 5G DDNMF in a DISCOVERY_UPDATE_REQUEST message, the 5G DDNMF shall
discard the DISCOVERY_UPDATE_RESPONSE message. Otherwise, the 5G DDNMF shall
perform the following procedure.
When the UE is an announcing UE and the radio resources that the UE intends to
use are operated by a PLMN other than the HPLMN, the 5G DDNMF shall execute
the procedures defined in 3GPP TS 29.555 [9] to inform the 5G DDNMF in VPLMN
or local PLMN.
When the UE is a monitoring UE and the ProSe application ID monitored by the
UE is PLMN-specific and that PLMN ID indicated by the ProSe application ID is
not the same as that of the PLMN to which the 5G DDNMF belongs, the 5G DDNMF
executes the procedures defined in 3GPP TS 29.555 [9] to inform the 5G DDNMF
in the PLMN indicated by the ProSe application ID.
For each discovery entry ID received in the DISCOVERY_UPDATE_RESPONSE message,
if the procedure is to revoke a previously allocated ProSe application code or
discovery filter(s), the 5G DDNMF shall delete the discovery entry indicated
by the discovery entry ID from the UE\'s context and release the associated
resources.
#### 6.2.11.5 Direct discovery update procedure not accepted by the UE
If the DISCOVERY_UPDATE_REQUEST message cannot be accepted by the UE, the UE
sends a DISCOVERY_UPDATE_RESPONSE message containing a \
element to the 5G DDNMF including an appropriate PC3a control protocol cause
value.
If the discovery entry ID contained in the DISCOVERY_UPDATE _REQUEST message
is unknown, the UE shall send the DISCOVERY_UPDATE_RESPONSE message containing
a \ element with PC3a control protocol cause value # 10
\"Unknown or invalid discovery entry ID\".
#### 6.2.11.6 Abnormal cases
##### 6.2.11.6.1 Abnormal cases in the 5G DDNMF
The following abnormal cases can be identified:
a) Indication from the transport layer of transmission failure of
DISCOVERY_UPDATE_REQUEST message (e.g., after TCP retransmission timeout)
The 5G DDNMF shall close the existing secure connection to the UE.
b) No response from the UE after the DISCOVERY_UPDATE_REQUEST message has been
successfully delivered (e.g., TCP ACK has been received for the
DISCOVERY_UPDATE_REQUEST message)
The 5G DDNMF shall retransmit the DISCOVERY_UPDATE_REQUEST message.
NOTE: The timer to trigger retransmission and the maximum number of allowed
retransmissions are 5G DDNMF implementation specific.
##### 6.2.11.6.2 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Indication from the lower layer of transmission failure of
DISCOVERY_UPDATE_RESPONSE message.
After receiving an indication from lower layer that the
DISCOVERY_UPDATE_RESPONSE message has not been successfully acknowledged
(e.g., TCP ACK is not received), the UE shall abort the procedure.
### 6.2.12 Direct discovery update procedure for restricted discovery
#### 6.2.12.1 General
The discovery update procedure is used to update the discovery filters and/or
allocate a new ProSe restricted code as defined in 3GPP TS 23.304 [2]. The 5G
DDNMF can at any time update/revoke a previously allocated ProSe restricted
code, or discovery filters.
#### 6.2.12.2 Revocation of restricted discovery filters
##### 6.2.12.2.1 Restricted discovery filters revocation procedure initiation
The 5G DDNMF in the HPLMN shall initiate the restricted discovery filters
revocation procedure by sending the DISCOVERY_UPDATE_REQUEST to the UE with:
a) a new DDNMF transaction ID not used in any other direct discovery
procedures in PC3a interface;
b) the discovery entry ID set to the discovery entry ID of the corresponding
discovery entry that contains the restricted discovery filter to be revoked;
and
c) optionally update info containing the restricted discovery filters that
replace the existing ones, if the 5G DDNMF decides to remove only certain
filter(s) and not others.
NOTE: The 5G DDNMF can include one or multiple transactions in one
DISCOVERY_UPDATE_REQUEST message for different Restricted discovery filters
and receive corresponding \ element or \
element in a DISCOVERY_UPDATE_RESPONSE message for each respective
transaction. In the following description of the network initiated direct
discovery update request procedure, only one transaction is included.
Figure 6.2.12.2.1 illustrates the interaction of the UE and the 5G DDNMF in
the restricted discovery filters revocation procedure.
Figure 6.2.12.2.1.1: Restricted discovery filters revocation procedure
##### 6.2.12.2.2 Restricted discovery filters revocation procedure accepted by
the UE
Upon receiving a DISCOVERY_UPDATE_REQUEST message, the UE shall check if the
discovery entry ID contained in the DISCOVERY_UPDATE_REQUEST message is valid.
If the discovery entry ID is valid, the UE shall proceed with the following
direct discovery update procedure.
The UE shall remove all the restricted discovery filters corresponding to the
discovery entry ID if the Update info is not included in the
DISCOVERY_UPDATE_REQUEST message or shall remove the old restricted discovery
filters and store the restricted discovery filter included in the Update info
in the DISCOVERY_UPDATE_REQUEST message. Then the UE shall send a
DISCOVERY_UPDATE_RESPONSE message to the 5G DDNMF with the \
element which contains:
a) the DDNMF transaction ID set to the value of the DDNMF transaction ID
received in the DISCOVERY_UPDATE_REQUEST message; and
b) discovery entry ID set to the value of the discovery entry ID received in
the DISCOVERY_UPDATE_REQUEST message.
##### 6.2.12.2.3 Restricted discovery filters revocation procedure completion
by the 5G DDNMF
Upon receipt of the DISCOVERY_UPDATE_ RESPONSE message by the 5G DDNMF, if the
DDNMF transaction ID contained in the \ element does not
match the value sent by the 5G DDNMF in a DISCOVERY_UPDATE_REQUEST message,
the 5G DDNMF shall discard the DISCOVERY_UPDATE_RESPONSE message. Upon receipt
of the DISCOVERY_UPDATE_ RESPONSE message by the 5G DDNMF, if the DDNMF
transaction ID contained in the \ element matches the value
sent by the 5G DDNMF in a DISCOVERY_UPDATE_REQUEST message, the restricted
discovery filters revocation procedure is complete.
##### 6.2.12.2.4 Restricted discovery filters revocation procedure not
accepted by the UE
If the DISCOVERY_UPDATE_REQUEST message cannot be accepted by the UE, the UE
sends a DISCOVERY_UPDATE_RESPONSE message containing a \
element to the 5G DDNMF including an appropriate PC3a control protocol cause
value.
If the discovery entry ID contained in the DISCOVERY_UPDATE_REQUEST message is
not found in the UE context, the UE shall send a DISCOVERY_UPDATE_RESPONSE
message containing a \ element with PC3 control protocol
cause value #10 \"Unknown or Invalid discovery entry ID\".
##### 6.2.12.2.5 Abnormal cases
###### 6.2.12.2.5.1 Abnormal cases in the 5G DDNMF
The following abnormal cases can be identified:
a) Indication from the transport layer of transmission failure of
DISCOVERY_UPDATE_REQUEST message (e.g., after TCP retransmission timeout)
The 5G DDNMF shall close the existing secure connection to the UE.
b) No response from the UE after the DISCOVERY_UPDATE_REQUEST message has been
successfully delivered (e.g., TCP ACK has been received for the
DISCOVERY_UPDATE_REQUEST message)
The 5G DDNMF shall retransmit the DISCOVERY_UPDATE_REQUEST message.
NOTE: The timer to trigger retransmission and the maximum number of allowed
retransmissions are 5G DDNMF implementation specific.
###### 6.2.12.2.5.2 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Indication from the lower layer of transmission failure of
DISCOVERY_UPDATE_RESPONSE message.
After receiving an indication from lower layer that the
DISCOVERY_UPDATE_RESPONSE message has not been successfully acknowledged
(e.g., TCP ACK is not received), the UE shall abort the procedure.
#### 6.2.12.3 Allocation of new ProSe restricted code
##### 6.2.12.3.1 New ProSe restricted code allocation procedure initiation
The 5G DDNMF in the HPLMN shall initiate the ProSe restricted code allocation
procedure by sending the DISCOVERY_UPDATE_REQUEST to the UE with:
a) a new DDNMF transaction ID not used in any other direct discovery
procedures in PC3a interface;
b) the discovery entry ID set to the discovery entry ID of the corresponding
discovery entry that contains the ProSe restricted code to be replaced; and
c) update info containing the ProSe restricted code set to the ProSe
restricted code to be replaced and a validity timer T5062 set to the T5062
timer value assigned by the 5G DDNMF to the ProSe restricted code.
Figure 6.2.12.3.1.1 illustrates the interaction of the UE and the 5G DDNMF in
the ProSe restricted code allocation procedure.
NOTE: The 5G DDNMF can include one or multiple transactions in one
DISCOVERY_UPDATE_REQUEST message for different ProSe restricted codes and
receive corresponding \ element or \ element
in a DISCOVERY_UPDATE_RESPONSE message for each respective transaction. In the
following description of the network initiated direct discovery update request
procedure, only one transaction is included.
Figure 6.2.12.3.1.1: New ProSe restricted code allocation procedure
##### 6.2.12.3.2 ProSe restricted code allocation procedure accepted by the UE
Upon receiving a DISCOVERY_UPDATE_REQUEST message, the UE shall check if the
discovery entry ID contained in the DISCOVERY_UPDATE_REQUEST message is valid.
If the discovery entry ID is valid, the UE shall proceed with the following
direct discovery update procedure.
The UE shall replace the ProSe restricted code corresponding to the discovery
entry ID included in the DISCOVERY_UPDATE_REQUEST message. The UE shall stop
the validity timer T5062 if running and start the validity timer T5062 with
the received value. Then the UE shall send a DISCOVERY_UPDATE_RESPONSE message
to the 5G DDNMF with the \ element which contains:
a) the DDNMF transaction ID set to the value of the DDNMF transaction ID
received in the DISCOVERY_UPDATE_REQUEST message; and
b) discovery entry ID set to the value of the discovery entry ID received in
the DISCOVERY_UPDATE_REQUEST message.
##### 6.2.12.3.3 ProSe restricted code allocation procedure completion by the
5G DDNMF
Upon receipt of the DISCOVERY_UPDATE_ RESPONSE message by the 5G DDNMF, if the
DDNMF transaction ID contained in the \ element does not
match the value sent by the 5G DDNMF in a DISCOVERY_UPDATE_REQUEST message,
the 5G DDNMF shall discard the DISCOVERY_UPDATE_RESPONSE message. Upon receipt
of the DISCOVERY_UPDATE_ RESPONSE message by the 5G DDNMF, if the DDNMF
transaction ID contained in the \ element matches the value
sent by the 5G DDNMF in a DISCOVERY_UPDATE_REQUEST message, the ProSe
restricted code allocation procedure is complete.
##### 6.2.12.3.4 ProSe restricted code allocation procedure not accepted by
the UE
If the DISCOVERY_UPDATE_REQUEST message cannot be accepted by the UE, the UE
sends a DISCOVERY_UPDATE_RESPONSE message containing a \
element to the 5G DDNMF including an appropriate PC3a control protocol cause
value.
If the discovery entry ID contained in the DISCOVERY_UPDATE_REQUEST message is
not found in the UE context, the UE shall send a DISCOVERY_UPDATE _RESPONSE
message containing a \ element with PC3a control protocol
cause value #10 \"Unknown or invalid discovery entry ID\".
##### 6.2.12.3.5 Abnormal cases
###### 6.2.12.3.5.1 Abnormal cases in the 5G DDNMF
The following abnormal cases can be identified:
a) Indication from the transport layer of transmission failure of
DISCOVERY_UPDATE_REQUEST message (e.g., after TCP retransmission timeout)
The 5G DDNMF shall close the existing secure connection to the UE.
b) No response from the UE after the DISCOVERY_UPDATE_REQUEST message has been
successfully delivered (e.g., TCP ACK has been received for the
DISCOVERY_UPDATE_REQUEST message)
The 5G DDNMF shall retransmit the DISCOVERY_UPDATE_REQUEST message.
NOTE: The timer to trigger retransmission and the maximum number of allowed
retransmissions are 5G DDNMF implementation specific.
###### 6.2.12.3.5.2 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Indication from the lower layer of transmission failure of
DISCOVERY_UPDATE_RESPONSE message.
After receiving an indication from lower layer that the
DISCOVERY_UPDATE_RESPONSE message has not been successfully acknowledged
(e.g., TCP ACK is not received), the UE shall abort the procedure.
### 6.2.13 Announcing alert procedure
#### 6.2.13.1 General
The purpose of the announcing alert procedure is for the 5G DDNMF in HPLMN to
send to the announcing UE the ProSe restricted code generated in the announce
request procedure for restricted 5G ProSe direct discovery model A as
specified in clause 6.2.3.
Before initiating the announcing alert procedure, the 5G DDNMF shall determine
whether the announcing UE and the monitoring UE are close enough to trigger
the announcing alert procedure.
The announcing UE includes the ProSe restricted code in a PROSE PC5 DISCOVERY
message and passes the PROSE PC5 DISCOVERY message to the lower layers for
transmission over the PC5 interface in the registered PLMN or local PLMN as a
result of a successful announcing alert procedure.
#### 6.2.13.2 Announcing alert procedure initiation
If the UE has initiated an announce request procedure for restricted 5G ProSe
direct discovery model A before as specified in clause 6.2.3 and the on demand
announcing enabled indicator associated with the RPAUID in the announcing UE
context is set to 1, the 5G DDNMF shall initiate an announcing alert
procedure:
a) when the 5G DDNMF receives a pair of target PDUID - target RPAUID from the
ProSe application server as described in 3GPP TS 29.503 [10], the target
RPAUID is the same as the RPAUID stored in the announcing UE context and 5G
DDNMF determines the monitoring UE is in the vicinity of the announcing UE; or
b) when the 5G DDNMF receives a pair of target PDUID - target RPAUID from
other 5G DDNMF as described in 3GPP TS 29.555 [9], the target RPAUID is the
same as the RPAUID stored in the announcing UE context and the 5G DDNMF
determines the monitoring UE is in the vicinity of the announcing UE.
NOTE: How the 5G DDNMF in the HPLMN determines whether the announcing UE and
the monitoring UE are close enough to trigger the announcing alert procedure
is left to the implementation of 5G DDNMF.
The 5G DDNMF shall initiate the announcing alert procedure by sending an
ANNOUNCING_ALERT_REQUEST message with:
a) a new DDNMF transaction ID;
b) the RPAUID set to the Target RPAUID received from ProSe application server
as specified in 3GPP TS 29.503 [10] or from other 5G DDNMF as specified in
3GPP TS 29.555 [9];
c) the ProSe restricted code set to the ProSe restricted code or the ProSe
restricted code prefix. If restricted Direct Discovery with application-
controlled extension was requested by the announcing UE , the
ANNOUNCING_ALERT_REQUEST message also contains one or more ProSe restricted
code suffix Ranges which contain the suffix(es) for the RPAUID retrieved from
the announcing UE context; and
d) the discovery entry ID set to the identifier associated with the
corresponding discovery entry in the UE\'s context.
Figure 6.2.13.2.1 illustrates the interaction of the 5G DDNMF and the UE in
the Announce Alert procedure.
Figure 6.2.13.2.1: Announcing alert procedure
#### 6.2.13.3 Announcing alert procedure accepted by the UE
Upon receipt of the ANNOUNCING_ALERT_REQUEST message, the UE shall check
whether there is an existing discovery entry identified by the discovery entry
ID included in the ANNOUNCING_ALERT_REQUEST message. If the discovery entry
exists in the UE, the UE shall send an ANNOUNING_ALERT_RESPONSE message to the
5G DDNMF with a DDNMF transaction ID set to the value of the DDNMF transaction
ID received in the ANNOUNCING_ALERT_REQUEST message.
Then, the UE may perform restricted 5G ProSe direct discovery model A
announcing as described below.
The UE requests the parameters from the lower layers for restricted 5G ProSe
direct discovery model A announcing (see 3GPP TS 38.331 [13]). The UE shall
perform restricted 5G ProSe direct discovery model A announcing only if the
lower layers indicate that ProSe direct discovery is supported by the network.
If the UE in 5GMM-IDLE mode has to request resources for ProSe direct
discovery announcing as specified in 3GPP TS 38.331 [13], the UE shall perform
a service request procedure or registration procedure as specified in 3GPP TS
24.501 [11]. The UE shall obtain the UTC time for the next discovery
transmission opportunity for ProSe direct discovery from the lower layers.
If a valid UTC time is obtained, the UE shall generate the UTC-based counter
corresponding to this UTC time as specified in clause 11.2.5. If the resulting
UTC-based counter is within Max Offset of the time shown by the clock used for
ProSe by the UE, the UE shall use the UTC-based counter and the DUIK contained
in the \ element of the DISCOVERY_RESPONSE
message to compute the MIC field for the PROSE PC5 DISCOVERY message as
described in 3GPP TS 33.503 [34].
The UE shall either use the ProSe restricted code received in the
ANNOUNCING_ALERT_REQUEST message, or select one ProSe restricted code based on
the ProSe restricted code prefix and ProSe restricted code suffix Range(s)
received in the ANNOUNCING_ALERT_REQUEST message as announced ProSe restricted
code, along with the MIC and the eight least significant bits of the UTC-based
counter, in order to construct a PROSE PC5 DISCOVERY message, according to the
format defined in clause 10.2.5.
NOTE: The UE can use different codes formed based on different ProSe
restricted code suffixes to announce, without having to send a new
DISCOVERY_REQUEST message to the 5G DDNMF, as long as the validity timer T5062
of the ProSe restricted code prefix has not expired.
The UE then passes the PROSE PC5 DISCOVERY message to the lower layers for
transmission if:
a) the UE is currently authorized to perform restricted 5G ProSe direct
discovery model A announcing in the registered PLMN or the local PLMN
operating the radio resources that the UE intends to use;
b) the validity timer T5062 for the corresponding discovery entry allocated
ProSe restricted code or ProSe restricted code prefix has not expired; and
c) a request from upper layers to announce the RPAUID associated with both the
ProSe restricted code or ProSe restricted code prefix and the authorized ProSe
identifier, is still in place.
The UE shall ensure that it keeps on passing PROSE PC5 DISCOVERY messages to
the lower layers for transmission until the validity timer T5062 of the ProSe
restricted code or ProSe restricted code prefix expires. How this is achieved
is left up to UE implementation.
During the announcing operation, if one of the above conditions is no longer
met, the UE may instruct the lower layers to stop announcing. When the UE
stops announcing, if the lower layers indicate that the UE is required to send
a discovery indication to the NG-RAN and the UE is in 5GMM-CONNECTED mode, the
UE shall trigger the corresponding procedure in lower layers as specified in
3GPP TS 38.331 [13].
#### 6.2.13.4 Announcing alert procedure completion by the 5G DDNMF
Upon receipt of the ANNOUNCING_ALERT_RESPONSE message with a DDNMF transaction
ID set to the value of the DDNMF transaction ID included in the
ANNOUNCING_ALERT_REQUEST message, the 5G DDNMF will set the associated on
demand announcing enabled indicator to 0. Then the announcing alert procedure
is successfully completed.
#### 6.2.13.5 Announcing alert procedure not accepted by the UE
If the ANNOUNCING_ALERT_REQUEST message cannot be accepted by the UE, the UE
sends an ANNOUNCING_ALERT_RESPONSE message containing a \
element to the 5G DDNMF including an appropriate PC3a control protocol cause
value.
If the discovery entry ID contained in the ANNOUNCING_ALERT_REQUEST message is
unknown, the UE shall send the ANNOUNCING_ALERT_RESPONSE message containing a
\ element with PC3a control protocol cause value #10\"Unknown
or invalid discovery entry ID\".
#### 6.2.13.6 Abnormal cases
##### 6.2.13.6.1 Abnormal cases in the 5G DDNMF
The following abnormal cases can be identified:
a) Indication from the transport layer of transmission failure of
ANNOUNCING_ALERT_REQUEST message (e.g., after TCP retransmission timeout)
The 5G DDNMF shall close the existing secure connection to the UE.
b) No response from the UE after the ANNOUNCING_ALERT_REQUEST message has been
successfully delivered (e.g., TCP ACK has been received for the
ANNOUNCING_ALERT_REQUEST message)
The 5G DDNMF shall retransmit the ANNOUNCING_ALERT_REQUEST message.
NOTE: The timer to trigger retransmission and the maximum number of allowed
retransmissions are 5G DDNMF implementation specific.
##### 6.2.13.6.2 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Indication from the lower layer of transmission failure of
ANNOUNCING_ALERT_RESPONSE message.
After receiving an indication from lower layer that the
ANNOUNCING_ALERT_RESPONSE message has not been successfully acknowledged
(e.g., TCP ACK is not received), the UE shall abort the procedure.
### 6.2.14 5G ProSe direct discovery procedure over PC5 interface
#### 6.2.14.1 General
This clause describes the procedures for 5G ProSe direct discovery procedure
over PC5 interface. The purpose of the 5G ProSe direct discovery procedure
over PC5 interface is to enable a ProSe-enabled UE to detect and identify
another ProSe-enabled UE over PC5 interface.
To perform 5G ProSe direct discovery procedure over PC5 interface, the UE is
configured with the related information as described in clause 5.2.3 and the
UE interacts with 5G DDNMF as specified in clause 6.2 when it is in coverage
to obtain the related parameters (e.g. ProSe application code, ProSe
restricted code). If a UE cannot derive any of the necessary configurations
(e.g. default destination layer-2 ID for initial discovery signalling)
according to the mapping rules for the ProSe identifier of a ProSe service
(see 3GPP TS 24.555 [17]), then the UE is not allowed to perform any operation
as specified in clause 6.2.14 for the ProSe service.
The following models for 5G ProSe direct discovery procedure over PC5
interface as specified in 3GPP TS 23.304 [2] are supported:
a) Model A uses a single discovery protocol message (Announcement); and
b) Model B uses two discovery protocol messages (Solicitation and Response).
NOTE: If the UE is authorized to perform both 5G ProSe direct discovery Model
A and 5G ProSe direct discovery Model B, it is up to UE implementation to
select which model to perform or perform both models simultaneously.
The UE may use the PC5 DRX mechanism to perform 5G ProSe direct discovery over
PC5 interface when the UE is not served by NG-RAN as specified in clause
5.2.3.
The following procedures are defined for 5G ProSe direct discovery procedure
over PC5 interface:
a) 5G ProSe direct discovery procedure over PC5 interface with Model A:
1) Announcing UE procedure for 5G ProSe direct discovery initiation;
2) Announcing UE procedure for 5G ProSe direct discovery completion;
3) Monitoring UE procedure for 5G ProSe direct discovery initiation; and
4) Monitoring UE procedure for 5G ProSe direct discovery completion; and
b) 5G ProSe direct discovery procedure over PC5 interface with Model B:
1) Discoverer UE procedure for 5G ProSe direct discovery initiation;
2) Discoverer UE procedure for 5G ProSe direct discovery completion;
3) Discoveree UE procedure for 5G ProSe direct discovery initiation; and
4) Discoveree UE procedure for 5G ProSe direct discovery completion.
#### 6.2.14.2 Procedures
##### 6.2.14.2.1 5G ProSe direct discovery procedure over PC5 interface with
model A
###### 6.2.14.2.1.1 General
In this procedure, the UE sending the PROSE PC5 DISCOVERY message is called
the \"announcing UE\" and the \"monitoring UE\" is the UE that triggers the
lower layer to start monitoring for PROSE PC5 DISCOVERY message.
###### 6.2.14.2.1.2 Announcing UE procedure for 5G ProSe direct discovery
initiation
The UE is authorised to perform the announcing UE procedure for 5G ProSe
direct discovery if:
a) the UE is not served by NG-RAN, is authorised to perform 5G ProSe direct
discovery using announcing procedure when the UE is not served by NG-RAN and
is configured with the radio parameters to be used for 5G ProSe direct
discovery when not served by NG-RAN;
b) the UE is served by NG-RAN and is authorised to perform 5G ProSe direct
discovery using announcing in the PLMN indicated by the serving cell; or
c) the UE is:
1) in 5GMM-IDLE mode, in limited service state as specified in 3GPP TS 23.122
[14] and the reason for the UE being in limited service state is one of the
following:
i) the UE is unable to find a suitable cell in the selected PLMN as specified
in 3GPP TS 38.304 [15];
ii) the UE received a REGISTRATION REJECT message or a SERVICE REJECT message
with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501
[11]; or
iii) the UE received a REGISTRATION REJECT message or a SERVICE REJECT message
with the 5GMM cause #7 \"5GS services not allowed \" as specified in 3GPP TS
24.501 [11]; and
2) authorised to perform 5G ProSe direct discovery using announcing when the
UE is not served by NG-RAN; and:
i) configured with the radio parameters to be used for 5G ProSe direct
discovery when not served by NG-RAN; or
ii) the lower layers indicate that the UE does not need to request resources
for 5G ProSe direct discovery procedure.
NOTE 1: When the lower layers indicate that the UE does not need to request
resources for 5G ProSe direct discovery procedure, the serving cell broadcasts
a common radio resources pool for ProSe discovery transmission and the UE can
use this common radio resources pool while in limited service state.
otherwise, the UE is not authorised to perform the announcing UE procedure for
5G ProSe direct discovery.
Figure 6.2.14.2.1.2.1 illustrates the interaction of the UEs in the announcing
UE procedure for 5G ProSe direct discovery.
Figure 6.2.14.2.1.2.1: Announcing UE procedure for 5G ProSe direct discovery
When the UE is triggered by an upper layer application to perform announcing
UE procedure for 5G ProSe direct discovery announcing procedure, if the UE is
authorised to perform the announcing UE procedure for 5G ProSe direct
discovery, then the UE:
a) if the UE is served by NG-RAN and the UE in 5GMM-IDLE mode needs to request
resources for sending PROSE PC5 DISCOVERY messages as specified in 3GPP TS
38.331 [13], shall perform a service request procedure as specified in 3GPP TS
24.501 [11];
b) shall obtain a valid UTC time for the discovery transmission from the lower
layers and generate the UTC-based counter corresponding to this UTC time;
c) shall generate a PROSE PC5 DISCOVERY message for 5G ProSe direct discovery
announcement if the resulting UTC-based counter is within the max offset of
the time shown by the clock used for ProSe by the UE and if the timer T5060 or
T5062 does not expire. In the PROSE PC5 DISCOVERY message for direct discovery
announcement, the UE:
1) shall set the ProSe direct discovery PC5 message type parameter as
specified in table 10.2.1.1 or table 10.2.1.2;
2) shall include either ProSe application code or ProSe restricted code;
3) shall include the MIC field computed as described in 3GPP TS 33.503 [34],
by using the UTC-based counter and the discovery key contained in the
\ element of the DISCOVERY_RESPONSE message for open 5G
ProSe direct discovery, or using the UTC-based counter and the DUIK contained
in the \ element of the DISCOVERY_RESPONSE
message for restricted 5G ProSe direct discovery model A;
4) may include the Metadata IE to provide the application layer metadata
information; and
5) shall set the UTC-based counter LSB parameter to the 4 least significant
bits of the UTC-based counter;
d) shall apply the DUIK, DUSK, or DUCK with the associated Encrypted Bitmask,
along with the UTC-based counter to the PROSE PC5 DISCOVERY message for
whichever security mechanism(s) configured to be applied, e.g., integrity
protection, message scrambling or confidentiality protection of one or more
above parameters, as specified in 3GPP TS 33.503[34], for restricted 5G ProSe
direct discovery;
e) shall set the destination layer-2 ID to the default destination layer-2 ID
as specified in clause 5.2.3 and self-assign a source layer-2 ID for sending
the direct discovery announcement; and
NOTE 2: The UE implementation ensures that the value of the self-assigned
source layer-2 ID is different from any other self-assigned source layer-2
ID(s) in use for 5G ProSe direct communication as specified in clause 7.2, is
different from any other provisioned destination layer-2 ID(s) as specified in
clause 5.2 and is different from any other self-assigned source layer-2 ID in
use for a simultaneous 5G ProSe direct discovery procedure over PC5 with a
different discovery model as specified in clause 6.2.14.2.2.2, clause
6.2.15.2.2.2 and clause 8.2.1.3.1.2.
f) shall pass the resulting PROSE PC5 DISCOVERY message along with the source
layer-2 ID and destination layer-2 ID for direct discovery announcement and an
indication that the message is for 5G ProSe direct discovery to the lower
layers for transmission over the PC5 interface.
In case of open 5G ProSe direct discovery, the UE shall either use the ProSe
application code received in the DISCOVERY_RESPONSE message from the 5G DDNMF,
or select one ProSe application code based on the ProSe application code
prefix and ProSe application code suffix range(s) received in the
DISCOVERY_RESPONSE message from the 5G DDNMF as announced ProSe application
code, along with the MIC and the four least significant bits of the UTC-based
counter.
NOTE 2: The UE can use different codes formed based on different ProSe
application code suffixes to announce, without having to send a new request to
the 5G DDNMF, as long as the validity timer T5060 of the ProSe application
code prefix has not expired.
In case of restricted 5G ProSe direct discovery model A, the UE shall either
use the ProSe restricted code received in the DISCOVERY_RESPONSE message, or
select one ProSe restricted code based on the ProSe restricted code prefix and
ProSe restricted code suffix range(s) received in the DISCOVERY_RESPONSE
message from the 5G DDNMF as announced ProSe restricted code, along with the 4
least significant bits of the UTC-based counter.
NOTE 3: The UE can use different codes formed based on different ProSe
restricted code suffixes to announce, without having to send a new
DISCOVERY_REQUEST message to the 5G DDNMF, as long as the validity timer T5062
of the ProSe restricted code prefix has not expired.
The announcing UE shall ensure that it keeps on passing the same PROSE PC5
DISCOVERY message to the lower layers for transmission until the request from
upper layers to perform announcing UE procedure for 5G ProSe direct discovery
is still in place, or the validity timer of the ProSe application code or
ProSe application code prefix in case of open 5G ProSe direct discovery or the
validity timer of the ProSe restricted code or ProSe restricted code prefix in
case of restricted 5G ProSe direct discovery expires. How this is achieved is
left up to UE implementation.
NOTE 4: The announcing UE can stop announcing UE procedure for 5G ProSe direct
discovery for power saving by implementation specific means e.g. an
implementation-specific maximum number of 5G ProSe direct links configured in
the UE, or an implementation-specific timer expires.
###### 6.2.14.2.1.3 Announcing UE procedure for 5G ProSe direct discovery
completion
When the request from upper layers to perform announcing UE procedure for 5G
ProSe direct discovery is not in place, or the validity timer of the ProSe
application code or ProSe application code prefix in case of open 5G ProSe
direct discovery or the validity timer of the ProSe restricted code or ProSe
restricted code prefix in case of restricted 5G ProSe direct discovery
expires, the UE may instruct the lower layers to stop announcing.
NOTE: The announcing UE can stop announcing UE procedure for 5G ProSe direct
discovery for power saving by implementation specific means e.g. an
implementation-specific maximum number of 5G ProSe direct links configured in
the UE, or an implementation-specific timer expires.
When the UE stops announcing, if the UE is in 5GMM-CONNECTED mode, the UE
shall trigger the corresponding procedure in lower layers as specified in 3GPP
TS 38.331 [13].
###### 6.2.14.2.1.4 Monitoring UE procedure for 5G ProSe direct discovery
initiation
The UE is authorised to perform the monitoring UE procedure for 5G ProSe
direct discovery if:
a) the UE is not served by NG-RAN, is authorised to perform 5G ProSe direct
discovery using monitoring when the UE is not served by NG-RAN and is
configured with the radio parameters to be used for 5G ProSe direct discovery
when not served by NG-RAN;
b) the UE is served by NG-RAN and is authorised to perform 5G ProSe direct
discovery monitoring in at least one PLMN; or
c) the UE is:
1) in 5GMM-IDLE mode, in limited service state as specified in 3GPP TS 23.122
[14] and the reason for the UE being in limited service state is one of the
following:
i) the UE is unable to find a suitable cell in the selected PLMN as specified
in 3GPP TS 38.304 [15];
ii) the UE received a REGISTRATION REJECT message or a SERVICE REJECT message
with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501
[11]; or
iii) the UE received a REGISTRATION REJECT message or a SERVICE REJECT message
with the 5GMM cause #7 \"5GS services not allowed\" as specified in 3GPP TS
24.501 [11]; and
2) authorised to perform 5G ProSe direct discovery using monitoring when the
UE is not served by NG-RAN; and:
i) configured with the radio parameters to be used for 5G ProSe direct
discovery when not served by NG-RAN; or
ii) the lower layers indicate that the UE does not need to request resources
for 5G ProSe direct discovery procedure.
NOTE 1: When the lower layers indicate that the UE does not need to request
resources for 5G ProSe direct discovery procedure, the serving cell broadcasts
a common radio resources pool for ProSe discovery transmission and the UE can
use this common radio resources pool while in limited service state.
otherwise, the UE is not authorised to perform the monitoring UE procedure for
5G ProSe direct discovery procedure.
Figure 6.2.14.2.1.4.1 illustrates the interaction of the UEs in the monitoring
UE procedure for 5G ProSe direct discovery procedure.
Figure 6.2.14.2.1.4.1: Monitoring UE procedure for 5G ProSe direct discovery
When the UE is triggered by an upper layer application to perform monitoring
UE procedure for 5G ProSe direct discovery for a ProSe application code or
ProSe restricted code; and:
a) if the UE is authorised to perform the monitoring UE procedure for 5G ProSe
direct discovery;
b) if the difference between UTC-based counter associated with that discovery
slot and UE\'s ProSe clock is not greater than the max offset of the
monitoring UE\'s ProSe clock; and
c) if the timer T5060 or T5062 does not expire;
then the UE shall instruct the lower layers to start monitoring for PROSE PC5
DISCOVERY message.
In the case of restricted 5G ProSe direct discovery, upon reception of a PROSE
PC5 DISCOVERY message for 5G ProSe direct discovery announcement for the
destination layer-2 ID to be monitored, the UE shall use the associated DUSK,
if received from the 5G DDNMF and the UTC-based counter obtained during the
monitoring operation to unscramble the PROSE PC5 DISCOVERY message as
described in 3GPP TS 33.503 [34]. Then, if a DUCK is received from the 5G
DDNMF, the UE shall use the DUCK and the UTC-based counter to decrypt the
configured message-specific confidentiality-protected portion, as described in
3GPP TS 33.503 [34]. Finally, if a DUIK is received from the 5G DDNMF, the UE
shall use the DUIK and UTC-based counter to verify the MIC field in the
unscrambled PROSE PC5 DISCOVERY message for 5G ProSe direct discovery
announcement.
NOTE 2: The use of an erroneous UTC-based counter for processing received
PROSE PC5 DISCOVERY messages at the ProSe-enabled UE can cause MIC check
failure after DUIK is used for integrity check and malformed contents after
DUSK is used for unscrambling or DUCK is used for deciphering. How a ProSe-
enabled UE ensures the accuracy of the UTC-based counter is left to UE
implementation.
NOTE 3: The UE can determine the received PROSE PC5 DISCOVERY message for 5G
ProSe direct discovery announcement is for 5G ProSe direct discovery based on
an indication from the lower layer.
_In case of open 5G ProSe direct discovery, for a ProSe application ID
requested by the monitoring UE, the_ 5G DDNMF _may have assigned one or more
discovery filters. If application-controlled extension is used_ , _th_ e UE
may further apply additional filtering on the part corresponding to the ProSe
application code suffix. _The UE should apply all assigned discovery filters
to its monitoring operation. Using these discovery filters may result in a
match event. The UE shall consider that the_ ProSe application code _it seeks
to monitor has been discovered if there is a match event as following:_
When, for any of the ProSe application masks in a discovery filter, the output
of a bitwise AND operation between the ProSe application code contained in the
received PROSE PC5 DISCOVERY message and the ProSe application mask, matches
the output of a bitwise AND operation between the ProSe application mask and
the ProSe application code contained in the same discovery filter.
NOTE 4: A ProSe application mask with all bits set to \"1\" is assigned by the
5G DDNMF for full matching.
_In case of restricted 5G ProSe direct discovery model A, the UE provides the
application level container, which contains the authorized Target RPAUID(s),
to the upper layer applications. For each authorized target RPAUID, the 5G
DDNMF may have assigned one or more restricted discovery filters. If
application-controlled extension is used, the UE may further apply additional
filtering on the part corresponding to the ProSe restricted code suffix. The
UE should then apply all restricted discovery filters to its monitoring
operation. Using these restricted discovery filters may result in a match
event. The UE shall consider that the target RPAUID it seeks to monitor has
been discovered if there is a match event as follows:_
When, for any of the masks in a restricted discovery filter, the output of a
bitwise AND operation between the ProSe restricted code contained in the
received PROSE PC5 DISCOVERY message and the mask, matches the output of a
bitwise AND operation between the mask and the code contained in the same
restricted discovery filter.
NOTE 5: In a restricted discovery filter, a mask with all bits set to \"1\" is
assigned by the 5G DDNMF for full matching of a ProSe restricted code.
###### 6.2.14.2.1.5 Monitoring UE procedure for 5G ProSe direct discovery
completion
During the monitoring UE procedure for 5G ProSe direct discovery, if the
request from upper layers to perform the monitoring UE procedure for 5G ProSe
direct discovery is not in place, or if the validity timer of the discovery
filter or the validity timer of the Restricted discovery filter expires, the
UE may instruct the lower layers to stop monitoring.
When the UE stops monitoring, if the UE is in 5GMM-CONNECTED mode, the UE
shall trigger the corresponding procedure in lower layers as specified in 3GPP
TS 38.331 [13].
##### 6.2.14.2.2 5G ProSe direct discovery procedure over PC5 interface with
model B
###### 6.2.14.2.2.1 General
In this procedure, the UE sending the PROSE PC5 DISCOVERY message is called
the \"Discoverer UE\" and the other UE is called the \"Discoveree UE\".
###### 6.2.14.2.2.2 Discoverer UE procedure for 5G ProSe direct discovery
initiation
The UE is authorised to perform the discoverer UE procedure for 5G ProSe
direct discovery if:
a) the UE is not served by NG-RAN, is authorised to perform 5G ProSe direct
discovery discoverer operation when the UE is not served by NG-RAN and is
configured with the radio parameters to be used for 5G ProSe direct discovery
when not served by NG-RAN;
b) the UE is served by NG-RAN and is authorised to perform 5G ProSe direct
discovery discoverer operation in the PLMN indicated by the serving cell; or
c) the UE is:
1) in 5GMM-IDLE mode, in limited service state as specified in 3GPP TS 23.122
[14] and the reason for the UE being in limited service state is one of the
following:
i) the UE is unable to find a suitable cell in the selected PLMN as specified
in 3GPP TS 38.304 [15];
ii) the UE received a REGISTRATION REJECT message or a SERVICE REJECT message
with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501
[11]; or
iii) the UE received a REGISTRATION REJECT message or a SERVICE REJECT message
with the 5GMM cause #7 \"5GS services not allowed\" as specified in 3GPP TS
24.501 [11]; and
2) authorised to perform 5G ProSe direct discovery discoverer operation when
the UE is not served by NG-RAN; and:
i) configured with the radio parameters to be used for 5G ProSe direct
discovery use when not served by NG-RAN; or
ii) the lower layers indicate that the UE does not need to request resources
for 5G ProSe direct discovery procedure.
NOTE 1: When the lower layers indicate that the UE does not need to request
resources for 5G ProSe direct discovery procedure, the serving cell broadcasts
a common radio resources pool for ProSe discovery transmission and the UE can
use this common radio resources pool while in limited service state.
otherwise, the UE is not authorised to perform the discoverer UE procedure for
5G ProSe direct discovery.
Figure 6.2.14.2.2.2.1 illustrates the interaction of the UEs in the discoverer
UE procedure for 5G ProSe direct discovery.
Figure 6.2.14.2.2.2.1: Discoverer UE procedure for 5G ProSe direct discovery
When the UE is triggered by an upper layer application to query the target
RPAUID in restricted discovery Model B, associated with both the ProSe query
code and the authorised ProSe identifier; and
a) if the UE is authorised to perform the discoverer UE procedure for 5G ProSe
direct discovery in the registered PLMN or the local PLMN operating the radio
resources that the UE intends to use; and
b) if the validity timer T5070 for the ProSe query code and corresponding
ProSe Response Filter(s) has not expired,
then the UE:
a) if the UE is served by NG-RAN and the UE in 5GMM-IDLE mode needs to request
resources for sending PROSE PC5 DISCOVERY messages as specified in 3GPP TS
38.331 [13], shall perform a service request procedure as specified in 3GPP TS
24.501 [11];
b) shall obtain a valid UTC time for the discovery transmission from the lower
layers and generate the UTC-based counter corresponding to this UTC time and
if the resulting UTC-based counter is within max offset of the time shown by
the clock used for ProSe by the UE, the UE shall for each ProSe query code in
this discovery entry, use the ProSe query code to construct a PROSE PC5
DISCOVERY message as below;
c) shall generate a PROSE PC5 DISCOVERY message for 5G ProSe direct discovery
solicitation. In the PROSE PC5 DISCOVERY message for 5G ProSe direct discovery
solicitation, the UE:
1) shall set the ProSe direct discovery PC5 message type parameter as
specified in table 10.2.1.3;
2) shall include ProSe query code;
3) shall include the MIC field computed as described in 3GPP TS 33.503 [34] by
using the UTC-based counter and the DUIK contained in the \ element of the DISCOVERY_RESPONSE message; and
4) shall set the UTC-based counter LSB parameter to the 4 least significant
bits of the UTC-based counter;
d) shall apply the DUIK, DUSK, or DUCK with the associated encrypted bitmask,
along with the UTC-based counter to the PROSE PC5 DISCOVERY message for
whichever security mechanism(s) configured to be applied, e.g., integrity
protection, message scrambling or confidentiality protection of one or more
above parameters, as specified in 3GPP TS 33.503 [34];
e) shall set the destination layer-2 ID to the default destination layer-2 ID
as specified in clause 5.2.3 and self-assign a source layer-2 ID for sending
the direct discovery announcement; and
NOTE 2: The UE implementation ensures that the value of the self-assigned
source layer-2 ID is different from any other self-assigned source layer-2
ID(s) in use for 5G ProSe direct communication as specified in clause 7.2, is
different from any other provisioned destination layer-2 ID(s) as specified in
clause 5.2 and is different from any other self-assigned source layer-2 ID in
use for a simultaneous 5G ProSe direct discovery procedure over PC5 with a
different discovery model as specified in clause 6.2.14.2.1.2, clause
6.2.15.2.1.2, clause 8.2.1.2.2.2 and clause 8.2.1.2.4.2.
f) shall pass the resulting PROSE PC5 DISCOVERY message along with the source
layer-2 ID and destination layer-2 ID for 5G ProSe direct discovery
solicitation and the PLMN ID of the intended announcing PLMN if available in
the discovery entry and an indication that the message is for 5G ProSe direct
discovery to the lower layers for transmission over the PC5 interface and
shall instruct the lower layer to start monitoring.
The UE shall ensure that it keeps on passing the same PROSE PC5 DISCOVERY
message to the lower layers for transmission until the validity timer T5070 of
the ProSe query code expires, or until the request from upper layers to query
the target RPAUID in restricted discovery Model B, associated with both the
ProSe query code and the authorised application identity, is not in place. How
this is achieved is left up to UE implementation.
NOTE 3: The discoverer UE can stop discoverer UE procedure for 5G ProSe direct
discovery for power saving by implementation specific means e.g. an
implementation-specific maximum number of 5G ProSe direct links configured in
the UE, or an implementation-specific timer expires.
The UE may apply the discovery response filter(s) received from the 5G DDNMF
to its monitoring operation. _Using the discovery response filter may result
in a match event for the target RPAUID the UE is querying for. There is match
event when, for any of the masks_ i _n a discovery response filter, the output
of a bitwise AND operation between the ProSe response code contained in the_
received _PROSE PC5 DISCOVERY message and th_ e mask, _matches the output of a
bitwise AND operation between the_ mask _and the code_ contained _in the
discovery response_ f _ilter._
Upon reception of a PROSE PC5 DISCOVERY message for direct discovery response,
for the target destination layer-2 ID of the direct discovery to be
discovered, the UE shall use the associated DUSK, if received from the 5G
DDNMF and the UTC-based counter obtained during the monitoring operation to
unscramble the PROSE PC5 DISCOVERY message as described in 3GPP TS 33.503
[34]. Then, if a DUCK is received from the 5G DDNMF, the UE shall use the DUCK
and the UTC-based counter to decrypt the configured message-specific
confidentiality-protected portion, as described in 3GPP TS 33.503 [34].
Finally, if a DUIK is received from the 5G DDNMF, the UE shall use the DUIK
and UTC-based counter to verify the MIC field in the unscrambled PROSE PC5
DISCOVERY message for direct discovery response. If a MIC Check Indicator
parameter is included instead, the UE shall use the match report procedure
described in clause 6.2.10 to trigger checking of the MIC of the PROSE PC5
DISCOVERY message containing the ProSe response code by the 5G DDNMF.
The UE may notify the upper layer application about the match event of
restricted 5G ProSe direct discovery model B with the corresponding target
RPAUID and metadata, if the RPAUID and metadata are included in the Subquery
result element in the DISCOVERY_RESPONSE message from the 5G DDNMF.
###### 6.2.14.2.2.3 Discoverer UE procedure for 5G ProSe direct discovery
completion
During the discoverer operation, if
a) the validity timer T5070 for the ProSe query code and corresponding ProSe
Response Filter(s) has expired; and
b) the request from upper layers to query the target RPAUID in restricted
discovery Model B, associated with both the ProSe query code and the
authorised ProSe identifier, is not in place,
NOTE: The discoverer UE can stop discoverer UE procedure for 5G ProSe direct
discovery for power saving by implementation specific means e.g. an
implementation-specific maximum number of 5G ProSe direct links configured in
the UE, or an implementation-specific timer expires.
then the UE may instruct the lower layers to stop the discoverer operation.
When the UE stops discoverer operation, if the UE is in 5GMM-CONNECTED mode,
the UE shall trigger the corresponding procedure in lower layers as specified
in 3GPP TS 38.331 [13].
###### 6.2.14.2.2.4 Discoveree UE procedure for 5G ProSe direct discovery
initiation
The UE is authorised to perform the discoveree UE procedure for 5G ProSe
direct discovery if:
a) the UE is not served by NG-RAN, is authorised to perform 5G ProSe direct
discovery discoveree operation when the UE is not served by NG-RAN and is
configured with the radio parameters to be used for 5G ProSe direct discovery
when not served by NG-RAN;
b) the UE is served by NG-RAN and is authorised to perform 5G ProSe direct
discovery discoverer operation in the PLMN indicated by the serving cell; or
c) the UE is:
1) in 5GMM-IDLE mode, in limited service state as specified in 3GPP TS 23.122
[14] and the reason for the UE being in limited service state is one of the
following:
i) the UE is unable to find a suitable cell in the selected PLMN as specified
in 3GPP TS 38.304 [15];
ii) the UE received a REGISTRATION REJECT message or a SERVICE REJECT message
with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501
[11]; or
iii) the UE received a REGISTRATION REJECT message or a SERVICE REJECT message
with the 5GMM cause #7 \"5GS services not allowed\" as specified in 3GPP TS
24.501 [11]; and
2) authorised to perform 5G ProSe direct discovery discoverer operation when
the UE is not served by NG-RAN; and:
i) configured with the radio parameters to be used for 5G ProSe direct
discovery use when not served by NG-RAN; or
ii) the lower layers indicate that the UE does not need to request resources
for 5G ProSe direct discovery procedure.
NOTE 1: When the lower layers indicate that the UE does not need to request
resources for 5G ProSe direct discovery procedure, the serving cell broadcasts
a common radio resources pool for ProSe discovery transmission and the UE can
use this common radio resources pool while in limited service state.
otherwise, the UE is not authorised to perform the discoveree UE procedure for
5G ProSe direct discovery.
Figure 6.2.14.2.2.4.1 illustrates the interaction of the UEs in the discoveree
UE procedure for 5G ProSe direct discovery.
Figure 6.2.14.2.2.4.1: Discoveree UE procedure for 5G ProSe direct discovery
When the UE is triggered by an upper layer application to perform discoveree
operation for the RPAUID associated with an authorized ProSe identifier; and
if:
a) the UE is authorised to perform the discoveree UE procedure for 5G ProSe
direct discovery;
b) the UE has obtained the ProSe response code and discovery query filter(s)
and the respective validity timer T5068 for the corresponding discovery entry
has not expired; and
c) the difference between UTC-based counter associated with that discovery
slot and UE\'s ProSe clock is not greater than the max offset of the
monitoring UE\'s ProSe clock,
then the UE:
a) if the UE is served by NG-RAN and the UE in 5GMM-IDLE mode needs to request
resources for sending PROSE PC5 DISCOVERY messages as specified in 3GPP TS
38.331 [13], shall perform a service request procedure or registration
procedure as specified in 3GPP TS 24.501 [11]; and
b) shall instruct the lower layers to start monitoring for PROSE PC5 DISCOVERY
messages as specified in 3GPP TS 38.331 [13].
The UE may apply the discovery query filter(s) received from the 5G DDNMF to
its monitoring operation. _Using the discovery query filter(s) may result in a
match event. There is match event when, for any of the masks_ i _n a discovery
query filter, the output of a bitwise AND operation between the ProSe query
code contained in the_ received _PROSE PC5 DISCOVERY message and th_ e mask,
_matches the output of a bitwise AND operation between the_ mask _and the
code_ contained _in the discovery query filter._
Upon reception of a PROSE PC5 DISCOVERY message for direct discovery
solicitation for the destination layer-2 ID which the UE is configured to
respond for, with applying a discovery query filter to a received PROSE PC5
DISCOVERY message for the above-mentioned bitwise AND operation, the UE shall
use the associated DUSK, if received from the 5G DDNMF and the UTC-based
counter obtained during the monitoring operation to unscramble the PROSE PC5
DISCOVERY message as described in 3GPP TS 33.503 [34]. Then, if a DUCK is
received from the 5G DDNMF, the UE shall use the DUCK and the UTC-based
counter to decrypt the configured message-specific confidentiality protected
portion, as described in 3GPP TS 33.503 [34]. Finally, if a DUIK is received
from the 5G DDNMF, the UE shall use the DUIK and UTC-based counter to verify
the MIC field in the unscrambled PROSE PC5 DISCOVERY message for direct
discovery solicitation.
NOTE 2: The UE can look for a match on the unencrypted bits first before
applying DUCK, to minimise the amount of processing performed before finding a
match.
NOTE 3: The UE needs to verify the MIC field because the match report
procedure is not used for checking the MIC of a PROSE PC5 DISCOVERY message
containing a ProSe query code by the 5G DDNMF.
NOTE 4: The UE can determine the received PROSE PC5 DISCOVERY message for
direct discovery solicitation is for 5G ProSe direct discovery based on an
indication from the lower layer.
_Once the match of the discovery query filter(s) occurs, the UE process this
match event and requests the lower layers to announce the corresponding ProSe
response code in the PC5 interface as a response, as specified in 3GPP TS
38.331 [13]. If the UE in 5GMM-IDLE mode has to request resources for 5G ProSe
direct discovery announcing as specified in 3GPP TS 38.331 [13], the UE shall
perform a service request procedure or registration procedure as specified in
3GPP TS 24.501 [11]. The UE_ shall obtain a valid UTC time for the discovery
transmission from the lower layers and generate the UTC-based counter
corresponding to this UTC time. If the resulting UTC-based counter is within
max offset of the time shown by the clock used for ProSe by the UE, the UE
shall use the ProSe response code received in the DISCOVERY_RESPONSE message
from the 5G DDNMF. The UE shall generate a PROSE PC5 DISCOVERY message for 5G
ProSe direct discovery response. In the PROSE PC5 DISCOVERY message for 5G
ProSe direct discovery response, the UE:
a) shall set the ProSe direct discovery PC5 message type parameter as
specified in table 10.2.1.4;
b) shall include ProSe response code;
c) shall include the MIC field computed as described in 3GPP TS 33.503 [34] by
using the UTC-based counter and the DUIK contained in the \ element of the DISCOVERY_RESPONSE message;
d) may include the Metadata IE to provide the application layer metadata
information; and
e) shall set the UTC-based counter LSB parameter to the 4 least significant
bits of the UTC-based counter.
After generating the PROSE PC5 DISCOVERY message for 5G ProSe direct discovery
response, the UE:
a) shall set the destination layer-2 ID to the source layer-2 ID of the
received message and self-assign a source layer-2 ID for sending the direct
discovery response message;
NOTE 5: The UE implementation ensures that the value of the self-assigned
source layer-2 ID is different from any other self-assigned source layer-2
ID(s) in use for 5G ProSe direct communication as specified in clause 7.2 and
is different from any other provisioned destination layer-2 ID(s) as specified
in clause 5.2.
b) shall apply the DUIK, DUSK, or DUCK with the associated encrypted bitmask,
along with the UTC-based counter to the PROSE PC5 DISCOVERY message for
whichever security mechanism(s) configured to be applied, e.g., integrity
protection, message scrambling or confidentiality protection of one or more
above parameters, as specified in 3GPP TS 33.503 [34]; and
c) shall pass the resulting PROSE PC5 DISCOVERY message along with the source
layer-2 ID and destination layer-2 ID for 5G ProSe direct discovery response,
the PLMN ID of the intended announcing PLMN and an indication that the message
is for 5G ProSe direct discovery to the lower layers for transmission over the
PC5 interface.
NOTE 6: If the UE is processing a PROSE DIRECT LINK ESTABLISHMENT REQUEST
message from the same source layer-2 ID of the received PROSE PC5 DISCOVERY
message for direct discovery solicitation, it depends on UE implementation to
avoid the conflict of destination layer-2 ID (e.g. send a PROSE DIRECT LINK
ESTABLISHMENT REJECT message containing PC5 signalling protocol cause value #3
\"conflict of layer-2 ID for unicast communication is detected\", or ignore
the PROSE DIRECT DISCOVERY message for direct discovery solicitation).
For each match event with the discovery query filter(s), the UE shall at least
pass PROSE PC5 DISCOVERY message once to the lower layers for transmission.
The UE shall ensure that it keeps on passing PROSE PC5 DISCOVERY messages to
the lower layers for transmission as response(s) to the match event(s) of the
corresponding discovery query filter(s) until the validity timer T5068
expires. How this is achieved is left up to UE implementation.
###### 6.2.14.2.2.5 Discoveree UE procedure for 5G ProSe direct discovery
completion
During the discoveree operation, if
a) the validity timer T5068 for the ProSe response code and corresponding
discovery query filter(s) has expired; and
b) the request from upper layers to perform discoveree operation for the
RPAUID associated with an authorized ProSe identifier is not in place, then
the UE may instruct the lower layers to stop monitoring.
When the UE stops monitoring, if the lower layers indicate that the UE is
required to send a discovery indication to the NG-RAN and the UE is in 5GMM-
CONNECTED mode, the UE shall trigger the corresponding procedure in lower
layers as specified in 3GPP TS 38.331 [13].
### 6.2.15 Group member discovery over PC5 interface
#### 6.2.15.1 General
This clause describes the procedures for group member discovery over PC5
interface for both public safety use and commercial services. The purpose of
the group member discovery procedure over PC5 interface is to enable a ProSe-
enabled UE to detect and identify another ProSe-enabled UE that belongs to the
same application layer group (e.g., sharing the same application layer group
ID) over PC5 interface.
To perform group member discovery over PC5 interface, the UE is configured
with the related information as described in clause 5.2.3. The following
models for group member discovery procedure over PC5 interface as specified in
3GPP TS 23.304 [2] are supported:
a) Model A uses a single discovery protocol message (Announcement); and
b) Model B uses two discovery protocol messages (Solicitation and Response).
NOTE: If the UE is authorized to perform both group member discovery over PC5
interface with Model A and group member discovery over PC5 interface with
Model B, it is up to UE implementation to select which model to perform or
perform both models simultaneously.
The following procedures are defined for group member discovery procedure over
PC5 interface:
a) Group member discovery over PC5 interface with Model A:
1) Announcing UE procedure for group member discovery initiation;
2) Announcing UE procedure for group member discovery completion;
3) Monitoring UE procedure for group member discovery initiation; and
4) Monitoring UE procedure for group member discovery completion; and
b) Group member discovery over PC5 interface with Model B:
1) Discoverer UE procedure for group member discovery initiation;
2) Discoverer UE procedure for group member discovery completion;
3) Discoveree UE procedure for group member discovery initiation; and
4) Discoveree UE procedure for group member discovery completion.
The group member discovery over PC5 interface with Model A can only discover
the targeted group members that are identified by the configured application
layer group ID. The group member discovery over PC5 interface with Model B can
either discover a specific group member of the application layer group
identified by the configured application layer group ID or the targeted group
members that are identified by the configured application layer group ID.
#### 6.2.15.2 Procedures
##### 6.2.15.2.1 Group member discovery over PC5 interface with model A
###### 6.2.15.2.1.1 General
In this procedure, the UE sending the PROSE PC5 DISCOVERY message is called
the \"announcing UE\" and the other UE is called the \"monitoring UE\".
###### 6.2.15.2.1.2 Announcing UE procedure for group member discovery
initiation
The UE is authorised to perform the announcing UE procedure for group member
discovery if:
a) the following is true:
1) the UE is not served by NG-RAN, is authorised to perform 5G ProSe direct
discovery using announcing procedure when the UE is not served by NG-RAN and
is configured with the radio parameters to be used for 5G ProSe direct
discovery when not served by NG-RAN;
2) the UE is served by NG-RAN and is authorised to perform 5G ProSe direct
discovery using announcing in the PLMN indicated by the serving cell; or
3) the UE is:
i) in 5GMM-IDLE mode, in limited service state as specified in 3GPP TS 23.122
[14] and the reason for the UE being in limited service state is one of the
following:
A) the UE is unable to find a suitable cell in the selected PLMN as specified
in 3GPP TS 38.304 [15];
B) the UE received a REGISTRATION REJECT message or a SERVICE REJECT message
with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501
[11]; or
C) the UE received a REGISTRATION REJECT message or a SERVICE REJECT message
with the 5GMM cause #7 \"5GS services not allowed \" as specified in 3GPP TS
24.501 [11]; and
ii) authorised to perform 5G ProSe direct discovery using announcing when the
UE is not served by NG-RAN and:
A) configured with the radio parameters to be used for 5G ProSe direct
discovery when not served by NG-RAN; or
B) the lower layers indicate that the UE does not need to request resources
for 5G ProSe direct discovery procedure; and
NOTE 1: When the lower layers indicate that the UE does not need to request
resources for 5G ProSe direct discovery procedure, the serving cell broadcasts
a common radio resources pool for 5G ProSe discovery transmission and the UE
can use this common radio resources pool while in limited service state.
b) the UE is configured with the application layer group ID identifying the
application layer group to be announced and with the User info ID for the
group member discovery parameter;
otherwise, the UE is not authorised to perform the announcing UE procedure for
group member discovery procedure.
Figure 6.2.15.2.1.2.1 illustrates the interaction of the UEs in the announcing
UE procedure for group member discovery.
Figure 6.2.15.2.1.2.1: Announcing UE procedure for group member discovery
When the UE is triggered by an upper layer application to announce
availability in a discovery group, if the UE is authorised to perform the
announcing UE procedure for group member discovery, then the UE:
a) if the UE is served by NG-RAN and the UE in 5GMM-IDLE mode needs to request
resources for sending PROSE PC5 DISCOVERY messages as specified in 3GPP TS
38.331 [13], shall perform a service request procedure as specified in 3GPP TS
24.501 [11];
b) shall obtain a valid UTC time for the discovery transmission from the lower
layers and generate the UTC-based counter corresponding to this UTC time;
c) shall generate a PROSE PC5 DISCOVERY message for group member discovery
announcement. In the PROSE PC5 DISCOVERY message for group member discovery
announcement, the UE:
1) shall set the announcer info parameter to the User info ID for the group
member discovery parameter; and
2) shall set the application layer group ID parameter to the application layer
group ID parameter identifying the discovery group to be announced;
3) shall include the MIC filed computed as described in 3GPP TS 33.503 [34],
by using the UTC-based counter and the DUIK contained in the \ element of the DISCOVERY_RESPONSE message;
4) shall set the UTC-based counter LSB parameter to the 4 least significant
bits of the UTC-based counter;
5) shall set the ProSe direct discovery PC5 message type parameter as
specified in table 10.2.1.5; and
6) may include the Metadata IE to provide the application layer discovery
message;
d) shall apply the DUIK, DUSK, or DUCK with the associated Encrypted Bitmask,
along with the UTC-based counter to the PROSE PC5 DISCOVERY message for
whichever security mechanism(s) configured to be applied, e.g., integrity
protection, message scrambling or confidentiality protection of one or more
above parameters, as specified in 3GPP TS 33.303[36];
e) shall apply one of the following to determine the destination layer-2 ID:
1) if the application layer group ID has a configured layer-2 group ID as
specified in clause 5.2.3, set the destination layer-2 ID to the layer-2 group
ID; or
2) otherwise, convert the application layer group ID into a destination
layer-2 ID as following:
i) to use the group identifier as the input to the SHA-256 hashing algorithm
as specified in ISO/IEC 10118-3:2018 [28]; and
ii) to use the 24 least significant bits of the 256 bits of the output as
destination layer-2 ID;
NOTE 2: SHA-256 hashing algorithm is implemented in the ME.
f) shall self-assign a source layer-2 ID for sending the group member
discovery announcement message; and
NOTE 3: The UE implementation ensures that the value of the self-assigned
source layer-2 ID is different from any other self-assigned source layer-2
ID(s) in use for 5G ProSe direct communication as specified in clause 7.2, is
different from any other provisioned destination layer-2 ID(s) as specified in
clause 5.2 and is different from any other self-assigned source layer-2 ID in
use for a simultaneous 5G ProSe direct discovery procedure over PC5 with a
different discovery model as specified in clause 6.2.14.2.2.2, clause
6.2.15.2.2.2 and clause 8.2.1.3.1.2.
g) shall pass the resulting PROSE PC5 DISCOVERY message for group member
discovery announcement along with the source layer-2 ID and the destination
layer-2 ID to the lower layers for transmission over the PC5 interface.
The announcing UE shall ensure that it keeps on passing the same PROSE PC5
DISCOVERY message to the lower layers for transmission until the announcing UE
is triggered by an upper layer application to stop announcing availability in
a discovery group, or until the UE stops being authorised to perform the
announcing UE procedure for group member discovery.
NOTE 4: The announcing UE can stop announcing UE procedure for group member
discovery for power saving by implementation specific means e.g. an
implementation-specific maximum number of 5G ProSe direct links configured in
the UE, or an implementation-specific timer expires.
###### 6.2.15.2.1.3 Announcing UE procedure for group member discovery
completion
When the announcing UE is triggered by an upper layer application to stop
announcing availability in a discovery group, or when the announcing UE stops
being authorised to perform the announcing UE procedure for group member
discovery, the UE shall instruct the lower layers to stop announcing.
NOTE: The announcing UE can stop announcing UE procedure for group member
discovery for power saving by implementation specific means e.g. an
implementation-specific maximum number of 5G ProSe direct links configured in
the UE, or an implementation-specific timer expires.
When the UE stops announcing, if the UE is in 5GMM-CONNECTED mode, the UE
shall trigger the corresponding procedure in lower layers as specified in 3GPP
TS 38.331 [13].
###### 6.2.15.2.1.4 Monitoring UE procedure for group member discovery
initiation
The UE is authorised to perform the monitoring UE procedure for group member
discovery if:
a) the following is true:
1) the UE is not served by NG-RAN, is authorised to perform 5G ProSe direct
discovery using monitoring when the UE is not served by NG-RAN and is
configured with the radio parameters to be used for 5G ProSe direct discovery
when not served by NG-RAN;
2) the UE is served by NG-RAN and is authorised to perform 5G ProSe direct
discovery monitoring in at least one PLMN; or
3) the UE is:
i) in 5GMM-IDLE mode, in limited service state as specified in 3GPP TS 23.122
[14] and the reason for the UE being in limited service state is one of the
following:
A) the UE is unable to find a suitable cell in the selected PLMN as specified
in 3GPP TS 38.304 [15];
B) the UE received a REGISTRATION REJECT message or a SERVICE REJECT message
with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501
[11]; or
C) the UE received a REGISTRATION REJECT message or a SERVICE REJECT message
with the 5GMM cause #7 \"5GS services not allowed\" as specified in 3GPP TS
24.501 [11]; and
ii) authorised to perform 5G ProSe direct discovery using monitoring when the
UE is not served by NG-RAN; and:
A) configured with the radio parameters to be used for 5G ProSe direct
discovery when not served by NG-RAN; or
B) the lower layers indicate that the UE does not need to request resources
for 5G ProSe direct discovery procedure; and
NOTE 1: When the lower layers indicate that the UE does not need to request
resources for 5G ProSe direct discovery procedure, the serving cell broadcasts
a common radio resources pool for 5G ProSe discovery transmission and the UE
can use this common radio resources pool while in limited service state.
b) the UE is configured with the application layer group ID parameter
identifying the discovery group to be monitored;
otherwise, the UE is not authorised to perform the monitoring UE procedure for
group member discovery.
Figure 6.2.15.2.1.4.1 illustrates the interaction of the UEs in the monitoring
UE procedure for group member discovery.
Figure 6.2.15.2.1.4.1: Monitoring UE procedure for group member discovery
When the UE is triggered by an upper layer application to monitor proximity of
other UEs in a discovery group and if the UE is authorised to perform the
monitoring UE procedure for group member discovery, then the UE shall instruct
the lower layers to start monitoring for PROSE PC5 DISCOVERY message as
following:
a) if the application layer group ID has a configured layer-2 group ID as
specified in clause 5.2.3, the UE shall monitor for PROSE PC5 DISCOVERY
message with the layer-2 group ID as specified in clause 5.2.3; or
b) otherwise, the UE shall convert the application layer group ID into a
destination layer-2 ID and shall monitor for PROSE PC5 DISCOVERY message with
the converted destination layer-2 ID. The UE shall convert the application
layer group ID into a destination layer-2 ID as following:
1) to use the group identifier as the input to the SHA-256 hashing algorithm
as specified in ISO/IEC 10118-3:2018 [28]; and
2) to use the 24 least significant bits of the 256 bits of the output as
destination layer-2 ID.
NOTE 2: SHA-256 hashing algorithm is implemented in the ME.
Upon reception of a PROSE PC5 DISCOVERY message for group member discovery
announcement, for the target application layer group ID of the discovery group
to be monitored, the UE shall use the associated DUSK, if configured or
calculated using the PSDK and the UTC-based counter obtained during the
monitoring operation to unscramble the PROSE PC5 DISCOVERY message as
described in 3GPP TS 33.303 [36]. Then, if a DUCK is configured or calculated
using the PSDK, the UE shall use the DUCK and the UTC-based counter to decrypt
the configured message-specific confidentiality-protected portion, as
described in 3GPP TS 33.303 [36]. Finally, if a DUIK is configured or
calculated using the PSDK, the UE shall use the DUIK and UTC-based counter to
verify the MIC field in the unscrambled PROSE PC5 DISCOVERY message for group
member discovery announcement.
NOTE 3: The use of an erroneous UTC-based counter for processing received
PROSE PC5 DISCOVERY messages at the ProSe-enabled UE can cause MIC check
failure after DUIK is used for integrity check and malformed contents after
DUSK is used for unscrambling or DUCK is used for deciphering. How a ProSe-
enabled UE ensures the accuracy of the UTC-based counter is left to UE
implementation.
Then if the application layer group ID parameter of the PROSE PC5 DISCOVERY
message for group member discovery announcement is the same as the configured
application layer group ID parameter as specified in clause 5, the UE shall
consider that other UE in the discovery group the UE seeks to monitor has been
discovered.
###### 6.2.15.2.1.5 Monitoring UE procedure for group member discovery
completion
When the UE is triggered by an upper layer application to stop monitoring
proximity of other UEs in a discovery group, or when the UE stops being
authorised to perform the monitoring UE procedure for group member discovery,
the UE shall instruct the lower layers to stop monitoring.
When the UE stops monitoring, if the UE is in 5GMM-CONNECTED mode, the UE
shall trigger the corresponding procedure in lower layers as specified in 3GPP
TS 38.331 [13].
##### 6.2.15.2.2 Group member discovery over PC5 interface with model B
###### 6.2.15.2.2.1 General
In this procedure, the UE sending the PROSE PC5 DISCOVERY message is called
the \"discoverer UE\" and the other UE is called the \"discoveree UE\".
###### 6.2.15.2.2.2 Discoverer UE procedure for group member discovery
initiation
The UE is authorised to perform the discoverer UE procedure for group member
discovery if:
a) the following is true:
1) the UE is not served by NG-RAN, is authorised to perform 5G ProSe direct
discovery discoverer operation when the UE is not served by NG-RAN and is
configured with the radio parameters to be used for 5G ProSe direct discovery
when not served by NG-RAN;
2) the UE is served by NG-RAN and is authorised to perform 5G ProSe direct
discovery discoverer operation in the PLMN indicated by the serving cell; or
3) the UE is:
i) in 5GMM-IDLE mode, in limited service state as specified in 3GPP TS 23.122
[14] and the reason for the UE being in limited service state is one of the
following:
A) the UE is unable to find a suitable cell in the selected PLMN as specified
in 3GPP TS 38.304 [15];
B) the UE received a REGISTRATION REJECT message or a SERVICE REJECT message
with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501
[11]; or
C) the UE received a REGISTRATION REJECT message or a SERVICE REJECT message
with the 5GMM cause #7 \"5GS services not allowed\" as specified in 3GPP TS
24.501 [11]; and
ii) authorised to perform 5G ProSe direct discovery discoverer operation when
the UE is not served by NG-RAN and:
A) configured with the radio parameters to be used for 5G ProSe direct
discovery use when not served by NG-RAN; or
B) the lower layers indicate that the UE does not need to request resources
for 5G ProSe direct discovery procedure; and
NOTE 1: When the lower layers indicate that the UE does not need to request
resources for 5G ProSe direct discovery procedure, the serving cell broadcasts
a common radio resources pool for 5G ProSe discovery transmission and the UE
can use this common radio resources pool while in limited service state.
b) the UE is configured with the application layer group ID parameter
identifying the discovery group to be solicited and with the User info ID for
the group member discovery parameter;
otherwise, the UE is not authorised to perform the discoverer UE procedure for
group member discovery.
Figure 6.2.15.2.2.2.1 illustrates the interaction of the UEs in the discoverer
UE procedure for group member discovery.
Figure 6.2.15.2.2.2.1: Discoverer UE procedure for group member discovery
When the UE is triggered by an upper layer application to solicit proximity of
other UEs in a discovery group and if the UE is authorised to perform the
discoverer UE procedure for group member discovery, then the UE:
a) if the UE is served by NG-RAN and the UE in 5GMM-IDLE mode needs to request
resources for sending PROSE PC5 DISCOVERY messages as specified in 3GPP TS
38.331 [13], shall perform a service request procedure as specified in 3GPP TS
24.501 [11];
b) shall obtain a valid UTC time for the discovery transmission from the lower
layers and generate the UTC-based counter corresponding to this UTC time;
c) shall generate a PROSE PC5 DISCOVERY message for group member discovery
solicitation. In the PROSE PC5 DISCOVERY message for group member discovery
solicitation, the UE:
1) shall set the discoverer info parameter to the user info ID for the group
member discovery parameter;
2) shall set the application layer group ID parameter to the application layer
group ID parameter identifying the discovery group to be solicited;
3) shall set the target user info parameter to the target info, if the target
information is provided by the upper layers to identify a specific group
member of the application layer group identified by the configured application
layer group ID;
NOTE 2: If the PROSE PC5 DISCOVERY message for group member discovery
solicitation does not indicate any specific target UE (i.e., target user info
is not included in the PROSE PC5 DISCOVERY message), the PROSE PC5 DISCOVERY
message for group member discovery solicitation is only used to discover the
targeted group members that are identified by the configured application layer
group ID.
4) shall include the MIC filed computed as described in 3GPP TS 33.503 [34] by
using the UTC-based counter and the DUIK contained in the \ element of the DISCOVERY_RESPONSE message;
5) shall set the UTC-based counter LSB parameter to the 4 least significant
bits of the UTC-based counter; and
6) shall set the ProSe direct discovery PC5 message type parameter as
specified in table 10.2.1.6;
d) shall apply the DUIK, DUSK, or DUCK with the associated Encrypted Bitmask,
along with the UTC-based counter to the PROSE PC5 DISCOVERY message for
whichever security mechanism(s) configured to be applied, e.g., integrity
protection, message scrambling or confidentiality protection of one or more
above parameters, as specified in 3GPP TS 33.303 [36];
e) shall apply one of the following to determine the destination layer-2 ID:
1) if the application layer group ID has a configured layer-2 group ID as
specified in clause 5.2.3, set the destination layer-2 ID to the layer-2 group
ID; or
2) otherwise, convert the application layer group ID into a destination
layer-2 ID as following:
i) to use the group identifier as the input to the SHA-256 hashing algorithm
as specified in ISO/IEC 10118-3:2018 [28]; and
ii) to use the 24 least significant bits of the 256 bits of the output as
destination layer-2 ID;
NOTE 3: SHA-256 hashing algorithm is implemented in the ME.
f) shall self-assign a source layer-2 ID for sending the group member
discovery solicitation message; and
NOTE 4: The UE implementation ensures that the value of the self-assigned
source layer-2 ID is different from any other self-assigned source layer-2
ID(s) in use for 5G ProSe direct communication as specified in clause 7.2, is
different from any other provisioned destination layer-2 ID(s) as specified in
clause 5.2, and is different from any other self-assigned source layer-2 ID in
use for a simultaneous 5G ProSe direct discovery procedure over PC5 with a
different discovery model as specified in clause 6.2.14.2.1.2, clause
6.2.15.2.1.2, clause 8.2.1.2.2.2 and clause 8.2.1.2.4.2.
g) shall pass the resulting PROSE PC5 DISCOVERY message for group member
discovery solicitation along with the source layer-2 ID and destination
layer-2 ID to the lower layers for transmission over the PC5 interface.
The UE shall ensure that it keeps on passing the same PROSE PC5 DISCOVERY
message to the lower layers for transmission with an indication that the
message until the UE is triggered by an upper layer application to stop
soliciting proximity of other UEs in a discovery group, or until the UE stops
being authorised to perform the discoverer UE procedure for group member
discovery. How this is achieved is left up to UE implementation.
NOTE 5: The discoverer UE can stop discoverer UE procedure for group member
discovery for power saving by implementation specific means e.g. an
implementation-specific maximum number of 5G ProSe direct links configured in
the UE, or an implementation-specific timer expires.
Upon reception of a PROSE PC5 DISCOVERY message for group member discovery
response, for the target application layer group ID of the discovery group to
be discovered, the UE shall use the associated DUSK, if configured or
calculated using the PSDK and the UTC-based counter obtained during the
monitoring operation to unscramble the PROSE PC5 DISCOVERY message as
described in 3GPP TS 33.303 [36]. Then, if a DUCK is configured or calculated
using the PSDK, the UE shall use the DUCK and the UTC-based counter to decrypt
the configured message-specific confidentiality-protected portion, as
described in 3GPP TS 33.303 [36]. Finally, if a DUIK is configured or
calculated using the PSDK, the UE shall use the DUIK and UTC-based counter to
verify the MIC field in the unscrambled PROSE PC5 DISCOVERY message for group
member discovery response.
Then if:
a) the application layer group ID parameter of the PROSE PC5 DISCOVERY message
for group member discovery response is the same as the application layer group
ID parameter of the PROSE PC5 DISCOVERY message for group member discovery
solicitation, and
b) the target information is not provided by the upper layers to identify a
specific group member of the application layer group, or the discoveree info
in the PROSE PC5 DISCOVERY message for group member discovery response is the
same as the target information if the target information is provided by the
upper layers,
the UE shall consider that other UE in the discovery group the UE seeks to
discover has been discovered.
###### 6.2.15.2.2.3 Discoverer UE procedure for group member discovery
completion
When the UE is triggered by an upper layer application to stop soliciting
proximity of other UEs in a discovery group, or when the UE stops being
authorised to perform the discoverer UE procedure for group member discovery,
the UE shall instruct the lower layers to stop discoverer operation.
NOTE: The discoverer UE can stop discoverer UE procedure for group member
discovery for power saving by implementation specific means e.g. an
implementation-specific maximum number of 5G ProSe direct links configured in
the UE, or an implementation-specific timer expires.
When the UE stops discoverer operation, if the UE is in 5GMM-CONNECTED mode,
the UE shall trigger the corresponding procedure in lower layers as specified
in 3GPP TS 38.331 [13].
###### 6.2.15.2.2.4 Discoveree UE procedure for group member discovery
initiation
The UE is authorised to perform the discoveree UE procedure for group member
discovery if:
a) the following is true:
1) the UE is not served by NG-RAN, is authorised to perform 5G ProSe direct
discovery discoveree operation when the UE is not served by NG-RAN and is
configured with the radio parameters to be used for 5G ProSe direct discovery
when not served by NG-RAN;
2) the UE is served by NG-RAN and is authorised to perform 5G ProSe direct
discovery discoveree operation in the PLMN(s) indicated by the serving cell;
or
3) the UE is:
i) in 5GMM-IDLE mode, in limited service state as specified in 3GPP TS 23.122
[14] and the reason for the UE being in limited service state is one of the
following:
A) the UE is unable to find a suitable cell in the selected PLMN as specified
in 3GPP TS 38.304 [15];
B) the UE received a REGISTRATION REJECT message or a SERVICE REJECT message
with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501
[11]; or
C) the UE received a REGISTRATION REJECT message or a SERVICE REJECT message
with the 5GMM cause #7 \"5GS services not allowed\" as specified in 3GPP TS
24.501 [11]; and
ii) authorised to perform 5G ProSe direct discovery discoveree operation when
the UE is not served by NG-RAN; and:
A) configured with the radio parameters to be used for 5G ProSe direct
discovery when not served by NG-RAN; or
B) the lower layers indicate that the UE does not need to request resources
for 5G ProSe direct discovery procedure; and
NOTE 1: When the lower layers indicate that the UE does not need to request
resources for 5G ProSe direct discovery procedure, the serving cell broadcasts
a common radio resources pool for 5G ProSe discovery transmission and the UE
can use this common radio resources pool while in limited service state.
b) the UE is configured with the application layer group ID parameter
identifying the discovery group to be responded to and with the User info ID
for the group member discovery parameter;
otherwise, the UE is not authorised to perform the discoveree UE procedure for
group member discovery.
Figure 6.2.15.2.2.4.1 illustrates the interaction of the UEs in the discoveree
UE procedure for group member discovery.
Figure 6.2.15.2.2.4.1: Discoveree UE procedure for group member discovery
When the UE is triggered by an upper layer application to start responding to
solicitation on proximity of a UE in a discovery group and if the UE is
authorised to perform the discoveree UE procedure for group member discovery,
then the UE:
a) if the UE is served by NG-RAN and the UE in 5GMM-IDLE mode needs to request
resources for sending PROSE PC5 DISCOVERY messages as specified in 3GPP TS
38.331 [13], shall perform a service request procedure as specified in 3GPP TS
24.501 [11]; and
b) shall instruct the lower layers to start monitoring for PROSE PC5 DISCOVERY
messages.
Upon reception of a PROSE PC5 DISCOVERY message for group member discovery
solicitation, for the application layer group ID of the discovery group which
the UE is configured to respond for, the UE shall use the associated DUSK, if
configured or calculated using the PSDK and the UTC-based counter obtained
during the monitoring operation to unscramble the PROSE PC5 DISCOVERY message
as described in 3GPP TS 33.303 [36]. Then, if a DUCK is configured or
calculated using the PSDK, the UE shall use the DUCK and the UTC-based counter
to decrypt the configured message-specific confidentiality protected portion,
as described in 3GPP TS 33.303 [36]. Finally, if a DUIK is configured or
calculated using the PSDK, the UE shall use the DUIK and UTC-based counter to
verify the MIC field in the unscrambled PROSE PC5 DISCOVERY message for group
member discovery solicitation.
Then, if:
a) the application layer group ID parameter of the received PROSE PC5
DISCOVERY message is the same as the application layer group ID parameter for
the discovery group; and
b) the target user info parameter is not included in the received PROSE PC5
DISCOVERY message or the target user info parameter in the received PROSE PC5
DISCOVERY message is the same as the user info ID for the group member
discovery provided by the upper layers or same as the configured user info ID
for the group member discovery as specified in clause 5.2.3;
_the UE:_
a) shall obtain a valid UTC time for the discovery transmission from the lower
layers and generate the UTC-based counter corresponding to this UTC time;
b) shall generate a PROSE PC5 DISCOVERY message for group member discovery
response. In the PROSE PC5 DISCOVERY message for group member discovery
response, the UE:
1) shall set the discoveree info parameter to the user info ID for the group
member discovery parameter;
2) shall set the application layer group ID parameter to the application layer
group ID parameter of the PROSE PC5 DISCOVERY message for group member
discovery solicitation;
3) shall include the MIC filed computed as described in 3GPP TS 33.503 [34] by
using the UTC-based counter and the DUIK contained in the \ element of the DISCOVERY_RESPONSE message;
4) shall set the UTC-based counter LSB parameter to the 4 least significant
bits of the UTC-based counter;
5) shall set the ProSe direct discovery PC5 message type parameter as
specified in table 10.2.1.7; and
6) may include the Metadata IE to provide the application layer discovery
message;
c) shall apply the DUIK, DUSK, or DUCK with the associated Encrypted Bitmask,
along with the UTC-based counter to the PROSE PC5 DISCOVERY message for
whichever security mechanism(s) configured to be applied, e.g., integrity
protection, message scrambling or confidentiality protection of one or more
above parameters, as specified in 3GPP TS 33.303 [36];
d) shall set the destination layer-2 ID to the source layer-2 ID from the
discoverer UE used in the transportation of the PROSE PC5 DISCOVERY message
for group member discovery solicitation and self-assign a source layer-2 ID
for sending the group member discovery response message; and
NOTE 2: The UE implementation ensures that the value of the self-assigned
source layer-2 ID is different from any other self-assigned source layer-2
ID(s) in use for 5G ProSe direct communication as specified in clause 7.2 and
is different from any other provisioned destination layer-2 ID(s) as specified
in clause 5.2.
e) shall pass the resulting PROSE PC5 DISCOVERY message for group member
discovery response along with the source layer-2 ID and the destination
layer-2 ID to the lower layers for transmission over the PC5 interface.
NOTE 3: If the UE is processing a PROSE DIRECT LINK ESTABLISHMENT REQUEST
message from the same source layer-2 ID of the received PROSE PC5 DISCOVERY
message for group member discovery solicitation, it depends on UE
implementation to avoid the conflict of destination layer-2 ID (e.g. send a
PROSE DIRECT LINK ESTABLISHMENT REJECT message containing PC5 signalling
protocol cause value #3 \"conflict of layer-2 ID for unicast communication is
detected\", or ignore the PROSE DIRECT DISCOVERY message for group member
discovery solicitation).
###### 6.2.15.2.2.5 Discoveree UE procedure for group member discovery
completion
When the UE is triggered by an upper layer application to stop responding to
solicitation on proximity of other UEs in a discovery group, or when the UE
stops being authorised to perform the discoveree UE procedure for group member
discovery, the UE shall instruct the lower layers to stop monitoring.
When the UE stops monitoring, if the UE is in 5GMM-CONNECTED mode, the UE
shall trigger the corresponding procedure in lower layers as specified in 3GPP
TS 38.331 [13].
### 6.2.16 Procedure for UE to use provisioned radio resources for 5G ProSe
direct discovery
When the UE is not served by NG-RAN for 5G ProSe direct discovery and is
authorized to use 5G ProSe direct discovery, the UE shall select the
corresponding radio parameters to be used for 5G ProSe direct discovery as
follows:
a) if the UE can determine itself located in a geographical area and the UE is
provisioned with radio parameters for the geographical area, the UE shall
select the radio parameters associated with that geographical area; or
b) in all other cases, the UE shall not initiate 5G ProSe direct discovery
over PC5.
If the UE intends to use \"non-operator managed\" radio parameters as
specified in clause 5.2.3, the UE shall initiate 5G ProSe direct discovery
with the selected radio parameters.
If the UE intends to use \"operator managed\" radio parameters as specified in
clause 5.2.3, before initiating 5G ProSe direct discovery, the UE shall check
with lower layers whether the selected radio parameters can be used in the
current location without causing interference to other cells as specified in
3GPP TS 38.331 [13]; and:
a) if the lower layers indicate that the usage would not cause any
interference, the UE shall initiate 5G ProSe direct discovery; or
NOTE: If the lower layers find that there exists a cell operating the
provisioned radio resources (i.e., carrier frequency) and the cell belongs to
the registered PLMN or a PLMN equivalent to the registered PLMN and the UE is
authorized for 5G ProSe direct discovery in this PLMN, the UE can use the
radio parameters indicated by the cell as specified in 3GPP TS 38.331 [13].
b) else if the lower layers report that one or more PLMNs operate in the
provisioned radio resources (i.e., carrier frequency) then:
1) if the following conditions are met:
i) none of the PLMNs reported by the lower layers is the registered PLMN or
equivalent to the registered PLMN;
ii) at least one of the PLMNs reported by the lower layers is in the list of
authorized PLMNs for 5G ProSe direct discovery and provides radio resources
for 5G ProSe direct discovery as specified in 3GPP TS 38.331 [13]; and
iii) the UE does not have an emergency PDU session;
then the UE shall:
i) if in 5GMM-IDLE mode, perform PLMN selection triggered by 5G ProSe direct
discovery as specified in 3GPP TS 23.122 [14]; or
ii) else if in 5GMM-CONNECTED mode, either:
A) perform a De-registration procedure as specified in 3GPP TS 24.501 [11] and
then perform PLMN selection triggered by 5G ProSe direct discovery as
specified in 3GPP TS 23.122 [14]; or
B) not initiate 5G ProSe direct discovery.
Whether the UE performs i) or ii) above is left up to UE implementation; or
2) else the UE shall not initiate 5G ProSe direct discovery.
If the registration to the selected PLMN is successful, the UE shall proceed
with the procedure to initiate 5G ProSe direct discovery as specified in
clause 6.2.14 and clause 6.2.15.
If the UE is performing 5G ProSe direct discovery using radio parameters
associated with a geographical area and moves out of that geographical area,
the UE shall stop performing 5G ProSe direct discovery and then if the UE is
not served by NG-RAN for 5G ProSe direct discovery, the UE shall select
appropriate radio parameters for the new geographical area as specified above.
### 6.2.17 5G PKMF address request procedure
#### 6.2.17.1 General
The purpose of the 5G PKMF address request procedure is to allow a UE to
obtain a 5G PKMF address from the 5G DDNMF in HPLMN over PC3a interface as
specified in 3GPP TS 33.503 [34] for the security procedure over user plane. A
UE may initiate a 5G PKMF address request procedure:
a) when the UE needs to obtain a 5G PKMF address from the 5G DDNMF in HPLMN on
demand; or
b) when the UE can not access the 5G PKMF using the 5G PKMF address
provisioned by the network as specified in clause 5.2.5.
To initiate a 5G PKMF address request procedure, the UE shall be configured
with the authorized parameters for 5G ProSe UE-to-network relay as specified
in clause 5.2.5. Both the 5G ProSe remote UE and the 5G ProSe UE-to-network
relay UE are allowed to initiate the 5G PKMF address request procedure.
NOTE: The UE is allowed to access the 5G PKMF directly without initiating a 5G
PKMF address request procedure if it is pre-configured with the 5G PKMF
address as specified in clause 5.2.5.
#### 6.2.17.2 5G PKMF address request procedure initiation by the UE
The UE shall initiate the 5G PKMF address request procedure by sending a
PROSE_5GPKMF_ADDRESS_REQUEST message with the \ element.
In the \ element, the UE:
a) shall include a new transaction ID not used in any other direct discovery
procedures in PC3a interface.
Figure 6.2.17.2.1 illustrates the interaction of the UE and the 5G DDNMF in
the 5G PKMF address request procedure.
Figure 6.2.17.2.1: 5G PKMF address request procedure
#### 6.2.17.3 5G PKMF address request procedure accepted by the 5G DDNMF
Upon receiving a PROSE_5GPKMF_ADDRESS_REQUEST message, the 5G DDNMF shall
check whether the UE is authorized to act as a 5G ProSe remote UE or act as a
5G ProSe UE-to-network relay UE. If authorized, the 5G DDNMF shall then send a
PROSE_5GPKMF_ADDRESS_RESPONSE message with the \
element. In the \ element, the 5G DDNMF shall include:
a) the transaction ID set to the value of the transaction ID received in the
PROSE_5GPKMF_ADDRESS_REQUEST message from the UE; and
b) the PKMF address set to the value of the 5G PMKF address in the HPLMN of
the UE.
#### 6.2.17.4 5G PKMF address request procedure completed by the UE
Upon receiving the PROSE_5GPKMF_ADDRESS_RESPONSE message with the \ element, if the transaction ID matches the value sent by the
UE in a PROSE_5GPKMF_ADDRESS_REQUEST message, the UE shall store the received
5G PKMF address.
#### 6.2.17.5 5G PKMF address request procedure not accepted by the 5G DDNMF
If the PROSE_5GPKMF_ADDRESS_REQUEST message cannot be accepted by the 5G
DDNMF, the 5G DDNMF sends a PROSE_5GPKMF_ADDRESS_RESPONSE message containing a
\ element to the UE including an appropriate PC3a control
protocol cause value and including the transaction ID set to the value of the
transaction ID received in the PROSE_5GPKMF_ADDRESS_REQUEST message.
Upon receipt of the PROSE_5GPKMF_ADDRESS_RESPONSE message with the \ element, if the transaction ID matches the value sent by the
UE in a PROSE_5GPKMF_ADDRESS_REQUEST message, the UE shall consider the 5G
PKMF address request procedure as rejected.
If the UE is not authorized for acting as a 5G ProSe remote UE or a 5G ProSe
UE-to-network relay UE, the 5G DDNMF shall send the
PROSE_5GPKMF_ADDRESS_RESPONSE message containing a \
element with PC3a control protocol cause value #3 \"UE authorization
failure\".
#### 6.2.17.6 Abnormal cases
##### 6.2.17.6.1 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Indication from the transport layer of transmission failure of
PROSE_5GPKMF_ADDRESS_REQUEST message (e.g., after TCP retransmission timeout).
The UE shall close the existing secure connection to the 5G DDNMF, establish a
new secure connection and then restart the 5G PKMF address request procedure.
b) No response from the 5G DDNMF after the PROSE_5GPKMF_ADDRESS_REQUEST
message has been successfully delivered (e.g., TCP ACK has been received for
the PROSE_5GPKMF_ADDRESS_REQUEST message).
The UE shall retransmit the PROSE_5GPKMF_ADDRESS_REQUEST message.
NOTE: The timer to trigger retransmission and the maximum number of allowed
retransmissions are UE implementation specific.
c) Change of PLMN.
If a PLMN change occurs before the 5G PKMF address request procedure is
completed, the procedure shall be aborted. If the UE is authorized to initiate
the 5G PKMF address request procedure in the new PLMN, the procedure shall be
restarted once the UE is registered on the new PLMN.
##### 6.2.17.6.2 Abnormal cases in the 5G DDNMF
The following abnormal cases can be identified:
a) Indication from the lower layer of transmission failure of
PROSE_5GPKMF_ADDRESS_REQUEST message.
After receiving an indication from lower layer that the
PROSE_5GPKMF_ADDRESS_REQUEST message has not been successfully acknowledged
(e.g., TCP ACK is not received), the 5G DDNMF shall abort the procedure.
# 7 5G ProSe direct communications
## 7.1 Overview
This clause describes the procedures at the UE and between UEs, for 5G ProSe
direct communication over PC5.
The UE shall support requirements for securing 5G ProSe direct communication
over PC5.
To perform the 5G ProSe direct communication over PC5, the UE shall be
configured with the corresponding configurations as specified in clause 5.2.4.
If a UE cannot derive any of the necessary configurations (e.g. NR Tx profile,
ProSe NR frequencies, PC5 QoS parameters) according to the mapping rules for
the ProSe identifier of a ProSe service (see 3GPP TS 24.555 [17]), then the UE
is not allowed to perform any operation as specified in clause 7 for the ProSe
service.
The PC5 interface is selected based on the ProSe application to path
preference mapping rules as specified in clause 5.2.4 before 5G ProSe direct
communication.
For unicast mode 5G ProSe direct communication, the following data unit types
are supported: IPv4, IPv6, Ethernet and Unstructured.
For broadcast and groupcast mode 5G ProSe communication, the following data
unit types are supported: IPv4, IPv6, Ethernet, Unstructured and Address
Resolution Protocol (see RFC 826 [32]).
5G ProSe direct communication over NR-PC5 supports broadcast mode, groupcast
mode and unicast mode. If the upper layer of the UE indicates the mode of
communication, the UE shall set the mode of communication based on the request
of the upper layer. Otherwise, the UE shall set the mode of communication
based on the mapping rules between the 5G ProSe identifiers and the default
mode of communication defined in clause 5.2.4.
NOTE: Further details about whether broadcast, unicast or groupcast can be
used over PC5 are described in 3GPP TS 23.304 [3] clause 5.3.
The UE may use the PC5 DRX mechanism to perform 5G ProSe direct communication
over PC5 interface for broadcast mode and groupcast mode when the UE is not
served by NG-RAN as specified in clause 5.2.4. For transmitting and receiving
direct communication request messages (i.e. the PROSE DIRECT LINK
ESTABLISHMENT REQUEST message), the default PC5 DRX configuration is used (see
3GPP TS 38.300 [21]).
## 7.2 Unicast mode 5G ProSe direct communication over PC5
### 7.2.1 Overview
This clause describes the PC5 signalling protocol procedures between two UEs
for one-to-one (i.e., unicast) mode of ProSe direct communication. The
following PC5 signalling protocol procedures are defined:
a) 5G ProSe direct link establishment;
b) 5G ProSe direct link modification;
c) 5G ProSe direct link release;
d) 5G ProSe direct link identifier update;
e) 5G ProSe direct link keep-alive;
f) 5G ProSe direct link security mode control;
g) 5G ProSe direct link re-keying; and
h) 5G ProSe direct link authentication.
Each 5G ProSe direct link is associated with a 5G ProSe direct link context.
For 5G ProSe UE-to-network relay, the 5G ProSe direct link context includes:
a) user info ID and layer-2 ID of 5G ProSe remote UE;
b) user info ID and layer-2 ID of 5G ProSe UE-to-network relay UE;
c) relay service code; and
d) in the case of 5G ProSe Layer-3 UE-to-network relay, the network layer
protocol and the information about PC5 QoS flow(s).
The 5G ProSe direct link context shall be created during a 5G ProSe direct
link establishment procedure, be updated accordingly after a 5G ProSe direct
link modification procedure or 5G ProSe direct link identifier update
procedure and be deleted during the 5G ProSe direct link release procedure or
during a local release of 5G ProSe direct link as specified in clause 7.2.
### 7.2.2 5G ProSe direct link establishment procedure
#### 7.2.2.1 General
Depending on the type of the 5G ProSe direct link establishment procedure
(i.e., UE oriented layer-2 link establishment or ProSe service oriented
layer-2 link establishment in 3GPP TS 23.304 [2]), the 5G ProSe direct link
establishment procedure is used to establish a 5G ProSe direct link between
two UEs or to establish multiple 5G ProSe direct links between the UE and
multiple target UEs. The UE sending the request message is called the
\"initiating UE\" and the other UE is called the \"target UE\". If the request
message does not indicate the specific target UE (i.e., target user info is
not included in the request message) and multiple target UEs are interested in
the ProSe application(s) indicated in the request message, then the initiating
UE shall handle corresponding response messages received from those target
UEs. The maximum number of 5G ProSe direct links established in a UE at a time
shall not exceed an implementation-specific maximum number of established 5G
ProSe direct links.
NOTE 1: The recommended maximum number of established 5G ProSe direct links is
8.
When the 5G ProSe direct link establishment procedure for a 5G ProSe layer-3
remote UE completes successfully and if there is a PDU session established for
relaying the traffic of the 5G ProSe remote UE, the 5G ProSe layer-3 UE-to-
network relay UE shall perform the remote UE report procedure as specified in
3GPP TS 24.501 [11].
NOTE 2: A single PC5 unicast link is established between a 5G ProSe layer-2
UE-to-network relay UE and a 5G ProSe layer-2 remote UE for supporting PDU
sessions of the 5G ProSe layer-2 remote UE, as specified in 3GPP TS 38.300
[21].
#### 7.2.2.2 5G ProSe direct link establishment procedure initiation by
initiating UE
The initiating UE shall meet the following pre-conditions before initiating
this procedure:
> a) a request from upper layers to transmit the packet for ProSe application
> over PC5 or a request from lower layers to trigger ProSe direct link
> establishment;
b) the communication mode is unicast mode (e.g., pre-configured as specified
in clause 5.2.4 or indicated by upper layers);
c) the link layer identifier for the initiating UE (i.e., layer-2 ID used for
unicast communication) is available (e.g., pre-configured or self-assigned)
and is not being used by other existing 5G ProSe direct links within the
initiating UE;
> d) the link layer identifier for the destination UE (i.e., the unicast
> layer-2 ID of the target UE or the broadcast layer-2 ID) is available to the
> initiating UE (e.g., pre-configured, obtained as specified in clause 5.2,
> known via prior ProSe direct communication or indicated by lower layers);
NOTE 1: In the case where different ProSe applications are mapped to distinct
default destination layer-2 IDs, when the initiating UE intends to establish a
single unicast link that can be used for more than one ProSe identifiers, the
UE can select any of the default destination layer-2 ID for unicast initial
signalling.
e) the initiating UE is either authorised for 5G ProSe direct communication
over PC5 in NR-PC5 in the serving PLMN, has a valid authorization for 5G ProSe
direct communication over PC5 in NR-PC5 when not served by NG-RAN, or is
authorized to use a 5G ProSe UE-to-network relay UE. The UE considers that it
is not served by NG-RAN if the following conditions are met:
1) not served by NG-RAN for ProSe direct communication over PC5;
2) in limited service state as specified in 3GPP TS 23.122 [14], if the reason
for the UE being in limited service state is one of the following;
i) the UE is unable to find a suitable cell in the selected PLMN as specified
in 3GPP TS 38.304 [15];
ii) the UE received a REGISTRATION REJECT message or a SERVICE REJECT message
with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501
[11]; or
iii) the UE received a REGISTRATION REJECT message or a SERVICE REJECT message
with the 5GMM cause #7 \"5GS services not allowed\" as specified in 3GPP TS
24.501 [11]; or
3) in limited service state as specified in 3GPP TS 23.122 [14] for reasons
other than i), ii) or iii) above and located in a geographical area for which
the UE is provisioned with \"non-operator managed\" radio parameters as
specified in clause 5.2;
f) there is no existing 5G ProSe direct link for the pair of peer application
layer IDs, or there is an existing 5G ProSe direct link for the pair of peer
application layer IDs and:
1) the network layer protocol of the existing 5G ProSe direct link is not
identical to the network layer protocol required by the upper layer in the
initiating UE for this ProSe application;
2) the security policy (either signalling security policy or user plane
security policy) corresponding to the ProSe identifier is not compatible with
the security policy of the existing 5G ProSe direct link; or
3) in case of the 5G ProSe direct link establishment procedure is for direct
communication between the 5G ProSe layer-3 remote UE and the 5G ProSe layer-3
UE-to-network relay UE, the existing 5G ProSe direct link for the peer UE is
established with a different RSC or established not for direct communication
between the 5G ProSe layer-3 remote UE and the 5G ProSe layer-3 UE-to-network
relay UE; or
4) in case of the 5G ProSe direct link establishment procedure is for direct
communication between the 5G ProSe layer-2 remote UE and the 5G ProSe layer-2
UE-to-network relay UE, the existing 5G ProSe direct link for the peer UE is
established not for direct communication between the 5G ProSe layer-2 remote
UE and the 5G ProSe layer-2 UE-to-network relay UE;
g) the number of established 5G ProSe direct links is less than the
implementation-specific maximum number of established 5G ProSe direct links
allowed in the UE at a time; and
h) timer T5088 is not associated with the link layer identifier for the
destination UE or timer T5088 associated with the link layer identifier for
the destination UE has already expired or stopped.
After receiving the service data or request from the upper layers, the
initiating UE shall derive the PC5 QoS parameters and assign the PQFI(s) for
the PC5 QoS flows(s) to be established as specified in clause 7.2.7.
If the 5G ProSe direct link establishment procedure is for direct
communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network
relay UE, then the UE shall apply the DUCK or DUSK used for UE-to-network
relay discovery along with the UTC-based counter for encrypting:
a) the relay service code; and
b) the UP-PRUK ID or CP-PRUK ID, if available,
as specified in clause 6.3.5.2 of 3GPP TS 33.503 [34], and the UE shall use
the security protected relay service code and the security protected UP-PRUK
ID or security protected CP-PRUK ID for creating a PROSE DIRECT LINK
ESTABLISHMENT REQUEST message.
NOTE 2: If the UE is neither configured with DUCK nor DUSK, the relay service
code and the UP-PRUK ID or CP-PRUK ID are not encrypted.
In order to initiate the 5G ProSe direct link establishment procedure, the
initiating UE shall create a PROSE DIRECT LINK ESTABLISHMENT REQUEST message.
The initiating UE:
a) shall include the source user info set to the initiating UE\'s application
layer ID received from upper layers;
b) shall include the ProSe identifier(s) received from upper layer if the 5G
ProSe direct link establishment procedure is not for 5G ProSe direct
communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network
relay UE;
c) shall include the target user info set to the target UE\'s application
layer ID if received from upper layers or if known based on the unicast
layer-2 ID of target UE (i.e. destination layer-2 ID) as described in clause
5.8.2.4 of 3GPP TS 23.304 [3], or to the user info ID of the 5G ProSe UE-to-
network relay UE obtained during the 5G ProSe UE-to-network relay discovery
procedure;
d) if the 5G ProSe direct link is not for direct communication between the 5G
ProSe remote UE and the 5G ProSe UE-to-network relay UE:
1) shall include the key establishment information container if the UE PC5
unicast signalling integrity protection policy is set to \"Signalling
integrity protection required\" or \"Signalling integrity protection
preferred\" and may include the key establishment information container if the
UE PC5 unicast signalling integrity protection policy is set to \"Signalling
integrity protection not needed\";
NOTE 3: The key establishment information container is provided by upper
layers.
e) shall include:
1) a Nonce_1, if the direct communication is not between the 5G ProSe remote
UE and the 5G ProSe UE-to-network relay UE, or if the direct communication is
between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE and the
security procedure over control plane is used as specified in 3GPP TS 33.503
[34]; or
2) a K~NRP~ freshness parameter 1, if the direct communication is between the
5G ProSe remote UE and the 5G ProSe UE-to-network relay UE and the security
procedure over user plane is used as specified in 3GPP TS 33.503 [34];
set to the 128-bit nonce value generated by the initiating UE for the purpose
of session key establishment over this 5G ProSe direct link if the UE PC5
unicast signalling integrity protection policy is set to \"Signalling
integrity protection required\" or \"Signalling integrity protection
preferred\";
NOTE 4: The Nonce_1 IE in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message
is used to hold the value of Nonce_1 or K~NRP~ freshness parameter 1.
f) shall include its UE security capabilities indicating the list of
algorithms that the initiating UE supports for the security establishment of
this 5G ProSe direct link;
g) shall include the MSB of K~NRP-sess~ ID chosen by the initiating UE as
specified in 3GPP TS 33.503 [34] if the UE PC5 unicast signalling integrity
protection policy is set to \"Signalling integrity protection required\" or
\"Signalling integrity protection preferred\";
NOTE 5: If the direct communication is not between the 5G ProSe remote UE and
the 5G ProSe UE-to-network relay UE, the K~NRP-sess~ ID holds the ID that
corresponds to K~NRP-sess~. If the direct communication is between the 5G
ProSe remote UE and the 5G ProSe UE-to-network relay UE, the K~NRP-sess~ ID
holds the ID that corresponds to K~NRP-sess~ (if security procedure over user
plane is used) or K~relay-sess~ (if security procedure over control plane is
used).
h) may include a K~NRP~ ID if the initiating UE has an existing K~NRP~ for the
target UE and the direct communication is not between the 5G ProSe remote UE
and the 5G ProSe UE-to-network relay UE;
i) shall include its UE PC5 unicast signalling security policy. In the case
where the different ProSe applications are mapped to the different PC5 unicast
signalling security policies, when the initiating UE intends to establish a
single unicast link that can be used for more than one ProSe application, each
of the signalling security polices of those ProSe applications shall be
compatible, e.g., \"Signalling integrity protection not needed\" and
\"Signalling integrity protection required\" are not compatible. In case the
5G ProSe direct link establishment procedure is for direct communication
between 5G ProSe remote UE and 5G ProSe UE-to-network relay UE, the Signalling
integrity protection policy shall be set to \"Signalling integrity protection
required\";
j) shall include the Relay service code IE set to the relay service code of
the target relay UE if the 5G ProSe direct link establishment procedure is for
direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-
network relay UE;
k) shall include the UTC-based counter LSB set to the four least significant
bits of the UTC-based counter if the 5G ProSe direct link establishment
procedure is for direct communication between the 5G ProSe remote UE and the
5G ProSe UE-to-network relay UE;
l) shall include the UE identity IE set to the SUCI of the initiating UE if:
1) the 5G ProSe direct link establishment procedure is for direct
communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network
relay UE; and
2) the security for 5G ProSe UE-to-network relay uses the security procedure
over control plane and the initiating UE does not have a valid CP-PRUK as
specified in 3GPP TS 33.503 [34], or, the security for 5G ProSe UE-to-network
relay uses the security procedure over user plane and the initiating UE does
not have a valid UP-PRUK as specified in 3GPP TS 33.503 [34];
m) shall include the User security key ID IE set to:
1) UP-PRUK ID of the initiating UE if:
i) the 5G ProSe direct link establishment procedure is for direct
communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network
relay UE;
ii) the initiating UE has a valid UP-PRUK; and
iii) the security for 5G ProSe UE-to-network relay uses the security procedure
over user plane as specified in 3GPP TS 33.503 [34]; or
2) CP-PRUK ID of the initiating UE that is associated with the relay service
code of the target UE if:
i) the 5G ProSe direct link establishment procedure is for direct
communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network
relay UE;
ii) the initiating UE has a valid CP-PRUK is associated with the relay service
code of the target UE; and
iii) the security for 5G ProSe UE-to-network relay uses the security procedure
over control plane as specified in 3GPP TS 33.503 [34];
n) shall include the HPLMN ID of the initiating UE, if the UP-PRUK ID of the
initiating UE is included and is not in NAI format (see 3GPP TS 33.503 [34]);
and
o) shall include the MIC IE set to the calculated MIC value as specified in
clause 6.3.5.3 of 3GPP TS 33.503 [34] if the 5G ProSe direct link
establishment procedure is for direct communication between the 5G ProSe
remote UE and the 5G ProSe UE-to-network relay UE and the UE has the DUIK.
After the PROSE DIRECT LINK ESTABLISHMENT REQUEST message is generated, the
initiating UE shall pass this message to the lower layers for transmission
along with the source layer-2 ID and destination layer-2 ID as follows:
a) if the 5G ProSe direct communication is in a consequence of 5G ProSe direct
discovery as defined in clause 6.2.14, clause 6.2.15, and clause 8.2.1:
self-assign a source layer-2 ID, and the destination layer-2 ID set to the
source layer-2 ID in the received PROSE PC5 DISCOVERY message for discovery
procedure; or
b) otherwise:
self-assign a source layer-2 ID, and the destination layer-2 ID set to the
destination layer-2 ID used for unicast initial signalling as specified in
clause 5.2.4,
NOTE 6: The UE implementation ensures that any value of the self-assigned
source layer-2 ID in a) and b) is different from any other self-assigned
source layer-2 ID(s) in use for 5G ProSe direct discovery as specified in
clause 6.2.14, clause 6.2.15 and clause 8.2.1, and is different from any other
provisioned destination layer-2 ID(s) as specified in clause 5.2.
NOTE 7: It is possible for the initiating UE to reuse the initiating UE\'s
layer-2 ID used in previous 5G ProSe direct link with the same peer UE.
and start timer T5080.
NOTE 8: A default PC5 DRX configuration is used for transmitting the PROSE
DIRECT LINK ESTABLISHMENT REQUEST message as specified in 3GPP TS 38.300 [21].
The UE shall not send a new PROSE DIRECT LINK ESTABLISHMENT REQUEST message to
the same target UE identified by the same application layer ID while timer
T5080 is running. If the target user info IE is not included in the PROSE
DIRECT LINK ESTABLISHMENT REQUEST message (i.e., ProSe application oriented 5G
ProSe direct link establishment procedure), the initiating UE shall handle
multiple PROSE DIRECT LINK ESTABLISHMENT ACCEPT messages, if any, received
from different target UEs for the establishment of multiple 5G ProSe direct
links before the expiry of timer T5080.
NOTE 9: In order to ensure successful 5G ProSe direct link establishment,
T5080 should be set to a value larger than the sum of T5089 and T5092.
Figure 7.2.2.2.1: UE oriented 5G ProSe direct link establishment procedure
Figure 7.2.2.2.2: ProSe service oriented 5G ProSe direct link establishment
procedure
#### 7.2.2.3 5G ProSe direct link establishment procedure accepted by the
target UE
Upon receipt of a PROSE DIRECT LINK ESTABLISHMENT REQUEST message, if the
target UE accepts this request, the target UE shall uniquely assign a PC5 link
identifier, create a 5G ProSe direct link context.
NOTE 1: A default PC5 DRX configuration is used for receiving the PROSE DIRECT
LINK ESTABLISHMENT REQUEST message as specified in 3GPP TS 38.300 [21].
If the PROSE DIRECT LINK ESTABLISHMENT REQUEST message is for 5G ProSe direct
communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network
relay UE, the target UE shall verify the MIC field in the received PROSE
DIRECT LINK ESTABLISHMENT REQUEST with the DUIK, if any, and decrypts the
encrypted:
a) relay service code; and
b) UP-PRUK ID or CP-PRUK ID, if received,
using the DUCK or DUSK used for 5G ProSe UE-to-network relay discovery (see
clause 6.3.5.2 of 3GPP TS 33.503 [34]), and verifies if the relay service code
matches with the one that the target UE has sent during 5G ProSe UE-to-network
relay discovery procedure.
NOTE 2: If the UE is neither configured with DUCK nor DUSK, the relay service
code and the UP-PRUK ID or CP-PRUK ID are not encrypted.
If the 5G ProSe direct link establishment procedure is not for direct
communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network
relay UE, the target UE may initiate 5G ProSe direct link authentication
procedure as specified in clause 7.2.12 and shall initiate 5G ProSe direct
link security mode control procedure as specified in clause 7.2.10.
If the 5G ProSe direct link establishment procedure is for direct
communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network
relay UE, the target UE shall proceed with either:
a) the authentication and key agreement procedure as specified in clause 5.5.4
of 3GPP TS 24.501 [11] if the security procedure over control plane as
specified in 3GPP TS 33.503 [34] is used; or
b) the key request procedure as specified in clause 8.2.10.2.4 if the security
procedure over user plane as specified in 3GPP TS 33.503 [34] is used;
and shall initiate 5G ProSe direct link security mode control procedure as
specified in clause 7.2.10.
The target UE shall set the source layer-2 ID and the destination layer-2 ID
as specified in clause 7.2.12 and clause 7.2.10, and store the corresponding
source layer-2 ID for unicast communication and the destination layer-2 ID for
unicast communication in the 5G ProSe direct link context.
If:
a) the target user info IE is included in the PROSE DIRECT LINK ESTABLISHMENT
REQUEST message and this IE includes the target UE\'s application layer ID; or
b) the target user info IE is not included in the PROSE DIRECT LINK
ESTABLISHMENT REQUEST message and the target UE is interested in the ProSe
application(s) identified by the ProSe identifier IE in the PROSE DIRECT LINK
ESTABLISHMENT REQUEST message;
then the target UE shall:
a) if the direct communication is not between the 5G ProSe remote UE and the
5G ProSe UE-to-network relay UE:
1) identify an existing K~NRP~ based on the K~NRP~ ID included in the PROSE
DIRECT LINK ESTABLISHMENT REQUEST message; or
2) if K~NRP~ ID is not included in the PROSE DIRECT LINK ESTABLISHMENT REQUEST
message, the target UE does not have an existing K~NRP~ for the K~NRP~ ID
included in PROSE DIRECT LINK ESTABLISHMENT REQUEST message or the target UE
wishes to derive a new K~NRP~, derive a new K~NRP~. This may require
performing one or more 5G ProSe direct link authentication procedures as
specified in clause 7.2.12;
b) if the direct communication is between the 5G ProSe remote UE and the 5G
ProSe UE-to-network relay UE and the security procedure over control plane as
specified in 3GPP TS 33.503 [34] is used, request a new K~NR_ProSe~ according
to the security procedure over user plane as specified in 3GPP TS 33.503 [34];
or
c) if the direct communication is between the 5G ProSe remote UE and the 5G
ProSe UE-to-network relay UE and the security procedure over user plane as
specified in 3GPP TS 33.503 [34] is used, request a new K~NRP~ according to
the security procedure over user plane.
NOTE 3: How many times the 5G ProSe direct link authentication procedure needs
to be performed to derive a new K~NRP~ depends on the authentication method
used.
After an existing K~NRP~ was identified or a new K~NRP~ was derived, or after
a new K~NRP~ or K~NR_ProSe~ is received, the target UE shall initiate a 5G
ProSe direct link security mode control procedure as specified in clause
7.2.10.
Upon successful completion of the 5G ProSe direct link security mode control
procedure, in order to determine whether the PROSE DIRECT LINK ESTABLISHMENT
REQUEST message can be accepted or not, in case of IP communication, the
target UE checks whether there is at least one common IP address configuration
option supported by both the initiating UE and the target UE.
Before sending the PROSE DIRECT LINK ESTABLISHMENT ACCEPT message to the 5G
ProSe remote UE, the target UE acting as a 5G ProSe layer-3 UE-to-network
relay UE initiates the UE requested PDU session establishment procedure as
specified in 3GPP TS 24.501 [11] if:
1) the PDU session for relaying the service associated with the RSC has not
been established yet; or
2) the PDU session for relaying the service associated with the RSC has been
established but the PDU session type is Unstructured.
If the target UE accepts the 5G ProSe direct link establishment procedure, the
target UE shall create a PROSE DIRECT LINK ESTABLISHMENT ACCEPT message. The
target UE:
a) shall include the source user info set to the target UE\'s application
layer ID received from upper layers;
b) shall include PQFI(s), the corresponding PC5 QoS parameters and optionally
the ProSe identifier(s) that the target UE accepts, if the target UE is not
acting as a 5G ProSe layer-2 UE-to-network relay UE;
c) may include the PC5 QoS rule(s) if the target UE is not acting as a 5G
ProSe layer-2 UE-to-network relay UE;
d) shall include an IP address configuration IE set to one of the following
values if IP communication is used and the target UE is not acting as a 5G
ProSe layer-2 UE-to-network relay UE:
1) \"DHCPv4 server\" if only IPv4 address allocation mechanism is supported by
the target UE, i.e., acting as a DHCPv4 server;
2) \"IPv6 router\" if only IPv6 address allocation mechanism is supported by
the target UE, i.e., acting as an IPv6 router;
3) \"DHCPv4 server & IPv6 Router\" if both IPv4 and IPv6 address allocation
mechanism are supported by the target UE; or
4) \"address allocation not supported\" if neither IPv4 nor IPv6 address
allocation mechanism is supported by the target UE and the target UE is not
acting as a 5G ProSe layer-3 UE-to-network relay UE;
NOTE 4: The UE doesn\'t include an IP address configuration IE nor a link
local IPv6 address IE if Ethernet or Unstructured data unit type is used for
communication.
e) shall include a link local IPv6 address IE formed locally based on IETF RFC
4862 [25] if IP address configuration IE is set to \"address allocation not
supported\", the received PROSE DIRECT LINK SECURITY MODE COMPLETE message
included a link local IPv6 address IE and the target UE is neither acting as a
5G ProSe layer-2 UE-to-network relay UE nor acting as a 5G ProSe layer-3 relay
UE; and
f) shall include the configuration of UE PC5 unicast user plane security
protection based on the agreed user plane security policy, as specified in
3GPP TS 33.503 [34].
After the PROSE DIRECT LINK ESTABLISHMENT ACCEPT message is generated, the
target UE shall pass this message to the lower layers for transmission along
with the initiating UE\'s layer-2 ID for unicast communication and the target
UE\'s layer-2 ID for unicast communication and shall start timer T5090 if:
a) at least one of ProSe identifiers for the 5G ProSe direct links satisfies
the privacy requirements as specified in clause 5.2.4; or
> b) T5090 is configured as specified in clause 5.2.5.
NOTE 5: Two UEs negotiate the PC5 DRX configuration in the AS layer, and the
PC5 DRX parameter values are configured per pair of source and destination
Layer-2 IDs in the AS layer, as specified in 3GPP TS 38.300 [21].
After sending the PROSE DIRECT LINK ESTABLISHMENT ACCEPT message, the target
UE shall provide the following information along with the layer-2 IDs to the
lower layer, which enables the lower layer to handle the coming PC5 signalling
or traffic data:
a) the PC5 link identifier self-assigned for this 5G ProSe direct link;
b) PQFI(s) and its corresponding PC5 QoS parameters, if available; and
c) an indication of activation of the PC5 unicast user plane security
protection for the 5G ProSe direct link, if applicable.
If the target UE accepts the 5G ProSe direct link establishment request and
the 5G ProSe direct link is established not for 5G ProSe direct communication
between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, then
the target UE may perform the PC5 QoS flow establishment over 5G ProSe direct
link as specified in clause 7.2.7. If the 5G ProSe direct link is established
for 5G ProSe direct communication between the 5G ProSe layer-3 remote UE and
the 5G ProSe layer-3 UE-to-network relay UE, then the target UE may perform
the PC5 QoS flow establishment over 5G ProSe direct link as specified in
clause 8.2.6.
#### 7.2.2.4 5G ProSe direct link establishment procedure completion by the
initiating UE
If the Target user info IE is included in the PROSE DIRECT LINK ESTABLISHMENT
REQUEST message, upon receipt of the PROSE DIRECT LINK ESTABLISHMENT ACCEPT
message, the initiating UE shall stop timer T5080. If the Target user info IE
is not included in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message the
initiating UE may keep the timer T5080 running and continue to handle multiple
response messages (i.e., the PROSE DIRECT LINK ESTABLISHMENT ACCEPT message)
from multiple target UEs.
For each of the PROSE DIRECT LINK ESTABLISHMENT ACCEPT message received, the
initiating UE shall uniquely assign a PC5 link identifier and create a 5G
ProSe direct link context for each of the 5G ProSe direct link(s). Then the
initiating UE shall store the source layer-2 ID and the destination layer-2 ID
used in the transport of this message provided by the lower layers in the 5G
ProSe direct link context(s) to complete the establishment of the 5G ProSe
direct link with the target UE(s). From this time onward the initiating UE
shall use the established link(s) for ProSe direct communication over PC5 and
additional PC5 signalling messages to the target UE(s).
After receiving the PROSE DIRECT LINK ESTABLISHMENT ACCEPT message, the
initiating UE shall provide the following information along with the layer-2
IDs to the lower layer, which enables the lower layer to handle the coming PC5
signalling or traffic data:
a) the PC5 link identifier self-assigned for this 5G ProSe direct link;
b) PQFI(s) and its corresponding PC5 QoS parameters, if available; and
c) an indication of activation of the PC5 unicast user plane security
protection for the 5G ProSe direct link, if applicable.
The initiating UE shall start timer T5090 if:
a) at least one of ProSe identifiers for the 5G ProSe direct links satisfies
the privacy requirements as specified in clause 5.2.4; or
b) T5090 is configured as specified in clause 5.2.5.
In addition, the initiating UE may perform the PC5 QoS flow establishment over
5G ProSe direct link as specified in clause 7.2.7.
Upon expiry of the timer T5080, if the PROSE DIRECT LINK ESTABLISHMENT REQUEST
message did not include the Target user info IE and the initiating UE received
at least one PROSE DIRECT LINK ESTABLISHMENT ACCEPT message, it is up to the
UE implementation to consider the 5G ProSe direct link establishment procedure
as complete or to restart the timer T5080.
#### 7.2.2.5 5G ProSe direct link establishment procedure not accepted by the
target UE
If the PROSE DIRECT LINK ESTABLISHMENT REQUEST message cannot be accepted, the
target UE shall send a PROSE DIRECT LINK ESTABLISHMENT REJECT message. The
PROSE DIRECT LINK ESTABLISHMENT REJECT message contains a PC5 signalling
protocol cause IE set to one of the following cause values:
#1 direct communication to the target UE not allowed;
#3 conflict of layer-2 ID for unicast communication is detected;
#5 lack of resources for 5G ProSe direct link;
#13 congestion situation;
#15 security procedure failure of 5G ProSe UE-to-network relay; or
#111 protocol error, unspecified.
If the target UE is not allowed to accept the PROSE DIRECT LINK ESTABLISHMENT
REQUEST message, e.g., based on operator policy or configuration parameters
for ProSe direct communication over PC5 as specified in clause 5.2, or the
target UE is acting as a layer-3 relay UE, is in non-allowed area of its
serving PLMN and the corresponding relay service code is not associated with
high priority access as defined in clause 5.3.5 of 3GPP TS 24.501 [11], the
target UE shall send a PROSE DIRECT LINK ESTABLISHMENT REJECT message
containing PC5 signalling protocol cause value #1 \"direct communication to
the target UE not allowed\".
For a received PROSE DIRECT LINK ESTABLISHMENT REQUEST message from a layer-2
ID (for unicast communication), if the target UE already has an existing link
established to a UE using this layer-2 ID or is currently processing a PROSE
DIRECT LINK ESTABLISHMENT REQUEST message from the same layer-2 ID and with
one of following parameters different from the existing link or the link for
which the link establishment is in progress:
a) the source user info;
b) type of data (e.g., IP or non-IP); or
c) security policy,
the target UE shall send a PROSE DIRECT LINK ESTABLISHMENT REJECT message
containing PC5 signalling protocol cause value #3 \"conflict of layer-2 ID for
unicast communication is detected\".
NOTE 1: If the UE is processing a PROSE DIRECT DISCOVERY message from the same
source layer-2 ID of the received PROSE DIRECT LINK ESTABLISHMENT REQUEST
message, it depends on UE implementation to avoid the conflict of destination
layer-2 ID (e.g. send a PROSE DIRECT LINK ESTABLISHMENT REJECT message
containing PC5 signalling protocol cause value #3 \"conflict of layer-2 ID for
unicast communication is detected\", or ignore the PROSE DIRECT DISCOVERY
message).
NOTE 2: The type of data (e.g., IP or non-IP) is indicated by the optional IP
address configuration IE included in the corresponding DIRECT LINK SECURITY
MODE COMPLETE message, i.e., the type of data for the requested link is IP
type if this IE is included and the type of data for the requested link is
non-IP if this IE is not included.
If the 5G ProSe direct link establishment fails due to the implementation-
specific maximum number of established 5G ProSe direct links has been reached,
or other temporary lower layer problems causing resource constraints, the
target UE shall send a PROSE DIRECT LINK ESTABLISHMENT REJECT message
containing PC5 signalling protocol cause value #5 \"lack of resources for 5G
ProSe direct link\".
If the 5G ProSe direct link establishment request is for relaying and:
a) the NAS level mobility management congestion control as specified in clause
5.3.9 of TS 24.501 [11] is activated at the target UE; or
b) the target UE is under congestion;
the target UE shall send a PROSE DIRECT LINK ESTABLISHMENT REJECT message
containing PC5 signalling protocol cause value #13 \"congestion situation\".
The target UE may provide a back-off timer value to the initiating UE in the
PROSE DIRECT LINK ESTABLISHMENT REJECT message. The target UE shall not accept
any 5G ProSe direct link establishment request for relaying if the back-off
timer for NAS level mobility management congestion control is running.
If the 5G ProSe direct link establishment request is for relaying, the NAS
level session management congestion as specified in clause 6.2.7 and in clause
6.2.8 of TS 24.501 [11] is activated at the target UE which is acting as a 5G
ProSe layer-3 UE-to-network relay UE, and the relay service code used in the
5G ProSe direct link establishment corresponds to a DNN and/or S-NSSAI for
which the NAS level session management congestion is activated, and the target
UE needs to perform the PDU session establishment procedure for the DNN and/or
S-NSSAI or the PDU session modification procedure for the DNN and/or S-NSSAI,
then the target UE shall send a PROSE DIRECT LINK ESTABLISHMENT REJECT message
containing PC5 signalling protocol cause value #13 \"congestion situation\".
The target UE may provide a back-off timer value to the initiating UE in the
PROSE DIRECT LINK ESTABLISHMENT REJECT message.
NOTE 3: How the target UE determines that it is under congestion is
implementation specific (e.g., any relaying related operational overhead,
etc).
NOTE 4: In case the target UE is under the NAS level mobility management
congestion control, it is an implementation option that the provided back-off
timer value to the initiating UE is set to the remaining time of the mobility
management back-off timer T3346 or with an additional offset value.
If the 5G ProSe direct link establishment request is for relaying, the request
required the establishment of a PDU session by the 5G ProSe layer-3 UE-to-
network relay UE which is a target UE, and the PDU session establishment was
unsuccessful due to the reception of 5GSM cause #8 \"maximum number of PDU
sessions reached\", #27 \"Missing or unknown DNN\", #28 \"Unknown PDU session
type\", #29 \"user authentication or authorization failed\", #31 \"request
rejected, unspecified\", #32 \"service option not supported\", #33 \"requested
service option not subscribed\", or #65 \"maximum number of PDU sessions
reached\" as specified in 3GPP TS 24.501 [11], then target UE shall send a
PROSE DIRECT LINK ESTABLISHMENT REJECT message containing PC5 signalling
protocol cause value #111 \"protocol error, unspecified\".
If the 5G ProSe direct link establishment procedure is for direct
communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network
relay UE and it fails due to a failure in the security procedure over control
plane or security procedure over user plane as specified in 3GPP TS 33.503
[34], the target UE shall send a PROSE DIRECT LINK ESTABLISHMENT REJECT
message containing PC5 signalling protocol cause value #15 \"security
procedure failure of 5G ProSe UE-to-network relay\". The target UE shall
provide the EAP message if received from the network according to the security
procedure over control plane as specified in 3GPP TS 33.503 [34].
NOTE 5: The cause value #15 \"security procedure failure of 5G ProSe UE-to-
network relay\" is also used when the CP-PRUK or the UP-PRUK is not found in
the network.
If the 5G ProSe direct link establishment fails due to other reasons, the
target UE shall send a PROSE DIRECT LINK ESTABLISHMENT REJECT message
containing PC5 signalling protocol cause value #111 \"protocol error,
unspecified\".
After sending the PROSE DIRECT LINK ESTABLISHMENT REJECT message, the target
UE shall provide the following information along with the initiating UE\'s
layer-2 ID for unicast communication and the target UE\'s layer-2 ID for
unicast communication to the lower layer:
a) an indication of deactivation of the PC5 unicast security protection and
deletion of security context for the 5G ProSe direct link, if applicable.
Upon receipt of the PROSE DIRECT LINK ESTABLISHMENT REJECT message, the
initiating UE shall stop timer T5080 and abort the 5G ProSe direct link
establishment procedure. If the PC5 signalling protocol cause value in the
PROSE DIRECT LINK ESTABLISHMENT REJECT message is #1 \"direct communication to
the target UE not allowed\" or #5 \"lack of resources for 5G ProSe direct
link\", then the initiating UE shall not attempt to start the 5G ProSe direct
link establishment procedure with the same target UE at least for a time
period T. If the PC5 signalling protocol cause value in the PROSE DIRECT LINK
ESTABLISHMENT REJECT message is #13 \"congestion situation\" and a back-off
timer value is provided in the PROSE DIRECT LINK ESTABLISHMENT REJECT message,
the initiating UE shall start timer T5088 associated with the layer-2 ID of
the target UE and set its value to the provided timer value. If the PC5
signalling protocol cause value in the PROSE DIRECT LINK ESTABLISHMENT REJECT
message is #15 \"security procedure failure of 5G ProSe UE-to-network relay\",
and initiating UE has included the UE identity IE set to SUCI in the PROSE
DIRECT LINK ESTABLISHMENT REQUEST message, then the initiating UE shall
initiate the UE-to-network relay reselection procedure as specified in clause
8.2.3. If the PC5 signalling protocol cause value in the PROSE DIRECT LINK
ESTABLISHMENT REJECT message is #15 \"security procedure failure of 5G ProSe
UE-to-network relay\" and the initiating UE has included the User security key
ID IE set to UP-PRUK ID or CP-PRUK ID in the PROSE DIRECT LINK ESTABLISHMENT
REQUEST message, then the initiating UE may initiate the UE-to-network relay
reselection procedure as specified in clause 8.2.3 and the UE shall further:
a) if the same 5G ProSe UE-to-network relay UE is selected, discard the
previously used CP-PRUK and associated CP-PRUK ID, or the UP-PRUK and
associated UP-PRUK ID, if any, and include the UE identity IE set to SUCI in
the PROSE DIRECT LINK ESTABLISHMENT REQUEST when initiating the subsequent 5G
ProSe direct link establishment procedure as specified in clause 7.2.2.2; or
b) if a different 5G ProSe UE-to-network relay UE is selected, include the
User security key ID IE set to the previously used UP-PRUK ID or CP-PRUK ID in
the PROSE DIRECT LINK ESTABLISHMENT REQUEST message.
NOTE 5: The length of time period T is UE implementation specific and can be
different for the case when the UE receives PC5 signalling protocol cause
value #1 \"direct communication to the target UE not allowed\" or when the UE
receives PC5 signalling protocol cause value #5 \"lack of resources for 5G
ProSe direct link\".
After receiving the PROSE DIRECT LINK ESTABLISHMENT REJECT message, the
initiating UE shall provide the following information along with the
initiating UE\'s layer-2 ID for unicast communication and the target UE\'s
layer-2 ID for unicast communication to the lower layer:
a) an indication of deactivation of the PC5 unicast security protection and
deletion of security context for the 5G ProSe direct link, if applicable.
#### 7.2.2.6 Abnormal cases
##### 7.2.2.6.1 Abnormal cases at the initiating UE
If timer T5080 expires and the Target user info IE is included in the PROSE
DIRECT LINK ESTABLISHMENT REQUEST message, the initiating UE shall retransmit
the PROSE DIRECT LINK ESTABLISHMENT REQUEST message and restart timer T5080.
After reaching the maximum number of allowed retransmissions, the initiating
UE shall abort the 5G ProSe direct link establishment procedure and may notify
the upper layer that the target UE is unreachable.
Upon expiry of the timer T5080, if the PROSE DIRECT LINK ESTABLISHMENT REQUEST
message did not include the Target user info IE and the initiating UE did not
receive any PROSE DIRECT LINK ESTABLISHMENT ACCEPT message, the initiating UE
may retransmit the PROSE DIRECT LINK ESTABLISHMENT REQUEST message and restart
timer T5080. If the PROSE DIRECT LINK ESTABLISHMENT REQUEST message did not
include the Target user info IE and the initiating UE did not receive any
PROSE DIRECT LINK ESTABLISHMENT ACCEPT message, then after reaching the
maximum number of allowed retransmissions, the initiating UE shall abort the
5G ProSe direct link establishment procedure and may notify the upper layer
that no target UE is available.
NOTE: The maximum number of allowed retransmissions is UE implementation
specific.
If the need to establish a link no longer exists before the procedure is
completed, the initiating UE shall abort the procedure.
When the initiating UE aborts the 5G ProSe direct link establishment
procedure, the initiating UE shall provide the following information along
with the initiating UE\'s layer-2 ID for unicast communication and the target
UE\'s layer-2 ID for unicast communication to the lower layer:
a) an indication of deactivation of the PC5 unicast security protection and
deletion of security context for the 5G ProSe direct link, if applicable.
##### 7.2.2.6.2 Abnormal cases at the target UE
For a received PROSE DIRECT LINK ESTABLISHMENT REQUEST message from a source
layer-2 ID (for unicast communication), if the target UE already has an
existing link established to the UE known to use the same source layer-2 ID,
the same source user info, the same type of data (IP or non-IP) and the same
security policy, the UE shall process the new request. However, the target UE
shall only delete the existing 5G ProSe direct link context after the new link
establishment procedure succeeds.
NOTE: The type of data (e.g., IP or non-IP) is indicated by the optional IP
address configuration IE included in the corresponding PROSE DIRECT LINK
SECURITY MODE COMPLETE message, i.e., the type of data for the requested link
is IP type if this IE is included and the type of data for the requested link
is non-IP if this IE is not included.
If the PROSE DIRECT LINK ESTABLISHMENT REQUEST message is for 5G ProSe direct
communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network
relay UE, after the target UE decrypts the encrypted relay service code using
the DUSK or DUCK used for 5G ProSe UE-to-network relay discovery, if the relay
service code does not match with the one that the target UE has sent during 5G
ProSe UE-to-network relay discovery procedure, then the target UE shall abort
the 5G ProSe direct link establishment procedure.
If the PROSE DIRECT LINK ESTABLISHMENT REQUEST message is for 5G ProSe direct
communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network
relay UE, the message is integrity protected and the integrity verification of
the message fails at the target UE, then the target UE shall abort the 5G
ProSe direct link establishment procedure.
### 7.2.3 5G ProSe direct link modification procedure
#### 7.2.3.1 General
The purpose of the 5G ProSe direct link modification procedure is to modify
the existing ProSe direct link to:
a) add new PC5 QoS flow(s) to the existing 5G ProSe direct link;
b) modify existing PC5 QoS flow(s) for updating PC5 QoS parameters of the
existing PC5 QoS flow(s);
c) modify existing PC5 QoS flow(s) for associating new ProSe application(s)
with the existing PC5 QoS flow(s);
d) modify existing PC5 QoS flow(s) for removing the associated ProSe
application(s) from the existing PC5 QoS flow(s); or
e) remove existing PC5 QoS flow(s) from the existing 5G ProSe direct link.
In this procedure, the UE sending the PROSE DIRECT LINK MODIFICATION REQUEST
message is called the \"initiating UE\" and the other UE is called the
\"target UE\".
NOTE: The 5G ProSe direct link modification procedure is not applicable for 5G
ProSe layer-2 UE-to-network relay case.
#### 7.2.3.2 5G ProSe direct link modification procedure initiated by
initiating UE
The initiating UE shall meet the following pre-conditions before initiating
this procedure for adding a new ProSe application to the existing 5G ProSe
direct link:
a) there is a 5G ProSe direct link between the initiating UE and the target
UE;
b) the pair of application layer IDs and the network layer protocol of this 5G
ProSe direct link are identical to those required by the application layer in
the initiating UE for this ProSe application;
c) the security policy corresponding to the ProSe identifier is aligned with
the security policy of the existing 5G ProSe direct link;
> d) the timer T5091 is not running; and
>
> e) the initiating UE is not performing the 5G ProSe direct link re-keying
> procedure initiated by the target UE.
After receiving the service data or request from the upper layers, the
initiating UE shall perform the PC5 QoS flow match as specified in clause
7.2.8. If there is no matched PC5 QoS flow, the initiating UE shall derive the
PC5 QoS parameters and assign the PQFI(s) for the PC5 QoS flows(s) to be
established as specified in clause 7.2.7.
If the 5G ProSe direct link modification procedure is to add new PC5 QoS
flow(s) to the existing 5G ProSe direct link, the initiating UE shall create a
PROSE DIRECT LINK MODIFICATION REQUEST message. In this message, initiating
UE:
a) shall include the PQFI(s), the corresponding PC5 QoS parameters and
optionally the ProSe identifier(s);
b) shall include the link modification operation code set to \"Add new PC5 QoS
flow(s) to the existing 5G ProSe direct link \"; and
c) may include the PC5 QoS rule(s) to indicate the packet filters of the PC5
QoS flow(s).
If the 5G ProSe direct link modification procedure is to modify the PC5 QoS
parameters for existing PC5 QoS flow(s) in the existing 5G ProSe direct link,
the initiating UE shall create a PROSE DIRECT LINK MODIFICATION REQUEST
message. In this message, the initiating UE:
a) shall include the PQFI(s) and the corresponding PC5 QoS parameters,
including the ProSe identifier(s);
b) shall include the link modification operation code set to \"Modify PC5 QoS
parameters of the existing PC5 QoS flow(s)\"; and
c) may include the PC5 QoS rule(s) to indicate the packet filters of the PC5
QoS flow(s).
If the 5G ProSe direct link modification procedure is to associate new ProSe
application(s) with existing PC5 QoS flow(s), the initiating UE shall create a
PROSE DIRECT LINK MODIFICATION REQUEST message. In this message, the
initiating UE:
a) shall include the PQFI(s) and the corresponding PC5 QoS parameters,
including the ProSe identifier(s);
b) shall include the link modification operation code set to \"Associate new
ProSe application(s) with existing PC5 QoS flow(s)\"; and
c) may include the PC5 QoS rule(s) to indicate the packet filters of the PC5
QoS flow(s).
If the PC5 5G ProSe direct link modification procedure is to remove the
associated ProSe application(s) from existing PC5 QoS flow(s), the initiating
UE shall create a PROSE DIRECT LINK MODIFICATION REQUEST message. In this
message, the initiating UE:
a) shall include the PQFI(s) and the corresponding PC5 QoS parameters
including the ProSe identifier(s); and
b) shall include the link modification operation code set to \"Remove ProSe
application(s) from existing PC5 QoS flow(s)\".
If the direct link modification procedure is to remove any PC5 QoS flow(s)
from the existing 5G ProSe direct link, the initiating UE shall create a PROSE
DIRECT LINK MODIFICATION REQUEST message. In this message, the initiating UE:
a) shall include the PQFI(s); and
b) shall include the link modification operation code set to \"Remove existing
PC5 QoS flow(s) from the existing 5G ProSe direct link\".
After the PROSE DIRECT LINK MODIFICATION REQUEST message is generated, the
initiating UE shall pass this message to the lower layers for transmission
along with the initiating UE\'s layer-2 ID for 5G ProSe direct communication
and the target UE\'s layer-2 ID for 5G ProSe direct communication and start
timer T5081. The UE shall not send a new PROSE DIRECT LINK MODIFICATION
REQUEST message to the same target UE while timer T5081 is running.
Figure 7.2.3.2.1: 5G ProSe direct link modification procedure
#### 7.2.3.3 5G ProSe direct link modification procedure accepted by the
target UE
If the PROSE DIRECT LINK MODIFICATION REQUEST message is accepted, the target
UE shall respond with the PROSE DIRECT LINK MODIFICATION ACCEPT message.
If the PROSE DIRECT LINK MODIFICATION REQUEST message is to add a new ProSe
application, add new PC5 QoS flow(s) or modify any existing PC5 QoS flow(s) in
the 5G ProSe direct link, the target UE:
a) shall include the PQFI(s), the corresponding PC5 QoS parameters and
optionally the ProSe identifier(s) that the target UE accepts; and
b) may include the PC5 QoS rule(s) to indicate the packet filters of the PC5
QoS flow(s);
in the PROSE DIRECT LINK MODIFICATION ACCEPT message.
If the PROSE DIRECT LINK MODIFICATION REQUEST message is to remove an existing
ProSe application from the 5G ProSe direct link, the target UE shall delete
the ProSe identifier received in the PROSE DIRECT LINK MODIFICATION REQUEST
message and the corresponding PQFI(s) and PC5 QoS parameters from the profile
associated with the 5G ProSe direct link.
If the PROSE DIRECT LINK MODIFICATION REQUEST message is to remove existing
PC5 QoS flow(s) from the PC5 5G ProSe direct link, the target UE shall delete
the PQFI(s) and the corresponding PC5 QoS parameters from the profile
associated with the 5G ProSe direct link.
If the PROSE DIRECT LINK MODIFICATION REQUEST message is to add a new ProSe
application, add new PC5 QoS flow(s) or modify any existing PC5 QoS flow(s) in
the 5G ProSe direct link, after sending the PROSE DIRECT LINK MODIFICATION
ACCEPT message, the target UE shall provide the added or modified PQFI(s) and
corresponding PC5 QoS parameters along with PC5 link identifier to the lower
layer.
If the PROSE DIRECT LINK MODIFICATION REQUEST message is to remove an existing
ProSe application or to remove the existing PC5 QoS flow(s) from the 5G ProSe
direct link, after sending the PROSE DIRECT LINK MODIFICATION ACCEPT message,
the target UE shall provide the removed PQFI(s) along with the PC5 link
identifier to the lower layer.
If the 5G ProSe direct link is for 5G ProSe direct communication between the
5G ProSe remote UE and the 5G ProSe layer-3 UE-to-network relay UE, and if the
initiating UE is the 5G ProSe remote UE, then the target UE (as the 5G ProSe
layer-3 UE-to-network relay UE) performs the QoS flows handling procedure as
specified in clause 8.2.6.3.3 and clause 8.2.6.4.2.
If the target UE accepts the 5G ProSe direct link modification request, then
the target UE may perform the PC5 QoS flow establishment over 5G ProSe direct
link as specified in clause 7.2.7 and perform the PC5 QoS flow match over 5G
ProSe direct link as specified in clause 7.2.8.
#### 7.2.3.4 5G ProSe direct link modification procedure completion by the
initiating UE
Upon receipt of the PROSE DIRECT LINK MODIFICATION ACCEPT message, the
initiating UE shall stop timer T5081.
Upon receipt of the PROSE DIRECT LINK MODIFICATION ACCEPT message, if the
PROSE DIRECT LINK MODIFICATION REQUEST message is to add a new ProSe
application, add new PC5 QoS flow(s) or modify any existing PC5 QoS flow(s) in
the 5G ProSe direct link, the initiating UE shall provide the added or
modified PQFI(s) and corresponding PC5 QoS parameters along with PC5 link
identifier to the lower layer.
Upon receipt of the PROSE DIRECT LINK MODIFICATION ACCEPT message, if the
PROSE DIRECT LINK MODIFICATION REQUEST message is to remove an existing ProSe
application or to remove the existing PC5 QoS flow(s) from the 5G ProSe direct
link, the initiating UE shall provide the removed PQFI(s) along with the PC5
link identifier to the lower layer.
#### 7.2.3.5 5G ProSe direct link modification procedure not accepted by the
target UE
If the 5G ProSe direct link modification request cannot be accepted, the
target UE shall send a PROSE DIRECT LINK MODIFICATION REJECT message. The
PROSE DIRECT LINK MODIFICATION REJECT message contains a PC5 signalling
protocol cause IE set to one of the following cause values:
#5 lack of resources for 5G ProSe direct link;
#6 required service not allowed;
#12 security policy not aligned;
#16 lack of local capabilities; or
#111 protocol error, unspecified.
If the target UE is not allowed to accept this request, e.g., because the
ProSe application to be added is not allowed per the operator policy or
configuration parameters for ProSe communication over PC5 as specified in
clause 5.2.4, the target UE shall send a PROSE DIRECT LINK MODIFICATION REJECT
message with PC5 signalling protocol cause value #6 \"required service not
allowed\".
If the 5G ProSe direct link modification fails due to the congestion problems
or other temporary lower layer problems causing resource constraints, the
target UE shall send a PROSE DIRECT LINK MODIFICATION REJECT message with PC5
signalling protocol cause value #5 \"lack of resources for 5G ProSe direct
link\".
If the link modification operation code is set to \"Associate new ProSe
application(s) with existing PC5 QoS flow(s)\" and the security policy
corresponding to the ProSe identifier(s) is not aligned with the security
policy applied to the existing 5G ProSe direct link, then the target UE shall
send a PROSE DIRECT LINK MODIFICATION REJECT message with PC5 signalling
protocol cause value #12 \"security policy not aligned\".
If the link modification operation requires the addition of new PC5 QoS
flow(s) but the target UE cannot support additional packet filters which would
be required on the existing PDU session of the target UE, then the target UE
shall send a PROSE DIRECT LINK MODIFICATION REJECT message with PC5 signalling
protocol cause value #16\"lack of local capabilities\".
For other reasons causing the failure of link modification, the target UE
shall send a PROSE DIRECT LINK MODIFICATION REJECT message with PC5 signalling
protocol cause value #111 \"protocol error, unspecified\".
Upon receipt of the PROSE DIRECT LINK MODIFICATION REJECT message, the
initiating UE shall stop timer T5081 and abort the 5G ProSe direct link
modification procedure. If the PC5 signalling protocol cause value in the
PROSE DIRECT LINK MODIFICATION REJECT message is #11 \"required service not
allowed\" or #5 \"lack of resources for 5G ProSe direct link\" or #12
\"security policy not aligned\", then the initiating UE shall not attempt to
start 5G ProSe direct link modification with the same target UE to add the
same ProSe application, or to add or modify the same PC5 QoS flow(s) at least
for a time period T.
NOTE: The length of time period T is UE implementation specific and can be
different for the case when the UE receives PC5 signalling protocol cause
value #11 \"required service not allowed\" or when the UE receives PC5
signalling protocol cause value #5 \"lack of resources for 5G ProSe direct
link\" or when the UE receives PC5 signalling protocol cause value #12
\"security policy not aligned\". The length of time period T is not less than
30 minutes.
#### 7.2.3.6 Abnormal cases
##### 7.2.3.6.1 Abnormal cases at the initiating UE
The following abnormal cases can be identified:
a) If timer T5081 expires, the initiating UE shall retransmit the PROSE DIRECT
LINK MODIFICATION REQUEST message and restart timer T5081. After reaching the
maximum number of allowed retransmissions, the initiating UE shall abort the
5G ProSe direct link modification procedure and may notify the upper layer
that the target UE is unreachable.
NOTE 1: The maximum number of allowed retransmissions is UE implementation
specific.
NOTE 2: After reaching the maximum number of allowed retransmissions, whether
the initiating UE releases this 5G ProSe direct link depends on its
implementation.
b) For the same 5G ProSe direct link, if the initiating UE receives a PROSE
DIRECT LINK RELEASE REQUEST message after the initiation of UE-requested 5G
ProSe direct link modification procedure, the initiating UE shall stop the
timer T5081 and abort the 5G ProSe direct link modification procedure and
proceed with the 5G ProSe direct link release procedure.
c) For the same 5G ProSe direct link, if the initiating UE receives a PROSE
DIRECT LINK MODIFICATION REQUEST message during the 5G ProSe direct link
modification procedure, the initiating UE shall stop the timer T5081 and abort
the 5G ProSe direct link modification procedure. Following handling is
implementation dependent, e.g., the initiating UE waits for an implementation
dependent time for initiating a new 5G ProSe direct link modification
procedure, if still needed.
NOTE 3: The implementation dependent timer value needs to be set to avoid
further collisions (e.g., random timer value).
##### 7.2.3.6.2 Abnormal cases at the target UE
The following abnormal cases can be identified:
a) For the same 5G ProSe direct link, if the target UE receives a PROSE DIRECT
LINK RELEASE REQUEST message during the 5G ProSe direct link modification
procedure, the target UE shall stop all running timers for this 5G ProSe
direct link, abort the 5G ProSe direct link modification procedure and proceed
with the 5G ProSe direct link release procedure.
### 7.2.4 5G ProSe direct link identifier update procedure
#### 7.2.4.1 General
The 5G ProSe direct link identifier update procedure is used to update and
exchange the new identifiers (e.g., application layer ID, layer-2 ID, security
information and IP address/prefix) between two UEs for a 5G ProSe direct link
before using the new identifiers. The UE sending the PROSE DIRECT LINK
IDENTIFIER UPDATE REQUEST message is called the \"initiating UE\" and the
other UE is called the \"target UE\".
#### 7.2.4.2 5G ProSe direct link identifier update procedure initiation by
initiating UE
The initiating UE shall initiate the procedure if:
a) the initiating UE receives a request from upper layers to change the
application layer ID and there is an existing 5G ProSe direct link associated
with this application layer ID; or
b) the privacy timer (see clause 5.2.4) of the initiating UE\'s layer-2 ID
expires for an existing 5G ProSe direct link.
The initiating UE shall meet the following pre-conditions before initiating
this procedure:
> a) the timer T5091 is not running; and
>
> b) the initiating UE is not performing the 5G ProSe direct link re-keying
> procedure initiated by the target UE.
If the 5G ProSe direct link identifier update procedure is triggered by a
change of the initiating UE\'s application layer ID, the initiating UE shall
create a PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message. In this message,
the initiating UE:
a) shall include the initiating UE\'s new application layer ID received from
upper layer;
b) shall include the initiating UE\'s new layer-2 ID assigned by itself;
c) shall include the new MSB of K~NRP-sess~ ID; and
d) shall include the new IP address/prefix if IP communication is used and the
5G ProSe direct link is not for 5G ProSe direct communication between 5G ProSe
layer-2 remote UE and 5G ProSe layer-2 UE-to-network relay UE.
If the 5G ProSe direct link identifier update procedure is triggered by the
expiry of the initiating UE\'s privacy timer T5090 as specified in clause
5.2.4 and clause 5.2.5, the initiating UE shall create a PROSE DIRECT LINK
IDENTIFIER UPDATE REQUEST message. In this message, the initiating UE:
a) shall include the initiating UE\'s new layer-2 ID assigned by itself;
b) shall include the new MSB of K~NRP-sess~ ID;
c) may include the initiating UE\'s new application layer ID if received from
upper layer; and
d) shall include the new IP address/prefix if IP communication is used and
changed and the 5G ProSe direct link is not for 5G ProSe direct communication
between 5G ProSe layer-2 remote UE and 5G ProSe layer-2 UE-to-network relay
UE.
After the PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message is generated,
the initiating UE shall pass this message to the lower layers for transmission
along with the initiating UE\'s old layer-2 ID for 5G ProSe direct
communication and the target UE\'s layer-2 ID for 5G ProSe direct
communication and start timer T5082. The UE shall not send a new PROSE DIRECT
LINK IDENTIFIER UPDATE REQUEST message to the same target UE while timer T5082
is running.
Figure 7.2.4.2.1: 5G ProSe direct link identifier update procedure
#### 7.2.4.3 5G ProSe direct link identifier update procedure accepted by the
target UE
Upon receipt of a PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message, if the
target UE determines:
a) the 5G ProSe direct link associated with this request message is still
valid; and
b) the timer T5083 for the 5G ProSe direct link identified by this request
message is not running,
then the target UE accepts this request and responds with a PROSE DIRECT LINK
IDENTIFIER UPDATE ACCEPT message.
The target UE shall create the PROSE DIRECT LINK IDENTIFIER UPDATE ACCEPT
message. In this message, the target UE:
a) shall include the target UE\'s new layer-2 ID assigned by itself;
b) shall include the new LSB of K~NRP-sess~ ID;
c) shall include the initiating UE\'s new MSB of K~NRP-sess~ ID;
d) shall include the initiating UE\'s new layer-2 ID;
e) shall include the target UE\'s new application layer ID if received from
upper layer;
f) shall include the initiating UE\'s new IP address/prefix if received from
the initiating UE and IP communication is used;
g) shall include the initiating UE\'s new application layer ID if received
from the initiating UE; and
h) shall include the target UE\'s new IP address/prefix if IP communication is
used and changed and the 5G ProSe direct link is not for 5G ProSe direct
communication between 5G ProSe layer-2 remote UE and 5G ProSe layer-2 UE-to-
network relay UE.
After the PROSE DIRECT LINK IDENTIFIER UPDATE ACCEPT message is generated, the
target UE shall pass this message to the lower layers for transmission along
with the initiating UE\'s old layer-2 ID for 5G ProSe direct communication and
the target UE\'s old layer-2 ID for 5G ProSe direct communication and start
timer T5083. The UE shall not send a new PROSE DIRECT LINK IDENTIFIER UPDATE
ACCEPT message to the same initiating UE while timer T5083 is running.
Before target UE receives the traffic using the new layer-2 IDs, the target UE
shall continue to receive the traffic with the old layer-2 IDs (i.e.,
initiating UE\'s old layer-2 ID and target UE\'s old layer-2 ID) from
initiating UE.
Before target UE receives the PROSE DIRECT LINK IDENTIFIER UPDATE ACK message
from initiating UE, the target UE shall keep sending traffic to the initiating
UE using the old layer-2 IDs (i.e., initiating UE\'s old layer-2 ID for 5G
ProSe direct communication and target UE\'s old layer-2 ID for 5G ProSe direct
communication).
#### 7.2.4.4 5G ProSe direct link identifier update procedure acknowledged by
the initiating UE
Upon receipt of the PROSE DIRECT LINK IDENTIFIER UPDATE ACCEPT message, the
initiating UE shall stop timer T5082 and respond with a PROSE DIRECT LINK
IDENTIFIER UPDATE ACK message. In this message, the initiating UE:
a) shall include the target UE\'s new layer-2 ID;
b) shall include the target UE\'s new LSB of K~NRP-sess~ ID;
c) shall include the target UE\'s new application layer ID, if received; and
d) shall include the target UE\'s new IP address/prefix, if received.
After the PROSE DIRECT LINK IDENTIFIER UPDATE ACK message is generated, the
initiating UE shall pass this message to the lower layers for transmission
along with the initiating UE\'s old layer-2 ID for 5G ProSe direct
communication and the target UE\'s old layer-2 ID for 5G ProSe direct
communication and shall stop timer T5090 if running and start a timer T5090 as
configured if at least one of ProSe identifiers for the 5G ProSe direct link
satisfying the privacy requirements as specified in clause 5.2.4 or if
satisfying the privacy requirements as specified in clause 5.2.5.
Upon sending the PROSE DIRECT LINK IDENTIFIER UPDATE ACK message, the
initiating UE shall update the associated 5G ProSe direct link context with
the new identifiers and pass the new layer-2 IDs (i.e., initiating UE\'s new
layer-2 ID for 5G ProSe direct communication and target UE\'s new layer-2 ID
for 5G ProSe direct communication) along with the PC5 link identifier down to
the lower layer. Then the initiating UE shall use the new layer-2 IDs (i.e.,
initiating UE\'s new layer-2 ID for 5G ProSe direct communication and target
UE\'s new layer-2 ID for 5G ProSe direct communication) to transmit the PC5
signalling message and PC5 user plane data.
The initiating UE shall continue to receive traffic with the old layer-2 IDs
(i.e., initiating UE\'s old layer-2 ID for 5G ProSe direct communication and
target UE\'s old layer-2 ID for 5G ProSe direct communication) from the target
UE until it receives traffic with the new layer-2 IDs (i.e., initiating UE\'s
new layer-2 ID and target UE\'s new layer-2 ID) from the target UE.
#### 7.2.4.5 5G ProSe direct link identifier update procedure completion by
the target UE
Upon receipt of the PROSE DIRECT LINK IDENTIFIER UPDATE ACK message, the
target UE shall update the associated 5G ProSe direct link context with the
new identifiers, pass the new layer-2 IDs (i.e., initiating UE\'s new layer-2
ID and target UE\'s new layer-2 ID) down to the lower layer, stop timer T5083
and timer T5090 if running and start a timer T5090 as configured if at least
one of ProSe identifiers for the 5G ProSe direct link satisfying the privacy
requirements as specified in clause 5.2.4 or if satisfying the privacy
requirements as specified in clause 5.2.5. Then the target UE shall use the
new layer-2 IDs (i.e., initiating UE\'s new layer-2 ID for 5G ProSe direct
communication and target UE\'s new layer-2 ID for 5G ProSe direct
communication) to transmit the PC5 signalling message and PC5 user plane data.
#### 7.2.4.6 5G ProSe direct link identifier update procedure not accepted by
the target UE
If the PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message cannot be accepted,
the target UE shall send a PROSE DIRECT LINK IDENTIFIER UPDATE REJECT message.
The PROSE DIRECT LINK IDENTIFIER UPDATE REJECT message contains a PC5
signalling protocol cause IE set to one of the following cause values:
#3 conflict of layer-2 ID for 5G ProSe direct communication is detected; or
#111 protocol error, unspecified.
For a received PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message from a
layer-2 ID (for 5G ProSe direct communication), if the target UE already has
an existing link using this layer-2 ID or is currently processing a PROSE
DIRECT LINK IDENTIFIER UPDATE REQUEST message from the same layer-2 ID, but
with user info different from the user info IE included in this new incoming
message, the target UE shall send a PROSE DIRECT LINK IDENTIFIER UPDATE REJECT
message with PC5 signalling protocol cause value #3 \"conflict of layer-2 ID
for 5G ProSe direct communication is detected\".
NOTE: After receiving the PROSE DIRECT LINK IDENTIFIER UPDATE REJECT message,
whether the initiating UE initiates the 5G ProSe direct link release procedure
or initiates another 5G ProSe direct link identifier update procedure with a
new layer-2 ID depends on UE implementation.
For other reasons causing the failure of link identifier update, the target UE
shall send a PROSE DIRECT LINK IDENTIFIER UPDATE REJECT message with PC5
signalling protocol cause value #111 \"protocol error, unspecified\".
Upon receipt of the PROSE DIRECT LINK IDENTIFIER UPDATE REJECT message, the
initiating UE shall stop timer T5082 and abort this 5G ProSe direct link
identifier update procedure.
#### 7.2.4.7 Abnormal cases
##### 7.2.4.7.1 Abnormal cases at the initiating UE
The following abnormal cases can be identified:
a) If timer T5082 expires, the initiating UE shall retransmit the PROSE DIRECT
LINK IDENTIFIER UPDATE REQUEST message and restart timer T5082. After reaching
the maximum number of allowed retransmissions, the initiating UE shall abort
the 5G ProSe direct link identifier update procedure and may notify the upper
layer that the target UE is unreachable.
NOTE 1: The maximum number of allowed retransmissions is UE implementation
specific.
NOTE 2: After reaching the maximum number of allowed retransmissions, whether
the initiating UE releases this 5G ProSe direct link depends on its
implementation.
b) For the same 5G ProSe direct link, if the initiating UE receives a PROSE
DIRECT LINK IDENTIFIER UPDATE REQUEST message during the 5G ProSe direct link
identifier update procedure, the initiating UE shall stop the timer T5082 and
abort the 5G ProSe direct link identifier update procedure. Following handling
is implementation dependent, e.g., the initiating UE waits for an
implementation dependent time for initiating a new 5G ProSe direct link
identifier update procedure, if still needed.
NOTE 3: The implementation dependent timer value needs to be set to avoid
further collisions (e.g., random timer value).
c) For the same 5G ProSe direct link, if the initiating UE receives a PROSE
DIRECT LINK REKEYING REQUEST message after initiating the 5G ProSe direct link
identifier update procedure, the initiating UE shall ignore the PROSE DIRECT
LINK REKEYING REQUEST message and proceed with the 5G ProSe direct link
identifier update procedure.
d) For the same 5G ProSe direct link, if the initiating UE receives a PROSE
DIRECT LINK RELEASE REQUEST message after the initiation of 5G ProSe direct
link identifier update procedure, the initiating UE shall stop the timer T5082
and abort the 5G ProSe direct link identifier update procedure and proceed
with the 5G ProSe direct link release procedure.
e) After sending the PROSE DIRECT LINK IDENTIFIER UPDATE ACK message to the
target UE, if another PROSE DIRECT LINK IDENTIFIER UPDATE ACCEPT message from
the target UE is received before the traffic from the target UE with the new
layer-2 IDs is received, the initiating UE shall retransmit the PROSE DIRECT
LINK IDENTIFIER UPDATE ACK message along with the initiating UE\'s old layer-2
ID and the target UE\'s old layer-2 ID.
NOTE 4: It is up to implementation to handle the failure of traffic delivery
for new layer-2 IDs if such traffic has been sent before the initiating UE
retransmits the PROSE DIRECT LINK IDENTIFIER UPDATE ACK message.
f) After sending the PROSE DIRECT LINK IDENTIFIER UPDATE ACK message to the
target UE, if the initiating UE keeps receiving traffic from the target UE
with the old layer-2 IDs and traffic from the target UE with the new layer-2
IDs is not received during an implementation specific time which is greater
than the value of timer T5083, the initiating UE shall abort the 5G ProSe
direct link identifier update procedure and may release the 5G ProSe direct
link.
##### 7.2.4.7.2 Abnormal cases at the target UE
The following abnormal cases can be identified:
a) If timer T5083 expires, the target UE shall retransmit the PROSE DIRECT
LINK IDENTIFIER UPDATE ACCEPT message and restart timer T5083. After reaching
the maximum number of allowed retransmissions, the target UE shall abort the
5G ProSe direct link identifier update procedure and may notify the upper
layer that the initiating UE is unreachable.
NOTE 1: The maximum number of allowed retransmissions is UE implementation
specific.
NOTE 2: After reaching the maximum number of allowed retransmissions, whether
the target UE releases this 5G ProSe direct link depends on its
implementation.
b) If PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST is received when the timer
T5083 is running, the target UE shall stop the timer T5083 and abort the
ongoing 5G ProSe direct link identifier update procedure. The target UE shall
handle the new PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST as specified in
clause 7.2.4.3.
c) For the same 5G ProSe direct link, if the target UE receives a PROSE DIRECT
LINK RELEASE REQUEST message during the 5G ProSe direct link identifier update
procedure, the target UE shall stop the timer T5083, abort the 5G ProSe direct
link identifier update procedure and proceed with the 5G ProSe direct link
release procedure.
### 7.2.5 5G ProSe direct link keep-alive procedure
#### 7.2.5.1 General
The 5G ProSe direct link keep-alive procedure is used to maintain a 5G ProSe
direct link between two UEs, i.e., check that the link between the two UEs is
still valid. The UE sending the PROSE DIRECT LINK KEEPALIVE REQUEST message is
called the \"initiating UE\" and the other UE is called the \"target UE\".
The 5G ProSe direct link keep-alive procedure can be initiated by only one UE
or both UEs in the established 5G ProSe direct link.
NOTE: Whether the 5G ProSe direct link keep-alive procedure is initiated by
only one UE or both UEs in the established 5G ProSe direct link is UE
implementation specific.
#### 7.2.5.2 5G ProSe direct link keep-alive procedure initiation by the
initiating UE
The initiating UE shall meet the following pre-condition before initiating the
5G ProSe direct link keep-alive procedure:
a) there is a 5G ProSe direct link between the initiating UE and the target
UE.
The initiating UE shall manage a keep-alive timer T5084 and a keep-alive
counter for the 5G ProSe direct link keep-alive procedure. Timer T5084 is used
to trigger the periodic initiation of the 5G ProSe direct link keep-alive
procedure. The UE shall start or restart timer T5084 whenever the UE receives
a PC5 signalling message or PC5 user plane data from the target UE over this
5G ProSe direct link. The UE shall set the keep-alive counter to an initial
value of zero after 5G ProSe direct link establishment.
The initiating UE shall initiate the 5G ProSe direct link keep-alive procedure
when:
a) timer T5084 for this link expires;
b) optionally, a request from the lower layers to check the viability of the
5G ProSe direct link is received; or
NOTE 1: Whether the lower layers can request the initiation of the 5G ProSe
direct link keep-alive procedure and what the triggers for the lower layers
are to request the initiation of the 5G ProSe direct link keep-alive
procedure, are UE implementation specific.
c) optionally, a request from the upper layers to check the viability of the
5G ProSe direct link is received.
NOTE 2: Whether the upper layers can request the initiation of the 5G ProSe
direct link keep-alive procedure and what the triggers for the upper layers
are to request the initiation of the 5G ProSe direct link keep-alive
procedure, are UE implementation specific.
In order to initiate the 5G ProSe direct link keep-alive procedure, the
initiating UE shall stop timer T5084, if running and shall create a PROSE
DIRECT LINK KEEPALIVE REQUEST message. In this message, the initiating UE:
a) shall include the keep-alive counter for the 5G ProSe direct link; and
b) may include a maximum inactivity period to indicate the maximum inactivity
period of the initiating UE over this 5G ProSe direct link.
NOTE 3: The value chosen for the maximum inactivity period of the initiating
UE is UE implementation specific with the objective to minimize the number of
keep-alive procedures as much as possible. It is desirable to have the maximum
inactivity period value to be slightly higher than the value of keep-alive
timer T5084.
After the PROSE DIRECT LINK KEEPALIVE REQUEST message is generated, the
initiating UE shall pass this message to the lower layers for transmission
along with the initiating UE\'s layer-2 ID for 5G ProSe direct communication
and the target UE\'s layer-2 ID for 5G ProSe direct communication and start
timer T5085. The UE shall not send a new PROSE DIRECT LINK KEEPALIVE REQUEST
message to the same target UE while timer T5085 is running.
Figure 7.2.5.2.1: 5G ProSe direct link keep-alive procedure
#### 7.2.5.3 5G ProSe direct link keep-alive procedure accepted by the target
UE
Upon receipt of a PROSE DIRECT LINK KEEPALIVE REQUEST message, the target UE
shall create a PROSE DIRECT LINK KEEPALIVE RESPONSE message. In this message,
the target UE:
a) shall include the keep-alive counter set to the same value as that received
in the PROSE DIRECT LINK KEEPALIVE REQUEST message.
After the PROSE DIRECT LINK KEEPALIVE RESPONSE message is generated, the
target UE shall pass this message to the lower layers for transmission along
with the target UE\'s layer-2 ID for 5G ProSe direct communication and the
initiating UE\'s layer-2 ID for 5G ProSe direct communication.
If a maximum inactivity period is included in the PROSE DIRECT LINK KEEPALIVE
REQUEST message, the target UE shall stop T5086, if running and start T5086
with its value set to the maximum inactivity period. The target UE shall
restart T5086 whenever the target UE receives a PC5 signalling message or PC5
user plane data from the initiating UE over this 5G ProSe direct link.
#### 7.2.5.4 5G ProSe direct link keep-alive procedure completion by the
initiating UE
Upon receipt of a PROSE DIRECT LINK KEEPALIVE RESPONSE message, the initiating
UE shall stop timer T5085, start timer T5084 and increment the keep-alive
counter for the 5G ProSe direct link.
#### 7.2.5.5 Abnormal cases
##### 7.2.5.5.1 Abnormal cases at the initiating UE
a) Timer T5085 expires.
The initiating UE shall retransmit the PROSE DIRECT LINK KEEPALIVE REQUEST
message with the last used value of the keep-alive counter and restart timer
T5085. After reaching the maximum number of allowed retransmissions, the
initiating UE shall abort the 5G ProSe direct link keep-alive procedure and
locally release the 5G ProSe direct link.
NOTE: The maximum number of allowed retransmissions is UE implementation
specific.
b) The need to use this 5G ProSe direct link no longer exists before the 5G
ProSe direct link keep-alive procedure is completed.
The initiating UE shall abort the 5G ProSe direct link keep-alive procedure
and initiate a 5G ProSe direct link release procedure.
c) The initiating UE receives a PROSE DIRECT LINK KEEPALIVE RESPONSE message
with a keep-alive counter value different from the value which the initiating
UE had included in the last sent PROSE DIRECT LINK KEEPALIVE REQUEST message.
The initiating UE shall discard the PROSE DIRECT LINK KEEPALIVE RESPONSE
message.
d) The initiating UE receives a PC5 signalling message other than a PROSE
DIRECT LINK KEEPALIVE RESPONSE message or PC5 user plane data from the target
UE over this 5G ProSe direct link while timer T5085 is running.
The initiating UE shall stop timer T5085, abort the 5G ProSe direct link keep-
alive procedure, start timer T5084 and increment the keep-alive counter for
the 5G ProSe direct link.
e) The initiating UE receives a PROSE DIRECT LINK KEEPALIVE RESPONSE message
when T5085 is not running.
The initiating UE shall discard the PROSE DIRECT LINK KEEPALIVE RESPONSE
message.
##### 7.2.5.5.2 Abnormal cases at the target UE
a) Timer T5086 expires.
The target UE shall:
1) initiate a 5G ProSe direct link keep-alive procedure to check the link; or
2) initiate the 5G ProSe direct link release procedure.
Whether the UE chooses 1) or 2) is left to UE implementation.
b) The target UE receives a PROSE DIRECT LINK KEEPALIVE REQUEST message with a
keep-alive counter value lower than the value which the target UE had included
in the last sent PROSE DIRECT LINK KEEPALIVE RESPONSE message.
The target UE shall discard the PROSE DIRECT LINK KEEPALIVE REQUEST message.
c) The target UE receives a PROSE DIRECT LINK KEEPALIVE REQUEST message if
there is a pending PC5 signalling message or PC5 user plane data to be sent to
the initiating UE over this 5G ProSe direct link.
The target UE:
1) shall pass this PC5 signalling message to the lower layers for transmission
along with the target UE\'s layer-2 ID for 5G ProSe direct communication and
the initiating UE\'s layer-2 ID for 5G ProSe direct communication, or perform
the data transmission over 5G ProSe direct link as specified in clause 7.2.9;
and
2) shall consider transmission of this PC5 signalling message or PC5 user
plane data to be an implicit PROSE DIRECT LINK KEEPALIVE RESPONSE message and
skip generating a PROSE DIRECT LINK KEEPALIVE RESPONSE message. If a maximum
inactivity period is included in the PROSE DIRECT LINK KEEPALIVE REQUEST
message, the target UE shall stop T5086, if running and start T5086 with its
value set to the maximum inactivity period.
### 7.2.6 5G ProSe direct link release procedure
#### 7.2.6.1 General
The 5G ProSe direct link release procedure is used to release a secure 5G
ProSe direct link between two UEs. The link can be released from either end
point. The UE sending the PROSE DIRECT LINK RELEASE REQUEST message is called
the \"initiating UE\" and the other UE is called the \"target UE\".
If the UE receives an indication of radio link failure or an indication of
PC5-RRC connection release from the lower layer, the UE shall release the 5G
ProSe direct link locally and may delete the K~NRP~ ID associated with this
link after an implementation specific time. If the UE acting as 5G ProSe
layer-2 UE-to-network relay UE or 5G ProSe layer-2 remote UE receives a
request of 5G ProSe direct link release from the lower layer as specified in
3GPP TS 38.331 [13], the UE shall initiate the 5G ProSe direct link release
procedure.
When the direct link between a 5G ProSe remote UE and a 5G ProSe UE-to-network
relay UE is released, the 5G ProSe layer-3 UE-to-network relay UE shall
perform the remote UE report procedure as specified in 3GPP TS 24.501 [11].
#### 7.2.6.2 5G ProSe direct link release procedure initiation by initiating
UE
The initiating UE shall initiate the procedure if a request from upper layers
to release a 5G ProSe direct link with the target UE which uses a known
layer-2 ID (for unicast communication) is received and there is an existing 5G
ProSe direct link between these two UEs.
The initiating UE may initiate the procedure if the target UE has been non-
responsive, e.g., no response in the 5G ProSe direct link modification
procedure, 5G ProSe direct link identifier update procedure, 5G ProSe direct
link re-keying procedure or 5G ProSe direct link keep-alive procedure.
The initiating UE may initiate the procedure to release an established 5G
ProSe direct link if the UE has reached the maximum number of established 5G
ProSe direct links and there is a need to establish a new 5G ProSe direct
link. In this case, which 5G ProSe direct link is to be released is up to UE
implementation.
The initiating UE may initiate the procedure to release an established 5G
ProSe direct link upon expiry of the timer T5084.
If:
a) the initiating UE acts as 5G ProSe layer-3 UE-to-network relay UE; and
b) the PDU session established for relaying the traffic of the target UE is
released by the initiating UE or the network as specified in 3GPP TS 24.501
[11] clause 6.3.3 or clause 6.4.3;
the initiating UE should initiate the 5G ProSe direct link release procedure.
If the initiating UE which is acting as 5G ProSe layer-3 UE-to-network relay
UE establishes a new PDU session after receiving 5GSM cause value #39
\"reactivation requested\" as specified in 3GPP TS 24.501 [11] clause 6.3.2.3,
the UE may initiate the 5G ProSe direct link release procedure.
If:
a) the initiating UE acts as 5G ProSe layer-2 remote UE or 5G ProSe layer-3
remote UE for relay with N3IWF support; and
b) the initiating UE is in 5GMM-IDLE mode;
the initiating UE may initiate the 5G ProSe direct link release procedure.
If:
a) the initiating UE acts as 5G ProSe layer-2 remote UE, 5G ProSe layer-3
remote UE or 5G ProSe layer-2 UE-to-network relay UE; and
b) the service authorization for the initiating UE to act as 5G ProSe layer-2
remote UE, 5G ProSe layer-3 remote UE or 5G ProSe layer-2 UE-to-network relay
UE is revoked after receiving the configuration parameters for 5G ProSe UE-to-
network relay as specified in clause 5.2.5;
the initiating UE should initiate the 5G ProSe direct link release procedure.
If:
a) the initiating UE acts as 5G ProSe layer-3 UE-to-network relay UE; and
b) the service authorization for the initiating UE to act as 5G ProSe layer-3
UE-to-network relay UE in the serving PLMN is revoked after receiving the
configuration parameters for 5G ProSe UE-to-network relay as specified in
clause 5.2.5;
the initiating UE should initiate the 5G ProSe direct link release procedure,
and the initiating UE releases the PDU session established for relaying the
traffic of the target UE as specified in 3GPP TS 24.501 [11] clause 6.4.3.
In order to initiate the 5G ProSe direct link release procedure, the
initiating UE shall create a PROSE DIRECT LINK RELEASE REQUEST message with a
PC5 signalling protocol cause IE indicating one of the following cause values:
#1 direct communication to the target UE not allowed;
#2 direct communication to the target UE no longer needed;
#4 direct connection is not available anymore;
#5 lack of resources for 5G ProSe direct link;
#13 congestion situation; or
#111 protocol error, unspecified.
If the 5G ProSe direct link was established for relaying and:
a) the NAS level mobility management congestion control as specified in clause
5.3.9 of TS 24.501 [11] is activated at the initiating UE; or
b) the initiating UE is under congestion;
the initiating UE shall send a PROSE DIRECT LINK RELEASE REQUEST message
containing PC5 signalling protocol cause value #13 \"congestion situation\".
The initiating UE may provide a back-off timer value to the target UE in the
PROSE DIRECT LINK RELEASE REQUEST message. The initiating UE shall not accept
any 5G ProSe direct link establishment request for relaying if the back-off
timer NAS level mobility management congestion control is running.
NOTE 1: How the initiating UE determines that it is under congestion is
implementation specific (e.g., any relaying related operational overhead,
etc).
NOTE 2: In case the initiating UE is under the NAS level mobility management
congestion control, it is an implementation option that the provided back-off
timer value to the target UE is set to the mobility management back-off timer
T3346 or with an additional offset value.
If the 5G ProSe direct link was established by the initiating UE which is a 5G
ProSe layer-2 remote UE, and the NAS level mobility management congestion
control as specified in clause 5.3.9 of 3GPP TS 24.501 [11] is activated at
the initiating UE, then the initiating UE shall send a PROSE DIRECT LINK
RELEASE REQUEST message containing PC5 signalling protocol cause value #13
\"congestion situation\".
The initiating UE shall include the new 2 MSBs of K~NRP~ ID in the PROSE
DIRECT LINK RELEASE REQUEST message.
After the PROSE DIRECT LINK RELEASE REQUEST message is generated, the
initiating UE shall pass this message to the lower layers for transmission
along with the initiating UE\'s layer-2 ID for unicast communication and the
target UE\'s layer-2 ID for unicast communication and shall stop T5090 if
running. The initiating UE shall start timer T5087.
Figure 7.2.6.2.1: 5G ProSe direct link release procedure
#### 7.2.6.3 5G ProSe direct link release procedure accepted by the target UE
Upon receiving a PROSE DIRECT LINK RELEASE REQUEST message, the target UE
shall stop all running timers for this 5G ProSe direct link and abort any
other ongoing PC5 signalling protocol procedures on this 5G ProSe direct link.
If the PC5 signalling protocol cause value in the PROSE DIRECT LINK RELEASE
REQUEST message is #13 \"congestion situation\" and a back-off timer value is
provided in the PROSE DIRECT LINK RELEASE REQUEST message, the target UE shall
start timer T5088 associated with the layer-2 ID of the initiating UE and set
its value to the provided timer value.
The target UE shall respond with a PROSE DIRECT LINK RELEASE ACCEPT message.
The target UE shall include the new 2 LSBs of K~NRP~ ID in the PROSE DIRECT
LINK RELEASE ACCEPT message. After the message is sent, the target UE shall
release the 5G ProSe direct link by performing the following behaviours:
a) inform the lower layer along with the PC5 link identifier that the 5G ProSe
direct link has been released; and
b) delete the 5G ProSe direct link context of the 5G ProSe direct link after
an implementation specific time.
The target UE shall form the new K~NRP~ ID from the new MSBs of K~NRP~ ID
received in the PROSE DIRECT LINK RELEASE REQUEST message and the new LSBs of
K~NRP~ ID included in the PROSE DIRECT LINK RELEASE ACCEPT message. The target
UE shall replace the existing K~NRP~ ID with the new K~NRP~ ID. The target UE
may include the new K~NRP~ ID in PROSE DIRECT LINK ESTABLISHMENT REQUEST
message with the initiating UE as specified in clause 7.2.2.2.
#### 7.2.6.4 5G ProSe direct link release procedure completion by the
initiating UE
Upon receipt of the PROSE DIRECT LINK RELEASE ACCEPT message, the initiating
UE shall stop timer T5087 and shall release the 5G ProSe direct link by
performing the following behaviours:
a) inform the lower layer along with the PC5 link identifier that the 5G ProSe
direct link has been released; and
b) delete the 5G ProSe direct link context of the 5G ProSe direct link after
an implementation specific time.
The initiating UE shall form the new K~NRP~ ID from the MSBs of K~NRP~ ID
included in the PROSE DIRECT LINK RELEASE REQUEST message and the LSBs of
K~NRP~ ID received in the PROSE DIRECT LINK RELEASE ACCEPT message. The
initiating UE shall replace the existing K~NRP~ ID with the new K~NRP~ ID. The
initiating UE may include the new K~NRP~ ID in PROSE DIRECT LINK ESTABLISHMENT
REQUEST message with the target UE as specified in clause 7.2.2.2.
#### 7.2.6.5 Abnormal cases
##### 7.2.6.5.1 Abnormal cases at the initiating UE
If retransmission timer T5087 expires and the PC5 signalling protocol cause
included in the PC5 signalling protocol cause IE in the PROSE DIRECT LINK
RELEASE REQUEST message was #4 \"direct connection is not available anymore\",
the initiating UE shall release the 5G ProSe direct link locally and delete
the K~NRP~ ID associated with this link. From this time onward the initiating
UE shall no longer send or receive any messages via this link.
If retransmission timer T5087 expires and the PC5 signalling protocol cause
included in the PC5 signalling protocol cause IE in the PROSE DIRECT LINK
RELEASE REQUEST message was not #4 \"direct connection is not available
anymore\", the initiating UE shall initiate the transmission of the PROSE
DIRECT LINK RELEASE REQUEST message again and restart timer T5087.
If no response is received from the target UE after reaching the maximum
number of allowed retransmissions, the initiating UE shall release the 5G
ProSe direct link locally and delete the K~NRP~ ID associated with this link.
From this time onward the initiating UE shall no longer send or receive any
messages via this link.
NOTE: The maximum number of allowed retransmissions is UE implementation
specific.
### 7.2.7 PC5 QoS flow establishment over 5G ProSe direct link
In order to establish a PC5 QoS flow establishment over 5G ProSe direct link,
the UE shall derive the PC5 QoS parameters based on the ProSe application
requirements provided by the upper layers (if available) and the ProSe
identifier(s) according to the PC5 QoS mapping rules defined in clause 5.2.4.
The UE shall create the PC5 QoS flow(s) based on the derived PC5 QoS
parameters. For each PC5 QoS flow to be created, the UE shall perform the
following operations:
a) self-assign a PQFI;
b) create a PC5 QoS flow context, which contains:
1) the PQFI;
2) the ProSe identifier(s); and
3) the derived PC5 QoS parameters;
c) create a new PC5 QoS rule which contains:
1) a PC5 QoS rule identifier;
2) the PQFI;
3) a set of packet filters; and
4) a precedence value; and
d) pass the following parameters to the lower layers:
1) the PQFI;
2) the PC5 QoS parameters;
3) the PC5 link identifier; and
4) optionally, the source and destination layer-2 IDs.
Three types of packet filters are supported for unicast mode 5G ProSe direct
communication over PC5, i.e., the ProSe IP packet filter set, the ProSe packet
filter set and the ProSe Ethernet packet filter set. A PC5 QoS Rule contains
one of the following:
a) the ProSe IP packet filter set;
b) the ProSe packet filter set; or
c) the ProSe Ethernet packet filter set.
The ProSe IP packet filter set is defined as content of the packet filter
contents field specified in 3GPP TS 24.501 [11] figure 9.11.4.13.4 and table
9.11.4.13.1.
The ProSe packet filter set shall support packet filters based on at least any
combination of:
a) ProSe identifier;
b) the source layer-2 ID and the destination layer-2 ID; and
c) application layer ID (e.g., Station ID).
The ProSe Ethernet packet filter set is defined as content of the Ethernet
packet filter set as specified in 3GPP TS 24.501 [11] figure 9.11.4.13.4 and
table 9.11.4.13.1.
Each PC5 QoS rule additionally contains the ProSe identifier(s) when the ProSe
identifier is not included in the PC5 packet filter set.
The UE shall also pass the one or more ProSe NR frequencies associated with
the ProSe identifier of the ProSe application and the communication mode which
is set to unicast mode for the ProSe identifier to the lower layers based on
the ProSe identifier to ProSe NR frequency mapping rules for 5G ProSe
communication over PC5 as specified in clause 5.2.4.
If the 5G ProSe direct link is for direct communication between the 5G ProSe
remote UE and the 5G ProSe UE-to-network relay UE, PC5 QoS flow establishment
over the 5G ProSe direct link is performed as specified in clause 8.2.6.
### 7.2.8 PC5 QoS flow match over 5G ProSe direct link
When service data or request from the upper layers is received, the UE
determines if there is any existing PC5 QoS flow(s) matching the service data
or request, i.e., based on the PC5 QoS rules for the existing PC5 QoS flow(s).
If there is no PC5 QoS rules for the existing PC5 QoS flow(s) matching the
service data or request, the UE shall derive the PC5 QoS parameters based on
the ProSe application requirements provided by the upper layers (if available)
and the ProSe identifier(s) according to the PC5 QoS mapping rules defined in
clause 5.2.4 and shall perform the following:
a) if there is no existing PC5 QoS flow that fulfils the derived PC5 QoS
parameters, then the UE shall create a new PC5 QoS flow as specified in clause
7.2.7;
b) if there is an existing PC5 QoS flow that fulfils the derived PC5 QoS
parameters, then the UE shall update the PC5 packet filter set in the PC5 QoS
rule of this PC5 QoS flow, e.g., add the new packet filter in the PC5 QoS rule
of this existing PC5 QoS flow; and
c) the UE shall use the new PC5 QoS flow created as described in bullet a) or
the existing PC5 QoS flow with the updated PC5 QoS rules as described in
bullet b) to perform the transmission of ProSe direct communication over PC5
as specified in clause 7.2.9.
If there is a PC5 QoS rule for the existing PC5 QoS flow matching the service
data or request, the UE shall use this existing PC5 QoS flow to perform
transmission of ProSe direct communication over PC5 as specified in clause
7.2.9.
### 7.2.9 Data transmission over 5G ProSe direct link
#### 7.2.9.1 Transmission
When receiving user data from upper layers to be sent over 5G ProSe direct
link to a specific UE, the transmitting UE shall determine the 5G ProSe direct
link context corresponding to the application layer ID and then shall tag each
outgoing protocol data unit with the following information before passing it
to the lower layers for transmission:
a) a layer-3 protocol data unit type (see 3GPP TS 38.323 [16]) set to:
1) IP, if the ProSe message contains IP data;
2) Ethernet, if the ProSe message contains Ethernet data; or
3) Unstructured, if the ProSe message contains Unstructured data;
b) the PC5 link identifier associated with the 5G ProSe direct link context;
c) optionally, the source layer-2 ID set to the source layer-2 ID associated
with the 5G ProSe direct link context;
d) optionally, the destination layer-2 ID set to the destination layer-2 ID
associated with the 5G ProSe direct link context; and
e) the PQFI set to the value corresponding to the ProSe identifier and the
optional ProSe application requirements according to the mapping rules
specified in clause 5.2.4.
If the 5G ProSe direct link is for direct communication between the 5G ProSe
remote UE and the 5G ProSe UE-to-network relay UE, the association of the
ProSe application on the PC5 QoS flow over the 5G ProSe direct link is
performed as specified in clause 8.2.6.
#### 7.2.9.2 Procedure for UE to use provisioned radio resources for ProSe
communication over PC5
The procedures described for using NR-PC5 in clause 7.3.2.3 apply.
### 7.2.10 5G ProSe direct link security mode control procedure
#### 7.2.10.1 General
The 5G ProSe direct link security mode control procedure is used to establish
security between two UEs during a 5G ProSe direct link establishment procedure
or a 5G ProSe direct link re-keying procedure. Security is not established if
the UE PC5 signalling integrity protection is not activated. After successful
completion of the 5G ProSe direct link security mode control procedure, the
selected security algorithms and their non-null associate keys are used to
integrity protect and cipher all PC5 signalling messages exchanged over this
5G ProSe direct link between the UEs and the security context can be used to
protect all PC5 user plane data exchanged over this 5G ProSe direct link
between the UEs. The UE sending the PROSE DIRECT LINK SECURITY MODE COMMAND
message is called the \"initiating UE\" and the other UE is called the
\"target UE\".
#### 7.2.10.2 5G ProSe direct link security mode control procedure initiation
by the initiating UE
The initiating UE shall meet the following pre-conditions before initiating
the 5G ProSe direct link security mode control procedure:
a) the target UE has initiated a 5G ProSe direct link establishment procedure
toward the initiating UE by sending a PROSE DIRECT LINK ESTABLISHMENT REQUEST
message and:
1) the PROSE DIRECT LINK ESTABLISHMENT REQUEST message:
i) includes a target user info IE which includes the application layer ID of
the initiating UE; or
ii) does not include a target user info IE and the initiating UE is interested
in the ProSe service identified by the ProSe identifier in the PROSE DIRECT
LINK ESTABLISHMENT REQUEST message; and
2) the initiating UE:
i) if the direct communication is not between the 5G ProSe remote UE and the
5G ProSe UE-to-network relay UE has either identified an existing K~NRP~ based
on the K~NRP~ ID included in the PROSE DIRECT LINK ESTABLISHMENT REQUEST
message or derived a new K~NRP~;
ii) if the direct communication is between the 5G ProSe remote UE and the 5G
ProSe UE-to-network relay UE with the security procedure over user plane being
used, has received a new K~NRP~ according to the security procedure over user
plane as specified in 3GPP TS 33.503 [34];
iii) if the direct communication is between the 5G ProSe remote UE and the 5G
ProSe UE-to-network relay UE with the security procedure over control plane
being used, has received a new K~NR_ProSe~ according to the security procedure
over control plane as specified in 3GPP TS 33.503 [34]; or
iv) has decided not to activate security protection based on its UE 5G ProSe
direct signalling security policy and the target UE\'s 5G ProSe direct
signalling security policy; or
b) the target UE has initiated a 5G ProSe direct link re-keying procedure
toward the initiating UE by sending a PROSE DIRECT LINK REKEYING REQUEST
message and:
1) if the target UE has included a Re-authentication indication in the PROSE
DIRECT LINK REKEYING REQUEST message, the initiating UE has derived a new
K~NRP~.
When:
a) the direct communication is not between the 5G ProSe remote UE and the 5G
ProSe UE-to-network relay UE, if a new K~NRP~ has been derived by the
initiating UE; or
b) the direct communication is between the 5G ProSe remote UE and the 5G ProSe
UE-to-network relay UE, if a new K~NRP~ or K~NR_ProSe~ has been received by
the initiating UE according to the security procedure over user plane or the
security procedure over control plane, respectively, as specified in 3GPP TS
33.503 [34];
the initiating UE shall generate the 2 MSBs of K~NRP~ ID to ensure that the
resultant K~NRP~ ID will be unique in the initiating UE.
NOTE 1: If the direct communication is not between the 5G ProSe remote UE and
the 5G ProSe UE-to-network relay UE, the K~NRP~ ID holds the ID that
corresponds to K~NRP~. If the direct communication is between the 5G ProSe
remote UE and the 5G ProSe UE-to-network relay UE, the K~NRP~ ID holds the ID
that corresponds to K~NRP~ (if security procedure over user plane is used) or
K~NR_ProSe~ (if security procedure over control plane is used).
The initiating UE shall select security algorithms in accordance with its UE
5G ProSe direct signalling security policy and the target UE\'s 5G ProSe
direct signalling security policy. If the 5G ProSe direct link security mode
control procedure was triggered during a 5G ProSe direct link establishment
procedure, the initiating UE shall not select the null integrity protection
algorithm if the initiating UE or the target UE\'s 5G ProSe direct signalling
integrity protection policy is set to \"Signalling integrity protection
required\". If the 5G ProSe direct link security mode control procedure was
triggered during a 5G ProSe direct link re-keying procedure, the initiating
UE:
a) shall not select the null integrity protection algorithm if the integrity
protection algorithm currently in use for the 5G ProSe direct link is
different from the null integrity protection algorithm;
b) shall not select the null ciphering protection algorithm if the ciphering
protection algorithm currently in use for the 5G ProSe direct link is
different from the null ciphering protection algorithm;
c) shall select the null integrity protection algorithm if the integrity
protection algorithm currently in use is the null integrity protection
algorithm; and
d) shall select the null ciphering protection algorithm if the ciphering
protection algorithm currently in use is the null ciphering protection
algorithm.
Then the initiating UE shall:
a) if the direct communication is not between the 5G ProSe remote UE and the
5G ProSe UE-to-network relay UE:
1) generate a 128-bit Nonce_2 value;
2) derive K~NRP-sess~ from Nonce_1 received in the PROSE DIRECT LINK
ESTABLISHMENT REQUEST message, K~NRP~ and Nonce_2, as specified in 3GPP TS
33.536 [37]; and
3) derive the NR PC5 encryption key NRPEK and the NR PC5 integrity key NRPIK
from K~NRP-sess~ and the selected security algorithms as specified in 3GPP TS
33.536 [37];
b) if the direct communication is between the 5G ProSe remote UE and the 5G
ProSe UE-to-network relay UE and the security procedure over control plane as
specified in 3GPP TS 33.503 [34] is used:
1) derive K~relay-sess~ from K~NR_ProSe~, Nonce_2 and Nonce_1 received in the
PROSE DIRECT LINK ESTABLISHMENT REQUEST message as specified in 3GPP TS 33.503
[34]; and
2) derive the NR PC5 encryption key K~relay-enc~ and the NR PC5 integrity key
K~relay-int~ from K~relay-sess~ and the selected security algorithms as
specified in 3GPP TS 33.503 [34]; or
c) if the direct communication is between the 5G ProSe remote UE and the 5G
ProSe UE-to-network relay UE and the security procedure over user plane as
specified in 3GPP TS 33.503 [34] is used:
1) derive K~NRP-sess~ from K~NRP~, K~NRP~ freshness parameter 2 and K~NRP~
freshness parameter 1 received in the PROSE DIRECT LINK ESTABLISHMENT REQUEST
message as specified in 3GPP TS 33.503 [34]; and
2) derive the NR PC5 encryption key NRPEK and the NR PC5 integrity key NRPIK
from K~NRP-sess~ and the selected security algorithms as specified in 3GPP TS
33.503 [34]; and
d) create a PROSE DIRECT LINK SECURITY MODE COMMAND message. In this message,
the initiating UE:
1) shall include the key establishment information container IE if the 5G
ProSe direct link is not for direct communication between the 5G ProSe remote
UE and the 5G ProSe UE-to-network relay UE and a new K~NRP~ has been derived
at the initiating UE and the authentication method used to generate K~NRP~
requires sending information to complete the 5G ProSe direct link
authentication procedure;
NOTE 2: The key establishment information container is provided by upper
layers.
2) shall include the MSBs of K~NRP~ ID IE if a new K~NRP~ has been derived or
a new K~NRP~ or K~NR_ProSe~ has been received at the initiating UE;
3) shall include a Nonce_2 IE set to:
i) the 128-bit nonce value generated by the initiating UE when the direct
communication is not between the 5G ProSe remote UE and the 5G ProSe UE-to-
network relay UE;
ii) the K~NRP~ freshness parameter 2 value received by the initiating UE when
the direct communication is between the 5G ProSe remote UE and the 5G ProSe
UE-to-network relay UE with the security procedure over user plane as
specified in 3GPP TS 33.503 [34] being used; or
iii) the Nonce_2 value received by the initiating UE when the direct
communication is between the 5G ProSe remote UE and the 5G ProSe UE-to-network
relay UE with the security procedure over control plane as specified in 3GPP
TS 33.503 [34] being used;
for the purpose of session key establishment over this 5G ProSe direct link if
the selected integrity protection algorithm is not the null integrity
protection algorithm;
4) shall include the selected security algorithms;
5) shall include the UE security capabilities received from the target UE in
the PROSE DIRECT LINK ESTABLISHMENT REQUEST message or PROSE DIRECT LINK
REKEYING REQUEST message;
6) shall include the UE 5G ProSe direct signalling security policy received
from the target UE in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message;
7) shall include the LSB of K~NRP-sess~ ID chosen by the initiating UE as
specified in 3GPP TS 33.536 [37] if the selected integrity protection
algorithm is not the null integrity protection algorithm;
NOTE 3: If the direct communication is not between the 5G ProSe remote UE and
the 5G ProSe UE-to-network relay UE, the K~NRP-sess~ ID holds the ID that
corresponds to K~NRP-sess~. If the direct communication is between the 5G
ProSe remote UE and the 5G ProSe UE-to-network relay UE, the K~NRP-sess~ ID
holds the ID that corresponds to K~NRP-sess~ (if security procedure over user
plane is used) or K~relay-sess~ (if security procedure over control plane is
used).
8) shall include the GPI if received from the 5G PKMF according to the
security procedure over user plane as specified in 3GPP TS 33.503 [34], when
the direct communication is between the 5G ProSe remote UE and the 5G ProSe
UE-to-network relay UE; and
9) shall include the EAP message if received from the network according to the
security procedure over control plane as specified in 3GPP TS 33.503 [34],
when the direct communication is between the 5G ProSe remote UE and the 5G
ProSe UE-to-network relay UE.
If the security protection of this 5G ProSe direct link is activated by using
non-null integrity protection algorithm or non-null ciphering protection
algorithm, the initiating UE shall form the K~NRP-sess~ ID from the MSB of
K~NRP-sess~ ID received in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message
or PROSE DIRECT LINK REKEYING REQUEST message and the LSB of K~NRP-sess~ ID
included in the PROSE DIRECT LINK SECURITY MODE COMMAND message. The
initiating UE shall use the K~NRP-sess~ ID to identify the new security
context.
The initiating UE shall set the source layer-2 ID and destination layer-2 ID
as follows:
1) if the initiating UE is acting as a 5G ProSe layer-3 UE-to-network relay
UE, and the EAP-AKA\' based authentication method is used as specified in
clause 6.3.3.3 of 3GPP TS 33.503 [34],
the source layer-2 ID set to the source layer-2 ID used in PROSE AA MESSAGE
TRANSPORT REQUEST message, and the destination layer-2 ID set to the the
destination layer-2 ID used in PROSE AA MESSAGE TRANSPORT REQUEST message;
2) if the initiating UE is not acting as a 5G ProSe UE-to-network relay UE,
and a 5G ProSe direct link authentication procedure has been initiated:
the source layer-2 ID set to the source layer-2 ID used in PROSE DIRECT LINK
AUTHENTICATION REQUEST message, and the destination layer-2 ID set to the the
destination layer-2 ID used in PROSE DIRECT LINK AUTHENTICATION REQUEST
message;
3) otherwise, self-assign a source layer-2 ID, and the destination layer-2 ID
set to the source layer-2 ID in the PROSE DIRECT LINK ESTABLISHMENT REQUEST
message.
NOTE 4: The UE implementation ensures that any value of the self-assigned
source layer-2 ID is different from any other self-assigned source layer-2
ID(s) in use for 5G ProSe direct discovery as specified in clause 6.2.14,
clause 6.2.15 and clause 8.2.1, and is different from any other provisioned
destination layer-2 ID(s) as specified in clause 5.2.
NOTE 5: It is possible for the target UE to reuse the target UE\'s layer-2 ID
used in previous 5G ProSe direct link with the same peer UE.
After the PROSE DIRECT LINK SECURITY MODE COMMAND message is generated, the
initiating UE shall pass this message to the lower layers for transmission
along with the source layer-2 ID and the destination layer-2 ID, NRPIK (or
K~relay-int~ when applicable), NRPEK (or K~relay-enc~ when applicable) if
applicable, K~NRP-sess~ ID, the selected security algorithm as specified in TS
33.536 [37]; an indication of activation of the 5G ProSe direct signalling
security protection for the 5G ProSe direct link with the new security
context, if applicable and start timer T5089. The initiating UE shall not send
a new PROSE DIRECT LINK SECURITY MODE COMMAND message to the same target UE
while timer T5089 is running.
NOTE 6: The PROSE DIRECT LINK SECURITY MODE COMMAND message is integrity
protected (and not ciphered) at the lower layer using the new security
context.
If the 5G ProSe direct link security mode control procedure was triggered
during a 5G ProSe direct link re-keying procedure, the initiating UE shall
provide to the lower layers an indication of activation of the 5G ProSe direct
user plane security protection for the 5G ProSe direct link with the new
security context, if applicable, along with the initiating UE\'s layer-2 ID
for 5G ProSe direct communication and the target UE\'s layer-2 ID for 5G ProSe
direct communication.
Figure 7.2.10.2.1: 5G ProSe direct link security mode control procedure
#### 7.2.10.3 5G ProSe direct link security mode control procedure accepted by
the target UE
Upon receipt of a PROSE DIRECT LINK SECURITY MODE COMMAND message, if a new
assigned initiating UE\'s layer-2 ID is included and if the 5G ProSe direct
link authentication procedure has not been executed, the target UE shall
replace the original initiating UE\'s layer-2 ID with the new assigned
initiating UE\'s layer-2 ID for 5G ProSe direct communication. The target UE
shall check the selected security algorithms IE included in the PROSE DIRECT
LINK SECURITY MODE COMMAND message. If \"null integrity algorithm\" is
included in the selected security algorithms IE, the integrity protection is
not offered for this 5G ProSe direct link and the signalling messages are
transmitted unprotected. If \"null ciphering algorithm\" and an integrity
algorithm other than \"null integrity algorithm\" are included in the selected
algorithms IE, the ciphering protection is not offered for this 5G ProSe
direct link and the signalling messages are transmitted unprotected. If the
target UE\'s 5G ProSe direct signalling integrity protection policy is set to
\"Signalling integrity protection required\", the target UE shall check the
selected security algorithms IE in the PROSE DIRECT LINK SECURITY MODE COMMAND
message does not include the null integrity protection algorithm. If the
selected integrity protection algorithm is not the null integrity protection
algorithm, the target UE shall:
a) if the direct communication is not between the 5G ProSe remote UE and the
5G ProSe UE-to-network relay UE:
1) derive K~NRP-sess~ from K~NRP~, Nonce_1 and Nonce_2 received in the PROSE
DIRECT LINK SECURITY MODE COMMAND message as specified in 3GPP TS 33.536 [37];
2) derive NRPIK from K~NRP-sess~ and the selected integrity algorithm as
specified in 3GPP TS 33.536 [37]; and
3) if the K~NRP-sess~ is derived and the selected ciphering protection
algorithm is not the null ciphering protection algorithm, then the target UE
shall derive NRPEK from K~NRP-sess~ and the selected ciphering algorithm as
specified in 3GPP TS 33.536 [37]; or
b) if the direct communication is between the 5G ProSe remote UE and the 5G
ProSe UE-to-network relay UE:
1) if the security procedure over control plane as specified in 3GPP TS 33.503
[34] is used, derive K~relay-sess~ according to the security procedure over
control plane, and derive K~relay-int~ from K~relay-sess~ and the selected
integrity algorithm as specified in 3GPP TS 33.503 [34]. If the K~relay-sess~
is derived and the selected ciphering protection algorithm is not the null
ciphering protection algorithm, then the target UE shall derive K~relay-enc~
from K~relay-sess~ and the selected ciphering algorithm as specified in 3GPP
TS 33.503 [34]; or
2) if security procedure over user plane as specified in 3GPP TS 33.503 [34]
is used, derive K~NRP-sess~ according to the security procedure over user
plane, and derive NRPIK from K~NRP-sess~ and the selected integrity algorithm
as specified in 3GPP TS 33.503 [34]. If the K~NRP-sess~ is derived and the
selected ciphering protection algorithm is not the null ciphering protection
algorithm, then the target UE shall derive NRPEK from K~NRP-sess~ and the
selected ciphering algorithm as specified in 3GPP TS 33.503 [34].
The target UE shall determine whether or not the PROSE DIRECT LINK SECURITY
MODE COMMAND message can be accepted by:
a) checking that the selected security algorithms IE in the PROSE DIRECT LINK
SECURITY MODE COMMAND message does not include the null integrity protection
algorithm if the target UE\'s 5G ProSe direct signalling integrity protection
policy is set to \"Signalling integrity protection required\";
b) asking the lower layers to check the integrity of the PROSE DIRECT LINK
SECURITY MODE COMMAND message using NRPIK (or K~relay-int~ when applicable)
and the selected integrity protection algorithm, if the selected integrity
protection algorithm is not the null integrity protection algorithm;
c) checking that the received UE security capabilities have not been altered
compared to the values that the target UE sent to the initiating UE in the
PROSE DIRECT LINK ESTABLISHMENT REQUEST message or PROSE DIRECT LINK REKEYING
REQUEST message;
d) if the 5G ProSe direct link security mode control procedure was triggered
during a 5G ProSe direct link establishment procedure,
1) checking that the received UE 5G ProSe direct signalling security policy
has not been altered compared to the values that the target UE sent to the
initiating UE in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message; and
2) checking that the LSB of K~NRP-sess~ ID included in the PROSE DIRECT LINK
SECURITY MODE COMMAND message are not set to the same value as those received
from another UE in response to the target UE\'s PROSE DIRECT LINK
ESTABLISHMENT REQUEST message; and
e) if the 5G ProSe direct link security mode control procedure was triggered
during a 5G ProSe direct link re-keying procedure and the integrity protection
algorithm currently in use for the 5G ProSe direct link is different from the
null integrity protection algorithm, checking that the selected security
algorithms IE in the PROSE DIRECT LINK SECURITY MODE COMMAND message do not
include the null integrity protection algorithm.
If the target UE did not include a K~NRP~ ID in the PROSE DIRECT LINK
ESTABLISHMENT REQUEST message, the target UE included a Re-authentication
indication in the PROSE DIRECT LINK REKEYING REQUEST message or the initiating
UE has chosen to derive:
a) a new K~NRP~ if the direct communication is not between the 5G ProSe remote
UE and the 5G ProSe UE-to-network relay UE; the target UE shall derive K~NRP~
as specified in 3GPP TS 33.536 [37];
b) a new K~NRP~, if the direct communication is between the 5G ProSe remote UE
and the 5G ProSe UE-to-network relay UE and the security procedure over user
plane as specified in 3GPP TS 33.503 [34] is used, the target UE shall derive
K~NRP~ as specified in 3GPP TS 33.536 [37]; or
c) a new K~NR_ProSe~, if the direct communication is between the 5G ProSe
remote UE and the 5G ProSe UE-to-network relay UE and the security procedure
over control plane as specified in 3GPP TS 33.503 [34] is used, the target UE
shall derive K~NR_ProSe~ as specified in 3GPP TS 33.536 [37]; and
the target UE shall choose the 2 LSBs of K~NRP~ ID to ensure that the
resultant K~NRP~ ID will be unique in the target UE. The target UE shall form
K~NRP~ ID from the received MSB of K~NRP~ ID and its chosen 2 LSBs of K~NRP~
ID and shall store the complete K~NRP~ ID with K~NRP~/K~NR_ProSe~.
NOTE 1: If the direct communication is not between the 5G ProSe remote UE and
the 5G ProSe UE-to-network relay UE, the K~NRP~ ID holds the ID that
corresponds to K~NRP~. If the direct communication is between the 5G ProSe
remote UE and the 5G ProSe UE-to-network relay UE, the K~NRP~ ID holds the ID
that corresponds to K~NRP~ (if security procedure over user plane is used) or
K~NR_ProSe~ (if security procedure over control plane is used).
If the GPI is included in the PROSE DIRECT LINK SECURITY MODE COMMAND message
and the direct communication is between the 5G ProSe remote UE and the 5G
ProSe UE-to-network relay UE, the target UE shall derive the UP-PRUK and
obtain the UP-PRUK ID from the GPI, and use the UP-PRUK in deriving the
K~NRP~, according to the security procedure over user plane as specified in
3GPP TS 33.503 [34].
If the target UE accepts the PROSE DIRECT LINK SECURITY MODE COMMAND message,
the target UE shall create a PROSE DIRECT LINK SECURITY MODE COMPLETE message.
In this message, the target UE:
a) if the 5G ProSe direct link security mode control procedure was triggered
during a 5G ProSe direct link establishment procedure:
1) shall include the PQFI and the corresponding PC5 QoS parameters if the 5G
ProSe direct link is not for 5G ProSe direct communication between the 5G
ProSe remote UE and the 5G ProSe UE-to-network relay UE; or
2) may include the PQFI and the corresponding PC5 QoS parameters if the 5G
ProSe direct link is for 5G ProSe direct communication between 5G ProSe
layer-3 remote UE and 5G ProSe layer-3 UE-to-network relay UE;
NOTE 2: The PQFI and the corresponding PC5 QoS parameters are not included if
the 5G ProSe direct link is for 5G ProSe direct communication between 5G ProSe
layer-2 remote UE and 5G ProSe layer-2 UE-to-network relay UE.
b) if IP communication is used and the 5G ProSe direct link security mode
control procedure was triggered during a 5G ProSe direct link establishment
procedure, shall include an IP address configuration IE set to one of the
following values:
1) \"IPv6 router\" if only IPv6 address allocation mechanism is supported by
the target UE, i.e., acting as an IPv6 router;
2) \"DHCPv4 server\" if only IPv4 address allocation mechanism is supported by
the target UE, i.e., acting as a DHCPv4 server;
3) \"DHCPv4 server & IPv6 Router\" if both IPv4 and IPv6 address allocation
mechanism are supported by the target UE; or
4) \"address allocation not supported\" if neither IPv4 nor IPv6 address
allocation mechanism is supported by the target UE;
NOTE 3: The UE doesn\'t include an IP address configuration IE nor a link
local IPv6 address IE if Ethernet or Unstructured data unit type is used for
communication.
c) if IP communication is used, the IP address configuration IE is set to
\"address allocation not supported\" and the 5G ProSe direct link security
mode control procedure was triggered during a 5G ProSe direct link
establishment procedure, shall include a link local IPv6 address IE formed
locally based on IETF RFC 4862 [25];
d) if a new K~NRP~ was derived or a new K~NRP~ or K~NR_ProSe~ was received,
shall include the 2 LSBs of K~NRP~ ID; and
e) if the 5G ProSe direct link security mode control procedure was triggered
during a 5G ProSe direct link establishment procedure, shall include its UE 5G
ProSe direct user plane security policy for this 5G ProSe direct link. In the
case where the different ProSe services are mapped to the different 5G ProSe
direct user plane security policies, when more than one ProSe identifier is
included in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message, each of the
user plane security polices of those ProSe services shall be compatible, e.g.,
\"user plane integrity protection not needed\" and \"user plane integrity
protection required\" are not compatible.
If the selected integrity protection algorithm is not the null integrity
protection algorithm, the target UE shall form the K~NRP-sess~ ID from the MSB
of K~NRP-sess~ ID it had sent in the PROSE DIRECT LINK ESTABLISHMENT REQUEST
message or PROSE DIRECT LINK REKEYING REQUEST message and the LSB of K~NRP-
sess~ ID received in the PROSE DIRECT LINK SECURITY MODE COMMAND message. The
target UE shall use the K~NRP-sess~ ID to identify the new security context.
After the PROSE DIRECT LINK SECURITY MODE COMPLETE message is generated, the
target UE shall pass this message to the lower layers for transmission along
with the target UE\'s layer-2 ID for 5G ProSe direct communication and the
initiating UE\'s layer-2 ID for 5G ProSe direct communication, NRPIK (or
K~relay-int~ when applicable), NRPEK (or K~relay-enc~ when applicable) if
applicable, K~NRP-sess~ ID, the selected security algorithm as specified in
3GPP TS 33.536 [37] and an indication of activation of the 5G ProSe direct
signalling security protection for the 5G ProSe direct link with the new
security context, if applicable.
NOTE 4: The PROSE DIRECT LINK SECURITY MODE COMPLETE message and further 5G
ProSe direct signalling messages are integrity protected and ciphered (if
applicable) at the lower layer using the new security context.
If the 5G ProSe direct link security mode control procedure was triggered
during a 5G ProSe direct link re-keying procedure, the target UE shall provide
to the lower layers an indication of activation of the 5G ProSe direct user
plane security protection for the 5G ProSe direct link with the new security
context, if applicable, along with the initiating UE\'s layer-2 ID for 5G
ProSe direct communication and the target UE\'s layer-2 ID for 5G ProSe direct
communication.
#### 7.2.10.4 5G ProSe direct link security mode control procedure completion
by the initiating UE
Upon receiving a PROSE DIRECT LINK SECURITY MODE COMPLETE message, the
initiating UE shall stop timer T5089. If the selected integrity protection
algorithm is not the null integrity protection algorithm, the UE checks the
integrity of the PROSE DIRECT LINK SECURITY MODE COMPLETE message. If the
integrity check passes, the initiating UE shall then continue the procedure
which triggered the 5G ProSe direct link security mode control procedure. If
the selected integrity protection algorithm is the null integrity protection
algorithm, the UE continues the procedure without checking the integrity
protection.
After receiving the PROSE DIRECT LINK SECURITY MODE COMPLETE message, the
initiating UE shall delete the old security context it has for the target UE,
if any.
#### 7.2.10.5 5G ProSe direct link security mode control procedure not
accepted by the target UE
If the PROSE DIRECT LINK SECURITY MODE COMMAND message cannot be accepted, the
target UE shall send a PROSE DIRECT LINK SECURITY MODE REJECT message and the
target UE shall abort the ongoing procedure that triggered the initiation of
the 5G ProSe direct link security mode control procedure unless the ongoing
procedure is a 5G ProSe direct link establishment procedure and the Target
user info is not included in the PROSE DIRECT LINK ESTABLISHMENT REQUEST
message. The PROSE DIRECT LINK SECURITY MODE REJECT message contains a PC5
signalling protocol cause IE indicating one of the following cause values:
#5: lack of resources for 5G ProSe direct link;
#7: integrity failure;
#8: UE security capabilities mismatch;
#9: LSB of K~NRP-sess~ ID conflict;
#10: UE PC5 unicast signalling security policy mismatch;
#14: Authentication synchronisation error; or
#111: protocol error, unspecified.
If this 5G ProSe direct link security mode control procedure is triggered
during the 5G ProSe direct link establishment procedure and the
implementation-specific maximum number of established NR 5G ProSe direct links
has been reached, then the target UE shall send a PROSE DIRECT LINK SECURITY
MODE REJECT message containing PC5 signalling protocol cause value #5 \"lack
of resources for 5G ProSe direct link\".
If the PROSE DIRECT LINK SECURITY MODE COMMAND message cannot be accepted
because the 5G ProSe direct link security mode control procedure was triggered
during a 5G ProSe direct link establishment procedure, that the selected
security algorithms IE in the PROSE DIRECT LINK SECURITY MODE COMMAND message
included the null integrity protection algorithm and the target UE\'s 5G ProSe
direct signalling integrity protection policy is set to \"Signalling integrity
protection required\", the target UE shall include PC5 signalling protocol
cause #10 \"UE PC5 unicast signalling security policy mismatch\" in the PROSE
DIRECT LINK SECURITY MODE REJECT message.
If the PROSE DIRECT LINK SECURITY MODE COMMAND message cannot be accepted
because the 5G ProSe direct link security mode control procedure was triggered
during a 5G ProSe direct link re-keying procedure, the integrity protection
algorithm currently in use for the 5G ProSe direct link is different from the
null integrity protection algorithm and the selected security algorithms IE in
the PROSE DIRECT LINK SECURITY MODE COMMAND message include the null integrity
protection algorithm, the target UE, the target UE shall include PC5
signalling protocol cause #10 \"UE PC5 unicast signalling security policy
mismatch\" in the PROSE DIRECT LINK SECURITY MODE REJECT message.
If the target UE detects that the received UE security capabilities IE in the
PROSE DIRECT LINK SECURITY MODE COMMAND message has been altered compared to
the latest values that the target UE sent to the initiating UE in the PROSE
DIRECT LINK ESTABLISHMENT REQUEST message or PROSE DIRECT LINK REKEYING
REQUEST message, the target UE shall include PC5 signalling protocol cause #8
\"UE security capabilities mismatch\" in the PROSE DIRECT LINK SECURITY MODE
REJECT message.
If the target UE detects that the LSB of K~NRP-sess~ ID included in the PROSE
DIRECT LINK SECURITY MODE COMMAND message are set to the same value as those
received from another UE in response to the target UE\'s PROSE DIRECT LINK
ESTABLISHMENT REQUEST message, the target UE shall include PC5 signalling
protocol cause #9 \"LSB of K~NRP-sess~ ID conflict\" in the PROSE DIRECT LINK
SECURITY MODE REJECT message.
If the 5G ProSe direct link security mode control procedure is for direct
communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network
relay UE, and the PROSE DIRECT LINK SECURITY MODE COMMAND message cannot be
accepted due to a synchronisation error when processing the authentication
vector contained in the GPI sent by the 5G ProSe UE-to-network relay UE to the
5G ProSe remote UE, if any, the target UE shall include PC5 signalling
protocol cause #14 \"Authentication synchronisation error\" in the PROSE
DIRECT LINK SECURITY MODE REJECT message and shall include the RAND and AUTS
parameters in the PROSE DIRECT LINK SECURITY MODE REJECT message.
After the PROSE DIRECT LINK SECURITY MODE REJECT message is generated, the
target UE shall pass this message to the lower layers for transmission along
with the initiating UE\'s layer-2 ID for 5G ProSe direct communication and the
target UE\'s layer-2 ID for 5G ProSe direct communication.
Upon receipt of the PROSE DIRECT LINK SECURITY MODE REJECT message, the
initiating UE shall stop timer T5089, provide an indication to the lower layer
of deactivation of the 5G ProSe direct security protection and deletion of
security context for the 5G ProSe direct link, if applicable and:
a) if the PC5 signalling protocol cause IE in the PROSE DIRECT LINK SECURITY
MODE REJECT message is set to #9 \"LSB of K~NRP-sess~ ID conflict\",
retransmit the PROSE DIRECT LINK SECURITY MODE COMMAND message with a
different value for the LSB of K~NRP-sess~ ID and restart timer T5089;
b) if the PC5 signalling protocol cause IE in the PROSE DIRECT LINK SECURITY
MODE REJECT message is set to #14 \"Authentication synchronisation error\",
the message contained a RAND and an AUTS, and the 5G ProSe direct link
security mode control procedure is for direct communication between the 5G
ProSe remote UE and the 5G ProSe UE-to-network relay UE, may fetch a fresh GPI
from the PKMF by sending a Key Request message including RAND and AUTS as
specified in 3GPP TS 33.503 [34]; or
c) if the PC5 signalling protocol cause IE is set to the value other than #9
\"LSB of K~NRP-sess~ ID conflict\" and other than #14 \"Authentication
synchronisation error\", abort the ongoing procedure that triggered the
initiation of the 5G ProSe direct link security mode control procedure.
#### 7.2.10.6 Abnormal cases
##### 7.2.10.6.1 Abnormal cases at the initiating UE
a) Timer T5089 expires.
The initiating UE shall retransmit the PROSE DIRECT LINK SECURITY MODE COMMAND
message and restart timer T5089. After reaching the maximum number of allowed
retransmissions, the initiating UE shall abort the 5G ProSe direct link
security mode control procedure, shall provide an indication to the lower
layer of deactivation of the 5G ProSe direct security protection and deletion
of security context for the 5G ProSe direct link, if applicable and shall
abort the ongoing procedure that triggered the initiation of the 5G ProSe
direct link security mode control procedure.
NOTE 1: The maximum number of allowed retransmissions is UE implementation
specific.
b) The need to use this 5G ProSe direct link no longer exists before the 5G
ProSe direct link security mode control procedure is completed.
The initiating UE shall abort the procedure, shall provide an indication to
the lower layer of deactivation of the 5G ProSe direct security protection and
deletion of security context for the 5G ProSe direct link, if applicable and
shall abort the ongoing procedure that triggered the initiation of the 5G
ProSe direct link security mode control procedure.
c) If PROSE DIRECT LINK MODIFICATION REQUEST message or PROSE DIRECT LINK
IDENTIFIER UPDATE REQUEST message is received when the timer T5089 is running,
the initiating UE shall discard the PROSE DIRECT LINK MODIFICATION REQUEST
message or PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message.
> d) For the same 5G ProSe direct link, if PROSE DIRECT LINK RELEASE REQUEST
> message is received when the timer T5089 is running, the initiating UE shall
> stop the timer T5089, abort the 5G ProSe direct link security mode control
> procedure and proceed with the 5G ProSe direct link release procedure.
NOTE 2: The abnormal cases as described in bullet c) or d) only happen when
the 5G ProSe direct link security mode control procedure is used to establish
security between two UEs during a 5G ProSe direct link re-keying procedure.
### 7.2.11 5G ProSe direct link re-keying procedure
#### 7.2.11.1 General
The purpose of the 5G ProSe direct link re-keying procedure is to derive:
a) a new K~NRP-sess~ and, optionally, a new K~NRP~ for an existing 5G ProSe
direct link that is not between 5G ProSe remote UE and 5G ProSe UE-to-network
relay UE;
b) a new K~NRP-sess~ for an existing 5G ProSe direct link that is between 5G
ProSe remote UE and 5G ProSe UE-to-network relay UE when the security
procedure over user plane as specified in 3GPP TS 33.503 [34] is used; or
c) a new K~relay-sess~ for an existing 5G ProSe direct link that is between 5G
ProSe remote UE and 5G ProSe UE-to-network relay UE when the security
procedure over control plane as specified in 3GPP TS 33.503 [34] is used.
The UE sending the PROSE DIRECT LINK REKEYING REQUEST message is called the
\"initiating UE\" and the other UE is called the \"target UE\".
NOTE 1: There is no benefit in performing the 5G ProSe direct link re-keying
procedure when using the null integrity protection algorithm, hence it is
recommended not to trigger it when using the null integrity protection
algorithm.
#### 7.2.11.2 5G ProSe direct link re-keying procedure initiation by the
initiating UE
The initiating UE shall meet the following pre-condition before initiating the
5G ProSe direct link re-keying procedure:
a) there is a 5G ProSe direct link between the initiating UE and the target
UE; and
1) if the session key K~NRP-sess~ or K~relay-sess~ (see clause 7.2.11.1) used
to protect 5G ProSe direct link needs to be refreshed and neither timer T5089
nor T5091 are running;
2) if the UE wants to refresh K~NRP~, when the 5G ProSe direct link is not
between 5G ProSe remote UE and 5G ProSe UE-to-network relay UE, and neither
timer T5089 nor T5091 are running; or
3) if the lower layers indicate that a 5G ProSe direct link re-keying
procedure needs to be performed.
In order to initiate the 5G ProSe direct link re-keying procedure, the
initiating UE shall create a PROSE DIRECT LINK REKEYING REQUEST message. In
this message, the initiating UE:
a) shall include the Key establishment information container IE if the 5G
ProSe direct link is not for direct communication between the 5G ProSe remote
UE and the 5G ProSe UE-to-network relay UE and the null integrity protection
algorithm is not in use;
NOTE 1: The key establishment information container is provided by upper
layers.
b) shall include a Nonce_1 IE set to the 128-bit nonce value generated by the
initiating UE for the purpose of session key refresh over this 5G ProSe direct
link if the null integrity protection algorithm is not in use;
c) shall include its UE security capabilities indicating the list of
algorithms that the initiating UE supports for the re-keying of this 5G ProSe
direct link;
d) shall include the MSB of K~NRP-sess~ ID or the MSB of K~relay-sess~ ID (see
clause 7.2.11.1) chosen by the initiating UE as specified in 3GPP TS 33.503
[34] if the null integrity protection algorithm is not in use;
NOTE 2: The MSB of K~NRP-sess~ ID IE in the PROSE DIRECT LINK REKEYING REQUEST
message is used to hold the value of MSB of K~NRP-sess~ ID or MSB of K~relay-
sess~ ID.
e) may include a Re-authentication indication if the initiating UE wants to
derive a new K~NRP~ and the 5G ProSe direct link re-keying procedure is not
between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE;
NOTE 3: When the 5G ProSe direct link re-keying procedure is between the 5G
ProSe remote UE and the 5G ProSe UE-to-network relay UE, the Re-authentication
indication is not included because a new K~NRP~ is always derived according to
the security procedure over user plane or the security procedure over control
plane as specified in 3GPP TS 33.503 [34].
f) shall include the User security key ID IE set to:
1) UP-PRUK ID of the initiating UE if:
i) the UE has a valid UP-PRUK;
ii) the 5G ProSe direct link re-keying procedure is between the 5G ProSe
remote UE and the 5G ProSe UE-to-network relay UE; and
iii) the security procedure over user plane as specified in 3GPP TS 33.503
[34] is used; or
2) CP-PRUK ID of the initiating UE that is associated with the relay service
code of the target UE if:
i) the UE has a valid CP-PRUK associated with the relay service code of the
target UE;
ii) the 5G ProSe direct link re-keying procedure is between the 5G ProSe
remote UE and the 5G ProSe UE-to-network relay UE; and
iii) the security procedure over control plane as specified in 3GPP TS 33.503
[34] is used; and
g) shall include the HPLMN ID of the 5G ProSe Remote UE if the UP-PRUK ID is
included and is not in NAI format (see 3GPP TS 33.503 [34]).
After the PROSE DIRECT LINK REKEYING REQUEST message is generated, the
initiating UE shall pass this message to the lower layers for transmission
along with the initiating UE\'s layer-2 ID for unicast communication and the
target UE\'s layer-2 ID for unicast communication and start timer T5091. The
UE shall not send a new PROSE DIRECT LINK REKEYING REQUEST message to the same
target UE while timer T5091 is running.
NOTE 4: In order to ensure successful 5G ProSe direct link re-keying, T5091
should be set to a value larger than the sum of T5092 and T5089.
Figure 7.2.11.2.1: 5G ProSe direct link re-keying procedure
#### 7.2.11.3 5G ProSe direct link re-keying procedure accepted by the target
UE
Upon receipt of a PROSE DIRECT LINK REKEYING REQUEST message, if the PROSE
DIRECT LINK REKEYING REQUEST message includes a Re-authentication indication,
the target UE shall derive a new K~NRP~. This may require performing one or
more 5G ProSe direct link authentication procedures as specified in clause
7.2.12.
NOTE: How many times the 5G ProSe direct link authentication procedure needs
to be performed to derive a new K~NRP~ depends on the authentication method
used.
Then the target UE shall initiate a 5G ProSe direct link security mode control
procedure as specified in in clause 7.2.10, where if the 5G ProSe direct link
re-keying procedure is sent from the 5G ProSe remote UE to the 5G ProSe UE-to-
network relay UE, the target UE shall proceed to establish a new K~NRP~ or
K~NR_ProSe~ according to the security procedure over user plane or the
security procedure over control plane, respectively, as specified in 3GPP TS
33.503 [34].
Upon successful completion of the 5G ProSe direct link security mode control
procedure, the target UE shall create a PROSE DIRECT LINK REKEYING RESPONSE
message.
After the PROSE DIRECT LINK REKEYING RESPONSE message is generated, the target
UE shall pass this message to the lower layers for transmission along with the
initiating UE\'s layer-2 ID for unicast communication and the target UE\'s
layer-2 ID for unicast communication.
#### 7.2.11.4 5G ProSe direct link re-keying procedure completion by the
initiating UE
Upon receipt of the PROSE DIRECT LINK REKEYING RESPONSE message, the
initiating UE shall stop timer T5091 and check the integrity of the PROSE
DIRECT LINK REKEYING RESPONSE message using the new NRPIK.
After receiving the PROSE DIRECT LINK REKEYING RESPONSE message, the
initiating UE shall delete the old security context it has for the target UE.
#### 7.2.11.5 Abnormal cases at the initiating UE
The following abnormal cases can be identified:
a) Timer T5091 expires.
The initiating UE shall retransmit the PROSE DIRECT LINK REKEYING REQUEST
message and restart timer T5091. After reaching the maximum number of allowed
retransmissions, the initiating UE shall abort the 5G ProSe direct link re-
keying procedure, shall provide an indication of deactivation of the PC5
unicast security protection and deletion of security context for the 5G ProSe
direct link to the lower layer, if applicable, along with the initiating UE\'s
layer-2 ID for unicast communication and the target UE\'s layer-2 ID for
unicast communication and may initiate the 5G ProSe direct link release
procedure.
NOTE: The maximum number of allowed retransmissions is UE implementation
specific.
b) The need to use this 5G ProSe direct link no longer exists before the 5G
ProSe direct link re-keying procedure is completed.
The initiating UE shall abort the procedure and shall provide an indication of
deactivation of the PC5 unicast security protection and deletion of security
context for the 5G ProSe direct link to the lower layer, if applicable, along
with the initiating UE\'s layer-2 ID for unicast communication and the target
UE\'s layer-2 ID for unicast communication.
c) For the same 5G ProSe direct link, if the initiating UE receives a PROSE
DIRECT LINK IDENTIFIER UPDATE REQUEST message after initiating the 5G ProSe
direct link re-keying procedure, the initiating UE shall stop the timer T5091,
abort the 5G ProSe direct link re-keying procedure and proceed with the 5G
ProSe direct link identifier update procedure.
### 7.2.12 5G ProSe direct link authentication procedure
#### 7.2.12.1 General
The 5G ProSe direct link authentication procedure is used to perform mutual
authentication of UEs establishing a 5G ProSe direct link and to derive a new
K~NRP~ shared between two UEs during a 5G ProSe direct link establishment
procedure or a 5G ProSe direct link re-keying procedure. After successful
completion of the 5G ProSe direct link authentication procedure, the new
K~NRP~ is used for security establishment during the 5G ProSe direct link
security mode control procedure as specified in clause 7.2.10. The UE sending
the PROSE DIRECT LINK AUTHENTICATION REQUEST message is called the
\"initiating UE\" and the other UE is called the \"target UE\".
NOTE: The 5G ProSe direct link authentication procedure is applicable for
neither 5G ProSe layer-3 UE-to-network relay nor 5G ProSe layer-2 UE-to-
network relay.
#### 7.2.12.2 5G ProSe direct link authentication procedure initiation by the
initiating UE
The initiating UE shall meet one of the following pre-conditions when
establishing the non-null signalling integrity protection based on the
decision of the initiating UE, before initiating the 5G ProSe direct link
authentication procedure:
a) the target UE has initiated a 5G ProSe direct link establishment procedure
toward the initiating UE by sending a PROSE DIRECT LINK ESTABLISHMENT REQUEST
message and:
1) the PROSE DIRECT LINK ESTABLISHMENT REQUEST message:
i) includes a target user info IE which includes the application layer ID of
the initiating UE; or
ii) does not include a target user info IE and the initiating UE is interested
in the ProSe service identified by the ProSe identifier in the PROSE DIRECT
LINK ESTABLISHMENT REQUEST message; and
2) the K~NRP~ ID is not included in the PROSE DIRECT LINK ESTABLISHMENT
REQUEST message or the initiating UE does not have an existing K~NRP~ for the
K~NRP~ ID included in PROSE DIRECT LINK ESTABLISHMENT REQUEST message or the
initiating UE derives a new K~NRP~; or
b) the target UE has initiated a 5G ProSe direct link re-keying procedure
toward the initiating UE by sending a PROSE DIRECT LINK REKEYING REQUEST
message and the PROSE DIRECT LINK REKEYING REQUEST message includes a Re-
authentication indication.
In order to initiate the 5G ProSe direct link authentication procedure, the
initiating UE shall create a PROSE DIRECT LINK AUTHENTICATION REQUEST message.
In this message, the initiating UE:
a) shall include the key establishment information container IE.
NOTE 1: The Key establishment information container is provided by upper
layers.
The initiating UE shall self-assign a source layer-2 ID, and the destination
layer-2 ID set to the source layer-2 ID in the PROSE DIRECT LINK ESTABLISHMENT
REQUEST message.
NOTE 2: The UE implementation ensures that any value of the self-assigned
source layer-2 ID is different from any other self-assigned source layer-2
ID(s) in use for 5G ProSe direct discovery as specified in clause 6.2.14,
clause 6.2.15 and clause 8.2.1 and is different from any other provisioned
destination layer-2 ID(s) as specified in clause 5.2.
NOTE 3: It is possible for the target UE to reuse the target UE\'s layer-2 ID
used in previous 5G ProSe direct link with the same peer UE.
After the PROSE DIRECT LINK AUTHENTICATION REQUEST message is generated, the
initiating UE shall pass this message to the lower layers for transmission
along with the initiating UE\'s layer-2 ID for unicast communication and the
target UE\'s layer-2 ID for unicast communication.
The initiating UE shall start timer T5092. The UE shall not send a new PROSE
DIRECT LINK AUTHENTICATION REQUEST message to the same target UE while timer
T5092 is running.
Figure 7.2.12.2.1: 5G ProSe direct link authentication procedure
#### 7.2.12.3 5G ProSe direct link authentication procedure accepted by the
target UE
Upon receipt of a PROSE DIRECT LINK AUTHENTICATION REQUEST message, if a new
assigned initiating UE\'s layer-2 ID is included, the target UE shall replace
the original initiating UE\'s layer-2 ID with the new assigned initiating
UE\'s layer-2 ID for unicast communication. If the target UE determines that
the PROSE DIRECT LINK AUTHENTICATION REQUEST message can be accepted, the
target UE shall create a PROSE DIRECT LINK AUTHENTICATION RESPONSE message.
The target UE shall check if the number of established 5G ProSe direct links
is less than the implementation-specific maximum number of established NR 5G
ProSe direct links allowed in the UE at a time. In this message, the target
UE:
a) shall include the Key establishment information container IE.
NOTE: The key establishment information container is provided by upper layers.
After the PROSE DIRECT LINK AUTHENTICATION RESPONSE message is generated, the
target UE shall pass this message to the lower layers for transmission along
with the target UE\'s layer-2 ID for unicast communication and the initiating
UE\'s layer-2 ID for unicast communication.
#### 7.2.12.4 5G ProSe direct link authentication procedure completion by the
initiating UE
Upon receiving a PROSE DIRECT LINK AUTHENTICATION RESPONSE message, if the
initiating UE determines that the PROSE DIRECT LINK AUTHENTICATION RESPONSE
message can be accepted, the initiating UE shall stop timer T5092.
NOTE: When the initiating UE derives the new K~NRP~ during the 5G ProSe direct
link authentication procedure depends on the authentication method in use.
#### 7.2.12.5 5G ProSe direct link authentication procedure not accepted by
the target UE
If the PROSE DIRECT LINK AUTHENTICATION REQUEST message cannot be accepted,
the target UE shall create a PROSE DIRECT LINK AUTHENTICATION REJECT message.
In this message, the target UE shall include a PC5 signalling protocol cause
IE indicating one of the following cause values:
#5: lack of resources for 5G ProSe direct link;
#6: authentication failure.
If this 5G ProSe direct link authentication procedure is triggered during the
5G ProSe direct link establishment procedure and the implementation-specific
maximum number of established NR 5G ProSe direct links has been reached, then
the target UE shall send a PROSE DIRECT LINK AUTHENTICATION REJECT message
containing PC5 signalling protocol cause value #5 \"lack of resources for 5G
ProSe direct link\".
After the PROSE DIRECT LINK AUTHENTICATION REJECT message is generated, the
target UE shall pass this message to the lower layers for transmission along
with the initiating UE\'s layer-2 ID for unicast communication and the target
UE\'s layer-2 ID for unicast communication.
The target UE shall abort the ongoing procedure that triggered the initiation
of the 5G ProSe direct link authentication procedure if the ongoing procedure
is the 5G ProSe direct link establishment procedure and the target user info
is included in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message.
Upon receipt of the PROSE DIRECT LINK AUTHENTICATION REJECT message, the
initiating UE shall stop timer T5092 and abort the ongoing procedure that
triggered the initiation of the 5G ProSe direct link authentication procedure.
#### 7.2.12.6 5G ProSe direct link authentication procedure not accepted by
the initiating UE
If the PROSE DIRECT LINK AUTHENTICATION RESPONSE message cannot be accepted,
the initiating UE shall stop timer T5092 and create a PROSE DIRECT LINK
AUTHENTICATION FAILURE message. In this message, the initiating UE may include
the Key establishment information container IE if provided by upper layers.
After the PROSE DIRECT LINK AUTHENTICATION FAILURE message is generated, the
initiating UE shall pass this message to the lower layers for transmission
along with the initiating UE\'s layer-2 ID for unicast communication and the
target UE\'s layer-2 ID for unicast communication.
The initiating UE shall abort the ongoing procedure that triggered the
initiation of the 5G ProSe direct link authentication procedure.
Upon receipt of the PROSE DIRECT LINK AUTHENTICATION FAILURE message, the
target UE shall abort the ongoing procedure that triggered the initiation of
the 5G ProSe direct link authentication procedure and shall indicate to upper
layers that authentication has failed.
#### 7.2.12.7 Abnormal cases
##### 7.2.12.7.1 Abnormal cases at the initiating UE
a) Timer T5092 expires.
The initiating UE shall retransmit the PROSE DIRECT LINK AUTHENTICATION
REQUEST message and restart timer T5092. After reaching the maximum number of
allowed retransmissions, the initiating UE shall abort the 5G ProSe direct
link authentication procedure and shall abort the ongoing procedure that
triggered the initiation of the 5G ProSe direct link authentication procedure.
NOTE 1: The maximum number of allowed retransmissions is UE implementation
specific.
b) The need to use this 5G ProSe direct link no longer exists before the 5G
ProSe direct link authentication procedure is completed.
The initiating UE shall abort the 5G ProSe direct link authentication
procedure and shall abort the ongoing procedure that triggered the initiation
of the 5G ProSe direct link authentication procedure.
c) For the same 5G ProSe direct link, if the initiating UE receives a PROSE
DIRECT LINK RELEASE REQUEST message during the 5G ProSe direct link
authentication procedure, the initiating UE shall stop all running timers for
this 5G ProSe direct link, abort the 5G ProSe direct link authentication
procedure and proceed with the 5G ProSe direct link release procedure.
NOTE 2: The abnormal cases as described in bullet c) only happens when the 5G
ProSe direct link authentication procedure is used to perform mutual
authentication of UEs during a 5G ProSe direct link re-keying procedure.
## 7.3 Broadcast mode 5G ProSe direct communication over PC5
### 7.3.1 Overview
This clause describes the 5G ProSe communication over PC5 reference point in
broadcast mode operation. The UE is configured with the related information as
described in clause 5.2.4.
### 7.3.2 Transmission of broadcast mode 5G ProSe communication over PC5
#### 7.3.2.1 Initiation
##### 7.3.2.1.1 Broadcast mode 5G ProSe communication over PC5 triggered by
upper layers
When the UE is requested by upper layers to send data unit(s) of a ProSe
application identified by a ProSe identifier using 5G ProSe communication over
PC5, the request from the upper layers includes:
a) the data unit(s) of the ProSe application;
b) the ProSe identifier of the ProSe application for the data unit(s);
c) the type of data in the data unit(s) (i.e., IP, Ethernet, Address
Resolution Protocol, or Unstructured);
d) optionally the communication mode which is set to broadcast mode; and
e) optionally the 5G ProSe application requirements (e.g., priority
requirement, reliability requirement, delay requirement).
Upon a request from upper layers to send data unit(s) of a ProSe application
identified by a ProSe identifier using 5G ProSe communication over PC5, the UE
passes the one or more ProSe NR frequencies associated with the ProSe
identifier based on the ProSe identifier to ProSe NR frequency mapping rules
for 5G ProSe communication over PC5 as specified in clause 5.2.4 and the
communication mode which is set to broadcast mode for the data unit(s) to the
lower layers.
Upon a request from upper layers to send data unit(s) of a ProSe application
identified by a ProSe identifier using 5G ProSe communication over PC5, the UE
determines the NR Tx profiles based on the list of ProSe identifiers to NR Tx
profiles for broadcast and groupcast mapping rules as specified in clause
5.2.4 and passes the NR Tx profiles to the lower layers as specified in clause
7.3.2.2. Additionally, when the UE is not served by NG-RAN, the UE also passes
the configured PC5 DRX configuration as specified in clause 5.2.4 to the lower
layers.
The UE shall maintain a list of ProSe services the UE is interested in,
including the ProSe services in use, the ProSe services that the UE is
interested for transmission or both, for each destination layer-2 ID. The
ProSe services are identified by the ProSe identifiers.
NOTE: How the UE maintains the list of ProSe services the UE is interested in
is left to UE implementation.
Then, if:
a) the following conditions are met:
1) the UE is served by NG-RAN for 5G ProSe communication;
2) the UE intends to use the radio resources (i.e., carrier frequency)
provided by a serving cell;
3) the registered PLMN is in the list of PLMNs in which the UE is authorized
to use 5G ProSe communication over PC5 when the UE is served by NG-RAN for 5G
ProSe communication over PC5 as specified in clause 5.2.4; and
4) the ProSe identifier of the ProSe application is included in the list of
ProSe applications authorized for 5G ProSe communication over PC5 as specified
in clause 5.2.4; or
b) the following conditions are met:
1) the UE is:
i) not served by NG-RAN for 5G ProSe communication over PC5;
ii) in limited service state as specified in 3GPP TS 23.122 [14], if the
reason for the UE being in limited service state is one of the following:
A) the UE is unable to find a suitable cell in the selected PLMN as specified
in 3GPP TS 38.304 [15];
B) the UE received a REGISTRATION REJECT message or a SERVICE REJECT message
with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501
[11]; or
C) the UE received a REGISTRATION REJECT message or a SERVICE REJECT message
with the 5GMM cause #7 \"5GS services not allowed\" as specified in 3GPP TS
24.501 [11]; or
iii) in limited service state as specified in 3GPP TS 23.122 [14] for reasons
other than A), B) or C) above and located in a geographical area for which the
UE is provisioned with \"non-operator managed\" radio parameters as specified
in clause 5.2.4;
2) the UE is authorized to use 5G ProSe communication over PC5 when the UE is
not served by NG-RAN for 5G ProSe communication as specified in clause 5.2.4;
and
3) the ProSe identifier of the ProSe application is included in the list of
ProSe applications authorized for 5G ProSe communication over PC5 as specified
in clause 5.2.4;
then the UE shall proceed as specified in clause 7.3.2.1.2, else the UE shall
not perform transmission of 5G ProSe communication over PC5.
##### 7.3.2.1.2 PC5 QoS flow match and establishment
In order to determine if any existing PC5 QoS flow matches the request from
upper layers, UE shall proceed as follows:
a) according to the PC5 QoS mapping rules specified in clause 5.2.4, the UE
shall use the PC5 QoS parameters corresponding to the ProSe identifier and
optionally 5G ProSe application requirements;
b) according to the ProSe identifier to destination layer-2 ID for broadcast
mapping rules specified in clause 5.2.4, the UE shall use the destination
layer-2 ID corresponding to the ProSe identifier;
c) if there is no existing context for the destination layer-2 ID, then:
1) build a new context for the destination layer-2 ID;
2) self-assign a new source layer-2 ID; and
NOTE: The UE implementation ensures that the value of the self-assigned source
layer-2 ID is different from any other self-assigned source layer-2 ID(s) in
use for 5G ProSe direct discovery as specified in clause 6.2.14, clause 6.2.15
and clause 8.2.1 and is different from any other provisioned destination
layer-2 ID(s) as specified in clause 5.2.
3) pass the source layer-2 ID and the destination layer-2 ID to lower layers.
d) if in the context for the destination layer-2 ID, there is no PC5 QoS rule
for the existing PC5 QoS flow(s) matching the service data or request, the UE
shall derive the PC5 QoS parameters based on the 5G ProSe application
requirements provided by the upper layers (if available) and the ProSe
identifier according to the PC5 QoS mapping rules defined in clause 5.2.4 and
shall perform the following:
1) if there is no existing PC5 QoS flow that fulfils the derived PC5 QoS
parameters, then the UE shall create a new PC5 QoS flow by performing the
following operations:
i) self-assign a new PQFI;
ii) create a new PC5 QoS flow context which contains:
A) the PQFI;
B) the ProSe identifier(s); and
C) the derived PC5 QoS parameters;
iii) create a new PC5 QoS rule which contains:
A) a PC5 QoS rule identifier;
B) the PQFI;
C) a set of packet filters; and
D) a precedence value; and
iv) pass the following parameters to the lower layers:
A) the PQFI;
B) the PC5 QoS parameters;
C) the source layer-2 ID and the destination layer-2 ID; and
D) the NR Tx profile, if available, as determined for the respective ProSe
identifier based on the list of ProSe identifiers to NR Tx profiles for
broadcast and groupcast mapping rules as specified in clause 5.2.4;
2) if there is an existing PC5 QoS flow that fulfils the derived PC5 QoS
parameters, then the UE shall update the PC5 packet filter set in the PC5 QoS
rule of this PC5 QoS flow, e.g. add the new packet filter in the PC5 QoS rule
of this existing PC5 QoS flow; and
3) the UE shall use the new PC5 QoS flow created as described in bullet 1) or
the existing PC5 QoS flow with the updated PC5 QoS rules as described in
bullet 2) to perform the transmission of 5G ProSe communication over PC5 as
specified in clause 7.3.2.2; and
e) if in the context for the destination layer-2 ID, there is a PC5 QoS rule
for the existing PC5 QoS flow matching the service data or request, the UE
shall use this existing PC5 QoS flow to perform transmission of 5G ProSe
communication over PC5 as specified in clause 7.3.2.2.
Three types of packet filters are supported for broadcast mode 5G ProSe direct
communication over PC5, i.e., the ProSe IP packet filter set, the ProSe packet
filter set and the ProSe Ethernet packet filter set. The three types of packet
filters are defined the same as specified in clause 7.2.7.
#### 7.3.2.2 Transmission
The UE shall include the data unit(s) in a protocol data unit with the
following parameters:
a) a layer-3 protocol data unit type (see 3GPP TS 38.323 [16]) set to:
1) IP, if the data unit(s) contains IP data;
2) Ethernet, if the data unit(s) contains Ethernet data;
3) Address Resolution Protocol, if the data unit(s) contains Address
Resolution Protocol data; or
4) Unstructured, if the data unit(s) contains Unstructured data;
b) the source layer-2 ID set to the layer-2 ID self-assigned by the UE for 5G
ProSe communication over PC5 as specified in clause 7.3.2.1.2;
c) the destination layer-2 ID set to the destination layer-2 ID associated
with the ProSe identifier of the ProSe application in this list of ProSe
applications authorized for 5G ProSe communication over PC5 as specified in
clause 5.2.4;
d) if the data unit(s) contains IP data, the source IP address set to the
source IP address allocated to the UE as specified in clause 7.3.4;
NOTE: How to set the destination IP address is left to UE implementation.
e) the PQFI set to the value corresponding to the PC5 QoS rules as specified
in clause 7.3.2.1, and
f) the NR Tx profile based on the ProSe identifiers to NR Tx profiles for
broadcast and groupcast mapping rules as specified in clause 5.2.4. If the
list of ProSe services the UE is interested in for the destination layer-2 ID
changes, the UE shall provide all the NR Tx profiles for the ProSe
identifier(s) in the list of ProSe services the UE is interested in for the
destination layer-2 ID to the lower layers,
then UE shall request radio resources for 5G ProSe communication over PC5 as
specified in 3GPP TS 38.300 [21] and pass the data unit(s) on the PC5 QoS Flow
identified by the PQFI to lower layers for transmission. The PC5 QoS Rules
corresponding to the PQFIs map the data unit(s) with the same ProSe identifier
and with the same PC5 QoS parameters to the same PC5 QoS Flow and apply PQFI
to the data unit(s).
If the UE is camped on a serving cell indicating that 5G ProSe communication
over PC5 is supported by the network, but not broadcasting any carrier
frequencies and radio resources for 5G ProSe communication over PC5 as
specified in 3GPP TS 38.331 [13], the UE shall request radio resources for 5G
ProSe communication over PC5 as specified in 3GPP TS 24.501 [11].
#### 7.3.2.3 Procedure for UE to use provisioned radio resources for 5G ProSe
communication over PC5
When the UE is not served by NG-RAN for 5G ProSe communication and is
authorized to use 5G ProSe communication over PC5, the UE shall identify the
NR-PC5 to be used for 5G ProSe communication over PC5. After identifying NR-
PC5 to be used for 5G ProSe communication over PC5, the UE shall select the
corresponding radio parameters to be used for 5G ProSe communication over PC5
as follows:
a) if the UE can determine itself located in a geographical area and the UE is
provisioned with radio parameters for the geographical area, the UE shall
select the radio parameters associated with that geographical area; or
b) in all other cases, the UE shall not initiate 5G ProSe communication over
PC5.
If the UE intends to use \"non-operator managed\" radio parameters as
specified in clause 5.2.4, the UE shall initiate 5G ProSe communication over
PC5 with the selected radio parameters.
If the UE intends to use \"operator managed\" radio parameters as specified in
clause 5.2.4, before initiating 5G ProSe communication over PC5, the UE shall
check with lower layers whether the selected radio parameters can be used in
the current location without causing interference to other cells as specified
in 3GPP TS 38.331 [13]; and:
a) if the lower layers indicate that the usage would not cause any
interference, the UE shall initiate 5G ProSe communication over PC5; or
NOTE: If the lower layers find that there exists a cell operating the
provisioned radio resources (i.e., carrier frequency) and the cell belongs to
the registered PLMN or a PLMN equivalent to the registered PLMN and the UE is
authorized for 5G ProSe communication over PC5 in this PLMN, the UE can use
the radio parameters indicated by the cell as specified in 3GPP TS 38.331
[13].
b) else if the lower layers report that one or more PLMNs operate in the
provisioned radio resources (i.e., carrier frequency) then:
1) if the following conditions are met:
i) none of the PLMNs reported by the lower layers is the registered PLMN or
equivalent to the registered PLMN;
ii) at least one of the PLMNs reported by the lower layers is in the list of
authorized PLMNs for 5G ProSe communication over PC5 and provides radio
resources for 5G ProSe communication over PC5 as specified in 3GPP TS 38.331
[13]; and
iii) the UE does not have an emergency PDU session;
then the UE shall:
i) if in 5GMM-IDLE mode, perform PLMN selection triggered by 5G ProSe
communication over PC5 as specified in 3GPP TS 23.122 [14]; or
ii) else if in 5GMM-CONNECTED mode, either:
A) perform a De-registration procedure as specified in 3GPP TS 24.501 [11] and
then perform PLMN selection triggered by 5G ProSe communication over PC5 as
specified in 3GPP TS 23.122 [14]; or
B) not initiate 5G ProSe communication over PC5.
Whether the UE performs i) or ii) above is left up to UE implementation; or
2) else the UE shall not initiate 5G ProSe communication over PC5.
If the registration to the selected PLMN is successful, the UE shall proceed
with the procedure to initiate 5G ProSe communication over PC5 as specified in
clause 7.3.2.1.
If the UE is performing 5G ProSe communication over PC5 using radio parameters
associated with a geographical area and moves out of that geographical area,
the UE shall stop performing 5G ProSe communication over PC5 and then:
a) if the UE is not served by NG-RAN for 5G ProSe communication over PC5 or
the UE intends to use radio resources for 5G ProSe communication over PC5
other than those operated by the serving cell, the UE shall select appropriate
radio parameters for the new geographical area as specified above; or
b) if the UE is served by NG-RAN for 5G ProSe communication over PC5 and
intends to use radio resources for 5G ProSe communication over PC5 operated by
the serving cell, the UE shall proceed with the procedure to initiate 5G ProSe
communication over PC5 when served by NG-RAN for 5G ProSe communication over
PC5.
#### 7.3.2.4 Privacy of 5G ProSe transmission over PC5
Upon initiating transmission of 5G ProSe communication over PC5, if:
a) the ProSe identifier of a ProSe application requesting transmission of 5G
ProSe communication over PC5 is in the list of ProSe applications which
require privacy for 5G ProSe communication over PC5 as specified in clause
5.2.4; and
b) the UE is located in a geographical area in which this ProSe application
requires privacy for 5G ProSe communication over PC5 as specified in clause
5.2.4, or the UE is not provisioned any geographical areas in which this ProSe
applications requires privacy for 5G ProSe communication over PC5,
then the UE shall proceed as follows:
a) if timer T5100 is not running, start timer T5100 and set its timer value as
the privacy timer value as specified in clause 5.2.4;
b) upon:
1) getting an indication from upper layers that the application layer
identifier has been changed; or
2) timer T5100 expiry,
then:
1) change the value of the source layer-2 ID self-assigned by the UE for the
5G ProSe communication over PC5;
NOTE 1: The UE implementation ensures that the value of the self-assigned
source layer-2 ID is different from any other self-assigned source layer-2
ID(s) in use for 5G ProSe direct discovery as specified in clause 6.2.14,
clause 6.2.15 and clause 8.2.1 and is different from any other provisioned
destination layer-2 ID(s) as specified in clause 5.2.
2) if the data unit(s) contains IP data, change the value of the source IP
address self-assigned by the UE for 5G ProSe communication over PC5;
NOTE 2: How to change and randomise the UE\'s source layer-2 ID and source IP
address including IP prefix (if used) is specified in clause 5.5 of 3GPP TS
33.536 [37] with the consideration of replacing V2X with 5G ProSe.
3) provide an indication to upper layers that the source layer-2 ID, or the
source IP address, or both the source layer-2 ID and the source IP address are
changed;
4) pass the changed source layer-2 ID and destination layer-2 ID, along with
the corresponding PQFI down to the lower layer;
5) restart timer T5100; and
6) upon stopping transmission of the 5G ProSe communication over PC5, stop
timer T5100.
### 7.3.3 Reception of broadcast mode 5G ProSe communication over PC5
The UE may be configured by upper layers with one or more destination layer-2
ID(s) for reception of data unit(s) over PC5.
The UE shall maintain a list of ProSe services the UE is interested in,
including the ProSe services in use, ProSe services that the UE is interested
for reception or both, for each destination layer-2 ID. The ProSe services are
identified by the ProSe identifiers.
NOTE 1: How the UE maintains the list of ProSe services it is interested in is
left to UE implementation.
The receiving UE shall determine the PC5 QoS parameters for this broadcast
ProSe service in the same way described in clause 7.3.2.1.2 and shall
determine the NR Tx profile as described in clause 5.2.4, and shall provide
the PC5 QoS parameters, the NR Tx profile and the destination layer-2 ID(s) to
lower layers. If the list of ProSe services the UE is interested in for the
destination layer-2 ID changes, the receiving UE shall update the lower layers
for the NR Tx Profiles information by providing all the NR Tx profiles for the
ProSe identifier(s) in the list of ProSe services the UE is interested in for
the destination layer-2 ID to the lower layers.
For each received protocol data unit over PC5, the receiving UE shall check if
the destination layer-2 ID of the received protocol data unit matches one of
the configured destination layer-2 IDs. If yes, the UE shall then check
whether the protocol data unit type as defined 3GPP TS 38.323 [16] provided by
the lower layers for the received packet is set to IP, Ethernet, Address
Resolution Protocol or Unstructured and pass the protocol data unit to the
corresponding upper layer entity.
NOTE 2: When the PC5 DRX operation is needed based on the provided NR Tx
profile, the lower layers use PC5 QoS parameters and the destination layer-2
ID(s) to determine the PC5 DRX parameter values (see 3GPP TS 38.300 [21]) for
reception operation over PC5 reference point.
### 7.3.4 IP address allocation for broadcast mode 5G ProSe communication over
PC5
When the UE needs to perform 5G ProSe communication over PC5 reference point
in broadcast mode operation and the type of data in the data unit is IP, the
UE:
a) for IPv4,
1) shall use the pre-configured link local IPv4 address as source address; or
2) shall use dynamic configuration of IPv4 link-local addresses as specified
in IETF RFC 3927 [38] if there is no pre-configured link local IPv4 address;
and
b) for IPv6,
1) shall auto-configure a link local IPv6 address following procedures defined
in IETF RFC 4862 [25]; and
2) may use this IP address for direct communication without sending Neighbour
Solicitation and Neighbour Advertisement message for Duplicate Address
Detection.
## 7.4 Groupcast mode 5G ProSe direct communication over PC5
### 7.4.1 Overview
This clause describes the 5G ProSe communication over PC5 reference point in
groupcast mode operation. The UE is configured with the related information as
described in clause 5.2.4. For commercial services, the application layer
group ID is provided by application server. For public safety services, the
pre-configured or provisioned application layer group ID as described in
clause 5.2.4 will be used for groupcast communication.
### 7.4.2 Transmission of groupcast mode 5G ProSe communication over PC5
#### 7.4.2.1 Initiation
##### 7.4.2.1.1 Initiation of forming a group
Before the UE is requested by upper layers to send data unit(s) of a ProSe
application identified by a ProSe identifier using 5G ProSe communication over
PC5, for the users sharing the same application layer group ID as configured
in clause 5.2.4 may perform a group member discovery procedure as specified in
clause 6.2.15.
When the group is formed, the following information may be exchanged within
the group members included in the application layer discovery message:
a) group size; and
b) member ID.
NOTE: Whether to transmit the application layer discovery message as metadata
in a 5G ProSe direct discovery message or as user traffic over PC5 is UE
implementation specific.
##### 7.4.2.1.2 Requirements for 5G ProSe direct communication over PC5
The requirements for groupcast mode 5G ProSe direct communication over PC5 is
the same as described in clause 7.3.2.1.1, with the following additions:
a) When the UE is requested by upper layers to send data unit(s) of a ProSe
application identified by a ProSe identifier using 5G ProSe communication over
PC5, the request from the upper layers includes:
1) the application layer group ID;
2) the group size and the member IDs;
3) the range requirement; or
4) the communication mode which is set to groupcast mode.
##### 7.4.2.1.3 PC5 QoS flow match and establishment
The PC5 QoS flow match and establishment for groupcast mode 5G ProSe direct
communication over PC5 is the same as described in clause 7.3.2.1.2, with the
following modifications:
a) The UE shall determine the destination layer-2 ID as:
1) if no application layer group ID is provided by the application layer, then
according to the mapping rules specified in clause 5.2.4, the UE shall set the
destination layer-2 ID to the destination layer-2 ID corresponding to the
ProSe identifier as specified in clause 5.2.4;
2) if application layer group ID is provided by the application layer and
there is a context for the application layer group ID as specified in clause
5.2.4, then UE shall set the destination layer-2 ID to the ProSe layer-2 group
ID in the context; and
3) if application layer group ID is provided by the application layer and
there is no context for the application layer group ID as specified in clause
5.2.4, then the UE shall convert the application layer group ID into a
destination layer-2 ID as following:
i) to use the group identifier as the input to the SHA-256 hashing algorithm
as specified in ISO/IEC 10118-3:2018 [28]; and
ii) to use the 24 least significant bits of the 256 bits of the output as
destination layer-2 ID; and
NOTE: SHA-256 hashing algorithm is implemented in the ME.
b) If there is no existing context for the destination layer-2 ID and optional
group identifier, the UE shall proceed as:
1) to establish a new context for the destination layer-2 ID and optional
group identifier;
2) self-assign a new source layer-2 ID; and
3) to pass the source/destination layer-2 IDs, optional group size and
optional member IDs to lower layers.
#### 7.4.2.2 Transmission
The transmission of groupcast mode 5G ProSe direct communication over PC5 is
same as described in clause 7.3.2.2, with the following additions:
a) If group identifier is provided, then the destination layer-2 ID shall be
set to the destination layer-2 ID in the context for the group identifier as
specified in clause 7.4.2.1.3.
#### 7.4.2.3 Procedure for UE to use provisioned radio resources for 5G ProSe
direct communication over PC5
The procedures described in clause 7.3.2.3 apply.
#### 7.4.2.4 Privacy of 5G ProSe direct transmission over PC5
The procedures described in clause 7.3.2.4 apply with the following additions:
a) using the privacy timer T5200 for groupcast; and
b) how to change and randomise the UE\'s source layer-2 ID and source IP
address including IP prefix (if used) is specified in clause 5.4 of 3GPP TS
33.536 [37] with the consideration of replacing V2X with 5G ProSe.
### 7.4.3 Reception of groupcast mode 5G ProSe direct communication over PC5
The reception of groupcast mode 5G ProSe direct communication over PC5 is the
same as described in clause 7.3.3, with the following additions:
a) besides the configured destination layer-2 ID(s) for receiving messages
over PC5, the UE shall also derive the destination layer-2 ID(s) based on
group identifier(s) if provided by upper layers as specified in clause
7.4.2.1.
### 7.4.4 IP address allocation for groupcast mode 5G ProSe communication over
PC5
When the UE needs to perform 5G ProSe communication over PC5 reference point
in groupcast mode operation and the type of data in the data unit is IP, the
UE uses the same IP address allocation mechanism as specified in clause 7.3.4.
## 7.5 Void
### 7.5.1 Void
### 7.5.2 Void
### 7.5.3 Void
## 7.6 PC3ach control protocol for 5G ProSe direct communication
### 7.6.1 Transport protocol for PC3ach control protocol for 5G ProSe direct
communication
The UE and 5G DDNMF CTF (ADF) shall use HTTP 1.1 as specified in IETF RFC 7231
[4] as the transport protocol for messages transmitted over the PC3ach
interface. The 5G ProSe messages described here shall be included in the body
of either an HTTP request message or an HTTP response message.
### 7.6.2 Procedures for PC3ach control protocol for 5G ProSe direct
communication
#### 7.6.2.1 Usage information report list sending procedure
##### 7.6.2.1.1 General
The purpose of the usage information report list sending procedure is to
enable a 5G ProSe-enabled UE to provide information necessary for composing of
charging events related to the 5G ProSe direct communication as defined in
3GPP TS 32.277 [45].
The UE shall perform the usage information report list sending procedure with
the Accounting Data Forwarding (ADF) function block of the Charging Trigger
Function (CTF) in the 5G DDNMF (5G DDNMF CTF (ADF)) residing in the HPLMN.
The UE shall construct the usage information report based on the configuration
described in clause 5.2.
##### 7.6.2.1.2 Usage information report list sending procedure initiation
The UE shall perform the usage information report list sending procedure if
the UE is in NG-RAN coverage and if:
a) the following is true:
1) the configured collection period has elapsed, either since the beginning of
5G ProSe direct communication (if it is the first usage information report
list sending procedure performed after the beginning of 5G ProSe direct
communication) or since the end of the previous usage information report list
sending procedure;
2) the configured reporting window has not elapsed after the configured
collection period elapsed;
3) the UE is in the RRC_CONNECTED mode (see 3GPP TS 38.300 [21]); and
4) the UE has usage information for at least one collection period; or
b) the following is true:
1) the configured collection period has elapsed, either since the beginning of
5G ProSe direct communication (if it is the first usage information report
list sending procedure performed after the beginning of 5G ProSe direct
communication) or since the end of the previous usage information report list
sending procedure;
2) the configured reporting window has elapsed after the configured collection
period elapsed; and
3) the UE has usage information for at least one collection period.
The UE shall initiate the usage information report list sending procedure by
sending a PROSE_USAGE_INFORMATION_REPORT_LIST message to the 5G DDNMF CTF
(ADF).
If the UE is configured with the address of the 5G DDNMF CTF (ADF) for
uploading the usage information reports, the UE shall send the
PROSE_USAGE_INFORMATION_REPORT_LIST message to the configured address of the
5G DDNMF CTF (ADF). If the UE is not configured with the address of the 5G
DDNMF CTF (ADF) for uploading the usage information reports, the UE shall send
the PROSE_USAGE_INFORMATION_REPORT_LIST message to the IP address of the 5G
DDNMF discovered as described in clause 6.1.2.2.
In the PROSE_USAGE_INFORMATION_REPORT_LIST message, the UE:
a) shall include a new transaction ID;
b) for each collection period:
1) shall include a sequence number of the usage information report;
2) if the UE is configured to report the time stamps when it went in and out
of NG-RAN coverage during the collection period in the usage information, for
each going in or out of NG-RAN coverage:
i) shall include the information of whether the UE was in or out of NG-RAN
coverage;
ii) shall include the time stamp of the move; and
iii) if the UE was in NG-RAN coverage and the UE is configured to report the
list of locations of the UE when in NG-RAN coverage during the collection
period in the usage information, for each camping on a cell or usage of a cell
in the 5GMM-CONNECTED mode:
A) shall include the NG-RAN cell global identification of the cell; and
B) shall include the time stamp of beginning of the camping on the cell or of
beginning of the usage of the cell in the 5GMM-CONNECTED mode;
3) in case of broadcast and groupcast mode 5G ProSe direct communication, for
each group identified by ProSe layer-2 group ID:
i) if the UE is configured to report the group parameters in the usage
information, shall include the ProSe layer-2 group ID, ProSe group IP
multicast address, the IP address used by the UE as a source IP address, and
the layer-2 ID used by the UE as a source layer-2 ID;
ii) if the UE transmitted data during the collection period and the UE is
configured to report the time stamps of the first transmission/reception
during the collection period in the usage information, shall include the time
stamp of the first transmission to the ProSe Group IP multicast address in the
collection period;
iii) if the UE received data during the collection period and the UE is
configured to report the time stamps of the first transmission/reception
during the collection period in the usage information, shall include the time
stamp of the first reception from the ProSe Group IP multicast address in the
collection period;
iv) for each transmitter in groupcast mode 5G ProSe direct communication,
shall include the source layer-2 ID and IP address of the transmitter;
v) if the UE is configured to report the amount of data transmitted during the
collection period with location information in the usage information, per each
in or out of NG-RAN coverage period and per each NG-RAN cell used when in NG-
RAN coverage:
A) shall indicate whether the data are sent in or out of NG-RAN coverage;
B) if the UE transmitted data in an NG-RAN cell during an in NG-RAN coverage
period:
\- shall include the NG-RAN cell global identification of the NG-RAN cell;
\- shall include the amount of data transmitted in the NG-RAN cell;
\- if the UE is configured to report the time stamps of the first
transmission/reception during the collection period in the usage information,
shall include time stamp of the first transmission in the NG-RAN cell; and
\- if the UE is configured to report the radio parameters used for 5G ProSe
direct communication during the reporting period in the usage information,
shall include the indicator of which radio resources were used and radio
frequency used; and
C) if the UE transmitted data during out of NG-RAN coverage period:
\- shall include the amount of data transmitted during the out of NG-RAN
coverage period;
\- if the UE is configured to report the time stamps of the first
transmission/reception during the collection period in the usage information,
shall include time stamp of the first transmission during the out of NG-RAN
coverage period; and
\- if the UE is configured to report the radio parameters used for 5G ProSe
direct communication during the reporting period in the usage information,
shall include the used radio frequency;
vi) if the UE is configured to report the amount of data transmitted during
the collection period without location information in the usage information,
per each in or out of NG-RAN coverage period:
A) shall indicate whether the data are sent in or out of NG-RAN coverage;
B) if the UE transmitted data during in NG-RAN coverage period:
\- shall include the amount of data transmitted during the in NG-RAN coverage
period;
\- if the UE is configured to report the time stamps of the first
transmission/reception during the collection period in the usage information,
shall include time stamp of the first transmission during the in NG-RAN
coverage period; and
\- if the UE is configured to report the radio parameters used for 5G ProSe
direct communication during the reporting period in the usage information,
shall include the indicator of which radio resources were used and radio
frequency used; and
C) if the UE transmitted data during out of NG-RAN coverage period:
\- shall include the amount of data transmitted during the out of NG-RAN
coverage period;
\- if the UE is configured to report the time stamps of the first
transmission/reception during the collection period in the usage information,
shall include time stamp of the first transmission during the out of NG-RAN
coverage period; and
\- if the UE is configured to report the radio parameters used for 5G ProSe
direct communication during the reporting period in the usage information,
shall include the used radio frequency;
vii) if the UE is configured to report the amount of data received during the
collection period with location information in the usage information, per each
in or out of NG-RAN coverage period and per each NG-RAN cell used when in NG-
RAN coverage:
A) shall indicate whether the data are received in or out of NG-RAN coverage;
B) if the UE received data in an NG-RAN cell during an in NG-RAN coverage
period:
\- shall include the NG-RAN cell global identification of the NG-RAN cell;
\- shall include the amount of data received in the NG-RAN cell;
\- if the UE is configured to report the time stamps of the first
transmission/reception during the collection period in the usage information,
shall include time stamp of the first reception in the NG-RAN cell; and
\- if the UE is configured to report the radio parameters used for 5G ProSe
direct communication during the reporting period in the usage information,
shall include the indicator of which radio resources were used and radio
frequency used; and
C) if the UE received data during out of NG-RAN coverage period:
\- shall include the amount of data received during the out of NG-RAN coverage
period;
\- if the UE is configured to report the time stamps of the first
transmission/reception during the collection period in the usage information,
shall include time stamp of the first reception during the out of NG-RAN
coverage period; and
\- if the UE is configured to report the radio parameters used for 5G ProSe
direct communication during the reporting period in the usage information,
shall include the used radio frequency;
viii) if the UE is configured to report the amount of data received during the
collection period without location information in the usage information, per
each in or out of NG-RAN coverage period:
A) shall indicate whether the data are received in or out of NG-RAN coverage;
B) if the UE received data during in NG-RAN coverage period:
\- shall include the amount of data received during the in NG-RAN coverage
period;
\- if the UE is configured to report the time stamps of the first
transmission/reception during the collection period in the usage information,
shall include time stamp of the first reception during the in NG-RAN coverage
period; and
\- if the UE is configured to report the radio parameters used for 5G ProSe
direct communication during the reporting period in the usage information,
shall include the indicator of which radio resources were used and radio
frequency used; and
C) if the UE received data during out of NG-RAN coverage period:
\- shall include the amount of data received during the out of NG-RAN coverage
period;
\- if the UE is configured to report the time stamps of the first
transmission/reception during the collection period in the usage information,
shall include time stamp of the first reception during the out of NG-RAN
coverage period; and
\- if the UE is configured to report the radio parameters used for 5G ProSe
direct communication during the reporting period in the usage information,
shall include the used radio frequency; and
ix) if the UE is configured to report QoS flow information, per each QoS flow
identified by the PQFI:
A) if the UE transmitted the QoS flow during the collection period:
\- shall include the time stamp for start of transmission of the QoS flow in
the collection period;
\- shall include the time stamp for end of transmission of the QoS flow in the
collection period;
\- shall include the (initial) PC5 QoS parameters of the QoS flow in the
collection period as specified in clause 10.6.4.2;
\- shall include the amount of data of the QoS flow transmitted with the
(initial) PC5 QoS parameters in the collection period; and
\- if the PC5 QoS parameters of the QoS flow were changed during the
collection period, shall include the time stamp for start of transmission of
the QoS flow with the new PC5 QoS parameters, the new PC5 QoS parameters of
the QoS flow as specified in clause 10.6.4.2, and the amount of data of the
QoS flow transmitted with the new PC5 QoS parameters in the collection period;
or
B) if the UE received the QoS flow during the collection period:
\- shall include the time stamp for start of reception of the QoS flow in the
collection period;
\- shall include the time stamp for end of reception of the QoS flow in the
collection period;
\- shall include the (initial) PC5 QoS parameters of the QoS flow in the
collection period as specified in clause 10.6.4.2;
\- shall include the amount of data of the QoS flow received with the
(initial) PC5 QoS parameters in the collection period; and
\- if the PC5 QoS parameters of the QoS flow were changed during the
collection period, shall include the time stamp for start of reception of the
QoS flow with the new PC5 QoS parameters, the new PC5 QoS parameters of the
QoS flow as specified in clause 10.6.4.2, and the amount of data of the QoS
flow received with the new PC5 QoS parameters in the collection period;
4) in case of unicast mode 5G ProSe direct communication, for each 5G ProSe
direct communication identified by the source layer-2 ID and destination
layer-2 ID for unicast communication:
i) shall include the IP address used by the UE as a source IP address, and the
layer-2 ID used by the UE as a source layer-2 ID;
ii) if the UE transmitted data during the collection period and the UE is
configured to report the time stamps of the first transmission/reception
during the collection period in the usage information, shall include the time
stamp of the first transmission in the 5G ProSe direct communication in the
collection period;
iii) if the UE received data during the collection period and the UE is
configured to report the time stamps of the first transmission/reception
during the collection period in the usage information, shall include the time
stamp of the first reception in the 5G ProSe direct communication in the
collection period;
iv) for each transmitter in unicast mode 5G ProSe direct communication not
between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE, shall
include the source layer-2 ID and IP address of the transmitter, target
layer-2 ID and IP address of the receiver;
v) for each transmitter in unicast mode 5G ProSe direct communication between
5G ProSe the remote UE and the 5G ProSe UE-to-network relay UE, shall include
the source layer-2 ID and IP address of the transmitter, layer-2 ID and IP
address of 5G ProSe UE-to-network relay UE;
vi) if the UE is configured to report the amount of data transmitted during
the collection period with location information in the usage information, per
each in or out of NG-RAN coverage period and per each NG-RAN cell used when in
NG-RAN coverage:
A) shall indicate whether the data are sent in or out of NG-RAN coverage;
B) if the UE transmitted data in an NG-RAN cell during an in NG-RAN coverage
period:
\- shall include the NG-RAN cell global identification of the NG-RAN cell;
\- shall include the amount of data transmitted in the NG-RAN cell;
\- if the UE is configured to report the time stamps of the first
transmission/reception during the collection period in the usage information,
shall include time stamp of the first transmission in the NG-RAN cell; and
\- if the UE is configured to report the radio parameters used for 5G ProSe
direct communication during the reporting period in the usage information,
shall include the indicator of which radio resources were used and radio
frequency used; and
C) if the UE transmitted data during out of NG-RAN coverage period:
\- shall include the amount of data transmitted during the out of NG-RAN
coverage period;
\- if the UE is configured to report the time stamps of the first
transmission/reception during the collection period in the usage information,
shall include time stamp of the first transmission during the out of NG-RAN
coverage period; and
\- if the UE is configured to report the radio parameters used for 5G ProSe
direct communication during the reporting period in the usage information,
shall include the used radio frequency;
vii) if the UE is configured to report the amount of data transmitted during
the collection period without location information in the usage information,
per each in or out of NG-RAN coverage period:
A) shall indicate whether the data are sent in or out of NG-RAN coverage;
B) if the UE transmitted data during in NG-RAN coverage period:
\- shall include the amount of data transmitted during the in NG-RAN coverage
period;
\- if the UE is configured to report the time stamps of the first
transmission/reception during the collection period in the usage information,
shall include time stamp of the first transmission during the in NG-RAN
coverage period; and
\- if the UE is configured to report the radio parameters used for 5G ProSe
direct communication during the reporting period in the usage information,
shall include the indicator of which radio resources were used and radio
frequency used; and
C) if the UE transmitted data during out of NG-RAN coverage period:
\- shall include the amount of data transmitted during the out of NG-RAN
coverage period; and
\- if the UE is configured to report the time stamps of the first
transmission/reception during the collection period in the usage information,
shall include time stamp of the first transmission during the out of NG-RAN
coverage period;
\- if the UE is configured to report the radio parameters used for 5G ProSe
direct communication during the reporting period in the usage information,
shall include the used radio frequency;
viii) if the UE is configured to report the amount of data received during the
collection period with location information in the usage information, per each
in or out of NG-RAN coverage period and per each NG-RAN cell used when in NG-
RAN coverage:
A) shall indicate whether the data are received in or out of NG-RAN coverage;
B) if the UE received data in an NG-RAN cell during an in NG-RAN coverage
period:
\- shall include the NG-RAN cell global identification of the NG-RAN cell;
\- shall include the amount of data received in the NG-RAN cell;
\- if the UE is configured to report the time stamps of the first
transmission/reception during the collection period in the usage information,
shall include time stamp of the first reception in the NG-RAN cell; and
\- if the UE is configured to report the radio parameters used for 5G ProSe
direct communication during the reporting period in the usage information,
shall include the indicator of which radio resources were used and radio
frequency used; and
C) if the UE received data during out of NG-RAN coverage period:
\- shall include the amount of data received during the out of NG-RAN coverage
period;
\- if the UE is configured to report the time stamps of the first
transmission/reception during the collection period in the usage information,
shall include time stamp of the first reception during the out of NG-RAN
coverage period; and
\- if the UE is configured to report the radio parameters used for 5G ProSe
direct communication during the reporting period in the usage information,
shall include the used radio frequency;
ix) if the UE is configured to report the amount of data received during the
collection period without location information in the usage information, per
each in or out of NG-RAN coverage period:
A) shall indicate whether the data are received in or out of NG-RAN coverage;
B) if the UE received data during in NG-RAN coverage period:
\- shall include the amount of data received during the in NG-RAN coverage
period;
\- if the UE is configured to report the time stamps of the first
transmission/reception during the collection period in the usage information,
shall include time stamp of the first reception during the in NG-RAN coverage
period; and
\- if the UE is configured to report the radio parameters used for 5G ProSe
direct communication during the reporting period in the usage information,
shall include the indicator of which radio resources were used and radio
frequency used; and
C) if the UE received data during out of NG-RAN coverage period:
\- shall include the amount of data received during the out of NG-RAN coverage
period;
\- if the UE is configured to report the time stamps of the first
transmission/reception during the collection period in the usage information,
shall include time stamp of the first reception during the out of NG-RAN
coverage period; and
\- if the UE is configured to report the radio parameters used for 5G ProSe
direct communication during the reporting period in the usage information,
shall include the used radio frequency;
x) if the UE acts as a 5G ProSe UE-to-network relay UE, per each NG-RAN cell
used during the 5G ProSe direct communication between the 5G ProSe remote UE
and the 5G ProSe UE-to-network relay UE:
A) shall include the NG-RAN cell global identification of the NG-RAN cell;
B) shall include the amount of data relayed by the UE;
C) shall include time stamp of the first data relay via the UE in the NG-RAN
cell; and
D) if the UE is configured to report the radio parameters used for 5G ProSe
direct communication during the reporting period in the usage information,
shall include the indicator of which radio resources were used and the radio
frequency used; and
xi) if the UE is configured to report QoS flow information, per each QoS flow
identified by the PQFI:
A) if the UE transmitted the QoS flow during the collection period:
\- shall include the time stamp for start of transmission of the QoS flow in
the collection period;
\- shall include the time stamp for end of transmission of the QoS flow in the
collection period;
\- shall include the (initial) PC5 QoS parameters of the QoS flow in the
collection period as specified in clause 10.6.4.2;
\- shall include the amount of data of the QoS flow transmitted with the
(initial) PC5 QoS parameters in the collection period; and
\- if the PC5 QoS parameters of the QoS flow were changed during the
collection period, shall include the time stamp for start of transmission of
the QoS flow with the new PC5 QoS parameters, the new PC5 QoS parameters of
the QoS flow as specified in clause 10.6.4.2, and the amount of data of the
QoS flow transmitted with the new PC5 QoS parameters in the collection period;
or
B) if the UE received the QoS flow during the collection period:
\- shall include the time stamp for start of reception of the QoS flow in the
collection period;
\- shall include the time stamp for end of reception of the QoS flow in the
collection period;
\- shall include the (initial) PC5 QoS parameters of the QoS flow in the
collection period as specified in clause 10.6.4.2;
\- shall include the amount of data of the QoS flow received with the
(initial) PC5 QoS parameters in the collection period; and
\- if the PC5 QoS parameters of the QoS flow were changed during the
collection period, shall include the time stamp for start of reception of the
QoS flow with the new PC5 QoS parameters, the new PC5 QoS parameters of the
QoS flow as specified in clause 10.6.4.2, and the amount of data of the QoS
flow received with the new PC5 QoS parameters in the collection period; and
5) if configured radio parameters for the 5G ProSe direct communication
applicable in the geographical area of the UE were used during the collection
period, shall include the configured radio parameters for the 5G ProSe direct
communication applicable in the geographical area of the UE; and
c) for each application specific data received from upper layers during the
collection period, shall include the received application specific data.
Figure 7.6.2.1.2.1 illustrates the interaction of the UE and the 5G DDNMF CTF
(ADF) in the usage information report list sending procedure.
Figure 7.6.2.1.2.1: Usage information report list sending procedure
##### 7.6.2.1.3 Usage information report list sending procedure accepted by
the 5G DDNMF
Upon receiving a PROSE_USAGE_INFORMATION_REPORT_LIST message from UE, the 5G
DDNMF CTF (ADF) triggers one or more charging data requests according to 3GPP
TS 32.277 [45].
If the PROSE_USAGE_INFORMATION_REPORT_LIST message is accepted by the 5G DDNMF
CTF (ADF), the 5G DDNMF CTF (ADF) shall send a
PROSE_USAGE_INFORMATION_REPORT_LIST_RESPONSE message to the UE, containing a
\ element with transaction ID set to the value of the
transaction ID included in the PROSE_USAGE_INFORMATION_REPORT_LIST message.
##### 7.6.2.1.4 Usage information report list sending procedure successful
completion by the UE
Upon receipt of the PROSE_USAGE_INFORMATION_REPORT_LIST_RESPONSE message
containing a \ element with transaction ID set to the value
of the transaction ID included in the PROSE_USAGE_INFORMATION_REPORT_LIST
message, the usage information report list sending procedure is successfully
completed.
##### 7.6.2.1.5 Usage information report list sending procedure not accepted
by the 5G DDNMF
If the PROSE_USAGE_INFORMATION_REPORT_LIST message is not accepted by the 5G
DDNMF CTF (ADF), the 5G DDNMF CTF (ADF) shall send a
PROSE_USAGE_INFORMATION_REPORT_LIST_RESPONSE message to the UE. In the
PROSE_USAGE_INFORMATION_REPORT_LIST_RESPONSE message, the 5G DDNMF CTF (ADF):
1) shall include a \ element with transaction ID set to the
value of the transaction ID included in the
PROSE_USAGE_INFORMATION_REPORT_LIST message; and
2) shall include appropriate cause value.
##### 7.6.2.1.6 Usage information report list sending procedure unsuccessful
completion by the UE
Upon receipt of the PROSE_USAGE_INFORMATION_REPORT_LIST_RESPONSE message
containing a \ element with transaction ID set to the value
of the transaction ID included in the PROSE_USAGE_INFORMATION_REPORT_LIST
message, the usage information report list sending procedure is unsuccessfully
completed.
If the PROSE_USAGE_INFORMATION_REPORT_LIST_RESPONSE message contains the cause
value set to #3 \"Invalid message format\", the UE shall not perform the usage
information report list sending procedure until the UE powers off and powers
on again or the USIM is removed.
# 8 5G ProSe UE-to-network relay
## 8.1 Overview
This clause describes the procedures for 5G ProSe UE-to-network relay. The UE
is configured with the related information as described in clause 5.2.5.
## 8.2 Procedures
### 8.2.1 UE-to-network relay discovery over PC5 interface
#### 8.2.1.1 General
This clause describes the procedures for both layer-3 and layer-2 UE-to-
network relay discovery for public safety use and commercial services at a
ProSe-enabled UE over the PC5 interface. The purpose of the UE-to-network
relay discovery procedure over PC5 interface is to enable a ProSe-enabled UE
to detect and identify another ProSe-enabled UE over PC5 interface for UE-to-
network relay communication between a UE and 5GC.
NOTE 1: Relaying Multicast/Broadcast Service traffic to a 5G ProSe remote UE
by a 5G ProSe UE-to-network relay is not supported in this release of the
specification.
A UE-to-network relay supporting multiple relay service codes can advertise
the relay service codes using multiple discovery messages, with one relay
service code per discovery message.
The following principles for 5G ProSe UE-to-network relay apply when the 5G
ProSe UE-to-network relay UE or the 5G ProSe remote UE is in service area
restriction as defined in clause 5.3.5 of 3GPP TS 24.501 [11]:
a) in non-allowed area of its serving PLMN, the 5G ProSe layer-3 UE-to-network
relay UE is not allowed to perform relay operations (e.g., UE-to-network relay
discovery as specified in clause 8.2.1, or accept the 5G ProSe direct link
establishment procedure as specified in clause 7.2.2) except for e.g. high
priority access as defined in clause 5.3.5 of 3GPP TS 24.501 [11] based on
relay service codes as specified in clause 5.2.5;
b) service area restriction is not applicable to the 5G ProSe layer-3 remote
UE;
c) in non-allowed area of its serving PLMN, the 5G ProSe layer-2 UE-to-network
relay UE is not allowed to perform relay operations (e.g., UE-to-network relay
discovery as specified in clause 8.2.1, or accept the 5G ProSe direct link
establishment procedure as specified in clause 7.2.2); and
d) in non-allowed area of its serving PLMN, the 5G ProSe layer-2 remote UE
follows the same principles of service area restrictions as specified in
clause 5.3.5 of 3GPP TS 24.501 [11] for communication with the network via the
5G ProSe layer-2 UE-to-network relay UE, taking into account the TAI in the
RRC container received from the 5G ProSe layer-2 UE-to-network relay UE.
NOTE 2: Closed access group information is not specified for 5G ProSe.
NOTE 3: Principles of operation for emergency services (incl. exceptions from
mobility restrictions) are not specified in this release of the specification.
The following principles for 5G ProSe UE-to-network relay apply when the relay
UE or the 5G ProSe remote UE is in 5GS forbidden tracking areas as defined in
clause 5.3.13 of 3GPP TS 24.501 [11]:
a) in a 5GS forbidden tracking area of its serving PLMN, the 5G ProSe UE-to-
network relay UE is not allowed to perform relay operations; and
b) in a 5GS forbidden tracking area of its serving PLMN, the 5G ProSe remote
UE is not allowed to access the network via the 5G ProSe UE-to-network relay
UE, taking into account the TAI in the RRC container received from the 5G
ProSe layer-2 UE-to-network relay UE.
To perform UE-to-network relay discovery over PC5 interface, the UE is
configured with the related information as described in clause 5.2.5. The
following models for UE-to-network relay discovery procedure over PC5
interface as specified in 3GPP TS 23.304 [2] are supported:
a) Model A uses a single discovery protocol message (Announcement); and
b) Model B uses two discovery protocol messages (Solicitation and Response).
NOTE 4: If the UE is authorized to perform both 5G ProSe UE-to-network relay
discovery Model A and 5G ProSe UE-to-network relay discovery Model B, it is up
to UE implementation to select which model to perform or perform both models
simultaneously.
The 5G ProSe UE-to-network relay UE and 5G ProSe layer-3 remote UE may use the
PC5 DRX mechanism to perform 5G ProSe UE-to-network relay discovery over PC5
interface when the UE is not served by NG-RAN as specified in clause 5.2.5.
The following procedures are defined for UE-to-network relay discovery
procedure over PC5 interface:
a) UE-to-network relay discovery over PC5 interface with Model A:
1) Announcing UE procedure for UE-to-network relay discovery initiation;
2) Announcing UE procedure for UE-to-network relay discovery completion;
3) Monitoring UE procedure for UE-to-network relay discovery initiation;
4) Monitoring UE procedure for UE-to-network relay discovery completion;
5) Announcing UE procedure for UE-to-network relay discovery additional
information; and
6) Monitoring UE procedure for UE-to-network relay discovery additional
information; and
b) UE-to-network relay discovery over PC5 interface with Model B:
1) Discoverer UE procedure for UE-to-network relay discovery initiation;
2) Discoverer UE procedure for UE-to-network relay discovery completion;
3) Discoveree UE procedure for UE-to-network relay discovery initiation; and
4) Discoveree UE procedure for UE-to-network relay discovery completion.
#### 8.2.1.2 UE-to-network relay discovery over PC5 interface with model A
##### 8.2.1.2.1 General
In this procedure, the 5G ProSe UE-to-network relay UE acts as an \"announcing
UE\" and the 5G ProSe remote UE acts as a \"monitoring UE\".
##### 8.2.1.2.2 Announcing UE relay discovery for UE-to-network relay
discovery
###### 8.2.1.2.2.1 General
The purpose of the announcing UE procedure for UE-to-network relay discovery
is:
a) to enable a ProSe-enabled UE to announce availability of a connectivity
service provided by a UE-to-network relay of the ProSe-enabled UE to other
ProSe-enabled UEs, upon a request from upper layers as defined in 3GPP TS
23.304 [2]; or
b) to enable a ProSe-enabled UE to measure the PROSE PC5 DISCOVERY message
signal strength between the ProSe-enabled UE and the 5G ProSe UE-to-network
relay UE(s) for relay selection/reselection.
###### 8.2.1.2.2.2 Announcing UE procedure for UE-to-network relay discovery
initiation
The UE is authorised to perform the announcing UE procedure for UE-to-network
relay discovery if:
a) the UE is authorised to act as a UE-to-network relay in the PLMN indicated
by the serving cell as specified in clause 5.2.5, and
1) the UE is served by NG-RAN and the UE is authorised to perform 5G ProSe
direct discovery in the PLMN as specified in clause 5; or
2) the UE is authorised to perform 5G ProSe direct discovery when not served
by NG-RAN as specified in clause 5 and intends to use the provisioned radio
resources for UE-to-network relay discovery;
b) the UE is configured with:
1) the relay service code parameter identifying the connectivity service to be
announced as specified in clause 5.2.5 and the indicated security procedure
for the relay service code is supported by the UE. For 5G ProSe layer-3 UE-to-
network relay UE,
i) the S-NSSAI associated with that relay service code shall belong to the
allowed NSSAI of the UE; and
ii) if the UE is camped on a cell whose TAI is in the list of \"non-allowed
tracking areas\" or is camped on a cell whose TAI is not in the list of
\"allowed tracking areas\", then the relay service code shall be associated
with high priority access as defined in clause 5.3.5 of 3GPP TS 24.501 [11];
and
2) the User info ID for the UE-to-network relay discovery parameter as
specified in clause 5.2.5;
c) for 5G ProSe layer-3 UE-to-network relay UE, the UE is configured with PDU
Session parameters which is used for relayed traffic for the associated relay
service code, as specified in clause 5.2.5; and
d) the back-off timer T3346 used for NAS mobility management congestion
control as specified in clause 5.3.9 of 3GPP TS 24.501 [11] is not running at
the UE;
otherwise, the UE is not authorised to perform the announcing UE procedure for
UE-to-network relay discovery.
Figure 8.2.1.2.2.2.1 illustrates the interaction of the UEs in the announcing
UE procedure for UE-to-network relay discovery.
Figure 8.2.1.2.2.2.1: Announcing UE procedure for UE-to-network relay
discovery
When the UE is triggered by an upper layer application to announce
availability of a connectivity service provided by a UE-to-network relay, if
the UE is authorised to perform the announcing UE procedure for UE-to-network
relay discovery, then the UE:
a) if the UE is served by NG-RAN and the UE in 5GMM-IDLE mode needs to request
resources for sending PROSE PC5 DISCOVERY messages for relay discovery as
specified in 3GPP TS 38.331 [13], shall perform a service request procedure or
mobility registration procedure as specified in 3GPP TS 24.501 [11];
b) shall obtain a valid UTC time for the discovery transmission from the lower
layers and generate the UTC-based counter corresponding to this UTC time as
specified in clause 11.2.5;
c) shall generate a PROSE PC5 DISCOVERY message for UE-to-network relay
discovery announcement according to clause 10.2.1. In the PROSE PC5 DISCOVERY
message for UE-to-network relay discovery announcement, the UE:
1) shall set the announcer info parameter to the User info ID configured for
the UE-to-network relay discovery, as specified in clause 5.2.5;
2) shall set the relay service code parameter to the relay service code
configured for the connectivity service to be announced, as specified in
clause 5.2.5;
3) shall include the MIC field computed as described in 3GPP TS 33.503 [34],
by using the UTC-based counter and the DUIK contained in the \ element of the PROSE_SECURITY_PARAM_RESPONSE
message;
4) shall set the UTC-based counter LSB parameter to the 4 least significant
bits of the UTC-based counter;
5) shall set the Resource Status Indicator bit of the status indicator
parameter to indicate whether or not the UE has resources available to provide
a connectivity service for additional ProSe-enabled UEs;
6) shall set the ProSe direct discovery PC5 message type parameter as
specified in table 10.2.1.8;
7) if acting as 5G ProSe layer-2 UE-to-network relay UE, shall set the NCGI
parameter to the NCGI of its serving cell; and
8) if acting as 5G ProSe layer-2 UE-to-network relay UE, shall set the RRC
container to the RRC container if provided by the lower layers;
d) shall apply the DUIK, DUSK, or DUCK with the associated Encrypted Bitmask,
along with the UTC-based counter to the PROSE PC5 DISCOVERY message for
whichever security mechanism(s) configured to be applied, e.g., integrity
protection, message scrambling or confidentiality protection of one or more
above parameters, as specified in 3GPP TS 33.503 [34];
e) shall set the destination layer-2 ID to the default destination layer-2 ID
as specified in clause 5.2.5 and self-assign a source layer-2 ID for sending
the UE-to-network relay discovery announcement; and
NOTE 1: The UE implementation ensures that the value of the self-assigned
source layer-2 ID is different from any other self-assigned source layer-2
ID(s) in use for 5G ProSe direct communication as specified in clause 7.2, is
different from any other provisioned destination layer-2 ID(s) as specified in
clause 5.2 and is different from any other self-assigned source layer-2 ID in
use for a simultaneous 5G ProSe direct discovery procedure over PC5 with a
different discovery model as specified in clause 6.2.14.2.2.2, clause
6.2.15.2.2.2 and clause 8.2.1.3.1.2.
f) shall pass the resulting PROSE PC5 DISCOVERY message for UE-to-network
relay discovery announcement to the lower layers for transmission over the PC5
interface with the source layer-2 ID, destination layer-2 ID and an indication
that the message is for 5G ProSe direct discovery.
The UE shall ensure that it keeps on passing the same PROSE PC5 DISCOVERY
message along with the same source layer-2 ID, destination layer-2 ID and an
indication that the message is for 5G ProSe direct discovery to the lower
layers for transmission until the UE is triggered by an upper layer
application to stop announcing availability of a connectivity service provided
by a UE-to-network relay, or until the UE stops being authorised to perform
the announcing UE procedure for UE-to-network relay discovery. How this is
achieved is left up to UE implementation.
NOTE 2: The announcing UE can stop announcing UE procedure for UE-to-network
relay discovery for power saving by implementation specific means e.g. an
implementation-specific maximum number of 5G ProSe direct links configured in
the UE, or an implementation-specific timer expires.
###### 8.2.1.2.2.3 Announcing UE procedure for UE-to-network relay discovery
completion
When the announcing UE is triggered by an upper layer application to stop
announcing availability in a discovery group, or when the announcing UE stops
being authorised to perform the announcing UE procedure for UE-to-network
relay discovery, the UE shall instruct the lower layers to stop announcing.
NOTE: The announcing UE can stop announcing UE procedure for UE-to-network
relay discovery for power saving by implementation specific means e.g. an
implementation-specific maximum number of 5G ProSe direct links configured in
the UE, or an implementation-specific timer expires.
When the UE stops announcing, if the UE is in 5GMM-CONNECTED mode, the UE
shall trigger the corresponding procedure in lower layers as specified in 3GPP
TS 38.331 [13].
##### 8.2.1.2.3 Monitoring UE relay discovery for UE-to-network relay
discovery
###### 8.2.1.2.3.1 General
The purpose of the monitoring UE procedure for UE-to-network relay discovery
is:
a) to enable a ProSe-enabled UE to become aware of proximity of a connectivity
service provided by a UE-to-network relay, upon a request from upper layers as
defined in 3GPP TS 23.304 [2]; or
b) to enable a ProSe-enabled UE to perform measurements of signal strength of
PROSE PC5 DISCOVERY messages from 5G ProSe UE-to-network relay UE(s) for relay
selection/reselection.
###### 8.2.1.2.3.2 Monitoring UE procedure for UE-to-network relay discovery
initiation
The UE is authorised to perform the monitoring UE procedure for UE-to-network
relay discovery if:
a) the following is true:
1) the UE is not served by NG-RAN, is authorised to perform 5G ProSe direct
discovery using monitoring when the UE is not served by NG-RAN and is
configured with the radio parameters to be used for 5G ProSe direct discovery
when not served by NG-RAN;
2) the UE is served by NG-RAN and is authorised to perform 5G ProSe direct
discovery monitoring in at least one PLMN; or
3) the UE is:
i) in 5GMM-IDLE mode, in limited service state as specified in 3GPP TS 23.122
[14] and the reason for the UE being in limited service state is one of the
following:
A) the UE is unable to find a suitable cell in the selected PLMN as specified
in 3GPP TS 38.304 [15];
B) the UE received a REGISTRATION REJECT message or a SERVICE REJECT message
with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501
[11] ; or
C) the UE received a REGISTRATION REJECT message or a SERVICE REJECT message
with the 5GMM cause #7 \"5GS services not allowed\" as specified in 3GPP TS
24.501 [11]; and
ii) authorised to perform 5G ProSe direct discovery using monitoring when the
UE is not served by NG-RAN, and:
A) configured with the radio parameters to be used for 5G ProSe direct
discovery when not served by NG-RAN;
b) the UE is configured with the relay service code parameter identifying the
connectivity service to be monitored, as specified in clause 5.2.5 and the
indicated security procedure for the relay service code is supported by the
UE; and
c) for 5G ProSe layer-2 remote UE, the UE is camped on a cell whose TAI is not
in the list of \"non-allowed tracking areas\" or is camped on a cell whose TAI
is in the list of \"allowed tracking areas\",
otherwise, the UE is not authorised to perform the monitoring UE procedure for
UE-to-network relay discovery.
Figure 8.2.1.2.3.2.1 illustrates the interaction of the UEs in the monitoring
UE procedure for UE-to-network relay discovery.
Figure 8.2.1.2.3.2.1: Monitoring UE procedure for UE-to-network relay
discovery
When the UE is triggered by the upper layers to monitor proximity of a
connectivity service provided by a UE-to-network relay or when the UE decides
to perform 5G ProSe UE-to-network relay reselection as specified in clause
8.2.3, and if the UE is authorised to perform the monitoring UE procedure for
UE-to-network relay discovery, then the UE shall instruct the lower layers to
start monitoring for PROSE PC5 DISCOVERY messages with the default destination
layer-2 ID as specified in clause 5.2.5.
If the traffic descriptor is configured as specified in clause 5.2.5, the 5G
ProSe layer-3 remote UE shall determine the monitored RSC by mapping the
traffic from the upper layer application with the traffic descriptor as
follows:
a) if there are at least one ProSe application traffic descriptor(s) to be
used for the relayed traffic as specified in clause 5.2.5 which has not yet
been evaluated,
1) if the ProSe application traffic descriptor matches upper layer application
information;
the UE shall select the RSC associated with the matched ProSe application
traffic descriptor for monitoring. If more than one RSCs are associated with
the upper layer application information, it is up to UE implementation to
select a RSC in this release of specification;
2) else, the UE shall select the next ProSe application traffic descriptor
which has not yet been evaluated and proceed to step 1);
b) else, it is up to UE implementation to select a RSC.
NOTE 1: Selection of relay service code is up to UE implementation if there is
no ProSe application traffic descriptor(s) configured in the UE.
Upon reception of a PROSE PC5 DISCOVERY message for UE-to-network relay
discovery announcement according to clause 10.2.1, for the target relay
service code of the connectivity service which the UE is authorized to
monitor, the UE shall use the associated DUSK, if received from the 5G DDNMF
or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-network
relay is used) and the UTC-based counter obtained during the monitoring
operation to unscramble the PROSE PC5 DISCOVERY message as described in 3GPP
TS 33.503 [34]. Then, if a DUCK is received from the 5G DDNMF or 5G PKMF (if
security procedure over user plane for 5G ProSe UE-to-network relay is used),
the UE shall use the DUCK and the UTC-based counter to decrypt the configured
message-specific confidentiality-protected portion, as described in 3GPP TS
33.503 [34]. Finally, if a DUIK is received from the 5G DDNMF or 5G PKMF (if
security procedure over user plane for 5G ProSe UE-to-network relay is used),
the UE shall use the DUIK and the UTC-based counter to verify the MIC field in
the unscrambled PROSE PC5 DISCOVERY message for UE-to-network relay discovery
announcement.
NOTE 2: The use of an erroneous UTC-based counter for processing received
PROSE PC5 DISCOVERY messages at the ProSe-enabled UE can cause MIC check
failure after DUIK is used for integrity check and malformed contents after
DUSK is used for unscrambling or DUCK is used for deciphering. How a ProSe-
enabled UE ensures the accuracy of the UTC-based counter is left to UE
implementation.
NOTE 3: The UE can determine the received PROSE PC5 DISCOVERY message for UE-
to-network relay discovery announcement is for 5G ProSe direct discovery based
on an indication from the lower layer.
Then if:
a) the relay service code parameter of the PROSE PC5 DISCOVERY message for UE-
to-network relay discovery announcement is the same as the relay service code
parameter configured as specified in clause 5 for the connectivity service
being monitored; and
b) the target announcer info is not provided by upper layers for the
connectivity service being monitored, or the announcer info parameter of the
PROSE PC5 DISCOVERY message for UE-to-network relay discovery announcement is
the same as the target announcer info if the target annoucer info is provided
by upper layers for the connectivity service being monitored,
_then the UE shall consider that the_ connectivity service the UE _seeks to
monitor has been discovered. In addition, the UE can measure the signal
strength of the PROSE_ PC5 DISCOVERY message for UE-to-network relay discovery
announcement _for relay selection or reselection._
###### 8.2.1.2.3.3 Monitoring UE procedure for UE-to-network relay discovery
completion
When the UE is triggered by an upper layer application to stop monitoring
proximity of other UEs in a discovery group, or when the UE stops being
authorised to perform the monitoring UE procedure for UE-to-network relay
discovery, the UE shall instruct the lower layers to stop monitoring.
When the UE stops monitoring, if the UE is in 5GMM-CONNECTED mode, the UE
shall trigger the corresponding procedure in lower layers as specified in 3GPP
TS 38.331 [13].
##### 8.2.1.2.4 Announcing UE procedure for relay discovery additional
information
###### 8.2.1.2.4.1 General
The purpose of the announcing UE procedure for relay discovery additional
information is to announce to the 5G ProSe remote UEs additional information
about:
a) the NCGI of the cell serving the 5G ProSe layer-3 UE-to-network relay UE;
and
b) the TAI of the cell serving the 5G ProSe layer-3 UE-to-network relay UE;
as defined in 3GPP TS 23.304 [2].
###### 8.2.1.2.4.2 Announcing procedure for relay discovery additional
information
The 5G ProSe UE-to-network relay UE announces the relay discovery additional
information:
a) if the 5G ProSe remote UE requests the 5G ProSe UE-to-network relay UE to
announce the NG-RAN Cell Global ID (NCGI) or TAI of the cell serving the 5G
ProSe UE-to-network relay UE and as a response the 5G ProSe UE-to-network
relay UE acknowledges with the ProSe additional parameters announcement
response message, then the 5G ProSe UE-to-network relay UE includes the NCGI
or TAI of the serving cell in the PROSE PC5 DISCOVERY message for relay
discovery additional information until the timer T5107 expires (see clause
8.2.8).
NOTE 1: 5G ProSe UE-to-network relay UE announces the relay discovery
additional information only when it is in NG-RAN coverage.
Figure 8.2.1.2.4.2.1 illustrates the interaction of the 5G ProSe UE-to-network
relay UE and the 5G ProSe remote UE in the announcing UE procedure for relay
discovery additional information.
Figure 8.2.1.2.4.2.1: Announcing procedure for relay discovery additional
information
The 5G ProSe UE-to-network relay UE may start announcing relay discovery
additional information if:
a) the 5G ProSe UE-to-network relay UE is currently authorised to perform 5G
ProSe direct discovery Model A announcing in the serving PLMN if the UE is
served by NG-RAN, and
1) additional parameters announcement for the serving cell of the 5G ProSe UE-
to-network relay UE has been requested and responded to 5G ProSe remote UEs,
the timer T5107 has not expired (periodic reporting);
2) additional parameters announcement for the serving cell of the 5G ProSe UE-
to-network relay UE has been requested and responded to 5G ProSe remote UEs,
the timer T5107 has not expired and the 5G ProSe UE-to-network relay UE
detects camping on a new serving cell; or
3) additional parameters announcement for the serving cell of the 5G ProSe UE-
to-network relay UE has been requested and responded to 5G ProSe remote UEs,
the timer T5107 has not expired and the 5G ProSe UE-to-network relay UE
detects entering a new tracking area.
When the 5G ProSe UE-to-network relay UE has some additional information to
broadcast (i.e., NCGI, TAI), then the 5G ProSe UE-to-network relay UE:
a) shall request the parameters from the lower layers for ProSe direct
discovery announcing (see 3GPP TS 38.331 [13]). If the 5G ProSe UE-to-network
relay UE in 5GMM-IDLE mode needs to request resources for sending PROSE PC5
DISCOVERY messages as specified in 3GPP TS 38.331 [13], the 5G ProSe UE-to-
network relay UE shall perform a service request procedure or mobility
registration procedure as specified in 3GPP TS 24.501 [11];
b) shall obtain a valid UTC time for the discovery transmission from the lower
layers and generate the UTC-based counter corresponding to this UTC time as
specified in clause 11.2.5;
c) shall generate PROSE PC5 DISCOVERY message(s) for relay discovery
additional information according to clause 10.2.1. In the PROSE PC5 DISCOVERY
message for relay discovery additional information, the 5G ProSe UE-to-network
relay UE shall:
1) include the relay service code used for 5G ProSe direct communication which
the 5G ProSe remote UE used to request for the relay discovery additional
information;
2) set the announcer info parameter to the User info ID parameter, configured
in clause 5.2.5;
3) set the NGCI parameter to the NCGI of the cell serving the UE, if the UE
acts as 5G ProSe layer-3 UE-to-network relay UE and the NGCI is to be
announced;
4) set the Relay TAI parameter to the TAI of the cell serving the UE, if the
UE acts as 5G ProSe layer-3 UE-to-network relay UE and the TAI is to be
announced;
5) include the MIC field computed as described in 3GPP TS 33.503 [34], by
using the UTC-based counter and the DUIK contained in the \ element of the PROSE_SECURITY_PARAM_RESPONSE
message;
6) shall set the UTC-based counter LSB parameter to the 4 least significant
bits of the UTC-based counter; and
7) shall set the ProSe direct discovery PC5 message type parameter as
specified in table 10.2.1.11;
d) shall apply the DUIK, DUSK, or DUCK with the associated Encrypted Bitmask,
along with the UTC-based counter to the PROSE PC5 DISCOVERY message for
whichever security mechanism(s) configured to be applied, e.g., integrity
protection, message scrambling or confidentiality protection of one or more
above parameters, as specified in 3GPP TS 33.503 [34];
e) shall set the default destination layer-2 ID as specified in clause 5.2.5
to the destination layer-2 ID and self-assign a source layer-2 ID for sending
the UE-to-network relay discovery announcement; and
NOTE 2: The UE implementation ensures that the value of the self-assigned
source layer-2 ID is different from any other self-assigned source layer-2
ID(s) in use for 5G ProSe direct communication as specified in clause 7.2, is
different from any other provisioned destination layer-2 ID(s) as specified in
clause 5.2 and is different from any other self-assigned source layer-2 ID in
use for a simultaneous 5G ProSe direct discovery procedure over PC5 with a
different discovery model as specified in clause 6.2.14.2.2.2, clause
6.2.15.2.2.2 and clause 8.2.1.3.1.2.
f) shall pass the resulting PROSE PC5 DISCOVERY message for relay discovery
additional information along with the source layer-2 ID, destination layer-2
ID and an indication that the message is for 5G ProSe direct discovery to the
lower layers for transmission over the PC5 interface.
The 5G ProSe UE-to-network relay UE shall ensure that it keeps on passing the
PROSE PC5 DISCOVERY messages periodically to the lower layers for transmission
until the corresponding timer (i.e., timer T5107 when the additional
information is NCGI or TAI) expires. How this is achieved is left up to UE
implementation.
NOTE 3: The announcing UE can stop announcing UE procedure for relay discovery
additional information for power saving by implementation specific means e.g.
an implementation-specific maximum number of 5G ProSe direct links configured
in the UE, or an implementation-specific timer expires.
NOTE 4: The periodicity of sending the PROSE PC5 DISCOVERY messages for relay
discovery additional information by the 5G ProSe UE-to-network relay UE is
implementation specific and is normally lower than the one related to the
additional parameters announcement request refresh timer T5016.
During the announcing operation, if one of the above conditions is no longer
met, the 5G ProSe UE-to-network relay UE may instruct the lower layers to stop
announcing.
##### 8.2.1.2.5 Monitoring UE procedure for relay discovery additional
information
###### 8.2.1.2.5.1 General
The purpose of the monitoring UE procedure for relay discovery additional
information is to enable a 5G ProSe remote UE to become aware of the
additional information of the 5G ProSe UE-to-network relay UE as described in
clause 8.2.1.2.4.1.
###### 8.2.1.2.5.2 Monitoring procedure for relay discovery additional
information
The 5G ProSe remote UE monitors relay discovery additional information:
a) until the additional parameters announcement request refresh timer T5016
expires if the 5G ProSe remote UE has requested the 5G ProSe UE-to-network
relay UE to announce the NCGI or TAI of the cell serving the 5G ProSe UE-to-
network relay UE and received the ProSe additional parameters announcement
response message from the 5G ProSe UE-to-network relay UE.
The UE may instruct the lower layers to start monitoring if:
a) a request from upper layers to monitor for relay discovery additional
information is still in place and either:
1) the UE is currently authorised to perform 5G ProSe direct discovery Model A
monitoring in at least one PLMN if the UE is served by NG-RAN;
2) the UE is currently authorised to perform 5G ProSe direct discovery Model A
monitoring if the UE is not served by NG-RAN; or
3) the UE is:
i) in 5GMM-IDLE mode, in limited service state as specified in 3GPP TS 23.122
[14] and the reason for the UE being in limited service state is one of the
following:
A) the UE is unable to find a suitable cell in the selected PLMN as specified
in 3GPP TS 36.304 [15];
B) the UE received a REGISTRATION REJECT message or a SERVICE REJECT message
with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501
[11]; or
C) the UE received a REGISTRATION REJECT message or a SERVICE REJECT message
with the 5GMM cause #7 \"5GS services not allowed \" as specified in 3GPP TS
24.501 [11]; and
ii) authorised to perform 5G ProSe direct discovery Model A monitoring when
the UE is not served by NG-RAN and configured with the radio parameters to be
used for 5G ProSe direct discovery when not served by NG-RAN.
If the UE is in 5GMM-CONNECTED mode, the monitoring UE shall also trigger the
corresponding procedure in lower layers as specified in 3GPP TS 38.331 [13].
During the monitoring operation, if one of the above conditions is no longer
met, the UE may instruct the lower layers to stop monitoring. When the UE
stops monitoring, if the UE is in 5GMM-CONNECTED mode, the UE shall trigger
the corresponding procedure in lower layers as specified in 3GPP TS 38.331
[13].
Upon reception of a PROSE PC5 DISCOVERY message for relay discovery additional
information according to clause 10.2.1, for the target relay service code to
be monitored, the UE shall use the associated DUSK, if received from the 5G
DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-
network relay is used) and the UTC-based counter obtained during the
monitoring operation to unscramble the PROSE PC5 DISCOVERY message as
described in 3GPP TS 33.503 [34]. Then, if a DUCK is received from the 5G
DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-
network relay is used), the UE shall use the DUCK and the UTC-based counter to
decrypt the configured message-specific confidentiality protected portion, as
described in 3GPP TS 33.503 [34]. Finally, if a DUIK is received from the 5G
DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe UE-to-
network relay is used), the UE shall use the DUIK and UTC-based counter to
verify the MIC field in the unscrambled PROSE PC5 DISCOVERY message for relay
discovery additional information.
NOTE 1: The use of an erroneous UTC-based counter for processing received
PROSE PC5 DISCOVERY messages at the ProSe-enabled UE can cause MIC check
failure after DUIK is used for integrity check and malformed contents after
DUSK is used for unscrambling or DUCK is used for deciphering. How a ProSe-
enabled UE ensures the accuracy of the UTC-based counter is left to UE
implementation.
NOTE 2: The UE can determine the received PROSE PC5 DISCOVERY message for
relay discovery additional information is for 5G ProSe direct discovery based
on an indication from the lower layer.
Then, if:
a) the relay service code parameter of the PROSE PC5 DISCOVERY message for
relay discovery additional information is the same as the relay service code
parameter configured as specified in clause 5.2.5 for the connectivity service
being monitored; and
b) the announcer info parameter of the PROSE PC5 DISCOVERY message for relay
discovery additional information is the same as the target announcer info if
the target announcer info is provided by upper layers or same as the User info
ID of the 5G ProSe UE-to-network relay UE to which the 5G ProSe additional
parameters announcement was requested and acknowledged as specified in clause
8.2.8,
then _the UE shall consider that the_ relay discovery additional information
it intend _s to monitor has been discovered. In addition, the UE can measure
the signal strength of the_ PROSE PC5 DISCOVERY message for relay discovery
additional information _for relay selection or reselection._
#### 8.2.1.3 UE-to-network relay discovery over PC5 interface with model B
##### 8.2.1.3.1 Discoverer UE procedure for UE-to-network Relay discovery
###### 8.2.1.3.1.1 General
The purpose of the discoverer UE procedure for UE-to-network Relay discovery
is:
a) to enable a ProSe-enabled UE to solicit proximity of a connectivity service
provided by a UE-to-network Relay, upon a request from upper layers; or
b) to enable a ProSe-enabled UE to measure the PROSE PC5 DISCOVERY message
signal strength between the ProSe-enabled UE and the 5G ProSe UE-to-network
Relay UE(s) for relay selection/reselection.
In this procedure, the UE sending the PROSE PC5 DISCOVERY message is called
the \"discoverer UE\" and the other UE is called the \"discoveree UE\".
###### 8.2.1.3.1.2 Discoverer UE procedure for UE-to-network relay discovery
initiation
The UE is authorised to perform the discoverer UE procedure for UE-to-network
relay discovery if:
a) one of the following is true:
1) the UE is not served by NG-RAN, is authorised to act as a 5G ProSe remote
UE towards a 5G ProSe UE-to-network relay UE and is configured with the radio
parameters to be used for ProSe UE-to-network relay discovery when not served
by NG-RAN;
2) the UE is served by NG-RAN, is authorised to act as a 5G ProSe remote UE
towards a 5G ProSe UE-to-network relay UE; or
3) the UE is:
i) in 5GMM-IDLE mode, in limited service state as specified in 3GPP TS 23.122
[14] and the reason for the UE being in limited service state is one of the
following:
A) the UE is unable to find a suitable cell in the selected PLMN as specified
in 3GPP TS 38.304 [15];
B) the UE received a REGISTRATION REJECT message or a SERVICE REJECT message
with the 5GMM cause #11 \"PLMN not allowed\" as specified in 3GPP TS 24.501
[11]; or
C) the UE received a REGISTRATION REJECT message or a SERVICE REJECT message
with the 5GMM cause #7 \"5GS services not allowed\" as specified in 3GPP TS
24.501 [11]; and
ii) authorised to act as a 5G ProSe remote UE towards a 5G ProSe UE-to-network
relay UE when the UE is not served by NG-RAN and configured with the radio
parameters to be used for ProSe UE-to-network relay discovery use when not
served by NG-RAN;
b) the UE is configured with:
1) the relay service code parameter identifying the connectivity service to be
solicited and the indicated security procedure for the relay service code is
supported by the UE; and
2) the User info ID for the UE-to-network relay discovery parameter, as
specified in clause 5.2.5; and
c) for 5G ProSe layer-2 remote UE, the UE is camped on a cell whose TAI is not
in the list of \"non-allowed tracking areas\" or is camped on a cell whose TAI
is in the list of \"allowed tracking areas\",
otherwise, the UE is not authorised to perform the discoverer UE procedure for
UE-to-network relay discovery.
Figure 8.2.1.3.1.2.1 illustrates the interaction of the UEs in the discoverer
UE procedure for UE-to-network relay discovery.
Figure 8.2.1.3.1.2.1: Discoverer UE procedure for UE-to-network Relay
discovery
For PROSE PC5 DISCOVERY message signal strength measurement, the UE manages a
periodic measurement timer T5109, which is used to trigger the periodic PROSE
PC5 DISCOVERY message signal strength measurement between the UE and the ProSe
UE-to-network relay UE with which the UE has a link established. It is started
whenever the UE has established a direct link with a 5G ProSe UE-to-network
relay UE and restarted whenever the UE receives the PROSE PC5 DISCOVERY
message for UE-to-network relay discovery response from the 5G ProSe UE-to-
network relay UE with which the UE has a link established.
When the UE is triggered by the upper layers to solicit proximity of a
connectivity service provided by a 5G ProSe UE-to-network relay UE, or when
the periodic measurement timer T5109 expires and if the UE is authorised to
perform the discoverer UE procedure for UE-to-network relay discovery, then
the UE:
a) if the UE is served by NG-RAN and the UE in 5GMM-IDLE mode needs to request
resources for sending PROSE PC5 DISCOVERY messages for relay discovery as
specified in 3GPP TS 38.331 [13], shall perform a service request procedure as
specified in 3GPP TS 24.501 [11];
b) shall obtain a valid UTC time for the discovery transmission from the lower
layers and generate the UTC-based counter corresponding to this UTC time;
c) shall generate a PROSE PC5 DISCOVERY message for UE-to-network relay
discovery solicitation. In the PROSE PC5 DISCOVERY message for UE-to-network
relay discovery solicitation, the UE:
1) shall set the discoverer info parameter to the configured User info ID for
the UE-to-network relay discovery parameter, as specified in clause 5.2.5;
2) shall set the relay service code parameter to the relay service code
parameter identifying the connectivity service to be solicited, configured in
clause 5.2.5. For the 5G ProSe layer-3 remote UE, if the traffic descriptor is
configured as specified in clause 5.2.5, the UE shall determine the RSC as
follows:
i) if there are at least one ProSe application traffic descriptor(s) to be
used for the relayed traffic as specified in clause 5.2.5 which has not yet
been evaluated,
A) if the ProSe application traffic descriptor matches the upper layer
application information;
the UE shall select the RSC associated with the matched ProSe application
traffic descriptor for solicitation. If more than one RSCs are associated with
the upper layer application information, it is up to UE implementation to
select a RSC in this release of specification;
B) else, the UE shall select the next ProSe application traffic descriptor
which has not yet been evaluated and proceed to step A);
ii) else, it is up to UE implementation to select a RSC.
NOTE 1: Selection of relay service code is up to UE implementation if there is
no ProSe application traffic descriptor(s) configured in the UE.
3) shall include the MIC filed computed as described in 3GPP TS 33.503 [34] by
using the UTC-based counter and the DUIK contained in the \ element of the PROSE_SECURITY_PARAM_RESPONSE
message;
4) shall set the UTC-based counter LSB parameter to the 4 least significant
bits of the UTC-based counter;
5) shall set the ProSe direct discovery PC5 message type parameter as
specified in table 10.2.1.9; and
6) may include the target discoveree info parameter set to the user info ID of
the targeted discoveree user if the target discoveree info is provided by the
application layer;
d) shall apply the DUIK, DUSK, or DUCK with the associated Encrypted Bitmask,
along with the UTC-based counter to the PROSE PC5 DISCOVERY message for
whichever security mechanism(s) configured to be applied, e.g., integrity
protection, message scrambling or confidentiality protection of one or more
above parameters, as specified in 3GPP TS 33.503 [34];
e) shall set the default destination layer-2 ID as specified in clause 5.2.5
to the destination layer-2 ID and self-assign a source layer-2 ID for sending
the UE-to-network relay discovery solicitation message; and
NOTE 2: The UE implementation ensures that the value of the self-assigned
source layer-2 ID is different from any other self-assigned source layer-2
ID(s) in use for 5G ProSe direct communication as specified in clause 7.2, is
different from any other provisioned destination layer-2 ID(s) as specified in
clause 5.2 and is different from any other self-assigned source layer-2 ID in
use for a simultaneous 5G ProSe direct discovery procedure over PC5 with a
different discovery model as specified in clause 6.2.14.2.1.2, clause
6.2.15.2.1.2, clause 8.2.1.2.2.2 and clause 8.2.1.2.4.2.
f) shall pass the resulting PROSE PC5 DISCOVERY message for UE-to-network
relay discovery solicitation along with the source layer-2 ID, destination
layer-2 ID and an indication that the message is for 5G ProSe direct discovery
to the lower layers for transmission over the PC5 interface.
If the PROSE PC5 DISCOVERY message for UE-to-network relay discovery
solicitation is used to solicit proximity of a connectivity service provided
by a 5G ProSe UE-to-network relay UE, the UE shall ensure that it keeps on
passing the PROSE PC5 DISCOVERY message for UE-to-network relay discovery
solicitation for transmission until the UE is triggered by an upper layer
application to stop soliciting proximity of a connectivity service provided by
a 5G ProSe UE-to-network relay UE, or until the UE stops being authorised to
perform the discoverer UE procedure for UE-to-network relay discovery. How
this is achieved is left up to UE implementation.
NOTE 3: The discoverer UE can stop discoverer UE procedure for UE-to-network
relay discovery for power saving by implementation specific means e.g. an
implementation-specific maximum number of 5G ProSe direct links configured in
the UE, or an implementation-specific timer expires.
If the PROSE PC5 DISCOVERY message for UE-to-network relay discovery
solicitation is used to trigger the PROSE PC5 DISCOVERY message signal
strength measurement between the UE and the 5G ProSe UE-to-network Relay UE
with which the UE has a link established, the UE shall start the
retransmission timer T5108. If retransmission timer T5108 expires, the UE
shall retransmit the PROSE PC5 DISCOVERY message for UE-to-network relay
discovery solicitation and restart timer T5108. If no response is received
from the ProSe UE-to-network relay UE with which the UE has a link established
after reaching the maximum number of allowed retransmissions, the UE shall
trigger relay reselection procedure.
NOTE 4: The maximum number of allowed retransmissions is UE implementation
specific.
Upon reception of a PROSE PC5 DISCOVERY message for UE-to-network relay
discovery response along with the destination layer-2 ID which the UE is
configure to respond for, for the target relay service code of the
connectivity service which the UE is authorized to discover, the UE shall use
the associated DUSK, if received from the 5G DDNMF or 5G PKMF (if security
procedure over user plane for 5G ProSe UE-to-network relay is used) and the
UTC-based counter obtained during the reception operation to unscramble the
PROSE PC5 DISCOVERY message as described in 3GPP TS 33.503 [34]. Then, if a
DUCK is received from the 5G DDNMF or 5G PKMF (if security procedure over user
plane for 5G ProSe UE-to-network relay is used), the UE shall use the DUCK and
the UTC-based counter to decrypt the configured message-specific
confidentiality-protected portion, as described in 3GPP TS 33.503 [34].
Finally, if a DUIK is received from the 5G DDNMF or 5G PKMF (if security
procedure over user plane for 5G ProSe UE-to-network relay is used), the UE
shall use the DUIK and the UTC-based counter to verify the MIC field in the
unscrambled PROSE PC5 DISCOVERY message for UE-to-network relay discovery
response.
NOTE 5: The UE can determine the received PROSE PC5 DISCOVERY message for UE-
to-network relay discovery response is for 5G ProSe direct discovery based on
an indication from the lower layer.
Then if:
a) the relay service code parameter of the PROSE PC5 DISCOVERY message for UE-
to-network relay discovery response is the same as the relay service code
parameter of the PROSE PC5 DISCOVERY message for UE-to-network relay discovery
solicitation; and
b) the target discoveree info is not provided by upper layers for the
connectivity service being solicited, or the discoveree info parameter of the
PROSE PC5 DISCOVERY message for UE-to-network relay discovery response is the
same as the target discoveree info if the target discoveree info is provided
by upper layers for the connectivity service being solicited,
then _the UE shall consider that the_ connectivity service the UE _seeks to
discover has been discovered. In addition, the UE can measure the signal
strength of the_ PROSE PC5 DISCOVERY message for UE-to-network relay discovery
response _for relay selection or reselection. If the UE has received the_
PROSE PC5 DISCOVERY message for UE-to-network relay discovery response from
the ProSe UE-to-network Relay UE with which the UE has a link established, the
UE shall stop the retransmission timer T5108 and start the periodic
measurement timer T5109.
###### 8.2.1.3.1.3 Discoverer UE procedure for UE-to-network Relay discovery
completion
When the UE is triggered by an upper layer application to stop soliciting for
proximity of a connectivity service provided by a UE-to-network Relay, or when
the UE stops being authorised to perform the Discoverer UE procedure for UE-
to-network Relay discovery, the UE shall instruct the lower layers to stop the
discoverer operation.
NOTE: The discoverer UE can stop discoverer UE procedure for UE-to-network
relay discovery for power saving by implementation specific means e.g. an
implementation-specific maximum number of 5G ProSe direct links configured in
the UE, or an implementation-specific timer expires.
When the UE stops discoverer operation, if the UE is in 5GMM-CONNECTED mode,
the UE shall trigger the corresponding procedure in lower layers as specified
in 3GPP TS 38.331 [13].
##### 8.2.1.3.2 Discoveree UE procedure for UE-to-network Relay discovery
###### 8.2.1.3.2.1 General
The purpose of the discoveree UE procedure for UE-to-network relay discovery
is to enable a ProSe-enabled UE with a UE-to-network Relay to respond to
solicitation from other ProSe-enabled UEs on proximity of a connectivity
service provided by the 5G ProSe UE-to-network relay UE, upon a request from
upper layers.
In this procedure, the UE sending the PROSE PC5 DISCOVERY message is called
the \"discoverer UE\" and the other UE is called the \"discoveree UE\".
###### 8.2.1.3.2.2 Discoveree UE procedure for UE-to-network relay discovery
initiation
The UE is authorised to perform the discoveree UE procedure for UE-to-network
relay discovery if:
a) the UE is authorised to act as a 5G ProSe UE-to-network relay UE in the
PLMN indicated by the serving cell, and
1) the UE is served by NG-RAN; or
2) the UE is not served by NG-RAN and intends to use the provisioned radio
resources for UE-to-network relay discovery;
b) the UE is configured with:
1) the relay service code parameter identifying the connectivity service to be
responded to as specified in clause 5.2.5 and the indicated security procedure
for the relay service code is supported by the UE. For 5G ProSe layer-3 UE-to-
network relay UE,
i) the S-NSSAI associated with that relay service code shall belong to the
allowed NSSAI of the UE; and
ii) if the UE is camped on a cell whose TAI is in the list of \"non-allowed
tracking areas\" or is camped on a cell whose TAI is not in the list of
\"allowed tracking areas\", then the relay service code shall be associated
with high priority access as defined in clause 5.3.5 of 3GPP TS 24.501 [11];
and
2) the User info ID for the UE-to-network relay discovery parameter, as
specified in clause 5.2.5; and
c) the back-off timer T3346 used for NAS mobility management congestion
control as specified in clause 5.3.9 of 3GPP TS 24.501 [11] is not running at
the UE;
otherwise, the UE is not authorised to perform the discoveree UE procedure for
UE-to-network relay discovery.
Figure 8.2.1.3.2.2.1 illustrates the interaction of the UEs in the discoveree
UE procedure for UE-to-network relay discovery.
Figure 8.2.1.3.2.2.1: Discoveree UE procedure for UE-to-network Relay
discovery
When the UE is triggered by an upper layer application to start responding to
solicitation on proximity of a connectivity service provided by the UE-to-
network Relay and if the UE is authorised to perform the discoveree UE
procedure for UE-to-network Relay discovery, then the UE:
a) if the UE is served by NG-RAN and the UE in 5GMM-IDLE mode needs to request
resources for sending PROSE PC5 DISCOVERY messages as specified in 3GPP TS
38.331 [13], shall perform a service request procedure as specified in 3GPP TS
24.501 [11]; and
b) shall instruct the lower layers to start monitoring for PROSE PC5 DISCOVERY
messages.
Upon reception of a PROSE PC5 DISCOVERY message for UE-to-network relay
discovery solicitation, for the relay service code of the connectivity service
which the UE is authorized to respond, the UE shall use the associated DUSK,
if received from the 5G DDNMF or 5G PKMF (if security procedure over user
plane for 5G ProSe UE-to-network relay is used) and the UTC-based counter
obtained during the reception operation to unscramble the PROSE PC5 DISCOVERY
message as described in 3GPP TS 33.503 [34]. Then, if a DUCK is received from
the 5G DDNMF or 5G PKMF (if security procedure over user plane for 5G ProSe
UE-to-network relay is used), the UE shall use the DUCK and the UTC-based
counter to decrypt the configured message-specific confidentiality-protected
portion, as described in 3GPP TS 33.503 [34]. Finally, if a DUIK is received
from the 5G DDNMF or 5G PKMF (if security procedure over user plane for 5G
ProSe UE-to-network relay is used), the UE shall use the DUIK and the UTC-
based counter to verify the MIC field in the unscrambled PROSE PC5 DISCOVERY
message for UE-to-network relay discovery solicitation.
NOTE 1: The UE can determine the received PROSE PC5 DISCOVERY message for 5G
ProSe direct discovery announcement is for 5G ProSe direct discovery based on
an indication from the lower layer.
Then, if:
a) the relay service code parameter of the received PROSE PC5 DISCOVERY
message for UE-to-network relay discovery solicitation is the same as the
relay service code parameter configured as specified in clause 5.2.5 for the
connectivity service; and
b) the target discoveree info parameter of the received PROSE PC5 DISCOVERY
message for UE-to-network relay discovery solicitation is the same as the user
info ID for the UE-to-network relay discovery provided by upper layers or same
as the configured user info ID for the UE-to-network relay discovery as
specified in clause 5.2.5, if the target discoveree info parameter is included
in the received PROSE PC5 DISCOVERY message;
then the UE:
a) shall obtain a valid UTC time for the discovery transmission from the lower
layers and generate the UTC-based counter corresponding to this UTC time;
b) shall generate a PROSE PC5 DISCOVERY message for UE-to-network relay
discovery response. In the PROSE PC5 DISCOVERY message for UE-to-network relay
discovery response, the UE:
1) shall set the Discoveree info parameter to the configured User info ID for
the UE-to-network Relay discovery parameter, as specified in clause 5.2.5;
2) shall set the relay service code parameter to the relay service code
parameter of the PROSE PC5 DISCOVERY message for UE-to-network relay discovery
solicitation;
3) shall set the Resource Status Indicator bit of the status indicator
parameter to indicate whether or not the UE has resources available to provide
a connectivity service for additional ProSe-enabled UEs;
4) shall include the MIC filed computed as described in 3GPP TS 33.503 [34] by
using the UTC-based counter and the DUIK contained in the \ element of the PROSE_SECURITY_PARAM_RESPONSE
message;
5) shall set the UTC-based counter LSB parameter to the 4 least significant
bits of the UTC-based counter;
6) shall set the ProSe direct discovery PC5 message type parameter as
specified in table 10.2.1.10;
7) if acting as 5G ProSe layer-2 UE-to-network relay UE, shall set the NCGI
parameter to the NCGI of its serving cell; and
8) if acting as 5G ProSe layer-2 UE-to-network relay UE, shall set the RRC
container to the RRC container if provided by the lower layers;
c) shall apply the DUIK, DUSK, or DUCK with the associated Encrypted Bitmask,
along with the UTC-based counter to the PROSE PC5 DISCOVERY message for
whichever security mechanism(s) configured to be applied, e.g., integrity
protection, message scrambling or confidentiality protection of one or more
above parameters, as specified in 3GPP TS 33.503 [34];
d) shall set the destination layer-2 ID to the source layer-2 ID from the
discoverer UE used in the transportation of the PROSE PC5 DISCOVERY message
for UE-to-network relay discovery solicitation and self-assign a source
layer-2 ID for sending the UE-to-network relay discovery response message; and
NOTE 2: The UE implementation ensures that the value of the self-assigned
source layer-2 ID is different from any other self-assigned source layer-2
ID(s) in use for 5G ProSe direct communication as specified in clause 7.2 and
is different from any other provisioned destination layer-2 ID(s) as specified
in clause 5.2.
e) shall pass the resulting PROSE PC5 DISCOVERY message for UE-to-network
relay discovery response along with the source layer-2 ID, destination layer-2
ID and an indication that the message is for 5G ProSe direct discovery to the
lower layers for transmission over the PC5 interface.
NOTE 3: If the UE is processing a PROSE DIRECT LINK ESTABLISHMENT REQUEST
message from the same source layer-2 ID of the received PROSE PC5 DISCOVERY
message for UE-to-network relay discovery solicitation, it depends on UE
implementation to avoid the conflict of destination layer-2 ID (e.g. send a
PROSE DIRECT LINK ESTABLISHMENT REJECT message containing PC5 signalling
protocol cause value #3 \"conflict of layer-2 ID for unicast communication is
detected\", or ignore the PROSE DIRECT DISCOVERY message for UE-to-network
relay discovery solicitation).
###### 8.2.1.3.2.3 Discoveree UE procedure for UE-to-network relay discovery
completion
When the UE is triggered by an upper layer application to stop responding to
solicitation on proximity of a connectivity service provided by a 5G ProSe UE-
to-network relay UE, or when the UE stops being authorised to perform the
discoveree UE procedure for UE-to-network relay discovery, the UE shall
instruct the lower layers to stop monitoring.
When the UE stops monitoring, if the UE is in 5GMM-CONNECTED mode, the UE
shall trigger the corresponding procedure in lower layers as specified in 3GPP
TS 38.331 [13].
#### 8.2.1.4 Procedure for UE to use provisioned radio resources for 5G ProSe
UE-to-network discovery
When the UE is not served by NG-RAN for 5G ProSe UE-to-network relay discovery
and is authorized to use 5G ProSe UE-to-network relay discovery, the UE shall
select the corresponding radio parameters to be used for 5G ProSe UE-to-
network relay discovery as follows:
a) if the UE can determine itself located in a geographical area and the UE is
provisioned with radio parameters for the geographical area, the UE shall
select the radio parameters associated with that geographical area; or
b) in all other cases, the UE shall not initiate 5G ProSe UE-to-network relay
discovery.
If the UE intends to use \"non-operator managed\" radio parameters as
specified in clause 5.2.5, the UE shall initiate 5G ProSe UE-to-network relay
discovery with the selected radio parameters.
If the UE intends to use \"operator managed\" radio parameters as specified in
clause 5.2.5, before initiating 5G ProSe UE-to-network relay discovery, the UE
shall check with lower layers whether the selected radio parameters can be
used in the current location without causing interference to other cells as
specified in 3GPP TS 38.331 [13]; and:
a) if the lower layers indicate that the usage would not cause any
interference, the UE shall initiate 5G ProSe UE-to-network relay discovery; or
NOTE: If the lower layers find that there exists a cell operating the
provisioned radio resources (i.e., carrier frequency) and the cell belongs to
the registered PLMN or a PLMN equivalent to the registered PLMN and the UE is
authorized for 5G ProSe UE-to-network relay discovery in this PLMN, the UE can
use the radio parameters indicated by the cell as specified in 3GPP TS 38.331
[13].
b) else if the lower layers report that one or more PLMNs operate in the
provisioned radio resources (i.e., carrier frequency) then:
1) if the following conditions are met:
i) none of the PLMNs reported by the lower layers is the registered PLMN or
equivalent to the registered PLMN;
ii) at least one of the PLMNs reported by the lower layers is in the list of
authorized PLMNs for 5G ProSe UE-to-network relay discovery and provides radio
resources for 5G ProSe UE-to-network relay discovery as specified in 3GPP TS
38.331 [13]; and
iii) the UE does not have an emergency PDU session;
then the UE shall:
i) if in 5GMM-IDLE mode, perform PLMN selection triggered by 5G ProSe UE-to-
network relay discovery as specified in 3GPP TS 23.122 [14]; or
ii) else if in 5GMM-CONNECTED mode, either:
A) perform a De-registration procedure as specified in 3GPP TS 24.501 [11] and
then perform PLMN selection triggered by 5G ProSe UE-to-network relay
discovery as specified in 3GPP TS 23.122 [14]; or
B) not initiate 5G ProSe direct discovery.
Whether the UE performs i) or ii) above is left up to UE implementation; or
2) else the UE shall not initiate 5G ProSe UE-to-network relay discovery.
If the registration to the selected PLMN is successful, the UE shall proceed
with the procedure to initiate 5G ProSe UE-to-network relay discovery as
specified in clause 8.2.1.
If the UE is performing 5G ProSe UE-to-network relay discovery using radio
parameters associated with a geographical area and moves out of that
geographical area, the UE shall stop performing 5G ProSe UE-to-network relay
discovery and then if the UE is not served by NG-RAN for 5G ProSe UE-to-
network relay discovery, the UE shall select appropriate radio parameters for
the new geographical area as specified above.
### 8.2.2 UE-to-network relay selection procedure
#### 8.2.2.1 General
The purpose of the UE-to-network relay selection procedure is to enable a 5G
ProSe remote UE to select a suitable 5G ProSe UE-to-network relay UE to obtain
a connectivity service to 5GC.
#### 8.2.2.2 UE-to-network relay selection procedure initiation
The 5G ProSe remote UE shall trigger the UE-to-network relay selection
procedure if the following conditions are met:
a) the UE is authorised to act as a 5G ProSe remote UE towards a 5G ProSe UE-
to-network relay UE as specified in clause 5.2.5:
1) if the 5G ProSe remote UE is expected to use 5G ProSe layer-3 UE-to-network
relay, the indication whether the UE is authorized to use a 5G ProSe layer-3
UE-to-network relay UE shall be set;
2) if the 5G ProSe remote UE is expected to use 5G ProSe layer-2 UE-to-network
relay, the subset of the PLMN(s) provided by the 5G ProSe layer-2 UE-to-
network relay UE shall be in the list of PLMNs in which the UE is authorized
to use a 5G ProSe layer-2 UE-to-network relay UE; and
3) if the 5G ProSe remote UE is expected to use 5G ProSe layer-2 UE-to-network
relay, the 5G ProSe remote UE selected PLMN shall be in the list of PLMNs in
which the UE is authorized to use a 5G ProSe layer-2 UE-to-network relay UE
and in the subset of the PLMN(s) provided by the 5G ProSe layer-2 UE-to-
network relay UE;
b) the UE has obtained a list of 5G ProSe UE-to-network relay UE candidate(s)
fulfilling ProSe layer criteria with the monitoring procedure for UE-to-
network relay discovery as specified in clause 8.2.1.2.3 or the discoverer
procedure for UE-to-network relay discovery as specified in clause 8.2.1.3.1;
and
c) the UE has obtained a list of 5G ProSe UE-to-network relay UE candidate(s)
fulfilling lower layers criteria as specified in 3GPP TS 38.331 [13].
NOTE: It is left to UE implementation on how UE handles the case when there is
no appropriate 5G ProSe UE-to-network relay UE around.
#### 8.2.2.3 UE-to-network relay selection procedure completion
If there exists only one 5G ProSe UE-to-network relay UE candidate satisfying
the conditions in clause 8.2.2.2, then that 5G ProSe UE-to-network relay UE is
selected. If there exist more than one 5G ProSe UE-to-network relay candidate
satisfying the conditions in clause 8.2.2.2, any relay candidates not
satisfying the non-radio related ProSe layer criteria shall be discarded and
out of the remaining relay candidates, the relay candidate with the highest
ranking of the lower layer criteria shall be selected. The UE may take the
value of the resource status indicator bit of the status indicator parameter
of the PROSE PC5 DISCOVERY message for UE-to-network relay discovery
announcement or PROSE PC5 DISCOVERY message for UE-to-network relay discovery
response into account when deciding which 5G ProSe UE-to-network relay to
select. It is up to the UE implementation whether the ProSe layer or the lower
layers takes the final selection on which 5G ProSe UE-to-network relay UE to
select.
### 8.2.3 UE-to-network relay reselection procedure
#### 8.2.3.1 General
The purpose of the UE-to-network relay reselection procedure is to enable a 5G
ProSe remote UE to reselect a 5G ProSe UE-to-network relay UE to obtain a
connectivity service to 5GC when the serving 5G ProSe UE-to-network relay UE
is no longer suitable.
#### 8.2.3.2 UE-to-network relay reselection procedure initiation
The 5G ProSe remote UE shall trigger the UE-to-network relay reselection
procedure if one of the following conditions is met:
a) the UE has received a lower layers indication that the serving 5G ProSe UE-
to-network relay UE no longer fulfills the lower layers criteria as specified
in 3GPP TS 38.331 [13];
b) the parameters related to 5G ProSe UE-to-network relay in the configuration
parameters for 5G ProSe UE-to-network relay as specified in clause 5.2.5
(e.g., relay service code, User info ID, etc.) have been updated and the
serving 5G ProSe UE-to-network relay UE no longer fulfills the conditions
specified in clause 8.2.2.2;
c) the UE has received a PROSE DIRECT LINK ESTABLISHMENT REJECT message from
the 5G ProSe UE-to-network relay UE with the PC5 signalling protocol cause
value #1 \"direct communication to the target UE not allowed\";
d) the UE has received a PROSE DIRECT LINK RELEASE REQUEST message from the 5G
ProSe UE-to-network relay UE with the PC5 signalling protocol cause value #1
\"direct communication to the target UE not allowed\";
e) the UE has received a PROSE DIRECT LINK RELEASE REQUEST message from the 5G
ProSe UE-to-network relay UE with the PC5 signalling protocol cause value #4
\"direct connection is not available anymore\";
f) the UE has not received any response from the 5G ProSe UE-to-network relay
UE after M consecutive retransmissions of PROSE DIRECT LINK ESTABLISHMENT
REQUEST or PROSE DIRECT LINK KEEPALIVE REQUEST messages;
g) the UE has not received any response from the 5G ProSe UE-to-network relay
UE after M consecutive retransmissions of PROSE PC5 DISCOVERY message for UE-
to-network relay discovery solicitation used to trigger the PROSE PC5
DISCOVERY message signal strength measurement between the UE and the 5G ProSe
UE-to-network relay UE with which the UE has a link established;
NOTE: The value of M is implementation specific and is less than or equal to
the maximum number of retransmissions allowed for PC5 signalling protocol.
h) the UE has received a PROSE DIRECT LINK ESTABLISHMENT REJECT message from
the ProSe UE-to-network relay UE with the cause value #13 \"congestion
situation\";
i) the UE has received a PROSE DIRECT LINK RELEASE REQUEST message from the
ProSe UE-to-network relay UE with the cause value #13 \"congestion
situation\"; or
j) the UE has received a PROSE DIRECT LINK ESTABLISHMENT REJECT message from
the 5G ProSe UE-to-network relay UE with the cause value #15 \"security
procedure failure of 5G ProSe UE-to-network relay\".
In cases c), d), h) and i), the 5G ProSe remote UE shall exclude the 5G ProSe
UE-to-network relay UE which sent the message specified in cases c), d), h) or
i) from the UE-to-network relay reselection process described below (at least
for the indicated back-off time period if provided from the ProSe UE-to-
network relay UE in cases h) and i)).
In case j), when the 5G ProSe remote UE has included the UE identity IE set to
SUCI in the PROSE DIRECT LINK ESTABLISHMENT REQUEST message, the 5G ProSe
remote UE shall exclude the 5G ProSe UE-to-network relay UE which sent the
message specified in case j) from the UE-to-network relay reselection process
described below.
To conduct UE-to-network relay reselection process, the UE shall first
initiate one of the following procedures or both depending on UE\'s
configuration parameters for 5G ProSe UE-to-network relay as specified in
clause 5.2.5:
a) monitoring procedure for UE-to-network relay discovery as specified in
clause 8.2.1.2.3; or
b) discoverer procedure for UE-to-network relay discovery as specified in
clause 8.2.1.3.1.
After the execution of the above discovery procedure(s), the 5G ProSe remote
UE performs the UE-to-network relay selection procedure as specified in clause
8.2.2.
NOTE: It is left to UE implementation on how UE handles the case when there is
no appropriate 5G ProSe UE-to-network relay UE around.
### 8.2.4 Procedure for UE to use provisioned radio resources for 5G ProSe UE-
to-network relay communication
When the UE is not served by NG-RAN for 5G ProSe UE-to-network relay
communication and is authorized to use 5G ProSe UE-to-network relay
communication, the UE shall select the corresponding radio parameters to be
used for 5G ProSe UE-to-network relay communication as follows:
a) if the UE can determine itself located in a geographical area and the UE is
provisioned with radio parameters for the geographical area, the UE shall
select the radio parameters associated with that geographical area; or
b) in all other cases, the UE shall not initiate 5G ProSe UE-to-network relay
communication.
If the UE intends to use \"non-operator managed\" radio parameters as
specified in clause 5.2.5, the UE shall initiate 5G ProSe UE-to-network relay
communication with the selected radio parameters.
If the UE intends to use \"operator managed\" radio parameters as specified in
clause 5.2.5, before initiating 5G ProSe UE-to-network relay communication,
the UE shall check with lower layers whether the selected radio parameters can
be used in the current location without causing interference to other cells as
specified in 3GPP TS 38.331 [13]; and:
a) if the lower layers indicate that the usage would not cause any
interference, the UE shall initiate 5G ProSe UE-to-network relay
communication; or
NOTE: If the lower layers find that there exists a cell operating the
provisioned radio resources (i.e., carrier frequency) and the cell belongs to
the registered PLMN or a PLMN equivalent to the registered PLMN and the UE is
authorized for 5G ProSe UE-to-network relay communication in this PLMN, the UE
can use the radio parameters indicated by the cell as specified in 3GPP TS
38.331 [13].
b) else if the lower layers report that one or more PLMNs operate in the
provisioned radio resources (i.e., carrier frequency) then:
1) if the following conditions are met:
i) none of the PLMNs reported by the lower layers is the registered PLMN or
equivalent to the registered PLMN;
ii) at least one of the PLMNs reported by the lower layers is in the list of
authorized PLMNs for 5G ProSe UE-to-network relay communication and provides
radio resources for 5G ProSe UE-to-network communication as specified in 3GPP
TS 38.331 [13]; and
iii) the UE does not have an emergency PDU session;
then the UE shall:
i) if in 5GMM-IDLE mode, perform PLMN selection triggered by 5G ProSe UE-to-
network discovery as specified in 3GPP TS 23.122 [14]; or
ii) else if in 5GMM-CONNECTED mode, either:
A) perform a De-registration procedure as specified in 3GPP TS 24.501 [11] and
then perform PLMN selection triggered by 5G ProSe UE-to-network discovery as
specified in 3GPP TS 23.122 [14]; or
B) not initiate 5G ProSe UE-to-network communication.
Whether the UE performs i) or ii) above is left up to UE implementation; or
2) else the UE shall not initiate 5G ProSe UE-to-network relay communication.
If the registration to the selected PLMN is successful, the UE shall proceed
with the procedure to initiate 5G ProSe communication over PC5 as specified in
clause 7.2.
If the UE is performing 5G ProSe UE-to-network relay communication using radio
parameters associated with a geographical area and moves out of that
geographical area, the UE shall stop performing 5G ProSe UE-to-network relay
communication.
### 8.2.5 IP address allocation for 5G ProSe remote UE in 5G ProSe layer-3 UE-
to-network relay procedure
When one of the two UEs on the direct link acts as a 5G ProSe layer-3 UE-to-
network relay UE, the PDU session type is IPv4, IPv6 or IPv4v6 and is used for
relaying IP traffic over PC5 reference point, the two UEs shall select the IP
version (IPv4 or IPv6) to be used based on the following rules:
a) if the 5G ProSe layer-3 UE-to-network relay UE has indicated \"DHCPv4
Server\" in the IP address configuration IE, the 5G ProSe remote UE shall
initiate the IPv4 address configuration with DHCPv4 procedure acting as a DHCP
client, according to IETF RFC 2131 [23] and IETF RFC 4039 [24];
b) if the 5G ProSe layer-3 UE-to-network relay UE has indicated \"IPv6
Router\" in the IP address configuration IE, the 5G ProSe remote UE shall
initiate the IPv6 address configuration with IPv6 stateless address auto-
configuration acting as an IPv6 host based on IETF RFC 4862 [25];
NOTE: The 5G ProSe layer-3 UE-to-network relay UE uses IPv6 prefix delegation
via DHCPv6 (see clause 8.2.5a) to obtain the IPv6 prefix assigned to the 5G
ProSe layer-3 remote UE.
c) if the 5G ProSe layer-3 UE-to-network relay UE has indicated \"IPv6
Router\" in the IP address configuration IE, the 5G ProSe remote UE may use
stateless DHCPv6 for additional parameter configuration, as defined in TS
23.501 [22]; and
d) if the 5G ProSe layer-3 UE-to-network relay UE has indicated \"DHCPv4
Server & IPv6 Router\" in the IP address configuration IE, the 5G ProSe remote
UE shall choose the IP version and initiate the corresponding IP address
configuration procedure as a client or host.
### 8.2.5a IPv6 prefix delegation via DHCPv6 for 5G ProSe layer-3 UE-to-
network relay
If the 5G ProSe layer-3 UE-to-network relay UE can indicate \"IPv6 Router\" or
\"DHCPv4 Server & IPv6 Router\" in the IP address configuration IE, the 5G
ProSe layer-3 UE-to-network relay UE requests additional IPv6 prefixes (i.e.,
prefixes in addition to the /64 default prefix which was allocated via
stateless IPv6 address autoconfiguration) from the SMF as specified in 3GPP TS
24.501 [11].
Once the 5G ProSe layer-3 UE-to-network relay UE successfully obtains the
network prefix shorter than the default /64 prefix using DHCPv6, the 5G ProSe
layer-3 UE-to-network relay UE can assign /64 prefix from the network prefix
when the 5G ProSe layer-3 UE-to-network remote UE requests IPv6 prefix via
stateless IPv6 address autoconfiguration.
### 8.2.6 QoS handling for 5G ProSe UE-to-network relay
#### 8.2.6.1 General
This clause describes the QoS handling between a 5G ProSe UE-to-network relay
UE and a 5G ProSe remote UE. The purpose of QoS handling for 5G ProSe UE-to-
network relay is to meet the end-to-end QoS requirement between 5G ProSe
remote UE and the network.
The QoS handling for 5G ProSe UE-to-network relay can be classified with the
following three cases according to the type of 5G ProSe UE-to-network relay:
a) QoS handling for 5G ProSe remote UE accessing the network via a 5G ProSe
layer-2 UE-to-network relay;
b) QoS handling for 5G ProSe remote UE accessing the network via a 5G ProSe
layer-3 UE-to-network relay without N3IWF; and
c) QoS handling for 5G ProSe remote UE accessing the network via a 5G ProSe
layer-3 UE-to-network relay with N3IWF.
#### 8.2.6.2 QoS handling for 5G ProSe layer-2 UE-to-network relay
For a 5G ProSe layer-2 remote UE accessing the network via a 5G ProSe layer-2
UE-to-network relay, the end-to-end QoS requirement between 5G ProSe layer-2
remote UE and the network can be met by the existing 5G QoS control between
the 5G ProSe layer-2 remote UE and the core network that is serving the 5G
ProSe layer-2 remote UE as specified in 3GPP TS 24.501 [11].
#### 8.2.6.3 QoS handling for 5G ProSe layer-3 UE-to-network relay without
N3IWF
##### 8.2.6.3.1 General
The QoS handling by a 5G ProSe layer-3 UE-to-network relay without an N3IWF to
achieve an end-to-end QoS between the 5G ProSe layer-3 remote UE and the
network is described in clause 5.6.2.1 of 3GPP TS 23.304 [2].
For a 5G ProSe layer-3 remote UE accessing the network via a 5G ProSe layer-3
UE-to-network relay without N3IWF, the end-to-end QoS requirement between 5G
ProSe layer-3 remote UE and the network can be satisfied by the corresponding
QoS control:
a) QoS control between 5G ProSe layer-3 remote UE and 5G ProSe layer-3 UE-to-
network relay UE (PC5 QoS control); and
b) QoS control between 5G ProSe layer-3 UE-to-network relay UE and the network
(Uu QoS control).
To achieve this, the QoS mapping can be pre-configured as specified in clause
5.2.5 or provided to the 5G ProSe UE-to-network relay UE by the PCF using
Prose Policy as specified in clause 5.3.2.
##### 8.2.6.3.2 QoS flows handling initiated by the network
For QoS flows setup initiated by the network, upon reception QoS rules and QoS
flow level QoS parameters from the SMF, the 5G ProSe layer-3 UE-to-network
relay UE:
a) shall determine the PQI based on the QoS mapping rules configured in clause
5.2.5;
b) shall set the GFBR value for the PC5 GBR QoS flow to the GFBR value from
the SMF, if any;
c) shall set the MFBR value for the PC5 GBR QoS flow to the MFBR value from
the SMF, if any;
d) shall set the averaging window value for the PC5 GBR QoS flow to the
averaging value from the SMF, if any;
e) may derive the packet filter(s) used for PC5 QoS rule(s) from the packet
filter(s) used over Uu reference; and
f) may initiate the 5G ProSe direct link modification procedure(s) as defined
in clause 7.2.3 to either update the existing PC5 QoS flow or to set up a new
PC5 QoS flow. The 5G ProSe layer-3 UE-to-network relay UE may include the PC5
QoS rule(s) when initiating the 5G ProSe direct link modification procedure
toward a 5G ProSe layer-3 remote UE for which the IP address associated to the
5G ProSe layer-3 remote UE is included in the packet filter(s) used over Uu.
Alternatively, for dynamic QoS handling of 5G ProSe layer-3 remote UE using
reflective QoS mechanism, upon the 5G ProSe layer-3 UE-to-network relay UE
receiving a downlink user data packet along with the Reflective QoS Indication
(RQI) as specified in 3GPP TS 24.501 [11], the 5G ProSe layer-3 UE-to-network
relay UE:
a) creates a derived QoS rule by reflective QoS in the UE as specified in
clause 6.2.5.1.4, 3GPP TS 24.501 [11];
b) shall create a new derived PC5 QoS rule or update the existing derived PC5
QoS rule for the PC5 QoS flow based on the derived QoS rule from a);
c) shall determine the corresponding PQI for the PC5 QoS flow based on the QoS
mapping rules as specified in clause 5.2.5 and the 5QI value that corresponds
to the QFI of the QoS rule from b); and
d) shall perform one of the following:
1) if there is a PC5 QoS flow with the determined PQI, the 5G ProSe layer-3
UE-to-network relay UE shall perform the 5G ProSe direct link modification
procedure as specified in clause 7.2.3 to associate the ProSe application on
the existing PC5 QoS flow. The 5G ProSe layer-3 UE-to-network relay UE may
include the PC5 QoS rule(s) associated with the updated PC5 QoS flow; or
2) if there is no PC5 QoS flow with the determined PQI, the 5G ProSe layer-3
UE-to-network relay UE shall perform the 5G ProSe direct link modification
procedure as specified in clause 7.2.3 to add a new PC5 QoS flow with the
determined PQI and associate the ProSe application on the new PC5 QoS flow.
The 5G ProSe layer-3 UE-to-network relay UE may include the PC5 QoS rule(s)
associated with the newly added PC5 QoS flow.
When a derived QoS rule is deleted, the 5G ProSe layer-3 UE-to-network relay
UE shall perform the 5G ProSe direct link modification procedure as specified
in clause 7.2.3 to associate the ProSe application with a PC5 QoS flow such
that the determined PQI maps to the 5QI of the signalled QoS rule.
##### 8.2.6.3.3 PC5 QoS flows handling initiated by the 5G ProSe layer-3
remote UE
For PC5 QoS flows setup or modification initiated by the 5G ProSe layer-3
remote UE, the 5G ProSe layer-3 remote UE shall provide the PC5 QoS flow
context as defined in clause 7.2.7 to the 5G ProSe layer-3 UE-to-network relay
UE to indicate the end-to-end QoS requirements for the traffic transmission
between 5G ProSe layer-3 remote UE and the network, using 5G ProSe direct link
establishment procedure as specified in clause 7.2.2 or 5G ProSe direct link
modification procedure as specified in clause 7.2.3.
In addition, if the 5G ProSe layer-3 remote UE wants to add new PC5 QoS
flow(s) or modify the existing PC5 QoS flow(s) for IP traffic or Ethernet
traffic, the 5G ProSe layer-3 remote UE may also provide the PC5 QoS rule(s)
for the PC5 QoS flow(s) to be added or modified to the 5G ProSe layer-3 UE-to-
network relay UE, using 5G ProSe direct link establishment procedure as
specified in clause 7.2.2 or 5G ProSe direct link modification procedure as
specified in clause 7.2.3.
Upon reception of the PC5 QoS flow context from the 5G ProSe layer-3 remote
UE, the 5G ProSe layer-3 UE-to-network relay UE:
a) shall perform one of the following:
1) if the end-to-end QoS requirements can be supported by an entry in QoS
mapping configured in clause 5.2.5, then the 5G ProSe layer-3 UE-to-network
relay UE uses the 5QI of the entry for the Uu QoS control and uses the PQI of
the entry for the PC5 QoS control; or
2) if the end-to-end QoS requirements cannot be supported by any entry in QoS
mapping configured in clause 5.2.5, then the 5G ProSe layer-3 UE-to-network
relay UE determines the 5QI for the Uu QoS control and PQI for the PC5 QoS
control based on its implementation;
b) optionally, derives the packet filter(s) used over Uu reference point if
the 5G ProSe layer-3 UE-to-network relay UE received PC5 QoS rule(s) from 5G
ProSe layer-3 remote UE;
c) if a new QoS flow needs to be established or the existing QoS flow(s) needs
to be modified, performs UE-requested PDU session modification procedure as
specified in clause 6.4.2 in 3GPP TS 24.501 [11] providing:
1) the Requested QoS flow descriptions IE with the 5QI value determined in
bullet a); or
2) the Requested QoS rules IE with the packet filter(s) if packet filter(s)
are derived in bullet b);
d) shall further update the corresponding PC5 QoS flow with the updated PQI
value if the 5G ProSe layer-3 UE-to-network relay UE receives the authorized
QoS flow descriptions with a 5QI value which is different from the 5QI value
indicated by the 5G ProSe layer-3 UE-to-network relay UE as described in
bullet c); and
e) shall provide the 5G ProSe layer-3 remote UE with the PQI determined in
bullet a) or the PQI updated in bullet d), the corresponding PC5 QoS
parameters and the corresponding ProSe identifier(s) as specified in clause
7.2.2.3 (if 5G ProSe direct link establishment procedure was initiated by the
5G ProSe layer-3 remote UE) or clause 7.2.3.3 (if 5G ProSe direct link
modification procedure was initiated by the 5G ProSe layer-3 remote UE).
#### 8.2.6.4 QoS handling for 5G ProSe layer-3 UE-to-network relay with N3IWF
##### 8.2.6.4.1 General
As specified in clause 5.6.2.2 of 3GPP TS 23.304 [2], when the 5G ProSe
layer-3 remote UE accesses 5GS via a 5G ProSe layer-3 UE-to-network relay with
N3IWF, the N3IWF can use one of the following operations for QoS support in 5G
ProSe layer-3 UE-to-network relay UE\'s serving PLMN:
a) a static QoS mapping mechanism; or
b) a dynamic QoS signalling based mechanism.
For a), there is no signalling impact to the 5G ProSe layer-3 remote UE and
the 5G ProSe layer-3 UE-to-network relay UE.
For b), clause 8.2.6.4.2 specifies the QoS handling with QoS signalling
procedure to transport the IPsec traffic in the 5G ProSe layer-3 UE-to-network
relay UE\'s 5GCN.
##### 8.2.6.4.2 QoS handling with QoS signalling procedure
When the 5G ProSe layer-3 remote UE establishes or handovers a PDU session via
the N3IWF as described in clause 4.12.5 of 3GPP TS 23.502 [51], the N3IWF
initiates a child SA creation procedure by sending a CREATE_CHILD_SA request
message to associate the QoS flow(s) of the PDU session with the child SA of
the user plane as specified in clause 7.5 of 3GPP TS 24.502 [26]. In the
CREATE_CHILD_SA request message, the 5G_QOS_INFO Notify payload includes the
PDU session ID, one or more QFI(s), optionally a DSCP value and optionally
Additional QoS Information as defined in clause 9.3.1.1 of 3GPP TS 24.502
[26]. The N3IWF can also initiate the user plane IPsec child SA modification
procedure by sending an INFORMATIONAL request message including the
5G_QOS_INFO Notify payload if the child SA associated with the QoS flows of
the PDU session needs to be modified as specified in clause 7.6 of 3GPP TS
24.502 [26].
Based on information in the received 5G_QoS_INFO Notify payload, the 5G ProSe
layer-3 remote UE determines whether to initiate the 5G ProSe direct link
modification procedure to setup or modify the PC5 QoS flows. If the 5G ProSe
direct link modification procedure needs to be initiated, the 5G ProSe layer-3
remote UE shall perform the procedure as specified in clause 8.2.6.3.3 with
following additions:
a) if the Additional QoS Information is received in the 5G_QoS_INFO Notify
payload, the 5G ProSe layer-3 remote UE shall set the PC5 QoS flow
descriptions IE based on the Additional QoS Information; and
b) the 5G ProSe layer-3 remote UE shall include the PC5 QoS rules IE with the
packet filter containing the N3IWF IP address, the security parameter index of
the child SA and the DSCP value if received in the 5G_QoS_INFO Notify payload.
The 5G ProSe layer-3 UE-to-network relay UE determines whether to initiate PDU
session modification procedure to request establishment or modification of the
QoS flow of the dedicated QoS rules which is associated with the IPsec traffic
between the 5G ProSe layer-3 remote UE and the N3IWF. If the PDU session
modification procedure needs to be initiated, the 5G ProSe layer-3 UE-to-
network relay UE shall perform the procedure as specified in clause 6.4.2 of
3GPP TS 24.501 [11] with following additions:
a) the 5G ProSe layer-3 UE-to-network relay UE sends the packet filter
provided in the PC5 QoS rules IE by the 5G ProSe layer-3 remote UE to the SMF.
### 8.2.7 5G ProSe layer-3 UE-to-network relay with N3IWF support
#### 8.2.7.1 General
As specified in clause 5.4.1.2 of 3GPP TS 23.304 [2], the 5G ProSe layer-3 UE-
to-network relay with N3IWF support shall provide the 5G ProSe layer-3 remote
UE with the connection which can access to the N3IWF. In this way, the 5G
ProSe layer-3 remote UE is able to select the N3IWF and access to the 5GC via
the N3IWF.
The layer-3 ProSe UE-to-network relay UE is provisioned with the UE policies
for 5G ProSe layer-3 UE-to-network relay including the relay service code
which corresponds to use N3IWF access for the relayed traffic as defined in
3GPP TS 24.555 [17].
For UE-to-network relay discovery with model A, the 5G ProSe UE-to-network
relay UE shall include the relay service code in the PROSE PC5 DISCOVERY
message for UE-to-network relay discovery announcement as specified in clause
8.2.1.2. For UE-to-network relay discovery with model B, the 5G ProSe layer-3
remote UE shall include the relay service code which corresponds to use N3IWF
access for the relayed traffic in the PROSE PC5 DISCOVERY message for UE-to-
network relay discovery solicitation as specified in clause 8.2.1.3. The relay
service code in the PROSE PC5 DISCOVERY message for UE-to-network relay
discovery response shall match the relay service code received from the 5G
ProSe layer-3 remote UE.
NOTE 1: The UE is allowed to use the 5G ProSe layer-3 UE-to-network relay with
N3IWF support if the UE is authorized to be a 5G ProSe layer-3 remote UE as
specified in clause 5.2.5 and the non-3GPP access type is preferred in the
selected route selection descriptor in the URSP rule as defined in 3GPP TS
24.526 [5].
If the 5G ProSe layer-3 remote UE intends to access 5GC via N3IWF, the 5G
ProSe layer-3 remote UE:
a) shall select the relay service code which corresponds to use N3IWF access
for the relayed traffic in the received PROSE PC5 DISCOVERY message;
b) shall send the PROSE DIRECT LINK ESTABLISHMENT REQUEST message including
the selected relay service code in a) to the 5G ProSe layer-3 UE-to-network
relay UE; and
c) shall use either the security procedure over user plane or the security
procedure over control plane as specified in 3GPP TS 33.503 [34].
NOTE 2: After using either the security procedure over user plane or the
security procedure over control plane as specified in 3GPP TS 33.503 [34], the
5G ProSe layer-3 remote UE performs the security procedures as specified in
clause 7.2.1 of 3GPP TS 33.501 [50].
The 5G ProSe layer-3 UE-to-network relay UE establishes the PDU session with
corresponding parameters for the requested relay service code as specified in
clause 8.2.7.2.
The 5G ProSe layer-3 remote UE performs the N3IWF selection as specified in
8.2.7.3 once the IP address/prefix allocation is completed.
#### 8.2.7.2 5G ProSe layer-3 UE-to-network relay UE establishing PDU session
to access N3IWF
The 5G ProSe layer-3 UE-to-network relay UE establishes the PDU session based
on the UE policies for 5G ProSe layer-3 UE-to-network relay service codes
defined in 3GPP TS 24.555 [17]. The PDU session establishment is triggered
upon receipt of the PROSE DIRECT LINK ESTABLISHMENT REQUEST message including
the relay service code. The 5G ProSe layer-3 remote UE may change 5G ProSe
layer-3 UE-to-network relay(s) while maintaining the PDU session(s)
established via 5G ProSe layer-3 UE-to-network relay and N3IWF, when the 5G
ProSe layer-3 remote UE and the N3IWF support MOBIKE as specified TS 24.502
[26].
NOTE: If there is an existing PDU session for 5G ProSe layer-3 UE-to-network
relay without N3IWF, whether to reuse that existing PDU session or to
establish a new PDU session for 5G ProSe layer-3 UE-to-network relay with
N3IWF is determined by 5G ProSe layer-3 UE-to-network relay UE as specified in
3GPP TS 23.503[33].
#### 8.2.7.3 N3IWF selection for 5G ProSe layer-3 remote UE
As specified in clause 6.5.1.2.2 of 3GPP TS 23.304 [2], the 5G ProSe layer-3
remote UE selects the N3IWF using following information included in UE
policies for 5G ProSe UE-to-network remote UE as defined in clause 5.6.2 of
3GPP TS 24.555 [17]:
a) N3IWF identifier configuration for 5G ProSe layer-3 remote UE; and
b) 5G ProSe layer-3 UE-to-network relay access node selection information.
The 5G ProSe layer-3 remote UE performs the N3IWF selection procedure as
specified in clause 7.2.4.3 of 3GPP TS 24.502 [26].
### 8.2.8 5G ProSe additional parameters announcement procedure
#### 8.2.8.1 General
The purpose of the 5G ProSe additional parameters announcement procedure is
for the 5G ProSe layer-3 remote UE to obtain NCGI or TAI of the cell serving
the 5G ProSe layer-3 UE-to-network relay UE.
The 5G ProSe remote UE in this procedure shall be a 5G ProSe-enabled UE and is
authorised to act as a 5G ProSe layer-3 remote UE towards a 5G ProSe layer-3
UE-to-network relay UE based on the service authorization procedure as
specified in clause 5. The 5G ProSe layer-3 UE-to-network relay UE in this
procedure shall be a 5G ProSe-enabled UE and is authorised to act as a 5G 5G
ProSe layer-3 UE-to-network relay UE based on the service authorization
procedure as specified in clause 5.
#### 8.2.8.2 5G ProSe additional parameters announcement procedure initiation
by the 5G ProSe layer-3 remote UE
Before initiating the 5G ProSe additional parameters announcement procedure, a
direct link has been successfully established between the 5G ProSe layer-3
remote UE and the 5G ProSe layer-3 UE-to-network relay UE.
The 5G ProSe layer-3 remote UE shall initiate a 5G ProSe additional parameters
announcement procedure:
a) when the 5G ProSe layer-3 remote UE is triggered by an upper layer
application to report NCGI or TAI of the serving cell to the application
server, but cannot receive the PROSE PC5 DISCOVERY message for relay discovery
additional information from the 5G ProSe layer-3 UE-to-network relay UE, or
the NCGI or TAI is not included in the PROSE PC5 DISCOVERY message for relay
discovery additional information from the 5G ProSe layer-3 UE-to-network relay
UE; or
b) when the additional parameters announcement request refresh timer T5106
expires and the 5G ProSe layer-3 remote UE still needs to obtain NCGI or TAI
of the cell serving the 5G ProSe layer-3 UE-to-network relay.
The 5G ProSe layer-3 remote UE shall generate a PROSE ADDITIONAL PARAMETERS
ANNOUNCEMENT REQUEST message and pass this message to the lower layers for
transmission along with the 5G ProSe layer-3 remote UE\'s layer-2 ID (for
unicast communication) and the 5G ProSe layer-3 UE-to-network relay UE\'s
layer-2 ID (for unicast communication).
Figure 8.2.8.2.1: 5G ProSe additional parameters announcement procedure
#### 8.2.8.3 5G ProSe additional parameters announcement procedure accepted by
the 5G ProSe layer-3 UE-to-network relay UE
Upon receiving a PROSE ADDITIONAL PARAMETERS ANNOUNCEMENT REQUEST message, the
5G ProSe layer-3 UE-to-network relay UE shall allocate an additional
parameters announcement request refresh timer T5106 to the 5G ProSe remote UE
and start a timer T5107. The timer T5107 shall be longer than the additional
parameters announcement request refresh timer T5106.
Then the 5G ProSe layer-3 UE-to-network relay UE shall respond a PROSE
ADDITIONAL PARAMETERS ANNOUNCEMENT RESPONSE message with an additional
parameters announcement request refresh timer T5106 IE set to the T5106 timer
value assigned by the 5G ProSe layer-3 UE-to-network relay UE. The 5G ProSe
layer-3 UE-to-network relay UE shall start announcing the NCGI or TAI of the
serving cell by triggering the announcing UE procedure for relay discovery
additional information as described in clause 8.2.1.2.4.
#### 8.2.8.4 5G ProSe additional parameters announcement procedure completion
by the 5G ProSe layer-3 remote UE
Upon receiving a PROSE ADDITIONAL PARAMETERS ANNOUNCEMENT RESPONSE message,
the UE shall start the additional parameters announcement request refresh
timer T5106 with the received value.
#### 8.2.8.5 Abnormal cases
##### 8.2.8.5.1 Abnormal cases in the 5G ProSe layer-3 remote UE
If there is no response from the 5G ProSe layer-3 UE-to-network relay UE after
the PROSE ADDITIONAL PARAMETERS ANNOUNCEMENT REQUEST message has been
successfully delivered, the 5G ProSe layer-3 remote UE shall retransmit the
PROSE ADDITIONAL PARAMETERS ANNOUNCEMENT REQUEST message.
NOTE: The timer to trigger retransmission and the maximum number of allowed
retransmissions are UE implementation specific.
### 8.2.9 5G ProSe AA message reliable transport procedure
#### 8.2.9.1 General
The purpose of the 5G ProSe AA message reliable transport procedure is to
exchange the EAP message between the 5G ProSe layer-3 remote UE and the 5G
ProSe layer-3 UE-to-network relay UE.
The 5G ProSe layer-3 remote UE in this procedure shall be a 5G ProSe-enabled
UE and is authorised to act as a 5G ProSe layer-3 remote UE towards a 5G ProSe
layer-3 UE-to-network relay UE based on the service authorization procedure as
specified in clause 5. The 5G ProSe layer-3 UE-to-network relay UE in this
procedure shall be a 5G ProSe-enabled UE and is authorised to act as a 5G
layer-3 ProSe UE-to-network relay UE based on the service authorization
procedure as specified in clause 5.
In this clause, the 5G ProSe layer-3 UE-to-network relay UE is the initiating
UE and the 5G ProSe layer-3 remote UE is the target UE.
#### 8.2.9.2 5G ProSe AA message reliable transport procedure initiation
The UE shall initiate a 5G ProSe AA message reliable transport procedure when
the UE receives the EAP message for the target UE from the network.
The UE shall generate a PROSE AA MESSAGE TRANSPORT REQUEST message. In this
message, during an EAP based authentication procedure, the initiating UE shall
include the EAP message IE set to the received EAP message for the target UE
from the network as specified in 3GPP TS 24.501 [11].
NOTE 1: In this release of this specification, the EAP message IE is always
included.
The initiating UE shall self-assign a source layer-2 ID and set the
destination layer-2 ID to the source layer-2 ID in the PROSE DIRECT LINK
ESTABLISHMENT REQUEST message, i.e., the target UE\'s layer-2 ID.
NOTE 2: The UE implementation ensures that any value of the self-assigned
source layer-2 ID is different from any other self-assigned source layer-2
ID(s) in use for 5G ProSe direct discovery as specified in clause 6.2.14,
clause 6.2.15 and clause 8.2.1 and is different from any other provisioned
destination layer-2 ID(s) as specified in clause 5.2.
After the PROSE AA MESSAGE TRANSPORT REQUEST message is generated, the
initiating UE shall pass this message to the lower layers for transmission
along with the initiating UE\'s layer-2 ID and the target UE\'s layer-2 ID and
start timer T5093. The UE shall not send a new PROSE AA MESSAGE TRANSPORT
REQUEST message to the same target UE while timer T5093 is running.
Figure 8.2.9.2.1: 5G ProSe AA message reliable transport procedure
#### 8.2.9.3 5G ProSe AA message reliable transport procedure accepted by the
target UE
Upon receiving a PROSE AA MESSAGE TRANSPORT REQUEST message, the target UE
shall pass the EAP message in the EAP message IE to the upper layer for the
external DN authentication.
When the upper layers provide an EAP message responding to the received EAP
message, the target UE shall generate a PROSE AA MESSAGE TRANSPORT RESPONSE
message including the EAP message IE set to the received EAP message from the
upper layers.
After the PROSE AA MESSAGE TRANSPORT RESPONSE message is generated, the target
UE shall pass this message to the lower layers for transmission along with the
initiating UE\'s layer-2 ID and the target UE\'s layer-2 ID.
#### 8.2.9.4 5G ProSe AA message reliable transport procedure completion by
the initiating UE
Upon receiving a PROSE AA MESSAGE TRANSPORT RESPONSE message, the UE shall
stop timer T5093 and shall pass the EAP message in the PROSE AA MESSAGE
TRANSPORT RESPONSE message to the lower layer and inform the lower layer to
initiate the PDU EAP message reliable transport procedure as specified in 3GPP
TS 24.501 [11].
#### 8.2.9.5 Abnormal cases
##### 8.2.9.5.1 Abnormal cases at the initiating UE
a) Timer T5093 expires.
The initiating UE shall retransmit the PROSE AA MESSAGE TRANSPORT REQUEST
message and restart timer T5093. After reaching the maximum number of allowed
retransmissions, the initiating UE shall abort the 5G ProSe AA message
reliable transport procedure and shall abort the ongoing procedure that
triggered the initiation of the 5G ProSe AA message reliable transport
procedure.
NOTE: The maximum number of allowed retransmissions is UE implementation
specific.
b) The need to use this 5G ProSe direct link no longer exists before the 5G
ProSe AA message reliable transport procedure is completed.
The initiating UE shall abort the 5G ProSe AA message reliable transport
procedure and shall abort the ongoing procedure that triggered the initiation
of the 5G ProSe AA message reliable transport procedure.
### 8.2.10 5G ProSe security procedures over PC8 interface
#### 8.2.10.1 General
##### 8.2.10.1.1 Transport protocol for PC8 messages
The UE and 5G PKMF shall use HTTP 1.1 as specified in IETF RFC 7230 [3] and
IETF RFC 7231 [4] as the transport protocol for PC8 messages over the PC8
interface. The PC8 messages described here shall be included in the body of
either an HTTP request message or an HTTP response message.
##### 8.2.10.1.2 Handling of UE-initiated procedures
###### 8.2.10.1.2.1 General
The following rules apply for UE-initiated procedures:
a) the UE initiates 5G ProSe transactions with an HTTP request message
containing the PC8 request(s);
b) the 5G PKMF responds to the requests with an HTTP response message
containing the PC8 response(s) for the PC8 request(s); and
c) HTTP POST methods are used for 5G ProSe procedures over PC8 interface.
The UE may use UE local configuration or URSP, as defined in 3GPP TS 24.526
[5], to establish a PDU session for reaching the HPLMN 5G PKMF:
a) if a PDU session for reaching the HPLMN 5G PKMF is not established yet, the
UE shall establish the PDU session for reaching the HPLMN 5G PKMF and shall
send the HTTP request message via the PDU session for reaching the HPLMN 5G
PKMF; and
b) if a PDU session for reaching the HPLMN 5G PKMF is already established
(e.g., either due to other 5G ProSe feature or due to other application), the
UE shall send the HTTP request message via the PDU session for reaching the
HPLMN 5G PKMF.
###### 8.2.10.1.2.2 5G PKMF discovery
The 5G PKMF address can be pre-configured in the UE, provided by the 5G DDNMF
or provided in the ProSeP by the PCF.
The UE shall use the 5G PKMF address in the following order of decreasing
precedence:
a) provided in the ProSeP by the PCF;
b) provided by the 5G DDNMF; and
c) pre-configured in the ME.
If the UE is pre-configured with the 5G PKMF address, does not have the 5G
PKMF address provided in the ProSeP by the PCF and does not have the 5G PKMF
address provided by the 5G DDNMF, the UE may access the 5G PKMF using the pre-
configured 5G PKMF address without requesting the 5G DDNMF to provide the 5G
PKMF address. In case that the UE cannot access the 5G PKMF using the pre-
configured 5G PKMF address, the UE may request the 5G DDNMF to provide the 5G
PKMF address.
#### 8.2.10.2 Procedures
##### 8.2.10.2.1 Types of 5G ProSe procedures over PC8 interface
The following procedures are defined:
a) 5G ProSe UE-to-network relay discovery security parameters request
procedure;
b) 5G ProSe remote user key request procedure; and
c) Key request procedure.
In the following descriptions of 5G procedures over PC8 interface, the terms
\"request\" and \"response\" refer to the corresponding PC8 messages, not to
the HTTP request or response. The following procedure descriptions use a
single PC8 message for illustration purposes.
The 5G ProSe procedures over PC8 interface shall be integrity protected and
confidentiality protected using the security procedures using GBA or AKMA, see
clause 5.2.5.3 and clause 5.2.5.4 in 3GPP TS 33.503 [34].
NOTE 1: A single HTTP request message can contain multiple PC8 requests and a
single HTTP response message can contain multiple PC8 responses.
NOTE 2: The privacy of the UE identity included in the PC8 messages of 5G
ProSe procedures over PC8 interface is ensured by the confidentiality
protection of those procedures.
##### 8.2.10.2.2 5G ProSe UE-to-network relay discovery security parameters
request procedure
###### 8.2.10.2.2.1 General
The purpose of the 5G ProSe UE-to-network relay discovery security parameters
request procedure is for the UE:
a) to obtain the 5G ProSe UE-to-network relay discovery security parameters
for 5G ProSe remote UE, applicable when the UE acts as a 5G ProSe remote UE
and uses the security procedure over user plane as specified in 3GPP TS 33.503
[34]; and
b) to obtain the 5G ProSe UE-to-network relay discovery security parameters
for 5G ProSe UE-to-network relay UE, applicable when the UE acts as a 5G ProSe
UE-to-network relay UE and uses the security procedure over user plane as
specified in 3GPP TS 33.503 [34].
###### 8.2.10.2.2.2 5G ProSe UE-to-network relay discovery security parameters
request procedure initiation
The UE shall initiate the 5G ProSe UE-to-network relay discovery security
parameters request procedure:
a) if the UE is authorized to act as a 5G ProSe remote UE and uses the
security procedure over user plane as specified in 3GPP TS 33.503 [34]:
1) when the UE has no 5G ProSe UE-to-network relay discovery security
parameters for 5G ProSe remote UE and the UE is in NG-RAN coverage; or
2) after expiration of timer T5094, when in NG-RAN coverage or when entering
NG-RAN coverage; or
b) if the UE is authorized to act as a 5G ProSe UE-to-network relay UE and
uses the security procedure over user plane as specified in 3GPP TS 33.503
[34]:
1) when the 5G ProSe UE-to-network relay discovery security parameters for 5G
ProSe UE-to-network relay UE and the UE is in NG-RAN coverage; or
2) after expiration of timer T5095, when in NG-RAN coverage or when entering
NG-RAN coverage.
The UE shall initiate the 5G ProSe UE-to-network relay discovery security
parameters request procedure by sending a PROSE_SECURITY_PARAM_REQUEST message
with the \ element. In the \ element, the UE:
a) shall include a new transaction ID;
b) shall indicate whether the UE requests the 5G ProSe UE-to-network relay
discovery security parameters for 5G ProSe remote UE, the 5G ProSe UE-to-
network relay discovery security parameters for 5G ProSe UE-to-network relay
UE or both;
c) shall include the PC5 UE security capabilities indicating ciphering
algorithms supported by the UE;
d) if the UE requests the 5G ProSe UE-to-network relay discovery security
parameters for 5G ProSe remote UE, may include a list of PLMN identities of
the visited PLMNs; and
e) may indicate the requested model indicating the model of the 5G ProSe UE-
to-network relay discovery over PC5 interface for which security parameters
are requested, set to \"model A\" or \"model B\".
NOTE: If the requested model is not included in the
PROSE_SECURITY_PARAM_REQUEST message, security parameters are requested for
both model A and model B of the 5G ProSe UE-to-network relay discovery over
PC5 interface.
Figure 8.2.10.2.2.2.1 illustrates the interaction of the UE and the 5G PKMF in
the 5G ProSe UE-to-network relay discovery security parameters request
procedure.
Figure 8.2.10.2.2.2.1: 5G ProSe UE-to-network relay discovery security
parameters request procedure
###### 8.2.10.2.2.3 5G ProSe UE-to-network relay discovery security parameters
request procedure accepted by the 5G PKMF
Upon receiving a PROSE_SECURITY_PARAM_REQUEST message with the \ element, if:
a) the UE requests the 5G ProSe UE-to-network relay discovery security
parameters for 5G ProSe remote UE only and the PROSE_SECURITY_PARAM_REQUEST
message is received over a TLS tunnel established by a UE authorized to act as
a 5G ProSe remote UE;
b) the UE requests the 5G ProSe UE-to-network relay discovery security
parameters for 5G ProSe UE-to-network relay UE only and the
PROSE_SECURITY_PARAM_REQUEST message is received over a TLS tunnel established
by a UE authorized to act as a 5G ProSe UE-to-network relay UE; or
c) the UE requests the 5G ProSe UE-to-network relay discovery security
parameters for 5G ProSe remote UE and the 5G ProSe UE-to-network relay
discovery security parameters for 5G ProSe UE-to-network relay UE and the
PROSE_SECURITY_PARAM_REQUEST message is received over a TLS tunnel established
by a UE authorized to act as a 5G ProSe UE-to-network relay UE and authorized
to act as a 5G ProSe remote UE;
the 5G PKMF shall send a PROSE_SECURITY_PARAM_RESPONSE message containing a
\ element. In the \ element, the 5G PKMF:
a) shall include the transaction ID set to the value of the transaction ID
received in the PROSE_SECURITY_PARAM_REQUEST message;
b) if the UE requests the 5G ProSe UE-to-network relay discovery security
parameters for 5G ProSe remote UE:
1) shall include the 5G ProSe UE-to-network relay discovery security
parameters for 5G ProSe remote UE. In the 5G ProSe UE-to-network relay
discovery security parameters for 5G ProSe remote UE, the 5G PKMF:
A) shall include the expiration timer of the 5G ProSe UE-to-network relay
discovery security parameters for 5G ProSe remote UE; and
B) for each relay service code for which the UE is authorized to act as a 5G
ProSe remote UE:
i) if the requested model is not indicated in the PROSE_SECURITY_PARAM_REQUEST
message or is set to \"model A\", may include the code-receiving security
parameters for model A containing one or more of DUSK, DUIK and DUCK with
associated encrypted bitmask;
ii) if the requested model is not indicated in the
PROSE_SECURITY_PARAM_REQUEST message or is set to \"model B\", may include the
code-receiving security parameters for model B containing one or more of DUSK,
DUIK and DUCK with associated encrypted bitmask and the code-sending security
parameters for model B containing one or more of DUSK, DUIK and DUCK with
associated encrypted bitmask; and
iii) shall include the selected ciphering algorithm; and
2) may include the PC5 security policies per relay service code for 5G ProSe
remote UE. In the PC5 security policies per relay service code for 5G ProSe
remote UE, the 5G PKMF:
A) for each relay service code for which the UE is authorized to act as a 5G
ProSe remote UE:
i) shall include the PC5 security policies;
c) if the UE requests the 5G ProSe UE-to-network relay discovery security
parameters for 5G ProSe UE-to-network relay UE:
1) shall include the 5G ProSe UE-to-network relay discovery security
parameters for 5G ProSe UE-to-network relay UE. In the 5G ProSe UE-to-network
relay discovery security parameters for 5G ProSe UE-to-network relay UE, the
5G PKMF:
A) shall include the expiration timer of the 5G ProSe UE-to-network relay
discovery security parameters for 5G ProSe UE-to-network relay UE; and
B) for each relay service code for which the UE is authorized to act as a 5G
ProSe UE-to-network relay UE:
i) if the requested model is not indicated in the PROSE_SECURITY_PARAM_REQUEST
message or is set to \"model A\", may include the code-sending security
parameters for model A containing one or more of DUSK, DUIK and DUCK with
associated encrypted bitmask;
ii) if the requested model is not indicated in the
PROSE_SECURITY_PARAM_REQUEST message or is set to \"model B\", may include the
code-receiving security parameters for model B containing one or more of DUSK,
DUIK and DUCK with associated encrypted bitmask and the code-sending security
parameters for model B containing one or more of DUSK, DUIK and DUCK with
associated encrypted bitmask; and
iii) shall include the selected ciphering algorithm; and
2) may include the PC5 security policies per relay service code for 5G ProSe
UE-to-network relay UE. In the PC5 security policies per relay service code
for 5G ProSe UE-to-network relay UE, the 5G PKMF:
A) for each relay service code for which the UE is authorized to act as a 5G
ProSe UE-to-network relay UE:
i) shall include the PC5 security policies; and
d) shall include the current time set to the current UTC-based time at the 5G
PKMF and the max offset.
If the UE requests the 5G ProSe UE-to-network relay discovery security
parameters for 5G ProSe remote UE, the UE identity in the
PROSE_SECURITY_PARAM_REQUEST message indicates a UE authorized to act as a 5G
ProSe remote UE and the PROSE_SECURITY_PARAM_REQUEST message contains a list
of PLMN identities of the visited PLMNs, the 5G PKMF shall include in the 5G
ProSe UE-to-network relay discovery security parameters for 5G ProSe remote UE
any information received from 5G PKMFs of potential 5G ProSe UE-to-network
relay UEs which can serve the UE.
###### 8.2.10.2.2.4 5G ProSe UE-to-network relay discovery security parameters
request procedure completion by the UE
Upon receipt of the PROSE_SECURITY_PARAM_RESPONSE message with the \, if the transaction ID contained in the
\ element matches the value sent by
the UE in a PROSE_SECURITY_PARAM_REQUEST message with the \ element, the UE:
a) if the PROSE_SECURITY_PARAM_RESPONSE message contains the 5G ProSe UE-to-
network relay discovery security parameters for 5G ProSe remote UE:
1) shall store the 5G ProSe UE-to-network relay discovery security parameters
for 5G ProSe remote UE, shall stop timer T5094, if running and shall start
timer T5094 with the value of the expiration timer indicated in the 5G ProSe
UE-to-network relay discovery security parameters for 5G ProSe remote UE; and
2) if the PC5 security policies per relay service code for 5G ProSe remote UE
are received, shall store the PC5 security policies per relay service code for
5G ProSe remote UE;
b) if the PROSE_SECURITY_PARAM_RESPONSE message contains the 5G ProSe UE-to-
network relay discovery security parameters for 5G ProSe UE-to-network relay
UE:
1) shall store the 5G ProSe UE-to-network relay discovery security parameters
for 5G ProSe UE-to-network relay UE, shall stop timer T5095, if running and
shall start timer T5081 with the value of the expiration timer indicated in
the 5G ProSe UE-to-network relay discovery security parameters for 5G ProSe
UE-to-network relay UE; and
2) if the PC5 security policies per relay service code for 5G ProSe UE-to-
network relay UE are received, shall store the PC5 security policies per relay
service code for 5G ProSe UE-to-network relay UE; and
c) shall set a ProSe clock (see 3GPP TS 33.503 [34]) to the value of the
received current time parameter and store the received max offset.
###### 8.2.10.2.2.5 5G ProSe UE-to-network relay discovery security parameters
request procedure not accepted by the 5G PKMF
If the PROSE_SECURITY_PARAM_REQUEST message with the \ element cannot be accepted by the 5G PKMF, the 5G PKMF
shall send a PROSE_SECURITY_PARAM_RESPONSE message containing a \ element. In the \ element, the 5G PKMF shall include the transaction
ID set to the value of the transaction ID received in the
PROSE_SECURITY_PARAM_REQUEST message and shall include an appropriate PC8
control protocol cause value.
Upon receipt of the PROSE_SECURITY_PARAM_RESPONSE message with the \ element, if the transaction ID contained
in the \ element matches the value
sent by the UE in a PROSE_SECURITY_PARAM_REQUEST message with the \ element, the UE shall consider the 5G
ProSe UE-to-network relay discovery security parameters request procedure as
rejected.
###### 8.2.10.2.2.6 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Indication from the transport layer of transmission failure of
PROSE_SECURITY_PARAM_REQUEST message (e.g. after TCP retransmission timeout).
The UE shall close the existing secure connection to the 5G PKMF, establish a
new secure connection and then restart the 5G ProSe UE-to-network relay
discovery security parameters request procedure.
b) No response from the 5G PKMF after the PROSE_SECURITY_PARAM_REQUEST message
has been successfully delivered (e.g. TCP ACK has been received for the
PROSE_SECURITY_PARAM_REQUEST message)
The UE shall retransmit the PROSE_SECURITY_PARAM_REQUEST message.
NOTE: The timer to trigger retransmission and the maximum number of allowed
retransmissions are UE implementation specific.
###### 8.2.10.2.2.7 Abnormal cases in the 5G PKMF
The following abnormal cases can be identified:
a) Indication from the lower layer of transmission failure of
PROSE_SECURITY_PARAM_RESPONSE message.
After receiving an indication from lower layer that the
PROSE_SECURITY_PARAM_RESPONSE message has not been successfully acknowledged
(e.g. TCP ACK is not received), the 5G PKMF shall abort the procedure.
##### 8.2.10.2.3 5G ProSe remote user key request procedure
###### 8.2.10.2.3.1 General
The purpose of the 5G ProSe remote user key request procedure is for the UE
authorized to act as a 5G ProSe remote UE to obtain a UP-PRUK and a UP-PRUK
ID.
Before initiating this procedure, the 5G ProSe remote UE needs to be
authorized to use a 5G ProSe layer-3 UE-to-network relay UE or a 5G ProSe
layer-2 UE-to-network relay UE in the registered PLMN or local PLMN based on
the configuration parameters as specified in clause 5.2.5.
###### 8.2.10.2.3.2 5G ProSe remote user key request procedure initiation
If the UE is authorized to use a 5G ProSe layer-3 UE-to-network relay UE or a
5G ProSe layer-2 UE-to-network relay UE in the registered PLMN or local PLMN,
and needs to be able to obtain a connectivity service from a 5G ProSe UE-to-
network relay UE, it shall initiate this procedure.
The UE shall initiate the 5G ProSe remote user key request procedure by
sending a PROSE_PRUK_REQUEST message with the \ element. In the
\ element, the UE:
a) shall include a new transaction ID not used in any other direct discovery
procedures in PC8 interface; and
b) shall include the UP-PRUK ID set to the UP-PRUK ID associated with the UE
stored UP-PRUK, if the UE stores UP-PRUK.
Figure 8.2.10.2.3.2.1 illustrates the interaction of the UE and the 5G PKMF in
the 5G ProSe remote user key request procedure.
Figure 8.2.10.2.3.2.1: 5G ProSe remote user key request procedure
###### 8.2.10.2.3.3 5G ProSe remote user key request procedure accepted by the
5G PKMF
Upon receiving a PROSE_PRUK_REQUEST message, the 5G PKMF shall check whether
the UE is authorized to act as a 5G ProSe remote UE. If authorized, the 5G
PKMF shall then send a PROSE_PRUK_RESPONSE message with the \
element. In the \ element, the 5G PKMF shall include:
a) the transaction ID set to the value of the transaction ID received in the
PROSE_PRUK_REQUEST message from the UE;
b) the UP-PRUK ID set to the value of the UP-PRUK ID associated with the UP-
PRUK; and
c) the UP-PRUK set to the value of the allocated UP-PRUK to the UE.
###### 8.2.10.2.3.4 5G ProSe remote user key request procedure completion by
the UE
Upon receipt of the PROSE_PRUK_RESPONSE message, if the transaction ID matches
the value sent by the UE in a PROSE_PRUK_REQUEST message, the UE shall delete
any previously stored UP-PRUK and UP-PRUK ID and store the received UP-PRUK
and the associtated UP-PRUK ID.
###### 8.2.10.2.3.5 5G ProSe remote user key request procedure not accepted by
the 5G PKMF
If the PROSE_PRUK_REQUEST message cannot be accepted by the 5G PKMF, the 5G
PKMF sends a PROSE_PRUK_RESPONSE message containing a \ element
to the UE including an appropriate PC8 control protocol cause value and
including the transaction ID set to the value of the transaction ID received
in the PC8_PRUK_REQUEST message.
Upon receipt of the PROSE_PRUK_RESPONSE message containing a \
element, if the transaction ID matches the value sent by the UE in a
PROSE_PRUK_REQUEST message, the UE shall consider the 5G ProSe remote user key
request procedure as rejected.
If the UE is not authorized for acting as a 5G ProSe remote UE, the 5G PKMF
shall send the PROSE_PRUK_RESPONSE message containing a \ element
with PC8 control protocol cause value #1 \"UE authorization failure\".
###### 8.2.10.2.3.6 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Indication from the transport layer of transmission failure of
PROSE_PRUK_REQUEST message (e.g., after TCP retransmission timeout).
The UE shall close the existing secure connection to the 5G PKMF, establish a
new secure connection and then restart the UP-PRUK request procedure.
b) No response from the 5G PKMF after the PROSE_PRUK_REQUEST message has been
successfully delivered (e.g., TCP ACK has been received for the
PROSE_PRUK_REQUEST message).
The UE shall retransmit the PROSE_PRUK_REQUEST message.
NOTE: The timer to trigger retransmission and the maximum number of allowed
retransmissions are UE implementation specific.
###### 8.2.10.2.3.7 Abnormal cases in the 5G PKMF
The following abnormal cases can be identified:
a) Indication from the lower layer of transmission failure of
PROSE_PRUK_RESPONSE message.
After receiving an indication from lower layer that the PROSE_PRUK_RESPONSE
message has not been successfully acknowledged (e.g. TCP ACK is not received),
the 5G PKMF shall abort the procedure.
##### 8.2.10.2.4 Key request procedure
###### 8.2.10.2.4.1 General
The purpose of the key request procedure is for a UE acting as a 5G ProSe UE-
to-network relay to obtain security parameter needed for establishment of 5G
ProSe direct link with a 5G ProSe remote UE.
###### 8.2.10.2.4.2 Key request procedure initiation
The UE shall initiate the key request procedure:
a) when the UE acting as a 5G ProSe UE-to-network relay for a relay service
code receives a request to establish a 5G ProSe direct link from a 5G ProSe
remote UE; and
b) when a 5G ProSe direct link security mode control procedure is rejected by
the 5G ProSe remote UE due to the authentication synchronisation error.
The UE shall initiate the key request procedure by sending a PROSE_KEY_REQUEST
message with the \ element. In the \ element, the
UE:
a) shall include a new transaction ID;
b) shall include the relay service code for which the 5G ProSe direct link is
requested to be established;
c) shall include the SUCI or the UP-PRUK ID of the 5G ProSe remote UE,
received from the 5G ProSe remote UE;
d) shall include the K~NRP~ freshness parameter 1, received from the 5G ProSe
remote UE;
e) shall include the PLMN identity of the HPLMN of the 5G ProSe remote UE, if
received from the 5G ProSe remote UE; and
f) if the key request procedure is initiated upon a 5G ProSe direct link
security mode control procedure being rejected by the 5G ProSe remote UE due
to the authentication synchronisation error, shall include the AUTS and the
RAND, received from the 5G ProSe remote UE.
Figure 8.2.10.2.4.2.1 illustrates the interaction of the UE and the 5G PKMF in
the Key request procedure.
Figure 8.2.10.2.4.2.1: Key request procedure
###### 8.2.10.2.4.3 Key request procedure accepted by the 5G PKMF
Upon receiving a PROSE_KEY_REQUEST message with the \ element,
if:
a) the PROSE_KEY_REQUEST message is received over a TLS tunnel established by
a UE authorized to act as a 5G ProSe UE-to-network relay for the relay service
code indicated in the PROSE_KEY_REQUEST message; and
b) the 5G ProSe remote UE identified by the SUCI, the UP-PRUK ID or the AUTS
provided by the 5G ProSe remote UE and the PLMN identity of the HPLMN of the
5G ProSe remote UE, if any, indicated in the PROSE_KEY_REQUEST message is
authorized to act as a 5G ProSe remote UE for the relay service code indicated
in the PROSE_KEY_REQUEST message;
the 5G PKMF shall send a PROSE_KEY_RESPONSE message containing a \
element. In the \ element, the 5G PKMF:
a) shall include the transaction ID set to the value of the transaction ID
received in the PROSE_KEY_REQUEST message;
b) shall include the UP-PRUK ID of the 5G ProSe remote UE;
c) shall include the K~NRP~;
d) shall include the K~NRP~ freshness parameter 2; and
e) if the AUTS and the RAND are included in the PROSE_KEY_REQUEST message or a
new UP-PRUK is required, then shall include the GBA push information (GPI).
If the 5G ProSe remote UE is served by another 5G PKMF, the 5G PKMF of the 5G
ProSe UE-to-network relay requests the 5G PKMF of the 5G ProSe remote UE to
check that the 5G ProSe remote UE identified by the SUCI, the UP-PRUK ID or
the AUTS provided by the 5G ProSe remote UE and the PLMN identity of the HPLMN
of the 5G ProSe remote UE, if any, indicated in the PROSE_KEY_REQUEST message,
is authorized to act a 5G ProSe remote UE for the relay service code indicated
in the PROSE_KEY_REQUEST message and to provide the UP-PRUK ID of the 5G ProSe
remote UE, the K~NRP~, the K~NRP~ freshness parameter 2, and optionally the
GBA push information (GPI).
###### 8.2.10.2.4.4 Key request procedure completion by the UE
Upon receipt of the PROSE_KEY_RESPONSE message with the \ element,
if the transaction ID contained in the \ element matches the value
sent by the UE in a PROSE_KEY_REQUEST message with the \ element,
the UE shall use the UP-PRUK ID of the 5G ProSe remote UE, the K~NRP~, the
K~NRP~ freshness parameter 2 and the GBA push information (GPI), if received,
in the 5G ProSe direct link establishment.
###### 8.2.10.2.4.5 Key request procedure not accepted by the 5G PKMF
If the PROSE_KEY_REQUEST message with \ element cannot be
accepted by the 5G PKMF, the 5G PKMF shall send a PROSE_KEY_RESPONSE message
containing a \ element. In the \ element, the 5G PKMF
shall include the transaction ID set to the value of the transaction ID
received in the PROSE_KEY_REQUEST message and shall include an appropriate PC8
control protocol cause value.
NOTE: The 5G PKMF decides to reject the PROSE_KEY_REQUEST message when e.g.
the UP-PRUK is not found in the network.
Upon receipt of the PROSE_KEY_RESPONSE message with the \ element,
if the transaction ID contained in the \ element matches the value
sent by the UE in a PROSE_KEY_REQUEST message with the \ element,
the UE shall consider the key request procedure as rejected.
###### 8.2.10.2.4.6 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Indication from the transport layer of transmission failure of
PROSE_KEY_REQUEST message (e.g., after TCP retransmission timeout)
The UE shall close the existing secure connection to the 5G PKMF, establish a
new secure connection and then restart the key request procedure.
b) No response from the 5G PKMF after the PROSE_KEY_REQUEST message has been
successfully delivered (e.g. TCP ACK has been received for the
PROSE_KEY_REQUEST message)
The UE shall retransmit the PROSE_KEY_REQUEST message.
NOTE: The timer to trigger retransmission and the maximum number of allowed
retransmissions are UE implementation specific.
###### 8.2.10.2.4.7 Abnormal cases in the 5G PKMF
The following abnormal cases can be identified:
a) Indication from the lower layer of transmission failure of
PROSE_KEY_RESPONSE message
After receiving an indication from lower layer that the PROSE_KEY_RESPONSE
message has not been successfully acknowledged (e.g., TCP ACK is not
received), the 5G PKMF shall abort the procedure.
### 8.2.11 UE-to-network relay unicast direct communication over PC5 interface
The direct communication between 5G ProSe remote UE and 5G ProSe UE-to-network
relay UE reuses the procedures for unicast mode 5G ProSe direct communication
over PC5 described in clause 7.2.
NOTE: Any modifications needed to the procedures defined for unicast mode 5G
ProSe direct communication over PC5 to support the direct communication
between 5G ProSe remote UE and 5G ProSe UE-to-network relay UE are described
within clause 7.2.
### 8.2.12 5G ProSe security procedures over PC3a interface
#### 8.2.12.1 General
##### 8.2.12.1.1 Transport protocol for PC3a messages
The UE and 5G DDNMF shall use HTTP 1.1 as specified in IETF RFC 7230 [3] and
IETF RFC 7231 [4] as the transport protocol for PC3a messages over the PC3a
interface. The PC3a messages described here shall be included in the body of
either an HTTP request message or an HTTP response message.
##### 8.2.12.1.2 Handling of UE-initiated procedures
###### 8.2.12.1.2.1 General
The following rules apply for UE-initiated procedures:
a) the UE initiates 5G ProSe transactions with an HTTP request message
containing the PC3a request(s);
b) the 5G DDNMF responds to the requests with an HTTP response message
containing the PC3a response(s) for the PC3a request(s); and
c) HTTP POST methods are used for 5G ProSe procedures over PC3a interface.
The UE may use UE local configuration or URSP, as defined in 3GPP TS 24.526
[5], to establish a PDU session for reaching the HPLMN 5G DDNMF:
a) if a PDU session for reaching the HPLMN 5G DDNMF is not established yet,
the UE shall establish the PDU session for reaching the HPLMN 5G DDNMF and
shall send the HTTP request message via the PDU session for reaching the HPLMN
5G DDNMF; and
b) if a PDU session for reaching the HPLMN 5G DDNMF is already established
(e.g., either due to other 5G ProSe feature or due to other application), the
UE shall send the HTTP request message via the PDU session for reaching the
HPLMN 5G DDNMF.
###### 8.2.12.1.2.2 5G DDNMF discovery
#### The 5G DDNMF discovery is the same as described in clause
6.1.2.2.8.2.12.2 Procedures
##### 8.2.12.2.1 Types of 5G ProSe security procedures over PC3a interface
The following procedures are defined:
a) 5G ProSe UE-to-network relay discovery security material request procedure.
In the following descriptions of 5G procedures over PC3a interface, the terms
\"request\" and \"response\" refer to the corresponding PC3a messages, not to
the HTTP request or response. The following procedure descriptions use a
single PC3a message for illustration purposes.
The PC3a control protocol procedures for 5G ProSe direct discovery shall be
integrity protected and confidentiality protected using the security
procedures defined in clause 5.2.3 in 3GPP TS 33.503 [34].
NOTE: A single HTTP request message can contain multiple PC3a control protocol
requests and a single HTTP response message can contain multiple PC3a control
protocol responses.
When the TLS tunnel between the UE and the 5G DDNMF for transport of PC3a
messages is established by the UE according to 3GPP TS 33.503 [34], the 5G
DDNMF shall obtain identity of the served UE using the procedures specified in
3GPP TS 33.220 [46] or 3GPP TS 33.535 [47].
##### 8.2.12.2.2 5G ProSe UE-to-network relay discovery security material
request procedure
###### 8.2.12.2.2.1 General
The purpose of the 5G ProSe UE-to-network relay discovery security material
request procedure is for the UE:
a) to obtain the 5G ProSe UE-to-network relay discovery security material for
5G ProSe remote UE, applicable when the UE acts as a 5G ProSe remote UE and
uses the security procedure over control plane as specified in 3GPP TS 33.503
[34]; and
b) to obtain the 5G ProSe UE-to-network relay discovery security material for
5G ProSe UE-to-network relay UE, applicable when the UE acts as a 5G ProSe UE-
to-network relay UE and uses the security procedure over control plane as
specified in 3GPP TS 33.503 [34].
###### 8.2.12.2.2.2 5G ProSe UE-to-network relay discovery security material
request procedure initiation
The UE shall initiate the 5G ProSe UE-to-network relay discovery security
material request procedure:
a) if the UE is authorized to act as a 5G ProSe remote UE and uses the
security procedure over control plane as specified in 3GPP TS 33.503 [34]:
1) when the UE has no 5G ProSe UE-to-network relay discovery security material
for 5G ProSe remote UE and the UE is in NG-RAN coverage; or
2) after expiration of timer T5078, when in NG-RAN coverage or when entering
NG-RAN coverage; or
b) if the UE is authorized to act as a 5G ProSe UE-to-network relay UE and
uses the security procedure over control plane as specified in 3GPP TS 33.503
[34]:
1) when the UE has no 5G ProSe UE-to-network relay discovery security material
for 5G ProSe UE-to-network relay UE and the UE is in NG-RAN coverage; or
2) after expiration of timer T5079, when in NG-RAN coverage or when entering
NG-RAN coverage.
The UE shall initiate the 5G ProSe UE-to-network relay discovery security
material request procedure by sending a PROSE_SECURITY_MATERIAL_REQUEST
message with the \ element. In the
\ element, the UE:
a) shall include a new transaction ID;
b) shall indicate whether the UE requests the 5G ProSe UE-to-network relay
discovery security material for 5G ProSe remote UE, the 5G ProSe UE-to-network
relay discovery security material for 5G ProSe UE-to-network relay UE or both;
c) shall include the PC5 UE security capabilities indicating ciphering
algorithms supported by the UE;
d) if the UE requests the 5G ProSe UE-to-network relay discovery security
material for 5G ProSe remote UE, may include a list of PLMN identities of the
visited PLMNs; and
e) may indicate the requested model indicating the model of the 5G ProSe UE-
to-network relay discovery over PC5 interface for which security parameters
are requested, set to \"model A\" or \"model B\".
NOTE: If the requested model is not included in the
PROSE_SECURITY_MATERIAL_REQUEST message, security parameters are requested for
both model A and model B of the 5G ProSe UE-to-network relay discovery over
PC5 interface.
Figure 8.2.12.2.2.2.1 illustrates the interaction of the UE and the 5G DDNMF
in the 5G ProSe UE-to-network relay discovery security material request
procedure.
Figure 8.2.12.2.2.2.1: 5G ProSe UE-to-network relay discovery security
material request procedure
###### 8.2.12.2.2.3 5G ProSe UE-to-network relay discovery security material
request procedure accepted by the 5G DDNMF
Upon receiving a PROSE_SECURITY_MATERIAL_REQUEST message with the \ element, if:
a) the UE requests the 5G ProSe UE-to-network relay discovery security
material for 5G ProSe remote UE only and the PROSE_SECURITY_MATERIAL_REQUEST
message is received over a TLS tunnel established by a UE authorized to act as
a 5G ProSe remote UE;
b) the UE requests the 5G ProSe UE-to-network relay discovery security
material for 5G ProSe UE-to-network relay UE only and the
PROSE_SECURITY_MATERIAL_REQUEST message is received over a TLS tunnel
established by a UE authorized to act as a 5G ProSe UE-to-network relay UE; or
c) the UE requests the 5G ProSe UE-to-network relay discovery security
material for 5G ProSe remote UE and the 5G ProSe UE-to-network relay discovery
security material for 5G ProSe UE-to-network relay UE and the
PROSE_SECURITY_MATERIAL_REQUEST message is received over a TLS tunnel
established by a UE authorized to act as a 5G ProSe UE-to-network relay UE and
authorized to act as a 5G ProSe remote UE;
the 5G DDNMF shall send a PROSE_SECURITY_MATERIAL_RESPONSE message containing
a \ element. In the \ element, the 5G DDNMF:
a) shall include the transaction ID set to the value of the transaction ID
received in the PROSE_SECURITY_MATERIAL_REQUEST message;
b) if the UE requests the 5G ProSe UE-to-network relay discovery security
material for 5G ProSe remote UE:
1) shall include the 5G ProSe UE-to-network relay discovery security material
for 5G ProSe remote UE. In the 5G ProSe UE-to-network relay discovery security
material for 5G ProSe remote UE, the 5G DDNMF:
A) shall include the expiration timer of the 5G ProSe UE-to-network relay
discovery security material for 5G ProSe remote UE; and
B) for each relay service code for which the UE is authorized to act as a 5G
ProSe remote UE:
i) if the requested model is not indicated in the
PROSE_SECURITY_MATERIAL_REQUEST message or is set to \"model A\", may include
the code-receiving security parameters for model A containing one or more of
DUSK, DUIK and DUCK with associated encrypted bitmask;
ii) if the requested model is not indicated in the
PROSE_SECURITY_MATERIAL_REQUEST message or is set to \"model B\", may include
the code-receiving security parameters for model B containing one or more of
DUSK, DUIK and DUCK with associated encrypted bitmask and the code-sending
security parameters for model B containing one or more of DUSK, DUIK and DUCK
with associated encrypted bitmask; and
iii) shall include the selected ciphering algorithm; and
2) may include the PC5 security policies per relay service code for 5G ProSe
remote UE. In the PC5 security policies per relay service code for 5G ProSe
remote UE, the 5G DDNMF:
A) for each relay service code for which the UE is authorized to act as a 5G
ProSe remote UE:
i) shall include the PC5 security policies;
c) if the UE requests the 5G ProSe UE-to-network relay discovery security
material for 5G ProSe UE-to-network relay UE:
1) shall include the 5G ProSe UE-to-network relay discovery security material
for 5G ProSe UE-to-network relay UE. In the 5G ProSe UE-to-network relay
discovery security material for 5G ProSe UE-to-network relay UE, the 5G DDNMF:
A) shall include the expiration timer of the 5G ProSe UE-to-network relay
discovery security material for 5G ProSe UE-to-network relay UE; and
B) for each relay service code for which the UE is authorized to act as a 5G
ProSe UE-to-network relay UE:
i) if the requested model is not indicated in the
PROSE_SECURITY_MATERIAL_REQUEST message or is set to \"model A\", may include
the code-sending security parameters for model A containing one or more of
DUSK, DUIK and DUCK with associated encrypted bitmask;
ii) if the requested model is not indicated in the
PROSE_SECURITY_MATERIAL_REQUEST message or is set to \"model B\", may include
the code-receiving security parameters for model B containing one or more of
DUSK, DUIK and DUCK with associated encrypted bitmask and the code-sending
security parameters for model B containing one or more of DUSK, DUIK and DUCK
with associated encrypted bitmask; and
iii) shall include the selected ciphering algorithm; and
2) may include the PC5 security policies per relay service code for 5G ProSe
UE-to-network relay UE. In the PC5 security policies per relay service code
for 5G ProSe UE-to-network relay UE, the 5G DDNMF:
A) for each relay service code for which the UE is authorized to act as a 5G
ProSe UE-to-network relay UE:
i) shall include the PC5 security policies; and
d) shall include the current time set to the current UTC-based time at the 5G
DDNMF and the max offset.
If the UE requests the 5G ProSe UE-to-network relay discovery security
material for 5G ProSe remote UE, the UE identity in the
PROSE_SECURITY_MATERIAL_REQUEST message indicates a UE authorized to act as a
5G ProSe remote UE and the PROSE_SECURITY_MATERIAL_REQUEST message contains a
list of PLMN identities of the visited PLMNs, the 5G DDNMF shall include in
the 5G ProSe UE-to-network relay discovery security material for 5G ProSe
remote UE any information received from 5G DDNMFs of potential 5G ProSe UE-to-
network relay UEs which can serve the UE.
###### 8.2.12.2.2.4 5G ProSe UE-to-network relay discovery security material
request procedure completion by the UE
Upon receipt of the PROSE_SECURITY_MATERIAL_RESPONSE message with the \, if the transaction ID contained in the
\ element matches the value sent by
the UE in a PROSE_SECURITY_MATERIAL_REQUEST message with the \ element, the UE:
a) if the PROSE_SECURITY_MATERIAL_RESPONSE message contains the 5G ProSe UE-
to-network relay discovery security material for 5G ProSe remote UE:
1) shall store the 5G ProSe UE-to-network relay discovery security material
for 5G ProSe remote UE, shall stop timer T5078, if running and shall start
timer T5078 with the value of the expiration timer indicated in the 5G ProSe
UE-to-network relay discovery security material for 5G ProSe remote UE; and
2) if the PC5 security policies per relay service code for 5G ProSe remote UE
are received, shall store the PC5 security policies per relay service code for
5G ProSe remote UE;
b) if the PROSE_SECURITY_MATERIAL_RESPONSE message contains the 5G ProSe UE-
to-network relay discovery security material for 5G ProSe UE-to-network relay
UE:
1) shall store the 5G ProSe UE-to-network relay discovery security material
for 5G ProSe UE-to-network relay UE, shall stop timer T5079, if running and
shall start timer T5079 with the value of the expiration timer indicated in
the 5G ProSe UE-to-network relay discovery security material for 5G ProSe UE-
to-network relay UE; and
2) if the PC5 security policies per relay service code for 5G ProSe UE-to-
network relay UE are received, shall store the PC5 security policies per relay
service code for 5G ProSe UE-to-network relay UE; and
c) shall set a ProSe clock (see 3GPP TS 33.503 [34]) to the value of the
received current time parameter and store the received max offset.
###### 8.2.12.2.2.5 5G ProSe UE-to-network relay discovery security material
request procedure not accepted by the 5G DDNMF
If the PROSE_SECURITY_MATERIAL_REQUEST message with the \ element cannot be accepted by the 5G DDNMF, the
5G DDNMF shall send a PROSE_SECURITY_MATERIAL_RESPONSE message containing a
\ element. In the \ element, the 5G DDNMF shall include the
transaction ID set to the value of the transaction ID received in the
PROSE_SECURITY_MATERIAL_REQUEST message and shall include an appropriate PC3a
control protocol cause value.
Upon receipt of the PROSE_SECURITY_MATERIAL_RESPONSE message with the \ element, if the transaction ID contained
in the \ element matches the value
sent by the UE in a PROSE_SECURITY_MATERIAL_REQUEST message with the \ element, the UE shall consider the 5G
ProSe UE-to-network relay discovery security material request procedure as
rejected.
###### 8.2.12.2.2.6 Abnormal cases in the UE
The following abnormal cases can be identified:
a) Indication from the transport layer of transmission failure of
PROSE_SECURITY_MATERIAL_REQUEST message (e.g. after TCP retransmission
timeout).
The UE shall close the existing secure connection to the 5G DDNMF, establish a
new secure connection and then restart the 5G ProSe UE-to-network relay
discovery security material request procedure.
b) No response from the 5G DDNMF after the PROSE_SECURITY_MATERIAL_REQUEST
message has been successfully delivered (e.g. TCP ACK has been received for
the PROSE_SECURITY_MATERIAL_REQUEST message)
The UE shall retransmit the PROSE_SECURITY_MATERIAL_REQUEST message.
NOTE: The timer to trigger retransmission and the maximum number of allowed
retransmissions are UE implementation specific.
###### 8.2.12.2.2.7 Abnormal cases in the 5G DDNMF
The following abnormal cases can be identified:
a) Indication from the lower layer of transmission failure of
PROSE_SECURITY_MATERIAL_RESPONSE message.
After receiving an indication from lower layer that the
PROSE_SECURITY_MATERIAL_RESPONSE message has not been successfully
acknowledged (e.g. TCP ACK is not received), the 5G DDNMF shall abort the
procedure.
# 9 Handling of unknown, unforeseen and erroneous protocol data
## 9.1 General
The procedures specified in the present document apply to those PC3a, PC8 or
PC5 messages which pass the checks described in this clause.
This clause also specifies procedures for the handling of unknown, unforeseen
and erroneous protocol data by the receiving entity. These procedures are
called \"error handling procedures\", but in addition to providing recovery
mechanisms for error situations they define a compatibility mechanism for
future extensions of the protocols.
Detailed error handling procedures in the network are implementation dependent
and may vary from PLMN to PLMN. However, when extensions of this protocol are
developed, networks will be assumed to have the error handling that is
indicated in this clause as mandatory (\"shall\") and that is indicated as
strongly recommended (\"should\").
Also, the error handling of the network is only considered as mandatory or
strongly recommended when certain thresholds for errors are not reached during
a dedicated connection.
## 9.2 Handling of unknown, unforeseen and erroneous protocol data in messages
sent over the PC3a or PC8 interface
### 9.2.1 Unforeseen message type
If the UE receives a PC3a or PC8 message with a message type corresponding to
a ProSe discovery mechanism that the UE is not authorised to use by the
network, the UE shall discard the message.
If the DDNMF receives a PC3a message or the 5G PKMF receives a PC8 message,
whose message type indicates that this is a ProSe discovery mechanism the
sending UE is not authorised to support, the DDNMF or the the 5G PKMF shall
discard the message.
## 9.3 Handling of unknown, unforeseen and erroneous protocol data in messages
sent over the PC5 interface
### 9.3.1 Message too short or too long
#### 9.3.1.1 Message too short
When a message is received that is too short to contain a complete message
type information element, that message shall be ignored, cf. 3GPP TS 24.007
[20].
#### 9.3.1.2 Message too long
The maximum size of a PC5 signalling message is 65535 octets.
### 9.3.2 Unknown or unforeseen message type
If the UE receives a PC5 signalling message with message type not defined for
the PC5 signalling protocol or not implemented by the receiver, it shall
ignore the PC5 signalling message.
NOTE: A message type not defined for the PC5 signalling protocol in the given
direction is regarded by the receiver as a message type not defined for the
PC5 signalling protocol, see 3GPP TS 24.007 [20].
If the UE receives a message not compatible with the PC5 signalling protocol
state, the UE shall ignore the PC5 signalling message.
### 9.3.3 Non-semantical mandatory information element errors
When on receipt of a message,
a) an \"imperative message part\" error; or
b) a \"missing mandatory IE\" error
is diagnosed or when a message containing:
a) a syntactically incorrect mandatory IE;
b) an IE unknown in the message, but encoded as \"comprehension required\"
(see 3GPP TS 24.007 [20]); or
c) an out of sequence IE encoded as \"comprehension required\" (see 3GPP TS
24.007 [20]) is received,
the UE shall ignore the PC5 signalling message.
### 9.3.4 Unknown and unforeseen IEs in the non-imperative message part
#### 9.3.4.1 IEIs unknown in the message
The UE shall ignore all IEs unknown in a message which are not encoded as
\"comprehension required\" (see 3GPP TS 24.007 [20]).
#### 9.3.4.2 Out of sequence IEs
The UE shall ignore all out of sequence IEs in a message which are not encoded
as \"comprehension required\" (see 3GPP TS 24.007 [20]).
#### 9.3.4.3 Repeated IEs
If an information element with format T, TV, TLV, or TLV-E is repeated in a
message in which repetition of the information element is not specified in
clause 11.3, the UE shall handle only the contents of the information element
appearing first and shall ignore all subsequent repetitions of the information
element. When repetition of information elements is specified, the UE shall
handle only the contents of specified repeated information elements. If the
limit on repetition of information elements is exceeded, the UE shall handle
the contents of information elements appearing first up to the limit of
repetitions and shall ignore all subsequent repetitions of the information
element.
### 9.3.5 Non-imperative message part errors
#### 9.3.5.1 General
This category includes:
a) syntactically incorrect optional IEs; and
b) conditional IE errors.
#### 9.3.5.2 Syntactically incorrect optional IEs
The UE shall treat all optional IEs that are syntactically incorrect in a
message as not present in the message.
#### 9.3.5.3 Conditional IE errors
When upon receipt of a PC5 signalling message, the UE diagnoses a \"missing
conditional IE\" error or an \"unexpected conditional IE\" error, or when it
receives a PC5 signalling message containing at least one syntactically
incorrect conditional IE, the UE shall ignore the message.
### 9.3.6 Messages with semantically incorrect contents
When a message with semantically incorrect contents is received, the UE shall
perform the foreseen reactions of the procedural part of clause 7.2. If,
however no such reactions are specified, the UE shall ignore the message.
# 10 Message functional definitions and contents
## 10.1 Overview
This clause contains the definition and contents of the messages used in the
procedures described in the present document.
## 10.2 5G ProSe direct discovery messages
### 10.2.1 Message definition
This message is sent by the UE over the PC5 interface for open 5G ProSe direct
discovery and restricted 5G ProSe direct discovery. See table 10.2.1.1, table
10.2.1.2, table 10.2.1.3, table 10.2.1.4, table 10.2.1.5, table 10.2.1.6,
table 10.2.1.7, table 10.2.1.8, table 10.2.1.9, table 10.2.1.10 and table
10.2.1.11.
Message type: PROSE PC5 DISCOVERY
Significance: dual
Direction: UE to peer UE
Table 10.2.1.1: PROSE PC5 DISCOVERY message content for open 5G ProSe direct
discovery announcement
+-----------+-----------+-----------+----------+--------+--------+ | IEI | In | Type/ | Presence | Format | Length | | | formation | Reference | | | | | | Element | | | | | +===========+===========+===========+==========+========+========+ | | ProSe | ProSe | M | V | 1 | | | direct | direct | | | | | | discovery | discovery | | | | | | PC5 | PC5 | | | | | | message | message | | | | | | type | type | | | | | | (NOTE) | | | | | | | | 11.2.1 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | UTC-based | UTC-based | M | V | 1 | | | counter | counter | | | | | | LSB | LSB | | | | | | | | | | | | | | 11.2.14 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | MIC | MIC | M | V | 4 | | | | | | | | | | | 11.2.4 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | ProSe | ProSe | M | V | 23 | | | ap | ap | | | | | | plication | plication | | | | | | code | code | | | | | | | | | | | | | | 11.2.2 | | | | +-----------+-----------+-----------+----------+--------+--------+ | 7A | Metadata | Metadata | O | TLV-E | 4-8195 | | | | | | | | | | | 11.2.13 | | | | +-----------+-----------+-----------+----------+--------+--------+ | NOTE: The | | | | | | | discovery | | | | | | | type is | | | | | | | set to | | | | | | | \"Open | | | | | | | di | | | | | | | scovery\" | | | | | | | and the | | | | | | | content | | | | | | | type is | | | | | | | set to | | | | | | | \"Announ | | | | | | | cement\". | | | | | | +-----------+-----------+-----------+----------+--------+--------+
Table 10.2.1.2: PROSE PC5 DISCOVERY message content for restricted 5G ProSe
direct discovery announcement
+-----------+-----------+-----------+----------+--------+--------+ | IEI | In | Type/ | Presence | Format | Length | | | formation | Reference | | | | | | Element | | | | | +===========+===========+===========+==========+========+========+ | | ProSe | ProSe | M | V | 1 | | | direct | direct | | | | | | discovery | discovery | | | | | | PC5 | PC5 | | | | | | message | message | | | | | | type | type | | | | | | (NOTE) | | | | | | | | 11.2.1 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | UTC-based | UTC-based | M | V | 1 | | | counter | counter | | | | | | LSB | LSB | | | | | | | | | | | | | | 11.2.14 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | MIC | MIC | M | V | 4 | | | | | | | | | | | 11.2.4 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | ProSe | ProSe | M | V | 23 | | | r | r | | | | | | estricted | estricted | | | | | | code | code | | | | | | | | | | | | | | 11.2.3 | | | | +-----------+-----------+-----------+----------+--------+--------+ | 7A | Metadata | Metadata | O | TLV-E | 4-8195 | | | | | | | | | | | 11.2.13 | | | | +-----------+-----------+-----------+----------+--------+--------+ | NOTE: The | | | | | | | discovery | | | | | | | type is | | | | | | | set to | | | | | | | \"R | | | | | | | estricted | | | | | | | di | | | | | | | scovery\" | | | | | | | and the | | | | | | | content | | | | | | | type is | | | | | | | set to | | | | | | | \"Announ | | | | | | | cement\". | | | | | | +-----------+-----------+-----------+----------+--------+--------+
Table 10.2.1.3: PROSE PC5 DISCOVERY message content for restricted 5G ProSe
direct discovery solicitation
+-----------+-----------+-----------+----------+--------+--------+ | IEI | In | Type/ | Presence | Format | Length | | | formation | Reference | | | | | | Element | | | | | +===========+===========+===========+==========+========+========+ | | ProSe | ProSe | M | V | 1 | | | direct | direct | | | | | | discovery | discovery | | | | | | PC5 | PC5 | | | | | | message | message | | | | | | type | type | | | | | | (NOTE) | | | | | | | | 11.2.1 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | UTC-based | UTC-based | M | V | 1 | | | counter | counter | | | | | | LSB | LSB | | | | | | | | | | | | | | 11.2.14 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | MIC | MIC | M | V | 4 | | | | | | | | | | | 11.2.4 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | ProSe | ProSe | M | V | 23 | | | query | r | | | | | | code | estricted | | | | | | | code | | | | | | | | | | | | | | 11.2.3 | | | | +-----------+-----------+-----------+----------+--------+--------+ | NOTE: The | | | | | | | discovery | | | | | | | type is | | | | | | | set to | | | | | | | \"R | | | | | | | estricted | | | | | | | di | | | | | | | scovery\" | | | | | | | and the | | | | | | | content | | | | | | | type is | | | | | | | set to | | | | | | | \"Solici | | | | | | | tation\". | | | | | | +-----------+-----------+-----------+----------+--------+--------+
Table 10.2.1.4: PROSE PC5 DISCOVERY message content for restricted 5G ProSe
direct discovery response
+-----------+-----------+-----------+----------+--------+--------+ | IEI | In | Type/ | Presence | Format | Length | | | formation | Reference | | | | | | Element | | | | | +===========+===========+===========+==========+========+========+ | | ProSe | ProSe | M | V | 1 | | | direct | direct | | | | | | discovery | discovery | | | | | | PC5 | PC5 | | | | | | message | message | | | | | | type | type | | | | | | (NOTE) | | | | | | | | 11.2.1 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | UTC-based | UTC-based | M | V | 1 | | | counter | counter | | | | | | LSB | LSB | | | | | | | | | | | | | | 11.2.14 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | MIC | MIC | M | V | 4 | | | | | | | | | | | 11.2.4 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | ProSe | ProSe | M | V | 23 | | | response | r | | | | | | code | estricted | | | | | | | code | | | | | | | | | | | | | | 11.2.3 | | | | +-----------+-----------+-----------+----------+--------+--------+ | 7A | Metadata | Metadata | O | TLV-E | 4-8195 | | | | | | | | | | | 11.2.13 | | | | +-----------+-----------+-----------+----------+--------+--------+ | NOTE: The | | | | | | | discovery | | | | | | | type is | | | | | | | set to | | | | | | | \"R | | | | | | | estricted | | | | | | | di | | | | | | | scovery\" | | | | | | | and the | | | | | | | content | | | | | | | type is | | | | | | | set to | | | | | | | \"re | | | | | | | sponse\". | | | | | | +-----------+-----------+-----------+----------+--------+--------+
Table 10.2.1.5: PROSE PC5 DISCOVERY message for group member discovery
announcement
+-----------+-----------+-----------+----------+--------+--------+ | IEI | In | Type/ | Presence | Format | Length | | | formation | Reference | | | | | | Element | | | | | +===========+===========+===========+==========+========+========+ | | ProSe | ProSe | M | V | 1 | | | direct | direct | | | | | | discovery | discovery | | | | | | PC5 | PC5 | | | | | | message | message | | | | | | type | type | | | | | | (NOTE) | | | | | | | | 11.2.1 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | UTC-based | UTC-based | M | V | 1 | | | counter | counter | | | | | | LSB | LSB | | | | | | | | | | | | | | 11.2.14 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | MIC | MIC | M | V | 4 | | | | | | | | | | | 11.2.4 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | Ap | Ap | M | LV | 2-257 | | | plication | plication | | | | | | layer | layer | | | | | | group ID | group ID | | | | | | | | | | | | | | 11.2.6 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | Announcer | User info | M | V | 6 | | | info | ID | | | | | | | | | | | | | | 11.2.7 | | | | +-----------+-----------+-----------+----------+--------+--------+ | 7A | Metadata | Metadata | O | TLV-E | 4-8195 | | | | | | | | | | | 11.2.13 | | | | +-----------+-----------+-----------+----------+--------+--------+ | NOTE: The | | | | | | | discovery | | | | | | | type is | | | | | | | set to | | | | | | | \"R | | | | | | | estricted | | | | | | | dis | | | | | | | covery\", | | | | | | | the | | | | | | | content | | | | | | | type is | | | | | | | set to | | | | | | | \"Group | | | | | | | member | | | | | | | discovery | | | | | | | announcem | | | | | | | ent/group | | | | | | | member | | | | | | | discovery | | | | | | | r | | | | | | | esponse\" | | | | | | | and the | | | | | | | discovery | | | | | | | model is | | | | | | | set to | | | | | | | \"Model | | | | | | | A\". | | | | | | +-----------+-----------+-----------+----------+--------+--------+
Table 10.2.1.6: PROSE PC5 DISCOVERY message for group member discovery
solicitation
+-----------+-----------+-----------+----------+--------+--------+ | IEI | In | Type/ | Presence | Format | Length | | | formation | Reference | | | | | | Element | | | | | +===========+===========+===========+==========+========+========+ | | ProSe | ProSe | M | V | 1 | | | direct | direct | | | | | | discovery | discovery | | | | | | PC5 | PC5 | | | | | | message | message | | | | | | type | type | | | | | | (NOTE) | | | | | | | | 11.2.1 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | UTC-based | UTC-based | M | V | 1 | | | counter | counter | | | | | | LSB | LSB | | | | | | | | | | | | | | 11.2.14 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | MIC | MIC | M | V | 4 | | | | | | | | | | | 11.2.4 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | Ap | Ap | M | LV | 2-256 | | | plication | plication | | | | | | layer | layer | | | | | | group ID | group ID | | | | | | | | | | | | | | 11.2.6 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | D | User info | M | V | 6 | | | iscoverer | ID | | | | | | info | | | | | | | | 11.2.7 | | | | +-----------+-----------+-----------+----------+--------+--------+ | 28 | Target | User info | O | TV | 7 | | | user info | ID | | | | | | | | | | | | | | 11.2.7 | | | | +-----------+-----------+-----------+----------+--------+--------+ | NOTE: The | | | | | | | discovery | | | | | | | type is | | | | | | | set to | | | | | | | \"R | | | | | | | estricted | | | | | | | dis | | | | | | | covery\", | | | | | | | the | | | | | | | content | | | | | | | type is | | | | | | | set to | | | | | | | \"Group | | | | | | | member | | | | | | | discovery | | | | | | | solic | | | | | | | itation\" | | | | | | | and the | | | | | | | discovery | | | | | | | model is | | | | | | | set to | | | | | | | \"Model | | | | | | | B\". | | | | | | +-----------+-----------+-----------+----------+--------+--------+
Table 10.2.1.7: PROSE PC5 DISCOVERY message for group member discovery
response
+-----------+-----------+-----------+----------+--------+--------+ | IEI | In | Type/ | Presence | Format | Length | | | formation | Reference | | | | | | Element | | | | | +===========+===========+===========+==========+========+========+ | | ProSe | ProSe | M | V | 1 | | | direct | direct | | | | | | discovery | discovery | | | | | | PC5 | PC5 | | | | | | message | message | | | | | | type | type | | | | | | (NOTE) | | | | | | | | 11.2.1 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | UTC-based | UTC-based | M | V | 1 | | | counter | counter | | | | | | LSB | LSB | | | | | | | | | | | | | | 11.2.14 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | MIC | MIC | M | V | 4 | | | | | | | | | | | 11.2.4 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | Ap | Ap | M | LV | 2-256 | | | plication | plication | | | | | | layer | layer | | | | | | group ID | group ID | | | | | | | | | | | | | | 11.2.6 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | D | User info | M | V | 6 | | | iscoveree | ID | | | | | | info | | | | | | | | 11.2.7 | | | | +-----------+-----------+-----------+----------+--------+--------+ | 7A | Metadata | Metadata | O | TLV-E | 4-8195 | | | | | | | | | | | 11.2.13 | | | | +-----------+-----------+-----------+----------+--------+--------+ | NOTE: The | | | | | | | discovery | | | | | | | type is | | | | | | | set to | | | | | | | \"R | | | | | | | estricted | | | | | | | dis | | | | | | | covery\", | | | | | | | the | | | | | | | content | | | | | | | type is | | | | | | | set to | | | | | | | \"Group | | | | | | | member | | | | | | | discovery | | | | | | | announcem | | | | | | | ent/group | | | | | | | member | | | | | | | discovery | | | | | | | r | | | | | | | esponse\" | | | | | | | and the | | | | | | | discovery | | | | | | | model is | | | | | | | set to | | | | | | | \"Model | | | | | | | B\". | | | | | | +-----------+-----------+-----------+----------+--------+--------+
Table 10.2.1.8: PROSE PC5 DISCOVERY message for UE-to-network relay discovery
announcement
+-----------+-----------+-----------+----------+--------+--------+ | IEI | In | Type/ | Presence | Format | Length | | | formation | Reference | | | | | | Element | | | | | +===========+===========+===========+==========+========+========+ | | ProSe | ProSe | M | V | 1 | | | direct | direct | | | | | | discovery | discovery | | | | | | PC5 | PC5 | | | | | | message | message | | | | | | type | type | | | | | | (NOTE 1) | | | | | | | | 11.2.1 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | UTC-based | UTC-based | M | V | 1 | | | counter | counter | | | | | | LSB | LSB | | | | | | | | | | | | | | 11.2.11 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | MIC | MIC | M | V | 4 | | | | | | | | | | | 11.2.4 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | Announcer | User info | M | V | 6 | | | info | ID | | | | | | | | | | | | | | 11.2.7 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | Relay | Relay | M | V | 3 | | | service | service | | | | | | code | code | | | | | | (NOTE 2) | | | | | | | | 11.2.8 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | Status | Status | M | V | 1 | | | indicator | indicator | | | | | | | | | | | | | | 11.2.9 | | | | +-----------+-----------+-----------+----------+--------+--------+ | 52 | NCGI | NCGI | O | TV | 9 | | | | | | | | | | | 11.2.12 | | | | +-----------+-----------+-----------+----------+--------+--------+ | 63 | RRC | RRC | O | TLV | 3-257 | | | container | container | | | | | | | | | | | | | | 11.2.14 | | | | +-----------+-----------+-----------+----------+--------+--------+ | NOTE 1: | | | | | | | The | | | | | | | discovery | | | | | | | type is | | | | | | | set to | | | | | | | \"R | | | | | | | estricted | | | | | | | dis | | | | | | | covery\", | | | | | | | the | | | | | | | content | | | | | | | type is | | | | | | | set to | | | | | | | \"UE-t | | | | | | | o-network | | | | | | | relay | | | | | | | discovery | | | | | | | announce | | | | | | | ment/UE-t | | | | | | | o-network | | | | | | | relay | | | | | | | discovery | | | | | | | r | | | | | | | esponse\" | | | | | | | and the | | | | | | | discovery | | | | | | | model is | | | | | | | set to | | | | | | | \"Model | | | | | | | A\". | | | | | | | | | | | | | | NOTE 2: | | | | | | | If the | | | | | | | a | | | | | | | nnouncing | | | | | | | UE works | | | | | | | as a 5G | | | | | | | ProSe | | | | | | | Layer-3 | | | | | | | UE-t | | | | | | | o-network | | | | | | | relay UE, | | | | | | | the | | | | | | | S-NSSAI | | | | | | | a | | | | | | | ssociated | | | | | | | with the | | | | | | | relay | | | | | | | service | | | | | | | code | | | | | | | belongs | | | | | | | to the | | | | | | | allowed | | | | | | | NSSAI of | | | | | | | the UE. | | | | | | +-----------+-----------+-----------+----------+--------+--------+
Table 10.2.1.9: PROSE PC5 DISCOVERY message for UE-to-network relay discovery
solicitation
+-----------+-----------+-----------+----------+--------+--------+ | IEI | In | Type/ | Presence | Format | Length | | | formation | Reference | | | | | | Element | | | | | +===========+===========+===========+==========+========+========+ | | ProSe | ProSe | M | V | 1 | | | direct | direct | | | | | | discovery | discovery | | | | | | PC5 | PC5 | | | | | | message | message | | | | | | type | type | | | | | | (NOTE) | | | | | | | | 11.2.1 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | UTC-based | UTC-based | M | V | 1 | | | counter | counter | | | | | | LSB | LSB | | | | | | | | | | | | | | 11.2.11 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | MIC | MIC | M | V | 4 | | | | | | | | | | | 11.2.4 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | D | User info | M | V | 6 | | | iscoverer | ID | | | | | | info | | | | | | | | 11.2.7 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | Relay | Relay | M | V | 3 | | | service | service | | | | | | code | code | | | | | | | | | | | | | | 11.2.8 | | | | +-----------+-----------+-----------+----------+--------+--------+ | 29 | Target | User info | O | TV | 7 | | | d | ID | | | | | | iscoveree | | | | | | | info | 11.2.7 | | | | +-----------+-----------+-----------+----------+--------+--------+ | NOTE: The | | | | | | | discovery | | | | | | | type is | | | | | | | set to | | | | | | | \"R | | | | | | | estricted | | | | | | | dis | | | | | | | covery\", | | | | | | | the | | | | | | | content | | | | | | | type is | | | | | | | set to | | | | | | | \"UE-t | | | | | | | o-network | | | | | | | relay | | | | | | | discovery | | | | | | | solic | | | | | | | itation\" | | | | | | | and the | | | | | | | discovery | | | | | | | model is | | | | | | | set to | | | | | | | \"Model | | | | | | | B\". | | | | | | +-----------+-----------+-----------+----------+--------+--------+
Table 10.2.1.10: PROSE PC5 DISCOVERY message for UE-to-network relay discovery
response
+-----------+-----------+-----------+----------+--------+--------+ | IEI | In | Type/ | Presence | Format | Length | | | formation | Reference | | | | | | Element | | | | | +===========+===========+===========+==========+========+========+ | | ProSe | ProSe | M | V | 1 | | | direct | direct | | | | | | discovery | discovery | | | | | | PC5 | PC5 | | | | | | message | message | | | | | | type | type | | | | | | (NOTE 1) | | | | | | | | 11.2.1 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | UTC-based | UTC-based | M | V | 1 | | | counter | counter | | | | | | LSB | LSB | | | | | | | | | | | | | | 11.2.11 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | MIC | MIC | M | V | 4 | | | | | | | | | | | 11.2.4 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | D | User info | M | V | 6 | | | iscoveree | ID | | | | | | info | | | | | | | | 11.2.7 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | Relay | Relay | M | V | 3 | | | service | service | | | | | | code | code | | | | | | (NOTE 2) | | | | | | | | 11.2.8 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | Status | Status | M | V | 1 | | | indicator | indicator | | | | | | | | | | | | | | 11.2.9 | | | | +-----------+-----------+-----------+----------+--------+--------+ | 52 | NCGI | NCGI | O | TV | 9 | | | | | | | | | | | 11.2.12 | | | | +-----------+-----------+-----------+----------+--------+--------+ | 63 | RRC | RRC | O | TLV | 3-257 | | | container | container | | | | | | | | | | | | | | 11.2.14 | | | | +-----------+-----------+-----------+----------+--------+--------+ | NOTE 1: | | | | | | | The | | | | | | | discovery | | | | | | | type is | | | | | | | set to | | | | | | | \"R | | | | | | | estricted | | | | | | | dis | | | | | | | covery\", | | | | | | | the | | | | | | | content | | | | | | | type is | | | | | | | set to | | | | | | | \"UE-t | | | | | | | o-network | | | | | | | relay | | | | | | | discovery | | | | | | | announce | | | | | | | ment/UE-t | | | | | | | o-network | | | | | | | relay | | | | | | | discovery | | | | | | | r | | | | | | | esponse\" | | | | | | | and the | | | | | | | discovery | | | | | | | model is | | | | | | | set to | | | | | | | \"Model | | | | | | | B\". | | | | | | | | | | | | | | NOTE 2: | | | | | | | If the | | | | | | | d | | | | | | | iscoveree | | | | | | | UE works | | | | | | | as a 5G | | | | | | | ProSe | | | | | | | Layer-3 | | | | | | | UE-t | | | | | | | o-network | | | | | | | relay UE, | | | | | | | the | | | | | | | S-NSSAI | | | | | | | a | | | | | | | ssociated | | | | | | | with the | | | | | | | relay | | | | | | | service | | | | | | | code | | | | | | | belongs | | | | | | | to the | | | | | | | allowed | | | | | | | NSSAI of | | | | | | | the UE. | | | | | | +-----------+-----------+-----------+----------+--------+--------+
Table 10.2.1.11: PROSE PC5 DISCOVERY message for relay discovery additional
information
+-----------+-----------+-----------+----------+--------+--------+ | IEI | In | Type/ | Presence | Format | Length | | | formation | Reference | | | | | | Element | | | | | +===========+===========+===========+==========+========+========+ | | ProSe | ProSe | M | V | 1 | | | direct | direct | | | | | | discovery | discovery | | | | | | PC5 | PC5 | | | | | | message | message | | | | | | type | type | | | | | | (NOTE) | | | | | | | | 11.2.1 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | UTC-based | UTC-based | M | V | 1 | | | counter | counter | | | | | | LSB | LSB | | | | | | | | | | | | | | 11.2.11 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | MIC | MIC | M | V | 4 | | | | | | | | | | | 11.2.4 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | Relay | Relay | M | V | 3 | | | service | service | | | | | | code | code | | | | | | | | | | | | | | 11.2.8 | | | | +-----------+-----------+-----------+----------+--------+--------+ | | Announcer | User info | M | V | 6 | | | info | ID | | | | | | | | | | | | | | 11.2.7 | | | | +-----------+-----------+-----------+----------+--------+--------+ | 52 | NCGI | NCGI | O | TV | 9 | | | | | | | | | | | 11.2.12 | | | | +-----------+-----------+-----------+----------+--------+--------+ | 51 | Relay TAI | TAI | O | TV | 4 | | | | | | | | | | | 11.2.10 | | | | +-----------+-----------+-----------+----------+--------+--------+ | NOTE: The | | | | | | | discovery | | | | | | | type is | | | | | | | set to | | | | | | | \"R | | | | | | | estricted | | | | | | | dis | | | | | | | covery\", | | | | | | | the | | | | | | | content | | | | | | | type is | | | | | | | set to | | | | | | | \"Relay | | | | | | | discovery | | | | | | | a | | | | | | | dditional | | | | | | | info | | | | | | | rmation\" | | | | | | | and the | | | | | | | discovery | | | | | | | model is | | | | | | | set to | | | | | | | \"Model | | | | | | | A\". | | | | | | +-----------+-----------+-----------+----------+--------+--------+
### 10.2.2 Relay TAI
The information element may be included in PROSE PC5 DISCOVERY message for
relay discovery additional information as in table 10.2.1.11 to indicate the
tracking area identity corresponding to the serving cell of the 5G ProSe
layer-3 UE-to-network relay for discoveree UEs supporting N3IWF discovery
procedure.
### 10.2.3 NCGI
The NCGI information element shall be included in:
a) PROSE PC5 DISCOVERY message for UE-to-network relay discovery announcement
as in table 10.2.1.8; or
b) PROSE PC5 DISCOVERY message for UE-to-network relay discovery response as
in table 10.2.1.10;
to indicate the NCGI of the serving cell if the UE acts as a 5G ProSe layer-2
UE-to-network relay UE.
When the UE acts as a 5G ProSe layer-3 UE-to-network relay UE, the UE may
include the NCGI information element in PROSE PC5 DISCOVERY message for relay
discovery additional information as in table 10.2.1.11 to indicate the NCGI of
the serving cell.
### 10.2.4 Target user info
The target user info IE shall be included in PROSE PC5 DISCOVERY message for
group member discovery solicitation in as in table 10.2.1.6 if the target
information is provided by the upper layers to identify a specific group
member of the application layer group identified by the configured application
layer group ID.
### 10.2.5 Metadata
The Metadata information element may be included:
a) to provide the application layer metadata information in the following
messages:
1) the PROSE PC5 DISCOVERY message for open 5G ProSe direct discovery
announcement as in table 10.2.1.1;
2) the PROSE PC5 DISCOVERY message for restricted 5G ProSe direct discovery
announcement as in table 10.2.1.2; and
3) the PROSE PC5 DISCOVERY message for restricted 5G ProSe direct discovery
response as in table 10.2.1.4; or
b) to provide the application layer discovery message in the following
messages:
1) the PROSE PC5 DISCOVERY message for group member discovery announcement as
in table 10.2.1.5; and
2) the PROSE PC5 DISCOVERY message for group member discovery response as in
table 10.2.1.7.
NOTE 1: The format of the application layer metadata information and the
application layer discovery message are out of scope of this specification.
NOTE 2: Possible impact on the performance of the 5G ProSe direct discovery
procedure is to be considered if the resulted Metadata information element
size is too big, e.g., longer delay and lower reliability.
### 10.2.6 RRC container
The RRC container information element shall be included in:
a) PROSE PC5 DISCOVERY message for UE-to-network relay discovery announcement
as in table 10.2.1.8; or
b) PROSE PC5 DISCOVERY message for UE-to-network relay discovery response as
in table 10.2.1.10;
to indicate the RRC container information if it is received from the lower
layers and the UE acts as a 5G ProSe layer-2 UE-to-network relay UE.
### 10.2.7 Target discoveree info
The target discoveree info IE shall be included in PROSE PC5 DISCOVERY message
for UE-to-network relay discovery solicitation as in table 10.2.1.9 if the
target discoveree info is provided by the application layer.
## 10.3 PC5 signalling messages
### 10.3.1 ProSe direct link establishment request
#### 10.3.1.1 Message definition
This message is sent by a UE to another peer UE to establish a direct link.
See table 10.3.1.1.1.
Message type: PROSE DIRECT LINK ESTABLISHMENT REQUEST
Significance: dual
Direction: UE to peer UE
Table 10.3.1.1.1: PROSE DIRECT LINK ESTABLISHMENT REQUEST message content
+-----+-----------+-----------+----------+--------+----------+ | IEI | In | Type/ | Presence | Format | Length | | | formation | Reference | | | | | | Element | | | | | +=====+===========+===========+==========+========+==========+ | | PROSE | ProSe PC5 | M | V | 1 | | | DIRECT | s | | | | | | LINK | ignalling | | | | | | ESTA | message | | | | | | BLISHMENT | type | | | | | | REQUEST | | | | | | | message | 11.3.1 | | | | | | identity | | | | | +-----+-----------+-----------+----------+--------+----------+ | | Sequence | Sequence | M | V | 1 | | | number | number | | | | | | | | | | | | | | 11.3.2 | | | | +-----+-----------+-----------+----------+--------+----------+ | | Source | Ap | M | LV | 2-256 | | | user info | plication | | | | | | | layer ID | | | | | | | | | | | | | | 11.3.4 | | | | +-----+-----------+-----------+----------+--------+----------+ | | UE | UE | M | LV | 3-9 | | | security | security | | | | | | cap | cap | | | | | | abilities | abilities | | | | | | | | | | | | | | 11.3.11 | | | | +-----+-----------+-----------+----------+--------+----------+ | | UE PC5 | UE PC5 | M | V | 1 | | | unicast | unicast | | | | | | s | s | | | | | | ignalling | ignalling | | | | | | security | security | | | | | | policy | policy | | | | | | | | | | | | | | 11.3.12 | | | | +-----+-----------+-----------+----------+--------+----------+ | 4F | MIC | MIC | O | TV | 5 | | | | | | | | | | | 11.3.38 | | | | +-----+-----------+-----------+----------+--------+----------+ | 7B | ProSe | ProSe | O | TLV-E | 21-65538 | | | id | i | | | | | | entifiers | dentifier | | | | | | | | | | | | | | 11.3.3 | | | | +-----+-----------+-----------+----------+--------+----------+ | 74 | Key | Key | O | TLV-E | 4-65538 | | | esta | esta | | | | | | blishment | blishment | | | | | | in | in | | | | | | formation | formation | | | | | | container | container | | | | | | | | | | | | | | 11.3.9 | | | | +-----+-----------+-----------+----------+--------+----------+ | 56 | Nonce_1 | Nonce | O | TV | 17 | | | | | | | | | | | 11.3.10 | | | | +-----+-----------+-----------+----------+--------+----------+ | 5C | MSB of | MSB of | O | TV | 2 | | | K~ | K~ | | | | | | NRP-sess~ | NRP-sess~ | | | | | | ID | ID | | | | | | | | | | | | | | 11.3.13 | | | | +-----+-----------+-----------+----------+--------+----------+ | 28 | Target | Ap | O | TLV | 3-257 | | | user info | plication | | | | | | | layer ID | | | | | | | | | | | | | | 11.3.4 | | | | +-----+-----------+-----------+----------+--------+----------+ | 58 | K~NRP~ ID | K~NRP~ ID | O | TV | 5 | | | | | | | | | | | 11.3.14 | | | | +-----+-----------+-----------+----------+--------+----------+ | 54 | Relay | Relay | O | TV | 4 | | | service | service | | | | | | code | code | | | | | | | | | | | | | | 11.3.26 | | | | +-----+-----------+-----------+----------+--------+----------+ | 7D | UE | 5GS | O | TLV-E | 4-n | | | identity | mobile | | | | | | | identity | | | | | | | | | | | | | | 11.3.30 | | | | +-----+-----------+-----------+----------+--------+----------+ | 64 | User | User | O | TLV | 3-n | | | security | security | | | | | | key ID | key ID | | | | | | | | | | | | | | 11.3.32 | | | | +-----+-----------+-----------+----------+--------+----------+ | 2A | HPLMN ID | PLMN ID | O | TLV | 5 | | | | | | | | | | | 11.3.33 | | | | +-----+-----------+-----------+----------+--------+----------+ | 2B | UTC-based | UTC-based | O | TV | 2 | | | counter | counter | | | | | | LSB | LSB | | | | | | | | | | | | | | 11.2.14 | | | | +-----+-----------+-----------+----------+--------+----------+
#### 10.3.1.2 Target user info
The UE shall include this IE if the target UE\'s application layer ID is
received from upper layers or known based on the unicast layer-2 ID of target
UE (i.e. destination layer-2 ID) as described in clause 5.8.2.4 of 3GPP TS
23.304 [3], or if the UE receives the user info ID of the 5G ProSe UE-to-
network relay UE during the 5G ProSe UE-to-network relay discovery procedure.
#### 10.3.1.3 Key establishment information container
The UE shall include this IE if the UE PC5 unicast signalling security policy
is set to \"Signalling integrity protection required\" or \"Signalling
integrity protection preferred\".
#### 10.3.1.4 Nonce_1
The UE shall include this IE if the UE PC5 unicast signalling security policy
is set to \"Signalling integrity protection required\" or \"Signalling
integrity protection preferred\" and the 5G ProSe direct link is not for
direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-
network relay UE.
NOTE: When the 5G ProSe direct link establishment procedure is between the 5G
ProSe remote UE and the 5G ProSe UE-to-network relay UE and the security
procedure over user plane is used as specified in 3GPP TS 33.503 [34], the
\"Nonce_1\" is called \"K~NRP~ freshness parameter 1\" as specified in 3GPP TS
33.503 [34].
#### 10.3.1.5 MSB of K~NRP-sess~ ID
The UE shall include this IE if the UE PC5 unicast signalling security policy
is set to \"Signalling integrity protection required\" or \"Signalling
integrity protection preferred\".
#### 10.3.1.6 K~NRP~ ID
The UE may include this IE if it has an existing K~NRP~ for the target UE.
#### 10.3.1.7 Relay service code
The UE shall include this IE if the 5G ProSe direct link establishment
procedure is for direct communication between the 5G ProSe remote UE and the
5G ProSe UE-to-network relay UE.
#### 10.3.1.8 ProSe identifiers
The UE shall include this IE if the 5G ProSe direct link establishment
procedure is not for 5G ProSe direct communication between the 5G ProSe remote
UE and the 5G ProSe UE-to-network relay UE.
#### 10.3.1.9 UE identity
The UE shall include this IE if the 5G ProSe direct link establishment
procedure is for direct communication between the 5G ProSe remote UE and the
5G ProSe UE-to-network relay UE.
#### 10.3.1.10 User security key ID
The UE shall include this IE if the 5G ProSe direct link establishment
procedure is for direct communication between the 5G ProSe remote UE and the
5G ProSe UE-to-network relay UE, and:
a) the security procedure over user plane for 5G ProSe UE-to-network relay is
used as specified in 3GPP TS 33.503 [34] and the UE has a valid UP-PRUK; or
b) the security procedure over control plane for 5G ProSe UE-to-network relay
is used as specified in 3GPP TS 33.503 [34] and the UE has a valid CP-PRUK
associated with the relay service code of the target UE.
#### 10.3.1.11 HPLMN ID
The UE shall include this IE if the the UP-PRUK ID of the UE is included and
is not in NAI format (see 3GPP TS 33.503 [34]).
#### 10.3.1.12 UTC-based counter LSB
The UE shall include this IE if the 5G ProSe direct link establishment
procedure is for direct communication between the 5G ProSe remote UE and the
5G ProSe UE-to-network relay UE.
#### 10.3.1.13 MIC
The UE shall include this IE if the 5G ProSe direct link establishment
procedure is for direct communication between the 5G ProSe remote UE and the
5G ProSe UE-to-network relay UE and the UE has the DUIK.
### 10.3.2 ProSe direct link establishment accept
#### 10.3.2.1 Message definition
This message is sent by a UE to another peer UE to accept the received PROSE
DIRECT LINK ESTABLISHMENT REQUEST message. See table 10.3.2.1.1.
Message type: PROSE DIRECT LINK ESTABLISHMENT ACCEPT
Significance: dual
Direction: UE to peer UE
Table 10.3.2.1.1: PROSE DIRECT LINK ESTABLISHMENT ACCEPT message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | PROSE | ProSe PC5 | M | V | 1 | | | DIRECT | signalling | | | | | | LINK | message | | | | | | EST | type | | | | | | ABLISHMENT | | | | | | | ACCEPT | 11.3.1 | | | | | | message | | | | | | | identity | | | | | +-----+------------+------------+----------+--------+---------+ | | Sequence | Sequence | M | V | 1 | | | number | number | | | | | | | | | | | | | | 11.3.2 | | | | +-----+------------+------------+----------+--------+---------+ | | Source | A | M | LV | 2-256 | | | user info | pplication | | | | | | | layer ID | | | | | | | | | | | | | | 11.3.4 | | | | +-----+------------+------------+----------+--------+---------+ | | Con | Con | M | V | 1 | | | figuration | figuration | | | | | | of UE PC5 | of UE PC5 | | | | | | unicast | unicast | | | | | | user plane | user plane | | | | | | security | security | | | | | | protection | protection | | | | | | | | | | | | | | 11.3.23 | | | | +-----+------------+------------+----------+--------+---------+ | 79 | QoS flow | PC5 QoS | O | TLV-E | 6-65538 | | | de | flow | | | | | | scriptions | de | | | | | | | scriptions | | | | | | | | | | | | | | 11.3.5 | | | | +-----+------------+------------+----------+--------+---------+ | 7C | QoS rules | PC5 QoS | O | TLV-E | 7-65538 | | | | rules | | | | | | | | | | | | | | 11.3.29 | | | | +-----+------------+------------+----------+--------+---------+ | 62 | IP address | IP address | O | TV | 2 | | | con | con | | | | | | figuration | figuration | | | | | | | | | | | | | | 11.3.6 | | | | +-----+------------+------------+----------+--------+---------+ | 61 | Target | Link local | O | TV | 17 | | | link local | IPv6 | | | | | | IPv6 | address | | | | | | address | | | | | | | | 11.3.7 | | | | +-----+------------+------------+----------+--------+---------+
#### 10.3.2.2 IP address configuration
The UE shall include this IE if IP communication is used.
#### 10.3.2.3 Target link local IPv6 address
The UE shall include this IE if IP communication is used and the IP address
configuration is set to \"address allocation not supported\".
#### 10.3.2.4 QoS flow descriptions
The UE shall include this IE if:
a) the 5G ProSe direct link establishment procedure is not for 5G ProSe direct
communication between the 5G ProSe remote UE and the 5G ProSe UE-to-network
relay UE; or
b) the 5G ProSe direct link establishment procedure is for 5G ProSe direct
communication between the 5G ProSe layer-3 remote UE and the 5G ProSe layer-3
UE-to-network relay UE.
#### 10.3.2.5 QoS rules
The UE may include this IE to indicate the PC5 QoS rules for the established
PC5 QoS flow(s).
### 10.3.3 ProSe direct link establishment reject
#### 10.3.3.1 Message definition
This message is sent by the UE to another peer UE to indicate that the link
establishment request is not accepted. See table 10.3.3.1.1.
Message type: PROSE DIRECT LINK ESTABLISHMENT REJECT
Significance: dual
Direction: UE to peer UE
Table 10.3.3.1.1: PROSE DIRECT LINK ESTABLISHMENT REJECT message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | PROSE | ProSe PC5 | M | V | 1 | | | DIRECT LINK | signalling | | | | | | ES | message | | | | | | TABLISHMENT | type | | | | | | REJECT | | | | | | | message | 11.3.1 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | Sequence | Sequence | M | V | 1 | | | number | number | | | | | | | | | | | | | | 11.3.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | PC5 | PC5 | M | V | 1 | | | signalling | signalling | | | | | | protocol | protocol | | | | | | cause | cause | | | | | | | | | | | | | | 11.3.8 | | | | +-----+-------------+-------------+----------+--------+--------+ | 5E | Back-off | GPRS timer | O | TV | 2 | | | value | | | | | | | | 11.3.27 | | | | +-----+-------------+-------------+----------+--------+--------+ | 70 | EAP message | EAP message | O | TLV-E | 7-1503 | | | | | | | | | | | 11.3.31 | | | | +-----+-------------+-------------+----------+--------+--------+
#### 10.3.3.2 Back-off value
The UE may include this IE when it needs to indicate a back-off timer to
another peer UE for congestion control purpose.
#### 10.3.3.3 EAP message
The EAP message IE is included if received from the network according to the
security procedure over control plane as specified in 3GPP TS 33.503 [34],
when the direct communication is between the 5G ProSe remote UE and the 5G
ProSe UE-to-network relay UE:
### 10.3.4 ProSe direct link release request
#### 10.3.4.1 Message definition
This message is sent by the UE to another peer UE to initiate the direct link
release procedure. See table 10.3.4.1.1.
Message type: PROSE DIRECT LINK RELEASE REQUEST
Significance: dual
Direction: UE to peer UE
Table 10.3.4.1.1: PROSE DIRECT LINK RELEASE REQUEST message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | PROSE | ProSe PC5 | M | V | 1 | | | DIRECT LINK | signalling | | | | | | RELEASE | message | | | | | | REQUEST | type | | | | | | message | | | | | | | identity | 11.3.1 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Sequence | Sequence | M | V | 1 | | | number | number | | | | | | | | | | | | | | 11.3.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | PC5 | PC5 | M | V | 1 | | | signalling | signalling | | | | | | protocol | protocol | | | | | | cause | cause | | | | | | | | | | | | | | 11.3.8 | | | | +-----+-------------+-------------+----------+--------+--------+ | | MSBs of | MSBs of | M | V | 2 | | | K~NRP~ ID | K~NRP~ ID | | | | | | | | | | | | | | 11.3.16 | | | | +-----+-------------+-------------+----------+--------+--------+ | 5E | Back-off | GPRS timer | O | TV | 2 | | | value | | | | | | | | 11.3.27 | | | | +-----+-------------+-------------+----------+--------+--------+
#### 10.3.4.2 Back-off value
The UE may include this IE when it needs to indicate a back-off timer to
another peer UE for congestion control purpose.
### 10.3.5 ProSe direct link release accept
#### 10.3.5.1 Message definition
This message is sent by the UE to another peer UE to indicate that the link
release request is accepted. See table 10.3.5.1.1.
Message type: PROSE DIRECT LINK RELEASE ACCEPT
Significance: dual
Direction: UE to peer UE
Table 10.3.5.1.1: PROSE DIRECT LINK RELEASE ACCEPT message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | PROSE | ProSe PC5 | M | V | 1 | | | DIRECT LINK | signalling | | | | | | RELEASE | message | | | | | | ACCEPT | type | | | | | | message | | | | | | | identity | 11.3.1 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Sequence | Sequence | M | V | 1 | | | number | number | | | | | | | | | | | | | | 11.3.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | LSBs of | LSBs of | M | V | 2 | | | K~NRP~ ID | K~NRP~ ID | | | | | | | | | | | | | | 11.3.17 | | | | +-----+-------------+-------------+----------+--------+--------+
### 10.3.6 ProSe direct link modification request
#### 10.3.6.1 Message definition
This message is sent by the UE to another peer UE to initiate the direct link
modification procedure. See table 10.3.6.1.1.
Message type: PROSE DIRECT LINK MODIFICATION REQUEST
Significance: dual
Direction: UE to peer UE
Table 10.3.6.1.1: PROSE DIRECT LINK MODIFICATION REQUEST message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | PROSE | ProSe PC5 | M | V | 1 | | | DIRECT | signalling | | | | | | LINK | message | | | | | | MO | type | | | | | | DIFICATION | | | | | | | REQUEST | 11.3.1 | | | | | | message | | | | | | | identity | | | | | +-----+------------+------------+----------+--------+---------+ | | Sequence | Sequence | M | V | 1 | | | number | number | | | | | | | | | | | | | | 11.3.2 | | | | +-----+------------+------------+----------+--------+---------+ | | Link | Link | M | V | 1 | | | mo | mo | | | | | | dification | dification | | | | | | operation | operation | | | | | | code | code | | | | | | | | | | | | | | 11.3.19 | | | | +-----+------------+------------+----------+--------+---------+ | | QoS flow | PC5 QoS | M | LV-E | 5-65537 | | | de | flow | | | | | | scriptions | de | | | | | | | scriptions | | | | | | | | | | | | | | 11.3.5 | | | | +-----+------------+------------+----------+--------+---------+ | 7C | QoS rules | PC5 QoS | O | TLV-E | 7-65538 | | | | rules | | | | | | | | | | | | | | 11.3.29 | | | | +-----+------------+------------+----------+--------+---------+
#### 10.3.6.2 QoS rules
The UE may include this IE to indicate the PC5 QoS rules for the PC5 QoS
flow(s) to be added or modified.
### 10.3.7 ProSe direct link modification accept
#### 10.3.7.1 Message definition
This message is sent by the UE to another peer UE to indicate that the link
modification request is accepted. See table 10.3.7.1.1.
Message type: PROSE DIRECT LINK MODIFICATION ACCEPT
Significance: dual
Direction: UE to peer UE
Table 10.3.7.1.1: PROSE DIRECT LINK MODIFICATION ACCEPT message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | PROSE | ProSe PC5 | M | V | 1 | | | DIRECT | signalling | | | | | | LINK | message | | | | | | MO | type | | | | | | DIFICATION | | | | | | | ACCEPT | 11.3.1 | | | | | | message | | | | | | | identity | | | | | +-----+------------+------------+----------+--------+---------+ | | Sequence | Sequence | M | V | 1 | | | number | number | | | | | | | | | | | | | | 11.3.2 | | | | +-----+------------+------------+----------+--------+---------+ | 79 | QoS flow | PC5 QoS | O | TLV-E | 6-65538 | | | de | flow | | | | | | scriptions | de | | | | | | | scriptions | | | | | | | | | | | | | | 11.3.5 | | | | +-----+------------+------------+----------+--------+---------+ | 7C | QoS rules | PC5 QoS | O | TLV-E | 7-65538 | | | | rules | | | | | | | | | | | | | | 11.3.29 | | | | +-----+------------+------------+----------+--------+---------+
#### 10.3.7.2 QoS flow descriptions
The UE shall include this IE if the 5G ProSe direct link modification
procedure is to:
a) add new PC5 QoS flow(s) to the existing 5G ProSe direct link;
b) modify PC5 QoS parameters of the existing PC5 QoS flow(s);
c) associate new ProSe application(s) with existing PC5 QoS flow(s); or
d) remove ProSe application(s) from existing PC5 QoS flow(s).
#### 10.3.7.3 QoS rules
The UE may include this IE to indicate the PC5 QoS rules for the PC5 QoS
flow(s) to be added or modified.
### 10.3.8 ProSe direct link keepalive request
#### 10.3.8.1 Message definition
This message is sent by a UE to another peer UE when a 5G ProSe direct link
keep-alive procedure is initiated. See table 10.3.8.1.1.
Message type: PROSE DIRECT LINK KEEPALIVE REQUEST
Significance: dual
Direction: UE to peer UE
Table 10.3.8.1.1: PROSE DIRECT LINK KEEPALIVE REQUEST message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | PROSE | ProSe PC5 | M | V | 1 | | | DIRECT LINK | signalling | | | | | | KEEPALIVE | message | | | | | | REQUEST | type | | | | | | message | | | | | | | identity | 11.3.1. | | | | +-----+-------------+-------------+----------+--------+--------+ | | Sequence | Sequence | M | V | 1 | | | number | number | | | | | | | | | | | | | | 11.3.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Keep-alive | Keep-alive | M | V | 4 | | | counter | counter | | | | | | | | | | | | | | 11.3.20 | | | | +-----+-------------+-------------+----------+--------+--------+ | 5F | Maximum | Maximum | O | TV | 5 | | | inactivity | inactivity | | | | | | period | period | | | | | | | | | | | | | | 11.3.21 | | | | +-----+-------------+-------------+----------+--------+--------+
#### 10.3.8.2 Maximum inactivity period
The UE may include this IE to indicate its maximum inactivity period to the
peer UE.
### 10.3.9 ProSe direct link keepalive response
#### 10.3.9.1 Message definition
This message is sent by a UE to another peer UE to respond to a PROSE DIRECT
LINK KEEPALIVE REQUEST message. See table 10.3.9.1.1.
Message type: PROSE DIRECT LINK KEEPALIVE RESPONSE
Significance: dual
Direction: UE to peer UE
Table 10.3.9.1.1: PROSE DIRECT LINK KEEPALIVE RESPONSE message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | PROSE | ProSe PC5 | M | V | 1 | | | DIRECT LINK | signalling | | | | | | KEEPALIVE | message | | | | | | RESPONSE | type | | | | | | message | | | | | | | identity | 11.3.1. | | | | +-----+-------------+-------------+----------+--------+--------+ | | Sequence | Sequence | M | V | 1 | | | number | number | | | | | | | | | | | | | | 11.3.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Keep-alive | Keep-alive | M | V | 4 | | | counter | counter | | | | | | | | | | | | | | 11.3.20 | | | | +-----+-------------+-------------+----------+--------+--------+
### 10.3.10 ProSe direct link authentication request
#### 10.3.10.1 Message definition
This message is sent by a UE to another peer UE when a 5G ProSe direct link
authentication procedure is initiated. See table 10.3.10.1.1.
Message type: PROSE DIRECT LINK AUTHENTICATION REQUEST
Significance: dual
Direction: UE to peer UE
Table 10.3.10.1.1: PROSE DIRECT LINK AUTHENTICATION REQUEST message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | PROSE | ProSe PC5 | M | V | 1 | | | DIRECT | signalling | | | | | | LINK | message | | | | | | AUTH | type | | | | | | ENTICATION | | | | | | | REQUEST | 11.3.1. | | | | | | message | | | | | | | identity | | | | | +-----+------------+------------+----------+--------+---------+ | | Sequence | Sequence | M | V | 1 | | | number | number | | | | | | | | | | | | | | 11.3.2 | | | | +-----+------------+------------+----------+--------+---------+ | | Key | Key | M | LV-E | 3-65537 | | | est | est | | | | | | ablishment | ablishment | | | | | | i | i | | | | | | nformation | nformation | | | | | | container | container | | | | | | | | | | | | | | 11.3.9 | | | | +-----+------------+------------+----------+--------+---------+
### 10.3.11 ProSe direct link authentication response
#### 10.3.11.1 Message definition
This message is sent by a UE to another peer UE to respond to a PROSE DIRECT
LINK AUTHENTICATION REQUEST message. See table 10.3.11.1.1.
Message type: PROSE DIRECT LINK AUTHENTICATION RESPONSE
Significance: dual
Direction: UE to peer UE
Table 10.3.11.1.1: PROSE DIRECT LINK AUTHENTICATION RESPONSE message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | PROSE | ProSe PC5 | M | V | 1 | | | DIRECT | signalling | | | | | | LINK | message | | | | | | AUTH | type | | | | | | ENTICATION | | | | | | | RESPONSE | 11.3.1. | | | | | | message | | | | | | | identity | | | | | +-----+------------+------------+----------+--------+---------+ | | Sequence | Sequence | M | V | 1 | | | number | number | | | | | | | | | | | | | | 11.3.2 | | | | +-----+------------+------------+----------+--------+---------+ | | Key | Key | M | LV-E | 3-65537 | | | est | est | | | | | | ablishment | ablishment | | | | | | i | i | | | | | | nformation | nformation | | | | | | container | container | | | | | | | | | | | | | | 11.3.9 | | | | +-----+------------+------------+----------+--------+---------+
### 10.3.12 ProSe direct link authentication reject
#### 10.3.12.1 Message definition
This message is sent by a UE to another peer UE to reject a PROSE DIRECT LINK
AUTHENTICATION REQUEST message. See table 10.3.12.1.1.
Message type: PROSE DIRECT LINK AUTHENTICATION REJECT
Significance: dual
Direction: UE to peer UE
Table 10.3.12.1.1: PROSE DIRECT LINK AUTHENTICATION REJECT message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | PROSE | ProSe PC5 | M | V | 1 | | | DIRECT LINK | signalling | | | | | | AUT | message | | | | | | HENTICATION | type | | | | | | REJECT | | | | | | | message | 11.3.1. | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | Sequence | Sequence | M | V | 1 | | | number | number | | | | | | | | | | | | | | 11.3.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | PC5 | PC5 | M | V | 1 | | | signalling | signalling | | | | | | protocol | protocol | | | | | | cause | cause | | | | | | | | | | | | | | 11.3.8 | | | | +-----+-------------+-------------+----------+--------+--------+
### 10.3.13 ProSe direct link security mode command
#### 10.3.13.1 Message definition
This message is sent by a UE to another peer UE when a 5G ProSe direct link
security mode control procedure is initiated. See table 10.3.13.1.1.
Message type: PROSE DIRECT LINK SECURITY MODE COMMAND
Significance: dual
Direction: UE to peer UE
Table 10.3.13.1.1: PROSE DIRECT LINK SECURITY MODE COMMAND message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | PROSE | ProSe PC5 | M | V | 1 | | | DIRECT | signalling | | | | | | LINK | message | | | | | | SECURITY | type | | | | | | MODE | | | | | | | COMMAND | 11.3.1. | | | | | | message | | | | | | | identity | | | | | +-----+------------+------------+----------+--------+---------+ | | Sequence | Sequence | M | V | 1 | | | number | number | | | | | | | | | | | | | | 11.3.2 | | | | +-----+------------+------------+----------+--------+---------+ | | Selected | Selected | M | V | 1 | | | security | security | | | | | | algorithms | algorithms | | | | | | | | | | | | | | 11.3.22 | | | | +-----+------------+------------+----------+--------+---------+ | | UE | UE | M | LV | 3-9 | | | security | security | | | | | | ca | ca | | | | | | pabilities | pabilities | | | | | | | | | | | | | | 11.3.11 | | | | +-----+------------+------------+----------+--------+---------+ | 59 | UE PC5 | UE PC5 | O | TV | 2 | | | unicast | unicast | | | | | | signalling | signalling | | | | | | security | security | | | | | | policy | policy | | | | | | | | | | | | | | 11.3.12 | | | | +-----+------------+------------+----------+--------+---------+ | 57 | Nonce_2 | Nonce | O | TV | 17 | | | | | | | | | | | 11.3.10 | | | | +-----+------------+------------+----------+--------+---------+ | 5D | LSB of | LSB of | O | TV | 2 | | | K | K | | | | | | ~NRP-sess~ | ~NRP-sess~ | | | | | | ID | ID | | | | | | | | | | | | | | 11.3.15 | | | | +-----+------------+------------+----------+--------+---------+ | 74 | Key | Key | O | TLV-E | 4-65538 | | | est | est | | | | | | ablishment | ablishment | | | | | | i | i | | | | | | nformation | nformation | | | | | | container | container | | | | | | | | | | | | | | 11.3.9 | | | | +-----+------------+------------+----------+--------+---------+ | 5A | MSBs of | MSBs of | O | TV | 3 | | | K~NRP~ ID | K~NRP~ ID | | | | | | | | | | | | | | 11.3.16 | | | | +-----+------------+------------+----------+--------+---------+ | 7A | GPI | GPI | O | TLV-E | n-65538 | | | | | | | | | | | 11.3.35 | | | | +-----+------------+------------+----------+--------+---------+ | 70 | EAP | EAP | O | TLV-E | 7-1503 | | | message | message | | | | | | | | | | | | | | 11.3.31 | | | | +-----+------------+------------+----------+--------+---------+
#### 10.3.13.2 Nonce_2
The UE shall include this IE if the selected integrity protection algorithms
is not the null integrity protection algorithm.
NOTE: When the 5G ProSe direct link establishment procedure is between the 5G
ProSe remote UE and the 5G ProSe UE-to-network relay UE and the security
procedure over user plane is used as specified in 3GPP TS 33.503 [34], the
\"Nonce_2\" is called \"K~NRP~ freshness parameter 2\" as specified in 3GPP TS
33.503 [34].
#### 10.3.13.3 LSB of KNRP-sess ID
The UE shall include this IE if the selected integrity protection algorithms
is not the null integrity protection algorithm.
#### 10.3.13.4 Key establishment information container
The UE shall include this IE if the UE has derived a new K~NRP~ and the
authentication method used to generate K~NRP~ requires sending information to
complete the authentication procedure and the 5G ProSe direct link is not for
direct communication between the 5G ProSe remote UE and the 5G ProSe UE-to-
network relay UE.
#### 10.3.13.5 MSBs of K~NRP~ ID
The UE shall include this IE if the UE has derived a new K~NRP~.
#### 10.3.13.6 UE PC5 unicast signalling security policy
The UE shall include this IE if the PROSE DIRECT LINK SECURITY MODE COMMAND
message is triggered by the PROSE DIRECT LINK ESTABLISHMENT REQUEST message.
The content of the IE is the same as the content of UE PC5 unicast signalling
security policy IE in the received PROSE DIRECT LINK ESTABLISHMENT REQUEST
message in order to provide protection against bidding down attacks.
#### 10.3.13.7 GPI
The UE shall include this IE if received from the 5G PKMF according to the
security procedure over user plane as specified in 3GPP TS 33.503 [34], when
the direct communication is between the 5G ProSe remote UE and the 5G ProSe
UE-to-network relay UE.
#### 10.3.13.8 EAP message
The EAP message IE is included if received from the network according to the
security procedure over control plane as specified in 3GPP TS 33.503 [34],
when the direct communication is between the 5G ProSe remote UE and the 5G
ProSe UE-to-network relay UE:
### 10.3.14 ProSe direct link security mode complete
#### 10.3.14.1 Message definition
This message is sent by a UE to another peer UE to respond to a PROSE DIRECT
LINK SECURITY MODE COMMAND message. See table 10.3.14.1.1.
Message type: PROSE DIRECT LINK SECURITY MODE COMPLETE
Significance: dual
Direction: UE to peer UE
Table 10.3.14.1.1: PROSE DIRECT LINK SECURITY MODE COMPLETE message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | PROSE | ProSe PC5 | M | V | 1 | | | DIRECT | signalling | | | | | | LINK | message | | | | | | SECURITY | type | | | | | | MODE | | | | | | | COMPLETE | 11.3.1. | | | | | | message | | | | | | | identity | | | | | +-----+------------+------------+----------+--------+---------+ | | Sequence | Sequence | M | V | 1 | | | number | number | | | | | | | | | | | | | | 11.3.2 | | | | +-----+------------+------------+----------+--------+---------+ | | UE PC5 | UE PC5 | M | V | 1 | | | unicast | unicast | | | | | | user plane | user plane | | | | | | security | security | | | | | | policy | policy | | | | | | | | | | | | | | 11.3.23 | | | | +-----+------------+------------+----------+--------+---------+ | 79 | QoS flow | PC5 QoS | O | TLV-E | 6-65538 | | | de | flow | | | | | | scriptions | de | | | | | | | scriptions | | | | | | | | | | | | | | 11.3.5 | | | | +-----+------------+------------+----------+--------+---------+ | 62 | IP address | IP address | O | TV | 2 | | | con | con | | | | | | figuration | figuration | | | | | | | | | | | | | | 11.3.6 | | | | +-----+------------+------------+----------+--------+---------+ | 61 | Target | Link local | O | TV | 17 | | | link local | IPv6 | | | | | | IPv6 | address | | | | | | address | | | | | | | | 11.3.7 | | | | +-----+------------+------------+----------+--------+---------+ | 5B | LSBs of | LSBs of | O | TV | 3 | | | K~NRP~ ID | K~NRP~ ID | | | | | | | | | | | | | | 11.3.17 | | | | +-----+------------+------------+----------+--------+---------+ | 7C | QoS rules | PC5 QoS | O | TLV-E | 7-65538 | | | | rules | | | | | | | | | | | | | | 11.3.29 | | | | +-----+------------+------------+----------+--------+---------+
#### 10.3.14.2 IP address configuration
The UE shall include this IE if IP communication is used and the 5G ProSe
direct link security mode control procedure was triggered during a 5G ProSe
direct link establishment procedure.
#### 10.3.14.3 Target link local IPv6 address
The UE shall include this IE if IP communication is used, the IP address
configuration is set to \"address allocation not supported\" and the 5G ProSe
direct link security mode control procedure was triggered during a 5G ProSe
direct link establishment procedure.
#### 10.3.14.4 LSBs of K~NRP~ ID
The UE shall include this IE if a new K~NRP~ was derived.
#### 10.3.14.5 QoS rules
The UE may include this IE to indicate the PC5 QoS rules for the PC5 QoS
flow(s) to be added.
#### 10.3.14.6 QoS flow descriptions
The UE shall include this IE if:
a) the 5G ProSe direct link security mode control procedure was triggered
during a 5G ProSe direct link establishment procedure and is not for 5G ProSe
direct communication between a 5G ProSe remote UE and a 5G ProSe UE-to-network
relay UE.
The UE may include this IE if:
a) the 5G ProSe direct link security mode control procedure was triggered
during a 5G ProSe direct link establishment procedure and is for 5G ProSe
direct communication between the 5G ProSe layer-3 remote UE and the 5G ProSe
layer-3 UE-to-network relay UE.
### 10.3.15 ProSe direct link security mode reject
#### 10.3.15.1 Message definition
This message is sent by a UE to another peer UE to reject a PROSE DIRECT LINK
SECURITY MODE COMMAND message. See table 10.3.15.1.1.
Message type: PROSE DIRECT LINK SECURITY MODE REJECT
Significance: dual
Direction: UE to peer UE
Table 10.3.15.1.1: PROSE DIRECT LINK SECURITY MODE REJECT message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | PROSE | ProSe PC5 | M | V | 1 | | | DIRECT LINK | signalling | | | | | | SECURITY | message | | | | | | MODE REJECT | type | | | | | | message | | | | | | | identity | 11.3.1. | | | | +-----+-------------+-------------+----------+--------+--------+ | | Sequence | Sequence | M | V | 1 | | | number | number | | | | | | | | | | | | | | 11.3.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | PC5 | PC5 | M | V | 1 | | | signalling | signalling | | | | | | protocol | protocol | | | | | | cause | cause | | | | | | | | | | | | | | 11.3.8 | | | | +-----+-------------+-------------+----------+--------+--------+ | 2B | RAND | RAND | O | TV | 17 | | | | | | | | | | | 11.3.36 | | | | +-----+-------------+-------------+----------+--------+--------+ | 2C | AUTS | AUTS | O | TV | 15 | | | | | | | | | | | 11.3.37 | | | | +-----+-------------+-------------+----------+--------+--------+
#### 10.3.15.2 RAND
The UE shall include this IE if there is a synchronisation error and the 5G
ProSe direct link security mode control procedure is for direct communication
between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE.
#### 10.3.15.3 AUTS
The UE shall include this IE if there is a synchronisation error and the 5G
ProSe direct link security mode control procedure is for direct communication
between the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE.
### 10.3.16 ProSe direct link rekeying request
#### 10.3.16.1 Message definition
This message is sent by a UE to another peer UE when a 5G ProSe direct link
re-keying procedure is initiated. See table 10.3.16.1.1.
Message type: PROSE DIRECT LINK REKEYING REQUEST
Significance: dual
Direction: UE to peer UE
Table 10.3.16.1.1: PROSE DIRECT LINK REKEYING REQUEST message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | PROSE | ProSe PC5 | M | V | 1 | | | DIRECT | signalling | | | | | | LINK | message | | | | | | REKEYING | type | | | | | | REQUEST | | | | | | | message | 11.3.1. | | | | | | identity | | | | | +-----+------------+------------+----------+--------+---------+ | | Sequence | Sequence | M | V | 1 | | | number | number | | | | | | | | | | | | | | 11.3.2 | | | | +-----+------------+------------+----------+--------+---------+ | | UE | UE | M | LV | 3-9 | | | security | security | | | | | | ca | ca | | | | | | pabilities | pabilities | | | | | | | | | | | | | | 11.3.11 | | | | +-----+------------+------------+----------+--------+---------+ | 74 | Key | Key | O | TLV-E | 4-65538 | | | est | est | | | | | | ablishment | ablishment | | | | | | i | i | | | | | | nformation | nformation | | | | | | container | container | | | | | | | | | | | | | | 11.3.9 | | | | +-----+------------+------------+----------+--------+---------+ | 56 | Nonce_1 | Nonce | O | TV | 17 | | | | | | | | | | | 11.3.10 | | | | +-----+------------+------------+----------+--------+---------+ | 5C | MSB of | MSB of | O | TV | 2 | | | K | K | | | | | | ~NRP-sess~ | ~NRP-sess~ | | | | | | ID | ID | | | | | | | | | | | | | | 11.3.13 | | | | +-----+------------+------------+----------+--------+---------+ | 55 | Re-auth | Re-auth | O | TV | 2 | | | entication | entication | | | | | | indication | indication | | | | | | | | | | | | | | 11.3.24 | | | | +-----+------------+------------+----------+--------+---------+ | 64 | User | User | O | TLV | 3-n | | | security | security | | | | | | key ID | key ID | | | | | | | | | | | | | | 11.3.32 | | | | +-----+------------+------------+----------+--------+---------+ | 2A | HPLMN ID | HPLMN ID | O | TLV | 5 | | | | | | | | | | | 11.3.bb | | | | +-----+------------+------------+----------+--------+---------+
#### 10.3.16.2 Key establishment information container
The UE shall include this IE if the null integrity protection algorithm is not
in use and the 5G ProSe direct link is not for direct communication between
the 5G ProSe remote UE and the 5G ProSe UE-to-network relay UE.
#### 10.3.16.3 Nonce_1
The UE shall include this IE if the null integrity protection algorithm is not
in use.
NOTE 2: When the 5G ProSe direct link re-keying procedure is between the 5G
ProSe remote UE and the 5G ProSe UE-to-network relay UE and the security
procedure over user plane is used as specified in 3GPP TS 33.503 [34], the
\"Nonce_1\" is called \"K~NRP~ freshness parameter 1\" as specified in 3GPP TS
33.503 [34].
#### 10.3.16.4 MSB of KNRP-sess ID
The UE shall include this IE if the null integrity protection algorithm is not
in use.
#### 10.3.16.5 Re-authentication indication
The UE shall include this IE if the UE wants to derive a new K~NRP~.
#### 10.3.16.6 User security key ID
The UE shall include this IE if the 5G ProSe direct link re-keying procedure
is for direct communication between the 5G ProSe remote UE and the 5G ProSe
UE-to-network relay UE, and:
a) the security procedure over user plane as specified in 3GPP TS 33.503 [34]
is used and the UE has a valid UP-PRUK; or
b) the security procedure over control plane as specified in 3GPP TS 33.503
[34] is used and the UE has a valid CP-PRUK associated with the relay service
code of the target UE.
#### 10.3.16.7 HPLMN ID
The UE shall include this IE if the UP-PRUK ID is included and is not in NAI
format (see 3GPP TS 33.503 [34]).
### 10.3.17 ProSe direct link rekeying response
#### 10.3.17.1 Message definition
This message is sent by a UE to another peer UE to respond to a PROSE DIRECT
LINK REKEYING REQUEST message. See table 10.3.17.1.1.
Message type: PROSE DIRECT LINK REKEYING RESPONSE
Significance: dual
Direction: UE to peer UE
Table 10.3.17.1.1: PROSE DIRECT LINK REKEYING RESPONSE message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | PROSE | ProSe PC5 | M | V | 1 | | | DIRECT LINK | signalling | | | | | | REKEYING | message | | | | | | RESPONSE | type | | | | | | message | | | | | | | identity | 11.3.1. | | | | +-----+-------------+-------------+----------+--------+--------+ | | Sequence | Sequence | M | V | 1 | | | number | number | | | | | | | | | | | | | | 11.3.2 | | | | +-----+-------------+-------------+----------+--------+--------+
### 10.3.18 ProSe direct link identifier update request
#### 10.3.18.1 Message definition
This message is sent by a UE to another peer UE to initiate the direct link
identifier procedure. See table 10.3.18.1.1.
Message type: PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST
Significance: dual
Direction: UE to peer UE
Table 10.3.18.1.1: PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | PROSE | ProSe PC5 | M | V | 1 | | | DIRECT LINK | signalling | | | | | | IDENTIFIER | message | | | | | | UPDATE | type | | | | | | REQUEST | | | | | | | message | 11.3.1 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | Sequence | Sequence | M | V | 1 | | | number | number | | | | | | | | | | | | | | 11.3.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | MSB of | MSB of | M | V | 1 | | | K~NRP-sess~ | K~NRP-sess~ | | | | | | ID | ID | | | | | | | | | | | | | | 11.3.13 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Source | Layer-2 ID | M | V | 3 | | | layer-2 ID | | | | | | | | 11.3.25 | | | | +-----+-------------+-------------+----------+--------+--------+ | 27 | Source user | Application | O | TLV | 3-257 | | | info | layer ID | | | | | | | | | | | | | | 11.3.4 | | | | +-----+-------------+-------------+----------+--------+--------+ | 60 | Source link | Link local | O | TV | 17 | | | local IPv6 | IPv6 | | | | | | address | address | | | | | | | | | | | | | | 11.3.7 | | | | +-----+-------------+-------------+----------+--------+--------+
#### 10.3.18.2 Source user info
This IE is included when the initiating UE receives a new application layer
ID.
#### 10.3.18.3 Source link local IPv6 address
This IE is included when the link local IPv6 address changes at the initiating
UE and the 5G ProSe direct link is not for 5G ProSe direct communication
between 5G ProSe layer-2 remote UE and 5G ProSe layer-2 UE-to-network relay
UE.
### 10.3.19 ProSe direct link identifier update accept
#### 10.3.19.1 Message definition
This message is sent by the UE to another peer UE to indicate that the link
identifier update request is accepted. See table 10.3.19.1.1.
Message type: PROSE DIRECT LINK IDENTIFIER UPDATE ACCEPT
Significance: dual
Direction: UE to peer UE
Table 10.3.19.1.1: PROSE DIRECT LINK IDENTIFIER UPDATE ACCEPT message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | PROSE | ProSe PC5 | M | V | 1 | | | DIRECT LINK | signalling | | | | | | IDENTIFIER | message | | | | | | UPDATE | type | | | | | | ACCEPT | | | | | | | message | 11.3.1 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | Sequence | Sequence | M | V | 1 | | | number | number | | | | | | | | | | | | | | 11.3.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | LSB of | LSB of | M | V | 1 | | | K~NRP-sess~ | K~NRP-sess~ | | | | | | ID | ID | | | | | | | | | | | | | | 11.3.15 | | | | +-----+-------------+-------------+----------+--------+--------+ | | MSB of | MSB of | M | V | 1 | | | K~NRP-sess~ | K~NRP-sess~ | | | | | | ID | ID | | | | | | | | | | | | | | 11.3.13 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Source | Layer-2 ID | M | V | 3 | | | layer-2 ID | | | | | | | | 11.3.25 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Target | Layer-2 ID | M | V | 3 | | | layer-2 ID | | | | | | | | 11.3.25 | | | | +-----+-------------+-------------+----------+--------+--------+ | 28 | Target user | Application | O | TLV | 3-257 | | | info | layer ID | | | | | | | | | | | | | | 11.3.4 | | | | +-----+-------------+-------------+----------+--------+--------+ | 61 | Target link | Link local | O | TV | 17 | | | local IPv6 | IPv6 | | | | | | address | address | | | | | | | | | | | | | | 11.3.7 | | | | +-----+-------------+-------------+----------+--------+--------+ | 27 | Source user | Application | O | TLV | 3-257 | | | info | layer ID | | | | | | | | | | | | | | 11.3.4 | | | | +-----+-------------+-------------+----------+--------+--------+ | 60 | Source link | Link local | O | TV | 17 | | | local IPv6 | IPv6 | | | | | | address | address | | | | | | | | | | | | | | 11.3.7 | | | | +-----+-------------+-------------+----------+--------+--------+
#### 10.3.19.2 Target user info
This IE is included if the target UE receives the Source user info IE in the
PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message.
#### 10.3.19.3 Target link local IPv6 address
This IE is included if the target UE receives the Source link local IPv6
address IE in the PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST message.
#### 10.3.19.4 Source user info
This IE is included when the application layer ID changes at the target UE and
the target UE receives a new application layer ID from the upper layers.
#### 10.3.19.5 Source link local IPv6 address
This IE is included when the link local IPv6 address changes at the target UE
and the target UE receives a new Link local IPv6 address from the upper layers
and the 5G ProSe direct link is not for 5G ProSe direct communication between
5G ProSe layer-2 remote UE and 5G ProSe layer-2 UE-to-network relay UE.
### 10.3.20 ProSe direct link identifier update ack
#### 10.3.20.1 Message definition
This message is sent by the initiating UE to target UE to indicate that the
initiating UE has received target UE\'s accept message. See table 10.3.20.1.1.
Message type: PROSE DIRECT LINK IDENTIFIER UPDATE ACK
Significance: dual
Direction: UE to peer UE
Table 10.3.20.1.1: PROSE DIRECT LINK IDENTIFIER UPDATE ACK message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | PROSE | ProSe PC5 | M | V | 1 | | | DIRECT LINK | signalling | | | | | | IDENTIFIER | message | | | | | | UPDATE ACK | type | | | | | | message | | | | | | | identity | 11.3.1 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Sequence | Sequence | M | V | 1 | | | number | number | | | | | | | | | | | | | | 11.3.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | LSB of | LSB of | M | V | 1 | | | K~NRP-sess~ | K~NRP-sess~ | | | | | | ID | ID | | | | | | | | | | | | | | 11.3.15 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Target | Layer-2 ID | M | V | 3 | | | layer-2 ID | | | | | | | | 11.3.25 | | | | +-----+-------------+-------------+----------+--------+--------+ | 28 | Target user | Application | O | TLV | 3-257 | | | info | layer ID | | | | | | | | | | | | | | 11.3.4 | | | | +-----+-------------+-------------+----------+--------+--------+ | 61 | Target link | Link local | O | TV | 17 | | | local IPv6 | IPv6 | | | | | | address | address | | | | | | | | | | | | | | 11.3.7 | | | | +-----+-------------+-------------+----------+--------+--------+
#### 10.3.20.2 Target user info
This IE is included when the initiating UE receives the Source user info IE in
the PROSE DIRECT LINK IDENTIFIER UPDATE ACCEPT message.
#### 10.3.20.3 Target link local IPv6 address
This IE is included when the initiating UE receives the Source link local IPv6
address IE in the PROSE DIRECT LINK IDENTIFIER UPDATE ACCEPT message.
### 10.3.21 ProSe direct link identifier update reject
#### 10.3.21.1 Message definition
This message is sent by the target UE to initiating UE to indicate that the
link identifier update request is not accepted. See table 10.3.21.1.1.
Message type: PROSE DIRECT LINK IDENTIFIER UPDATE REJECT
Significance: dual
Direction: UE to peer UE
Table 10.3.21.1.1: PROSE DIRECT LINK IDENTIFIER UPDATE REJECT message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | PROSE | ProSe PC5 | M | V | 1 | | | DIRECT LINK | signalling | | | | | | IDENTIFIER | message | | | | | | UPDATE | type | | | | | | REJECT | | | | | | | message | 11.3.1 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | Sequence | Sequence | M | V | 1 | | | number | number | | | | | | | | | | | | | | 11.3.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | PC5 | PC5 | M | V | 1 | | | signalling | signalling | | | | | | protocol | protocol | | | | | | cause | cause | | | | | | | | | | | | | | 11.3.8 | | | | +-----+-------------+-------------+----------+--------+--------+
### 10.3.22 ProSe direct link modification reject
#### 10.3.22.1 Message definition
This message is sent by the UE to another peer UE to indicate that the link
modification request is not accepted. See table 10.3.22.1.1.
Message type: PROSE DIRECT LINK MODIFICATION REJECT
Significance: dual
Direction: UE to peer UE
Table 10.3.22.1.1: PROSE DIRECT LINK MODIFICATION REJECT message content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | PROSE | ProSe PC5 | M | V | 1 | | | DIRECT LINK | signalling | | | | | | M | message | | | | | | ODIFICATION | type | | | | | | REJECT | | | | | | | message | 11.3.1 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | Sequence | Sequence | M | V | 1 | | | number | number | | | | | | | | | | | | | | 11.3.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | PC5 | PC5 | M | V | 1 | | | signalling | signalling | | | | | | protocol | protocol | | | | | | cause | cause | | | | | | | | | | | | | | 11.3.8 | | | | +-----+-------------+-------------+----------+--------+--------+
### 10.3.23 ProSe direct link authentication failure
#### 10.3.23.1 Message definition
This message is sent by a UE to another peer UE to reject a PROSE DIRECT LINK
AUTHENTICATION RESPONSE message. See table 10.3.23.1.1.
Message type: PROSE DIRECT LINK AUTHENTICATION FAILURE
Significance: dual
Direction: UE to peer UE
Table 10.3.23.1.1: PROSE DIRECT LINK AUTHENTICATION FAILURE message content
+-----+------------+------------+----------+--------+---------+ | IEI | I | Type | Presence | Format | Length | | | nformation | /Reference | | | | | | Element | | | | | +=====+============+============+==========+========+=========+ | | PROSE | ProSe PC5 | M | V | 1 | | | DIRECT | signalling | | | | | | LINK | message | | | | | | AUTH | type | | | | | | ENTICATION | | | | | | | FAILURE | 11.3.1. | | | | | | message | | | | | | | identity | | | | | +-----+------------+------------+----------+--------+---------+ | | Sequence | Sequence | M | V | 1 | | | number | number | | | | | | | | | | | | | | 11.3.2 | | | | +-----+------------+------------+----------+--------+---------+ | 74 | Key | Key | O | TLV-E | 4-65538 | | | est | est | | | | | | ablishment | ablishment | | | | | | i | i | | | | | | nformation | nformation | | | | | | container | container | | | | | | | | | | | | | | 11.3.9 | | | | +-----+------------+------------+----------+--------+---------+
#### 10.3.23.2 Key establishment information container
The UE shall include this IE if it is provided by upper layers.
### 10.3.24 ProSe additional parameters announcement request
#### 10.3.24.1 Message definition
This message is sent by the 5G ProSe layer-3 remote UE to 5G ProSe layer-3 UE-
to-network relay UE to initiate the ProSe additional parameters announcement
request procedure. See table 10.3.24.1.1.
Message type: PROSE ADDITIONAL PARAMETERS ANNOUNCEMENT REQUEST
Significance: dual
Direction: UE to peer UE
Table 10.3.24.1.1: PROSE ADDITIONAL PARAMETERS ANNOUNCEMENT REQUEST content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | PROSE | ProSe PC5 | M | V | 1 | | | ADDITIONAL | signalling | | | | | | PARAMETERS | message | | | | | | A | type | | | | | | NNOUNCEMENT | | | | | | | REQUEST | 11.3.1 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | Sequence | Sequence | M | V | 1 | | | Number | Number | | | | | | | | | | | | | | 11.3.2 | | | | +-----+-------------+-------------+----------+--------+--------+
### 10.3.25 ProSe additional parameters announcement response
#### 10.3.25.1 Message definition
This message is sent by the 5G ProSe layer-3 UE-to-network relay UE to the 5G
ProSe layer-3 remote UE to acknowledge and respond to the ProSe additional
parameters announcement request. See table 10.3.25.1.1.
Message type: PROSE ADDITIONAL PARAMETERS ANNOUNCEMENT RESPONSE
Significance: dual
Direction: UE to peer UE
Table 10.3.25.1.1: PROSE ADDITIONAL PARAMETERS ANNOUNCEMENT RESPONSE content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | PROSE | ProSe PC5 | M | V | 1 | | | ADDITIONAL | signalling | | | | | | PARAMETERS | message | | | | | | A | type | | | | | | NNOUNCEMENT | | | | | | | RESPONSE | 11.3.1 | | | | | | identity | | | | | +-----+-------------+-------------+----------+--------+--------+ | | Sequence | Sequence | M | V | 1 | | | Number | number | | | | | | | | | | | | | | 11.3.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Additional | Binary | M | V | 2 | | | parameters | | | | | | | a | 11.3.28 | | | | | | nnouncement | | | | | | | request | | | | | | | refresh | | | | | | | timer T5106 | | | | | +-----+-------------+-------------+----------+--------+--------+
### 10.3.26 ProSe AA message transport request
#### 10.3.26.1 Message definition
This message is sent by the 5G ProSe layer-3 UE-to-network relay UE to the 5G
ProSe layer-3 remote UE to forward the EAP message. See table 10.3.26.1.1.
Message type: PROSE AA MESSAGE TRANSPORT REQUEST
Significance: dual
Direction: UE to peer UE
Table 10.3.26.1.1: PROSE AA MESSAGE TRANSPORT REQUEST content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | PROSE AA | ProSe PC5 | M | V | 1 | | | MESSAGE | signalling | | | | | | TRANSPORT | message | | | | | | REQUEST | type | | | | | | identity | | | | | | | | 11.3.1 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Sequence | Sequence | M | V | 1 | | | Number | number | | | | | | | | | | | | | | 11.3.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | 70 | EAP message | EAP message | O | TLV-E | 7-1503 | | | | | | | | | | | 11.3.31 | | | | +-----+-------------+-------------+----------+--------+--------+
#### 10.3.26.2 EAP message
The EAP message IE is included if the PROSE AA MESSAGE TRANSPORT REQUEST
message is used in an EAP based authentication procedure.
### 10.3.27 ProSe AA message transport response
#### 10.3.27.1 Message definition
This message is sent by the 5G ProSe layer-3 remote UE to the 5G ProSe layer-3
UE-to-network relay UE to forward the EAP message. See table 10.3.27.1.1.
Message type: PROSE AA MESSAGE TRANSPORT RESPONSE
Significance: dual
Direction: UE to peer UE
Table 10.3.27.1.1: PROSE AA MESSAGE TRANSPORT RESPONSE content
+-----+-------------+-------------+----------+--------+--------+ | IEI | Information | Typ | Presence | Format | Length | | | Element | e/Reference | | | | +=====+=============+=============+==========+========+========+ | | PROSE AA | ProSe PC5 | M | V | 1 | | | MESSAGE | signalling | | | | | | TRANSPORT | message | | | | | | RESPONSE | type | | | | | | identity | | | | | | | | 11.3.1 | | | | +-----+-------------+-------------+----------+--------+--------+ | | Sequence | Sequence | M | V | 1 | | | Number | number | | | | | | | | | | | | | | 11.3.2 | | | | +-----+-------------+-------------+----------+--------+--------+ | 70 | EAP message | EAP message | O | TLV-E | 7-1503 | | | | | | | | | | | 11.3.31 | | | | +-----+-------------+-------------+----------+--------+--------+
#### 10.3.27.2 EAP message
The EAP message IE is included if the PROSE AA MESSAGE TRANSPORT RESPONSE
message is used in an EAP based authentication procedure.
## 10.4 Provisioning of 5G ProSe configuration information signalling messages
### 10.4.1 UE policy provisioning request
The UE POLICY PROVISIONING REQUEST message is sent by the UE to the PCF to
request the PCF to manage ProSeP, see 3GPP TS 24.587 [18] clause 7.2.1 for the
message definition.
### 10.4.2 UE policy provisioning reject
The UE POLICY PROVISIONING REJECT message is sent by the PCF to the UE to
report that the PCF rejects the request to manage ProSeP, see 3GPP TS 24.587
[18] clause 7.2.2 for the message definition.
## 10.5 5G ProSe discovery and security messages over PC3a
### 10.5.1 General
This clause defines the XML schema and MIME type related to 5G ProSe direct
discovery messages.
### 10.5.2 application/vnd.3gpp-prose-pc3a+xml
The MIME type is used to carry information related to the 5G ProSe discovery
operation. It shall be coded as an XML document containing one of the
following 5G ProSe discovery messages:
a) DISCOVERY_REQUEST;
b) DISCOVERY_RESPONSE;
c) MATCH_REPORT;
d) MATCH_REPORT_ACK;
e) DISCOVERY_UPDATE_REQUEST;
f) DISCOVERY_UPDATE_RESPONSE;
g) ANNOUNCING_ALERT_REQUEST;
h) ANNOUNCING_ALERT_RESPONSE;
i) PROSE_5GPKMF_ADDRESS_REQUEST;
j) PROSE_5GPKMF_ADDRESS_RESPONSE;
k) PROSE_SECURITY_MATERIAL_REQUEST; or
l) PROSE_SECURITY_MATERIAL_RESPONSE
Each of those messages is presented in the XML document as an XML element
named after the corresponding message.
### 10.5.3 XML schema
Implementations in compliance with the present document shall implement the
XML schema defined below for messages used in 5G ProSe direct discovery
procedures over PC3a interface.
\
\
\
\
Info for 5G ProSe Discovery Control Messages Syntax
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
An entity receiving the XML body ignores any unknown XML element and any
unknown XML attribute.
### 10.5.4 Semantics
#### 10.5.4.1 General
The \ element is the root element of this XML
document and it can be one of the following elements:
a) \;
b) \;
c) \;
d) \;
e) \;
f) \
g) \;
h) \;
i) \;
j) \;
k) \;
l) \;
m) \ element containing other discovery message defined in future
releases; or
n) an element from other namespaces defined in future releases.
#### 10.5.4.2 Semantics of \
The \ element contains one or more of the following
elements:
a) zero, one or more \ element which contains transactions
sent from the UE to the 5G DDNMF as announcing or monitoring requests for open
5G ProSe direct discovery. Each \ consists of:
1) a \ element containing the parameter defined in clause
11.4.2.1;
2) a \ element containing the parameter defined in clause 11.4.2.2;
3) a \ element containing the parameter defined in
clause 11.4.2.4;
4) an \ element containing the parameter defined in
clause 11.4.2.5;
5) a \ element containing the parameter defined in clause
11.4.2.26;
6) an optional \ element containing the parameter defined in
clause 11.4.2.20;
7) an optional \ element containing the parameter defined in clause
11.4.2.15;
8) an optional \ element containing the parameter defined
in clause 11.4.2.43;
9) zero or one \ element containing the parameter
defined in clause 11.4.2.31;
10) zero or one \ element containing elements defined in future
releases;
11) zero, one or more elements from other namespaces defined in future
releases; and
12) zero, one or more attributes defined in future releases;
b) zero, one, or more \ element which contains
transactions sent from the UE to the 5G DDNMF as announcing or monitoring
requests for restricted 5G ProSe directed discovery model A or transactions
sent from the UE to the 5G DDNMF as discoveree or discoverer requests for
restricted 5G ProSe directed discovery model B. Each \ consists of:
1) a \ element containing the parameter defined in clause
11.4.2.1;
2) a \ element containing the parameter defined in clause 11.4.2.2;
3) a \ element containing the parameter defined in clause 11.4.2.23;
4) an \ element containing the parameter defined in
clause 11.4.2.5;
5) a \ element containing the parameter defined in clause
11.4.2.18;
6) zero or one \ element containing the parameter
defined in clause 11.4.2.31;
7) an \ element containing the parameter defined in clause
11.4.2.24;
8) an \ element containing the parameter defined
in clause 11.4.2.25;
9) zero or one \ element containing the parameter defined in
clause 11.4.2.34;
10) zero or one \ element containing the parameter defined
in clause 11.4.2.43;
11) a \ element containing the parameter defined in clause
11.4.2.26;
12) an optional \ element containing the parameter defined in
clause 11.4.2.20;
13) a \ element containing the
parameter defined in clause 11.4.2.50;
14) zero or one \ element containing elements defined in future
releases;
15) zero, one or more elements from other namespaces defined in future
releases; and
16) zero, one or more attributes defined in future releases;
c) zero or one \ element containing elements defined in future
releases;
d) zero, one or more elements from other namespaces defined in future
releases;
e) an optional \"network-initiated transaction method\" attribute containing
the parameter defined in clause 11.4.2.42; and
f) zero, one or more attributes defined in future releases.
#### 10.5.4.3 Semantics of \
The \ element contains one or more of the following
elements:
a) a \ element containing the parameter defined in clause
11.4.2.16;
b) a \ element containing the parameter defined in clause
11.4.2.17;
c) zero, one or more \ element which contains transactions
sent from the 5G DDNMF to the UE as a response to an announcing request if the
5G DDNMF accepts the request. Each \ consists of:
1) a \ element containing the parameter defined in clause
11.4.2.1;
2) zero, one or more \ elements containing the
parameter defined in clause 11.4.2.6;
3) zero or one \ element containing the parameter
defined in clause 11.4.2.45;
4) zero, or one \ element containing the parameter
defined in 11.4.2.7;
5) zero, or, one \ element containing the parameter defined in
clause 11.4.2.48;
6) a \ element containing the parameter defined in clause
11.4.2.26;
7) zero or one \ element containing the parameter
defined in clause 11.4.2.31;
8) zero or one \ element containing elements defined in future
releases;
9) zero, one or more elements from other namespaces defined in future
releases; and
10) zero, one or more attributes defined in future releases;
d) zero, one or more \ element which contains transactions
sent from the 5G DDNMF to the UE as a response to a monitoring request if the
5G DDNMF accepts the request. Each \ consists of:
1) a \ element containing the parameter defined in clause
11.4.2.1;
2) zero, one or more \ elements containing the parameter
defined in clause 11.4.2.9;
3) a \ element containing the parameter defined in clause
11.4.2.26;
4) zero or one \ element containing the parameter
defined in clause 11.4.2.31;
5) zero or one \ element containing elements defined in future
releases;
6) zero, one or more elements from other namespaces defined in future
releases; and
7) zero, one or more attributes defined in future releases;
e) zero, one or more \ element which contains
transactions sent from the 5G DDNMF to the UE as a response to an announcing
request for restricted 5G ProSe direct discovery model A if the 5G DDNMF
accepts the request. Each \ consists of:
1) a \ element containing the parameter defined in clause
11.4.2.1;
2) zero or one \ element containing the parameter
defined in clause 11.4.2.27;
3) zero, one or more \ element containing
the parameter defined in clause 11.4.2.28;
4) zero or one \ element containing the parameter
defined in 11.4.2.32;
5) zero or one \ element containing the parameter
defined in clause 11.4.2.31;
6) a \ element containing the parameter
defined in clause 11.4.2.33;
7) zero or one \ element containing
the parameter defined in clause 11.4.2.29;
8) a \ element containing the parameter defined in clause
11.4.2.26;
9) a \ element containing the parameter
defined in clause 11.4.2.51;
10) zero or one \ element containing the parameter
defined in clause 11.4.2.49;
11) zero or one \ element containing elements defined in future
releases;
12) zero, one or more elements from other namespaces defined in future
releases; and
13) zero, one or more attributes defined in future releases;
f) zero, one or more \ element which contains
transactions sent from the 5G DDNMF to the UE as a response to a monitoring
request for restricted 5G ProSe direct discovery model A if the 5G DDNMF
accepts the request. Each \ consists of:
1) a \ element containing the parameter defined in clause
11.4.2.1;
2) one or more \ elements containing the
parameter defined in clause 11.4.2.30;
3) zero or one \ element containing the parameter
defined in clause 11.4.2.31
4) a \ element containing the parameter defined in clause
11.4.2.26;
5) an \ element containing the parameter defined
in clause 11.4.2.25;
6) one or more \ element containing the
parameter defined in clause 11.4.2.33;
7) a \ element containing the parameter
defined in clause 11.4.2.51;
8) zero or one \ element containing the parameter
defined in clause 11.4.2.49;
9) zero or one \ element containing elements defined in future
releases;
10) zero, one or more elements from other namespaces defined in future
releases; and
11) zero, one or more attributes defined in future releases;
g) zero, one or more \ element which contains
transactions sent from the 5G DDNMF to the UE as a response to a discoveree
UE\'s request for restricted 5G ProSe direct discovery model B if the 5G DDNMF
accepts the request. Each \ consists of:
1) a \ element containing the parameter defined in clause
11.4.2.1;
2) a \ element containing the element defined in
clause11.4.2.35;
3) one or more \ elements containing the parameter defined in
clause 11.4.2.36;
4) a \ element containing the parameter defined in
clause 11.4.2.37;
5) a \ element containing the parameter
defined in clause 11.4.2.33;
6) one or more \ element containing the
parameter defined in clause 11.4.2.33;
7) a \ element containing the parameter defined in clause
11.4.2.26;
8) zero or one \ element containing the parameter
defined in clause 11.4.2.49;
9) a \ element containing the parameter
defined in clause 11.4.2.51;
10) zero or one \ element containing elements defined in future
releases;
11) zero, one or more elements from other namespaces defined in future
releases; and
12) zero, one or more attributes defined in future releases;
h) zero, one or more \ element which contains
transactions sent from the 5G DDNMF to the UE as a response to a discoverer
UE\'s request for restricted 5G ProSe direct discovery model B if the 5G DDNMF
accepts the request. Each \ consists of:
1) a \ element containing the parameter defined in clause
11.4.2.1;
2) one or more \ elements containing the parameter defined in
clause 11.4.2.38;
3) a \ element containing the parameter
defined in clause 11.4.2.33;
4) one or more \ element containing the
parameter defined in clause 11.4.2.33;
5) a \ element containing the parameter defined in clause
11.4.2.26;
6) zero or one \ element containing the parameter
defined in clause 11.4.2.49;
7) a \ element containing the parameter
defined in clause 11.4.2.51;
8) zero or one \ element containing elements defined in future
releases;
9) zero, one or more elements from other namespaces defined in future
releases; and
10) zero, one or more attributes defined in future releases;
i) zero, one or more \ element which contains transactions
sent from the 5G DDNMF to the UE as a response to an announcing or monitoring
requests if the 5G DDNMF cannot accept the request. Each \
consists of:
1) a \ element containing the parameter defined in clause
11.4.2.1;
2) a \ element containing the parameter
defined in clause 11.4.2.8.
3) zero, one or more elements defined in future releases; and
4) zero, one or more attributes defined in future releases;
j) zero or one \ element containing elements defined in future
releases;
k) zero, one or more elements from other namespaces defined in future
releases;
l) an optional \"network-initiated transaction method\" attribute containing
the parameter defined in clause 11.4.2.42; and
m) zero, one or more attributes defined in future releases.
#### 10.5.4.4 Semantics of \
The \ element contains one or more of the following elements:
a) zero, one or more \ element which contains transactions sent
from the UE to the 5G DDNMF to report a matching of the direct discovery. Each
\ consists of:
1) a \ element containing the parameter defined in clause
11.4.2.1;
2) a \ element containing the parameter defined
in clause 11.4.2.52;
3) a \ element containing the parameter defined in clause
11.4.2.10;
4) an optional \ element containing the parameter defined in clause
11.4.2.11;
5) a \ element containing the parameter defined in clause
11.4.2.12;
6) a \ element containing the parameter defined in clause
11.4.2.14;
7) zero or one \ element containing elements defined in future
releases;
8) zero, one or more elements from other namespaces defined in future
releases; and
9) zero, one or more attributes defined in future releases;
b) zero, one or more \ element which contain transactions
sent from the UE to the 5G DDNMF to report a matching of the restricted direct
discovery model A or model B. Each \ consists of:
1) a \ element containing the parameter defined in clause
11.4.2.1;
2) a \ element containing the parameter defined in clause
11.4.2.18
3) an \ element containing the parameter defined in
clause 11.4.2.5
4) an \ element containing the parameter defined in clause 11.4.2.23;
5) zero or one \ element containing the parameter
defined in clause 11.4.2.52, if it is required to check the MIC via the match
report procedure;
6) zero or one \ element containing the ProSe
Restricted Code parameter defined in clause 11.4.2.27 or ProSe Response Code
parameter defined in clause 11.4.2.35, if it is not required to check the MIC
via the match report procedure;
7) a \ element containing the parameter defined in clause
11.4.2.12, if it is required to check the MIC via the match report procedure;
8) a \ element containing the parameter defined in clause
11.4.2.14;
9) zero or one \ element containing elements defined in future
releases;
10) zero, one or more elements from other namespaces defined in future
releases; and
11) zero, one or more attributes defined in future releases.
c) zero or one \ element containing elements defined in future
releases;
d) zero, one or more elements from other namespaces defined in future
releases; and
e) zero, one or more attributes defined in future releases.
#### 10.5.4.5 Semantics of \
The \ element contains one or more of the following
elements:
a) a \ element containing the parameter defined in clause
11.4.2.16;
b) zero, one or more \ element which contains transactions sent
from the 5G DDNMF to the UE as a response to a match report if the 5G DDNMF
accepts the report. Each \ consists of:
1) a \ element containing the parameter defined in clause
11.4.2.1;
2) a \ element containing the parameter defined in
clause 11.4.2.4;
3) a \ element containing the parameter defined in
clause 11.4.2.13;
4) an optional \ element containing the parameter defined in clause
11.4.2.15;
5) an optional \ element containing the parameter defined
in clause 11.4.2.41;
6) a mandatory \"match-report-refresh-timer-T5074\" attribute containing the
parameter defined in clause 11.4.2.19;
7) zero or one \ element containing elements defined in future
releases;
8) zero, one or more elements from other namespaces defined in future
releases; and
9) zero, one or more attributes defined in future releases;
c) zero, one or more \ element which contain
transactions sent from the 5G DDNMF to the UE as a response to a match report
if the 5G DDNMF accepts the report. Each \ consists of:
1) a \ element containing the parameter defined in clause
11.4.2.1;
2) an \ element containing the parameter defined in
clause 11.4.2.5;
3) an \ element containing the parameter defined in clause 11.4.2.23;
4) a \ element containing the parameter defined in
clause 11.4.2.39;
5) an optional \ element containing the parameter defined in clause
11.4.2.15;
6) zero or one \ element containing elements defined in future
releases;
7) zero, one or more elements from other namespaces defined in future
releases;
8) an optional \"match-report-refresh-timer-T5077\" attribute containing the
parameter defined in clause 11.4.2.40; and
9) zero, one or more attributes defined in future releases;
d) zero, one or more \ element which contains transactions sent
from the 5G DDNMF to the UE as a response to a match report if the 5G DDNMF
cannot accept the match report. Each \ consists of:
1) a \ element containing the parameter defined in clause
11.4.2.1;
2) a \ element containing the parameter
defined in clause 11.4.2.8;
3) zero, one or more elements defined in future releases; and
4) zero, one or more attributes defined in future releases;
e) zero or one \ element containing elements defined in future
releases;
f) zero, one or more elements from other namespaces defined in future
releases; and
g) zero, one or more attributes defined in future releases.
#### 10.5.4.6 Semantics of \
The \ element contains one or more of the following
elements:
a) One or more \ element which contains transactions
sent from the 5G DDNMF to the UE as announcing or monitoring requests. Each
\ consists of:
1) a \ element containing the parameter defined in
clause 11.4.2.21;
2) a \ element containing the parameter defined in clause
11.4.2.26;
3) an optional \ element containing the parameter defined in
clause 11.4.2.22;
4) zero or one \ element containing elements defined in future
releases;
5) zero, one or more elements defined in future releases; and
6) zero, one or more attributes defined in future releases;
b) zero or one \ element containing elements defined in future
releases;
c) zero, one or more elements from other namespaces defined in future
releases; and
d) zero, one or more attributes defined in future releases.
#### 10.5.4.7 Semantics of \
The \ element contains one or more of the
following elements:
a) one or more \ element which contains transactions sent
from the UE to the 5G DDNMF as a response if the UE accepts the request. Each
\ consists of:
1) a \ element containing the parameter defined in
clause 11.4.2.21;
2) a \ element containing the parameter defined in clause
11.4.2.26;
3) zero, one or more elements defined in future releases; and
4) zero, one or more attributes defined in future releases;
b) zero, one or more \ element which contains transactions
sent from the UE to the 5G DDNMF as a response if the UE cannot accept the
request. Each \ consists of:
1) a \ element containing the parameter defined in
clause 11.4.2.21;
2) a \ element containing the parameter
defined in clause 11.4.2.8.
3) zero, one or more elements defined in future releases; and
4) zero, one or more attributes defined in future releases;
c) zero or one \ element containing elements defined in future
releases;
d) zero, one or more elements from other namespaces defined in future
releases; and
e) zero, one or more attributes defined in future releases.
#### 10.5.4.8 Semantics of \
The \ element contains one or more of the following
elements:
a) One or more \ element which contains transactions
sent from the UE to the 5G DDNMF as announcing or monitoring requests. Each
\ consists of:
1) a \ element containing the parameter defined in
clause 11.4.2.21;
2) a \ element containing the parameter defined in clause 11.4.2.23;
3) a \ element containing the parameter defined in clause
11.4.2.26;
4) a \ element containing the parameter defined in
clause 11.4.2.27;
5) zero, one or more \ element containing
the parameter defined in clause 11.4.2.28;
6) zero or one \ element containing elements defined in future
releases;
7) zero, one or more elements from other namespaces defined in future
releases; and
8) zero, one or more attributes defined in future releases;
b) zero or one \ element containing elements defined in future
releases;
c) zero, one or more elements from other namespaces defined in future
releases; and
d) zero, one or more attributes defined in future releases.
#### 10.5.4.9 Semantics of \
The \ element contains one or more of the following
elements:
a) One or more \ element which contains
transactions sent from the UE to the 5G DDNMF as announcing or monitoring
requests. Each \ consists of:
1) a \ element containing the parameter defined in
clause 11.4.2.21;
2) zero, one or more elements defined in future releases; and
3) zero, one or more attributes defined in future releases;
b) zero, one or more \ element which contains transactions
sent from the UE to the 5G DDNMF as a response if the UE cannot accept the
request. Each \ consists of:
1) a \ element containing the parameter defined in
clause 11.4.2.21;
2) a \ element containing the parameter
defined in clause 11.4.2.8.
3) zero, one or more elements defined in future releases; and
4) zero, one or more attributes defined in future releases;
c) zero or one \ element containing elements defined in future
releases;
d) zero, one or more elements from other namespaces defined in future
releases; and
e) zero, one or more attributes defined in future releases.
#### 10.5.4.10 Semantics of \
The \ element contains one or more of the
following elements:
a) zero, one or more \ element which contains
transactions sent from the UE to the 5G DDNMF. Each \
consists of:
1) a \ element containing the parameter defined in clause
11.4.2.1;
2) zero or one \ element containing elements defined in future
releases;
3) zero, one or more elements from other namespaces defined in future
releases; and
4) zero, one or more attributes defined in future releases;
b) zero or one \ element containing elements defined in future
releases;
c) zero, one or more elements from other namespaces defined in future
releases; and
d) zero, one or more attributes defined in future releases.
#### 10.5.4.11 Semantics of \
The \ element contains one or more of the
following elements:
a) zero, one or more \ element which contains
transactions sent from the 5G DDNMF to the UE. Each \
consists of:
1) a \ element containing the parameter defined in clause
11.4.2.1;
2) a \ element containing the parameter defined in clause
11.4.2.53;
3) zero or one \ element containing elements defined in future
releases;
4) zero, one or more elements from other namespaces defined in future
releases; and
5) zero, one or more attributes defined in future releases;
b) zero, one or more \ element which contains
transactions sent from the 5G DDNMF to the UE as a response if the 5G DDNMF
cannot accept the request. Each \ consists of:
1) a \ element containing the parameter defined in clause
11.4.2.1;
2) a \ element containing the parameter
defined in clause 11.4.2.8.
3) zero, one or more elements defined in future releases; and
4) zero, one or more attributes defined in future releases;
c) zero or one \ element containing elements defined in future
releases;
d) zero, one or more elements from other namespaces defined in future
releases; and
e) zero, one or more attributes defined in future releases.
#### 10.5.4.12 Semantics of \
The semantics of \ is same as the semantics
of \ defined in clause 10.6.4.2, where 5G PKMF
is replaced by 5G DDNMF.
#### 10.5.4.13 Semantics of \
The semantics of \ is same as the semantics
of \ defined in clause 10.6.4.3, where 5G PKMF
is replaced by 5G DDNMF.
## 10.6 5G ProSe security messages over PC8
### 10.6.1 General
This clause defines the XML schema and MIME type related to 5G ProSe security
messages.
### 10.6.2 application/vnd.3gpp-prose-pc8+xml
The MIME type is used to carry information related to the 5G ProSe security
operation. It shall be coded as an XML document containing one of the
following 5G ProSe security messages:
a) a PROSE_SECURITY_PARAM_REQUEST message;
b) a PROSE_SECURITY_PARAM_RESPONSE message;
c) a PROSE_PRUK_REQUEST message;
d) a PROSE_PRUK_RESPONSE message;
e) a PROSE_KEY_REQUEST message; or
f) a PROSE_KEY_RESPONSE message.
Each of those messages is presented in the XML document as an XML element
named after the corresponding message.
### 10.6.3 XML schema
Implementations in compliance with the present document shall implement the
XML schema defined below for messages used in 5G ProSe security procedures
over PC8 interface.
\
\
\
\
Info for 5G ProSe Security Control Messages Syntax
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
An entity receiving the XML body ignores any unknown XML element and any
unknown XML attribute.
### 10.6.4 Semantics
#### 10.6.4.1 General
The \ element is the root element of this XML document
and it contains one of the following elements:
a) a \ element;
b) a \ element;
c) a \ element;
d) a \ element;
e) a \ element;
f) a \ element;
g) \ element containing other discovery message defined in future
releases; or
h) an element from other namespaces defined in future releases.
#### 10.6.4.2 Semantics of \ element
The \ element contains:
a) zero or more \ elements which
contain transactions sent from the UE to the 5G PKMF;
b) zero or one \ element containing elements defined in future
releases;
c) zero or more elements from other namespaces defined in future releases; and
d) zero or more attributes defined in future releases.
The \ contains:
a) a \ element containing the parameter defined in clause
11.6.2.1;
b) a \ element;
c) a \ element containing the parameter defined
in clause 11.6.2.4;
d) zero or one \ element;
e) zero or one \ element;
f) zero or one \ element containing elements defined in future
releases;
g) zero or more elements from other namespaces defined in future releases; and
h) zero or more attributes defined in future releases.
The \ element contains:
a) the following:
1) a \ element indicating that the 5G ProSe UE-to-network relay
discovery security parameters for 5G ProSe remote UE are requested;
2) a \ element indicating that the 5G ProSe UE-to-network relay discovery
security parameters for 5G ProSe UE-to-network relay UE are requested; or
3) both;
b) zero or one \ element containing elements defined in future
releases;
c) zero or more elements from other namespaces defined in future releases; and
d) zero or more attributes defined in future releases.
The \ element contains:
a) one or more \ elements;
b) zero or one \ element containing elements defined in future
releases;
c) zero or more elements from other namespaces defined in future releases; and
d) zero or more attributes defined in future releases.
The \ element contains:
a) an \ elements containing the parameter defined in clause 11.6.2.5;
b) an \ elements containing the parameter defined in clause 11.6.2.6;
c) zero or one \ element containing elements defined in future
releases;
d) zero or more elements from other namespaces defined in future releases; and
e) zero or more attributes defined in future releases.
The \ element contains:
a) a \ elements indicating that security parameters are requested for
5G ProSe UE-to-network relay discovery over PC5 interface model A or an
\ elements indicating that security parameters are requested for 5G
ProSe UE-to-network relay discovery over PC5 interface model B;
b) zero or one \ element containing elements defined in future
releases;
c) zero or more elements from other namespaces defined in future releases; and
d) zero or more attributes defined in future releases.
#### 10.6.4.3 Semantics of \ element
The \ element sent from the 5G PKMF to the UE
contains:
a) zero or more \ elements which
contain accepted transactions;
b) zero or more \ elements which
contain rejected transactions;
c) zero or one \ element containing elements defined in future
releases;
d) zero or more elements from other namespaces defined in future releases; and
e) zero or more attributes defined in future releases.
The \ contains:
a) a \ element containing the parameter defined in clause
11.6.2.1;
b) zero or one \ element indicating the 5G
ProSe UE-to-network relay discovery security parameters for 5G ProSe remote
UE;
c) zero or one \ element indicating the PC5 security policies per relay service code
for 5G ProSe remote UE;
d) zero or one \ element indicating the 5G ProSe
UE-to-network relay discovery security parameters for 5G ProSe UE-to-network
relay UE;
e) zero or one \
element indicating the PC5 security policies per relay service code for 5G
ProSe UE-to-network relay UE;
f) a \ element containing the parameter defined in clause
11.6.2.7;
g) a \ element containing the parameter defined in clause
11.6.2.8;
h) zero or one \ element containing elements defined in future
releases;
i) zero or more elements from other namespaces defined in future releases; and
j) zero or more attributes defined in future releases.
The \ element contains:
a) an \ element containing the parameter defined in clause
11.6.2.9;
b) a \ element;
c) zero or one \ element containing elements defined in future
releases;
d) zero or more elements from other namespaces defined in future releases; and
e) zero or more attributes defined in future releases.
The \ element included in
the \ element contains:
a) one or more \ elements;
b) zero or one \ element containing elements defined in future
releases;
c) zero or more elements from other namespaces defined in future releases; and
d) zero or more attributes defined in future releases.
The \ element included in the
\ element included in the
\ element contains:
a) a \ element containing the parameter defined in clause
11.6.2.10;
b) optionally a \ element;
c) optionally a \ element;
d) optionally a \ element;
e) a \ element containing the parameter
defined in clause 11.6.2.11;
f) zero or one \ element containing elements defined in future
releases;
g) zero or more elements from other namespaces defined in future releases; and
h) zero or more attributes defined in future releases.
The \ element, the \ element, the \ element and the \ element contain:
a) optionally a \ element containing the parameter defined in clause
11.6.2.12;
b) optionally a \ element containing the parameter defined in clause
11.6.2.13;
c) optionally a \ element;
d) zero or one \ element containing elements defined in future
releases;
e) zero or more elements from other namespaces defined in future releases; and
f) zero or more attributes defined in future releases.
The \ element contains:
a) a \ element containing the parameter
defined in clause 11.6.2.14;
b) an \ element containing the parameter defined in clause
11.6.2.15;
c) zero or one \ element containing elements defined in future
releases;
d) zero or more elements from other namespaces defined in future releases; and
e) zero or more attributes defined in future releases.
The \
element and the \ element contain:
a) one or more \ elements;
b) zero or one \ element containing elements defined in future
releases;
c) zero or more elements from other namespaces defined in future releases; and
d) zero or more attributes defined in future releases.
The \ element contains:
a) a \ element containing the parameter defined in clause
11.6.2.10;
b) a \ element;
c) zero or one \ element containing elements defined in future
releases;
d) zero or more elements from other namespaces defined in future releases; and
e) zero or more attributes defined in future releases.
The \ element contains:
a) a \ element containing the parameter defined
in clause 11.6.2.17;
b) a \ element containing the
parameter defined in clause 11.6.2.18;
c) a \ element containing the parameter defined
in clause 11.6.2.19;
d) zero or one \ element containing elements defined in future
releases;
e) zero or more elements from other namespaces defined in future releases; and
f) zero or more attributes defined in future releases.
The \ element contains:
a) an \ element containing the parameter defined in clause
11.6.2.9;
b) a \ element; and
c) zero or one \ element containing elements defined in future
releases;
d) zero or more elements from other namespaces defined in future releases; and
e) zero or more attributes defined in future releases.
The \ element included in
the \ element contains:
a) one or more \ elements;
b) zero or one \ element containing elements defined in future
releases;
c) zero or more elements from other namespaces defined in future releases; and
d) zero or more attributes defined in future releases.
The \ element included in the
\ element included in the
\ element contains:
a) a \ element containing the parameter defined in clause
11.6.2.10;
b) optionally a \ element;
c) optionally a \ element;
d) optionally a \ element;
e) a \ element containing the parameter
defined in clause 11.6.2.11;
f) zero or one \ element containing elements defined in future
releases;
g) zero or more elements from other namespaces defined in future releases; and
h) zero or more attributes defined in future releases.
The \ element contains:
a) a \ element containing the parameter defined in clause
11.6.2.1;
b) a \ element containing the parameter
defined in clause 11.6.2.20;
c) zero or one \ element containing elements defined in future
releases;
d) zero or more elements from other namespaces defined in future releases; and
e) zero or more attributes defined in future releases.
#### 10.6.4.4 Semantics of \
The \ element contains:
a) zero or more \ elements which contain transactions sent from
the UE to the 5G PKMF;
b) zero or one \ element containing elements defined in future
releases;
c) zero or more elements from other namespaces defined in future releases; and
d) zero or more attributes defined in future releases.
The \ element contains:
a) a \ element containing the parameter defined in clause
11.6.2.1;
b) zero or one \ element containing the parameter defined in
clause 11.6.2.3;
c) zero or one \ element containing elements defined in future
releases;
d) zero or more elements from other namespaces defined in future releases; and
e) zero or more attributes defined in future releases;
#### 10.6.4.5 Semantics of \
The \ element contains:
a) zero or more \ elements which contain the accepted
transactions;
b) zero or more \ elements which contain the rejected
transactions;
c) zero or one \ element containing elements defined in future
releases;
d) zero or more elements from other namespaces defined in future releases; and
e) zero or more attributes defined in future releases.
The \ element contains:
a) a \ element containing the parameter defined in clause
11.6.2.1;
b) a \ element containing the parameter defined in clause
11.6.2.3;
c) a \ element containing the parameter defined in clause 11.6.2.2;
d) zero or one \ element containing elements defined in future
releases;
e) zero or more elements from other namespaces defined in future releases; and
f) zero or more attributes defined in future releases.
The \ element contains:
a) a \ element containing the parameter defined in clause
11.6.2.1;
b) a \ element containing the parameter
defined in clause 11.6.2.20;
c) zero or one \ element containing elements defined in future
releases;
d) zero or more elements from other namespaces defined in future releases; and
e) zero or more attributes defined in future releases.
#### 10.6.4.6 Semantics of \ element
The \ element contains:
a) zero or more \ elements which contain transactions sent from
the UE to the 5G PKMF.
b) zero or one \ element containing elements defined in future
releases;
c) zero or more elements from other namespaces defined in future releases; and
d) zero or more attributes defined in future releases.
The \ element contains:
a) a \ element containing the parameter defined in clause
11.6.2.1;
b) a \ element containing the parameter defined in clause
11.6.2.10;
c) zero or one \ element containing the parameter defined in clause
11.6.2.21;
d) zero or one \ element containing the parameter defined in
clause 11.6.2.3;
e) a \ element containing the parameter defined in
clause 11.6.2.22;
f) zero or one \ element;
g) zero or one \ element containing the parameter defined in clause
11.6.2.23;
h) zero or one \ element containing the parameter defined in clause
11.6.2.24;
i) zero or one \ element containing elements defined in future
releases;
j) zero or more elements from other namespaces defined in future releases; and
k) zero or more attributes defined in future releases.
The \ element contains:
a) an \ elements containing the parameter defined in clause 11.6.2.5;
b) an \ elements containing the parameter defined in clause 11.6.2.6;
c) zero or one \ element containing elements defined in future
releases;
d) zero or more elements from other namespaces defined in future releases; and
e) zero or more attributes defined in future releases.
#### 10.6.4.7 Semantics of \ element
The \ element sent from the 5G PKMF to the UE contains:
a) zero or more \ elements which contain accepted transactions;
b) zero or more \ elements which contain rejected transactions;
c) zero or one \ element containing elements defined in future
releases;
d) zero or more elements from other namespaces defined in future releases; and
e) zero or more attributes defined in future releases.
The \ contains:
a) a \ element containing the parameter defined in clause
11.6.2.1;
b) a \ element containing the parameter defined in clause
11.6.2.3;
c) a \ element containing the parameter defined in clause 11.6.2.25;
d) a \ element containing the parameter defined in
clause 11.6.2.26;
e) zero or one \ element containing the parameter defined in clause
11.6.2.16;
f) zero or one \ element containing elements defined in future
releases;
g) zero or more elements from other namespaces defined in future releases; and
h) zero or more attributes defined in future releases.
The \ element contains:
a) a \ element containing the parameter defined in clause
11.6.2.1;
b) a \ element containing the parameter
defined in clause 11.6.2.20;
c) zero or one \ element containing elements defined in future
releases;
d) zero or more elements from other namespaces defined in future releases; and
e) zero or more attributes defined in future releases.
## 10.7 Messages transmitted over the PC3ach interface
### 10.7.1 General
This clause defines XML schema and MIME type related to messages transmitted
over the PC3ach interface.
### 10.7.2 application/vnd.3gpp-prose-pc3ach+xml
The MIME type is used to carry information related to message transmitted over
the PC3ach interface. It shall be coded as an XML document compliant to the
XML schema in clause 10.7.3 containing one of the following messages:
\- PROSE_USAGE_INFORMATION_REPORT_LIST; or
\- PROSE_USAGE_INFORMATION_REPORT_LIST_RESPONSE.
Each of those messages is presented in the XML document as an XML element
named after the corresponding message.
### 10.7.3 XML Schema
\
\
\
\
Syntax of messages transmitted over the PC3ach interface
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
### 10.7.4 Semantics
#### 10.7.4.1 General
The \ element is the root element of this XML document.
The \ element contains one of the following:
a) \ element;
b) \ element;
c) \ element containing elements defined in future releases; or
d) one or more elements from other namespace defined in future releases.
The \ element contains zero, one or more attributes
defined in future releases.
#### 10.7.4.2 Semantics of \
The \ element contains:
a) a \ element containing the parameter defined in clause
11.6.2.1;
b) one or more \ elements;
c) zero, one or more \ element;
d) zero or one \ element containing elements defined in future
releases;
e) zero, one or more elements from other namespaces defined in future
releases; and
f) zero, one or more attributes defined in future releases.
The \ element carries one usage information report.
The \ element contains:
a) mandatory \"sequence-number\" attribute containing the parameter defined in
clause 11.6.2.2;
b) zero, one or more \ elements;
c) zero, one or more \ element;
d) zero, one or more \ element;
e) zero, one or more \ elements;
f) zero or one \ element containing elements defined in future
releases;
g) zero, one or more elements from other namespaces defined in future
releases; and
h) zero, one or more attributes defined in future releases.
The \ element carries information whether the UE was in NG-RAN
coverage or out of NG-RAN coverage. The \ element contains:
a) mandatory \"in-coverage\" attribute containing the parameter defined in
clause 11.6.2.3;
b) optional \"timestamp\" attribute containing the parameter defined in clause
11.6.2.7 indicating date and time when the information given in the element
start being valid;
c) if the UE was in NG-RAN coverage, zero, one or more \ elements;
d) zero or one \ element containing elements defined in future
releases;
e) zero, one or more elements from other namespaces defined in future
releases; and
f) zero, one or more attributes defined in future releases.
The \ element carries information about an NG-RAN cell where the UE
was camping on or which the UE used in the 5GMM-CONNECTED mode. The
\ element contains:
a) an optional \"NCGI\" attribute containing the parameter defined in clause
11.6.2.4;
b) an optional \"timestamp\" attribute containing the parameter defined in
clause 11.6.2.7 indicating date and time when the information given in the
element start being valid;
c) zero or one \ element containing elements defined in future
releases;
d) zero, one or more elements from other namespaces defined in future
releases; and
e) zero, one or more attributes defined in future releases.
The \ element carries information about the configured
radio parameters for the ProSe direct communication applicable in the
geographical area of the UE. The \ element contains:
a) a mandatory \"params\" attribute containing the parameter defined in clause
11.6.2.5;
b) a mandatory \"timestamp\" attribute containing the parameter defined in
clause 11.6.2.7 indicating date and time when the information given in the
element start being valid;
c) zero or one \ element containing elements defined in future
releases;
d) zero, one or more elements from other namespaces defined in future
releases; and
e) zero, one or more attributes defined in future releases.
The \ element carries information about a 5G ProSe group. The \
element contains:
a) a mandatory \"prose-layer2-group-ID\" attribute containing the parameter
defined in clause 11.6.2.8;
b) a mandatory \"prose-group-IP-multicast-address\" attribute containing the
parameter defined in clause 11.6.2.10;
c) an optional \"first-transmission-timestamp\" attribute containing the
parameter defined in clause 11.6.2.7 indicating date and time of the first
transmission to the ProSe Group IP multicast address in the collection period;
d) an optional \"first-reception-timestamp\" attribute containing the
parameter defined in clause 11.6.2.7 indicating date and time of the first
reception from the ProSe Group IP multicast address in the collection period;
e) a \ element containing the parameter defined in
clause 11.6.2.10, of the UE;
f) a \ element containing the parameter defined in clause
11.6.2.11, of the UE;
g) zero, one or more \ element;
h) zero, one or more \ element;
i) zero, one or more \ element;
j) zero, one or more \ elements;
k) zero or one \ element containing elements defined in future
releases;
l) zero, one or more elements from other namespaces defined in future
releases; and
m) zero, one or more attributes defined in future releases.
The \ element carries information about an unicast mode 5G ProSe
direct communication. The \ element contains:
a) an optional \"first-transmission-timestamp\" attribute containing the
parameter defined in clause 11.6.2.7 indicating date and time of the first
transmission in the unicast mode 5G ProSe direct communication in the
collection period;
b) an optional \"first-reception-timestamp\" attribute containing the
parameter defined in clause 11.6.2.7 indicating date and time of the first
reception in the unicast mode 5G ProSe direct communication in the collection
period;
c) a \ element containing the parameter defined in
clause 11.6.2.10, of the UE;
d) a \ element containing the parameter defined in clause
11.6.2.11, of the UE;
e) zero, one or more \ element;
f) zero, one or more \ element;
g) zero, one or more \ element;
h zero, one or more \ element;
i) zero, one or more \ element;
j) zero, one or more \ element;
k) zero, one or more \ elements;
l) zero or one \ element containing elements defined in future
releases;
m) zero, one or more elements from other namespaces defined in future
releases; and
n) zero, one or more attributes defined in future releases.
The \ element carries information about a transmitter in a 5G
ProSe group or in an unicast mode 5G ProSe direct communication. The
\ element contains:
a) a mandatory \"source-IP-address\" attribute containing the parameter
defined in clause 11.6.2.10, of the transmitter;
b) a mandatory \"source-layer2-id\" attribute containing the parameter defined
in clause 11.6.2.11, of the transmitter;
c) zero or one \ element containing elements defined in future
releases;
d) zero, one or more elements from other namespaces defined in future
releases; and
e) zero, one or more attributes defined in future releases.
The \ element carries information about a receiver in an unicast
mode 5G ProSe direct communication. The \ element contains:
a) a mandatory \"target-IP-address\" attribute containing the parameter
defined in clause 11.6.2.10, of the receiver;
b) a mandatory \"target-layer2-id\" attribute containing the parameter defined
in clause 11.6.2.11, of the receiver;
c) zero or one \ element containing elements defined in future
releases;
d) zero, one or more elements from other namespaces defined in future
releases; and
e) zero, one or more attributes defined in future releases.
The \ element carries information about a transmission in a
ProSe group or in an unicast mode 5G ProSe direct communication. The
\ element contains:
a) a mandatory \"in-coverage\" attribute containing the parameter defined in
clause 11.6.2.3;
b) if the UE was in NG-RAN coverage when transmitting the data, an optional
\"NCGI\" attribute containing the parameter defined in clause 11.6.2.5,
indicating NG-RAN Cell Global Identification of the NG-RAN cell where the UE
was camping on or which the UE used in the 5GMM-CONNECTED mode when
transmitting the data;
c) if the UE was in NG-RAN coverage and the \"NCGI\" attribute is included:
1) a mandatory \"amount\" attribute containing the parameter defined in clause
11.6.2.12 indicating the amount of octets transmitted to the ProSe group or in
an unicast mode 5G ProSe direct communication:
\- when the UE was camping on a cell identified by the \"NCGI\" attribute when
transmitting the data; or
\- when the UE used in the 5GMM-CONNECTED mode a cell identified by the
\"NCGI\" attribute when transmitting the data; and
2) an optional \"timestamp\" attribute containing the parameter defined in
clause 11.6.2.7 indicating date and time of the first transmission in the NG-
RAN cell;
d) if the UE was in NG-RAN coverage and the \"NCGI\" attribute is not
included:
1) a mandatory \"amount\" attribute containing the parameter defined in clause
11.6.2.12 indicating the amount of octets transmitted to the ProSe group or in
an unicast mode 5G ProSe direct communication during the in NG-RAN coverage
period; and
2) an optional \"timestamp\" attribute containing the parameter defined in
clause 11.6.2.7 indicating date and time of the first transmission during the
in NG-RAN coverage period;
e) if the UE was out of NG-RAN coverage:
1) a mandatory \"amount\" attribute containing the parameter defined in clause
11.6.2.12 indicating the amount of octets transmitted to the ProSe group or in
an unicast mode 5G ProSe direct communication during the out of NG-RAN
coverage period; and
2) an optional \"timestamp\" attribute containing the parameter defined in
clause 11.6.2.7 indicating date and time of the first transmission during the
out of NG-RAN coverage period;
f) an optional \"radio-resources-ind\" attribute containing the parameter
defined in clause 11.6.2.13;
g) an optional \"radio-frequency\" attribute containing the parameter defined
in clause 11.6.2.14;
h) zero or one \ element containing elements defined in future
releases;
i) zero, one or more elements from other namespaces defined in future
releases; and
j) zero, one or more attributes defined in future releases.
The \ element carries information about a reception in a ProSe
group or in an unicast mode 5G ProSe direct communication. The \
element contains:
a) a mandatory \"in-coverage\" attribute containing the parameter defined in
clause 11.6.2.3 indicating whether the UE was in NG-RAN coverage when
receiving the data;
b) if the UE was in NG-RAN coverage when receiving the data, an optional
\"NCGI\" attribute containing the parameter defined in clause 11.6.2.4
indicating NG-RAN Cell Global Identification of the NG-RAN cell where the UE
was camping on or which the UE used in the 5GMM-CONNECTED mode when receiving
the data;
c) if the UE was in NG-RAN coverage and the \"NCGI\" attribute is included:
1) a mandatory \"amount\" attribute containing the parameter defined in clause
11.6.2.12 indicating the amount of octets received from the ProSe group or in
an unicast mode 5G ProSe direct communication:
\- when the UE was camping on a cell identified by the \"NCGI\" attribute when
receiving the data; or
\- when the UE used in the 5GMM-CONNECTED mode a cell identified by the
\"NCGI\" attribute when receiving the data; and
2) an optional \"timestamp\" attribute containing the parameter defined in
clause 11.6.2.7 indicating date and time of the first reception in the NG-RAN
cell;
d) if the UE was in NG-RAN coverage and the \"NCGI\" attribute is not
included:
1) a mandatory \"amount\" attribute containing the parameter defined in clause
11.6.2.12 indicating the amount of octets received from the ProSe group or in
an unicast mode 5G ProSe direct communication during the in NG-RAN coverage
period: and
2) an optional \"timestamp\" attribute containing the parameter defined in
clause 11.6.2.7 indicating date and time of the first reception during the in
NG-RAN coverage period;
e) if the UE was out of NG-RAN coverage:
1) a mandatory \"amount\" attribute containing the parameter defined in clause
11.6.2.12 indicating the amount of octets received from the ProSe group or in
an unicast mode 5G ProSe direct communication during the out of NG-RAN
coverage period; and
2) an optional \"timestamp\" attribute containing the parameter defined in
clause 11.6.2.7 indicating date and time of the first reception during the out
of NG-RAN coverage period;
f) an optional \"radio-resources-ind\" attribute containing the parameter
defined in clause 11.6.2.13;
g) an optional \"radio-frequency\" attribute containing the parameter defined
in clause 11.6.2.14;
h) zero or one \ element containing elements defined in future
releases;
i) zero, one or more elements from other namespaces defined in future
releases; and
j) zero, one or more attributes defined in future releases.
The \ element carries information about a 5G ProSe UE-to-network
relay UE. The \ element contains:
a) a mandatory \"relay-UE-IP-address\" attribute containing the parameter
defined in clause 11.6.2.10, of the 5G ProSe UE-to-network relay UE;
b) a mandatory \"relay-UE-id\" attribute containing the parameter defined in
clause 11.6.2.11, of the 5G ProSe UE-to-network relay UE;
c) zero or one \ element containing elements defined in future
releases;
d) zero, one or more elements from other namespaces defined in future
releases; and
e) zero, one or more attributes defined in future releases.
The \ element carries information about a data relay in an unicast mode
5G ProSe direct communication between the 5G ProSe remote UE and the 5G ProSe
UE-to-network relay UE,. The \ element contains:
a) a mandatory \"NCGI\" attribute containing the parameter defined in clause
11.6.2.4, indicating NG-RAN Cell Global Identification of the NG-RAN cell
where the UE was camping on or which the UE used in the 5GMM-CONNECTED mode
when relaying the data;
b a mandatory \"amount\" attribute containing the parameter defined in clause
11.6.2.12 indicating the amount of octets relayed by the UE used in the 5GMM-
CONNECTED mode a cell identified by the \"NCGI\" attribute when relaying the
data;
c) a mandatory \"timestamp\" attribute containing the parameter defined in
clause 11.6.2.7 indicating date and time of the first data relay in the NG-RAN
cell;
d) an optional \"radio-resources-ind\" attribute containing the parameter
defined in clause 11.6.2.13;
e) an optional \"radio-frequency\" attribute containing the parameter defined
in clause 11.6.2.14;
f) zero or one \ element containing elements defined in future
releases;
g) zero, one or more elements from other namespaces defined in future
releases; and
h) zero, one or more attributes defined in future releases.
The \ element contains an application specific data
received from upper layers during the collection period.
The \ element carries information of PC5 QoS flows used by the UE
for 5G ProSe direct communication. The \ element contains:
a) a mandatory \"qos-flow-id\" attribute containing the parameter defined in
clause 11.6.2.15;
b) zero, one or more \"\\" element;
c) an optional \"timestamp\" attribute containing the parameter defined in
clause 11.6.2.7 indicating date and time when the information given in the
element start being valid;
d) an optional \"timestamp\" attribute containing the parameter defined in
clause 11.6.2.7 indicating date and time when the information given in the
element stop being valid;
e) a mandatory \"amount\" attribute containing the parameter defined in clause
11.6.2.12 indicating the amount of octets of the QoS flow transmitted or
received;
f) zero or one \ element containing elements defined in future
releases;
g) zero, one or more elements from other namespaces defined in future
releases; and
h) zero, one or more attributes defined in future releases.
The \ element carries information of QoS parameters for the
PC5 QoS flows used by the UE for 5G ProSe direct communication. The \ element contains:
a) a mandatory \"pqi\" attribute containing the parameter defined in clause
11.6.2.16;
b) an optional \"gfbr\" attribute containing the parameter defined in clause
11.6.2.17;
c) an optional \"mfbr\" attribute containing the parameter defined in clause
11.6.2.18;
d) an optional \"averaging-window\" attribute containing the parameter defined
in clause 11.6.2.19;
e) an optional \"Resource-type\" attribute containing the parameter defined in
clause 11.6.2.20;
f) an optional \"default-priority-level\" attribute containing the parameter
defined in clause 11.6.2.21;
g) an optional \"packet-delay-budget\" attribute containing the parameter
defined in clause 11.6.2.22;
h) an optional \"packet-error-rate\" attribute containing the parameter
defined in clause 11.6.2.23;
i) an optional \"default-maximum-data-burst-volume\" attribute containing the
parameter defined in clause 11.6.2.24;
j) zero or one \ element containing elements defined in future
releases;
k) zero, one or more elements from other namespaces defined in future
releases; and
l) zero, one or more attributes defined in future releases.
#### 10.7.4.3 Semantics of \
The \ element contains:
a) one of \ element and \ element;
b) zero or one \ element containing elements defined in future
releases;
c) zero, one or more elements from other namespaces defined in future
releases; and
d) zero, one or more attributes defined in future releases.
The \ element indicates that a related
PROSE_USAGE_INFORMATION_REPORT_LIST message was accepted. The \ element contains:
a) \ element containing the parameter defined in clause
11.6.2.1 indicating the value of the transaction ID of the related
PROSE_USAGE_INFORMATION_REPORT_LIST message;
b) zero or one \ element containing elements defined in future
releases;
c) zero, one or more elements from other namespaces defined in future
releases; and
d) zero, one or more attributes defined in future releases.
The \ element indicates that a related
PROSE_USAGE_INFORMATION_REPORT_LIST message was rejected. The \ element contains:
a) \ element containing the parameter defined in clause
11.6.2.1 indicating the value of the transaction ID of the related
PROSE_USAGE_INFORMATION_REPORT_LIST message;
b) \ element containing the parameter defined in clause 11.6.2.6;
c) zero or one \ element containing elements defined in future
releases;
d) zero, one or more elements from other namespaces defined in future
releases; and
e) zero, one or more attributes defined in future releases.
# 11 Information elements coding
## 11.1 Overview
This clause contains general message format and information elements coding
for the messages used in the procedures described in the present document.
## 11.2 5G ProSe direct discovery message formats
### 11.2.1 ProSe direct discovery PC5 message type
This parameter is used to indicate the type of ProSe direct discovery message
over PC5 interface.
This parameter is coded as shown in figure 11.2.1.1 and table 11.2.1.1.
The ProSe direct discovery PC5 message type is a type 1 information element,
with the length of 1 octet.
8 7 6 5 4 3 2 1
* * *
Discovery type Content type Discovery model octet 1
Figure 11.2.1.1: ProSe direct discovery PC5 message type parameter
Table 11.2.1.1: ProSe direct discovery PC5 message type parameter
Discovery type value (octet 1):
* * *
Bit  
8 7  
0 0 Reserved 0 1 Open discovery 1 0 Restricted discovery 1 1 Reserved
Content type value (octet 1):  
Bit  
**6** **5** **4** **3**  
0 0 0 0 Announcement/response 0 0 0 1 Solicitation 0 1 0 0 UE-to-network relay
discovery announcement/UE-to-network relay discovery response 0 1 0 1 UE-to-
network relay discovery solicitation 0 1 1 0 Group member discovery
announcement/group member discovery response 0 1 1 1 Group member discovery
solicitation 1 0 0 0 Relay discovery additional information The other values
are reserved.
Discovery model value (octet 1):  
Bit  
**2** **1**  
0 0 Reserved 0 1 Model A 1 0 Model B 1 1 Reserved
NOTE 1: Content type \'0000\' (announce/response) is used for model A
announcing and for model B discoveree operation.
NOTE 2: Content type \'0100\' (UE-to-network relay discovery announcement or
UE-to-network relay discovery response) is used for model A announcing and for
model B discoveree operation.
NOTE 3: Content type \'0110\' (group member discovery announcement or group
member discovery response) is used for model A announcing and for model B
discoveree operation.
### 11.2.2 ProSe application code
This parameter is used to contain a ProSe application code. The format of the
ProSe application code is as follows:
a) if the ProSe application code is included in a PROSE PC5 DISCOVERY message
and application-controlled extension is used, the ProSe application code is
encoded as a 184 bitstring composed of:
1) the ProSe application code prefix; and
2) the ProSe application code suffix; or
b) in all other cases, the ProSe application is encoded as a 184 bitstring as
defined in 3GPP TS 23.003 [12].
### 11.2.3 ProSe restricted code
This parameter is used to contain a ProSe restricted code. The format of the
ProSe restricted code is as follows:
a) if the ProSe restricted code is included in a PROSE PC5 DISCOVERY message
and application-controlled extension is not used, the ProSe restricted code is
encoded as a 184 bitstring composed of:
1) the ProSe restricted code in the 64 most significant bits; and
2) the remaining 120 bits set to zero;
b) if the ProSe restricted code is included in a PROSE PC5 DISCOVERY message
and application-controlled extension is used, the ProSe restricted code is
encoded as a 184 bitstring composed of
1) the ProSe restricted code prefix in the 64 most significant bits;
2) the ProSe restricted code suffix; and
3) any remaining unused least significant bits set to zero; or
c) in all other cases, the ProSe restricted code is encoded as a 64 bitstring
as defined in 3GPP TS 23.003 [12].
### 11.2.4 MIC
This parameter is used to carry the MIC (Message Integrity Check) associated
with the ProSe application code contained in a PROSE PC5 DISCOVERY message.
### 11.2.5 UTC-based counter
This parameter is used to indicate the UTC time associated with the discovery
transmission opportunity in which a PROSE PC5 DISCOVERY message is sent. It is
expressed in unit of seconds and coded in binary format as the 32 least
significant bits of the Coordinated Universal Time as defined in 3GPP TS
38.331 [13].
### 11.2.6 Application layer group ID
The application layer group ID parameter carries an identifier of an
application layer group that the UE belongs to.
The application layer group ID information element is coded as shown in figure
11.2.6.1 and table 11.2.6.1.
The application layer group ID is a type 4 information element.
8 7 6 5 4 3 2 1
* * *
Application layer group ID IEI octet 1  
Length of application layer group ID contents octet 2  
Application layer group ID contents octet 3  
octet m
Figure 11.2.6.1: Application layer group ID information element
Table 11.2.6.1: Application layer group ID information element
+----------------------------------------------------------------------+ | The length of application layer group ID contents field contains the | | binary coded representation of the length of the application layer | | group ID contents field. | | | | The application layer group ID contents field contains the octets | | indicating the application layer group ID. The format of the | | application layer group ID parameter is out of scope of this | | specification. | +----------------------------------------------------------------------+
### 11.2.7 User info ID
The user info ID parameter carries a user info ID as specified in 3GPP TS
23.304 [2]. The value of the user info ID parameter is a 48-bit long bit
string. The format of the user info ID parameter is out of scope of this
specification.
NOTE: Depending on operation, user info ID is indicated as the announcer info
parameter, the discoverer info parameter or the discoveree info parameter.
### 11.2.8 Relay service code
The relay service code parameter is used to indicate the connectivity service
the UE-to-network relay provides to the 5G ProSe remote UE in the UE-to-
network relay direct discovery. The value of the relay service code parameter
is 24-bit long bit string. The format of the relay service code parameter is
out of scope of this specification.
The relay service code is a type 3 information element with a length of 4
octets.
The relay service code IE is coded as shown in figure 11.2.8.1 and table
11.2.8.1.
+------------------------+---------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +------------------------+---------+---+---+---+---+---+---+---+ | Relay service code IEI | octet 1 | | | | | | | | +------------------------+---------+---+---+---+---+---+---+---+ | Relay service code | octet 2 | | | | | | | | | | | | | | | | | | | | octet 4 | | | | | | | | +------------------------+---------+---+---+---+---+---+---+---+
Figure 11.2.8.1: Relay service code information element
Table 11.2.8.1: Relay service code information element
+----------------------------------------------------+ | Relay service code (octet 2 to 4) | | | | This field contains the 24-bit relay service code. | +----------------------------------------------------+
### 11.2.9 Status indicator
The status indicator parameter is used to indicate the status of 5G ProSe UE-
to-network relay UE.
The status indicator is a type 3 information element with a length of 2
octets.
The status indicator IE is coded as shown in figure 11.2.9.1 and table
11.2.9.1.
* * *
8 7 6 5 4 3 2 1  
Status indicator IEI octet 1  
Spare RSI octet 2
* * *
Figure 11.2.9.1: Status indicator information element
Table 11.2.9.1: Status indicator information element
+----------------------------+---+---+---+----------------------------+ | Resource status indicator | | | | | | (RSI) (octet 2, bit 1) | | | | | | | | | | | | The bit is used to | | | | | | indicate whether or not | | | | | | the UE has resources | | | | | | available to provide a | | | | | | connectivity service for | | | | | | additional ProSe-enabled | | | | | | UEs. | | | | | +============================+===+===+===+============================+ | Bit | | | | | +----------------------------+---+---+---+----------------------------+ | 1 | | | | | +----------------------------+---+---+---+----------------------------+ | 0 | | | | the UE does not have | | | | | | resources available to | | | | | | provide a connectivity | | | | | | service for additional | | | | | | ProSe-enabled UEs | +----------------------------+---+---+---+----------------------------+ | 1 | | | | the UE has resources | | | | | | available to provide a | | | | | | connectivity service for | | | | | | additional ProSe-enabled | | | | | | UEs | +----------------------------+---+---+---+----------------------------+ | Bits 2 to 8 of octet 1 are | | | | | | spare and shall be coded | | | | | | as zero. | | | | | +----------------------------+---+---+---+----------------------------+
### 11.2.10 TAI
The TAI information element in coded as the 5GS tracking area identity
specified in clause 9.11.3.8 of 3GPP TS 24.501 [11].
### 11.2.11 UTC-based counter LSB
This parameter is used to carrythe four least significant bits of the UTC-
based counter associated with the discovery transmission opportunity used by
the UE.
The UTC-based counter LSB IE is a type 3 information element with a length of
2 octets.
The UTC-based counter LSB IE is coded as shown in figures 11.2.11.1, figure
11.2.11.2 and table 11.2.11.1.
* * *
8 7 6 5 4 3 2 1  
UTC-based counter LSB IEI octet 1  
Spare UTC-based counter LSB contents octet 2
* * *
Figure 11.2.11.1: UTC-based counter LSB parameter for open 5G ProSe direct
discovery
Table 11.2.11.1: UTC-based counter LSB information element
+----------------------------------------------------------------------+ | UTC-based counter LSB contents (bits 1 to 4 of octet 2) | | | | Bits 1 to 4 of octet 2 are set to the four least significant bits of | | the UTC-based counter encoded as specified in clause 11.2.5. | | | | Bits 5 to 8 of octet 2 are spare and shall be coded as zero. | +----------------------------------------------------------------------+
### 11.2.12 NCGI
The NCGI information element is used to indicate the NCGI of the serving cell
where the 5G ProSe UE-to-network relay UE is camping.
The NCGI is a type 3 information element with a length of 9 octets.
The NCGI information element is coded as shown in figure 11.2.12.1 and table
11.2.12.2.
     8             7             6         5   4   3   2   1
* * *
     NCGI IEI      octet 1                                     
     MCC digit 2   MCC digit 1   octet 2                       
     MNC digit 3   MCC digit 3   octet 3                       
     MNC digit 2   MNC digit 1   octet 4                       
     NCI digit 2   NCI digit 1   octet 5                       
     NCI digit 4   NCI digit 3   octet 6                       
     NCI digit 6   NCI digit 5   octet 7                       
     NCI digit 8   NCI digit 7   octet 8                       
     Spare         NCI digit 9   octet 9
Figure 11.2.12.1: UE-to-network relay NCGI parameter
Table 11.2.12.1: UE-to-network relay NCGI parameter
+----------------------------------------------------------------------+ | MCC, Mobile country code (octet 2, octet 3 bits 1 to 4) | | | | The MCC field is coded as in ITU-T Rec. E.212 [27], Annex A. | | | | MNC, Mobile network code (octet 3 bits 5 to 8, octet 4) | | | | The coding of this field is the responsibility of each | | administration but BCD coding shall be used. If MNC consists of 2 | | digits, Bits 5 to 8 of octet 2 is coded as \"1111\". | | | | NCI, NR cell identity (octet 5, octet 6, octet 7, octet 8, octet 9 | | bits 1 to 4) | | | | The NCI field is coded as in 3GPP TS 23.003 [12]. | | | | Spare (octet 9 bits 5 to 8) | | | | The Spare field is coded as zeros. | +----------------------------------------------------------------------+
### 11.2.13 Metadata
The Metadata parameter carries the application layer metadata information.
The Metadata information element is coded as shown in figure 11.2.13.1 and
table 11.2.13.1.
The Metadata is a type 6 information element.
+-----------------------------+---------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +=============================+=========+===+===+===+===+===+===+===+ | Metadata IEI | octet 1 | | | | | | | | +-----------------------------+---------+---+---+---+---+---+---+---+ | Length of Metadata contents | octet 2 | | | | | | | | +-----------------------------+---------+---+---+---+---+---+---+---+ | | octet 3 | | | | | | | | +-----------------------------+---------+---+---+---+---+---+---+---+ | Metadata contents | octet 4 | | | | | | | | | | | | | | | | | | | | octet m | | | | | | | | +-----------------------------+---------+---+---+---+---+---+---+---+
Figure 11.2.13.1: Metadata information element
Table 11.2.13.1: Metadata information element
+----------------------------------------------------------------------+ | The length of Metadata contents field contains the binary coded | | representation of the length of the Metadata contents field. | | | | The Metadata contents field contains the octets indicating the | | Metadata parameter. The format of the Metadata parameter is out of | | scope of this specification. | +----------------------------------------------------------------------+
### 11.2.14 RRC container
The RRC container information element is used to indicate the RRC container
information received from the lower layers.
The RRC container is a type 4 information element.
The RRC container information element is coded as shown in figure 11.2.14.1
and table 11.2.14.1.
+----------------------------------+---------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +==================================+=========+===+===+===+===+===+===+===+ | RRC container IEI | octet 1 | | | | | | | | +----------------------------------+---------+---+---+---+---+---+---+---+ | Length of RRC container contents | octet 2 | | | | | | | | +----------------------------------+---------+---+---+---+---+---+---+---+ | RRC container contents | octet 3 | | | | | | | | | | | | | | | | | | | | octet m | | | | | | | | +----------------------------------+---------+---+---+---+---+---+---+---+
Figure 11.2.14.1: RRC container information element
Table 11.2.14.1: RRC container information element
+----------------------------------------------------------------------+ | The length of RRC container contents field contains the binary coded | | representation of the length of the RRC container contents field. | | | | RRC container contents (octet 3 to m) | | | | The RRC container contents field is coded as SL-AccessInfo-L2U2N in | | clause 9.4 of 3GPP TS 38.331 [13]. | +----------------------------------------------------------------------+
## 11.3 PC5 signalling message formats
### 11.3.1 ProSe PC5 signalling message type
The purpose of the ProSe PC5 signalling message type information element is to
indicate the type of messages used in ProSe PC5 signalling protocol.
The value part of the ProSe PC5 signalling message type information element
used in the ProSe PC5 signalling messages is coded as shown in table 11.3.1.1.
The ProSe PC5 signalling message type is a type 3 information element, with
the length of 1 octet.
Table 11.3.1.1: ProSe PC5 signalling message type
Bits
* * *
**8** **7** **6** **5** **4** **3** **2** **1**  
0 0 0 0 0 0 0 1 PROSE DIRECT LINK ESTABLISHMENT REQUEST 0 0 0 0 0 0 1 0 PROSE
DIRECT LINK ESTABLISHMENT ACCEPT 0 0 0 0 0 0 1 1 PROSE DIRECT LINK
ESTABLISHMENT REJECT 0 0 0 0 0 1 0 0 PROSE DIRECT LINK MODIFICATION REQUEST 0
0 0 0 0 1 0 1 PROSE DIRECT LINK MODIFICATION ACCEPT 0 0 0 0 0 1 1 0 PROSE
DIRECT LINK MODIFICATION REJECT 0 0 0 0 0 1 1 1 PROSE DIRECT LINK RELEASE
REQUEST 0 0 0 0 1 0 0 0 PROSE DIRECT LINK RELEASE ACCEPT 0 0 0 0 1 0 0 1 PROSE
DIRECT LINK KEEPALIVE REQUEST 0 0 0 0 1 0 1 0 PROSE DIRECT LINK KEEPALIVE
RESPONSE 0 0 0 0 1 0 1 1 PROSE DIRECT LINK AUTHENTICATION REQUEST 0 0 0 0 1 1
0 0 PROSE DIRECT LINK AUTHENTICATION RESPONSE 0 0 0 0 1 1 0 1 PROSE DIRECT
LINK AUTHENTICATION REJECT 0 0 0 0 1 1 1 0 PROSE DIRECT LINK SECURITY MODE
COMMAND 0 0 0 0 1 1 1 1 PROSE DIRECT LINK SECURITY MODE COMPLETE 0 0 0 1 0 0 0
0 PROSE DIRECT LINK SECURITY MODE REJECT 0 0 0 1 0 0 0 1 PROSE DIRECT LINK
REKEYING REQUEST 0 0 0 1 0 0 1 0 PROSE DIRECT LINK REKEYING RESPONSE 0 0 0 1 0
0 1 1 PROSE DIRECT LINK IDENTIFIER UPDATE REQUEST 0 0 0 1 0 1 0 0 PROSE DIRECT
LINK IDENTIFIER UPDATE ACCEPT 0 0 0 1 0 1 0 1 PROSE DIRECT LINK IDENTIFIER
UPDATE ACK 0 0 0 1 0 1 1 0 PROSE DIRECT LINK IDENTIFIER UPDATE REJECT 0 0 0 1
0 1 1 1 PROSE DIRECT LINK AUTHENTICATION FAILURE 0 0 0 1 1 0 0 0 PROSE
ADDITIONAL PARAMETERS ANNOUNCEMENT REQUEST 0 0 0 1 1 0 0 1 PROSE ADDITIONAL
PARAMETERS ANNOUNCEMENT RESPONSE 0 0 0 1 1 0 1 0 PROSE AA MESSAGE TRANSPORT
REQUEST 0 0 0 1 1 0 1 1 PROSE AA MESSAGE TRANSPORT RESPONSE
### 11.3.2 Sequence number
The purpose of the Sequence number information element is to uniquely identify
a ProSe PC5 signalling message being sent or received. The sending UE will
increment the sequence number for each outgoing new ProSe PC5 signalling
message.
The Sequence number information element is an integer in the 0-255 range.
The Sequence number is a type 3 information element, with a length of 1 octet.
### 11.3.3 ProSe identifier
The purpose of the ProSe identifier parameter is to carry the identifier of a
ProSe application.
The ProSe identifier information element is coded as shown in figure 11.3.3.1
and table 11.3.3.1.
The ProSe identifier is a type 6 information element with a minimum length of
21 octets.
+-------------------------------------+---------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +=====================================+===============+===+===+===+===+===+===+===+ | ProSe identifier IEI | octet 1 | | | | | | | | +-------------------------------------+---------------+---+---+---+---+---+---+---+ | Length of ProSe identifier contents | octet 2 | | | | | | | | | | | | | | | | | | | | octet 3 | | | | | | | | +-------------------------------------+---------------+---+---+---+---+---+---+---+ | ProSe identifier 1 | octet 4 | | | | | | | | | | | | | | | | | | | | octet u | | | | | | | | +-------------------------------------+---------------+---+---+---+---+---+---+---+ | ProSe identifier 2 | octet (u+1)* | | | | | | | | | | | | | | | | | | | | octet v* | | | | | | | | +-------------------------------------+---------------+---+---+---+---+---+---+---+ | ... | octet (v+1)* | | | | | | | | | | | | | | | | | | | | octet w* | | | | | | | | +-------------------------------------+---------------+---+---+---+---+---+---+---+ | ProSe identifier n | octet (w+1)* | | | | | | | | +-------------------------------------+---------------+---+---+---+---+---+---+---+ | | octet x* | | | | | | | | +-------------------------------------+---------------+---+---+---+---+---+---+---+
Figure 11.3.3.1: ProSe identifier information element
Table 11.3.3.1: ProSe identifier information element
+----------------------------------------------------------------------+ | ProSe identifier: | | | | The ProSe identifier field contains a sequence of a sixteen octet OS | | Id field, a one octet OS App Id length field and an OS App Id field. | | The OS Id field shall be transmitted first. The OS Id field contains | | a Universally Unique IDentifier (UUID) as specified in | | IETF RFC 4122 [30]. | +======================================================================+ | NOTE: Further definition of the format of OS App Id is beyond the | | scope of this specification. | +----------------------------------------------------------------------+
### 11.3.4 Application layer ID
The purpose of the application layer ID parameter information element carries
an application layer ID as specified in 3GPP TS 23.304 [2].
The application layer ID information element is coded as shown in figure
11.3.4.1 and table 11.3.4.1.
The application layer ID is a type 4 information element.
8 7 6 5 4 3 2 1
* * *
Application layer ID IEI octet 1  
Length of application layer ID contents octet 2  
Application layer ID contents octet 3  
octet m
Figure 11.3.4.1: Application layer ID information element
Table 11.3.4.1: Application layer ID information element
+----------------------------------------------------------------------+ | The length of application layer ID contents field contains the | | binary coded representation of the length of the application layer | | ID contents field. | | | | The application layer ID contents field contains the octets | | indicating the application layer ID. The format of the application | | layer ID parameter is out of scope of this specification. | +----------------------------------------------------------------------+
### 11.3.5 PC5 QoS flow descriptions
The purpose of the PC5 QoS flow descriptions information element is to
indicate a set of PC5 QoS flow descriptions to be used by the UE over the
direct link, where each PC5 QoS flow description is a set of parameters as
described in clause 5.6 of 3GPP TS 23.304 [2].
The PC5 QoS flow descriptions is a type 6 information element with a minimum
length of 6 octets. The maximum length for the information element is 65538
octets.
The PC5 QoS flow descriptions information element is coded as shown in figure
11.3.5.1, figure 11.3.5.2, figure 11.3.5.3, figure 11.3.5.4 and table
11.3.5.1.
+----------------------------------------------+-----------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +==============================================+===========+===+===+===+===+===+===+===+ | PC5 QoS flow descriptions IEI | octet 1 | | | | | | | | +----------------------------------------------+-----------+---+---+---+---+---+---+---+ | Length of PC5 QoS flow descriptions contents | octet 2 | | | | | | | | | | | | | | | | | | | | octet 3 | | | | | | | | +----------------------------------------------+-----------+---+---+---+---+---+---+---+ | PC5 QoS flow description 1 | octet 4 | | | | | | | | | | | | | | | | | | | | octet u | | | | | | | | +----------------------------------------------+-----------+---+---+---+---+---+---+---+ | PC5 QoS flow description 2 | octet u+1 | | | | | | | | | | | | | | | | | | | | octet v | | | | | | | | +----------------------------------------------+-----------+---+---+---+---+---+---+---+ | ... | octet v+1 | | | | | | | | | | | | | | | | | | | | octet w | | | | | | | | +----------------------------------------------+-----------+---+---+---+---+---+---+---+ | PC5 QoS flow description n | octet w+1 | | | | | | | | | | | | | | | | | | | | octet x | | | | | | | | +----------------------------------------------+-----------+---+---+---+---+---+---+---+
Figure 11.3.5.1: PC5 QoS flow descriptions information element
+--------+--------+--------+--------+-------+-----+--------+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +========+========+========+========+=======+=====+========+===+===+ | 0 | 0 | PQFI | octet | | | | | | | | | | 4 | | | | | | | Spare | Spare | | | | | | | | +--------+--------+--------+--------+-------+-----+--------+---+---+ | Ope | 0 | 0 | 0 | 0 | PII | octet | | | | ration | | | | | | 5 | | | | code | Spare | Spare | Spare | Spare | | | | | +--------+--------+--------+--------+-------+-----+--------+---+---+ | 0 | E | Number | octet | | | | | | | | | of | 6 | | | | | | | Spare | | para | | | | | | | | | | meters | | | | | | | +--------+--------+--------+--------+-------+-----+--------+---+---+ | Asso | octet | | | | | | | | | ciated | 7* | | | | | | | | | ProSe | | | | | | | | | | ident | octet | | | | | | | | | ifiers | k* | | | | | | | | +--------+--------+--------+--------+-------+-----+--------+---+---+ | Para | octet | | | | | | | | | meters | k+1* | | | | | | | | | list | | | | | | | | | | | octet | | | | | | | | | | u* | | | | | | | | +--------+--------+--------+--------+-------+-----+--------+---+---+
Figure 11.3.5.2: PC5 QoS flow description
+-------------+-----------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +=============+===========+===+===+===+===+===+===+===+ | Parameter 1 | octet k+1 | | | | | | | | | | | | | | | | | | | | octet m | | | | | | | | +-------------+-----------+---+---+---+---+---+---+---+ | Parameter 2 | octet m+1 | | | | | | | | | | | | | | | | | | | | octet n | | | | | | | | +-------------+-----------+---+---+---+---+---+---+---+ | ... | octet n+1 | | | | | | | | | | | | | | | | | | | | octet o | | | | | | | | +-------------+-----------+---+---+---+---+---+---+---+ | Parameter n | octet o+1 | | | | | | | | | | | | | | | | | | | | octet u | | | | | | | | +-------------+-----------+---+---+---+---+---+---+---+
Figure 11.3.5.3: Parameters list
+------------------------------+-----------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +==============================+===========+===+===+===+===+===+===+===+ | Parameter identifier | octet k+1 | | | | | | | | +------------------------------+-----------+---+---+---+---+---+---+---+ | Length of parameter contents | octet k+2 | | | | | | | | +------------------------------+-----------+---+---+---+---+---+---+---+ | Parameter contents | octet k+3 | | | | | | | | | | | | | | | | | | | | octet m | | | | | | | | +------------------------------+-----------+---+---+---+---+---+---+---+
Figure 11.3.5.4: Parameter
Table 11.3.5.1: PC5 QoS flow descriptions information element
+----------------------------------------------------------------------+ | PC5 QoS flow identifier (PQFI) (bits 6 to 1 of octet 4) | | | | PQFI field contains the PC5 QoS flow identifier. | | | | Bits | | | | 6 5 4 3 2 1 | | | | 0 0 0 0 0 1 PQFI 1 | | | | to | | | | 1 1 1 1 1 1 PQFI 63 | | | | The UE shall not set the PQFI value to 0. | +======================================================================+ | ProSe identifiers indication (PII) (bit 1 of octet 5) | | | | The PII indicates whether the Associated ProSe identifiers field is | | included | | | | Bit\ | | 1 | | | | 0 Associated ProSe identifiers field is not included | | | | 1 Associated ProSe identifiers field is included | +----------------------------------------------------------------------+ | | +----------------------------------------------------------------------+ | Operation code (bits 8 to 6 of octet 5) | | | | Bits | | | | 8 7 6 | | | | 0 0 1 Create new PC5 QoS flow description | | | | 0 1 0 Delete existing PC5 QoS flow description | | | | 0 1 1 Modify existing PC5 QoS flow description | | | | All other values are reserved. | +----------------------------------------------------------------------+ | E bit (bit 7 of octet 6) | | | | For the \"create new PC5 QoS flow description\" operation, the E bit | | is encoded as follows: | | | | Bit\ | | 7 | | | | 0 reserved | | | | 1 parameters list is included | | | | For the \"Delete existing PC5 QoS flow description\" operation, the | | E bit is encoded as follows: | | | | Bit\ | | 7 | | | | 0 parameters list is not included | | | | 1 reserved | | | | For the \"modify existing PC5 QoS flow description\" operation, the | | E bit is encoded as follows: | | | | Bit\ | | 7 | | | | 0 extension of previously provided parameters | | | | 1 replacement of all previously provided parameters | | | | If the E bit is set to \"parameters list is not included\", the | | number of parameters field has zero value. If the E bit is set to | | \"parameters list is included\", the number of parameters field has | | non-zero value. If the E bit is set to \"extension of previously | | provided parameters\" or \"replacement of all previously provided | | parameters\", the number of parameters field has non-zero value. If | | the E bit is set to \"extension of previously provided parameters\" | | and one of the parameters in the new parameters list already exists | | in the previously provided parameters, the parameter shall be set to | | the new value. | | | | Number of parameters (bits 6 to 1 of octet 6) | | | | The number of parameters field contains the binary coding for the | | number of parameters in the parameters list field. The number of | | parameters field is encoded in bits 6 through 1 of octet 6 where bit | | 6 is the most significant and bit 1 is the least significant bit. | | | | Associated ProSe identifiers (octet 7 to k) | | | | The associated ProSe identifiers field contains a variable number of | | ProSe identifiers associated with the PC5 QoS flow. Associated ProSe | | identifiers field is coded as the length and value part of ProSe | | identifier information element as specified in clause 11.3.3 | | starting with the second octet. | | | | Parameters list (octets k+1 to u) | | | | The parameters list contains a variable number of parameters. | | | | Each parameter included in the parameters list is of variable length | | and consists of: | | | | - a parameter identifier (1 octet);\ | | - the length of the parameter contents (1 octet); and\ | | - the parameter contents itself (variable amount of octets). | | | | The parameter identifier field is used to identify each parameter | | included in the parameters list and it contains the hexadecimal | | coding of the parameter identifier. Bit 8 of the parameter | | identifier field contains the most significant bit and bit 1 | | contains the least significant bit. In this version of the protocol, | | the following parameter identifiers are specified: | | | | - 01H (PQI);\ | | - 02H (GFBR); (see NOTE) | | | | - 03H (MFBR); (see NOTE) | | | | - 04H (Averaging window) ; | | | | - 05H (Resource type); | | | | - 06H (Default priority level); | | | | - 07H (Packet delay budget); | | | | - 08H (Packet error rate); | | | | - 09H (Default maximum data burst volume). | | | | If the parameters list contains a parameter identifier that is not | | supported by the receiving entity the corresponding parameter shall | | be discarded. | | | | The length of parameter contents field contains the binary coded | | representation of the length of the parameter contents field. The | | first bit in transmission order is the most significant bit. | | | | When the parameter identifier indicates PQI, the parameter contents | | field contains the binary representation of PQI that is one octet in | | length. | | | | PQI: | | | | Bits | | | | 8 7 6 5 4 3 2 1 | | | | 0 0 0 0 0 0 0 0 Reserved | | | | 0 0 0 0 0 0 0 1 | | | | to Spare | | | | 0 0 0 1 0 1 0 0 | | | | 0 0 0 1 0 1 0 1 PQI 21 | | | | 0 0 0 1 0 1 1 0 PQI 22 | | | | 0 0 0 1 0 1 1 1 PQI 23 | | | | 0 0 0 1 1 0 0 0 PQI 24 | | | | 0 0 0 1 1 0 0 1 PQI 25 | | | | 0 0 0 1 1 0 1 0 PQI 26 | | | | 0 0 0 1 1 0 1 1 | | | | to Spare | | | | 0 0 1 1 0 1 1 0 | | | | 0 0 1 1 0 1 1 1 PQI 55 | | | | 0 0 1 1 1 0 0 0 PQI 56 | | | | 0 0 1 1 1 0 0 1 PQI 57 | | | | 0 0 1 1 1 0 1 0 PQI 58 | | | | 0 0 1 1 1 0 1 1 PQI 59 | | | | 0 0 1 1 1 1 0 0 PQI 60 | | | | 0 0 1 1 1 1 0 1 PQI 61 | | | | 0 0 1 1 1 1 1 0 | | | | to Spare | | | | 0 1 0 1 1 0 0 1 | | | | 0 1 0 1 1 0 1 0 PQI 90 | | | | 0 1 0 1 1 0 1 1 PQI 91 | | | | 0 1 0 1 1 1 0 0 PQI 92 | | | | 0 1 0 1 1 1 0 1 PQI 93 | | | | 0 1 0 1 1 1 1 0 | | | | to Spare | | | | 0 1 1 1 1 1 1 1 | | | | 1 0 0 0 0 0 0 0 | | | | to Operator-specific PQIs | | | | 1 1 1 1 1 1 1 0 | | | | 1 1 1 1 1 1 1 1 Reserved | | | | The UE shall consider all other values not explicitly defined in | | this version of the protocol as unsupported. | | | | When the parameter identifier indicates \"GFBR\", the parameter | | contents field contains one octet indicating the unit of the | | guaranteed flow bit rate followed by two octets containing the value | | of the guaranteed flow bit rate. | | | | Unit of the guaranteed flow bit rate (octet 1) | | | | Bits | | | | 8 7 6 5 4 3 2 1 | | | | 0 0 0 0 0 0 0 0 value is not used | | | | 0 0 0 0 0 0 0 1 value is incremented in multiples of 1 Kbps | | | | 0 0 0 0 0 0 1 0 value is incremented in multiples of 4 Kbps | | | | 0 0 0 0 0 0 1 1 value is incremented in multiples of 16 Kbps | | | | 0 0 0 0 0 1 0 0 value is incremented in multiples of 64 Kbps | | | | 0 0 0 0 0 1 0 1 value is incremented in multiples of 256 Kbps | | | | 0 0 0 0 0 1 1 0 value is incremented in multiples of 1 Mbps | | | | 0 0 0 0 0 1 1 1 value is incremented in multiples of 4 Mbps | | | | 0 0 0 0 1 0 0 0 value is incremented in multiples of 16 Mbps | | | | 0 0 0 0 1 0 0 1 value is incremented in multiples of 64 Mbps | | | | 0 0 0 0 1 0 1 0 value is incremented in multiples of 256 Mbps | | | | 0 0 0 0 1 0 1 1 value is incremented in multiples of 1 Gbps | | | | 0 0 0 0 1 1 0 0 value is incremented in multiples of 4 Gbps | | | | 0 0 0 0 1 1 0 1 value is incremented in multiples of 16 Gbps | | | | 0 0 0 0 1 1 1 0 value is incremented in multiples of 64 Gbps | | | | 0 0 0 0 1 1 1 1 value is incremented in multiples of 256 Gbps | | | | 0 0 0 1 0 0 0 0 value is incremented in multiples of 1 Tbps | | | | 0 0 0 1 0 0 0 1 value is incremented in multiples of 4 Tbps | | | | 0 0 0 1 0 0 1 0 value is incremented in multiples of 16 Tbps | | | | 0 0 0 1 0 0 1 1 value is incremented in multiples of 64 Tbps | | | | 0 0 0 1 0 1 0 0 value is incremented in multiples of 256 Tbps | | | | 0 0 0 1 0 1 0 1 value is incremented in multiples of 1 Pbps | | | | 0 0 0 1 0 1 1 0 value is incremented in multiples of 4 Pbps | | | | 0 0 0 1 0 1 1 1 value is incremented in multiples of 16 Pbps | | | | 0 0 0 1 1 0 0 0 value is incremented in multiples of 64 Pbps | | | | 0 0 0 1 1 0 0 1 value is incremented in multiples of 256 Pbps | | | | Other values shall be interpreted as multiples of 256 Pbps in this | | version of the protocol. | | | | Value of the guaranteed flow bit rate (octets 2 and 3) | | | | Octets 2 and 3 represent the binary coded value of the guaranteed | | flow bit rate in units defined by the unit of the guaranteed flow | | bit rate. | | | | When the parameter identifier indicates \"GFBR downlink\", the | | parameter contents field contains one octet indicating the unit of | | the guaranteed flow bit rate for downlink followed by two octets | | containing the value of the guaranteed flow bit rate for downlink. | | | | When the parameter identifier indicates \"MFBR \", the parameter | | contents field contains the one octet indicating the unit of the | | maximum flow bit rate followed by two octets containing the value of | | maximum flow bit rate. | | | | Unit of the maximum flow bit rate (octet 1) | | | | The coding is identical to that of the unit of the guaranteed flow | | bit rate. | | | | Value of the maximum flow bit rate (octets 2 and 3) | | | | Octets 2 and 3 represent the binary coded value of the maximum flow | | bit rate in units defined by the unit of the maximum flow bit rate. | | | | When the parameter identifier indicates \"averaging window\", the | | parameter contents field contains the binary representation of the | | averaging window for both uplink and downlink in milliseconds and | | the parameter contents field is two octets in length. | +----------------------------------------------------------------------+ | When the parameter identifier indicates \"resource type\", the | | parameter contents field contains the binary representation of the | | resource type that is one octet in length. | | | | Resource type: | | | | Bits | | | | 8 7 6 5 4 3 2 1 | | | | 0 0 0 0 0 0 0 0 Reserved | | | | 0 0 0 0 0 0 0 1 Non-GBR | | | | 0 0 0 0 0 0 1 0 GBR | | | | 0 0 0 0 0 0 1 1 Delay critical GBR | | | | 0 0 0 0 0 1 0 0 | | | | to Spare | | | | 1 1 1 1 1 1 1 1 | | | | When the parameter identifier indicates \"default priority level\", | | the parameter contents field contains the binary representation of | | the default priority level that is one octet in length. | | | | Default priority level: | | | | Bits | | | | 8 7 6 5 4 3 2 1 | | | | 0 0 0 0 0 0 0 0 Reserved | | | | 0 0 0 0 0 0 0 1 1 | | | | 0 0 0 0 0 0 1 0 2 | | | | 0 0 0 0 0 0 1 1 3 | | | | 0 0 0 0 0 1 0 0 4 | | | | 0 0 0 0 0 1 0 1 5 | | | | 0 0 0 0 0 1 1 0 6 | | | | 0 0 0 0 0 1 1 1 7 | | | | 0 0 0 0 1 0 0 0 8 | | | | 0 0 0 0 1 0 0 1 | | | | to Spare | | | | 1 1 1 1 1 1 1 1 | | | | When the parameter identifier indicates \"packet delay budget\", the | | parameter contents field contains the binary representation of the | | packet delay budget for both uplink and downlink in milliseconds and | | the parameter contents field is two octets in length. | | | | When the parameter identifier indicates \"packet error rate\", the | | parameter contents field contains the binary representation of the | | power of 10^-1^ for both uplink and downlink and the parameter | | contents field is one octet in length. | | | | When the parameter identifier indicates \"default maximum data burst | | volume\", the parameter contents field contains the binary | | representation of the default maximum data burst volume for both | | uplink and downlink in bytes and the parameter contents field is two | | octets in length. | +----------------------------------------------------------------------+ | NOTE: The GFBR and MFBR apply to both directions of the 5G ProSe | | direct link. | +----------------------------------------------------------------------+
### 11.3.6 IP address configuration
The purpose of the IP address configuration information element is to indicate
the configuration options for IP address used by the UE over this direct link.
The IP address configuration is a type 3 information element with the length
of 2 octets.
The IP address configuration information element is coded as shown in figure
11.3.6.1 and table 11.3.6.1.
8 7 6 5 4 3 2 1
* * *
IP address configuration IEI octet 1  
IP address configuration content octet 2
Figure 11.3.6.1: IP address configuration information element
Table 11.3.6.1: IP address configuration information element
IP address configuration value (octet 2)
* * *
Bits  
4 3 2 1  
0 0 0 1 IPv6 Router 0 0 1 0 address allocation not supported 0 0 1 1 DHCPv4
server 0 1 0 0 DHCPv4 server & IPv6 Router
All other values are reserved.
Bit 5 to 8 of octet 2 are spare and shall be coded as zero.
### 11.3.7 Link local IPv6 address
The purpose of the Link local IPv6 address information element is to indicate
the link local IPv6 address.
The Link local IPv6 address is a type 3 information element with the length of
17 octets.
The Link local IPv6 address information element is coded as shown in figure
11.3.7.1 and table 11.3.7.1.
8 7 6 5 4 3 2 1
* * *
Link local IPv6 address IEI octet 1  
Link local IPv6 address content octet 2  
octet 17
Figure 11.3.7.1: Link local IPv6 address information element
Table 11.3.7.1: Link local IPv6 address information element
+----------------------------------------------------------------------+ | Link local IPv6 address value (octet 2 to 17) | | | | This contains the 128-bit IPv6 address. This IPv6 address is encoded | | as a 128-bit address according to IETF RFC 4291 [15]. | +----------------------------------------------------------------------+
### 11.3.8 PC5 signalling protocol cause
The purpose of the PC5 signalling protocol cause information element is to
indicate the cause used in the PC5 signalling protocol procedures.
The PC5 signalling protocol cause is a type 3 information element with a
length of 2 octets.
The PC5 signalling protocol cause information element is coded as shown in
figure 11.3.8.1 and table 11.3.8.1.
8 7 6 5 4 3 2 1
* * *
PC5 signalling protocol cause IEI octet 1  
PC5 signalling cause value octet 2
Figure 11.3.8.1: PC5 signalling protocol cause information element
Table 11.3.8.1: PC5 signalling protocol cause information element
PC5 signalling cause value (octet 2)
* * *
Bits  
8 7 6 5 4 3 2 1  
0 0 0 0 0 0 0 1 Direct communication to the target UE not allowed 0 0 0 0 0 0
1 0 Direct communication to the target UE no longer needed 0 0 0 0 0 0 1 1
Conflict of layer-2 ID for unicast communication is detected 0 0 0 0 0 1 0 0
Direct connection is not available anymore 0 0 0 0 0 1 0 1 Lack of resources
for 5G ProSe direct link 0 0 0 0 0 1 1 0 Authentication failure 0 0 0 0 0 1 1
1 Integrity failure 0 0 0 0 1 0 0 0 UE security capabilities mismatch 0 0 0 0
1 0 0 1 LSB of K~NRP-sess~ ID conflict 0 0 0 0 1 0 1 0 UE PC5 unicast
signalling security policy mismatch 0 0 0 0 1 0 1 1 Required service not
allowed 0 0 0 0 1 1 0 0 Security policy not aligned 0 0 0 0 1 1 0 1 Congestion
situation 0 0 0 0 1 1 1 0 Authentication synchronisation error 0 0 0 0 1 1 1 1
Security procedure failure of 5G ProSe UE-to-network relay 0 1 1 0 1 1 1 1
Protocol error, unspecified Any other value received by the UE shall be
treated as 0110 1111, \"protocol error, unspecified\".
### 11.3.9 Key establishment information container
The Key establishment information container information element contains
information for 5G ProSe direct link key establishment.
The Key establishment information container is a type 6 information element
with a minimum length of 4 octets.
The Key establishment information container information element is coded as
shown in figure 11.3.9.1 and table 11.3.9.1.
+------------------------------------------------------------+---------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +============================================================+=========+===+===+===+===+===+===+===+ | Key establishment information container IEI | octet 1 | | | | | | | | +------------------------------------------------------------+---------+---+---+---+---+---+---+---+ | Length of key establishment information container contents | octet 2 | | | | | | | | | | | | | | | | | | | | octet 3 | | | | | | | | +------------------------------------------------------------+---------+---+---+---+---+---+---+---+ | Key establishment information container contents | octet 4 | | | | | | | | +------------------------------------------------------------+---------+---+---+---+---+---+---+---+ | | octet n | | | | | | | | +------------------------------------------------------------+---------+---+---+---+---+---+---+---+
Figure 11.3.9.1: Key establishment information container information element
Table 11.3.9.1: Key establishment information container information element
+------------------------------------------------------------------+ | Key establishment information container contents (octet 4 to n) | | | | This field contains the key establishment information container. | +------------------------------------------------------------------+
### 11.3.10 Nonce
The Nonce information element contains a 128-bit nonce used during 5G ProSe
direct link security establishment.
The Nonce information element is a type 3 information element, with a length
of 17 octets.
The Nonce information element is coded as shown in figure 11.3.10.1 and table
11.3.10.1.
8 7 6 5 4 3 2 1
* * *
Nonce IEI octet 1  
Nonce contents octet 2  
octet 17
Figure 11.3.10.1: Nonce information element
Table 11.3.10.1: Nonce information element
+----------------------------------------------+ | Nonce contents (octet 2 to 17) | | | | This field contains the 128-bit nonce value. | +----------------------------------------------+
### 11.3.11 UE security capabilities
The UE security capabilities information element is used to indicate which
security algorithms are supported by the UE.
The UE _security capabilities_ is a type 4 information element with a minimum
length of 4 octets and a maximum length of 10 octets.
The UE security capabilities information element is coded as shown in figure
11.3.11.1 and table 11.3.11.1.
+-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +=======+=======+=======+=======+=======+=======+=======+=======+=======+ | UE | octet | | | | | | | | | sec | 1 | | | | | | | | | urity | | | | | | | | | | ca | | | | | | | | | | pabil | | | | | | | | | | ities | | | | | | | | | | IEI | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | L | octet | | | | | | | | | ength | 2 | | | | | | | | | of UE | | | | | | | | | | sec | | | | | | | | | | urity | | | | | | | | | | ca | | | | | | | | | | pabil | | | | | | | | | | ities | | | | | | | | | | con | | | | | | | | | | tents | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 5 | 128- | 128- | 128- | 5 | 5 | 5 | 5 | octet | | G-EA0 | | | | G-EA4 | G-EA5 | G-EA6 | G-EA7 | 3 | | | 5 | 5 | 5 | | | | | | | | G-EA1 | G-EA2 | G-EA3 | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 5 | 128- | 128- | 128- | 5 | 5 | 5 | 5 | octet | | G-IA0 | | | | G-IA4 | G-IA5 | G-IA6 | G-IA7 | 4 | | | 5 | 5 | 5 | | | | | | | | G-IA1 | G-IA2 | G-IA3 | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | Spare | octet | | | | | | | | | | 5* | | | | | | | | | | -10* | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+
Figure 11.3.11.1: UE security capabilities information element
Table 11.3.11.1: UE _security capabilities_ information element
5GS encryption algorithms supported (octet 3)
* * *
5GS encryption algorithm 5G-EA0 supported (octet 3, bit 8)  
0 5GS encryption algorithm 5G-EA0 not supported 1 5GS encryption algorithm
5G-EA0 supported
5GS encryption algorithm 128-5G-EA1 supported (octet 3, bit 7)  
0 5GS encryption algorithm 128-5G-EA1 not supported 1 5GS encryption algorithm
128-5G-EA1 supported
5GS encryption algorithm 128-5G-EA2 supported (octet 3, bit 6)  
0 5GS encryption algorithm 128-5G-EA2 not supported 1 5GS encryption algorithm
128-5G-EA2 supported
5GS encryption algorithm 128-5G-EA3 supported (octet 3, bit 5)  
0 5GS encryption algorithm 128-5G-EA3 not supported 1 5GS encryption algorithm
128-5G-EA3 supported
5GS encryption algorithm 5G-EA4 supported (octet 3, bit 4)  
0 5GS encryption algorithm 5G-EA4 not supported 1 5GS encryption algorithm
5G-EA4 supported
5GS encryption algorithm 5G-EA5 supported (octet 3, bit 3)  
0 5GS encryption algorithm 5G-EA5 not supported 1 5GS encryption algorithm
5G-EA5 supported
5GS encryption algorithm 5G-EA6 supported (octet 3, bit 2)  
0 5GS encryption algorithm 5G-EA6 not supported 1 5GS encryption algorithm
5G-EA6 supported
5GS encryption algorithm 5G-EA7 supported (octet 3, bit 1)  
0 5GS encryption algorithm 5G-EA7 not supported 1 5GS encryption algorithm
5G-EA7 supported
5GS integrity algorithms supported (octet 4)
5GS integrity algorithm 5G-IA0 supported (octet 4, bit 8)  
0 5GS integrity algorithm 5G-IA0 not supported 1 5GS integrity algorithm
5G-IA0 supported
5GS integrity algorithm 128-5G-IA1 supported (octet 4, bit 7)  
0 5GS integrity algorithm 128-5G-IA1 not supported 1 5GS integrity algorithm
128-5G-IA1 supported
5GS integrity algorithm 128-5G-IA2 supported (octet 4, bit 6)  
0 5GS integrity algorithm 128-5G-IA2 not supported 1 5GS integrity algorithm
128-5G-IA2 supported
5GS integrity algorithm 128-5G-IA3 supported (octet 4, bit 5)  
0 5GS integrity algorithm 128-5G-IA3 not supported 1 5GS integrity algorithm
128-5G-IA3 supported
5GS integrity algorithm 5G-IA4 supported (octet 4, bit 4)  
0 5GS integrity algorithm 5G-IA4 not supported 1 5GS integrity algorithm
5G-IA4 supported
5GS integrity algorithm 5G-IA5 supported (octet 4, bit 3)  
0 5GS integrity algorithm 5G-IA5 not supported 1 5GS integrity algorithm
5G-IA5 supported
5GS integrity algorithm 5G-IA6supported (octet 4, bit 2)  
0 5GS integrity algorithm 5G-IA6 not supported 1 5GS integrity algorithm
5G-IA6 supported
5GS integrity algorithm 5G-IA7 supported (octet 4, bit 1)  
0 5GS integrity algorithm 5G-IA7 not supported 1 5GS integrity algorithm
5G-IA7 supported
### 11.3.12 UE PC5 unicast signalling security policy
The purpose of the UE PC5 unicast signalling security policy information
element is to indicate the UE\'s configuration for integrity protection and
ciphering of PC5 signalling messages.
The UE PC5 unicast signalling security policy is a type 3 information element
with a length of 2 octets.
The UE PC5 unicast signalling security policy information element is coded as
shown in figure 11.3.12.1.1 and table 11.3.12.1.
+----------+----------+-------+----------+---------+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +==========+==========+=======+==========+=========+===+===+===+===+ | UE PC5 | octet 1 | | | | | | | | | unicast | | | | | | | | | | si | | | | | | | | | | gnalling | | | | | | | | | | security | | | | | | | | | | policy | | | | | | | | | | IEI | | | | | | | | | +----------+----------+-------+----------+---------+---+---+---+---+ | 0 | Si | 0 | Si | octet 2 | | | | | | | gnalling | | gnalling | | | | | | | spare | c | spare | i | | | | | | | | iphering | | ntegrity | | | | | | | | policy | | pr | | | | | | | | | | otection | | | | | | | | | | policy | | | | | | +----------+----------+-------+----------+---------+---+---+---+---+
Figure 11.3.12.1: UE 5G ProSe direct signalling security policy information
element
Table 11.3.12.1: UE PC5 unicast signalling security policy information element
+----------------------------+---+---+---+----------------------------+ | Signalling integrity | | | | | | protection policy (octet | | | | | | 2, bit 1 to 3) | | | | | +============================+===+===+===+============================+ | Bits | | | | | +----------------------------+---+---+---+----------------------------+ | 3 | 2 | 1 | | | +----------------------------+---+---+---+----------------------------+ | 0 | 0 | 0 | | Signalling integrity | | | | | | protection not needed | +----------------------------+---+---+---+----------------------------+ | 0 | 0 | 1 | | Signalling integrity | | | | | | protection preferred | +----------------------------+---+---+---+----------------------------+ | 0 | 1 | 0 | | Signalling integrity | | | | | | protection required | +----------------------------+---+---+---+----------------------------+ | 0 | 1 | 1 | | | +----------------------------+---+---+---+----------------------------+ | to Spare | | | | | +----------------------------+---+---+---+----------------------------+ | 1 | 1 | 0 | | | +----------------------------+---+---+---+----------------------------+ | 1 | 1 | 1 | | Reserved | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | If the UE receives a | | | | | | signalling integrity | | | | | | protection policy value | | | | | | that the UE does not | | | | | | understand, the UE shall | | | | | | interpret the value as 010 | | | | | | \"Signalling integrity | | | | | | protection required\". | | | | | | | | | | | | Signalling ciphering | | | | | | policy (octet 2, bit 5 to | | | | | | 7) | | | | | +----------------------------+---+---+---+----------------------------+ | Bits | | | | | +----------------------------+---+---+---+----------------------------+ | 7 | 6 | 5 | | | +----------------------------+---+---+---+----------------------------+ | 0 | 0 | 0 | | Signalling ciphering not | | | | | | needed | +----------------------------+---+---+---+----------------------------+ | 0 | 0 | 1 | | Signalling ciphering | | | | | | preferred | +----------------------------+---+---+---+----------------------------+ | 0 | 1 | 0 | | Signalling ciphering | | | | | | required | +----------------------------+---+---+---+----------------------------+ | 0 | 1 | 1 | | | +----------------------------+---+---+---+----------------------------+ | to Spare | | | | | +----------------------------+---+---+---+----------------------------+ | 1 | 1 | 0 | | | +----------------------------+---+---+---+----------------------------+ | 1 | 1 | 1 | | Reserved | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | If the UE receives a | | | | | | signalling ciphering | | | | | | policy value that the UE | | | | | | does not understand, the | | | | | | UE shall interpret the | | | | | | value as 010 \"Signalling | | | | | | ciphering required\". | | | | | | | | | | | | Bit 4 and 8 of octet 2 are | | | | | | spare and shall be coded | | | | | | as zero. | | | | | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+
### 11.3.13 MSB of K~NRP-sess~ ID
The purpose of the MSB of K~NRP-sess~ ID information element is to carry the 8
most significant bits of the K~NRP-sess~ ID.
The MSB of K~NRP-sess~ ID information element is a type 3 information element
with a length of 2 octets.
The MSB of K~NRP-sess~ ID information element is coded as shown in figure
11.3.13.1 and table 11.3.13.1.
8 7 6 5 4 3 2 1
* * *
MSB of K~NRP-sess~ ID IEI octet 1  
MSB of K~NRP-sess~ ID contents octet 2
Figure 11.3.13.1: MSB of K~NRP-sess~ ID information element
Table 11.3.13.1: MSB of K~NRP-sess~ ID information element
+--------------------------------------------------------------------+ | MSB of K~NRP-sess~ ID contents (octet 2) | | | | This field contains the 8 most significant bits of K~NRP-sess~ ID. | +--------------------------------------------------------------------+
### 11.3.14 K~NRP~ ID
The purpose of the K~NRP~ ID information element is to carry the identity of
the K~NRP~ held by a UE.
The K~NRP~ ID is a type 3 information element with a length of 5 octets.
The K~NRP~ ID information element is coded as shown in figure 11.3.14.1 and
table 11.3.14.1
8 7 6 5 4 3 2 1
* * *
K~NRP~ ID IEI octet 1  
K~NRP~ ID contents octet 2  
octet 5
Figure 11.3.14.1: K~NRP~ ID information element
Table 11.3.14.1: K~NRP~ ID information element
+--------------------------------------------------------+ | K~NRP~ ID contents (octet 2 to 5) | | | | This field contains the 32-bit identifier of a K~NRP~. | +--------------------------------------------------------+
### 11.3.15 LSB of K~NRP-sess~ ID
The purpose of the LSB of K~NRP-sess~ ID information element is to carry the 8
least significant bits of the K~NRP-sess~ ID.
The LSB of K~NRP-sess~ ID is a type 3 information element with a length of 2
octets.
The LSB of K~NRP-sess~ ID information element is coded as shown in figure
11.3.15.1 and table 12.3.15.1.
8 7 6 5 4 3 2 1
* * *
LSB of K~NRP-sess~ ID octet 1  
LSB of K~NRP-sess~ ID contents octet 2
Figure 11.3.15.1: LSB of K~NRP-sess~ ID information element
Table 11.3.15.1: LSB of K~NRP-sess~ ID information element
+---------------------------------------------------------------------+ | LSB of K~NRP-sess~ ID contents (octet 2) | | | | This field contains the 8 least significant bits of K~NRP-sess~ ID. | +---------------------------------------------------------------------+
### 11.3.16 MSBs of K~NRP~ ID
The purpose of the MSBs of K~NRP~ ID information element is to carry the 16
most significant bits of the K~NRP~ ID.
The MSBs of K~NRP~ ID is a type 3 information element with a length of 3
octets.
The MSBs of K~NRP~ ID information element is coded as shown in figure
11.3.16.1 and table 11.3.16.1.
8 7 6 5 4 3 2 1
* * *
MSBs of K~NRP~ ID IEI octet 1  
MSBs of K~NRP~ ID contents octet 2  
octet 3
Figure 11.3.16.1: MSBs of K~NRP~ ID information element
Table 11.3.16.1: MSBs of K~NRP~ ID information element
+----------------------------------------------------------------+ | MSBs of K~NRP~ ID contents (octet 2 to 3) | | | | This field contains the 16 most significant bits of K~NRP~ ID. | +----------------------------------------------------------------+
### 11.3.17 LSBs of K~NRP~ ID
The purpose of the LSBs of K~NRP~ ID information element is to carry the 16
least significant bits of the K~NRP~ ID.
The LSBs of K~NRP~ ID is a type 3 information element with a length of 3
octets.
The LSBs of K~NRP~ ID information element is coded as shown in figure
11.3.17.1 and table 11.3.17.1.
8 7 6 5 4 3 2 1
* * *
LSBs of K~NRP~ ID IEI octet 1  
LSBs of K~NRP~ ID contents octet 2  
octet 3
Figure 11.3.17.1: LSBs of K~NRP~ ID information element
Table 11.3.17.1: LSBs of K~NRP~ ID information element
+-----------------------------------------------------------------+ | LSBs of K~NRP~ ID contents (octet 2 to 3) | | | | This field contains the 16 least significant bits of K~NRP~ ID. | +-----------------------------------------------------------------+
### 11.3.18 Configuration of UE PC5 unicast user plane security protection
The purpose of the configuration of UE PC5 unicast user plane security
protection information element is to indicate the agreed configuration for
security protection of PC5 user plane data between UEs over the 5G ProSe
direct link.
The configuration of UE PC5 unicast user plane security protection is a type 3
information element with a length of 2 octets.
The configuration of UE PC5 unicast user plane security protection information
element is coded as shown in figure 11.3.18.1 and table 11.3.18.1.
+----------+----------+-------+----------+---------+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +==========+==========+=======+==========+=========+===+===+===+===+ | confi | octet 1 | | | | | | | | | guration | | | | | | | | | | of UE | | | | | | | | | | PC5 | | | | | | | | | | unicast | | | | | | | | | | user | | | | | | | | | | plane | | | | | | | | | | security | | | | | | | | | | pr | | | | | | | | | | otection | | | | | | | | | | IEI | | | | | | | | | +----------+----------+-------+----------+---------+---+---+---+---+ | 0 | User | 0 | User | octet 2 | | | | | | | plane | | plane | | | | | | | spare | c | spare | i | | | | | | | | iphering | | ntegrity | | | | | | | | confi | | pr | | | | | | | | guration | | otection | | | | | | | | | | confi | | | | | | | | | | guration | | | | | | +----------+----------+-------+----------+---------+---+---+---+---+
Figure 11.3.18.1: Configuration of UE PC5 unicast user plane security
protection information element
Table 11.3.18.1: Configuration of UE PC5 unicast user plane security
protection information element
User plane integrity protection configuration (octet 2, bit 1 to 3)
* * *
Bits  
3 2 1  
0 0 0 Off 0 0 1 Off or On 0 1 0 On 0 1 1  
to Spare  
1 1 0  
1 1 1 Reserved
User plane ciphering configuration (octet 2, bit 5 to 7)  
Bits  
7 6 5  
0 0 0 Off 0 0 1 Off or On 0 1 0 On 0 1 1  
to Spare  
1 1 0  
1 1 1 Reserved
Bit 4 and 8 of octet 2 are spare and shall be coded as zero.
### 11.3.19 Link modification operation code
The purpose of the Link modification operation code information element is to
indicate what the operation of the 5G ProSe direct link modification procedure
triggered by initiating UE is.
The Link modification operation code is a type 3 information element, with a
length of 2 octets.
The Link modification operation code information element is coded as shown in
figure 11.3.19.1 and table 11.3.19.1.
8 7 6 5 4 3 2 1
* * *
Link modification operation code IEI octet 1  
Link modification operation code octet 2
Figure 11.3.19.1: Link modification operation code information element
Table 11.3.19.1: Link modification operation code information element
Link modification operation code (octet 2)
* * *
Bits  
4 3 2 1  
0 0 0 1 void 0 0 1 0 void 0 0 1 1 Add new PC5 QoS flow(s) to the existing 5G
ProSe direct link 0 1 0 0 Modify PC5 QoS parameters of the existing PC5 QoS
flow(s) 0 1 0 1 Remove existing PC5 QoS flow(s) from the existing 5G ProSe
direct link 0 1 1 0 Associate new ProSe application(s) with existing PC5 QoS
flow(s) 0 1 1 1 Remove ProSe application(s) from existing PC5 QoS flow(s) 1 0
0 0  
to Spare  
1 1 1 0  
1 1 1 1 Reserved
Bit 5 to 8 of octet 2 are spare and shall be coded as zero.
### 11.3.20 Keep-alive counter
The purpose of the Keep-alive counter information element is to indicate the
keep-alive counter which is a 32-bit counter used for the 5G ProSe direct link
keep-alive procedure.
The Keep-alive counter is a type 3 information element with a length of 5
octets.
The Keep-alive counter information element is coded as shown in figure
11.3.20.1 and table 11.3.20.1.
8 7 6 5 4 3 2 1
* * *
Keep-alive counter IEI octet 1  
Keep-alive counter contents octet 2  
octet 5
Figure 11.3.20.1: Keep-alive counter information element
Table 11.3.20.1: Keep-alive counter information element
+----------------------------------------------------+ | Keep-alive counter contents (octet 2 to 5) | | | | This field contains the 32-bit keep-alive counter. | +----------------------------------------------------+
### 11.3.21 Maximum inactivity period
The purpose of the Maximum inactivity period information element is to
indicate the maximum inactivity period of the initiating UE during a 5G ProSe
direct link keep-alive procedure.
The Maximum inactivity period is a type 3 information element, with a length
of 5 octets.
The Maximum inactivity period information element is coded as shown in figure
11.3.21.1 and table 11.3.21.1.
8 7 6 5 4 3 2 1
* * *
Maximum inactivity period IEI octet 1  
Maximum inactivity period contents octet 2  
octet 5
Figure 11.3.21.1: Maximum inactivity period information element
Table 11.3.21.1: Maximum inactivity period information element
+----------------------------------------------------------------------+ | Maximum inactivity period contents (octet 2 to 5) | | | | This field contains the binary encoding of the maximum inactivity | | period expressed in units of seconds. | +----------------------------------------------------------------------+
### 11.3.22 Selected security algorithms
The purpose of the Selected security algorithms information element is to
indicate the algorithms to be used for ciphering and integrity protection.
The Selected security algorithms is a type 3 information element with a length
of 2 octets.
The Selected security algorithms information element is coded as shown in
figure 11.3.22.1 and table 11.3.22.1.
+----------+----------+-------+----------+---------+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +==========+==========+=======+==========+=========+===+===+===+===+ | Selected | octet 1 | | | | | | | | | security | | | | | | | | | | al | | | | | | | | | | gorithms | | | | | | | | | | IEI | | | | | | | | | +----------+----------+-------+----------+---------+---+---+---+---+ | 0 | Type of | 0 | Type of | octet 2 | | | | | | | c | | i | | | | | | | spare | iphering | spare | ntegrity | | | | | | | | a | | pr | | | | | | | | lgorithm | | otection | | | | | | | | | | a | | | | | | | | | | lgorithm | | | | | | +----------+----------+-------+----------+---------+---+---+---+---+
Figure 11.3.22.1: Selected security algorithms information element
Table 11.3.22.1: Selected security algorithms information element
Type of integrity protection algorithm (octet 2, bit 1 to 3)
* * *
Bits  
**3** **2** **1**  
0 0 0 5GS integrity algorithm 5G-IA0 (null integrity protection algorithm) 0 0
1 5GS integrity algorithm 128-5G-IA1 0 1 0 5GS integrity algorithm 128-5G-IA2
0 1 1 5GS integrity algorithm 128-5G-IA3 1 0 0 5GS integrity algorithm 5G-IA4
1 0 1 5GS integrity algorithm 5G-IA5 1 1 0 5GS integrity algorithm 5G-IA6 1 1
1 5GS integrity algorithm 5G-IA7
Type of ciphering algorithm (octet 2, bit 5 to 7)  
Bits  
**7** **6** **5**  
0 0 0 5GS encryption algorithm 5G-EA0 (null ciphering algorithm) 0 0 1 5GS
encryption algorithm 128-5G-EA1 0 1 0 5GS encryption algorithm 128-5G-EA2 0 1
1 5GS encryption algorithm 128-5G-EA3 1 0 0 5GS encryption algorithm 5G-EA4 1
0 1 5GS encryption algorithm 5G-EA5 1 1 0 5GS encryption algorithm 5G-EA6 1 1
1 5GS encryption algorithm 5G-EA7
Bit 4 and 8 of octet 2 are spare and shall be coded as zero.
### 11.3.23 UE PC5 unicast user plane security policy
The purpose of the UE PC5 unicast user plane security policy information
element is to indicate the UE\'s configuration for integrity protection and
ciphering of PC5 user plane data.
The UE PC5 unicast user plane security policy is a type 3 information element
with a length of 2 octets.
The UE PC5 unicast user plane security policy information element is coded as
shown in figure 11.3.23.1 and table 11.3.23.1.
+----------+----------+-------+----------+---------+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +==========+==========+=======+==========+=========+===+===+===+===+ | UE PC5 | octet 1 | | | | | | | | | unicast | | | | | | | | | | user | | | | | | | | | | plane | | | | | | | | | | security | | | | | | | | | | policy | | | | | | | | | | IEI | | | | | | | | | +----------+----------+-------+----------+---------+---+---+---+---+ | 0 | User | 0 | User | octet 2 | | | | | | | plane | | plane | | | | | | | spare | c | spare | i | | | | | | | | iphering | | ntegrity | | | | | | | | policy | | pr | | | | | | | | | | otection | | | | | | | | | | policy | | | | | | +----------+----------+-------+----------+---------+---+---+---+---+
Figure 11.3.23.1: UE PC5 unicast user plane security policy information
element
Table 11.3.23.1: UE PC5 unicast user plane security policy information element
+----------------------------+---+---+---+----------------------------+ | User plane integrity | | | | | | protection policy (octet | | | | | | 2, bit 1 to 3) | | | | | +============================+===+===+===+============================+ | Bits | | | | | +----------------------------+---+---+---+----------------------------+ | 3 | 2 | 1 | | | +----------------------------+---+---+---+----------------------------+ | 0 | 0 | 0 | | User plane integrity | | | | | | protection not needed | +----------------------------+---+---+---+----------------------------+ | 0 | 0 | 1 | | User plane integrity | | | | | | protection preferred | +----------------------------+---+---+---+----------------------------+ | 0 | 1 | 0 | | User plane integrity | | | | | | protection required | +----------------------------+---+---+---+----------------------------+ | 0 | 1 | 1 | | | +----------------------------+---+---+---+----------------------------+ | to Spare | | | | | +----------------------------+---+---+---+----------------------------+ | 1 | 1 | 0 | | | +----------------------------+---+---+---+----------------------------+ | 1 | 1 | 1 | | Reserved | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | If the UE receives a user | | | | | | plane integrity protection | | | | | | policy value that the UE | | | | | | does not understand, the | | | | | | UE shall interpret the | | | | | | value as 010 \"user plane | | | | | | integrity protection | | | | | | required\". | | | | | | | | | | | | User plane ciphering | | | | | | policy (octet 2, bit 5 to | | | | | | 7) | | | | | +----------------------------+---+---+---+----------------------------+ | Bits | | | | | +----------------------------+---+---+---+----------------------------+ | 7 | 6 | 5 | | | +----------------------------+---+---+---+----------------------------+ | 0 | 0 | 0 | | User plane ciphering not | | | | | | needed | +----------------------------+---+---+---+----------------------------+ | 0 | 0 | 1 | | User plane ciphering | | | | | | preferred | +----------------------------+---+---+---+----------------------------+ | 0 | 1 | 0 | | User plane ciphering | | | | | | required | +----------------------------+---+---+---+----------------------------+ | 0 | 1 | 1 | | | +----------------------------+---+---+---+----------------------------+ | to Spare | | | | | +----------------------------+---+---+---+----------------------------+ | 1 | 1 | 0 | | | +----------------------------+---+---+---+----------------------------+ | 1 | 1 | 1 | | Reserved | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+ | If the UE receives a user | | | | | | plane ciphering protection | | | | | | policy value that the UE | | | | | | does not understand, the | | | | | | UE shall interpret the | | | | | | value as 010 \"user plane | | | | | | ciphering protection | | | | | | required\". | | | | | | | | | | | | Bit 4 and 8 of octet 2 are | | | | | | spare and shall be coded | | | | | | as zero. | | | | | +----------------------------+---+---+---+----------------------------+ | | | | | | +----------------------------+---+---+---+----------------------------+
### 11.3.24 Re-authentication indication
The purpose of the Re-authentication indication information element is to
indication that K~NRP~ needs to be refreshed.
The Re-authentication indication information element is a type 3 information
element, with a length of 2 octets.
The Re-authentication indication information element is coded as shown in
figure 11.3.24.1 and table 11.3.24.1.
8 7 6 5 4 3 2 1
* * *
Re-authentication indication IEI octet 1  
Re-authentication indication contents octet 2
Figure 11.3.24.1: Re-authentication indication information element
Table 11.3.24.1: Re-authentication indication information element
+--------------------------------------------------------------+ | Re-authentication indication contents (octet 2) | | | | Bits | | | | **1** | | | | 0 Reserved | | | | 1 K~NRP~ is requested to be refreshed | | | | Bits 2 to 8 of octet 2 are spare and shall be coded as zero. | +==============================================================+ | | +--------------------------------------------------------------+
### 11.3.25 Layer-2 ID
The purpose of the layer-2 ID information element is to indicate the layer-2
ID that is used by UE.
The layer-2 ID is a type 3 information element with a length of 4 octets.
The layer-2 ID information element is coded as shown in figure 11.3.25.1 and
table 11.3.25.1.
8 7 6 5 4 3 2 1
* * *
Layer-2 ID IEI octet 1  
Layer-2 ID octet 2  
octet 4
Figure 11.3.25.1: Layer-2 ID information element
Table 11.3.25.1: Layer-2 ID information element
+--------------------------------------------+ | Layer-2 ID (octet 2 to 4) | | | | This field contains the 24-bit layer-2 ID. | +--------------------------------------------+
### 11.3.26 Relay service code
The purpose of the relay service code information element is to identify a
connectivity service the UE-to-Network relay provides.
The relay service code information element is coded as shown in figure
11.3.26.1 and table 11.3.26.1.
The relay service code is a type 3 information element with a length of 4
octets.
8 7 6 5 4 3 2 1
* * *
Relay service code IEI octet 1  
Relay service code octet 2  
octet 4
Figure 11.3.26.1: Relay service code information element
Table 11.3.26.1: Relay service code information element
+----------------------------------------------+ | Relay service code value (octet 2 to 4) | | | | This contains the 24-bit relay service code. | +----------------------------------------------+
### 11.3.27 GPRS timer
See clause 10.5.7.3 in 3GPP TS 24.008 [31].
### 11.3.28 Additional parametersannouncement request refresh timer T5106
This parameter is used to carry the value of Additional parameters
announcement request refresh timer. It is an integer in the 1-1440 range
representing the timer value in unit of minutes.
The Additional parameters announcement request refresh timer T5106 is a type 3
information element with a length of 2 octets.
The Additional parameters announcement request refresh timer T5106 IE is coded
as shown in figure 11.3.28.1 and table 11.3.28.1.
+---------------------+---------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +=====================+=========+===+===+===+===+===+===+===+ | Additional | octet 1 | | | | | | | | | parameters | | | | | | | | | | announcement | | | | | | | | | | request refresh | | | | | | | | | | timer T5106 IEI | | | | | | | | | +---------------------+---------+---+---+---+---+---+---+---+ | Additional | octet 2 | | | | | | | | | parameters | | | | | | | | | | announcement | octet 3 | | | | | | | | | request refresh | | | | | | | | | | timer T5106 | | | | | | | | | | contents | | | | | | | | | +---------------------+---------+---+---+---+---+---+---+---+
Figure 11.3.28.1: Additional parameters announcement request refresh timer
T5106 information element
Table 11.3.28.1: Additional parameters announcement request refresh timer
T5106 information element
+----------------------------------------------------------------------+ | Additional parameters announcement request refresh timer T5106 | | (octet 1 to 2) | | | | This field contains the 16-bit Additional parameters announcement | | request refresh timer T5106. | +----------------------------------------------------------------------+
### 11.3.29 PC5 QoS rules
The purpose of the PC5 QoS rules information element is to indicate a set of
PC5 QoS rules to be used by the UE over the direct link, where each PC5 QoS
rule is a set of parameters as described in clause 5.6.1 of 3GPP TS 23.304
[2].
The PC5 QoS rules information element is a type 6 information element with a
minimum length of 7 octets. The maximum length for the information element is
65538 octets.
The PC5 QoS flow rules information element is coded as shown in figure
11.3.29.1, figure 11.3.29.2, figure 11.3.29.3, figure 11.3.29.4 and table
11.3.29.1.
| 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 |   
---|---|---|---|---|---|---|---|---|---  
| PC5 QoS rules IEI | octet 1 |  |  |  |  |  |  |   
| Length of PC5 QoS rules IE | octet 2 |  |  |  |  |  |  |   
|  | octet 3 |  |  |  |  |  |  |   
| PC5 QoS rule 1 | octet 4 octet u |  |  |  |  |  |  |   
| PC5 QoS rule 2 | octet u+1 octet v |  |  |  |  |  |  |   
| â€¦ | octet v+1 octet w |  |  |  |  |  |  |   
| PC5 QoS rule n | octet w+1 octet x |  |  |  |  |  |  |   
Figure 11.3.29.1: PC5 QoS rules information element
| 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 |   
---|---|---|---|---|---|---|---|---|---  
| PC5 QoS rule identifier | octet 4 |  |  |  |  |  |  |   
| Length of PC5 QoS rule | octet 5 |  |  |  |  |  |  |   
|  | octet 6 |  |  |  |  |  |  |   
| Rule operation code | DQR bit | Number of packet filters | octet 7 |  |  |  |  |   
| Packet filter list | octet 8* octet a* |  |  |  |  |  |  |   
| PC5 QoS rule precedence | octet a+1* |  |  |  |  |  |  |   
| 0 Spare | 0 Spare | PC5 QoS flow identifier (PQFI) | octet a+2* |  |  |  |  |   
| ProSe identifier | octet a+3* octet b* |  |  |  |  |  |  |   
Figure 11.3.29.2: PC5 QoS rule (u=a+2 or u=b)
* * *
     8       7   6   5   4                            3           2   1   
     0       0   0   0   Packet filter identifier 1   octet 8             
     Spare                                                                
     0       0   0   0   Packet filter identifier 2   octet 9             
     Spare                                                                
     ...                                                                  
     0       0   0   0   Packet filter identifier N   octet N+7           
     Spare
* * *
Figure 11.3.29.3: Packet filter list when the rule operation is \"modify
existing PC5 QoS rule and delete packet filters\" (m=N+7)
| 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 |   
---|---|---|---|---|---|---|---|---|---  
| 0 | 0 | 0 | 0 | Packet filter identifier 1 | octet 8 |  |  |   
| Spare |  |  |  |  |  |  |  |   
| Length of packet filter contents 1 | octet 9 |  |  |  |  |  |  |   
| Packet filter contents 1 | octet 10 octet m |  |  |  |  |  |  |   
| 0 | 0 | 0 | 0 | Packet filter identifier 2 | octet m+1 |  |  |   
| Spare |  |  |  |  |  |  |  |   
| Length of packet filter contents 2 | octet m+2 |  |  |  |  |  |  |   
| Packet filter contents 2 | octet m+3 octet n |  |  |  |  |  |  |   
| â€¦ | octet n+1 octet y |  |  |  |  |  |  |   
| 0 | 0 | 0 | 0 | Packet filter identifier N | octet y+1 |  |  |   
| Spare |  |  |  |  |  |  |  |   
| Length of packet filter contents N | octet y+2 |  |  |  |  |  |  |   
| Packet filter contents N | octet y+3 octet z |  |  |  |  |  |  |   
Figure 11.3.29.4: Packet filter list when the rule operation is \"create new
PC5 QoS rule\", or \"modify existing PC5 QoS rule and add packet filters\" or
\"modify existing PC5 QoS rule and replace all packet filters\"
Table 11.3.29.1: PC5 QoS rules information element
+----------------------------------------------------------------------+ | PC5 QoS rule identifier (octet 4) | | | | The PC5 QoS rule identifier field is used to identify the PC5 QoS | | rule. | | | | Bits | | | | 8 7 6 5 4 3 2 1 | | | | 0 0 0 0 0 0 0 0 no PC5 QoS rule identifier assigned | | | | 0 0 0 0 0 0 0 1 PQRI 1 | | | | to | | | | 1 1 1 1 1 1 1 1 PQRI 255 | | | | The target UE shall not set the PQRI value to 0. | | | | PC5 QoS rule precedence (octet a+1) | | | | The PC5 QoS rule precedence field is used to specify the precedence | | of the PC5 QoS rule among all PC5 QoS rules associated with the PC5 | | direct link of the PC5 QoS flow. This field includes the binary | | coded value of the PC5 QoS rule precedence in the range from 0 to | | 255 (decimal). The higher the value of the PC5 QoS rule precedence | | field, the lower the precedence of that PC5 QoS rule is. For the | | \"delete existing PC5 QoS rule\" operation, the PC5 QoS rule | | precedence value field shall not be included. For the \"create new | | PC5 QoS rule\" operation, the PC5 QoS rule precedence value field | | shall be included. | | | | PC5 QoS flow identifier (PQFI) (bits 6 to 1 of octet a+2) (see | | NOTE 1) | | | | The PC5 QoS flow identifier (PQFI) field contains the PC5 QoS flow | | identifier. | | | | Bits | | | | 6 5 4 3 2 1 | | | | 0 0 0 0 0 0 no PC5 QoS flow identifier assigned | | | | 0 0 0 0 0 1 PQFI 1 | | | | to | | | | 1 1 1 1 1 1 PQFI 63 | | | | The target UE shall not set the PQFI value to 0. | | | | For the \"delete existing PC5 QoS rule\" operation, the PC5 QoS flow | | identifier value field shall not be included. For the \"create new | | PC5 QoS rule\" operation, the PC5 QoS flow identifier value field | | shall be included. | | | | DQR bit (bit 5 of octet 7) | | | | The DQR bit indicates whether the PC5 QoS rule is the default PC5 | | QoS rule and it is encoded as follows: | | | | Bit | | | | 5 | | | | 0 the PC5 QoS rule is not the default PC5 QoS rule. | | | | 1 the PC5 QoS rule is the default PC5 QoS rule. | | | | Rule operation code (bits 8 to 6 of octet 7)\ | | Bits\ | | 8 7 6 | | | | 0 0 0 Reserved\ | | 0 0 1 Create new PC5 QoS rule | | | | 0 1 0 Delete existing PC5 QoS rule | | | | 0 1 1 Modify existing PC5 QoS rule and add packet filters | | | | 1 0 0 Modify existing PC5 QoS rule and replace all packet filters | | | | 1 0 1 Modify existing PC5 QoS rule and delete packet filters | | | | 1 1 0 Modify existing PC5 QoS rule without modifying packet filters | | | | 1 1 1 Reserved | | | | ProSe identifier (octets a+3 to b) (NOTE 2) | | | | The ProSe identifier field is used to carry the identifier of a | | ProSe application and shall be encoded as defined in clause 11.3.3. | | | | Number of packet filters (bits 4 to 1 of octet 7) | | | | The number of packet filters contains the binary coding for the | | number of packet filters in the packet filter list. The number of | | packet filters field is encoded in bits 4 through 1 of octet 7 where | | bit 4 is the most significant and bit 1 is the least significant | | bit. For the \"delete existing PC5 QoS rule\" operation and for the | | \"modify existing PC5 QoS rule without modifying packet filters\" | | operation, the number of packet filters shall be coded as 0. For the | | \"create new PC5 QoS rule\" operation and the \"modify existing PC5 | | QoS rule and replace all packet filters\" operation, the number of | | packet filters shall be greater than or equal to 0 and less than or | | equal to 15. For all other operations, the number of packet filters | | shall be greater than 0 and less than or equal to 15. | | | | Packet filter list (octets 8 to m) | | | | The packet filter list contains a variable number of packet filters. | | | | For the \"delete existing PC5 QoS rule\" operation, the length of | | PC5 QoS rule field is set to one. | | | | For the \"delete existing PC5 QoS rule\" operation and the \"modify | | existing PC5 QoS rule without modifying packet filters\" operation, | | the packet filter list shall be empty. | | | | For the \"modify existing PC5 QoS rule and delete packet filters\" | | operation, the packet filter list shall contain a variable number of | | packet filter identifiers. This number shall be derived from the | | coding of the number of packet filters field in octet 7. | | | | For the \"create new PC5 QoS rule\" operation and for the \"modify | | existing PC5 QoS rule and replace all packet filters\" operation, | | the packet filter list shall contain 0 or a variable number of | | packet filters. This number shall be derived from the coding of the | | number of packet filters field in octet 7. | | | | For the \"modify existing PC5 QoS rule and add packet filters\" | | operation, the packet filter list shall contain a variable number of | | packet filters. This number shall be derived from the coding of the | | number of packet filters field in octet 7. | | | | Each packet filter is of variable length and consists of | | | | - a packet filter identifier (4 bits);\ | | - the length of the packet filter contents (1 octet); and\ | | - the packet filter contents itself (variable amount of octets). | | | | The packet filter identifier field is used to identify each packet | | filter in a PC5 QoS rule. The least significant 4 bits are used. | | When the UE requests to \"create new PC5 QoS rule\", \"modify | | existing PC5 QoS rule and replace all packet filters\" or \"modify | | existing PC5 QoS rule and add packet filters\", the packet filter | | identifier values shall be set to 0. | | | | The length of the packet filter contents field contains the binary | | coded representation of the length of the packet filter contents | | field of a packet filter. The first bit in transmission order is the | | most significant bit. | | | | The packet filter contents field is of variable size and contains a | | variable number (at least one) of packet filter components. Each | | packet filter component shall be encoded as a sequence of a one | | octet packet filter component type identifier and a fixed length | | packet filter component value field. The packet filter component | | type identifier shall be transmitted first. | | | | In each packet filter, there shall not be more than one occurrence | | of each packet filter component type. Among the \"IPv4 remote | | address type\" and \"IPv6 remote address/prefix length type\" packet | | filter components, only one shall be present in one packet filter. | | Among the \"IPv4 local address type\" and \"IPv6 local | | address/prefix length type\" packet filter components, only one | | shall be present in one packet filter. Among the \"single local port | | type\" and \"local port range type\" packet filter components, only | | one shall be present in one packet filter. Among the \"single remote | | port type\" and \"remote port range type\" packet filter components, | | only one shall be present in one packet filter. If the \"match-all | | type\" packet filter component is present in the packet filter, no | | other packet filter component shall be present in the packet filter | | and the length of the packet filter contents field shall be set to | | one. If the \"Ethertype type\" packet filter component is present in | | the packet filter and the \"Ethertype type\" packet filter component | | value is neither \"0x0800\" (for IPv4) nor \"0x86DD\" (for IPv6), no | | IP packet filter component shall be present in the packet filter. | | | | The term \"IP packet filter component\" refers to \"IPv4 remote | | address type\", \"IPv4 local address type\", \"IPv6 remote | | address/prefix length type\", \"IPv6 local address/prefix length | | type\", \"Protocol identifier/Next header type\", \"Single local | | port type\", \"Local port range type\", \"Single remote port type\", | | \"Remote port range type\", \"Security parameter index type\", | | \"Type of service/Traffic class type\" and \"Flow label type\". | | | | The term local refers to the initiating UE. The term remote refers | | to an external network entity if the initiating UE is acting as a 5G | | ProSe layer-3 UE-to-network relay UE. Otherwise, the term remote | | refers to the peer UE of the 5G ProSe direct link. | | | | Packet filter component type identifier\ | | Bits\ | | 8 7 6 5 4 3 2 1 | | | | 0 0 0 0 0 0 0 1 Match-all type\ | | 0 0 0 1 0 0 0 0 IPv4 remote address type\ | | 0 0 0 1 0 0 0 1 IPv4 local address type\ | | 0 0 1 0 0 0 0 1 IPv6 remote address/prefix length type\ | | 0 0 1 0 0 0 1 1 IPv6 local address/prefix length type\ | | 0 0 1 1 0 0 0 0 Protocol identifier/Next header type\ | | 0 1 0 0 0 0 0 0 Single local port type\ | | 0 1 0 0 0 0 0 1 Local port range type\ | | 0 1 0 1 0 0 0 0 Single remote port type\ | | 0 1 0 1 0 0 0 1 Remote port range type\ | | 0 1 1 0 0 0 0 0 Security parameter index type\ | | 0 1 1 1 0 0 0 0 Type of service/Traffic class type\ | | 1 0 0 0 0 0 0 0 Flow label type | | | | 1 0 0 0 0 0 0 1 Destination MAC address type\ | | 1 0 0 0 0 0 1 0 Source MAC address type\ | | 1 0 0 0 0 0 1 1 802.1Q C-TAG VID type\ | | 1 0 0 0 0 1 0 0 802.1Q S-TAG VID type\ | | 1 0 0 0 0 1 0 1 802.1Q C-TAG PCP/DEI type\ | | 1 0 0 0 0 1 1 0 802.1Q S-TAG PCP/DEI type\ | | 1 0 0 0 0 1 1 1 Ethertype type\ | | 1 0 0 0 1 0 0 0 Destination MAC address range type\ | | 1 0 0 0 1 0 0 1 Source MAC address range type\ | | 1 0 0 0 1 0 1 0 ProSe identifier (NOTE 2)\ | | 1 0 0 0 1 0 1 1 Source layer-2 ID\ | | 1 0 0 0 1 1 0 0 Destination layer-2 ID\ | | 1 0 0 0 1 1 0 1 Application layer ID | | | | All other values are reserved. | | | | The description and valid combinations of packet filter component | | type identifiers in a packet filter are defined in clause 7.2.7. | | | | For \"match-all type\", the packet filter component shall not | | include the packet filter component value field. | | | | For \"IPv4 remote address type\", the packet filter component value | | field shall be encoded as a sequence of a four octet IPv4 address | | field and a four octet IPv4 address mask field. The IPv4 address | | field shall be transmitted first. | | | | For \"IPv4 local address type\", the packet filter component value | | field shall be encoded as defined for \"IPv4 remote address type\". | | | | For \"IPv6 remote address/prefix length type\", the packet filter | | component value field shall be encoded as a sequence of a sixteen | | octet IPv6 address field and one octet prefix length field. The IPv6 | | address field shall be transmitted first. | | | | For \"IPv6 local address/prefix length type\", the packet filter | | component value field shall be encoded as defined for \"IPv6 remote | | address /prefix length\". | | | | For \"protocol identifier/Next header type\", the packet filter | | component value field shall be encoded as one octet which specifies | | the IPv4 protocol identifier or Ipv6 next header. | | | | For \"single local port type\" and \"single remote port type\", the | | packet filter component value field shall be encoded as two octets | | which specify a port number. | | | | For \"local port range type\" and \"remote port range type\", the | | packet filter component value field shall be encoded as a sequence | | of a two octet port range low limit field and a two octet port range | | high limit field. The port range low limit field shall be | | transmitted first. | | | | For \"security parameter index\", the packet filter component value | | field shall be encoded as four octets which specify the IPSec | | security parameter index. | | | | For \"type of service/traffic class type\", the packet filter | | component value field shall be encoded as a sequence of a one octet | | type-of-service/traffic class field and a one octet | | type-of-service/traffic class mask field. The | | type-of-service/traffic class field shall be transmitted first. | | | | For \"flow label type\", the packet filter component value field | | shall be encoded as three octets which specify the IPv6 flow label. | | The bits 8 through 5 of the first octet shall be spare whereas the | | remaining 20 bits shall contain the IPv6 flow label. | | | | For \"destination MAC address type\" and \"source MAC address | | type\", the packet filter component value field shall be encoded as | | 6 octets which specify a MAC address. When the _packet filter | | direction_ field indicates \"bidirectional\", the destination MAC | | address is the remote MAC address and the source MAC address is the | | local MAC address. | | | | For \"802.1Q C-TAG VID type\", the packet filter component value | | field shall be encoded as two octets which specify the VID of the | | customer-VLAN tag (C-TAG). The bits 8 through 5 of the first octet | | shall be spare whereas the remaining 12 bits shall contain the VID. | | | | For \"802.1Q S-TAG VID type\", the packet filter component value | | field shall be encoded as two octets which specify the VID of the | | service-VLAN tag (S-TAG). The bits 8 through 5 of the first octet | | shall be spare whereas the remaining 12 bits shall contain the VID. | | If there are more than one S-TAG in the Ethernet frame header, the | | outermost S-TAG is evaluated. | | | | For \"802.1Q C-TAG PCP/DEI type\", the packet filter component value | | field shall be encoded as one octet which specifies the 802.1Q C-TAG | | PCP and DEI. The bits 8 through 5 of the octet shall be spare, the | | bits 4 through 2 contain the PCP and bit 1 contains the DEI. | | | | For \"802.1Q S-TAG PCP/DEI type\", the packet filter component value | | field shall be encoded as one octet which specifies the 802.1Q S-TAG | | PCP. The bits 8 through 5 of the octet shall be spare, the bits 4 | | through 2 contain the PCP and bit 1 contains the DEI. If there are | | more than one S-TAG in the Ethernet frame header, the outermost | | S-TAG is evaluated. | | | | For \"Ethertype type\", the packet filter component value field | | shall be encoded as two octets which specify an ethertype. | | | | For \"destination MAC address range type\", the packet filter | | component value field shall be encoded as a sequence of a 6 octet | | destination MAC address range low limit field and a 6 octet | | destination MAC address range high limit field. The destination MAC | | address range low limit field shall be transmitted first. When the | | packet filter direction field indicates \"bidirectional\", the | | destination MAC address range is the remote MAC address range. | | | | For \"source MAC address range type\", the packet filter component | | value field shall be encoded as a sequence of a 6 octet source MAC | | address range low limit field and a 6 octet source MAC address range | | high limit field. The source MAC address range low limit field shall | | be transmitted first. When the packet filter direction field | | indicates \"bidirectional\", the source MAC address is the local MAC | | address range. | | | | For \"ProSe identifier\", the packet filter component value field | | shall be encoded as defined in clause 11.3.3. | | | | For \"source layer-2 ID\" and \"destination layer-2 ID\", the packet | | filter component value field shall be encoded as defined in | | clause 11.3.25. | | | | For \"application layer ID\", the packet filter component value | | field shall be encoded as defined in clause 11.3.4. | +----------------------------------------------------------------------+ | NOTE 1: Octet a+2 shall not be included without octet a+1. | | | | NOTE 2: ProSe identifier (octets a+3 to b) can exist only when there | | is no packet filter including the ProSe identifier packet filter | | component. | +----------------------------------------------------------------------+
### 11.3.30 5GS mobile identity
See clause 9.11.3.4 in 3GPP TS 24.501 [11] with Type of identity set to
\"SUCI\".
### 11.3.31 EAP message
The purpose of the EAP message information element is to transport an EAP
message as specified in IETF RFC 3748 [39].
The EAP message information element is coded as specified in clause 9.11.2.2
of 3GPP TS 24.501 [11].
### 11.3.32 PRUK ID
### 11.3.32 User security key ID
The purpose of the User security key ID information element is to carry the
identity of the UP-PRUK or the CP-PRUK.
The User security key ID is a type 4 information element with a minimal length
of 3 octets and a maximum length of 255 octets.
The User security key ID information element is coded as shown in figure
11.3.32.1 and table 11.3.32.1.
+--------+--------+-------+-------+--------+--------+--------+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +========+========+=======+=======+========+========+========+===+===+ | User | octet | | | | | | | | | se | 1 | | | | | | | | | curity | | | | | | | | | | key ID | | | | | | | | | | IEI | | | | | | | | | +--------+--------+-------+-------+--------+--------+--------+---+---+ | Length | octet | | | | | | | | | of | 2 | | | | | | | | | User | | | | | | | | | | se | | | | | | | | | | curity | | | | | | | | | | key ID | | | | | | | | | | co | | | | | | | | | | ntents | | | | | | | | | +--------+--------+-------+-------+--------+--------+--------+---+---+ | 0 | 0 | 0 | 0 | User | User | octet | | | | | | | | se | se | 3 | | | | Spare | Spare | Spare | Spare | curity | curity | | | | | | | | | key ID | key ID | | | | | | | | | format | type | | | | +--------+--------+-------+-------+--------+--------+--------+---+---+ | User | octet | | | | | | | | | se | 4 | | | | | | | | | curity | | | | | | | | | | key ID | octet | | | | | | | | | | n | | | | | | | | +--------+--------+-------+-------+--------+--------+--------+---+---+
Figure 11.3.32.1: User security key ID information element
Table 11.3.32.1: User security key ID information element
+---------------------+---------------------+-------+---+------------+ | User security key | | | | | | ID type (bit 1 to 3 | | | | | | of octet 3) | | | | | +=====================+=====================+=======+===+============+ | The user security | | | | | | key ID type | | | | | | indicates the type | | | | | | of the user | | | | | | security key ID. | | | | | +---------------------+---------------------+-------+---+------------+ | Bits | | | | | +---------------------+---------------------+-------+---+------------+ | **3** | **2** | **1** | | | +---------------------+---------------------+-------+---+------------+ | 0 | 0 | 1 | | UP-PRUK ID | +---------------------+---------------------+-------+---+------------+ | 0 | 1 | 0 | | CP-PRUK ID | +---------------------+---------------------+-------+---+------------+ | All other values | | | | | | are reserved. | | | | | +---------------------+---------------------+-------+---+------------+ | | | | | | +---------------------+---------------------+-------+---+------------+ | User security key | | | | | | ID format (bit 4 of | | | | | | octet 3) (NOTE) | | | | | +---------------------+---------------------+-------+---+------------+ | Bit | | | | | +---------------------+---------------------+-------+---+------------+ | **4** | | | | | +---------------------+---------------------+-------+---+------------+ | 0 | network access | | | | | | identifier (NAI) | | | | +---------------------+---------------------+-------+---+------------+ | 1 | 64-bit string | | | | +---------------------+---------------------+-------+---+------------+ | Bits 5 to 8 of | | | | | | octet 3 are spare | | | | | | and shall be coded | | | | | | as zero. | | | | | +---------------------+---------------------+-------+---+------------+ | User security key | | | | | | ID (octet 4 to | | | | | | octet n) | | | | | | | | | | | | The user security | | | | | | key ID field | | | | | | contains the | | | | | | UP-PRUK ID or the | | | | | | CP-PRUK ID. If the | | | | | | user security key | | | | | | ID format field | | | | | | indicates \"NAI\", | | | | | | the UP-PRUK ID or | | | | | | the CP-PRUK ID in | | | | | | the user security | | | | | | key ID field is in | | | | | | the NAI format as | | | | | | defined in | | | | | | 3GP | | | | | | P TS 23.003 [12], | | | | | | encoded as UTF-8 | | | | | | string. If the user | | | | | | security key ID | | | | | | format field | | | | | | indicates \"64-bit | | | | | | string\", the | | | | | | UP-PRUK ID in the | | | | | | user security key | | | | | | ID field is a | | | | | | 64-bit string, | | | | | | encoded using | | | | | | binary encoding. | | | | | +---------------------+---------------------+-------+---+------------+ | NOTE: When user | | | | | | security key ID | | | | | | type is set to | | | | | | CP-PRUK ID, the | | | | | | user security key | | | | | | ID format shall be | | | | | | always set to | | | | | | \"NAI\". | | | | | +---------------------+---------------------+-------+---+------------+ | | | | | | +---------------------+---------------------+-------+---+------------+
### 11.3.33 PLMN ID
The PLMN ID information element is coded as the PLMN identity information
element specified in clause 9.11.3.85 of 3GPP TS 24.501 [11].
### 11.3.34 Void
### 11.3.35 GPI
The GPI information element contains the GBA Push Information used for the
security procedure over user plane as specified in 3GPP TS 33.503 [34].
The Key GPI is a type 6 information element.
The GPI information element is coded as shown in figure 11.3.35.1 and table
11.3.35.1.
+------------------------+---------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +========================+=========+===+===+===+===+===+===+===+ | GPI IEI | octet 1 | | | | | | | | +------------------------+---------+---+---+---+---+---+---+---+ | Length of GPI contents | octet 2 | | | | | | | | +------------------------+---------+---+---+---+---+---+---+---+ | | octet 3 | | | | | | | | +------------------------+---------+---+---+---+---+---+---+---+ | GPI contents | octet 4 | | | | | | | | | | | | | | | | | | | | octet n | | | | | | | | +------------------------+---------+---+---+---+---+---+---+---+
Figure 11.3.35.1: GPI information element
Table 11.3.35.1: GPI information element
GPI contents (octet 4 to n)
* * *
This field contains the GPI which is encoded as specified in clause 5.3.5 of
3GPP TS 33.223 [44].
### 11.3.36 RAND
The purpose of the RAND information element is to provide the UE with a non-
predictable challenge (see 3GPP TS 33.503 [34]).
The RAND information element is coded as shown in figure 11.3.36.1 and table
11.3.36.1.
The RAND is a type 3 information element with a length of 17 octets.
+------------+----------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +============+==========+===+===+===+===+===+===+===+ | RAND IEI | octet 1 | | | | | | | | +------------+----------+---+---+---+---+---+---+---+ | RAND value | octet 2 | | | | | | | | | | | | | | | | | | | | octet 17 | | | | | | | | +------------+----------+---+---+---+---+---+---+---+
Figure 11.3.36.1: RAND information element
Table 11.3.36.1: RAND information element
RAND value (octet 2 to 17)
* * *
The RAND value consists of 128 bits (see 3GPP TS 33.503 [34]).
### 11.3.37 AUTS
The purpose of the AUTS information element is to provide the network with the
necessary information to begin a re-synchronisation (see 3GPP TS 33.503 [34]).
The AUTS information element is coded as shown in figure 11.3.37.1 and table
11.3.37.1.
The AUTS is a type 3 information element with a length of 15 octets.
+------------+----------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +============+==========+===+===+===+===+===+===+===+ | AUTS IEI | octet 1 | | | | | | | | +------------+----------+---+---+---+---+---+---+---+ | AUTS value | octet 2 | | | | | | | | | | | | | | | | | | | | octet 15 | | | | | | | | +------------+----------+---+---+---+---+---+---+---+
Figure 11.3.37.1: AUTS information element
Table 11.3.37.1: AUTS information element
AUTS value (octet 2 to 15)
* * *
This contains AUTS (see 3GPP TS 33.503 [34]).
### 11.3.38 MIC
This parameter is used to carry the MIC value for integrity protection of the
PROSE DIRECT LINK ESTABLISHMENT REQUEST message.
The MIC information element is coded as shown in figure 11.3.38.1 and table
11.3.38.1.
The MIC IE is a type 3 information element with a length of 5 octets.
+-----------+---------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +===========+=========+===+===+===+===+===+===+===+ | MIC IEI | octet 1 | | | | | | | | +-----------+---------+---+---+---+---+---+---+---+ | MIC value | octet 2 | | | | | | | | | | | | | | | | | | | | octet 5 | | | | | | | | +-----------+---------+---+---+---+---+---+---+---+
Figure 11.3.38.1: MIC information element
Table 11.3.38.1: MIC information element
+-------------------------------------------------------------------------+ | MIC value (octet 2 to 5) | | | | The MIC value field consists of the MIC value for integrity protection. | +-------------------------------------------------------------------------+
## 11.4 5G ProSe direct discovery message over PC3a formats
### 11.4.1 Data types format in XML schema
To exchange structured information over the transport protocol, XML text
format/notation is introduced.
The corresponding XML data types for the data types used in ProSe messages are
provided in table 11.4.1.1.
Table 11.4.1.1: Primitive or derived types for ProSe parameter type
ProSe parameter type Type in XML schema
* * *
Integer xs:integer String xs:string Boolean xs:boolean Binary xs:hexBinary Bit
string xs:hexBinary Time xs:dateTime
For complex data types described in clause 11.4.2, an XML \"complexType\" can
be used.
Message construction shall be compliant with W3C REC-xmlschema-2-20041028:
\"XML Schema Part 2: Datatypes\" [29]
### 11.4.2 Parameters in 5G ProSe direct discovery messages over PC3a
#### 11.4.2.1 Transaction ID
This parameter is used to uniquely identify a PC3a control protocol for ProSe
direct discovery transaction when it is combined with other PC3a control
protocol for ProSe direct discovery transactions in the same transport
message. The UE shall set this parameter to a new number for each outgoing new
discovery request. The transaction ID is an integer in the 0-255 range.
#### 11.4.2.2 Command
This parameter is used to indicate the type of discovery request (announce,
monitor, query, or response) contained in a DISCOVERY_REQUEST message. It is
an integer in the 0-255 range encoded in table 11.4.2.2.1.
Table 11.4.2.2.1: Command
0 Reserved
* * *
1 Announce 2 Monitor 3 Query 4 Response 5 Metadata_update 6-255 Unused
#### 11.4.2.3 Void
#### 11.4.2.4 Prose application ID
This parameter is used to carry an identity used for open 5G ProSe direct
discovery, identifying application related information for the ProSe-enabled
UE. It is coded as specified in 3GPP TS 23.003 [12].
#### 11.4.2.5 Application identity
This parameter is used to identify the particular application that triggers
the DISCOVERY_REQUEST message. The Application identity information element is
coded as the ProSe identifier specified in clause 11.3.3.
#### 11.4.2.6 ProSe application code
This parameter is used to contain a ProSe application code. The format of the
ProSe application code is as follows:
a) if the ProSe application code is included in a MATCH_REPORT message and
application-controlled extension is used, the ProSe application code is
encoded as a 184 bitstring composed of:
1) the ProSe application code Prefix; and
2) the ProSe application code Suffix; or
b) in all other cases, the ProSe application is encoded as a 184 bitstring as
defined in 3GPP TS 23.003 [12].
#### 11.4.2.7 Validity timer T5060
This parameter is used to carry the value of validity timer T5060 associated
with a ProSe application code. It is an integer in the 1-525600 range
representing the timer value in unit of minutes.
#### 11.4.2.8 PC3a control protocol cause value
This parameter is used to indicate the particular reason why a
DISCOVERY_REQUEST or MATCH_REPORT message from the UE has been rejected by the
5G DDNMF. It is an integer in the 0-255 range encoded in table 11.4.2.8.1.
Table 11.4.2.8.1: PC3a control protocol cause value
0 Reserved
* * *
1 Invalid Application 2 Unknown ProSe application ID 3 UE authorization
failure 4 Unknown ProSe application code 5 Invalid MIC 6 Invalid UTC-based
counter 7 Invalid message format 8 Scope violation in ProSe application ID 9
Unknown RPAUID 10 Unknown or invalid discovery entry ID 11 Invalid discovery
target 12 UE unauthorised for discovery with application-controlled extension
13 UE unauthorised for on-demand announcing 14 Missing application level
container 15 Invalid data in application level container 16 Invalid match
event 17 No valid ProSe application code 18 Invalid UE Identity 19 Not
compatible PC5 UE ciphering algorithm capability 20-255 Unused
#### 11.4.2.9 Discovery filter
The elements in the discovery filter parameter are listed below.
a) ProSe application code: The ProSe application code is used by a monitoring
UE for full or partial matching of PROSE PC5 DISCOVERY messages received on
the PC5 interface (see clause 10.2.1). Only one code is allowed in a discovery
filter;
b) ProSe application mask: a bitmask provided by the 5G DDNMF in order to
allow the monitoring UE to perform a full matching or partial matching of
PROSE PC5 DISCOVERY messages received on the PC5 interface. A ProSe
application mask with all bits set to \"1\" is used for full matching. One or
more ProSe application masks may be included in a discovery filter. The length
of the ProSe application mask is as same as the length of ProSe application
code; and
c) TTL Timer T5064: time-to-live duration for which the associated discovery
filter is valid, after which it shall not be used. It is an integer in the
1-525600 range representing the timer value in unit of minutes.
#### 11.4.2.10 Monitored PLMN ID
This parameter is used to indicate the PLMN ID of the PLMN in which the PROSE
PC5 DISCOVERY message containing a ProSe application code for which there was
a match event was received. It is coded as specified in 3GPP TS 23.003 [12].
#### 11.4.2.11 VPLMN ID
This parameter is used to indicate the PLMN ID of the PLMN in which the
requesting UE is registered. It is coded as specified in 3GPP TS 23.003 [12].
#### 11.4.2.12 UTC-based counter
This parameter is used to indicate the UTC time associated with the discovery
transmission opportunity in which a PROSE PC5 DISCOVERY message is sent. This
parameter is also used to indicate the UTC time associated with the security
protected relay service code for 5G ProSe UE-to-network relay when PROSE
DIRECT LINK ESTABLISHMENT REQUEST message is sent. It is expressed in unit of
seconds and coded in binary format as the 32 least significant bits of the
coordinated universal time as defined in 3GPP TS 38.331 [13].
#### 11.4.2.13 Validity timer T5072
This parameter is used to carry the value of validity timer T5072 associated
with a ProSe application code for which there was a match event. It is an
integer in the 1-525600 range representing the timer value in unit of minutes.
#### 11.4.2.14 Metadata flag
This parameter is used to indicate whether the UE wishes to receive the latest
metadata information associated with the ProSe application ID or RPAUID in the
MATCH_REPORT_ACK from the 5G DDNMF. It is a Boolean value coded as follows:
a) False: the UE does not wish to receive the latest metadata information
associated with the ProSe application ID or RPAUID in the MATCH_REPORT_ACK
from the 5G DDNMF; or
b) True: the UE wishes to receive the latest metadata information associated
with the ProSe application ID or RPAUID in the MATCH_REPORT_ACK message from
the 5G DDNMF.
#### 11.4.2.15 Metadata
This parameter is used to carry the metadata that is associated with the ProSe
application ID contained in the MATCH_REPORT_ACK message. The purpose of the
metadata is to carry additional application-layer information associated with
a particular ProSe application ID. Examples of such information are postal
address, phone number, URL etc. The length and contents of the metadata are
out of scope of 3GPP. The format of the metadata is a UTF8-encoded string.
#### 11.4.2.16 Current time
This parameter is used to carry the current UTC-based time at the 5G DDNMF.
The format of this parameter follows the XML data type defined in table
11.4.1.1 for ProSe parameter type \"Time\".
#### 11.4.2.17 Max offset
This parameter is used to indicate the maximum time difference between the
time on the UE\'s ProSe clock and the UTC-based counter associated with the
discovery slot in seconds, as specified in 3GPP TS 33.503 [34]. The Max offset
is an integer in the 1-32 range.
#### 11.4.2.18 Discovery type
This parameter is used to indicate the type of ProSe direct discovery
contained in the DISCOVERY_REQUEST message or MATCH_REPORT message. It is an
integer in the 0-3 range encoded as table 11.4.2.18.1.
Table 11.4.2.18.1: Discovery type
0 Reserved
* * *
1 Open discovery 2 Restricted discovery 3 Unused
#### 11.4.2.19 Match report refresh timer T5074
This parameter is used to carry the value of match report refresh timer T5074
associated with a ProSe application code for which there was a match event. It
is an integer in the 1-525600 range representing the timer value in unit of
minutes.
#### 11.4.2.20 Requested timer
During the announce request procedure for open 5G ProSe direct discovery or
restricted 5G ProSe direct discovery model A, the requested timer element is
used to carry the length of validity timer associated with the ProSe
application code or the ProSe restricted code that the UE expects to receive
from the 5G DDNMF. When the procedure is to inform the 5G DDNMF that the UE
wants to stop announcing a ProSe application code or a ProSe restricted code
before the associated valid timer expires, the requested timer shall be set to
0.
During the monitor request procedure for open 5G ProSe direct discovery or
restricted 5G ProSe direct discovery model A, the requested timer element is
only used to inform the 5G DDNMF that the UE wants to stop monitoring using
discovery filter(s) or restricted discovery filter(s). The requested timer
shall be set to 0.
It is an integer in the 0-525600 range representing the timer value in unit of
minutes.
#### 11.4.2.21 DDNMF transaction ID
This parameter is used to uniquely identify a PC3a control protocol for ProSe
direct discovery transaction when it is combined with other PC3a control
protocol for ProSe direct discovery transactions in the same transport
message. The 5G DDNMF shall set this parameter to a new number for each
outgoing new request. The DDNMF transaction ID is an integer in the 0-255
range.
#### 11.4.2.22 Update info
This parameter is used to carry the following:
a) the updated information for an announcing UE in restricted discovery with a
new ProSe restricted code to replace the old one in the discovery entry and
the corresponding validity timer. In this case the parameter shall contain the
following:
1) ProSe restricted code: See clause 11.4.2.27; and
2) validity timer T5062: See clause 11.4.2.32.
b) the updated information for a monitoring UE in restricted discovery with a
new set of restricted discovery filters to be used for a given discovery
entry. In this case the parameter shall contain one or more restricted
discovery filters as defined in clause 11.4.2.30;
c) the updated information for an announcing UE in open discovery with a new
ProSe application code to replace the old one in the discovery entry and the
corresponding validity timer. In this case the parameter shall contain:
1) ProSe application code: See clause 11.4.2.6; and
2) validity timer T5060: See clause 11.4.2.7; or
d) the updated information for a monitoring UE in open discovery with a new
set of discovery filters to be used for a given discovery entry. In this case
the parameter shall contain one or more discovery filters defined in clause
11.4.2.9.
#### 11.4.2.23 RPAUID
This parameter is used to carry the RPAUID, which is an identity used for
restricted 5G ProSe direct discovery, identifying application related
information for the 5G ProSe-enabled UE.
#### 11.4.2.24 Announcing type
This parameter is used to indicate whether the UE requests on demand
announcing in a DISCOVERY_REQUEST message. It is an integer in the 0-255 range
encoded as table 11.4.2.24.1.
Table 11.4.2.24.1: Announcing type
0 Normal
* * *
1 On demand 2-225 Unused
#### 11.4.2.25 Application level container
This parameter is used to carry the Application level container, which
contains application-level data transparent to the 3GPP network transferred
between the application client in the UE and the ProSe application server.
#### 11.4.2.26 Discovery entry ID
This parameter is used to carry the discovery entry ID, which is an identity
allocated by the 5G DDNMF to refer to a discovery entry in the UE\'s context
as a result of a discovery request, either announcing or monitoring. It is an
integer in the 0-65535 range.
#### 11.4.2.27 ProSe restricted code
This parameter is used to contain a ProSe restricted code. The format of the
ProSe restricted code is as follows:
a) if the ProSe restricted code is included in a MATCH_REPORT message and
application-controlled extension is not used, the ProSe restricted code is
encoded as a 184 bitstring composed of:
1) the ProSe restricted code in the 64 most significant bits; and
2) the remaining 120 bits set to zero;
b) if the ProSe restricted code is included in a MATCH_REPORT message and
application-controlled extension is used, the ProSe restricted code is encoded
as a 184 bitstring composed of
1) the ProSe restricted code prefix in the 64 most significant bits;
2) the ProSe restricted code suffix; and
3) any remaining unused least significant bits set to zero; or
c) in all other cases, the ProSe restricted code is encoded as a 64 bitstring
as defined in 3GPP TS 23.003 [12].
#### 11.4.2.28 ProSe restricted code suffix range
This parameter is used to carry a range of consecutive ProSe restricted code
suffixes, each of which can be appended by the UE to a ProSe restricted code
prefix (see clause 11.4.2.27) for restricted 5G ProSe direct discovery with
application-controlled extension. A ProSe restricted code suffix range
includes a beginning suffix code and optionally an ending suffix code, as
described below:
a) beginning suffix code: the bit-length of this bit string reflects the
length of the suffix portion of the ProSe restricted code allocated by the
ProSe application server for an RPAUID based on application configuration. The
binary value of this code is the lowest value of the ProSe restricted code
suffix range; and
b) ending suffix code: the binary value of this code is the highest value of
the ProSe restricted code suffix range. The length of the ending suffix code
shall be the same as that of the beginning suffix code.
If the ProSe restricted code suffix range contains only a single ProSe
restricted code suffix, then that suffix is represented by the beginning
suffix code and the ending suffix code is omitted.
#### 11.4.2.29 On demand announcing enabled indicator
This parameter is used to carry the on demand announcing enabled indicator,
which is a Boolean value indicating whether on demand announcing is enabled or
not in the 5G DDNMF.
#### 11.4.2.30 Restricted discovery filter
This parameter is used to carry the discovery filter(s) used to monitor an
individual target RPAUID in restricted 5G ProSe direct discovery model A. It
contains one or more filters, TTL timer T5066, optionally an RPAUID parameter
identifying the target RPAUID, optionally a metadata indicator and optionally
the corresponding metadata. The elements in the restricted discovery filter
parameter are defined as below:
a) filter: a matching filter used for restricted 5G ProSe direct discovery
Model A monitoring. It contains one code and one or more masks. The code is
used by a monitoring UE for full or partial matching of PROSE PC5 DISCOVERY
messages received on the PC5 interface with a ProSe restricted code (see
clause 11.4.2.27). Only one code is allowed in a filter. The mask is a bitmask
provided by the 5G DDNMF in order to allow the monitoring UE to perform a full
matching or partial matching of PROSE PC5 DISCOVERY messages received on the
PC5 interface. A mask with all bits set to \"1\" is used for full matching.
One or more masks may be included in a filter. The length of the mask is the
same as the length of the code;
b) TTL Timer T5066: time-to-live duration for which the associated restricted
discovery filter is valid, after which it shall not be used. It is an integer
in the 1-525600 range representing the timer value in unit of minutes;
c) RPAUID: identifier of the target RPAUID to be monitored;
d) metadata indicator: it contains the information element defined in clause
11.4.2.44; and
e) metadata: application-layer metadata associated with the monitoring target.
#### 11.4.2.31 ACE enabled indicator
This parameter is used to indicate whether application-controlled extension
for open 5G ProSe direct discovery or restricted 5G ProSe direct discovery is
enabled. It is an integer value in the 0-255 range encoded as table
11.4.2.31.1.
Table 11.4.2.31.1: ACE enabled indicator
0 Reserved
* * *
1 Normal 2 Application-controlled extension enable 3-225 Unused
#### 11.4.2.32 Validity timer T5062
This parameter is used to carry the value of validity timer T5062 associated
with a ProSe restricted code or ProSe restricted code prefix. It is an integer
in the 1-525600 range representing the timer value in unit of minutes.
#### 11.4.2.33 Restricted code security material
This parameter is used as a container for the information necessary for
security keys and algorithms protecting the sending or receiving of restricted
5G ProSe direct discovery messages over the PC5 interface. The elements in the
restricted code security material parameter are listed below:
a) DUSK: an optional key which is allocated by the 5G DDNMF and is used by the
UE for scrambling or unscrambling the PROSE PC5 DISCOVERY message containing
the ProSe restricted code in restricted 5G ProSe direct discovery. The
calculation of the DUSK is defined in 3GPP TS 33.503 [34];
b) DUIK: an optional key which is allocated by the 5G DDNMF and is used by the
UE to compute the MIC that is included in the PROSE PC5 DISCOVERY message
containing the ProSe restricted code in restricted 5G ProSe direct discovery.
The calculation of the DUIK is defined in 3GPP TS 33.503 [34]; and
c) DUCK and associated encrypted bitmask: DUCK is an optional key which is
allocated by the 5G DDNMF and is used by the UE to encrypt a portion of the
PROSE PC5 DISCOVERY message containing the ProSe restricted code in restricted
5G ProSe direct discovery. The calculation of the DUCK is defined in 3GPP TS
33.503 [34]. The encrypted bitmask is a bitmask which uses bit \"1\" to mark
the positions of the bits for which the DUCK encryption is applied.
d) MIC-check-indicator: an optional indication which is provided by the 5G
DDNMF and indicates whether to use match reports for MIC checking, used by the
UE to decide whether to perform the required MIC check via the match report
procedure for restricted 5G ProSe direct discovery. If this indication is
included, the DUIK shall not be included in the restricted code security
material parameter but provided as a separate parameter as specified in 3GPP
TS 33.503 [34]. This indication is not used for 5G ProSe UE-to-network relay
discovery and group member discovery.
#### 11.4.2.34 Discovery model
This parameter is used to indicate the model of ProSe direct discovery
contained in the DISCOVERY_REQUEST message. It is an integer in the 0-3 range
encoded as table 11.4.2.34.1.
Table 11.4.2.34.1: Discovery model
0 Reserved
* * *
1 Model A 2 Model B 3 Unused
#### 11.4.2.35 ProSe response code
This parameter is used to carry the ProSe response code. It is a bit string
coded as specified in 3GPP TS 23.003 [12].
#### 11.4.2.36 Discovery query filter
This parameter is used to carry the discovery query filter that is allocated
by the 5G DDNMF in the HPLMN to the discoveree UE for restricted Model B
discovery, for a particular RPAUID. The elements in the discovery query filter
parameter are defined as below:
a) Code: the code is used by a discoveree UE for full or partial matching of
PROSE PC5 DISCOVERY messages received on the PC5 interface containing a ProSe
query code. Only one code is allowed in a discovery query filter; and
b) Mask: the mask is a bitmask provided by the 5G DDNMF in order to allow the
discoveree UE to perform a full matching or partial matching of PROSE PC5
DISCOVERY messages received on the PC5 interface containing the ProSe query
code. A mask with all bits set to \"1\" is used for full matching. One or more
masks may be included in a filter. The length of the mask is the same as the
length of the code.
#### 11.4.2.37 Validity timer T5068
This parameter is used to carry the value of validity timer T5068 associated
with a ProSe response code and corresponding discovery query filter(s). It is
an integer in the 1-525600 range representing the timer value in unit of
minutes.
#### 11.4.2.38 Subquery result
This parameter is used to contain the information allocated by the 5G DDNMF
related to one particular query target RPAUID which the discoverer UE intends
to query with restricted 5G ProSe direct discovery model B. It contains one
ProSe query code, one or more discovery response filter(s), validity timer
T5070, an RPAUID parameter identifying the target RPAUID, restricted security
and optionally the corresponding metadata. The elements in the subquery result
parameter are defined as below:
a) ProSe query code: it is a ProSe restricted code allocated by the 5G DDNMF
to a discoverer UE to solicit the response from a discoveree UE for a
particular target RPAUID;
b) discovery response filter: it contains one code and one or more masks to be
used to matching ProSe response code. The code is used by a discoverer UE to
represent a targeted ProSe response code (see clause 11.4.2.35). The mask is a
bitmask provided by the 5G DDNMF in order to allow the discoverer UE to
perform a full matching or partial matching of PROSE PC5 DISCOVERY messages
received on the PC5 interface containing the ProSe response code. A mask with
all bits set to \"1\" is used for full matching. The length of the mask is the
same as the length of the code;
c) validity timer T5070: it represents the validity time associated with a
ProSe query code and corresponding discovery response filter(s). It is an
integer in the 1-525600 range representing the timer value in unit of minutes;
d) code-sending security parameter: it contains the information element
defined in clause 11.4.2.33;
e) code-receiving security parameter: it contains the information element
defined in clause 11.4.2.33;
f) RPAUID: identifier of the target RPAUID to be monitored; and
g) metadata: application-layer metadata associated with the querying target.
#### 11.4.2.39 Validity timer T5076
This parameter is used to carry the value of validity timer T5076 associated
with a ProSe restricted code for which there was a match event. It is an
integer in the 1-525600 range representing the timer value in unit of minutes.
#### 11.4.2.40 Match report refresh timer T5077
This parameter is used to carry the value of match report refresh timer T5077
associated with a ProSe restricted Code for which there was a match event. It
is an integer in the 1-525600 range representing the timer value in unit of
minutes.
#### 11.4.2.41 Metadata index mask
This parameter is a bitmask provided by the 5G DDNMF in order to indicate the
portion used for the metadata index in the ProSe application code for the
monitoring UE. The length of the metadata index mask is as same as the length
of ProSe application code.
#### 11.4.2.42 Network-initiated transaction method
This parameter is used to indicate the method enabling transport of PC3a
messages for 5G DDNMF-initiated ProSe direct discovery procedures. It is an
integer in the 0-255 range encoded as table 11.4.2.42.1.
Table 11.4.2.42.1: Network-initiated transaction method
0 Unused
* * *
1 HTTP long polling 2-255 Unused
#### 11.4.2.43 Announcing PLMN ID
This parameter is used to indicate the PLMN ID of the PLMN operating the radio
resources which the UE intends to use for transmitting a PROSE PC5 DISCOVERY
message. It is coded as specified in 3GPP TS 23.003 [12].
#### 11.4.2.44 Metadata Indicator
This parameter is used to indicate whether there is a metadata associated with
the target RPAUID. It is an integer value in the 0-255 range encoded as table
11.4.2.44.1.
Table 11.4.2.44.1: Metadata indicator
0 No metadata associated
* * *
1 Metadata associated 2-255 Unused
#### 11.4.2.45 ProSe application code prefix
This parameter is used to contain a ProSe application code prefix. Its length
indicates the size in bits of the allocated prefix, which can take any value
that is a multiple of 8 in the 32 to 176 range.
NOTE: The size of the prefix for a given application is determined by the
ProSe application server and made known to the 5G DDNMF by means that are out
of scope of 3GPP.
#### 11.4.2.46 ProSe application code suffix
This parameter is used to contain a ProSe application code suffix. The ProSe
application code suffix is used with a ProSe application code prefix to form a
184-bit ProSe application code for open 5G ProSe direct discovery with
application-controlled extension.
#### 11.4.2.47 ProSe application code ACE
This parameter is used to carry a set of ProSe application code(s) allocated
for a corresponding ProSe application ID when application-controlled extension
is used. It contains one ProSe application code Prefix and one or more ProSe
application code suffix range(s). The elements in the ProSe application code
ACE parameter are defined as below:
a) ProSe application code prefix: as defined in clause 11.4.2.45; and
b) ProSe application code suffix range: this parameter is used to carry a
range of consecutive ProSe application code suffixes (see clause 11.4.2.46). A
ProSe application code suffix range includes a beginning suffix code and
optionally an ending suffix code, as described below:
1) beginning suffix code: the bit-length of this bit string reflects the
length of the suffix portion of the ProSe application code allocated by the
ProSe application server for a ProSe application ID based on application
configuration. The binary value of this code is the lowest value of the ProSe
application code suffix range; and
2) ending suffix code: the binary value of this code is the highest value of
the ProSe application code suffix range. The length of the ending suffix code
shall be the same as that of the beginning suffix code.
If the ProSe application code suffix range contains only a single ProSe
application code suffix, then that suffix is represented by the beginning
suffix code and the ending suffix code is omitted.
#### 11.4.2.48 Discovery key
This parameter is used to carry a Discovery key allocated by the 5G DDNMF.
This key is used by the UE to compute the MIC that is included in the PROSE
PC5 DISCOVERY message. The format of Discovery key is defined in 3GPP TS
33.303 [36].
#### 11.4.2.49 PC5 security policies
This parameter is used to indicate the PC5 security policies as integer
values, where the PC5 signalling security policies are defined in table
11.3.12.1 and the PC5 user plane security policies are defined in table
11.3.23.1.
#### 11.4.2.50 PC5 UE ciphering algorithm capability
This parameter is used to indicate the UE supported ciphering algorithms as
integer values, where the UE supported ciphering algorithms field is defined
as octet 3 of figure 11.3.11.1 and table 11.3.11.1.
#### 11.4.2.51 Selected PC5 ciphering algorithm
This parameter is used to indicate the selected PC5 ciphering algorithm as
integer values, where the selected PC5 ciphering algorithm filed is defined as
bit 5 to 7 of octet 2 in figure 11.3.22.1 and table 11.3.22.1.
#### 11.4.2.52 ProSe PC5 discovery message
This parameter is used to include the entire PROSE PC5 DISCOVERY message where
the match event occurred. For the restricted 5G ProSe direct discovery
procedure, this parameter is included if it is required to check the MIC via
the match report procedure as specified in clause 6.2.9.2 and clause 6.2.10.2.
#### 11.4.2.53 PKMF address
This parameter is used to carry a 5G PKMF address to the UE by the 5G DDNMF in
order to find a 5G PKMF for the authentication based on security procedure
over user plane as specified in 3GPP TS 33.503 [34].
The PKMF address information element is coded as shown in figure 11.4.2.53.1,
figure 11.4.2.53.2, figure 11.4.2.53.3, and table 11.4.2.53.1.
+------------------------+---------------+-------+-------+-------+-------+-------+-------+---------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +========================+===============+=======+=======+=======+=======+=======+=======+=========+ | Length of PKMF address | octet 1 | | | | | | | | +------------------------+---------------+-------+-------+-------+-------+-------+-------+---------+ | | octet 2 | | | | | | | | +------------------------+---------------+-------+-------+-------+-------+-------+-------+---------+ | 0 | 0 | 0 | 0 | 0 | FQDNI | IPv6I | IPv4I | octet 3 | | | | | | | | | | | | Spare | Spare | Spare | Spare | Spare | | | | | +------------------------+---------------+-------+-------+-------+-------+-------+-------+---------+ | IPv4 address list | octet 4* | | | | | | | | | | | | | | | | | | | | octet o* | | | | | | | | +------------------------+---------------+-------+-------+-------+-------+-------+-------+---------+ | IPv6 address list | octet (o+1)* | | | | | | | | | | | | | | | | | | | | octet m* | | | | | | | | +------------------------+---------------+-------+-------+-------+-------+-------+-------+---------+ | FQDN | octet (m+1)* | | | | | | | | | | | | | | | | | | | | octet n* | | | | | | | | +------------------------+---------------+-------+-------+-------+-------+-------+-------+---------+
Figure 11.4.2.53.1: PKMF address
+--------------------------+-----------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +==========================+===========+===+===+===+===+===+===+===+ | Number of IPv4 addresses | octet 4 | | | | | | | | +--------------------------+-----------+---+---+---+---+---+---+---+ | IPv4 address 1 | octet 5 | | | | | | | | | | | | | | | | | | | | octet 8 | | | | | | | | +--------------------------+-----------+---+---+---+---+---+---+---+ | IPv4 address 2 | octet 9 | | | | | | | | | | | | | | | | | | | | octet 12 | | | | | | | | +--------------------------+-----------+---+---+---+---+---+---+---+ | ... ... | | | | | | | | | +--------------------------+-----------+---+---+---+---+---+---+---+ | IPv4 address N | octet o-3 | | | | | | | | | | | | | | | | | | | | octet o | | | | | | | | +--------------------------+-----------+---+---+---+---+---+---+---+
Figure 11.4.2.53.2: IPv4 address list
+--------------------------+------------+---+---+---+---+---+---+---+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | | +==========================+============+===+===+===+===+===+===+===+ | Number of IPv6 addresses | octet o+1 | | | | | | | | +--------------------------+------------+---+---+---+---+---+---+---+ | IPv6 address 1 | octet o+2 | | | | | | | | | | | | | | | | | | | | octet o+17 | | | | | | | | +--------------------------+------------+---+---+---+---+---+---+---+ | IPv6 address 2 | octet o+18 | | | | | | | | | | | | | | | | | | | | octet o+33 | | | | | | | | +--------------------------+------------+---+---+---+---+---+---+---+ | ... ... | | | | | | | | | +--------------------------+------------+---+---+---+---+---+---+---+ | IPv6 address N | octet m-15 | | | | | | | | | | | | | | | | | | | | octet m | | | | | | | | +--------------------------+------------+---+---+---+---+---+---+---+
Figure 11.4.2.53.3: IPv6 address list
Table 11.4.2.53.1: PKMF address information element
+----------------------------------+----------------------------------+ | IPv4 addresses indicator (IPv4I) | | | (octet 3 bit 1): (NOTE 1) | | +==================================+==================================+ | Bit | | +----------------------------------+----------------------------------+ | **1** | | +----------------------------------+----------------------------------+ | 0 | IPv4 address list is not present | +----------------------------------+----------------------------------+ | 1 | IPv4 address list is present | +----------------------------------+----------------------------------+ | IPv6 addresses indicator (IPv6I) | | | (octet 3 bit 2): (NOTE 1) | | +----------------------------------+----------------------------------+ | Bit | | +----------------------------------+----------------------------------+ | **2** | | +----------------------------------+----------------------------------+ | 0 | IPv6 address list is not present | +----------------------------------+----------------------------------+ | 1 | IPv6 address list is present | +----------------------------------+----------------------------------+ | FQDN indicator (FQDNI) (octet 3 | | | bit 3): (NOTE 2) | | +----------------------------------+----------------------------------+ | Bit | | +----------------------------------+----------------------------------+ | **3** | | +----------------------------------+----------------------------------+ | 0 | FQDN is not present | +----------------------------------+----------------------------------+ | 1 | FQDN is present | +----------------------------------+----------------------------------+ | IPv4 address list (octet 4 to | | | octet o) | | +----------------------------------+----------------------------------+ | IPv4 address list contains the | | | IPv4 address(es) of the 5G PKMF | | | and shall be encoded as defined | | | in figure 11.4.2.53.2. | | | | | | IPv6 address list (octet o+1 to | | | octet m) | | | | | | IPv6 address list contains the | | | IPv6 address(es) of the 5G PKMF | | | and shall be encoded as defined | | | in figure 11.4.2.53.3. | | | | | | FQDN (octet m+1 to n) | | | | | | FQDN field contains a sequence | | | of one octet FQDN length field | | | and a FQDN value of variable | | | size. The FQDN value field shall | | | be encoded as defined in | | | clause 28.3.2.1 of | | | 3GPP TS 23.003 [12]. | | +----------------------------------+----------------------------------+ | NOTE 1: If multiple IPv4 | | | addresses and/or IPv6 addresses | | | are included, which one of these | | | addresses is selected is | | | implementation dependent. | | | | | | NOTE 2: If the 5G PKMF supports | | | the 5G PKMF Services with | | | \"https\" URI scheme (i.e use of | | | TLS is mandatory), then the FQDN | | | shall be used to construct the | | | target URI. | | +----------------------------------+----------------------------------+
## 11.5 Void
## 11.6 5G ProSe security message over PC8 formats
### 11.6.1 Data types format in XML schema
To exchange structured information over the transport protocol, XML text
format/notation is introduced.
The corresponding XML data types for the data types used in ProSe messages are
provided in table 11.6.1.1.
Table 11.6.1.1: Primitive or derived types for ProSe parameter type
ProSe parameter type Type in XML schema
* * *
Integer xs:integer String xs:string Boolean xs:boolean Binary xs:hexBinary Bit
string xs:hexBinary Time xs:dateTime
For complex data types described in clause 11.6.2, an XML \"complexType\" can
be used.
Message construction shall be compliant with W3C REC-xmlschema-2-20041028:
\"XML Schema Part 2: Datatypes\" [29].
### 11.6.2 Parameters in 5G ProSe security messages over PC8
#### 11.6.2.1 Transaction ID
This parameter is used to uniquely identify a PC8 control protocol for 5G
ProSe security transaction when it is combined with other PC8 control protocol
for 5G ProSe security transactions in the same transport message. The UE shall
set this parameter to a new number for each outgoing new key request. The
transaction ID is an integer in the 0-255 range.
#### 11.6.2.2 UP-PRUK
This parameter is used to indicate the UP-PRUK allocated by the 5G PKMF. The
calculation of the UP-PRUK is defined in 3GPP TS 33.503 [34].
#### 11.6.2.3 UP-PRUK ID
This parameter is used to indicate the identifier of the UE stored UP-PRUK.
The UP-PRUK ID value consists of two fields:
a) UP-PRUK ID format field which is the 1st character of the UP-PRUK ID value:
an ASCII character, as defined in IETF RFC 20 [40], coded in table 11.6.2.5.1;
and
Table 11.6.2.3.1: UP-PRUK ID format
ASCII character \"0\" Reserved
* * *
ASCII character \"1\" NAI ASCII character \"2\" 64-bit string other ASCII
characters unused
b) UP-PRUK ID field which is 2nd and later characters of the UP-PRUK ID value:
1) if the UP-PRUK ID format field indicates \"NAI\", the UP-PRUK ID field is a
UP-PRUK ID in the NAI format as defined in clause 28.7.10 of 3GPP TS 23.003
[12], encoded as UTF-8 string; or
2) if the UP-PRUK ID format field indicates \"64-bit string\", the UP-PRUK ID
field is a 64-bit string, encoded using 16 hexadecimal digits, each digit
indicated by an ASCII character \"0\" - \"9\" or \"A\" - \"F\", as defined in
IETF RFC 20 [40].
#### 11.6.2.4 PC5 UE security capabilities
See clause 11.4.2.50.
#### 11.6.2.5 MCC
This parameter is used to indicate the MCC as specified in Annex A of ITU-T
Recommendation E.212 [27].
#### 11.6.2.6 MNC
The coding of this parameter is responsibility of each administration. If MNC
consists of 2 digits, MNC value is between 10 and 99.
#### 11.6.2.7 Current time
See clause 11.4.2.16.
#### 11.6.2.8 Max offset
See clause 11.4.2.17.
#### 11.6.2.9 Expiration timer
This parameter is used to indicate the expiration timer of the 5G ProSe UE-to-
network relay discovery security parameters for 5G ProSe remote UE or the
expiration timer of the 5G ProSe UE-to-network relay discovery security
parameters for 5G ProSe UE-to-network relay UE.
It is an integer in the 1-525600 (decimal) range representing the timer value
in unit of minutes.
#### 11.6.2.10 Relay service code
This parameter is used to indicate a connectivity service the UE-to-Network
relay provides.
It is an integer in the 0 to 16777215 (decimal) range.
#### 11.6.2.11 Selected PC5 ciphering algorithm
See clause 11.4.2.51.
#### 11.6.2.12 DUSK
This parameter is used to provide DUSK as specified in 3GPP TS 33.503 [34].
#### 11.6.2.13 DUIK
This parameter is used to provide DUIK as specified in 3GPP TS 33.503 [34].
#### 11.6.2.14 DUCK
This parameter is used to provide DUCK as specified in 3GPP TS 33.503 [34].
#### 11.6.2.15 Encrypted bitmask
This parameter is used to provide encrypted_bits_mask associated with a DUCK
as specified in 3GPP TS 33.503 [34].
#### 11.6.2.16 GPI
This parameter is used to indicate the GPI encoded as specified in clause
5.3.5 in 3GPP TS 33.223 [44].
#### 11.6.2.17 Signalling ciphering policy
This parameter is used to indicate the signalling ciphering policy. The
parameter is encoded as the signalling ciphering policy field as specified in
the table 11.3.12.1, with values in the 0 to 7 range.
#### 11.6.2.18 User plane integrity protection policy
This parameter is used to indicate the user plane integrity protection policy.
The parameter is encoded as the user plane integrity protection policy field
as specified in the table 11.3.23.1, with values in the 0 to 7 range.
#### 11.6.2.19 User plane ciphering policy
This parameter is used to indicate the user plane ciphering policy. The
parameter is encoded as the user plane ciphering policy field as specified in
the table 11.3.23.1, with values in the 0 to 7 range.
#### 11.6.2.20 PC8 control protocol cause value
This parameter is used to indicate the particular reason why a
PROSE_SECURITY_PARAM_REQUEST, PROSE_PRUK_REQUEST or PROSE_KEY_REQUEST message
from the UE has been rejected by the 5G PKMF. It is an integer in the 0-255
range encoded in table 11.6.2.20.1.
Table 11.6.2.20.1: PC8 control protocol cause value
0 Reserved
* * *
3 UE authorization failure 1, 2, 4-255 Unused
#### 11.6.2.21 SUCI
This parameter is used to indicate the SUCI of the 5G ProSe remote UE in NAI
format as specified in 3GPP TS 23.003 [12].
#### 11.6.2.22 K~NRP~ freshness parameter 1
This parameter is used to indicate 128-bit long K~NRP~ freshness parameter 1
as specified in 3GPP TS 33.503 [34].
#### 11.6.2.23 AUTS
This parameter is used to provide 112-bit long information to begin a re-
synchronisation as specified in 3GPP TS 33.503 [34].
#### 11.6.2.24 RAND
This parameter is used to provide a 128-bit long non-predictable challenge as
specified in 3GPP TS 33.503 [34].
#### 11.6.2.25 K~NRP~
This parameter is used to provide a 256-bit K~NRP~ as specified in 3GPP TS
33.503 [34].
#### 11.6.2.26 K~NRP~ freshness parameter 2
This parameter is used to indicate 128-bit long K~NRP~ freshness parameter 2
as specified in 3GPP TS 33.503 [34].
## 11.7 Formats for messages transmitted over the PC3ach interface
### 11.7.1 Data types format in XML schema
To exchange structured information over the transport protocol, XML text
format/notation is introduced.
The corresponding XML data types for the data types used in 5G ProSe PC3ach
messages are provided in table 11.7.1.
Table 11.7.1: Primitive or derived types for 5G ProSe PC3ach Parameter Type
5G ProSe Parameter Type Type in XML Schema
* * *
Integer xs:integer String xs:string Boolean xs:boolean Binary xs:hexBinary Bit
string xs:hexBinary Time xs:dateTime
For complex data types described in clause 11.7.2, an XML \"complexType\" can
be used.
Message construction shall be compliant with W3C REC-xmlschema-2-20041028
[29].
### 11.7.2 Parameters in messages transmitted over the PC3ach interface
#### 11.7.2.1 Transaction ID
This parameter is used to uniquely identify a message transmitted over the
PC3ach interface when it is combined with another message transmitted over the
PC3ach interface in the same transport message. The UE shall set this
parameter to a new number for each outgoing new message which includes this
information element and is transmitted over the PC3ach interface. The
transaction ID is an integer in the 0-255 range.
#### 11.7.2.2 Sequence number
This parameter is used to indicate sequence number of the usage information
report. The sequence number is an integer in the 0-4294967295 range. The
sequence number is set to 0 on UE power up and is increased by 1 whenever a
new usage information report is created.
#### 11.7.2.3 In coverage
This parameter is used to indicate whether the UE was in NG-RAN coverage. It
is a Boolean value coded as follows:
True the UE is in NG-RAN coverage.
False the UE is out of NG-RAN coverage.
#### 11.7.2.4 NCGI
This parameter is used to indicate NG-RAN Cell Global Identification of the
NG-RAN cell where the UE was camping on or which the UE used in the 5GMM-
CONNECTED mode. The coding of NCGI is defined in 3GPP TS 23.003 [12].
#### 11.7.2.5 5G ProSe direct communication radio parameters
This parameter is used to indicate the radio parameters used for 5G ProSe
direct communication. Format of the value is according to the SL-
PreconfigurationNR-r16 ASN.1 data type described in 3GPP TS 38.331 [13].
#### 11.7.2.6 Cause value
This parameter is used to indicate the particular reason why the 5G DDNMF CTF
(ADF) rejects PROSE_USAGE_INFORMATION_REPORT_LIST message. It is an integer in
the 0-255 range encoded as follows:
0 Reserved
2 UE authorization failure
3 Invalid message format
10 Unable to process usage information report list
1, 4-9, 11-255 Unused
#### 11.7.2.7 Timestamp
This parameter is used to indicate time and date. The format of this parameter
follows the XML data type defined in table 11.7.1 for 5G ProSe PC3ach message
parameter type \"Time\".
#### 11.7.2.8 ProSe layer-2 group ID
This parameter is used to indicate a ProSe layer-2 group ID. The value of
ProSe layer-2 group ID is a 24-bit bit-string.
#### 11.7.2.9 5G ProSe Group IP multicast address
This parameter is used to indicate a 5G ProSe Group IP multicast address. If
the IP address is an IPv4 address, its value is coded as a string representing
the dotted-decimal format of the IPv4 address as specified in IETF RFC 1166
[48]. If the IP address is an IPv6 address, its value is coded as a string
representing the canonical text representation format of the IPv6 address as
specified in IETF RFC 5952 [49].
#### 11.7.2.10 UE IP address
This parameter is used to indicate an IP address used by the UE as a source
address. If the IP address is an IPv4 address, its value is coded as a string
representing the dotted-decimal format of the IPv4 address as specified in
IETF RFC 1166 [48]. If the IP address is an IPv6 address, its value is coded
as a string representing the canonical text representation format of the IPv6
address as specified in IETF RFC 5952 [49].
#### 11.7.2.11 UE layer-2 ID
This parameter is used to indicate the layer-2 ID used by the UE. The value of
UE layer-2 ID is a 24-bit bit-string.
#### 11.7.2.12 Data amount
This parameter is used to indicate the amount of transmitted or received data
in octets. The value of this parameter is coded as an integer.
#### 11.7.2.13 Radio resources indicator
This parameter is used to indicate whether the operator-provided radio
resources or the configured radio resources were used for 5G ProSe direct
communication.
It is an integer in the 0-255 range encoded as follows:
0 Reserved
1 the operator-provided radio resources
2 the configured radio resources
3-255 Unused
#### 11.7.2.14 Radio frequency
This parameter is used to indicate the radio frequency used for 5G ProSe
direct communication.
Format of the value is according to the ARFCN-ValueNR ASN.1 data type
described in 3GPP TS 38.331 [13].
#### 11.7.2.15 PC5 QoS flow identifier
This parameter is used to indicate the PC5 QoS flow identifier used to
identify the QoS flow for 5G ProSe direct communication. It is coded as
specified in Table 11.3.5.1.
#### 11.7.2.16 PQI
This parameter is used to indicate the PQI of PC5 QoS flow used for 5G ProSe
direct communication. It is coded as specified in Table 11.3.5.1.
#### 11.7.2.17 GFBR
This parameter is used to indicate the guaranteed flow bit rate (GFBR) of PC5
QoS flow used for 5G ProSe direct communication. It is coded as specified in
Table 11.3.5.1.
#### 11.7.2.18 MFBR
This parameter is used to indicate the maximum flow bit rate (MFBR) of PC5 QoS
flow used for 5G ProSe direct communication. It is coded as specified in Table
11.3.5.1.
#### 11.7.2.19 Averaging window
This parameter is used to indicate the averaging window of PC5 QoS flow used
for 5G ProSe direct communication. It is coded as specified in Table 11.3.5.1.
#### 11.7.2.20 Resource type
This parameter is used to indicate the resource type of PC5 QoS flow used for
5G ProSe direct communication. It is coded as specified in Table 11.3.5.1.
#### 11.7.2.21 Default priority level
This parameter is used to indicate the default priority level of PC5 QoS flow
used for 5G ProSe direct communication. It is coded as specified in Table
11.3.5.1.
#### 11.7.2.22 Packet delay budget
This parameter is used to indicate the packet delay budget of PC5 QoS flow
used for 5G ProSe direct communication. It is coded as specified in Table
11.3.5.1.
#### 11.7.2.23 Packet error rate
This parameter is used to indicate the packet error rate of PC5 QoS flow used
for 5G ProSe direct communication. It is coded as specified in Table 11.3.5.1.
#### 11.7.2.24 Default maximum data burst volume
This parameter is used to indicate the default maximum data burst volume of
PC5 QoS flow used for 5G ProSe direct communication. It is coded as specified
in Table 11.3.5.1.
# 12 List of system parameters
## 12.1 Overview
The description of timers in the following tables should be considered a brief
summary. The precise details are found in clauses 4 to 8, which should be
considered the definitive descriptions.
## 12.2 Timers of provisioning of parameters for 5G ProSe configuration
procedures
Timers of provisioning of parameters for 5G ProSe configuration are shown in
table 12.2.1.
NOTE: Timer T5040 is defined in 3GPP TS 24.587 [18].
Table 12.2.1: Timers of provisioning of parameters for 5G ProSe configuration
-- UE side
+-------------+-------------+-------------+-------------+-------------+ | TIMER NUM. | TIMER VALUE | CAUSE OF | NORMAL STOP | ON\ | | | | START | | EXPIRY | +=============+=============+=============+=============+=============+ | T5051 | Validity | Start using | Stop using | Initiate | | | timer value | the new UE | the old UE | the | | | for UE | policies | policies | U | | | policies | for 5G | for 5G | E-requested | | | for 5G | ProSe | ProSe | ProSeP | | | ProSe | direct | direct | p | | | direct | discovery | discovery | rovisioning | | | discovery | received in | | procedure | | | over PC5 | MANAGE UE | | | | | (see | POLICY | | (NOTE 1) | | | c | COMMAND | | | | | lause 5.2), | message | | | | | which is | | | | | | specified | | | | | | in | | | | | | 3GPP TS 24 | | | | | | .555 [17] | | | | | | clause 5.3. | | | | +-------------+-------------+-------------+-------------+-------------+ | T5052 | Validity | Start using | Stop using | Initiate | | | timer value | the new UE | the old UE | the | | | for UE | policies | policies | U | | | policies | for 5G | for 5G | E-requested | | | for 5G | ProSe | ProSe | ProSeP | | | ProSe | direct | direct | p | | | direct | com | com | rovisioning | | | co | munications | munications | procedure | | | mmunication | received in | | | | | over PC5 | MANAGE UE | | (NOTE 1) | | | (see | POLICY | | | | | c | COMMAND | | | | | lause 5.2), | message | | | | | which is | | | | | | specified | | | | | | in | | | | | | 3GPP TS 24 | | | | | | .555 [17] | | | | | | clause 5.4. | | | | +-------------+-------------+-------------+-------------+-------------+ | T5053 | Validity | Start using | Stop using | Initiate | | | timer value | the new UE | the old UE | the | | | for UE | policies | policies | U | | | policies | for 5G | for 5G | E-requested | | | for 5G | ProSe | ProSe | ProSeP | | | ProSe | UE | UE | p | | | UE | -to-network | -to-network | rovisioning | | | -to-network | relay UE | relay UE | procedure | | | relay UE | received in | | | | | (see | MANAGE UE | | (NOTE 1) | | | c | POLICY | | | | | lause 5.2), | COMMAND | | | | | which is | message | | | | | specified | | | | | | in | | | | | | 3GPP TS 24 | | | | | | .555 [17] | | | | | | clause 5.5. | | | | +-------------+-------------+-------------+-------------+-------------+ | T5054 | Validity | Start using | Stop using | Initiate | | | timer value | the new UE | the old UE | the | | | for UE | policies | policies | U | | | policies | for 5G | for 5G | E-requested | | | for 5G | ProSe | ProSe | ProSeP | | | ProSe | Remote UE | Remote UE | p | | | remote UE | received in | | rovisioning | | | (see | MANAGE UE | | procedure | | | c | POLICY | | | | | lause 5.2), | COMMAND | | (NOTE 1) | | | which is | message | | | | | specified | | | | | | in | | | | | | 3GPP TS 24 | | | | | | .555 [17] | | | | | | clause 5.6. | | | | +-------------+-------------+-------------+-------------+-------------+ | T5055 | Validity | Start using | Stop using | Consider | | | timer value | the | the | the | | | for the | security | security | existing | | | security | related | related | configured | | | related | parameters | parameters | security | | | parameters | for | for | related | | | at the 5G | discovery | discovery | parameters | | | ProSe | in the new | in the old | for | | | UE | UE policies | UE policies | discovery | | | -to-network | for 5G | for 5G | as invalid | | | relay UE, | ProSe | ProSe | | | | used for | UE | UE | | | | UE | -to-network | -to-network | | | | -to-network | relay UE | relay UE | | | | relay | received in | | | | | discovery | MANAGE UE | | | | | when the | POLICY | | | | | security | COMMAND | | | | | procedure | message | | | | | over | | | | | | control | | | | | | plane as | | | | | | specified | | | | | | in | | | | | | 3GPP TS 33 | | | | | | .503 [34] | | | | | | is used | | | | | | (see | | | | | | c | | | | | | lause 5.2), | | | | | | which is | | | | | | specified | | | | | | in | | | | | | 3GPP TS 24 | | | | | | .555 [17] | | | | | | clause 5.5. | | | | +-------------+-------------+-------------+-------------+-------------+ | T5056 | Validity | Start using | Stop using | Consider | | | timer value | the | the | the | | | for the | security | security | existing | | | security | related | related | configured | | | related | parameters | parameters | security | | | parameters | for | for | related | | | at the 5G | discovery | discovery | parameters | | | ProSe | in the new | in the old | for | | | remote UE, | UE policies | UE policies | discovery | | | used for | for 5G | for 5G | as invalid | | | UE | ProSe | ProSe | | | | -to-network | remote UE | remote UE | | | | relay | received in | | | | | discovery | MANAGE UE | | | | | when the | POLICY | | | | | security | COMMAND | | | | | procedure | message | | | | | over | | | | | | control | | | | | | plane as | | | | | | specified | | | | | | in | | | | | | 3GPP TS 33 | | | | | | .503 [34] | | | | | | is used | | | | | | (see | | | | | | c | | | | | | lause 5.2), | | | | | | which is | | | | | | specified | | | | | | in | | | | | | 3GPP TS 24 | | | | | | .555 [17] | | | | | | clause 5.6. | | | | +-------------+-------------+-------------+-------------+-------------+ | T5057 | Validity | Start using | Stop using | Initiate | | | timer value | the new UE | the old UE | the | | | for UE | policies | policies | U | | | policies | for 5G | for 5G | E-requested | | | for 5G | ProSe usage | ProSe usage | ProSeP | | | ProSe usage | information | information | p | | | information | reporting | reporting | rovisioning | | | reporting | received in | | procedure | | | (see | MANAGE UE | | | | | c | POLICY | | (NOTE 1) | | | lause 5.2), | COMMAND | | | | | which is | message | | | | | specified | | | | | | in | | | | | | 3GPP TS 24 | | | | | | .555 [17] | | | | | | clause 5.7. | | | | +-------------+-------------+-------------+-------------+-------------+ | NOTE 1: The | | | | | | timers | | | | | | expire only | | | | | | once. | | | | | +-------------+-------------+-------------+-------------+-------------+
## 12.3 Timers of 5G ProSe direct link management procedures
NOTE: Timer T3346 is defined in 3GPP TS 24.008 [31].
Table 12.3.1: 5G ProSe direct link management timers
+-------------+-------------+-------------+-------------+-------------+ | TIMER NUM. | TIMER VALUE | CAUSE OF | NORMAL STOP | ON\ | | | | START | | EXPIRY | +=============+=============+=============+=============+=============+ | T5080 | 8s | Upon | Upon | Ret | | | | sending a | receiving a | ransmission | | | NOTE 1 | PROSE | PROSE | of PROSE | | | | DIRECT LINK | DIRECT LINK | DIRECT LINK | | | | ES | ES | ES | | | | TABLISHMENT | TABLISHMENT | TABLISHMENT | | | | REQUEST | ACCEPT or | REQUEST | | | | message | PROSE | message if | | | | | DIRECT LINK | the Target | | | | | ES | user info | | | | | TABLISHMENT | is included | | | | | REJECT | in the | | | | | message | PROSE | | | | | from the | DIRECT LINK | | | | | target UE | ES | | | | | if the | TABLISHMENT | | | | | Target user | REQUEST | | | | | info is | message; or | | | | | included in | | | | | | the PROSE | may abort | | | | | DIRECT LINK | the ongoing | | | | | ES | procedure | | | | | TABLISHMENT | if the | | | | | REQUEST | Target user | | | | | message | info is not | | | | | | included in | | | | | | the PROSE | | | | | | DIRECT LINK | | | | | | ES | | | | | | TABLISHMENT | | | | | | REQUEST | | | | | | message | +-------------+-------------+-------------+-------------+-------------+ | T5081 | 5s | Upon | Upon | Ret | | | | sending a | receiving a | ransmission | | | | PROSE | PROSE | of PROSE | | | | DIRECT LINK | DIRECT LINK | DIRECT LINK | | | | M | M | M | | | | ODIFICATION | ODIFICATION | ODIFICATION | | | | REQUEST | ACCEPT or | REQUEST | | | | message | PROSE | message | | | | | DIRECT LINK | | | | | | M | | | | | | ODIFICATION | | | | | | REJECT or | | | | | | PROSE | | | | | | DIRECT LINK | | | | | | RELEASE | | | | | | REQUEST | | | | | | message | | | | | | from the | | | | | | target UE | | +-------------+-------------+-------------+-------------+-------------+ | T5082 | 2s | Upon | Upon | Ret | | | | sending a | receiving a | ransmission | | | | PROSE | PROSE | of the | | | | DIRECT LINK | DIRECT LINK | PROSE | | | | IDENTIFIER | IDENTIFIER | DIRECT LINK | | | | UPDATE | UPDATE | IDENTIFIER | | | | REQUEST | ACCEPT or | UPDATE | | | | message | PROSE | REQUEST | | | | | DIRECT LINK | message | | | | | IDENTIFIER | | | | | | UPDATE | | | | | | REJECT or | | | | | | PROSE | | | | | | DIRECT LINK | | | | | | RELEASE | | | | | | REQUEST | | | | | | message | | | | | | from the | | | | | | target UE | | +-------------+-------------+-------------+-------------+-------------+ | T5083 | 2s | Upon | Upon | Ret | | | | sending a | receiving a | ransmission | | | | PROSE | PROSE | of the | | | | DIRECT LINK | DIRECT LINK | PROSE | | | | IDENTIFIER | IDENTIFIER | DIRECT LINK | | | | UPDATE | UPDATE ACK | IDENTIFIER | | | | ACCEPT | message or | UPDATE | | | | message | PROSE | ACCEPT | | | | | DIRECT LINK | message | | | | | RELEASE | | | | | | REQUEST | | | | | | message | | | | | | from the | | | | | | initiating | | | | | | UE | | +-------------+-------------+-------------+-------------+-------------+ | T5084 | 5s | Upon | Upon 5G | Initiate | | | | receiving a | ProSe | the 5G | | | | PC5 | direct link | ProSe | | | | signalling | release or | direct link | | | | message or | upon | keep-alive | | | | PC5 user | initiating | procedure | | | | plane data | the 5G | | | | | | ProSe | | | | | | direct link | | | | | | keep-alive | | | | | | procedure | | +-------------+-------------+-------------+-------------+-------------+ | T5085 | 5s | Upon | Upon | Ret | | | | sending a | receiving a | ransmission | | | | PROSE | PC5 | of the | | | | DIRECT LINK | signalling | PROSE | | | | KEEPALIVE | message or | DIRECT LINK | | | | REQUEST | PC5 user | KEEPALIVE | | | | message | plane data | REQUEST | | | | | | message | +-------------+-------------+-------------+-------------+-------------+ | T5086 | Default 10m | Upon | Upon | Either | | | | receiving a | receiving a | initiate | | | NOTE 2 | Maximum | PC5 | the 5G | | | | inactivity | signalling | ProSe | | | | period in a | message or | direct link | | | | PROSE | PC5 user | keep-alive | | | | DIRECT LINK | plane data | procedure | | | | KEEPALIVE | | or the 5G | | | | REQUEST | | ProSe | | | | message, | | direct link | | | | receiving a | | release | | | | PC5 | | procedure | | | | signalling | | | | | | message or | | | | | | receiving | | | | | | PC5 user | | | | | | plane data | | | +-------------+-------------+-------------+-------------+-------------+ | T5087 | 5s | Upon | Upon | Ret | | | | sending a | receiving a | ransmission | | | | PROSE | PROSE | of PROSE | | | | DIRECT LINK | DIRECT LINK | DIRECT LINK | | | | RELEASE | RELEASE | RELEASE | | | | REQUEST | ACCEPT | REQUEST | | | | message | message | message | | | | | from the | | | | | | target UE | | +-------------+-------------+-------------+-------------+-------------+ | T5088 | As | Upon | Upon | Take the | | | described | receiving a | receiving | peer UE | | | in | PROSE | PROSE PC5 | onboard for | | | cla | DIRECT LINK | DISCOVERY | UE | | | use 7.2.2.5 | ES | message | -to-network | | | and | TABLISHMENT | from the | relay UE | | | cla | REJECT | same | discovery | | | use 7.2.6.3 | message | UE | and | | | | with PC5 | -to-network | selection | | | | signalling | relay UE | | | | | protocol | due to | | | | | cause value | starting | | | | | set to #13 | announcing | | | | | \ | UE | | | | | "congestion | procedure | | | | | situation\" | or | | | | | and a | discoveree | | | | | back-off | UE | | | | | timer value | procedure | | | | | is provided | as | | | | | in the | described | | | | | message | in | | | | | | clause | | | | | Upon | 8.2.1.2.1.2 | | | | | receiving a | and | | | | | PROSE | clause | | | | | DIRECT LINK | 8.2.1.3.2.2 | | | | | RELEASE | r | | | | | REQUEST | espectively | | | | | message | | | | | | with PC5 | | | | | | signalling | | | | | | protocol | | | | | | cause value | | | | | | set to #13 | | | | | | \ | | | | | | "congestion | | | | | | situation\" | | | | | | and a | | | | | | back-off | | | | | | timer value | | | | | | is provided | | | | | | in the | | | | | | message | | | +-------------+-------------+-------------+-------------+-------------+ | T5089 | 2s | Upon | Upon | Ret | | | | sending a | receiving a | ransmission | | | | PROSE | PROSE | of PROSE | | | | DIRECT LINK | DIRECT LINK | DIRECT LINK | | | | SECURITY | SECURITY | SECURITY | | | | MODE | MODE | MODE | | | | COMMAND | COMPLETE or | COMMAND | | | | message | PROSE | message | | | | | DIRECT LINK | | | | | | SECURITY | | | | | | MODE REJECT | | | | | | message | | | | | | from the | | | | | | target UE | | +-------------+-------------+-------------+-------------+-------------+ | T5090 | NOTE 2 | Upon | Upon | T | | | | e | completing | ransmission | | | | stablishing | a 5G ProSe | of PROSE | | | | a 5G ProSe | direct link | DIRECT LINK | | | | direct link | identifier | IDENTIFIER | | | | and | update or | UPDATE | | | | satisfying | | REQUEST | | | | the privacy | upon | message | | | | requirement | accepting a | | | | | for 5G | PROSE | | | | | UE | DIRECT LINK | | | | | -to-network | IDENTIFIER | | | | | relay or at | UPDATE | | | | | least one | REQUEST | | | | | of ProSe | message or | | | | | identifiers | | | | | | for the 5G | upon a 5G | | | | | ProSe | ProSe | | | | | direct link | direct link | | | | | satisfying | release | | | | | the privacy | | | | | | r | | | | | | equirements | | | | | | or | | | | | | | | | | | | upon | | | | | | completing | | | | | | the 5G | | | | | | ProSe | | | | | | direct link | | | | | | identifier | | | | | | update | | | | | | procedure | | | +-------------+-------------+-------------+-------------+-------------+ | T5091 | 8s | Upon | Upon | Ret | | | | sending a | receiving a | ransmission | | | | PROSE | PROSE | of PROSE | | | | DIRECT LINK | DIRECT LINK | DIRECT LINK | | | | REKEYING | REKEYING | REKEYING | | | | REQUEST | RESPONSE | REQUEST | | | | message | message or | message | | | | | PROSE | | | | | | DIRECT LINK | | | | | | RELEASE | | | | | | REQUEST | | | | | | message | | | | | | from the | | | | | | target UE | | +-------------+-------------+-------------+-------------+-------------+ | T5092 | 2s | Upon | Upon | Ret | | | | sending a | receiving a | ransmission | | | | PROSE | PROSE | of PROSE | | | | DIRECT LINK | DIRECT LINK | DIRECT LINK | | | | AUT | AUT | AUT | | | | HENTICATION | HENTICATION | HENTICATION | | | | REQUEST | RESPONSE or | REQUEST | | | | message | DIRECT LINK | message | | | | | AUT | | | | | | HENTICATION | | | | | | REJECT | | | | | | message | | | | | | from the | | | | | | target UE | | +-------------+-------------+-------------+-------------+-------------+ | T5093 | 2s | Upon | Upon | Ret | | | | sending a | receiving a | ransmission | | | | PROSE AA | PROSE AA | of PROSE AA | | | | MESSAGE | MESSAGE | MESSAGE | | | | TRANSPORT | TRANSPORT | TRANSPORT | | | | REQUEST | RESPONSE | REQUEST | | | | message | message | message | | | | | from the | | | | | | target UE | | +-------------+-------------+-------------+-------------+-------------+ | NOTE 1: If | | | | | | the Target | | | | | | user info | | | | | | is not | | | | | | included in | | | | | | the PROSE | | | | | | DIRECT LINK | | | | | | ES | | | | | | TABLISHMENT | | | | | | REQUEST | | | | | | message, | | | | | | then the | | | | | | initiating | | | | | | UE may keep | | | | | | the timer | | | | | | T5080 | | | | | | running | | | | | | upon | | | | | | receiving | | | | | | PROSE | | | | | | DIRECT LINK | | | | | | ES | | | | | | TABLISHMENT | | | | | | ACCEPT | | | | | | message. | | | | | | | | | | | | NOTE 2: The | | | | | | value of | | | | | | this timer | | | | | | is the | | | | | | privacy | | | | | | timer value | | | | | | which is | | | | | | one of the | | | | | | co | | | | | | nfiguration | | | | | | parameters | | | | | | for 5G | | | | | | ProSe | | | | | | direct | | | | | | co | | | | | | mmunication | | | | | | (see | | | | | | c | | | | | | lause 5.2.4 | | | | | | and | | | | | | cl | | | | | | ause 5.2.5) | | | | | | and it is | | | | | | specified | | | | | | in | | | | | | 3GPP TS 24 | | | | | | .555 [17] | | | | | | clause 5.4, | | | | | | clause 5.5 | | | | | | and | | | | | | clause 5.6. | | | | | +-------------+-------------+-------------+-------------+-------------+
## 12.4 Timers of 5G ProSe direct discovery procedures over PC3a
Table 12.4.1: Timers of 5G ProSe direct discovery procedures over PC3a \-- UE
side
+-------------+-------------+-------------+-------------+-------------+ | TIMER NUM. | TIMER VALUE | CAUSE OF | NORMAL STOP | ON\ | | | | START | | EXPIRY | +=============+=============+=============+=============+=============+ | T5060 | NOTE 1 | Upon | Upon | Stop | | | | receiving a | receiving a | announcing | | | | ProSe | new T5060 | the | | | | application | timer value | associated | | | | code with | for the | ProSe | | | | an | same ProSe | application | | | | associated | application | code over | | | | T5060 timer | code or | the PC5 | | | | in a | receiving a | interface | | | | DISCOVER | new Timer | and | | | | Y_RESPONSE | associated | re-initiate | | | | message | with a new | the | | | | whose | ProSe | announce | | | | transaction | application | request | | | | ID | code for | procedure | | | | contained | the same | if the | | | | in the | ProSe | request | | | | \ | ID in a | layers to | | | | element | DISCOVER | announce | | | | matches the | Y_RESPONSE | the ProSe | | | | value sent | message. | application | | | | by the UE | | ID | | | | in a | When the UE | co | | | | DISCOVE | selects a | rresponding | | | | RY_REQUEST | new PLMN. | to the | | | | message | | associated | | | | with the | Upon | ProSe | | | | command set | receiving a | application | | | | to | \ | place. | | | | as | element in | | | | | described | a | | | | | in | DISC | | | | | clau | OVERY_UPDA | | | | | se 6.2.2.4. | TE_REQUEST | | | | | | message and | | | | | Upon | the | | | | | receiving a | discovery | | | | | ProSe | entry ID in | | | | | application | the | | | | | code with | \ | | | | | T5060 timer | element is | | | | | in the | known, as | | | | | Update info | described | | | | | in the | in | | | | | \ | | | | | | element in | | | | | | a | | | | | | DISC | | | | | | OVERY_UPDA | | | | | | TE_REQUEST | | | | | | message and | | | | | | the | | | | | | discovery | | | | | | entry ID in | | | | | | the | | | | | | \ | | | | | | element is | | | | | | known, as | | | | | | described | | | | | | in | | | | | | claus | | | | | | e 6.2.11.3. | | | +-------------+-------------+-------------+-------------+-------------+ | T5062 | NOTE 2 | Upon | Upon | Stop | | | | receiving a | receiving a | announcing | | | | ProSe | new T5062 | the | | | | restricted | timer value | associated | | | | code or | for the | ProSe | | | | ProSe | same ProSe | restricted | | | | restricted | restricted | code over | | | | code prefix | code or | the PC5 | | | | with an | ProSe | interface | | | | associated | restricted | if the | | | | T5062 timer | code | ProSe | | | | in a | prefix, or | restricted | | | | DISCOVER | upon | code is | | | | Y_RESPONSE | receiving a | already | | | | message | new T5062 | allocated; | | | | whose | timer | and | | | | transaction | associated | re-initiate | | | | ID | with a new | the | | | | contained | ProSe | announce | | | | in the | restricted | request | | | | \ | restricted | request | | | | element | code prefix | from upper | | | | matches the | for the | layers to | | | | value sent | same RPAUID | announce | | | | by the UE | in a | the RPAUID | | | | in a | DISCOVER | co | | | | DISCOVE | Y_RESPONSE | rresponding | | | | RY_REQUEST | message. | to the | | | | message | | associated | | | | with the | When the UE | ProSe | | | | command set | selects a | restricted | | | | to | new PLMN. | code is | | | | \ | | still in | | | | "announce\" | Upon | place. | | | | and the | receiving a | | | | | discovery | ProSe | | | | | type set to | restricted | | | | | \"Restrict | code with | | | | | d | an | | | | | iscovery\", | associated | | | | | as | T5062 timer | | | | | described | in the | | | | | in | Update info | | | | | clau | in the | | | | | se 6.2.3.4. | \ | | | | | receiving a | element in | | | | | ProSe | a | | | | | restricted | DISC | | | | | code with | OVERY_UPDA | | | | | an | TE_REQUEST | | | | | associated | message and | | | | | T5062 timer | the | | | | | in the | discovery | | | | | Update info | entry ID in | | | | | in the | the | | | | | \ | e-request> | | | | | element in | element is | | | | | a | known, as | | | | | DISC | described | | | | | OVERY_UPDA | in | | | | | TE_REQUEST | clause | | | | | message and | 6.2.12.3.2. | | | | | the | | | | | | discovery | | | | | | entry ID in | | | | | | the | | | | | | \ | | | | | | element is | | | | | | known, as | | | | | | described | | | | | | in | | | | | | clause | | | | | | 6.2.12.3.2. | | | +-------------+-------------+-------------+-------------+-------------+ | T5064 | NOTE 3 | Upon | Upon | Stop using | | | | receiving a | receiving a | the | | | | discovery | new T5064 | associated | | | | filter with | timer value | discovery | | | | an | for the | filter for | | | | associated | same | ProSe | | | | T5064 timer | discovery | direct | | | | in a | filter in a | discovery | | | | DISCOVER | DISCOVER | monitoring | | | | Y_RESPONSE | Y_RESPONSE | over the | | | | message | message. | PC5 | | | | whose | | interface | | | | transaction | Upon | and | | | | ID | receiving a | re-initiate | | | | contained | \ | procedure, | | | | e-monitor> | element in | if the | | | | element | a | request | | | | matches the | DISC | from upper | | | | value sent | OVERY_UPDA | layers to | | | | by the UE | TE_REQUEST | monitor the | | | | in a | message and | ProSe | | | | DISCOVE | the | application | | | | RY_REQUEST | discovery | ID | | | | message | entry ID in | co | | | | with the | the | rresponding | | | | command set | \ | discovery | | | | "monitor\", | element is | filter is | | | | as | known, as | still in | | | | described | described | place. | | | | in | in | | | | | clau | claus | | | | | se 6.2.4.4. | e 6.2.11.3. | | | | | | | | | | | Upon | | | | | | receiving a | | | | | | discovery | | | | | | filter in | | | | | | the Update | | | | | | info in the | | | | | | \ | | | | | | element in | | | | | | a | | | | | | DISC | | | | | | OVERY_UPDA | | | | | | TE_REQUEST | | | | | | message and | | | | | | the | | | | | | discovery | | | | | | entry ID in | | | | | | the | | | | | | \ | | | | | | element is | | | | | | known, as | | | | | | described | | | | | | in | | | | | | claus | | | | | | e 6.2.11.3. | | | +-------------+-------------+-------------+-------------+-------------+ | T5066 | NOTE 4 | Upon | Upon | Stop using | | | | receiving a | receiving | the | | | | Restricted | one or more | associated | | | | discovery | new T5066 | Restricted | | | | filter with | timer | discovery | | | | an | values for | filter for | | | | associated | the same | restricted | | | | T5066 timer | discovery | 5G ProSe | | | | in a | entry in a | direct | | | | DISCOVER | DISCOVER | discovery | | | | Y_RESPONSE | Y_RESPONSE | monitoring | | | | message | message. | over the | | | | whose | | PC5 | | | | transaction | Upon | interface | | | | ID | receiving a | and | | | | contained | Restricted | re-initiate | | | | in the | discovery | the monitor | | | | \ | info in the | if the | | | | element | \ | layers to | | | | by the UE | element in | monitor the | | | | in a | a | co | | | | DISCOVE | DISC | rresponding | | | | RY_REQUEST | OVERY_UPDA | discovery | | | | message | TE_REQUEST | target is | | | | with the | message and | still in | | | | command set | the | place. | | | | to | discovery | | | | | \"monitor\" | entry ID in | | | | | and the | the | | | | | discovery | \ | | | | | d | element is | | | | | iscovery\", | known, as | | | | | as | described | | | | | described | in | | | | | in | clause | | | | | clau | 6.2.12.3.2. | | | | | se 6.2.5.4. | | | | | | | | | | | | Upon | | | | | | receiving a | | | | | | Restricted | | | | | | discovery | | | | | | filter in | | | | | | the Update | | | | | | info in the | | | | | | \ | | | | | | element in | | | | | | a | | | | | | DISC | | | | | | OVERY_UPDA | | | | | | TE_REQUEST | | | | | | message and | | | | | | the | | | | | | discovery | | | | | | entry ID in | | | | | | the | | | | | | \ | | | | | | element is | | | | | | known, as | | | | | | described | | | | | | in | | | | | | clause | | | | | | 6.2.12.3.2. | | | +-------------+-------------+-------------+-------------+-------------+ | T5068 | NOTE 5 | Upon | Upon | Stop | | | | receiving a | receiving a | announcing | | | | ProSe | new T5068 | the | | | | response | timer value | associated | | | | code and | for the | ProSe | | | | discovery | same | response | | | | query | discovery | code or | | | | filters | entry in a | monitoring | | | | with an | DISCOVER | with the | | | | associated | Y_RESPONSE | associated | | | | T5068 timer | message. | discovery | | | | in a | | query | | | | DISCOVER | When the UE | filter(s) | | | | Y_RESPONSE | selects a | over the | | | | message | new PLMN. | PC5 | | | | whose | | interface | | | | transaction | | and | | | | ID | | re-initiate | | | | contained | | the | | | | in the \ element | | request | | | | matches the | | from upper | | | | value sent | | layers to | | | | by the UE | | announce | | | | in a | | the RPAUID | | | | DISCOVE | | in Model B | | | | RY_REQUEST | | is still in | | | | message | | place. | | | | with the | | | | | | command set | | | | | | to | | | | | | \ | | | | | | "response\" | | | | | | and the | | | | | | discovery | | | | | | type set to | | | | | | \"Restrict | | | | | | d | | | | | | iscovery\", | | | | | | as | | | | | | described | | | | | | in | | | | | | clau | | | | | | se 6.2.6.4. | | | +-------------+-------------+-------------+-------------+-------------+ | T5070 | NOTE 6 | Upon | Upon | Stop | | | | receiving a | receiving a | announcing | | | | ProSe query | new T5070 | the | | | | code and | timer value | associated | | | | discovery | for the | ProSe query | | | | response | same | code or | | | | filters | discovery | monitoring | | | | with an | entry in a | with the | | | | associated | DISCOVER | associated | | | | T5070 timer | Y_RESPONSE | discovery | | | | in a | message. | response | | | | DISCOVER | | filter(s) | | | | Y_RESPONSE | | over the | | | | message | | PC5 | | | | whose | | interface | | | | transaction | | and | | | | ID | | re-initiate | | | | contained | | the | | | | in the \ element | | request | | | | matches the | | from upper | | | | value sent | | layers to | | | | by the UE | | query for | | | | in a | | the same | | | | DISCOVE | | targets in | | | | RY_REQUEST | | Model B is | | | | message | | still in | | | | with the | | place. | | | | command set | | | | | | to | | | | | | \"query\" | | | | | | and the | | | | | | discovery | | | | | | type set to | | | | | | \"Restrict | | | | | | d | | | | | | iscovery\", | | | | | | as | | | | | | described | | | | | | in | | | | | | clau | | | | | | se 6.2.7.4. | | | +-------------+-------------+-------------+-------------+-------------+ | T5072 | NOTE 7 | Upon | Upon | The UE may | | | | receiving a | receiving a | inform the | | | | T5072 timer | new T5072 | upper | | | | in a | timer value | layers that | | | | MATCH_ | for the | the | | | | REPORT_ACK | same ProSe | co | | | | message | application | rresponding | | | | whose | code in a | ProSe | | | | transaction | MATCH_ | application | | | | ID | REPORT_ACK | ID is no | | | | contained | message. | longer | | | | in the | | matched. | | | | \ | receiving a | | | | | element | MATCH_ | | | | | matches the | REPORT_ACK | | | | | value sent | message | | | | | by the UE | with a | | | | | in a | \ | | | | | TCH_REPORT | element | | | | | message, as | containing | | | | | described | PC3a | | | | | in | control | | | | | clau | protocol | | | | | se 6.2.8.4. | cause value | | | | | | is #5. | | +-------------+-------------+-------------+-------------+-------------+ | T5074 | NOTE 7 | Upon | Upon | The UE | | | | receiving a | receiving a | needs to | | | | T5074 timer | new T5074 | | | | | in a | timer value | send a | | | | MATCH_ | for the | Match | | | | REPORT_ACK | same ProSe | Report on | | | | message | application | next | | | | whose | code in a | instance it | | | | transaction | MATCH_ | detects the | | | | ID | REPORT_ACK | co | | | | contained | message. | rresponding | | | | in the | | ProSe | | | | \ | co | code. | | | | element | rresponding | | | | | matches the | T5074 timer | | | | | value sent | for the | | | | | by the UE | ProSe | | | | | in a | application | | | | | MA | code is | | | | | TCH_REPORT | stopped or | | | | | message, as | expires. | | | | | described | | | | | | in | | | | | | clau | | | | | | se 6.2.8.4. | | | +-------------+-------------+-------------+-------------+-------------+ | T5076 | NOTE 8 | Upon | Upon | The UE may | | | | receiving a | receiving a | inform the | | | | T5076 timer | new T5076 | upper | | | | in a | timer value | layers that | | | | MATCH_ | for the | the | | | | REPORT_ACK | same ProSe | co | | | | message | restricted | rresponding | | | | whose | code or | RPAUID is | | | | transaction | ProSe | no longer | | | | ID | response | matched. | | | | contained | code in a | | | | | in the | MATCH_ | | | | | \ | | | | | | element | Upon | | | | | matches the | receiving a | | | | | value sent | MATCH_ | | | | | by the UE | REPORT_ACK | | | | | in a | message | | | | | MA | with a | | | | | TCH_REPORT | \ | | | | | described | element | | | | | in | containing | | | | | cla | PC3a | | | | | use 6.2.9.4 | control | | | | | or | protocol | | | | | 6.2.10.4. | cause value | | | | | | #5. | | +-------------+-------------+-------------+-------------+-------------+ | T5077 | NOTE 8 | Upon | Upon | The UE | | | | receiving a | receiving a | needs to | | | | T5077 timer | new T5077 | | | | | in a | timer value | send a | | | | MATCH_ | for the | Match | | | | REPORT_ACK | same ProSe | Report on | | | | message | restricted | next | | | | whose | code or | instance it | | | | transaction | ProSe | detects the | | | | ID | response | co | | | | contained | code in a | rresponding | | | | in the | MATCH_ | ProSe | | | | \ | | ProSe | | | | element | When the | response | | | | matches the | co | code. | | | | value sent | rresponding | | | | | by the UE | T5076 timer | | | | | in a | for the | | | | | MA | ProSe | | | | | TCH_REPORT | restricted | | | | | message, as | code or | | | | | described | ProSe | | | | | in | response | | | | | clau | code is | | | | | se 6.2.9.4. | stopped or | | | | | | expires. | | +-------------+-------------+-------------+-------------+-------------+ | NOTE 1: The | | | | | | value of | | | | | | this timer | | | | | | is provided | | | | | | by the 5G | | | | | | DDNMF | | | | | | during the | | | | | | announce | | | | | | request and | | | | | | discovery | | | | | | update | | | | | | procedure | | | | | | for open 5G | | | | | | ProSe | | | | | | direct | | | | | | discovery. | | | | | | | | | | | | NOTE 2: The | | | | | | value of | | | | | | this timer | | | | | | is provided | | | | | | by the 5G | | | | | | DDNMF | | | | | | during the | | | | | | announce | | | | | | request and | | | | | | discovery | | | | | | update | | | | | | procedure | | | | | | for | | | | | | restricted | | | | | | 5G ProSe | | | | | | direct | | | | | | discovery | | | | | | model A. | | | | | | | | | | | | NOTE 3: The | | | | | | value of | | | | | | this timer | | | | | | is provided | | | | | | by the 5G | | | | | | DDNMF | | | | | | during the | | | | | | monitor | | | | | | request and | | | | | | discovery | | | | | | update | | | | | | procedure | | | | | | for open 5G | | | | | | ProSe | | | | | | direct | | | | | | discovery. | | | | | | | | | | | | NOTE 4: The | | | | | | value of | | | | | | this timer | | | | | | is provided | | | | | | by the 5G | | | | | | DDNMF | | | | | | during the | | | | | | monitor | | | | | | request and | | | | | | discovery | | | | | | update | | | | | | procedure | | | | | | for | | | | | | restricted | | | | | | 5G ProSe | | | | | | direct | | | | | | discovery | | | | | | model A. | | | | | | | | | | | | NOTE 5: The | | | | | | value of | | | | | | this timer | | | | | | is assigned | | | | | | by the 5G | | | | | | DDNMF | | | | | | during the | | | | | | discoveree | | | | | | request | | | | | | procedure | | | | | | for | | | | | | restricted | | | | | | 5G ProSe | | | | | | direct | | | | | | discovery | | | | | | model B. | | | | | | | | | | | | NOTE 6: The | | | | | | value of | | | | | | this timer | | | | | | is assigned | | | | | | by the 5G | | | | | | DDNMF | | | | | | during the | | | | | | discoverer | | | | | | request | | | | | | procedure | | | | | | for | | | | | | restricted | | | | | | 5G ProSe | | | | | | direct | | | | | | discovery | | | | | | model B. | | | | | | | | | | | | NOTE 7: The | | | | | | value of | | | | | | this timer | | | | | | is provided | | | | | | by the 5G | | | | | | DDNMF | | | | | | during the | | | | | | match | | | | | | report | | | | | | procedure | | | | | | for open 5G | | | | | | ProSe | | | | | | direct | | | | | | discovery. | | | | | | | | | | | | NOTE 8: The | | | | | | value of | | | | | | this timer | | | | | | is provided | | | | | | by the 5G | | | | | | DDNMF | | | | | | during the | | | | | | match | | | | | | report | | | | | | procedure | | | | | | for | | | | | | restricted | | | | | | 5G ProSe | | | | | | direct | | | | | | discovery | | | | | | model A or | | | | | | match | | | | | | report | | | | | | procedure | | | | | | for | | | | | | restricted | | | | | | 5G ProSe | | | | | | direct | | | | | | discovery | | | | | | model B. | | | | | +-------------+-------------+-------------+-------------+-------------+
Table 12.4.2: Timers of 5G ProSe direct discovery procedures over PC3a \-- 5G
DDNMF side
+-------------+-------------+-------------+-------------+-------------+ | TIMER NUM. | TIMER VALUE | CAUSE OF | NORMAL STOP | ON\ | | | | START | | EXPIRY | +=============+=============+=============+=============+=============+ | T5061 | NOTE 1 | Upon | Upon | Delete the | | | | assigning a | receiving a | association | | | | ProSe | new | between the | | | | application | DISCOVE | UE, the | | | | code with | RY_REQUEST | requested | | | | an | message | ProSe | | | | associated | from the UE | application | | | | T5060 value | with the | ID and the | | | | to the UE, | command set | co | | | | as | to | rresponding | | | | described | \ | ProSe | | | | in | "announce\" | application | | | | cla | for the | code | | | | use 6.2.2.3 | same ProSe | allocated | | | | and | application | by the 5G | | | | claus | ID. | DDNMF. | | | | e 6.2.11.2. | | | +-------------+-------------+-------------+-------------+-------------+ | T5063 | NOTE 3 | Upon | Upon | Delete the | | | | assigning a | receiving a | association | | | | ProSe | new | between the | | | | restricted | DISCOVE | UE, the | | | | code or | RY_REQUEST | RPAUID and | | | | ProSe | message | the | | | | restricted | from the UE | co | | | | code prefix | with the | rresponding | | | | with an | command set | ProSe | | | | associated | to | restricted | | | | T5062 value | \ | code or | | | | to the UE, | "announce\" | ProSe | | | | as | for the | restricted | | | | described | same RPAUID | code prefix | | | | in | or | allocated | | | | cla | discovery | by the 5G | | | | use 6.2.3.3 | entry ID. | DDNMF. | | | | and | Set to be | | | | | clause | the same as | | | | | 6.2.12.3.1. | the | | | | | | discovery | | | | | | entry in | | | | | | which this | | | | | | timer is | | | | | | running. | | +-------------+-------------+-------------+-------------+-------------+ | T5065 | NOTE 2 | Upon | Upon | Delete the | | | | assigning a | receiving a | association | | | | discovery | new | between the | | | | filter with | DISCOVE | UE, the | | | | an | RY_REQUEST | requested | | | | associated | message | ProSe | | | | T5064 value | from the UE | application | | | | to the UE, | with the | ID and the | | | | as | command set | co | | | | described | to | rresponding | | | | in | \"monitor\" | discovery | | | | cla | for the | filter | | | | use 6.2.4.3 | same ProSe | allocated | | | | and | application | by the 5G | | | | claus | ID | DDNMF. | | | | e 6.2.11.2. | | | +-------------+-------------+-------------+-------------+-------------+ | T5067 | NOTE 4 | Upon | Upon | Delete the | | | | assigning a | receiving a | association | | | | Restricted | new | between the | | | | discovery | DISCOVE | UE, the | | | | filter with | RY_REQUEST | RPAUID and | | | | an | message | the | | | | associated | from the UE | co | | | | T5066 value | with the | rresponding | | | | to the UE, | command set | Restricted | | | | as | to | discovery | | | | described | \"monitor\" | filter | | | | in | and | allocated | | | | cla | discovery | by the 5G | | | | use 6.2.5.3 | entry ID | DDNMF. | | | | and | set to be | | | | | clause | the same as | | | | | 6.2.12.3.1. | the | | | | | | discovery | | | | | | entry in | | | | | | which this | | | | | | timer is | | | | | | running. | | +-------------+-------------+-------------+-------------+-------------+ | T5069 | NOTE 5 | Upon | Upon | Delete the | | | | assigning a | receiving a | discovery | | | | ProSe query | new | entry in | | | | code, ProSe | DISCOVE | discoveree | | | | response | RY_REQUEST | UE context | | | | code and | message | which | | | | discovery | from the UE | contains | | | | query | with the | association | | | | filter(s) | command set | between the | | | | with an | to | UE, the | | | | associated | \ | RPAUID and | | | | T5068 value | "response\" | the | | | | to the UE, | for the | co | | | | as | same RPAUID | rresponding | | | | described | or | ProSe query | | | | in | discovery | code, ProSe | | | | clau | entry ID. | response | | | | se 6.2.6.3. | Set to be | code, | | | | | the same as | discovery | | | | | the | query | | | | | discovery | filter(s) | | | | | entry in | allocated | | | | | which this | by the 5G | | | | | timer is | DDNMF. | | | | | running. | | +-------------+-------------+-------------+-------------+-------------+ | T5071 | NOTE 6 | Upon | Upon | Delete the | | | | retrieving | receiving a | discovery | | | | the ProSe | new | entry in | | | | query code, | DISCOVE | discoverer | | | | ProSe | RY_REQUEST | UE context | | | | response | message | which | | | | code from | from the UE | contains | | | | discoveree | with the | the | | | | UE context | command set | association | | | | and | to | between the | | | | assigning | \"query\" | UE, the | | | | Discovery | and | RPAUID and | | | | Response | discovery | the | | | | Filter(s) | entry ID | co | | | | with an | set to be | rresponding | | | | associated | the same as | Discovery | | | | T5070 value | the | Response | | | | to the UE, | discovery | Filter(s) | | | | as | entry in | allocated | | | | described | which this | by the 5G | | | | in | timer is | DDNMF. | | | | clau | running. | | | | | se 6.2.7.3. | | | +-------------+-------------+-------------+-------------+-------------+ | NOTE 1: The | | | | | | value of | | | | | | this timer | | | | | | is assigned | | | | | | by the 5G | | | | | | DDNMF | | | | | | during the | | | | | | announce | | | | | | request and | | | | | | discovery | | | | | | update | | | | | | procedure | | | | | | for open 5G | | | | | | ProSe | | | | | | direct | | | | | | discovery. | | | | | | | | | | | | NOTE 2: The | | | | | | value of | | | | | | this timer | | | | | | is assigned | | | | | | by the 5G | | | | | | DDNMF | | | | | | during the | | | | | | monitor | | | | | | request and | | | | | | discovery | | | | | | update | | | | | | procedure | | | | | | for open 5G | | | | | | ProSe | | | | | | direct | | | | | | discovery. | | | | | | | | | | | | NOTE 3: The | | | | | | value of | | | | | | this timer | | | | | | is assigned | | | | | | by the 5G | | | | | | DDNMF | | | | | | during the | | | | | | announce | | | | | | request and | | | | | | discovery | | | | | | update | | | | | | procedure | | | | | | for | | | | | | restricted | | | | | | 5G ProSe | | | | | | direct | | | | | | discovery | | | | | | model A. | | | | | | | | | | | | NOTE 4: The | | | | | | value of | | | | | | this timer | | | | | | is assigned | | | | | | by the 5G | | | | | | DDNMF | | | | | | during the | | | | | | monitor | | | | | | request and | | | | | | discovery | | | | | | update | | | | | | procedure | | | | | | for | | | | | | restricted | | | | | | 5G ProSe | | | | | | direct | | | | | | discovery | | | | | | model A. | | | | | | | | | | | | NOTE 5: The | | | | | | value of | | | | | | this timer | | | | | | is assigned | | | | | | by the 5G | | | | | | DDNMF | | | | | | during the | | | | | | discoveree | | | | | | request | | | | | | procedure | | | | | | for | | | | | | restricted | | | | | | 5G ProSe | | | | | | direct | | | | | | discovery | | | | | | model B. | | | | | | | | | | | | NOTE 6: The | | | | | | value of | | | | | | this timer | | | | | | is assigned | | | | | | by the 5G | | | | | | DDNMF | | | | | | during the | | | | | | discoverer | | | | | | request | | | | | | procedure | | | | | | for | | | | | | restricted | | | | | | 5G ProSe | | | | | | direct | | | | | | discovery | | | | | | model B. | | | | | +-------------+-------------+-------------+-------------+-------------+
NOTE: Multiple timers T5061, T5063, T5065, T5067, T5069 and T5071 can run
simultaneously in the 5G DDNMF.
## 12.5 Timers of broadcast mode 5G ProSe communication over PC5 interface
Table 12.5.1: timers of broadcast mode 5G ProSe communication over PC5
+------------+-------------+-------------+-------------+-------------+ | TIMER NUM. | TIMER VALUE | CAUSE OF | NORMAL STOP | ON\ | | | | START | | EXPIRY | +============+=============+=============+=============+=============+ | T5100 | Privacy | Upon | Upon | Change the | | | timer value | initiating | stopping | value of | | | for source | t | t | the source | | | layer-2 ID | ransmission | ransmission | layer-2 ID | | | of UE for | of | of | se | | | 5G ProSe | broadcast | broadcast | lf-assigned | | | co | mode 5G | mode V2X | by the UE | | | mmunication | ProSe | co | for | | | over PC5 | co | mmunication | broadcast | | | (see clause | mmunication | over PC5, | mode ProSe | | | 5.2), which | over PC5, | as | co | | | is | as | described | mmunication | | | specified | described | in | over PC5. | | | in 3GPP TS | in | clau | | | | 24.555 | clau | se 7.3.2.4. | If the data | | | [17] | se 7.3.2.4. | | unit(s) of | | | clause 5.4. | | | a ProSe | | | | Upon | | application | | | | receiving | | contains IP | | | | an | | data, | | | | indication | | change the | | | | from upper | | value of | | | | layers that | | the source | | | | the | | IP address | | | | application | | se | | | | layer | | lf-assigned | | | | identifier | | by the UE | | | | has been | | for | | | | changed | | broadcast | | | | while | | mode 5G | | | | performing | | ProSe | | | | t | | co | | | | ransmission | | mmunication | | | | of | | over PC5. | | | | broadcast | | | | | | mode 5G | | | | | | ProSe | | | | | | co | | | | | | mmunication | | | | | | over PC5, | | | | | | as | | | | | | described | | | | | | in | | | | | | clau | | | | | | se 7.3.2.4. | | | | | | | | | | | | Upon T5100 | | | | | | expiration | | | | | | while | | | | | | performing | | | | | | t | | | | | | ransmission | | | | | | of | | | | | | broadcast | | | | | | mode 5G | | | | | | ProSe | | | | | | co | | | | | | mmunication | | | | | | over PC5, | | | | | | as | | | | | | described | | | | | | in | | | | | | clau | | | | | | se 7.3.2.4. | | | +------------+-------------+-------------+-------------+-------------+
## 12.6 Timers of groupcast mode 5G ProSe communication over PC5 interface
Table 12.6.1: timers of groupcast mode 5G ProSe direct communication over PC5
+------------+-------------+-------------+-------------+-------------+ | TIMER NUM. | TIMER VALUE | CAUSE OF | NORMAL STOP | ON\ | | | | START | | EXPIRY | +============+=============+=============+=============+=============+ | T5200 | Privacy | Upon | Upon | Change the | | | timer value | initiating | stopping | value of | | | for source | t | t | the source | | | layer-2 ID | ransmission | ransmission | Layer-2 ID | | | of UE for | of | of | se | | | 5G ProSe | groupcast | groupcast | lf-assigned | | | co | mode 5G | mode 5G | by the UE | | | mmunication | ProSe | ProSe | for | | | over PC5 | co | co | groupcast | | | (see clause | mmunication | mmunication | mode ProSe | | | 5.2), which | over PC5, | over PC5, | co | | | is | as | as | mmunication | | | specified | described | described | over PC5. | | | in 3GPP TS | in | in | | | | 24.555 | clau | clau | If the data | | | [17] | se 7.4.2.4. | se 7.4.2.4. | unit(s) of | | | clause 5.4. | | | a ProSe | | | | Upon | | application | | | | receiving | | contains IP | | | | an | | data, | | | | indication | | change the | | | | from upper | | value of | | | | layers that | | the source | | | | the | | IP address | | | | application | | se | | | | layer | | lf-assigned | | | | identifier | | by the UE | | | | has been | | for | | | | changed | | groupcast | | | | while | | mode 5G | | | | performing | | ProSe | | | | t | | co | | | | ransmission | | mmunication | | | | of | | over PC5. | | | | groupcast | | | | | | mode 5G | | | | | | ProSe | | | | | | co | | | | | | mmunication | | | | | | over PC5, | | | | | | as | | | | | | described | | | | | | in | | | | | | clau | | | | | | se 7.4.2.4. | | | | | | | | | | | | Upon T5200 | | | | | | expiration | | | | | | while | | | | | | performing | | | | | | t | | | | | | ransmission | | | | | | of | | | | | | groupcast | | | | | | mode 5G | | | | | | ProSe | | | | | | co | | | | | | mmunication | | | | | | over PC5, | | | | | | as | | | | | | described | | | | | | in | | | | | | clau | | | | | | se 7.4.2.4. | | | +------------+-------------+-------------+-------------+-------------+
## 12.7 Timers of 5G ProSe additional parameters announcement procedure
Table 12.7: 5G ProSe additional parameters announcement timers
+-------------+-------------+-------------+-------------+-------------+ | TIMER NUM. | TIMER VALUE | CAUSE OF | NORMAL STOP | ON\ | | | | START | | EXPIRY | +=============+=============+=============+=============+=============+ | T5106 | NOTE 1 | Upon | Upon | Re-initiate | | | | receiving a | receiving | the | | | | T5106 value | one or more | additional | | | | in a PROSE | new T5106 | parameters | | | | ADDITIONAL | timer | a | | | | PARAMETERS | values in a | nnouncement | | | | A | PROSE | request | | | | NNOUNCEMENT | ADDITIONAL | procedure, | | | | RESPONSE | PARAMETERS | if the | | | | message as | ANNOUNCEMEN | upper layer | | | | described | T_RESPONSE | application | | | | in | message. | still needs | | | | clau | | to obtain | | | | se 10.3.25. | | NCGI or TAI | | | | | | of the cell | | | | | | serving the | | | | | | 5G ProSe | | | | | | layer-3 | | | | | | UE | | | | | | -to-network | | | | | | relay. | +-------------+-------------+-------------+-------------+-------------+ | T5107 | NOTE 2 | Upon | Upon | Stop the | | | | sending a | sending a | cell ID or | | | | PROSE | new PROSE | TAI | | | | ADDITIONAL | ADDITIONAL | a | | | | PARAMETERS | PARAMETERS | nnouncement | | | | A | A | in the | | | | NNOUNCEMENT | NNOUNCEMENT | PROSE PC5 | | | | RESPONSE | RESPONSE | DISCOVERY | | | | message as | message. | message for | | | | described | | relay | | | | in | | discovery | | | | clau | | additional | | | | se 10.3.25. | | I | | | | | | nformation. | +-------------+-------------+-------------+-------------+-------------+ | NOTE 1: The | | | | | | value of | | | | | | this timer | | | | | | is provided | | | | | | by the 5G | | | | | | ProSe | | | | | | layer-3 | | | | | | UE | | | | | | -to-network | | | | | | relay UE | | | | | | during the | | | | | | 5G ProSe | | | | | | additional | | | | | | parameters | | | | | | a | | | | | | nnouncement | | | | | | procedure. | | | | | | | | | | | | NOTE 2: The | | | | | | value of | | | | | | this timer | | | | | | is assigned | | | | | | by the 5G | | | | | | ProSe | | | | | | layer-3 | | | | | | UE | | | | | | -to-network | | | | | | relay UE | | | | | | during the | | | | | | 5G ProSe | | | | | | additional | | | | | | parameters | | | | | | a | | | | | | nnouncement | | | | | | procedure. | | | | | +-------------+-------------+-------------+-------------+-------------+
## 12.8 Timers for PC8 interface
Table 12.8.1: Timers for PC8 interface - UE side
* * *
TIMER NUM. TIMER VALUE CAUSE OF START NORMAL STOP ON\ EXPIRY
* * *
T5094 Expiration time of the 5G ProSe UE-to-network relay discovery security
parameters for 5G ProSe remote UE (see clause 8.2.9.2.2). Reception of the 5G
ProSe UE-to-network relay discovery security parameters for 5G ProSe remote
UE. Stop using the old 5G ProSe UE-to-network relay discovery security
parameters for 5G ProSe remote UE. Initiation of 5G ProSe UE-to-network relay
discovery security parameters request procedure, requesting the 5G ProSe UE-
to-network relay discovery security parameters for 5G ProSe remote UE.
T5095 Expiration time of the 5G ProSe UE-to-network relay discovery security
parameters for 5G ProSe UE-to-network relay UE (see clause 8.2.9.2.2).
Reception of the 5G ProSe UE-to-network relay discovery security parameters
for 5G ProSe UE-to-network relay UE. Stop using the old 5G ProSe UE-to-network
relay discovery security parameters for 5G ProSe UE-to-network relay UE.
Initiation of 5G ProSe UE-to-network relay discovery security parameters
request procedure, requesting the 5G ProSe UE-to-network relay discovery
security parameters for 5G ProSe UE-to-network relay UE.
* * *
## 12.9 Timers of 5G ProSe UE-to-network relay with model B
Table 12.9.1: 5G ProSe UE-to-network relay with Model B timers
* * *
TIMER NUM. TIMER VALUE CAUSE OF START NORMAL STOP ON\ EXPIRY
* * *
T5108 2s Upon sending the PROSE PC5 DISCOVERY message for 5G ProSe UE-to-
network relay discovery solicitation used to trigger the PROSE PC5 DISCOVERY
message signal strength measurement between the UE and the 5G ProSe UE-to-
network relay UE with which the UE has a link established Upon receiving _the_
PROSE PC5 DISCOVERY message for 5G ProSe UE-to-network relay discovery
response from the 5G ProSe UE-to-network relay UE with which the UE has a link
established Retransmission the PROSE PC5 DISCOVERY message for 5G ProSe UE-to-
network relay discovery solicitation
T5109 NOTE Upon receiving the PROSE PC5 DISCOVERY message for 5G ProSe UE-to-
network relay discovery response used for the the PROSE PC5 DISCOVERY message
signal strength measurement from the 5G ProSe UE-to-network relay UE with
which the UE has a link established Upon releasing the 5G ProSe direct link
with a 5G ProSe UE-to-network relay UE Sending the PROSE PC5 DISCOVERY message
for 5G ProSe UE-to-network relay discovery solicitation used to trigger the
PROSE PC5 DISCOVERY message signal strength measurement between the UE and the
5G ProSe UE-to-network relay UE with which the UE has a link established
NOTE: The value of this timer is left to implementation.
* * *
## 12.10 Timers for 5G ProSe UE-to-network relay discovery security material
request procedure over PC3a interface
Table 12.10.1: Timers for PC8 interface - UE side
* * *
TIMER NUM. TIMER VALUE CAUSE OF START NORMAL STOP ON\ EXPIRY
* * *
T5078 Expiration time of the 5G ProSe UE-to-network relay discovery security
material for 5G ProSe remote UE (see clause 8.2.12.2.2). Reception of the 5G
ProSe UE-to-network relay discovery security material for 5G ProSe remote UE.
Stop using the old 5G ProSe UE-to-network relay discovery security material
for 5G ProSe remote UE. Initiation of 5G ProSe UE-to-network relay discovery
security material request procedure, requesting the 5G ProSe UE-to-network
relay discovery security material for 5G ProSe remote UE.
T5079 Expiration time of the 5G ProSe UE-to-network relay discovery security
material for 5G ProSe UE-to-network relay UE (see clause 8.2.12.2.2).
Reception of the 5G ProSe UE-to-network relay discovery security material for
5G ProSe UE-to-network relay UE. Stop using the old 5G ProSe UE-to-network
relay discovery security material for 5G ProSe UE-to-network relay UE.
Initiation of 5G ProSe UE-to-network relay discovery security material request
procedure, requesting the 5G ProSe UE-to-network relay discovery security
material for 5G ProSe UE-to-network relay UE.
* * *
###### ## Annex A (informative): IANA registrations
# A.1 IANA registrations for MIME types
## A.1.1 General
IETF RFC 4288 [41], clause 9, states the process that applies in case of
changes to the registry of media types. Any changes to the format after the
registration with IANA would invoke this procedure.
## A.1.2 application/vnd.3gpp-prose-pc3a+xml
Your Name:
\
Your Email Address:
\
Media Type Name:
Application
Subtype name:
Vendor Tree -- vnd.3gpp-prose-pc3a+xml
Required parameters:
None.
Optional parameters:
\"charset\" the parameter has identical semantics to the charset parameter of
the \"application/xml\" media type as specified in clause 9.1 of IETF RFC 7303
[42].
Encoding considerations:
binary.
Security considerations:
Same as general security considerations for application/xml media type as
specified in clause 9.1 of IETF RFC 7303 [42]. The information transported in
this media type does not include active or executable content. Mechanisms for
privacy and integrity protection of protocol parameters exist. Those
mechanisms as well as authentication and further security mechanisms are
described in 3GPP TS 33.503 [34].
This media type does not include provisions for directives that institute
actions on a recipient\'s files or other resources.
This media type does not include provisions for directives that institute
actions that, while not directly harmful to the recipient, may result in
disclosure of information that either facilitates a subsequent attack or else
violates a recipient\'s privacy in any way.
This media type does not employ compression.
Interoperability considerations:
The media type allows for interoperability of messages transmitted for 5G
ProSe over the PC3a interface. The messages are sent between user equipment
and mobile network.
Published specification:
3GPP TS 24.554 (http://www.3gpp.org/ftp/Specs/html-info/24554.htm)
Applications which use this media type:
n/a.
Fragment identifier considerations:
The handling in clause 5 of IETF RFC 7303 [42] applies.
Restrictions on usage:
None.
Provisional registration? (standards tree only):
n/a.
Additional information:
1\. Deprecated alias names for this type: n/a
2\. Magic number(s): n/a
3\. File extension(s): n/a
4\. Macintosh File Type Code(s): n/a
5\. Object Identifier(s) or OID(s): n/a
Intended usage:
Common.
Other information/general comment:
The media type is intended to be used in 5G proximity service procedures.
Person to contact for further information:
\- Name: \
\- Email: \
\- Author/Change controller:
i) Author: 3GPP CT1 Working Group/3GPP_TSG_CT_WG1\@LIST.ETSI.ORG
ii) Change controller: \/\
## A.1.2A application/vnd.3gpp-prose-pc8+xml
Your Name:
\
Your Email Address:
\
Media Type Name:
Application
Subtype name:
Vendor Tree - vnd.3gpp-prose-pc8+xml
Required parameters:
None
Optional parameters:
\"charset\" the parameter has identical semantics to the charset parameter of
the \"application/xml\" media type as specified in clause 9.1 of IETF RFC 7303
[42].
Encoding considerations:
binary.
Security considerations:
Same as general security considerations for application/xml media type as
specified in clause 9.1 of IETF RFC 7303 [42]. The information transported in
this media type does not include active or executable content. Mechanisms for
privacy and integrity protection of protocol parameters exist. Those
mechanisms as well as authentication and further security mechanisms are
described in 3GPP TS 33.503 [34].
This media type does not include provisions for directives that institute
actions on a recipient\'s files or other resources.
This media type does not include provisions for directives that institute
actions that, while not directly harmful to the recipient, may result in
disclosure of information that either facilitates a subsequent attack or else
violates a recipient\'s privacy in any way.
This media type does not employ compression.
Interoperability considerations:
The media type allows for interoperability of messages transmitted over the
PC8 interface. The messages are sent between user equipment and mobile
network.
Published specification:
3GPP TS 24.554 (http://www.3gpp.org/ftp/Specs/html-info/24554.htm)
Applications which use this media type:
n/a.
Fragment identifier considerations:
The handling in clause 5 of IETF RFC 7303 [42] applies.
Restrictions on usage:
None.
Provisional registration? (standards tree only):
n/a.
Additional information:
1\. Deprecated alias names for this type: n/a.
2\. Magic number(s): n/a.
3\. File extension(s): n/a.
4\. Macintosh File Type Code(s): n/a.
5\. Object Identifier(s) or OID(s): n/a.
Intended usage:
Common.
Other information/general comment:
The media type is intended to be used in 5G proximity service procedures.
Person to contact for further information:
\- Name: \
\- Email: \
\- Author/Change controller:
i) Author: 3GPP CT1 Working Group/3GPP_TSG_CT_WG1\@LIST.ETSI.ORG
ii) Change controller: \/\
## A.1.3 application/vnd.3gpp-prose-pc3ach+xml
Your Name:
\
Your Email Address:
\
Media Type Name:
Application
Subtype name:
Vendor Tree -- vnd.3gpp-prose-pc3ach+xml
Required parameters:
None
Optional parameters:
\"charset\" the parameter has identical semantics to the charset parameter of
the \"application/xml\" media type as specified in clause 9.1 of IETF RFC 7303
[42].
Encoding considerations:
binary.
Security considerations:
Same as general security considerations for application/xml media type as
specified in clause 9.1 of IETF RFC 7303 [42]. The information transported in
this media type does not include active or executable content. Mechanisms for
privacy and integrity protection of protocol parameters exist. Those
mechanisms as well as authentication and further security mechanisms are
described in 3GPP TS 33.503 [34].
This media type does not include provisions for directives that institute
actions on a recipient\'s files or other resources.
This media type does not include provisions for directives that institute
actions that, while not directly harmful to the recipient, may result in
disclosure of information that either facilitates a subsequent attack or else
violates a recipient\'s privacy in any way.
This media type does not employ compression.
Interoperability considerations:
The media type allows for interoperability of messages transmitted over the
PC3ach interface, including those related to transport of the usage
information request of proximity services. The messages are sent between user
equipment and mobile network.
Published specification:
3GPP TS 24.554 (http://www.3gpp.org/ftp/Specs/html-info/24554.htm)
Applications which use this media type:
n/a
Fragment identifier considerations:
The handling in clause 5 of IETF RFC 7303 [42] applies.
Restrictions on usage:
None
Provisional registration? (standards tree only):
n/a
Additional information:
1\. Deprecated alias names for this type: n/a
2\. Magic number(s): n/a
3\. File extension(s): n/a
4\. Macintosh File Type Code(s): n/a
5\. Object Identifier(s) or OID(s): n/a
Intended usage:
Common.
Other information/general comment:
The media type is intended to be used in proximity service procedures.
Person to contact for further information:
\- Name: \
\- Email: \
\- Author/Change controller:
i) Author: 3GPP CT1 Working Group/3GPP_TSG_CT_WG1\@LIST.ETSI.ORG
ii) Change controller: \/\
#
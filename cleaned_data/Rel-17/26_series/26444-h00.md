# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies the digital test sequences for the Enhanced
Voice Services (EVS) Codec. These sequences are used in conformance testing
for implementations of the EVS Codec (3GPP TS 26.445), Voice Activity
Detection (VAD) (3GPP TS.26.451), Comfort Noise Generation (3GPP TS 26.449),
Discontinuous Transmission (DTX) (3GPP TS 26.450), Error Concealment of Lost
Packets (3GPP TS 26.447), Jitter Buffer Management (JBM) (3GPP TS 26.448), and
AMR-WB Interoperable Function (3GPP TS 26.446). In addition, the present
document specifies procedures for conformance testing.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 26.445: \"Codec for Enhanced Voice Services (EVS); Detailed
Algorithmic Description\".
[3] 3GPP TS 26.451: \"Codec for Enhanced Voice Services (EVS); Voice Activity
Detection (VAD)\".
[4] 3GPP TS 26.449: \"Codec for Enhanced Voice Services (EVS); Comfort Noise
Generation (CNG) Aspects\".
[5] 3GPP TS 26.450: \"Codec for Enhanced Voice Services (EVS); Discontinuous
Transmission (DTX)\".
[6] 3GPP TS 26.447: \"Codec for Enhanced Voice Services (EVS); Error
Concealment of Lost Packets\".
[7] 3GPP TS 26.442: \" Codec for Enhanced Voice Services (EVS); ANSI C code
(fixed-point)\".
[8] 3GPP TS 26.443: \"Codec for Enhanced Voice Services (EVS); ANSI C code
(floating-point)\".
[9] 3GPP TS 26.174: \"Adaptive Multi-Rate - Wideband (AMR-WB) Speech Codec
Test Sequences\".
[10] 3GPP TS 26.446: \"Codec for Enhanced Voice Services (EVS); AMR-WB
Backward Compatible Functions\".
[11] 3GPP TS 26. 448: \"Codec for Enhanced Voice Services (EVS); Jitter Buffer
Management\".
[12] 3GPP TS 26.452: \"Codec for Enhanced Voice Services (EVS); ANSI C code;
Alternative fixed-point using updated basic operators\".
[13] 3GPP TS 26.406: \"General audio codec audio processing functions;
Enhanced aacPlus general audio codec; Conformance testing\".
[14] 3GPP TS 26.274: \"Audio codec processing functions; Extended Adaptive
Multi-Rate - Wideband (AMR-WB+) speech codec; Conformance testing\".
[15] 3GPP TS 26.952: \"Codec for Enhanced Voice Services (EVS); Performance
Characterization\".
[16] ITU-T Recommendation P.863 (03/2018): \"Perceptual objective listening
quality assessment\".
[17] ITU-T Recommendation P.501 (03/2017): \"Test signals for use in
telephonometry\".
[18] ITU-R Recommendation BS.1387-1 (11/2001): \"Method for objective
measurements of perceived audio quality\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TS 26.445 [2], 3GPP TS 26.451 [3], 3GPP TS 26.449 [4], 3GPP TS 26.450
[5], 3GPP TS 26.447 [6], 3GPP TS 26.448 [11], and 3GPP TS 26.446 [10] apply.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
ACELP Algebraic Code-Excited Linear Prediction
AMR-WB Adaptive Multi Rate Wideband (codec)
CNG Comfort Noise Generator
DTX Discontinuous Transmission
EVS Enhanced Voice Services
FB Fullband
FEC Frame Erasure Concealment
IP Internet Protocol
JBM Jitter Buffer Management
MSB Most Significant Bit
MTSI Multimedia Telephony Service for IMS
NB Narrowband
PS Packet Switched
PSTN Public Switched Telephone Network
SAD Sound Activity Detection
SC-VBR Source Controlled - Variable Bit Rate
SID Silence Insertion Descriptor
SWB Super Wideband
VAD Voice Activity Detection
WB Wideband
WMOPS Weighted Millions of Operations Per Second
# 4 General
## 4.1 Introduction
This specification provides digital test sequences which are necessary to test
conformance for an implementation of the EVS codec (TS 26.445 [2]), Voice
Activity Detection (TS 26.451 [3]), Comfort Noise Generation (TS 26.449 [4]),
Discontinuous Transmission (TS 26.450 [5]), Concealment of Lost Packets (3GPP
TS 26.447 [6]), Jitter Buffer Management (JBM) (3GPP TS 26.448 [11]) and AMR-
WB Interoperable Function (3GPP TS 26.446 [10]), and for the testing of
conformance for implementations of the ANSI C code in TS 26.442 [7], TS 26.443
[8] and TS 26.452 [12].
A standard compliant implementation of the above specifications shall pass
conformance tests according to clause 7. The necessary test sequences can be
found in the corresponding ZIP files according to the attached Readme.txt
file.
Clause 5 describes the format of the files, which contain the digital test
sequences. Clause 6 describes the test sequences for the EVS codec, including
error concealment of lost packets, the AMR-WB interoperable function. the VAD,
comfort noise generation, discontinuous transmission, the AMR-WB interoperable
function, the EVS jitter buffer management, Clause 7 describes the conformance
testing for implementations of the EVS codec.
# 5 Test sequence format
## 5.1 Introduction to test sequence format
This clause provides information on the format of the digital test sequences
for the EVS codec (TS 26.445 [2]), Voice Activity Detection (TS 26.451 [3]),
Comfort Noise Generation (TS 26.449 [4]), Discontinuous Transmission (TS
26.449 [5]), and Error Concealment of Lost Packets (TS 26.447 [6]), Jitter
Buffer Management (JBM) (3GPP TS 26.448 [11]), and AMR-WB Interoperable
Function (3GPP TS 26.446 [10]).
## 5.2 File format
The test sequence files in PC (little-endian) byte order are provided in
archive files (ZIP format, see the pointer file Readme.txt which accompanies
the present document).
Following decompression, three types of file are provided:
\- Files for input to the speech encoder: *.INP
\- Files for comparison with the encoder output and for input to the speech
decoder: *.COD
\- Files for comparison with the decoder output: *.OUT
\- Files for input to the speech decoder with JBM *.RTP
\- One mode control file for the mode switching test *.MOD
\- Instructions how to operate the test sequences *TXT
# 6 EVS codec test sequences including error concealment of lost packets
## 6.1 Introduction to test sequences
This clause provides information on the test sequences designed to exercise
the EVS codec (TS 26.445 [2]).
## 6.2 Codec configuration
The speech encoder shall be configured as instructed in the readme file
attached.
## 6.3 EVS codec test sequences
### 6.3.1 EVS encoder test sequences
The test sequences are provided and described in the ZIP archive.
The test sequences for encoder testing and instructions to operate the encoder
are summarized in Readme_EVS_enc.txt.
### 6.3.2 EVS decoder test sequences
The test sequences for decoder testing and instructions to operate the decoder
are summarized in Readme_EVS_dec.txt.
### 6.3.3 Test sequences for AMR-WB interoperable function
The test sequences for the AMR-WB interoperable function include the test
sequences defined in TS 26.174 [9], but *.COD and *.OUT files are not
identical to those provided by TS 26.174.
Readme_AMRWB_IO_enc.txt and Readme_AMRWB_IO_dec.txt summarized the input test
sequences, output test sequences, and instructions to execute the AMR-WB
interoperable function test.
### 6.3.4 Test sequences for jitter buffer management
The input test sequences, the output sequences, and instructions to run the
jitter buffer management test are summarized in the Readme_JBM_dec.txt.
# 7 Conformance Testing
## 7.1 Bit-exact Conformance
For an implementation to be declared conformant according to the bit-exact
conformance method, the encoder and decoder output sequences of the
implementation shall match bit-exactly the test sequences provided in the
corresponding ZIP files according to the attached Readme.txt file and in
accordance with clause 6. This applies for all implementations based on TS
26.442 [7], TS 26.443 [8] or TS 26.452 [12]. For fixed-point implementations
based on TS 26.442 [7] and TS 26.452 [12] this is the only conformance method.
## 7.2 Non-Bit-exact Conformance
### 7.2.1 Overview
If an implementation under test is based on the reference floating--point code
(TS 26.443 [8]) and the output sequences are not bit-exact to the test
sequences according to clause 6, the non bit-exact conformance testing process
defined here shall be used to test the conformance.
A conformant floating-point implementation of the EVS codec shall be compliant
to the reference specification in TS 26.443 [8] by implementing all the
algorithmic steps of the EVS codec, further specified in 3GPP TS 26.445
(Detailed Algorithmic Description) [2], 3GPP TS 26.451 (Voice Activity
Detection (VAD)) [3], 3GPP TS 26.449 (Comfort Noise Generation (CNG)) [4],
3GPP TS 26.450 (Discontinuous Transmission (DTX)) [5], 3GPP TS 26.447 (Packet
Loss Concealment (PLC) of Lost Packets) [6], and 3GPP TS 26.446 (AMR-WB
Interoperable Function) [10].
If a floating-point implementation uses the Jitter Buffer Management (JBM)
according to TS 26.448 [11], the implementation shall be compliant to the
reference specification in TS 26.443 [8] by implementing all the algorithmic
steps of 3GPP TS 26.448 (Jitter Buffer Management (JBM)).
An implementation shall be tested for non-bit-exact conformance using three
specific tests:
\- Decoder test comparing the implementation decoder with TS 26.443 [8]
decoder.
\- Encoder test comparing the implementation encoder with TS 26.443 [8]
encoder.
\- MOS-LQO verification comparing the implementation with TS 26.442 [7]
implementation.
All three tests shall pass for the implementation to be declared conformant.
The tests are described in more details in Annex A.
Figure 7.1 shows the flow chart of the non bit-exact conformance process.
Figure 7.1: Non bit-exact conformance process
### 7.2.2 Running the Tests
The executables and scripts illustrating how to run the tests are included in
the ZIP of the floating-point test sequences. Annex A provides more details on
the tests. In the case of discrepancy between the procedure described in Annex
A and the scripts provided in the ZIP file, the procedure of the scripts
provided prevail.
For the encoder and decoder tests, instructions on how to operate the
implementation under test to run the tests are contained in the text file
testvec\Readme.md. The scripts require an additional tool, ResampAudio.exe
(instructions on how to download it are contained in the Readme file). The
decoder and encoder test scripts are run by executing two Bourne-Shell
scripts:
\- Readme_dec_snr.sh.txt: batch file describes how to run the decoder test
\- Readme_enc_sh.txt: batch file describes how to run the encoder test
The reference files for SNR and MLD encoder and decoder tests are also
included in the zip file.
For the MOS-LQO verification, instructions on how to operate the
implementation under test to run the test are contained in the text file mos-
lqo\README.md. The test script is run by executing the mos-lqo.py Python^Â®^
script, which in turn executes several Bourne-Shell scripts. The test script
requires additional tools:
\- P.863 [16] implementation, compatible with version 2 of [16]
\- CopyAudio.exe (instructions on how to download it are contained in the
Readme file)
For the MOS-LQO test an additional database, based on [17], [13], [14] is
used, as explained in Annex A.3.2.
The implementation will be declared conformant if all three tests (encoder,
decoder, MOS-LQO) are passed.
###### ## Annex A: Tools Description (normative)
# A.1 Decoder Test
## A.1.1 General Considerations
The reference PCM signals are taken from the decoded floating-point test
sequences of this specification. The PCM signal under test are obtained by
running the floating-point bit-stream included in this specification through
the Decoder under Test (Figure A.1). The reference decoder is the floating-
point code of TS 26.443 [8].
Figure A.1: Flow diagram for the decoder test using signal-based metrics
All metrics are calculated on the reference PCM signal $x_{\text{REF}}(t)$ and
the PCM signal under test $x_{\text{TST}}(t)$ based on 20ms frames. The frames
of the two signals will be time aligned, this means the delay compensation in
EVS encoder and decoder remains ON (the default configuration). Furthermore,
the frame processing is aligned with the encoded frame by adding the decoder
delay. Table A.1 shows the delay values used for the different sampling
frequencies.
Table A.1: Delay used for alignment of processing frames with encoded frames
**Sampling frequency** **8000 Hz** **16000 Hz** **32000 Hz** **48000 Hz**
* * *
Delay (samples) 10 37 74 111
The number of samples $N$ for a 20ms frame size is defined by $N = f_{s}
\bullet 0.02$, where $f_{s}$ represents the sampling rate.
The PCM signals $x_{\text{REF}}(t)$ and $x_{\text{TST}}(t)$ should be scaled
between -1 and 1.
## A.1.2 Metrics
### A.1.2.1 RMS Error Threshold
The RMS method is derived from the decoder conformance used in ISO/IEC
14496-26 [10]. The RMS error is calculated for each 20ms frame and compared to
a threshold according to:
$\ RMS = 20 \bullet \log_{10}\left( \sqrt{\frac{\sum_{}^{}{(x_{\text{REF}} -
x_{\text{TST}})}^{2}}{N}} \right)  T_{\text{snr}} -
SNRHEADROOM - CDSNRHEADROOM \ T_{\text{snr}} - SNRHEADROOM - CDSNRHEADROOM,\ \
else \ \end{matrix} \right.\ $$
## A.1.3 Analysis Flow and Reporting
The three metrics are computed in a specific order, as shown in Figure A.2.
Once a frame passes a metric, the process is stopped and the next frame is
analysed. The SNR metric is computed on the frames failing the RMS error
criteria. Similarly, the Spectral Distortion metric is computed on the frames
failing the SNR criteria.
Figure A.2: Flow chart for decoder tool
In a file one or two frames could slightly be above the threshold. To avoid
relaxing the threshold, a constraint on the number of frames failing per file
has been added as an additional criterion.
if number_of_frames_failing =\ AnnexC//P501_C_chinese_f1_FB_48k.wav
an1f1s2 => AnnexC//P501_C_chinese_f2_FB_48k.wav
an1f1s3 => Speech and Noise Signals Clause B/Dutch_FB_clause_B.3.2//female
1.wav
an1f1s4 => Speech and Noise Signals Clause B/Dutch_FB_clause_B.3.2//female
2.wav
an1f1s5 => AnnexC//P501_C_english_f1_FB_48k.wav
an1f2s1 => AnnexC//P501_C_english_f2_FB_48k.wav
an1f2s2 => AnnexC//P501_C_finnish_f1_FB_48k.wav
an1f2s3 => AnnexC//P501_C_finnish_f2_FB_48k.wav
an1f2s4 => AnnexC//P501_C_french_f1_FB_48k.wav
an1f2s5 => AnnexC//P501_C_french_f2_FB_48k.wav
an1f3s1 => AnnexC//P501_C_german_f1_FB_48k.wav
an1f3s2 => AnnexC//P501_C_german_f2_FB_48k.wav
an1f3s3 => AnnexC//P501_C_italian_f1_FB_48k.wav
an1f3s4 => AnnexC//P501_C_italian_f2_FB_48k.wav
an1f3s5 => AnnexC//P501_C_japanese_f1_FB_48k.wav
an1m1s1 => AnnexC//P501_C_chinese_m1_FB_48k.wav
an1m1s2 => AnnexC//P501_C_chinese_m2_FB_48k.wav
an1m1s3 => Speech and Noise Signals Clause B/Dutch_FB_clause_B.3.2//male 1.wav
an1m1s4 => Speech and Noise Signals Clause B/Dutch_FB_clause_B.3.2//male 2.wav
an1m1s5 => AnnexC//P501_C_english_m1_FB_48k.wav
an1m2s1 => AnnexC//P501_C_english_m2_FB_48k.wav
an1m2s2 => AnnexC//P501_C_finnish_m1_FB_48k.wav
an1m2s3 => AnnexC//P501_C_finnish_m2_FB_48k.wav
an1m2s4 => AnnexC//P501_C_french_m1_FB_48k.wav
an1m2s5 => AnnexC//P501_C_french_m2_FB_48k.wav
an1m3s1 => AnnexC//P501_C_german_m1_FB_48k.wav
an1m3s2 => AnnexC//P501_C_german_m2_FB_48k.wav
an1m3s3 => AnnexC//P501_C_italian_m1_FB_48k.wav
an1m3s4 => AnnexC//P501_C_italian_m2_FB_48k.wav
an1m3s5 => AnnexC//P501_C_japanese_m1_FB_48k.wav
The noisy speech items are created from the clean speech items above and mixed
with car, street, or office noise.
The mixed content and music items are selected from [13], and [14] as follows:
an1a1s1 => samples 840000:1104000 from {26444}/stv48c.INP,
an1a1s2 => samples 1260000:1404288 from{26444}/stv48c.INP,
an1a1s3 => samples 1611888:1793270 from {26444}/stv48c.INP,
an1a1s4 => samples 1793270:2057040 from {26444}/stv48c.INP,
an1a1s5 => left channel from {26406}/guitar_cymbals.wav,
an1a2s1 => left channel from {26274}/m_cl_x_1_org.wav,
an1a2s2 => left channel from {26274}/m_cl_x_2_org.wav,
an1a2s3 => left channel from {26274}/m_ot_x_5_org.wav,
an1a2s4 => left channel from {26274}/m_ot_x_8_org.wav,
an1a2s5 => left channel from {26274}/m_si_x_3_org.wav,
an1a3s1 => left channel from {26274}/m_ch_x_1_org.wav,
an1a3s2 => left channel from {26274}/m_po_x_2_org.wav,
an1a3s3 => left channel from {26274}/m_ot_x_4_org.wav,
an1a3s4 => left channel from {26274}/m_ot_x_9_org.wav,
an1a3s5 => left channel from {26274}/m_po_x_3_org.wav,
an1a4s1 => left channel from {26274}/m_ot_x_6_org.wav,
an1a4s2 => left channel from {26274}/m_ot_x_3_org.wav,
an1a4s3 => left channel from {26274}/m_ot_x_a_org.wav,
an1a4s4 => left channel from {26274}/m_ot_x_b.org.wav,
an1a4s5 => left channel from {26406}/hihat.wav,
an1a5s1 => left channel from {26274}/m_ot_x_7_org.wav,
an1a5s2 => left channel from {26274}/m_po_x_1_org.wav,
an1a5s3 => left channel from {26274}/m_ot_x_2_org.wav,
an1a5s4 => left channel from {26274}/m_po_x_4_org.wav,
an1a5s5 => left channel from {26274}/m_po_x_5_org.wav,
an1a6s1 => left channel from {26274}/m_po_x_6_org.wav,
an1a6s2 => left channel from {26274}/m_po_x_3_org.wav,
an1a6s3 => left channel from {26274}/m_si_x_1_org.wav,
an1a6s4 => left channel from {26274}/m_si_x_2_org.wav,
an1a6s5 => left channel from {26274}/m_vo_x_1_org.wav
## A.3.3 Test Conditions
The differences are computed for various test conditions:
\- All the codec modes of EVS
\- All the bandwidths of EVS
\- All the bit-rates of EVS, including bit-rate switching
\- DTX ON and OFF
\- Various levels: -26 dB, -36 dB, -16 dB
\- Various noise conditions
\- Various impairment conditions
The files have been processed according to EVS-7c (EVS processing plan) for
the various test conditions [6]. In all, 941 test conditions are assessed.
The processing generates for all 941 test conditions from the items detailed
in clause A.3.2, roughly 225000 seconds (or \~62 hours) of PCM data, which
shall be assessed with P.863 [16] according to version 2 to generate the
average MOS-LQO differences per test condition.
NOTE: Implementers are advised to ensure that sufficient free storage space is
available as the processing may require up to 100 GB of storage. Processing
and P.863 [16] evaluation may also require significant amounts of time.
## A.3.4 Thresholds and Criteria
From the MOS-LQO differences of the test condition, the average, 95%, 99% and
Maximum are computed for all bandwidths combined, as well as for each set of
bandwidth condition. The number of test condition for each bandwidth and the
total are summarized in Table A.6.
Table A.6: Number of test conditions per bandwidth excluding the EVS JBM [11]
Bandwidth NB WB WBIO SWB FB All
* * *
Number 118 214 216 170 143 861
An implementation according to 26.443 Version 16.3.0 will be considered
passing the MOS-LQO verification if all the average, 95 percentile, 99
percentile and maximum MOS-LQO differences are below the thresholds proposed
in Table A.7 for all bandwidths.
Table A.7: Thresholds for MOS_LQO difference excluding the EVS JBM [11]
All Average 95% 99% Max
* * *
A-B 0.001 0.04 0.07 0.11 A-C 0.001 0.02 0.04 0.09 A-D 0.002 0.04 0.07 0.12 NB
Average 95% 99% Max A-B 0.01 0.07 0.09 0.1 A-C 0.002 0.02 0.02 0.04 A-D 0.012
0.07 0.09 0.11 WB Average 95% 99% Max A-B 0.002 0.05 0.06 0.08 A-C 0.001 0.02
0.04 0.09 A-D 0.004 0.05 0.07 0.09 WBIO Average 95% 99% Max A-B 0.006 0.02
0.04 0.08 A-C 0.003 0.01 0.02 0.04 A-D 0.004 0.01 0.03 0.08 SWB Average 95%
99% Max A-B 0.002 0.04 0.06 0.08 A-C 0.003 0.03 0.04 0.05 A-D 0.003 0.04 0.07
0.08 FB Average 95% 99% Max A-B 0.005 0.05 0.07 0.11 A-C 0.003 0.03 0.04 0.06
A-D 0.003 0.05 0.07 0.12
* * *
* * *
NOTE: The MOS-LQO verification does not include testing of the EVS JBM
solution. Conformance for the EVS JBM solution in [11] is FFS.
# A.4 Reference Implementations
To get the snr and mld corridor as well as the thresholds values for the MOS-
LQO, as set of references implementations were used. Table A.8 list the
implementations used for references, including compiler, target platform,
compiler setting. These implementations are based on mainstream compilers and
platforms and used the latest version of EVS code defined in TS 26.443 [8].
These implementations are not bit-exact between themselves or with the 3GPP
reference implementation (Visual Studio 2018, Release mode).
Table A.8: List of Reference Implementations
Name Platform Compiler Optimization OS
* * *
aarch64_gnu-gcc-8_-armv8_O2 ARMv8 GCC v8 O2 Linux aarch64_gnu-gcc-8_armv8_O3
ARMv8 GCC v8 O3 Linux clang-6_armv8 _O2 ARMv8 Clang v6 O2 with FMA Linux
clang-6_armv8_O3 ARMv8 Clang v6 O3 with FMA Linux clang-6.0_x86_64_O2 x86_64
Clang v6 O2 Linux gcc-7_i686_-O0 i686 GCC v7 O0 Linux gcc-7_i686_-O1 i686 GCC
v7 O1 Linux gcc-7_i686_-O2 i686 GCC v7 O2 Linux gcc-7_i686_-O3 i686 GCC v7 O3
Linux icc-19_x86_64_avx2 x86_64 ICC v19 O3 with FMA Linux
#
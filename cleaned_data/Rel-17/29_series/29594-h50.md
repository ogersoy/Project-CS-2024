# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present specification provides the stage 3 definition of the Spending
Limit Control Service of the 5G System.
The 5G System Architecture is defined in 3GPP TS 23.501 [2]. The stage 2
definition and related procedures for the Spending Limit Control Service are
specified in 3GPP TS 23.502 [3] and 3GPP TS 23.503 [6].
The 5G System stage 3 call flows are provided in 3GPP TS 29.513 [12].
The Technical Realization of the Service Based Architecture and the Principles
and Guidelines for Services Definition are specified in 3GPP TS 29.500 [4] and
3GPP TS 29.501 [5].
The Spending Limit Control Service is provided by the Charging Function (CHF)
and enables the NF service consumer to retrieve policy counter status
information. The internal CHF functionality for policy counter management
provisioning is specified in 3GPP TS 32.240 [7].
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[3] 3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".
[4] 3GPP TS 29.500: \"5G System; Technical Realization of Service Based
Architecture; Stage 3\".
[5] 3GPP TS 29.501: \"5G System; Principles and Guidelines for Services
Definition; Stage 3\".
[6] 3GPP TS 23.503: \"Policy and Charging Control Framework for the 5G System;
Stage 2\".
[7] 3GPP TS 32.240: \"Charging architecture and principles; Stage 2\".
[8] IETF RFC 7540: \"Hypertext Transfer Protocol Version 2 (HTTP/2)\".
[9] OpenAPI: \"OpenAPI Specification Version 3.0.0\",
https://spec.openapis.org/oas/v3.0.0.
[10] IETF RFC 8259: \"The JavaScript Object Notation (JSON) Data Interchange
Format\".
[11] 3GPP TS 29.571: \"5G System; Common Data Types for Service Based
Interfaces\".
[12] 3GPP TS 29.513: \"5G System; Policy and Charging Control signalling flows
and QoS parameter mapping; Stage 3\".
[13] IETF RFC 7807: \"Problem Details for HTTP APIs\".
[14] 3GPP TS 33.501: \"Security architecture and procedures for 5G system\".
[15] IETF RFC 6749: \"The OAuth 2.0 Authorization Framework\".
[16] 3GPP TS 29.510: \"5G System; Network Function Repository Services; Stage
3\".
[17] 3GPP TR 21.900: \"Technical Specification Group working methods\".
[18] 3GPP TS 29.512: \"5G System; Session Management Policy Control Service;
Stage 3\".
[19] 3GPP TS 23.316: \"Wireless and wireline convergence access support for
the 5G System (5GS)\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
3GPP TR 21.905 [1].
**Nchf:** Service-based interface exhibited by Charging Function.
**Policy counter:** A mechanism within the CHF to track spending applicable to
a subscriber.
**Policy counter identifier:** A reference to a policy counter in the CHF for
a subscriber.
**Policy counter status:** A label whose values are not standardized and that
is associated with a policy counter\'s value relative to the spending limit(s)
(the number of possible policy counter status values for a policy counter is
one greater than the number of thresholds associated with that policy counter,
i.e. policy counter status values describe the status around the thresholds).
This is used to convey information relating to subscriber spending from CHF to
PCF. Specific labels are configured jointly in CHF and PCF.
**Spending limit:** A spending limit is the usage limit of a policy counter
(e.g. monetary, volume, duration) that a subscriber is allowed to consume.
**Spending limit report: A notification, containing the current policy counter
status generated from the CHF to the PCF.**
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
5G-RG 5G Residential Gateway
CCS Converged Charging System
CHF Charging Function
CTS Charging Trigger Function
FN-RG Fixed Network Residential Gateway
GCI Global Cable Identifier
GLI Global Line Identifier
GPSI Generic Public Subscription Identifier
NF Network Function
NRF Network Repository Function
PCF Policy Control Function
SUPI Subscription Permanent Identifier
W-AGF Wireline Access Gateway Function
# 4 Nchf_SpendingLimitControl Service
## 4.1 Service Description
### 4.1.1 Overview
The Nchf_SpendingLimitControl service, as defined in 3GPP TS23.502 [3] and
3GPP TS23.503 [6], is provided by the Charging Function (CHF).
The Nchf_SpendingLimitControl service enables the NF service consumer (e.g.
PCF) to retrieve policy counter status information and spending limit
reporting per UE from the CHF.
If the spending limit reporting is no more required, the
Nchf_SpendingLimitControl service enables the NF service consumer to
unsubscribe from the reporting.
Nchf_SpendingLimitControl Service applies to the cases where the PCF interacts
with the CHF in the non-roaming scenario, and the H-PCF interacts with the
H-CHF in the home-routed scenario.
### 4.1.2 Service Architecture
The Nchf_SpendingLimitControl service is provided by the CHF and consumed by
the NF service consumer (e.g. PCF), as shown in figure 4.1.2-1 for the SBI
representation model and in figure 4.1.2-2 for the reference point
representation model.
Figure 4.1.2-1: Nchf_SpendingLimitControl service architecture, SBI
representation
Figure 4.1.2-2: Nchf_SpendingLimitControl service architecture, reference
point representation
### 4.1.3 Network Functions
#### 4.1.3.1 Charging Function (CHF)
The Charging Function (CHF) is part of the Converged Charging System (CCS).
The CHF provides the Nchf_SpendingLimitControl service and is specified in
3GPP TS 32.240 [7].
#### 4.1.3.2 NF Service Consumers
The PCF is the known NF service consumer, as defined in 3GPP TS 23.502 [3].
The NF service consumer accesses policy counter status information relating to
the subscriber spending from the CHF and uses the status of each relevant
policy counter as input to its policy decision as required by the decision
logic.
## 4.2 Service Operations
### 4.2.1 Introduction
The service operations defined for the Nchf_SpendingLimitControl service are
shown in table 4.2.1-1.
_Table 4.2.1-1: Nchf_SpendingLimitControl Service Operations_
* * *
**Service operation name** **Description** **Initiated by**
Nchf_SpendingLimitControl_Subscribe This service operation is used by NF
service consumers to subscribe to notification of changes in the status of the
policy counters available and retrieval of the status of the policy counters
for which subscription is accepted. NF service consumer (e.g. PCF)
Nchf_SpendingLimitControl_Unsubscribe This service operation is used by NF
service consumers to unsubscribe from notification of changes in the status of
all policy counters. NF service consumer (e.g. PCF)
Nchf_SpendingLimitControl_Notify This service operation is used by the CHF to
notify the NF service consumers about the change of the status of the
subscribed policy counters. Alternatively, it can be used by the CHF to notify
that the status for one or multiple subscribed policy counter will change in
the future, indicating the time when this change shall be applied.
Alternatively, it is also used to notify the NF service consumer of the
removal of a subscriber from the CHF system for the purpose that the NF
service consumer can terminate the subscriptions of all policy counters of the
subscriber. CHF
* * *
### 4.2.2 Nchf_SpendingLimitControl_Subscribe service operation
#### 4.2.2.1 General
The Nchf_SpendingLimitControl_Subscribe service operation is used by the NF
service consumer to subscribe to notification of changes in the status of the
policy counters available and to retrieve the status of the policy counters
for which the subscription is accepted. The following procedures are related
to the subscribe service operation:
\- initial spending limit retrieval; and
\- intermediate spending limit report retrieval.
#### 4.2.2.2 Initial spending limit retrieval
Figure 4.2.2.2-1 shows the scenario where the NF service consumer sends a
request to the CHF to retrieve the status of policy counters available at the
CHF and to subscribe to spending limit reporting (see also 3GPP TS 23.502 [3],
figure 4.16.8.2.1).
Figure 4.2.2.2-1: NF service consumer subscribes to retrieve policy counter
status and spending limit reporting
The NF service consumer shall send an HTTP POST request to the resource
\"{apiRoot}/nchf-spendinglimitcontrol/v1/subscriptions\" representing the
\"Spending Limit Retrieval Subscriptions\", as shown in figure 4.2.2.2-1, step
1, to create a subscription for retrieval of the policy counter status and
spending limit reporting.
The \"SpendingLimitContext\" data structure provided in the request body shall
include:
\- the Subscription Permanent Identifier (SUPI) encoded in the \"supi\"
attribute;
\- the notification correlation target address encoded in the \"notifUri\"
attribute; and
\- If the feature \"NotificationCorrelation\" is supported, a Notification
Correlation Identifier assigned by the NF service consumer for the requested
notifications encoded in the \"notifId\" attribute, if the \"notifUri\" does
not encode within the provided URI the notification correlation Id.
NOTE: NF service consumer (e.g. PCF) ensures the combination of notifUri and
notifId is unique per subscription in the whole network, including multiple
network slices scenario.
The \"SpendingLimitContext\" data structure provided in the request body may
include:
\- the General Public Subscription Identifier (GPSI) encoded in the \"gpsi\"
attribute;
\- Event Filter information \"list of policy counter identifier(s)\" encoded
in the \"policyCounterIds\" attribute. The \"policyCounterIds\" attribute
shall contain the list of policy counter identifiers to be subscribed to. If
the \"policyCounterIds\" attribute is omitted, the subscription is to all
available policy counters; and
\- when the feature \"SubscriptionExpirationTimeControl\" is supported by the
NF service consumer, the NF service consumer may include an expiry time
encoded in the \"expiry\" attribute, representing the time up to which the
subscription is desired to be kept active. When the \"expiry\" attribute is
omitted in the request, it represents the NF service consumer does not have
any time constraint in the duration of the subscription.
If the CHF cannot successfully fulfil the received HTTP POST request due to an
internal CHF error or due to the error in the HTTP POST request, the CHF shall
send the HTTP error response as specified in clause 5.7.
If the subscriber specified in the request is unknown to the CHF, the CHF
shall indicate in an HTTP \"400 Bad Request\" response the cause for the
rejection with the \"cause\" attribute set to \"USER_UNKNOWN\".
If the CHF has no available policy counters specified for the subscriber, the
CHF shall indicate in an HTTP \"400 Bad Request\" response the cause for the
rejection with the \"cause\" attribute set to \"NO_AVAILABLE_POLICY_COUNTERS
\".
If one or more policy counters specified in the request in the
\"policyCounterIds\" attribute are unknown to the CHF, and the CHF is
configured to reject request, the CHF shall indicate in an HTTP \"400 Bad
Request\" response the cause for the rejection with the \"cause\" attribute
set to \"UNKNOWN_POLICY_COUNTERS\" and the unknown policy counter identifiers
within the \"invalidParams\" attribute.
Otherwise, upon the reception of an HTTP POST request the CHF shall:
\- create a new subscription resource, which contains the list of the policy
counters included in the \"policyCounterIds\" attribute, or if the
\"policyCounterIds\" attribute is omitted, all the policy counters of the
subscriber;
\- assign a subscriptionId; and
\- store the subscription resource.
After the CHF created an \"Individual Spending Limit Retrieval Subscription\"
resource, the CHF shall respond with \"201 Created\" response with a Location
header field containing the URI of the created subscription resource and the
message body containing a representation of the created subscription, as shown
in figure 4.2.2.2-1, step 2.
The SpendingLimitStatus data structure provided in the response body shall
include the status of the requested subscribed policy counters in the
\"statusInfos\" map, where every PolicyCounterInfo entry shall contain:
\- the policy counter identifier in the \"policyCounterId\" attribute; and
\- the policy counter status in the \"currentStatus\" attribute.
When a requested policy counter identifier is known by the CHF, but it is not
applicable to the subscriber (e.g. not provisioned), the CHF may include it in
the \"statusInfos\" map, and set the \"currentStatus\" attribute to an
operator configured policy counter status to indicate this to the NF service
consumer.
When one or more policy counters specified in the request in the
\"policyCounterIds\" attribute are unknown to the CHF, and the CHF is
configured to accept the request, the CHF may include the unknown policy
counters in the \"statusInfos\" map, and set the \"currentStatus\" attribute
to an operator configured policy counter status to indicate this to the NF
service consumer.
A PolicyCounterInfo data structure may include the list of the pending policy
counter statuses and their activation times within the attribute
\"penPolCounterStatuses\".
When the feature \"SubscriptionExpirationTimeControl\" is supported, the CHF
may include the \"expiry\" attribute, representing the time up to which the
subscription shall be kept active. If an expiry time was included in the
subscription request, then the expiry time shall be returned in the response,
and the value shall be less than or equal to the requested value. When the
\"expiry\" attribute is omitted in the request and in the response, it
represents neither the CHF or the NF service consumer have time constrains in
the duration of the subscription and shall be kept active till the explicit
subscription termination as described in clause 4.2.3.2 and clause 4.2.4.3.
NOTE 1: If the NF Service Consumer does not include a expiry time in the
request, the CHF can include a expiry time in the response that represents the
time after which the subscription becomes invalid.
NOTE 2: Once the subscription expires, if the NF service consumer wants to
keep receiving notifications, it needs to create a new subscription in the
CHF, as specified in this clause.
#### 4.2.2.3 Intermediate spending limit report retrieval
Figure 4.2.2.3-1 shows the scenario where the NF service consumer sends a
request to the CHF to modify the existing subscription to the retrieval of
spending limit reports (see also 3GPP TS 23.502 [3], figure 4.16.8.3.1). The
NF service consumer can add or remove policy counters to retrieve the status
of the counters.
Figure 4.2.2.3-1: NF service consumer modifies the subscription to retrieve
policy counter status and spending limit reporting
The NF service consumer shall send an HTTP PUT request to the resource
\"{apiRoot}/nchf-spendinglimitcontrol/v1/subscriptions/{subscriptionId}\"
representing an existing \"Individual Spending Limit Subscription\" resource,
as shown in figure 4.2.2.3-1, step 1, to modify the subscription for retrieval
of the policy counter status and spending limit reporting.
The \"SpendingLimitContext\" data structure provided in the request body:
\- shall include the Subscription Permanent Identifier (SUPI) encoded in the
\"supi\" attribute;
\- shall include the notification correlation target address encoded in the
\"notifUri\" attribute;
\- if the feature \"NotificationCorrelation\" is supported, a Notification
Correlation Identifier assigned by the NF service consumer for the requested
notifications encoded in the \"notifId\" attribute, if the \"notifUri\" does
not encode within the provided URI the notification correlation Id.
NOTE 1: If the notification correlation target address is not changed the
previously provided notification correlation target address is included in the
\"notifUri\" attribute. If the Notification Correlation Id is not changed the
previously provided Notification Correlation Id is included in the \"notifId\"
attribute.
\- if the General Public Subscription Identifier (GPSI) was provided within
the initial spending limit retrieval procedure, described in clause 4.2.2.2,
shall include the GPSI encoded in the \"gpsi\" attribute; and
\- may include Event Filter information as a \"list of policy counter
identifier(s)\" encoded in the \"policyCounterIds\" attribute. The
\"policyCounterIds\" attribute shall contain the updated list of policy
counter identifiers to be subscribed to. If the \"policyCounterIds\" attribute
is omitted, the subscription is updated to all available policy counters; and
\- when the feature \"SubscriptionExpirationTimeControl\" is supported, may
include an updated expiry time encoded in the \"expiry\" attribute to update
the duration of the subscription, representing the updated time up to which
the subscription is desired to be kept active. When the \"expiry\" attribute
is omitted in the request, it represents the NF service consumer update does
not have any time constraint from this moment on in the duration of the
subscription.
NOTE 2: The \"notifUri\" attribute within the SpendingLimitContext data
structure can be modified to request that subsequent notifications are sent to
a new NF service consumer.
When the \"policyCounterIds\" attribute is present in the subscription
request, this list of policy counters overrides a previously provisioned list.
After the CHF modified an \"Individual Spending Limit Retrieval Subscription\"
resource, the CHF shall respond with \"200 OK\" response with the message body
containing a representation of the modified subscription, as shown in figure
4.2.2.3-1, step 2.
The SpendingLimitStatus data structure provided in the response body, when the
feature \"SubscriptionExpirationTimeControl\" is not supported, shall include
the status of the requested subscribed policy counters in the \"statusInfos\"
map, where every PolicyCounterInfo entry shall contain:
\- the policy counter identifier in the \"policyCounterId\" attribute; and
\- the policy counter status in the \"currentStatus\" attribute.
When a requested policy counter identifier is known by the CHF, but it is not
applicable to the subscriber (e.g. not provisioned), the CHF may include it in
the \"statusInfos\" map, and set the \"currentStatus\" attribute to an
operator configured policy counter status to indicate this to the NF service
consumer.
When one or more policy counters specified in the request in the
\"policyCounterIds\" attribute are unknown to the CHF, and the CHF is
configured to accept the request, the CHF may include the unknown policy
counters in the \"statusInfos\" map, and set the \"currentStatus\" attribute
to an operator configured policy counter status to indicate this to the NF
service consumer.
A PolicyCounterInfo data structure may include the list of the pending policy
counter statuses and their activation times within the attribute
\"penPolCounterStatuses\".
When the feature \"SubscriptionExpirationTimeControl\" is supported, the CHF
may include the \"expiry\" attribute, representing the time up to which the
subscription shall be kept active. If an expiry time was included in the
subscription update request, then the expiry time shall be returned in the
response, and the value returned should be less than or equal to the value in
the request. When the \"expiry\" attribute is omitted in the request and in
the response, it represents that the subscription shall be considered valid
without an expiry time.
NOTE 3: When the NF service consumer does not include an expiry time in the
request, the CHF can include an expiry time in the response that represents an
update of the previously provided duration of the subscription.
NOTE 4: Once the subscription expires, if the NF service consumer wants to
keep receiving notifications, it needs to create a new subscription in the
CHF, as specified in clause 4.2.2.2.
If errors occur when processing the HTTP PUT request, the CHF shall send an
HTTP error response as specified in clause 5.7.
If the feature \"ES3XX\" is supported, and the CHF determines the received
HTTP PUT request needs to be redirected, the CHF shall send an HTTP redirect
response as specified in clause 6.10.9 of 3GPP TS 29.500 [4].
If the CHF has no available policy counters specified for the subscriber, the
CHF shall indicate in an HTTP \"400 Bad Request\" response the cause for the
rejection with the \"cause\" attribute set to \"NO_AVAILABLE_POLICY_COUNTERS
\".
If one or more policy counters specified in the PUT request in the
\"policyCounterIds\" attribute are unknown to the CHF, and the CHF is
configured to reject request, the CHF shall indicate in an HTTP \"400 Bad
Request\" response the cause for the rejection with the \"cause\" attribute
set to \"UNKNOWN_POLICY_COUNTERS\" and the unknown policy counter identifiers
within the \"invalidParams\" attribute. The PUT request shall not take effect,
and the CHF shall maintain the Individual Spending Limit Retrieval resource.
NOTE 5: In order to avoid misbehaviors due to the policy counters status
maintained in the CHF and the NF service consumer, the NF service consumer can
terminate the subscription invoking the Nchf_SpendingLimitControl_Unsubscribe
service operation in clause 4.2.3.2.
NOTE 6: The NF service consumer can terminate the subscription invoking the
Nchf_SpendingLimitControl_Unsubscribe service operation in clause 4.2.3.2, or
maintain subscription assuming that further available policy counters will be
notified.
### 4.2.3 Nchf_SpendingLimitControl_Unsubscribe service operation
#### 4.2.3.1 General
The Nchf_SpendingLimitControl_Unsubscribe service operation is used by the NF
service consumer to cancel the subscription of status changes for all the
policy counters available at the CHF. That means the complete cancellation of
the spending limit reporting procedure.
#### 4.2.3.2 Unsubscribe from spending limit reporting
Figure 4.2.3.2-1 shows the scenario where the NF service consumer sends a
request to the CHF to unsubscribe from spending limit reporting (see also 3GPP
TS 23.502 [3] figure 4.16.8.4.1).
Figure 4.2.3.2-1: NF service consumer unsubscribes from spending limit
reporting
The NF service consumer shall invoke the Nchf_SpendingLimitControl_Unsubscribe
service operation to unsubscribe from the spending limit reporting (status
change for all policy counters available is no more required). The NF service
consumer shall send an HTTP DELETE request to the resource \"{apiRoot}/nchf-
spendinglimitcontrol/v1/subscriptions/{subscriptionId}\", whereby the
\"{subscriptionId}\" is the identification of the existing subscription to be
deleted. Upon the reception of an HTTP DELETE request the CHF removes the
corresponding subscription.
If the HTTP DELETE request is accepted by the CHF, it shall respond with \"204
No Content\" as shown in figure 4.2.3.2-1, step 2.
If the HTTP DELETE request is not accepted by the CHF (e.g. the HTTP DELETE
request is for a non-existent subscription), it shall indicate the appropriate
cause for the rejection in the HTTP response code or, if the feature \"ES3XX\"
is supported, an HTTP redirect response to the NF service consumer.
### 4.2.4 Nchf_SpendingLimitControl_Notify service operation
#### 4.2.4.1 General
The Nchf_SpendingLimitControl_Notify service operation is used by the CHF:
\- to notify the change of the status of the subscribed policy counters
available at the CHF for that subscriber; and/or
\- to provide one or more pending statuses for a subscribed policy counter
together with the time they shall be applied; and/or
\- to request the termination of the subscription of status changes for all
policy counters for a subscriber (e.g. the subscriber is removed from the CHF
system).
#### 4.2.4.2 Spending limit report
Figure 4.2.4.2-1 shows the scenario where the CHF sends a notification to the
NF service consumer, when it detects that the status of a policy counter(s)
has changed and the NF service consumer has subscribed to notifications of
changes in the status of this policy counter(s). The CHF can also notify the
NF service consumer that the status for one or multiple subscribed policy
counter will change and indicate this by providing the time when this change
shall be applied (see also 3GPP TS 23.502 [3], figure 4.16.8.5.1).
Figure 4.2.4.2-1: Spending limit reporting
The CHF shall send an HTTP POST request to the resource notification target
address (notifUri) of the NF service consumer received in the subscription
creation or modification, and shall append the \"notify\" segment path at the
end of the URI, to indicate the NF service consumer the notification of a
policy counter status change.
The SpendingLimitStatus data structure provided in the request body:
\- shall include the Subscriber Identity in the \"supi\" attribute;
\- shall include, if the feature \"NotificationCorrelation\" is supported, the
notification correlation ID in the \"notifId\" attribute if received in the
SpendingLimitContext data structure provided in the creation or update of the
subscription;
\- shall include, when the feature \"SubscriptionExpirationTimeControl\" is
not supported, Policy counters status in the \"statusInfos\" map, where every
PolicyCounterInfo entry shall include:
a. the \"policyCounterId\" attribute with the policy counter identifier; and
b. the \"currentStatus\" attribute with the new policy counter status when the
notification is triggered by a change in the policy counter status, or the
current policy counter status when the notification is triggered by a change
in the pending policy counter status(es); and
\- may include, when the feature \"SubscriptionExpirationTimeControl\" is
supported, the Policy counters status in the \"statusInfos\" map if at this
time there is change of policy counter status and/or the update of the expiry
time in the \"expiry\".
NOTE 1: When the feature \"SubscriptionExpirationTimeControl\" is supported,
and the CHF includes the update of the expiry time, if at this time there is
no change of policy counter status, the CHF does not include the
\"statusInfos\" attribute.
When a policy counter identifier is no longer applicable to the subscriber
(e.g. becomes not provisioned), but still exists in the Individual Spending
Control Retrieval resource, the CHF may include it in the \"statusInfos\" map,
and set the \"currentStatus\" attribute to an operator configured policy
counter status to indicate this to the NF service consumer.
A PolicyCounterInfo data structure may include the list of pending policy
counter statuses and their activation times within the attribute
\"penPolCounterStatuses.
When the feature \"SubscriptionExpirationTimeControl\" is supported, the CHF
may include the \"expiry\" attribute, representing an update in the time up to
which the subscription shall be kept active. When the \"expiry\" attribute is
omitted, it represents that the previously agreed duration of the subscription
remains valid.
NOTE 2: Once the subscription expires, if the NF Service Consumer wants to
keep receiving notifications, it needs to create a new subscription in the
CHF, as specified in clause 4.2.2.2.
The CHF shall not send the policy counter status for the same policy counter
until it received the response of the previous status report of the policy
counter.
If the HTTP POST notification request message is accepted by the NF service
consumer, it shall acknowledge the receipt of the event notification with a
\"204 No Content\" response, as shown in figure 4.2.4.2-1, step 2.
If errors occur when processing the HTTP POST request, the NF service consumer
shall send an HTTP error response as specified in clause 5.7.
If the feature \"ES3XX\" is supported, and the NF service consumer determines
the received HTTP POST request needs to be redirected, the NF service consumer
shall send an HTTP redirect response as specified in clause 6.10.9 of 3GPP TS
29.500 [4].
If the NF service consumer receives an HTTP POST notification request message
for an intermediate spending limit report transaction from the CHF in which no
pending policy counter statuses and their activation times are included for a
policy counter, i.e., the \"penPolCounterStatuses\" attribute is not included,
the NF service consumer shall cancel all previously provided pending policy
counter statuses and their activation times for this policy counter. If the NF
service consumer receives an HTTP POST notification request message for an
intermediate spending limit report transaction from the CHF containing pending
policy counter statuses and their activation times for a previously provided
policy counter, the NF service consumer shall replace the existing pending
policy counter statuses and their activation times if any.
If the NF service consumer receives an HTTP POST request for spending limit
report initiated by the CHF while it has an ongoing intermediate spending
limit report retrieval transaction with the CHF, the NF service consumer shall
update the policy counter information based on the HTTP POST request for
spending limit report. When the corresponding response for the ongoing
intermediate spending limit report retrieval transaction is eventually
received, the NF service consumer shall only update policy counter information
for counters that were not provided in the previously received HTTP POST
request for spending limit report.
#### 4.2.4.3 Subscription termination request by CHF
Figure 4.2.4.3-1 shows the scenario where the CHF sends a notification to the
NF service consumer, when it requests the termination of the subscription of
status changes for all policy counters for a subscriber.
Figure 4.2.4.3-1: Subscription termination request by CHF
The CHF shall send an HTTP POST request to the resource notification target
address (notifUri) of the NF service consumer received in the subscription
creation or modification and shall append the \"terminate\" segment path at
the end of the URI, to indicate the subscription termination and the removal
of the Individual Spending Limit Retrieval Subscription resource to the NF
service consumer.
The SubscriptionTerminationInfo data structure provided in the request body
shall include the subscriber identification encoded in the \"supi\" attribute,
if the feature \"NotificationCorrelation\" is supported, the Notification
Correlation Id in the \"notifId\" attribute if received and may include
subscription termination information in the \"termCause\" attribute.
When the termination request is because the subscriber identified by the SUPI
has been removed from the CHF, the CHF shall set the \"termCause\" attribute
to \"REMOVED_SUBSCRIBER\".
If the HTTP POST notification request message is accepted by the NF service
consumer, it shall remove the subscription to notifications of all policy
counters for a subscriber and shall acknowledge the receipt of the event
notification with a \"204 No Content\" response, as shown in figure 4.2.4.3-1,
step 2.
If errors occur when processing the HTTP POST request, the NF service consumer
shall send an HTTP error response as specified in clause 5.7.
If the feature \"ES3XX\" is supported, and the NF service consumer determines
the received HTTP POST request needs to be redirected, the NF service consumer
shall send an HTTP redirect response as specified in clause 6.10.9 of 3GPP TS
29.500 [4].
# 5 Nchf_SpendingLimitControl Service API
## 5.1 Introduction
The Nchf_SpendingLimitControl service shall use the Nchf_SpendingLimitControl
API.
The API URI of the Nchf_SpendingLimitControl API shall be:
**{apiRoot}/\ /\**
The request URIs used in HTTP requests from the NF service consumer towards
the CHF shall have the Resource URI structure defined in clause 4.4.1 of 3GPP
TS 29.501 [5], i.e.:
> **{apiRoot}/\ /\/\**
with the following components:
\- The {apiRoot} shall be set as described in 3GPP TS29.501 [5].
\- The **\ ** shall be \"nchf-spendinglimitcontrol\".
\- The **\ ** shall be \"v1\".
\- The **\ ** shall be set as described in
clause 5.3.
## 5.2 Usage of HTTP
### 5.2.1 General
HTTP/2, IETF RFC 7540 [8], shall be used as specified in clause 5.2 of 3GPP TS
29.500 [4].
HTTP/2 shall be transported as specified in clause 5.3 of 3GPP TS 29.500 [4].
The OpenAPI [9] specification of HTTP messages and content bodies for the
Nchf_SpendingLimitControl service is contained in Annex A.
### 5.2.2 HTTP standard headers
#### 5.2.2.1 General
See clause 5.2.2 of 3GPP TS 29.500 [4] for the usage of HTTP standard headers.
#### 5.2.2.2 Content type
JSON, IETF RFC 8259 [10], shall be used as content type of the HTTP bodies
specified in the present specification, as specified in clause 5.4 of 3GPP TS
29.500 [4]. The use of the JSON format shall be signalled by the content type
\"application/json\".
\"Problem Details\" JSON object shall be used to indicate additional details
of the error in a HTTP response body and shall be signalled by the content
type \"application/problem+json\", as defined in IETF RFC 7807 [13].
### 5.2.3 HTTP custom headers
#### 5.2.3.1 General
The Nchf_SpendingLimitControl API shall support HTTP custom header fields
specified in clause 5.2.3.2 of 3GPP TS 29.500 [4] and may support HTTP custom
header fields specified in clause 5.2.3.3 of 3GPP TS 29.500 [4].
In this Release of the specification, no specific custom headers are defined
for the Nchf_SpendingLimitControl API.
## 5.3 Resources
### 5.3.1 Resource Structure
This clause describes the structure for the Resource URIs and the resources
and methods used for the service.
Figure 5.3.1-1 shows the resource URI structure of the
Nchf_SpendingLimitControl API.
Figure 5.3.1-1: Resource URI structure of the Nchf_SpendingLimitControl API
Table 5.3.1-1 provides an overview of the resources and applicable HTTP
methods.
Table 5.3.1-1: Resources and methods overview
* * *
Resource name Resource URI HTTP method or custom operation Description
Spending Limit Retrieval Subscriptions /subscriptions POST Creates a new
individual spending limit retrieval subscription. Individual Spending Limit
Retrieval Subscription /subscriptions/{subscriptionId} PUT Modifies an
existing subscription (e.g. addition of additional policy counters). DELETE
Deletes an individual subscription.
* * *
### 5.3.2 Resource: Spending Limit Retrieval Subscriptions (Collection)
#### 5.3.2.1 Description
This resource represents the collection of Nchf_SpendingLimitControl service
subscriptions at a given CHF.
#### 5.3.2.2 Resource definition
Resource URI: **{apiRoot}/nchf-spendinglimitcontrol/v1/subscriptions**
This resource shall support the resource URI variables defined in table
5.3.2.2-1.
Table 5.3.2.2-1: Resource URI variables for this resource
* * *
Name Data type Definition apiRoot string See clause 5.1
* * *
#### 5.3.2.3 Resource Standard Methods
##### 5.3.2.3.1 POST
This method shall support the URI query parameters specified in table
5.3.2.3.1-1.
Table 5.3.2.3.1-1: URI query parameters supported by the POST method on this
resource
* * *
Name Data type P Cardinality Description n/a
* * *
This method shall support the request data structures specified in table
5.3.2.3.1-2 and the response data structures and response codes specified in
table 5.3.2.3.1-3.
Table 5.3.2.3.1-2: Data structures supported by the POST Request Body on this
resource
* * *
Data type P Cardinality Description SpendingLimitContext M 1 Contains the
information for the creation of a new individual spending limit retrieval
subscription.
* * *
Table 5.3.2.3.1-3: Data structures supported by the POST Response Body on this
resource
+---------------+---+-------------+---------------+---------------+ | Data type | P | Cardinality | Response | Description | | | | | codes | | +---------------+---+-------------+---------------+---------------+ | Spendi | M | 1 | 201 Created | The spending | | ngLimitStatus | | | | limit | | | | | | subscription | | | | | | was created | | | | | | and spending | | | | | | limit reports | | | | | | are provided. | +---------------+---+-------------+---------------+---------------+ | P | O | 0..1 | 400 Bad | (NOTE 2) | | roblemDetails | | | Request | | +---------------+---+-------------+---------------+---------------+ | NOTE 1: In | | | | | | addition, the | | | | | | HTTP status | | | | | | codes which | | | | | | are specified | | | | | | as mandatory | | | | | | in | | | | | | ta | | | | | | ble 5.2.7.1-1 | | | | | | of | | | | | | 3GPP TS | | | | | | 29.500 [4] | | | | | | for the POST | | | | | | method shall | | | | | | also apply. | | | | | | | | | | | | NOTE 2: In | | | | | | addition to | | | | | | protocol and | | | | | | application | | | | | | errors which | | | | | | are specified | | | | | | in clause | | | | | | 5.2.7.2 of | | | | | | 3GPP TS | | | | | | 29.500 [4], | | | | | | specific | | | | | | errors are | | | | | | described in | | | | | | clause 5.7. | | | | | +---------------+---+-------------+---------------+---------------+
Table 5.3.2.3.1-4: Headers supported by the 201 Response Code on this resource
* * *
Name Data type P Cardinality Description Location string M 1 Contains the URI
of the newly created resource, according to the structure: {apiRoot}/nchf-
spendinglimitcontrol/v1/subscriptions/{subscriptionId}
* * *
#### 5.3.2.4 Resource Custom Operations
None.
### 5.3.3 Resource: Individual Spending Limit Retrieval Subscription
(Document)
#### 5.3.3.1 Description
This resource represents an individual Nchf_SpendingLimitControl service
subscription at a given CHF.
#### 5.3.3.2 Resource definition
Resource URI: **{apiRoot}/nchf-
spendinglimitcontrol/v1/subscriptions/{subscriptionId}**
This resource shall support the resource URI variables defined in table
5.3.3.2-1.
Table 5.3.3.2-1: Resource URI variables for this resource
* * *
Name Data type Definition apiRoot string See clause 5.1 subscriptionId string
Identifies a subscription to the CHF spending limit control retrieval service.
* * *
#### 5.3.3.3 Resource Standard Methods
##### 5.3.3.3.1 PUT
This method shall support the URI query parameters specified in table
5.3.3.3.1-1.
Table 5.3.3.3.1-1: URI query parameters supported by the PUT method on this
resource
* * *
Name Data type P Cardinality Description n/a
* * *
This method shall support the request data structures specified in table
5.3.3.3.1-2 and the response data structures and response codes specified in
table 5.3.3.3.1-3.
Table 5.3.3.3.1-2: Data structures supported by the PUT Request Body on this
resource
* * *
Data type P Cardinality Description SpendingLimitContext M 1 Modifies the
existing individual spending limit retrieval subscription.
* * *
Table 5.3.3.3.1-3: Data structures supported by the PUT Response Body on this
resource
+---------------+---+-------------+---------------+---------------+ | Data type | P | Cardinality | Response | Description | | | | | codes | | +---------------+---+-------------+---------------+---------------+ | Spendi | M | 1 | 200 OK | Successful | | ngLimitStatus | | | | case: The | | | | | | individual | | | | | | spending | | | | | | limit | | | | | | subscription | | | | | | was modified | | | | | | and spending | | | | | | limit reports | | | | | | are provided. | +---------------+---+-------------+---------------+---------------+ | Red | O | 0..1 | 307 Temporary | Temporary | | irectResponse | | | Redirect | redirection, | | | | | | during | | | | | | Individual | | | | | | Spending | | | | | | Limit | | | | | | Retrieval | | | | | | Subscription | | | | | | modification. | | | | | | The response | | | | | | shall include | | | | | | a Location | | | | | | header field | | | | | | containing an | | | | | | alternative | | | | | | URI of the | | | | | | resource | | | | | | located in an | | | | | | alternative | | | | | | CHF (service) | | | | | | instance. | | | | | | | | | | | | Applicable if | | | | | | the feature | | | | | | \"ES3XX\" is | | | | | | supported. | +---------------+---+-------------+---------------+---------------+ | Red | O | 0..1 | 308 Permanent | Permanent | | irectResponse | | | Redirect | redirection, | | | | | | during | | | | | | Individual | | | | | | Spending | | | | | | Limit | | | | | | Retrieval | | | | | | Subscription | | | | | | modification. | | | | | | The response | | | | | | shall include | | | | | | a Location | | | | | | header field | | | | | | containing an | | | | | | alternative | | | | | | URI of the | | | | | | resource | | | | | | located in an | | | | | | alternative | | | | | | CHF (service) | | | | | | instance. | | | | | | | | | | | | Applicable if | | | | | | the feature | | | | | | \"ES3XX\" is | | | | | | supported. | +---------------+---+-------------+---------------+---------------+ | P | O | 0..1 | 400 Bad | (NOTE 2) | | roblemDetails | | | Request | | +---------------+---+-------------+---------------+---------------+ | NOTE 1: In | | | | | | addition, the | | | | | | HTTP status | | | | | | codes which | | | | | | are specified | | | | | | as mandatory | | | | | | in | | | | | | ta | | | | | | ble 5.2.7.1-1 | | | | | | of | | | | | | 3GPP TS | | | | | | 29.500 [4] | | | | | | for the PUT | | | | | | method shall | | | | | | also apply. | | | | | | | | | | | | NOTE 2: In | | | | | | addition to | | | | | | protocol and | | | | | | application | | | | | | errors which | | | | | | are specified | | | | | | in | | | | | | c | | | | | | lause 5.2.7.2 | | | | | | of | | | | | | 3GPP TS | | | | | | 29.500 [4], | | | | | | specific | | | | | | errors are | | | | | | described in | | | | | | clause 5.7. | | | | | +---------------+---+-------------+---------------+---------------+
Table 5.3.3.3.1-4: Headers supported by the 307 Response Code on this resource
* * *
Name Data type P Cardinality Description Location string M 1 An alternative
URI of the resource located in an alternative CHF (service) instance. 3gpp-
Sbi-Target-Nf-Id string O 0..1 Identifier of the target NF (service) instance
towards which the request is redirected
* * *
Table 5.3.3.3.1-5: Headers supported by the 308 Response Code on this resource
* * *
Name Data type P Cardinality Description Location string M 1 An alternative
URI of the resource located in an alternative CHF (service) instance. 3gpp-
Sbi-Target-Nf-Id string O 0..1 Identifier of the target NF (service) instance
towards which the request is redirected
* * *
##### 5.3.3.3.2 DELETE
This method shall support the URI query parameters specified in table
5.3.3.3.2-1.
Table 5.3.3.3.3-1: URI query parameters supported by the DELETE method on this
resource
* * *
Name Data type P Cardinality Description n/a
* * *
This method shall support the request data structures specified in table
5.3.3.3.2-2 and the response data structures and response codes specified in
table 5.3.3.3.2-3.
Table 5.3.3.3.2-2: Data structures supported by the DELETE Request Body on
this resource
* * *
Data type P Cardinality Description n/a
* * *
Table 5.3.3.3.2-3: Data structures supported by the DELETE Response Body on
this resource
+---------------+---+-------------+---------------+---------------+ | Data type | P | Cardinality | Response | Description | | | | | codes | | +---------------+---+-------------+---------------+---------------+ | n/a | | | 204 No | Successful | | | | | Content | case: The | | | | | | individual | | | | | | spending | | | | | | limit | | | | | | subscription | | | | | | matching the | | | | | | s | | | | | | ubscriptionId | | | | | | was deleted. | +---------------+---+-------------+---------------+---------------+ | Red | O | 0..1 | 307 Temporary | Temporary | | irectResponse | | | Redirect | redirection, | | | | | | during | | | | | | Individual | | | | | | Spending | | | | | | Limit | | | | | | Retrieval | | | | | | Subscription | | | | | | deletion. The | | | | | | response | | | | | | shall include | | | | | | a Location | | | | | | header field | | | | | | containing an | | | | | | alternative | | | | | | URI of the | | | | | | resource | | | | | | located in an | | | | | | alternative | | | | | | CHF (service) | | | | | | instance. | | | | | | | | | | | | Applicable if | | | | | | the feature | | | | | | \"ES3XX\" is | | | | | | supported. | +---------------+---+-------------+---------------+---------------+ | Red | O | 0..1 | 308 Permanent | Permanent | | irectResponse | | | Redirect | redirection, | | | | | | during | | | | | | Individual | | | | | | Spending | | | | | | Limit | | | | | | Retrieval | | | | | | Subscription | | | | | | deletion. The | | | | | | response | | | | | | shall include | | | | | | a Location | | | | | | header field | | | | | | containing an | | | | | | alternative | | | | | | URI of the | | | | | | resource | | | | | | located in an | | | | | | alternative | | | | | | CHF (service) | | | | | | instance. | | | | | | | | | | | | Applicable if | | | | | | the feature | | | | | | \"ES3XX\" is | | | | | | supported. | +---------------+---+-------------+---------------+---------------+ | NOTE: In | | | | | | addition, the | | | | | | HTTP status | | | | | | codes which | | | | | | are specified | | | | | | as mandatory | | | | | | in | | | | | | ta | | | | | | ble 5.2.7.1-1 | | | | | | of | | | | | | 3GPP TS | | | | | | 29.500 [4] | | | | | | for the | | | | | | DELETE method | | | | | | shall also | | | | | | apply. | | | | | +---------------+---+-------------+---------------+---------------+
Table 5.3.3.3.2-4: Headers supported by the 307 Response Code on this resource
* * *
Name Data type P Cardinality Description Location string M 1 An alternative
URI of the resource located in an alternative CHF (service) instance. 3gpp-
Sbi-Target-Nf-Id string O 0..1 Identifier of the target NF (service) instance
towards which the request is redirected
* * *
Table 5.3.3.3.2-5: Headers supported by the 308 Response Code on this resource
* * *
Name Data type P Cardinality Description Location string M 1 An alternative
URI of the resource located in an alternative CHF (service) instance. 3gpp-
Sbi-Target-Nf-Id string O 0..1 Identifier of the target NF (service) instance
towards which the request is redirected
* * *
## 5.4 Custom Operations without associated resources
None.
## 5.5 Notifications
### 5.5.1 General
Notification shall comply with clause 6.2 of 3GPP TS 29.500 [4] and clause
4.6.2.3 of 3GPP TS 29.501 [5].
Table 5.5.1-1: Notifications overview
* * *
Notification Callback URI HTTP method or custom operation Description (service
operation) Spending limit notification {notifUri}/notify notify (POST) Counter
Status changes notification. Subscription Termination {notifUri}/terminate
terminate (POST) Indication of subscription termination.
* * *
### 5.5.2 Spending limit notification
#### 5.5.2.1 Description
The spending limit notification is used by the CHF to notify the change of the
status of the subscribed policy counters for a subscriber and/or to provide
one or more pending statuses for a subscribed policy counter together with the
time they shall be applied.
#### 5.5.2.2 Target URI
The Callback URI **{notifUri}/notify** shall be used with the callback URI
variables defined in table 5.5.2.2-1.
Table 5.5.2.2-1: Callback URI variables
* * *
Name Data type Definition notifUri Uri The Notification Uri as assigned by the
NF service consumer during the subscription service operation and described
within the SpendingLimitContext data type (see table 5.6.2.2-1).
* * *
#### 5.5.2.3 Standard Methods
##### 5.5.2.3.1 POST
This method shall support the URI query parameters specified in table
5.5.2.3.1-1.
Table 5.5.2.3.1-1: URI query parameters supported by the POST method on this
resource
* * *
Name Data type P Cardinality Description n/a
* * *
This method shall support the request data structures specified in table
5.5.2.3.1-2 and the response data structures and response codes specified in
table 5.5.2.3.1-3.
Table 5.5.2.3.1-2: Data structures supported by the POST Request Body on this
resource
* * *
Data type P Cardinality Description SpendingLimitStatus M 1 Provides
information about the statuses of policy counters.
* * *
Table 5.5.2.3.1-3: Data structures supported by the POST Response Body on this
resource
+---------------+---+-------------+---------------+---------------+ | Data type | P | Cardinality | Response | Description | | | | | codes | | +---------------+---+-------------+---------------+---------------+ | n/a | | | 204 No | The receipt | | | | | Content | of the | | | | | | notification | | | | | | is | | | | | | acknowledged. | +---------------+---+-------------+---------------+---------------+ | Red | O | 0..1 | 307 Temporary | Temporary | | irectResponse | | | Redirect | redirection, | | | | | | during | | | | | | Spending | | | | | | limit report. | | | | | | The response | | | | | | shall include | | | | | | a Location | | | | | | header field | | | | | | containing an | | | | | | alternative | | | | | | URI | | | | | | representing | | | | | | the end point | | | | | | of an | | | | | | alternative | | | | | | NF consumer | | | | | | (service) | | | | | | instance | | | | | | where the | | | | | | notification | | | | | | should be | | | | | | sent. | | | | | | | | | | | | Applicable if | | | | | | the feature | | | | | | \"ES3XX\" is | | | | | | supported. | +---------------+---+-------------+---------------+---------------+ | Red | O | 0..1 | 308 Permanent | Permanent | | irectResponse | | | Redirect | redirection, | | | | | | during | | | | | | Spending | | | | | | limit report. | | | | | | The response | | | | | | shall include | | | | | | a Location | | | | | | header field | | | | | | containing an | | | | | | alternative | | | | | | URI | | | | | | representing | | | | | | the end point | | | | | | of an | | | | | | alternative | | | | | | NF consumer | | | | | | (service) | | | | | | instance | | | | | | where the | | | | | | notification | | | | | | should be | | | | | | sent. | | | | | | | | | | | | Applicable if | | | | | | the feature | | | | | | \"ES3XX\" is | | | | | | supported. | +---------------+---+-------------+---------------+---------------+ | NOTE: In | | | | | | addition, the | | | | | | HTTP status | | | | | | codes which | | | | | | are specified | | | | | | as mandatory | | | | | | in | | | | | | ta | | | | | | ble 5.2.7.1-1 | | | | | | of | | | | | | 3GPP TS | | | | | | 29.500 [4] | | | | | | for the POST | | | | | | method shall | | | | | | also apply. | | | | | +---------------+---+-------------+---------------+---------------+
Table 5.3.3.3.2-4: Headers supported by the 307 Response Code on this resource
* * *
Name Data type P Cardinality Description Location string M 1 An alternative
URI representing the end point of an alternative NF consumer (service)
instance towards which the notification should be redirected. 3gpp-Sbi-Target-
Nf-Id string O 0..1 Identifier of the target NF (service) instance towards
which the notification request is redirected
* * *
Table 5.3.3.3.2-5: Headers supported by the 308 Response Code on this resource
* * *
Name Data type P Cardinality Description Location string M 1 An alternative
URI representing the end point of an alternative NF consumer (service)
instance towards which the notification should be redirected. 3gpp-Sbi-Target-
Nf-Id string O 0..1 Identifier of the target NF (service) instance towards
which the notification request is redirected
* * *
### 5.5.3 Subscription Termination
#### 5.5.3.1 Description
The Subscription Termination request is used by the CHF to request the NF
service consumer the termination of the subscription to policy counter status
changes.
#### 5.5.3.2 Target URI
The Callback URI **{notifUri}/terminate** shall be used with the callback URI
variables defined in table 5.5.3.2-1.
Table 5.5.3.2-1: Callback URI variables
* * *
Name Data type Definition notifUri Uri The Notification Uri as assigned by the
NF service consumer during the subscription service operation and described
within the SpendingLimitContext data type (see table 5.6.2.2-1).
* * *
#### 5.5.3.3 Standard Methods
##### 5.5.3.3.1 POST
This method shall support the URI query parameters specified in table
5.5.3.3.1-1.
Table 5.5.3.3.1-1: URI query parameters supported by the POST method on this
resource
* * *
Name Data type P Cardinality Description n/a
* * *
This method shall support the request data structures specified in table
5.5.3.3.1-2 and the response data structures and response codes specified in
table 5.5.3.3.1-3.
Table 5.5.3.3.1-2: Data structures supported by the POST Request Body on this
resource
* * *
Data type P Cardinality Description SubscriptionTerminationInfo M 1 Provides
information about the deletion of the resource.
* * *
Table 5.5.3.3.1-3: Data structures supported by the POST Response Body on this
resource
+---------------+---+-------------+---------------+---------------+ | Data type | P | Cardinality | Response | Description | | | | | codes | | +---------------+---+-------------+---------------+---------------+ | n/a | | | 204 No | The receipt | | | | | Content | of the | | | | | | Notification | | | | | | is | | | | | | acknowledged. | +---------------+---+-------------+---------------+---------------+ | Red | O | 0..1 | 307 Temporary | Temporary | | irectResponse | | | Redirect | redirection, | | | | | | during | | | | | | subscription | | | | | | termination. | | | | | | The response | | | | | | shall include | | | | | | a Location | | | | | | header field | | | | | | containing an | | | | | | alternative | | | | | | URI | | | | | | representing | | | | | | the end point | | | | | | of an | | | | | | alternative | | | | | | NF consumer | | | | | | (service) | | | | | | instance | | | | | | where the | | | | | | notification | | | | | | should be | | | | | | sent. | | | | | | | | | | | | Applicable if | | | | | | the feature | | | | | | \"ES3XX\" is | | | | | | supported. | +---------------+---+-------------+---------------+---------------+ | Red | O | 0..1 | 308 Permanent | Permanent | | irectResponse | | | Redirect | redirection, | | | | | | during | | | | | | subscription | | | | | | termination. | | | | | | The response | | | | | | shall include | | | | | | a Location | | | | | | header field | | | | | | containing an | | | | | | alternative | | | | | | URI | | | | | | representing | | | | | | the end point | | | | | | of an | | | | | | alternative | | | | | | NF consumer | | | | | | (service) | | | | | | instance | | | | | | where the | | | | | | notification | | | | | | should be | | | | | | sent. | | | | | | | | | | | | Applicable if | | | | | | the feature | | | | | | \"ES3XX\" is | | | | | | supported. | +---------------+---+-------------+---------------+---------------+ | NOTE: In | | | | | | addition, the | | | | | | HTTP status | | | | | | codes which | | | | | | are specified | | | | | | as mandatory | | | | | | in | | | | | | ta | | | | | | ble 5.2.7.1-1 | | | | | | of | | | | | | 3GPP TS | | | | | | 29.500 [4] | | | | | | for the POST | | | | | | method shall | | | | | | also apply. | | | | | +---------------+---+-------------+---------------+---------------+
Table 5.5.3.3.1-4: Headers supported by the 307 Response Code on this resource
* * *
Name Data type P Cardinality Description Location string M 1 An alternative
URI representing the end point of an alternative NF consumer (service)
instance towards which the notification should be redirected. 3gpp-Sbi-Target-
Nf-Id string O 0..1 Identifier of the target NF (service) instance towards
which the notification request is redirected
* * *
Table 5.5.3.3.1-5: Headers supported by the 308 Response Code on this resource
* * *
Name Data type P Cardinality Description Location string M 1 An alternative
URI representing the end point of an alternative NF consumer (service)
instance towards which the notification should be redirected. 3gpp-Sbi-Target-
Nf-Id string O 0..1 Identifier of the target NF (service) instance towards
which the notification request is redirected
* * *
## 5.6 Data Model
### 5.6.1 General
This clause specifies the application data model supported by the API.
Table 5.6.1-1 specifies the data types defined for the
Nchf_SpendingLimitControl service based interface protocol.
Table 5.6.1-1: Nchf_SpendingLimitControl specific Data Types
* * *
Data type Section defined Description Applicability SpendingLimitContext
5.6.2.2 Describes the subscription data structure required for an individual
CHF spending limit subscription.  
SpendingLimitStatus 5.6.2.3 Describes the data structure presenting the
statuses of policy counters.  
PolicyCounterInfo 5.6.2.4 Describes the data structure presenting the policy
counter status.  
PendingPolicyCounterStatus 5.6.2.5 Describes the data structure presenting the
pending policy counter status.  
PolicyCounterId 5.6.3.2 Identifies a policy counter.  
SubscriptionTerminationInfo 5.6.2.6 Describes the data structure presenting
the indication of the termination of the subscription.  
TerminationCause 5.6.3.3 Represents the types of causes for requesting the
termination of the subscription.
* * *
Table 5.6.1-2 specifies data types re-used by the Nchf_SpendingLimitControl
service based interface protocol from other specifications, including a
reference to their respective specifications and when needed, a short
description of their use within the Nchf_SpendingLimitControl service based
interface.
Table 5.6.1-2: Nchf_SpendingLimitControl re-used Data Types
* * *
Data type Reference Comments Applicability DateTime 3GPP TS 29.571 [11] String
with format \"date-time\" as defined in OpenAPI Specification [9].  
Uri 3GPP TS 29.571 [11]  
Supi 3GPP TS 29.571 [11]  
Gpsi 3GPP TS 29.571 [11]  
RedirectResponse 3GPP TS 29.571 [11] Contains redirection related information.
ES3XX SupportedFeatures 3GPP TS 29.571 [11] Used to negotiate the
applicability of the optional features defined in table 5.8-1.
* * *
### 5.6.2 Structured data types
#### 5.6.2.1 Introduction
This clause defines the structures to be used in resource representations.
#### 5.6.2.2 Type SpendingLimitContext
Table 5.6.2.2-1: Definition of type SpendingLimitContext
* * *
Attribute name Data type P Cardinality Description Applicability supi Supi C
0..1 The Subscription Permanent Identifier (Supi) shall be present within the
initial spending limit retrieval procedure (creation of a new individual
subscription) and intermediate spending limit retrieval procedure
(modification of an existing subscription).  
gpsi Gpsi O 0..1 The Generic Public Subscription Identifier (Gpsi) shall
contain either an External Id or an MSISDN. It may be present within the
initial spending limit retrieval procedure (creation of a new individual
subscription) and intermediate spending limit retrieval procedure
(modification of an existing subscription).  
policyCounterIds array(PolicyCounterId) O 1..N This is a list of policy
counter identifier(s), which identifies policy counters maintained per
subscriber within the CHF.  
notifUri Uri C 0..1 This attribute identifies the recipient of spending limit
notifications sent to the NF service consumer by the CHF. The notifUri shall
be present within the initial spending limit retrieval procedure (creation of
a new individual subscription and within the intermediate spending limit
retrieval procedure (modification of an existing subscription).  
notifId string C 0..1 Notification Correlation ID assigned by the NF service
consumer. It shall be included if the NotificationCorrelation feature is
supported, the notifUri does not encode the notification correlation Id, and
the NF service consumers require multiple subscriptions for the same SUPI,
e.g. UE accesses multiple network slices. NotificationCorrelation expiry
DateTime O 0..1 The expiry time may be included in a subscription request.
When present, this IE shall represent the longest duration time after which
the subscription shall become invalid. SubscriptionExpirationTimeControl
supportedFeatures SupportedFeatures C 0..1 The list of supported features as
described in clause 5.8 shall be supplied by the NF service consumer in the
POST request that request the creation of a spending limit report resource and
intermediate spending limit retrieval procedure (modification of an existing
subscription).
* * *
#### 5.6.2.3 Type SpendingLimitStatus
Table 5.6.2.3-1: Definition of type SpendingLimitStatus
+-----------+-----------+---+-----------+-----------+-----------+ | Attribute | Data type | P | Ca | De | Appl | | name | | | rdinality | scription | icability | +-----------+-----------+---+-----------+-----------+-----------+ | supi | Supi | O | 0..1 | The | | | | | | | Sub | | | | | | | scription | | | | | | | Permanent | | | | | | | I | | | | | | | dentifier | | | | | | | (Supi) | | | | | | | shall be | | | | | | | present | | | | | | | within | | | | | | | the | | | | | | | callback | | | | | | | notify | | | | | | | service | | | | | | | operation | | | | | | | (not | | | | | | | ification | | | | | | | of the | | | | | | | status of | | | | | | | s | | | | | | | ubscribed | | | | | | | policy | | | | | | | c | | | | | | | ounters). | | +-----------+-----------+---+-----------+-----------+-----------+ | notifId | string | C | 0..1 | Not | Notif | | | | | | ification | icationCo | | | | | | Co | rrelation | | | | | | rrelation | | | | | | | ID | | | | | | | assigned | | | | | | | by the NF | | | | | | | service | | | | | | | consumer. | | | | | | | It shall | | | | | | | be | | | | | | | included | | | | | | | if | | | | | | | provided | | | | | | | during | | | | | | | the | | | | | | | sub | | | | | | | scription | | | | | | | within | | | | | | | the | | | | | | | Sp | | | | | | | endingLim | | | | | | | itContext | | | | | | | data | | | | | | | type. | | +-----------+-----------+---+-----------+-----------+-----------+ | st | map( | C | 1..N | Status of | | | atusInfos | PolicyCou | | | the | | | | nterInfo) | | | requested | | | | | | | policy | | | | | | | counters. | | | | | | | The key | | | | | | | of the | | | | | | | map is | | | | | | | the | | | | | | | attribute | | | | | | | \" | | | | | | | policyCou | | | | | | | nterId\". | | | | | | | | | | | | | | It may be | | | | | | | omitted | | | | | | | when the | | | | | | | feature | | | | | | | Subscr | | | | | | | iptionExp | | | | | | | irationTi | | | | | | | meControl | | | | | | | is | | | | | | | supported | | | | | | | and the | | | | | | | CHF only | | | | | | | requires | | | | | | | to update | | | | | | | the | | | | | | | \ | | | | | | | "expiry\" | | | | | | | a | | | | | | | ttribute. | | +-----------+-----------+---+-----------+-----------+-----------+ | expiry | DateTime | C | 0..1 | This | Subscr | | | | | | expiry | iptionExp | | | | | | time | irationTi | | | | | | shall be | meControl | | | | | | included | | | | | | | in a | | | | | | | sub | | | | | | | scription | | | | | | | response, | | | | | | | if the | | | | | | | expiry | | | | | | | time was | | | | | | | included | | | | | | | in the | | | | | | | request. | | | | | | | | | | | | | | It may be | | | | | | | included | | | | | | | in a | | | | | | | sub | | | | | | | scription | | | | | | | response | | | | | | | and | | | | | | | not | | | | | | | ification | | | | | | | request | | | | | | | based on | | | | | | | operator | | | | | | | policies | | | | | | | for the | | | | | | | control | | | | | | | in the | | | | | | | CHF of | | | | | | | the | | | | | | | sub | | | | | | | scription | | | | | | | duration. | | +-----------+-----------+---+-----------+-----------+-----------+ | supporte | Supporte | C | 0..1 | If the | | | dFeatures | dFeatures | | | supporte | | | | | | | dFeatures | | | | | | | is | | | | | | | included | | | | | | | in the | | | | | | | request | | | | | | | by the NF | | | | | | | service | | | | | | | consumer, | | | | | | | it shall | | | | | | | be | | | | | | | supplied | | | | | | | in the | | | | | | | reply of | | | | | | | the | | | | | | | corr | | | | | | | esponding | | | | | | | request | | | | | | | by the | | | | | | | CHF. | | +-----------+-----------+---+-----------+-----------+-----------+
#### 5.6.2.4 Type PolicyCounterInfo
Table 5.6.2.4-1: Definition of type PolicyCounterInfo
* * *
Attribute name Data type P Cardinality Description Applicability
policyCounterId PolicyCounterId M 1 Identifies the requested policy counter.  
currentStatus string M 1 Identifies the policy counter status applicable for a
specific policy counter identified by the policyCounterId. The values (e.g.
valid, invalid or any other status) are not specified. The interpretation and
actions related to the defined values are out of scope of 3GPP.  
penPolCounterStatuses array(PendingPolicyCounterStatus) O 1..N Provides the
pending policy counter status.
* * *
#### 5.6.2.5 Type PendingPolicyCounterStatus
Table 5.6.2.5-1: Definition of type PendingPolicyCounterStatus
* * *
Attribute name Data type P Cardinality Description Applicability
policyCounterStatus string M 1 Identifies the policy counter status applicable
for a specific policy counter identified by the PolicyCounterId. The values
(e.g. valid, invalid or any other status) are not specified. The
interpretation and actions related to the defined values are out of scope of
3GPP.  
activationTime DateTime M 1 Indicates the time at which the pending policy
counter status becomes the current status of a policy counter.
* * *
#### 5.6.2.6 Type SubscriptionTerminationInfo
Table 5.6.2.6-1: Definition of type SubscriptionTerminationInfo
* * *
Attribute name Data type P Cardinality Description Applicability supi Supi M 1
Subscription Permanent Identifier.  
notifId string C 0..1 Notification Correlation ID assigned by the NF service
consumer. It shall be included if provided during the subscription within the
SpendingLimitContext data type. NotificationCorrelation termCause
TerminationCause O 0..1 Indicates the cause for requesting the termination of
the subscription to policy counter status changes.
* * *
### 5.6.3 Simple data types and enumerations
#### 5.6.3.1 Introduction
This clause defines simple data types and enumerations that can be referenced
from data structures defined in the previous clauses.
#### 5.6.3.2 Simple data types
The simple data types defined in table 5.6.3.2-1 shall be supported.
Table 5.6.3.2-1: Simple data types
* * *
Type Name Type Definition Description Applicability PolicyCounterId string
Identifies a policy counter.
* * *
#### 5.6.3.3 Enumeration: TerminationCause
The enumeration \"TerminationCause\" represents the types of causes the CHF
can report when requesting the termination of the subscription.
Table 5.6.3.3-1: Enumeration TerminationCause
* * *
Enumeration value Description Applicability REMOVED_SUBSCRIBER The subscriber
identified by the SUPI has been removed from the CHF.
* * *
## 5.7 Error handling
### 5.7.1 General
HTTP error handling shall be supported as specified in clause 5.2.4 of 3GPP TS
29.500 [4].
For the Nchf_SpendingLimitControl service API, HTTP error responses shall be
supported as specified in clause 4.8 of 3GPP TS 29.501 [5].
Protocol errors and application errors specified in table 5.2.7.2-1 of 3GPP TS
29.500 [4] shall be supported for an HTTP method if the corresponding HTTP
status codes are specified as mandatory for that HTTP method in table
5.2.7.1-1 of 3GPP TS 29.500 [4].
In addition, the requirements in the following clauses shall apply.
### 5.7.2 Protocol Errors
In this Release of the specification, there are no additional protocol errors
applicable for the Nchf_SpendingLimitControl service API.
### 5.7.3 Application Errors
The application errors defined for the Nchf_SpendingLimitControl service API
are listed in table 5.7.3-1.
Table 5.7.3-1: Application errors
* * *
Application Error HTTP status code Description USER_UNKNOWN 400 Bad Request
The subscriber specified in the request is not known at the CHF and the
subscription cannot be created. NO_AVAILABLE_POLICY_COUNTERS 400 Bad Request
There are no policy counters available for the subscriber at the CHF
UNKNOWN_POLICY_COUNTERS 400 Bad Request The policy counter identifiers in the
request are not known at the CHF. NOTE: Including a \"ProblemDetails\" data
structure with the \"cause\" attribute in the HTTP response is optional unless
explicitly mandated in the service operation clauses.
* * *
## 5.8 Feature negotiation
The optional features in table 5.8-1 are defined for the
Nchf_SpendingLimitControl Service API. They shall be negotiated using the
extensibility mechanism defined in clause 6.6.2 of 3GPP TS 29.500 [4].
Table 5.8-1: Supported Features
* * *
Feature number Feature Name Description 1 SubscriptionExpirationTimeControl
Indicates the support of a expiry time to control the time duration of the
subscription to changes of policy counters status. 2 NotifiationCorrelation
Indicates the support of the explicit indication of the notification
correlation id 3 ES3XX Extended Support for 3xx redirections. This feature
indicates the support of redirection for any service operation, according to
Stateless NF procedures as specified in clauses 6.5.3.2 and 6.5.3.3 of 3GPP TS
29.500 [4] and according to HTTP redirection principles for indirect
communication, as specified in clause 6.10.9 of 3GPP TS 29.500 [4].
* * *
## 5.9 Security
As indicated in 3GPP TS 33.501 [14] and 3GPP TS 29.500 [4], the access to the
Nchf_SpendingLimitControl API, based on local configuration, may be authorized
by means of the OAuth2 protocol (see IETF RFC 6749 [15]), using the \"Client
Credentials\" authorization grant, where the NRF (see 3GPP TS 29.510 [16])
plays the role of the authorization server.
If OAuth2 is used, an NF service consumer, prior to consuming services offered
by the Nchf_SpendingLimitControl API, shall obtain a \"token\" from the
authorization server, by invoking the Access Token Request service, as
described in 3GPP TS 29.510 [16], clause 5.4.2.2.
NOTE: When multiple NRFs are deployed in a network, the NRF used as
authorization server is the same NRF that the NF service consumer used for
discovering the Nchf_SpendingLimitControl service.
The Nchf_SpendingLimitControl API defines a single scope \"nchf-
spendinglimitcontrol\" for OAuth2 authorization (as specified in 3GPP TS
33.501 [14]) for the entire API, and it does not define any additional scopes
at resource or operation level.
###### ## Annex A (normative): OpenAPI specification
# A.1 General
The present Annex contains an OpenAPI [9] specification of HTTP messages and
content bodies used by the Nchf_SpendingLimitControl Service API.
This Annex shall take precedence when being discrepant to other parts of the
specification with respect to the encoding of information elements and methods
within the API.
NOTE: The semantics and procedures, as well as conditions, e.g. for the
applicability and allowed combinations of attributes or values, not expressed
in the OpenAPI definitions but defined in other parts of the specification
also apply.
Informative copies of the OpenAPI specification file contained in this 3GPP
Technical Specification are available on a Git-based repository that uses the
GitLab software version control system (see clause 5B of the 3GPP TR 21.900
[17] and clause 5.3.1 of the 3GPP TS 29.501 [5] for further information).
# A.2 Nchf_SpendingLimitControl Service API
openapi: 3.0.0
info:
version: 1.2.0
title: Nchf_SpendingLimitControl
description: \|
Nchf Spending Limit Control Service.
Â© 2022, 3GPP Organizational Partners (ARIB, ATIS, CCSA, ETSI, TSDSI, TTA,
TTC).
All rights reserved.
externalDocs:
description: 3GPP TS 29.594 V17.4.0; 5G System; Spending Limit Control
Service.
url: \'https://www.3gpp.org/ftp/Specs/archive/29_series/29.594/\'
servers:
\- url: \'{apiRoot}/nchf-spendinglimitcontrol/v1\'
variables:
apiRoot:
default: https://example.com
description: apiRoot as defined in clause 4.4 of 3GPP TS 29.501
security:
\- {}
\- oAuth2ClientCredentials:
\- nchf-spendinglimitcontrol
paths:
/subscriptions:
post:
requestBody:
required: true
content:
application/json:
schema:
\$ref: \'#/components/schemas/SpendingLimitContext\'
responses:
\'201\':
description: Success
content:
application/json:
schema:
\$ref: \'#/components/schemas/SpendingLimitStatus\'
headers:
Location:
description: >
Contains the URI of the created individual spending limit resource,
according to the structure
{apiRoot}/nchf-spendinglimitcontrol/v1/subscriptions/{subscriptionId}
required: true
schema:
type: string
\'400\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/400\'
\'401\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/401\'
\'403\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/403\'
\'404\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/404\'
\'411\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/411\'
\'413\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/413\'
\'415\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/415\'
\'429\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/429\'
\'500\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/500\'
\'503\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/503\'
default:
\$ref: \'TS29571_CommonData.yaml#/components/responses/default\'
callbacks:
statusNotification:
\'{\$request.body#/notifUri}/notify\':
post:
requestBody:
required: true
content:
application/json:
schema:
\$ref: \'#/components/schemas/SpendingLimitStatus\'
responses:
\'204\':
description: No Content, Notification was succesfull
\'307\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/307\'
\'308\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/308\'
\'400\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/400\'
\'401\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/401\'
\'403\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/403\'
\'404\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/404\'
\'411\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/411\'
\'413\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/413\'
\'415\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/415\'
\'429\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/429\'
\'500\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/500\'
\'503\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/503\'
default:
\$ref: \'TS29571_CommonData.yaml#/components/responses/default\'
subscriptionTermination:
\'{\$request.body#/notifUri}/terminate\':
post:
requestBody:
required: true
content:
application/json:
schema:
\$ref: \'#/components/schemas/SubscriptionTerminationInfo\'
responses:
\'204\':
description: No Content, Notification was succesfull
\'307\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/307\'
\'308\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/308\'
\'400\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/400\'
\'401\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/401\'
\'403\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/403\'
\'404\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/404\'
\'411\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/411\'
\'413\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/413\'
\'415\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/415\'
\'429\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/429\'
\'500\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/500\'
\'503\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/503\'
default:
\$ref: \'TS29571_CommonData.yaml#/components/responses/default\'
/subscriptions/{subscriptionId}:
parameters:
\- in: path
name: subscriptionId
description: Identifies an individual spending limit retrieval subscription.
required: true
schema:
type: string
put:
requestBody:
required: true
content:
application/json:
schema:
\$ref: \'#/components/schemas/SpendingLimitContext\'
responses:
\'200\':
description: OK. Resource was succesfully modified and representation is
returned
content:
application/json:
schema:
\$ref: \'#/components/schemas/SpendingLimitStatus\'
\'307\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/307\'
\'308\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/308\'
\'400\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/400\'
\'401\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/401\'
\'403\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/403\'
\'404\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/404\'
\'411\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/411\'
\'413\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/413\'
\'415\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/415\'
\'429\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/429\'
\'500\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/500\'
\'503\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/503\'
default:
\$ref: \'TS29571_CommonData.yaml#/components/responses/default\'
delete:
responses:
\'204\':
description: No Content. Resource was succesfully deleted
\'307\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/307\'
\'308\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/308\'
\'400\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/400\'
\'401\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/401\'
\'403\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/403\'
\'404\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/404\'
\'429\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/429\'
\'500\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/500\'
\'503\':
\$ref: \'TS29571_CommonData.yaml#/components/responses/503\'
default:
\$ref: \'TS29571_CommonData.yaml#/components/responses/default\'
components:
securitySchemes:
oAuth2ClientCredentials:
type: oauth2
flows:
clientCredentials:
tokenUrl: \'{nrfApiRoot}/oauth2/token\'
scopes:
nchf-spendinglimitcontrol: Access to the Nchf_SpendingLimitControl API
schemas:
SpendingLimitContext:
description: >
Represents the subscription data structure required for an individual CHF
spending limit
subscription.
type: object
properties:
supi:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/Supi\'
gpsi:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/Gpsi\'
policyCounterIds:
type: array
items:
\$ref: \'#/components/schemas/PolicyCounterId\'
minItems: 1
description: >
This is a list of policy counter identifier(s), which identifies policy
counters
maintained per subscriber within the CHF.
notifUri:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/Uri\'
expiry:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/DateTime\'
supportedFeatures:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/SupportedFeatures\'
notifId:
type: string
SpendingLimitStatus:
description: >
Represents the data structure presenting the statuses of policy counters.
type: object
properties:
supi:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/Supi\'
notifId:
type: string
statusInfos:
type: object
additionalProperties:
\$ref: \'#/components/schemas/PolicyCounterInfo\'
minProperties: 1
description: >
Status of the requested policy counters. The key of the map is the attribute
\"policyCounterId\".
expiry:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/DateTime\'
supportedFeatures:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/SupportedFeatures\'
PolicyCounterInfo:
description: Represents the data structure presenting the policy counter
status.
type: object
properties:
policyCounterId:
\$ref: \'#/components/schemas/PolicyCounterId\'
currentStatus:
type: string
description: >
Identifies the policy counter status applicable for a specific policy counter
identified
by the policyCounterId. The values (e.g. valid, invalid or any other status)
are not
specified. The interpretation and actions related to the defined values are
out of scope
of 3GPP.
penPolCounterStatuses:
type: array
items:
\$ref: \'#/components/schemas/PendingPolicyCounterStatus\'
minItems: 1
description: Provides the pending policy counter status.
required:
\- policyCounterId
\- currentStatus
PendingPolicyCounterStatus:
description: >
Represents the data structure presenting the pending policy counter status.
type: object
properties:
policyCounterStatus:
type: string
description: >
Identifies the policy counter status applicable for a specific policy counter
identified
by the policyCounterId. The values (e.g. valid, invalid or any other status)
are not
specified. The interpretation and actions related to the defined values are
out of scope
of 3GPP.
activationTime:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/DateTime\'
required:
\- policyCounterStatus
\- activationTime
PolicyCounterId:
type: string
description: Identifies a policy counter.
SubscriptionTerminationInfo:
description: >
Represents the data structure presenting the indication of the termination of
the
subscription.
type: object
properties:
supi:
\$ref: \'TS29571_CommonData.yaml#/components/schemas/Supi\'
notifId:
type: string
termCause:
\$ref: \'#/components/schemas/TerminationCause\'
required:
\- supi
TerminationCause:
description: >
Represents the cause for requesting the termination of the subscription to
policy counter
status changes.
anyOf:
\- type: string
enum:
\- REMOVED_SUBSCRIBER
\- type: string
###### ## Annex B (normative): 5GC and EPC interworking scenario support
# B.1 Scope
This annex defines procedures for the Nchf_SpendingLimitControl service for
5GC and EPC interworking scenarios specified in clause B.1 of 3GPP TS 29.512
[18].
# B.2 Nchf_SpendingLimitControl Service
## B.2.1 Service Description
### B.2.1.1 Overview
The overview in clause 4.1.1 applies.
### B.2.1.2 Service Architecture
The architecture in clause 4.1.2 applies.
# B.3 Service Operation
## B.3.1 Introduction
The service operations defined in clause 4.2 shall be applicable.
## B.3.2 Nchf_SpendingLimitControl_Subscribe Service Operation
Clause 4.2.2.2 and clause 4.2.2.3 are applied with the differences that the NF
service consumers (e.g. PCF) shall include (if available) in
SpendingLimitContext data structure:
\- the IMSI of the user within the \"supi\" attribute;
\- the MSISDN of the user within the \"gpsi\" attribute;
## B.3.3 Nchf_SpendingLimitControl_Unsubscribe Service Operation
Clause 4.2.3 applies.
## B.3.4 Nchf_SpendingLimitControl_Notify Service Operation
Clause 4.2.4 applies.
###### ## Annex C (normative): Wireless and wireline convergence access
support
# C.1 Scope
This annex defines procedures for wireless and wireline convergence access
support for 5GS. The specific stage 2 definition and related procedures are
contained in 3GPP TS 23.316 [19]. The System Architecture for wireless and
wireline convergence access is defined in 3GPP TS 23.501 [2].
# C.2 Nchf_SpendingLimitControl Service
## C.2.1 Service Description
### C.2.1.1 Overview
Clause 4.1.1 applies with the following exceptions:
\- the UE is replaced by the 5G-RG and the W-AGF, which is acting as a UE
towards the 5GC on behalf of the FN-RG; and
\- roaming is only applicable to a 5G-RG connecting to the 5GC via NG RAN,
i.e., the H-PCF interaction with the H-CHF for the home-routed scenario only
applies to a 5G-RG connecting to the 5GC via NG RAN.
### C.2.1.2 Service Architecture
The architecture in clause 4.1.2 applies.
# C.3 Service Operation
## C.3.1 Introduction
The service operations defined in clause 4.2.1 apply.
## C.3.2 Nchf_SpendingLimitControl_Subscribe Service Operation
### C.3.2.1 General
Clauses 4.2.2.2 and 4.2.2.3 are applied with the differences that the NF
service consumer shall include (if available) in SpendingLimitContext data
structure:
\- a IMSI or a Global Cable Identifier (GCI) or a Global Line Identifier (GLI)
as specified in 3GPP TS 23.316 [19] clause 4.7, encoded as specified in 3GPP
TS 29.571[11], clause 5.3.2, within the \"supi\" attribute.
## C.3.3 Nchf_SpendingLimitControl_Unsubscribe Service Operation
Clause 4.2.3 applies.
## C.3.4 Nchf_SpendingLimitControl_Notify Service Operation
Clause 4.2.4 applies.
#
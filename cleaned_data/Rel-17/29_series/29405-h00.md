# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies the procedures and the Nq and Nq\' Application
Protocol (Nq-AP) messages used on the Nq/Nq\' interfaces between the RAN
Congestion Awareness Function (RCAF) and the Mobility Management Entity (MME)
or the Serving GPRS Support Node (SGSN). The related stage 2 requirements are
specified in 3GPP TS 23.401 [2] and 3GPP TS 23.060 [3].
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for
Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".
[3] 3GPP TS 23.060: \"General Packet Radio Service (GPRS); Service
description; Stage 2\".
[4] 3GPP TS 29.303: \"Domain Name System Procedures; Stage 3\"
[5] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[6] IETF RFC 791 (September 1981): \"Internet Protocol\".
[7] IETF RFC 2460 (December 1998): \"Internet Protocol, Version 6 (IPv6)
Specification\".
[8] IETF RFC 4960 (September 2007): \"Stream Control Transmission Protocol\".
[9] ITU-T Recommendation E.212: \"The international identification plan for
mobile terminals and mobile users\".
[10] 3GPP TS 36.413: \"Evolved Universal Terrestrial Radio Access Network
(E-UTRAN); S1 Application Protocol (S1AP)\".
[11] IETF RFC 1035: \"Domain Names - Implementation and Specification\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
RCAF RAN Congestion Awareness Function
# 4 General Description
This document describes the procedures, messages and information elements over
the Nq and Nq\' interfaces between the MME/SGSN and the RCAF to transfer the
IMSI/APN information associated to the eNodeB or E-UTRAN cells or UTRAN
Service Area experiencing user plane congestion.
The Nq interface is located between the RCAF and the MME. The Nq\' interface
is located between the RCAF and the SGSN.
Both the Nq and the Nq\' interfaces use the Nq-AP protocol. The Nq-AP protocol
described in this document uses a Type, Length and Value (TLV) encoding of
messages over an SCTP transport. The SCTP transport is described in clause 6.
The Nq-AP messages and the Information Elements are described in clause 8 and
9 respectively.
# 5 Procedures for Nq-AP
## 5.1 Introduction
The Nq interface is used between the RCAF and MME for the IMSI and APN
information retrieval procedures as specified in sub-clause 5.9.3 of 3GPP TS
23.401 [2].
The Nq\' interface is used between the RCAF and SGSN for the APN information
retrieval procedure as specified in sub-clause 6.17 of 3GPP TS 23.060 [3].
## 5.2 IMSI and APN Information Retrieval Procedure
### 5.2.1 General
The IMSI and APN information retrieval procedure is used between the RCAF and
the MME over the Nq interface. The RCAF uses this procedure to retrieve from
the MME:
\- the IMSIs that are currently in ECM-CONNECTED state and having active
E-RABs under a given eNodeB or E-UTRAN cell;
\- for each IMSI the list of APNs currently having active PDN connections.
The RCAF selects the MME(s) serving a user plane congested eNodeB or an
E-UTRAN cell through the DNS procedure as specified in sub-clause 5.4 of 3GPP
TS 29.303 [4].
### 5.2.2 IMSI and APN Information Retrieval Procedure Initiation
#### 5.2.2.1 Procedures in the RCAF
When the RCAF needs to retrieve the IMSI(s) / APN(s) information for a given
user plane congested area, the RCAF shall send the NqAP-IMSI-APN-INFORMATION-
REQUEST message towards the MME(s).
The RCAF shall include in the NqAP-IMSI-APN-INFORMATION-REQUEST message:
\- the Global eNodeB ID IE(s) if it requests the IMSI(s) and APN(s) for a
given user plane congested area at an eNodeB level;
\- the ECGI IE(s) if it requests the IMSI(s) and APN(s) for a given user plane
congested area at an E-UTRAN cell level.
NOTE: For a given user plane congested area, the RCAF retrieves the IMSI and
APN information from the MME at a eNodeB level or E-UTRAN cell level based on
local policy at the RCAF.
#### 5.2.2.2 Procedures in the MME
When the MME receives the NqAP-IMSI-APN-INFORMATION-REQUEST message from the
RCAF, the MME shall report in the NqAP-IMSI-APN-INFORMATION-RESPONSE message,
for each eNodeB or E-UTRAN cell requested by the RCAF, that has at least one
subscriber:
\- the Macro eNodeB ID or Home eNodeB ID or the E-UTRAN cell ID in the RAN
Entity value field of the RAN Entity Identifier IE for which the MME(s) report
the IMSI and the APN information.
\- all the subscribers that are currently in ECM-CONNECTED state and having
active E-RABs, except the subscribers involved in an Emergency call, under the
given eNodeB or E-UTRAN cell in the Subscriber-Information IE. Multiple
instances of the Subscriber-Information IE shall be included if there are
multiple subscribers under the given eNodeB or E-UTRAN cell.
\- for each subscriber, the IMSI in the IMSI IE and APNs currently having
active PDN connections in the APN IE. Multiple instances of the APN IE shall
be included under a Subscriber-Information IE if the subscriber has active PDN
connections towards multiple APNs.
The information reported by the MME for each eNodeB or E-UTRAN cell shall be
encoded as an instance of the RAN Associated Information IE.
For a single NqAP-IMSI-APN-INFORMATION-REQUEST message from the RCAF, the MME
may send multiple NqAP-IMSI-APN-INFORMATION-RESPONSE messages.
There shall be no NqAP-IMSI-APN-INFORMATION-RESPONSE sent, if the MME does not
find any subscriber under any of the requested eNodeB or E-UTRAN cell.
## 5.3 APN Information Retrieval Procedure
### 5.3.1 General
The APN information retrieval procedure is used between the RCAF and the SGSN
over the Nq\' interface. The RCAF uses this procedure to retrieve from the
SGSN:
\- the APNs that are currently having PDP contexts activated for each IMSI
provided by the RCAF.
The RCAF selects the SGSN(s) serving a user plane congested SAI through the
DNS procedure as specified in sub-clause 5.5 of 3GPP TS 29.303 [4].
### 5.3.2 APN Information Retrieval Procedure Initiation
#### 5.3.2.1 Procedures in the RCAF
When the RCAF needs to retrieve the APN(s) for the list of IMSI(s)
experiencing RAN user plane congestion, the RCAF shall send the NqAP-APN-
INFORMATION-REQUEST message towards the SGSN(s).
The RCAF shall include the following information in the NqAP-APN-INFORMATION-
REQUEST message
\- the list of IMSI(s) in the IMSI IE. Multiple instances of the IMSI IE shall
be included if there are multiple subscribers for which APN information needs
to be queried from the SGSN.
#### 5.3.2.2 Procedures in the SGSN
When the SGSN receives the NqAP-APN-INFORMATION-REQUEST message from the RCAF,
the SGSN shall report in the NqAP-APN-INFORMATION-RESPONSE message, if there
is at least one subscriber\'s information to report:
\- list of subscribers for which the APN information is provided by the SGSN,
in the Subscriber-Information IE. Multiple instances of the Subscriber-
Information IE shall be included if there are multiple subscribers for which
the SGSN is reporting the APN information. Each instance of the Subscriber-
Information IE contains:
\- the IMSI of the subscriber encoded in the IMSI IE;
\- the APNs currently having active PDP contexts with active RABs, encoded in
the APN IE. Multiple instances of the APN IE shall be included under a
Subscriber-Information IE if the subscriber has active PDP contexts towards
multiple APNs. Emergency call APNs shall be excluded.
\- If the subscriber does not have any PDP context with active RABs, then the
SGSN shall not include that subscriber\'s information in the NqAP-APN-
INFORMATION-RESPONSE.
In a pooled SGSN scenario each SGSN may have only a subset of IMSIs
registered. An SGSN shall report the APN information only for the IMSIs it
knows.
For a single NqAP-APN-INFORMATION-REQUEST message from the RCAF, the SGSN may
send multiple NqAP- APN-INFORMATION-RESPONSE messages.
There shall be no NqAP-APN-INFORMATION-RESPONSE sent, if the SGSN does not
find any requested subscriber attached.
# 6 Transport
## 6.1 General
This subclause specifies the standards for signalling transport to be used
across Nq/Nq\' interface. Nq/Nq\' interface is a logical interface between the
RCAF and the MME/SGSN. All the Nq-AP messages described in the present
document require an SCTP association between the RCAF and the MME/SGSN.
## 6.2 IP layer
The RCAF shall support IPv6 (see IETF RFC 2460 [7]) and IPv4 (see IETF RFC 791
[6]).
## 6.3 Transport layer
SCTP (see IETF RFC 4960 [8]) shall be supported as the transport layer of Nq-
AP messages.
Semi-permanent SCTP associations shall be established between the RCAF and
MME/SGSN, i.e. the SCTP associations shall remain up under normal
circumstances when the RCAF needs to use the Nq-AP procedures towards the
MME/SGSN.
The RCAF shall initiate establishment of the SCTP association.
Transport network redundancy can be achieved by SCTP multi-homing between two
end-points, of which one or both is assigned with multiple IP addresses. SCTP
end-points shall support a multi-homed remote SCTP end-point. For SCTP
endpoint redundancy, an SCTP endpoint (in the RCAF or MME/SGSN) may send an
INIT, at any time for an already established SCTP association, which the other
SCTP endpoint shall handle as defined in IETF RFC 4960 [8].
RCAF and MME/SGSN shall support a configuration with a single SCTP association
per RCAF/MME (or RCAF/SGSN) pair. Configurations with multiple SCTP endpoints
per RCAF/MME (or RCAF/SGSN) pair may be supported.
Within the SCTP association established between one RCAF and one MME/SGSN,
both RCAF and MME/SGSN shall reserve several stream identifiers, based on the
INIT message exchange for the sole use of Nq-AP procedures.
The registered port number for Nq-AP is 36424.
The payload protocol identifier to be used for Nq-AP is 0.
# 7 Error Handling
## 7.1 General
This subclause specifies procedures for the handling of unknown, unforeseen,
and erroneous protocol data by the receiving entity (i.e. the MME or the
RCAF). These procedures are called \"error handling procedures\". If a
protocol error is detected by the receiving NqAP entity, it should log the
event including the erroneous message and may include the error in a
statistical counter.
## 7.2 Message too short
When the receiving entity receives a message that is too short to contain a
complete message type information element, the receiving entity shall ignore
that message.
## 7.3 Unknown or unforeseen message type
The entity receiving a message with a message type that is not defined or is
not implemented, it shall ignore the message.
The entity receiving a message that is not defined to be received by that
entity (e.g. the message is sent in the wrong direction) shall treat the
message as unknown message and shall ignore the message.
## 7.4 Missing mandatory information element
When the entity receiving a request message diagnoses a \"missing mandatory
information element\" error, the receiving entity shall ignore the message and
shall return a corresponding response message with the cause IE set to
\"Mandatory IE missing\", together with the type of the missing mandatory IE.
When the entity receiving a response message diagnoses a \"missing mandatory
information element\" error, it shall ignore the message.
## 7.5 Information elements unknown or unforeseen in the message
The receiving entity shall ignore all information elements unknown or
unforeseen in a message.
## 7.6 Out of sequence information elements
The receiving entity shall ignore all information elements that are out of
sequence.
## 7.7 Repeated information elements
If an information element is repeated in a message in which repetition of the
information element is not specified, the receiving entity shall only handle
the contents of the information element appearing first and shall ignore all
subsequent repetitions of the information element. When repetition of
information elements is specified, the receiving entity shall only handle the
contents of specified repeated information elements. If a limit on the
repetition of information elements is specified and the limit is exceeded, the
receiving entity shall handle the contents of information elements appearing
first up to the limit of repetitions and shall ignore all subsequent
repetitions of the information element.
## 7.8 Syntactically incorrect mandatory information element.
On receipt of a message, which contains a syntactically incorrect mandatory
information element, the receiver shall ignore the message and shall return a
corresponding response message with the cause IE set to \"Mandatory IE
incorrect\", together with the type of the offending mandatory IE.
## 7.9 Syntactically incorrect optional information elements
The receiving entity shall treat all optional information elements that are
syntactically incorrect in a message as not present in the message.
## 7.10 Conditional information element errors
When the entity receiving a request message diagnoses a \"missing conditional
information element\" error, the receiving entity shall ignore the message and
shall return a corresponding response message with the cause IE set to
\"Conditional IE missing\", together with the type of the missing conditional
IE.
When the entity receiving a request message diagnoses an \"unexpected
conditional information element\" error or when it receives a message
containing at least one syntactically incorrect conditional information
element which is required to be present in the message, the receiving entity
shall ignore the message and shall return a corresponding response message
with the cause IE set to \"Conditional IE incorrect\", together with the type
of the offending conditional IE.
When the entity receiving a response message diagnoses a \"missing conditional
information element\" error, \"unexpected conditional information element\"
error or when it receives a response message containing at least one
syntactically incorrect conditional information element which is required to
be present in the message, it shall ignore the message.
When the entity receives a message containing a syntactically incorrect
conditional information element, which is not required to be present in the
message, nor required to be absent in the message, then the receiving entity
shall ignore that information element.
## 7.11 Information elements with semantically incorrect contents
When an information element with semantically incorrect contents is received,
the foreseen reactions of the procedural part of the present specification are
performed.
If however no such reactions are specified, the receiving entity shall ignore
that information element and treat the rest of the message. If the
semantically incorrect information element in a request message is a mandatory
information element, then the receiving entity shall return a corresponding
response message with the cause IE set to \"Mandatory IE incorrect\", together
with the type of the offending mandatory IE. If the semantically incorrect
information element in a response message is a mandatory information element,
then the receiving entity shall ignore the message.
## 7.12 NqAP Message of Invalid Length
If an NqAP entity receives a Request message within an IP/SCTP packet of a
length that is inconsistent with the value specified in the Length field of
the NqAP message header, then the receiving NqAP entity should log the error
and shall send the Response message with the Cause IE value set to \"Invalid
Length\".
If an NqAP entity receives a Response message within an IP/SCTP packet of a
length that is inconsistent with the value specified in the Length field of
the NqAP message header, then the receiving NqAP entity should log the error
and shall silently discard the message.
# 8 Messages Description
## 8.1 NqAP-IMSI-APN-INFORMATION-REQUEST Message
### 8.1.1 Message definition
This message is sent by the RCAF to the MME to request the list of IMSIs and
APNs activated for each IMSI under a given RAN Identifier (E-UTRAN cell Id or
the eNodeB Id). Table 8.1.1 shows the content of the NqAP-IMSI-APN-
INFORMATION-REQUEST message. Multiple instances of the RAN Entity Identifier
IE shall be included if the RCAF is requesting the IMSI and APN information
from MME for multiple eNodeB(s) or E-UTRAN Cell Ids.
Table 8.1.1: NqAP-IMSI-APN-INFORMATION-REQUEST message content
+-----------------------+-----------------------+----------+--------+--------+ | Information element | Type/Reference | Presence | Format | Length | +-----------------------+-----------------------+----------+--------+--------+ | Message type | Message type | M | V | 1 | | | | | | | | | 9.2 | | | | +-----------------------+-----------------------+----------+--------+--------+ | RAN Entity Identifier | RAN Entity Identifier | M | TLV | 11-13 | | | | | | | | | 9.4.3 | | | | +-----------------------+-----------------------+----------+--------+--------+
## 8.2 NqAP-IMSI-APN-INFORMATION-RESPONSE Message
### 8.2.1 Message definition
This message is sent by the MME to the RCAF in response to the NqAP-IMSI-APN-
INFORMATION-REQUEST message. Table 8.2.1 shows the content of the NqAP-IMSI-
APN-INFORMATION-RESPONSE message. The RAN-Associated-Information IE shall be
encoded if the cause value in Cause IE is \"Request Accepted\". Multiple
instances of the RAN-Associated-Information IE shall be included if the RCAF
had requested IMSI and APN information for multiple eNodeB Id(s) or EUTRAN
Cell Id(s) and if the particular instance of the NqAP-IMSI-APN-INFORMATION-
RESPONSE message could find subscribers under some or all of these requested
eNodeB Id(s) or EUTRAN Cell Id(s).
The MME Name IE shall be included if the cause value in Cause IE is anything
other than \"Request Accepted\".
Table 8.2.1: NqAP-IMSI-APN-INFORMATION-RESPONSE message content
+------------------+------------------+----------+--------+----------+ | Information | Type/Reference | Presence | Format | Length | | element | | | | | +------------------+------------------+----------+--------+----------+ | Message type | Message type | M | V | 1 | | | | | | | | | 9.2 | | | | +------------------+------------------+----------+--------+----------+ | Cause | Cause | M | TLV | 4 | | | | | | | | | 9.4.6 | | | | +------------------+------------------+----------+--------+----------+ | RAN Associated | RAN-Associ | C | TLV | Variable | | Information | ated-Information | | | | | | | | | | | | 9.4.5 | | | | +------------------+------------------+----------+--------+----------+ | MME Name | Fully Qualified | C | TLV | Variable | | | Domain Name | | | | | | (FQDN) | | | | | | | | | | | | 9.4.7 | | | | +------------------+------------------+----------+--------+----------+
## 8.3 NqAP-APN-INFORMATION-REQUEST Message
### 8.3.1 Message definition
This message shall be sent by the RCAF to the SGSN to request the list of APNs
activated for a given set of IMSI(s). Table 8.3.1 shows the content of the
NqAP-APN-INFORMATION-REQUEST message. Multiple instances of the IMSI IE shall
be included if the RCAF is requesting the APN information from SGSN for
multiple IMSIs.
Table 8.3.1: NqAP-APN-INFORMATION-REQUEST message content
+---------------------+----------------+----------+--------+--------+ | Information element | Type/Reference | Presence | Format | Length | +---------------------+----------------+----------+--------+--------+ | Message type | Message type\ | M | V | 1 | | | 9.2 | | | | +---------------------+----------------+----------+--------+--------+ | IMSI | IMSI | M | TLV | 6-11 | | | | | | | | | 9.4.1 | | | | +---------------------+----------------+----------+--------+--------+
## 8.4 NqAP-APN-INFORMATION-RESPONSE Message
### 8.4.1 Message definition
This message is sent by the SGSN to the RCAF in response to the NqAP-APN-
INFORMATION-REQUEST message. Table 8.4.1 shows the content of the NqAP-APN-
INFORMATION-RESPONSE message. The Subscriber-Information IE shall be encoded
if the cause value in Cause IE is \"Request Accepted\". Multiple instances of
the Subscriber-Information IE shall be included if the RCAF had requested APN
information for multiple IMSI(s) and if the particular instance of the NqAP-
APN-INFORMATION-RESPONSE message carries more than one subscriber\'s
information.
The SGSN Name IE shall be included if the cause value in Cause IE is anything
other than \"Request Accepted\".
Table 8.4.1: NqAP-APN-INFORMATION-RESPONSE message content
+------------------+------------------+----------+--------+----------+ | Information | Type/Reference | Presence | Format | Length | | element | | | | | +------------------+------------------+----------+--------+----------+ | Message type | Message type\ | M | V | 1 | | | 9.2 | | | | +------------------+------------------+----------+--------+----------+ | Cause | Cause | M | TLV | 4 | | | | | | | | | 9.4.6 | | | | +------------------+------------------+----------+--------+----------+ | Subscriber | Subscr | C | TLV | Variable | | Information | iber-Information | | | | | | | | | | | | 9.4.4 | | | | +------------------+------------------+----------+--------+----------+ | SGSN Name | Fully Qualified | C | TLV | Variable | | | Domain Name | | | | | | (FQDN) | | | | | | | | | | | | 9.4.7 | | | | +------------------+------------------+----------+--------+----------+
# 9 Information Elements
## 9.1 Overview
This clause specifies the coding of the information elements used in by the
Nq-AP protocol.
The spare bits in the coding of an information element shall be set to zero by
the sender and shall be ignored by the receiver.
### 9.1.1 Presence requirements for Information Elements
There are four different presence requirements (Mandatory, Conditional,
Conditional-Optional, Optional) for an information element within a given Nq-
AP message:
\- Mandatory means that the IE shall be included by the sending side, and that
the receiver diagnoses a \"missing mandatory information element\" error, when
detecting that the IE is not present.
\- Conditional means:
\- that the IE shall be included by sending entity if the conditions specified
in the relevant protocol specification are met;
\- the receiver shall check the conditions as specified in the corresponding
message type description, based on the parameter combination in the message
and/or on the state of the receiving node, to infer if a conditional IE shall
be expected. Only if a receiver has sufficient information the following
applies. A conditional IE, which is absolutely necessary for the receiving
entity to complete the procedure, is missing, then the receiver shall abort
the procedure.
\- Conditional-Optional means:
\- that the IE shall be included by an entity complying with this version of
the specification, if the conditions specified are met.
\- the receiver need not check the presence of the IE in the message. If the
receiver checks the presence of the Conditional-Optional IE, then the IE\'s
absence shall not trigger any of the error handling procedures. The handling
of an absence or erroneous such IEs shall be treated as Optional IEs.
\- Optional means:
\- that the IE shall be included as a service option. Therefore, the IE may be
included or not in a message. The handling of an absent optional IE, or an
erroneous optional IE is specified in subclause 7 \"Error Handling\".
For grouped IEs, the presence requirement of the embedded IE shall follow the
rules:
\- The grouped IE is Mandatory within a given message: the presence
requirements of individual embedded IEs are as stated within the Mandatory
grouped IE for the given message.
\- The grouped IE is Conditional within a given message: if the embedded IE in
the grouped IE is Mandatory or Conditional, this embedded IE is viewed as
Conditional IE by the receiver. If the embedded IE in the grouped IE is
Optional, this embedded IE is viewed as Optional IE by the receiver.
\- The grouped IE is Conditional-Optional within a given message: if the
embedded IE in the grouped IE is Mandatory or Conditional, this embedded IE is
viewed as Conditional-Optional IE by the receiver. If the embedded IE in the
grouped IE is Conditional-Optional, this embedded IE is viewed as Optional IE
by the receiver. If the embedded IE in the grouped IE is Optional, this
embedded IE is viewed as Optional IE by the receiver.- The grouped IE is
Optional within a given message: all embedded IEs in the grouped IE are viewed
as Optional IEs by the receiver.
In all of the above cases, appropriate error handling as described in
subclause 7 shall be applied for protocol errors of the embedded IEs.
### 9.1.2 Grouped Information Elements
Information elements can contain other IEs. This type of IE is called
\"Grouped IEs\".
Grouped IEs have a length value in the TLV encoding, which includes the added
length of all the embedded IEs. Overall coding of a grouped information
element with 3 octets long IE header is defined in subclause 9.3.2
\"Information Element Format\". Each information element within a grouped IE
shall also contain a 3-octet long IE header.
## 9.2 Message Type
Message type uniquely identifies the message being sent. It is a single octet
information element, mandatory in all messages. Table 9.2-1 defines the value
part of the Message type information element.
Table 9.2-1: Message type information element
* * *
Message Type value Message type Reference 0 Reserved  
1 NqAP-IMSI-APN-INFORMATION-REQUEST 8.1 2 NqAP-IMSI-APN-INFORMATION-RESPONSE
8.2 3 NqAP-APN-INFORMATION-REQUEST 8.3 4 NqAP-APN-INFORMATION-RESPONSE 8.4
5-255 Spare. For future use.
* * *
## 9.3 Information Element Coding
### 9.3.1 Information Element Types
A Nq-AP message may contain several information elements. Except the Message
type IE defined in subclause 9.2, all the other Information Elements shall be
TLV (Type, Length, Value) coded. Nq-AP information element type values are
specified in the Table 9.3.1-1.
Table 9.3.1-1: Information Element types for Nq-AP
+---------------+-------------------------------------------------+-----------+ | IE Type value | Information elements | Reference | | | | | | (Decimal) | | | +===============+=================================================+===========+ | 0 | Reserved | | +---------------+-------------------------------------------------+-----------+ | 1 | International Mobile Subscriber Identity (IMSI) | 9.4.1 | +---------------+-------------------------------------------------+-----------+ | 2 | Access Point Name (APN) | 9.4.2 | +---------------+-------------------------------------------------+-----------+ | 3 | RAN Entity Identifier | 9.4.3 | +---------------+-------------------------------------------------+-----------+ | 4 | Subscriber-Information | 9.4.4 | +---------------+-------------------------------------------------+-----------+ | 5 | RAN Associated Information | 9.4.5 | +---------------+-------------------------------------------------+-----------+ | 6 | Cause | 9.4.6 | +---------------+-------------------------------------------------+-----------+ | 7 | Fully Qualified Domain Name (FQDN) | 9.4.7 | +---------------+-------------------------------------------------+-----------+ | 8-255 | Spare. For future use. | | +---------------+-------------------------------------------------+-----------+
### 9.3.2 Information Element Format
Figure 9.3.2-1 depicts the format of an information element.
* * *
                  Bits                                                                      
     Octets       8                                             7   6   5   4   3   2   1   
     1            Type = xxx (decimal)                                                      
     2 to 3       Length = n                                                                
     4 to (n+3)   IE specific data or content of a grouped IE
* * *
Figure 9.3.2-1: Information Element Format
An IE has the following mandatory fields:
\- Type field: This field indicates the type of Information Element. The valid
values of the IE type are defined in clause 9.3.1.
\- Length: This field contains the length of the information element excluding
the first three octets, which are common for all information elements (Type
and Length) and is denoted \"n\" in Figure 9.3.2-1. For all the length fields,
bit 8 of the lowest numbered octet is the most significant bit and bit 1 of
the highest numbered octet is the least significant bit.
## 9.4 Information elements
### 9.4.1 International Mobile Subscriber Identity (IMSI)
The International Mobile Subscriber Identity (IMSI) IE represents the IMSI of
the subscriber. The sending entity copies the value part of the IMSI into
octets 4 to (n+3) of the IMSI IE. IMSI is defined in 3GPP TS 23.003 [5].
* * *
              Bits                                                              
     Octets   8                      7                  6   5   4   3   2   1   
     1        IE Type = 1(decimal)                                              
     2 to 3   Length = n                                                        
     4        Number digit 2         Number digit 1                             
     5        Number digit 4         Number digit 3                             
     ...      ...                    ...                                        
     n+3      Number digit m         Number digit m-1
* * *
Figure 9.4.1-1: IMSI
Octets 4 to (n+3) represent the IMSI value as described in ITU-T Rec E.212
[9], encoded as TBCD digits, i.e. digits from 0 through 9 are encoded \"0000\"
to \"1001\". When there is an odd number of digits, bits 8 to 5 of the last
octet are encoded with the filler \"1111\". The maximum number of digits is
15.
### 9.4.2 Access Point Name (APN)
The Access Point Name information element specifies the APN towards which a
subscriber has active PDN connection and is coded as shown in figure 9.4.2-1.
The encoding the APN field follows 3GPP TS 23.003 [5] subclause 9.1. The
content of the APN field shall be the full APN with both the APN Network
Identifier and APN Operator Identifier being present as specified in 3GPP TS
23.003 [5] subclauses 9.1.1 and 9.1.2, 3GPP TS 23.060 [3] Annex A and 3GPP TS
23.401 [2] subclause 4.3.8.1.
NOTE: The APN field is not encoded as a dotted string as commonly used in
documentation.
* * *
                  Bits                                                  
     Octets       8                         7   6   5   4   3   2   1   
     1            IE Type = 2(decimal)                                  
     2 to 3       Length = n                                            
     4 to (n+3)   Access Point Name (APN)
* * *
Figure 9.4.2-1: APN
### 9.4.3 RAN Entity Identifier
The RAN Entity Identifier IE represents the location granularity for which
subscriber information is provided. The RAN Entity Identifier shall either be
a Macro eNodeB ID or a Home eNodeB ID or a E-UTRAN Cell Global Identity. The
RAN Entity Identifier is coded as shown in figure 9.4.3-1.
* * *
                  Bits                                                
     Octets       8                       7   6   5   4   3   2   1   
     1            IE Type = 3 (decimal)                               
     2 to 3       Length = n                                          
     4            RAN Entity Type                                     
     5 to (n+4)   RAN Entity Value
* * *
Figure 9.4.3-1: RAN Entity Identifier
The RAN Entity Type values are given below in Table 9.4.3-1
Table 9.4.3-1: RAN Entity Type values and their meanings
+------------------------------+------------------------------+ | > RAN Entity Type | > RAN Entity Value (Decimal) | +==============================+==============================+ | Macro eNodeB ID | 0 | +------------------------------+------------------------------+ | Home eNodeB ID | 1 | +------------------------------+------------------------------+ | E-UTRAN Cell Global Identity | 2 | +------------------------------+------------------------------+ | \ | 3 to 255 | +------------------------------+------------------------------+
If the RAN Entity Type is Macro eNodeB ID then the RAN Entity value shall
represent a Macro eNodeB ID. The Macro eNodeB ID is encoded as shown below in
Figure 9.4.3-2.
* * *
                Bits                                                                 
     Octets     8                          7                 6   5   4   3   2   1   
     5          MCC digit 2                MCC digit 1                               
     6          MNC digit 3                MCC digit 3                               
     7          MNC digit 2                MNC digit 1                               
     8          Spare                      Macro eNodeB ID                           
     9 to 10    Macro eNodeB ID                                                      
     11 to 12   Tracking Area Code (TAC)
* * *
Figure 9.4.3-2: Encoding of Macro eNodeB as the RAN Entity Value
The Macro eNodeB ID consists of 20 bits. Bit 4 of Octet 8 is the most
significant bit and bit 1 of Octet 10 is the least significant bit. The coding
of the Macro eNodeB ID is the responsibility of each administration. Coding
using full hexadecimal representation shall be used.
If the RAN Entity Type is Home eNodeB ID then the Home eNodeB ID shall be
encoded as the RAN Entity value as shown below in Figure 9.4.3-3.
* * *
                Bits                                                                
     Octets     8                          7                6   5   4   3   2   1   
     5          MCC digit 2                MCC digit 1                              
     6          MNC digit 3                MCC digit 3                              
     7          MNC digit 2                MNC digit 1                              
     8          Spare                      Home eNodeB ID                           
     9 to 11    Home eNodeB ID                                                      
     12 to 13   Tracking Area Code (TAC)
* * *
Figure 9.4.3-3: Encoding of Home eNodeB as the RAN Entity Value
The Home eNodeB ID consists of 28 bits. See 3GPP TS 36.413 [10]. Bit 4 of
Octet 9 is the most significant bit and bit 1 of Octet 12 is the least
significant bit. The coding of the Home eNodeB ID is the responsibility of
each administration. Coding using full hexadecimal representation shall be
used.
If the RAN Entity Type is E-UTRAN Cell Global Identity (ECGI) then the ECGI
shall be encoded as the RAN Entity value as shown below in Figure 9.4.3-4.
* * *
               Bits                                                                  
     Octets    8                               7             6   5   4   3   2   1   
     5         MCC digit 2                     MCC digit 1                           
     6         MNC digit 3                     MCC digit 3                           
     7         MNC digit 2                     MNC digit 1                           
     8         Spare                           ECI                                   
     9 to 11   ECI (E-UTRAN Cell Identifier)
* * *
Figure 9.4.3-4: Encoding of ECGI as the RAN Entity Value
The E-UTRAN Cell Identifier (ECI) consists of 28 bits. The ECI field shall
start with Bit 4 of octet 8, which is the most significant bit. Bit 1 of Octet
11 is the least significant bit. The coding of the E-UTRAN cell identifier is
the responsibility of each administration. Coding using full hexadecimal
representation shall be used.
### 9.4.4 Subscriber-Information
The Subscriber-Information IE is a grouped IE and it carries the information
related to a subscriber (IMSI and APN).
Octet 1 IE Type = 4 (decimal)
* * *
Octets 2 and 3 Length = n  
Information elements P Condition / Comment IE Type IMSI M IMSI APN M If there
are more than one APN for which PDN connections are activated for a
subscriber, then each APN shall be encoded as a separate instance of the APN
IE APN
Figure 9.4.4-1: Subscriber Information
### 9.4.5 RAN Associated Information
The RAN Associated Information IE is a grouped IE and it carries the
information related to list of subscribers for a given RAN Entity Identifier.
Octet 1 IE Type = 5 (decimal)
* * *
Octets 2 and 3 Length = n  
Information elements P Condition / Comment IE Type RAN Entity Identifier M RAN
Entity Identifier Subscriber Information M If there are more than one
subscriber under the given RAN Entity Identifier, then each subscriber\'s
information shall be encoded as a separate instance of the Subscriber
Information IE Subscriber-Information
Figure 9.4.5-1: RAN Associated Information
### 9.4.6 Cause
The Cause IE shall be used to indicate the RCAF
\- Success / reason for failure of processing a request message;
The Cause IE shall be encoded as specified in figure 9.4.6-1 below.
* * *
. Bits  
Octets 8 7 6 5 4 3 2 1  
1 IE Type = 6 (decimal)  
2 to 3 Length = n  
4 Cause value  
5 Type of the offending IE
* * *
Figure 9.4.6-1: Cause
Cause is a variable length IE, which may have either of the following two
lengths values:
\- If n = 1, then the Cause IE shall be 4 octets long. Therefore, octet 5 will
not be present.
\- If n = 2, then the Cause IE shall be 5 octets long.
The Cause value shall be included in a response message. In a response
message, the Cause value indicates the acceptance or the rejection of the
corresponding request message. The Cause value indicates the explicit reason
for the rejection.
If the rejection is due to a mandatory IE or a verifiable conditional IE is
faulty or missing, the offending IE shall be included in Octet 5.
The following table provides the various cause values
Table 9.4.6-1: Cause values
+--------------------------+-------------+--------------------------+ | Cause Type | Cause value | Meaning | | | | | | | (decimal) | | +==========================+=============+==========================+ | | 0 | Reserved. Shall not be | | | | sent and if received the | | | | Cause shall be treated | | | | as an invalid IE | +--------------------------+-------------+--------------------------+ | Acceptance Cause | 1 | Request Accepted | +--------------------------+-------------+--------------------------+ | | 2 to 15 | Spare. This value range | | | | shall be used for | | | | acceptance cause values. | +--------------------------+-------------+--------------------------+ | Protocol Errors | 16 | Mandatory IE incorrect | +--------------------------+-------------+--------------------------+ | | 17 | Mandatory IE missing | +--------------------------+-------------+--------------------------+ | | 18 | Conditional IE incorrect | +--------------------------+-------------+--------------------------+ | | 19 | Conditional IE missing | +--------------------------+-------------+--------------------------+ | | 20 | Invalid length | +--------------------------+-------------+--------------------------+ | | 21 to 63 | Spare. This value range | | | | shall be used by Cause | | | | values representing | | | | protocol errors. | +--------------------------+-------------+--------------------------+ | Cause Codes Representing | 64 | MME/SGSN Congested | | Status | | | +--------------------------+-------------+--------------------------+ | | 65 to 255 | Spare. For Future Use. | +--------------------------+-------------+--------------------------+
### 9.4.7 Fully Qualified Domain Name (FQDN)
Fully Qualified Domain Name (FQDN) is coded as depicted in Figure 9.4.7-1.
* * *
                  Bits                                             
     Octets       8                    7   6   5   4   3   2   1   
     1            Type = 7 (decimal)                               
     2 to 3       Length = n                                       
     4 to (n+3)   FQDN
* * *
Figure 9.4.7-1: Fully Qualified Domain Name (FQDN)
The FQDN field encoding shall be identical to the encoding of a FQDN within a
DNS message of section 3.1 of IETF RFC 1035 [11] but excluding the trailing
zero byte.
NOTE: The FQDN field in the IE is not encoded as a dotted string as commonly
used in DNS master zone files.
#
# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, certain modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
NOTE 1: The constructions \"shall\" and \"shall not\" are confined to the
context of normative provisions, and do not appear in Technical Reports.
NOTE 2: The constructions \"must\" and \"must not\" are not used as
substitutes for \"shall\" and \"shall not\". Their use is avoided insofar as
possible, and they are not used in a normative context except in a direct
citation from an external, referenced, non-3GPP document, or so as to maintain
continuity of style when extending or modifying the provisions of such a
referenced document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
NOTE 3: The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
NOTE 4: The constructions \"can\" and \"cannot\" shall not to be used as
substitutes for \"may\" and \"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
NOTE 5: The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
The present document specifies the media plane control protocols and
interactions with the media needed to support a Mission Critical Push To Talk
(MCPTT) system interworking with a Land Mobile Radio (LMR) system. This
interworking includes both the signalling and the media planes between the
MCPTT system and the LMR system. The function between the MCPTT system and the
LMR system is referred to as an Interworking Function (IWF).
The IWF supports the basic group and other features as specified in 3GPP TS
23.283 [24].
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 24.379: \"Mission Critical Push To Talk (MCPTT) call control
Protocol specification\".
[3] IETF RFC 3550: \"RTP: A Transport Protocol for Real-Time Applications\".
[4] 3GPP TS 24.483: \"Mission Critical Services (MCS) Management Object
(MO)\".
[5] 3GPP TS 23.379: \"Functional architecture and information flows to support
mission critical communication services; Stage 2\".
[6] 3GPP TS 29.468: \"Group Communication System Enablers for LTE (GCSE_LTE);
MB2 Reference Point; Stage 3\".
[7] IETF RFC 5761: \"Multiplexing RTP Data and Control Packets on a Single
Port\".
[8] Void.
[9] 3GPP TS 25.446: \"MBMS synchronization protocol (SYNC)\".
[10] 3GPP TS 29.281: \"General Packet Radio System (GPRS) Tunnelling Protocol
User Plane (GTPv1-U)\".
[11] 3GPP TS 24.008: \"Mobile radio interface layer 3 specification; Core
Network protocols; Stage 3\".
[12] 3GPP TS 24.481: \"Mission Critical Services (MCS) group management
Protocol specification\".
[13] 3GPP TS 24.484: \"Mission Critical Services (MCS) configuration
management protocol specification\".
[14] Void.
[15] IETF RFC 3830: \"MIKEY: Multimedia Internet KEYing\".
[16] IETF RFC 3711: \"The Secure Real-time Protocol (SRTP)\".
[17] IETF RFC 6509: \"MIKEY-SAKKE: Sakai-Kashar Key Encryption in Multimedia
Internet KEYing (MIKEY)\".
[18] 3GPP TS 33.180: \"Security of the mission critical service\".
[19] 3GPP TS 23.032: \"Universal Geographical Area Description (GAD)\".
[20] IETF RFC 5795: \"The Robust Header Compression (ROHC) Framework\".
[21] IETF RFC 3095: \"RObust Header Compression (ROHC): Framework and four
profiles: RTP, UDP, ESP, and uncompressed\".
[22] IETF RFC 5225: \"RObust Header Compression Version 2 (ROHCv2): Profiles
for RTP, UDP, IP, ESP and UDP-Lite\".
[23] 3GPP TS 23.280: \"Common functional architecture to support mission
critical services; Stage 2\".
[24] 3GPP TS 23.283: \"Mission Critical Communication Interworking with Land
Mobile Radio Systems\".
[25] 3GPP TS 24.380: \"Mission Critical Push To Talk (MCPTT) media plane
control\".
[26] 3GPP TS 29.379: \"Mission Critical Push To Talk (MCPTT) call control
interworking with LMR systems\".
[27] 3GPP TS 22.179: \"Mission Critical Push To Talk (MCPTT) Stage 1\".
# 3 Definitions of terms, symbols and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in 3GPP TR 21.905
[1] and the following apply. A term defined in the present document takes
precedence over the definition of the same term, if any, in 3GPP TR 21.905
[1].
**Floor participant:** The floor participant functional entity is responsible
for floor requests. In the present document this term can be a floor
participant that can be in either an MCPTT system (ref. 3GPP TS 23.379 [5]) or
in an IWF.
**IWF floor control server:** A floor control server that is in the IWF.
**IWF floor participant:** A floor participant that is in the IWF.
**IWF media endpoint:** A media endpoint that is in the IWF.
**Media endpoint:** The end producer or consumer of media and floor control
traffic (see also \"IWF media endpoint\").
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.379 [5] apply:
**Floor control**
**Floor participant**
**Floor control server**
**Group call**
**MCPTT call**
**Mission critical push to talk**
**Private call**
**SIP core**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.283 [24] apply:
**Interworking Function (IWF)**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 29.379 [26] apply:
**IWF performing the controlling role**
**IWF performing the non-controlling**
**IWF performing the participating role**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 24.380 [25] apply:
**Active floor request queue**
**Conversation**
**Effective priority**
**Media burst**
**Media plane control protocols**
**Passive floor request queue**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 33.180 [18] apply:
**Group Master Key (GMK)**
**Group Master Key Identifier (GMK-ID)**
**Private Call Key (PCK)**
**Private Call Key Identifier (PCK-ID)**
**Signalling Protection Key (SPK)**
**Signalling Protection Key Identifier (SPK-ID)**
For the purposes of the present document, the following terms and definitions
given in IETF RFC 3711 [16] apply:
**SRTP master key (SRTP-MK)**
**SRTP master key identifier (SRTP-MKI)**
**SRTP master salt (SRTP-MS)**
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
GMK Group Management Key
GMK-ID Group Master Key Identifier
GMS Group Management Server
GUK-ID Group User Key Identifier
IP Internet Protocol
MBMS Multimedia Broadcast and Multicast Service
MCPTT Mission Critical Push To Talk
PCK Private Call Key
PCK-ID Private Call Key Identifier
PTT Push-To-Talk
RFC Request For Comment
RTCP RTP Control Protocol
RTP Real-time Transport Protocol
SPK Signalling Protection Key
SPK-ID Signalling Protection Key Identifier
SRTCP Secure RTCP
SRTP Secure RTP
SRTP-MK SRTP master key
SRTP-MKI SRTP master key identifier
SRTP-MS SRTP master salt
SSRC Synchronization SouRCe
UE User Equipment
# 4 General
## 4.1 Overview
### 4.1.1 Floor Control
#### 4.1.1.1 General
In an MCPTT group call after the call is setup, at a given time only a single
group member is allowed to talk, and all other affiliated group members listen
to this talker. The control action for obtaining this mode of operation is
known as floor control. The direct actors of floor control are the floor
participants and the floor control server. A floor participant does the floor
control related actions in MCPTT media endpoints and IWF media endpoints. The
floor control server is the decision maker of the floor control. The floor
control server is in the IWF when it is performing the controlling role.
#### 4.1.1.2 On-network floor control
For a general overview of floor control not specific to the IWF, see 3GPP TS
24.380 [25]. In that description, the IWF fulfills all of the described roles
as a peer to the MCPTT server. The following features mentioned in 3GPP TS
24.380 [25] are not fully supported in the present document: cut-in, ambient
listening and multi-talker.
#### 4.1.1.3 Off-network floor control
Off-network is not applicable to the IWF.
#### 4.1.1.4 Determine effective priority
The floor control server can determine how to handle a received Floor Request
message using a number of input parameters. Examples of input parameters that
the floor control server can use are:
1\. the floor priority, using the value of the Floor Priority field in the
Floor Request message;
2\. the \ element as specified in 3GPP TS 24.481 [12];
3\. the participant type, using the \ element specified in
3GPP TS 24.481 [12] or, in case a non-controlling MCPTT function is attached
to a group call, the \ value in the Track Info field in the
Floor Request message;
4\. the type of call indicated in the Floor Indicator field;
5\. the effective priority of the floor participant with the permission to
send media, and the current type of the call (e.g. normal, imminent-peril,
emergency, broadcast); and
6\. any other information in the group document specified in 3GPP TS 24.481
[12] or information stored in the IWF outside the scope of the present
document.
Using a local policy and the above input parameters the floor control server
can determine that a floor request is:
1\. pre-emptive such that the current talker is overridden;
2\. pre-emptive such that the current talker is revoked;
3\. not pre-emptive and put in the floor request queue, if queueing was
negotiated; or
4\. not-pre-emptive and rejected, if queueing was not negotiated.
#### 4.1.1.5 Determine off-network effective priority
Off-network is not applicable to the IWF.
### 4.1.2 Pre-established session call control
Pre-established session call control is not applicable to the IWF.
### 4.1.3 MBMS subchannel control
MBMS is not applicable to the IWF.
## 4.2 Internal structure of media plane control entities
### 4.2.0 General
For clarity, the present document describes media plane aspects of the IWF-1
reference point using the structure shown in 3GPP TS 24.380 [25] and further
detailed in clause 4.2.1. The IWF need not implement the structure of media
plane control entities given in the present document, but the resulting IWF
behaviour on the IWF-1 interface must be as specified in the present document.
The floor control interface towards LMR entities is out of scope of the
present document.
### 4.2.1 Controlling MCPTT function
According to 3GPP TS 23.379 [5], the controlling MCPTT function is divided
into a floor control server and a media distribution function. In the present
document an example of an internal structure of the IWF performing the
controlling role is illustrated in figure 4.2-1.
NOTE: The real internal structure of the IWF is implementation specific but a
possible internal structure is shown to illustrate the procedures.
Figure 4.2.1-1: Internal structure of floor control in the IWF performing the
controlling role
All entities in the IWF performing the controlling role are assumed to have a
direct communication interface to the application and signalling plane. The
interface to the application and signaling plane carries information about SIP
session initialisation and SIP session release, SDP content, etc.
The reference point IWF-1 is described in 3GPP TS 23.283 [24]. The floor
control interface towards the MCPTT media endpoint receives and transmits the
floor control messages from and to the MCPTT media endpoint via the
participating MCPTT function or non-controlling MCPTT function. The procedures
are controlled by a state machine described in clause 6.3.5. One state machine
is needed for each MCPTT media endpoint participating in an MCPTT call. A non-
controlling MCPTT function is seen by the floor control interface towards the
MCPTT client as an MCPTT media endpoint.
The floor control arbitration logic performs the floor control. The floor
control arbitration logic is controlled by a state machine described in clause
6.3.4. One state machine is needed per MCPTT call.
The floor request queue is accessible both by the floor control interface
towards the MCPTT client for all MCPTT media endpoint in the call and the
floor control arbitration logic.
The network media interface receives and sends media from and to the
associated MCPTT media endpoint via the participating MCPTT function or non-
controlling MCPTT function. The network media interface is out of scope of the
present document. One network media interface is needed for each MCPTT media
endpoint participating in an MCPTT call. A non-controlling MCPTT function is
seen by the network media interface as an MCPTT media endpoint.
The media distributor is controlled by the floor control arbitration logic.
The media distributor is out of scope of the present document. One media
distributor is needed per MCPTT call.
The internal interfaces are assumed to transport the following types of
information.
1\. The interface between the network media interface and the floor control
interface towards the MCPTT client:
a. Indication that the network media interface has started to receive media
packets from the associated MCPTT media endpoint or that media packets are no
longer received from the associated MCPTT media endpoint.
NOTE: It is an implementation option whether an indication e.g. is sent for
every received RTP media packet or only when the first packet is received and
then when no more RTP packets are received.
2\. The interface between the floor control interface towards the MCPTT media
endpoint and the floor control arbitration logic:
a. Floor control messages to and from the associated MCPTT media endpoint,
requests to create or delete the state machine instance for the associated
MCPTT media endpoint. The floor control messages to the floor control
arbitration logic are limited to floor control messages that will change the
state of the floor.
3\. The interface between the network media interface and the media
distributor:
a. Media to and from associated MCPTT media endpoint. This interface is out of
scope of the present document.
4\. The interface between the floor control arbitration logic and the media
distributor:
a. Requests to start or stop distributing media to floor participants in the
MCPTT call. Indication that the media distributor has started to receive media
packets from the network media interface associated with the MCPTT media
endpoint with the permission to send media or that media packets are no longer
received from the network media interface from the associated MCPTT media
endpoint.
5\. The interface between the floor control interface towards the MCPTT client
and the floor request queue:
a. Requests to store received Floor Request messages in the queue or requests
to remove Floor Request messages from the queue and the queue content for
building the Floor Queue Position Info message.
6\. The interface between the floor control arbitration logic and the floor
request queue:
a. Requests to store received Floor Request messages in the queue or requests
to remove Floor Request messages from the queue. Indications that the queue is
modified.
### 4.2.2 MCPTT client
A user homed in the IWF is represented as an \"IWF media endpoint\". Actions
relative to an IWF media endpoint are described as appropriate in the
procedures of this present document for the IWF performing the participating,
controlling, and non-controlling roles.
### 4.2.3 Participating MCPTT function
#### 4.2.3.1 General
The IWF performing the participating role uses media plane control (non-SIP)
messages when taking part in the floor control procedures as specified in
clause 6.
The following clauses describe the assumed internal structure of the IWF
performing the participating role and its role in the floor control
procedures.
#### 4.2.3.2 Internal structure of the IWF performing the participating role
In the present document the internal structure of the IWF performing the
participating role is illustrated in figure 4.2.3.2-1.
NOTE: The real internal structure of the IWF performing the participating role
is implementation specific, but a possible internal structure is shown to
illustrate the logic and the procedures.
Figure 4.2.3.2-1: Internal structure of the IWF performing the participating
role
All entities in the IWF performing the participating role have a direct
communication interface to the application and signalling plane. The interface
to the application and signalling plane carries information about SIP session
initialisation and SIP session release, SDP content, etc.
The reference point IWF-1 is described in 3GPP TS 23.283 [24].
The IWF floor participant in the IWF performing the participating role manages
media sessions on behalf of users homed in the IWF for cases where the session
is homed in the MCPTT system. The specifications for the IWF performing the
participating role related to the floor control are in clause 6.4 for media
and media plane control delivery.
### 4.2.4 Non-controlling MCPTT function of an MCPTT group
According to 3GPP TS 24.379 [2] subclause 5.3 the MCPTT server can act in a
non-controlling MCPTT function of an MCPTT group role. In the present document
the internal structure of the non-controlling MCPTT function of the IWF of an
MCPTT group is illustrated in figure 4.2.4-1.
## 4.3 The media plane control channel
### 4.3.1 General
The media plane control channel is used for transport of messages associated
with the floor control protocol.
### 4.3.2 Control channel realization
The media plane control channel is realized by sending RTCP APP packets on top
of UDP/IP. RTCP APP packets are defined in IETF RFC 3550 [3]. The MCPTT
specific coding of the RTCP APP packets is defined in clause 8 of the present
document.
### 4.3.3 Establishing a media plane control channel
#### 4.3.3.1 General
The IWF uses the SDP offer/answer mechanism in order to negotiate the
establishment of the media plane control channel. The SDP offer/answer
procedures for negotiating media plane control channel capabilities are
specified in clause 14. The ABNF is defined in clause 12.
The media description (\"m=\" line) associated with the media plane control
channel shall have the values as described in table 4.3.3.1-1.
Table 4.3.3.1-1: Media plane control channel media description
* * *
Media description element Value \ \"application\" \ RTCP port
\ \"udp\" \ \"MCPTT\"
* * *
The port used for RTCP messages associated with the media plane control
channel shall be different than ports used for RTCP messages associated with
other \"m=\" lines (e.g. RTP) in the SDP.
NOTE 1: As RTCP is used to transport messages on the media plane control
channel, the \"m=\" line port value indicates an RTCP port. This is different
from cases where an \"m=\" line is associated with an RTP-based stream, and
the \"m=\" line port value indicates an RTP port.
NOTE 2: In the case where the media plane control channel uses a different IP
address than other media described in the SDP, a media plane control channel
specific \"c=\" line also needs to be associated with the \"m=\" line
associated with the media plane control channel.
The format of the optional SDP fmtp attribute, when associated with the media
plane control channel, is described in clause 12.
The example below shows an SDP media description for a media plane control
channel.
m=application 20032 udp MCPTT
a=fmtp:MCPTT mc_queueing;mc_priority=5;mc_granted
# 5 Roles
## 5.1 General
This clause associates the IWF with the MCPTT roles described in the stage 2
architecture document (see 3GPP TS 23.379 [5]).
## 5.2 Client
The IWF acts on behalf of all users homed in the IWF. There are no client
procedures specified in the present document and specific client handling
within the LMR system is out of scope.
## 5.3 IWF performing the controlling role
An IWF performing the controlling role shall:
1\. support the role of a controlling MCPTT function as specified in 3GPP TS
23.379 [5];
2\. support negotiating media plane control channel media level attributes as
specified in clause 4.3;
3\. provide floor control arbitration logic with an interface to MCPTT clients
as described in clause 4.2.1 and support the related procedures as specified
in clause 6.3;
4\. provide a network media interface as described in clause 4.2.1 and support
associated procedures as specified in clause 6.3;
5\. provide a media distributor with a floor control interface towards the
MCPTT clients as described in 3GPP TS 24.380 [25] clause 4.2.1 and support
associated procedures in clause 6.3;
6\. support the on-network mode floor control protocol elements as specified
in clause 8: and
7\. support media plane security as specified in clause 13.
An IWF performing the controlling role may:
1\. provide a floor request queue as described in clause 4.2.1 and support the
related procedures as specified in clause 6.3 and clause 4.3.
## 5.4 IWF performing the participating role
An IWF performing the participating role shall:
1\. support the role of a participating MCPTT function;
2\. distribute floor control messages as described in clause 6.3 and support
associated procedures as specified in clause 6.4;
3\. perform endpoint floor control signalling as the floor participant on
behalf of users homed in the IWF; and
NOTE: Floor control is modelled as a floor participant that is part of the IWF
performing the participating role, and sits \"behind\" the participating role.
This is for modelling purposes only and does not impose any particular
structure or implementation on the IWF.
4\. support media plane security as specified in clause 13.
## 5.5 IWF performing the non-controlling role
An IWF performing the non-controlling role of an MCPTT group shall:
1\. support floor control involving groups from multiple MCPTT systems as
specified in 3GPP TS 29.379 [26];
2\. provide a floor control interface towards the controlling MCPTT function
as described in clause 4.2.4 and support the related procedures as specified
in clause 6.5;
3\. provide a media interface towards the controlling MCPTT function as
described in clause 4.2.4 and support the related procedure as specified in
clause 6.5;
4\. provide a media distributor as described in clause 4.2.4 and the related
procedures as specified in clause 6.5; and
5\. support media plane security as specified in clause 13.
# 6 Floor control
## 6.1 General
This clause provides:
1\. the IWF floor participant in clause 6.2;
2\. the IWF floor control server procedures in clause 6.3;
3\. the IWF performing the participating floor control procedures in clause
6.4; and
4\. the IWF performing the non-controlling role of an MCPTT group in clause
6.5.
If media plane security is required, the IWF shall perform the additional
procedures in clause 13.
NOTE: It is possible that in a group re-group operation, the IWF can be
performing both the controlling role for the re-grouped groups and the non-
controlling role for one or more constituent groups. The actual implementation
and internal communication among aspects of the IWF is out of scope.
Editor\'s Note: The procedures of the IWF performing the non-controlling role
are FFS.
## 6.2 Floor participant procedures
Procedures for IWF floor participants are addressed in the following:
\- the IWF performing the controlling role procedures in clause 6.3.4; and
\- the IWF performing the participating role procedures in clause 6.4.
Editor\'s Note: The IWF performing the non-controlling role is FFS.
## 6.3 Floor control server procedures
### 6.3.1 General
The floor control server arbitration logic in the IWF floor control server
shall support the procedures in clauses 6.3.2 and 6.3.3 and shall behave
according to the floor control server state transition diagram for \'general
floor control operation\' in clause 6.3.4.
The floor control interface towards the MCPTT client in the IWF floor control
server shall behave according to the floor control server state transition
diagram for \'basic floor control operation towards the floor participant\' as
specified in clause 6.3.5.
### 6.3.2 IWF performing the controlling role procedures at MCPTT call
initialization
#### 6.3.2.1 General
Clause 6.3.2.2 describes the initial procedures when a new SIP session is
establishing a group session or a private session with floor control.
Clause 6.3.2.3 describes the procedures when the IWF performing the non-
controlling role switches from the non-controlling role to the controlling
role.
#### 6.3.2.2 Initial procedures
When an MCPTT call is established a new instance of the floor control server
state machine for \'general floor control operation\' is created.
For each MCPTT media endpoint added to the MCPTT call, a new instance of the
floor control server state machine for \'basic floor control operation towards
the floor participant\' is added.
If the optional \"mc_queueing\" feature is supported and has been negotiated
as specified in clause 14, the IWF floor control server could queue the
implicit floor control request for the MCPTT media endpoint.
For cases where a SIP request originates in the MCPTT system, the initial SIP
INVITE request or SIP REFER request to establish an MCPTT chat group call or
to rejoin an ongoing MCPTT call is not handled as an implicit floor control
request message by the IWF floor control server unless explicitly stated in
the SIP INVITE request or in the SIP REFER request.
The permission to send media to the inviting MCPTT media endpoint due to
implicit floor control request is applicable to both confirmed indication and
unconfirmed indication.
When the first unconfirmed indication is received from the invited
participating MCPTT function (see 3GPP TS 29.379 [26]) the IWF floor control
server optionally can give an early indication to send RTP media packets, to
the inviting MCPTT media endpoint.
Before the IWF floor control server sends the first floor control message in
the MCPTT call, the IWF floor control server has to assign itself an SSRC
identifier to be included in media floor control messages and quality feedback
messages if the IWF is supporting that option. A suitable algorithm to
generate the SSRC identifier is described in IETF RFC 3550 [3].
The MCPTT floor participant and the IWF floor control server can negotiate the
maximum priority level that the floor participant is permitted to request. The
IWF floor control server can pre-empt the current sender based on the
negotiated maximum priority level that the MCPTT floor participant is
permitted to request, and the priority level included in the Floor Request
message.
NOTE: The maximum priority level that an MCPTT floor participant can use is
negotiated as specified in clause 14.3.3 and is based on group configuration
data retrieved by the IWF performing the controlling role from the group
management server as described in 3GPP TS 24.481 [12] and local policies
applied by the IWF performing the controlling role.
The MCPTT floor participant and the IWF floor control server can negotiate
queueing of floor requests using the \"mc_queueing\" fmtp attribute as
described in clause 14. If queueing is supported and negotiated, the IWF floor
control server queues the floor control request if a Floor Request message is
received when another floor participant has the floor and the priority of the
current speaker is the same or higher.
#### 6.3.2.3 Switching from a non-controlling to a controlling role
Editor\'s Note: The IWF non-controlling role procedures are FFS.
### 6.3.3 Floor control procedures at MCPTT call release
When an MCPTT media endpoint leaves an MCPTT call and the MCPTT call remains
ongoing with the other media endpoints, the IWF floor control server follows a
two-step procedure.
> Step 1 The IWF stops sending floor control messages and RTP media packets to
> the MCPTT media endpoint leaving the MCPTT call and, the IWF discards floor
> control messages and RTP media packets received from the MCPTT media
> endpoint leaving the MCPTT call.
>
> Step 2 When the application and signalling plane has determined that the
> MCPTT call with this MCPTT floor participant has been released, the
> corresponding instance of the IWF floor control server state machine for
> \'basic floor control operation towards the floor participant\' is released.
When an MCPTT call is released, the IWF floor control server follows a two-
step procedure.
> Step 1 The IWF stops sending floor control messages and RTP media packets to
> all floor participants in the MCPTT call.
>
> Step 2 When the application and signalling plane has determined that the
> MCPTT call has been released, the corresponding instance of the floor
> control server state machine for \'general floor control operation\' are
> also terminated, along with any \'basic floor control operation towards the
> floor participant\' state machines for the floor participants of this call.
The floor control server state machine for general floor control operation
initiates the MCPTT call release depending on the release policy specified in
3GPP TS 29.379 [26].
### 6.3.4 Floor control server state transition diagram for general floor
control operation
#### 6.3.4.1 General
The floor control server arbitration logic in the floor control server in the
IWF shall behave according to the state diagram in Figure 6.3.4.1-1 and state
transitions specified in this clause. The present clause is applicable for
floor control of groups homed in the IWF.
Figure 6.3.4.1-1: Floor control server state transition diagram for \'general
floor control operation\'
The floor control arbitration logic in the floor control server shall keep one
instance of the \'general floor control operation\' state machine per MCPTT
call.
If floor control messages or RTP media packets arrives in a state where there
is no procedure specified in the following clauses the floor control
arbitration logic in the IWF floor control server:
1\. shall discard the floor control message;
2\. shall request the media distributor in the IWF to discard any received RTP
media packet; and
3\. shall remain in the current state.
State details are explained in the following clauses.
#### 6.3.4.2 State: \'Start-stop\'
##### 6.3.4.2.1 General
When a new instance of the \'general floor control operation\' state machine
is initiated, before any floor control related input is applied, the state
machine is in \'Start-stop\' state. Similarly, when the call is released the
state machine shall return to the \'Start-stop\' state or the related MCPTT
call is released.
##### 6.3.4.2.2 MCPTT call initialization
When an MCPTT call is initiated as specified in 3GPP TS 29.379 [26] and
1\. if a confirmed indication is required and at least one invited media
endpoint has accepted the invitation;
2\. if a confirmed indication is not required; or
3\. if the initialised MCPTT call is a temporary group session;
NOTE: An MCPTT group call is a temporary group session when the \ element is present in the \ element as specified in
3GPP TS 24.481 [12].
then the floor control arbitration logic in the floor control server:
1\. shall create an instance of the \'general floor control operation\' state
machine;
2\. shall wait for the \'basic floor control operation towards the floor
participant\' to be initialized before continuing the following steps;
3\. when the \'basic floor control operation towards the floor participant\'
state machine is initialized, and the initialised session is not a temporary
group session:
a. if the \"mc_granted\" fmtp attribute is not negotiated as specified in
clause 14:
i. if the floor control server is granting an implicit floor request at MCPTT
call establishment, shall act as if a Floor Request message was received and
perform the actions specified in clause 6.3.4.3.3; or
ii. if the floor control server is not granting an implicit floor request at
MCPTT call establishment, shall enter the \'G: Floor Idle\' state as specified
in clause 6.3.4.3.2; or
b. if the \"mc_granted\" fmtp attribute is negotiated as specified in clause
14, shall enter the \'G: Floor Taken\' state as specified in clause 6.3.4.4.2;
and
4\. if the \'basic floor control operation towards the floor participant\'
state machine is initialized, and the initialised session is a temporary group
session, shall enter the \'G: Initialising\' state as specified in the clause
6.3.4.8.1.
#### 6.3.4.3 State: \'G: Floor Idle\'
##### 6.3.4.3.1 General
The floor control arbitration logic in the IWF floor control server is in this
state when no floor participant currently has permission to send media.
Timer T4 (Inactivity) and timer T7 (Floor Idle) can be running when the floor
control arbitration logic in the IWF floor control server is in this state.
##### 6.3.4.3.2 Enter the \'G: Floor Idle\' state
When entering this state from any state except the \'Start-stop\' state and if
no MCPTT media endpoint negotiated support of queueing floor requests as
described in clause 14, and the IWF does not require queuing for its IWF floor
participants, and the state machine specified in clause 6.3.6 does not exist,
the floor control arbitration logic in the IWF floor control server:
1\. if there is a Track Info field associated with the floor control server
state transition diagram for \'general floor control operation\' stored, shall
remove the Track Info field from the storage;
2\. if the active floor request queue is empty the IWF floor control server:
a. shall send Floor Idle message to all MCPTT floor participants. The Floor
Idle message:
i. shall include a Message Sequence Number field with a Message Sequence
Number value increased with 1; and
ii. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
NOTE 1: How the IWF informs IWF media endpoints of the idle floor is out of
scope of the present document.
b. shall start timer T7 (Floor Idle) and initialise counter C7 (Floor Idle) to
1;
c. shall start timer T4 (Inactivity); and
d. shall set the general state to the \'G: Floor Idle\' state; and
3\. if the active floor request queue is not empty the IWF floor control
server:
a. shall select a queued floor request from the top of the active floor
request queue;
b. shall remove that queued floor request from the active floor request queue;
c. if the queued floor request includes a Track Info field, shall store the
Track Info field and associate it with the floor control server state
transition diagram for \'general floor control operation\'; and
d. shall enter the \'G: Floor Taken\' state as specified in the clause
6.3.4.4.2 with respect to that floor participant.
When entering this state from any state except the \'Start-stop\' state and
the state machine specified in clause 6.3.6 exists, the floor control
arbitration logic in the IWF floor control server:
1\. if there is a Track Info field associated with the floor control server
state transition diagram for \'general floor control operation\' stored, shall
remove the Track Info field from the storage;
2\. shall send Floor Idle message to all MCPTT floor participants which are
configured to listen to the overridden participant. The Floor Idle message:
a. shall include a Message Sequence Number field with a Message Sequence
Number value increased with 1; and
b. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
NOTE 2: How the IWF informs IWF media endpoints of the idle floor is out of
scope of the present document.
3\. shall send Floor Taken message to MCPTT floor participants which are
configured to listen only to the overridden participant. The Floor Taken
message:
a. if privacy is not requested, shall include the granted MCPTT user\'s
(overriding participant) MCPTT ID in the Granted Party\'s Identity field;
b. shall include a Message Sequence Number field with a \ value increased with 1; and
c. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
NOTE 3: How the IWF informs IWF media endpoints of the taken floor is out of
scope of the present document.
4\. shall set the general state to the \'G: Floor Taken\' state; and
5\. shall send the termination instruction to the \'dual floor control
operation\' state machine.
##### 6.3.4.3.3 Receive Floor Request message (R: Floor Request)
Upon receiving a floor request message (from an MCPTT floor participant that
is permitted to make a floor request) the floor control arbitration logic in
the IWF floor control server:
1\. shall reject the request if one of the following conditions is fulfilled:
a. if there is only one media endpoint in the MCPTT call; and
b. \ element is present in the \ element as
specified 3GPP TS 24.481 [12] for the associated floor participant;
2\. if the floor request is rejected the IWF floor control server:
a. shall send the Floor Deny message. The Floor Deny message:
i. shall include in the Reject Cause field the \ value:
A. cause #3 (Only one participant), if there is only one media endpoint in the
MCPTT call; or
B. cause #5 (Receive only), if the \ element is present
in the \ element as specified in 3GPP TS 24.481 [12] for the associated
MCPTT floor participant;
ii. may include an additional text string explaining the reason for rejecting
the floor request in the \ value of the Reject Cause field; and
iii. if the Floor Request included a Track Info field, shall include the
received Track Info field;
b. shall remain in the \'G: Floor Idle\' state; and
3\. if the floor request is granted the IWF floor control server:
a. shall stop timer T4 (Inactivity);
b. shall stop timer T7 (Floor Idle);
c. if the floor is being granted to an MCPTT floor participant, and if a Track
Info field is included in the Floor Request message, shall store the received
Track Info field, and
d. shall enter the \'G: Floor Taken\' state as specified in the clause
6.3.4.4.2.
##### 6.3.4.3.3a IWF floor participant grant (I: IWF Floor Participant Grant)
To grant floor to an IWF floor participant, the floor control arbitration
logic in the IWF floor control server:
1\. shall stop timer T4 (Inactivity);
2\. shall stop timer T7 (Floor Idle);
3\. if the floor is being granted to an IWF floor participant,
a. shall generate and store an SSRC; otherwise
b. shall store the SSRC of the IWF floor participant granted the permission to
send media until the floor is released associated to that floor request; and
4\. shall enter the \'G: Floor Taken\' state as specified in the clause
6.3.4.4.2.
##### 6.3.4.3.4 Timer T7 (Floor Idle) expired
On expiry of timer T7 (Floor Idle) the floor control arbitration logic in the
IWF floor control server:
1\. shall restart timer T7 (Floor Idle) and increment counter C7 (Floor Idle)
by 1 if counter C7 (Floor Idle) has not reached its upper limit;
2\. shall send a Floor Idle message to all MCPTT floor participants in the
MCPTT call if counter C7 (Floor Idle) has not reached its upper limit. The
Floor Idle message:
a. shall include a Message Sequence Number field with a \ value increased with 1; and
NOTE: How the IWF informs IWF media endpoints of the idle floor is out of
scope of the present document.
3\. shall remain in the \'G: Floor Idle\' state.
##### 6.3.4.3.5 Timer T4 (Inactivity) expired
On expiry of timer T4 (Inactivity) the floor control arbitration logic in the
IWF floor control server based on a configurable service provider policy
either:
1\. shall indicate to the application and signalling plane that timer T4
(Inactivity) has expired;
2\. if the application and signalling planes initiates MCPTT call release,
shall enter the \'Releasing\' state; and
3\. if the application and signalling planes do not initiate MCPTT call
release:
a. should restart the T4 (Inactivity) timer; and
b. shall remain in the \'G: Floor Idle\' state.
##### 6.3.4.3.6 Receive an implicit floor request (R: Implicit floor request)
Upon receiving an implicit floor request due to an upgrade to an emergency
group call or due to an upgrade to imminent peril call, the floor control
arbitration logic in the IWF floor control server:
1\. shall reject the request if there is only one media endpoint in the MCPTT
call;
2\. if the floor request is rejected the IWF floor control server:
a. shall send the Floor Deny message. The Floor Deny message:
i. shall include in the Reject Cause field the \ value cause #3
(Only one participant); and
ii. may include in the Reject Cause field an additional text string explaining
the reason for rejecting the floor request in the \ value; and
b. shall remain in the \'G: Floor Idle\' state; and
3\. if the floor request is granted the IWF floor control server:
a. shall stop the timer T4 (Inactivity);
b. shall stop the timer T7 (Floor Idle); and
c. shall enter the \'G: Floor Taken\' state as specified in the clause
6.3.4.4.2.
#### 6.3.4.4 State: \'G: Floor Taken\'
##### 6.3.4.4.1 General
The floor control arbitration logic in the IWF floor control server uses this
state when it has permitted one or more media endpoints in the MCPTT call to
send media.
Timer T1 (End of RTP media) is running when the floor control server is in
this state.
Timer T2 (End talking) can be running when the IWF floor control server is in
this state.
Timer T20 (Floor Granted) is running to guarantee reliable delivery of the
Floor Granted message, if the granted floor request was queued.
##### 6.3.4.4.2 Enter the \'G: Floor Taken\' state
When entering this state, the floor control arbitration logic in the IWF floor
control server:
1\. shall send a Floor Granted message to the MCPTT floor participant to which
the floor is granted. The Floor Granted message:
a. shall include the value of timer T2 (Stop talking) in the Duration field;
b. shall include the granted priority in the Floor priority field;
c. if a Track Info field associated with the floor control server state
transition diagram for \'general floor control operation\' is stored, shall
include the stored Track Info field; and
d. if a group call is a broadcast group call, system call, emergency call, an
imminent peril call or a temporary group session, shall include the Floor
Indicator field with appropriate indications;
2\. shall start timer T20 (Floor Granted) if the floor request was queued for
the participant to which the floor is granted and initialise the counter C20
(Floor Granted) to 1;
3\. shall send Floor Taken message to all MCPTT floor participants. The Floor
Taken message:
a. shall include the granted user\'s MCPTT ID in the Granted Party\'s Identity
field, if privacy is not requested;
b. shall include a Message Sequence Number field with a Message Sequence
Number value increased with 1;
c. if the session is a broadcast group call, shall include the Permission to
Request the Floor field set to \'0\';
d. if the session is not a broadcast group call, may include the Permission to
Request the Floor field set to \'1\'; and
e. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
NOTE: How the IWF informs IWF media endpoints of the taken floor is out of
scope of the present document.
4\. shall start timer T1 (End of RTP media) for the participant to which the
floor is granted; and
5\. shall set the general state to \'G: Floor Taken\' state.
##### 6.3.4.4.3 Timer T1 (End of RTP media) expired
On expiry of timer T1 (End of RTP media), the floor control arbitration logic
in the IWF floor control server:
1\. shall stop the timer T2 (Stop talking) for the participant to which the
floor is granted; if running;
2\. shall stop timer T20 (Granted re-send) for the participant to which the
floor is granted, if running;
3\. shall request the media distributor to stop distributing RTP media packets
received from the participant for which T1 (End of RTP media) has expired
(with the exception of RTP media packets already in the buffer (if RTP media
buffering is ongoing)) to other media endpoints; and
4\. shall enter the \'G: Floor Idle\' state as specified in the clause
6.3.4.3.2;
##### 6.3.4.4.4 Timer T2 (Stop talking) expired
On expiry of timer T2 (Stop talking), the floor control arbitration logic in
the IWF floor control server:
1\. shall stop timer T1 (End of RTP media) for the MCPTT participant for which
timer T2 has expired;
2\. shall include the Reject Cause field with the \ value set to
#2 (Media burst too long) in the Floor Revoke message sent in clause
6.3.4.5.2; and
3\. shall enter the \'G: pending Floor Revoke\' state as specified in the
clause 6.3.4.5.2.
##### 6.3.4.4.5 Receive RTP media packets (R: RTP media)
Upon receiving an indication from the media distributor that RTP media packets
are received from the MCPTT media endpoint, the floor control arbitration
logic in the IWF floor control server:
1\. shall start timer T2 (Stop talking) for the MCPTT media endpoint from
which the RTP packet has been received, if not running;
2\. shall restart timer T1 (End of RTP media) for the participant from which
the RTP packet has been received;
3\. shall stop timer T20 (Floor Granted) for the participant from which the
RTP packet has been received, if running;
4\. shall forward the RTP media packets to media endpoints according to local
policy; and
NOTE: If dual floor control is ongoing as described in clause 6.3.6, the list
of floor participants that receive the overriding, overridden, or both
transmissions is based on configuration.
5\. shall remain in the \'G: Floor Taken\' state.
##### 6.3.4.4.6 Receive Floor Release message (R: Floor Release)
Upon receiving a Floor Release message or upon determining that a user homed
in the IWF has released the floor, the floor control arbitration logic in the
IWF floor control server:
1\. shall request the media distributor to stop forwarding RTP media packets
received from the participant that sent the Floor Release message;
2\. shall stop timer T2 (Stop talking) for the participant that sent the Floor
Release message, if running;
3\. shall stop timer T20 (Granted re-send) for the participant that sent the
Floor Release message, if running; and
4\. shall enter the \'G: Floor Idle\' state as specified in the clause
6.3.4.3.2;
##### 6.3.4.4.6a IWF floor participant release (I: IWF floor participant
release)
Upon deciding to release the floor, the floor control arbitration logic in the
IWF floor control server:
1\. shall request the media distributor to stop forwarding RTP media packets;
and
2\. shall enter the \'G: Floor Idle\' state as specified in the clause
6.3.4.3.2.
##### 6.3.4.4.7 Receive Floor Request message with pre-emptive priority (R:
pre-emptive Floor Request)
NOTE: This procedure is also invoked from the clause 6.3.5.4.4.
On receipt of a floor request message with effective priority indicating pre-
emptive priority, and if the effective priority of the floor participant with
permission to send media is not the pre-emptive priority, the floor control
arbitration logic in the IWF floor control server:
1\. based on local policy, select one of the following options:
a. revoke the current speaker; or
b. allow media from both the current speaker and from the participant now
requesting floor with a pre-emptive floor priority;
2\. if revoking current speaker is selected:
a. shall stop timer T1 (End of RTP media), if running;
b. shall stop timer T20 (Floor Granted), if running;
c. shall include a Reject Cause field with the \ value set to #4
(Media Burst pre-empted) in the Floor Revoke message sent in clause 6.3.4.5.2;
d. shall enter the \'G: pending Floor Revoke\' state as specified in the
clause 6.3.4.5.2;
e. shall insert the MCPTT floor participant into the active floor request
queue to the position in front of all queued requests, if not inserted yet or
update the position of the floor participant in the active floor request queue
to the position in front of all other queued requests, if already inserted;
and
f. shall send a Floor Queue Position Info message to the requesting MCPTT
floor participant, if negotiated support of queueing of floor requests as
specified in clause 14. The Floor Queue Position Info message:
i. include the queue position and floor priority in the Queue Info field; and
ii. if the Floor Request message included a Track Info field, shall include
the received Track Info field; and
3\. if allow media from both the current speaker and from the participant now
requesting floor with a pre-emptive priority is selected:
a. shall perform the actions specified in the clause 6.3.6.2.2.
##### 6.3.4.4.7a Receive Floor Request message multi-talker (R: multi-talker
Floor Request)
The multi-talker feature is not supported in this version of the present
document.
##### 6.3.4.4.8 Receive Floor request message from MCPTT floor participant (R:
Floor Request)
Upon receiving a floor request message from the MCPTT floor participant that
has been granted permission to send media, the floor control arbitration logic
in the IWF floor control server:
1\. shall send a Floor Granted message to the previously granted MCPTT floor
participant. The Floor Granted message:
a. shall include the value of timer T2 (Stop talking) running for this MCPTT
floor participant in the Duration field;
b. shall include the granted priority in the Floor priority field; and
c. if the Floor Request message included a Track Info field, shall include the
received Track Info field; and2. shall remain in the \'G: Floor Taken\' state.
##### 6.3.4.4.9 Timer T20 (Floor Granted) expired
On expiry of timer T20 (Floor Granted), the floor control arbitration logic in
the IWF floor control server:
1\. shall send a Floor Granted message to the granted floor participant if
counter C20 (Floor Granted) has not reached its upper limit: The Floor Granted
message:
a. shall include the value of timer T2 (Stop talking) in the Duration field;
b. shall include the granted priority in the Floor priority field; and
c. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
2\. shall start timer T20 (Floor Granted) and increment counter C20 (Floor
Granted) by 1 if counter C20 (Floor Granted) has not reached its upper limit;
and
3\. shall remain in the \'G: Floor Taken\' state.
##### 6.3.4.4.10 Timer T20 (Floor Granted) expired N times
When timer T20 (Floor Granted) expires and counter C20 (Floor Granted) reaches
its upper limit, the floor control arbitration logic in the IWF floor control
server:
1\. shall remain in the \'G: Floor Taken\' state.
##### 6.3.4.4.11 MCPTT media endpoint release (R: client release)
If the IWF floor control server receives an indication from the floor control
interface towards the MCPTT client that the MCPTT media endpoint has started
to disconnect from the MCPTT call, or the IWF decides to release the floor,
the floor control arbitration logic in the floor control server:
1\. shall enter the \'G: Floor Idle\' state as specified in the clause
6.3.4.3.2.
##### 6.3.4.4.12 Receive an implicit floor request (R: Implicit floor request)
Upon receiving an implicit floor request due to an upgrade to an emergency
group call or due to an upgrade to imminent peril call, the floor control
arbitration logic in the IWF floor control server:
1\. shall stop timer T1 (End of RTP media), if running;
2\. shall stop timer T20 (Floor Granted), if running;
3\. shall set the Reject Cause field in the Floor Revoke message to #4 (Media
Burst pre-empted);
4\. shall enter the \'G: pending Floor Revoke\' state as specified in the
clause 6.3.4.5.2;
5\. shall insert the MCPTT floor participant into the active floor request
queue to the position in front of all queued requests, if not inserted yet or
update the position of the floor participant in the active floor request queue
to the position in front of all other queued requests, if already inserted;
and
6\. shall send a Floor Queue Position Info message to the requesting MCPTT
floor participant, if negotiated support of queueing floor requests as
specified in clause 14. The Floor Queue Position Request message:
a. shall include the queue position and floor priority in the Queue Info
field; and
b. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications.
#### 6.3.4.5 State: \'G: pending Floor Revoke\'
##### 6.3.4.5.1 General
The floor control arbitration logic in the IWF floor control server uses this
state after having sent a Floor Revoke message to the MCPTT floor participant.
Timer T3 (Stop talking grace) is running when the floor control arbitration
logic in the IWF floor control server is in this state.
In this state, the IWF forwards RTP media packets to the MCPTT media endpoints
in the MCPTT call.
##### 6.3.4.5.2 Enter the \'G: pending Floor Revoke\' state
When entering this state, the floor control arbitration logic in the IWF floor
control server:
1\. shall send the Floor Revoke message to the MCPTT floor participant. The
Floor Revoke message:
a. shall include the reason for sending the Floor Revoke message in the
\ value in the Reject Cause field; and
b. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
2\. shall start timer T3 (Stop talking grace) for which a Floor Revoke message
has been sent; and
3\. shall set the general state to \'G: pending Floor Revoke\'.
##### 6.3.4.5.3 Receive RTP media packets (R: RTP media)
Upon receiving an indication from the media distributor that RTP media packets
are received from the permitted floor participant the IWF floor control
server:
1\. shall restart timer T1 (End of RTP media);
NOTE 1: If the upper limit for timer T3 (Stop talking grace) is less than the
upper limit of timer T1 (End of RTP media) then timer T1 (End of RTP media)
will not expire.
2\. shall instruct the media distributor to forward the RTP media packets to
MCPTT media endpoints according to local policy; and
NOTE 2: If dual floor control is ongoing as described in clause 6.3.6, the
list of floor participants that receive the overriding, overridden, or both
transmissions is based on configuration.
3\. shall remain in the \'G: pending Floor Revoke\' state.
##### 6.3.4.5.4 Receive Floor Release message (R: Floor Release)
Upon receiving a Floor Release message for which a Floor Revoke message has
been sent, the floor control arbitration logic in the IWF floor control
server:
1\. shall request the media distributor to stop forwarding RTP media packets;
2\. shall stop timer T1 (End of RTP media) , if running;
3\. shall stop timer T3 (Stop talking grace);
4\. if the active floor request queue is not empty the IWF floor control
server shall enter the \'G: Idle\' state as specified in the clause 6.3.4.3.2;
and
5\. if the active floor request queue is empty the IWF floor control server
shall enter the \'G: Idle\' state as specified in the clause 6.3.4.3.2.
##### 6.3.4.5.5 Timer T3 (Stop talking grace) expired
On expiry of timer T3 (Stop talking grace) for which a Floor Revoke message
has been sent, the floor control arbitration logic in the IWF floor control
server:
1\. shall indicate to the interface towards the MCPTT client that the general
state machine is now \'G: Floor Idle\'; and
2\. shall enter the \'G: Idle\' state as specified in the clause 6.3.4.3.2.
##### 6.3.4.5.6 Timer T1 (End of RTP media) expired
On expiry of timer T1 (End of RTP media) assigned to the MCPTT floor
participant for which a Floor Revoke message has been sent, the floor control
arbitration logic in the IWF floor control server:
1\. shall stop timer T3 (Stop talking grace); and
2\. if the floor is now empty; shall enter the \'G: Floor Idle\' state as
specified in the clause 6.3.4.3.2.
On expiry of timer T1 (End of RTP media) assigned to a participant different
than the MCPTT floor participant for which a Floor Revoke message has been
sent, the floor control arbitration logic in the IWF floor control server:
1\. shall stop forwarding related RTP media packets;
2\. shall stop timer T2 (Stop talking) for the MCPTT floor participant for
which timer T1 (End of RTP media) expired, if running; and
3\. shall stop timer T20 (Granted re-send) for the participant, if running.
#### 6.3.4.6 In any state
##### 6.3.4.6.1 General
This clause describes the actions to be taken in all states defined for the
general state diagram with the exception of the \'Start-stop\' state.
##### 6.3.4.6.2 Receive MCPTT call release - 1
This clause is used by the floor control arbitration logic in the IWF floor
control server when an MCPTT call is released.
Upon receiving an MCPTT call release step 1 request from the application and
signalling plane or upon determining that a user homed in the IWF has released
the call, the floor control arbitration logic in the IWF floor control server:
1\. shall request the media distributor to stop sending RTP media packets to
MCPTT media endpoints; and
2\. shall enter the \'Releasing\' state.
##### 6.3.4.6.3 Receive an instruction to merge group calls (R: Merge)
Upon receiving an instruction from the application and signalling plane to
merge the ongoing group call with other group calls, the IWF floor control
server:
1\. shall perform the actions in clause 6.5.2.3; and
2\. shall enter the \'Start-stop\' state.
#### 6.3.4.7 State: \'Releasing\'
##### 6.3.4.7.1 General
The floor control arbitration logic in the IWF floor control server uses this
state while waiting for the application and signalling plane to finalize the
disconnection of an MCPTT call.
##### 6.3.4.7.2 Receive MCPTT call release - 2
Upon receiving an MCPTT call release step 2 request from the application and
signalling plane, the floor control arbitration logic in the IWF floor control
server:
1\. shall release all resources reserved in the media plane including the
instances used for the \'Floor control server state transition diagram for
general floor control operation\', and \'Floor control server state transition
diagram for basic floor control operation towards the floor participant\'
state machines and any running timers associated with the state machines; and
2\. shall enter the \'Start-stop\' state.
#### 6.3.4.8 State: \'G: Floor Initialising\'
##### 6.3.4.8.1 General
The floor control arbitration logic in the IWF floor control server uses this
state while waiting for all invited constituent MCPTT groups to reply with a
final SIP response.
There are no timers running in this state. The floor control arbitration logic
is relying on SIP timers in the signalling and application plane.
##### 6.3.4.8.2 Enter the \'G: Initialising\' state
When entering this state, the floor control arbitration logic:
1\. shall set the general state to the \'G: Initialising\' state.
##### 6.3.4.8.3 Receiving a floor request from a constituent MCPTT group (R:
mcptt-floor-request)
Upon receiving an indication from the application and signalling plane that a
floor request is received from one of the invited constituent MCPTT groups in
an application/vnd.3gpp.mcptt-floor-request+xml MIME body, the floor control
arbitration logic:
1\. shall cache the application/vnd.3gpp.mcptt-floor-request+xml MIME body;
and
2\. remain in the \'G: Initialising\' state.
##### 6.3.4.8.4 All final SIP responses received (R: final SIP responses)
Upon receiving an indication from the application and signalling plane that
all invited constituent MCPTT groups have sent a final SIP response, the floor
control arbitration logic:
1\. if at least one application/vnd.3gpp.mcptt-floor-request+xml MIME body
exists with the \ element set to \"general\":
a. shall select the floor participant with the highest priority as described
in clause 4.1.1.4:
i. among the cached application/vnd.3gpp.mcptt-floor-request+xml MIME bodies
with the \ element set to \"general\"; and
ii. the floor participant initialising the temporary group session as
described in clause 4.1.1.4, if the floor participant initialising the
temporary group session negotiated implicit floor request as specified in
clause 14;
b. shall send a Floor Revoke message to all MCPTT floor participants in the
cached application/vnd.3gpp.mcptt-floor-request+xml MIME body with the
\ element set to \"general\" that are not granted the permission
to send media. The Floor Revoke message:
i. shall include the \ value set to \'4\' (Media Burst pre-
empted) in the Reject Cause field;
ii. shall include information taken from the \ element in the
cached application/vnd.3gpp.mcptt-floor-request+xml MIME body with the
\ element set to \"general\" in the Track Info field; and
iii. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
NOTE 1: How the IWF informs IWF media endpoints of the floor revoke is out of
scope of the present document.
c. if the floor participant selected to be granted the floor is in one of
invited constituent MCPTT groups:
i. shall convert the \ element to a format of a Track Info field
and cache the Track Info field associated with the floor control server state
transition diagram for \'general floor control operation\'; and
ii. shall enter the \'G: Taken\' state as specified in the clause 6.3.4.4.2
using the selected floor participant as the requesting floor participant;
2\. if at least one application/vnd.3gpp.mcptt-floor-request+xml MIME body
exists with the \ element set to \"dual\":
a. shall select the floor participant with the highest priority as described
in clause 4.1.1.4 among the cached application/vnd.3gpp.mcptt-floor-
request+xml MIME bodies with the \ element set to \"dual\"; and
b. shall send a Floor Revoke message to all floor participants in the cached
application/vnd.3gpp.mcptt-floor-request+xml MIME body with the \
element set to \"dual\" that are not granted the permission to send media. The
Floor Revoke message:
i. shall include the \ value set to \'4\' (Media Burst pre-
empted) in the Reject Cause field;
ii. shall include information taken from the \ element in the
cached application/vnd.3gpp.mcptt-floor-request+xml MIME body with the
\ element set to \"general\" in the Track Info field;
iii. shall include the Floor Indicator with the G-bit set to \'1\' (Dual
floor);
iv. shall convert the \ element to a format of a Track Info field
and cache the Track Info field associated with floor control server state
transition diagram for \'dual floor control operation\'; and
v. shall enter the \'D: Floor Taken\' state as specified in the clause
6.3.6.3.2 using the selected floor participant as the requesting floor
participant; and
NOTE 2: How the IWF informs IWF media endpoints of the floor revoke is out of
scope of the present document.
3\. if no cached application/vnd.3gpp.mcptt-floor-request+xml MIME with the
\ element set to \"general\" body exists:
a. if an implicit floor request is negotiated as described in clause 14 when
the temporary group session was established, shall enter the \'G: Taken\'
state as specified in the clause 6.3.4.4.2; and
b. if an implicit floor request is not negotiated as described in clause 14
when the temporary group session was established, shall enter the \'G: Idle\'
state as specified in the clause 6.3.4.3.2.
### 6.3.5 Floor control server state transition diagram for basic floor
control operation towards the floor participant
#### 6.3.5.1 General
The floor control interface towards the MCPTT client in the IWF floor control
server shall behave according to the state diagram and state transitions
specified in this clause.
Editor\'s Note: procedures for the IWF performing the non-controlling role are
FFS.
The description of the floor control interface towards an IWF media endpoint
is part of the general floor control server state diagram and state
transitions specified in clause 6.3.4.
Figure 6.3.5.1-1 shows the states and state transitions for an associated
floor participant in the floor control server.
Figure 6.3.5.1-1: Floor control server state transition diagram for basic
floor control operation towards the floor participant
The floor control interface towards the MCPTT client in the IWF floor control
server shall create one instance of the \'basic floor control operations\'
state machine towards the MCPTT client for every floor participant served by
the IWF floor control server as follows:
1\. For pre-arranged group call in case of an originating MCPTT call, the
\'basic floor control operation towards the floor participant\' state machine
shall be created when the MCPTT server sends the SIP 200 (OK) response towards
the originating MCPTT client.
2\. For pre-arranged group call in case of a terminating MCPTT call, the
\'basic floor control operation towards the floor participant\' state machine
shall be created when the IWF floor control server receives the SIP 200 (OK)
response.
3\. For chat group call the \'basic floor control operation state machine
towards the floor participant\' shall be created when the MCPTT server sends
the SIP 200 (OK) response to the received initial SIP INVITE request.
The floor participant associated to the \'basic floor control operation
towards the floor participant\' state machine is here referred to as the
\"associated floor participant\".
The external inputs to the state machine are:
1\. directives coming from the floor control arbitration logic;
2\. floor messages sent by the floor participants;
3\. media; and
4\. in certain cases, SIP messages used for call handling.
If floor control messages or RTP media packets arrives in a state where there
is no procedure specified in the following clauses, the floor control
interface towards the MCPTT client in the IWF floor control server:
1\. shall discard the floor control message;
2\. shall request the network media interface in the MCPTT server to discard
any received RTP media packet; and
3\. shall remain in the current state.
State details are explained in the following clauses.
#### 6.3.5.2 State: \'Start-stop\'
##### 6.3.5.2.1 General
When a new instance of the \'basic floor control operations towards the floor
participant\' state machine is created, before any floor control related input
is applied, the state machine is in the \'Start-stop\' state. Similarly, when
the call is released the state machine shall return to the Start-Stop state.
An association between the IWF floor control server and a floor participant in
the MCPTT client is created, when the state machine is created; and
1\. in case of an originating MCPTT call, when the MCPTT server sends the SIP
200 (OK) response to the originating MCPTT client; and
2\. in case of a terminating MCPTT call, when the IWF floor control server
receives the SIP 200 (OK) response sent from the terminating MCPTT client.
##### 6.3.5.2.2 SIP Session initiated
When a SIP Session is established and if:
1\. the session is not a temporary group call session; or
2\. the session is a temporary group call session and the associated floor
participant is an invited MCPTT client (i.e. not a constituent MCPTT group);
then:
NOTE 1: A MCPTT group call is a temporary group session when the \ element is present in the \ element as specified in
3GPP TS 24.481 [12].
1\. if an MCPTT client initiates an MCPTT call with an implicit floor request,
and the MCPTT call does not exist yet, the floor control interface towards the
MCPTT client in the IWF floor control server:
a. shall initialize a general state machine as specified in clause 6.3.4.2.2;
and
NOTE 2: In the clause 6.3.4.2.2 the \'general floor control operation\' state
machine will continue with the initialization of the \'general floor control
operation\' state machine.
b. shall enter the state \'U: permitted\' as specified in the clause
6.3.5.5.2;
2\. if the associated MCPTT client rejoins an ongoing MCPTT call without an
implicit floor request or initiates or joins a chat group call without an
implicit floor request or attempts to initiate an already existing MCPTT call
without an implicit floor request, and
a. if an MCPTT call already exists but no MCPTT client has the permission to
send a media, the floor control interface towards the MCPTT client in the IWF
floor control server:
i. should send a Floor Idle message to the MCPTT client. The Floor Idle
message:
A. shall include a Message Sequence Number field with a Message Sequence
Number value increased with 1; and
B. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
ii. shall enter the state \'U: not permitted and Floor Idle\' as specified in
the clause 6.3.5.5.2;
b. if an MCPTT call is initiated, the floor control interface towards the
MCPTT client in the IWF floor control server:
i. shall enter the state \'U: not permitted and Floor Idle\' as specified in
the clause 6.3.5.5.2; and
ii. shall initialize a general state machine as specified in clause 6.3.4.2.2;
and
NOTE 3: In the clause 6.3.4.2.2 the general state machine will continue with
the initialization of the general state machine.
c. if another MCPTT client has the permission to send a media, the floor
control interface towards the MCPTT client in the IWF floor control server:
i. should send a Floor Taken message to the MCPTT client. The Floor Taken
message:
A. shall include the granted MCPTT user\'s MCPTT ID in the Granted Party\'s
Identity field if privacy is not requested;
B. shall include a Message Sequence Number field with a \ value increased with 1;
C. if the session is a broadcast group call, shall include the Permission to
Request the floor field set to \'0\';
D. if the session is not a broadcast group call, may include the Permission to
Request the floor field set to \'1\'; and
E. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications
ii. shall enter the \'U: not permitted and Floor Taken\' state as specified in
the clause 6.3.5.4.2;
3\. if the associated floor participant attempts to initiate an already
existing MCPTT call with an implicit floor request, and
a. if no MCPTT client has the permission to send media, the floor control
interface towards the MCPTT client in the IWF floor control server:
i. shall process the implicit floor request as if a Floor Request message was
receive as specified in clause 6.3.4.3.3; and
ii. shall enter the state \'U: permitted\' as specified in the clause
6.3.5.5.2;
b. if the MCPTT client negotiated support of queueing floor requests as
specified in clause 14 and if another MCPTT client has the permission to send
media, the floor control interface towards the MCPTT client in the IWF floor
control server:
i. shall set the priority level to the negotiated maximum priority level that
the MCPTT client is permitted to request, except for pre-emptive priority,
when high priority is used;
NOTE 4: The maximum floor priority the floor participant is permitted to
request is negotiated in the \"mc_priority\" fmtp attribute as specified in
clause 14.
NOTE 5: The initial implicit floor request will not result in pre-emption when
an MCPTT client is joining an ongoing MCPTT call. If the MCPTT client wants to
pre-empt the current MCPTT client that is sending media, an explicit floor
request with pre-emptive floor priority is required.
ii. shall insert the MCPTT client into the active floor request queue to the
position immediately following all queued floor requests with the same floor
priority;
iii. shall send a Floor Queue Position Info message to the MCPTT client. The
Floor Queue Position Info message:
A shall include the queue position and floor priority in the Queue Info field;
and
B. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
iv. should send a Floor Queue Position Info message with the updated status to
the MCPTT clients in the active floor request queue which negotiated queueing
of floor requests as specified in clause 14, which have requested the queue
status, whose queue position has been changed since the previous Floor Queue
Position Info message and which is not the joining MCPTT client. The Floor
Queue Position Info message:
A shall include the queue position and floor priority in the Queue Info field;
and
B. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
v. shall enter the \'U: not permitted and Floor Taken\' state as specified in
the clause 6.3.5.4.2; and
c. if the MCPTT client did not negotiate queueing of floor requests and if
another MCPTT client has the permission to send a media, the floor control
interface towards the MCPTT client in the IWF floor control server:
i. shall send a Floor Taken message to the MCPTT client. The Floor Taken
message:
A. shall include the granted MCPTT user\'s MCPTT ID in the Granted Party\'s
Identity field if privacy is not requested;
B. shall include a Message Sequence Number field with a Message Sequence
Number value increased with 1;
C. if the session is a broadcast group call, shall include the Permission to
Request the floor field set to \'0\';
D. if the session is not a broadcast group call, may include the Permission to
Request the floor field set to \'1\'; and
E. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
ii. shall enter the \'U: not permitted and Floor Taken\' state as specified in
the clause 6.3.5.4.2; and
4\. if the MCPTT client is invited to the MCPTT call and
a. if another MCPTT client has permission to send a media, the floor control
interface towards the MCPTT client in the IWF floor control server:
i. should send a Floor Taken message to the MCPTT client. The Floor Taken
message:
A. shall include the granted MCPTT user\'s MCPTT ID in the Granted Party\'s
Identity field if privacy is not requested;
B. shall include a Message Sequence Number field with a Message Sequence
Number value increased with 1;
C. if the session is a broadcast group call, shall include the Permission to
Request the floor field set to \'0\';
D. if the session is not a broadcast group call, may include the Permission to
Request the floor field set to \'1\'; and
E. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
ii. shall enter the \'U: not permitted and Floor Taken\' state as specified in
the clause 6.3.5.4.2; and
b. if no other MCPTT client has the permission to send a media; the floor
control interface towards the MCPTT client in the IWF floor control server:
i. should send a Floor Idle message to the MCPTT client. The Floor Idle
message:
A. shall include a Message Sequence Number field with a \ value increased with 1; and
B. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
ii. shall enter the \'U: not permitted and Floor Idle\' state as specified in
the clause 6.3.5.3.2.
When a SIP Session is established and if the session is a temporary group call
session and,
1\. if the associated floor participant is a constituent MCPTT group; or
2\. if the associated floor participant is the initiator of the temporary
group session;
then the floor control interface towards the MCPTT client:
1\. shall initialize a general state machine as specified in clause 6.3.4.2.2,
if not already initiated; and
2\. shall enter the \'U: not permitted and initiating\' state as specified in
clause 6.3.5.10.2.
#### 6.3.5.3 State: \'U: not permitted and Floor Idle\'
##### 6.3.5.3.1 General
The floor control interface towards the MCPTT client in the IWF floor control
server uses this state when the associated floor participant is not permitted
to send media.
##### 6.3.5.3.2 Enter state \'U: not permitted and Floor Idle\'
When entering this state, the floor control interface towards the MCPTT client
in the IWF floor control server:
1\. if a Track Info field is stored, shall remove the Track Info field from
the storage; and
2\. shall set the state for the associated floor participant to \'U: not
permitted and Floor Idle\'.
##### 6.3.5.3.3 Send Floor Taken message (S: Floor Taken)
When a Floor Taken message is received from the floor control server
arbitration logic, the floor control interface towards the MCPTT client in the
IWF floor control server:
1\. shall forward the Floor Taken message to the associated floor participant;
2\. may set the first bit in the subtype of the Floor Taken message to \'1\'
(Acknowledgment is required) as described in clause 8.3.2, and
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. shall enter the \'U: not permitted and Floor Taken\' state as specified in
the clause 6.3.5.4.2.
##### 6.3.5.3.4 Receive Floor Request message (R: Floor Request)
Upon receiving a Floor Request message from the associated floor participant,
the floor control interface towards the MCPTT client in the IWF floor control
server:
1\. if the session is not a broadcast group call or if the session is a
broadcast group call and the associated floor participant is the initiator of
the broadcast group call, shall forward the Floor Request message to the floor
control server arbitration logic;
NOTE 1: The Floor Request message can contain a Floor Indicator field
indicating that the floor request is an attempt to upgrade a group call to a
broadcast group call. If the floor control arbitration logic accepts the floor
request, the ongoing group call will be upgraded accordingly by the Floor
Granted message and, for other participants, by the Floor Taken message.
NOTE 2 Initiating a broadcast group call is done in the application and
signalling plane using SIP. Initiating or upgrading a call to an emergency
call or an imminent peril call is done in the application and signalling plane
using SIP.
2\. if the session is a broadcast group call and the associated floor
participant is not the initiator of the broadcast group call, shall send a
Floor Deny message to the associated floor participant. The Floor Deny
message:
a. shall include in the Reject Cause field the \ value cause #5
(Receive only);
b. may include in the Reject Cause field an additional text string explaining
the reason for rejecting the floor request in the \ value;
c. may set the first bit in the subtype of the Floor Deny message to \'1\'
(Acknowledgment is required) as described in clause 8.3.2; and
NOTE 3: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
d. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
3\. shall remain in the \'U: not permitted and Floor Idle\' state.
##### 6.3.5.3.5 Send Floor Grant message (S: Floor Grant)
When a Floor Granted message is received from the floor control arbitration
logic in the IWF, the floor control interface towards the MCPTT client in the
IWF floor control server:
1\. shall forward the Floor Granted messages to the associated floor
participant;
2\. may set the first bit in the subtype of the Floor Granted message to \'1\'
(Acknowledgment is required) as described in clause 8.3.2; and
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. shall enter the state \'U: permitted\' as specified in clause 6.3.5.5.2.
##### 6.3.5.3.6 Send Floor Deny message (S: Floor Deny)
When a Floor Deny message is received from the floor control arbitration logic
in the IWF, the floor control interface towards the MCPTT client in the IWF
floor control server:
1\. shall forward the Floor Deny messages to the associated floor participant;
2\. may set the first bit in the subtype of the Floor Deny message to \'1\'
(Acknowledgment is required) as described in clause 8.3.2; and
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. shall remain in the \'U: not permitted and Floor Idle\' state.
##### 6.3.5.3.7 Receive Floor Release message (R: Floor Release)
Upon receiving a Floor Release message from the associated floor participant,
the floor control interface towards the MCPTT client in the IWF floor control
server:
1\. if the first bit in the subtype of the Floor Release message is set to
\'1\' (Acknowledgment is required) as described in clause 8.3.2, shall send a
Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'4\' (Floor Release); and
b. shall include the Source field set to \'2\' (the controlling MCPTT function
is the source);
2\. shall send a Floor Idle message to the associated floor participant. The
Floor Idle message:
a. shall include a Message Sequence Number field with a \ value increased with 1;
b. may set the first bit in the subtype of the Floor Idle message to \'1\'
(Acknowledgment is required) as described in clause 8.3.2; and
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
c. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
3\. if a Track Info field is included in the Floor Release message, shall use
the topmost \ value and the SSRC in the received Floor
Release message to check if the floor participant has a queued floor request;
4\. if a no Track Info field is included in the Floor Release message, shall
use the SSRC in the received Floor Release message to check if the floor
participant has a queued floor request;
5 if the floor participant has a floor request in the queue, shall remove the
queued floor request from the queue; and
6\. shall remain in the state \'U: not permitted and Floor Idle\' state.
##### 6.3.5.3.8 Receive RTP media packets (R: media)
Upon receiving an indication from the network media interface that RTP media
packets are received with payload from the associated floor participant and if
Floor Release message was received in the previous \'U: permitted\' state, the
floor control interface towards the MCPTT client in the IWF floor control
server:
NOTE: Reception of unauthorized RTP media packets can only happen if the
associated floor participant is in an MCPTT client. If the associated floor
participant is a floor control server interface in a non-controlling MCPTT
function of an MCPTT group, the unauthorized RTP media packets are handled in
the non-controlling MCPTT function.
1\. shall request the network media interface in the MCPTT server to not
forward the received RTP media packets to the media distributor in the MCPTT
server;
2\. shall send a Floor Revoke message to the associated floor participant. The
Floor Revoke message:
a. shall include the Reject Cause field with the \ value set to
#3 (No permission to send a Media Burst); and
b. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
3\. shall enter the \'U: not permitted but sends media\' state as specified in
the clause 6.3.5.7.2.
##### 6.3.5.3.9 Receive an implicit floor request (R: Implicit floor request)
When an ongoing session is upgraded to an emergency group call and when the
application and signalling plane indicates that a subsequent SDP offer
included the \"mc_implicit_request\" fmtp attribute as described in clause 14,
the floor control interface towards the MCPTT client in the IWF floor control
server:
1\. shall indicate to the floor control server arbitration logic that an
implicit floor request is received due to an upgrade to an emergency group
call; and
2\. shall remain in the \'U: not permitted and Floor Idle\' state.
##### 6.3.5.3.10 Send Floor Idle message (S: Floor Idle)
When receiving a Floor Idle message from the floor control server arbitration
logic in the MCPTT server, the floor control interface towards the MCPTT
client in the IWF floor control server:
1\. shall forward the Floor Idle message to the associated floor participant;
2\. may set the first bit in the subtype of the Floor Idle message to \'1\'
(Acknowledgment is required) as described in clause 8.3.2; and
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. shall remain in the \'U: not permitted and Floor Idle\' state.
#### 6.3.5.4 State \'U: not permitted and Floor Taken\'
##### 6.3.5.4.1 General
The floor control interface towards the MCPTT client in the IWF floor control
server uses this state when another MCPTT client (i.e. not the associated
floor participant) has been given permission to send media.
In this state RTP media packets received from the media distributor in the
MCPTT server are forwarded to the associated floor participant by the network
media interface in the MCPTT server.
##### 6.3.5.4.2 Enter state \'U: not permitted and Floor Taken\'
When entering this state, the IWF floor control server:
1\. if a Track Info field is stored, shall remove the Track Info field from
the storage; and
2\. shall set the state to \'U: not permitted and Floor Taken\'.
##### 6.3.5.4.3 Send Floor Idle message (S: Floor Idle)
When receiving a Floor Idle message from the floor control server arbitration
logic in the MCPTT server, the floor control interface towards the MCPTT
client in the IWF floor control server:
1\. shall forward the Floor Idle message to the associated floor participant;
2\. may set the first bit in the subtype of the Floor Idle message to \'1\'
(Acknowledgment is required) as described in clause 8.3.2;
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. if an indication is stored that the participant is listening to media from
two sources, i.e. dual floor control is applied,
a. shall remain in the \'U: not permitted and Floor Taken\' state; and
b. shall remove the indication that a participant is listening to media from
two sources; and
4\. if an indication for dual floor control is not stored, shall enter the
\'U: not permitted and Floor Idle\' state as specified in the clause
6.3.5.3.2.
##### 6.3.5.4.4 Receive Floor Request message (R: Floor Request)
Upon receiving a Floor Request message from the associated floor participant,
if the group is configured for audio cut-in floor control, the floor control
interface towards the MCPTT client in the IWF floor control server:
1\. shall forward the Floor Request message to the floor control server
arbitration logic; and
2\. shall remain in the \'U: not permitted and Floor Taken\' state.
Upon receiving a Floor Request message, without a Floor Indicator field or
with the Floor Indicator field included where the D-bit (Emergency call) and
the E-bit (Imminent peril call) are set to \'0\', from the associated floor
participant, and if the MCPTT client did not negotiate queueing of floor
requests or did not include a priority in the \"mc_priority\" fmtp attribute
as specified in clause 14, the floor control interface towards the MCPTT
client in the IWF floor control server:
1\. shall send a Floor Deny message to the associated floor participant. The
Floor Deny message:
a. shall include in the Reject Cause field the \ value cause #1
(Another MCPTT client has permission);
b. may include in the Reject Cause field an additional text string explaining
the reason for rejecting the floor request in the \ value;
c. if the Floor Request included a Track Info field, shall include the
received Track Info field; and
d. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
2\. may set the first bit in the subtype of the Floor Deny message to \'1\'
(Acknowledgment is required) as described in clause 8.3.2; and
NOTE 1: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. shall remain in the \'U: not permitted and Floor Taken\' state.
Upon receiving a Floor Request message from the associated floor participant
and the session is a broadcast group call, the floor control interface towards
the MCPTT client in the IWF floor control server:
1\. shall send a Floor Deny message to the associated floor participant. The
Floor Deny message:
a. shall include in the Reject Cause field the \ value cause #5
(Receive only);
b. may include in the Reject Cause field an additional text string explaining
the reason for rejecting the floor request in the \ value; and
c. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
2\. may set the first bit in the subtype of the Floor Deny message to \'1\'
(Acknowledgment is required) as described in clause 8.3.2; and
NOTE 2: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. shall remain in the \'U: not permitted and Floor Taken\' state.
Upon receiving a Floor Request message from the associated floor participant
and if the MCPTT client negotiated support of queueing of floor requests or
included a floor priority in the \"mc_priority\" or both as described in
specified in clause 14 and according to local policy, the floor control
interface towards the MCPTT client in the IWF floor control server:
1\. shall determine the effective priority level as described in clause
4.1.1.4 by using the following parameters:
a. the floor priority shall be:
i. the lower of the floor priority included in Floor Request message and the
negotiated maximum floor priority that the MCPTT client is permitted to
request, if the MCPTT client negotiated floor priority \"mc_priority\" and
floor priority is included in the Floor Request message;
ii. the receive only floor priority, if the MCPTT client negotiated floor
priority in the \"mc_priority\" fmtp attribute and if the negotiated maximum
floor priority that the MCPTT client is permitted to request is \"receive
only\";
iii. the default priority, if the MCPTT client negotiated floor priority in
the \"mc_priority\" fmtp attribute, if the negotiated maximum floor priority
that the MCPTT client is permitted to request is not receive only and if the
floor priority is not included in the Floor Request message; and
iv. the default priority, if the MCPTT client did not negotiate floor priority
in the \"mc_priority\" fmtp attribute; and
b. the type of the call shall be
i. if the Floor Indicator field is included in the message and the D-bit
(Emergency call bit) is set to \'1\', determined to be an emergency call;
ii. if the Floor Indicator field is included in the message and the E-bit
(Imminent peril call) is set to \'1\', determined to be an imminent peril
call; and
iii. if the Floor Indicator field is not included in the message or the Floor
Indicator field is included and neither the D-bit (Emergency call bit) nor the
E-bit (Imminent peril call) is set to \'1\', determined to be a normal call;
2\. if the effective priority is \"receive only\", the floor control interface
towards the MCPTT client in the IWF floor control server:
a. shall send a Floor Deny message to the floor participant. The Floor Deny
message:
i. shall include in the Reject Cause field the \ value cause #5
(Receive only) ;
ii. may include in the Reject Cause field an additional text string explaining
the reason for rejecting the floor request in the \ value;
iii. if the Floor Request included a Track Info field, shall include the
received Track Info field; and
iv. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
b. shall remain in the \'U: not permitted and Floor Taken\' state;
3\. if
a. a Track Info field is included in the Floor Request message, shall use the
topmost \ value and the SSRC in the received Floor
Request message to check if the floor participant has a queued floor request;
or
b. a Track Info field is not included in the Floor Request message, shall use
the SSRC in the received Floor Request message to check if the floor
participant has a queued floor request;
4\. if the floor participant already has a queued floor request with the same
effective priority level, the floor control interface towards the MCPTT client
in the IWF floor control server:
a. shall send a Floor Queue Position Info message to the requesting MCPTT
client, if the MCPTT client negotiated support of queueing of floor requests
as specified in clause 14. The Floor Queue Position Info message:
i. shall include the queue position and floor priority in the Queue Info
field;
ii. if the Floor Request included a Track Info field, shall include the
received Track Info field; and
iii. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
b. shall remain in the \'U: not permitted and Floor Taken\' state
5\. if the effective priority level is pre-emptive and there are no other pre-
emptive requests in the active floor request queue and the effective priority
level of the current MCPTT client with permission to send a media is not the
pre-emptive priority, the floor control interface towards the MCPTT client in
the IWF floor control server:
a. shall forward the Floor Request message to the floor control server
arbitration logic indicating that a Floor Request message with pre-emptive
priority is received; and
b. shall remain in the \'U: not permitted and Floor Taken\' state
NOTE 3: The Floor control server arbitration logic initiates revoking the
permission to send media towards the current MCPTT client with the permission
to send media as specified in the clause 6.3.4.4.7;
6\. if the MCPTT client did not negotiate support of queueing of floor
requests as specified in clause 14, the effective priority level is pre-
emptive and either other pre-emptive request is queued or the effective
priority level of the current MCPTT client with permission to send a media is
the pre-emptive priority, the floor control interface towards the MCPTT client
in the IWF floor control server:
a. shall send a Floor Deny message to the associated floor participant. The
Floor Deny message:
i. shall include in the Reject Cause field the \ value cause #1
(Another MCPTT client has permission);
ii. may include in the Reject Cause field an additional text string explaining
the reason for rejecting the floor request in the \ value;
iii. if the Floor Request included a Track Info field, shall include the
received Track Info field; and
iv. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
b. shall remain in the \'U: not permitted and Floor Taken\' state;
7\. if the MCPTT client did not negotiate \"queueing\" and the effective
priority level is not pre-emptive, the floor control interface towards the
MCPTT client in the IWF floor control server:
a. shall send a Floor Deny message to the associated floor participant. The
Floor Deny message:
i. shall include in the Reject Cause field the \ value cause #1
(Another MCPTT client has permission);
ii. may include in the Reject Cause field an additional text string explaining
the reason for rejecting the floor request in the \ value;
iii. if the Floor Request included a Track Info field, shall include the
received Track Info field; and
iv. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
b. shall remain in the \'U: not permitted and Floor Taken\' state; and
8\. if the MCPTT client negotiated support of queueing of floor requests as
specified in clause 14 and the effective priority level is not pre-emptive,
the floor control interface towards the MCPTT client in the IWF floor control
server:
a. shall insert the MCPTT client into the active floor request queue, if not
inserted yet, or update the position of the MCPTT client in the active floor
request queue, if already inserted, to the position immediately following all
queued requests at the same effective priority level;
b. the IWF floor control server shall send a Floor Queue Position Info message
to the floor participant. The Floor Queue Position Info message:
i. shall include the queue position and floor priority in the Queue Info
field;
ii. if the Floor Request included a Track Info field, shall include the
received Track Info field; and
iii. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
c. shall remain in the \'U: not permitted and Floor Taken\' state; and
d. may set the first bit in the subtype of the Floor Queue Position message to
\'1\' (Acknowledgment is required) as described in clause 8.3.2.
NOTE 4: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
##### 6.3.5.4.5 Receive Floor Release message (R: Floor Release)
Upon receiving a Floor Release message from the associated floor participant
and if the MCPTT client did not negotiate support of queueing of floor
requests or included a floor priority in the \"mc_priority\" fmtp attribute as
specified in clause 14, the floor control interface towards the MCPTT client
in the IWF floor control server:
1\. if the first bit in the subtype of the Floor Release message is set to
\'1\' (Acknowledgment is required) as described in clause 8.3.2, shall send a
Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'4\' (Floor Release); and
b. shall include the Source field set to \'2\' (the controlling MCPTT function
is the source);
2\. shall send a Floor Taken message to the associated floor participant. The
Floor Taken message:
a. shall include the granted MCPTT user\'s MCPTT ID in the Granted Party\'s
Identity field if privacy is not requested;
b. shall include a Message Sequence Number field with a \ value increased with 1;
c. shall include the Permission to Request the floor field set to \'0\', if
the floor participants are not allowed to request the floor;
d. if the Floor Release message included a Track Info field, shall include the
received Track Info field;
e. may set the first bit in the subtype of the Floor Taken message to \'1\'
(Acknowledgment is required) as described in clause 8.3.2; and
NOTE 1: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
f. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
3\. shall remain in the \'U: not permitted and Floor Taken\' state.
Upon receiving a Floor Release message from the associated floor participant
and if the MCPTT client negotiated support of queueing of floor requests as
specified in clause 14, the floor control interface towards the MCPTT client
in the IWF floor control server:
1\. if the first bit in the subtype of the Floor Release message is set to
\'1\' (Acknowledgment is required) as described in clause 8.3.2, shall send a
Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'4\' (Floor Release); and
b. shall include the Source field set to \'2\' (the controlling MCPTT function
is the source);
2\. if
a. a Track Info field is included in the Floor Release message, shall use the
topmost \ value and the SSRC in the received Floor
Release message to check if the floor participant has a queued floor request;
or
b. if a Track Info field is not included in the Floor Release message, shall
use the SSRC in the received Floor Release message to check if the floor
participant has a queued floor request;
3\. shall remove the MCPTT client from the active floor request queue, if the
MCPTT client was in the active floor request queue;
4\. shall send a Floor Taken message to the associated floor participant. The
Floor Taken message:
a. shall include the granted MCPTT user\'s MCPTT ID in the Granted Party\'s
Identity field if privacy is not requested;
b. if the session is a broadcast group call, shall include the Permission to
Request the floor field set to \'0\';
c. if the session is not a broadcast group call, may include the Permission to
Request the floor field set to \'1\';
d. if a Track Info field is included in the Floor Release message, shall
include the received Track Info field;
e. shall include a Message Sequence Number field with a \ value increased with 1; and
f. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
5\. may set the first bit in the subtype of the Floor Taken message is set to
\'1\' (Acknowledgment is required) as described in clause 8.3.2; and
NOTE 2: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
6\. shall remain in the \'U: not permitted and Floor Taken\' state.
##### 6.3.5.4.6 Receive RTP media packets (R: media)
Upon receiving an indication from the network media interface in the MCPTT
server that RTP media packets with payload are received from the associated
floor participant, the floor control interface towards the MCPTT client in the
IWF floor control server:
NOTE: Reception of unauthorized RTP media packets can only happen if the
associated floor participant is in an MCPTT client. If the associated floor
participant is a floor control server interface in a non-controlling MCPTT
function of an MCPTT group, the unauthorized RTP media packets are handled in
the non-controlling MCPTT function.
1\. shall request the network media interface to not forward the RTP media
packets to the media distributor in the MCPTT server;
2\. shall send a Floor Revoke message to the associated floor participant. The
Floor Revoke message:
a. shall include the Reject Cause field with the Reject Cause value set to #3
(No permission to send a Media Burst); and
b. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
3\. shall enter the \'U: not permitted but sends media\' state as specified in
the clause 6.3.5.7.2.
##### 6.3.5.4.7 Send Floor Queue Position Info message (R: Floor Queue
Position Request)
Upon receiving a Floor Queue Position Request message from the associated
floor participant, the floor control interface towards the MCPTT client in the
IWF floor control server:
1\. shall send the Floor Queue Position Info message. The Floor Queue Position
Info message:
a. shall include the queue position and floor priority in the Queue Info
field;
b. if a Track Info field is included in the Floor Queue Position Info message,
shall include the received Track Info field;
c. may include the first bit in the subtype of the Floor Queue Position Info
message set to \'1\' (Acknowledgment is required) as described in clause
8.3.2; and
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
d. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
3\. shall remain in the \'U: not permitted and Floor Taken\' state.
##### 6.3.5.4.8 Receive an implicit floor request (R: Implicit floor request)
When an ongoing session is upgraded to an emergency group call and when the
application and signalling plane indicates that a subsequent SDP offer
included the \"mc_implicit_request\" fmtp attribute as specified in clause 14,
the floor control interface towards the MCPTT client in the IWF floor control
server:
1\. shall indicate to the floor control server arbitration logic that an
implicit floor request is received due to an upgrade to an emergency group
call; and
2\. shall remain in the \'U: not permitted and Floor Taken\' state.
##### 6.3.5.4.9 Send Floor Granted message (S: Floor Granted)
When a Floor Granted message is received from the floor control arbitration
logic in the IWF, the floor control interface towards the MCPTT client in the
IWF floor control server:
1\. shall forward the Floor Granted messages to the associated floor
participant;
2\. may set the first bit in the subtype of the Floor Granted message to \'1\'
(Acknowledgment is required) as described in clause 8.3.2;
NOTE 1: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. if the G-bit in the Floor Indicator is set to \'1\' (Dual floor) shall
store an indication that the participant is overriding without revoke; and
NOTE 2: The G-bit in the Floor Indicator is set to \'1\' as specified in
clause 6.3.6.3.2.
4\. shall enter the state \'U: permitted\' as specified in clause 6.3.5.5.2.
##### 6.3.5.4.10 Send Floor Taken message (S: Floor Taken)
When a Floor Taken message is received from the floor control arbitration
logic in the IWF, if the G-bit in the Floor Indicator is set to \'1\' (Dual
floor) the floor control interface towards the MCPTT client in the IWF floor
control server:
1\. shall forward the Floor Taken message to the associated floor participant;
2\. may set the first bit in the subtype of the Floor Taken message to \'1\'
(Acknowledgment is required) as described in clause 8.3.2;
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. shall store an indication that the participant is listening to media from
two sources; and
4\. shall remain in the \'U: not permitted and Floor Taken\' state.
##### 6.3.5.4.11 Send Floor Release Multi Talker message (S: Floor Release
Multi Talker)
Multi-talker is not supported in the present document.
#### 6.3.5.5 State: \'U: permitted\'
##### 6.3.5.5.1 General
The floor control interface towards the MCPTT client in the IWF floor control
server uses this state when the associated floor participant has been given
permission to send media.
##### 6.3.5.5.2 Enter state \'U: permitted\'
When entering this state, the floor control interface towards the MCPTT client
in the IWF floor control server:
1\. shall set the state for the associated floor participant to \'U:
permitted\'.
##### 6.3.5.5.3 Receive Floor Release message (R: Floor Release)
Upon receiving a Floor Release message from the associated floor participant,
the floor control interface towards the MCPTT client in the IWF floor control
server:
1\. if the first bit in the subtype of the Floor Release message is set to
\'1\' (Acknowledgment is required) as described in clause 8.3.2, shall send a
Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'4\' (Floor Release); and
b. shall include the Source field set to \'2\' (the controlling MCPTT function
is the source);
2\. if an indication that the participant is overriding without revoke is
stored,
a. shall forward the Floor Release message to the \'dual floor control
operation\' state machine of the floor control arbitration logic in the IWF
with the first bit in the subtype of the Floor Release message set to \'0\'
(Acknowledgment is not required), if not already set;
b. shall remove the indication that the participant is overriding without
revoke; and
c. shall enter the \'U: not permitted and Floor Taken\' state as specified in
the clause 6.3.5.4.2;
3\. if an indication that the participant is overridden without revoke is
stored,
a. shall forward the Floor Release message to the general floor control
operation state machine of the floor control arbitration logic in the IWF with
the first bit in the subtype of the Floor Release message set to \'0\'
(Acknowledgment is not required), if not already set;
b. shall remove the indication that the participant is overridden without
revoke; and
c. shall enter the \'U: not permitted and Floor Taken\' state as specified in
the clause 6.3.5.4.2; and
4\. if no indication is stored:
a. shall forward the Floor Release message to the general floor control
operation state machine of the floor control arbitration logic in the IWF with
the first bit in the subtype of the Floor Release message set to \'0\'
(Acknowledgment is not required), if not already set; and
b. shall remain in the \'U: permitted\' state.
##### 6.3.5.5.4 Send Floor Idle message (S: Floor Idle)
Upon receiving the Floor Idle message from the floor control server
arbitration logic in the MCPTT server, the floor control interface towards the
MCPTT client in the IWF floor control server:
1\. if the G-bit in the Floor Indicator is set to \'1\' (Dual Floor) and an
indication that the participant is overridden without revoke is stored
a. shall send Floor Idle message to the associated floor participant;
b. shall remove the indication that a participant is overridden without
revoke; and
c. shall remain in \'U: permitted state\';
2\. if no indication is stored shall enter the \'U: not permitted and Floor
Idle\' state as specified in the clause 6.3.5.3.2; and
3\. if an indication that the participant is overriding without revoke is
stored
a. shall send Floor Idle message to the associated floor participant;
b. shall remove the indication that a participant is overriding without
revoke; and
c. shall remain in \'U: permitted state\'.
##### 6.3.5.5.5 Send Floor Revoke message (S: Floor Revoke)
When receiving the Floor Revoke message from the floor control server
arbitration logic in the MCPTT server, the floor control interface towards the
MCPTT client in the IWF floor control server:
1\. shall forward the Floor Revoke message to the floor participant;
2\. if the Floor Revoke message includes the Track Info field, shall store the
Track Info field; and
3\. shall enter the state \'U pending Floor Revoke\' as specified in the
clause 6.3.5.6.2.
##### 6.3.5.5.6 Receive RTP media packets (R: media)
Upon receiving an indication from the network media interface in the MCPTT
server that RTP media packets with payload are received from the associated
floor participant, the floor control interface towards the MCPTT client in the
IWF floor control server:
1\. if an indication that the participant is overriding without revoke is not
stored,
a. shall request the network media interface in the MCPTT server to forward
RTP media packets to the media distributor in the MCPTT server.
##### 6.3.5.5.7 Receive Floor Request message (R: Floor Request)
Upon receiving a Floor Request message from the associated floor participant,
the floor control interface towards the MCPTT client in the IWF floor control
server:
1\. shall forward the Floor Request message to the floor control server
arbitration logic in the MCPTT server; and
b. shall instruct the media distributor to act as in clause 6.3.4.4.5.
2\. if an indication that the participant is overriding without revoke is
stored,
a. shall request the network media interface in the MCPTT server to forward
RTP media packets to the media distributor in the MCPTT server; and
b. shall instruct the media distributor to act as in clause 6.3.6.3.5; and
3\. shall remain in the \'U: permitted\' state.
##### 6.3.5.5.8 Send RTP Media (S: media)
When RTP packets are received from the media distributor, the floor control
interface towards the MCPTT client in the IWF floor control server:
1\. shall forward the RTP packet to the associated floor participant if the
indication that the participant is overridden without revoke is stored;
2\. shall forward the RTP packet to the associated floor participant if the
indication that the participant is overriding without revoke is stored; and
3\. shall remain in the \'U: permitted\' state.
##### 6.3.5.5.9 Send Floor Taken message (S: Floor Taken)
When receiving the Floor Taken message from the floor control server
arbitration logic in the MCPTT server with the G-bit in the Floor Indicator
set to \'1\' (Dual Floor), the floor control interface towards the MCPTT
client in the IWF floor control server:
1\. shall send the Floor Taken message to the associated floor participant;
2\. shall store an indication that the participant is overridden without
revoke; and
3\. shall remain in the \'U: permitted\' state.
When receiving the Floor Taken message from the floor control server
arbitration logic in the MCPTT server with the G-bit in the Floor Indicator
set to \'0\' (Not dual floor), the floor control interface towards the MCPTT
client in the IWF floor control server:
1\. shall send the Floor Taken message to the associated floor participant;
and
2\. shall enter the \'U: not permitted and Floor Taken\' state as specified in
the clause 6.3.5.4.2.
##### 6.3.5.5.10 Send Floor Release Multi Talker message (S: Floor Release
Multi Talker)
Multi-talker is not supported in the present document.
#### 6.3.5.6 State: \'U: pending Floor Revoke\'
##### 6.3.5.6.1 General
The floor control interface towards the MCPTT client in the floor control
server uses this state during the grace period after sending the Floor Revoke
message.
In this state timer T8 (Floor Revoke) is running.
##### 6.3.5.6.2 Enter state \'U pending Floor Revoke\'
When entering this state, the floor control interface towards the MCPTT client
in the IWF floor control server:
1\. shall start timer T8 (Floor Revoke); and
2\. shall enter the state \'U: pending Floor Revoke\'.
##### 6.3.5.6.3 Timer T8 (media Revoke) expired
On expiry of timer T8 (Floor Revoke) the floor control interface towards the
MCPTT client in the IWF floor control server:
1\. shall retransmit the Floor Revoke message to the associated floor
participant. The Floor Revoke message:
a. shall include the same Rejection Cause field and the same Floor Indicator
field as in the previous sent Floor Revoke message;
2\. shall start timer T8 (Floor Revoke); and
3\. shall remain in the \'U: pending Floor Revoke\' state.
NOTE: The number of times the IWF floor control server retransmits the Floor
Revoke message and the action to take when the IWF floor control server gives
up is an implementation option. However, it is recommended that the MCPTT
client is disconnected from the MCPTT call when the IWF floor control server
gives up.
##### 6.3.5.6.4 Receive RTP media packets (R: media)
Upon receiving an RTP media packet with payload from the associated floor
participant, the floor control interface towards the MCPTT client in the IWF
floor control server:
1\. shall forward RTP media packets to the media distributor; and
2\. shall remain in the \'U: pending Floor Revoke\' state.
##### 6.3.5.6.5 Receive Floor Release message (R: Floor Release)
Upon receiving a Floor Release message from the associated floor participant,
the floor control interface towards the MCPTT client in the IWF floor control
server:
1\. if the first bit in the subtype of the Floor Release message is set to
\'1\' (Acknowledgment is required) as described in clause 8.3.2, shall send a
Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'4\' (Floor Release); and
b. shall include the Source field set to \'2\' (the controlling MCPTT function
is the source);
2\. if the G-bit in the Floor Indicator is set to \'1\' (Dual floor):
a. if the state in the \'general floor control operation\' state machine is
\'G: Taken\':
i. shall send a Floor Taken message to the associated floor participant. The
Floor Taken message:
A. shall include the granted MCPTT user\'s MCPTT ID in the Granted Party\'s
Identity field of the permitted MCPTT client if privacy is not requested; and
B. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
ii. shall enter the \'U: not permitted and Floor Taken\' state as specified in
the clause 6.3.5.4.2; and
b. if the state in the \'general floor control operation\' state machine is
\'G: Idle\':
i. shall send a Floor Idle message to the associated floor participant;
ii. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
iii. shall enter the \'U: not permitted and Floor Idle\' state as specified in
the clause 6.3.5.3.2; and
3\. if the G-bit in the Floor Indicator is set to \'0\':
a. shall forward the Floor Release message to the floor control server
arbitration logic; and
b. shall remain in the state \'U: pending Floor Revoke\'.
##### 6.3.5.6.6 Send Floor Idle message (S: Floor Idle)
Upon receiving a Floor Idle message from the floor control server arbitration
logic in the MCPTT server, the floor control interface towards the MCPTT
client in the IWF floor control server:
NOTE 1: The Floor Idle message is sent when timer T3 (Stop talking grace)
expires and when timer T1 (End of RTP media) expires and when there are no
queued floor requests.
1\. shall send the Floor Idle message to the associated floor participant;
2\. may set the first bit in the subtype of the Floor Idle message to \'1\'
(Acknowledgment is required) as described in clause 8.3.2; and
NOTE 2: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. shall enter the \'U: not permitted and Floor Idle\' state as specified in
the clause 6.3.5.3.2.
##### 6.3.5.6.7 Send Floor Taken message (S: Floor Taken)
Upon receiving a Floor Taken message from the floor control server arbitration
logic in the MCPTT server, the floor control interface towards the MCPTT
client in the IWF floor control server:
NOTE 1: The Floor Taken message is sent when timer T3 (Stop talking grace)
expires or when timer T1 (End of RTP media) expires and if there are queued
floor requests.
1\. shall send the Floor Taken message to the associated floor participant;
2\. may set the first bit in the subtype of the Floor Taken message to \'1\'
(Acknowledgment is required) as described in clause 8.3.2; and
NOTE 2: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. shall enter the \'U: not permitted and Floor Taken\' state as specified in
the clause 6.3.5.3.2.
##### 6.3.5.6.8 Send Floor Release Multi Talker message (S: Floor Release
Multi Talker)
Multi-talker is not supported in the present document.
#### 6.3.5.7 State \'U: not permitted but sends media\'
##### 6.3.5.7.1 General
The floor control interface towards the MCPTT client in the floor control
server uses this state when it receives RTP media packets from the MCPTT
client and the MCPTT client is not permitted to send media.
Timer T8 (Floor Revoke) is running in this state.
##### 6.3.5.7.2 Enter state \'U: not permitted but sends media\'
When entering this state, the floor control interface towards the MCPTT client
in the IWF floor control server:
1\. shall start timer T8 (Floor Revoke); and
2\. shall enter the state \'U: not permitted but sends media\'.
In this state the floor control interface towards the MCPTT client in the IWF
floor control server:
1\. shall not request the network media interface in the MCPTT server to
forward RTP media packets from the MCPTT client to the media distributor in
the MCPTT server.
##### 6.3.5.7.3 Timer T8 (Floor Revoke) expired
On expiry of timer T8 (Floor Revoke), the floor control interface towards the
MCPTT client in the IWF floor control server:
1\. shall send a Floor Revoke message to the associated floor participant. The
Floor Revoke message:
a. shall include in the Rejection Cause field the \ value set
to #3 (No permission to send a Media Burst); and
b. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
2\. shall restart timer T8 (Floor Revoke); and
3\. shall remain in the \'U: not permitted but sends media\' state.
NOTE: The number of times the IWF floor control server retransmits the Floor
Revoke message and the action to take when the IWF floor control server gives
up is an implementation option. However, the recommended action is that the
MCPTT client is disconnected from the MCPTT call.
##### 6.3.5.7.4 Receive Floor Release message (R: Floor Release)
Upon receiving a Floor Release message, the floor control interface towards
the MCPTT client in the IWF floor control server:
1\. if the first bit in the subtype of the Floor Release message is set to
\'1\' (Acknowledgment is required) as described in clause 8.3.2, shall send a
Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'4\' (Floor Release); and
b. shall include the Source field set to \'2\' (the controlling MCPTT function
is the source);
2\. if the general state is \'G: Floor Idle\', the floor control interface
towards the MCPTT client in the IWF floor control server:
a. shall send the Floor Idle message. The Floor Idle message:
i. shall include a Message Sequence Number field with a Message Sequence
Number value increased with 1; and
ii. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
b. shall enter the \'U: not permitted and Floor Idle\' state as specified in
the clause 6.3.5.3.2; and
3\. if the general state is \'G: Floor Taken\', the floor control interface
towards the MCPTT client in the IWF floor control server:
a. shall send a Floor Taken message. The Floor Taken message:
i. shall include the granted MCPTT user\'s MCPTT ID in the Granted Party\'s
Identity field if privacy is not requested;
ii. if the session is a broadcast group call, shall include the Permission to
Request the floor field set to \'0\';
iii. if the session is not a broadcast group call, may include the Permission
to Request the floor field set to \'1\';
iv. may include the first bit in the subtype of the Floor Taken message set to
\'1\' (Acknowledgment is required) as described in clause 8.3.2; and
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
v. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
c. shall enter the \'U: not permitted and Floor Taken\' state as specified in
the clause 6.3.5.4.2.
##### 6.3.5.7.5 Send Floor Taken message (S: Floor Taken)
Receiving the Floor Taken message from the floor control server arbitration
logic in the MCPTT server with the I-bit in the Floor Indicator set to \'1\'
(multi-talker) is not supported in the present document.
##### 6.3.5.7.6 Send Floor Release Multi Talker message (S: Floor Release
Multi Talker)
Multi-talker is not supported in the present document.
#### 6.3.5.8 In any state
##### 6.3.5.8.1 General
This clause describes the actions to be taken in all states defined for the
basic state diagram with the exception of the \'Start-stop\' and \'Releasing\'
states.
##### 6.3.5.8.2 Receive MCPTT call release -- 1
Upon receiving an MCPTT call release step 1 request from the application and
signalling plane e.g. when the MCPTT call is going to be released or when the
MCPTT client leaves the MCPTT call, the floor control interface towards the
MCPTT client in the IWF floor control server:
1\. shall stop sending floor control messages to the associated floor
participant;
2\. shall request the network media interface to stop sending RTP media
packets towards to the associated MCPTT client;
3\. shall ignore any floor control messages received from the associated floor
participant;
4\. shall request the network media interface to stop forwarding RTP media
packets from the associated MCPTT client to the media distributor in the MCPTT
server;
5\. shall indicate to the floor control server arbitration logic in the MCPTT
server that the MCPTT client has started to disconnect from the MCPTT call;
and
6\. shall enter the \'Releasing\' state.
##### 6.3.5.8.3 Receiving a merging instruction (R: Merge)
Upon receipt of an instruction to merge with another group due to the group
regrouping function, the floor control interface towards the MCPTT client:
1\. shall create an instance of the \'floor participant interface state
transition\' as specified in clause 6.5.5;
2\. shall move information associated with the instance used for \'floor
participant interface state transition\' to the \'basic floor control
operation towards the floor participant\' state machine;
NOTE: Which information that needs to be moved is an implementation option.
3\. shall enter the \'Start-stop\' state and terminate the \'basic floor
control operation towards the floor participant\'\' state machine associated
with this floor participant and this MCPTT call;
4\. if the state was \'U: not permitted and Floor Idle\', \'U: not permitted
Floor Taken\', \'U: pending Floor Revoke\', \'U: not permitted and
initiating\' or \'U: not permitted but sends media\':
a. shall enter the \'P: has no permission\' state as specified in clause
6.5.5; and
b. shall perform actions specified in clause 6.5.5.3; and
5\. if the state was \'U: permitted\':
a. shall enter the \'P: has permission\' state; and
b. shall perform actions specified in clause 6.5.5.4.
#### 6.3.5.9 State: \'Releasing\'
##### 6.3.5.9.1 General
The floor control interface towards the MCPTT client in the IWF floor control
server uses this state while waiting for the application and signalling plane
to finalize the release of the MCPTT call or finalizing the removal of the
MCPTT client from the MCPTT call.
##### 6.3.5.9.2 Receive MCPTT call release - 2
Upon receiving an MCPTT call release step 2 request from the application and
signalling plane, the floor control interface towards the MCPTT client in the
IWF floor control server:
1\. shall request the network media interface to release all resources
associated with this MCPTT client for this MCPTT call; and
2\. shall enter the \'Start-stop\' state and terminate the \'basic floor
control operation towards the floor participant\'\' state machine associated
with this floor participant and this MCPTT call.
#### 6.3.5.10 State: \'U: not permitted and initiating\'
##### 6.3.5.10.1 General
The floor control interface towards the MCPTT client uses this state when
waiting for the floor control arbitration logic to finalize the initialisation
of the state machine to be used for a temporary group session.
During this state Floor Request messages can be received from the non-
controlling MCPTT function. Any Floor Request message received will be added
to the queue according to the priority of the floor request determine as
described in clause 4.1.1.4.
##### 6.3.5.10.2 Enter the \'U: not permitted and initiating\' state
The floor control interface towards the MCPTT client:
1\. shall set the state for the associated floor participant to \'U: not
permitted and Initiating\'.
##### 6.3.5.10.3 Send Floor Taken message (S: Floor Taken)
When a Floor Taken message is received from the floor control arbitration
logic in the IWF, the floor control interface towards the MCPTT client:
1\. shall forward the Floor Taken messages to the associated floor
participant;
2\. may set the first bit in the subtype of the Floor Taken message to \'1\'
(Acknowledgment is required) as described in clause 8.3.2; and
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. shall enter the state \'U: not permitted and Floor Taken\' as specified in
clause 6.3.5.4.2.
##### 6.3.5.10.4 Send Floor Idle message (S: Floor Idle)
When receiving a Floor Idle message from the floor control server arbitration
logic in the MCPTT server, the floor control interface towards the MCPTT
client:
1\. shall forward the Floor Idle message to the associated floor participant;
2\. may set the first bit in the subtype of the Floor Idle message to \'1\'
(Acknowledgment is required) as described in clause 8.3.2; and
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. shall enter the \'U: not permitted and Floor Idle\' state as specified in
the clause 6.3.5.3.2.
##### 6.3.5.10.5 Receive Floor Request message (R: Floor Request)
Upon receipt of a Floor Request message, the floor control interface towards
the MCPTT client:
1\. shall determine the effective priority level as described in clause
4.1.1.4;
2\. shall put the Floor Request message in the floor request queue according
to the determined effective priority level;
3\. if the \ value in the Track Info field is set to
\'1\' (the floor participant in the MCPTT client supports queueing), shall
send a Floor Queue Position Info message to the requesting non-Controlling
MCPTT function, The Floor Queue Position Info message:
a. shall include the queue position and floor priority in the Queue Info
field;
b. shall include the received Track Info field; and
c. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
4 if the \ value in the Track Info field is set to \'0\'
(the floor participant in the MCPTT client does not support queueing), shall
send the Floor Deny message. The floor Deny message:
NOTE: A Floor Request from a MCPTT client in a constituent group can be
received without the queuing capability if a floor participant in an ongoing
constituent MCPTT group request floor while the floor was idle during the
merging process.
a. shall include in the Reject Cause field the \ value cause
\'1\' (Another MCPTT client has permission);
b. shall include the received Track Info field; and
c. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
5\. shall remain in the \'U: not permitted and initiating\' state.
##### 6.3.5.10.6 Send Floor Granted message (S: Floor Granted)
When a Floor Granted message is received from the floor control arbitration
logic, the floor control interface towards the MCPTT client:
1\. shall forward the Floor Granted messages to the associated floor
participant;
2\. may set the first bit in the subtype of the Floor Granted message to \'1\'
(Acknowledgment is required) as described in clause 8.3.2; and
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. shall enter the state \'U: permitted\' as specified in clause 6.3.5.5.2.
##### 6.3.5.10.7 Receive a Floor Release message (S: Floor Release)
Upon receiving a Floor Release message from the associated floor participant,
the floor control interface towards the MCPTT client:
1\. if the first bit in the subtype of the Floor Release message is set to
\'1\' (Acknowledgment is required) as described in clause 8.3.2, shall send a
Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'4\' (Floor Release); and
b. shall include the Source field set to \'2\' (the controlling MCPTT function
is the source);
2\. shall use the topmost \ value and the SSRC in the
Track Info field of the received Floor Release message to check if the floor
participant has a queued floor request and if not, check if there is a floor
request in one of the cached application/vnd.3gpp.mcptt-floor-request+xml MIME
bodies;
3\. shall remove the MCPTT client from the active floor request queue or the
cached application/vnd.3gpp.mcptt-floor-request+xml MIME body, if the MCPTT
client was in the active floor request queue or in the
application/vnd.3gpp.mcptt-floor-request+xml MIME body; and
4\. shall remain in the \'U: not permitted and initiating\' state.
##### 6.3.5.10.8 Send Floor Release Multi Talker message (S: Floor Release
Multi Talker)
Multi-talker is not supported in the present document.
### 6.3.6 Dual floor control
#### 6.3.6.1 General
Editor\'s Note: The procedures of the IWF performing the non-controlling role
are FFS.
Dual floor control is used when a floor participant requests floor with a pre-
emptive floor priority allowing the floor control in clause 6.3.4 to continue
without revoking the floor from the floor participant permitted to send media
as specified in 3GPP TS 23.379 [5] clause 10.9.1.3.2.2.
The floor control server arbitration logic in the IWF floor control server
shall behave according to the state diagram and state transitions specified in
this clause.
Figure 6.3.6.1-1 shows the \'dual floor control operation\' states (D states)
and the state transition diagram.
Figure 6.3.6.1-1: Floor control server state transition diagram for \'dual
floor control operation\'
The floor control arbitration logic in the IWF floor control server shall keep
one instance of the \'dual floor control operation\' state machine for a floor
participant with pre-emptive floor priority where this MCPTT user or user
homed in the IWF is allowed to talk without revoking a current speaker with
lower floor priority.
NOTE: Only one media endpoint with this type of pre-emptive floor priority can
exist within an MCPTT call.
The floor participant associated to the \'dual floor control operation\' state
machine is in the following clauses referred to as the overriding media
endpoint.
If floor control messages or RTP media packets arrive in a state where there
is no procedure specified in the following clauses the floor control
arbitration logic in the IWF floor control server:
1\. shall discard the floor control message;
2\. shall request the media distributor in the IWF to discard any received RTP
media packet; and
3\. shall remain in the current state.
State details are explained in the following clauses.
#### 6.3.6.2 State: \'Start-stop\'
##### 6.3.6.2.1 General
When a new instance of the \'dual floor control operation\' state machine is
initiated, before any floor control related input is applied, the state
machine is in \'Start-stop\' state. Similarly, when the media burst is
released the state machine shall return to the \'Start-Stop\' state or the
related MCPTT call is released.
##### 6.3.6.2.2 Receive Floor Request message with overriding pre-emptive
floor priority (R: Floor Request)
When an MCPTT floor participant that requests the floor with an overriding
pre-emptive priority is granted the floor the floor control arbitration logic
in the IWF floor control server:
1\. shall create one instance of the \'dual floor control operation\' state
machine;
2\. shall store the SSRC of the floor participant;
3\. if a Track Info field is included in the Floor Request message, shall
store the received Track Info field associated with the floor control server
state transition diagram for \'dual floor control operation\', and
4 shall enter the state \'D: Floor Taken\' as specified in the clause
6.3.6.3.2.
##### 6.3.6.2.2A Floor Grant to IWF floor participant with overriding pre-
emptive floor priority (I: Floor Grant to IWF floor participant)
When the IWF determines that an IWF floor participant with an overriding pre-
emptive priority is to be granted the floor the floor control arbitration
logic in the IWF floor control server:
1\. shall create one instance of the \'dual floor control operation\' state
machine;
2\. shall determine an SSRC for the IWF floor participant and shall store the
SSRC of the IWF floor participant; and
3 shall enter the state \'D: Floor Taken\' as specified in the clause
6.3.6.3.2.
#### 6.3.6.3 State: \'D: Floor Taken\'
##### 6.3.6.3.1 General
The floor control arbitration logic in the IWF floor control server uses this
state when it has permitted one floor participant to override a current
speaker in an MCPTT call to send media.
Timer T11 (End of RTP dual) can be running when the IWF floor control server
is in this state.
Timer T12 (Stop talking dual) can be running when the IWF floor control server
is in this state.
##### 6.3.6.3.2 Enter state \'D: Floor Taken\'
When entering this state, the floor control arbitration logic in the IWF floor
control server:
1\. if the requesting floor participant is an MCPTT floor participant, shall
send a Floor Granted message to the requesting MCPTT floor participant. The
Floor Granted message:
a. shall include the value of the T12 (Stop talking dual) timer in the
Duration field;
b. shall include the granted priority in the Floor priority field;
c. if a Track Info field associated with the floor control server state
transition diagram for \'dual floor control operation\' state machine is
stored, shall include the stored Track Info field;
d. shall include the Floor Indicator field with the G-bit set to \'1\' (Dual
floor);
e. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
f. if non-controlling MCPTT functions are involved, shall include the SSRC of
the granted floor participant;
2\. shall send a Floor Idle message to any non-controlling MCPTT functions
involved in the session and to those MCPTT floor participants controlled by
the IWF performing the controlling role that will only listen to RTP media
from the overriding media endpoint according to local policy. The Floor Idle
message:
NOTE 1: The non-controlling MCPTT function will send the Floor Idle message to
those MCPTT floor participants controlled by the non-controlling MCPTT
function that will only listen to RTP media from the overriding media endpoint
according to local policy when the non-controlling MCPTT function receives the
Floor Taken with the G-bit set to \'1\' (Dual floor) in the Floor Indicator
field.
i. shall include a Message Sequence Number field with a Message Sequence
Number value increased with 1; and
ii. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
3\. shall send a Floor Taken message to any non-controlling MCPTT functions
involved and to MCPTT floor participants controlled by the IWF performing the
controlling role that will listen to the RTP media from the overriding media
endpoint according to local policy. The Floor Taken message:
NOTE 2: The media endpoint overridden by the overriding media endpoint is
still sending voice (overridden). The list of floor participants that receive
the overriding, overridden, or both transmissions is based on configuration.
a. shall include the granted floor participant's MCPTT ID in the Granted
Party\'s Identity field, if privacy is not requested;
b. shall include a Message Sequence Number field with a \ value increased with 1;
c. shall include the Floor Indicator field with the G-bit set to \'1\' (Dual
floor); and
d. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
4\. shall start the T11 (End of RTP dual) timer; and
5\. shall enter the state \'D: Floor Taken\'.
##### 6.3.6.3.3 Timer T11 (End of RTP dual) expired
On expiry of timer T11 (End of RTP dual), the floor control arbitration logic
in the IWF floor control server:
1\. shall stop the T12 (Stop talking dual) timer; if running;
2\. shall request the media distributor in the IWF to stop distributing RTP
media packets received from the overriding media endpoint to other media
endpoints;
NOTE: If dual floor control is ongoing as described in clause 6.3.6, the list
of floor participants that receive the overriding, overridden, or both
transmissions is based on configuration.
3\. shall release all resources reserved in the media plane including the
instances used for the \'dual floor control operation\' state machine and any
running timers associated with the state machine;
4\. shall send a Floor Idle message to any non-controlling MCPTT functions and
to those MCPTT floor participants controlled by the IWF performing the
controlling role receiving RTP media from the overriding media endpoint. The
Floor Idle message:
a. shall include a Floor Indicator field with the G-bit set to \'1\' (Dual
floor);
b. shall include a Message Sequence Number field with a \ value increased with 1; and
c. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
5\. if the state in the \'general floor control operation\' state machine is
\'G: Taken\';
a shall send a Floor Taken message to any non-controlling MCPTT functions and
to those MCPTT floor participants controlled by the IWF performing the
controlling role that only received RTP media from the overriding media
endpoint. The Floor Taken message:
i. shall include the granted floor participant\'s MCPTT ID in the Granted
Party\'s Identity field, if privacy is not requested;
ii. shall include a Message Sequence Number field with a \ value increased with 1; and
iii. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
6\. if the state in the \'general floor control operation\' state machine is
\'G: Idle\', shall send a Floor Idle message to all MCPTT floor participants.
The Floor Idle message:
a. shall include a Message Sequence Number field with a \ value increased with 1; and
b. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
7\. shall enter the \'Start-stop\' state.
##### 6.3.6.3.4 Timer T12 (Stop talking dual) expired
On expiry of the T12 (Stop talking dual) timer the floor control arbitration
logic in the IWF floor control server:
1\. shall stop the T11 (End of RTP dual) timer;
2\. shall request the media distributor in the IWF to stop distributing RTP
media packets to other media endpoints;
3\. if the floor participant is an MCPTT floor participant, shall send the
Floor Revoke message to the permitted MCPTT floor participant. The Floor
Revoke message:
a. shall include the Reject Cause field with the \ value set to
#2 (Media burst too long) in the Floor Revoke message sent in clause
6.3.4.5.2;
b. shall include the Floor Indicator with the G-bit set to \'1\' (Dual floor);
c. if a Track Info field associated with the dual floor is stored, shall
include the stored Track Info field; and
d. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
4\. shall remove the stored Track info field associated with the dual floor;
5\. if the state in the \'general floor control operation\' state machine is
\'G: Taken\';
a. shall send a Floor Taken message to all non-controlling MCPTT functions (if
the session is a temporary group session involving non-controlling MCPTT
functions) and to those MCPTT floor participants that only received RTP media
from the overriding media endpoint. The Floor Taken message:
i. shall include the granted floor participant's MCPTT ID in the Granted
Party\'s Identity field, if privacy is not requested; and
ii shall include a Message Sequence Number field with a \ value increased with 1;
6\. if the state in the \'general floor control operation\' state machine is
\'G: Idle\', shall send a Floor Idle message to all MCPTT floor participants.
The Floor Idle message:
a. shall include a Message Sequence Number field with a \ value increased with 1; and
b. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
7\. shall release all resources reserved in the media plane including the
instances used for the Floor control server state transition diagram for
\'dual floor control operation\'; and
8\. shall enter the \'Start-stop\' state.
##### 6.3.6.3.5 Receive RTP media packets (R: media)
Upon receiving an indication from the media distributor in the IWF that RTP
media packets are received from the permitted media endpoint, the floor
control arbitration logic in the IWF floor control server:
1\. if the media endpoint is an MCPTT media endpoint, shall start the T12
(Stop talking dual) timer, if not already running;
2\. shall restart the T11 (End of RTP dual) timer;
3\. shall instruct the media distributor to forward the received RTP media
packets to any non-controlling MCPTT functions, to the overridden media
endpoint and to those media endpoints receiving RTP media from the overriding
media endpoint controlled by the IWF performing the controlling role according
to local policy; and
NOTE 1: The RTP media is sent to the media endpoints subjected to the maximum
number of simultaneous transmissions received in one group call for override
(N7) as indicated in 3GPP TS 23.379 [5].
NOTE 2: The IWF performing the non-controlling role will forward the RTP media
packets to media endpoints receiving RTP media from the overriding media
endpoint according to local policy in the IWF performing the non-controlling
role.
4\. shall remain in the \'D: Floor Taken\' state.
##### 6.3.6.3.6 Receive Floor Release message (R: Floor Release)
Upon receiving a Floor Release message from the overriding MCPTT media
endpoint or upon determining that the floor has been released by an overriding
IWF media endpoint, the floor control arbitration logic in the IWF floor
control server:
1\. shall request the media distributor in the IWF to stop distributing RTP
media packets received from the overriding media endpoint to other media
endpoints;
2\. shall stop the T12 (Stop talking dual) timer, if running;
3\. shall stop the T11 (End of RTP dual) timer;
4\. shall release all resources reserved in the media plane including the
instances used for the Floor control server state transition diagram for
\'dual floor control operation\' and any running timers associated with the
state machine;
5\. if a Floor Release message has been received from an MCPTT media endpoint
and if the first bit in the subtype of the Floor Release message is set to
\'1\' (acknowledgement is required) as specified in clause 8.2.2:
a. shall send a Floor Ack message. The Floor Ack message:
i. shall set the Source field to the value \'2\' (the IWF performing the
controlling role is the source); and
ii. shall set the Message Type field to the value \'4\' (Floor Release);
6\. shall send a Floor Idle message to any non-controlling MCPTT functions, to
the overridden participant if it is an MCPTT floor participant and to those
MCPTT floor participants controlled by the IWF performing the controlling role
receiving RTP media from the overriding media endpoint. The Floor Idle
message:
a. shall include an Floor Indicator field with the G-bit set to \'1\' (Dual
floor);
b shall include a Message Sequence Number field with a \ value increased with 1; and
c. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
7\. if the state in the \'general floor control operation\' state machine is
\'G: Taken\',
a. shall send a Floor Taken message to any non-controlling MCPTT functions and
to those MCPTT floor participants that only received RTP media from the
overriding media endpoint. The Floor Taken message:
i. shall include the granted floor participant's MCPTT ID in the Granted
Party\'s Identity field, if privacy is not requested;
ii. shall include a Message Sequence Number field with a Message Sequence
Number value increased with 1; and
iii. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
8\. if the state in the \'general floor control operation\' state machine is
\'G: Idle\', shall send a Floor Idle message to all MCPTT floor participants.
The Floor Idle message:
a. shall include a Message Sequence Number field with a Message Sequence
Number value increased with 1; and
b. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
9\. shall enter the \'Start-stop\' state.
##### 6.3.6.3.6A IWF Floor Release (I: Floor release by IWF floor participant)
The procedures in clause 6.3.6.3.6 are followed.
##### 6.3.6.3.7 Receive Floor request message from permitted MCPTT floor
participant (R: Floor Request)
Upon receiving a Floor Request message from the MCPTT floor participant that
has been granted permission to send overriding media, the floor control
arbitration logic in the IWF floor control server:
1\. shall send a Floor Granted message to the previously granted MCPTT floor
participant. The Floor Granted message:
a. shall include the value of the T12 (Stop talking dual) timer in the
Duration field;
b. shall include the granted priority in the Floor priority field;
c. if the Floor Request message included a Track Info field, shall include the
received Track Info field; and
d. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications; and
2\. shall remain in the \'D: Floor Taken\' state.
##### 6.3.6.3.8 Permitted MCPTT participant release
If the IWF floor control server receives an indication from the floor control
interface towards the MCPTT client that the overriding MCPTT media endpoint
has started to disconnect from the MCPTT call, the floor control arbitration
logic in the IWF floor control server:
1\. shall request the media distributor in the IWF to stop distributing RTP
media packets received from the overriding MCPTT media endpoint to other media
endpoints;
2\. shall send a Floor Idle message to any non-controlling MCPTT functions and
to those MCPTT floor participants controlled by the IWF performing the
controlling role receiving RTP media from the overriding MCPTT media endpoint.
The Floor Idle message:
a. shall include an Floor Indicator field with the G-bit set to \'1\' (Dual
floor);
b shall include a Message Sequence Number field with a \ value increased with 1; and
c. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
3\. shall release all resources reserved in the media plane including the
instances used for the Floor control server state transition diagram for
\'dual floor control operation\' and any running timers associated with the
state machine; and
4\. shall enter the \'Start-stop\' state.
##### 6.3.6.3.8A Permitted IWF participant release (I: Call release by IWF
floor participant)
If the IWF floor control server determines that the overriding IWF media
endpoint has started to disconnect from the MCPTT call, the floor control
arbitration logic in the IWF floor control server:
1\. shall request the media distributor in the IWF to stop distributing RTP
media packets received from the overriding IWF media endpoint to other media
endpoints;
2\. shall send a Floor Idle message to any non-controlling MCPTT functions and
to those MCPTT floor participants controlled by the IWF performing the
controlling role receiving RTP media from the overriding IWF media endpoint.
The Floor Idle message:
a. shall include an Floor Indicator field with the G-bit set to \'1\' (Dual
floor);
b shall include a Message Sequence Number field with a \ value increased with 1; and
c. if a group call is a broadcast group call, a system call, an emergency
call, an imminent peril call, or a temporary group session, shall include the
Floor Indicator field with appropriate indications;
3\. shall release all resources reserved in the media plane including the
instances used for the Floor control server state transition diagram for
\'dual floor control operation\' and any running timers associated with the
state machine; and
4\. shall enter the \'Start-stop\' state.
##### 6.3.6.3.9 Receive Terminate (Terminate)
Upon receiving the termination instruction, the floor control arbitration
logic in the IWF floor control server:
1\. shall set the value of timer T1 (End of RTP media) to the value of timer
T11 (End of RTP dual) and start timer T1, if timer T11 (End of RTP dual) is
running;
2\. shall set the value of timer T2 (Stop talking) to the value of timer T12
(Stop talking dual) and start timer T2, if timer T12 (Stop talking dual) is
running;
3\. shall release all resources reserved in the media plane including the
instances used for the dual floor control operation\' state machine and stop
any running timers associated with the state machine; and
4\. shall enter the \'Start-stop\' state.
NOTE: The overriding participant continues to have the floor until its current
talk burst is terminated.
#### 6.3.6.4 In any state
##### 6.3.6.4.1 General
This clause describes the actions to be taken in all states defined for the
general state diagram with the exception of the \'Start-stop\' state.
##### 6.3.6.4.2 Receive MCPTT call release - 1
This clause is used by the floor control arbitration logic in the IWF floor
control server when an MCPTT call is released.
Upon receiving an MCPTT call release step 1 request from the application and
signalling plane the floor control arbitration logic in the IWF floor control
server:
1\. shall request the media distributor in the IWF to stop sending RTP media
packets to media endpoints; and
2\. shall enter the \'Releasing\' state.
#### 6.3.6.5 State: \'Releasing\'
##### 6.3.6.5.1 General
The floor control arbitration logic in the IWF floor control server uses this
state while waiting for the application and signalling plane to finalize the
disconnection of an MCPTT call.
##### 6.3.6.5.2 Receive MCPTT call release - 2
Upon receiving an MCPTT call release step 2 request from the application and
signalling plane, the floor control arbitration logic in the IWF floor control
server:
1\. shall release all resources reserved in the media plane including the
instances used for the dual floor control operation\' state machine and any
running timers associated with the state machine; and
2\. shall enter the \'Start-stop\' state.
## 6.4 IWF performing the participating role floor control procedures
### 6.4.1 General
The IWF performing the participating role performs the procedures in this
clause on behalf of each IWF media endpoint.
### 6.4.2 IWF floor participant procedures at MCPTT session initialization
#### 6.4.2.1 General
Based on the negotiations during the call establishment specified in 3GPP TS
29.379 [26], a new instance of a media session shall be created for this call.
The SIP INVITE request sent by the application and signalling plane:
1\. shall be regarded an implicit floor request when an implicit floor request
is negotiated; and
2\. shall not be regarded as an implicit floor request in case of a rejoin to
an already on-going group call.
NOTE: The IWF floor participant can negotiate the use of prioritization of the
Floor Request message. In that case, the floor participant can request
permission to send media at a priority level that is either the same as or
lower than the highest priority that was permitted to the participant in the
MCPTT call initialization. If a floor participant is authorized for pre-
emptive priority in the MCPTT call it is good practise to always request
permission to send RTP media packets at a priority level that is lower than
pre-emptive priority unless the IWF explicitly needs to pre-empt the current
RTP media packets\' sender. In any case pre-emptive priority will have no
effect for audio cut-in floor control.
#### 6.4.2.2 MCPTT call initiated, IWF originating
When a call is initiated as described in 3GPP TS 29.379 [26], the IWF floor
participant:
1\. shall create a media session;
2\. if the originating IWF floor participant receives a floor control message
before it receives the SIP 200 (OK) response, shall store the floor control
message; and
NOTE: The originating IWF floor participant might receive a floor control
message before the SIP 200 (OK) response when initiating, joining or rejoining
a call because of processing delays of the SIP 200 (OK) response in the SIP
core.
3\. if a floor control message is received after a SIP INVITE request with
implicit floor request and before the reception of the SIP 200 (OK), shall act
upon the floor control message.
#### 6.4.2.3 MCPTT call established, IWF terminating
When an MCPTT call is established, the terminating IWF floor participant shall
create an instance of a media session.
NOTE: From an IWF floor participant perspective the MCPTT call is established
when the application and signalling plane sends the SIP 200 (OK) response.
### 6.4.3 IWF floor participant procedures at MCPTT call release
The MCPTT call release can be initiated by the IWF floor participant or the
MCPTT floor control server. The following steps are performed:
1\. The IWF floor participant stops sending floor control messages and stops
sending RTP media packets.
2\. When the application and signalling plane has determined that the MCPTT
call is released, the corresponding instance of the media session is
terminated.
The user plane can initiate release step 1, but the application and signalling
plane always initiates release step 2.
NOTE: A badly formatted RTP packet or floor control message received is
ignored by the IWF floor participant.
### 6.4.4 IWF floor participant floor message handing
#### 6.4.4.1 Receive Floor Idle message
Upon receiving a Floor Idle message, the IWF floor participant:
1\. if the first bit in the subtype of the Floor Idle message is set to \'1\'
(Acknowledgment is required) as described in clause 8.3.2, shall send a Floor
Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'5\' (Floor Idle); and
b. shall include the Source field set to \'0\' (the IWF floor participant is
the source).
#### 6.4.4.2 Receive Floor Taken message
Upon receiving the Floor Taken message, the IWF floor participant:
1\. if the first bit in the subtype of the Floor Taken message is set to \'1\'
(Acknowledgment is required) as described in clause 8.3.2, shall send a Floor
Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'2\' (Floor Taken); and
b. shall include the Source field set to \'0\' (the IWF floor participant is
the source).
#### 6.4.4.3 Receive RTP media packets
The IWF can expect to receive RTP media packets at any time during a media
session except after releasing a media session.
NOTE: RTP media packets can be received from multiple sources when dual floor
control is applied by the floor control server (see 3GPP TS 24.380 [25],
clause 6.3.6). The IWF can differentiate between the different sources using
the SSRC in the received RTP media packets. How the IWF mixes the different
RTP media stream sources is out of scope of the present document.
#### 6.4.4.4 Send Floor Request message
Upon deciding to request permission to send media, the IWF floor participant:
1\. shall send the Floor Request message toward the MCPTT floor control
server; The Floor Request message:
a. if a different priority than the normal priority is required, shall include
the Floor Priority field with the priority not higher than negotiated with the
floor control server as specified in clause 14.3.3; and
b. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types.
#### 6.4.4.5 Receive Floor Granted message
Upon receiving a Floor Granted message from the floor control server or a
floor granted indication in a SIP 200 (OK) response in the application and
signalling layer, the IWF floor participant:
1\. if the first bit in the subtype of the Floor Granted message is set to
\'1\' (Acknowledgment is required) as described in clause 8.3.2, shall send a
Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'1\' (Floor Granted); and
b. shall include the Source field set to \'0\' (the IWF floor participant is
the source);
2\. may send a Floor Release message at any time, even before sending any
media; and
3\. shall start encoding and forwarding media to the MCPTT server.
#### 6.4.4.6 Receive Floor Deny message
Upon receiving a Floor Deny message, the IWF floor participant:
1\. if the first bit in the subtype of the Floor Deny message is set to \'1\'
(Acknowledgment is required) as described in clause 8.3.2, shall send a Floor
Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'3\' (Floor Deny); and
b. shall include the Source field set to \'0\' (the IWF floor participant is
the source); and
2\. shall not encode and forward voice packets.
#### 6.4.4.7 Send Floor Release message
Upon deciding to release permission to send media, the IWF floor participant:
1\. shall send a Floor Release message towards the floor control server;
a. if the session is a broadcast call and if the session was established as a
normal call, shall include the Floor Indicator with the A-bit set to \'1\'
(Normal call);
2\. may include the first bit in the subtype of the Floor Release message set
to \'1\' (Acknowledgment is required) as described in clause 8.3.2; and
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. if the Floor Granted message included the G-bit set to \'1\' (Dual floor),
shall include the Floor Indicator with the G-bit set to \'1\' (Dual floor).
#### 6.4.4.8 Receive Floor Queue Position Info message
Upon receiving a Floor Queue Position Info message, the IWF floor participant:
1\. if the first bit in the subtype of the Floor Queue Position Info message
is set to \'1\' (Acknowledgment is required) as described in clause 8.3.2,
shall send a Floor Ack message. The Floor Ack message:
a. shall include the Message Type field set to \'9\' (Floor Queue Position
Info); and
b. shall include the Source field set to \'0\' (the IWF floor participant is
the source).
NOTE: While in the queue, the IWF floor participant can receive RTP Media
packets and the IWF floor participant can send and receive floor control
messages.
#### 6.4.4.9 Receive Floor Revoke message
Upon receiving a Floor Revoke message, the IWF floor participant:
1\. shall discard any remaining buffered RTP media packets and to stop
forwarding encoded voice to the MCPTT server;
2\. shall send a Floor Release message. In the Floor Release message:
a. shall include the Floor Indicator with the G-bit set to the value of the
G-bit in the Floor Revoke message; and
b. may set the first bit in the subtype to \'1\' (Acknowledgment is required)
as described in clause 8.3.2.
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
#### 6.4.4.10 Receive MCPTT call release
Upon receiving an MCPTT call release request from the application and
signalling plane when the MCPTT call is going to be released or when the IWF
floor participant is leaving the MCPTT call, the IWF floor participant:
1\. shall stop sending floor control messages; and
2\. shall stop sending RTP media packets.
## 6.5 IWF performing the non-controlling role of an MCPTT group
### 6.5.4 Floor control server interface procedures
#### 6.5.4.1 General
The floor control server interface is stateless with regards to the floor
control message received and sent.
The following subclauses specify what the floor control server interface shall
do when receiving a floor control message sent by the controlling MCPTT
function or received at the floor participant interface or initiated
internally for an IWF media endpoint and how the floor control server controls
the media distribution function in the non-controlling MCPTT function.
Editor\'s Note: Existing clauses 6.3.5 and 6.3.6 should be evaluated for
updates now that we support regroup. Search for \"non-controlling\" in TS
24.380 and TS 29.380.
#### 6.5.4.2 Receiving a Floor Request message
Upon receiving a Floor Request message from one floor participant interface,
the floor control server interface:
1\. shall
a. forward the Floor Request message to the controlling MCPTT function if the
controlling function is in the MCPTT system; or
b. forward to the floor control server in the IWF if the controlling function
is in the IWF.
The Floor Request message:
a. shall include all fields included by the floor participant;
b. if a Track Info field is included, shall include the temporary identifier
at the end of the \ value item; and
c. if a Track Info field is not included, shall include a Track Info field
populated as follows:
i. shall include the \"mc_queueing\" fmtp attribute value negotiated as
specified in clause 14 in the \ value;
ii. shall include a \ value based on the \
element specified in 3GPP TS 24.481 [12], if value in the \
element is available, otherwise set the \ value to
\"unknown\"; and
iii. shall include the temporary identifier as the first \ value; and
2\. if the value of the \ in the Track Info is \'1\' (the
floor participant in the MCPTT client supports queueing), shall store the
outgoing Floor Request message in the passive floor request queue.
#### 6.5.4.2A IWF sends a Floor Request message
Upon deciding to request permission to send media when the controlling
function is in the MCPTT system, the IWF:
1\. shall send the Floor Request message toward the MCPTT floor control server
in the MCPTT system. The Floor Request message:
a. if a different priority than the normal priority is required, shall include
the Floor Priority field with the priority not higher than negotiated with the
floor control server as specified in clause 14.3.3; and
b. if the floor request is a broadcast group call, system call, emergency call
or an imminent peril call, shall include a Floor Indicator field indicating
the relevant call types.
#### 6.5.4.3 Receive Floor Release message
Upon receiving a Floor Release message from one floor participant interface,
the floor control server interface:
NOTE: A Floor Release message can be received from the permitted floor
participant and from any participant that is queued in the floor control
server.
1\. shall forward a Floor Release message to the controlling MCPTT function if
the controlling function is in the MCPTT system or to the floor control server
state transition diagram for basic floor control operation towards the floor
participant in the IWF if the controlling function is in the IWF. The Floor
Release message:
a. shall include all fields included by the floor participant in the Floor
Release message;
b. if a Track Info field is included, shall include the temporary identifier
at the end of the \ value item; and
c. if a Track Info field is not included, shall include a Track Info field as
follows:
i. shall include the \"mc_queueing\" fmtp attribute value negotiated as
specified in clause 14 in the \ value; and
ii. shall include the temporary identifier as the first \ value; and
2\. if a Floor Request message received from this floor participant is in the
passive floor request queue, shall remove the floor request from the passive
floor request queue.
#### 6.5.4.3A IWF sends a Floor Release message
Upon deciding to release permission to send media when the controlling
function is in the MCPTT system, the IWF floor participant:
1\. shall send a Floor Release message towards the floor control server in the
MCPTT system;
a. if the session is a broadcast call and if the session was established as a
normal call, shall include the Floor Indicator with the A-bit set to \'1\'
(Normal call);
2\. may include the first bit in the subtype of the Floor Release message set
to \'1\' (Acknowledgment is required) as described in clause 8.3.2; and
NOTE: It is an implementation option to handle the receipt of the Floor Ack
message and what action to take if the Floor Ack message is not received.
3\. if the Floor Granted message included the G-bit set to \'1\' (Dual floor),
shall include the Floor Indicator with the G-bit set to \'1\' (Dual floor).
#### 6.5.4.4 Receive Floor Queue Position Request message
Upon receiving a Floor Queue Position Request message from one floor
participant interface, the floor control server interface:
1\. shall forward the Floor Queue Position Request message to the controlling
MCPTT function if the controlling function is in the MCPTT system or to the
floor control server state transition diagram for basic floor control
operation towards the floor participant in the IWF if the controlling function
is in the IWF. The Floor Queue Position Request message:
a. shall include all fields included by the floor participant;
b. if a Track Info field is included, shall include the temporary identifier
at the end of the \ value item; and
c. if a Track Info field is not included, shall include a Track Info field as
follows:
i. shall include the \"mc_queueing\" fmtp attribute value negotiated as
specified in clause 14 in the \ value; and
ii. shall include the temporary identifier as the first \ value.
#### 6.5.4.4A IWF sends Floor Queue Position Request message
Upon deciding to request the queue position, when the controlling function is
in the MCPTT system, the IWF:
1\. shall send the Floor Ack message towards the floor control server in the
MCPTT system. The Floor Ack message:
a. shall include the Message Type field set to \'2\' (Floor Taken);
b. shall include the Source field set to \'0\' (the floor participant is the
source); and
c. shall include a Track Info field as follows:
i. shall include the \"mc_queueing\" fmtp attribute value negotiated as
specified in clause 14 in the \ value; and
ii. shall include the temporary identifier as the first \ value.
#### 6.5.4.5 Receive Floor Ack message
Upon receiving a Floor Ack message from one floor participant interface the
floor control server interface:
1\. shall send the Floor Ack message towards the controlling MCPTT function if
the controlling function is in the MCPTT system or to the floor control server
state transition diagram for basic floor control operation towards the floor
participant in the IWF if the controlling function is in the IWF. The Floor
Ack message:
a. shall include all fields included by the floor participant in the Floor Ack
message;
b. if Track Info field is included, shall include the temporary identifier at
the end of the \ value item; and
c. if a Track Info field is not included, shall include a Track Info field
with temporary identifier as the first \.
#### 6.5.4.5A IWF sends Floor Ack message
Upon deciding to send a Floor Ack message, when the controlling function is in
the MCPTT system, the IWF:
1\. shall send the Floor Ack message towards the floor control server in the
MCPTT system. The Floor Ack message shall include a Track Info field as
follows:
a. shall include the temporary identifier as the first \ value.
#### 6.5.4.6 Receive Floor Granted message
Upon receiving a Floor Granted message sent from the controlling MCPTT
function, the floor control server interface:
1\. shall send the Floor Granted to the floor participant interface identified
by the \ value at the end of the Track Info field. The
Floor Granted message:
a. shall include the fields as received with the following exceptions:
i. if the Track Info field only contains one \ value,
shall remove the Track Info field from the outgoing Floor Granted message; and
ii. if the Track Info field contains more than one \
value, shall remove the last \ value from the Track
Info field from the outgoing Floor Granted message; and
b if the Floor Indicator field is included in the Floor Granted message and
the G-bit is set to \'1\' (Dual floor), shall store the SSRC of granted floor
participant and associate the stored value with dual floor;
2\. if:
a. the SSRC of the granted floor participant associated with dual floor is not
stored, shall send a Floor Taken message populated as specified in step d.
below to all participant interfaces with the exception of the floor
participant interface to which the Floor Granted message is sent;
b. the SSRC of the granted floor participant associated with dual floor is
stored and if the Floor Indicator field is not included in the Floor Granted
message or if the Floor Indicator field is included in the Floor Granted
message and the G-bit is set to \'0\' (Not dual floor), shall send a Floor
Taken message populated as specified in step d. below to all participant
interfaces with the exception of:
i. the floor participant interface to which the Floor Granted message is sent;
and
ii. the floor participants only listening to the overriding floor participant;
c. the Floor Indicator field is included in the Floor Granted message and the
G-bit is set to \'1\' (Dual floor):
i. shall send a Floor Taken message populated as specified in step d. below to
floor participants that will listen to the RTP media from the overriding MCPTT
client according to local policy;
NOTE 1: The floor participant overridden by the overriding floor participant
is still sending voice (overridden). The list of floor participants that
receive the overriding, overridden, or both transmissions is based on
configuration.
d. The Floor Taken message:
i. shall include the granted user\'s MCPTT ID in the Granted Party\'s Identity
field if privacy is not requested by the granted floor participant when the
floor participant was invited to the session;
NOTE 2: The privacy request was stored for each invited floor participant when
the floor participant accepted the invitation as specified in subclause 6.5.2.
ii. shall include in the Message Sequence Number field the local \ value increased with 1;
iii. shall include the Permission to Request Floor field to \'0\', if the
group call is a broadcast group call;
iv. may include the Permission to Request the Floor field set to \'1\', if the
group call is not a broadcast group call; and
v. shall set the first bit in the subtype of the Floor Taken message to \'0\'
(acknowledgement is not required); and
NOTE 3: A Floor Taken message sent to all participants does not require
acknowledgement.
e. if the Floor Indicator field was included in the Floor Granted message,
shall include the received Floor Indicator field; and
3\. if the Floor Request message received from the floor participant is in the
passive floor request queue, shall remove the floor request from the passive
floor request queue; and
4 if the Floor Indicator field is included in the Floor Granted message and
the G-bit is set to \'1\' (Dual floor), shall send a Floor Idle message to
those floor participants that will only listen to RTP media from the
overriding MCPTT client. The Floor Idle message:
a. shall include the Floor Indicator field as received in the Floor Granted
message with the G-bit set to \'0\' (Not dual floor); and
b. shall include in the Message Sequence Number field the local \ value increased with 1.
#### 6.5.4.6A IWF grants floor
Upon deciding to grant floor, where the controlling function is in the IWF,
the IWF floor control server interface:
Editor\'s Note: Need to create a grant message for internally generated
requests, need to also consider floor requests coming from IWF CF that
originated in MCPTT, how do those make it here? Does IWF CF call this nCF?
Editor\'s note: Need to add procedures for clauses 6.5.4.7 thru 6.5.4.16.
#### 6.5.4.17 Receive Floor Release Multi Talker message
Upon receiving a Floor Release Multi Talker message sent from the controlling
MCPTT function, the IWF floor control server interface shall ignore the Floor
Release Multi Talker message.
NOTE: The multi-taker feature is not supported in the present document.
### 6.5.5 Floor participant interface procedures
#### 6.5.5.1 General
The floor participant interface toward the MCPTT client shall behave according
to the state diagram and state transitions specified in this clause.
Figure 6.5.5.1-1 shows the general floor control operation states (P states)
and the state transition diagram.
Figure 6.5.5.1-1: The \'floor participant interface toward the MCPTT client
state transition\' state diagram
The floor participant interface toward the MCPTT client shall keep one
instance of the \'floor participant interface toward the MCPTT client state
transition\' state machine per MCPTT client in a session. The interface and
procedures toward IWF media endpoints are out of scope of the present
document.
The floor participant associated to the \'floor participant interface toward
the MCPTT client state transition\' state machine is in the following clauses
referred to as the MCPTT floor participant.
If floor control messages or RTP media packets arrives in a state where there
is no procedure specified in the following clauses the floor participant
interface toward the MCPTT client:
1\. shall discard the floor control message;
2\. shall request the network media interface to discard any received RTP
media packet; and
3\. shall remain in the current state.
State details are explained in the following clauses.
#### 6.5.5.2 State: \'Start-Stop\'
##### 6.5.5.2.1 General
When a new instance of the \'Floor participant interface toward the MCPTT
client state transition\' state machine is initiated, before any floor control
related input is applied, the state machine is in \'Start-stop\' state.
Similarly, when the session is released the state machine shall return to the
\'Start-stop\' state.
##### 6.5.5.2.2 Participant invited to session
When the floor participant interface toward the MCPTT client receives an
indication from the floor control server interface that an MCPTT client has
accepted the invitation to a session (i.e. when the SIP 200 (OK) response to
the initial SIP INVITE request is received as specified in 3GPP TS 24.379 [2])
, the floor participant interface toward the MCPTT client:
1\. shall enter the \'P: has no permission\' state.
#### 6.5.5.3 State: \'P: has no permission\'
##### 6.5.5.3.1 General
The floor participant interface toward the MCPTT client uses this state when
the MCPTT floor participant is not permitted to send media.
##### 6.5.5.3.2 Receive Floor Idle message (R: Floor Idle)
When the floor participant interface toward the MCPTT client receives a Floor
Idle message from the floor control server interface, the floor participant
interface toward the MCPTT client:
1\. shall send the Floor Idle message to the MCPTT floor participant;
2\. if the first bit in the subtype of the Floor Idle message is set to \'1\'
(acknowledgement is required) as specified in clause 8.2.2, shall store an
indication that a Floor Ack message to a Floor Idle messages is expected; and
3\. shall remain in the \'P: has no permission\' state.
##### 6.5.5.3.3 Receive Floor Taken message (R: Floor Taken)
When the floor participant interface toward the MCPTT client receives a Floor
Taken message from the floor control server interface, the floor participant
interface toward the MCPTT client:
1\. shall send the Floor Taken message to the MCPTT floor participant;
2\. if the first bit in the subtype of the Floor Taken message is set to \'1\'
(acknowledgement is required) as specified in clause 8.2.2, shall store an
indication that a Floor Ack message to a Floor Taken messages is expected; and
3\. shall remain in the \'P: has no permission\' state.
##### 6.5.5.3.4 Receive Floor Request message (R: Floor Request)
When the floor participant interface toward the MCPTT client receives a Floor
Request message from the MCPTT floor participant, the floor participant
interface toward the MCPTT client:
1\. shall send the Floor Request message to the floor control server
interface; and
2\. shall remain in the \'P: has no permission\' state.
##### 6.5.5.3.5 Receive Floor Granted message (R: Floor Granted)
When the floor participant interface toward the MCPTT client receives a Floor
Granted message from the floor control server interface, the floor participant
interface toward the MCPTT client:
1\. shall send the Floor Granted message to the MCPTT floor participant;
2\. if the first bit in the subtype of the Floor Granted message is set to
\'1\' (acknowledgement is required) as specified in clause 8.2.2, shall store
an indication that a Floor Ack message to a Floor Granted messages is
expected; and
3\. shall enter the \'P: has permission\' state.
##### 6.5.5.3.6 Receive Floor Deny message (R: Floor Deny)
When the floor participant interface toward the MCPTT client receives a Floor
Deny message from the floor control server interface, the floor participant
interface toward the MCPTT client:
1\. shall send the Floor Deny message to the MCPTT floor participant toward
the MCPTT client;
2\. if the first bit in the subtype of the Floor Deny message is set to \'1\'
(acknowledgement is required) as specified in clause 8.2.2, shall store an
indication that a Floor Ack message to a Floor Deny messages is expected; and
3\. shall remain in the \'P: has no permission\' state.
##### 6.5.5.3.7 Receive Floor Queue Position Info message (R: Floor Queue
Position Info)
When the floor participant interface toward the MCPTT client receives a Floor
Queue Position Info message from the floor control server interface, the floor
participant interface toward the MCPTT client:
1\. shall send the Floor Queue Position Info message to the MCPTT floor
participant;
2\. if the first bit in the subtype of the Floor Queue Position Info message
is set to \'1\' (acknowledgement is required) as specified in clause 8.2.2,
shall store an indication that a Floor Ack message to a Floor Queue Position
Info messages is expected; and
3\. shall remain in the \'P: has no permission\' state.
##### 6.5.5.3.8 Receive Floor Queue Position Request message (R: Floor Queue
Position Request)
When the floor participant interface toward the MCPTT client receives a Floor
Queue Position Request message from the MCPTT floor participant, the floor
participant interface toward the MCPTT client:
1\. shall send the Floor Queue Position Request message to the floor control
server interface; and
2\. shall remain in the \'P: has no permission\' state.
##### 6.5.5.3.9 Receive RTP media packets (R: RTP media)
When the floor participant interface toward the MCPTT client receives an
indication from the network media interface that RTP media packets are
received from the media distributor, the floor participant interface toward
the MCPTT client:
1\. shall instruct the network media interface to send the received RTP media
packets towards the MCPTT client; and
2\. shall remain in the \'P: has no permission\' state.
When the floor participant interface toward the MCPTT client receives an
indication from the network media interface that RTP media packets are
received from the MCPTT client, the floor participant interface toward the
MCPTT client:
1\. shall send a Floor Revoke message to the MCPTT floor participant. The
Floor Revoke message:
a. shall include the Reject Cause field with the \ value set to
#3 (No permission to send a Media Burst);
2\. shall store that a Floor Release message is expected from the MCPTT floor
participant; and
3\. shall remain in the \'P: has no permission\' state.
##### 6.5.5.3.10 Receive Floor Release message (R: Floor Release)
When the floor participant interface toward the MCPTT client receives a Floor
Release message from the MCPTT floor participant, the floor participant
interface toward the MCPTT client:
1\. if a Floor Release message is not expected from the MCPTT floor
participant:
a. if the first bit in the subtype of the Floor Release message is set to
\'1\' (acknowledgement is required) as specified in clause 8.2.2, based on
local policy:
i shall send a Floor Ack message to the MCPTT floor participant and set the
first bit in the subtype of the Floor Release message to \'0\'
(acknowledgement is not required) in the outgoing Floor Release message; or
ii. wait for the Floor Ack from the floor control server; and
b. shall forward the Floor Release message to the floor control server
interface;
2\. if a Floor Release message is expected from the MCPTT floor participant:
a. if the first bit in the subtype of the Floor Release message is set to
\'1\' (acknowledgement is required) as specified in clause 8.2.2:
i. shall send a Floor Ack message to the MCPTT floor participant; and
b. shall remove that a Floor Release message is expected from the floor
participant; and
3\. shall remain in the \'P: has no permission\' state.
##### 6.5.5.3.11 Receive split instruction (R: Split)
Upon receiving an instruction to split the ongoing MCPTT call, to the floor
participant interface toward the MCPTT client:
1\. shall create a new instance of the \'basic floor control operation towards
the floor participant\' state machine;
2\. shall move information associated with the instance used for \'floor
participant interface toward the MCPTT client state transition\' to the
\'basic floor control operation towards the floor participant\' state machine;
NOTE: Which information that needs to be moved is an implementation option.
3\. shall enter the \'Start-stop\' state and terminate the \'floor participant
state transition\' state machine associated with this MCPTT floor participant
and this session;
4\. if the state in \'general floor control operation\' state machine is \'G:
Floor Idle\' state; shall enter the \'U: not permitted and Floor Idle\' state
as specified in clause 6.3.5.3.2; and
5\. if the state in \'general floor control operation\' state machine is \'G:
Floor Taken\' state; shall enter the \'U: not permitted and Floor Taken\'
state as specified in clause 6.3.5.4.2.
##### 6.5.5.3.12 Receive Floor Release Multi Talker message (R: Floor Release
Multi-talker)
When the floor participant interface toward the MCPTT client receives a Floor
Release Multi Talker message from the floor control server interface, the
floor participant interface toward the MCPTT client:
1\. shall remain in the \'P: has no permission\' state.
NOTE: The multi-talker feature is not supported in the present document.
#### 6.5.5.4 State: \'P: has permission\'
##### 6.5.5.4.1 General
The floor participant interface toward the MCPTT client uses this state when
the floor participant has permission to send media
##### 6.5.5.4.2 Receive RTP media packets
When the floor participant interface toward the MCPTT client receives an
indication from the network media interface that RTP media packets are
received from the MCPTT client, the floor participant interface toward the
MCPTT client:
1\. shall instruct the media interface to forward received RTP media packets
towards the media distributor; and
2\. shall remain in the \'P: has permission\' state.
##### 6.5.5.4.3 Receive Floor Release message (R: Floor Release)
When the floor participant interface toward the MCPTT client receives a Floor
Release message from the floor participant, the floor participant interface
toward the MCPTT client:
1\. shall send the Floor Release message to the floor control server
interface; and
3\. shall remain in the \'P: has permission\' state.
##### 6.5.5.4.4 Receive Floor Ack message (R: Floor Ack)
When the floor participant interface toward the MCPTT client receives a Floor
Ack message from the floor control server interface, the floor participant
interface toward the MCPTT client:
1\. shall send the Floor Ack message to the floor participant; and
2\. shall remain in the \'P: has permission\' state.
##### 6.5.5.4.5 Receive Floor Idle message (R: Floor Idle)
When the floor participant interface toward the MCPTT client receives a Floor
Idle message from the floor control server interface, the floor participant
interface toward the MCPTT client:
1\. shall send the Floor Idle message to the floor participant;
2\. if the first bit in the subtype of the Floor Idle message is set to \'1\'
(acknowledgement is required), shall store an indication that a Floor Ack
message to a Floor Idle messages is expected; and
3\. shall enter the \'P: has no permission\' state.
##### 6.5.5.4.6 Receive Floor Taken message (R: Floor Taken)
When the floor participant interface toward the MCPTT client receives a Floor
Taken message from the floor control server interface, the floor participant
interface toward the MCPTT client:
1\. shall send the Floor Taken message to the floor participant;
2\. if the first bit in the subtype of the Floor Taken message is set to \'1\'
(acknowledgement is required), shall store an indication that a Floor Ack
message to a Floor Taken messages is expected; and
3\. shall enter the \'P: has no permission\' state.
##### 6.5.5.4.7 Receive Floor Revoke message (R: Floor Revoke)
When the floor participant interface toward the MCPTT client receives a Floor
Revoke message from the floor control server interface, the floor participant
interface toward the MCPTT client:
1\. shall send the Floor Revoke message to the MCPTT floor participant;
2\. if the first bit in the subtype of the Floor Revoke message is set to
\'1\' (acknowledgement is required), shall store an indication that a Floor
Ack message to a Floor Revoke messages is expected; and
3\. shall remain in the \'P: has permission\' state.
##### 6.5.5.4.8 Receive split instruction (R: Split)
Upon receiving an instruction to split the ongoing MCPTT call, the floor
participant interface toward the MCPTT client:
1\. shall create a new instance of the \'basic floor control operation towards
the floor participant\' state machine as specified in clause 6.3.5;
2\. shall move information associated with the instance used for \'floor
participant interface toward the MCPTT client state transition\' to the
\'basic floor control operation towards the floor participant\' state machine;
NOTE: Which information that needs to be moved is an implementation option.
3\. shall enter the \'Start-stop\' state and terminate the \'floor participant
state transition\' state machine associated with this MCPTT floor participant
and this session; and
4\. shall enter the \'U: permitted\' state as specified in clause 6.3.5.5.2.
##### 6.5.5.4.9 Receive Floor Release Multi Talker message (R: Floor Release
Multi-talker)
When the floor participant interface toward the MCPTT client receives a Floor
Release Multi Talker message from the floor control server interface, the
floor participant interface toward the MCPTT client:
1\. shall remain in the \'P: has permission\' state.
NOTE: The multi-talker feature is not supported in the present document.
#### 6.5.5.5 In any state
##### 6.5.5.5.1 General
This clause describes the actions to be taken in all states defined for the
\'floor participant state transition\' diagram with the exception of the
\'Start-stop\' and \'Releasing\' states.
##### 6.5.5.5.2 Receive Floor Ack message (R: Floor Ack)
If a Floor Ack message is received from the MCPTT floor participant, the floor
participant interface toward the MCPTT client:
1\. if an indication exists that a Floor Ack message is expected for the
message in the Message Type field;
a. shall forward the Floor Ack message to the floor control server interface;
and
b. shall remove the indication that a Floor Ack message is expected for the
message in the Message Type field; and
NOTE: It is an implementation option what action to take if an indication
exists that a Floor Ack message is expected for the message in the Message
Type field, but the Floor Ack message is not received
2\. shall remain in the current state.
If a Floor Ack message is received from the floor control server interface,
the floor participant interface toward the MCPTT client:
1\. shall send the Floor Ack message to the MCPTT floor participant; and
2\. shall remain in the current state.
##### 6.5.5.5.3 MCPTT session release step 1 (MCPTT call release - 1)
Upon receiving an MCPTT call release step 1 request from the application and
signalling plane e.g. when the session is going to be released or when the
MCPTT client leaves the session, the floor participant interface toward the
MCPTT client:
1\. shall stop sending floor control messages to the MCPTT floor participant;
2\. shall request the network media interface to stop sending RTP media
packets towards to the MCPTT client;
3\. shall ignore any floor control messages received from the MCPTT floor
participant;
4\. shall request the network media interface to stop forwarding RTP media
packets from the MCPTT client to the media distributor;
5\. shall indicate to the floor control server interface that the MCPTT client
has started to disconnect from the session; and
6\. shall enter the \'P: Releasing\' state.
#### 6.5.5.6 State: \'P: Releasing\'
##### 6.5.5.6.1 General
The floor participant interface toward the MCPTT client uses this state while
waiting for the application and signalling plane to finalize the release of
the session or finalizing the removal of the MCPTT client from the session.
##### 6.5.5.6.2 MCPTT session release step 2 (MCPTT call release - 2)
Upon receiving an MCPTT call release step 2 request from the application and
signalling plane, the floor participant interface toward the MCPTT client:
1\. shall request the network media interface to release all resources
associated with this MCPTT client for this MCPTT call; and
2\. shall enter the \'Start-stop\' state and terminate the \'floor participant
state transition\' state machine associated with this MCPTT floor participant
and this session.
# 7 Off-network floor control
Off-network floor control is not applicable to an IWF.
# 8 Coding
## 8.1 Introduction
The message and field formats specified in 3GPP TS 24.380 [25] clause 8.1
shall be used.
## 8.2 Floor control
The procedures specified in 3GPP TS 24.380 [25] clause 8.2 shall be used with
the following clarification.
The field formats specified in 3GPP TS 24.380 [25] clause 8.2 shall be
supported except for fields and field values used for the following features:
\- multi-talker;
\- ambient listening; and
\- functional alias.
## 8.3 Pre-established session call control
Pre-established session call control is not applicable to the IWF.
## 8.4 MBMS subchannel control
MBMS subchannel control is not applicable to the IWF.
## 8.5 MBMS notifications
MBMS notifications are not applicable to the IWF.
# 9 Call setup control over pre-established session
Call setup control over a pre-established session is not applicable to the
IWF.
# 10 MBMS procedures
MBMS procedures are not applicable to the IWF.
# 11 Configurable parameters
## 11.1 Timers
## 11.2 Counters
# 12 Extensions within the present document
No extensions are defined in the present document.
The IWF shall support the session description types defined in 3GPP TS 24.380
[25] clause 12.1.
# 13 Media plane security
## 13.1 General
Media plane security provides integrity and confidentiality protection of
individual media streams and media plane control messages in MCPTT sessions.
The media plane security is based on the 3GPP MCPTT security solution
including key management and end-to-end media and floor control messages
protection as defined in 3GPP TS 33.180 [18].
Various keys and associated key identifiers protect:
1\. RTP transported media;
2\. RTCP transported media control messages (i.e. RTCP SR packets, RTCP RR
packets, RTCP SDES packets); and
3\. RTCP APP transported floor control messages.
In an on-network group call of an MCPTT group which is not a constituent MCPTT
group of a temporary MCPTT group:
1\. if protection of media is negotiated, the GMK and the GMK-ID of the MCPTT
group protect the media sent and received by MCPTT clients and users homed in
the IWF;
2\. if protection of floor control messages between the IWF performing the
participating role and the controlling MCPTT function or between the IWF
performing the controlling role and the participating MCPTT function is
negotiated, the SPK and the SPK-ID protect the floor control messages sent and
received between the IWF performing the participating role and the controlling
MCPTT function or between the IWF performing the controlling role and the
participating MCPTT function; and
3\. if protection of media control messages between the IWF performing the
participating role and the controlling MCPTT function or between the IWF
performing the controlling role and the participating MCPTT function is
negotiated, the SPK and the SPK-ID protect the media control messages sent and
received between the IWF performing the participating role and the controlling
MCPTT function or between the IWF performing the controlling role and the
participating MCPTT function.
In an on-network group call of an MCPTT group which is a constituent MCPTT
group of a temporary MCPTT group:
1\. if protection of media is negotiated, the GMK and the GMK-ID of the
temporary MCPTT group protect the media sent and received by an MCPTT client
and a user homed in the IWF;
2\. if protection of floor control messages between the IWF performing the
participating role and the non-controlling MCPTT function or between the IWF
performing the non-controlling role and the participating MCPTT function is
negotiated, the SPK and the SPK-ID protect the floor control messages sent and
received between the IWF performing the participating role and the non-
controlling MCPTT function or between the IWF performing the non-controlling
role and participating MCPTT function;
3\. if protection of floor control messages between the IWF performing the
non-controlling role and the controlling MCPTT function or between the IWF
performing the controlling role and the non-controlling MCPTT function is
negotiated, the SPK and the SPK-ID protect the floor control messages sent and
received between the IWF performing the non-controlling role and the
controlling MCPTT function or between the IWF performing the controlling role
and the non-controlling MCPTT function;
4\. if protection of media control messages between the IWF performing the
participating role and the non-controlling MCPTT function or between the IWF
performing the non-controlling role and the participating MCPTT function is
negotiated, the SPK and the SPK-ID protect the media control messages sent and
received between the IWF performing the participating role and the non-
controlling MCPTT function or between the IWF performing the non-controlling
role and the participating MCPTT function; and
5\. if protection of media control messages between the IWF performing the
non-controlling role and the controlling MCPTT function or between the IWF
performing the controlling role and the non-controlling MCPTT function is
negotiated, the SPK and the SPK-ID protect the media control messages sent and
received between the IWF performing the non-controlling role and the
controlling MCPTT function or between the IWF performing the controlling role
and the non-controlling MCPTT function.
In an on-network private call:
1\. if protection of media is negotiated, the PCK and the PCK-ID protect media
sent and received by the MCPTT client and the user homed in the IWF;
2\. if protection of floor control messages between the IWF performing the
participating role and the controlling MCPTT function or between the IWF
performing the controlling role and the participating MCPTT function is
negotiated, the SPK and the SPK-ID protect the floor control messages sent and
received between the IWF performing the participating role and the controlling
MCPTT function or between the IWF performing the controlling role and the
participating MCPTT function; and
3\. if protection of media control messages between the IWF performing the
participating role and the controlling MCPTT function or between the IWF
performing the controlling role and the participating MCPTT function is
negotiated, the SPK and the SPK-ID protect the media control messages sent and
received between the IWF performing the participating role and the controlling
MCPTT function or between the IWF performing the controlling role and the
participating MCPTT function.
The GMK and the GMK-ID are distributed to the MCPTT clients using the group
document subscription and notification procedure specified in 3GPP TS 24.481
[12].
The GMK and the GMK-ID are distributed to the IWF by the MCPTT GMS per the
procedures specified in 3GPP TS 24.481 [12] for distribution of the GMK and
GMK-ID to an MCPTT server.
How the GMK and the GMK-ID are distributed to floor participants homed in the
IWF is out of scope of the present document.
The SPK and the SPK-ID are configured in the IWF for all the roles it
performs.
If a private call that passes through the IWF is initiated by an MCPTT client,
the PCK and the PCK-ID are generated by the MCPTT client initiating the
private call and provided to the IWF using SIP signalling according to 3GPP TS
24.379 [2], using the Connect message described in clause 8.3.4.
If a private call that passes through the IWF is initiated by a user homed in
the IWF, the PCK and the PCK-ID are generated by the IWF and provided to the
MCPTT client receiving the private call using SIP signalling according to 3GPP
TS 24.379 [2], using the Connect message described in clause 8.3.4.
NOTE: The distribution and provisioning of LMR keys by the LMR system to
entities in the MCPTT system is out of scope.
## 13.2 **Derivation of SRTP/SRTCP master keys**
Each key (i.e. GMK, PCK, SPK) and its associated key identifier (i.e. GMK-ID,
PCK-ID, SPK-ID) described in clause 13.1 are used to derive SRTP-MK, SRTP-MS
and SRTP-MKI.
SRTP-MK, SRTP-MS and SRTP-MKI are used in encryption of media or floor control
messages in SRTP as specified in IETF RFC 3711 [16] and 3GPP TS 33.180 [18].
## 13.3 Media plane encryption and decryption
### 13.3.1 General
Void.
### 13.3.2 The IWF performing the participating role
The IWF performing the participating role:
1\. if protection of media is negotiated, shall be transparent to RTP media
streams and shall forward encrypted RTP media streams without decrypting the
payload;
2\. if protection of floor control messages between the IWF performing the
participating role and the controlling MCPTT function is negotiated and the
SPK and the SPK-ID are configured in the IWF, then the IWF performing the
participating role:
A) shall encrypt floor control messages sent to the controlling MCPTT function
according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS
and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2;
and
B) shall decrypt floor control messages received from the controlling MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
clause 13.2;
3\. if protection of floor control messages between the IWF performing the
participating role and the non-controlling MCPTT function is negotiated and
the SPK and the SPK-ID are configured in the IWF, then the IWF performing the
participating role:
A) shall encrypt floor control messages sent to the non-controlling MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
clause 13.2; and
B) shall decrypt floor control messages received from the non-controlling
MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using
SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified
in clause 13.2;
4\. if protection of media control messages between the IWF performing the
participating role and the controlling MCPTT function is negotiated and the
SPK and the SPK-ID are configured in the IWF, then the IWF performing the
participating role:
A) shall encrypt media control messages sent to the controlling MCPTT function
according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS
and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2;
and
B) shall decrypt media control messages received from the controlling MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
clause 13.2; and
5\. if protection of media control messages between the IWF performing the
participating role and the non-controlling MCPTT function is negotiated and
the SPK and the SPK-ID are configured in the IWF, then the IWF performing the
participating role:
A) shall encrypt media control messages sent to the non-controlling MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
clause 13.2; and
B) shall decrypt media control messages received from the non-controlling
MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using
SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified
in clause 13.2.
### 13.3.3 The IWF media endpoint
The IWF media endpoint:
1\. in an on-network group call of an MCPTT group which is not a constituent
MCPTT group of a temporary MCPTT group:
A) if protection of media is negotiated and the GMK and the GMK-ID of the
MCPTT group were received using the group document subscription and
notification procedure specified in 3GPP TS 24.481 [12] for the MCPTT group:
i) shall encrypt sent media according to IETF RFC 3711 [16] and 3GPP TS 33.180
[18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the GMK and GMK-ID as
specified in clause 13.2; and
ii) shall decrypt received media according to IETF RFC 3711 [16] and 3GPP TS
33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the GMK and
GMK-ID as specified in clause 13.2;
2\. in an on-network group call of an MCPTT group which is a constituent MCPTT
group of a temporary MCPTT group:
A) if protection of media is negotiated and the GMK and the GMK-ID of the
temporary MCPTT group were received using the group document subscription and
notification procedure specified in 3GPP TS 24.481 [12] for the constituent
MCPTT group:
i) shall encrypt sent media according to IETF RFC 3711 [16] and 3GPP TS 33.180
[18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the GMK and GMK-ID of
the temporary MCPTT group as specified in clause 13.2; and
ii) shall decrypt received media according to IETF RFC 3711 [16] and 3GPP TS
33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the GMK and
GMK-ID of the temporary MCPTT group as specified in clause 13.2; and
3\. in an on-network private call:
A) if:
i) protection of media is negotiated in an originating call and the PCK and
the PCK-ID were sent to the remote MCPTT client using SIP signalling according
to 3GPP TS 24.379 [2]; or
ii) protection of media is negotiated in a terminating call and the PCK and
the PCK-ID were received from the remote MCPTT client using SIP signalling
according to 3GPP TS 24.379 [2];
then:
i) shall encrypt sent media according to IETF RFC 3711 [16] and 3GPP TS 33.180
[18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the PCK and PCK-ID as
specified in clause 13.2; and
ii) shall decrypt received media according to IETF RFC 3711 [16] and 3GPP TS
33.180 [18] using SRTP-MK, SRTP-MS and SRTP-MKI generated using the PCK and
PCK-ID as specified in clause 13.2.
### 13.3.4 The IWF performing the controlling role
The IWF performing the controlling role:
1\. if protection of media is negotiated, shall be transparent to RTP media
streams and shall forward encrypted RTP media streams without decrypting the
payload;
2\. in an on-network group call of an MCPTT group which is not a constituent
MCPTT group of a temporary MCPTT group:
A) if protection of floor control messages between the IWF performing the
controlling role and the participating MCPTT function is negotiated and the
SPK and the SPK-ID are configured in the IWF, then the IWF performing the
controlling role:
i) shall encrypt floor control messages sent to the participating MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
clause 13.2; and
ii) shall decrypt floor control messages received from the participating MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
clause 13.2; and
B) if protection of media control messages between the IWF performing the
controlling role and the participating MCPTT function is negotiated and the
SPK and the SPK-ID are configured in the IWF, then the IWF performing the
controlling role:
i) shall encrypt media control messages sent to the participating MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
clause 13.2; and
ii) shall decrypt media control messages received from the participating MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
clause 13.2;
3\. in an on-network group call of an MCPTT group which is a constituent MCPTT
group of a temporary MCPTT group:
A) if protection of floor control messages between the IWF performing the
controlling role and the non-controlling MCPTT function is negotiated and the
SPK and the SPK-ID are configured in the IWF, then the IWF performing the
controlling role:
i) shall encrypt floor control messages sent to the non-controlling MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
clause 13.2; and
ii) shall decrypt floor control messages received from the non-controlling
MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using
SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified
in clause 13.2; and
B) if protection of media control messages between the IWF performing the
controlling role and the non-controlling MCPTT function is negotiated and the
SPK and the SPK-ID are configured in the IWF, then the IWF performing the
controlling role:
i) shall encrypt media control messages sent to the non-controlling MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
clause 13.2; and
ii) shall decrypt media control messages received from the non-controlling
MCPTT function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using
SRTP-MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified
in clause 13.2; and
4\. in an on-network private call:
A) if protection of floor control messages between the IWF performing the
controlling role and the participating MCPTT function is negotiated and the
SPK and the SPK-ID are configured in the IWF, then the IWF performing the
controlling role:
i) shall encrypt floor control messages sent to the participating MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
clause 13.2; and
ii) shall decrypt floor control messages received from the participating MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
clause 13.2; and
B) if protection of media control messages between the IWF performing the
controlling role and the participating MCPTT function is negotiated and the
SPK and the SPK-ID are configured in the IWF, then the IWF performing the
controlling role:
i) shall encrypt media control messages sent to the participating MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
clause 13.2;
ii) shall decrypt media control messages received from the participating MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
clause 13.2.
### 13.3.5 The IWF performing the non-controlling role
The IWF performing the non-controlling role:
1\. if protection of media is negotiated, shall be transparent to RTP media
streams and shall forward encrypted RTP media streams without decrypting the
payload;
2\. if protection of floor control messages between the IWF performing the
non-controlling role and the participating MCPTT function is negotiated and
the SPK and the SPK-ID are configured in the IWF, then the IWF performing the
non-controlling role:
A) shall encrypt floor control messages sent to the participating MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
clause 13.2; and
B) shall decrypt floor control messages received from the participating MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
clause 13.2;
3\. if protection of floor control messages between the IWF performing the
non-controlling role and the controlling MCPTT function is negotiated and the
SPK and the SPK-ID are configured in the IWF, then the IWF performing the non-
controlling role:
A) shall encrypt floor control messages sent to the controlling MCPTT function
according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS
and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2;
and
B) shall decrypt floor control messages received from the controlling MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
clause 13.2;
4) if protection of media control messages between the IWF performing the non-
controlling role and the participating MCPTT function is negotiated and the
SPK and the SPK-ID are configured in the IWF, then the IWF performing the non-
controlling role:
A) shall encrypt media control messages sent to the participating MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
clause 13.2; and
B) shall decrypt media control messages received from the participating MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
clause 13.2; and
5) if protection of media control messages between the IWF performing the non-
controlling role and the controlling MCPTT function is negotiated and the SPK
and the SPK-ID are configured in the IWF, then the IWF performing the non-
controlling role:
A) shall encrypt media control messages sent to the controlling MCPTT function
according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-MK, SRTP-MS
and SRTP-MKI generated using the SPK and SPK-ID as specified in clause 13.2;
and
B) shall decrypt media control messages received from the controlling MCPTT
function according to IETF RFC 3711 [16] and 3GPP TS 33.180 [18] using SRTP-
MK, SRTP-MS and SRTP-MKI generated using the SPK and SPK-ID as specified in
clause 13.2.
# 14 SDP offer/ answer procedures
## 14.1 General
The IWF shall operate per 3GPP TS 24.380 [25] clause 14.1.
## 14.2 Generating an SDP offer
The IWF shall generate an SDP offer per 3GPP TS 24.380 [25] clause 14.2.
## 14.3 Generating the SDP answer
The IWF shall generate an SDP answer per 3GPP TS 24.380 [25] clause 14.3.
## 14.4 Offeror processing of the SDP answer
The IWF shall process an SDP answer per 3GPP TS 24.380 [25] clause 14.4.
## 14.5 Modifying the media plane control channel
The IWF shall support modification of the media plane control channel per 3GPP
TS 24.380 [25] clause 14.5.
## 14.6 The use of SDP offer / answer procedures in off-network mode
The use of SDP offer / answer procedures in off-network mode is not applicable
to the IWF.
#
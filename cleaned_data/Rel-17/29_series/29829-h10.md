# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# Introduction
In the Rel-16 architecture for 5G SMSoNAS (i.e. SMS over NAS), SMSF and the
UDM are not able to expose service-based interfaces to an IP-SM-GW, SMS Router
or SMS Center, As a result, SMSoNAS transport to/from the SMSF/UDM (e.g.
towards IP-SM-GW, SMS Router, SMS Center, etc.) enabling to send MO / MT SMS
is still carried out via legacy MAP or Diameter protocols.
This generates the following main issues:
\- No SBI-based interface is defined for enabling the retrieval of routing
information from the UDM for the transfer of short messages (used by SMS-
Router, IP-SM-GW, etc.).
\- No SBI-based interface is defined for MO / MT SMS from or to IP-SM-GW/SMS
Router or any other NF that may want to send/receive SMS via interactions with
SMSF.
\- MAP and/or Diameter have to be supported by the SMSF and the UDM in order
to fully support 5G SMSoNAS. It is hence not possible to deploy a pure SBI-
based 5GC if SMS has to be supported.
\- In the roaming scenarios, MO and MT SMS cannot benefit from the new inter-
PLMN 5GC security framework based on the SEPP and the use of the secured N32
interface, relying instead on legacy MAP and/or Diameter SMS interfaces with
all the well-known security vulnerabilities.
This Technical Report aims to study the key issues and requirements for
implementing SBA/SBI paradigm and associated enhancements for 5G SMS and
potential solutions to resolve the identified issues.
# 1 Scope
The present document identifies the SMS transfer in 5G network based on
service-based interfaces, which allow SMSF and UDM to only support the SBI
based interfaces in 5GC and avoid resorting to legacy MAP and Diameter
interfaces within the PLMN and across PLMNs including roaming scenarios,
identifies the key issues that are related to support of Service-based
interfaces in 5GC, analyses potential solutions to address the key issues.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.040: \"Technical realization of the Short Message Service
(SMS)\".
[3] 3GPP TS 23.501: \"System architecture for the 5G System (5GS); Stage 2\".
[4] 3GPP TS 23.502: \"Procedures for the 5G System (5GS); Stage 2\".
[5] 3GPP TS 23.632: \"User data interworking, coexistence and migration; Stage
2\".
[6] 3GPP TS 29.540: \"5G System; SMS Services; Stage 3\".
[7] 3GPP TS 29.503: \"5G System; Unified Data Management Services; Stage 3\".
[8] 3GPP TS 24.011: \"Point-to-Point (PP) Short Message Service (SMS) support
on mobile radio interface\".
[9] 3GPP TS 29.573: \"5G System; Public Land Mobile Network (PLMN)
Interconnection; Stage 3\".
[10] 3GPP TS 29.510: \"5G System; Network Function Repository Services; Stage
3\".
# 3 Definitions of terms, symbols and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in 3GPP TR 21.905
[1] and the following apply. A term defined in the present document takes
precedence over the definition of the same term, if any, in 3GPP TR 21.905
[1].
**alert‑SC:** service element provided by a GSM/UMTS/EPS/5GS PLMN to inform an
SC which has previously initiated unsuccessful short message delivery
attempt(s) to a specific MS/UE, that the MS/UE is now recognized by the PLMN
to have recovered operation.
**Gateway MSC For Short Message Service (SMS‑GMSC):** function of an MSC
capable of receiving a short message from an SC, interrogating an HLR/HSS/UDM
for routing information and SMS info, and delivering the short message to the
VMSC/SGSN/MME/SMSF of the recipient MS/UE.
**Interworking MSC For Short Message Service (SMS‑IWMSC):** function of an MSC
capable of receiving a short message from within the PLMN and submitting it to
the recipient SC.
**IP-Short-Message-Gateway (IP-SM-GW):** function responsible for protocol
interworking between the IP-based UE and the SC.
**Service Centre (SC):** function responsible for the relaying and store and
forwarding of a short message between an SME and an MS/UE.
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
GPSI Generic Public Subscription Identifier
MO SMS Mobile Originated Short Message Service
MT SMS Mobile Terminated Short Message Service
NAS Non-Access-Stratum
NP Number Portability
NRF Network Repository Function
SBA Service Based Architecture
SBI Service Based Interface
SMS Short Message Service
SM MO Short Message Mobile Originated
SM MT Short Message Mobile Terminated
SMSF Short Message Service Function
SMSoNAS SMS over NAS
UDM Unified Data Management
# 4 Overall Requirements
In order to remove dependency of legacy MAP and Diameter interfaces from SMSF
and UDM for SMS service, following requirements shall be considered during the
study:
\- A full SBI based solution for SMS service in 5GC shall be specified;
\- Routing mechanism for SMS delivery shall be based on service-based
interfaces between 5GC and legacy SMS nodes (e.g. SMS-Router, IP-SM-GW, etc.);
\- The candidate solutions shall be applicable for roaming and non-roaming
scenarios;
\- SMS delivery for MSISDN-less terminals (e.g. CIoT terminals) shall be
supported.
# 5 Key Issues
## 5.1 Key Issue #1: \ SBI-based SM MT message transfer
This Key Issue explains modifications and enhancements needed for SBI-based SM
MT, compared to the SM MT in 3GPP TS 23.040 [2]. As showed in the figure
5.1-1, this key issue includes:
\- Fundamental procedures of SBI-based SM MT within SMS, including:
\- Procedures for SBI-based MT Message Transfer;
\- Other SM MT procedures in 3GPP TS 23.040 [2] which are infected by SBI-
based SM MT.
\- Node functionality enhancements needed for SBI-based SM MT, including:
\- Enhancements of SMS-GMSC;
\- Enhancements of SMS Router;
\- Enhancements of IP-SM-GW;
\- Enhancements of SMSF;
\- Enhancements of UDM;
\- Enhancements of NRF;
\- Enhancements of other related node functionalities.
\- Interface enhancements for SBI-based SM MT, including:
\- Interface 2: Interface between SMS-GMSC and UDM;
\- Interface 3: Interface between SMS-GMSC and SMSF;
\- Interface 3a: Interface between SMS-GMSC and SMS Router;
\- Interface 3b: Interface between SMS Router and SMSF;
\- Interface 4: Interface between SMS-GMSC and IP-SM-GW;
\- Interface 5: Interface between IP-SM-GW and SMSF;
\- Interface 6: Interface between UDM and SMS Router;
\- Interface 7: Interface between UDM and IP-SM-GW;
\- Interface between NRFs in source and target PLMNs;
\- Other related interfaces;
\- Routing rules for SM MT.
Figure 5.1-1: Message transfer architecture for SM MT
## 5.2 Key Issue #2: \ SBI-based SM MO message transfer
This Key Issue explains modifications and enhancements needed for SBI-based SM
MO, compared to the SM MO in 3GPP TS 23.040 [2]. As showed in the figure5.2-1,
this key issue includes:
\- Fundamental procedures of SBI-based SM MO within SMS, including:
\- Procedures for SBI-based MO Message Transfer;
\- Other SM MO procedures in 3GPP TS 23.040 [2] which are infected by SBI-
based SM MO;
\- Node functionality enhancements needed for SBI-based SM MO, including:
\- Enhancements of SMS-IWMSC;
\- Enhancements of SMSF;
\- Enhancements of NRF;
\- Enhancements of other related node functionalities;
\- Interface enhancements needed for SBI-based SM MO, including:
\- Interface 3: Interface between SMS-IWMSC and SMSF;
\- Interface between NRFs in source and target PLMNs;
\- Other related interfaces;
\- Routing rules for SM MO.
Figure 5.2-1: Message transfer architecture for SM MO
## 5.3 Key Issue #3: \ Mechanism to select the target PLMN based on GPSI
when using SBI
### 5.3.1 Description
Short Message Service requires routing of some signalling messages based on
the public identifier (e.g. MSISDN) of the SMS recipient.
This is the case of the interaction between the SMS-GMSC and the UDM to
retrieve the routing information (i.e. the SMSF address) for the transfer of
the Short Message to the SMSF serving the SMS recipient, where the signalling
message is normally routed based on the recipient\'s MSISDN. In case that the
SMS recipient belongs to a PLMN different from the PLMN of the SMS sender, the
signaling takes place across PLMN borders.
Those interactions requiring routing based on MSISDN are currently
accomplished using one of the existing protocols, MAP or Diameter, which can
both use MSISDN as address.
When service-based interfaces are defined between the SMS entities (SMS-
GMSC/IWMSC, SMS Router, IP-SM-GW) and the 5GC (UDM, SMSF) and the SMS entities
and the 5GC are located in different PLMNs, it is needed a mechanism to
determine the target PLMN for those SBI operations between the SMS entities
and the 5GC requiring routing based on the GPSI of the SMS recipient,
equivalent to existing routing methods based on MSISDN used in MAP or
Diameter. Current service discovery mechanisms in SBA based on GPSI, specially
discovery across PLMNs, do not include enough information to select the target
PLMN. Additionally, Number Portability aspects also need to be considered.
Hence, it is needed to define a mechanism in 5GS to select the target PLMN for
procedures involving service-based operations that require routing across
PLMNs based on GPSI as public identifier.
This key issue aims at addressing the following aspects:
\- Study mechanisms to identify the PLMN where to route messages based on the
recipient\'s GPSI for the applicable SBI operations between the SMS entities
and the 5GC.
\- Consider Number Portability aspects to select the proper PLMN where the SMS
recipient belongs to.
## 5.4 Key Issue #4: Usage of N32 for PLMN Interconnect Scenarios
### 5.4.1 Description
The current scope of the N32 protocol, as described in 3GPP TS 29.573 [9] is
limited to roaming scenarios between a SEPP in a HPLMN and a SEPP in a VPLMN.
However, there are use cases for MO/MT-SMS transfer, where the \"Subscriber
A\" (originator of the SMS) and the \"Subscriber B\" (recipient of the SMS)
might be both in their home PLMNs (i.e. not roaming). This is a case of PLMN
interconnection, and not a roaming scenario.
It shall be studied the need to expand the scope of the N32 protocol to cover
cases of PLMN Interconnect, and the implications (if any) of such protocol re-
scoping.
## 5.5 Key Issue #5: Mechanism for protocol selection
### 5.5.1 Description
When network functions involved in Short Message Service support legacy
protocols (MAP, Diameter) and SBA protocols, protocol selection logic is
needed to select the right protocol. This key issue aims at addressing the
following aspects:
\- Study protocol selection mechanisms in the SMSF (towards SMS-IWMSC for MO-
SMS)
\- Study protocol selection mechanisms in the SMS-GMSC (towards UDM/HSS/HLR
for Routing Info Retrieval)
\- Study protocol selection mechanisms in SMS-GMSC (towards SMSF for MT SMS)
# 6 Solutions
## 6.1 Solution#1: Solution for SBI-based MT SMS
### 6.1.1 Introduction
This solution is to address Key Issue #1 \"SBI-based SM MT message transfer\".
In order to remove dependency of legacy MAP and Diameter interfaces from SMSF
and UDM for SMS service, corresponding services are defined, and node
functionality enhancements are also introduced in this solution.
### 6.1.2 Successful MT SMS message transfer
A new service Nsmsf_SMSDelivery is defined, to be exposed by SMSF and
registered in NRF, in order to deliver MT SMS to SMSF, or to transfer the MO
SMS Delivery Report to SMSF, as depicted in Figure 6.1.2-1.
Figure 6.1.2-1 MT SMS Delivery or MO SMS Delivery Report via the
Nsmsf_SMSDelivery service
Another new service Nrouter_SMSDelivery is defined, to be exposed by SMS
Router and registered in NRF, in order to enable the transfer of MT SMS
Delivery to SMS Router, as depicted in Figure 6.1.2-2.
Figure 6.1.2-2 MT SMS Delivery via the Nrouter_SMSDelivery service
Another new service Nrouter_SMSSubmit is defined, to be exposed by SMS Router
and registered in NRF, in order to enable the transfer of MT SMS Delivery
Report to SMS Router, as depicted in Figure 6.1.2-3.
Figure 6.1.2-3 MT SMS Delivery Report via the Nrouter_SMSSubmit service
Another new service Nudm_SmsRoutingInfo is defined, to be exposed by UDM and
registered in NRF, in order to enable NF service consumer to get routing
information from UDM, as depicted in Figure 6.1.2-4.
Figure 6.1.2-4 Routing information offered by the Nudm_SmsRoutingInfo service
Another new service Nrouter_SmsRoutingInfo is defined, to be exposed by SMS-
Router and registered in NRF, in order to enable NF service consumer to get
routing information from SMS Router, as depicted in Figure 6.1.2-5.
Figure 6.1.2-5 Routing information offered by the Nrouter_SmsRoutingInfo
service
Another new service Nudm_SmDeliveryReportStatus is defined, to be exposed by
UDM and registered in NRF, in order to enable the update of MT SMS Delivery
Report Status to UDM, as depicted in Figure 6.1.2-6.
Figure 6.1.2-6 MT SMS Delivery Report status update via the
Nudm_SmDeliveryReportStatus
The procedure for successful SBI-based MT SMS message transfer is showed in
Figure 6.1.2-7 and Figure 6.1.2-8, which is based on MT SMS procedures in 3GPP
TS 23.040 [2] clause 10. Compared to procedures in 3GPP TS 23.040 [2], service
providers register services in NRF, including:
\- Nudm_SmsRoutingInfo service provided by UDM.
\- Nrouter_SmsRoutingInfo service provided by SMS Router.
\- Nrouter_SMSSubmit service provided by SMS Router.
\- Nrouter_SMSDelivery service provided by SMS Router.
\- Nsmsf_SMSDelivery service provided by SMSF.
\- Nsc_SMSSubmit service provided by SMS-GMSC (as defined in Solution#2
TR29.829).
At the same time, service consumers discover services from NRF, including:
\- SMS-GMSC discovers Nudm_SmsRoutingInfo service from NRF.
\- SMS-GMSC discovers Nrouter_SmsRoutingInfo service from NRF.
\- SMS-GMSC discovers Nsmsf_SMSDelivery service from NRF.
\- SMS-GMSC discovers Nrouter_SMSDelivery service from NRF.
\- SMS Router discovers Nudm_SmsRoutingInfo service from NRF.
\- SMS Router discovers Nsmsf_SMSDelivery service from NRF.
\- SMS Router discovers Nsc_SMSSubmit service from NRF.
\- UDM discovers Nrouter_SmsRoutingInfo service from NRF.
\- SMSF discovers Nrouter_SMSSubmit service from NRF.
\- SMSF discovers Nsc_SMSSubmit service from NRF.
Figure 6.1.2-7: Procedures for successful SBI-based MT SMS message transfer
(with SMS Router)
0 SMSF registers Nsmsf_SMSDelivery service in NRF, UDM registers
Nudm_SmsRoutingInfo and Nudm_SmDeliveryReportStatus service in NRF, SMS-GMSC
registers Nsc_SMSSubmit service in NRF, SMS Router registers
Nrouter_SmsRoutingInfo service, Nrouter_SMSSubmit service and
Nrouter_SMSDelivery service in NRF.
1 Message Transfer from SC to SMS-GMSC.
If SMS-GMSC has retrieved and stored Routing Information of this UE during the
former MT SMS deliveries, or if Routing Information for the UE has been
preconfigured in SMS-GMSC, steps 2a-2o and step 3 can be skipped.
2a-2f Alternative 1: the SMS-GMSC discovers and selects Nudm_SmsRoutingInfo to
retrieve the routing information of the UE to be able to send the MT SM from
UDM. The UDM discovers and selects Nrouter_SmsRoutingInfo to retrieve the
address of the SMS Router to receive the MT SM, the UDM also provides the SMSF
instance to the SMS Router. Then the SMS Router provides its address to the
UDM to receive the MT SM. UDM provides the received address to the SMS-GMSC.
2g-2o Alternative 2: the SMS-GMSC discovers and selects Nudm_SmsRoutingInfo to
retrieve the routing information of the UE to be able to send the MT SM from
UDM. The UDM responses the message with 3xx redirection, the URI of the SMS
Router is included location header. After that, SMS-GMSC discovers and selects
Nrouter_SmsRoutingInfo to retrieve the address of the SMS Router to receive
the MT SM, and the SMS Router queries the UDM by invoking the
Nudm_SmsRoutingInfo to retrieve the SMSF instance. The SMS Router/IP-SM-GW
provides address to the SMS-GMSC to receive the MT SM.
3 SMS-GMSC discovers Nrouter_SMSDelivery service from NRF.
4 SMS-GMSC to SMS Router: Nrouter_SMSDelivery service request, and MT SMS
message transfer.
5 SMS Router to SMS-GMSC: Nrouter_SMSDelivery service resoponse.
6 SMS Router discovers Nsmsf_SMSDelivery service from NRF.
7 SMS Router to SMSF: Nsmsf_SMSDelivery service request, and MT SMS message
transfer.
8 SMSF to SMS Router: Nsmsf_SMSDelivery service resoponse.
9 SMSF transfers message to UE.
10 SMSF to SMS Router: Nrouter_SMSSubmit service request, and transfer MT SMS
Delivery Report.
11 SMS Router to SMSF: Nrouter_SMSSubmit service response.
12 SMS Router to SMS-GMSC: Nsc_SMSSubmit service request, and transfer MT SMS
Delivery Report.
13 SMS-GMSC to SMS Router: Nsc_SMSSubmit service response.
14 SMS-GMSC updates SM-Delivery Report Status to UDM by invoking
Nudm_SmDeliveryReportStatus.
15 UDM responses SM-Delivery Report Status update to SMS-GMSC.
16 SMS-GMSC sends Delivery Report to SC.
Figure 6.1.2-8: Procedures for successful SBI-based MT SMS message transfer
(without SMS Router)
0 SMSF registers Nsmsf_SMSDelivery service in NRF, UDM registers
Nudm_SmsRoutingInfo and Nudm_SmDeliveryReportStatus service in NRF, SMS-GMSC
registers Nsc_SMSSubmit service in NRF.
If SMS-GMSC has retrieved and stored Routing Information of this UE during the
former MT SMS deliveries, or if Routing Information for the UE has been
preconfigured in SMS-GMSC, steps 2-5 can be skipped.
1 Message Transfer from SC to SMS-GMSC.
2 SMS-GMSC discovers and chooses Nudm_SmsRoutingInfo service from NRF.
3 SMS-GMSC to UDM: Nudm_SmsRoutingInfo service request.
4 UDM to SMS-GMSC: Nudm_SmsRoutingInfo service response.
5 SMS-GMSC discovers and chooses Nsmsf_SMSDelivery service from NRF.
6 SMS-GMSC to SMSF: Nsmsf_SMSDelivery service request, and forwards short
message to SMSF directly.
7 SMSF to SMS-GMSC: Nsmsf_SMSDelivery service response.
8 SMSF transfers message to UE.
9 SMSF discovers and chooses Nsc_SMSSubmit service from NRF
10 SMSF to SMS-GMSC: Nsc_SMSSubmit service request, and transfer MT SMS
Delivery Report.
11 SMS-GMSC to SMSF: Nsc_SMSSubmit service response.
12 SMS-GMSC updates SM-Delivery Report Status to UDM by invoking
Nudm_SmDeliveryReportStatus.
13 UDM responses SM-Delivery Report Status update to SMS-GMSC.
14 SMS-GMSC sends Delivery Report to SC.
Note: Nsc_SMSSubmit service for MT SMS Delivery Report is defined in
Solution#2 TR29.829.
SMS-GMSC selects UDM based on the GPSI of the UE, and UDM can choose the right
SMS route information based on the GPSI.
For the inter PLMN case, NF service provider registers corresponding services
in the NRF of the PLMN where it is located, and NF service consumer discovers
and invokes inter-PLMN services following the procedures in clause 5.2.2 of
3GPP TS 29.510 [10] and solution#3 in TR 29.829.
### 6.1.3 Unsuccessful MT SMS message transfer
Figure 6.1.3-1 Example of MT SMS delivery via the Nsmsf_SMSDelivery service
2b. If MT SMS delivery fails at the SMSF (e.g. the SUPI is unknown to the SMSF
in the request body), the SMSF shall return an HTTP \"400 Bad Request\" status
code with the ProblemDetails IE providing details of the error.
If MT SMS delivery fails at the SMSF due to SMSF internal errors, the SMSF
shall return an HTTP \"500 Internal Server Error\" status code with the
ProblemDetails IE providing details of the error.
The procedures defined in clause 4.13.3.9 of 3GPP TS 23.502 [4] and in TS
23.040 [2] shall then apply.
### 6.1.4 Alert SC message transfer
This solution proposes the definition of a new service Nsc_AlertSC, to be
exposed by the SMS-IWMSC, in order to be alerted by the UDM when the UE is
reachable for SMS (e.g. UE has responded to a paging request), when a delivery
attempt has failed because the MS is not reachable or the MS memory capacity
was exceeded. Consequently, The SC then may on reception of an Alert‑SC ‑
initiate a new delivery attempt procedure for the queued messages destined for
this MS.
Figure 6.1.4-1 Alert SC via Nsmsc_AlertSC service
### 6.1.5 Impacts on services, entities and interfaces
SMS-GMSC:
\- Support to discover Nudm_SmsRoutingInfo service from NRF.
\- Support to discover Nrouter_SmsRoutingInfo service from NRF.
\- Support to discover Nsmsf_SMSDelivery service from NRF.
\- Support to discover Nrouter_SMSDelivery service from NRF.
\- Support to discover Nudm_SmDeliveryReportStatus service from NRF.
\- Support to register Nsc_SMSSubmitt service in NRF.
\- Support SBI interface to UDM, SMSF and SMS Router.
\- Support to act as protocol converter between MAP/Diameter and SBI towards
SMSF or SMS Router.
UDM:
**-** Support to discover _Nrouter_SmsRoutingInfo service_ from NRF.
**-** Support to register _Nudm_SmsRoutingInfo service_ in NRF.
**-** Support to register Nudm_SmDeliveryReportStatus _service_ in NRF.
_-_ _Support SBI interfaces to SMS-GMSC and SMS Router._
SMS Router:
\- Support to discover Nsmsf_SMSDelivery service from NRF.
**-** Support to discover _Nudm_SmsRoutingInfo service_ in NRF.
**-** Support to discover _Nsc_SMSSubmitt service_ in NRF.
**-** Support to register Nrouter_SmsRoutingInfo service in NRF.
**-** Support to register Nrouter_SMSSubmit service in NRF.
**-** Support to register Nrouter_SMSDelivery service in NRF.
\- Support SBI interfaces to UDM, SMSF and SMS-GMSC.
SMSF:
\- Support to discover Nrouter_SMSSubmit service from NRF.
\- Support to discover Nsc_SMSSubmit service from NRF.
\- Support to register _Nsmsf_SMSDelivery service_ in NRF.
_-_ _Support SBI interfaces to SMS-GMSC and SMS Router._
NRF:
\- Support registration and discovery of the new defined services in this
solution.
## 6.2 Solution#2: Solution for SBI-based MO SMS
### 6.2.1 Introduction
This solution is to address Key Issue #2 \"SBI-based SM MO message transfer\".
In order to remove dependency of legacy MAP and Diameter interfaces from SMSF
and UDM for SMS service, corresponding services are defined, and node
functionality enhancements are also introduced in this solution.
This solution also considers message transfer for MSISDN-less MO SMS.
### 6.2.2 Successful MO SMS message transfer
A new service Nsc_SMSSubmit is defined, to be exposed by SMS-IWMSC/SMS-GMSC
and registered in NRF, in order to submit the MO SMS to SMS-IWMSC/SMS-GMSC, or
to transfer the MT SMS Delivery Report to SMS-GMSC.
Figure 6.2.2-1 MO SMS Submit or MT SMS Delivery Report via the Nsc_SMSSubmit
service
The procedure for successful SBI-based MO SMS message submit and MT SMS
Delivery Report is showed in Figure 6.2.2-2, which is based on SMS procedures
in 3GPP TS 23.040 [2] clause 10.2. Compared to procedures in 3GPP TS 23.040
[2], service providers register services in NRF, including:
\- _Nsc_SMSSubmit_ service provided by SMS-IWMSC/SMS-GMSC.
\- Nsmsf_SMSDelivery service provided by SMSF (as defined in Solution#1
TR29.829).
At the same time, service consumers discover services from NRF, including:
\- SMSF discovers Nsc_SMSSubmit service from NRF.
\- SMS-IWMSC discovers Nsmsf_SMSDelivery service from NRF.
Figure 6.2.2-2: Procedures for successful SBI-based SM MO message transfer
0 SMS-IWMSC registers Nsc_SMSSubmit service in NRF, SMSF registers
Nsmsf_SMSDelivery service in NRF.
1 Message Transfer from UE to SMSF through AMF.
2 SMSF discovers and chooses Nsc_SMSSubmit service for MO SMS submit from NRF.
3 SMSF to SMS-IWMSC: Nsc_SMSSubmit service request, and forwards MO SMS to
SMS-IWMSC.
4 SMS-IWMSC to SMSF: Nsc_SMSSubmit service response.
5 SMS-IWMSC transfers message to SC.
6 Delivery Report from SC to SMS-IWMSC.
7 SMS-IWMSC discovers and chooses Nsmsf_SMSDelivery service for MO SMS
Delivery Report from NRF.
8 SMS-IWMSC to SMSF: Nsmsf_SMSDelivery service request, and transfer MO SMS
Delivery Report.
9 SMSF to SMS-IWMSC: Nsmsf_SMSDelivery service response.
10 Delivery Report from SMSF to UE.
Note: Nsmsf_SMSDelivery service for MO SMS Delivery Report is defined in
Solution#1 TR29.829.
SMSF can choose the right SMS-IWMSC base on SUPI/SUCI of the UE, if SMS-IWMSC
locates in a different PLMN, SMSF can find the right SMS-IWMSC through vNRF
and hNRF.
For the inter PLMN case, NF service provider registers corresponding services
in the NRF of the PLMN where it is located, and NF service consumer discovers
and invokes inter-PLMN services following the procedures in clause 5.2.2 of
3GPP TS 29.510 [10] and solution#3 in TR 29.829.
### 6.2.3 Unsuccessful MO SMS message transfer
Figure 6.2.2-1 MO SMS Submit via the Nsc_SMSSubmit service
2b. If MO SMS submit fails at the SC/SMS-IWMSC (e.g. the GPSI is unknown to
the SC/SMS-IWMSC in the request body), the SC/SMS-IWMSC shall return an HTTP
\"403 Forbidden\" status code with the ProblemDetails IE providing details of
the error.
If MO SMS submit fails at the SC/SMS-IWMSC due to SC/SMS-IWMSC internal
errors, the SC/SMS-IWMSC shall return an HTTP \"500 Internal Server Error\"
status code with the ProblemDetails IE providing details of the error.
The procedures defined in TS 23.040 [2] shall then apply.
### 6.2.4 MSISDN-less MO SMS message transfer
A new service Nnef_SMService_MoForwardSm is defined, to be exposed by NEF and
registered in NRF, in order to submit the MO SMS to AF.
Figure 6.2.4-1 MSISDN-less MO SMS Submit via the Nnef_SMService_MoForwardSm
service
The procedure for SBI-based MSISDN-less MO SMS message transfer is showed in
Figure 6.2.4-2, which is based on MSISDN-less MO SMS procedure via Nnef in
3GPP TS 23.502 [4] clause 4.13.7.2. Compared to procedures in 3GPP TS 23.502
[4], service providers register services in NRF, including:
\- Nnef_SMService_MoForwardSm service provided by NEF.
At the same time, service consumers discover services from NRF, including:
\- SMS-SC discovers Nnef_SMService_MoForwardSm service from NRF.
Figure 6.2.4-2: Procedures for MSISDN-less MO SMS message transfer
0 NEF registers Nnef_SMService_MoForwardSm service in NRF, during the NF
registration procedure.
1 MO SMS transmit from UE to SMS-SC, as already defined in clause 6.2.2.
2a-2b SMS-SC discovers and chooses Nnef_SMService_MoForwardSm service for
MSISDN-less MO SMS submit from NRF.
3 SMS-SC forwards MO SM to NEF, by invoking Nnef_SMService_MoForwardSm
service.
4-5 Nudm_SDM_Get and response between NEF and UDM, which refers to Step3-Step4
of Figure 4.13.7.2-1 in TS 23.502 [4].
6 The NEF provides a Nnef_MSISDN-less_MO_SMSNotify, which refers to Step5 of
Figure 4.13.7.2-1 in TS 23.502 [4].
7 NEF sends Nnef_SMService_MoForwardSm response to SMS-SC, carrying a success
or failure delivery indication to SMS-SC.
8 SMS-SC indicates success/failure back to UE using existing SBI-based SMS
delivery report defined in clause 6.2.2.
### 6.2.5 Impacts on services, entities and interfaces
SMS-IWMSC:
\- Support to register Nsc_SMSSubmit service in NRF.
\- Support to discover Nsmsf_SMSDelivery service from NRF.
\- Support SBI interface to SMSF.
\- Support to act as protocol converter between SBI and MAP/Diameter towards
SC.
SMSF:
\- Support to register Nsmsf_SMSDelivery service from NRF.
\- Support to discover Nsc_SMSSubmit service from NRF.
_\- Support SBI interfaces to SMS-IWMSC._
NEF
\- Support to register Nnef_SMService_MoForwardSm service in NRF.
SMS-SC
\- Support to discover Nnef_SMService_MoForwardSm service from NRF.
NRF:
\- Support registration and discovery of the newly defined services in this
solution.
## 6.3 Solution #3: Mechanism to select the target PLMN based on GPSI using
NRF
### 6.3.1 Introduction
This solution addresses Key Issue #3 (\"Mechanism to select the target PLMN
based on GPSI when using SBI\") and Key Issue #5 (\"Mechanism for protocol
selection\") for protocol selection in the SMS-GMSC.
Short Message Service requires routing of some signalling messages based on
the public identifier (e.g. MSISDN) of the SMS recipient. In case that the SMS
recipient belongs to a PLMN different from the PLMN of the SMS sender, the
signaling takes place across PLMN borders.
Current service discovery mechanisms in SBA based on GPSI do not include
information to select the target PLMN. This solution provides a mechanism when
using service-based interfaces to select the target PLMN based on GPSI by
enhancing the discovery and selection procedures using NRF and leveraging on
the support of the existing DNS/ENUM and Number Portability services, if
applicable, determining the target PLMN and whether SBI or legacy interfaces
(e.g. MAP/Diameter) can be used. The proposal considers the selection of the
target PLMN when the GPSI is an MSDIDN.
NOTE: It is assumed that an External Identifier belongs to the home PLMN and
hence it is not required to determine the target PLMN when the GPSI is an
External Identifier.
While the solution is addressing the need for a new mechanism to select the
target PLMN for those interactions between the SMS entities and the 5GC
requiring routing based on the GPSI of the SMS recipient, it could be
applicable to any potential use case and procedure requiring selection of the
target PLMN based on GPSI in 5GS.
### 6.3.2 Description
The description of the solution is illustrated using the interaction between
SMS-GMSC and UDM for MT SMS delivery in 5GC, i.e. a mechanism for the SMS-
GMSC, acting as NF service consumer, to retrieve routing information from UDM
in the target PLMN, acting as NF service producer, when service-based
interfaces are used between the SMS entities and 5GC.
The solution proposes to select the target PLMN based on MSISDN using the
discovery procedure with NRF according to the following:
\- The NF consumer (e.g. SMS-GMSC) located in the PLMN of subscriber A (SMS
sender) performs discovery of the target NF/NF service instance(s) (e.g. UDM)
invoking the local NRF in the same PLMN (referred as local PLMN hereinafter).
The discovery request is based on the MSISDN of subscriber B (SMS recipient),
which is the only known recipient\'s identity, and includes an optional
indication for the NRF to determine the target PLMN and interface to be used.
\- The local NRF can determine the target PLMN and the interface to be used
(SBI or legacy interface) performing an ENUM query, unless such information is
available by other means, e.g. locally configured in the NRF.
\- An ENUM record for the full MSISDN or number series provisioned in the
DNS/ENUM server can be used to indicate whether the user belongs to the local
PLMN or another PLMN in the same or different country. The output of the
lookup process using DNS/ENUM can be a URI that is provided in the ENUM
response and points to the NRF in the target PLMN with which there is an
interconnection agreement using SBI, so that the local NRF can send an inter-
PLMN service discovery request to the target PLMN. An existing Enumservice
type/subtype (e.g. \"web:http\") registered in IANA may be reused or new
one(s) may be specified to be used for 5GC/SBA.
\- Absence of an ENUM record can imply to use a non-SBI interaction and hence
a legacy interface should be used for the next operation request in the
procedure (e.g. a MAP operation from SMS-GMSC towards HLR to retrieve routing
information for SMS). This may be the case when the HSS/HLR is deployed in the
target PLMN interworking with the UDM via UDICOM interface for SMS procedures,
or there is no SBI interconnection with the target PLMN. An ENUM record
containing an existing Enumservice type/subtype (e.g. pstn:tel) may be used as
well to indicate that a non-SBI interface should be used.
\- If Number Portability (NP) service is required, the DNS/ENUM server can
perform an NP query for national MSISDN number series according to the
existing procedures. The answer from the NP service includes information about
the target PLMN, e.g. the Routing Number (RN) assigned to the network operator
owning that specific MSISDN, based on IETF RFC 4694 and local regulation in
each country. The information provided by the NP service is included in the
ENUM response for the local NRF to determine the target PLMN.
\- If NP is not required, the NRF can determine the target PLMN and the
interface to be used (SBI or legacy interface) based on local configuration,
instead of performing an ENUM query. If the NRF keeps local configuration of
the MSISDN ranges or list of individual MSISDNs owned by the local PLMN, this
information would need to be updated every time an MSISDN is added or removed
to the list/ranges belonging to the PLMN. Additionally, the configuration may
include information to determine the target PLMN for MSISDNs not belonging to
the local PLMN.
\- The ENUM response may then include one of the following:
\- A URI pointing to the NRF of the target PLMN.
\- If NP is applicable, a RN associated to the network operator the MSISDN
belongs to.
\- No record found for the MSISDN (or alternatively an ENUM record containing
a specific Enumservice type/subtype), implying that SBI interactions should
not be used.
\- Based on ENUM response or local configuration, the local NRF performs the
following actions:
\- If the response contains information from NP such as RN, the local NRF uses
the received information to determine the target PLMN (e.g. mapping the RN to
PLMN ID).
\- If the user belongs to the local PLMN, the local NRF searches for NF/NF
service instances (e.g. UDM instances) matching the discovery criteria that
can serve the request using SBI interactions.
\- If the user belongs to a different PLMN, based on the URI received in the
ENUM response pointing to the NRF in the target PLMN or based on the PLMN ID
obtained from the NP information or based on local configuration, the local
NRF sends a discovery request across PLMNs, interacting with the NRF in the
target PLMN to retrieve the NF/NF service instance(s) that matches the
discovery criteria.
\- The local NRF may receive in the inter-PLMN discovery response one of the
following:
\- NF/NF service instance(s) matching the discovery criteria in the target
PLMN.
\- The PLMN ID of the target PLMN as a result of ENUM and NP query in a
transit PLMN, if applicable. The local NRF will then send an inter-PLMN
discovery request to the NRF in the target PLMN if there is an interconnection
agreement based on SBI.
\- No NF instance(s) found in the target PLMN, implying that SBI interactions
should not be used.
\- The same behaviour described for the local NRF applies to the NRF in the
target and transit PLMN.
\- If the local NRF finds NF/NF service instances for the MSISDN in the local
PLMN or receives NF instances from the NRF in the target PLMN, the local NRF
provides the NF instances in the discovery response for the NF consumer to
send the next operation request in the procedure using SBI.
\- Otherwise, i.e. if there are not NF instances available that can serve the
request, the local NRF provides the discovery response indicating the consumer
NF to use a legacy interface for the next operation request in the procedure.
\- Based on discovery response from the local NRF, the NF service consumer
(e.g. SMS-GMSC) sends the operation request using SBI to the NF service
producer (e.g. UDM) or via legacy interface (e.g. MAP request to the HLR).
### 6.3.3 Procedures
The following clauses illustrates the procedure to determine the target PLMN
and the interface to be used for different scenarios depending on the PLMN the
SMS recipient\'s MSISDN belongs to and NP requirement.
#### 6.3.3.1 Scenario 1: Selection of target PLMN based on MSISDN belonging to
local PLMN
Figure 6.3.3.1 shows the procedure to select the target PLMN when the local
NRF performs ENUM query and the MSISDN belongs to the local PLMN, i.e. the
same PLMN of the NF service consumer (e.g. SMS-GMSC).
The discovery request to the local NRF (step 2) includes the optional
indication for the NRF to determine the target PLMN and interface to be used.
In this case, when the ENUM response indicates to the local NRF that the
MSISDN belongs to the local PLMN and SBI can be used, the local NRF performs a
local search of NF instances that are provided in the discovery response
(steps 4a-7a).
Figure 6.3.3.1 Selection of target PLMN based on MSISDN belonging to the local
PLMN
#### 6.3.3.2 Scenario 2: Selection of target PLMN based on MSISDN belonging to
a different PLMN with NP
Figure 6.3.3.2 shows the procedure to select the target PLMN when the MSISDN
belongs to a different PLMN from the PLMN of the NF service consumer (e.g.
SMS-GMSC), and Number Portability service is applicable.
In this case, the DNS/ENUM server is configured to perform an NP query and the
response is used by the local NRF to obtain the target PLMN ID (steps 4-8).
After the inter-PLMN discovery request, which includes the optional indication
to determine the interface and the indication that NP service has already been
invoked, the target PLMN determines the interface to be used (steps 9a-13a).
Figure 6.3.3.2 Selection of target PLMN based on MSISDN belonging to a
different PLMN with NP
#### 6.3.3.3 Scenario 3: Selection of target PLMN based on MSISDN belonging to
a different PLMN without NP
Figure 6.3.3.3 shows the procedure to select the target PLMN when the NRF
performs ENUM query, the MSISDN belongs to a different PLMN from the PLMN of
the NF service consumer (e.g. SMS-GMSC), and Number Portability service is not
applicable. This is the case of a target PLMN in a different country or in the
same country where NP is not required.
In this case, the ENUM response indicates to the local NRF that the MSISDN
belongs to a different PLMN including a URI pointing to the NRF in the target
PLMN (step 4a). After the inter-PLMN discovery request including the optional
indication, the target PLMN determines the interface to be used (steps
6a-10a).
Figure 6.3.3.3 Selection of target PLMN based on MSISDN belonging to a
different PLMN without NP
#### 6.3.3.4 Scenario 4: Selection of target PLMN based on MSISDN belonging to
a different PLMN via transit PLMN
Figure 6.3.3.4 shows the procedure to select the target PLMN when the MSISDN
belongs to a different PLMN from the PLMN of the NF service consumer (e.g.
SMS-GMSC), and the target PLMN is determined via a transit PLMN. This may be
the case of a target PLMN in a different country where NP query is required
and performed in a transit PLMN.
In this case, the ENUM response indicates to the local NRF that the MSISDN
belongs to a different PLMN including a URI pointing to the NRF in the transit
PLMN (step 4). After the inter-PLMN discovery request including the optional
indication, the NRF in the transit PLMN performs ENUM and subsequent NP
queries, maps the information received to the target PLMN ID and includes the
target PLMN ID in the inter-PLMN discovery response (steps 7-10), so that the
local NRF can check whether SBI interconnection exists between local and
target PLMNs.
Figure 6.3.3.4 Selection of target PLMN based on MSISDN belonging to a
different PLMN via transit PLMN
### 6.3.4 Impacts on services, entities and interfaces
SMS-GMSC:
\- Support service discovery request based on GPSI using NRF, including the
indication to determine the target PLMN and interface to be used for the next
operation in the procedure.
\- Support SBI interface to UDM.
NRF:
\- Support service discovery request based on GPSI including the indication to
determine the target PLMN and interface to be used for the next operation in
the procedure.
\- Support ENUM query, including information provided by NP service.
\- Determine target PLMN and interface to be used based on information
received from ENUM/NP, or the inter-PLMN discovery response or local
configuration.
ENUM:
\- Existing Enumservice type/subtype may be reused or new one(s) may be
specified to be used for 5GC/SBA.
## 6.4 Solution#4: MT SM transfer
### 6.4.1 Introduction
This solution is to address Key Issue #1 \"SBI-based SM MT message transfer\".
Introduce the solution for successful SM MT message transfer based on SBI in
5GC.
Figure 6.4.1-1 (copied from TS 3GPP 23.502 [4] clause 4.13.3.6) below is the
baseline procedure of MT SM over NAS from TS 3GPP 23.502 [4]. We can observe
that the interfaces between SMSF and SMS-GMSC, SMS-GMSC and UDM are still
based on legacy protocol. This solution targets to provide the new SBI-based
interfaces between the SMSF and the SMS-GMSC, the SMS-GMSC and the UDM, and
route based on SBI for successful MT SM transfer including transfer of MT SM
and transfer of the report for MT SM.
Figure 6.4.1-1: MT SM over NAS in CM_IDLE state via 3GPP access
### 6.4.2 Transfer of MT SM based on SBI
On the path to transfer MT SM, the SMSF needs add the new service or service
operation based on SBI which SMS-GMSC shall invoke to deliver the MT SM to the
SMSF. The SMSF has already provided SBI-based service Nsmsf_SMService to
activate/deactivate the SMS service and to send uplink SMS for UE, a new
service operation DownlinkSMS shall add in this service in order to send the
downlink SM to the UE, and this service operation is defined in the Figure
6.4.2-1 below.
Figure 6.4.2-1: Send MT SM payload in downlink direction
1\. The NF Service Consumer (e.g. SMS-SGMS) shall send a POST request to the
resource representing the UEContext (i.e. .../ue-contexts/{supi}/sendsms-dl)
of the SMSF. The payload body of the POST request shall contain the SMS record
to be sent, Service Centre address, _callbackURI,_ and optionally contains SM
Delivery Timer and SM Delivery Start Time if the UE is using extended idle
mode DRX.
2a. On success, \"200 OK\" shall be returned with \"SmsRecordDeliveryDataDl\"
object in the response body, the payload body of the POST response shall
contain the status of SMS record delivery attempts at the SMSF.
2b. On success, \"202 Accepted\" shall be returned to indicate that the
sending request has been accepted and MT SM record has been buffered in SMSF
if the UE is using extended idle mode DRX and the UE is expected to respond to
paging shortly or within the time frame indicated by the SM Delivery Timer and
SM Delivery Start Time in request body, and the SMSF should reattempt to
deliver the short message to the UE within this time frame.
2c. On failure or redirection, the appropriate HTTP status code (e.g. \"403
Forbidden\") indicating the error shall be returned.
### 6.4.3 Routing MT SM based on SBI
Before SMS-GMSC sends the MT SM to serving SMSF, SMS-GMSC need to get the
address or FQDN of serving SMSF node for UE. In order to get address or FQDN
of serving SMSF node for UE, SMS-GMSC discovers and selects the UDM that
manages the user subscriptions first, and then queries the serving SMSF node
for UE from the selected UDM, finally SMS-GMSC invokes the Nnrf_NFDiscovery
Service to get the address or FQDN of serving SMSF node for UE, the basic
procedure is shown in Figure 6.4.3-1 below.
Figure 6.4.3-1: Routing MT SM in downlink direction
_0\. UDM registers the NF profile an NF service profiles including the
supported SUPI ranges and/or GPSI ranges in the NRF. And SMSF also registers
NF profile an NF service profiles including IP addresses and/or FQDNs of the
NF in the NRF._
_1\. SC send the MT SM to SMS-GMSC._
_2\. SMS-GMSC invokes the Nnrf_NFDiscovery_NFDiscovery to get the UDM instance
that manages the user subscriptions using the GPSI/SUPI._
_3\. SMS-GMSC invokes Nudm_SmsRoutingInfo_Get to get the serving SMSF instance
for UE from the selected UDM._
_4\. SMS-GMSC invokes the Nnrf_NFDiscovery_NFDiscovery to get the IP addresses
or FQDNs of the serving SMSF for UE._
_5\. SMS-GMSC sends the MT SM records to the SMSF._
Based on the solution above, the existing 5GC system need to be enhanced as
below:
\- NRF is enhanced to support SMSF register and discover.
\- SMSF is enhanced to register itself in the NRF.
\- UDM is enhanced to support SMS-GMSC invokes Nudm_SmsRoutingInfo_Get to get
the serving routing information for SM for UE.
### 6.4.4 Transfer of Report to MT SM based on SBI
SMSF sends the report to MT SM using notification mechanism, callbackURI is
carried in the request message of service operation DownlinkSMS (see the
definition of the service operation in clause 6.z.2) when SMS-GMSC sends the
MT SM to SMSF. SMSF adds Nsmsf_SMService ReportNotify service operation to
notify SMS-GMSC the report using the previously received callbackURI. The
Figure 6.4.4-1below shows the service operation of notification.
Figure 6.4.4-1: Notify the Report to MT SM
1\. The SMSF sends a POST request to the callbackURI as provided by the NF
service consumer (e.g. SMS-GMSC) during Sending MT SM payload. The request
body shall contain the Report data to original MT SM.
2\. The NF service consumer responds with \"204 No Content\".
### 6.4.5 Impacts on services, entities and interfaces
SMSF：
\- Support new Nsmsf_SMService DownlinkSMS service operation
\- Support registering the SMSF NF profile and SMSF NF service profile in NRF
\- Support new Nsmsf_SMService ReportNotify service operation
SMS-GMSC:
\- Support invoking Nnrf_NFDiscovery to discover UDM using the User\'s
identifier and Select the UDM
\- Support invoking Nudm__SmsRoutingInfo_ _Get to get the serving routing
information for SMS and then invoking Nnrf_NFDiscovery to get the IP addresses
or FQDNs of serving SMSF
\- Support invoking Nsmsf_SMService DownlinkSMS to send MT SM
\- Support receiving Nsmsf_SMService ReportNotify serivice operation
UDM:
\- Support Nudm_ _SmsRoutingInfo_ service to provide routing information for
SMS.
NRF
\- Support the registration and discovery of SMSF NF profile and NF service
profile.
## 6.5 Solution#5: MO SM transfer
### 6.5.1 Introduction
This solution is to address Key Issue #2 \"SBI-based SM MO message transfer\".
Introduce the solution for successful SM MO message transfer based on SBI in
5GC.
Figure 6.5.1-1 (from 3GPP TS 23.502 [4] clause 4.13.3.3) below is the baseline
procedure for MO SM over NAS in 3GPP TS 23.502 [4]. We can observe that the
interfaces between the SMSF and the SMS-IWMSC, the SMS-IWMSC and the UDM are
still based on legacy protocol. This solution targets to provide the new SBI-
based interfaces between the SMSF and the SMS-IWMSC, the SMS-IWMSC and the
UDM, and route based on SBI for successful MO SM transfer including transfer
of MO SM message and the transfer of the report of MO SM.
Figure 6.5.1-1: MO SM over NAS
This solution will cover the scenarios below:
\- The requirement of that the SMSF gets the routing information to SMS-IWMSC
based on SBI needs be addressed
\- MO SM transfer between SMSF and SMS-IWMSC based on SBI
\- MO SM report transfer between SMSF and SMS-IWMSC based on SBI
### 6.5.2 SMS-IWMSC Discovery and Selection
More than one SMS-IWMSC may be deployed in the HPLMN (in the operator\'s
network), and these SMS-IWMSCs may be deployed based on the serving location,
or based on the serving UE identity ranges (e.g. SUPI ranges, GPSI ranges
etc.), or based on the connected E.164 address of the SC. The SMS-IWMSC
registers the routing information with other NF or NF service information
together in the NRF according to the specific deployment. The SMSF queries the
NRF to get the routing information related to the SMS-IWMSC instance or the
SMS-IWMSC service instance.
For supporting different deployments of the SMS-IWMSC instances, the following
factors may be registered in NRF in order to support discovery of the SMS-
IWMSC instances or the SMS-IWMSC service instances by the SMSF according to
the discovery solution mentioned in this clause:
\- supported SUPI ranges.
\- supported GPSI ranges
\- supported location (e.g. TAIs, CGIs, etc.)
\- supported E.164 address of the SC
Accordingly the following factors shall be supported as query parameters for
discovering the proper SMS-IWMSC instances or SMS-IWMSC by the SMSF.
\- SUPI
\- GPSI
\- Location of UE (e.g. TAIs, or CGIs etc.).
\- E.164 address of the SC
The IP addresses or FQDN of the SMS-IWMSC instances or the SMS-IWMSC service
instances should be returned to the SMSF, and the SMSF shall route the MO SM
to the SMS-IWMSC instances or SMS-IWMSC service instances based on the IP
addresses or FQDN of the SMS-IWMSC instances or SMS-IWMSC service instances.
### 6.5.3 Transfer of MO SM based on SBI
The SMSF has already provided the support of Nsmsf_SMService UplinkSM service
operation to support uplink SM transfer, see 3GPP TS 29.540 [6] clause
5.2.2.4.
SMS-IWMSC is still based on legacy interface. The interface based on SBI need
to be defined, therefore the SMS-IWMSC adds a new Niwmsc_SMS service and
SMSSubmit service operation to support the transfer of the MO SM based on SBI,
and Niwmsc_SMS_SMSSubmit service operation is defined as shown in Figure
6.b.3-1 below.
Figure 6.5.3-1: Send MO SM payload in downlink direction
1\. The NF Service Consumer (e.g. SMSF) shall send a POST request to the
resource URI associated with the \"mosms\" custom operation. The payload body
of the POST request shall contain the SM record to be sent, the Service Centre
address, the callbackURI for report to MO SM, the timer for waiting the report
to MO SM, and optionally contains the Access Type.
2a. On success, \"200 OK\" shall be returned with \"SmsRecordDeliveryDataMo\"
object in the response body, the payload body of the POST response shall
contain the status of SM record delivery attempts at the SMS-IWMSC.
2b. On failure or redirection, the appropriate HTTP status code (e.g. \"403
Forbidden\") indicating the error shall be returned.
### 6.5.4 Transfer of Report to MO SM based on SBI
SMS-IWMSC shall send the report for MO SM using notification mechanism, the
callbackURI is carried in the request message of service operation
Niwmsc_SMS_SMSSubmit (see the definition of the service operation in clause
6.5.3) when SMSF sends the MO SM to SMS-IWMSC. The SMS-IWMSC adds
Niwmsc_SMS_ReportNotify service operation to notify SMSF the report using the
previously received callbackURI. The Figure 6.5.4-1 below shows the service
operation for notification.
Figure 6.5.4-1: Notify the Report to MO SM
1\. The SMSF sends a POST request to the callbackURI as provided by the NF
service consumer (e.g. SMSF) during Sending MO SM payload. The request body
shall contain the Report data to original MO SM.
2\. The NF service consumer responds with \"204 No Content\".
### 6.5.5 Impacts on services, entities and interfaces
SMS-IWMSC：
\- Support new Niwmsc_SMS service
\- Support registering the SMS-IWMSC NF profile and S SMS-IWMSC MSF NF service
profile in NRF
SMSF:
\- Support invoking Nnrf_NFDiscovery to discover SMS-IWMSC in this solution
\- Support invoking Niwmsc_SMS to send MO SM and receive Report to MO SM
NRF
\- Support the registration and discovery of SMS-IWMSC NF profile and NF
service profile.
## 6.6 Solution#6: MT SM transfer via SMS Router/IP-SM-GW
### 6.6.1 Introduction
This solution is to address Key Issue #1 \"SBI-based SM MT message transfer\".
Current procedure of MT SM transfer via SMS Router/IP-SM-GW is shown in Figure
6.6.1-1, interfaces between SMS-GMSC and UDM, UDM/SMSF and SMS Router/IP-SM-GW
are still based on legacy protocol. This solution introduces a successful SM
MT message transfer based on SBI in 5GC with SMS Router/IP-SM-GW deployed,
steps 2, 4 and 6 are changed to messages in SBI interfaces, and other steps
will not be impacted.
Figure 6.6.1-1: Successful MT SM transfer via the SMS Router/IP-SM-GW
### 6.6.2 Routing MT SM via SMS Router/IP-SM-GW based on SBI
As shown in Figure 6.6.2-1, step 3 is identical to step 2 in Figure 6.6.1-1,
step 5 is identical to step 4 in Figure 6.6.1-1 and step 6 is identical to
step 6 in Figure 6.6.1-1. This procedure also defines the UDM/SMSF
registration and discovery before sending the message.
Figure 6.6.2-1: Successful MT SM transfer via the SMS Router/IP-SM-GW based on
SBI
0 The UDM registers the NF profile including the supported SUPI ranges and/or
GPSI ranges in the NRF. The SMSF also registers NF profile including the IP
addresses and/or the FQDNs of the NF in the NRF.
1 The SC sends the MT SM to the SMS-GMSC.
2 The SMS-GMSC invokes the Nnrf_NFDiscovery_NFDiscovery to retrieve the UDM
instance that manages the user subscriptions using the GPSI/SUPI.
3a.-3d. Alternative 1: the SMS-GMSC invokes Nudm_UECM_Get to retrieve the
routing information of the UE to be able to send the MT SM from the selected
UDM. The UDM invokes Nsmsrouter_SMService_Get or Nipsmgw_SMService_Get to
retrieve the address of the SMS Router/IP-SM-GW to receive the MT SM, the UDM
also provides the SMSF instance to the SMS Router/IP-SM-GW. The address of the
SMS Router/IP-SM-GW to be contacted by the UDM may be configured locally. The
SMS Router/IP-SM-GW provides address to the UDM to receive the MT SM. UDM
provides the received address to the SMS-GMSC.
3e.-3j. Alternative 2: the SMS-GMSC invokes Nudm_UECM_Get to retrieve the
routing information of the UE to be able to send the MT SM from the selected
UDM, UDM responses the message with 3xx redirection, the URI of the SMS
Router/IP-SM-GW is included location header. After that, the SMS-GMSC invokes
Nsmsrouter_SMService_Get or Nipsmgw_SMService_Get to retrieve the address of
the SMS Router/IP-SM-GW to receive the MT SM, and the SMS Router/IP-SM-GW
queries the UDM by invoking the Nudm_UECM_Get to retrieve the SMSF instance.
The SMS Router/IP-SM-GW provides address to the SMS-GMSC to receive the MT SM.
4 The SMS-GMSC sends the MT SM to SMS Router/IP-SM-GW.
5 The SMS Router/IP-SM-GW invokes the Nnrf_NFDiscovery_NFDiscovery to retrieve
the IP addresses or FQDNs of the serving SMSF of the UE based on the SMSF
instance received in step 3b.
6a. The SMS Router/IP-SM-GW sends the MT SM records to the SMSF.
6b and 6c. The SMSF responses SMS Router/IP-SM-GW for the receiving of the MT
SM records and sends delivery report to the SMS Router/IP-SM-GW later --
alternative 1.
6c. The SMSF responses SMS Router/IP-SM-GW with the delivery report included
-- alternative 2.
### 6.6.3 Get routing information from SMS Router/IP-SM-GW
The SMS Router/IP-SM-GW shall support the new service (SMService) and service
operation (Get) based on SBI, which may be invoked by UDM (step 3b, described
in clause 6.6.2) or the SMS-GMSC (step 3g, described in clause 6.6.2) to get
the routing information as defined in Figure 6.6.3-1 below.
Figure 6.6.3-1: Get routing information
1\. The NF Service Consumer (e.g. UDM or _SMS-GMSC_) shall send a GET request
to the resource representing the UE\'s routing information, if the NF Service
Consumer is UDM, the query parameters includes the NF Instance ID of the SMSF.
2a. On success, the SMS Router/IP-SM-GW responds with \"200 OK\" with the
message body containing the UE\'s routing information to receive the MT SM.
2b. On failure or redirection, the appropriate HTTP status code (e.g. \"403
Forbidden\") indicating the error shall be returned.
### 6.6.4 Transfer of MT SM from SMS Router/IP-SM-GW to SMSF
The SMSF shall support the new service or service operation based on SBI,
which may be invoked by SMS Router/IP-SM-GW to deliver the MT SM to SMSF. A
new service operation DownlinkSMS may be extended to the service
Nsmsf_SMService supported by the SMSF as defined in Figure 6.6.4-1 below.
Figure 6.6.4-1: Transfer of MT SM from SMS Router/IP-SM-GW to SMSF
1\. The NF Service Consumer (e.g. SMS Router/IP-SM-GW) shall send a POST
request to the resource representing the UEContext (i.e. .../ue-
contexts/{supi}/sendsms-dl) of the SMSF. The payload body of the POST request
shall contain the SMS record to be sent, Service Centre address, _callbackURI
of the_ SMS Router/IP-SM-GW _,_ and optionally contains the SM Delivery Timer
and SM Delivery Start Time if the UE is using extended idle mode DRX. For
alternative 2 described in step 6d of clause 6.6.2, the _callbackURI of the_
SMS Router/IP-SM-GW is not needed.
2a. On success, \"200 OK\" shall be returned with \"SmsRecordDeliveryDataDl\"
object in the response body, the payload body of the POST response shall
contain the status of SMS record delivery attempts at the SMSF. For
alternative 2 described in step 6d of clause 6.6.2, the Report data of the
original MT SM is included in the response body.
2b. On success, \"202 Accepted\" shall be returned to indicate that the
sending request has been accepted and MT SMS record has been buffered in SMSF
if the UE is using extended idle mode DRX and the UE is expected to respond to
paging shortly or within the time frame indicated by the SM Delivery Timer and
SM Delivery Start Time in request body, and the SMSF should reattempt to
deliver the short message to the UE within this time frame. For alternative 2
described in step 6d of clause 6.6.2, this step is not needed.
2c. On failure or redirection, the appropriate HTTP status code (e.g. \"403
Forbidden\") indicating the error shall be returned.
### 6.6.5 Transfer of Report from SMSF to SMS Router/IP-SM-GW
This procedure is only applicable to alternative 1 _described in step 6c of
clause 6.6.2._ Based on the callback URI of the SMS Router/IP-SM-GW received,
the SMSF sends notification to the SMS Router/IP-SM-GW to notify the delivery
report of MT SM. The SMSF needs to support the new service operation (Notify)
in Nsmsf_SMService service. The Figure 6.6.5-1 below shows the service
operation of notification.
Figure 6.6.5-1: Transfer of Report from SMSF to SMS Router/IP-SM-GW
1\. The SMSF sends a POST request to the callbackURI as provided by the NF
service consumer (e.g. SMS Router/IP-SM-GW) during transferring of MT SM from
the SMS Router/IP-SM-GW to the SMSF as defined in clause 6.6.4. The request
body shall contain the Report data of the original MT SM.
2\. The NF service consumer responds with \"204 No Content\".
### 6.6.6 Impacts on services, entities and interfaces
SMSF：
\- Support new Nsmsf_SMService DownlinkSMS service operation, invoked by SMS
Router/IP-SM-GW.
\- Support new Nsmsf_SMService Notify service operation to send the
notification to SMS Router/IP-SM-GW.
SMS Router/IP-SM-GW:
\- Support new service Nsmsrouter_SMService or Nipsmgw_SMService and the Get
service operation, invoked by UDM or the SMS-GMSC.
UDM:
\- Update the Nudm_UECM_Get, invoked by SMS-GMSC to retrieve the routing
information of SMS Router/IP-SM-GW.
\- Update the Nudm_UECM_Get, invoked by SMS Router/IP-SM-GW to retrieve the
routing information of SMSF.
## 6.7 Solution#7: Unsuccessful MT SM transfer via SMS Router/IP-SM-GW
### 6.7.1 Introduction
This solution is to address Key Issue #1 \"SBI-based SM MT message transfer\".
Introduce the solution on unsuccessful SM MT message transfer via SMS
Router/IP-SM-GW based on SBI in 5GC.
### 6.7.2 Failure for MT SMS transfer in SMS Router/IP-SM-GW
The UDM may invoke the Nsmsrouter_SMService_Get or Nipsmgw_SMService_Get from
the SMS Router/IP-SM-GW to get the routing information for MT SM.
_The_ SMS Router/IP-SM-GW _responds_ CONTEXT_NOT_FOUND _with 404 Not Found to
the UDM if no routing information is available for this UE._
_The_ SMS Router/IP-SM-GW _responds_ NETWORK_FAILURE with 504 Gateway Timeout
to the UDM if the request is rejected due to a network problem.
### 6.7.3 Impacts on services, entities and interfaces
SMS Router/IP-SM-GW:
\- Support of the failure cases in the new service Nsmsrouter_SMService or
Nipsmgw_SMService and the Get service operation.
## 6.8 Solution#8: **Unsuccessful MT SM transfer**
### 6.8.1 Introduction
This solution is to address Key Issue #1 \"SBI-based SM MT message transfer\".
Introduce the solution for unsuccessful SM MT message transfer based on SBI in
5GC.
Unsuccessful message transfer from the SC to the UE may be caused by a variety
of different errors. These errors may happen in the UE (e.g. Memory Capacity
Exceeded), or may happen in the network (e.g. NF overload, link error between
NFs), some of them may be temporary or some of them may be permanent. An error
indication shall be return to the SC from the SMS-GMSC in order that the SC
knows how to handle next, discard or reattempt. And for some errors which can
be recovered in short time, the network should provide ways that the SC can be
aware of the recovery and reattempt the send at a proper time.
The error indication related to mobile terminated short message transfer which
may be transferred to the originating SC see 3GPP TS 23.040 [2] clause 3.3.2
Table 1. This clause provides the solutions of Error indications based on SBI
between the SMSF and the SMS-GMSC, and the UDM and the SMS-GMSC when errors
happen during MT SM transfer, and how to map these Errors indication to the
Errors indication defined in 3GPP TS 23.040 [2] clause 3.3.2 Table 1.
### 6.8.2 Failure for MT SM transfer in SMSF
SMSF adds new service operation DownlinkSMS in existing Nsmsf_SMService to
transfer MT SM (see the description of the new service operation in solution 4
MT SM transfer of clause 6.4). SMSF indicates the error for MT SM transfer in
DownlinkSMS response if the transfer failed. The Application Errors used in
DownlinkSMS response are defined in Table 6.8.2-1 below, the SMS-GMSC shall
map the Application Error listed in Table 6.8.2-1 to the Error indications
which has been defined in 3GPP TS 23.040 [2] clause 3.3.2 Table 1 when SMS-
GMSC receives them, and the other Application Errors not listed are suggested
to be mapped to \"System failure\" see 3GPP TS 23.040 [2] clause 3.3.2 Table
1.
Table 6.8.2-1: Application errors
Application Error HTTP status code Description Error indication Mapped to
* * *
USER_NOT_FOUND 404 Not Found The provided subscriber identifier is invalid or
the service user not found from UDM. Unknown subscriber CONTEXT_NOT_FOUND 404
Not Found The UE context for SMS is invalid or not found in SMSF. Unknown
subscriber SERVICE_NOT_ALLOWED 403 Forbidden The requested service is barred
for this service user (e.g. Barring of all MT-SMS). Call barred
USER_UNREACHABLE 403 Forbidden The delivery of the short message to UE failed
due to UE is not reachable Absent subscriber UE_DELIVERY_FAILURE 403 Forbidden
The delivery of the short message to UE failed due to failure in UE at
reception of a short message, e.g. protocol error. Error in MS
MEMORY_CAPACITY_EXCEEDED 403 Forbidden The UE rejects the short message since
it has no memory capacity available to store the message. Memory Capacity
Exceeded HIGHER_PRIORITY_REQUEST_ONGOING 409 Conflict The delivery of MT SM
failed due to a higher priority session ongoing and SMSF can\'t buffer the MT
SM. This failure may happen because SMSF receive the
\"HIGHER_PRIORITY_REQUEST_ONGOING\" with 409 Conflict from AMF. MS busy for MT
SMS TEMPORARY_REJECT_REGISTRATION_ONGOING 409 Conflict The delivery of MT SM
failed due to an ongoing registration procedure and SMSF can\'t buffer the MT
SM. This failure may happen because SMSF receive the
\"HIGHER_PRIORITY_REQUEST_ONGOING\" with 409 Conflict from AMF. MS busy for MT
SMS TEMPORARY_REJECT_HANDOVER_ONGOING 409 Conflict The delivery of MT SM
failed an ongoing N2 handover procedure and SMSF can\'t buffer the MT SM. This
failure may happen because SMSF receive the
\"HIGHER_PRIORITY_REQUEST_ONGOING\" with 409 Conflict from AMF. MS busy for MT
SMS SMS_PAYLOAD_MISSING 400 Bad Request The expected SMS payload content is
missing.  
SMS_PAYLOAD_ERROR 400 Bad Request Errors exist in the format of SMS payload.
Editor\'s Note: It need be further studied about how to further harmonize with
3GPP TS 29.002 12.9.3 MTFSMRes user errors.
If USER_UNREACHABLE with 403 Forbidden is returned in DownlinkSMS response, a
structure the data UeAbsentError shall be returned in the response body, the
UeAbsentError shall contain ProblemDetails, may contain AbsentUserDiagnosticUe
(The values are defined in 3GPP TS 23.040[3] clause 3.3.2), and may contain
the estimated maximum waiting time in seconds before the UE will be reachable
(e.g. If the UE is in MICO mode or If the UE is using extended idle mode DRX,
this time shall be received from AMF).
If UE_DELIVERY_FAILURE with 403 Forbidden is returned in DownlinkSMS response,
a structure the data UeDeliveryError shall be returned in the response body,
the UeDeliveryError shall contain ProblemDetails and contain
UeDelvieryFailureCause, UeDelvieryFailureCause shall contain complementary
information associated to UE_DELIVERY_FAILURE.
If the SMSF can\'t transfer the MT SM within the time frame indicated by the
SMS-GMSC (e.g. indicated in SM-Delivery-Timer and SM-Delivery-Start-Time) and
the SMSF can buffer the short message record, the SMSF shall respond the
DownlinkSMS request with 202 Accepted, and notify the SMS-GMSC the result of
the MT SM delivery using the CallBackUri provided by the SMS-GMSC in the
DownlinkSMS request when the time frame indicated by SMS-GMSC previously
expires. The notification uses newly added Nsmsf_SMService
TransferFailureNotify service operation if the MT SM delivery failed. The
Figure 6.a.2-1below shows the service operation for notification.
Figure 6.8.2-1: MT SM Transfer Failure Notify
1\. When the SMSF determines that the delivery of MT SM has failed, the SMSF
sends a POST request to the callbackURI as previously provided by the NF
service consumer (e.g. SMS-GMSC) during Sending MT SM payload. The request
body shall contain the MT SM Transfer Failure Data to include the failure
cause and resource URI returned in the Location header when the DownlinkSMS
was initiated. The failure cause shall be set to one of following cause value:
\- USER_UNREACHABLE
\- HIGHER_PRIORITY_REQUEST_ONGOING
\- TEMPORARY_REJECT_REGISTRATION_ONGOING
\- TEMPORARY_REJECT_HANDOVER_ONGOING
2\. The NF service consumer responds with \"204 No Content\".
### 6.8.3 Failure for MT SM transfer in UDM
Before the SMS-GMSC transfers the MT SM to the SMSF, the SMS-GMSC shall
retrieve the serving SMSF information from the UDM using the existing
Nudm_UEContextManagement_Get service operation.
If the UDM responds USER_NOT_FOUND with 404 Not Found to the SMS-GMSC, the
SMS-GMSC shall map it to \"Unknown subscriber\" and return this Error
indication to the SC.
If the UDM responds CONTEXT_NOT_FOUND with 404 Not Found to the SMS-GMSC, the
SMS-GMSC shall query SMS Subscription Data using existing
Nudm_SubscriberDataManagement SMS Subscription Data Retrieval service
operation, if it indicates that the UE subscription doesn\'t allow SMS
delivery over NAS in the SMS Subscription Data, the SMS-GMSC shall indicate
Error indication \"Teleservice not provisioned\" to the SC, or if it indicates
that the UE subscription allows SMS delivery over NAS in the SMS Subscription
Data, the SMS-GMSC shall indicates Error indication \"Absent subscriber\" to
the SC.
### 6.8.4 Impacts on services, entities and interfaces
SMSF：
\- Support new Nsmsf_SMService DownlinkSMS service operation with the new
Error Indication.
\- Support new Nsmsf_SMService TransferFailureNotify service operation
SMS-GMSC:
\- Support invoking new Nsmsf_SMService DownlinkSMS service operation with the
new Error Indication, and corresponding operations in SMS-GMSC.
\- Support receiving Nsmsf_SMService TransferFailureNotify service operation
and corresponding operations in the SMS-GMSC
\- Support invoking Nudm_UEContextManagement_Get and
Nudm_SubscriberDataManagement SMS Subscription Data Retrieval service
operation, and the corresponding operations in the SMS-GMSC
## 6.9 Solution#9: Alert
### 6.9.1 Introduction
This solution is to address Key Issue #1 \"SBI-based SM MT message transfer\".
The SM MT message transfer failed because of some reasons like UE was
unreachable or the memory capacity for SMS was exceeded, the Alert-SC service
provides the service on that the network informs the SC that an UE,
1) to which a delivery attempt has failed because the UE was not reachable or
because the UE memory capacity was exceeded; and
2) which is now recognized by the PLMN:
a) to have resumed operation (e.g. to have responded to a paging request); or
b) to have memory newly available (which implies that the mobile is
reachable).
is again ready to receive one or more short messages. The SC may initiate the
delivery attempt procedure for the queued messages destined for this UE on
reception of an Alert-SC.
The solution in this clause covers,
1) How to request Alert and how to transfer Alert if UE SM MT message transfer
failed because UE was unreachable and this MT SM for the UE requested to be
retransmitted at a later time,
2) How to request Alert and how to transfer Alert if UE SM MT message transfer
failed because the memory capacity for SMS was exceeded and this MT SM for the
UE requested to be retransmitted at a later time.
The service operations between SMS-GMSC and SMSF, SMS-GMSC and UDM, UDM and
SMSF, UDM and AMF based on SBI are shown in following Figure 6.9.1-1.
Figure 6.9.1-1: The alert procedure
1 When the SMSF determines that the delivery of MT SM has failed, the SMSF
sends a POST request using the callbackURI as previously provided by the SMS-
GMSC.
2 The SMS-GMSC notifies the Failure Report to the SC.
3 If the cause of failure is because of the UE is unreachable or the UE memory
capacity is exceeded, the SMS-GMSC sends Nudm_EE_Subscribe to the UDM to
subscribe to the event \"UE_REACHABILITY_FOR_SMS\" or
\"UE_MEMORY_AVAILABLE_FOR_SMS\".
4a If the UDM receives the subscription to \"UE_MEMORY_AVAILABLE_FOR_SMS\",
the UDM sends the Nsmsf_EE_subscribe request to SMSF to subscribe to the
notification on that UE have memory newly available for SMS.
4b If the UDM receives the subscription to \"UE_REACHABILITY_FOR_SMS\" and the
UDM hasn\'t subscribed to the UE available event on AMF, the UDM sends the
Namf_EE_subscribe request to the AMF to subscribe to the notification on
reachability of that UE.
5a If SMSF receives the indication on UE has memory newly available for SMS,
the SMSF notifies the UDM of the event.
5b If the UE is reachable, the AMF notifies the UDM of that event.
6 The UDM notifies the \"UE_MEMORY_AVAILABLE_FOR_SMS\" or
\"UE_REACHABILITY_FOR_SMS\" to the SMS-GMSC accordingly.
7 The SMS-GMSC alerts the SC.
The following clauses are to introduce the services based on SBI related to
\"UE_MEMORY_AVAILABLE_FOR_SMS\" or \"UE_REACHABILITY_FOR_SMS\" separately.
### 6.9.2 Alert MS memory capacity available
When the SMS-GMSC receives the failure that the UE memory for SMS is exceeded
and the SMS-GMSC decided reattempting the delivery of the MT SM, the SMS-GMSC
subscribes to the event \"UE_MEMORY_AVAILABLE_FOR_SMS\" provided by the
network, and the network shall notify the SMS-GMSC when the event happened.
To support the subscription and notification of _the event_
\"UE_MEMORY_AVAILABLE_FOR_SMS\", the existing UDM EE subscribe and Notify
service operation shall be extended to support the event. See Subscription to
Notification of event occurrence service operation of UDM EE service in 3GPP
TS 29.503 [7] clause 5.5.2.2.2, the specific and extended part of the service
operation is described below:
In the subscription request, the event type is set to the newly added
\"UE_MEMORY_AVAILABLE_FOR_SMS\", the expiry time is set to the maximum store
time of MT SM in SC, the MaxNumOfReports is set to 1, and Monitoring
Configuration data includes the SC address.
Event Occurrence Notification service operation of UDM EE service is described
in 3GPP TS 29.503 [7] clause 5.5.2.4.2, the extended part of the service
operation is that eventType indicates \"UE_MEMORY_AVAILABLE_FOR_SMS\" and the
SC address is also included in the notify request.
To support the subscription and notification of _the event_
\"UE_MEMORY_AVAILABLE_FOR_SMS\", the SMSF added a new service
_Nsmsf_EventExposure, and subscribe/unsubscribe/notify service operation on
this new service._
When the UDM receives the EE subscription to event
\"UE_MEMORY_AVAILABLE_FOR_SMS\", the UDM shall invoke the
Nsmsf_EventExposure_subscribe to subscribe to the event
\"UE_MEMORY_AVAILABLE_FOR_SMS\" in the SMSF, see Figure 6.9.2-1.
Figure 6.9.2-1: NF service consumer subscribes to notifications
1\. The NF service consumer (e.g. UDM) sends a POST request to the parent
resource (collection of subscriptions) (.../{ueIdentity}/ee-subscriptions), to
create a subscription as present in message body. The request may event type
(e.g. _mobile has memory available_), the callbackURI to which the
notification will send, the configuration related to the Event (e.g. one time
event).
2a. On success, the UDM responds with \"201 Created\" with the message body
containing a representation of the created subscription. The Location HTTP
header shall contain the URI of the created subscription. If the event
subscription was for a group of UEs:
When the UDM decided to unsubscribe to the event
\"UE_MEMORY_AVAILABLE_FOR_SMS\" for which it has subscribed previously, the
UDM shall invoke the Nsmsf_EventExposure_unsubscribe to unsubscribe to the
event \"UE_MEMORY_AVAILABLE_FOR_SMS\" in SMSF, see Figure 6.9.2-2.
Figure 6.9.2-2: NF service consumer unsubscribes to notifications
1\. The NF service consumer sends a DELETE request to the resource identified
by the URI previously received during subscription creation.
2a. On success, the UDM responds with \"204 No Content\".
2b. If there is no valid subscription available (e.g. due to an unknown
SubscriptionId value), HTTP status code \"404 Not Found\" shall be returned
including additional error information in the response body (in the
\"ProblemDetails\" element).
When SMSF received the RP-SMMA message from UE (see 3GPP 24.011 [8] clause
7.3.2), the SMSF is aware of memory available of the MS, then SMSF notifies
the memory available to the consumers (e.g. UDM) which subscribes to this
service. It is suggested that the SMSF adds a new service Nsmsf_EventExposure
to provide subscribe/unsubscribe/notify the events related the UE (e.g. mobile
has memory available). The service operation are show below.
Figure 6.9.2-3: Event Occurrence Notification
1\. The UDM sends a POST request to the callbackURI provided by the NF service
consumer when subscribing to the event, the request shall include the report
related to the monitored event (e.g. _mobile has memory available_).
2\. The NF Service Consumer responds with \"204 No Content\".
### 6.9.3 Alert MS reachable
The UDM has already provided the support of the subscribe/unsubscribe/notify
of the event UE_REACHABILITY_FOR_SMS by Nudm_EventExposure Service. If during
the delivery of the MT SM to UE, the SMS-GMSC/SC receives that MT SM delivery
failed and the cause of failure is unreachable for UE from SMSF, the SMS-
GMSC/SC invokes Nudm_EventExposure Service to subscribe to the event
UE_REACHABILITY_FOR_SMS, the Nudm_EventExposure_subscribe is extended to
include the SC address in the request, and the UDM shall notify the SMS-GMSC
that the UE is reachable for SMS using Nudm_EventExposure_Notify Service
operation and callbackUri previously provided in the subscription request.
### 6.9.4 Impacts on services, entities and interfaces
SMS-GMSC:
\- Support invoking Nudm_EE service for \"UE_MEMORY_AVAILABLE_FOR_SMS\"
and\"UE_REACHABILITY_FOR_SMS\" events.
\- Support alert the SC according to the received notification of
\"UE_MEMORY_AVAILABLE_FOR_SMS\" and\"UE_REACHABILITY_FOR_SMS\" events.
UDM:
\- Extend the EE service to support subscribe/unsubscribe/notify new event
\"UE_MEMORY_AVAILABLE_FOR_SMS\".
\- Support invoking Nsmsf_EventExposure service.
SMSF:
\- Support newly added service Nsmsf_EventExposure.
\- Support to register the newly added service Nsmsf_EventExposure service in
NRF.
NRF:
\- Support registration and discovery of the new defined services.
## 6.10 Solution#10: Alert the recovery of UE memory for SMS
### 6.10.1 Introduction
This solution is to address Key Issue #1 \"SBI-based SM MT message transfer\".
The SM MT message transfer failed because of the memory capacity for SMS was
exceeded, the Alert-SC service in the network informs the SC that an UE has
memory newly available (which implies that the mobile is reachable) if the
SMS-GMSC/SC decided reattempting the delivery and subscribed to the
corresponding event in the network.
This solution covers how to request the Alert and how to transfer the Alert if
the UE SM MT message transfer failed because the memory capacity for SMS was
exceeded and this MT SMS for the UE requested to be retransmitted at a later
time. _The service operations between the SMS-GMSC and SMSF, SMS-GMSC and UDM,
UDM and SMSF, UDM and AMF based on SBI are shown in following Figure
6.10.1-1._
Figure 6.10.1-1: The alert procedure
1\. The SMS-GMSC invokes Nsmsf_SMService_DownlinkSMS request to send the MT
MS.
2\. When the SMSF determines that the delivery of MT SMS has failed, the SMSF
invokes Nudm_UECM_Update to store the state of UE memory (i.e. UE memory
exceeded).
3\. SMSF responds the SMS-GMSC with indication of the UE memory exceeded for
the SMS in the Nsmsf_SMService_DownlinkSMS Response.
4\. The SMS-GMSC notify the Failure Report to the SC.
5\. The SMS-GMSC invokes Nudm_EE_Subscribe to subscribe to the event
\"UE_MEMORY_AVAILABLE_FOR_SMS\".
6\. The AMF relay the RP-SMMA message from the UE to the SMSF using
Namf_Communication N1 Message Notification service operation.
7\. The SMSF invokes Nudm_UECM_Update to update the state of UE memory (UE
memory is available).
8\. The UDM notifies the \"UE_MEMORY_AVAILABLE_FOR_SMS\".
9\. The SMS-GMSC alerts the SC.
The first MT SM delivery failed from the same SC due to UE memory exceeded,
the SMSF stores this UE state in UDM/UDR, the later MT SMs can query this
state in UDM/UDR before delivery, and if UE state is UE Memory Exceeded, the
SMS-GMSC/SC should/shall store the MT SM locally, and then subscribe to the
event \"UE_MEMORY_AVAILABLE_FOR_SMS\" in the UDM, this way will avoid
unnecessary signalling interactions between the SMS-GMSC/SC and the UE.
### 6.10.2 UE memory capacity state store
The UDM/UDR adds a new UE memory state for SMS update service operations in
the Nudm_UEContextManagement Service to support that the SMSF provides the up
to date state of UE memory capacity for SMS in the UDM/UDR. If the SMSF is
aware of the change of UE memory capacity for SMS, the SMSF shall invoke this
service operation to update the state of UE memory capacity.
Figure 6.10.2-1 and Figure 6.10.2-2 shows a scenario where the SMSF sends a
request to the UDM/UDR to update the state of UE memory capacity within the
SmsfRegistration resource. The request contains the UE\'s identity (/{ueId})
which shall be a SUPI and an instruction to modify a parameter (e.g. PEI).
Figure 6.10.2-1: UE memory state for SMS update for 3GPP access
1\. The AMF sends a PATCH request to the resource representing the UE\'s SMSF
registration for 3GPP access. The Modification instruction contains the UE
memory state data for SMS including the state of the UE memory for SMS (e.g.
the memory for SMS exceeded or not), SC address, time of state change, expiry
timer of the stored state.
2a. On success, the UDM responds with \"204 No Content\".
2b. If the resource does not exist e.g. the UE is not registered yet, HTTP
status code \"404 Not Found\" should be returned including additional error
information in the response body (in the \"ProblemDetails\" element).
2c. If the resource exists, but the requesting SMSF is not the one currently
registered for the UE, HTTP status code \"422 Unprocessable Request\" should
be returned including additional error information in the response body (in
the \"ProblemDetails\" element).
On failure, the appropriate HTTP status code indicating the error shall be
returned and appropriate additional error information should be returned in
the PATCH response body.
Figure 6.10.2-2: UE memory state for SMS update for Non 3GPP access
1\. The SMSF sends a PATCH request to the resource representing the UE\'s SMSF
registration for Non 3GPP access. The Modification instruction contains the UE
memory state data for SMS including the state of the UE memory for SMS (e.g.
the memory for SMS exceeded or not), SC address, time of state change, expiry
timer of the stored state.
2a. On success, the UDM responds with \"204 No Content\".
2b. If the resource does not exist e.g. the UE is not registered yet, HTTP
status code \"404 Not Found\" should be returned including additional error
information in the response body (in the \"ProblemDetails\" element).
2c. If the resource exists, but the requesting SMSF is not the one currently
registered for the UE, HTTP status code \"422 Unprocessable Request\" should
be returned including additional error information in the response body (in
the \"ProblemDetails\" element).
On failure, the appropriate HTTP status code indicating the error shall be
returned and appropriate additional error information should be returned in
the PATCH response body.
### 6.10.3 UE memory capacity state query
Extend the SMSF Registration information to include the UE memory capacity
state information, and the UE memory capacity state information may contain
the state of the UE memory for SMS (e.g. the memory for SMS exceeded or not),
SC address, time of state change, expiry timer of the stored state. The
service consumer (e.g. SMSF, SMS-GMSC) may invoke Nudm_UEContextManagement_Get
to query the SMSF Registration information for 3GPP and Non 3GPP, if the UE
memory capacity state information is absent in the SMSF Registration
information, it implicitly indicates that the UE memory capacity for SMS is
available.
### 6.10.4 UE memory capacity available event
Extends the existing Nudm_EE service to support
subscription/unsubscription/notification of new event
\"UE_MEMORY_AVAILABLE_FOR_SMS\". When the UDM receives the change of state of
the UE memory for SMS from \"exceeded\" to \"available\", the UDM shall notify
the consumer (e.g. SMS-GMSC) on event \"UE_MEMORY_AVAILABLE_FOR_SMS\" if the
consumer has subscribed to the event.
See Subscription to Notification of event occurrence service operation of UDM
EE service in 3GPP TS 29.503 [7] clause 5.5.2.2.2, the specific and extended
part of the service operation is below:
> In the subscription request, the event type is set to the newly added
> \"UE_MEMORY_AVAILABLE_FOR_SMS\", the expiry time is set to the maximum store
> time of MT SM in SC, the MaxNumOfReports is set to 1, and Monitoring
> Configuration data includes the SC address.
See Event Occurrence Notification service operation of UDM EE service in 3GPP
TS 29.503 [7] clause 5.5.2.4.2, the extended part of the service operation is
that eventType indicates \"UE_MEMORY_AVAILABLE_FOR_SMS\" and the the SC
address is also included in the notify request.
For support the subscription and notification of the event
\"UE_MEMORY_AVAILABLE_FOR_SMS\", the SMSF added a new service
Nsmsf_EventExposure, and subscribe/unsubscribe/notify service operation on
this new service.
### 6.10.5 Alert MS reachable
The UDM has already provided the subscribe/unsubscribe/notify of the event
UE_REACHABILITY_FOR_SMS with the Nudm_EventExposure Service. If the SMS-
GMSC/SC received that MT SM delivery failed (during the delivery of the MT SM
to the UE) and the cause of failure is unreachable for UE from SMSF, the SMS-
GMSC/SC invokes Nudm_EventExposure Service to subscribe to the event
UE_REACHABILITY_FOR_SMS, the Nudm_EventExposure_subscribe is extended to
include the SC address in the request. and the UDM shall notify the SMS-GMSC
that the UE is reachable for SMS using Nudm_EventExposure_Notify Service
operation and the callbackUri previously provided in the subscription request.
### 6.10.6 Impacts on services, entities and interfaces
SMS-GMSC:
\- Support invoking Nudm_EE service for \"UE_MEMORY_AVAILABLE_FOR_SMS\"
\- Support alert the SC according to the received notification of
\"UE_MEMORY_AVAILABLE_FOR_SMS\" event.
UDM:
\- Extend the EE service to support subscribe/unsubscribe/notify new event
\"UE_MEMORY_AVAILABLE_FOR_SMS\".
\- Add new UE memory state for SMS update service operations in
Nudm_UEContextManagement Service.
SMSF:
\- Support to invoke newly added service operations in
Nudm_UEContextManagement.
## 6.11 Solution#11: Unsuccessful MO SM transfer
### 6.11.1 Introduction
This solution is to address Key Issue #2 \"SBI-based SM MO message transfer\".
Introduce the solution for unsuccessful MO SM based on SBI in 5GC.
Figure 6.11.1-1 (from TS 3GPP 23.502 [4] clause 4.13.3.3) below is the
baseline procedure of MO SM over NAS from TS 3GPP 23.502 [4]. We can observe
that the interface between the SMSF and the SMS-IWMSC is still based on legacy
protocol. This solution targets to provide the solution for Unsuccessful MO SM
transfer based on the new SBI-based interfaces between the SMSF and the SMS-
IWMSC/SC.
Figure 6.11.1-1: MO SM over NAS
### 6.11.2 Failure for MO SM transfer in SMS-IWMSC
SMS-IWMSC adds new Niwmsc_SMS service and UplinkSM service operation to
support the transfer of the uplink SM based on SBI (see the description of the
new service operation in solution b MO SM transfer of clause 6.5). SMS-IWMSC
indicates the different errors for MO SM transfer in UplinkSM response
according to the different failure scenarios which happened during MO SM
transfer. The Application Errors used in Niwmsc_SMS UplinkSM response are
defined in Table 6.11.2-1 below
Table 6.11.2-1: Application errors
Application Error HTTP status code Description
* * *
UNKNOWN_SERVICE_CENTRE_ADDRESS 403 Forbidden The delivery of the MO short
message failed because SMS-SC was known. SERVICE_CENTRE__CONGESTION 403
Forbidden The delivery of the MO short message failed because SMS-SC was in
congestion. USER_NOT_SERVICE_CENTER 403 Forbidden The delivery of the short
message failed because the user didn\'t belongs to the SMS-SC.
FACILITY_NOT_SUPPORTED 403 Forbidden The delivery of the MO short message
failed because of facility not supported. UNREACHABLE_SMS_SC 504 Gateway
Timeout The delivery of the MO short message failed because the response is
timeout.
If errors are indicated by the SMS-IWMSC, the SMSF shall send a failure report
(i.e. a RP-ERROR message) to the UE, with the error cause coded as following
map between errors indicated by SMS-IWMSC and error cause code in RP-ERROR
message:
Table 6.11.2-2: MAP of Application errors
+----------------------------------+----------------------------------+ | Return error from SMS-IWMSC | Cause value in the RP‑ERROR | | | message | +----------------------------------+----------------------------------+ | The Response from SMS-IWMSC is | 38 Network out of order | | timeout | | | | | | Unspecified 4xx/5xx error code | | +----------------------------------+----------------------------------+ | 403 Forbidden with | 69 Requested facility not | | FACILITY_NOT_SUPPORTED | implemented | +----------------------------------+----------------------------------+ | 403 Forbidden with | 1 Unassigned number | | U | | | NKNOWN_SERVICE_CENTRE_ADDRESS | | +----------------------------------+----------------------------------+ | 403 Forbidden with | 42 Congestion | | SERVICE_CENTRE__CONGESTION | | +----------------------------------+----------------------------------+ | 403 Forbidden with | 28 Unidentified subscriber | | USER_NOT_SERVICE_CENTER | | +----------------------------------+----------------------------------+
NOTE: The coding and the use of the RP‑ERROR message is specified in 3GPP TS
24.011 [8].
### 6.11.3 Impacts on services, entities and interfaces
SMS-IWMSC：
\- Support new Niwmsc_SMS UplinkSM service operation and related Application
errors.
SMSF:
\- Support invoking Niwmsc_SMS UplinkSM service operation and dealing with
related Application errors and error codes.
## 6.12 Solution #12: Mechanism to select the target PLMN with MNP
### 6.12.1 Introduction
This solution addresses Key Issue #3 (\"Mechanism to select the target PLMN
based on GPSI when using SBI\").
Termination of Short Message Service requires routing of some signalling
messages based on the public identifier (e.g. MSISDN) of the SMS recipient.
When the SMS recipient belongs to a PLMN different from the PLMN of the SMS
sender, the signaling takes place across PLMN borders. When number portability
is not implemented, the target PLMN can be identified using the recipients
MSISDN (E.164 number) prefix (e.g. CC+NDC). However, when number portability
is implemented it is necessary to know the recipient MSISDNs porting status to
determine the target network as the recipient MSISDN may have ported its
subscription from the number range holder PLMN to another PLMN.
This solution provides a mechanism, when using service-based interfaces, to
correctly route the signalling messages based on the public identifier (e.g.
MSISDN) to the recipient\'s subscription network.
NOTE: It is assumed that when the GPSI is an External Identifier the target
PLMN can be determined based on the domain part of the External Identifier and
hence the solution described in this paper only applies to when the GPSI is an
MSISDN (i.e. E.164 number).
### 6.12.2 Description
The solution proposes to introduce a new MNP (Mobile Number Portability) NF in
the 5GS architecture. This NF shall expose service API that will allow an NF
service consumer to retrieve the PLMN ID of the recipients MSISDN\'s
subscription network.
The MNP NF registers in the NRF with a new NFType (e.g. MNP) and is
discoverable by other NFs using this NFType.
An SMS-GMSC that supports SMS via SBI, first discovers the MNP NF via the NRF.
If the NRF returns NF profiles for MNP NF in discovery response, then the SMS-
GMSC contacts the MNP NF to identify the PLMN ID of the recipient MSISDN for
further discovery of UDM NF profiles for invoking UDM service operation for
routing information retrieval. The SMS-GMSC uses the PLMN ID received from MNP
NF as the target PLMN ID in the discovery request towards NRF to discover the
UDM NF profiles in the subscription network of the SMS recipient.
NOTE: Although this solution describes a mechanism for routing SBI messages
based on MSISDN to the correct PLMN for interaction between SMS entities like
SMS-GMSC and the UDM in the recipient\'s subscription PLMN, it could be
applicable to any potential use case and procedure that requires routing of
SBI messages based on GPSI (i.e. MSISDN) in 5GS.
When the recipient MSISDN belongs to the same country as the originating
network and MNP is not implemented in the country, an SMS-GMSC that supports
SMS via SBI may skip discovery of MNP NF and may directly discover UDM profile
for invoking UDM service operation for routing information retrieval. In this
case the SMS-GMSC determines the target PLMN ID from the recipient\'s MSISDN
Prefix (e.g. CC+NDC) while sending the discovery request to the NRF.
### 6.12.3 Procedures
The following clause illustrates the procedure to determine the correct PLMN
ID to route the routing information retrieval request to the UDM NF in the SMS
recipient\'s subscription network. The procedure covers both direct and
indirect routing based MNP implementation. The indirect routing mechanism is
also used for international SMS termination.
#### 6.12.3.1 Direct Routing (or All Call Query, ACQ)
When MNP is implemented in a country or number portability domain with direct
routing mechanism, the originating network first does the number portability
query to identify the recipient MSISDN\'s subscription PLMN before routing any
messages based on MSISDN.
Figure 6.12.3.1‑1 SMS termination when MNP is implemented with direct routing
(all call query)
Figure 6.12.3.1‑1 above shows the signalling flow diagram to route an SBI
message based on MSISDN when direct routing of MNP is implemented. Steps 1
through 6 is skipped if number portability is not implemented in the country
or PLMN and in this case the SMS-GMSC identifies the target PLMN from the
MSISDN Prefix (e.g. CC+NDC) based on local configuration.
1\. MNP NF registers to the NRF
2-3. SMS-GMSC discovers MNP NF via NRF
4-6. SMS-GMSC sends a NP status query request to MNP NF for the recipient
MSISDN. MNP NF checks the portability status of the recipient MSISDN and
responds back with the target PLMN ID. Alternatively the MNP NF may also
return a Routing Number (RN) or a URI using which the SMS-GMSC can identify
the target PLMN ID
7-8. SMS-GMSC uses the PLMN ID received in step 6 as the target PLMN ID when
performing discovery of UDM NF profile via NRF for sending the routing
information query to the UDM. If the target PLMN ID is not own network, the
local NRF forwards the discovery request to the NRF of the target PLMN. If
steps 1 through 6 were skipped because MNP is not implemented in the country,
the SMS-GMSC derives the target PLMN ID from the MSISDN Prefix (e.g. CC+NDC)
based on local configuration.
9-10. SMS-GMSC further performs routing information retrieval from the UDM,
based on the UDM profiles received in discovery response from NRF in step 8.
#### 6.12.3.2 Indirect Routing
When MNP is implemented in a country or number portability domain with
indirect routing mechanism, the signalling messages are always routed to the
number range holder network, the number range holder then performs a number
portability check and forwards the request to the subscription network if the
number is ported out. For the case of international SMS termination also
indirect routing is applied. In the case of international SMS termination, the
originating network is outside the number portability domain and may not have
any knowledge of whether number portability is implemented in the country of
the recipient MSISDN.
Figure 6.12.3.2‑1 SMS termination when MNP is implemented with Indirect
routing
Figure 6.12.3.2‑1 above shows the signalling flow diagram to route an SBI
message based on MSISDN when indirect routing of MNP is implemented. The steps
1 through 6 may be skipped if the SMS-GMSC knows (e.g. based on location
configuration) that number portability check is not needed for the recipient
MSISDN (e.g. when number portability is not implemented in a country or PLMN).
In this case SMS-GMSC identifies the target PLMN from the MSISDN Prefix (e.g.
CC+NDC) based on local configuration.
1\. MNP NF registers to the NRF
2-3. SMS-GMSC discovers MNP NF via NRF. The MNP NF belongs to the number range
holder PLMN. SMS-GMSC sets the target PLMN ID in the discovery request to the
number range holder PLMN. If the number range holder is a different PLMN then
the local NRF forwards the discovery request to the NRF of the number range
holder PLMN.
4-6. SMS-GMSC sends a NP status query request to MNP NF for the SMS recipient
MSISDN. MNP NF checks the portability status of the recipient MSISDN and
responds back with the target PLMN ID. Alternatively the MNP NF may also
return a Routing Number (RN) or a URI using which the SMS-GMSC can identify
the target PLMN ID
7-8. SMS-GMSC uses the PLMN ID received in step 6 as the target PLMN ID when
performing discovery of UDM NF profile via NRF for sending the routing
information query to the UDM. If the target PLMN ID is not own network, the
local NRF forwards the discovery request to the NRF of the target PLMN.
9-10. SMS-GMSC further performs routing information retrieval from the UDM,
based on the UDM profiles received in discovery response from NRF in step 8.
### 6.12.4 Impacts on services, entities and interfaces
NRF:
\- Support for registration and discovery of the new MNP NF and service API
SMS-GMSC:
\- Support SBI interface towards UDM and MNP NFs
\- Discovery of MNP NF profiles from NRF. When direct routing is used, the MNP
NF in the originating network is queried, so the target PLMN ID is not
included in the discovery request (which implies that the NRF searches for NF
profiles within local PLMN). When indirect routing is used, the MNP NF in the
number range holder network is queried, so the target PLMN ID in the discovery
request (to discover the MNP NF profile) is set to the number range holder
PLMN. SMS-GMSC derives the target PLMN ID for this request (indirect routing)
from the recipient\'s MSISDN prefix (e.g. CC+NDC).
\- Invoke new MNP service API to the MNP NF to determine the PLMN ID of the
recipient MSISDN
\- Use the PLMN ID received in the response from MNP as the target PLMN ID in
the discovery request to NRF for discovery of UDM NF profiles in the recipient
MSISDN\'s subscription network.
\- If MNP query is skipped (only when the recipient MSISDN is in the same
country as the originating SMS-GMSC and when MNP not implemented in the
country), then determine the target PLMN ID based on the recipients MSISDN
Prefix (e.g. CC+NDC). This target PLMN ID is used in the discovery request to
NRF to discover the UDM NF profiles in the recipient MSISDN\'s subscription
network.
\- Invoke routing information retrieval service operation to the UDM profile
received from NRF in discovery response
MNP NF:
\- A new MNP NF in introduced in the 5GS architecture.
\- This NF exposes a service API that allows a consumer of the service to
retrieve the PLMN ID of the Subscription Network of an MSISDN
\- MNP NF registers to the NRF and is discoverable by other service consumers
using the new NFType
## 6.13 Solution #13: SMS termination using SMS-GMSC in the home network of
SMS recipient
### 6.13.1 Introduction
This solution addresses Key Issue #1 \"SBI-based SM MT message transfer\". The
solution describes SMS Home routing scenario, where the SMS is first
transferred to the SMSC/SMS-GMSC of the recipient\'s home network, also
sometimes referred to as terminating SMSC. The home network SMSC/SMS-GMSC then
further performs the procedure for transferring the short message to the UE.
### 6.13.2 Description
In many networks deployments home routing of SMS is implemented. The SMS
targeted for a UE is first transferred to the SMSC/SMS-GMSC UE\'s home
network. The home network SMSC/SMS-GMSC then performs the procedures to
transfer the short message to the target UE. The SMS could be transferred from
the originating network SMSC to the home network SMSC or terminating SMSC
using proprietary mechanisms e.g. using SMPP (Short Message Peer-to-Peer)
protocol. How the originating SMSC forwards the SMS to the terminating SMSC is
out of scope of this solution proposal and it is assumed that the existing
mechanisms are utilised for this purpose. The solution described here only
provides a mechanism for the terminating SMSC (in the home network) to
transfer the SMS to the target UE using SBI.
There are many benefits of such SMS home routing implementation as the home
network has complete control of the SMS delivery. The home network can apply
appropriate screening, filtering, priority setting, retry policy etc. on the
messages before it decides to transfer the SMS to the UE. When implementing
support for SMS using service-based interfaces in a network, this also comes
with an additional advantage that the home network can deploy SBI based
mechanism for SMS delivery without having any dependency on whether the
originating network supports SBI for SMS or not. The existing mechanisms could
be used for forwarding the SMS from the originating SMSC to the terminating
SMSC and then the terminating SMSC/SMS-GMSC can use service based interfaces
for routing information retrieval from the UDM and further for terminating the
SMS to the UE if the UE\'s serving network (when roaming) supports service
based interface for SMS termination.
### 6.13.3 Procedures
Figure 6.13.3-1: SMS termination using SMS-GMSC in the home network of SMS
recipient
Figure 6.13.3‑1 above shows the signalling flow for transferring the short
message to a UE, through the terminating SMSC, using service-based interfaces.
0\. The originating SMSC forwards the SMS to the SMSC in the SMS recipient
MSISDN\'s home network.
1a. The UDM in the home network of the SMS recipient MSISDN registers with the
NRF for Nudm_SmsRoutingInfo service
1a. The SMSF registers with the NRF for Nnrf_MTForwardSM service. If the UE is
roaming in a visited PLMN, the SMSF and NRF both belong to the visited PLMN
2\. When the SMSC/SMS-GMSC in the home network receives the SMS from the
originating SMSC (step 0), the home SMSC/SMS-GMSC performs discovery of UDM NF
profile via NRF for sending the routing information query to the UDM.
3\. The SMSC/SMS-GMSC then invokes the Nudm_SmsRoutingInfo_Get request service
operation to the UDM instance discovered in step 2 for the recipient MSISDN.
The UDM provides the serving SMSF information in response.
4\. The SMSC/_SMS-GMSC invokes the Nnrf_NFDiscovery request to_ fetch SMSF
profile from NRF _._
5\. The SMSC/SMS-GMSC then invokes the Nsmsf_MTFormwardSM service operation to
transfer the short message to the SMSF. The SMSF provides delivery report in
Nsmsf_MTFormwardSM response.
### 6.13.4 Impacts on services, entities and interfaces
SMSF：
\- Support new Nsmsf_MTForwardSM service operation
\- Support registering the SMSF NF profile and SMSF NF service profile in NRF
SMS-GMSC:
\- Support invoking Nnrf_NFDiscovery to fetch UDM profile from NRF and Select
the UDM
\- Support invoking Nudm__SmsRoutingInfo_ _Get to get the serving routing
information for SMS
\- Support invoking Nnrf_NFDiscovery to fetch SMSF profile from NRF
\- Support invoking Nsmsf_ MTForwardSM to send MT SM to SMSF and receive
delivery report in Nsmsf_ MTForwardSM response.
UDM:
\- Support Nudm_ _SmsRoutingInfo_ service to provide routing information for
SMS.
NRF
\- Support the registration and discovery of SMSF NF profile and NF service
profile.
## 6.14 Solution #14: Protocol Selection \"Try and Error\"
This solution addresses Key Issue #5 \"mechanism for protocol selection\".
This solution is applicable for protocol selection in
\- SMSF towards SMS-IWMSC for MO-SMS and in
\- SMS-GMSC towards UDM/HSS/HLR for Routing Info Retrieval and in
\- SMS-GMSC towards SMSF for MT-SMS.
A NF that supports both legacy and SBA based protocols always tries to
discover via the local NRF a suitable NF service producer. If discovery is
successful, the SBA based protocol is selected; otherwise the legacy protocol
is selected.
## 6.15 Solution #15: Protocol Selection \"Local Configuration\"
This solution addresses Key Issue #5 \"mechanism for protocol selection\".
This solution is applicable for protocol selection in
\- SMSF towards SMS-IWMSC for MO-SMS and in
\- SMS-GMSC towards UDM/HSS/HLR for Routing Info Retrieval and in
\- SMS-GMSC towards SMSF for MT-SMS.
A NF that supports both legacy and SBA based protocols maintains a locally
configured static database that indicates per E.164 CC+NDC whether legacy
protocols shall be used or local NRF shall be contacted to discover a suitable
NF service producer. In the latter case, if no suitable NF service producer
could be discovered, fallback to legacy protocols is performed by the NF.
A NF may fallback to \"Try and Error\" method as explained in clause 6.14 in
the absence of a local configuration.
## 6.16 Solution #16: Protocol Selection \"Discovery during Routing Info
Retrieval\"
This solution addresses Key Issue #5 \"mechanism for protocol selection\".
This solution is applicable for protocol selection in
\- SMS-GMSC towards SMSF/SMS Router/IP-SM-GW for MT-SMS.
When an SMSF/SMS Router/IP-SM-GW registers at the UDM it indicates its support
of SBI based protocol for MT-SMS. The UDM stores this indication and provides
it to the SMS-GMSC during Routing Info retrieval.
The SMS-GMSC selects legacy or SBI based protocol based on the indication
received during Routing Info retrieval.
## 6.17 Solution #17: Inclusion of Interconnect indication when establishing
N32 connectivity
### 6.17.1 Description
This solution addresses Key Issue #4 \"Usage of N32 for PLMN Interconnect
Scenarios\".
Currently, N32 connectivity between SEPPs of two PLMNs is established when
SEPP determines the need. This is most likely established when NF Consumer,
e.g. AMF, requests to NF Producer, e.g. UDM, etc., to register a roaming
subscriber attempting to register on a VPLMN.
N32 can be established irrespective of whether there is roaming relationship
among two PLMNs. However, it is not beneficial to establish N32 connectivity
if there is no roaming relationship, as it requires unnecessary resources on
creating and maintaining the N32 connectivity. Therefore, SEPP should reject
the establishment of N32 connectivity based on roaming relationship.
If N32 connectivity is used also for SMS interconnect between subscribers for
two different PLMNs, additional purpose, i.e. interconnect, needs to be
considered for evaluating whether N32 connectivity can be established or
rejected.
To allow SEPPs to determine whether N32 connectivity can be established for
the necessary purposes, exchange of a new attribute that contains the purpose
of establishing N32 connectivity between SEPPs when initiating N32 handshake
shall be introduced so that pSEPP can determine whether to allow or reject the
requested N32 connectivity. The purpose of the N32 connectivity establishment
can include one or more purpose that can be for example Roaming, Interconnect,
Test prior to commercial launch, or any other.
### 6.17.2 Procedures
The procedure will follow the current N32 handshake procedure as defined in
clause 5.2.2 of 3GPP TS 29.573. During Security Capability Negotiation
Procedure, attributes \"SecNegoiateReqData\" and \"SecNegotiateRspData\" are
exchanged between initiating and responding SEPP.
Figure 6.17.2-1: Security Capability Negotiation Procedure
1\. In addition to existing attributes exchanged in the request, a new
attribute shall be sent from initiating SEPP to responding SEPP within
\"SecNegoiateReqData\" that contains the usage purpose of the intended N32
connectivity establishment.
2a. In addition to existing procedure defined in 3GPP TS 29.573, the
responding SEPP shall inspect the new attribute from Initiating SEPP
containing purpose of the intended N32 connectivity establishment, with the
policy that responding SEPP has. The policy can be the business relationship,
i.e. roaming, interconnect, test, any other, or in any combination. If the
purpose of the intended N32 connectivity establishment requested from
Initiating SEPP matches with the policy allowed by the responding SEPP, the
responding SEPP shall accept the request including the accepted purpose of the
N32 connectivity within the new attribute within \"SecNegotiateRspData\".
2b. If the purpose of the intended N32 connectivity establishment cannot be
accepted by the responding SEPP, the responding SEPP shall reject the request
including the reason in the ProblemDetails.
### 6.17.3 Impacts on services, entities and interfaces
SEPP:
\- support of new attributes within \"SecNegoiateReqData\" and
\"SecNegotiateRspData\" that exchanges requested/accepted purposes of N32
establishment during N32 handshake procedure
\- responding SEPP to support whether to accept or reject N32 establishment
can be accepted by relationship between the PLMNs
## 6.18 Solution #18: Inclusion of Interconnect indication over established
N32 connection
### 6.18.1 Description
This solution addresses Key Issue #4 \"Usage of N32 for PLMN Interconnect
Scenarios\".
Once N32 connectivity is established, SEPPs receive signaling from NF Consumer
and forward towards the NF Producer between two PLMNs, however SEPPs do not
consider whether each signaling can be forwarded or not based on the
relationship each PLMN has with their counterpart PLMN.
It should be possible to avoid unnecessary signaling to and from other PLMNs
to maintain the network. For roaming, currently this is achieved with
application-level logic where NF consumers, i.e. AMF, SMF, SMSF, abort further
processing once it receives an HTTP error status code with ProblemDetails
including ROAMING_NOT_ALLOWED when attempting to register on Nudm_UECM
Services. However, this will not work for the case of interconnect, as
interconnect cannot be rejected using Nudm_UECM Services. Therefore, SEPPs
should be able to evaluate the purpose of each signaling, and whether it is
allowed or subject to rejection based on business or any other relationship
that should be configured on SEPP.
In order to allow SEPPs to evaluate the purpose of each signaling, a new HTTP
custom header that includes the purpose shall be introduced. NF Consumer
should include in each request the purpose of each signaling, i.e. Roaming,
Interconnect, general, test, any other or in any combination. SEPPs should
verify whether the intended signaling can be transferred to the NF producer
based on the business or any other relationship, that can be locally
configured.
### 6.18.2 Procedures
The following procedures are considered.
Figure 6.18.2-1: Procedure on SEPP evaluation taking account relationship of
PLMNs
1\. NF Consumer will include the purpose, e.g. roaming, interconnect, general,
test, in the request destined to another PLMN in an HTTP custom header.
2\. cSEPP will check the content HTTP custom header and evaluate whether the
requested purpose of the request can be sent towards the other PLMN, based on
relationship with the other network.
3a. If the evaluation in step2 is allowed to forward, the signaling is
forwarded to the pSEPP.
3b. If the evaluation in step2 is rejected due to the relationship, a response
message is sent back to the NF Consumer with an appropriate HTTP status code.
4\. pSEPP will check the content HTTP custom header and evaluate whether the
requested purpose of the request can be accepted from the other PLMN, based on
relationship with the other network.
5a. If the evaluation in step4 is allowed to forward, the signaling is
forwarded to the pSEPP.
5b. If the evaluation in step4 is rejected due to the relationship, a response
message is sent back the result to the NF Consumer with an appropriate HTTP
status code.
6\. NF Producer will apply necessary procedures defined for the NF Producer.
7\. NF Producer will return
### 6.18.3 Impacts on services, entities and interfaces
NF Consumer
\- support of new HTTP Custom Header, that includes the purpose of the
signaling and included in the HTTP Request.
SEPP:
\- support of new HTTP Custom Header, that is included in the received HTTP
request and used for evaluating whether the request can be forwarded to the
next hop based on the relationship with the PLMNs.
\- ability to reject the requested HTTP request in case the relationship
between the two PLMNs does not meet the purpose of the request.
## 6.19 Solution #19: Mechanism to select the target PLMN based on GPSI in the
case of Indirect Communication with Delegated Discovery
### 6.19.1 Introduction
This solution addresses Key Issue #3 \"Mechanism to select the target PLMN
based on GPSI when using SBI\". Introduces the solution on selection of target
PLMN based on GPSI in Indirect Communication with Delegated Discovery.
### 6.19.2 Description
For Indirect Communication with Delegated Discovery, when the NF service
consumer is configured to use delegated service discovery, it includes the
necessary NF service discovery factors in the HTTP/2 request message to be
used by the SCP to perform the NF service discovery procedures on behalf of
the NF service consumer.
Impacts to procedures described in solution #3:
The NF service consumer (e.g. SMS-GMSC) sends NF service request to the NF
service producer using SBI to the SCP (e.g. step 8a in Figure 6.3.3.1, or step
14a in Figure 6.3.3.2, or step 11a in Figure 6.3.3.3), then SCP performs the
NF service discovery procedures as step 1 in all figures.
Impacts to procedures described in solution #12:
SMS-GMSC performs routing information retrieval from the UDM by sending the
Nudm Routing Info query as defined in step 9a to SCP, then SCP performs the NF
service discovery procedures from step4. Step 4 to 8 in Figure 6.12.3.1‑1 and
step 2 to 8 in Figure 6.12.3.2‑1 will be performed by the SCP.
### 6.19.3 Procedures
The following clause illustrates the procedures to determine the correct PLMN
ID to route the routing information retrieval request to the UDM in the SMS
recipient\'s subscription network in indirect Communication with Delegated
Discovery. Two procedures are included in this clause:
\- SCP delegates the MSISDN-to-Subscription-Network resolution to the local
NRF during UDM discovery.
\- SCP supports the MSISDN-to-Subscription-Network resolution to the MNP NF
before UDM discovery.
#### 6.19.3.1 SCP delegating the MSISDN-to-Subscription-Network resolution to
the local NRF during UDM discovery
Figure 6.19.3.1-1 shows the procedure to select the target PLMN when the SCP
delegating the MSISDN-to-Subscription-Network resolution to the local NRF
during UDM discovery in indirect Communication with Delegated Discovery.
Figure 6.19.3.1-1 SCP delegating the MSISDN-to-Subscription-Network resolution
to the local NRF
1\. SMS-GMSC sends routing information retrieval request to the SCP.
2\. SCP sends UDM discovery request to the local NRF.
3\. Local NRF determines target PLMN ID based on information received from NP
Server which could be the MNP NF or the DNS/ENUM Server. Alternatively, local
NRF also could determines target PLMN ID based on local configuration.
4\. Local NRF matches the UDM instances based on target PLMN ID returned from
NP query and other parameters in UDM discovery request from the SCP.
5\. Local NRF returns UDM discovery response to the SCP.
6\. SCP sends routing information retrieval request to the UDM.
7\. UDM returns routing information retrieval response to the SCP.
8\. SCP forwards routing information retrieval response to the SMS-GMSC.
#### 6.19.3.2 SCP supports the MSISDN-to-Subscription-Network resolution to
the MNP before UDM discovery
The procedure covers both direct and indirect routing based MNP
implementation.
Figure 6.19.3.2-1 SCP supports the MSISDN-to-Subscription-Network resolution
to the MNP (Direct Routing)
Figure 6.19.3.2-1 above shows the signalling flow diagram that in indirect
Communication with Delegated Discovery, the SCP is the service consumer of the
MSISDN-to-Subscription-Network resolution service in MNP NF and routes an SBI
message based on MSISDN when direct routing of MNP is implemented.
1\. MNP NF registers to the NRF.
2\. In indirect Communication with Delegated Discovery, SMS-GMSC sends routing
information retrieval request to the SCP.
3-4. SCP discovers MNP NF via NRF.
5-6. SCP sends a NP status query request to MNP NF for the recipient MSISDN.
MNP NF checks the portability status of the recipient MSISDN and responds back
with the target PLMN ID. Alternatively the MNP NF may also return a Routing
Number (RN) or a URI using which the SCP can identify the target PLMN ID.
7-8. SCP discovers the UDM from NRF with the target PLMN ID received in step
6. If the target PLMN ID is not the own network, the local NRF forwards the
discovery request to the NRF of the target PLMN.
9-10. SCP further performs routing information retrieval to the UDM, based on
the UDM profiles received in discovery response from NRF in step 8.
11\. SCP forwards routing information retrieval response from the UDM to the
SMS-GMSC.
Figure 6.19.3.2-2 SCP supports the MSISDN-to-Subscription-Network resolution
to the MNP (Indirect Routing)
Figure 6.19.3.2-2 above shows the signalling flow diagram that in indirect
Communication with Delegated Discovery, the SCP is the service consumer of the
MSISDN-to-Subscription-Network resolution service in the MNP NF and routes an
SBI message based on MSISDN when indirect routing of MNP is implemented.
1\. MNP NF registers to the NRF.
2\. In indirect Communication with Delegated Discovery, SMS-GMSC sends routing
information retrieval request to the SCP.
3-4. SCP discovers MNP NF via NRF. The MNP NF belongs to the number range
holder PLMN. SCP sets the target PLMN ID in the discovery request to the
number range holder PLMN. If the number range holder is a different PLMN then
the local NRF forwards the discovery request to the NRF of the number range
holder PLMN.
5-6. SCP sends a NP status query request to MNP NF for the SMS recipient
MSISDN. MNP NF checks the portability status of the recipient MSISDN and
responds back with the target PLMN ID. Alternatively the MNP NF may also
return a Routing Number (RN) or a URI using which the SMS-GMSC can identify
the target PLMN ID.
7-8. SCP discovers the UDM from NRF with the target PLMN ID received in step
6. If the target PLMN ID is not own network, the NRF forwards the discovery
request to the NRF of the target PLMN.
9-10. SCP further performs routing information retrieval from the UDM, based
on the UDM profiles received in discovery response from NRF in step 8.
11\. SCP forward routing information retrieval response from the UDM to the
SMS-GMSC.
### 6.19.4 Impacts on services, entities and interfaces
SMS-GMSC:
\- Support SBI interface to UDM.
\- Support to include the NF service discovery factors for service discovery
request based on GPSI.
SCP:
\- Support service discovery request based on GPSI using NRF.
\- Support Discovery of MNP NF profiles from NRF.
\- Support SBI interface towards MNP NFs to retrieve the target PLMN ID.
\- Support service discovery request based on target PLMN ID using NRF.
# 7 Evaluations and Conclusions
This clause evaluates the potential solutions described in clause 5 and
provides conclusions.
Each clause will evaluate the solutions for one key issue, and concludes on
the solution for that key issue.
## 7.1 Evaluation and Conclusions of Solutions for Key Issue#1
### 7.1.1 Evaluation
For Key Issue #1 -- \"SBI-based SM MT message transfer\", candidates Solution
#1, Solution #13 and a solution group (including Solution#4, #6, #7, #8, #9,
#10) have been proposed.
Candidate Solution #1 proposes to introduce new services for MT SMS Delivery,
MT SMS Delivery Report, Routing Information, Alert SC and so on. These new
services are registered in NRF and can be queried by NF service consumers.
Procedures and node functionality enhancements for SBI-based MT SMS are also
introduced in this solution.
Candidate Solution #13 introduces an alternative solution for MT SMS transfer
in SMS Home routing scenario, where the SMS is first transferred to the
SMSC/SMS-GMSC of the recipient\'s home network.
Candidate solution group (including Solution#4, #6, #7, #8, #9, #10)
introduces SMS transfer in the cases of MT SM transfer, MT SM transfer via SMS
Router/IP-SM-GW, unsuccessful MT SM transfer via SMS Router/IP-SM-GW,
unsuccessful MT SM transfer, alert and alert the recovery of UE memory for
SMS. In this solution group, new services are also defined.
In order to fulfil SBI-based SM MT, the three candidate solutions share the
same method: new services for SM MT are defined and registered in NRF, and
then service consumers can query NRF and invoke the services.
Editor\'s Note: The three candidate solutions can be merged for conclusion.
### 7.1.2 Conclusion
## 7.1 Evaluation and Conclusions of Solutions for Key Issue#1
### 7.1.1 Evaluation
For Key Issue #1 -- \"SBI-based SM MT message transfer\", candidates Solution
#1, Solution #13 and a solution group (including Solution#4, #6, #7, #8, #9,
#10) have been proposed.
Candidate Solution #1 proposes to introduce new services for MT SMS Delivery,
MT SMS Delivery Report, Routing Information, Alert SC and so on. These new
services are registered in NRF and can be queried by NF service consumers.
Procedures and node functionality enhancements for SBI-based MT SMS are also
introduced in this solution.
Candidate Solution #13 introduces an alternative solution for MT SMS transfer
in SMS Home routing scenario, where the SMS is first transferred to the
SMSC/SMS-GMSC of the recipient\'s home network.
Candidate solution group (including Solution#4, #6, #7, #8, #9, #10)
introduces SMS transfer in the cases of MT SM transfer, MT SM transfer via SMS
Router/IP-SM-GW, unsuccessful MT SM transfer via SMS Router/IP-SM-GW,
unsuccessful MT SM transfer, alert and alert the recovery of UE memory for
SMS. In this solution group, new services are also defined.
In order to fulfil SBI-based SM MT, the three candidate solutions share the
same method: new services for SM MT are defined and registered in NRF, and
then service consumers can query NRF and invoke the services.
Editor\'s Note: The three candidate solutions can be merged for conclusion.
### 7.1.2 Conclusion
According to the evaluation for KI#1, new services for SM MT should be defined
and the following conclusions are agreed:
\- Updates of SBI-based 5G SM MT in stage 2 TS are needed, including:
\- Network architecture for SBI-based SM MT message transfer;
\- Procedures for SBI-based SM MT, including MT SMS Delivery, MT SMS Delivery
Report, Routing Information, Alert SC and so on;
\- Updates of network function enhancements for 5G SM MT are needed,
including:
\- Updates of UDM in TS29.503;
\- Updates of SMSF in TS29.540;
\- Updates of data types in TS29.571;
\- New TSs (stage3) for node functionalities that service based interfaces are
introduced in should be added, including:
\- SMS-GMSC;
\- SMS Router;
\- IP-SM-GW;
## 7.2 Evaluation and Conclusions of Solutions for Key Issue#2
### 7.2.1 Evaluation
For Key Issue #2 -- \"SBI-based SM MO message transfer\", candidates Solution
#2 and a solution group (including Solution#5 and #11) have been proposed.
Candidate Solution #2 proposes to introduce new services for MO SMS Submit, MO
SMS Delivery Report, MSISDN-less MO SMS, and so on. These new services are
registered in NRF and can be queried by NF service consumers. Procedures and
node functionality enhancements for SBI-based MO SMS are also introduced in
this solution.
Candidate solution group (including Solution#5 and #10) introduces SMS
transfer in the cases of MO SM transfer and unsuccessful MO SM transfer. In
this solution group, new services are also defined.
In order to fulfil SBI-based SM MO, the two candidate solutions share the same
method: new services for SM MO are defined and registered in NRF, and then
service consumers can query NRF and invoke the services.
Editor\'s Note: The two candidate solutions can be merged for conclusion.
### 7.2.2 Conclusion
According to the evaluation for KI#2, new services for SM MO should be defined
and the following conclusions are agreed:
\- Updates of SBI-based 5G SM MO in stage 2 TS are needed, including:
\- Network architecture for SBI-based SM MO message transfer;
\- Procedures for SBI-based SM MO, including MO SMS Submit, MO SMS Delivery
Report, MSISDN-less MO SMS and so on;
\- Updates of network function enhancements for 5G SM MO are needed,
including:
\- Updates of UDM in TS29.503;
\- Updates of SMSF in TS29.540;
\- Updates of NEF;
\- Updates of SMS-SC;
\- Updates of data types in TS29.571;
\- New TSs (stage3) for node functionalities that service based interfaces are
introduced in should be added, including:
\- SMS-IWMSC;
## 7.3 Evaluation and Conclusions of Solutions for Key Issue#3
### 7.3.1 Evaluation
There are multiple solutions proposed for KI#3. The Table 7.3.1-1 below lists
down the various pros and cons identified for each solution.
Table 7.3.1-1: Pros and Cons of solutions for KI#3
+--------------+--------------------------+--------------------------+ | Solution Id | Pros | Cons | +==============+==========================+==========================+ | Solution#3 | 1. All the processing | 1. The NRF must support | | | logic of determining | ENUM application logic | | | target PLMN ID and | which is beyond the | | | whether to use SBI or | functional scope of the | | | legacy protocol for SMS | NRF as defined by stage | | | termination resides at a | 2. Also, it is not the | | | central NF i.e. in the | responsibility of the | | | NRF. It reduces the | NRF to determine the | | | impact on SMS-GMSC as it | recipient\'s | | | does not have to | subscription PLMN ID. | | | determine the target | | | | PLMN ID or number | 2. NRF will have to | | | portability information. | process request for | | | | every UE when the SBI | | | 2. The proposal | message needs to be | | | leverages already | routed on GPSI i.e. for | | | defined and widely used | every MT SMS delivery | | | services and procedures, | procedure. This will | | | such as the discovery | significantly increase | | | procedure using NRF and | the number of requests | | | the existing DNS/ENUM | to be processed by the | | | and Number Portability | NRF. | | | services. | | | | | NOTE: A discovery | | | | request for every UE is | | | | already required for | | | | discovery requests based | | | | on GPSI in the HPLMN | | | | when segmentation based | | | | on GPSI ranges is not | | | | used. | | | | | | | | 3. If the interface is | | | | not determined by local | | | | configuration in the NRF | | | | and SBI is to be used, | | | | it is required | | | | configuration or | | | | provisioning of the | | | | MSISDN (individual or | | | | number series) in | | | | DNS/ENUM to obtain the | | | | target NRF URI or NP | | | | information for the NRF | | | | to determine the target | | | | PLMN. | +--------------+--------------------------+--------------------------+ | Solution#12 | 1. The introduction of | 1. The responsibility | | | a new MNP NF in 5GS is | to discover the target | | | aligned with a general | PLMN is left to the | | | strategy of network | service consumer (e.g. | | | architecture evolution | the SMS-GMSC in the | | | to SBA. The NP service | context of SMS). Every | | | evolution to SBA can be | service consumer that | | | adopted in other use | needs to discover the | | | cases and procedures | target PLMN based on the | | | (e.g. in IMS). | MSISDN must support the | | | | new MNP functionality. | | | | | | | | 2. The definition of a | | | | new MNP NF and service | | | | in SBA potentially | | | | implies higher normative | | | | work than Solution #3. | | | | | | | | 3. The local | | | | configuration in the | | | | service consumer to | | | | determine the target | | | | PLMN might become | | | | complex (e.g. for | | | | international SMS | | | | termination). The local | | | | configuration must map | | | | the MSISDN (e.g. CC+NDC) | | | | to target PLMN ID for | | | | every PLMN (number range | | | | holder network) and | | | | country. This | | | | configuration must be | | | | applied and kept updated | | | | in all the service | | | | consumers. | | | | | | | | NOTE: This local | | | | configuration can be | | | | done in service | | | | consumers, but it also | | | | could be done in the | | | | local NRF; this approach | | | | (local configuration of | | | | the mapping CC+NDC to | | | | MCC/MNC done in local | | | | NRF) would be common to | | | | Solution #3 and | | | | Solution #12. | +--------------+--------------------------+--------------------------+ | Solution#19 | 1. The proposal defines | 1. For SCP delegating | | | how the SCP discovers | the | | | the UDM based on the | MSISDN | | | target PLMN ID of the | -to-Subscription-Network | | | service producer in case | resolution to the local | | | of Indirect | NRF, same cons as | | | Communication with | solution#3. | | | Delegated Discovery | | | | (Model D), which align | 2. For SCP supports the | | | with the eSBA | MSISDN | | | architecture. | -to-Subscription-Network | | | | resolution to the MNP, | | | 2. For SCP delegating | same as solution#12. | | | the | | | | MSISDN | | | | -to-Subscription-Network | | | | resolution to the local | | | | NRF, same pros as | | | | solution#3. | | +--------------+--------------------------+--------------------------+
### 7.3.2 Conclusion
The following conclusions are agreed:
\- Introduction of a New Network Function MNP as described in solution #12 is
recommended. The MNP offers a service allowing consumer NFs to retrieve a
UE\'s subscription network (PLMN-ID) by providing the UE\'s identity,
especially when the UE is identified by an MSISDN.
\- For the determination of the UE\'s subscription network, two alternatives
are recommended:
\- The MSISDN-to-Subscription-Network resolution service of the MNP NF may be
consumed by the SMS-GMSC before the UDM (in the subscription network) is
discovered, selected and queried for routing information.
\- The MSISDN-to-Subscription-network resolution may be delegated from the
SMS-GMSC to the local NRF during UDM discovery, as described in solution #3.
The local NRF may, then, consume the SBI services of the MNP NF, or as an
implementation choice, it can determine the UE\'s subscription network by
other means (e.g. local configuration, or direct ENUM query). The NRF provides
in the response the identity of the subscription network and its SMS protocol
support (SBI or legacy).
\- In Indirect Communication with Delegated Discovery, the service consumer
delegates service discovery to the SCP. In NP scenario, discovering the UDM in
UE\'s subscription network could be supported by the SCP. Summarized in
Solution #19, two alternatives recommended will be enhanced for the
determination of the UE\'s subscription network in case of Indirect
Communication with Delegated Discovery:
\- the SCP may support the MSISDN-to-Subscription-network resolution from the
MNP NF before UDM discovery; or
\- the SCP may delegate the MSISDN-to-Subscription-network resolution to the
local NRF during UDM discovery.
## 7.4 Evaluation and Conclusions of Solutions for Key Issue#4
### 7.4.1 Evaluation
Solution #17 and #18 has been proposed as the solution for Key issue#4 (Usage
of N32 for PLMN Interconnect Scenarios). The two solutions are independent
from each other, and both can be considered at the same time.
Solution #17 has benefit that allows operators to control whether N32 can be
established and used for intended purpose, that would allow operators with
efficient resource management, i.e. TLS management or any other required to
maintain N32 connectivity. As this would provide benefit to operation of each
network operators, introducing the capabilities for Solution #17 should be
considered.
Solution #18 has benefit that evaluation of each signaling per purpose at SEPP
is easier since NF Consumer will include the purpose in the HTTP Custom
Header. This will also help monitoring signaling exchanged between different
PLMNs, to monitor the purpose of the signaling. As this would provide benefit
to operation of each network operators, introducing the capabilities for
Solution #18 should be considered.
### 7.4.2 Conclusion
It is proposed that both Solution #17 and #18 are adopted to respective
specifications.
## 7.5 Evaluation and Conclusions of Solutions for Key Issue#5
### 7.5.1 Evaluation
There are multiple solutions proposed for KI#5. The Table 7.5.1-1 below lists
down the various pros and cons identified for each solution.
Table 7.5.1-1: Pros and Cons of solutions for KI#5
+--------------+--------------------------+--------------------------+ | Solution Id | Pros | Cons | +==============+==========================+==========================+ | Solution#3 | 1. The solution allows | see Cons for Solution#3 | | | an NF service consumer | in clause 7.3.1. | | | to get information about | | | | both the target PLMN and | | | | the interface to be used | | | | (SBI or legacy | | | | interface) through a | | | | single interaction with | | | | NRF, based on the | | | | information received in | | | | the discovery response, | | | | as it is done in other | | | | cases (e.g. PCF | | | | discovery for Rx/SBI | | | | interface). | | | | | | | | 2. It would be possible | | | | to differentiate MSISDNs | | | | for which SBI or legacy | | | | interface can be used | | | | (e.g. deployments with | | | | 5G-only devices for IoT | | | | and devices that can use | | | | any access) via | | | | provisioning or | | | | configuration in ENUM. | | | | | | | | 3. The decision on the | | | | interface for | | | | interconnection (SBI or | | | | non-SBI) is proposed to | | | | be determined always by | | | | the local NRF, rather | | | | than relying on | | | | interconnection | | | | agreements between other | | | | PLMNs (e.g. between | | | | transit and target | | | | PLMNs). | | +--------------+--------------------------+--------------------------+ | Solution#14 | 1. This solution is | 1. It is required a | | | simple as it relies on | discovery request to NRF | | | existing NRF discover | just for the purpose to | | | mechanisms: If a | determine the interface | | | required service cannot | to be used. | | | be discovered then | | | | legacy protocols are | | | | used. | | | | | | | | 2. The mechanism | | | | proposed to determine | | | | the interface to be used | | | | based on the discovery | | | | response from NRF is | | | | aligned with Solution | | | | #3. | | +--------------+--------------------------+--------------------------+ | Solution#15 | 1. This solution allows | 1. The local | | | to skip signalling | configuration in the | | | interactions between | service consumer to | | | SMS-GMSC and NRF/MNP for | determine the interface | | | cases where local | to be used for every | | | configuration indicates | PLMN and country might | | | that legacy protocols | become large and | | | must be used. | requires to know the | | | | deployment of each | | | | target PLMN. This | | | | configuration must be | | | | applied and kept updated | | | | in all the service | | | | consumers. | +--------------+--------------------------+--------------------------+ | Solution#16 | 1. NRF discovery of the | | | | SMSF/IP-SM-GW/SMS Router | | | | can be skipped by the | | | | SMS-GMSC when the UDM | | | | indicates during Routing | | | | Info retrieval that the | | | | SMSF does not offer the | | | | SMS-SBI service. | | | | | | | | For the case of MT SMS | | | | through IP-SM-GW/SMS | | | | Router, there is a | | | | situation that SMSF | | | | supports SBI, but | | | | IP-SM-GW/SMS Router only | | | | supports legacy | | | | interface. solution#16 | | | | can avoid using SBI when | | | | some of the NFs or | | | | function nodes do not | | | | support SBI. | | +--------------+--------------------------+--------------------------+
Editor\'s Note: Evaluation of Solutions #3, #14 and #15 still needs to be
completed.
### 7.5.2 Conclusion
Besides the determination of the target PLMN based on the GPSI, covered by
KI#3, it is needed to define a mechanism to select the protocol to be used for
the interaction with the target PLMN, as required by KI#5.
The mechanism for protocol selection based on the service discovery response
from the NRF is recommended for normative work, without excluding the
possibility to use local configuration, as proposed by Solution #15.
In this sense, Solution #14 proposes to select the protocol based on the
service discovery response, though requires that the NF service consumer
determines the target PLMN before sending the discovery request.
For the case of MT SMS through IP-SM-GW/SMS Router, it is suggested to let
SMS-GMSC to select protocol according to the indication of whether SMSF/ IP-
SM-GW/SMS Router support SBI during Routing Info Retrieval procedure, as
described in Solution#16.
Solution #3 proposes a mechanism for the NF service consumer to determine both
the target PLMN and the interface to be used through a single interaction with
the NRF, based on the information received in the discovery response.
A possible combination of Solution #3 and Solution #12 would also provide the
mechanism to determine the target PLMN and the protocol to be used based on
the discovery response from the NRF.
Editor\'s Note: Conclusion of Solutions for KI#5 still needs to be completed.
#
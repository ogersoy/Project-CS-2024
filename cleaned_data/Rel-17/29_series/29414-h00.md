# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies the bearer data transport and bearer control
protocols used between MGWs within the CS core network across the Nb
Interface. The present document assumes that the implementation of the split
of the call control and the bearer transport and control, as specified in 3GPP
TS 23.205 [1] with BICC-based Nc, and in 3GPP TS 23.231 [30] with SIP-I based
Nc,, see figure 1. For BICC-based Nc, the User Plane protocol that uses this
bearer data transport (Nb UP) is described in 3GPP TS 29.415 [3]. The
transport format for the Nb interface with IP transport can optionally allow
RTP multiplexing. Note that the present document does not preclude an
implementation of a combined MSC Server and MGW.
Figure 1: CS core network logical architecture
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document in the same
Release as the present document.
[1] 3GPP TS 23.205: \"Bearer Independent CS Core Network; Stage 2\".
[2] 3GPP TS 25.414: \"UTRAN Iu Interface Data Transport and Transport
Signalling\".
[3] 3GPP TS 29.415: \"Core Network Nb Interface User Plane Protocols\".
[4] 3GPP TS 29.232: \"Media Gateway Controller (MGC) -- Media Gateway (MGW)
Interface; Stage 3\".
[5] ITU-T Recommendation E.164 (5/1997): \"Numbering Plan for the ISDN Era\".
[6] ITU-T Recommendation I.361 (2/1999): \"B-ISDN ATM Layer Specification\".
[7] ITU-T Recommendation I.363.2 (11/2000): \"B-ISDN ATM Adaptation Layer Type
2 Specification\".
[8] ITU-T Recommendation I.363.5 (8/1996): \"B-ISDN ATM Adaptation Layer Type
5 Specification\".
[9] ITU-T Recommendation I.366.1 (6/1998): \"Segmentation and Reassembly
Service Specific Convergence Sublayer for the AAL Type 2\".
[10] ITU-T Recommendation H.248 (6/2000)\"Media Gateway Control Protocol\".
[11] 3GPP TS 29.205: \"Application of Q.1900 Series to Bearer Independent CS
Core Network Architecture\".
[12] (Void)
[13] (Void)
[14] ITU-T Recommendation Q.2110 (7/1994): \"B-ISDN ATM Adaptation Layer-
Service Specific Connection Oriented Protocol (SSCOP)\".
[15] ITU-T Recommendation Q.2140 (2/1995): \"B-ISDN ATM Adaptation Layer-
Service Specific Coordination Function for Support of Signalling at the
Network Node Interface (SSCF-NNI)\".
[16] ITU-T Recommendation Q.2150.1 (1999): \"B-ISDN ATM Adaptation Layer-
Signalling Transport Converter for the MTP3b\".
[17] ITU-T Recommendation Q.2210 (7/1996): \"Message Transfer Part level 3
functions and messages using the services of ITU-T Recommendation Q.2140\".
[18] ITU-T Implementor\'s guide (12/99) for recommendation Q.2210 (07/96).
[19] ITU-T Recommendation Q.2630.2 (12/2000): \"AAL type 2 Signalling Protocol
(Capability Set 2)\".
[20] ITU-T Recommendation Q.2931 (2/1995): \"Digital Subscriber Signalling
System No. 2 (DSS 2) -- User-Network Interface (UNI) layer 3 specification for
basic call/connection control\".
[21] ITU-T Recommendation X.213 (8/1997): \"Information Technology-Open
Systems Interconnection-Network Service Definitions\".
[22] IETF RFC 768: \"User Datagram Protocol. (UDP)\".
[23] IETF RFC 791: \"Internet Protocol (IP)\".
[24] IETF RFC 1889: \"RTP: A Transport Protocol for Real Time Applications\".
[25] IETF RFC 1890: \"RTP Profile for Audio and Video Conferences with Minimal
Control\".
[26] IETF RFC 2327: \"SDP: Session Description Protocol\".
[27] IETF RFC 2460: \"Internet Protocol, Version 6 (IPv6)\".
[28] 3GPP TR 29.814: \"Feasibility Study on Bandwidth Savings at Nb Interface
with IP transport\".
[29] IETF RFC 3550: \"RTP: A Transport Protocol for Real-Time Applications\".
[30] 3GPP TS 23.231: \" SIP-I based circuit-switched core network; Stage 2\".
[31] 3GPP TS 25.415: \"UTRAN Iu Interface User Plane Protocols\"
[32] 3GPP TS 26.102: \"Adaptive Multi-Rate (AMR) speech codec; Interface to Iu
and Uu\".
[33] IETF RFC 3551: \"RTP Profile for Audio and Video Conferences with Minimal
Control\".
[34] IETF RFC 3555: \"MIME Type Registration of RTP Payload Formats\".
[35] IETF RFC 4867: \"**Real-Time Transport Protocol (** RTP) payload format
and file storage format for the Adaptive Multi-Rate (AMR) Adaptive Multi-Rate
Wideband (AMR-WB) audio codecs\".
[36] 3GPP TS 29.007: \"General requirements on interworking between the Public
Land Mobile Network (PLMN) and the Integrated Services Digital Network (ISDN)
or Public Switched Telephone Network (PSTN)\" .
[37] 3GPP TS 26.445:\"Codec for Enhanced Voice Services (EVS); Detailed
Algorithmic Description\".
38] 3GPP TS 26.453: \"Codec for Enhanced Voice Services (EVS); Speech codec
frame structure\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the following terms and definitions
apply.
## 3.2 Abbreviations
For the purposes of the present document, the following abbreviations apply:
AAL ATM Adaptation Layer
AAL2 ATM Adaptation Layer Type 2
AAL5 ATM Adaptation Layer Type 5
AESA ATM End System Address
ALC AAL2 Link Characteristics
ARP Address Resolution Protocol
ATM Asynchronous Transfer Mode
AVP Audio Video Profile
BICC Bearer Independent Call Control
CMR Codec Mode Request
CN Core Network
CSRC Contributing Source
DSS2 Digital Subscriber Signalling 2
> EVS Enhanced Voice Services
EVS-CMR Codec Mode Request for EVS
IANA Internet Assigned Numbering Authority
IP Internet Protocol
IPv4 Internet Protocol version 4
IPv6 Internet Protocol version 6
IPBCP IP Bearer Control Protocol
ITU-T International Telecommunications Union-Telecommunication sector
IuFP Iu Framing protocol
MGW Media GateWay
MIME Multi purpose Internet Mail Extension
MTP3b Message Transfer Part level 3 for Q.2140 [15]
NNI Network Node Interface
NSAP Network Service Access Point
PDU Protocol Data Unit
PVC Permanent Virtual Circuit
RFC Request For Comment
RTP Real-Time Transport Protocol
RTCP Real-Time Transport Control Protocol
SAR Segmentation and Reassembly
SCCF-NNI Service Specific Coordination Function-Network Node Interface
SDP Session Description Protocol
SDU Service Data Unit
SID Silence Insertion Descriptor
SPVC Switched PVC
SSSAR Service Specific Segmentation and Re-assembly sublayer
SSCOP Service Specific Connection Oriented Protocol
SSCS Service Specific Convergence Sublayer
SSRC Synchronisation Source
SVC Switched Virtual Circuit
**TrFO Transcoder Free Operation**
UDP User Datagram Protocol
UNI User Network Interface
UP User Plane
VC Virtual Circuit
# 4 General
The Nb UP shall be transported either over an ATM or IP bearer.
# 5 Transport over ATM for BICC-based Nc
## 5.1 General
Clause 5 is only applicable in combination with BICC-based Nc.
ATM shall be used in the transport network user plane and the transport
network control plane according to ITU-T Recommendation I.361 [6]. The
structure of the ATM cell header used across the Nb interface shall be the
cell header format and encoding at the NNI (see Figure 3 in I.361 [6]).
## 5.2 Transport network user plane
### 5.2.1 General
Figure 2 shows the ATM protocol stack used for the transport network user
plane on the Nb interface.
* * *
_AAL-2 SAR SSCS (I.366.1)_ _AAL2 (I.363.2)_ _ATM_
* * *
Figure 2: ATM protocol stack used for the transport network user plane
ATM AAL2 connections shall be transported over a VC which may either be a PVC,
an SPVC or an SVC. For every ATM implementation of the Nb interface, a PVC
shall be supported. The support of an SPVC or an SVC is optional. An ATM
implementation may either support SPVCs only, SVCs only, or both.
If SPVCs or SVCs are supported, DSS2 signalling [20] shall be used for the
establishment and tear down of these VCs. The network element that generated a
given switched VC shall be the only network element that is allowed to tear
down this VC.
### 5.2.2 ATM Adaptation Layer 2
#### 5.2.2.1 AAL2-Segmentation and Reassembly Service Specific Convergence
Sublayer
Service Specific Segmentation and Reassembly (SSSAR) sublayer of ITU-T
Recommendation I.366.1 [9] shall be used for the segmentation and reassembly
of AAL2 SDUs (i.e. only SSSAR is used from I.366.1 [9]).
#### 5.2.2.2 AAL2-specification
AAL2 shall be used according to ITU-T Recommendation I.363.2 [7].
## 5.3 Transport network control plane
### 5.3.1 General
Figure 3 shows the protocol stack for the transport network control plane on
the Nb interface.
* * *
_AAL2 connection signalling (_ Q.2630.2 _)_ _AAL2 Signalling Transport
Converter for MTP3b (_ Q.2150.1 _)_ _MTP3b_ _SSCF-NNI_ _SSCOP_ _AAL5_ _ATM_
* * *
Figure 3: ATM protocol stack for the transport network control plane
Tunnelling, as described in 3GPP TS 23.205 [1], is currently not specified to
transport the ATM transport network control plane.
### 5.3.2 Signalling protocol
#### 5.3.2.1 AAL2 Signalling Protocol
ITU-T Q.2630.2 [19] shall be used for the establishment of AAL2 connections.
The AAL2 transport layer uses the embedded E.164 [5] or AESA variants of the
NSAP addressing formats [21]. Native E.164 addressing shall not be used.
The MGW which issues a given ESTABLISH request [19] provides a Binding
Reference (see 3GPP TS 23.205 [1]), This binding reference shall be copied
into the SUGR parameter of the corresponding ESTABLISH request primitive [19].
The AAL2 Link Characteristics parameter (ALC) in the Establish Request message
of the AAL2 signalling protocol shall be used.
### 5.3.3 Signalling transport converter
#### 5.3.3.1 AAL2 MTP3B Signalling Transport Converter
The AAL2 MTP3b Signalling Transport Converter shall be used according to ITU-T
Recommendation Q.2150.1 [16].
### 5.3.4 MTP3b
MTP3b shall be used according to ITU-T Recommendation Q.2210 [17 & 18].
### 5.3.5 SSCF-NNI
SSCF-NNI shall be used according to ITU-T Recommendation Q.2140 [15].
### 5.3.6 SSCOP
SSCOP shall be used according to ITU-T Recommendation Q.2110 [14].
### 5.3.7 ATM Adaptation Layer Type 5
AAL5 shall be used according to ITU-T Recommendation I.363.5 [8]
# 6 Transport over IP for BICC based Nc
## 6.1 General
Clause 6 is only applicable in combination with BICC-based Nc.
RTP (RFC 1889 [24] or RFC 3550 [29]) over UDP (RFC 768 [22]) over either IPv4
(RFC 791 [23]) or IPv6 (RFC 2460 [27]) shall be used in the transport network
user plane. The present specification takes the role of an RTP profile in
describing the transport of the Nb UP protocol by RTP. Figure 4 shows the
protocol stack for the transport network user plane on the Nb interface.
* * *
_RTP_ _UDP_ _IPv4 or IPv6_
* * *
Figure 4: IP Protocol stack for the transport network user plane
Tunnelling, as described in 3GPP TS 23.205 [1], shall be used to transport the
IP bearer control protocol IPBCP conform the ITU-T Recommendation Q.1970
\"BICC IP Bearer Control Protocol\" (IPBCP) (see 3GPP TS 29.205 [11]).
## 6.2 Bearer Transport without multiplexing
### 6.2.0 Introduction
The support of bearer transport without multiplexing shall be supported. It
shall be applied unless a bearer transport with multiplexing is negotiated via
RTCP, as decribed in clause 6.4.3.
### 6.2.1 IP
Either IPv4 (RFC 791 [23]) or IPv6 (RFC 2460 [27]) shall be used.
One MGW may have several IP interfaces with different IP addresses.
### 6.2.2 UDP
The UDP Protocol (see RFC 768 [22]) shall be applied.
Two consecutive port numbers shall be used at each MGW for the RTP bearer and
for the optional RTCP connection that transport a single Nb UP connection. Two
such consecutive port numbers are termed \"port number block\" in what
follows. The first port number shall be even and shall be assigned to the RTP
protocol. At a given MGW, the same port shall be used to send and to receive
RTP PDUs. The next port number shall be assigned to the RTCP protocol. This
port shall be reserved even if the optional RTCP protocol is not used.
Each MGW shall administer the port numbers it intends to use for RTP/RTCP port
number blocks.
### 6.2.3 RTP
RTP (see RFC 1889 [24] or RFC 3550 [29]) shall be applied.
#### 6.2.3.1 RTP Header
The RTP Header Fields shall be used as described in the following clauses:
##### 6.2.3.1.1 Version
RTP Version 2 shall be used.
##### 6.2.3.1.2 Padding
Padding shall not be used.
##### 6.2.3.1.3 Extension
The RTP Header shall not have an extension.
##### 6.2.3.1.4 Contributing Source (CSRC) count
There are zero CSRCs.
##### 6.2.3.1.5 Marker Bit
The marker bit is ignored.
##### 6.2.3.1.6 Payload Type
A dynamic Payload Type (see RFC 1890 [25]) shall be used. Values between 96
and 127 shall be used. The value shall be negotiated by means of the bearer
control protocol.
##### 6.2.3.1.7 Sequence Number
The sequence number shall be supplied by the source MGW of a RTP PDU. The sink
MGW of a RTP PDU may ignore the sequence number or it may use it to obtain
statistics about the link quality and / or to correct out-of-sequence
delivery, e.g. by dropping out-of-sequence packets.
##### 6.2.3.1.8 Timestamp
The timestamp shall be supplied by the source MGW of a RTP PDU. A clock
frequency of 16000 Hz shall be used. The definition of the RTP timestamp is
specified in IETF RFC 1889 [24] which states that RTP timestamp is based on
the sampling instant of the source encoder. However for the present
application the source MGW is not mandated to set the RTP timestamp according
to the sampling instant of the payload PDU. Although the RTP timestamp can
reflect the sampling instant in some scenarios, the sink MGW cannot rely upon
the accuracy of the RTP Timestamp. The sink MGW of a RTP PDU may ignore the
timestamp.
NOTE: An application can use the time based NbFP frame number to obtain end-
to-end timing information.
##### 6.2.3.1.9 Synchronisation Source (SSRC)
The source MGW of a RTP PDU shall supply a SSRC. The sink MGW of a RTP PDU may
ignore the SSRC if it does not use RTCP.
##### 6.2.3.1.10 CSRC list
This list is empty.
#### 6.2.3.2 RTP Payload
A single UP PDU, as described in 3GPP TS 29.415 [3], shall be transported as a
RTP payload.
### 6.2.4 RTCP
RTCP (see RFC 1889 [24]) may be applied. The use of the RTCP protocol is
optional.
A MGW may ignore incoming RTCP PDUs.
Figure 5 shows the protocol stack for the transport of RTCP. The above
Sections about IP and UDP shall also apply for the transport of RTCP.
* * *
_RTCP_ _UDP_ _IPv4 or IPv6_
* * *
Figure 5: RTCP Protocol stack for the transport network user plane
## 6.3 Bearer Control Protocol
The ITU-T Recommendation Q.1970 \"BICC IP Bearer Control Protocol\" (IPBCP)
(see 3GPP TS 29.205 [11]) shall be applied.
The use of Iu FP as RTP payload shall be indicated within IPBCP. IuFP shall
transport either speech or data in a bearer independent way as described in
3GPP TS 23.205 and 3GPP TS 29.205. The negotiation of the type of payload
within IuFP is outside the scope of IPBCP and described in the above
specifications.
NOTE: The IuFP is registered with IANA as the MIME type \"VND.3GPP.IuFP\"of
the \"audio\" category, however, this registration does not preclude the use
of IuFP to transport \"data\".
### 6.3.1 Transport
IPBCP shall be transported over the Mc and Nc interface by means of the ITU-T
Recommendation Q.1990 **\"** BICC Bearer Control Tunnelling Protocol\" ( see
3GPP TS 29.205 [11]). The transport of the Q.1990 **\"** BICC Bearer Control
Tunnelling Protocol\" on the Mc interface is described in 3GPP TS 29.232 [4].
The transport of the **\"** BICC Bearer Control Tunnelling Protocol\" on the
Nc interface is described in ITU-T Recommendation Q.765.5 (see 3GPP TS 29.205
[11]).
Figure 6: Transport of IPBCP
### 6.3.2 Procedures
The IPBCP procedures shall be used as described in the ITU-T Recommendation
Q.1970 \"BICC IP Bearer Control Protocol\" (IPBCP) (see 3GPP TS 29.205 [11]).
#### 6.3.2.1 Bearer Establishment
The forward and backward RTP bearers used to transport one Nb UP connection
shall be set up together after an IPBCP handshake with a Request message and
an Accepted message has succeeded.
Each MGW shall signal its peer MGW with the RTP port number. The RTCP port
number shall be the next higher number.
If the optional 20 ms packetisation time is supported for PCM encoded speech
over Nb and if its use is authorized by local configuration setting, the MGW
shall also negotiate with its peer MGW the packetisation time to be used for
PCM encoded speech over Nb, even if the codec configured on the bearer is
still unknown or differs from PCM. This is done by including the
\"pcmptime=20\" parameter in the IPBCP Request as defined in clause 6.3.3.5. A
MGW receiving the \"pcmptime=20\" parameter ignores it if the 20 ms
packetisation time is not supported for PCM encoded speech over Nb. A MGW
receiving the \"pcmptime=20\" parameter shall return the \"pcmptime=20\"
parameter in the IPBCP Accept message only if the 20 ms packetisation is
supported for PCM encoded speech over Nb and if its use is authorized by local
configuration setting. Receipt of the \"pcmptime=20\" parameter in the IPBCP
Accept shall indicate to the originating MGW that it shall apply the 20 ms
packetisation time when PCM encoded speech is sent over the Nb bearer.
Otherwise the default 5 ms packetisation time shall be used for PCM encoded
speech over Nb. The result of the negotiation is only used if PCM is selected
on the bearer.
#### 6.3.2.2 Bearer Modification
A modification of existing RTP bearers is not permitted. The IPBCP Request
message shall not be used to modify bearers.
#### 6.3.2.3 Bearer Release
When the H.248 Termination [10] of an Nb UP connection on a MGW is deleted by
means of signalling over the Mc interface, which are outside the scope of
IPBCP (see 3GPP TS 29.232 [4]), the used resources shall be freed as follows:
The MGW shall discard any packets arriving at the port pair used for the old
Nb UP connection until it sets up a new Nb UP connection on these ports. The
MGW shall only reuse these ports after a time that is long enough to avoid
that packets from the old connection still arrive.
### 6.3.3 Use of IPBCP message fields
The IPBCP message fields shall be used as described in the ITU-T
Recommendation Q.1970 \"BICC IP Bearer Control Protocol\" (IPBCP) (see 3GPP TS
29.205 [11]) and SDP (RFC 2327 [26]). Moreover, the following clauses shall be
applied:
#### 6.3.3.1 Origin
_\ _ shall be the IP address assigned to the IP interface used for
the RTP bearer on the source MGW of the present IPBCP message.
#### 6.3.3.2 Session Name
The source MGW shall supply an arbitrary string as _\ ._ The
sink MGW shall ignore this string.
#### 6.3.3.3 Connection Data
The _\ _ shall be identical to the above origin _\
_
#### 6.3.3.4 Media Announcement
_\ _ shall always be set to \"audio\" irrespective of the payload type
within IuFP.
_\ _ shall be set to the port number assigned to the RTP bearer on the
source MGW of the present IPBCP message
_\ _ shall be set to \"RTP/AVP\".
_\ _ shall be set to the chosen dynamic payload number. The MGW that
initiates the bearer establishment may choose any value between 96 and 127.
The peer MGW shall echo this value.
#### 6.3.3.5 Media Attributes
The following media attribute shall be supplied: \"a=rtpmap _:\ _ VND.3GPP.IUFP/16000\", where:_\ _ is
the same dynamic payload type number as in the above media announcement _\
_.
The media attribute \"a=fmtp:\ pcmptime=20\" shall also be set:
\- in the IPBCP Request if the optional 20 ms packetisation time is supported
for PCM encoded speech over Nb and if its use is authorized by local
configuration setting;
\- in the IPBCP Accept message if received in the IPBCP Request and if the
optional 20 ms packetisation time is supported for PCM encoded speech over Nb
and if its use is authorized by local configuration setting.
Other media attributes shall not be used. They shall be ignored in the MGW
receiving an IPBCP message.
Example of IPBCP Request / Accept exchange where both MGWs support the 20 ms
packetisation time for PCM encoded speech over Nb:
IPBCP Request (MGW1 -> MGW2)
m=audio 49170 RTP/AVP 97
a=rtpmap:97 VND.3GPP.IUFP/16000
a=fmtp:97 pcmptime=20
IPBCP Accept (MGW2 -> MGW1)
m=audio 49320 RTP/AVP 97
a=rtpmap:97 VND.3GPP.IUFP/16000
a=fmtp:97 pcmptime=20
## 6.4 Bearer Transport with multiplexing
### 6.4.1 Introduction
This clause specifies an optional transport format for the Nb interface and IP
transport that allows transporting several RTP/NbFP/codec payload PDUs of
different user plane connections within one packet, and the corresponding
backward compatible signalling extensions required to negotiate the use of
this transport option. Use of this transport format saves bandwith in the IP
network (bandwidth gains are evaluated in 3GPP TR 29.814 [28]).
Bandwith saving is achieved by multiplexing several NbFP PDUs within one
UDP/IP packet. As an option, the RTP header may be compressed in addition. Two
transport formats are specified accordingly.
### 6.4.2 Transport format
#### 6.4.2.1 IP
Either IPv4 (RFC 791 [23]) or IPv6 (RFC 2460 [27]) shall be used.
One MGW may have several IP interfaces with different IP addresses.
#### 6.4.2.2 UDP
The UDP Protocol (see RFC 768 [22]) shall be applied. If multiplexing is
applied with or without header compression, the source UDP port number shall
indicate the local termination used to combine the multiplexed packet and the
destination UDP port number shall indicate the remote port number where PDUs
are demultiplexed. The negotiation if multiplexing is applied and of the
destination UDP port is described in clause 6.4.3. If multiplexing was
negotiated for a Nb UP user plane connection, the MGW may apply multiplexing
by sending all packets of the user plane connection towards the negotiated
destination UDP port.
#### 6.4.2.3 Transport Format for multiplexing without RTP Header Compression
Several RTP/NbFP/codec payload PDUs sent to the same IP address are
multiplexed within one single UDP/IP packet over the Nb interface between
MGWs. If DiffServ is applied, all multiplexed PDUs also need to share the same
Diffserv class. The multiplexing shall only be used with RTP packets. RTCP
shall be transported normally by UDP/IP packets.
Use of multiplexing shall be negotiated between MGWs, as specified in clause
6.4.3.
Before each multiplexed RTP/NbFP/codec payload PDU inserted into the UDP/IP
packet a Multiplex Header, which identifies the multiplexed packet, shall be
inserted.
Figure 7: UDP/IP Packet with multiplexed RTP/NbFP payload PDUs without RTP
header compression
The Multiplex Header includes :
\- T bit.
The field has two possible values, 0 for indicating full packet and 1 for
indicating compressed packet. Value 0 shall be used for an uncompressed RTP
header, as decribed in the present clause.
\- Mux ID, 15 bits.
For identification of different user plane connections. The value shall be the
UDP destination port of the corresponding non-multiplexed RTP/NbFP PDU packet
divided by two (only even numbered ports are used for RTP sessions).
\- Length Indicator (LI), 8 bits, unsigned integer.
Gives the length of the multiplexed RTP/NbFP PDU packet (RTP header + RTP
Payload = RTP header + NbFP header + NbFP payload) in bytes (the last byte of
the RTP/NbFP PDU is padded to the next byte boundary if necessary). Maximum
length is 255 bytes. This LI allows to calculate where the next Multiplex
Header for the next multiplexed RTP/NbFP PDU packet starts.
\- R bit.
Reserved for future use. Shall be set to 0 by the sending entity and be
ignored by the receiving entity.
\- Source ID, 15 bits.
For identification of the different connections. The value shall be the source
UDP port of the corresponding non-multiplexed RTP/NbFP/codec PDU packet
divided by two (only even numbered ports are used for RTP sessions). This
information is transferred to permit the receiving node to optionally detect
and filter illegitimate packets (e.g. packets received from the peer
termination precedingly associated to the receiving termination).
The multiplexed RTP/NbFP payload PDU shall be inserted in the IP/UDP packet
directly after the corresponding Multiplex Header. The multiplexed RTP/NbFP
payload PDU shall follow the rules in clause 6.2.3 and consists of the full
RTP header, the full NbFP header and the NbFP payload. If the multiplexed
RTP/NbFP payload PDU does not end at a byte boundary, then the remaining bits
of its last byte shall be padded with zeros.
The multiplexing method does not limit the number of packets being multiplexed
and it is thus the data link layer protocol that defines the maximum frame
size. E.g. an IP datagram has a maximum length of 65 535 bytes and Ethernet 1
518 bytes. In order to avoid additional delay in the network the packets
should not be delayed more than 1 ms to 2 ms, which also effectively limits
the number of multiplexed packets and makes the multiplexing-jitter low.
Figure 8: Example of multiplexed packet with two RTP frames
#### 6.4.2.4 Transport Format for multiplexing with RTP header compression
To achieve even better bandwidth savings, the RTP header may optionally be
compressed. This is possible since the RTP header includes many static fields
that remain unchanged during an RTP session if NbFP is used as payload (see
clause 6.3.2).
Use of RTP header compression shall be negotiated between MGWs, as specified
in clause 6.4.3.
At least the first two RTP packets of each RTP session shall be sent with
their full RTP header to allow the receiver to store the full header and use
it in decompression. RTP packets shall also be sent with their full RTP header
till receipt of a RTCP packet from the peer indicating support of RTP header
compression. Subsequent packets may be sent with a compressed RTP header. If a
MGW does not receive any of the initial RTP packets with a full RTP header,
the MGW shall assume that the fields of the RTP header other than those
present in the compressed RTP header are set as defined in clause 6.2.3.1, and
shall therefore not consider this as an error.
Before each multiplexed RTP/NbFP/codec payload PDU inserted into the UDP/IP
packet a Multiplex Header, which identifies the multiplexed packet, shall be
inserted
Figure 9: UDP/IP Packet with multiplexed RTP/NbFP payload PDUs with RTP header
compression
The Multiplex Header shall be used as described in clause 6.4.2.3. However,
the T bit shall be set for a compressed RTP header, as decribed in the present
clause. The Length Indicator gives the length of the multiplexed RTP/NbFP PDU
packet in bytes (compressed RTP header + RTP Payload ).
The multiplexed RTP/NbFP payload PDU shall be inserted in the IP/UDP packet
directly after the corresponding Multiplex Header. The multiplexed RTP/NbFP
payload PDU shall consist of the compressed RTP header described below
followed by the full NbFP header and the NbFP payload, as described in 3GPP TS
29.415 [3]. If the multiplexed RTP/NbFP payload PDU does not end at a byte
boundary, then the remaining bits of its last byte shall be padded with zeros.
The compressed RTP header shall include the following two fields taken from
the uncompressed RTP header:
\- Sequence number (SN), 8 bits.
The field changes as the original sequence number (RFC 3550 [29]) but is
shortened from 16 bits to 8 bits (256 packets). The least significant byte of
the RTP sequence number shall be included. Clause 6.2.3.1.7 is applicable.
\- Timestamp (TS), 16 bits.
The TS field changes as the original timestamp (RFC 3550 [29]) but the length
is half of the original resulting in modulo of 4 seconds with 16 kHz clock
reference. The least significant two bytes of the RTP timestamp shall be
included. Clause 6.2.3.1.8 is applicable.
NOTE: These RTP fields change during a connection and thus need to be
transferred within each packet for NbFP payload. All other RTP fields do not
change (see clause 6.2.3).
Figure 10: Example of multiplexed packet with two RTP frames and compressed
RTP headers
### 6.4.3 RTCP
#### 6.4.3.1 General
A MGW wishing to apply Bearer Transport with multiplexing shall use RTCP (see
RFC 3550 [29]) to negotiate multiplexing.
RTCP shall be used separately for each user plane connection. RTCP shall be
transported by UDP/IP packets as described in clause 6.2.4. and not included
included in IP/UDP packets using the multiplexing format described above.
#### 6.4.3.2 Multiplex negotiation via RTCP
RTCP shall be used to negotiate the use of multiplexing. A new 3GPP-specific
RTCP Multiplexing packet is specified in clause 6.4.3.3 for this purpose, and
may be added to compound RTCP packets following the principles of RFC 3550
[29]. The Multiplexing RTCP packet indicates:
\- if multiplexing without RTP header compression is supported ;
\- if multiplexing with RTP header compression is supported ;
\- the local UDP port where to receive multiplexed data streams,
\- if multiplexing is selected..
When setting up a new user plane connection, both peer MGWs of a NbUP
connection shall start to send data without applying multiplexing and may
indicate their readiness to receive multiplexed data streams by including the
new RTCP Multiplexing packet in the initial and all subsequent RTCP packets
they send. A MGW shall always announce the same multiplexing capabilities and
the same UDP port where to receive multiplexed data streams in all the RTCP
Multiplexing packets it sends for a given RTP session. MGWs should preferably
send their initial RTCP packet at the very beginning of the RTP session to be
able to apply multiplexing as soon as possible. A MGW sending a Multiplexing
packet indicating support of multiplexing shall be ready to receive
multiplexed packets at the announced UDP port. A single UDP port for
multiplexing shall be used per destination IP address.
A MGW receiving an RTCP packet, where the peer indicated its readiness to
receive multiplexed data streams, may apply multiplexing to send the
corresponding RTP data streams towards the sender of the RTCP packet. If the
MGW decides to apply multiplexing, it can immediately start sending
multiplexed data streams towards the corresponding UDP multiplexing port
announced in the received RTCP Multiplexing packet. The MGW shall indicate in
subsequent RTCP Multiplexing packets if it applies multiplexing with or
without header compression for the given user connection
A MGW that does not receive RTCP or receives RTCP without the RTCP
Multiplexing packet shall continue to send data for the user connection
without applying multiplexing.
A MGW that does not support multiplexing will ignore the unknown received RTCP
Multiplexing package according to RTCP procedures and will continue to send
data for the user connection without applying multiplexing.
Sending of a RTCP Multiplexing packet indicating readiness to receive
multiplexed data streams does not necessarily mean that the MGW is ready to
send multiplexed data streams, i.e. multiplexing may be applied on a single or
on both directions for a given RTP session.
The applicable compressed header format is not negotiated using RTCP, but is
determined by the fact if the Nb bearer is controlled via a SIP-I based Nc
interface or a BICC based Nc interface. A MGW may support multiplexing of both
RTP header compression formats on a same IP interface.
#### 6.4.3.3 RTCP Multiplexing packet
The format of the RTCP Multiplexing packet is specified in figure 11.
Figure 11: RTCP Multiplexing packet
The APP packet header includes :
\- version (V), 2 bits
Identifies the version of RTP, which is the same in RTCP packets as in RTP
data packets. RTP Version 2 shall be used.
\- padding (P), 1 bit
As specified in RFC 3550 [4].
\- subtype, 5 bits.
The following subtype value shall be used :
00001 : RTCP Multiplexing packet
\- packet type (PT), 8 bits.
Shall contains the constant 204 to identify this as an RTCP APP packet
\- length, 16 bits.
As specified in RFC 3550 [4]. The length of this RTCP packet in 32-bit words
minus one, including the header and any padding. (The offset of one makes zero
a valid length and avoids a possible infinite loop in scanning a compound RTCP
packet, while counting 32-bit words avoids a validity check for a multiple of
4.)
\- SSRC/CSRC, 32 bits.
As specified in RFC 3550 [4].
\- name, 32 bits.
Shall be set to \"3GPP\"
The application-dependent data includes :
\- multiplexing bit (MUX), 1 bit
Indicates whether multiplexing without RTP header compression is supported or
not by the sender of the RTCP packet : set to 0 if not supported, set to 1 if
supported.
\- multiplexing with RTP header compression bit (CP), 1 bit
Indicates whether multiplexing with RTP header compression is supported or not
by the sender of the RTCP packet : set to 0 if not supported, set to 1 if
supported.
\- Selection bits, 2 bits
Indicates whether the sender of the RTCP packet has selected to apply
multiplexing with or without header compression for the user plane packets
that it sends on this connection. The following values are defined:
00: no multiplexing is applied
01: multiplexing is applied without RTP header compression
10: multiplexing is applied with RTP header compression
11: reserved
\- Local MUX UDP port, 15 bits :
Local UDP port where the sender demands to receive multiplexed data streams.
The value shall be the same as the local MUX UDP port divided by two. This
parameter shall be ignored by the receiver of the RTCP Multiplexing packet if
the MUX and CP bits indicate that multiplexing is not supported.
\- Reserved bits:
Extension bits may be added in the RTCP Multiplexing packet in future
releases. Reserved bits shall be set to 0 in sent RTCP Multiplexing packet of
this relaese and shall be ignored in incoming RTCP Multiplexing packets.
Extension fields may be added in the RTCP Multiplexing packet in future
releases. They shall be ignored by a MGW implementing an earlier version of
the specification.
# 7 Transport over IP for SIP-I based Nc
## 7.1 General
Clause 7 is only applicable in combination with SIP-I based Nc.
IPv4 (RFC 791 [23]) shall be supported. IPv6 (RFC 2460 [27]) may be supported.
RTP (RFC 1889 [24] or RFC 3551 [29]) over UDP (RFC 768 [22]) over either IPv4
(RFC 791 [23]) or IPv6 (RFC 2460 [27]) shall be used in the transport network
user plane. Figure 4 in Clause 6.1 shows the protocol stack for the transport
network user plane on the Nb interface.
## 7.2 Bearer Transport without multiplexing
### 7.2.0 Introduction
See 6.2.0
### 7.2.1 IP
See 6.2.1
### 7.2.2 UDP
See 7.2.2
### 7.2.3 RTP
RTP (see RFC 1889 [24] or RFC 3550 [30]) shall be applied.
#### 7.2.3.1 RTP Header
The RTP Header Fields shall be used as described in the following clauses:
##### 7.2.3.1.1 Version
RTP Version 2 shall be used.
##### 7.2.3.1.2 Padding
Padding shall not be used.
##### 7.2.3.1.3 Extension
The extension bit shall be used as specified for the RTP profile applicable
for the used payload.
##### 7.2.3.1.4 Contributing Source (CSRC) count
There are zero CSRCs.
##### 7.2.3.1.5 Marker Bit
The marker bit shall be used as specified for the RTP profile applicable for
the used payload.
##### 7.2.3.1.6 Payload Type
The payload type shall be set as negotiated by means of SIP-I and supplied
over the Mc interface.
##### 7.2.3.1.7 Sequence Number
The sequence number shall be supplied by the source MGW of a RTP PDU.
##### 7.2.3.1.8 Timestamp
The timestamp shall be supplied by the source MGW of a RTP PDU.
##### 7.2.3.1.9 Synchronisation Source (SSRC)
The source MGW of a RTP PDU shall supply a SSRC.
##### 7.2.3.1.10 CSRC list
This list is empty.
#### 7.2.3.2 RTP Payload
Speech in various encodings packed in corresponding RTP payload types may be
transported as RTP Payload, as further specified in TS 26.102 [32]. Data and
fax packed in corresponding RTP payload types may also be transported as RTP
Payload, as further specified in 3GPP TS 29.007 [36].
NOTE: The Nb framing protocol specified in 3GPP TS 29.415 [3] is not
applicable.
### 7.2.4 RTCP
The use of the RTCP (see RFC 1889 [24] or RFC 3551 [29]) protocol is optional,
unless the RTP payload profile of the transported payload requires RTCP.
A MGW may ignore incoming RTCP PDUs, unless the RTP payload profile of the
transported payload requires some usage of RTCP
Figure 5 in Clause 6.2.4 shows the protocol stack for the transport of RTCP.
The above Sections about IP and UDP shall also apply for the transport of
RTCP.
## 7.3 Bearer Transport with multiplexing
### 7.3.1 Introduction
See Clause 6.4.1
### 7.3.2 Transport format
#### 7.3.2.1 IP
See Clause 6.4.2.1
#### 7.3.2.2 UDP
See Clause 6.4.2.2
#### 7.3.2.3 Transport Format for multiplexing without RTP Header Compression
See Clause 6.4.2.3.
However, instead of RTP/NbFP/codec payload PDUs, RTP/codec payload PDUs shall
be transported. The RTP header and the RTP payload shall follow the rules in
clause 7.2.3.
#### 7.3.2.4 Transport Format for multiplexing with RTP header compression
RTP header compression for Nb bearers with SIP-I based Nc shall be applied as
specified in clause 6.4.2.4 for Nb bearers with BICC-based Nc, with the
exceptions specified in the present Clause.
The transport format additionally includes the marker bit (bit M) and the
payload type (PT), which can very dependent on the transported payload.
Figure 12: UDP/IP Packet with multiplexed RTP/Nb payload PDUs with RTP header
compression
The compressed RTP header shall include the following fields taken from the
uncompressed RTP header:
> \- Sequence number (SN), 8 bits.
>
> \- Timestamp (TS), 16 bits.
>
> \- Marker bit (M), 1 bit.
>
> \- Payload Type (PT), 7 bits
The usage of these header fields shall follow Clause 7.2.3
The Transport Format for multiplexing with RTP header compression shall not be
applied for RTP payload types that use an RTP header extension. For RTP
payload types that use an RTP header extension, this transport format shall
not be offered or accepted in the RTCP multiplexing negotiation.
### 7.3.3 RTCP
See Clause 6.4.3
## 7.4 Transcoder-less Interworking with the Iu Framing Protocol
### 7.4.1 Introduction
Figure 13: Transcoder-less Interworking between IuFP and RTP (optional in the
event the codecs on both sides are the same)
If no transcoder is inserted, the MGW shall interwork the procedures between
the RTP at the Nb interface of the SIP-I based CS CN and the Iu framing
protocol (see 3GPP TS 25.415 [31]) at the Iu interface as described in the
following Clauses.
### 7.4.2 Initialisation
There is no need to interwork IuFP initialisation procedures between Iu
interface and the RTP at the Nb interface of the SIP-I based CS CN.
### 7.4.3 Time alignment
The purpose of the time alignment procedure on the Iu interface is to minimise
the buffer delay in the RNC for downlink transmissions by adjusting the
vocoder time reference within the network. No such procedure exists within
RTP, so the MGW shall return NACK indication time alignment not supported
according to 3GPP TS 25.415 [31].
### 7.4.4 Rate control
#### 7.4.4.1 General
The rate control procedure signals to the peer entity the maximum rate among
the currently allowed rates at which it can receive codec frames. Rate control
only applies to AMR, AMR-WBand EVS codec configurations with multiple active
modes. For the EVS codec, the rate control procedure also signals to the peer
entity the maximum mode among the currently allowed modes at which it can
receive codec frames.
#### 7.4.4.2 Rate control for AMR and AMR-WB
For AMR and AMR-WB codecs:
\- On the Iu interface, IuFP provides for rate control via the exchange of
RATE CONTROL and RATE CONTROL ACK PDUs.
\- On the Nb interface of the SIP-I based CS CN, RFC 4867 [35] provides for
in-band rate control via the Codec Mode Request (CMR) field of every codec
frame.
\- Interworking of rate control procedures at an MGW between an Nb interface
and a corresponding Iu interface only applies when the MGW bridges compatible
codec configurations between the interfaces without applying a transcoding
function.
\- An MGW receiving a CMR from an Nb interface shall initiate the IuFP rate
control procedure on the corresponding Iu interface.
\- An MGW receiving a rate control request on an Iu interface shall adjust the
CMR field of outgoing speech frames on the corresponding Nb interface.
#### 7.4.4.3 Rate and Mode control for EVS
For the EVS codec:
\- On the Iu interface, IuFP provides for rate control via the exchange of
RATE CONTROL and RATE CONTROL ACK PDUs.
\- On the Iu interface, CMR for EVS (EVS-CMR) as specified in 3GPP TS 26.453
[38] clause 4.5 provides for in-band rate and mode control via the Codec Mode
Request (CMR) field of every codec frame (Speech or SID) and CMR-Only frame.
\- On the Nb interface of the SIP-I based CS CN, EVS-CMR as specified in 3GPP
TS 26.453 [38] clause 4.5 provides for in-band rate control via the Codec Mode
Request (CMR) field of every codec frame.
\- Interworking of rate control procedures at an MGW between an Nb interface
and a corresponding Iu interface only applies when the MGW bridges compatible
codec configurations between the interfaces without applying a transcoding
function.
\- An MGW receiving an EVS-CMR from an Nb interface may modify its contents
based on local policies and include the resulting contents into the EVS-CMR
field of the outgoing speech frame on the corresponding Iu interface.
\- An MGW receiving a rate control request and an EVS-CMR on an Iu interface
shall determine the lower limit of the maximum bit rates contained in each
request and include the resulting limit into the EVS-CMR field of the outgoing
speech frame on the corresponding Nb interface, with possible further
modifications to the EVS-CMR contents based on configured policies.
\- The rules by which the MGW may filter and modify the EVS-CMR contents
consist of the following:
1) The MGW shall not modify the EVS-CMR to increase the maximum bit rate;
2) If the MGW observes the incoming stream of speech frames or packets and
determines that a lower EVS mode is more appropriate, the MGW may modify the
EVS-CMRs sent in the opposite direction of the observed speech flow;
3) If the MGW modifies the EVS-CMR to decrease the maximum bit rate and the
resulting maximum bit rate no longer support the originally requested maximum
audio bandwidth, then the maximum audio bandwidth may be reduced by the MGW to
the next lower one that fits to the reduced maximum bit rate;
4) The MGW shall not modify the EVS-CMR in a way that results in a change of
the major operation mode (EVS primary mode or EVS AMR-WB IO mode);
NOTE: The MGW can be forced to change the major operation mode of an incoming
EVS-CMR when interworking between EVS and AMR-WB, during handover or after
handover.
5) When channel-aware mode is used, if the MGW observes the incoming stream of
speech frames or packets and determines that other channel-aware mode
parameters are more appropriate, the MGW may modify the EVS-CMRs, flowing in
the opposite direction of the observed speech flow to change the received
channel-aware offset to a bigger one (e.g. from 2 to 3) and the received
channel-aware depth to a lower, more robust one;
6) When channel-aware mode is used, the MGW shall not reduce the received
channel-aware offset or modify the received channel-aware depth a less robust
one;
7) The MGW should not block the channel-aware mode;
8) The MGW may modify the EVS primary mode in the received EVS-CMR to the EVS
Variable Bit Rate mode.
#### 7.4.4.4 Interworking of rate control between compatible AMR-WB and EVS
codec configurations
The EVS codec includes the EVS AMR-WB IO major operation mode and is therefore
TrFO-compatible to the AMR-WB codec, if the mode-set and mode-change-period
parameters are TrFO-compatible. For example, AMR-WB on one MGW termination and
EVS on the other MGW termination are TrFO-compatible codecs, if the mode-set
parameter s are TrFO-compatible and mode-change-period=2 on both sides.
If the MGW bridges compatible EVS codec configurations and AMR-WB codec
configurations:
\- If the codec of the incoming termination is EVS and the codec of the
outgoing termination is AMR-WB, then the rate control procedure for AMR-WB
shall apply at the outgoing termination, with the maximum rate equal to or
lower than the maximum rate received in the EVS-CMR. The MGW shall map
received EVS-CMRs to the selected mode-set of the outgoing AMR-WB termination.
NOTE: In this interworking scenario, the incoming EVS-CMR should request AMR-
WB IO mode of operation.
\- If the codec of the incoming termination is AMR-WB and the codec of the
outgoing termination is EVS, then the rate control procedure for AMR-WB shall
apply on the incoming termination and shall determine the maximum rate
included in the CMR sent by the MGW. The MWG shall request the EVS AMR-WB IO
major operation mode in the outgoing CMR.
\- The MGW may filter and modify the CMR contents according to the following
rules:
1) The MGW shall not modify the EVS-CMR to increase the maximum bit rate;
2) If the MGW observes the incoming stream of speech frames or packets and
determines that a lower EVS mode is more appropriate, the MGW may modify the
EVS-CMRs sent in the opposite direction of the observed speech flow.
If the MGW bridges EVS codec configurations and AMR-WB codec configurations
which are not compatible, the MGW shall apply transcoding and shall handle the
independent rate and mode control procedures towards the incoming and the
outgoing networks.
### 7.4.5 Frame quality indication
The Iu framing protocol signals frame quality with the Frame Quality
Classification (FQC) field of each speech frame PDU. See 3GPP TS 26.102 [32]
and 3GPP TS 25.415 [31] for details. The FQC may have possible values:
0=frame_good; 1=frame_bad; 2=frame_bad_due_to_radio; and 3=spare. The RTP AMR,
AMR-WB or EVS payload at the Nb interface signals frame quality with the Q bit
(frame quality indicator) field of each speech frame, as defined in RFC 4867
[35]. The Q bit may have values: 1=speech_good; and 0=speech_bad or sid_bad.
Tables 1 and 2 provide the mapping between Nb and Iu interfaces.
Table 1: Mapping of Nb RTP profile Qbit onto Iu FQC
* * *
Nb RTP profile Qbit Nb RTP profile FT Iu - FQC 1 x 0 0 x 1
* * *
Table 2: Mapping Iu FQC onto Nb RTP profile Qbit
* * *
Iu - FQC Nb RTP profile Qbit Nb RTP profile FT 0 1 NC 1 0 NO_DATA 2 0 NC
* * *
### 7.4.6 Framing
Even when the MGW bridges compatible codec configurations between the Nb and
Iu interfaces, the MGW shall perform translation between the frame formats
defined for the two interfaces, since all codec configurations have different
framing procedures for the two interfaces. The framing details for Iu are
defined in 3GPP TS 26.102 [32] and 3GPP TS 25.415 [31], although they do not
describe the framing for ITU-T codecs other than G.711. The framing details
for Nb are defined in IETF RFC 4867 [35],IETF RFC 3550 [29],IETF RFC 3551 [33]
and IETF RFC 3555 [34].
### 7.4.7 Transcoding
Transcoding at the MGW is avoided when the MGW bridges compatible codec
configurations between the Nb and Iu interfaces. Otherwise transcoding is
necessary, which eliminates the need to interwork other user plane procedures
between the interfaces.
### 7.4.8 Discontinuous transmission
When the MGW bridges compatible codec configurations between the Nb and Iu
interfaces, the DTX procedures are normally interworked transparently by
translating between the framing formats on the interfaces. All the ITU-T. AMR,
AMR-WB and EVS codecs have configurations that are compatible between the Iu
and Nb interfaces.
For the AMR, AMR-WB and EVS codecs, DTX is always enabled on the CS radio
Interface in the uplink direction and the transport channel for DTX in the
downlink is always provided.
### 7.4.9 Timing and sequence information
The MGW shall always correct out-of-sequence delivery between Nb and Iu
interfaces, either by re-ordering frames, or by dropping frames that are out
of sequence.
When the IuFP frame numbers are based on time and if the MGW bridges
compatible codec configurations between the Nb and Iu interfaces, it shall
either correct jitter before forwarding PDUs or interwork the RTP timestamp
(see RFC 3550 [29]) with the IuFP Frame Number (see 3GPP TS 25.415 [31]) so
that both the RTP timestamp and IuFP frame number similarly reflect the
nominal sampling instant of the user data in the packet.
NOTE: Correcting jitter may cause additional delay.
The RTP sequence number (see RFC 3550 [29]) is handled independently on Nb,
i.e. it is not interworked with the IuFP Frame Number (see 3GPP TS 25.415
[31]).
#
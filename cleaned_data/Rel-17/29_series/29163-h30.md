# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
Y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies the principles of interworking between the 3GPP
IM CN subsystem and BICC/ISUP based legacy CS networks, in order to support IM
basic voice, data and multimedia calls.
The present document addresses the areas of control and user plane
interworking between the IM CN subsystem and CS networks through the network
functions, which include the MGCF and IM-MGW. For the specification of control
plane interworking, areas such as the interworking between SIP and BICC or
ISUP are detailed in terms of the processes and protocol mappings required for
the support of both IM originated and terminated voice and multimedia calls.
Other areas addressed encompass the transport protocol and signalling issues
for negotiation and mapping of bearer capabilities and QoS information.
The present document specifies the interworking between 3GPP profile of SIP
(as detailed according to 3GPP TS 24.229 [9]) and BICC or ISUP, as specified
in ITU-T Recommendations Q.1902.1 to Q.1902.6 [30] and ITU-T Q761 to Q764 [4]
respectively.
The present document also specifies the interworking between circuit switched
multimedia telephony service, as described in 3GPP TS 26.110 [78] 3GPP TS
26.111 [79], and ITU-T Recommendation H.324 [81] and packet switched
multimedia services, as described in 3GPP TS 26.114 [104], in particular and
the interworking between the 3GPP profile of SIP and the inband control
protocols for multimedia communication as specified in ITU-T Recommendations
H.245 [82] and H.324 Annex K [81].
The present document addresses two interworking scenarios with respect to the
properties of the CS network:
\- The CS network does not use any 3GPP specific additions.
\- The CS network uses 3GPP specific additions.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] ITU-T Recommendation G.711 (11/88): \"Pulse Code Modulation (PCM) of voice
frequencies\".
[2] ITU-T Recommendation H.248.1 (05/02): \"Gateway control protocol: Version
2\".
[3] ITU-T Recommendation Q.701 (03/93), Q.702 (11/88), Q.703 (07/96), Q.704
(07/96), Q.705 (03/93), Q.706 (03/93), Q.707 (11/88), Q.708 (03/99), Q.709
(03/93): \"Functional description of the message transfer part (MTP) of
Signalling System No. 7\".
[4] ITU-T Recommendations Q.761to Q.764 (12/99): \"Specifications of
Signalling System No.7 ISDN User Part (ISUP)\".
[5] Void.
[6] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[7] Void.
[8] 3GPP TS 24.228: \"Signalling flows for the IP multimedia call control
based on SIP and SDP\".
[9] 3GPP TS 24.229: \"IP Multimedia Call Control Protocol based on SIP and
SDP\".
[10] 3GPP TS 23.002: \"Network Architecture\".
[11] 3GPP TS 22.228: \"Service requirements for the IP Multimedia Core Network
Subsystem\".
[12] 3GPP TS 23.228: \"IP Multimedia subsystem (IMS)\".
[13] Void.
[14] 3GPP TS 29.205: \"Application of Q.1900 series to Bearer Independent CS
Network architecture; Stage 3\".
[15] 3GPP TS 29.332: \"Media Gateway Control Function (MGCF) - IM-Media
Gateway (IM-MGW) interface, Stage 3\".
[16] IETF RFC 791: \"Internet Protocol\".
[17] IETF RFC 768: \"User Datagram Protocol\".
[18] IETF RFC 2960: \"Stream Control Transmission Protocol\".
[19] IETF RFC 3261: \"SIP: Session Initiation Protocol\".
[20] 3GPP TS 29.202: \"Signalling System No. 7 (SS7) signalling transport in
core network; Stage 3\".
[21] IETF RFC 2474: \"Definition of the Differentiated Services Field (DS
Field) in the Ipv4 and Ipv6 Headers\".
[22] IETF RFC 2475: \"An Architecture for Differentiated Services\".
[23] IETF RFC 4867 : \"RTP Payload Format and File Storage Format for the
Adaptive Multi-Rate (AMR) and Adaptive Multi-Rate Wideband (AMR-WB) Audio
Codecs\".
[24] IETF RFC 793: \"Transmission Control Protocol\".
[25] 3GPP TS 29.414: \"Core network Nb data transport and transport
signalling\".
[26] 3GPP TS 29.415: \"Core network Nb interface user plane protocols\".
[27] 3GPP TS 23.205: \"Bearer-independent circuit-switched core network; Stage
2\".
[28] Void.
[29] ITU-T Recommendation Q.2150.1: \"Signalling transport converter on MTP3
and MTP3b\".
[30] ITU-T Recommendations Q.1902.1 to Q.1902.6 (07/01): \"Bearer Independent
Call Control\".
[31] Void.
[32] Void.
[33] Void.
[34] Void.
[35] ITU-T Recommendation Q.765.5: \"Signalling system No. 7 - Application
transport mechanism: Bearer Independent Call Control (BICC)\".
[36] IETF RFC 3264: \"An Offer/Answer Model with the Session Description
Protocol (SDP)\".
[37] IETF RFC 3312: \"Integration of Resource Management and Session
Initiation Protocol (SIP)\".
[38] ITU-T Recommendation Q.850 (05/1998) including Amendment 1 (07/2001):
\"Usage of cause and location in the Digital Subscriber Signalling System No.
1 and the Signalling System No. 7 ISDN User Part\".
[39] IETF RFC 2460: \"Internet Protocol, Version 6 (Ipv6) Specification\".
[40] IETF RFC 3323: \"A Privacy Mechanism for the Session Initiation Protocol
(SIP)\".
[41] IETF RFC 3325: \"Private Extensions to the Session Initiation Protocol
(SIP) for Asserted Identity within Trusted Networks\".
[42] ITU-T Recommendation Q.730 (12/99), Q.731.1 (07/96), Q.731.3 (03/93),
Q.731.4 (03/93), Q.731.5 (03/93), Q.731.6 (03/93), Q.731.7 (06/97), Q.731.8
(02/92), Q.732.2-5 (12/99), Q.732.7 (07/96), Q.733.1 (02/92), Q.733.2 (03/93),
Q.733.3 (06/97), Q.733.4 (03/93), Q.733.5 (12/99), Q.734.1 (03/93), Q.734.2
(07/96), Q.735.1 (03/93), Q.735.3 (03/93), Q.735.6 (07/93), Q.736.1 (10/95),
Q.736.3 (10/95), Q.737.1 (06/97): \"ISDN user part supplementary services\".
[43] ITU-T Recommendation I.363.5 (1996): \"B-ISDN ATM Adaptation Layer
specification: Type 5 AAL\".
[44] ITU-T Recommendation Q.2110 (1994): \"B-ISDN ATM adaptation layer \-
Service Specific Connection Oriented Protocol (SSCOP)\".
[45] ITU-T Recommendation Q.2140 (1995): \"B-ISDN ATM adaptation layer \-
Service specific coordination function for signalling at the network node
interface (SSCF AT NNI)\".
[46] ITU-T Recommendation Q.2210 (1996): \"Message transfer part level 3
functions and messages using the services of ITU-T Recommendation Q.2140\".
[47] 3GPP TS 23.221: \"Architectural requirements\".
[48] ITU-T Recommendation E.164 (05/1997): \"The international public
telecommunication numbering plan\".
[49] ITU-T Recommendation Q.1912.5 (03/04): \"Interworking between Session
Initiation Protocol (SIP) and Bearer Independent Call Control Protocol or ISDN
User Part\".
[50] 3GPP TS 26.102: \"Adaptive Multi-Rate (AMR) speech codec; Interface to Iu
and Uu\".
[51] IETF RFC 3550: \"RTP: A Transport Protocol for Real-Time Applications\".
[52] IETF RFC 3551: \"RTP Profile for Audio and Video Conferences with Minimal
Control\".
[53] IETF RFC 3555: \"MIME Type Registration of RTP Payload Formats\".
[54] IETF RFC 3262: \"Reliability of provisional responses\".
[55] IETF RFC 3311: \"SIP UPDATE method\".
[56] IETF RFC 4566: \"SDP: Session Description Protocol\".
[57] 3GPP TS 26.103: \"Speech Codec List for GSM and UMTS\".
[58] 3GPP TS 28.062: \"Inband Tandem Free Operation (TFO) of speech codecs\".
[59] IETF RFC 3556: \"Session Description Protocol (SDP) Bandwidth Modifiers
for RTP Control Protocol (RTCP) bandwidth\".
[60] 3GPP TS 24.604: \"Communication Diversion (CDIV) using IP Multimedia (IM)
Core Network (CN) subsystem; Protocol specification\".
[61] 3GPP TS 24.605: \"Conference (CONF) using IP Multimedia (IM) Core Network
(CN) subsystem; Protocol specification\".
[62] 3GPP TS 24.606: \"Message Waiting Indication (MWI) using IP Multimedia
(IM) Core Network (CN) subsystem; Protocol specification\".
[63] 3GPP TS 24.607: \"Originating Identification Presentation (OIP) and
Originating Identification Restriction (OIR) using IP Multimedia (IM) Core
Network (CN) subsystem; Protocol specification\".
[64] 3GPP TS 24.608: \"Terminating Identification Presentation (TIP) and
Terminating Identification Restriction (TIR) using IP Multimedia (IM) Core
Network (CN) subsystem; Protocol specification\".
[65] 3GPP TS 24.610: \"Communication HOLD (HOLD) using IP Multimedia (IM) Core
Network (CN) subsystem; Protocol specification\".
[66] Void.
[67] 3GPP TS 24.611: \"Anonymous Communication Rejection (ACR) and
Communication Barring (CB) using IP Multimedia (IM) Core Network (CN)
subsystem; Protocol specification\".
[68] Void.
[69] IETF RFC 4040: \"RTP Payload Format for a 64 kbit/s Transparent Call\".
[70] ETSI EN 300 356-1 (V4.2.1): \"Integrated Services Digital Network (ISDN);
Signalling System No.7 (SS7); ISDN User Part (ISUP) version 4 for the
international interface; Part 1: Basic services [ITU-T Recommendations Q.761
to Q.764 (1999) modified]\".
[71] ETSI EN 300 356-21 (V4.2.1): \"Integrated Services Digital Network
(ISDN); Signalling System No.7 (SS7); ISDN User Part (ISUP) version 4 for the
international interface; Part 21: Anonymous Call Rejection (ACR) supplementary
service\".
[72] ITU-T Recommendation T.38 (09/2010): \"Procedures for real-time Group 3
facsimile communication over IP networks\".
[73] IETF RFC 3362: \"Real-time Facsimile (T.38) - image/t38 MIME Sub-type
Registration\".
[74] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[75] IETF RFC 3515: \"The Session Initiation Protocol (SIP) REFER method\".
[76] Void.
[77] IETF RFC 5079: \"Rejecting Anonymous Requests in the Session Initiation
Protocol (SIP)\".
[78] 3GPP TS 26.110: \"Codec for circuit switched multimedia telephony
service; General description\".
[79] 3GPP TS 26.111: \"Codec for Circuit switched Multimedia Telephony
Service; Modifications to H.324\".
[80] Void.
[81] ITU-T Recommendation H.324 (04/09): \"Terminal for low bitrate multimedia
communication\".
[82] ITU-T Recommendation H.245: \"Control protocol for multimedia
communication\".
[83] ITU-T Recommendation H.261 (03/93): \"Video codec for audiovisual
services at p x 64 kbit/s\".
[84] ITU-T Recommendation H.263 (01/05): \"Video coding for low bitrate
communication\".
[85] Void.
[86] Void.
[87] Void.
[88] 3GPP TS 24.173: \"IMS Multimedia Telephony Communication Service and
Supplementary Services, stage 3\".
[89] IETF RFC 5009: \"Private Header (P-Header) Extension to the Session
Initiation Protocol (SIP) for Authorization of Early Media\".
[90] IETF RFC 2663: \"IP Network Address Translator (NAT) Terminology and
Considerations\".
[91] IETF RFC 7044: \"An extension to the Session Initiation Protocol (SIP)
for Request History Information\".
[92] ITU-T Recommendation Q.769.1 (12/99): \"Signalling system No. 7 - ISDN
user part enhancements for the support of number portability\".
[93] IETF RFC 4694: \"Number portability parameters for the \"tel\" URI\".
[94] Void.
[95] Void.
[96] ETSI EN 300 403‑1 (V1.3.2): \"Integrated Services Digital Network (ISDN);
Digital Subscriber Signalling System No. one (DSS1) protocol; Signalling
network layer for circuit-mode basic call control; Part 1: Protocol
specification [ITU-T Recommendation Q.931 (1993), modified]\".
[97] IETF RFC 3966: \"The tel URI for Telephone Numbers\".
[98] Void.
[99] IETF RFC 7433: \"A Mechanism for Transporting User-to-User Call Control
Information in SIP\".
[99A] IETF RFC 7434: \"Interworking ISDN Call Control User Information with
SIP\".
[100] IETF RFC 4575: \"A Session Initiation Protocol (SIP) Event Package for
Conference State\".
[101] 3GPP TS 24.654: \"Closed User Group (CUG) using IP Multimedia (IM) Core
Network (CN) subsystem, Protocol Specification\".
[102] 3GPP TS 24.616: \"Malicious Communication Identification (MCID) using IP
Multimedia (IM) Core Network (CN) subsystem; Protocol specification\".
[103] 3GPP TS 23.014: \"Technical Specification Group Core Network; Support of
Dual Tone Multi-Frequency (DTMF) signalling\".
[104] 3GPP TS 26.114: \"IP Multimedia Subsystem (IMS); Multimedia Telephony;
Media handling and interaction\".
[105] IETF RFC 4733: \"RTP Payload for DTMF Digits, Telephony Tones and
Telephony Signals\".
[106] IETF RFC 6910: \"Completion of Calls for the Session Initiation Protocol
(SIP)\".
[107] IETF RFC 7462: \"URNs for the Alert-Info Header Field of the Session
Initiation Protocol (SIP)\".
[108] IETF RFC 4715: \"The Integrated Services Digital Network (ISDN)
Subaddress Encoding Type for tel URI\".
[109] IETF RFC 4585: \"Extended RTP Profile for Real-time Transport Control
Protocol (RTCP)-Based Feedback (RTP/AVPF)\".
[110] IETF RFC 5104: \"Codec Control Messages in the RTP Audio-Visual Profile
with Feedback (AVPF)\".
[111] 3GPP TS 24.615: \"Communication Waiting (CW) using IP Multimedia (IM)
Core Network (CN) subsystem, Protocol Specification\".
[112] 3GPP TS 24.642: \"Completion of Communications to Busy Subscriber (CCBS)
Completion of Communications by No Reply (CCNR) using IP Multimedia (IM) Core
Network (CN) subsystem; Protocol specification\".
[113] IETF RFC 4458: \"Session Initiation Protocol (SIP) URIs for Applications
such as Voicemail and Interactive Voice Response (IVR)\".
[114] IETF RFC 5993: \"RTP Payload format for Global System for Mobile
Communications Half Rate (GSM-HR)\".
[115] IETF RFC 6432: \"Carrying Q.850 Codes in Reason Header Fields in SIP
(Session Initiation Protocol) Responses\".
[116] IETF RFC 3326: \"The Reason Header Field for the Session Initiation
Protocol (SIP)\".
[117] ANSI Standard ATIS-1000113.2005(R2010) (07/2005): \"Signalling System
No. 7 (SS7) - Integrated Services Digital Network (ISDN) User Part\".
[118] 3GPP TS 23.237: \"IP Multimedia subsystem (IMS) Service Continuity;
Stage 2\".
[119] IETF RFC 5626: \"Managing Client Initiated Connections in the Session
Initiation Protocol (SIP)\".
[120] IETF RFC 7254: \"A Uniform Resource Name Namespace for the Global System
for Mobile Communications Association (GSMA) and the International Mobile
station Equipment Identity (IMEI)\".
[121] 3GPP TS 23.172: \"Technical realization of Circuit Switched (CS)
multimedia service UDI/RDI fallback and service modification; Stage 2\".
[122] 3GPP TS 23.226: \"Global Text Telephony (GTT); stage 2\".
[123] ITU‑T Recommendation T.140 (02/98): \"Text conversation presentation
protocol\".
[124] IETF RFC 4103: \"RTP Payload for Text Conversation\".
[125] ITU‑T Recommendation V.18 (11/00): \"Operational and interworking
requirements for DCEs operating in the text telephone mode\" including V.18
(2000) Ammendment 1 (11/02): \"Harmonization with ANSI TIA/EIA-825 (2000) text
phones\".
[126] 3GPP TS 26.226: \"Cellular text telephone modem; General description\".
[127] Void.
[128] Void.
[129] IETF RFC 3168: \"The Addition of Explicit Congestion Notification (ECN)
to IP\".
[130] IETF RFC 6679: \"Explicit Congestion Notification (ECN) for RTP over
UDP\".
[131] IETF RFC 3959: \"The Early Session Disposition Type for the Session
Initiation Protocol (SIP)\".
[132] 3GPP TS 24.182: \"IP Multimedia Subsystem (IMS) Customized Alerting
Tones (CAT); Protocol specification\".
[133] IETF RFC 6086: \"Session Initiation Protocol (SIP) INFO Method and
Package Framework\".
[134] 3GPP TS 23.088: \"Call Barring (CB) Supplementary Services; Stage 2\".
[135] IETF RFC 3840: \"Indicating User Agent Capabilities in the Session
Initiation Protocol (SIP)\".
[136] 3GPP TS 22.153: \"Multimedia Priority Service\".
[137] IETF RFC 3023: \"XML Media Types\".
[138] IETF RFC 6665: \"SIP-Specific Event Notification\".
[139] IETF RFC 7090: \"Public Safety Answering Point (PSAP) Callback\".
[141] 3GPP TS 24.292: \"IP Multimedia (IM) Core Network (CN) subsystem
Centralized Services (ICS); Stage 3\".
[142] IETF RFC 6809: \"Mechanism to Indicate Support of Features and
Capabilities in the Session Initiation Protocol (SIP)\".
[143] Void.
[144] Void.
[145] 3GPP TS 23.334: \"IMS Application Level Gateway (IMS-ALG) - IMS Access
Gateway (IMS-AGW) interface: Procedures Descriptions\".
[146] 3GPP TS 26.441: \"Codec for Enhanced Voice Services (EVS); General
Overview\".
[147] 3GPP TS 26.445: \"Codec for Enhanced Voice Services (EVS); Detailed
Algorithmic Description\".
[148] IETF RFC 8119: \"SIP \"cause\" URI Parameter for Service Number
Translation\".
[149] ITU-T Recommendation Q.931 (05/98): \"ISDN user-network interface layer
3 specification for basic call control\".
[150] IETF RFC 5939: \"Session Description Protocol (SDP) Capability
Negotiation\".
[151] 3GPP TS 23.333: \"Multimedia Resource Function Controller (MRFC) \-
Multimedia Resource Function Processor (MRFP) Mp interface: Procedures
Descriptions\".
[152] 3GPP TS 26.453: \"Codec for Enhanced Voice Services (EVS); Speech codec
frame structure\".
[153] IETF RFC 8224: \"Authenticated Identity Management in the Session
Initiation Protocol (SIP)\".
[154] IETF RFC 8197: \"A SIP Response Code for Unwanted Calls\".
[155] IETF RFC 8606: \"ISDN User Part (ISUP) Cause Location Parameter for the
SIP Reason Header Field\".
[156] IETF RFC 8445: \"Interactive Connectivity Establishment (ICE): A
Protocol for Network Address Translator (NAT) Traversal\".
[157] IETF RFC 8839: \"Session Description Protocol (SDP) Offer/Answer
Procedures for Interactive Connectivity Establishment (ICE)\".
[158] IETF RFC 8489: \"Session Traversal Utilities for NAT (STUN)\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [6], ITU-T Recommendation E.164 [48] and the following apply:
**Carrier textphone mode:** a mode for text communication, where continuous
signals (i.e. a carrier tone) are present on the connection irrespective of
whether text is being exchanged or not.
**Carrierless textphone mode:** a mode for text communication, where signals
are only present on the connection when text is being exchanged. E.g.: Baudot
**SS7 signalling function** : function in the CS network, which has the
capabilities to transport the SS7 MTP-User parts ISUP and BICC+STC~mtp~
**SIP signalling function** : function in the IM CN subsystem, which has the
capabilities to transport SIP
**Incoming or Outgoing** : used in the present document to indicate the
direction of a call (not signalling information) with respect to a reference
point.
**Incoming MGCF (I‑MGCF)** : entity that terminates incoming SIP calls from
the IMS side and originates outgoing calls towards the CS side using the BICC
or ISUP protocols.
**Outgoing Interworking Unit (O‑MGCF)** : entity that terminates incoming BICC
or ISUP calls from the CS side and originates outgoing calls towards the IMS
using SIP.
**Root Termination** : refers to Media Gateway as an entity in itself, rather
than a Termination within it. A special TerminationID, \"Root\" is reserved
for this purpose. See ITU-T Recommendation H.248.1. [2]
**Signalling Transport Converter (STC)** : function that converts the services
provided by a particular Signalling Transport to the services required by the
Generic Signalling Transport Service.
**STCmtp** : Signalling Transport Converter on MTP. See ITU-T Recommendation
Q.2150.1 [29].
**BICC+STCmtp** : this terminology means that BICC signalling always needs to
be used on top of STCmtp sublayer.
**diverting URI:** the URI of the node by which the existing communication was
last diverted/forwarded.
**diverted-to URI:** the URI to which the existing communication is
diverted/forwarded to.
**ICE lite:** The lite implementation of the Interactive Connectivity
Establishment (ICE) specified in IETF RFC 8445 [156].
**Full ICE:** The full implementation of the Interactive Connectivity
Establishment (ICE) specified in IETF RFC 8445 [156].
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations as defined in TR
21.905 [6] and the following apply:
18x A SIP status-code in the range 180 through 189
2xx A SIP status-code in the range 200 through 299
3PTY Three Party
3xx A SIP status-code in the range 300 through 399
4xx A SIP status-code in the range 400 through 499
5xx A SIP status-code in the range 500 through 599
6xx A SIP status-code in the range 600 through 699
AAL1 ATM Adaptation Layer type 1
ACR Anonymous Call Rejection
AMR Adaptive Multi-Rate
AMR-WB Adaptive Multi-Rate - WideBand
AMR-WB IO Adaptive Multi-Rate - WideBand Inter-operable Mode, included in the
EVS codec
ANM Answer Message
APM Application Transport Message
APP APPlication-defined RTCP packet
APRI Address Presentation Restriction Indicator
ATP Access Transport Parameter
BC Bearer Capability
BCI Backward Call Indicators
BGCF Breakout Gateway Control Function
BICC Bearer Independent Call Control
CAT Customized Alerting Tones
CB Communication Barring
CCNR Call Completion on No Reply
CCSS Call Completion Service Set-up
Cda Call Deflection Alerting
Cdi Call Deflection Immediate
CDIV Communication Diversion
CdPN Called Party Number
CFB Call Forwarding Busy
CFNR Call Forwarding No Reply
CGB Circuit Group Blocking
CgPN Calling Party Number
CIC Carrier Identification Code
CMR Codec Mode Request
CON Connect
CONF Conference
COT Continuity
CPC Calling Party\'s Category
CPG Call ProGress message
CSI Carrier Selection Information
DSCP DiffServ Code Point
DTX Discontinuous Transmission
ECN Explicit Congestion Notification
ECN-CE ECN Congestion Experienced
EVS Enhanced Voice Services
EVS-CMR Codec Mode Request for EVS
FAC Facility
FQC Frame Quality Classification
GN Generic Number
GRS Group Reset
GVNS Global Virtual Network Service
H/W Hardware
ICE Interactive Connectivity Establishment
ICS IMS Centralized Services
IDR Identification Request
IEPS International Emergency Preference Scheme
I-MGCF Incoming MGCF
IM-MGW IP Multimedia Media Gateway Function
INF Information
INR Information Request
IRS Identification Response
ITCC International Telecommunication Charge Card
ITU-T International Telecommunication Union - Telecommunication
Standardization Sector
MCID Malicious Communication Identification
M3UA MTP-L3 User Adaptation layer
MLPP Multi-Level Precedence and Pre-emption
MONA Media Orientation Negotiation Acceleration
MPC Media Preconfigured Channel
MPS Multimedia Priority Service
MRFP Media Resource Function Processor
MSN Multiple Subscriber Number
MSU Message Signalling Unit
MWI Message Waiting Indication
NOA Nature Of Address indicator
NPDI Number Portability Database Dip Indicator
OIP Originating Identification Presentation
OIR Originating Identification Restriction
OLI Originating Line Information
O-MGCF Outgoing MGCF
PI Progress Indicator
PIDF Presence Information Data Format
PSAP Public Safety Answering Point
REV Reverse Charging
RLC Release Complete
RSC Reset Circuit
RTCP RTP Control Protocol
RTP Real-time Transport Protocol
SAM Subsequent Address Message
SCTP Stream Control Transmission Protocol
SDPCapNeg SDP Capability Negotiation
SGW Signalling Gateway
SPC Signalling Preconfigured Channel
ST Sending Terminated
STUN Session Traversal Utilities for NAT
TCAP Transaction Capabilities Application Part
TDM Time Division Multiplex
TIP Terminating Identification Presentation
TIR Terminating Identification Restriction
TMR Transmission Medium Requirement
TMU Transmission Medium Used
TNL Transport Network Layer
TNS Transit Network Selection
TP Terminal Portability
UA User Agent
UAC User Agent Client
UDI Unrestricted Digital Information
UDI-TA Unrestricted Digital Information with Tones/Announcements
UID User Interactive Dialog
URI Uniform Resource Identifier
USI User Service Information
UUS User-to-User Signalling
XML eXtensible Markup Language
# 4 General
## 4.1 General interworking overview
The IM CN subsystem shall interwork with BICC and ISUP based legacy CS
networks, e.g. PSTN, ISDN, CS PLMNs, in order to provide the ability to
support basic voice calls (see 3GPP TS 22.228 [11]), between a UE located in
the IM CN subsystem and user equipment located in a CS network.
For the ability to support the delivery of basic voice calls between the IM CN
subsystem and CS networks, basic protocol interworking between SIP (as
specified in 3GPP TS 24.229 [9]) and BICC or ISUP (as specified in ITU-T
Recommendations Q.1902.1-6 [30] and ITU-T Recommendations Q761 to Q764 [4]
respectively) has to occur at a control plane level, in order that call setup,
call maintenance and call release procedures can be supported. The MGCF shall
provide this protocol mapping functionality within the IM CN subsystem.
User plane interworking between the IM CN subsystem and CS network bearers
(e.g. 64k TDM, ATM/AAL2 circuit or IP bearer) are supported by the functions
within the IM-MGW. The IM-MGW resides in the IM CN subsystem and shall provide
the bearer channel interconnection. The MGCF shall provide the call control to
bearer setup association.
The IM CN subsystem shall interwork, at the control and user plane, with BICC
and ISUP based legacy CS networks. The support of supplementary services shall
be as defined in 3GPP TS 22.228 [11]. The MGCF and IM-MGW shall support the
interworking of the IM CN subsystem to an external ISUP based CS network. They
may also support interworking to a BICC based CS network where no 3GPP
specific extension is applied. The MGCF and the IM-MGW may also support
interworking to a BICC based CS network where 3GPP specific extensions in
accordance with 3GPP TS 29.205 [14] are applied.
# 5 Network characteristics
## 5.1 Key characteristics of ISUP/BICC based CS networks
This signalling interface to a PSTN is either based on BICC Capability Set 2
as specified in ITU-T Recommendations Q.1902.1 to Q.1902.6 [30], or on ISUP
(see ITU-T Recommendations Q.761 to Q.764 [4]).
The interface towards a CS-PLMN may either be one of the interfaces mentioned
in the paragraph above or a signalling interface based on BICC with 3GPP
specific extensions, as specified for the 3GPP Nc interface in 3GPP TS 29.205
[14], and the IM-MGW may support the 3GPP Nb interface, as specified in 3GPP
TS 29.414 [25] and 3GPP TS 29.415 [26]. If the 3GPP Nc interface is applied as
signalling interface, the 3GPP Nb interface is used as user plane interface
and the Nb UP Framing protocol is applied.
## 5.2 Key characteristics of IM CN subsystem
The IM CN subsystem uses SIP to manage IP multimedia sessions in a 3GPP
environment, it also uses Ipv6, as defined in RFC 2460 [39], as the transport
mechanism for both SIP session signalling and media transport. The 3GPP
profile of SIP defining the usage of SIP within the IM CN subsystem is
specified in 3GPP TS 24.229 [9]. Example callflows are provided in 3GPP TS
24.228 [8].
# 6 Interworking with CS networks
## 6.1 Interworking reference model
Figure 1 details the reference model required to support interworking between
the 3GPP IM CN subsystem and CS networks for IM basic voice calls.
NOTE 1: The logical split of the signalling and bearer path between the CS
network and the IM CN subsystem is as shown, however the signalling and bearer
may be logically directly connected to the IM-MGW.
NOTE 2: The SGW may be implemented as a stand-alone entity or it may be
located in another entity either in the CS network or the IM-MGW. The
implementation options are not discussed in the present document.
NOTE 3: The IM-MGW may be connected via the Mb to various network entities,
such as a UE (via a GTP Tunnel to a GGSN), an MRFP, or an application server.
NOTE 4: A SGW function is not required for certain signalling transports,
where M3UA+SCTP+IP is used in CS network and IM-MGCF.
Figure 1: IM CN subsystem to CS network logical interworking reference model
### 6.1.1 Interworking reference points and interfaces
The reference points and network interfaces shown in figure 1 are as
described:
Protocol for Mg reference point: The single call control protocol applied
across the Mg reference point (i.e. between CSCF and MGCF) will be based on
the 3GPP profile of SIP as defined in accordance with 3GPP TS 24.229 [9].
Protocol for Mn reference point: The Mn reference point describes the
interfaces between the MGCF and IM-MGW, and has the properties as detailed in
3GPP TS 29.332 [15].
Protocol for Mj reference point: The single call control protocol applied
across the Mj reference point (i.e. between BGCF and MGCF) will be based on
the 3GPP profile of SIP as defined in accordance with 3GPP TS 24.229 [9].
Protocol for Mb reference point: The Mb reference point is defined in
accordance with 3GPP TS 23.002 [10] and is Ipv6 based.
### 6.1.2 Interworking functional entities
#### 6.1.2.1 Signalling Gateway Function (SGW)
This component performs the call related signalling conversion to or from
BICC/ISUP based MTP transport networks to BICC/ISUP based SCTP/IP transport
networks, and forwards the converted signalling to or from the MGCF. The
functionality within SGW shall be in accordance with 3GPP TS 23.002 [10].
#### 6.1.2.2 Media Gateway Control Function (MGCF)
This is the component within the IM CN subsystem, which controls the IM-MGW,
and also performs SIP to BICC or SIP to ISUP call related signalling
interworking.
The functionality defined within MGCF shall be defined in accordance with 3GPP
TS 23.002 [10].
#### 6.1.2.3 IP Multimedia - Media Gateway Function (IM-MGW)
This is the component within the IM CN subsystem, which provides the interface
between the PS domain and the CS domain, and it shall support the functions as
defined in accordance with 3GPP TS 23.002 [10].
## 6.2 Control plane interworking model
Within the IM CN subsystem, the 3GPP profile of SIP is used to originate and
terminate IM sessions to and from the UE.
External CS networks use BICC or ISUP to originate and terminate voice calls
to and from the IM CN subsystem.
Therefore, in order to provide the required interworking to enable inter
network session control, the control plane protocols shall be interworked
within the IM CN subsystem. This function is performed within the MGCF (see
clause 6.1.2).
## 6.3 User plane interworking model
Within the IM CN subsystem, Ipv6, and framing protocols such as RTP, are used
to transport media packets to and from the IM CN subsystem entity like UE or
MRFP.
External legacy CS networks use circuit switched bearer channels like TDM
circuits (e.g. 64 kbits PCM), ATM/AAL2 circuit or IP bearers to carry encoded
voice frames, to and from the IM CN subsystem.
Other CN networks use ATM/AAL 1 or AAL 2 or IP as a backbone, with different
framing protocols.
Therefore, in order to provide the required interworking to enable media data
exchange, the user plane protocols shall be translated within the IM CN
subsystem. This function is performed within the IM-MGW (see clause 6.1.2).
# 7 Control plane interworking
Signalling from CS networks to or from IM CN subsystem, where the associated
supported signalling protocols are SS7/M3UA+ SCTP+IP and M3UA+SCTP+IP
respectively, requires a level of interworking between the nodes across the
Control Plane, i.e. the SS7 signalling function, SGW (if applicable), MGCF and
SIP signalling function. This interworking is required in order to provide a
seamless support of a user part, i.e. SIP and BICC+STC~mtp~ or SIP and ISUP.
The transport of SS7 signalling protocol messages of any protocol layer that
is identified by MTP level 3, in SS7 terms, as a user part (MTP3-user) shall
be accomplished in accordance with the protocol architecture defined in the
following clauses. For the present document these protocol layers include, but
are not limited to, Bearer Independent Call Control (BICC)+STC~mtp~ and ISDN
User Part (ISUP).
## 7.1 General
The following clauses define the signalling interworking between the Bearer
Independent Call Control (BICC) or ISDN User Part (ISUP) protocols and Session
Initiation Protocol (SIP) with its associated Session Description Protocol
(SDP) at a MGCF. The MGCF shall act as a Type A exchange (ITU-T Recommendation
Q.764 [4]) for the purposes of ISUP and BICC Compatibility procedures. The
services that can be supported through the use of the signalling interworking
are limited to the services that are supported by BICC or ISUP and SIP based
network domains.
BICC is the call control protocol used between Nodes in a network that
incorporates separate call and bearer control. The BICC/ISUP capabilities or
signalling information defined for national use is outside the scope of the
present document. It does not imply interworking for national-specific
capabilities is not feasible.
The capabilities of SIP and SDP that are interworked with BICC or ISUP are
defined in 3GPP TS 24.229 [9].
Services that are common in SIP and BICC or ISUP network domains will
seamlessly interwork by using the function of the MGCF. The MGCF will
originate and/or terminate services or capabilities that do not interwork
seamlessly across domains according to the relevant protocol recommendation or
specification.
How to create a SIP component which is not mapped from BICC or ISUP
parameter(s) (e.g., the SIP domain name in the SIP URI) is outside the scope
of this specification.
Table 1 lists the services seamlessly interworked and therefore within the
scope of the present document.
Table 1: Interworking Capabilities between BICC/ISUP and SIP profile for 3GPP
* * *
Service Speech/3.1 kHz audio CS data Calls (optional) En bloc address
signalling Overlap address signalling from the CS side towards the IMS Out of
band transport of DTMF tones and information. (BICC only) Inband transport of
DTMF tones and information. (BICC and ISUP) Direct-Dialling-In (DDI) Multiple
Subscriber Number (MSN) Calling Line Identification Presentation (CLIP)
Calling Line Identification Restriction (CLIR) Connected line presentation
(COLP) Connected line restriction (COLR) Carrier routeing
* * *
## 7.2 Interworking between CS networks supporting ISUP and the IM CN
subsystem
The control plane between CS networks supporting ISUP and the IM CN subsystem
supporting SIP, where the underlying network is SS7 and IP respectively is as
shown in figure 2.
Figure 2: Control plane interworking between CS networks supporting ISUP\ and
the IM CN subsystem
### 7.2.1 Services performed by network entities in the control plane
#### 7.2.1.1 Services performed by the SS7 signalling function
The SS7 signalling function provides the capabilities to deliver or receive
SS7 MTP3-User information (e.g. ISUP or BICC+STC~mtp~) across the SS7
signalling network. The functional interface of the MTP, the MTP User parts
and the signalling network are as detailed in ITU-T Recommendations Q.701 to
Q.709 [3].
#### 7.2.1.2 Services of the SGW
The SGW shall perform the functions as described in 3GPP TS 23.002 [10].
In order to support the seamless operation of the MTP3-User part information
between networks incorporating SS7 and IP (either Ipv4, see RFC 791 [16], or
Ipv6, see RFC 2460 [39]), the SGW shall support the services of MTP as well as
the services of the M3UA (see 3GPP TS 29.202 [20]) and SCTP (see RFC 2960
[18]).
#### 7.2.1.3 Services of the MGCF
The session handling and session control of the MGCF shall be as detailed in
3GPP TS 24.229 [9].
The MGCF shall provide the interaction, through the use of its interworking
function, between the SS7 MTP3-User part information, e.g. ISUP, and SIP. The
MGCF interworking function shall also provide the translation between the SS7
MTP3-User part information and SIP, where the interworking of SIP to ISUP and
BICC+STC~mtp~ are detailed below.
#### 7.2.1.4 Services of the SIP signalling function
The SIP signalling function is a logical entity that provides the capabilities
to deliver or receive multimedia session information across the IM CN
subsystem signalling system.
### 7.2.2 Signalling interactions between network entities in the control
plane
#### 7.2.2.1 Signalling between the SS7 signalling function and MGCF
The SGW shall enable the signalling interaction between the SS7 signalling
function and the MGCF.
##### 7.2.2.1.1 Signalling from MGCF to SS7 signalling function
For signalling from the MGCF to the SS7 signalling function, the SGW shall
terminate the SCTP and M3UA protocol layers and deliver the MTP3-User protocol
messages, e.g. ISUP messages, towards the SS7 signalling function. The SGW
transmits and receives SS7 Message Signalling Units (MSUs) to and from the SS7
signalling function over standard SS7 network interfaces, using MTP to provide
reliable transport of the messages.
##### 7.2.2.1.2 Signalling from SS7 signalling function to MGCF
For signalling from the SS7 signalling function to the MGCF, the SGW shall
terminate SS7 MTP2 and MTP3 protocol layers and deliver MTP3-User part
information messages, e.g. ISUP, towards the MGCF. In order to direct messages
received from the SS7 MTP3 network to the appropriate IP destination, e.g.
MGCF, the SGW shall perform a message distribution function using the
information received from the MTP3-User message. Message distribution at the
SGW shall be performed in accordance with 3GPP TS 29.202 [20].
##### 7.2.2.1.3 Services offered by SCTP and M3UA
The SGW internal protocol mapping and transportation between BICC or ISUP
messages and IP encapsulated BICC or ISUP messages respectively is supported
by the services of the M3UA adaptation layer and the underlying SCTP layer.
The SGW shall allow for the transfer of MTP3-User signalling messages, e.g.
BICC or ISUP, to and from an MGCF, where the peer MTP3-User protocol exists.
###### 7.2.2.1.3.1 Services offered by SCTP
SCTP offers the ability to reliably transfer the SCTP User applications, e.g.
M3UA, between the SCTP User application peers. The initialization procedure
used for an association between two SCTP end-to-end peers, and the
initialization to the SCTP User applications shall be performed as detailed in
RCF 2960 [18].
###### 7.2.2.1.3.2 Services offered by M3UA
When an association between two SCTP peers has been established, the use of
M3UA shall provide the transport service in accordance with MTP (see ITU-T
Recommendations Q.701 to Q.709 [3]) to the MTP3-User, e.g. ISUP.
#### 7.2.2.2 Signalling between the MGCF and SIP signalling function
Signalling between the SIP signalling function and the MGCF uses the services
of IP (RFC 2460 [39]), and transport protocol such as TCP (RFC 793 [24]) or
UDP (RFC 768 [17]) or SCTP (RFC 2960 [18]) (see 3GPP TS 24.229 [9]), and SIP.
The naming and addressing concepts between the MGCF and SIP signalling
function shall be detailed in accordance with 3GPP TS 23.228 [12]. The issues
of general IP address management are discussed in 3GPP TS 23.221 [47].
### 7.2.3 SIP-ISUP protocol interworking
When a coding of a parameter value is omitted it implies that it is not
affected by the interworking and the values are assigned by normal protocol
procedures.
#### 7.2.3.1 Incoming call interworking from SIP to ISUP at I-MGCF
##### 7.2.3.1.1 Sending of IAM
On reception of a SIP INVITE requesting a session, the I‑MGCF shall send an
IAM message. The allowed sessions are given in clause 7.2.3.1.2.5.
An I-MGCF shall support both incoming INVITE requests containing SIP
preconditions and 100rel extensions in the SIP Supported or Require header
fields, and INVITE requests not containing these extensions, unless the Note
below applies.
NOTE: If the I-MGCF is deployed in an IMS network that by local configuration
serves no user requiring preconditions, the MGCF may not support incoming
requests requiring preconditions.
The I-MGCF shall interwork forked INVITE requests with different request URIs.
If the SIP precondition extension is not included in the Supported or Require
header field, the I-MGCF shall send an IAM immediately after the reception of
the INVITE, as shown in figure 3. The I-MGCF shall set the continuity
indicators to \"Continuity check not required\".
If a Continuity Check procedure is supported in the ISUP network and SIP
precondition extension are included in the SIP Supported or Require header
field, the I-MGCF shall send the IAM immediately after the reception of the
INVITE, as shown in figure 3. If the received SDP indicates that precondition
is fulfilled the I-MGCF shall set the continuity indicators to \"continuity
check is not required\". If the received SDP indicates that precondition is
not fulfilled the I-MGCF shall set the continuity indicators to \"continuity
check performed on a previous circuit\". The procedure in figure 3 applies
when the value of the continuity indicator is either set to \"continuity check
required\", \"continuity check performed on a previous circuit\" or
\"continuity check not required\". If the continuity indicator is set to
\"continuity check required\" the corresponding procedures at the Mn interface
described in clause 9.2.2.3 also apply.
Figure 3: Receipt of an INVITE request (continuity procedure supported in the
ISUP network)
If Continuity Check procedure is not supported in the ISUP network, and the
SDP in the received INVITE request contains preconditions not met, the I-MGCF
shall delay sending the IAM until the SIP preconditions are met and set the
continuity indicators in the resulting IAM to \"Continuity check not
required\".
Figure 4: Receipt of an INVITE request (continuity procedure not supported in
the ISUP network)
The I-MGCF shall reject an INVITE request for a session only containing
unsupported media types by sending a status code 488 \"Not Acceptable Here\".
If several media streams are contained in a single INVITE request, and if the
I-MGCF does not support multimedia interworking according to Annex E, then the
I-MGCF shall select one of the supported media streams, reserve the codec(s)
for that media stream, and reject the other media streams and unselected
codecs in the SDP answer, as detailed in IETF RFC 3264 [36]. If supported
audio media stream(s) and supported non-audio media stream(s) are contained in
a single INVITE request, an audio stream should be selected.
The I-MGCF shall include a To tag in the first backward non-100 provisional
response, in order to establish an early dialog as described in IETF RFC 3261
[19].
If an MGCF discovers an emergency call it shall, depending on national
requirements, map that to appropriate indication in ISUP.
According to IETF RFC 3261 [19] and IETF RFC 3264 [36], if an INVITE message
is received without an SDP offer, then the I-MGCF sends an SDP offer in the
first reliable non-failure message.
##### 7.2.3.1.2 Coding of the IAM
###### 7.2.3.1.2.0 General
The following ISDN user part parameters description can be found in ITU-T
Recommendation Q.763 [4].
###### 7.2.3.1.2.1 Called party number
The E.164 address encoded in the Request-URI shall be mapped to the called
party number parameter of the IAM message.
Table 2: Coding of the called party number
+----------------------+----------------------+----------------------+ | INVITE→ | IAM→ | | +----------------------+----------------------+----------------------+ | Request-URI | Called Party Number | | +----------------------+----------------------+----------------------+ | E.164 address | **Address Signal** : | | | | | | | (format +CC NDC SN) | Analyse the | | | | information | | | (e.g. as User info | contained in | | | portion of a SIP URI | received E.164 | | | with user=phone, or | address. | | | as tel URI) | | | | | If CC is country | | | | code of the network | | | | in which the next | | | | hop terminates, then | | | | remove \"+CC\" and | | | | use the remaining | | | | digits to fill the | | | | Address signals. | | | | | | | | If CC is not the | | | | country code of the | | | | network in which the | | | | next hop terminates, | | | | then remove \"+\" | | | | and use the | | | | remaining digits to | | | | fill the Address | | | | signals.\ | | | | (NOTE 2) | | +----------------------+----------------------+----------------------+ | []{.underline} | **Odd/even | | | | indicator** : set as | | | | required | | +----------------------+----------------------+----------------------+ | | **Nature of address | | | | indicator** : | | | | | | | | Analyse the | | | | information | | | | contained in | | | | received E.164 | | | | address. | | | | | | | | If CC is country | | | | code of the network | | | | in which the next | | | | hop terminates, then | | | | set Nature of | | | | Address indicator to | | | | \"National | | | | (significant) | | | | number. | | | | | | | | If CC is not the | | | | country code of the | | | | network in which the | | | | next hop terminates, | | | | then set Nature of | | | | Address indicator to | | | | \"International | | | | number\". | | | | | | | | (NOTE 1) | | +----------------------+----------------------+----------------------+ | | **Internal Network | | | | Number Indicator** : | | | | | | | | 1 routing to | | | | internal network | | | | number not allowed | | +----------------------+----------------------+----------------------+ | | **Numbering plan | | | | Indicator** : | | | | | | | | 001 ISDN (Telephony) | | | | numbering plan (Rec. | | | | E.164) | | +----------------------+----------------------+----------------------+ | _national operator | (NOTE 3) |__Address Signal_ _: | | option for service | | | | numbers_ : | | use received non | | | | E.164 number to fill | | Non E.164 numbers | | the Address signals | | | | with national | | (as a local-number | | significant number. | | with a phone-context | | | | in the User Info | | | | portion in a SIP URI | | | | with user=phone, or | | | | as a local number | | | | with a phone-context | | | | in a tel URI) | | | +----------------------+----------------------+----------------------+ | | | **Odd/even | | | | indicator** : set as | | | | required | +----------------------+----------------------+----------------------+ | | | **Nature of address | | | | indicator** : | | | | | | | | \"National | | | | (significant) | | | | number\". (NOTE 1) | +----------------------+----------------------+----------------------+ | | | **Internal Network | | | | Number Indicator** : | | | | | | | | 1 routing to | | | | internal network | | | | number not allowed | +----------------------+----------------------+----------------------+ | | | **Numbering plan | | | | Indicator** : | | | | | | | | 001 ISDN (Telephony) | | | | numbering plan (Rec. | | | | E.164) | +----------------------+----------------------+----------------------+ | | (NOTE 3) | **Address Signal** : | | | | | | | | Use received non | | | | E.164 number to fill | | | | the Address signals. | +----------------------+----------------------+----------------------+ | | | **Odd/even | | | | indicator** : set as | | | | required | +----------------------+----------------------+----------------------+ | | | **Nature of address | | | | indicator** : | | | | | | | | set Nature of | | | | Address indicator to | | | | \"network-specific | | | | number\" or to | | | | \"reserved for | | | | national use\". | +----------------------+----------------------+----------------------+ | | | **Internal Network | | | | Number Indicator** : | | | | | | | | 1 routing to | | | | internal network | | | | number not allowed | +----------------------+----------------------+----------------------+ | | | **Numbering plan | | | | Indicator** : | | | | | | | | Based on operator | | | | policy other | | | | numbering plan | | | | indicators than | | | | \"001 ISDN | | | | (Telephony) | | | | numbering plan (Rec. | | | | E.164)\" can be used | | | | e.g. depending on | | | | phone context value. | +----------------------+----------------------+----------------------+ | NOTE 1: The usage of | | | | \"nature of address | | | | indicator\" value | | | | \"unknown\" is | | | | allowed but the | | | | mapping is not | | | | specified in the | | | | present | | | | specification. | | | | | | | | NOTE 2: If PSTN XML | | | | and ISUP Sending | | | | Terminated (ST) | | | | signal are supported | | | | as a network option, | | | | then the PSTN XML | | | | sendin | | | | gCompleteIndication, | | | | if present, is | | | | mapped to the | | | | sending terminated | | | | digit (hexadecimal | | | | digit F) in the | | | | address signals | | | | field of the Called | | | | Party Number | | | | parameter. | | | | | | | | NOTE 3: Depending on | | | | configuration, | | | | network-specific | | | | numbers (identified | | | | by phone context | | | | according to | | | | operator policy) | | | | should be translated | | | | into \"ISDN | | | | (Telephony) | | | | numbering plan | | | | numbers (Rec. | | | | E.164)\" unless such | | | | a mapping is not | | | | possible and local | | | | operator\'s policy | | | | requires keeping | | | | them in local | | | | format. | | | +----------------------+----------------------+----------------------+
###### 7.2.3.1.2.2 Nature of connection indicators
bits [BA]{.underline} Satellite indicator
0 0 _no satellite circuit in the connection_
bits [DC]{.underline} Continuity check indicator
0 0 _continuity check not required_ , if the continuity check procedure is not
supported in the succeeding network (figure 4).
0 1 _continuity check required_ , if a continuity check shall be carried out
on the succeeding circuit.\ (figure 3)
1 0 _continuity check performed on a previous circuit otherwise_ , if the
continuity check procedure is supported in the succeeding network, but shall
not be carried out on the succeeding circuit otherwise. (figure 3)
bit [E]{.underline} Echo control device indicator
1 _outgoing echo control device included_ , for speech calls, e.g., TMR is
\"3.1KHz audio\".
0 _outgoing echo control device not included_ , for known data calls, e.g.,
TMR \"64 kBit/s unrestricted\" or HLC \"Facsimile Group 2/3\".
###### 7.2.3.1.2.3 Forward call indicators
bits [CB]{.underline} End-to-end method indicator
0 0 _no end-to-end method available (only link-by-link method available)_
bit [D]{.underline} Interworking indicator
1 _interworking encountered_
As a network operator option, the value D = 0 \"No interworking encountered\"
is used if the TMR = 64 kBit/s unrestricted is used.
NOTE: This avoids sending of a progress indicator with progress information 0
0 0 0 0 0 1 \"Call is not end-to-end ISDN; further call progress information
may be available in‑band\", so the call will not be released for that reason
by an ISDN terminal.
bit [E]{.underline} End-to-end information indicator (national use)
0 _no end-to-end information available_
bit [F]{.underline} ISDN user part/BICC indicator
0 _ISDN user part/BICC not used all the way_
As a network operator option, the value F = 1 \"ISDN user part/BICC used all
the way\" is used if the TMR = 64 kBit/s unrestricted is used.
NOTE: This avoids sending of a progress indicator with progress information 0
0 0 0 0 0 1 \"Call is not end-to-end ISDN; further call progress information
may be available in‑band\", so the call will not be released for that reason
by an ISDN terminal.
bits [HG]{.underline} ISDN user part/BICC preference indicator
if any used supplementary service requires ISUP or BICC all the way, depending
on operator policy:
0 0 _ISDN user part/BICC preferred all the way_ , or
1 0 _ISDN user part/BICC required all the way_ ;
Otherwise:
0 1 _ISDN user part/BICC not required all the way_
bit [I]{.underline} ISDN access indicator
0 _originating access non-ISDN_
As a network operator option, the value I = 1 \"originating access ISDN\" is
used if the TMR = 64 kBit/s unrestricted is used.
NOTE: This avoids sending of a progress indicator with progress information 0
0 0 0 1 1 \"Originating access is non-ISDN\", so the call will not be released
for that reason by an ISDN terminal.
bits [KJ]{.underline} SCCP method indicator
0 0 _no indication_
If the PSTN XML is supported as a network option, the Forward Call indicators
derived as shown in Table 02a shall take precedence.
Table 02a: Mapping of PSTN XML elements to Forward call indicators parameter
+----------------------------------+----------------------------------+ | INVITE → | IAM → | +----------------------------------+----------------------------------+ | PSTN XML | Forward call indicators | | | parameter | +----------------------------------+----------------------------------+ | PSTN XML with Progress indicator | bit D Interworking Indicator | | with Progress Description value | | | 6 | 0 \"no interworking encountered | | | (No. 7 signalling all the way)\" | | (Meaning: originating access | | | ISDN) | bit F ISDN User Part indicator | | | | | | 1 \"ISDN User Part used all the | | | way\" | | | | | | bit I ISDN access indicator | | | | | | 1 \"originating access ISDN\" | +----------------------------------+----------------------------------+ | NOTE: Progress Indicator with | | | Progress Description value \"6\" | | | shall not be included in an ATP | | | within the IAM. | | +----------------------------------+----------------------------------+
###### 7.2.3.1.2.4 Calling party\'s category
See ANNEX C for the normative interworking of the CPC parameter.
###### 7.2.3.1.2.4A Originating Line Information
The ISUP Originating Line Information parameter is defined by ANSI Standard
ATIS-1000113 [117], Chapter 3.
See Annex H for the normative interworking of the OLI parameter as a network
option.
###### 7.2.3.1.2.5 Transmission medium requirement
The I-MGCF may either transcode the selected codec(s) to the codec on the PSTN
side or it may attempt to interwork the media without transcoding. If the
I-MGCF transcodes, it shall select the TMR parameter to \"3.1 kHz audio\". If
the I-MGCF does not transcode, it should map the TMR, USI and Access Transport
parameters from the selected codec according to Table 2a. However, if the
I-MGCF supports the PSTN XML body as a network option, and if a PSTN XML body
is received in the INVITE request and the I-MGCF selects media encoded in any
of the formats in table 2a (G.711, Clearmode or t38) among the offered media,
the I-MGCF shall derive these parameters from the XML body instead, as
detailed in table 2b. The I-MGCF should only apply the mapping in table 2b if
the TMR and USI values derived from the selected codec according to table 2a
are equivalent with the values within the first Bearer Capability element in
the PSTN XML, and otherwise the I-MGCF should apply the mapping according to
table 2a.
The support of any of the media listed in table 2a is optional.
If no SDP is received from the remote peer (as described in clause 7.2.3.1.1),
then the TMR parameter should be set to \"3.1 kHz audio\". Transcoding shall
be applied as required.
Table 2a: Coding of TMR/USI/HLC from SDP: SIP to ISUP
+-------+-------+-------+-------+-------+-------+-------+-------+-------+ | | m= | | b= | a= | TMR | USI | HLC | | | | line | | line | line | para | para | IE in | | | | | | (NOTE | | meter | meter | the | | | | | | 4) | | | (opti | ATP | | | | | | | | | onal) | para | | | | | | | | | (NOTE | meter | | | | | | | | | 1) | (opti | | | | | | | | | | onal) | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | \ | ransp | fmt-l | modif | tpmap | codes | nform | I | Layer | | | ort> | ist> | ier> | :\ | | nsfer | Layer | stics | | | | | th-va | \ | oding | | ility | Pro | tific | | | | | | n | | | tocol | ation | | | | | (NOTE | ame> | | | Indi | | | | | | 5) | \[ | | | | | | | | | | \] | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | audio | RT | 0 | N/A | N/A | _\"3 | | | (NOTE | | | P/AVP | | or | | .1KHz | | | 3) | | | | | AS: | | aud | | | | | | | | up to | | io\"_ | | | | | | | | (64 | | | | | | | | | | k | | | | | | | | | | bit/s | | | | | | | | | | + | | | | | | | | | | RTP/U | | | | | | | | | | DP/IP | | | | | | | | | | over | | | | | | | | | | head) | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | audio | RT | Dy | N/A | r | _\"3 | | | (NOTE | | | P/AVP | namic | or | tpmap | .1KHz | | | 3) | | | | PT | AS: | :\  | | | | | | | | | k | PCMU | | | | | | | | | bit/s | /8000 | | | | | | | | | + | | | | | | | | | | RTP/U | | | | | | | | | | DP/IP | | | | | | | | | | over | | | | | | | | | | head) | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | audio | RT | 8 | N/A | N/A | _\"3 | | | (NOTE | | | P/AVP | | or | | .1KHz | | | 3) | | | | | AS: | | aud | | | | | | | | up to | | io\"_ | | | | | | | | (64 | | | | | | | | | | kb | | | | | | | | | | it/s+ | | | | | | | | | | RTP/U | | | | | | | | | | DP/IP | | | | | | | | | | over | | | | | | | | | | head) | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | audio | RT | Dy | N/A | r | _\"3 | | | (NOTE | | | P/AVP | namic | or | tpmap | .1KHz | | | 3) | | | | PT | AS: | :\  | | | | | | | | | k | PCMA | | | | | | | | | bit/s | /8000 | | | | | | | | | + | | | | | | | | | | RTP/U | | | | | | | | | | DP/IP | | | | | | | | | | over | | | | | | | | | | head) | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | audio | RT | Dy | AS: | r | _\"64 |_ \"Un | | | | | P/AVP | namic | (64 | tpmap | k | restr | | | | | | PT | kb | :\ | trict | gital | | | | | | | DP/IP | CLEA | ed\"_| info | | | | | | | over | RMODE | | rmati | | | | | | | head) | /8000 |_ or _| on\"_ | | | | | | | | | | | | | | | | | | (NOTE | _\"64 | * | | | | | | | | 2) | k | (NOTE | | | | | | | | | bit/s | 6)_ | | | | | | | | | pr | | | | | | | | | | eferr | | | | | | | | | | ed\"_| | | | | | | | | | | | | | | | | | | | * | | | | | | | | | | (NOTE | | | | | | | | | | 7)_ | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | image | Ud | t38 \ | N/A | Based | * | * | | _\" | | | ptl \ | [73] | or | on | \"3.1 | \"3.1 | | Facsí | | | [73] | | AS: | ITU-T | KHz | KHz | | mile\ | | | | | up to | T | aud | aud | | Group | | | | | (64 | .38 \ | io\"_ | io\"_| | 2 | | | | | k | [72] | | | | /3\"_ | | | | | bit/s | (NOTE | | | | | | | | | + | 8) | | | | | | | | | U | | | | | | | | | | DP/IP | | | | | | | | | | over | | | | | | | | | | head) | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | image | tcp | t38 \ | N/A | Based | * | * | | _\" | | | | [73] | or | on | \"3.1 | \"3.1 | | Facsí | | | | | AS: | ITU-T | KHz | KHz | | mile\ | | | | | up to | T | aud | aud | | Group | | | | | (64 | .38 \ | io\"_ | io\"_| | 2 | | | | | k | [72] | | | | /3\"_ | | | | | bit/s | | | | | | | | | | + | | | | | | | | | | T | | | | | | | | | | CP/IP | | | | | | | | | | over | | | | | | | | | | head) | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | NOTE | | | | | | | | | | 1: In | | | | | | | | | | this | | | | | | | | | | table | | | | | | | | | | the | | | | | | | | | | codec | | | | | | | | | | G.711 | | | | | | | | | | is | | | | | | | | | | used | | | | | | | | | | only | | | | | | | | | | as an | | | | | | | | | | exa | | | | | | | | | | mple. | | | | | | | | | | Other | | | | | | | | | | c | | | | | | | | | | odecs | | | | | | | | | | are | | | | | | | | | | poss | | | | | | | | | | ible. | | | | | | | | | | | | | | | | | | | | NOTE | | | | | | | | | | 2: | | | | | | | | | | CLEA | | | | | | | | | | RMODE | | | | | | | | | | is | | | | | | | | | | spec | | | | | | | | | | ified | | | | | | | | | | in | | | | | | | | | | RFC40 | | | | | | | | | | 40 [ | | | | | | | | | | 69]. | | | | | | | | | | | | | | | | | | | | NOTE | | | | | | | | | | 3: | | | | | | | | | | HLC | | | | | | | | | | is | | | | | | | | | | nor | | | | | | | | | | mally | | | | | | | | | | a | | | | | | | | | | bsent | | | | | | | | | | in | | | | | | | | | | this | | | | | | | | | | case. | | | | | | | | | | It is | | | | | | | | | | pos | | | | | | | | | | sible | | | | | | | | | | for | | | | | | | | | | HLC | | | | | | | | | | to be | | | | | | | | | | pr | | | | | | | | | | esent | | | | | | | | | | with | | | | | | | | | | the | | | | | | | | | | value | | | | | | | | | | \"Te | | | | | | | | | | lepho | | | | | | | | | | ny\", | | | | | | | | | | alt | | | | | | | | | | hough | | | | | | | | | | 6 | | | | | | | | | | .3.1/ | | | | | | | | | | Q.939 | | | | | | | | | | indi | | | | | | | | | | cates | | | | | | | | | | that | | | | | | | | | | this | | | | | | | | | | would | | | | | | | | | | nor | | | | | | | | | | mally | | | | | | | | | | be | | | | | | | | | | a | | | | | | | | | | ccomp | | | | | | | | | | anied | | | | | | | | | | by a | | | | | | | | | | value | | | | | | | | | | of | | | | | | | | | | \"Spe | | | | | | | | | | ech\" | | | | | | | | | | for | | | | | | | | | | the | | | | | | | | | | I | | | | | | | | | | nform | | | | | | | | | | ation | | | | | | | | | | Tra | | | | | | | | | | nsfer | | | | | | | | | | Capab | | | | | | | | | | ility | | | | | | | | | | ele | | | | | | | | | | ment. | | | | | | | | | | | | | | | | | | | | NOTE | | | | | | | | | | 4: | | | | | | | | | | The | | | | | | | | | | MGCF | | | | | | | | | | s | | | | | | | | | | hould | | | | | | | | | | r | | | | | | | | | | eturn | | | | | | | | | | an | | | | | | | | | | b:AS | | | | | | | | | | band | | | | | | | | | | width | | | | | | | | | | mod | | | | | | | | | | ifier | | | | | | | | | | with | | | | | | | | | | a | | | | | | | | | | band | | | | | | | | | | width | | | | | | | | | | of | | | | | | | | | | 64k | | | | | | | | | | bit/s | | | | | | | | | | + | | | | | | | | | | RTP/U | | | | | | | | | | DP/IP | | | | | | | | | | ove | | | | | | | | | | rhead | | | | | | | | | | in | | | | | | | | | | the | | | | | | | | | | SDP | | | | | | | | | | a | | | | | | | | | | nswer | | | | | | | | | | to | | | | | | | | | | re | | | | | | | | | | quest | | | | | | | | | | that | | | | | | | | | | the | | | | | | | | | | peer | | | | | | | | | | does | | | | | | | | | | not | | | | | | | | | | send | | | | | | | | | | with | | | | | | | | | | a | | | | | | | | | | h | | | | | | | | | | igher | | | | | | | | | | bandw | | | | | | | | | | idth. | | | | | | | | | | If | | | | | | | | | | the | | | | | | | | | | rec | | | | | | | | | | eived | | | | | | | | | | b | | | | | | | | | | =line | | | | | | | | | | indi | | | | | | | | | | cates | | | | | | | | | | a | | | | | | | | | | band | | | | | | | | | | width | | | | | | | | | | gr | | | | | | | | | | eater | | | | | | | | | | than | | | | | | | | | | 64k | | | | | | | | | | bit/s | | | | | | | | | | + | | | | | | | | | | RTP/U | | | | | | | | | | DP/IP | | | | | | | | | | over | | | | | | | | | | head, | | | | | | | | | | the | | | | | | | | | | MGCF | | | | | | | | | | s | | | | | | | | | | hould | | | | | | | | | | also | | | | | | | | | | a | | | | | | | | | | ccept | | | | | | | | | | the | | | | | | | | | | inc | | | | | | | | | | oming | | | | | | | | | | call. | | | | | | | | | | | | | | | | | | | | NOTE | | | | | | | | | | 5: | | | | | | | | | | \ | | | | | | | | | |  | | | | | | | | | | for | | | | | | | | | | \ | | | | | | | | | | of AS | | | | | | | | | | is in | | | | | | | | | | units | | | | | | | | | | of | | | | | | | | | | kb | | | | | | | | | | it/s. | | | | | | | | | | | | | | | | | | | | NOTE | | | | | | | | | | 6: In | | | | | | | | | | the | | | | | | | | | | case | | | | | | | | | | where | | | | | | | | | | the | | | | | | | | | | Clea | | | | | | | | | | rmode | | | | | | | | | | codec | | | | | | | | | | ap | | | | | | | | | | pears | | | | | | | | | | tog | | | | | | | | | | ether | | | | | | | | | | with | | | | | | | | | | s | | | | | | | | | | peech | | | | | | | | | | c | | | | | | | | | | odecs | | | | | | | | | | in | | | | | | | | | | the | | | | | | | | | | same | | | | | | | | | | m- | | | | | | | | | | line, | | | | | | | | | | the | | | | | | | | | | value | | | | | | | | | | \"Un | | | | | | | | | | restr | | | | | | | | | | icted | | | | | | | | | | di | | | | | | | | | | gital | | | | | | | | | | inf. | | | | | | | | | | w/t | | | | | | | | | | ones/ | | | | | | | | | | ann\" | | | | | | | | | | is | | | | | | | | | | appli | | | | | | | | | | cable | | | | | | | | | | but | | | | | | | | | | is | | | | | | | | | | m | | | | | | | | | | apped | | | | | | | | | | into | | | | | | | | | | the | | | | | | | | | | USI | | | | | | | | | | prime | | | | | | | | | | para | | | | | | | | | | meter | | | | | | | | | | (see | | | | | | | | | | c | | | | | | | | | | lause | | | | | | | | | | 7.2. | | | | | | | | | | 3.1.2 | | | | | | | | | | .5a). | | | | | | | | | | | | | | | | | | | | NOTE | | | | | | | | | | 7: | | | | | | | | | | The | | | | | | | | | | value | | | | | | | | | | \"64 | | | | | | | | | | k | | | | | | | | | | /bits | | | | | | | | | | p | | | | | | | | | | refer | | | | | | | | | | red\" | | | | | | | | | | s | | | | | | | | | | hould | | | | | | | | | | only | | | | | | | | | | be | | | | | | | | | | used | | | | | | | | | | if | | | | | | | | | | the | | | | | | | | | | Clea | | | | | | | | | | rmode | | | | | | | | | | codec | | | | | | | | | | ap | | | | | | | | | | pears | | | | | | | | | | tog | | | | | | | | | | ether | | | | | | | | | | with | | | | | | | | | | s | | | | | | | | | | peech | | | | | | | | | | c | | | | | | | | | | odecs | | | | | | | | | | in | | | | | | | | | | the | | | | | | | | | | same | | | | | | | | | | m | | | | | | | | | | -line | | | | | | | | | | and | | | | | | | | | | two | | | | | | | | | | PSTN | | | | | | | | | | XML | | | | | | | | | | B | | | | | | | | | | earer | | | | | | | | | | Capab | | | | | | | | | | ility | | | | | | | | | | ele | | | | | | | | | | ments | | | | | | | | | | a | | | | | | | | | | ppear | | | | | | | | | | in | | | | | | | | | | the | | | | | | | | | | in | | | | | | | | | | itial | | | | | | | | | | I | | | | | | | | | | NVITE | | | | | | | | | | re | | | | | | | | | | quest | | | | | | | | | | as | | | | | | | | | | desc | | | | | | | | | | ribed | | | | | | | | | | in | | | | | | | | | | the | | | | | | | | | | claus | | | | | | | | | | e 7.2 | | | | | | | | | | .3.1. | | | | | | | | | | 2.5a. | | | | | | | | | | | | | | | | | | | | NOTE | | | | | | | | | | 8: | | | | | | | | | | Annex | | | | | | | | | | K | | | | | | | | | | desc | | | | | | | | | | ribes | | | | | | | | | | r | | | | | | | | | | ecomm | | | | | | | | | | ended | | | | | | | | | | va | | | | | | | | | | lues. | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+
Table 2b: Mapping of PSTN XML elements into ISUP Parameters
+----------------+----------------+----------------+----------------+ | INVITE  | IAM  | | | +----------------+----------------+----------------+----------------+ | PSTN XML | Value | ISUP Parameter | Content | +----------------+----------------+----------------+----------------+ | HighLaye | | Access | High layer | | rCompatibility | | Transport | compatibility | | | | Parameter | (NOTE 1) | +----------------+----------------+----------------+----------------+ | LowLaye | | | Low layer | | rCompatibility | | | compatibility | +----------------+----------------+----------------+----------------+ | Be | | User Service | | | arerCapability | | Information | | | (NOTE 2) | | | | +----------------+----------------+----------------+----------------+ | HighLaye | | User Tele | High layer | | rCompatibility | | Service | compatibility | +----------------+----------------+----------------+----------------+ | Be | Speech | TMR | Speech | | arerCapability | | | | | (In | | | | | formationTrans | | | | | ferCapability) | | | | | (NOTE 2) | | | | +----------------+----------------+----------------+----------------+ | | 3.1 kHz audio | | 3.1 kHz audio | +----------------+----------------+----------------+----------------+ | | Unrestricted | | 64 kbit/s | | | digital | | unrestricted | | | information | | | +----------------+----------------+----------------+----------------+ | | Unrestricted | | 64 kbit/s | | | digital | | unrestricted | | | information | | | | | with | | | | | tones | | | | | /announcements | | | +----------------+----------------+----------------+----------------+ | NOTE 1: If two | | | | | high layer | | | | | compatibility | | | | | information | | | | | elements are | | | | | received, they | | | | | shall be | | | | | transferred in | | | | | the same order | | | | | as received in | | | | | the PSTN XML | | | | | body in the | | | | | INVITE | | | | | message. | | | | | | | | | | NOTE 2: If | | | | | there are two | | | | | BCs present, | | | | | see | | | | | clause | | | | | 7.2.3.1.2.5a. | | | | | | | | | | NOTE 3: The | | | | | above mapping | | | | | assumes that | | | | | there is only | | | | | a single | | | | | Be | | | | | arerCapability | | | | | present. | | | | +----------------+----------------+----------------+----------------+
###### 7.2.3.1.2.5a Transmission medium requirement prime and USI prime
(optional)
The procedures to support UDI-TA Fallback mechanism described in the present
clause shall only apply if two PSTN XML Bearer Capability elements appear
within the INVITE Request and the MGCF supports the PSTN XML body as a network
option.
When all the following conditions apply:
\- The INVITE request includes SDP with one m-line with at least two formats,
and with the coding of the first two formats appearing in table 2a;
\- the TMR and USI prime values derived from the first format in the m-line
according to table 2a are equivalent with the values within the second Bearer
Capability element in the PSTN XML;
\- the TMR prime and USI values derived from the second format in the m-line
according to table 2a are equivalent with the values within the first Bearer
Capability element in the PSTN XML; and.
\- the I-MGCF supports forwarding fallback signalling.
Then the I-MGCF shall
\- if TMR \"64 kBit/s preferred\" is supported at the succeeding trunk:
\- map the first XML Bearer Capability element into the \"USI\" within the
IAM;
\- map the the first PSTN XML BearerCapability (InformationTransferCapability)
into the \"TMR prime\" within the IAM, applying the same mapping rules as
specified for the mapping into the \"TMR\" in table 2b;
\- map the second XML Bearer Capability element
(InformationTransferCapability) into the USI prime within the IAM;
\- set the TMR within the IAM to \"64 kBit/s preferred\";
\- configure the IM-MGW; and
\- store those values;
\- if TMR \"64 kBit/s preferred\" is not supported at the succeeding trunk:
\- apply the procedures as described within clause 7.2.3.1.2.5, using the
first Bearer Capability element in the PSTN XMLand the second format in the
m-line;
discard the second Bearer Capability element in the PSTN XML;
\- select the second format in the m-line within the SDP answer; and
\- configure the IM-MGW.
Otherwise (i.e. if some Bearer Capability element in the PSTN XML did not
match the SDP), the I-MGCF shall:
\- discard the XML Bearer Capability elements;
\- if the I-MGCF received at least two formats within the m-line, select one
of those formats, exept for the CLEARMODE codec, within the SDP answer;
\- apply the mapping for the selected format according to table 2a; and
\- configure the IM-MGW accordingly
###### 7.2.3.1.2.6 Calling party number
The SIP \"Privacy\" header field is defined within IETF RFC 3323 [40]. The SIP
\"P-Asserted-Identity\" header field is defined in IETF RFC 3325 [41].
Table 3: Mapping of SIP From/P-Asserted-Identity/Privacy headers to CLI
parameters
+----------+----------+----------+----------+----------+----------+ | Has a | Has a | Calling | Calling | Generic | Generic | | \"P-Ass | \"From\" | Party | Party | Number | Number | | erted-Id | header | Number | Number | (ad | p | | entity\" | field | p | p | ditional | arameter | | header | (NOTE 3) | arameter | arameter | calling | APRI | | field | co | | | party | | | (NOTE 2, | ntaining | Address | APRI | number) | | | NOTE 5, | a URI | signals | | address | | | NOTE 6) | that | | | signals | | | been | encodes | | | | | | r | an E.164 | | | | | | eceived? | address | | | | | | | been | | | | | | | received | | | | | | | (NOTE | | | | | | | 6)? | | | | | +----------+----------+----------+----------+----------+----------+ | No | No | Network | Network | P | Not | | | | option | option | arameter | ap | | | | to | to set | not | plicable | | | | either | APRI to | included | | | | | include | \"pres | | | | | | a | entation | | | | | | network | rest | | | | | | provided | ricted\" | | | | | | E.164 | or | | | | | | number | \"pres | | | | | | (See | entation | | | | | | table 4) | a | | | | | | or omit | llowed\" | | | | | | the | | | | | | | Address | (NOTE | | | | | | signals. | 4)\ | | | | | | | (See | | | | | | | table 5) | | | | | | | | | | | | | | As a | | | | | | | network | | | | | | | option | | | | | | | the APRI | | | | | | | \"pres | | | | | | | entation | | | | | | | re | | | | | | | stricted | | | | | | | by | | | | | | | n | | | | | | | etwork\" | | | | | | | (NOTE 7) | | | | | | | can be | | | | | | | used | | | | | | | instead | | | | | | | of the | | | | | | | APRI | | | | | | | \"pres | | | | | | | entation | | | | | | | rest | | | | | | | ricted\" | | | +----------+----------+----------+----------+----------+----------+ | No | Yes | Network | Network | Network | APRI = | | | | option | option | option | \"pres | | | | to | to set | to | entation | | | | either | APRI to | either | rest | | | | include | \"pres | omit the | ricted\" | | | | a | entation | p | or | | | | network | rest | arameter | \"pres | | | | provided | ricted\" | (if CgPN | entation | | | | E.164 | or | has been | a | | | | number | \"pres | omitted) | llowed\" | | | | (See | entation | or | d | | | | table 4) | a | derive | epending | | | | or omit | llowed\" | from the | on SIP | | | | the | | \"From\" | Privacy | | | | Address | (NOTE 4) | header | header. | | | | signals. | | | | | | | | (See | (NOTE 1) | (See | | | | | table 5) | | table 6) | | | | | | (See | | | | | | As a | table 6) | | | | | | network | | | | | | | option | | | | | | | the APRI | | | | | | | \"pres | | | | | | | entation | | | | | | | re | | | | | | | stricted | | | | | | | by | | | | | | | n | | | | | | | etwork\" | | | | | | | (NOTE 7) | | | | | | | can be | | | | | | | used | | | | | | | instead | | | | | | | of the | | | | | | | APRI | | | | | | | \"pres | | | | | | | entation | | | | | | | rest | | | | | | | ricted\" | | | +----------+----------+----------+----------+----------+----------+ | Yes | No | Derived | APRI = | Not | Not | | | | from | \"pres | included | ap | | | | | entation | | plicable | | | | P-A | rest | | | | | | sserted- | ricted\" | | | | | | Identity | or | | | | | | | \"pres | | | | | | (See | entation | | | | | | table 5) | a | | | | | | | llowed\" | | | | | | | d | | | | | | | epending | | | | | | | on SIP | | | | | | | Privacy | | | | | | | header. | | | | | | | | | | | | | | (See | | | | | | | table 5) | | | +----------+----------+----------+----------+----------+----------+ | Yes | Yes | Derived | APRI = | Network | APRI = | | | | from | \"pres | option | \"pres | | | | | entation | to | entation | | | | P-A | rest | either | rest | | | | sserted- | ricted\" | omit the | ricted\" | | | | Identity | or | p | or | | | | | \"pres | arameter | \"pres | | | | (See | entation | or | entation | | | | table 5) | a | derive | a | | | | | llowed\" | from the | llowed\" | | | | | d | \"From\" | d | | | | | epending | header\ | epending | | | | | on SIP | (NOTE 1) | on SIP | | | | | Privacy | | Privacy | | | | | header. | (See | header. | | | | | | table 6) | | | | | | (See | | (see | | | | | table 5) | | table 6) | +----------+----------+----------+----------+----------+----------+ | NOTE 1: | | | | | | | This | | | | | | | mapping | | | | | | | eff | | | | | | | ectively | | | | | | | gives | | | | | | | the | | | | | | | eq | | | | | | | uivalent | | | | | | | of | | | | | | | Special | | | | | | | Arr | | | | | | | angement | | | | | | | to all | | | | | | | SIP UAC | | | | | | | with | | | | | | | access | | | | | | | to the | | | | | | | I‑MGCF. | | | | | | | | | | | | | | NOTE 2: | | | | | | | It is | | | | | | | possible | | | | | | | that the | | | | | | | P-A | | | | | | | sserted- | | | | | | | Identity | | | | | | | header | | | | | | | field | | | | | | | includes | | | | | | | both a | | | | | | | tel URI | | | | | | | and a | | | | | | | SIP URI. | | | | | | | In this | | | | | | | case, | | | | | | | either | | | | | | | the tel | | | | | | | URI or | | | | | | | the SIP | | | | | | | URI with | | | | | | | user=\ | | | | | | | "phone\" | | | | | | | and a | | | | | | | specific | | | | | | | host | | | | | | | portion, | | | | | | | as | | | | | | | selected | | | | | | | by | | | | | | | operator | | | | | | | policy, | | | | | | | may be | | | | | | | used. | | | | | | | | | | | | | | NOTE 3: | | | | | | | The | | | | | | | \"From\" | | | | | | | header | | | | | | | may | | | | | | | contain | | | | | | | an | | | | | | | \"A | | | | | | | nonymous | | | | | | | User | | | | | | | Ide | | | | | | | ntity\". | | | | | | | An | | | | | | | \"A | | | | | | | nonymous | | | | | | | User | | | | | | | Id | | | | | | | entity\" | | | | | | | includes | | | | | | | inf | | | | | | | ormation | | | | | | | that | | | | | | | does not | | | | | | | point to | | | | | | | the | | | | | | | calling | | | | | | | party. | | | | | | | IETF | | | | | | | RFC 3261 | | | | | | | re | | | | | | | commends | | | | | | | that the | | | | | | | disp | | | | | | | lay-name | | | | | | | c | | | | | | | omponent | | | | | | | contain | | | | | | | \"Anon | | | | | | | ymous\". | | | | | | | That the | | | | | | | A | | | | | | | nonymous | | | | | | | User | | | | | | | Identity | | | | | | | will | | | | | | | take the | | | | | | | form | | | | | | | defined | | | | | | | in | | | | | | | T | | | | | | | S 23.003 | | | | | | | [74]. | | | | | | | The | | | | | | | A | | | | | | | nonymous | | | | | | | User | | | | | | | Identity | | | | | | | i | | | | | | | ndicates | | | | | | | that the | | | | | | | calling | | | | | | | party | | | | | | | desired | | | | | | | an | | | | | | | onymity. | | | | | | | The From | | | | | | | header | | | | | | | may also | | | | | | | contain | | | | | | | an | | | | | | | Una | | | | | | | vailable | | | | | | | User | | | | | | | Identity | | | | | | | as | | | | | | | defined | | | | | | | in | | | | | | | T | | | | | | | S 23.003 | | | | | | | [74], | | | | | | | that | | | | | | | i | | | | | | | ndicates | | | | | | | that the | | | | | | | calling | | | | | | | party is | | | | | | | unknown. | | | | | | | | | | | | | | NOTE 4: | | | | | | | A | | | | | | | national | | | | | | | option | | | | | | | exists | | | | | | | to set | | | | | | | the APRI | | | | | | | to | | | | | | | \" | | | | | | | _Address | | | | | | | not | | | | | | | avail | | | | | | | able_ \". | | | | | | | | | | | | | | NOTE 5: | | | | | | | TS 24.2 | | | | | | | 29 [9] | | | | | | | gu | | | | | | | arantees | | | | | | | that the | | | | | | | received | | | | | | | number | | | | | | | is an | | | | | | | E.164 | | | | | | | number | | | | | | | f | | | | | | | ormatted | | | | | | | as an | | | | | | | inter | | | | | | | national | | | | | | | number, | | | | | | | with a | | | | | | | \"+\" | | | | | | | sign as | | | | | | | prefix. | | | | | | | | | | | | | | NOTE 6: | | | | | | | The | | | | | | | E.164 | | | | | | | numbers | | | | | | | co | | | | | | | nsidered | | | | | | | within | | | | | | | the | | | | | | | present | | | | | | | document | | | | | | | are | | | | | | | composed | | | | | | | by a | | | | | | | Country | | | | | | | Code | | | | | | | (CC), | | | | | | | followed | | | | | | | by a | | | | | | | National | | | | | | | Des | | | | | | | tination | | | | | | | Code | | | | | | | (NDC), | | | | | | | followed | | | | | | | by a | | | | | | | Su | | | | | | | bscriber | | | | | | | Number | | | | | | | (SN). On | | | | | | | the IMS | | | | | | | side, | | | | | | | the | | | | | | | numbers | | | | | | | are | | | | | | | inter | | | | | | | national | | | | | | | public | | | | | | | t | | | | | | | elecommu | | | | | | | nication | | | | | | | numbers | | | | | | | (\"CC\" | | | | | | | +\"NDC\" | | | | | | | +\"SN\") | | | | | | | and are | | | | | | | prefixed | | | | | | | by a | | | | | | | \"+\" | | | | | | | sign. On | | | | | | | the CS | | | | | | | side, it | | | | | | | is a | | | | | | | network | | | | | | | option | | | | | | | to omit | | | | | | | the CC. | | | | | | | | | | | | | | NOTE 7: | | | | | | | This is | | | | | | | an ETSI | | | | | | | specific | | | | | | | value | | | | | | | d | | | | | | | escribed | | | | | | | within | | | | | | | ETSI EN | | | | | | | 300 | | | | | | | 356-1 | | | | | | | [70]. | | | | | | +----------+----------+----------+----------+----------+----------+
Table 4: Setting of the network-provided BICC/ISUP calling party number
parameter with a CLI (network option)
+----------------------------------+----------------------------------+ | BICC/ISUP CgPN Parameter field | Value | +----------------------------------+----------------------------------+ | Screening Indicator | _\"network provided\"_ | +----------------------------------+----------------------------------+ | Number Incomplete Indicator | _\"complete\"_ | +----------------------------------+----------------------------------+ | Number Plan Indicator | _ISDN/Telephony (E.164)_ | +----------------------------------+----------------------------------+ | Address Presentation Restricted | _Presentation | | Indicator | allowed/restricted_ | | | | | | As a network option the APRI | | | value \"presentation restricted | | | by network\" (NOTE) can be used | | | instead of the APRI value | | | \"presentation restricted\" | +----------------------------------+----------------------------------+ | Nature of Address Indicator | If next BICC/ISUP node is | | | located in the same country set | | | to \"_National (Significant) | | | numbe_ r\" else set to | | | \"International number\" | +----------------------------------+----------------------------------+ | Address signals | If NOA is _\"national | | | (significant) number\"_ no | | | country code should be included. | | | If NOA is \"_international | | | number\",_ then the country code | | | of the network-provided number | | | should be included. | +----------------------------------+----------------------------------+ | NOTE: This is an ETSI specific | | | value described within ETSI EN | | | 300 356-1 [70] | | +----------------------------------+----------------------------------+
Table 5: Mapping of P-Asserted-Identity and privacy headers to the ISUP/BICC
calling party number parameter
+----------------+----------------+----------------+----------------+ | SIP Component | Value | BICC/ISUP | Value | | | | Parameter / | | | | | field | | +----------------+----------------+----------------+----------------+ | P-Ass | E.164 number | Calling Party | | | erted-Identity | | Number | | | header field | | | | | (NOTE 1) | | | | +----------------+----------------+----------------+----------------+ | | Number | _\"Complete\"_ | | | | incomplete | | | | | indicator | | | +----------------+----------------+----------------+----------------+ | | Numbering Plan | _\" | | | | Indicator | ISDN/Telephony | | | | | (E.164)\"_ | | +----------------+----------------+----------------+----------------+ | | Nature of | If CC encoded | | | | Address | in the URI is | | | | Indicator | equal to the | | | | | CC of the | | | | | country where | | | | | MGCF is | | | | | located AND | | | | | the next | | | | | BICC/ISUP node | | | | | is located in | | | | | the same | | | | | country then | | | | | | | | | | set to | | | | | _\"national | | | | | (significant) | | | | | number\"_ | | | | | | | | | | else set to | | | | | \" | | | | | _international | | | | | number\"_ | | +----------------+----------------+----------------+----------------+ | | Screening | Network | | | | indicator | Provided | | | | (NOTE 2) | | | +----------------+----------------+----------------+----------------+ | Addr-spec | \"CC\" \"NDC\" | Address signal | If NOA is | | | \"SN\" from | | \"_national | | | the URI | | (significant) | | | | | number\"_ then | | | | | set to | | | | | | | | | | \"NDC\" + | | | | | \"SN\" | | | | | | | | | | If NOA is | | | | | \" | | | | | _international | | | | | number\"_ then | | | | | set to | | | | | \"CC\"+ | | | | | \"NDC\"+\"SN\" | +----------------+----------------+----------------+----------------+ | Privacy header | | APRI | \ | | field is not | | | "_presentation | | present | | | allowed_ \" | +----------------+----------------+----------------+----------------+ | Privacy header | priv-value | APRI | If the Privacy | | field | | | header field | | (IETF RF | | | contains the | | C 3323 [40]) | | | values | | | | | \"_id_ \" (see | | | | | IETF RF | | | | | C 3325 [41]) | | | | | and/or | | | | | \"_header_ \", | | | | | the APRI shall | | | | | be set to | | | | | \ | | | | | "_presentation | | | | | restricted_ \". | | | | | Otherwise, the | | | | | APRI shall be | | | | | set to | | | | | \ | | | | | "_presentation | | | | | allowed_ \". | +----------------+----------------+----------------+----------------+ | NOTE 1: It is | | | | | possible that | | | | | a | | | | | P-Ass | | | | | erted-Identity | | | | | header field | | | | | includes both | | | | | a tel URI and | | | | | a SIP URI. In | | | | | this case, | | | | | either the tel | | | | | URI or the SIP | | | | | URI with | | | | | user=\"phone\" | | | | | and a specific | | | | | host portion, | | | | | as selected by | | | | | operator | | | | | policy, may be | | | | | used. | | | | | | | | | | NOTE 2: As a | | | | | network | | | | | option, the | | | | | MGCF may | | | | | support | | | | | \"Calling | | | | | number | | | | | verification | | | | | using | | | | | signature | | | | | verification | | | | | and | | | | | attestation | | | | | information \" | | | | | feature as | | | | | described in | | | | | IETF RF | | | | | C 8224 [153] | | | | | and | | | | | 3GPP TS | | | | | 24.229 [9]. | | | | | If the I-MGCF | | | | | received a | | | | | \"verstat\" | | | | | tel URI | | | | | parameter | | | | | (defined in | | | | | 3GPP T | | | | | S 24.229 [9] | | | | | c | | | | | lause 7.2A.20) | | | | | in the | | | | | P-Ass | | | | | erted-Identity | | | | | header filed | | | | | the I-MGCF may | | | | | map the | | | | | \"verstat\" | | | | | tel URI | | | | | parameter to | | | | | the Screening | | | | | Indicator | | | | | field as | | | | | follows:\ | | | | | - the value | | | | | \"No-T | | | | | N-Validation\" | | | | | to the value | | | | | \"user | | | | | provided, not | | | | | verified\";\ | | | | | - the value | | | | | \"TN-Valid | | | | | ation-Passed\" | | | | | to the value | | | | | \"user | | | | | provided, | | | | | verified and | | | | | passed\"; and\ | | | | | - the value | | | | | \"TN-Valid | | | | | ation-Failed\" | | | | | to the value | | | | | \"user | | | | | provided, | | | | | verified and | | | | | failed\". | | | | +----------------+----------------+----------------+----------------+
###### 7.2.3.1.2.7 Generic number
Table 6: Mapping of SIP from header field to BICC/ISUP generic number
(additional calling party number) parameter (network option)
+----------------+----------------+----------------+----------------+ | SIP component | Value | BICC/ISUP | Value | | | | parameter / | | | | | field | | +----------------+----------------+----------------+----------------+ | From header | name-addr or | Generic number | _\"additional | | field | addr-spec | | calling party | | | | Number | number\"_ | | | | Qualifier | | | | | Indicator | | +----------------+----------------+----------------+----------------+ | | Nature of | If CC encoded | | | | Address | in the URI is | | | | Indicator | equal to the | | | | | CC of the | | | | | country where | | | | | MGCF is | | | | | located AND | | | | | the next | | | | | BICC/ISUP node | | | | | is located in | | | | | the same | | | | | country then | | | | | | | | | | set to | | | | | _\"national | | | | | (significant) | | | | | number\"_ | | | | | | | | | | else set to | | | | | \" | | | | | _international | | | | | number\"_ | | +----------------+----------------+----------------+----------------+ | | National | Based on the | | | | operator | received local | | | | option for | number and | | | | local numbers | phone-context | | | | (NOTE 2): | set to | | | | | \"_subscriber | | | | Nature of | number_ \" or | | | | Address | \"_unknown_ \". | | | | Indicator | (NOTE 3) | | +----------------+----------------+----------------+----------------+ | | Number | _\"Complete\"_ | | | | incomplete | | | | | indicator | | | +----------------+----------------+----------------+----------------+ | | Numbering Plan | _\" | | | | Indicator | ISDN/Telephony | | | | | (E.164)\"_ | | +----------------+----------------+----------------+----------------+ | | Screening | _\"user | | | | indicator | provided not | | | | (NOTE 1) | verified\"_ | | +----------------+----------------+----------------+----------------+ | Addr-spec | E.164 address | Address signal | If NOA is | | | (format \"+\" | | \"national | | | \"CC\" \"NDC\" | | (significant) | | | \"SN\") from | | number\" then | | | the URI | | set to | | | | | | | | | | \"NDC\" + | | | | | \"SN\" | | | | | | | | | | If NOA is | | | | | \ | | | | | "international | | | | | number\" then | | | | | set to | | | | | \"CC\"+ | | | | | \"NDC\"+\"SN\" | +----------------+----------------+----------------+----------------+ | | National | | Use received | | | operator | | non E.164 | | | option for | | number to fill | | | local numbers | | the Address | | | (NOTE 2): | | signals. | | | | | | | | non E.164 | | | | | address | | | | | (NOTE 4) | | | +----------------+----------------+----------------+----------------+ | Privacy header | | APRI | \ | | field is not | | | "_presentation | | present | | | allowed_ \" | +----------------+----------------+----------------+----------------+ | Privacy header | priv-value | APRI | If the Privacy | | field | | | header field | | (IETF RF | | | contains the | | C 3323 [40]) | | | value | | | | | \"user\", the | | | | | APRI shall be | | | | | set to | | | | | \"presentation | | | | | restricted\". | | | | | Otherwise, the | | | | | APRI shall be | | | | | set to | | | | | \"presentation | | | | | allowed\". | +----------------+----------------+----------------+----------------+ | NOTE 1: As a | | | | | network | | | | | option, the | | | | | MGCF may | | | | | support | | | | | \"Calling | | | | | number | | | | | verification | | | | | using | | | | | signature | | | | | verification | | | | | and | | | | | attestation | | | | | information\" | | | | | feature as | | | | | described in | | | | | IETF RF | | | | | C 8224 [153] | | | | | and | | | | | 3GPP TS | | | | | 24.229 [9]. | | | | | If the I-MGCF | | | | | received a | | | | | \"verstat\" | | | | | tel URI | | | | | parameter | | | | | (defined in | | | | | 3GPP T | | | | | S 24.229 [9] | | | | | c | | | | | lause 7.2A.20) | | | | | in the From | | | | | header filed | | | | | the I-MGCF may | | | | | map the | | | | | \"verstat\" | | | | | tel URI | | | | | parameter to | | | | | the Screening | | | | | Indicator | | | | | field as | | | | | follows:\ | | | | | - the value | | | | | \"No-T | | | | | N-Validation\" | | | | | to the value | | | | | \"user | | | | | provided, not | | | | | verified\";\ | | | | | - the value | | | | | \"TN-Valid | | | | | ation-Passed\" | | | | | to the value | | | | | \"user | | | | | provided, | | | | | verified and | | | | | passed\"; and\ | | | | | - the value | | | | | \"TN-Valid | | | | | ation-Failed\" | | | | | to the value | | | | | \"user | | | | | provided, | | | | | verified and | | | | | failed\". | | | | | | | | | | NOTE 2: Local | | | | | numbers can | | | | | e.g. be | | | | | national | | | | | service | | | | | numbers, | | | | | business | | | | | trunking | | | | | numbers, or | | | | | private | | | | | numbers. | | | | | | | | | | NOTE 3: | | | | | Mapping | | | | | between | | | | | phone-context | | | | | values and | | | | | \"Nature of | | | | | Address | | | | | Indicator\" | | | | | values is | | | | | provisioned in | | | | | the MGCF. | | | | | Setting the | | | | | values of | | | | | \"Nature of | | | | | Address | | | | | Indicator\" is | | | | | dependent on | | | | | local | | | | | operator\'s | | | | | policies. | | | | | | | | | | NOTE 4: A non | | | | | E.164 address | | | | | can either be | | | | | present as a | | | | | local number | | | | | with a | | | | | phone-context | | | | | parameter in | | | | | the user | | | | | portion of a | | | | | SIP URI with | | | | | \"user=phone\" | | | | | or as a local | | | | | number with a | | | | | phone-context | | | | | parameter in a | | | | | tel URI. | | | | +----------------+----------------+----------------+----------------+
###### 7.2.3.1.2.8 User service information
For coding of the USI see 7.2.3.1.2.5.
###### 7.2.3.1.2.9 Hop Counter (National option)
The I-MGCF shall perform the following interworking procedure if the Hop
Counter procedure is supported in the CS network.
At the I‑MGCF the Max-Forwards SIP header shall be used to derive the Hop
Counter parameter if applicable. Due to the different default values (that are
based on network demands/provisions) of the SIP Max-Forwards header and the
Hop Counter, a factor shall be used to adapt the Max Forwards to the Hop
Counter at the I‑MGCF. For example, the following guidelines could be applied:
1) Max-Forwards for a given message should be monotone decreasing with each
successive visit to a SIP entity, regardless of intervening interworking, and
similarly for Hop Counter.
2) The initial and successively mapped values of Max-Forwards should be large
enough to accommodate the maximum number of hops that may be expected of a
validly routed call.
Table 7 shows the principle of the mapping:
Table 7: Max forwards - hop counter
* * *
Max-Forwards = X Hop Counter = INTEGER part of (X /Factor) =Y NOTE: The
Mapping of value X to Y should be done with the used (implemented) adaptation
mechanism.
* * *
The Principle of adoption could be implemented on a basis of the network
provision, trust domain rules and bilateral agreement.
###### 7.2.3.1.2.10 Progress Indicator
If the I-MGCF supports the PSTN XML body as a network option and an INVITE
containing a PSTN XML body is received, an available \"ProgressIndicator\"
element in the PSTN XML body shall be mapped into a Progress Indicator in the
Access Transport Parameter of the sent IAM as shown in table 7.2.3.1.2.10.1.
Table 7.2.3.1.2.10.1: Contents of the Access Transport Parameter
* * *
INVITE → IAM→ PSTN XML Access Transport Parameter Progress indicator Progress
indicator (NOTE) NOTE: A ProgressIndicator with Progress Description value 6
shall not be included into the ISUP ATP, and is mapped instead to Forward call
indicators parameter according to table 02a.
* * *
###### 7.2.3.1.2.11 Location Number
Location Number is defined in clause 3.30 of ITU-T Q.763 [4].
If the received INVITE message contains:
1) only one P-Access-Network-Info header field and the P-Access-Network-Info
header contains only one access network specific component then:
a) if an access-type field with the value \"GSTN\" is received:
i) if an access-info field with the value \"gstn-location\" is present and the
value \"operator-specific-GI\" is not present, the I-MGCF shall include an
ISUP Location Number parameter in the outgoing IAM set as shown in table
7.2.3.1.2.11.1; or
ii) as a network option:
\- if an access-info field with the value \"operator-specific-GI\" is present
and the value \"gstn-location\" is not present, the I-MGCF shall include an
ISUP Location Number parameter in the outgoing IAM set as shown in table
7.2.3.1.2.11.3; or
\- if both values \"gstn-location\" and \"operator-specific-GI\" are present,
the I-MGCF shall include an ISUP Location Number parameter in the outgoing IAM
set as shown in table 7.2.3.1.2.11.1 or table 7.2.3.1.2.11.3, based on local
policy; or
b) as a network option, if an access-type field with a value different from
than\"GSTN\" and an access-info field with the value \"operator-specific-GI\"
are received, the I-MGCF shall include an ISUP Location Number parameter in
the outgoing IAM as shown in table 7.2.3.1.2.11.3; or
2) more P-Access-Network-Info header fields or the P-Access-Network-Info
header field contains more access network specific components then the I-MGCF
shall select the access network specific component which contains a \"network-
provided\" parameter and shall perform the mapping to an ISUP Location Number
parameter as described in bullet 1).
NOTE 1: According to 3GPP TS 24.229 [9] two P-Access-Network-Info header
fields (or one P-Access-Network-Info header field with two access network
specific components) can be received but only one access network specific
component can contain the \"network-provided\" parameter.
NOTE 2: A UE will not create the P-Access-Network-Info header field with the
access-type field value \"GSTN\" and the \"gstn-location\" parameter, as
specified in subclause 7.2A.4.2 of 3GPP TS 24.229 [9]. However the access-type
field value \"GSTN\" without the \"network-provided\" parameter can be
received in interworking cases when the IMS network is used between two CS
networks and the P-Access-Network-Info header field was created by the O-MGCF
in accordance to subclause 7.2.3.2.2.9. Based on local policy, the I-MGCF can
select the P-Access-Network-Info header field with the access-type field value
\"GSTN\" and without the \"network-provided\" parameter.
Table 7.2.3.1.2.11.1: Contents of the location number parameter
* * *
INVITE → IAM→ Location Number parameter P-Access-Network-Info with access-
type=\"GSTN\" and gstn-location parameter Binary value derived from the gstn-
location parameter of the P-Access-Network-Info NOTE: The binary value shall
be obtained by removing the quotes and converting each pair of consecutive
character strings into an octet that has the equivalent hexadecimal
representation
* * *
Table 7.2.3.1.2.11.2: Mapping of P-Access-Network-Info to Location Number
+-----------------------+---------------------------------------------+ | INVITE→ | IAM→ | +-----------------------+---------------------------------------------+ | P-Access-Network-Info | Location Number | +-----------------------+---------------------------------------------+ | access type=\"GSTN\" | **Address Signal** : | | | | | gstn-location=value | Copied from octet 3 to n of the binary | | | representation of the gstn-location field | +-----------------------+---------------------------------------------+ | | **Odd/even indicator** : | | | | | | Copied from bit 8 octet 1 of the binary | | | representation of the gstn-location field | +-----------------------+---------------------------------------------+ | | **Nature of address indicator** : | | | | | | Copied from bit 7 to 1 of octet 1 of the | | | binary representation of the gstn-location | | | field | +-----------------------+---------------------------------------------+ | | **Internal Network Number Indicator** : | | | | | | Copied from bit 8 of octet 2 of the binary | | | representation of the gstn-location field | +-----------------------+---------------------------------------------+ | | **Numbering plan Indicator** : | | | | | | Copied from bit 7 to 5 of octet 2 of the | | | binary representation of the gstn-location | | | field | +-----------------------+---------------------------------------------+ | | **Address presentation restricted | | | indicator** : | | | | | | If the SIP Privacy header field = header, | | | APRI is set to \"01 (presentation | | | restricted)\" otherwise APRI is copied from | | | bit 4 and 3 of octet 2 of the binary | | | representation of the gstn-location field | +-----------------------+---------------------------------------------+ | | **Screening indicator** : | | | | | | If the \"network-provided\" parameter is | | | present in the P-Access-Network-Info header | | | field, set to \"11 (network provided)\" | | | otherwise set from bit 2 and 1 of octet 2 | | | of the binary representation of the | | | gstn-location field | +-----------------------+---------------------------------------------+
Table 7.2.3.1.2.11.3: Mapping of P-Access-Network-Info operator-specific-GI to
Location Number
+----------------------------------+----------------------------------+ | INVITE → | IAM→ | +----------------------------------+----------------------------------+ | | Location Number parameter | +----------------------------------+----------------------------------+ | P-Access-Network-Info with | | | | | | acce | | | ss-info=\"operator-specific-GI\" | | | | | | and operator-specific-GI | | | parameter | | +----------------------------------+----------------------------------+ | P-Access-Network-Info | Location Number | +----------------------------------+----------------------------------+ | acce | **Address Signal :** | | ss-info=\"operator-specific-GI\" | | | | Copy the digits set by 2 digits | | operator-specific-GI=value | per byte. In case of an odd | | | number of address signals, the | | | filler code 0000 is inserted | | | after the last address signal. | +----------------------------------+----------------------------------+ | | **Odd/even indicator** : | | | | | | Set as required | +----------------------------------+----------------------------------+ | | **Nature of address indicator** : | | | | | | Set from an operator-configured | | | value | +----------------------------------+----------------------------------+ | | **Internal Network Number | | | Indicator** : | | | | | | 1 routing to internal network | | | number not allowed | +----------------------------------+----------------------------------+ | | **Numbering plan Indicator** : | | | | | | Set from an operator-configured | | | value | +----------------------------------+----------------------------------+ | | **Address presentation | | | restricted indicator** : | | | | | | If the SIP Privacy header field | | | = header, APRI is set to \"01 | | | (presentation restricted)\" | +----------------------------------+----------------------------------+ | | **Screening indicator** : | | | | | | If the \"network-provided\" | | | parameter is present in the | | | P-Access-Network-Info header | | | field, set to \"11 (network | | | provided)\" | +----------------------------------+----------------------------------+ | NOTE: This mapping is only | | | possible if the | | | operator-specific-GI field of | | | the P-Access-Network-Info header | | | filed contains a sequence of | | | digits. | | +----------------------------------+----------------------------------+
###### 7.2.3.1.2.12 Support of ICS call
If the received initial INVITE request contains a Feature Caps header field,
defined in IETF RFC 6809 [142] with a \"+g.3gpp.ics\" header field parameter
as specified in clause B.4 of 3GPP TS 24.292 [141] then according to operator
policy the I-MGCF may mark a call as an \"ICS call\".
For the call marked as the \"ICS call\" the I-MGCF shall include in the
outgoing IAM message a redirection information parameter field set as shown in
table 7.2.3.1.2.12.1.
Table 7.2.3.1.2.12.1: Contents of the redirection information parameter field
* * *
INVITE → IAM→
Feature‑Caps header field with g.3gpp.ics feature‑capability indicator
Redirection information parameter field
                                                                                                      Redirecting indicator                     *Call diverted, all redirection info presentation restricted*
                                                                                                      Original redirection reason               *Unknown/not available*
                                                                                                      Redirecting reason                        *Unknown/not available*
                                                                                                      Redirection counter                       set to maximum value\
                                                                                                                                                (NOTE)
NOTE: For instance, in ISUP ITU-T Q.763 [4], the Redirection counter parameter
cannot exceed 5.
* * *
###### 7.2.3.1.2.13 UID capability indicators (National option)
UID capability indicators parameter is defined in ITU-T Recommendation Q.763
[4].
When a both-way media path is available, then it is possible to support user
interactive dialogs prior to answer through the use of the P-Early-Media
header field authorizing both‑way media.
If the received initial INVITE request contains a P-Early-Media header field
with the \"supported\" value and either the SDP in the INVITE request allows a
send/receive media path or the INVITE request does not contain an SDP body
then the UID capability indicators parameter in the outgoing IAM message may
be set as shown in table 7.2.3.1.2.13.1.
Table 7.2.3.1.2.13.1: Contents of the UID capability indicators parameter
* * *
INVITE → IAM→  
P-Early-Media with \"supported\" and either SDP with \"sendrecv\" (explicit or
implied) or no SDP present UID capability indicators parameter  
Through-connection indicator 1 \"_through-connection modification possible_ \"
T9 timer indicator 0 \"_no indication_ \"
* * *
###### 7.2.3.1.2.14 Called IN number and original called IN number (optional)
See Annex L for the normative interworking of the called IN number and
original called IN number parameters.
##### 7.2.3.1.2A Coding of the IAM when Number Portability is supported
This clause describes optional coding procedures when Number Portability is
supported.
###### 7.2.3.1.2A.1 Coding of the IAM when a Number Portability Routing Number
is available
ITU-T Q.769.1 [92] describes three possible addressing methods for signalling
of the Called Party E.164 address and Number Portability Routing Number (ITU-T
Q.769.1 [92] uses the terms directory number and network routing number
respectively). The choice of these methods is based on network operator and
national requirements.
The following clauses describe how the IAM is populated, based on these
methods, when a Number Portability Routing Number is available in the Request
URI in the form of a Tel URI \"rn=\" parameter.
When the optional Number Portability Routing Number is available and
supported, these procedures take precedence over procedures for coding of the
Called Party Number described in clause 7.2.3.1.2.1.
If the Number Portability Database Dip Indicator is present within the
Request-URI the procedures described in clause 7.2.3.1.2A.2 apply. When a
Number Portability Routing Number is not available, the Called Party Number
parameter is populated as described in clause 7.2.3.1.2.1.
###### # 7.2.3.1.2A.1.1 Separate Directory Number Addressing Method
Table 7a.0a: Coding of the called party number and called directory number
with Number Portability Separate Directory Number Addressing Method
+----------------------+----------------------+----------------------+ | INVITE→ | IAM→ | | +----------------------+----------------------+----------------------+ | Request-URI | Called Party Number | Called Directory | | | | Number | +----------------------+----------------------+----------------------+ | Called Party E.164 | **Address Signal:** | **Address Signal:** | | address | | | | | Analyse the | Remove \"+CC\" from | | (format +CC NDC SN) | information | the Called Party | | | contained in | E.164 address and | | (e.g. as User info | received Number | use the remaining | | in SIP URI with | Portability Routing | digits to fill the | | user=phone, or as | Number. If the | Address signals. | | tel URL) plus Number | Number Portability | | | Portability Routing | Routing number | | | Number (format +CC | contains an E.164 | | | NDC SN) (e.g. as Tel | address, then remove | | | URI rn= parameter) | \"+CC\" and use the | | | plus Number | remaining digits to | | | Portability Database | fill the Address | | | Dip Indicator as | signal. Otherwise, | | | defined in | use the digits of | | | IETF RFC 4694 [93] | the Number | | | (e.g. as Tel URI | Portability Routing | | | npdi parameter) | number to fill the | | | | Address signal. | | | | | | | | (NOTE) | | +----------------------+----------------------+----------------------+ | | **Odd/even |** Odd/even | | | indicator:**set as | indicator:** set as | | | required | required | +----------------------+----------------------+----------------------+ | | **Nature of address |** Nature of address | | | indicator:**| indicator:** | | | | | | | Set Nature of | Set Nature of | | | Address indicator to | Address indicator to | | | \"Network routing | \"National | | | number in national | (significant) | | | (significant) number | number\". | | | format\". \"National | | | | (significant) | | | | number\" and | | | | \"Network routing | | | | number in network | | | | specific number | | | | format\" may | | | | alternately be | | | | chosen as described | | | | in ITU-T | | | | Q.769.1 [92] | | +----------------------+----------------------+----------------------+ | | **Internal Network |** Internal Network | | | Number Indicator:**| Number Indicator:** | | | | | | | 1 routing to | 1 routing to | | | internal network | internal network | | | number not allowed | number not allowed | +----------------------+----------------------+----------------------+ | | **Numbering plan |** Numbering plan | | | Indicator:**| Indicator:** | | | | | | | 001 ISDN (Telephony) | 001 ISDN (Telephony) | | | numbering plan (Rec. | numbering plan (Rec. | | | E.164) | E.164) | +----------------------+----------------------+----------------------+ | NOTE: If PSTN XML | | | | and ISUP Sending | | | | Terminated (ST) | | | | signal are supported | | | | as a network option, | | | | then the PSTN XML | | | | sendin | | | | gCompleteIndication, | | | | if present, is | | | | mapped to the | | | | sending terminated | | | | digit (hexadecimal | | | | digit F) in the | | | | address signals | | | | field of the Called | | | | Party Number | | | | parameter. | | | +----------------------+----------------------+----------------------+
###### # 7.2.3.1.2A.1.2 Concatenated Addressing Method
Table 7a.0b: Coding of the called party number with Number Portability
Concatenated Addressing Method
+----------------------------------+----------------------------------+ | INVITE→ | IAM→ | +----------------------------------+----------------------------------+ | Request-URI | Called Party Number | +----------------------------------+----------------------------------+ | Called Party E.164 address | **Address Signal** : | | | | | (format +CC NDC SN) | Analyse the information | | | contained in received Number | | (e.g. as User info in SIP URI | Portability Routing Number. If | | with user=phone, or as tel URL) | the Number Portability Routing | | plus | number contains an E.164 | | | address, then remove \"+CC\" and | | Number Portability Routing | use the remaining digits to fill | | Number (format +CC NDC SN) (e.g. | the Address signal. Otherwise, | | as Tel URI rn= parameter) plus | use the digits of the Number | | | Portability Routing number to | | Number Portability Database Dip | fill the Address signal. | | Indicator as defined in | | | IETF RFC 4694 [93] (e.g. as | Remove the \"+CC\" from the | | Tel URI npdi parameter) | Called Party E.164 address and | | | append the remaining digits to | | | the Address signal. | | | | | | (NOTE) | +----------------------------------+----------------------------------+ | | **Odd/even indicator** : set as | | | required | +----------------------------------+----------------------------------+ | | Nature of address indicator: | | | | | | set Nature of Address indicator | | | to \"Network routing number | | | concatenated with called | | | directory number\" or \"National | | | (significant) number\" as | | | described in ITU-T | | | Q.769.1 [92] | +----------------------------------+----------------------------------+ | | **Internal Network Number | | | Indicator** : | | | | | | 1 routing to internal network | | | number not allowed | +----------------------------------+----------------------------------+ | | **Numbering plan Indicator** : | | | | | | 001 ISDN (Telephony) numbering | | | plan (Rec. E.164) | +----------------------------------+----------------------------------+ | NOTE: If PSTN XML and ISUP | | | Sending Terminated (ST) signal | | | are supported as a network | | | option, then the PSTN XML | | | sendingCompleteIndication, if | | | present, is mapped to the | | | sending terminated digit | | | (hexadecimal digit F) in the | | | address signals field of the | | | Called Party Number parameter. | | +----------------------------------+----------------------------------+
###### # 7.2.3.1.2A.1.3 Separate Network Routing Number Addressing Method
Table 7a.0c: Coding of the network routing number and called party number with
Number Portability Separate Network Routing Number Addressing Method
+----------------------+----------------------+----------------------+ | INVITE→ | IAM→ | | +----------------------+----------------------+----------------------+ | Request-URI | Network Routing | Called Party Number | | | Number | | +----------------------+----------------------+----------------------+ | Called Party E.164 | **Address Signal** : | **Address Signal** : | | address | | | | | Analyse the | Remove \"+CC\" from | | (format +CC NDC SN) | information | the Called Party | | | contained in | E.164 address and | | (e.g. as User info | received Number | use the remaining | | in SIP URI with | Portability Routing | digits to fill the | | user=phone, or as | Number. If the | Address signals. | | tel URL) plus Number | Number Portability | | | Portability Routing | Routing number | (NOTE) | | Number (format +CC | contains an E.164 | | | NDC SN) (e.g. as Tel | address, then remove | | | URI rn= parameter) | \"+CC\" and use the | | | plus Number | remaining digits to | | | Portability Database | fill the Address | | | Dip Indicator as | signal. Otherwise, | | | defined in | use the digits of | | | IETF RFC 4694 [93] | the Number | | | (e.g. as Tel URI | Portability Routing | | | npdi parameter) | number to fill the | | | | Address signal. | | +----------------------+----------------------+----------------------+ | | **Odd/even |** Odd/even | | | indicator**: set as | indicator** : set as | | | required | required | +----------------------+----------------------+----------------------+ | | Nature of address | Nature of address | | | indicator: | indicator: | | | | | | | Set Nature of | Set Nature of | | | Address indicator to | Address indicator to | | | \"Network routing | \"National | | | number in national | (significant) | | | (significant) number | number\". | | | format\". | | | | | | | | \"Network routing | | | | number in network | | | | specific number | | | | format\" may | | | | alternately be | | | | chosen as described | | | | in ITU-T | | | | Q.769.1 [92] | | +----------------------+----------------------+----------------------+ | | **Numbering plan |** Internal Network | | | Indicator**: | Number Indicator** : | | | | | | | 001 ISDN (Telephony) | 1 routing to | | | numbering plan (Rec. | internal network | | | E.164) | number not allowed | +----------------------+----------------------+----------------------+ | | | **Numbering plan | | | | Indicator** : | | | | | | | | 001 ISDN (Telephony) | | | | numbering plan (Rec. | | | | E.164) | +----------------------+----------------------+----------------------+ | NOTE: If PSTN XML | | | | and ISUP Sending | | | | Terminated (ST) | | | | signal are supported | | | | as a network option, | | | | then the PSTN XML | | | | sendin | | | | gCompleteIndication, | | | | if present, is | | | | mapped to the | | | | sending terminated | | | | digit (hexadecimal | | | | digit F) in the | | | | address signals | | | | field of the Called | | | | Party Number | | | | parameter. | | | +----------------------+----------------------+----------------------+
###### 7.2.3.1.2A.2 Number Portability Forward Information
Network Operator or National policy may allow forward transfer of number
portability status information, as described in ITU-T Q.769.1 [92]. In this
case, the following coding applies.
Table 7a.0d: Coding of the number portability forward information
+----------------------------------+----------------------------------+ | INVITE→ | IAM→ | +----------------------------------+----------------------------------+ | Request-URI | Number Portability Forward | | | Information | +----------------------------------+----------------------------------+ | Called Party E.164 address | If the Number Portability | | | Database Dip Indicator is | | (format +CC NDC SN) | present, and there is no Number | | | Portability Routing Number, set | | (e.g. as User info in SIP URI | to \"number portability query | | with user=phone, or as tel URL) | done for called number, | | plus Number Portability Routing | non-ported called subscriber\". | | Number (format +CC NDC SN) (e.g. | | | as Tel URI rn= parameter) plus | If the Number Portability | | Number Portability Database Dip | Database Dip Indicator is | | Indicator as defined in | present, and a Number | | IETF RFC 4694 [93] (e.g. as | Portability Routing Number is | | Tel URI npdi parameter) | present, set to \"number | | | portability query done for | | | called number, ported called | | | subscriber\". | | | | | | If there is no Number | | | Portability Database Dip | | | Indicator, set to \"number | | | portability query not done for | | | called number\" | +----------------------------------+----------------------------------+
##### 7.2.3.1.2B Coding of the IAM for Carrier Routeing
This clause describes optional coding procedures for carrier-based routeing.
The interworking of the CIC parameter is defined.
###### 7.2.3.1.2B.1 Coding of the IAM when a Carrier Identification Code (CIC)
is present
The procedures followed in clause 7.2.3.1.2.1 apply with the following
addition.
Based on network configuration, if the tel-URI parameter in a tel-URI or the
userinfo part of a SIP URI with user=phone in the Request-URI of an initial
INVITE request, contains a \"cic=\" parameter, as defined in IETF RFC 4694
[93], the I-MGCF may extract the carrier identification code from the \"cic=\"
field for routeing the call. If the outgoing IAM message contains the Transit
Network Selection (TNS) parameter, as defined in ITU-T Q.763 [4], based on
network configuration the TNS may be populated using the carrier
identification code from the \"cic=\" field. The format of the \"cic\"
parameter (e.g. global-cic and local-cic) shall be compliant to IETF RFC 4694
[93].
###### 7.2.3.1.2B.2 Void
##### 7.2.3.1.3 Sending of COT
Figure 5: Sending of COT
If the IAM has already been sent, the Continuity message shall be sent
indicating \"continuity check successful\", when all of the following
conditions have been met:
\- The requested remote preconditions (if any) in the IMS network have been
met.
\- The media stream previously set to inactive mode is set to active (as
specified in IETF RFC 4566 [56]).
\- Local preconditions have been fulfilled.
\- A possible outstanding continuity check procedure is successfully performed
on the outgoing circuit.
##### 7.2.3.1.3A Sending of SAM
###### 7.2.3.1.3A.1 General
The procedures in the present clause are only applicable if the I-MGCF
supports the network option of overlap signalling, using either the in-dialog
method or the multiple INVITEs method. Within one IMS only a single of those
methods shall be used.
After the ISUP IAM message has been sent the I-MGCF can receive additional
digits. The additional digits may either, as a network option, be received in:
\- in-dialog SIP INFO requests (\"legacy\" mode of usage of the INFO method as
defined in IETF RFC 6086 [133]), in-dialog method as specified in clause
7.2.3.1.3A.2 or
\- in additional SIP INVITE requests, multiple INVITEs method as specified in
7.2.3.1.3A.3.
Figure 5a: Sending of SAM
###### 7.2.3.1.3A.2 Additional digits received in in-dialog SIP INFO requests
If interworking of overlap signalling using the in-dialog method is supported
by the I-MGCF, the ISUP IAM message has already been sent, but no ISUP ACM or
REL message has been received, and a SIP INFO request carrying additional
digits is received, then the I-MGCF shall generate a SAM and pass it to
outgoing BICC/ISUP procedures. The SAM shall contain in its Subsequent Number
parameter only the additional digits received in this SIP INFO request.
###### 7.2.3.1.3A.3 Additional digits received in SIP INVITE requests
If interworking of overlap signalling using the multiple INVITEs method is
supported by the I-MGCF, the ISUP IAM message has already been sent, but no
ISUP ACM or REL message has been received, and the I-MGCF receives an INVITE
with the same Call‑ID and From tag as a previous INVITE which was associated
with a BICC/ISUP call/bearer control instance currently existing on the
BICC/ISUP side, then:
a) If the number of digits in the Request‑URI is greater than the number of
digits already received for the communication, the I-MGCF shall generate a SAM
and pass it to outgoing BICC/ISUP procedures. The SAM shall contain in its
Subsequent Number parameter only the additional digits received in this
Request‑URI compared with the digits already received for the communication.
The I-MGCF shall reply to any earlier INVITE with a 484 Address Incomplete
response if this has not already been done.
b) If the number of digits in the Request‑URI is equal or less than the number
of digits already received for the communication, then the I-MGCF shall
immediately send a 484 Address Incomplete response for this INVITE. In this
case, no SAM shall be sent to BICC/ISUP procedures.
Figure 5b: Receipt of subsequent INVITE for multiple INVITEs method overlap
signalling
On sending of a 484 Address Incomplete message for an INVITE transaction, the
I-MGCF considers any offer/answer exchange initiated by the INVITE to be
terminated. The new INVITE initiates a new offer/answer exchange. However, if
resources have already been reserved and they can be reused within the new
offer/answer exchange, the precondition signalling shall reflect the current
status of the affected preconditions.
##### 7.2.3.1.4 Sending of 180 ringing
###### 7.2.3.1.4.0 General
The I-MGCF shall send the SIP 180 Ringing response when receiving any of the
following messages:
\- ACM with Called party\'s status indicator set to subscriber free.
[]{.underline}
NOTE: Whether the P-Early-Media header field is included depends on whether
the received INVITE contains a P-Early-Media header field with the
\"supported\" parameter as described in IETF RFC 5009 [89] or based on local
policy.
Figure 6: The receipt of ACM
\- CPG with Event indicator set to alerting
[]{.underline}
NOTE: Whether the P-Early-Media header field is included depends on whether
the received INVITE contains a P-Early-Media header field with the
\"supported\" parameter as described in IETF RFC 5009 [89] or based on local
policy.
Figure 7: Receipt of CPG (Alerting)
For a speech call that is not identified as an \"ICS call\" as specified in
clause 7.2.3.1.2.12, if the INVITE request includes the P-Early-Media header
field, the I-MGCF shall include in the SIP 180 Ringing response a P-Early-
Media header field authorizing backward early media, except when
\- the I-MGCF has already sent a reliable provisional response (see IETF RFC
3262 [54]) including a P-Early-Media header, as defined in IETF RFC 5009 [89],
and
\- the most recently sent P-Early-Media header field authorized backward early
media.
NOTE: If the I-MGCF signals the P-Early-Media header field authorizing
backward early media, then the IMS can expect tones or announcements to the
calling party to flow from the CS network via an MGW controlled by the I-MGCF.
In particular, once the I-MGCF sends the 180 Ringing response, ringback is
expected in media from the CS network.
If the INVITE request doesn\'t include the P-Early-Media header field with the
\"supported\" parameter and if the speech call is not identified as the \"ICS
call\" as specified in clause 7.2.3.1.2.12, then as a network option the
I-MGCF may include in the SIP 180 Ringing response a P-Early-Media header
field authorizing backward early media.
As a network option, an I-MGCF may generate a Call-Info header field, or an
Alert-Info header field according to rules and procedures of IETF RFC 3261
[19] to provide media instead of the in-band media received from the PSTN.
For the speech call identified as the \"ICS call\" as specified in clause
7.2.3.1.2.12, if the I-MGCF has received the P-Early-Media header field in the
initial INVITE request, the I-MGCF shall include in the SIP 180 Ringing
response the P-Early-Media header field indicating the backward early media is
not authorised, except when:
\- the I-MGCF has already sent a reliable provisional response (see IETF RFC
3262 [54]) including a P-Early-Media header, as defined in IETF RFC 5009 [89];
and
\- the most recently sent P-Early-Media header field did not authorize the
backward early media.
If the P-Early-Media header field with the \"supported\" parameter was not
included in the initial INVITE request, then as a network option the I-MGCF
may include in the SIP 180 Ringing response the P-Early-Media header field
indicating the backward early media is not authorised for the \"ICS call\".
###### 7.2.3.1.4.0a PSTN XML body
The procedures in the present clause apply only if the I-MGCF supports the
PSTN XML body as a network option. The I-MGCF shall map the Access Transport
parameter received in the CPG or ACM into PSTN XML elements as shown in table
7a.0f and include this PSTN XML body in the 180 Ringing.
Table 7a.0f: Mapping of ISUP ATP Parameter into PSTN XML elements
+----------------------+----------------------+----------------------+ | 18x | CPG or ACM | | +----------------------+----------------------+----------------------+ | PSTN XML | ISUP Parameter | Content | +----------------------+----------------------+----------------------+ | ProgressIndicator | Access Transport | Progress indicator | | | Parameter | | +----------------------+----------------------+----------------------+ | Hi | | High layer | | ghLayerCompatibility | | compatibility | | (NOTE 2) | | | +----------------------+----------------------+----------------------+ | L | | Low layer | | owLayerCompatibility | | compatibility | | (NOTE 2) | | | +----------------------+----------------------+----------------------+ | BearerCapability | | Bearer Capability | | (NOTE 1, NOTE 2) | | | +----------------------+----------------------+----------------------+ | BearerCapability | Transmission medium | | | (NOTE 1, NOTE 2) | used parameter (NOTE | | | | 1) | | +----------------------+----------------------+----------------------+ | NOTE 1: see | | | | clause 7.2.3.1.4.1 | | | | Transmission Medium | | | | Used parameter (TMU) | | | | | | | | NOTE 2: The I-MGCF | | | | shall only provide | | | | this IE if it | | | | interworks media | | | | encoded in any of | | | | the formats in table | | | | 2a (G.711, | | | | Clearmode, or t38) | | | | without transcoding. | | | | If both TMU and a BC | | | | in the ATP have been | | | | received, the BC in | | | | the ATP shall be | | | | mapped. | | | +----------------------+----------------------+----------------------+
The I-MGCF shall map a possibly available \"ProgressIndicator\" element in the
ATP parameter within the ACM or CPG into a Progress Indicator in the PSTN XML
body of the 180 Ringing. In addition, the I-MGCF shall map the Backward call
indicators parameter and the Optional backward call indicators parameter (if
present) within the ACM or CPG into other ProgressIndicator(s) in the PSTN XML
body of the 180 Ringing as shown in table 7a.0g.
NOTE: The order of ProgressIndicators within the same PSTN XML body is
irrelevant.
Table 7a.0g: Mapping of ISUP BCI and optional BCI parameters into PSTN XML
ProgressIndicator
+----------------------------------+----------------------------------+ | ← 180 Ringing | ←ACM or CPG | +----------------------------------+----------------------------------+ | PSTN XML body with | Backward call indicators | | ProgressIndicator with | parameter | | \"Progress Description\" value | | | No (Value of PI) | Optional backward call | | | indicators parameter | +----------------------------------+----------------------------------+ | No. 1 | Backward call indicators | | | parameter | | (\"Call is not end-to-end ISDN: | | | further call progress | ISDN User Part indicator | | information may be available | | | in-band\") | 0 \"ISDN User Part not used all | | | the way\" | +----------------------------------+----------------------------------+ | No. 2 | Backward call indicators | | | parameter | | (\"Destination address is | | | non-ISDN\") | ISDN User Part indicator | | | | | | 1 \"ISDN User Part used all the | | | way\" | | | | | | ISDN access indicator | | | | | | 0 \"Terminating access | | | non-ISDN\" | +----------------------------------+----------------------------------+ | No. 7 | Backward call indicators | | | parameter | | (\"Terminating access ISDN\") | | | | ISDN User Part indicator | | | | | | 1 \"ISDN User Part used all the | | | way\" | | | | | | ISDN access indicator | | | | | | 1 \"Terminating access ISDN\" | +----------------------------------+----------------------------------+ | No. 8 | Optional backward call | | | indicators parameter | | (\"In-band information or an | | | appropriate pattern is now | In-band information indicator | | available\") | | | | \"in-band information or an | | | appropriate pattern is now | | | available\" | +----------------------------------+----------------------------------+ | NOTE: The ProgressIndicator | | | \"Coding Standard\" parameter | | | shall be set to \"00 (ITU-T | | | standardized coding)\". The | | | default value for the | | | ProgressIndicator \"Location\" | | | parameter is \"0011 (Transit | | | Network)\". | | +----------------------------------+----------------------------------+
###### 7.2.3.1.4.0b Fallback by I-MGCF
If the I-MGCF supports the PSTN XML body as a network option and the I-MGCF
received two PSTN XML Bearer Capability elements within the INVITE Request,
but the succeeding trunk does not support TMR \"64 kBit/s preferred\" (as
described in clause 7.2.3.1.2.5a), and if no corresponding elements were
received in the Access Transport Parameter (see table 7a.0f), then the I-MGCF
shall create a PSTN XML body containing the following elements, and include it
in the 18x Response :
\- a BearerCapability element, which shall be copied from the first
BearerCapability element received in the PSTN XML in the INVITE;
\- if two HighLayerCompatibility elements were present in the PSTN XML body in
the INVITE, then a HighLayerCompatibility element, which shall be copied from
the first HighLayerCompatibility element received in the PSTN XML in the
INVITE; and
\- a ProgressIndicator element with \"Progress Description\" value 5
(\"Interworking has occurred and has resulted in a telecommunication service
change\"),\"Coding Standard\" value \"00 (ITU-T standardized coding)\", and
default value \"0011 (Transit Network)\" for the \"Location\" parameter.
###### 7.2.3.1.4.1 Fallback in a succeeding network: Transmission Medium Used
parameter (TMU) received
The procedures in the present clause apply only if the I-MGCF supports the
PSTN XML body as a network option and receives a Transmission Medium Used
parameter (TMU).
NOTE: The I-MGCF will only receive a TMU parameter if it has applied the
Fallback related procedures in clause 7.2.3.1.2.5a, including both a TMR and
TMR Prime in the IAM, and fallback to the bearer capability identified in TMR
Prime and USI occurred in a succeeding network.
If the I-MGCF receives a Transmission Medium Used parameter (TMU) , the I-MGCF
shall:
\- If an BC is not available in the ATP in the Address Complete Message (ACM)
or Call Progress Message (CPG), map the TMU value (Speech or 3.1 kHz audio) to
the PSTN XML BearerCapability;
\- If an BC is available in the ATP in the Address Complete Message (ACM) or
Call Progress Message (CPG), include the received BC value in the PSTN XML
BearerCapability;
\- configure the IM-MGW to use the second format in the m-line in the SDP that
has been received in the INVITE as codec at the IMS termination; and
\- send SDP selecting the second format in the m-line of the SDP that has been
received in the INVITE as soon as allowed according to SIP rules.
Table 7.2.3.1.4.1.1: Sending of BC fallback indication
+----------------------------------+----------------------------------+ | ← 180 Ringing or 183 Session | ←ACM/CPG | | Progress | | +----------------------------------+----------------------------------+ | PSTN XML BearerCapability = | TMU \"Speech\" | | \"Speech\" | | | | ATP No BC | +----------------------------------+----------------------------------+ | PSTN XML BearerCapability = | TMU \"3.1 kHz audio\" | | \"3.1 kHz audio\" | | | | ATP No BC | +----------------------------------+----------------------------------+ | PSTN XML BearerCapability | TMU \"Speech or 3.1 kHz audio\" | | received in the ATP\ | | | (\"speech\" or \"3.1 kHz | ATP BC (\"speech\" or \"3.1 kHz | | audio\") | audio\") | +----------------------------------+----------------------------------+
##### 7.2.3.1.4A Sending of 183 Session Progress for early media scenarios
If SIP preconditions are used, the first 183 Session Progress will be sent
after the reception of the INVITE request, before any ISUP message has been
received from the CS network. The I-MGCF shall not include the P-Early-Media
header field in any SIP message before it receives an ISUP ACM.
For a speech call, which is not identified as an \"ICS call\" as specified in
clause 7.2.3.1.2.12, upon receipt of one of the following messages and if the
I-MGCF has received the P-Early-Media header field in the INVITE request, and
has not already sent a provisional response including a P-Early-Media header
field with parameters indicating authorization of early media with the same
directionality as determined by table 7.2.3.1.4A.1 or table 7.2.3.1.4A.2, then
the I-MGCF shall send the 183 Session Progress response with a P-Early-Media
header field authorizing early media as indicated:
\- ACM with the value of the called party\'s status indicator \"no
indication\" and one of the options described in table 7.2.3.1.4A.1 If the
I-MGCF supports the PSTN XML body as a network option, the I-MGCF shall map
parameters within the ACM into the PSTN XML body within the 183 as indicated
in table 7.2.3.1.4A.1. Based on local configuration, the I-MGCF may also send
a 183 Session Progress response with a P-Early-Media header field authorizing
early media if it receives an ACM with other parameters than described in
table 7.2.3.1.4A.1.
Figure 7c: Receipt of ACM \"No indication\"
Table 7.2.3.1.4A.1: ACM Parameters that trigger the 183 Session Progress
response
+----------------------------------+----------------------------------+ | ← 183 Session Progress | ← ACM | +----------------------------------+----------------------------------+ | P-Early-Media header field | Optional backward call | | authorizing backward early | indicators parameter | | media, if not already sent | | | (NOTE 2) | In-band information indicator | | | | | PSTN XML with ProgressIndicator | 1 \"In-band info or an | | with \"Progress Description\" | appropriate pattern is\ | | value No. 8 | now available\" | | | | | (\"In-band information or | | | appropriate pattern is now | | | available\") (NOTE 1) | | +----------------------------------+----------------------------------+ | PSTN XML with ProgressIndicator | Backward call indicators | | with \"Progress Description\" | parameter | | value No. 1 | | | | ISDN User Part indicator | | (\"Call is not end-to-end ISDN: | | | further call progress | 0 \"ISDN User Part not used all | | information may be available | the way\" | | in-band\") (NOTE 1) | | +----------------------------------+----------------------------------+ | PSTN XML with ProgressIndicator | Backward call indicators | | with \"Progress Description\" | parameter | | value No. 2 (\"Destination | | | address is non-ISDN\") (NOTE 1) | ISDN User Part indicator | | | | | | 1 \"ISDN User Part used all the | | | way\" | | | | | | ISDN access indicator | | | | | | 0 \"Terminating access | | | non-ISDN\" | +----------------------------------+----------------------------------+ | PSTN XML with ProgressIndicator | Backward call indicators | | with \"Progress Description\" | parameter | | value No. 7 | | | | ISDN User Part indicator | | (\"Terminating access ISDN\") | | | (NOTE 1) | 1 \"ISDN User Part used all the | | | way\" | | | | | | ISDN access indicator | | | | | | 1 \"Terminating access ISDN\" | +----------------------------------+----------------------------------+ | P-Early-Media header field | UID action indicators parameter | | authorizing both-way early | | | media, if not already sent | Through-connection instruction | | (NOTE 2) | indicator | | | | | | 1 \"through-connect in both | | | directions\" | +----------------------------------+----------------------------------+ | NOTE 1: The ProgressIndicator | | | \"Coding Standard\" parameter | | | shall be set to \"00 (ITU-T | | | standardized coding)\". The | | | default value for the | | | ProgressIndicator \"Location\" | | | parameter is \"0011 (Transit | | | Network)\". | | | | | | NOTE 2: Setting of the | | | P-Early-Media header field based | | | on the UID action indicators | | | parameter value of | | | \"through-connect in both | | | directions\" takes precedence | | | over setting based on the | | | Optional backward call | | | indicators parameter value of | | | \"In-band info or an appropriate | | | pattern is now available\". | | +----------------------------------+----------------------------------+
NOTE 1: As a network option the I-MGCF can also map ACM into 183 in other
cases than those described in table 7.2.3.1.4A.1.
\- CPG message, when:
1\. Event indicator is set to \"in-band information or an appropriate pattern
is now available\", or
2\. Event indicator is set to \"Progress\" and one of the options described in
table 7.2.3.1.4A.2.
Figure 7d: Receipt of CPG (in-band information available)
Table 7.2.3.1.4A.2: CPG Parameters that trigger the 183 Session Progress
response
+----------------------------------+----------------------------------+ | ←183 Session Progress | ←CPG | +----------------------------------+----------------------------------+ | P-Early-Media header field | **Event indicator** | | authorizing backward early | | | media, if not already sent | 000 0010 (progress) | | (NOTE 4) | | | | **Optional backward call | | PSTN XML with ProgressIndicator | indicators parameter** | | with \"Progress Description\" | | | value No. 8 | In-band information indicator | | | | | (\"In-band information or | 1 \"In-band info or an | | appropriate pattern is now | appropriate pattern is now\ | | available\") (NOTE 3) | available\" | +----------------------------------+----------------------------------+ | PSTN XML with ProgressIndicator | **Event indicator** | | with \"Progress Description\" | | | value No. 1 | 000 0010 (progress)\ | | | \ | | (Call is not end-to-end ISDN: | **Backward call indicators | | further progress information may | parameter** \ | | be available in-band\") (NOTE 3) | ISDN User Part indicator | | | | | | 0 \"ISDN User Part not used all | | | the way\" | +----------------------------------+----------------------------------+ | PSTN XML with ProgressIndicator | **Backward call indicators | | with \"Progress Description\" | parameter** | | value No. 2 (\"Destination | | | address is non-ISDN\") (NOTE 3) | ISDN User Part indicator | | | | | | 1 \"ISDN User Part used all the | | | way\" | | | | | | ISDN access indicator | | | | | | 0 \"Terminating access | | | non-ISDN\" | +----------------------------------+----------------------------------+ | PSTN XML with ProgressIndicator | **Backward call indicators | | with \"Progress Description\" | paramete** r | | value No. 7 | | | | ISDN User Part indicator | | (\"Terminating access ISDN\") | | | (NOTE 3) | 1 \"ISDN User Part used all the | | | way\" | | | | | | ISDN access indicator | | | | | | 1 \"Terminating access ISDN\" | +----------------------------------+----------------------------------+ | P-Early-Media header field | **UID action indicators | | authorizing both-way early | parameter** | | media, if not already sent | | | (NOTE 4) | Through-connection instruction | | | indicator | | | | | | 1 \"through-connect in both | | | directions\" | +----------------------------------+----------------------------------+ | NOTE 1: The mapping of the | | | contents in the CPG message is | | | only relevant if the information | | | received in the message is | | | different compared to earlier | | | received information, e.g., in | | | the ACM message or a CPG message | | | received prior to this message. | | | | | | NOTE 2: 183 Session Progress | | | message including a | | | P-Early-Media header authorizing | | | early media may only be sent for | | | a speech call. | | | | | | NOTE 3: The ProgressIndicator | | | \"Coding Standard\" parameter | | | shall be set to \"00 (ITU-T | | | standardized coding)\". The | | | default value for the | | | ProgressIndicator \"Location\" | | | parameter is \"0011 (Transit | | | Network)\". | | | | | | NOTE 4: Setting of the | | | P-Early-Media header field based | | | on the UID action indicators | | | parameter value of | | | \"through-connect in both | | | directions\" takes precedence | | | over setting based on the | | | Optional backward call | | | indicators parameter value of | | | \"In-band info or an appropriate | | | pattern is now available\". | | +----------------------------------+----------------------------------+
NOTE 2: As a network option the I-MGCF can also map CPG into 183 in other
cases than those described in table 7.2.3.1.4A.1.
If the INVITE request doesn\'t include the P-Early-Media header field with the
\"supported\" parameter, then as a network option the I-MGCF may include in
the SIP 180 Ringing response a P-Early-Media header field authorizing early
media.
If the I-MGCF supports the PSTN XML body as a network option, the I-MGCF shall
map the Access Transport Parameter received in the CPG or ACM into PSTN XML
elements as shown in table 7a.0f and include this XML body in the 183 Session
Progress. The I-MGCF shall include both a ProgressIndicator mapped from
possibly received Progress indicator element in the Access Transport Parameter
and ProgressIndicators derived according to table 7.2.3.1.4A.1 or table
7.2.3.1.4A.2 in the PSTN XML body.
NOTE 3: The order of ProgressIndicators within the same PSTN XML body is
irrelevant.
If the I-MGCF has applied UDI-TA fallback related procedures in clause
7.2.3.1.2.5a, the I-MGCF shall also apply the procedures in clauses
7.2.3.1.4.0b and 7.2.3.1.4.1, including the PSTN XML body in the 183 Session
Progress.
As a network option, an I-MGCF may generate a Call-Info header field, or an
Alert-Info header field according to rules and procedures of IETF RFC 3261
[19] to provide media instead of the in-band media received from the PSTN.
If the ACM or CPG contains an ISUP Cause, the MGCF may add a Reason header
field containing the received Cause Value to the SIP 183 Session Progress
provisional response as a network option. The mapping of the Cause Indicators
parameter to the Reason header as shown in table 9a shall be applied. IETF RFC
6432 [115] describes the use of the Reason header field in responses. The
Reason header field itself is described in IETF RFC 3326 [116].
##### 7.2.3.1.4B Sending of 181Call is being forwarded
The I-MGCF shall send the SIP 181 Call is being forwarded when receiving any
of the following messages:
\- ACM with call diversion information not indicating that presentation is not
allowed and optional backward call indicators indicate that in-band
information is available.
[]{.underline}
NOTE 1: Whether the P-Early-Media header field is included depends on whether
the received INVITE contains a P-Early-Media header field with the
\"supported\" parameter as described in IETF RFC 5009 [89] or based on local
policy.
Figure 7c: The receipt of ACM (call diversion information)
\- CPG with call diversion information not indicating that presentation is not
allowed and optional backward call indicators indicate that in-band
information is available.
[]{.underline}
NOTE 1: Whether the P-Early-Media header field is included if the received
INVITE contains a P-Early-Media header field with the \"supported\" parameter
as described in IETF RFC 5009 [89] or based on local policy.
Figure 7d: Receipt of CPG (Call diversion information)
For a speech call, and if the INVITE request includes the P-Early-Media
header, the I-MGCF shall include in the SIP 181 Call is being forwarded
response a P‑Early-Media header authorizing early media, except when
\- the I-MGCF has already sent a reliable provisional response including a
P-Early-Media header field, as defined in IETF RFC 5009 [89], or a 180 Ringing
response; and
\- the most recently sent P-Early-Media header field authorized early media.
NOTE: If the I-MGCF signals the P-Early-Media header field authorizing early
media, then the IMS can expect tones or announcements to the calling party to
flow from the CS network via an MGW controlled by the I‑MGCF.
If the INVITE request doesn\'t include the P-Early-Media header field with the
\"supported\" parameter, then as a network option the I-MGCF may include in
the SIP 180 Ringing response a P-Early-Media header field authorizing early
media.
##### 7.2.3.1.4C Sending of 183 Session Progress for overlap signalling using
the in-dialog method
If the I-MGCF supports the network option of overlap signalling using the in-
dialog method, and the SIP INVITE request contained an indication that the
100rel extension is supported or required, the I-MGCF shall send a reliable
183 (Session Progress) response immediately after the reception of an INVITE
request.
NOTE: If the INVITE request does not contain an indication that the 100rel
extension is supported or required, it is assumed that overlap is not used,
and that no further digits will be received.
##### 7.2.3.1.4D Sending of 183 Session Progress to carry ISUP Cause
If the I-MGCF receives an ACM or CPG message containing an ISUP Cause, and if
the I-MGCF does not send any SIP provisional response due to interworking
procedures described in clauses 7.2.3.1.4A, for the ACM or CPG message, the
I-MGCF may send a SIP 183 Session Progress with a Reason header field
containing the received Cause Value as a network option. The mapping of the
Cause Indicators parameter to the Reason header as shown in table 9a shall be
applied. IETF RFC 6432 [115] describes the use of the Reason header field in
responses. The Reason header field itself is described in IETF RFC 3326 [116].
[]{.underline}
Figure 7.2.3.1.4D.1: The receipt of ACM or CPG with ISUP Cause
##### 7.2.3.1.4E Sending of 183 Session Progress for ICS call
For a speech call identified as an \"ICS call\" as specified in clause
7.2.3.1.12 if the I‑MGCF has received:
\- ACM message with the value of the called party\'s status indicator \"_no
indication_ \" and the optional backward call indicators parameter field with
the in-band information indicator set to \"_in-band information or an
appropriate pattern is now available_ \"; or
\- CPG message with the event indicator of the event information parameter
field set to:
1 \"_in-band information or an appropriate pattern is now available_ \"; or
2 \"_progress_ \" and the optional backward call indicators parameter field
with the in-band information indicator set to \"_in-band information or an
appropriate pattern is now available_ \"; and
\- if the received ACM or CPG message does not contain the cause indicators
parameter field then:
a) if the I‑MGCF has received a P‑Early‑Media header field in the initial
INVITE request; and
b) the I‑MGCF has not already sent a provisional response including the
P‑Early‑Media header field with parameters indicating that a backward early
media is not authorised;
the I‑MGCF shall send the 183 Session Progress response with the P‑Early‑Media
header field indicating the backward early media is not authorised. If the
I‑MGCF supports a PSTN XML body as a network option, the I‑MGCF shall map
parameters within the ACM or CPG message into the PSTN XML body within the 183
Session Progress response as indicated in clause 7.2.3.1.4A; or
\- otherwise if the received ACM or CPG message contains the cause indicators
parameter field the I‑MGCF shall send a final response to the initial INVITE
request according to table 9 in clause 7.2.3.1.8 with a Reason header field
containing the received (Q.850) cause value. The mapping of the cause
indicators parameter field to the Reason header field as shown in table 9a
shall be applied. IETF RFC 6432 [115] describes the use of the Reason header
field in responses. The Reason header field itself is described in IETF
RFC3326 [116].
##### 7.2.3.1.5 Sending of the 200 OK (INVITE)
The following cases are possible trigger conditions for sending the 200 OK
(INVITE):
\- The reception of the ANM.
Figure 8: Receipt of ANM
\- The reception of the CON message.
Figure 9: Receipt of CON
If the I-MGCF supports the PSTN XML body as a network option, the I-MGCF shall
map the Access Transport Parameter received in the ANM or CON into PSTN XML
elements as shown in table 7.2.3.1.5.1 and include this PSTN XML body in the
200 OK (INVITE).
On receipt of an ANM/CON message containing the ATP including the Bearer
Capability set to \"unrestricted digital information with tones/announcement\"
without TMU parameter the 200 OK message shall contain the PSTN XML Bearer
Capability \"unrestricted digital information with tones/announcement\".
If the I-MGCF supports the PSTN XML body as a network option, the I-MGCF shall
map an available BCI element in the ANM or CON into a ProgressIndicator in the
PSTN XML body as shown in table 7.2.3.1.5.2; the I-MGCF shall include both a
ProgressIndicator mapped from possibly received Progress indicator element in
the Access Transport Parameter and ProgressIndicators derived according to
table 7.2.3.1.5.2 in the PSTN XML.
NOTE 1: The order of ProgressIndicators within the same PSTN XML body is
irrelevant.
Table 7.2.3.1.5.1: Mapping of ISUP ATP Parameter into PSTN XML elements
+----------------------+----------------------+----------------------+ | 200 OK | ANM or CON | | +----------------------+----------------------+----------------------+ | PSTN XML | ISUP Parameter | Content | +----------------------+----------------------+----------------------+ | ProgressIndicator | Access Transport | Progress indicator | | | Parameter | | +----------------------+----------------------+----------------------+ | Hi | | High layer | | ghLayerCompatibility | | compatibility | | (NOTE 2) | | | +----------------------+----------------------+----------------------+ | L | | Low layer | | owLayerCompatibility | | compatibility | | (NOTE 2) | | | +----------------------+----------------------+----------------------+ | BearerCapability | | Bearer Capability | | (NOTE 1, NOTE 2) | | | +----------------------+----------------------+----------------------+ | BearerCapability | Transmission medium | | | (NOTE 1, NOTE 2) | used parameter (NOTE | | | | 1) | | +----------------------+----------------------+----------------------+ | NOTE 1: see | | | | clause 7.2.3.1.4.1 | | | | Transmission Medium | | | | Used parameter (TMU) | | | | | | | | NOTE 2: The I-MGCF | | | | shall only provide | | | | this IE if it | | | | interworks media | | | | encoded in any of | | | | the formats in table | | | | 2a (G.711, | | | | Clearmode, or t38) | | | | without transcoding. | | | | If both TMU and a BC | | | | in the ATP have been | | | | received, the BC in | | | | the ATP shall be | | | | mapped. | | | +----------------------+----------------------+----------------------+
Table 7.2.3.1.5.2: Mapping of ISUP BCI and optional BCI parameters into PSTN
XML ProgressIndicator
+----------------------------------+----------------------------------+ | ← 200 OK | ←ANM or CON | +----------------------------------+----------------------------------+ | PSTN XML body with | Content | | ProgressIndicator with | | | \"Progress Description\" value | Backward call indicators | | No (Value of PI) (NOTE) | parameter | | | | | | Optional backward call | | | indicators parameter | +----------------------------------+----------------------------------+ | No. 1 | Backward call indicators | | | parameter | | (\"Call is not end-to-end ISDN: | | | further call progress | ISDN User Part indicator | | information may be available | | | in-band\") | 0 \"ISDN User Part not used all | | | the way\" | +----------------------------------+----------------------------------+ | No. 2 | Backward call indicators | | | parameter | | (\"Destination address is | | | non-ISDN\") | ISDN User Part indicator | | | | | | 1 \"ISDN User Part used all the | | | way\" | | | | | | ISDN access indicator | | | | | | 0 \"Terminating access | | | non-ISDN\" | +----------------------------------+----------------------------------+ | No. 7 | Backward call indicators | | | parameter | | (\"Terminating access ISDN\") | | | | ISDN User Part indicator | | | | | | 1 \"ISDN User Part used all the | | | way\" | | | | | | ISDN access indicator | | | | | | 1 \"Terminating access ISDN\" | +----------------------------------+----------------------------------+ | No. 8 | Optional backward call | | | indicators parameter | | (\"In-band information or an | | | appropriate pattern is now | In-band information indicator | | available\") | | | | 1 \"in-band information or an | | | appropriate\ | | | pattern is now available\" | +----------------------------------+----------------------------------+ | NOTE: The ProgressIndicator | | | \"Coding Standard\" parameter | | | shall be set to \"00 (ITU-T | | | standardized coding)\". The | | | default value for the | | | ProgressIndicator \"Location\" | | | parameter is \"0011 (Transit | | | Network)\". | | +----------------------------------+----------------------------------+
If the I-MGCF supports the PSTN XML body and receives a Transmission Medium
Used (TMU) parameter,
NOTE 2: The I-MGCF will only receive a TMU parameter if it has applied the
Fallback related procedures in clause 7.2.3.1.2.5a, including both a USI and
TMR Prime parameter in the IAM, and fallback to the bearer capability
identified in USI and TMR Prime occurred at the terminating side.
Then the I-MGCF shall:
\- if a BC is not available in the ATP in the ANM or CON, map the TMU value
(Speech or 3.1 kHz audio) to the PSTN XML BearerCapability element;
\- if a BC is available in the ATP in the ANM or CON, include the received BC
in the PSTN XML BearerCapability element;
\- configure the IM-MGW to use the second format in the m-line in the SDP that
has been received in the INVITE as codec at the IMS termination; and
\- send SDP selecting the second format in the m-line of the SDP that has been
received in the INVITE as soon as allowed according to SIP rules.
If the I-MGCF supports the PSTN XML body, has applied the Fallback related
procedures in clause 7.2.3.1.2.5a, including both a TMR and TMR Prime in the
IAM, and did not receive TMU in the ANM, CON, or any previous ISUP message,
NOTE 3: Fallback to the bearer capability identified in TMR did not occurre at
the terminating side.
Then the I-MGCF shall:
\- configure the IM-MGW to use the first format in the m-line in the SDP offer
that has been received in the INVITE as codec at the IMS termination; and
\- send SDP selecting the first format in the m-line in the SDP offer at the
first possibility according to SIP rules.
##### 7.2.3.1.6 Sending of the Release message (REL)
The following are possible triggers for sending the Release message:
\- Receipt of the BYE method
Figure 10: Receipt of the Bye method
\- Receipt of the CANCEL method
Figure 11: Receipt of Cancel method
Additional triggers are contained in table 10.
##### 7.2.3.1.7 Coding of the REL
Coding of the REL message depends on the Reason header field (specified in
IETF RFC 3326 [116]) contained in the BYE or CANCEL request.
If the Reason header field is missing or does not contain a cause parameter
then the ISUP Cause Value in the REL message shall be coded as shown in table
8.
If the Reason header field contains a protocol header field parameter set to
\"Q.850\" then the ISUP Cause Value shall be coded as shown in table 8a.
If the Reason header field contains a protocol header field parameter set to
\"SIP\" then, as a network option, the ISUP Cause Value may be coded as shown
in table 8aa.
The Location Field shall be set to \"_network beyond interworking point_ \".
If, as a network option, the I-MGCF supports the location header field
parameter as described in IETF RFC 8606 [155], the I-MGCF shall instead derive
the ISUP cause location from the location parameter in the SIP Reason header
field as shown in table 8c.
Table 8: Coding of REL
* * *
SIP Message  REL  Request cause indicators parameter BYE Cause value No. 16
(Normal call clearing) CANCEL Cause value No. 16 (Normal call clearing)
* * *
Table 8a: Mapping of SIP Reason header field\ into Cause Indicators parameter
-- Q.850 protocol case
* * *
Component of SIP Reason header field Component value BICC/ISUP Parameter field
Value Protocol \"_Q.850_ \" Cause Indicators parameter - protocol‑cause
\"_cause = XX_ \" (NOTE 1) Cause Value \"_XX_ \" (NOTE 1) \- - Location
_\"network beyond interworking point\"_ NOTE: \"XX\" is the Cause Value as
defined in ITU-T Recommendation Q.850 [38].
* * *
Table 8aa: Mapping of SIP Reason header field into Cause Indicators parameter
- SIP protocol case
+----------------+----------------+----------------+----------------+ | Component of | Component | BICC/ISUP | Value (NOTE 2) | | SIP Reason | value | Parameter | | | header field | | field | | +----------------+----------------+----------------+----------------+ | Protocol | \"_SIP_ \" | Cause | - | | | | Indicators | | | | | parameter | | +----------------+----------------+----------------+----------------+ | protocol‑cause | \"_cause = | Cause Value | \"_ 13 _\" (Call | | | 200_ \" | | completed | | | (NOTE 1) | | elsewhere) | +----------------+----------------+----------------+----------------+ | - | - | Location | _\"network | | | | | beyond | | | | | interworking | | | | | point\"_ | +----------------+----------------+----------------+----------------+ | NOTE 1: The | | | | | usage of SIP | | | | | response codes | | | | | such as | | | | | \"200\" is | | | | | specified in | | | | | 3GPP TS | | | | | 24.229 [9]. | | | | | | | | | | NOTE 2: The | | | | | ISUP Cause | | | | | Value in the | | | | | REL message | | | | | shall be coded | | | | | as shown in | | | | | table 8 if the | | | | | connected CS | | | | | network is | | | | | other | | | | | operator\'s | | | | | network, | | | | | except when a | | | | | bilateral | | | | | agreement for | | | | | use of the | | | | | cause value(s) | | | | | exists between | | | | | the operators. | | | | +----------------+----------------+----------------+----------------+
NOTE: The mapping of reason headers towards the ISDN can be misused due to
possible user creation of the reason header since there is no screening in
IMS.
If the I-MGCF supports this PSTN XML body as a network option and the I-MGCF
interworks media encoded in any of the formats in table 2a (G.711, Clearmode
or t38) without transcoding, and if a PSTN XML body is received in the BYE or
CANCEL request, the I-MGCF shall derive the Access Transport Parameter in the
REL message from the PSTN XML body as shown in table 8b.
Table 8b: Mapping of PSTN XML elements into ISUP Parameters
* * *
BYE or CANCEL  REL   
PSTN XML ISUP Parameter Content HighLayerCompatibility Access Transport
Parameter High layer compatibility LowLayerCompatibility Low layer
compatibility
* * *
Table 8c: Mapping of SIP Reason header field location parameter\ into Cause
Indicator Location parameter
* * *
Component of SIP Reason header field Component value BICC/ISUP Parameter field
Value location U Location user LPN private network serving the local user LN
public network serving the local user TN transit network RLN public network
serving the remote user RPN private network serving the remote user LOC-6
network beyond interworking point INTL international network LOC-8 network
beyond interworking point LOC-9 network beyond interworking point BI network
beyond interworking point LOC-11 network beyond interworking point LOC-12
network beyond interworking point LOC-13 network beyond interworking point
LOC-14 network beyond interworking point LOC-15 network beyond interworking
point NOTE: The interworking of the location value as described in this table
is a network option.
* * *
##### 7.2.3.1.8 Receipt of the Release Message
If the REL message is received and a final response (i.e. 200 OK (INVITE)) has
already been sent, the I-MGCF shall send a BYE message.
NOTE: According to SIP procedures, in the case that the REL message is
received and a final response (e.g. 200 OK (INVITE)) has already been sent
(but no ACK request has been received) on the incoming side of the I-MGCF then
the I-MGCF does not send a 487 Request terminated response and instead waits
until the ACK request is received before sending a BYE message.
If the REL message is received and the final response (i.e. 200 OK (INVITE))
has not already been sent, the I-MGCF shall send a Status-Code 4xx (Client
Error), 5xx (Server Error) or 6xx (Global Failure) response. The Status code
to be sent is determined by examining the Cause value received in the REL
message. Table 9 specifies the mapping of the cause values, as defined in
ITU-T Recommendation Q.850 [38], to SIP response status codes. Cause values
not appearing in the table shall have the same mapping as the appropriate
class defaults according to ITU-T Recommendation Q.850 [38].
Table 9: Receipt of the Release message (REL)
+----------------------------------+----------------------------------+ | ←SIP Message | ← REL | +----------------------------------+----------------------------------+ | Status code | Cause indicators parameter | +----------------------------------+----------------------------------+ | 404 Not Found | Cause value No 1 (Unallocated | | | (unassigned) number) | +----------------------------------+----------------------------------+ | 604 Does not exist anywhere | Cause value No 2 (No route to | | | specified transit network) | +----------------------------------+----------------------------------+ | 604 Does not exist anywhere | Cause value No 3 (No route to | | | destination) | +----------------------------------+----------------------------------+ | 500 Server Internal error | Cause value No 4 (Send special | | | information tone) | +----------------------------------+----------------------------------+ | 404 Not Found | Cause value No 5 (Misdialled | | | trunk prefix) | +----------------------------------+----------------------------------+ | 486 Busy Here | Cause value No 17 (User busy) | +----------------------------------+----------------------------------+ | 408 Request Timeout IF \"ICS | Cause value No 18 (No user | | call\" (NOTE 4) | responding) | | | | | ELSE 480 Temporarily unavailable | | +----------------------------------+----------------------------------+ | 480 Temporarily unavailable | Cause value No 19 (No answer | | | from user (user alerted)) | +----------------------------------+----------------------------------+ | 408 Request Timeout IF \"ICS | Cause value No 20 (Subscriber | | call\" (NOTE 4) | absent) | | | | | ELSE 480 Temporarily unavailable | | +----------------------------------+----------------------------------+ | 603 Decline IF location field is | Cause value No 21 (Call | | set to user ELSE 403 Forbidden | rejected) | +----------------------------------+----------------------------------+ | 410 Gone | Cause value No 22 (Number | | | changed) | +----------------------------------+----------------------------------+ | 410 Gone | Cause value No 23 (Redirection | | | to new destination) | +----------------------------------+----------------------------------+ | 433 Anonymity Disallowed (NOTE | Cause value No 24 (Call rejected | | 1) | due to feature at the | | | destination) | +----------------------------------+----------------------------------+ | 483 Too Many Hops | Cause value No 25 (Exchange | | | routing error) | +----------------------------------+----------------------------------+ | 480 Temporarily unavailable | Cause value No 26 (Non-selected | | | user clearing) | +----------------------------------+----------------------------------+ | 502 Bad Gateway | Cause value No 27 (Destination | | | out of order) | +----------------------------------+----------------------------------+ | 484 Address Incomplete | Cause value No 28 (Invalid | | | number format (address | | | incomplete)) | +----------------------------------+----------------------------------+ | 501 Not Implemented | Cause value No 29 (Facility | | | rejected) | +----------------------------------+----------------------------------+ | 480 Temporarily unavailable | Cause value No 31 (Normal, | | | unspecified) | | | | | | (class default) (NOTE 2) | +----------------------------------+----------------------------------+ | 486 Busy here if Diagnostics | Cause value No 34 (No | | indicator includes the (CCBS | circuit/channel available) | | indicator = CCBS possible) | | | | | | else 503 Service Unavailable | | | (NOTE 3) | | +----------------------------------+----------------------------------+ | 500 Server Internal error | Cause value No 38 (Network out | | | of order) | +----------------------------------+----------------------------------+ | 503 Service Unavailable (NOTE 3) | Cause value No 41 (Temporary | | | failure) | +----------------------------------+----------------------------------+ | 503 Service Unavailable (NOTE 3) | Cause value No 42 (Switching | | | equipment congestion) | +----------------------------------+----------------------------------+ | 500 Server Internal error | Cause value No 43 (Access | | | information discarded) | +----------------------------------+----------------------------------+ | 503 Service Unavailable (NOTE 3) | Cause value No 44 (Requested | | | channel not available) | +----------------------------------+----------------------------------+ | 500 Server Internal error | Cause value No 46 (Precedence | | | call blocked) | +----------------------------------+----------------------------------+ | 503 Service Unavailable (NOTE 3) | Cause value No 47 (Resource | | | unavailable, unspecified) | | | | | | (class default) | +----------------------------------+----------------------------------+ | 488 Not acceptable here | Cause value No 50 (Requested | | | facility not subscribed) | +----------------------------------+----------------------------------+ | 603 Decline | Cause value No 55 (Incoming | | | class barred within Closed User | | | Group (CUG)) | +----------------------------------+----------------------------------+ | 603 Decline | Cause value No 57 (Bearer | | | capability not authorised) | +----------------------------------+----------------------------------+ | 503 Service Unavailable (NOTE 3) | Cause value No 58 (Bearer | | | capability not presently | | | available) | +----------------------------------+----------------------------------+ | 501 Not Implemented | Cause value No 63 (Service | | | option not available, | | | unspecified)\ | | | (class default) | +----------------------------------+----------------------------------+ | 500 Server Internal error | Cause value No 65 (Bearer | | | capability not implemented) | +----------------------------------+----------------------------------+ | 501 Not Implemented | Cause value No 69 (Requested | | | facility not implemented) | +----------------------------------+----------------------------------+ | 501 Not Implemented | Cause value No 70 (Only | | | restricted digital information | | | capability is available) | +----------------------------------+----------------------------------+ | 501 Not Implemented | Cause value No 79 (Service or | | | option not implemented, | | | unspecified) | | | | | | (class default) | +----------------------------------+----------------------------------+ | 403 Forbidden | Cause value No 87 (User not | | | member of Closed User Group | | | (CUG)) | +----------------------------------+----------------------------------+ | 606 Not Acceptable | Cause value No 88 (Incompatible | | | destination) | +----------------------------------+----------------------------------+ | 403 Forbidden | Cause value No 90 (Non existing | | | Closed User Group (CUG)) | +----------------------------------+----------------------------------+ | 500 Server Internal error | Cause value No 91 (Invalid | | | transit network selection) | +----------------------------------+----------------------------------+ | 513 Message too large | Cause value No 95 (Invalid | | | message, unspecified)\ | | | (class default) | +----------------------------------+----------------------------------+ | 501 Not Implemented | Cause value No 97 (Message type | | | non-existent or not implemented) | +----------------------------------+----------------------------------+ | 501 Not Implemented | Cause value No 98 (Message not | | | compatible with call state or | | | message type non-existent or not | | | implemented) | +----------------------------------+----------------------------------+ | 501 Not Implemented | Cause value No 99 (Information | | | element/parameter non-existent | | | or not implemented) | +----------------------------------+----------------------------------+ | 504 Server timeout | Cause value No 102 (Recovery on | | | timer expiry) | +----------------------------------+----------------------------------+ | 501 Not Implemented | Cause value No 103 (Parameter | | | non-existent or not implemented, | | | passed on) | +----------------------------------+----------------------------------+ | 501 Not Implemented | Cause value No 110 (Message with | | | unrecognised parameter, | | | discarded) | +----------------------------------+----------------------------------+ | 400 Bad Request | Cause value No 111 (Protocol | | | error, unspecified)\ | | | (class default) | +----------------------------------+----------------------------------+ | 500 Server Internal error | Cause value No 127 | | | (Interworking, unspecified)\ | | | (class default) | +----------------------------------+----------------------------------+ | NOTE 1: Anonymity Disallowed, | | | IETF RFC 5079 [77] refers | | | | | | NOTE 2: Class 0 and class 1 have | | | the same default value. | | | | | | NOTE 3: No Retry-After header | | | field shall be included. | | | | | | NOTE 4: The I‑MGCF identifies a | | | call as an \"ICS call\" as | | | specified in | | | clause 7.2.3.1.2.12. | | +----------------------------------+----------------------------------+
A Reason header field containing the received (Q.850) Cause Value of the REL
shall be added to the SIP final response or BYE request sent as a result of
this subclause. The mapping of the Cause Indicators parameter to the Reason
header is shown in table 9a. IETF RFC 6432 [115] describes the use of the
Reason header field in responses. The Reason header field itself is described
in IETF RFC 3326 [116]. If, as a network option, the I-MGCF supports the
location header field parameter as described in IETF RFC 8606 [155], the
I-MGCF shall map the ISUP cause location to the location parameter in the SIP
Reason header field as shown in table 9a.
Table 9a: Mapping of Cause Indicators parameter into SIP Reason header fields
+----------------+----------------+----------------+----------------+ | Cause | Value of | component of | component | | indicators | parameter | SIP Reason | value | | parameter | field | header field | | | field | | | | +----------------+----------------+----------------+----------------+ | - | - | protocol | \"_Q.850_ \" | +----------------+----------------+----------------+----------------+ | Cause Value | \"_XX_ \" (NOTE | protocol‑cause | \"_cause = | | | 1) | | XX_ \" (NOTE 1) | +----------------+----------------+----------------+----------------+ | - | - | reason‑text | Should be | | | | | filled with | | | | | the definition | | | | | text as stated | | | | | in ITU-T | | | | | Recommendation | | | | | Q.850 [38].\ | | | | | (NOTE 2) | +----------------+----------------+----------------+----------------+ | Location | user | location | U | | (NOTE 3) | | | | +----------------+----------------+----------------+----------------+ | | private | | LPN | | | network | | | | | serving the | | | | | local user | | | +----------------+----------------+----------------+----------------+ | | public network | | LN | | | serving the | | | | | local user | | | +----------------+----------------+----------------+----------------+ | | transit | | TN | | | network | | | +----------------+----------------+----------------+----------------+ | | public network | | RLN | | | serving the | | | | | remote user | | | +----------------+----------------+----------------+----------------+ | | private | | RPN | | | network | | | | | serving the | | | | | remote user | | | +----------------+----------------+----------------+----------------+ | | international | | INTL | | | network | | | +----------------+----------------+----------------+----------------+ | | network beyond | | BI | | | interworking | | | | | point | | | +----------------+----------------+----------------+----------------+ | NOTE 1: \"XX\" | | | | | is the Cause | | | | | Value as | | | | | defined in | | | | | ITU-T | | | | | Recommendation | | | | | Q.850 [38]. | | | | | | | | | | NOTE 2: Due to | | | | | the fact that | | | | | the Cause | | | | | Indicators | | | | | parameter does | | | | | not include | | | | | the definition | | | | | text as | | | | | defined in | | | | | table 1 | | | | | /Q.850 [38], | | | | | this is based | | | | | on | | | | | provisioning | | | | | in the I-MGCF. | | | | | | | | | | NOTE 3: The | | | | | mapping of the | | | | | cause location | | | | | is a network | | | | | option. | | | | +----------------+----------------+----------------+----------------+
As a network option, an I-MGCF may generate an Error-Info header field
according to rules and procedures of IETF RFC 3261 [19] to provide media
instead of the in-band media received from the PSTN.
If the I-MGCF supports the PSTN XML body as a network option, the I-MGCF shall
map the Access Transport Parameter received in the REL into PSTN XML elements
as shown in table 9aa and include this PSTN XML body in the SIP final response
or BYE.
Table 9aa: Mapping of ISUP Parameters into PSTN XML elements
* * *
4xx,5xx,6xx or BYE REL  
PSTN XML ISUP Parameter Content ProgressIndicator Access Transport Parameter
Progress indicator HighLayerCompatibility (NOTE) High layer compatibility
LowLayerCompatibility (NOTE) Low layer compatibility NOTE: The I-MGCF shall
only provide this IE if it interworks media encoded in any of the formats in
table 2a (G.711, Clearmode, or t38) without transcoding,
* * *
##### 7.2.3.1.9 Receipt of RSC, GRS or CGB (H/W oriented)
Upon receipt of a RSC, GRS or CGB (H/W oriented) message the following applies
independently for each affected circuit:
NOTE: For the RSC message, the circuit identified by the CIC is affected.\ For
the GRS message, the affected circuits are identified by the CIC and the Range
subfield of the Range and Status parameter.\ For the CGB message, the affected
circuits are identified by the CIC and the Range and Status parameter.
If an initial address message has been sent for the affected circuit and after
at least one backward message relating to that call has been received then:
\- If the final response (i.e. 200 OK (INVITE)) has already been sent, the
I-MGCF shall send a BYE message.
\- If the final response (i.e. 200 OK (INVITE)) has not already been sent, the
I-MGCF shall send a SIP response with Status-Code 480 Temporarily Unavailable.
A Reason header field containing the (Q.850) Cause Value of the REL message
generated by the ISUP procedures shall be added to the SIP message (BYE or 480
response) to be sent by the SIP side of the I‑MGCF.
##### 7.2.3.1.9a Receipt of REFER
Figure 11a: Receipt of REFER method
Upon receipt of a REFER request at the MGCF, the default behaviour of the
I-MGCF is to reject the REFER request with a 403 Forbidden response.
NOTE: The I-MGCF may also decide for example to execute the REFER request as
specified in IETF RFC 3515 [75] as an operator option, but such handling is
outside of the scope of the present document.
##### 7.2.3.1.10 Autonomous Release at I-MGCF
Table 10 shows the trigger events at the MGCF and the release initiated by the
MGCF when the call is traversing from SIP to ISUP/BICC.
A Reason header field containing the (Q.850) Cause Value of the REL message
sent by the I‑MGCF shall be added to the SIP Message (BYE request or final
response) sent by the SIP side of the I‑MGCF.
Table 10: Autonomous Release at I‑MGCF
+----------------------+----------------------+----------------------+ |  SIP | Trigger event | REL  | | | | | | Response | | | +----------------------+----------------------+----------------------+ | | | cause parameter | +----------------------+----------------------+----------------------+ | 484 Address | Determination that | Not sent. | | Incomplete | insufficient digits | | | | received. | | +----------------------+----------------------+----------------------+ | 480 Temporarily | Congestion at the | Not sent. | | Unavailable | MGCF/Call is not | | | | routable. | | +----------------------+----------------------+----------------------+ | BYE | ISUP/BICC procedures | According to | | | result in release | ISUP/BICC | | | after answer | procedures. | +----------------------+----------------------+----------------------+ | BYE | SIP procedures | 127 (Interworking | | | result in release | unspecified) | | | after answer. | | +----------------------+----------------------+----------------------+ | 500 Server Internal | Call release due to | According to | | error | the ISUP/BICC | ISUP/BICC | | | compatibility | procedures. | | | procedure (NOTE) | | +----------------------+----------------------+----------------------+ | 484 Address | Call release due to | According to | | Incomplete | expiry of T7 within | ISUP/BICC | | | the ISUP/BICC | procedures. | | | procedures | | +----------------------+----------------------+----------------------+ | 480 Temporarily | Call release due to | According to | | Unavailable | expiry of T9 within | BICC/ISUP | | | the BICC/ISUP | procedures. | | | procedures | | +----------------------+----------------------+----------------------+ | 480 Temporarily | Other BICC/ISUP | According to | | Unavailable. | procedures result in | BICC/ISUP | | | release before | procedures. | | | answer. | | +----------------------+----------------------+----------------------+ | NOTE: MGCF receives | | | | unrecognized ISUP or | | | | BICC signalling | | | | information and | | | | determines that the | | | | call needs to be | | | | released based on | | | | the coding of the | | | | compatibility | | | | indicators, refer to | | | | ITU-T Recommendation | | | | Q.764 [4] and | | | | ITU-T | | | | Q.1902.4 [30]. | | | +----------------------+----------------------+----------------------+
##### 7.2.3.1.11 Internal through connection of the bearer path
The through connection procedure is described in clause 9.2.2.3.5.
#### 7.2.3.2 Outgoing Call Interworking from ISUP to SIP at O-MGCF
##### 7.2.3.2.1 Sending of INVITE
###### 7.2.3.2.1.1 General
{width="3.1458333333333335in" height="1.0208333333333333in"}
Figure 11b: Receipt of an IAM
Upon reception of an IAM message, the O-MGCF shall send a SIP INVITE request,
as further detailed in the clauses below.
An O-MGCF shall support both the SIP preconditions and 100rel extensions and
indicate the support of the SIP preconditions and 100rel extensions in the
INVITE request, unless the Note below applies.
NOTE: If the O-MGCF is deployed in an IMS network that by local configuration
serves no user requiring preconditions, it may send the INVITE request without
indicating support of preconditions.
###### 7.2.3.2.1.2 Interaction with continuity check
If the Continuity Check indicator in the Nature of Connection Indicators
parameter in the incoming IAM is set to indicate either \"_continuity check
required on this circuit_ \" or \"_continuity check performed on previous
circuit_ \", the O-MGCF should defer sending the INVITE request until
receiving a COT message.
NOTE: If the Continuity Check indicator in the Nature of Connection Indicators
parameter in the incoming IAM is set to indicate either \"_continuity check
required on this circuit_ \" or \"_continuity check performed on previous
circuit_ \" and the O-MGCF sends the INVITE request before receiving a COT
message, the following considerations apply: If the receiving terminal is not
supporting the SIP precondition and the SIP UPDATE method, clipping may occur.
Furthermore, if the MGCF sets the SDP \"inactive\" attribute in the initial
INVITE request and the receiving terminal is not supporting the SIP
precondition, the interworking procedures within the present specification do
not describe all necessary signalling interactions required to set up a call,
in particular with respect to the sending of the re-INVITE that may also cause
additional delay in the call setup. In addition, the interworking of the
ringing indication might not be possible if the peer sends the ringing
indication only as response to a re-INVITE.
NOTE: Waiting for the COT is recommended, if the Continuity Check indicator in
the Nature of Connection Indicators parameter in the incoming IAM is set to
indicate either \"_continuity check required on this circuit_ \" or
\"_continuity check performed on previous circuit_ \"
Figure 12: Receipt of an IAM (Waiting for the COT message)
###### 7.2.3.2.1.3 IAM without calling party number
If no calling party number is received in the incoming IAM message, as a
network option, the O-MGCF may send an INR message to request the calling
party number and not send the INVITE request until receiving an INF message
with calling party number. If no calling party number is received in the INF
message, O-MGCF may reject or continue the call based on local configuration.
Figure 12a: Receipt of an IAM (Request for calling party number)
###### 7.2.3.2.1.4 Terminating overlap signalling at MGCF
Figure 13: Receipt of an IAM (Overlap signalling in CS network)
After initiating the normal incoming BICC/ISUP call establishment procedures,
determining the end of address signalling and selecting to route the call to
the IMS domain, the O‑MGCF shall send the initial INVITE.
The end of address signalling shall be determined by the earlier of the
following criteria:
a) by receipt of an end-of-pulsing (ST) signal; or
b) by receipt of the maximum number of digits used in the national numbering
plan; or
c) by analysis of the called party number to indicate that a sufficient number
of digits has been received to route the call to the called party; or
d) by observing that timer Ti/w1 has expired after the receipt of the latest
address message and the minimum number of digits required for routing the call
have been received.
If the end of the address signalling is determined in accordance with criteria
a) b) or c), the timer Ti/w2 is started when INVITE is sent. Also, if the PSTN
XML body is supported as a network option, the O-MGCF shall insert the PSTN
XML sendingCompleteIndication.
###### 7.2.3.2.1.5 Fallback (optional)
The Fallback mechanism described in the present clause shall only apply if the
O-MGCF supports the PSTN XML body as a network option, and propagates UDI-TA
fallback signalling into the IMS as a network option.
NOTE: If the Fallback related signalling is not forwarded according to the
procedures in the present sublause by the O-MGCF, the O-MGCF will apply the
ISUP Fallback procedures when the IAM includes a TMR and a TMR prime parameter
and a USI and USI Prime parameter.
When the IAM includes a TMR and a TMR prime parameter and a USI and USI Prime
parameter then the O-MGCF shall:
\- map the \"USI Prime\" into the \"InformationTransferCapability\" of the
second BearerCapability element in the PSTN XML body;
\- include SDP with one m-line of \"audio\" media type in the INVITE;
\- map the \"TMR\" and \"USI Prime\" into a first offerered format in the SDP
m-line according to table 10b;
\- map the \"USI\" into the first Bearer Capability element in the PSTN XML
body;
\- map the \"TMR prime\" into the \"InformationTransferCapability\" of the
first BearerCapability element in the PSTN XML body; and
\- map the TMR prime and USI into a second offerered format in the SDP m-line
according to table 10b.
##### 7.2.3.2.1a Sending of INVITE without determining the end of address
signalling
###### 7.2.3.2.1a.1 General
As a network option, the O-MGCF is not required to determine the end of
address signalling. In this case the O-MGCF shall send an initial INVITE when
a preconfigured number of digits has been reached.
When the MGCF receives ISUP SAM messages the additional digits received in the
SAMs may either be sent using the in-dialog overlap method as specified in
clause 7.2.3.2.1a.2 or using the multiple INVITEs overlap method as specified
in 7.2.3.2.1a.3. It depends on the network configuration which of these
methods is applied. However, within one IMS only a single method shall be
used.
###### 7.2.3.2.1a.2 Additional digits sent with in-dialog overlap method
Figure 14: Overlap signalling using in-dialog INFOs in CS an IMS network
If the O-MGCF sends an initial SIP INVITE request before the end of address
signalling is determined, the O-MGCF shall:
\- use the SIP precondition extension within the SIP INVITE request;
\- start timer Ti/w2;
\- be prepared to process SAM as described below;
\- be prepared to handle incoming SIP 18x provisional responses, establishing
early dialogs; and
\- be prepared to handle incoming SIP 404 or 484 error responses as detailed
in clause 7.2.3.2.12.1.
NOTE 1: A SIP INVITE request with incomplete address information can be
rejected with a SIP 404 or 484 error response.
On receipt of a SAM from the BICC/ISUP side, unless the O-MGCF has received a
SIP 180 (Ringing) response for the call, the following O-MGCF procedures
apply:
\- The O-MGCF shall stop timer Ti/w3 (if it is running).
\- If no response has been received for the previous INVITE request of the
same call, the O-MGCF shall wait for the response and then apply the
procedures in the next bullets to transfer the digits received in the SAM. If
additional SAMs are received while the O-MGCF is waiting for the response for
the previous SIP INVITE request, the digits within shall be combined with the
digits of the previous SAMs.
\- If an early dialog has not been established, and a SIP 404 or 484 error
response has been received for the last previous SIP INVITE request for the
same call, the O-MGCF shall send a SIP INVITE request complying to the
following:
\- The SIP INVITE request shall use the SIP preconditions extension.
\- The SIP INVITE request shall include all digits received so far for this
call in the Request‑URI.
\- The SIP INVITE request shall include the same Call‑ID and From tag as the
previous SIP INVITE request for the call.
\- If an early dialog has been established, and a response has been received
for any previously sent SIP INFO request (\"legacy\" mode of usage of the INFO
method as defined in IETF RFC 6086 [133]), the O-MGCF shall send an in-dialog
SIP INFO request complying the following:
\- The SIP INFO request shall only include the digits received since the
previous SIP request with digits was sent (see Note).
\- If no response has been received for the previous SIP INFO request, the
O-MGCF shall wait for the response and then apply the procedures in the
previous bullet to transfer digits received in the SAM. If additional SAMs are
received while the O-MGCF is waiting for the response for the previous SIP
INFO request, the digits within shall be combined with the digits of the
previous SAMs.
\- Restart Ti/w2.
If timer Ti/w2 has expired, or the O-MGCF has received a SIP 180 (Ringing)
response for the call, the O‑MGCF shall ignore subsequent SAMs received.
NOTE 2: The encoding of the digits within the SIP INFO request is described in
clause 7.2.3.2.20.2.
###### 7.2.3.2.1a.3 Additional digits sent using the multiple INVITEs overlap
method
Figure 14a: Overlap signalling using multiple INVITEs in CS an IMS network
If the O-MGCF sends an SIP INVITE request before the end of address signalling
is determined, the O-MGCF shall:
\- use the SIP precondition extension within the SIP INVITE request;
\- start timer Ti/w2; and
\- be prepared to process SAM as described below; and
\- be prepared to handle incoming SIP 404 or 484 error responses as detailed
in clause 7.2.3.2.12.1.
NOTE: An SIP INVITE request with incomplete address information will be
rejected with a SIP 404 or 484 error response.
On receipt of a SAM from the BICC/ISUP side, unless the O-MGCF has received a
SIP 180 (Ringing) response for the call, the O‑MGCF shall:
\- stop timer Ti/w3 (if it is running);
\- send an INVITE request complying to the following:
\- The SIP INVITE request shall use the SIP preconditions extension.
\- The SIP INVITE request shall include all digits received so far for this
call in the Request‑URI.
\- The SIP INVITE request shall include the same Call‑ID and From tag as the
previous SIP INVITE request for the call.
\- restart Ti/w2;
If timer Ti/w2 has expired, or the O-MGCF has received a SIP 180 (Ringing)
response for the call, the O‑MGCF shall ignore subsequent SAMs received.
##### 7.2.3.2.2 Coding of the INVITE
###### 7.2.3.2.2.0 Overview
Table 10aa provides a summary of how the header fields within the outgoing
INVITE message are populated.
Table 10aa: Interworked contents of the INVITE message
+------------------------------------+--------------------------------+ | IAM→ | INVITE→ | +------------------------------------+--------------------------------+ | Called Party Number | Request-URI | | | | | | To | | | | | | History-Info | +------------------------------------+--------------------------------+ | Calling Party Number | P-Asserted-Identity | +------------------------------------+--------------------------------+ | | Privacy | +------------------------------------+--------------------------------+ | | From | +------------------------------------+--------------------------------+ | | Attestation-Info | +------------------------------------+--------------------------------+ | | Origination-Id | +------------------------------------+--------------------------------+ | Generic Number (_\"additional | From | | calling party number\"_) | | +------------------------------------+--------------------------------+ | | Privacy | +------------------------------------+--------------------------------+ | | Attestation-Info | +------------------------------------+--------------------------------+ | | Origination-Id | +------------------------------------+--------------------------------+ | Called IN number | History-Info | +------------------------------------+--------------------------------+ | Original called IN number | History-Info | +------------------------------------+--------------------------------+ | Hop Counter | Max-Forwards | +------------------------------------+--------------------------------+ | TMR/USI | Message Body (application/SDP) | +------------------------------------+--------------------------------+ | Location Number | P-Access-Network-Info | +------------------------------------+--------------------------------+
###### 7.2.3.2.2.1 Request-URI and To header field
The called party number parameter of the IAM message is used to derive
Request-URI of the INVITE request. The Request-URI is a tel URI or SIP URI
with \"user=phone\" and shall contain:
\- an E.164 International public telecommunication number prefixed by a \"+\"
sign (e.g. tel:+4911231234567) , or
\- a non E.164 number (national operator option for service numbers),
expressed as a local number as per IETF RFC 3966 [97].
Table 10a: Mapping ISUP Called Party Number to\ SIP Request-URI and To header
field
+----------------+----------------+----------------+----------------+ | IAM | INVITE | | | +----------------+----------------+----------------+----------------+ | BICC/ISUP | Value | SIP component | Value | | Parameter / | | | | | field | | | | +----------------+----------------+----------------+----------------+ | Called Party | | Request-URI | display-name | | Number (NOTE | | and To header | (optional) and | | 3) | | field | addr-spec | | | | | derived from | | | | | Called Party | | | | | Number | | | | | parameter | | | | | address | | | | | signals | +----------------+----------------+----------------+----------------+ | Nature of | \"_national | Tel URI or SIP | Insert \"+CC\" | | Address | (significant) | URI | before the | | Indicator | number_ \" | | Address | | (NOTE 2) (NOTE | | | signals (NOTE | | 6) | | | 1) | +----------------+----------------+----------------+----------------+ | | \" | | Insert \"+\" | | | _international | | before the | | | number_ \" | | Address | | | | | signals | +----------------+----------------+----------------+----------------+ | | _\"Ne | | according to | | | twork-specific | | local policies | | | number\"_ or\ | | should either | | | _\"reserved | | be: | | | for national | | | | | use\"_ | | - a global | | | | | number (+CC), | | | | | if the called | | | | | party number | | | | | may be | | | | | converted into | | | | | an E.164 | | | | | address | | | | | | | | | | OR, depending | | | | | on operator\'s | | | | | requirements | | | | | may be | | | | | converted into | | | | | | | | | | - local | | | | | number (with a | | | | | phone-context | | | | | parameter) | | | | | (NOTE 4) (NOTE | | | | | 5) | +----------------+----------------+----------------+----------------+ | NOTE 1: CC = | | | | | Country Code | | | | | of the network | | | | | in which the | | | | | O-MGCF is | | | | | located. | | | | | | | | | | NOTE 2: The | | | | | usage of | | | | | \"Nature of | | | | | address | | | | | indicator\" | | | | | value | | | | | \"unknown\" is | | | | | allowed but | | | | | the mapping is | | | | | not specified | | | | | in the present | | | | | specification. | | | | | | | | | | NOTE 3: If the | | | | | address | | | | | signals | | | | | received in | | | | | the ISUP | | | | | Called Party | | | | | Number contain | | | | | a sending | | | | | terminated | | | | | signal | | | | | (hexadecimal | | | | | digit F), then | | | | | this shall be | | | | | discarded or | | | | | if the O-MGCF | | | | | supports the | | | | | PSTN XML body | | | | | as a network | | | | | option then | | | | | the PSTN XML | | | | | sendingComp | | | | | leteIndication | | | | | shall be set. | | | | | | | | | | NOTE 4: | | | | | Mapping | | | | | between nature | | | | | of address | | | | | indicator | | | | | values and | | | | | phone-context | | | | | values is | | | | | provisioned in | | | | | the MGCF. | | | | | Setting of | | | | | value of | | | | | phone-context | | | | | is depending | | | | | on local | | | | | operator\'s | | | | | policies. | | | | | | | | | | NOTE 5: | | | | | Ne | | | | | twork-specific | | | | | number or | | | | | reserved for | | | | | national use | | | | | shall be | | | | | translated | | | | | into E.164 | | | | | format numbers | | | | | except if | | | | | local | | | | | operator\'s | | | | | policy | | | | | requires | | | | | keeping in | | | | | local format | | | | | (e.g. for | | | | | national | | | | | reasons E.164 | | | | | numbers cannot | | | | | be used for | | | | | such purpose). | | | | | In the later | | | | | case the | | | | | mapping shall | | | | | be done as | | | | | indicated in | | | | | the table. | | | | | | | | | | NOTE 6: The | | | | | values | | | | | \"Network | | | | | routing number | | | | | in national | | | | | (significant) | | | | | number | | | | | format\", | | | | | \"Network | | | | | routing number | | | | | in network | | | | | specific | | | | | number | | | | | format\" or | | | | | \"Network | | | | | routing number | | | | | concatenated | | | | | with called | | | | | directory | | | | | number\" are | | | | | used when | | | | | number | | | | | portability is | | | | | supported. For | | | | | the mapping | | | | | see | | | | | clau | | | | | se 7.2.3.2.2A. | | | | +----------------+----------------+----------------+----------------+
###### 7.2.3.2.2.2 SDP Media Description
If the O-MGCF indicates support of the SIP preconditions in the initial INVITE
request and local preconditions have not been met, the SDP media description
shall contain precondition information as per 3GPP TS 24.229 [9]. Depending on
the coding of the continuity indicators different precondition information
(IETF RFC 3312 [37]) is included. If the continuity indicator indicates
\"continuity performed on a previous circuit\" or \"continuity required on
this circuit\", and the INVITE is sent before receiving a COT, message (which
is not recommended according to clause 7.2.3.2.1.1), then the O-MGCF shall
indicate that the preconditions are not met. Otherwise the O-MGCF shall
indicate whether the preconditions are met, dependent on thestatus of the
local resource reservation.
If the O-MGCF determines that a speech call is incoming, the O-MGCF shall
include the AMR codec transported according to IETF RFC 4867 [23] with the
options listed in clause 12.3.1 of 3GPP TS 26.114 [104] in the SDP offer,
unless the Note below applies. Within the SDP offer, the O-MGCF should also
provide SDP RR and RS bandwidth modifiers specified in IETF RFC 3556 [59] as
detailed in clause 7.3.1 of 3GPP TS 26.114 [104]. The O-MGCF may include other
codecs according to operator policy.
NOTE: If the O-MGCF is deployed in an IMS network that by local configuration
serves no user equipment that implements the AMR codec, then the AMR codec may
be excluded from the SDP offer.
To avoid transcoding or to support non-speech services, the O-MGCF may add
media derived from the incoming ISUP information according to table 10b. The
support of the media listed in table 10b is optional. If the O-MGCF supports
the PSTN XML body as a network option and adds media derived from the incoming
ISUP information according to table 10b, the O-MGCF shall also map the media
related ISUP information into the XML body as shown in table 7.2.3.2.2.7.1.
Table 10b: Coding of SDP media description lines from TMR/USI: ISUP to SIP
+-------+-------+-------+-------+-------+-------+-------+-------+-------+ | TMR | USI | HLC | m= | b= | a= | | | | | para | para | IE in | line | line | line | | | | | meter | meter | ATP | | | | | | | | | (Opti | (Opti | | | | | | | | | onal) | onal) | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | TMR | I | User | High | \ | ransp | fmt-l | difie | tpmap | | | ation | nform | Chara | | ort> | ist> | r>:\ | :\ | | | Capab | 1 | Iden | | | | th-va | \ | oding | | | | tocol | ation | | | | | name | | | | Indi | | | | | | >/\\ | | | | | | | | | | [/enc | | | | | | | | | | oding | | | | | | | | | | pa | | | | | | | | | | ramet | | | | | | | | | | ers> | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | _\ |_ \ | _\" |_ Ig | _a |_ RTP | _0 |_ AS: | _rtp | | "spee | "Spee | G.711 | nore_ | udio _| /AVP_ | (and | (64 _| map:0 | | ch\"_ | ch\"_| μ-l | | | | pos | + | PCMU/ | | | | aw\"_ | | | | sibly | RTP/U | 8000 _| | | | | | | | 8) | DP/IP | | | | | | | | | (NOTE | over |_(and | | | | | | | | 1)_| head) | pos | | | | | | | | | | sibly | | | | | | | | | | rtp | | | | | | | | | | map:8 | | | | | | | | | | P | | | | | | | | | | CMA/8 | | | | | | | | | | 000)_ | | | | | | | | | | | | | | | | | | | | * | | | | | | | | | | (NOTE | | | | | | | | | | 1)_| +-------+-------+-------+-------+-------+-------+-------+-------+-------+ |_ \ | _\ |_ \" | _Ig |_ a | _RTP |_ Dy | _AS: |_ r | | "spee | "Spee | G.711 | nore _| udio_ | /AVP _| namic | (64_ | tpmap | | ch\"_| ch\"_ | μ-l | | | | PT | + | :\ | | | | | | | | sibly | over | PCMU/ | | | | | | | | a | head) | 8000_ | | | | | | | | s | | | | | | | | | | econd | | _(and | | | | | | | | Dy | | pos | | | | | | | | namic | | sibly | | | | | | | | PT)_ | | r | | | | | | | | | | tpmap | | | | | | | | * | | :\ | | | | | | | | | | P | | | | | | | | | | CMA/8 | | | | | | | | | | 000)_ | | | | | | | | | | | | | | | | | | | | * | | | | | | | | | | (NOTE | | | | | | | | | | 1)_| +-------+-------+-------+-------+-------+-------+-------+-------+-------+ |_ \ | _\ |_ \" | I | audio | RT | 8 | AS: | rtp | | "spee | "Spee | G.711 | gnore | | P/AVP | | (64 + | map:8 | | ch\"_| ch\"_ | A-l | | | | | RTP/U | PCMA | | | | aw\"_| | | | | DP/IP | /8000 | | | | | | | | | over | | | | | | | | | | head) | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ |_ \ | _\ |_ \" | I | audio | RT | Dy | AS: | r | | "spee | "Spee | G.711 | gnore | | P/AVP | namic | (64 + | tpmap | | ch\"_| ch\"_ | A-l | | | | PT | RTP/U | :\ | | | | | | | | | head) | PCMA | | | | | | | | | | /8000 | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | * | USI | | I | audio | RT | 8 | AS: | rtp | | \"3.1 | A | | gnore | | P/AVP | | (64 + | map:8 | | KHz | bsent | | | | | | RTP/U | PCMA | | aud | | | | | | | DP/IP | /8000 | | io\"_ | | | | | | | over | | | | | | | | | | head) | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | * | * | _\" | (NOTE | audio | RT | 0 | AS: | rtp | | \"3.1 | \"3.1 | G.711 | 3) | | P/AVP | (and | (64 + | map:0 | | KHz | KHz | μ-l | | | | pos | RTP/U | PCMU | | aud | aud | aw\"_ | | | | sibly | DP/IP | /8000 | | io\"_| io\"_ | | | | | 8) | over | | | | | | | | | | head) | (and | | | | | | | | (NOTE | | pos | | | | | | | | 1) | | sibly | | | | | | | | | | rtp | | | | | | | | | | map:8 | | | | | | | | | | PCMA/ | | | | | | | | | | 8000) | | | | | | | | | | | | | | | | | | | | (NOTE | | | | | | | | | | 1) | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | * | * | _\" | (NOTE | audio | RT | 8 | AS: | rtp | | \"3.1 | \"3.1 | G.711 | 3) | | P/AVP | | (64 + | map:8 | | KHz | KHz | A-l | | | | | RTP/U | PCMA | | aud | aud | aw\"_ | | | | | DP/IP | /8000 | | io\"_| io\"_ | | | | | | over | | | | | | | | | | head) | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | * | * | | _\ | image | Ud | t38\ | AS: | Based | | \"3.1 | \"3.1 | | "Facs | | ptl \ | [73] | (64 + | on | | KHz | KHz | | imile | (NOTE | [73] | | U | ITU-T | | aud | aud | | Group | 9) | | | DP/IP | T. | | io\"_ | io\"_| | 2 | | | | over | 38 [ | | | | | /3\"_ | | | | head) | 72]. | | | | | | | | | | (NOTE | | | | | | | | | | 8) | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | * | * | | _\ | image | Tcp | t38\ | AS: | Based | | \"3.1 | \"3.1 | | "Facs | | | [73] | (64 + | on | | KHz | KHz | | imile | (NOTE | (NOTE | | T | ITU-T | | aud | aud | | Group | 9) | 7) | | CP/IP | T. | | io\"_ | io\"_| | 2 | | | | over | 38 [ | | | | | /3\"_ | | | | head) | 72]. | | | | | | | | | | (NOTE | | | | | | | | | | 8) | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | * | * | | _\ | Audio | RT | 0, 8, | AS: | rtp | | \"3.1 | \"3.1 | | "Facs | | P/AVP | or | (64 + | map:0 | | KHz | KHz | | imile | (NOTE | | \  | over | or | | | | | /3\"_ | | | | head) | | | | | | | | | | | rtp | | | | | | | | | | map:8 | | | | | | | | | | PCMU | | | | | | | | | | /8000 | | | | | | | | | | or | | | | | | | | | | | | | | | | | | | | r | | | | | | | | | | tpmap | | | | | | | | | | :\ | | | | | | | | | | PCMA | | | | | | | | | | /8000 | | | | | | | | | | or | | | | | | | | | | | | | | | | | | | | r | | | | | | | | | | tpmap | | | | | | | | | | :\ | | | | | | | | | | PCMU | | | | | | | | | | /8000 | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | _\"64 |_ \"Sp | N/A | I | audio | RT | Dy | AS: | r | | k | eech/ | | gnore | | P/AVP | namic | (64 + | tpmap | | bit/s | 3 | | | | | PT | RTP/U | :\ | | ed\"_| dio\" | | | | | | head) | CLEA | | | (NOTE | | | | | | | RMODE | | | 6)_ | | | | | | | /8000 | | | | | | | | | | | | | | | | | | | | (NOTE | | | | | | | | | | 2) | | | | | | | | | | (NOTE | | | | | | | | | | 4) | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | _\"64 |_ \"Un | N/A | I | audio | RT | Dy | AS: | r | | k | restr | | gnore | | P/AVP | namic | (64 + | tpmap | | bit/s | icted | | | | | PT | RTP/U | :\ | | ed\"_| info | | | | | | head) | CLEA | | | rmati | | | | | | | RMODE | | | on\"_ | | | | | | | /8000 | | | | | | | | | | | | | | | | | | | | (NOTE | | | | | | | | | | 2) | | | | | | | | | | (NOTE | | | | | | | | | | 5) | +-------+-------+-------+-------+-------+-------+-------+-------+-------+ | NOTE | | | | | | | | | | 1: | | | | | | | | | | Both | | | | | | | | | | PCMA | | | | | | | | | | and | | | | | | | | | | PCMU | | | | | | | | | | could | | | | | | | | | | be | | | | | | | | | | requ | | | | | | | | | | ired. | | | | | | | | | | | | | | | | | | | | NOTE | | | | | | | | | | 2: | | | | | | | | | | CLEA | | | | | | | | | | RMODE | | | | | | | | | | is | | | | | | | | | | spec | | | | | | | | | | ified | | | | | | | | | | in | | | | | | | | | | I | | | | | | | | | | ETF R | | | | | | | | | | FC 40 | | | | | | | | | | 40 [ | | | | | | | | | | 69]. | | | | | | | | | | | | | | | | | | | | NOTE | | | | | | | | | | 3: | | | | | | | | | | HLC | | | | | | | | | | is | | | | | | | | | | nor | | | | | | | | | | mally | | | | | | | | | | a | | | | | | | | | | bsent | | | | | | | | | | in | | | | | | | | | | this | | | | | | | | | | case. | | | | | | | | | | It is | | | | | | | | | | pos | | | | | | | | | | sible | | | | | | | | | | for | | | | | | | | | | HLC | | | | | | | | | | to be | | | | | | | | | | pr | | | | | | | | | | esent | | | | | | | | | | with | | | | | | | | | | the | | | | | | | | | | value | | | | | | | | | | \"Te | | | | | | | | | | lepho | | | | | | | | | | ny\", | | | | | | | | | | alt | | | | | | | | | | hough | | | | | | | | | | 6 | | | | | | | | | | .3.1/ | | | | | | | | | | ITU-T | | | | | | | | | | Q.939 | | | | | | | | | | indi | | | | | | | | | | cates | | | | | | | | | | that | | | | | | | | | | this | | | | | | | | | | would | | | | | | | | | | nor | | | | | | | | | | mally | | | | | | | | | | be | | | | | | | | | | a | | | | | | | | | | ccomp | | | | | | | | | | anied | | | | | | | | | | by a | | | | | | | | | | value | | | | | | | | | | of | | | | | | | | | | \"Spe | | | | | | | | | | ech\" | | | | | | | | | | for | | | | | | | | | | the | | | | | | | | | | I | | | | | | | | | | nform | | | | | | | | | | ation | | | | | | | | | | Tra | | | | | | | | | | nsfer | | | | | | | | | | Capab | | | | | | | | | | ility | | | | | | | | | | ele | | | | | | | | | | ment. | | | | | | | | | | | | | | | | | | | | NOTE | | | | | | | | | | 4: | | | | | | | | | | After | | | | | | | | | | the | | | | | | | | | | CLEA | | | | | | | | | | RMODE | | | | | | | | | | c | | | | | | | | | | odec, | | | | | | | | | | addit | | | | | | | | | | ional | | | | | | | | | | s | | | | | | | | | | peech | | | | | | | | | | c | | | | | | | | | | odecs | | | | | | | | | | such | | | | | | | | | | as | | | | | | | | | | AMR | | | | | | | | | | a | | | | | | | | | | nd/or | | | | | | | | | | G.722 | | | | | | | | | | a | | | | | | | | | | nd/or | | | | | | | | | | G.711 | | | | | | | | | | avai | | | | | | | | | | lable | | | | | | | | | | via | | | | | | | | | | t | | | | | | | | | | ransc | | | | | | | | | | oding | | | | | | | | | | or | | | | | | | | | | refr | | | | | | | | | | aming | | | | | | | | | | s | | | | | | | | | | hould | | | | | | | | | | be | | | | | | | | | | of | | | | | | | | | | fered | | | | | | | | | | in | | | | | | | | | | the | | | | | | | | | | same | | | | | | | | | | m- | | | | | | | | | | line. | | | | | | | | | | | | | | | | | | | | NOTE | | | | | | | | | | 5: As | | | | | | | | | | a | | | | | | | | | | ltern | | | | | | | | | | ative | | | | | | | | | | or in | | | | | | | | | | add | | | | | | | | | | ition | | | | | | | | | | to | | | | | | | | | | the | | | | | | | | | | m | | | | | | | | | | -line | | | | | | | | | | conta | | | | | | | | | | ining | | | | | | | | | | the | | | | | | | | | | CLEA | | | | | | | | | | RMODE | | | | | | | | | | c | | | | | | | | | | odec, | | | | | | | | | | an | | | | | | | | | | MGCF | | | | | | | | | | suppo | | | | | | | | | | rting | | | | | | | | | | the | | | | | | | | | | multi | | | | | | | | | | media | | | | | | | | | | in | | | | | | | | | | terwo | | | | | | | | | | rking | | | | | | | | | | det | | | | | | | | | | ailed | | | | | | | | | | in | | | | | | | | | | Annex | | | | | | | | | | E may | | | | | | | | | | add | | | | | | | | | | an | | | | | | | | | | m | | | | | | | | | | -line | | | | | | | | | | for | | | | | | | | | | s | | | | | | | | | | peech | | | | | | | | | | c | | | | | | | | | | odecs | | | | | | | | | | and | | | | | | | | | | an | | | | | | | | | | m | | | | | | | | | | -line | | | | | | | | | | for | | | | | | | | | | video | | | | | | | | | | c | | | | | | | | | | odecs | | | | | | | | | | as | | | | | | | | | | det | | | | | | | | | | ailed | | | | | | | | | | in | | | | | | | | | | this | | | | | | | | | | A | | | | | | | | | | nnex. | | | | | | | | | | | | | | | | | | | | NOTE | | | | | | | | | | 6: In | | | | | | | | | | this | | | | | | | | | | case, | | | | | | | | | | the | | | | | | | | | | USI | | | | | | | | | | prime | | | | | | | | | | para | | | | | | | | | | meter | | | | | | | | | | will | | | | | | | | | | also | | | | | | | | | | be | | | | | | | | | | pr | | | | | | | | | | esent | | | | | | | | | | and | | | | | | | | | | will | | | | | | | | | | ind | | | | | | | | | | icate | | | | | | | | | | \"Un | | | | | | | | | | restr | | | | | | | | | | icted | | | | | | | | | | Di | | | | | | | | | | gital | | | | | | | | | | I | | | | | | | | | | nform | | | | | | | | | | ation | | | | | | | | | | with | | | | | | | | | | to | | | | | | | | | | nes/a | | | | | | | | | | nnoun | | | | | | | | | | cemen | | | | | | | | | | ts\". | | | | | | | | | | | | | | | | | | | | NOTE | | | | | | | | | | 7: | | | | | | | | | | This | | | | | | | | | | value | | | | | | | | | | is | | | | | | | | | | not | | | | | | | | | | r | | | | | | | | | | ecomm | | | | | | | | | | ended | | | | | | | | | | in a | | | | | | | | | | ne | | | | | | | | | | twork | | | | | | | | | | suppo | | | | | | | | | | rting | | | | | | | | | | MTSI | | | | | | | | | | cl | | | | | | | | | | ients | | | | | | | | | | as it | | | | | | | | | | is | | | | | | | | | | not | | | | | | | | | | supp | | | | | | | | | | orted | | | | | | | | | | by an | | | | | | | | | | MTSI | | | | | | | | | | c | | | | | | | | | | lient | | | | | | | | | | (see | | | | | | | | | | TS | | | | | | | | | | 24.17 | | | | | | | | | | 3 [8 | | | | | | | | | | 8]). | | | | | | | | | | | | | | | | | | | | NOTE | | | | | | | | | | 8: | | | | | | | | | | Annex | | | | | | | | | | K | | | | | | | | | | desc | | | | | | | | | | ribes | | | | | | | | | | r | | | | | | | | | | ecomm | | | | | | | | | | ended | | | | | | | | | | va | | | | | | | | | | lues. | | | | | | | | | | | | | | | | | | | | NOTE | | | | | | | | | | 9: | | | | | | | | | | FAX | | | | | | | | | | can | | | | | | | | | | e | | | | | | | | | | ither | | | | | | | | | | be | | | | | | | | | | t | | | | | | | | | | ransp | | | | | | | | | | orted | | | | | | | | | | acco | | | | | | | | | | rding | | | | | | | | | | to | | | | | | | | | | ITU-T | | | | | | | | | | reco | | | | | | | | | | mmend | | | | | | | | | | ation | | | | | | | | | | T | | | | | | | | | | .38 \ | | | | | | | | | | [72] | | | | | | | | | | using | | | | | | | | | | the | | | | | | | | | | \"im | | | | | | | | | | age\" | | | | | | | | | | media | | | | | | | | | | type | | | | | | | | | | or as | | | | | | | | | | i | | | | | | | | | | nband | | | | | | | | | | Voice | | | | | | | | | | band | | | | | | | | | | data | | | | | | | | | | over | | | | | | | | | | IP | | | | | | | | | | using | | | | | | | | | | the | | | | | | | | | | \"au | | | | | | | | | | dio\" | | | | | | | | | | media | | | | | | | | | | type. | | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+-------+
###### 7.2.3.2.2.3 P-Asserted-Identity, From and Privacy header fields
Table 12: Mapping BICC/ISUP CLI parameters to SIP header fields
+---------+---------+---------+---------+---------+---------+---------+ | Has a | Calling | Has a | Generic | P-Ass | From | Privacy | | Calling | Party | Generic | Number | erted-I | header | header | | Party | Number | Number | APRI | dentity | field | field | | Number | APRI | (AcgPN) | | header | | | | pa | | with a | | field | | | | rameter | | c | | | | | | with | | omplete | | | | | | c | | E.164 | | | | | | omplete | | number | | | | | | E.164 | | and | | | | | | number, | | with | | | | | | and | | Sc | | | | | | with | | reening | | | | | | Sc | | In | | | | | | reening | | dicator | | | | | | In | | = UPNV | | | | | | dicator | | been | | | | | | = UPVP | | re | | | | | | or NP | | ceived? | | | | | | ( | | | | | | | | NOTE 1) | | | | | | | | been | | | | | | | | re | | | | | | | | ceived? | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | N | - | N | - | Header | SIP URI | Header | | | | | | field | with | field | | | | | | not | ad | not | | | | | | i | dr-spec | i | | | | | | ncluded | of | ncluded | | | | | | or if | Unav | | | | | | | i | ailable | (N | | | | | | ncluded | User | OTE 11) | | | | | | SIP URI | I | | | | | | | with | dentity | | | | | | | ad | ( | | | | | | | dr-spec | NOTE 2) | | | | | | | of | ( | | | | | | | Unav | NOTE 6) | | | | | | | ailable | (N | | | | | | | User | OTE 12) | | | | | | | I | | | | | | | | dentity | | | | | | | | (N | | | | | | | | OTE 11) | | | +---------+---------+---------+---------+---------+---------+---------+ | N | - | Y | \"prese | Header | ad | Header | | | | ( | ntation | field | dr-spec | field | | | | NOTE 3) | al | not | derived | not | | | | | lowed\" | i | from | i | | | | | | ncluded | Generic | ncluded | | | | | | or if | Number | | | | | | | i | (AcgPN) | (N | | | | | | ncluded | address | OTE 11) | | | | | | SIP URI | signals | | | | | | | with | | | | | | | | ad | or | | | | | | | dr-spec | network | | | | | | | of | p | | | | | | | Unav | rovided | | | | | | | ailable | value | | | | | | | User | ( | | | | | | | I | NOTE 6) | | | | | | | dentity | | | | | | | | (N | | | | | | | | OTE 11) | | | +---------+---------+---------+---------+---------+---------+---------+ | N | - | Y | \"prese | Header | SIP URI | Header | | | | ( | ntation | field | with | field | | | | NOTE 3) | restr | not | ad | not | | | | | icted\" | i | dr-spec | i | | | | | | ncluded | of | ncluded | | | | | | or if | Unav | | | | | | | i | ailable | (N | | | | | | ncluded | User | OTE 11) | | | | | | SIP URI | I | | | | | | | with | dentity | | | | | | | ad | ( | | | | | | | dr-spec | NOTE 2) | | | | | | | of | ( | | | | | | | Unav | NOTE 6) | | | | | | | ailable | | | | | | | | User | | | | | | | | I | | | | | | | | dentity | | | | | | | | (N | | | | | | | | OTE 11) | | | +---------+---------+---------+---------+---------+---------+---------+ | | | | | | Derived | pri | | | | | | | from | v-value | | | | | | | the | =: | | | | | | | Generic | \ | | | | | | | Number | "user\" | | | | | | | pa | | | | | | | | rameter | (See | | | | | | | address | table | | | | | | | signals | 16). | | | | | | | (see | | | | | | | | table | | | | | | | | 13) | | | | | | | | ( | | | | | | | | NOTE 6) | | | | | | | | ( | | | | | | | | NOTE 8) | | +---------+---------+---------+---------+---------+---------+---------+ | Y | \"prese | N | - | Derived | Tel URI | Privacy | | | ntation | | | from | or SIP | header | | | al | | | Calling | URI | is not | | | lowed\" | | | Party | derived | i | | | | | | Number | from | ncluded | | | | | | pa | Calling | or if | | | | | | rameter | Party | in | | | | | | address | Number | cluded, | | | | | | signals | pa | \"id\" | | | | | | | rameter | and | | | | | | (See | address | \"h | | | | | | table | signals | eader\" | | | | | | 14) | (See | are not | | | | | | | table | i | | | | | | | 15) | ncluded | | | | | | | ( | (See | | | | | | | NOTE 6) | table | | | | | | | (N | 16) | | | | | | | OTE 12) | | +---------+---------+---------+---------+---------+---------+---------+ | Y | \"prese | Y | \"prese | Derived | Derived | Privacy | | | ntation | | ntation | from | from | header | | | al | | al | Calling | Generic | is not | | | lowed\" | | lowed\" | Party | Number | i | | | | | | Number | (AcgPN) | ncluded | | | | | | pa | address | or if | | | | | | rameter | signals | in | | | | | | address | | cluded, | | | | | | signals | (See | \"id\", | | | | | | | table | \"h | | | | | | (See | 13) | eader\" | | | | | | table | | and | | | | | | 14) | ( | \ | | | | | | | NOTE 6) | "user\" | | | | | | | | are not | | | | | | | | i | | | | | | | | ncluded | | | | | | | | | | | | | | | | (See | | | | | | | | table | | | | | | | | 16). | +---------+---------+---------+---------+---------+---------+---------+ | Y | \"prese | Y | \"prese | Derived | Tel URI | Privacy | | | ntation | | ntation | from | or SIP | header | | | al | | restr | Calling | URI | is not | | | lowed\" | | icted\" | Party | derived | i | | | | | | Number | from | ncluded | | | | | | pa | Calling | or if | | | | | | rameter | Party | in | | | | | | address | Number | cluded, | | | | | | signals | pa | \"id\" | | | | | | | rameter | and | | | | | | (See | address | \"h | | | | | | table | signals | eader\" | | | | | | 14) | (See | are not | | | | | | | table | i | | | | | | | 15) | ncluded | | | | | | | | | | | | | | | ( | (See | | | | | | | NOTE 6) | table | | | | | | | ( | 16). | | | | | | | NOTE 9) | | +---------+---------+---------+---------+---------+---------+---------+ | | | | | | SIP URI | Privacy | | | | | | | with | header | | | | | | | ad | is not | | | | | | | dr-spec | i | | | | | | | of | ncluded | | | | | | | An | or if | | | | | | | onymous | in | | | | | | | URI | cluded, | | | | | | | ( | \"id\" | | | | | | | NOTE 6) | and | | | | | | | ( | \"h | | | | | | | NOTE 7) | eader\" | | | | | | | (N | are not | | | | | | | OTE 10) | i | | | | | | | | ncluded | | | | | | | | | | | | | | | | (See | | | | | | | | table | | | | | | | | 16). | +---------+---------+---------+---------+---------+---------+---------+ | | | | | | Derived | pri | | | | | | | from | v-value | | | | | | | the | =: | | | | | | | Generic | \" | | | | | | | Number | user\". | | | | | | | pa | | | | | | | | rameter | \"id\" | | | | | | | address | and | | | | | | | signals | \"h | | | | | | | (see | eader\" | | | | | | | table | are not | | | | | | | 13) | i | | | | | | | ( | ncluded | | | | | | | NOTE 6) | | | | | | | | ( | (See | | | | | | | NOTE 8) | table | | | | | | | | 16). | +---------+---------+---------+---------+---------+---------+---------+ | Y | \"prese | N | - | Derived | SIP URI | pri | | | ntation | | | from | with | v-value | | | restr | | | Calling | ad | =: | | | icted\" | | | Party | dr-spec | \"id\". | | | | | | Number | of | (See | | | | | | pa | Unav | table | | | | | | rameter | ailable | 16) | | | | | | address | User | | | | | | | signals | I | | | | | | | | dentity | | | | | | | (See | ( | | | | | | | table | NOTE 2) | | | | | | | 14) | ( | | | | | | | | NOTE 6) | | | | | | | | (N | | | | | | | | OTE 12) | | +---------+---------+---------+---------+---------+---------+---------+ | Y | \"prese | Y | \"prese | Derived | Derived | pri | | | ntation | | ntation | from | from | v-value | | | restr | | al | Calling | Generic | =: | | | icted\" | | lowed\" | Party | Number | \"id\". | | | | | | Number | (AcgPN) | | | | | | | pa | address | | | | | | | rameter | signals | | | | | | | address | | | | | | | | signals | (See | | | | | | | | table | | | | | | | (See | 13) | | | | | | | table | | | | | | | | 14) | ( | | | | | | | | NOTE 6) | | +---------+---------+---------+---------+---------+---------+---------+ | Y | \"prese | Y | \"prese | Derived | SIP URI | pri | | | ntation | | ntation | from | with | v-value | | | restr | | restr | Calling | ad | =: | | | icted\" | | icted\" | Party | dr-spec | \"id\" | | | | | | Number | of | | | | | | | pa | An | | | | | | | rameter | onymous | | | | | | | address | URI | | | | | | | signals | ( | | | | | | | | NOTE 6) | | | | | | | (See | ( | | | | | | | table | NOTE 7) | | | | | | | 14) | (N | | | | | | | | OTE 10) | | +---------+---------+---------+---------+---------+---------+---------+ | | | | | | Derived | pri | | | | | | | from | v-value | | | | | | | the | =: | | | | | | | Generic | \"id\", | | | | | | | Number | \" | | | | | | | pa | user\". | | | | | | | rameter | | | | | | | | address | (See | | | | | | | signals | table | | | | | | | (see | 16). | | | | | | | table | | | | | | | | 13) | | | | | | | | ( | | | | | | | | NOTE 6) | | | | | | | | ( | | | | | | | | NOTE 8) | | +---------+---------+---------+---------+---------+---------+---------+ | Y | \"prese | N | - | Header | Ad | Privacy | | | ntation | | | field | dr-spec | header | | | res | | | not | is set | is not | | | tricted | | | in | to | i | | | by | | | cluded. | \"unava | ncluded | | | ne | | | | ilable\ | or if | | | twork\" | | | | @hostpo | in | | | | | | | rtion\" | cluded, | | | ( | | | | ( | \"id\" | | | NOTE 4) | | | | NOTE 5) | and | | | | | | | ( | \"h | | | | | | | NOTE 6) | eader\" | | | | | | | (N | are not | | | | | | | OTE 12) | i | | | | | | | | ncluded | | | | | | | | (See | | | | | | | | table | | | | | | | | 16) | +---------+---------+---------+---------+---------+---------+---------+ | Y | \"prese | Y | \"prese | Header | Derived | Privacy | | | ntation | | ntation | field | from | header | | | res | | al | not | Generic | is not | | | tricted | | lowed\" | in | Number | i | | | by | | | cluded. | (AcgPN) | ncluded | | | ne | | | | address | or if | | | twork\" | | | | signals | in | | | | | | | | cluded, | | | | | | | (See | \"id\", | | | | | | | table | \"h | | | | | | | 13) | eader\" | | | | | | | | and | | | | | | | ( | \ | | | | | | | NOTE 6) | "user\" | | | | | | | | are not | | | | | | | | i | | | | | | | | ncluded | | | | | | | | | | | | | | | | (See | | | | | | | | table | | | | | | | | 16). | +---------+---------+---------+---------+---------+---------+---------+ | Y | \"prese | Y | \"prese | Header | Ad | Privacy | | | ntation | | ntation | field | dr-spec | header | | | res | | restr | not | is set | is not | | | tricted | | icted\" | in | to | i | | | by | | | cluded. | An | ncluded | | | ne | | | | onymous | or if | | | twork\" | | | | URI | in | | | | | | | ( | cluded, | | | | | | | NOTE 6) | \"id\" | | | | | | | ( | and | | | | | | | NOTE 7) | \"h | | | | | | | | eader\" | | | | | | | | are not | | | | | | | | i | | | | | | | | ncluded | | | | | | | | | | | | | | | | (See | | | | | | | | table | | | | | | | | 16). | +---------+---------+---------+---------+---------+---------+---------+ | | | | | | Derived | pri | | | | | | | from | v-value | | | | | | | the | =: | | | | | | | Generic | \" | | | | | | | Number | user\". | | | | | | | pa | | | | | | | | rameter | \"id\" | | | | | | | address | and | | | | | | | signals | \"h | | | | | | | (see | eader\" | | | | | | | table | are not | | | | | | | 13) | i | | | | | | | ( | ncluded | | | | | | | NOTE 6) | | | | | | | | ( | (See | | | | | | | NOTE 8) | table | | | | | | | | 16). | +---------+---------+---------+---------+---------+---------+---------+ | NOTE 1: | | | | | | | | A | | | | | | | | Network | | | | | | | | P | | | | | | | | rovided | | | | | | | | CLI in | | | | | | | | the | | | | | | | | CgPN | | | | | | | | pa | | | | | | | | rameter | | | | | | | | may | | | | | | | | occur | | | | | | | | on a | | | | | | | | call to | | | | | | | | IMS. | | | | | | | | Th | | | | | | | | erefore | | | | | | | | in | | | | | | | | order | | | | | | | | to | | | | | | | | allow | | | | | | | | the | | | | | | | | \"di | | | | | | | | splay\" | | | | | | | | of this | | | | | | | | Network | | | | | | | | P | | | | | | | | rovided | | | | | | | | CLI at | | | | | | | | a SIP | | | | | | | | UAS it | | | | | | | | shall | | | | | | | | be | | | | | | | | mapped | | | | | | | | into | | | | | | | | the SIP | | | | | | | | From | | | | | | | | header. | | | | | | | | It is | | | | | | | | also | | | | | | | | con | | | | | | | | sidered | | | | | | | | s | | | | | | | | uitable | | | | | | | | to map | | | | | | | | into | | | | | | | | the | | | | | | | | P-Ass | | | | | | | | erted-I | | | | | | | | dentity | | | | | | | | header | | | | | | | | since | | | | | | | | in this | | | | | | | | context | | | | | | | | it is a | | | | | | | | fully | | | | | | | | authen | | | | | | | | ticated | | | | | | | | CLI | | | | | | | | related | | | | | | | | excl | | | | | | | | usively | | | | | | | | to the | | | | | | | | calling | | | | | | | | line, | | | | | | | | and | | | | | | | | th | | | | | | | | erefore | | | | | | | | as | | | | | | | | valid | | | | | | | | as a | | | | | | | | User | | | | | | | | P | | | | | | | | rovided | | | | | | | | V | | | | | | | | erified | | | | | | | | and | | | | | | | | Passed | | | | | | | | CLI for | | | | | | | | this | | | | | | | | p | | | | | | | | urpose. | | | | | | | | | | | | | | | | NOTE 2: | | | | | | | | The | | | | | | | | \ | | | | | | | | "From\" | | | | | | | | header | | | | | | | | may | | | | | | | | contain | | | | | | | | an | | | | | | | | \"Unav | | | | | | | | ailable | | | | | | | | User | | | | | | | | Iden | | | | | | | | tity\". | | | | | | | | An | | | | | | | | \"Unav | | | | | | | | ailable | | | | | | | | User | | | | | | | | Ide | | | | | | | | ntity\" | | | | | | | | i | | | | | | | | ncludes | | | | | | | | info | | | | | | | | rmation | | | | | | | | that | | | | | | | | does | | | | | | | | not | | | | | | | | point | | | | | | | | to the | | | | | | | | calling | | | | | | | | party | | | | | | | | and | | | | | | | | in | | | | | | | | dicates | | | | | | | | that | | | | | | | | the | | | | | | | | ca | | | | | | | | ller\'s | | | | | | | | i | | | | | | | | dentity | | | | | | | | is | | | | | | | | u | | | | | | | | nknown. | | | | | | | | The | | | | | | | | e | | | | | | | | ncoding | | | | | | | | of the | | | | | | | | \"Unav | | | | | | | | ailable | | | | | | | | User | | | | | | | | Ide | | | | | | | | ntity\" | | | | | | | | shall | | | | | | | | be as | | | | | | | | defined | | | | | | | | in | | | | | | | | 3 | | | | | | | | GPP TS | | | | | | | | 23.003 | | | | | | | | [74]. | | | | | | | | | | | | | | | | NOTE 3: | | | | | | | | This | | | | | | | | comb | | | | | | | | ination | | | | | | | | of CgPN | | | | | | | | and | | | | | | | | AcgPN | | | | | | | | is an | | | | | | | | error | | | | | | | | case | | | | | | | | but is | | | | | | | | shown | | | | | | | | here to | | | | | | | | ensure | | | | | | | | con | | | | | | | | sistent | | | | | | | | mapping | | | | | | | | across | | | | | | | | di | | | | | | | | fferent | | | | | | | | im | | | | | | | | plement | | | | | | | | ations. | | | | | | | | | | | | | | | | NOTE 4: | | | | | | | | This is | | | | | | | | an ETSI | | | | | | | | s | | | | | | | | pecific | | | | | | | | value | | | | | | | | de | | | | | | | | scribed | | | | | | | | within | | | | | | | | ETSI EN | | | | | | | | 300 | | | | | | | | 356-1 | | | | | | | | [70]. | | | | | | | | | | | | | | | | NOTE 5: | | | | | | | | The | | | | | | | | setting | | | | | | | | of the | | | | | | | | host | | | | | | | | portion | | | | | | | | is | | | | | | | | ac | | | | | | | | cording | | | | | | | | to | | | | | | | | o | | | | | | | | perator | | | | | | | | policy. | | | | | | | | | | | | | | | | NOTE 6: | | | | | | | | In | | | | | | | | acc | | | | | | | | ordance | | | | | | | | with | | | | | | | | IETF R | | | | | | | | FC 3261 | | | | | | | | [19] | | | | | | | | proc | | | | | | | | edures, | | | | | | | | a tag | | | | | | | | shall | | | | | | | | be | | | | | | | | added | | | | | | | | to the | | | | | | | | \ | | | | | | | | "From\" | | | | | | | | header. | | | | | | | | | | | | | | | | NOTE 7: | | | | | | | | The | | | | | | | | \ | | | | | | | | "From\" | | | | | | | | header | | | | | | | | may | | | | | | | | contain | | | | | | | | an | | | | | | | | \"An | | | | | | | | onymous | | | | | | | | User | | | | | | | | Iden | | | | | | | | tity\". | | | | | | | | An | | | | | | | | \"An | | | | | | | | onymous | | | | | | | | User | | | | | | | | Ide | | | | | | | | ntity\" | | | | | | | | i | | | | | | | | ncludes | | | | | | | | info | | | | | | | | rmation | | | | | | | | that | | | | | | | | does | | | | | | | | not | | | | | | | | point | | | | | | | | to the | | | | | | | | calling | | | | | | | | party | | | | | | | | and | | | | | | | | in | | | | | | | | dicates | | | | | | | | that | | | | | | | | the | | | | | | | | caller | | | | | | | | has | | | | | | | | w | | | | | | | | ithheld | | | | | | | | their | | | | | | | | id | | | | | | | | entity. | | | | | | | | The | | | | | | | | e | | | | | | | | ncoding | | | | | | | | of the | | | | | | | | \"An | | | | | | | | onymous | | | | | | | | User | | | | | | | | Ide | | | | | | | | ntity\" | | | | | | | | shall | | | | | | | | be as | | | | | | | | defined | | | | | | | | in | | | | | | | | 3 | | | | | | | | GPP TS | | | | | | | | 23.003 | | | | | | | | [74]. | | | | | | | | | | | | | | | | NOTE 8: | | | | | | | | As a | | | | | | | | network | | | | | | | | option, | | | | | | | | the | | | | | | | | \ | | | | | | | | "From\" | | | | | | | | header | | | | | | | | may be | | | | | | | | derived | | | | | | | | from | | | | | | | | the | | | | | | | | Generic | | | | | | | | Number | | | | | | | | pa | | | | | | | | rameter | | | | | | | | address | | | | | | | | signals | | | | | | | | (see | | | | | | | | table | | | | | | | | 13). | | | | | | | | This | | | | | | | | option | | | | | | | | is only | | | | | | | | reco | | | | | | | | mmended | | | | | | | | to use | | | | | | | | within | | | | | | | | a | | | | | | | | trusted | | | | | | | | domain | | | | | | | | where | | | | | | | | an | | | | | | | | entity | | | | | | | | such as | | | | | | | | a TAS | | | | | | | | is | | | | | | | | con | | | | | | | | figured | | | | | | | | to be | | | | | | | | i | | | | | | | | nserted | | | | | | | | into | | | | | | | | the | | | | | | | | call | | | | | | | | path | | | | | | | | that is | | | | | | | | able to | | | | | | | | change | | | | | | | | the | | | | | | | | \ | | | | | | | | "From\" | | | | | | | | Header | | | | | | | | content | | | | | | | | to an | | | | | | | | an | | | | | | | | onymous | | | | | | | | user | | | | | | | | i | | | | | | | | dentity | | | | | | | | (N | | | | | | | | OTE 7). | | | | | | | | | | | | | | | | NOTE 9: | | | | | | | | As a | | | | | | | | network | | | | | | | | option, | | | | | | | | the | | | | | | | | \ | | | | | | | | "From\" | | | | | | | | header | | | | | | | | may be | | | | | | | | derived | | | | | | | | from | | | | | | | | the | | | | | | | | Calling | | | | | | | | Party | | | | | | | | Number | | | | | | | | pa | | | | | | | | rameter | | | | | | | | address | | | | | | | | signals | | | | | | | | (see | | | | | | | | table | | | | | | | | 15). | | | | | | | | This | | | | | | | | option | | | | | | | | is only | | | | | | | | reco | | | | | | | | mmended | | | | | | | | to use | | | | | | | | within | | | | | | | | a | | | | | | | | trusted | | | | | | | | domain | | | | | | | | where | | | | | | | | an | | | | | | | | entity | | | | | | | | such as | | | | | | | | a TAS | | | | | | | | is | | | | | | | | con | | | | | | | | figured | | | | | | | | to be | | | | | | | | i | | | | | | | | nserted | | | | | | | | into | | | | | | | | the | | | | | | | | call | | | | | | | | path | | | | | | | | that is | | | | | | | | able to | | | | | | | | change | | | | | | | | the | | | | | | | | \ | | | | | | | | "From\" | | | | | | | | Header | | | | | | | | content | | | | | | | | to an | | | | | | | | an | | | | | | | | onymous | | | | | | | | user | | | | | | | | i | | | | | | | | dentity | | | | | | | | (N | | | | | | | | OTE 7). | | | | | | | | | | | | | | | | N | | | | | | | | OTE 10: | | | | | | | | Network | | | | | | | | option. | | | | | | | | | | | | | | | | N | | | | | | | | OTE 11: | | | | | | | | As a | | | | | | | | network | | | | | | | | option, | | | | | | | | the | | | | | | | | P-Ass | | | | | | | | erted-I | | | | | | | | dentity | | | | | | | | header | | | | | | | | field | | | | | | | | may be | | | | | | | | in | | | | | | | | cluded. | | | | | | | | The URI | | | | | | | | of the | | | | | | | | P-Ass | | | | | | | | erted-I | | | | | | | | dentity | | | | | | | | header | | | | | | | | field | | | | | | | | is | | | | | | | | \"Unav | | | | | | | | ailable | | | | | | | | User | | | | | | | | Ide | | | | | | | | ntity\" | | | | | | | | defined | | | | | | | | in | | | | | | | | 3 | | | | | | | | GPP TS | | | | | | | | 23.003 | | | | | | | | [74]. | | | | | | | | When | | | | | | | | pop | | | | | | | | ulating | | | | | | | | the | | | | | | | | P-Ass | | | | | | | | erted-I | | | | | | | | dentity | | | | | | | | header | | | | | | | | field | | | | | | | | con | | | | | | | | taining | | | | | | | | the | | | | | | | | \"Unav | | | | | | | | ailable | | | | | | | | User | | | | | | | | Ide | | | | | | | | ntity\" | | | | | | | | into a | | | | | | | | SIP | | | | | | | | r | | | | | | | | equest, | | | | | | | | the | | | | | | | | MGCF | | | | | | | | may | | | | | | | | p | | | | | | | | opulate | | | | | | | | the | | | | | | | | Privacy | | | | | | | | header | | | | | | | | field | | | | | | | | set to | | | | | | | | \"id\" | | | | | | | | into | | | | | | | | the SIP | | | | | | | | request | | | | | | | | in | | | | | | | | order | | | | | | | | to | | | | | | | | avoid | | | | | | | | this | | | | | | | | i | | | | | | | | dentity | | | | | | | | to be | | | | | | | | di | | | | | | | | splayed | | | | | | | | to | | | | | | | | user. | | | | | | | | | | | | | | | | N | | | | | | | | OTE 12: | | | | | | | | As a | | | | | | | | network | | | | | | | | option, | | | | | | | | for | | | | | | | | calls | | | | | | | | where a | | | | | | | | Generic | | | | | | | | Number | | | | | | | | (ACgPN) | | | | | | | | with | | | | | | | | the | | | | | | | | \ | | | | | | | | "Nature | | | | | | | | of | | | | | | | | Address | | | | | | | | Indi | | | | | | | | cator\" | | | | | | | | v | | | | | | | | alues\" | | | | | | | | sub | | | | | | | | scriber | | | | | | | | n | | | | | | | | umber\" | | | | | | | | or | | | | | | | | \"un | | | | | | | | known\" | | | | | | | | is | | | | | | | | re | | | | | | | | ceived, | | | | | | | | the | | | | | | | | nature | | | | | | | | of | | | | | | | | address | | | | | | | | in | | | | | | | | dicator | | | | | | | | and | | | | | | | | address | | | | | | | | signals | | | | | | | | may | | | | | | | | instead | | | | | | | | be | | | | | | | | mapped | | | | | | | | into | | | | | | | | the SIP | | | | | | | | From | | | | | | | | header | | | | | | | | field | | | | | | | | as | | | | | | | | sp | | | | | | | | ecified | | | | | | | | in | | | | | | | | Table | | | | | | | | 13. | | | | | | | +---------+---------+---------+---------+---------+---------+---------+
Table 13: Mapping of generic number (additional calling party number) to SIP
From header field
+----------------+----------------+----------------+----------------+ | BICC/ISUP | Value | SIP component | Value | | parameter / | | | | | field | | | | +----------------+----------------+----------------+----------------+ | Generic Number | \"_additional | From header | display-name | | | calling party | field | (optional) and | | Number | number_ \" | | addr-spec | | Qualifier | | | | | Indicator | | | | +----------------+----------------+----------------+----------------+ | Nature of | \"_national | Tel URI or SIP | Add CC (of the | | Address | (significant) | URI | country where | | Indicator | number_ \" | | the MGCF is | | | | | located) to GN | | | | | address | | | | | signals to | | | | | construct | | | | | E.164 number | | | | | in URI. Prefix | | | | | number with | | | | | \"+\". | +----------------+----------------+----------------+----------------+ | | \" | | Map complete | | | _international | | GN address | | | number_ \" | | signals to | | | | | E.164 number | | | | | in URI. Prefix | | | | | number with | | | | | \"+\". | +----------------+----------------+----------------+----------------+ | | \"_subscriber | | Map complete | | | number_ \" or | | GN address | | | \"_unknown_ \" | | signals. Add | | | (NOTE 1) | | phone-context | | | | | URI parameter | | | | | (NOTE 2) | +----------------+----------------+----------------+----------------+ | Address signal | if NOA is | | | | | \"_national | | | | | (significant) | | | | | number_ \" then | | | | | the format of | | | | | the address | | | | | signals is: | | | | | | | | | | NDC+ SN | | | | | | | | | | If NOA is | | | | | \" | | | | | _international | | | | | number_ \" | | | | | | | | | | then the | | | | | format of the | | | | | address | | | | | signals is: | | | | | | | | | | CC + NDC + SN | | | +----------------+----------------+----------------+----------------+ | | | Tel URI or SIP | CC+NDC+SN as | | | | URI | E.164 number | | | | | in URI. Prefix | | | | | number with | | | | | \"+\". | +----------------+----------------+----------------+----------------+ | | If NOA is | | Map subscriber | | | \"_subscriber | | number as | | | number_ \" | | local number | | | (NOTE 1), then | | with a | | | the format of | | phone-context | | | the address | | URI parameter | | | signals is: | | (NOTE 2) | | | | | | | | SN | | | +----------------+----------------+----------------+----------------+ | | If NOA is | | Map address | | | \"_unknown_ \" | | signals with a | | | (NOTE 1), then | | phone-context | | | the format of | | URI parameter | | | the address | | (NOTE 2) | | | signals is | | | | | determined by | | | | | the operator. | | | +----------------+----------------+----------------+----------------+ | | If NOA is | | Map subscriber | | | \"_subscriber | | number as | | | number_ \" | | local number | | | (NOTE 1), then | | with a | | | the format of | | phone-context | | | the address | | URI parameter | | | signals is: | | (NOTE 2) | | | | | | | | SN | | | +----------------+----------------+----------------+----------------+ | | If NOA is | | Map address | | | \"_unknown_ \" | | signals with a | | | (NOTE 1), then | | phone-context | | | the format of | | URI parameter | | | the address | | (NOTE 2) | | | signals is | | | | | determined by | | | | | the operator. | | | +----------------+----------------+----------------+----------------+ | NOTE 1: The | | | | | usage and the | | | | | interworking | | | | | of the | | | | | \"Nature of | | | | | Address | | | | | Indicator\" | | | | | values | | | | | \"subscriber | | | | | number\" and | | | | | \"unknown\" is | | | | | a national | | | | | operator | | | | | option. | | | | | | | | | | NOTE 2: | | | | | Mapping | | | | | between | | | | | \"Nature of | | | | | Address | | | | | Indicator\" | | | | | values and | | | | | phone-context | | | | | values is | | | | | provisioned in | | | | | the MGCF. | | | | | Setting the | | | | | values of | | | | | phone-context | | | | | is dependent | | | | | on local | | | | | operator\'s | | | | | policies. | | | | +----------------+----------------+----------------+----------------+
Table 14: Mapping of calling party number parameter to SIP P-Asserted-Identity
header fields
+----------------+----------------+----------------+----------------+ | BICC/ISUP | Value | SIP component | Value | | Parameter / | | | | | field | | | | +----------------+----------------+----------------+----------------+ | Calling Party | | P-Ass | addr-spec and | | Number | | erted-Identity | optionally | | | | header field | display-name | | | | | (NOTE 1) | +----------------+----------------+----------------+----------------+ | Nature of | \"_national | Tel URI or SIP | Add CC (of the | | Address | (significant) | URI | country where | | Indicator | number_ \" | | the MGCF is | | | | (NOTE 2) | located) to | | | | | CgPN address | | | | | signals to | | | | | construct | | | | | E.164 number | | | | | in URI. Prefix | | | | | number with | | | | | \"+\". | +----------------+----------------+----------------+----------------+ | | \" | | Map complete | | | _international | | CgPN address | | | number_ \" | | signals to | | | | | E.164 number | | | | | in URI. Prefix | | | | | number with | | | | | \"+\". | +----------------+----------------+----------------+----------------+ | Address signal | If NOA is | Tel URI or SIP | CC+NDC+SN as | | | \"_national | URI | E.164 number | | | (significant) | | in URI. Prefix | | | number_ \" then | (NOTE 2) | number with | | | the format of | | \"+\" | | | the address | | | | | signals is: | | | | | | | | | | NDC + SN | | | | | | | | | | If NOA is | | | | | \" | | | | | _international | | | | | number_ \" | | | | | | | | | | then the | | | | | format of the | | | | | address | | | | | signals is: | | | | | | | | | | CC + NDC + SN | | | +----------------+----------------+----------------+----------------+ | NOTE 1: The | | | | | display-name | | | | | may be mapped | | | | | from the | | | | | corresponding | | | | | telephone | | | | | number if | | | | | possible and | | | | | allowed by | | | | | network | | | | | operator | | | | | policies. | | | | | | | | | | NOTE 2: A tel | | | | | URI or a SIP | | | | | URI with | | | | | \"user=phone\" | | | | | is used | | | | | according to | | | | | operator | | | | | policy. | | | | +----------------+----------------+----------------+----------------+
Table 15: Mapping of BICC/ISUP Calling Party Number parameter to SIP From
header field
+----------------+----------------+----------------+----------------+ | BICC/ISUP | Value | SIP component | Value | | parameter / | | | | | field | | | | +----------------+----------------+----------------+----------------+ | Calling Party | | From header | | | Number | | field | | +----------------+----------------+----------------+----------------+ | Nature of | \"_national | Tel URI or SIP | Add CC (of the | | Address | (significant) | URI | country where | | Indicator | number_ \" | | the MGCF is | | | | (NOTE) | located) to | | | | | CgPN address | | | | | signals then | | | | | map to | | | | | construct | | | | | E.164 number | | | | | in URI. Prefix | | | | | number with | | | | | \"+\". | +----------------+----------------+----------------+----------------+ | | \" | | Map complete | | | _international | | CgPN address | | | number_ \" | | signals to | | | | | construct | | | | | E.164 number | | | | | in URI. Prefix | | | | | number with | | | | | \"+\". | +----------------+----------------+----------------+----------------+ | Address signal | If NOA is | Tel URI or SIP | CC+NDC+SN as | | | \"_national | URI | E.164 number | | | (significant) | | in URI. Prefix | | | number_ \" then | (NOTE) | number with | | | the format of | | \"+\". | | | the address | | | | | signals is: | | | | | | | | | | NDC + SN | | | | | | | | | | If NOA is | | | | | \" | | | | | _international | | | | | number_ \" | | | | | | | | | | then the | | | | | format of the | | | | | address | | | | | signals is: | | | | | | | | | | CC + NDC + SN | | | +----------------+----------------+----------------+----------------+ | NOTE: A tel | | | | | URI or a SIP | | | | | URI with | | | | | \"user=phone\" | | | | | is used | | | | | according to | | | | | operator | | | | | policy. | | | | +----------------+----------------+----------------+----------------+
Table 16: Mapping of BICC/ISUP APRIs into SIP Privacy header fields
+----------------+----------------+----------------+----------------+ | BICC/ISUP | Value | SIP component | Value | | parameter / | | | | | field | | | | +----------------+----------------+----------------+----------------+ | Calling Party | | Privacy header | priv-value | | Number | | field | | +----------------+----------------+----------------+----------------+ | APRI | \ | Priv-value | \"id\" | | | "_presentation | | | | | restricted_ \" | | (\"id\" | | | | | included only | | | | | if the | | | | | P-Ass | | | | | erted-Identity | | | | | header is | | | | | included in | | | | | the SIP | | | | | INVITE) | +----------------+----------------+----------------+----------------+ | | \ | Priv-value | omit Privacy | | | "_presentation | | header | | | allowed_ \" | | | | | _or_ | | or Privacy | | | \ | | header without | | | "_presentation | | \"id\" and | | | restricted by | | \"header\" if | | | network_ \" | | other privacy | | | | | service is | | | | | needed | +----------------+----------------+----------------+----------------+ | Generic Number | | Privacy header | priv-value | | (ACgPN) | | field | | +----------------+----------------+----------------+----------------+ | APRI (NOTE) | \"presentation | Priv-value | \"user\" | | | restricted\" | | | +----------------+----------------+----------------+----------------+ | | \"presentation | Priv-value | omit Privacy | | | allowed\" | | header | | | | | | | | | | or Privacy | | | | | header without | | | | | \"user\" if | | | | | other privacy | | | | | service is | | | | | needed | +----------------+----------------+----------------+----------------+ | NOTE: Mapping | | | | | of Generic | | | | | Number APRI is | | | | | only | | | | | applicable, if | | | | | the Generic | | | | | Number is | | | | | mapped to the | | | | | \"From\" | | | | | header field | | | | | (see table | | | | | 12). | | | | +----------------+----------------+----------------+----------------+
If, as a network option, the MGCF supports \"Calling number verification using
signature verification and attestation information\" feature as described in
IETF RFC 8224 [153] and 3GPP TS 24.229 [9], the MGCF shall:
\- include in the initial INVITE request:
a) attestation level in the Attestation-Info header field defined in 3GPP TS
24.229 [9]; and
b) the origination identifier in the Origination-Id header field defined in
3GPP TS 24.229 [9]; and
\- if the MGCF performed mapping of Calling party number parameter to the
P-Asserted-Identity header field as defined in table 14 and the MGCF received
the Calling party number with the Screening indicator set to value \"_user
provided, verified and passed_ \":
a) set the value of the Attestation-Info header field to \"B\" (Partial
Attestation) as described in 3GPP TS 24.229 [9]; and
b) use _own address or identifier_ for creation of the Origination-Id header
field as described in 3GPP TS 24.229 [9]; or
\- otherwise, for all other mapping cases defined in table 12:
a) set the value of the Attestation-Info header field to \"C\" (Gateway
Attestation) as described in 3GPP TS 24.229 [9]; and
b) use the received Circuit identification field (i.e. Circuit identification
code) for creation of the Origination-Id header field as described in 3GPP TS
24.229 [9].
###### 7.2.3.2.2.3A \"cpc\" URI Parameter in P-Asserted-Identity Header
See Annex C for normative interworking of a Calling party\'s category to a
\"cpc\" URI parameter within P-Asserted-Identity header field.
###### 7.2.3.2.2.3B \"oli\" URI Parameter in P-Asserted-Identity Header
See Annex H for normative interworking of the \"oli\" URI parameter as a
network option.
###### 7.2.3.2.2.4 Max Forwards header
If the Hop Counter procedure is supported in the CS network, the O‑MGCF shall
use the Hop Counter parameter to derive the Max-Forwards SIP header. Due to
the different default values (that are based on network demands/provisions) of
the SIP Max-Forwards header and the Hop Counter, an adaptation mechanism shall
be used to adopt the Hop Counter to the Max Forwards at the O‑MGCF. For
example, the following guidelines could be applied.
a) Max-Forwards for a given message should be monotone decreasing with each
successive visit to a SIP entity, regardless of intervening interworking, and
similarly for Hop Counter.
b) The initial and successively mapped values of Max-Forwards should be large
enough to accommodate the maximum number of hops that may be expected of a
validly routed call.
The table 17 shows the principle of the mapping:
Table 17: Hop counter-Max forwards
* * *
Hop Counter = X Max-Forwards = Y = Integer part of (X * Factor) NOTE: The
Mapping of value X to Y should be done with the used (implemented) adaptation
mechanism.
* * *
The factor used to map from Hop Counter to Max‑Forwards for a given call will
depend on call origin, and will be provisioned at the O‑MGCF based on network
topology, trust domain rules, and bilateral agreement.
The Principle of adaptation could be implemented on a basis of the network
provision, trust domain rules and bilateral agreement.
###### 7.2.3.2.2.5 IMS Communication Service Identifier
For speech and video calls, the O-MGCF shall insert an IMS Communication
Service Identifier, indicating the IMS Multimedia Telephony Communication
Service.
The IMS Communication Service Identifier for the IMS Multimedia Telephony
Communication Service is defined in 3GPP TS 24.173 [88].
###### 7.2.3.2.2.6 P-Early-Media header field
For a speech call the O-MGCF may include the P-Early-Media header field with
the \"supported\" parameter as described in IETF RFC 5009 [89] in each
outgoing INVITE request.
NOTE: The P-Early-Media header with the \"supported\" parameter can be ignored
by terminating devices when not supporting the procedures described in IETF
RFC 5009 [89].
###### 7.2.3.2.2.7 PSTN XML elements
If the O-MGCF supports the PSTN XML body as a network option, the O-MGCF shall
map ISUP information into the XML body as shown in table 7.2.3.2.2.7.1 and
7.2.3.2.2.8.1.
Table 7.2.3.2.2.7.1: Mapping of ISUP Parameters with PSTN XML elements
+----------------------+----------------------+----------------------+ | IAM  | INVITE  | | +----------------------+----------------------+----------------------+ | ISUP Parameter | Content | PSTN XML | +----------------------+----------------------+----------------------+ | Access Transport | High layer | Hi | | Parameter | compatibility | ghLayerCompatibility | | | | (NOTE 1, NOTE 2, | | | | NOTE 3) | +----------------------+----------------------+----------------------+ | []{.underline} | Low layer | L | | | compatibility | owLayerCompatibility | | | | (NOTE 3) | +----------------------+----------------------+----------------------+ | User Service | | Bearer Capability | | Information | | (NOTE 3, NOTE 4) | +----------------------+----------------------+----------------------+ | User Teleservice | High layer | Hi | | Information | compatibility | ghLayerCompatibility | | | | (NOTE 2, NOTE 3) | +----------------------+----------------------+----------------------+ | Called Party Number | Sending terminated | sendi | | | signal (hexadecimal | ngCompleteIndication | | | digit F) | | +----------------------+----------------------+----------------------+ | NOTE 1: If two high | | | | layer compatibility | | | | information elements | | | | are received in the | | | | ATP of the IAM, they | | | | shall be transferred | | | | in the same order as | | | | received into the | | | | PSTN XML body within | | | | the INVITE. | | | | | | | | NOTE 2: In the | | | | normal case, the | | | | High layer | | | | compatibility | | | | information in the | | | | ATP is equal to the | | | | High layer | | | | compatibility in the | | | | User Teleservice | | | | Information | | | | parameter. In the | | | | PSTN XML body, no | | | | two identical High | | | | layer compatibility | | | | information shall be | | | | present. If an HLC | | | | is available both in | | | | the ATP and in the | | | | User Teleservice | | | | information, the HLC | | | | from the ATP should | | | | be mapped. | | | | | | | | NOTE 3: The O-MGCF | | | | shall only map this | | | | information element | | | | if the O-MGCF offers | | | | media formats which | | | | can be transferred | | | | by the IM-MGW | | | | without transcoding | | | | and are derived from | | | | the incoming ISUP | | | | information | | | | according to table | | | | 10b. | | | | | | | | NOTE 4: See | | | | clause 7.2.3.2.1.5. | | | +----------------------+----------------------+----------------------+
###### 7.2.3.2.2.8 Progress indicator
If the O-MGCF supports the PSTN XML body as a network option, the Forward call
indicators parameter and an available \"Progress indicator\" element in the
IAM shall be mapped into a ProgressIndicator in the PSTN XML body of the
INVITE as shown in table 7.2.3.2.2.8.
Table 7.2.3.2.2.8: Coding of PSTN XML ProgressIndicator
+----------------+----------------+----------------+----------------+ | IAM→ | INVITE → | | | +----------------+----------------+----------------+----------------+ | Forward call | Access | PSTN XML body | | | indicators | transport | with | | | parameter | parameter | Pro | | | | | gressIndicator | | | | | with | | | | | \"Progress | | | | | Description\" | | | | | value No. | | | | | (Value of PI) | | +----------------+----------------+----------------+----------------+ | ISDN User Part | ISDN access | | | | indicator | indicator | | | +----------------+----------------+----------------+----------------+ | 0\ | Value | Value | No. 1 (NOTE 1) | | (\"ISDN User | n | n | | | Part\ | on-significant | on-significant | | | not used all | | | | | the way\") | | | | +----------------+----------------+----------------+----------------+ | 1\ | 0\ | Value | No. 3 (NOTE 1) | | (\"ISDN User | (\"originating | n | | | Part\ | access non - | on-significant | | | used all the | ISDN\") | | | | way\") | | | | +----------------+----------------+----------------+----------------+ | 1\ | 1\ | Progress | Pro | | (\"ISDN User | (\"originating | indicator No. | gressIndicator | | Part\ | access ISDN\") | (Value of PI) | mapped from | | used all the | | | Progress | | way\") | | | indicator | | | | | received in | | | | | the ATP (NOTE | | | | | 2) and | | | | | additional | | | | | Pro | | | | | gressIndicator | | | | | with | | | | | \"Progress | | | | | Description\" | | | | | value No.6 | | | | | (NOTE 1, NOTE | | | | | 3) | +----------------+----------------+----------------+----------------+ | 1\ | 1\ | Not present | No. 6 (NOTE 1) | | (\"ISDN User | (\"originating | | | | Part\ | access ISDN\") | | | | used all the | | | | | way\") | | | | +----------------+----------------+----------------+----------------+ | NOTE 1: The | | | | | Pro | | | | | gressIndicator | | | | | \"Coding | | | | | Standard\" | | | | | parameter | | | | | shall be set | | | | | to \"00 (ITU-T | | | | | standardized | | | | | coding)\". The | | | | | default value | | | | | for the | | | | | Pro | | | | | gressIndicator | | | | | \"Location\" | | | | | parameter is | | | | | \"0011 | | | | | (Transit | | | | | Network)\". | | | | | | | | | | NOTE 2: The | | | | | entire | | | | | Progress | | | | | indicator, | | | | | including the | | | | | \"Progress | | | | | Description\", | | | | | \"Coding | | | | | Standard\" and | | | | | \"Location\" | | | | | parameters | | | | | shall be | | | | | copied. | | | | | | | | | | NOTE 3: The | | | | | order of | | | | | Prog | | | | | ressIndicators | | | | | within PSTN | | | | | XML body is | | | | | irrelevant. | | | | +----------------+----------------+----------------+----------------+
###### 7.2.3.2.2.9 P-Access-Network-Info
If the IAM message includes a location number ISDN user part parameter, the
O-MGCF shall include a P-Access-Network-Info header. The P-Access-Network-Info
shall be populated as shown in table 7.2.3.2.2.9.1.
Table 7.2.3.2.2.9.1: Coding of the P-Access-Network-Info header fields
* * *
BICC/ISUP parameter / field SIP component Value Location Number access-type
\"GSTN\" gstn-location (NOTE) value of Location Number, in quotes NOTE:
Alternatively, as a network option, the value of the Location Number can
populate the operator-specific-GI parameter. In this case, the operator-
specific-GI is set to the text string between quotes with the sequence of
digits found in octet 3 to N (except the filler) starting with the 1^st^
digit. The access-info parameter is set to \"operator-specific-GI\"
* * *
Table 7.2.3.2.2.9.2: Mapping ISUP Location Number to SIP P-Access-Network-Info
+----------------------------------+----------------------------------+ | IAM | INVITE | +----------------------------------+----------------------------------+ | Location Number | P-Access-Network-Info | +----------------------------------+----------------------------------+ | Parameter name | not mapped | +----------------------------------+----------------------------------+ | Parameter length | not mapped | +----------------------------------+----------------------------------+ | Parameter content | gstn-location set to the | | | hexadecimal representation of | | | the ISUP parameter content, | | | encoded as a text string between | | | quotes | +----------------------------------+----------------------------------+ | NOTE 1: As specified in ITU-T | | | Q.763 [4], the parameter | | | content includes both the header | | | fields (octets 1 and 2) and the | | | address signals. | | | | | | NOTE 2: The parameter content | | | includes the address | | | presentation restricted | | | indicator. This field is not | | | mapped to the Privacy header | | | field. It is upon network | | | operator responsibility to | | | remove the P-Access-Network-Info | | | header field when leaving the | | | trust domain, as specified in | | | 3GPP TS 24.229 [9]. | | | | | | NOTE 3: If the screening | | | indicator is set to network | | | provided, a \"network-provided\" | | | parameter is added to the | | | P-Access-Network-Info header | | | field value. | | +----------------------------------+----------------------------------+
##### 7.2.3.2.2A Coding of the INVITE when Number Portability is supported
This clause describes optional coding procedures when Number Portability is
supported.
###### 7.2.3.2.2A.1 Request-URI and To header field
When Number Portability is supported, the method used for signalling of the
Called Party E.164 address and the Number Portability Routing Number
determines the parameters of the IAM message used to derive the Request-URI of
the INVITE request.
The number portability information (rn and npdi) shall not be mapped into the
To header field.
ITU-T Q.769.1 [92] describes three possible addressing methods for signalling
of the Called Party E.164 address and Number Portability Routing Number (ITU-T
Q.769.1 [92] uses the terms directory number and network routing number
respectively). The choice of these methods is based on network operator and
national requirements.
The following clauses describe how the Request-URI and To header field are
populated, based on these methods, when a Number Portability Routing Number is
available in the IAM.
When the optional Number Portability Routing Number is available and
supported, these procedures take precedence over procedures for coding of the
Request-URI and To header field described in clause 7.2.3.2.2.1.
When a Number Portability Routing Number is not available, the Request-URI and
To header field are populated as described in clause 7.2.3.2.2.1, with the
following addition: If a Number Portability Forward Information parameter is
present in the IAM, containing a value of \"number portability query done for
called number, non-ported called subscriber\", a tel URI npdi parameter [93]
is added.
For the following clauses, the Request-URI is a tel URI or SIP URI with
\"user=phone\" and shall contain an E.164 International public
telecommunication number prefixed by a \"+\" sign (e.g. ).
###### # 7.2.3.2.2A.1.1 Separate Directory Number Addressing Method
Table 17a: Mapping ISUP to SIP Request-URI and To header field with Number
Portability Separate Directory Number Addressing Method
+----------------------+----------------------+----------------------+ | IAM→ | INVITE | | +----------------------+----------------------+----------------------+ | Called Party Number | Called Directory | Request-URI and To | | | Number | Header Field | +----------------------+----------------------+----------------------+ | **Address Signal:** | **Address Signal:** | **The | | | | \"te | |** Nature of address | **Nature of address | lephone-subscriber\" | | indicator** : | indicator**: | is populated from | | | | the Called Directory | | \"Network routing | \"National | Number as follows** : | | number in national | (significant) | | | (significant) number | number\". | Insert \"+CC\" | | format\" or | | before the Address | | \"National | | signals (NOTE 1) | | (significant) | | | | number\" or | | **The Tel URI rn= | | \"Network routing | | parameter is | | number in network | | populated from the | | specific number | | Called Party Number | | format\" as | | as follows** : | | described in ITU-T | | | | Q.769.1 [92]\ | | Insert \"+CC\" | | (NOTE 2) | | before the Address | | | | signals (NOTE 1) | | | | | | | | **and is added only | | | | to the | | | | Request-URI.** | | | | | | | | Use of the local | | | | form of the rn= | | | | parameter is out of | | | | the scope of the | | | | present | | | | specification. | | | | | | | | **Tel URI npdi | | | | parameter as defined | | | | in | | | | IETF RFC 4694 [93] | | | | is added only to the | | | | Request-URI**. | +----------------------+----------------------+----------------------+ | NOTE 1: CC = Country | | | | Code of the network | | | | in which the O-MGCF | | | | is located. | | | | | | | | NOTE 2: If the | | | | address signals | | | | received in the ISUP | | | | Called Party Number | | | | contain a sending | | | | terminated signal | | | | (hexadecimal digit | | | | F), then this shall | | | | be discarded or if | | | | the PSTN XML is | | | | supported then the | | | | sendi | | | | ngCompleteIndication | | | | shall be included. | | | +----------------------+----------------------+----------------------+
###### # 7.2.3.2.2A.1.2 Concatenated Addressing Method
Table 17b: Mapping ISUP to SIP Request-URI and To header field with Number
Portability Concatenated Number Addressing Method
+----------------------------------+----------------------------------+ | IAM→ | INVITE | +----------------------------------+----------------------------------+ | Called Party Number | Request-URI and To Header Field | +----------------------------------+----------------------------------+ | **Address Signal:** | **The \"telephone-subscriber\" | | | is populated from the Called | |** Nature of address indicator**: | Party Number as follows** : | | | | | \"Network routing number | Remove the prefix representing | | concatenated with called | the Number Portability Routing | | directory number\" or | Number | | | | | \"National (significant) | or the prefix prior to the | | number\" as described in ITU-T | directory number (NOTE3). | | Q.769.1 [92]\ | | | (NOTE 2) | Insert \"+CC\" before the | | | Address signals (NOTE 1). | | | | | | **The Tel URI rn= parameter is | | | populated from the Called Party | | | Number as follows and is added | | | only to the Request-URI** : | | | | | | Use all address digits contained | | | within the Called Party Number | | | or | | | | | | remove the digits that follow | | | the prefix representing the | | | Number Portability Routing | | | Number | | | | | | Insert \"+CC\" before the | | | Address signals (NOTE 1) | | | | | | Use of the local form of the rn= | | | parameter is out of the scope of | | | the present specification. | | | | | | **Tel URI npdi parameter as | | | defined in IETF RFC 4694 [93] | | | is added only to the | | | Request-URI**. | +----------------------------------+----------------------------------+ | NOTE 1: CC = Country Code of the | | | network in which the O-MGCF is | | | located. | | | | | | NOTE 2: If the address signals | | | received in the ISUP Called | | | Party Number contain a sending | | | terminated signal (hexadecimal | | | digit F), then this shall be | | | discarded or if the PSTN XML is | | | supported then the | | | sendingCompleteIndication shall | | | be included. | | | | | | NOTE 3: Based on national policy | | | the whole Number Portability | | | Routing number includes the | | | Called Party Number and a | | | prefix. In such cases only the | | | Prefix has to be removed. | | | Normally the Nature of address | | | indicator indicates if the | | | Number Portability Routing | | | Number contains a Called Party | | | Number and a prefix. | | +----------------------------------+----------------------------------+
###### # 7.2.3.2.2A.1.3 Separate Network Routing Number Addressing Method
Table 17c: Mapping ISUP to SIP Request-URI and To header field with Number
Portability Separate Network Routing Number Addressing Method
+----------------------+----------------------+----------------------+ | IAM→ | INVITE | | +----------------------+----------------------+----------------------+ | Network Routing | Called Party Number | Request-URI and To | | Number | | Header Field | +----------------------+----------------------+----------------------+ | **Address Signal:** | **Address Signal:** | **The | | | | \"te | |** Nature of address | **Nature of address | lephone-subscriber\" | | indicator:** | indicator:**| is populated from | | | | the Called Party | | \"Network routing | \"National | Number as follows:** | | number in national | (significant) | | | (significant) number | number\". | Insert \"+CC\" | | format\" or | | before the Address | | \"Network routing | | signals (NOTE 1) | | number in network | | | | specific number | | **The Tel URI rn= | | format\" as | | parameter is | | described in ITU-T | | populated from the | | Q.769.1 [92]\ | | Network Routing | | (NOTE 2) | | Number as follows | | | | and is added only to | | | | the Request-URI:** | | | | | | | | Insert \"+CC\" | | | | before the Address | | | | signals (NOTE 1) | | | | | | | | Use of the local | | | | form of the rn= | | | | parameter is out of | | | | the scope of the | | | | present | | | | specification. | | | | | | | | **Tel URI npdi | | | | parameter as defined | | | | in | | | | IETF RFC 4694 [93] | | | | is added only to the | | | | Request-URI.** | +----------------------+----------------------+----------------------+ | NOTE 1: CC = Country | | | | Code of the network | | | | in which the O-MGCF | | | | is located. | | | | | | | | NOTE 2: If the | | | | address signals | | | | received in the ISUP | | | | Called Party Number | | | | contain a sending | | | | terminated signal | | | | (hexadecimal digit | | | | F), then this shall | | | | be discarded or if | | | | the PSTN XML is | | | | supported then the | | | | sendi | | | | ngCompleteIndication | | | | shall be included. | | | +----------------------+----------------------+----------------------+
##### 7.2.3.2.2B Coding of the INVITE for Carrier Routeing
This clause describes optional coding procedures for carrier-based routeing.
###### 7.2.3.2.2B.1 Mapping of \"cic\" in Request-URI
The procedures followed in clause 7.2.3.2.2.1 apply with the following
addition.
If the Transit Network Selection parameter, defined according to ITU-T Q.761
[4], is included in the IAM message the O-MGCF, based on network
configuration, may send the transit network selection information to the SIP
network. In such a case the \"cic=\" parameter as defined in IETF RFC 4694
[93] is included in the Request-URI and configured according to the table
below.
Table 17d: Mapping of ISUP \"Transit Network Selection\" (TNS) to SIP
\"Carrier Identification Code\" (CIC)
* * *
**ISUP parameter/field** **Value** **SIP Component** **Value** Transit Network
Selection Digits Carrier id code in Userinfo of Request-URI \"cic=carrier ID
code\" as defined in IETF RFC 4694 [93]
* * *
###### 7.2.3.2.2B.2 Void
##### 7.2.3.2.2C Coding of INVITE with instance-id in form of IMEI URN
An Emergency Access Transfer Function (EATF) that provides IMS-based
mechanisms for enabling service continuity of IMS emergency sessions is
described in 3GPP TS 23.237 [118]. A correlation of the call legs at the EATF
is based on the equipment identifier.
A Mobile Equipment Identifier (MEI) parameter of the Mobile Service Transport
(MST) Application Transport Parameter is defined in 3GPP TS 29.205 [14].
An instance-id is a SIP Contact header field parameter defined in IETF RFC
5626 [119]. When an IMEI is available, the instance-id shall take the form of
an International Mobile station Equipment Identity (IMEI) URN as specified in
IETF RFC 7254 [120].
When an O-MGCF receives the Mobile Service Transport (MST) Application
Transport Parameter containing the Mobile Equipment Identifier (MEI) parameter
within the IAM the O-MGCF shall perform the mapping to the \"+sip.instance\"
Contact header field parameter according to table 7.2.3.2.2C.1.
Table 7.2.3.2.2C.1: Mapping of ISUP/BICC to SIP
+----------------+----------------+----------------+----------------+ |  IAM |  INVITE | | | +----------------+----------------+----------------+----------------+ | ISUP Parameter | Value | SIP Component | Value | +----------------+----------------+----------------+----------------+ | MST | Mobile | Contact header | gmsa urn set | | Application | Equipment | | to \"imei\" | | Transport | Identifier: | containing | namespace | | Parameter | IMEI | \"+ | | | | | sip.instance\" | NOTE 1 | | | | parameter in | | | | | the form of | NOTE 2 | | | | IMEI URN | | +----------------+----------------+----------------+----------------+ | | Mobile | | | | | Equipment | | | | | Identifier: | | | | | IMEISV | | | +----------------+----------------+----------------+----------------+ | NOTE 1: The | | | | | gsma-specifier | | | | | \"imei\" is | | | | | generated as: | | | | | | | | | | urn:gsma:imei | | | | | :tac-snr-spare | | | | | | | | | | where\ | | | | | \"tac\" | | | | | represents 8 | | | | | digits type | | | | | allocation | | | | | code (TAC), | | | | | \"snr\" | | | | | represents 4 | | | | | digits serial | | | | | number (SNR),\ | | | | | and \"spare\" | | | | | represents | | | | | spare decimal | | | | | digit as | | | | | specified in | | | | | TS | | | | | 23.003 [74]. | | | | | | | | | | NOTE 2: The | | | | | Software | | | | | Version Number | | | | | is not | | | | | interworked | | | | | and thus the | | | | | \"svn\" | | | | | parameter is | | | | | not included | | | | | within the | | | | | gsma urn. | | | | +----------------+----------------+----------------+----------------+
###### 7.2.3.2.2.10 PSAP Call-back indication
If the O-MGCF based on the operator policy has determined that the received
IAM message is a for the purpose of a PSAP call-back, then the O-MGCF shall
include in the initial INVITE request a Priority header field with a \"psap-
callback\" header field value as specified in IETF RFC 7090 [139]. The
operator policy decision may be based the PSAP call-back indication in the
received IAM message and/or any other information made available at O-MGCF.
NOTE: The PSAP call-back indication in the received IAM message depends on the
national regulatory requirements applicable for the emergency services (e.g.
calling party\'s category parameter indicating priority/emergency call, pre-
defined prefix in front of the called party number) and is outside the scope
of this specification.
###### 7.2.3.2.2.11 History-Info header field (optional)
See Annex L for the normative interworking of the History-Info header field
into the called IN number and original called IN number parameters.
##### 7.2.3.2.3 Receipt of CONTINUITY
This clause only applies if the O-MGCF has sent the INVITE request without
waiting for an outstanding COT message (see clause 7.2.3.2.1).
Figure 14a: Receipt of COT (success)
When the requested local preconditions (if any) have been met and if possible
outstanding continuity procedures have successfully been completed (COT with
the Continuity Indicators parameter set to \"continuity check successful\" is
received), a SDP offer (e.g. a SIP UPDATE request, as defined in IETF RFC 3311
[55]) shall be sent for each early SIP dialogue for which the received
provisional response indicated support of preconditions confirming that all
the required local preconditions have been met.
NOTE: This procedure applies regardless of whether the early SIP dialog
existed prior to the preconditions being fulfilled or is subsequently created.
##### 7.2.3.2.4 Sending of ACM and awaiting answer indication
If the Address Complete Message (ACM) has not yet been sent, the following
cases are possible trigger conditions that shall lead to the sending the
address complete message (ACM):
\- the detection of end of address signalling by the expiry of Timer T i/w~1~
or,
Figure 15: Sending of ACM T i/w1 elapses
\- the reception of the first 180 Ringing. An O-MGCF initiates the sending of
an awaiting answer indication only if according to IETF RFC 5009 [89] backward
early media is not authorized (the most recently received P-Early-Media header
field is received does not authorize the backward early media or the P-Early-
Media header field has not yet been received).
Figure 16: Sending of ACM (Receipt of first 180 Ringing and backward early
media is not authorized)
Based on local knowledge that the call is transited to a PSTN network, the
O-MGCF may decide not to generate the awaiting answer indication when
receiving the 180 Ringing message and backward early media is not authorized
according to IETF RFC 5009 [89].
Figure 16a: Sending of ACM (Receipt of first 180 Ringing and backward early
media is authorized)
\- the reception of the first 181 Call is Being Forwarded.
Figure 16b: Sending of ACM (Receipt of first 181 Call is Being Forwarded and
backward early media is not authorized)
Figure 16c: Sending of ACM (Receipt of first 181 Call is Being Forwarded that
includes authorization of early media)
\- At an O-MGCF once all the following sub-conditions have been met: {1} the
reception of the first 183 Session Progress that includes a P-Early-Media
header field authorizing backward early media, and {2} SDP preconditions are
not used, or applicable SDP preconditions have been met.
Figure 16d: Sending of ACM (Receipt of first 183 Session Progress that
includes authorization of early media)
\- As a network option, reception of 183 containing a SIP reason header with
an Q.850 Cause Value.
[]{.underline}
Figure 16e: Sending of ACM (Receipt of 183 Session Progress containing SIP
Reason header)
\- Ti/w 2 expires after the initial INVITE is sent.
Figure 17: Sending of ACM (Ti/w2 elapses)
The sending of an awaiting answer indication is described in clause 9.2.3.3.
When a 180 (Ringing) response is received with the Alert-Info header field at
an O-MGCF supporting capabilities associated with the Alert-Info header field
an O-MGCF may instruct the IM-MGW to play out early media available at the
associated URL to the PSTN leg of the communication.
If the O-MGCF receives a 18x response with a P-Early-Media header field that
changes the authorization of early media, the O-MGCF terminates the sending of
the awaiting answer indication if the header field authorizes backward early
media, and initiates the sending of the awaiting answer indication if the
header field removes authorization of backward early media and if the O-MGCF
has received the 180 Ringing response.
##### 7.2.3.2.5 Coding of the ACM
###### 7.2.3.2.5.0 General
The description of the following ISDN user part parameters can be found in
ITU-T Recommendation Q.763 [4].
###### 7.2.3.2.5.1 Backward call indicators
bits [AB]{.underline} Charge indicator Contributors
1 0 _charge_
bits [DC]{.underline} Called party\'s status indicator
01 _subscriber free_ if the 180 Ringing has been received.
00 _no indication otherwise_
bits [FE]{.underline} Called party\'s category indicator
0 0 _no indication_
bits [HG]{.underline} End-to-end method indicator
0 0 no end-to-end method available
bit [I]{.underline} Interworking indicator
1 interworking encountered
As a network operator option, the value I = 0 \"no interworking encountered\"
is used for TMR = 64 kBit/s unrestricted
NOTE: This avoids sending of a progress indicator with Progress information 0
0 0 0 0 0 1 \"Call is not end-to-end ISDN; further call progress information
may be available in‑band\", so the call will not be released for that reason
by an ISDN terminal.
bit [J]{.underline} End-to-end information indicator
0 no end-to-end information available
bit [K]{.underline} ISDN user part/BICC indicator
0 ISDN user part not used all the way
As a network operator option, the value K = 1 \"ISDN user part/BICC used all
the way\" is used for TMR = 64 kBit/s unrestricted
NOTE: This avoids sending of a progress indicator with progress information 0
0 0 0 0 0 1 \"Call is not end-to-end ISDN; further call progress information
may be available in‑band\", so the call will not be released for that reason
by an ISDN terminal.
bit [L]{.underline} Holding indicator (national use)
0 _holding not requested_
bit [M]{.underline} ISDN access indicator
0 _terminating access non-ISDN_
As a network operator option, the value M = 1 \"terminating access ISDN\" is
used for TMR = 64 kBit/s unrestricted.
NOTE: This avoids sending of a progress indicator with progress information 0
0 0 0 0 1 0 \"Destination access is non-ISDN\", so the call will not be
released for that reason by an ISDN terminal.
bit [N]{.underline} Echo control device indicator
1 _incoming echo control device included_ , for speech calls, e.g., TMR is
\"3.1KHz audio\".
0 _incoming echo control device not included_ , for known data calls, e.g.,
TMR \"64 kBit/s unrestricted\" or HLC \"Facsimile Group 2/3\".
If the PSTN XML body is supported as a network option, the Backward Call
indicators parameters derived as shown in table 7.2.3.2.5.1.1 shall take
precedence over the above Backward Call indicators parameter setting.
Table 7.2.3.2.5.1.1: Derivation of Backward Call Indicators from PSTN XML body
+----------------------------------+----------------------------------+ | ←ACM | ← 180 Ringing or 183 Session | | | Progress | +----------------------------------+----------------------------------+ | Backward call indicators | PSTN XML body with Progress | | parameter | indicator with \"Coding | | | Standard\" value \"00 (ITU-T | | Optional backward call | standardized coding)\" and with | | indicators parameter | \"Progress Description\" No | | | (Value of PI) | +----------------------------------+----------------------------------+ | Backward call indicators | No. 1 | | parameter | | | | (\"Call is not end-to-end ISDN: | | ISDN User Part indicator | further call progress | | | information may be available | | 0 \"ISDN User Part not used all | in-band\") | | the way\" | | +----------------------------------+----------------------------------+ | Backward call indicators | No. 2\ | | parameter | (\"Destination address is | | | non-ISDN\") | | ISDN User Part indicator | | | | | | 1 \"ISDN User Part used all the | | | way\" | | | | | | ISDN access indicator | | | | | | 0 \"Terminating access | | | non-ISDN\" | | +----------------------------------+----------------------------------+ | Backward call indicators | No. 7 | | parameter | | | | (\"Terminating user ISDN\") | | Interworking indicator | | | | | | 0 \"no interworking | | | encountered\" | | | | | | ISDN User Part indicator | | | | | | 1 \"ISDN User Part used all the | | | way\" | | | | | | ISDN access indicator | | | | | | 1 \"Terminating access ISDN\" | | +----------------------------------+----------------------------------+ | Optional backward call | No. 8 | | indicators parameter | | | | (\"In-band information or an | | In-band information indicator | appropriate pattern is now | | | available\") | | 1 \"in-band information or an | | | appropriate pattern is\ | | | now available\" | | +----------------------------------+----------------------------------+
###### 7.2.3.2.5.2 Optional Backward call indicators
Bit A 1 \"in-band information or an appropriate pattern is now available\"
shall be set if 183 Session Progress or\ 181 Call is Being Forwarded response
is received and according to IETF RFC 5009 [89] backward early\ media is
authorized.
Table 7a0.4: Sending criteria of Optional backward call indicators parameter
+----------------------------------+----------------------------------+ | ←ACM | ← 183 Session Progress or\ | | | 181 Call is Being Forwarded | +----------------------------------+----------------------------------+ | Optional backward call | P-Early-Media header authorizing | | indicators parameter | backward early media | | | | | In-band information indicator | | | | | | in-band information or an | | | appropriate pattern is now | | | available | | +----------------------------------+----------------------------------+
###### 7.2.3.2.5.3 Access Transport Parameter, Transmission medium used
parameter
If the O-MGCF supports the PSTN XML body as a network option and if a PSTN XML
body is received within the 180 ringing or 183 session progress, the O-MGCF
shall store the received PSTN XML elements, replacing any previously stored
PSTN XML elements on that dialog.
NOTE: Multiple 18x responses can be received, both within a single dialog and
in multiple dialogs. The PSTN XML bodies are stored on a per-dialog basis to
be mapped to the ATP/TMU parameters on receipt of the 200 OK (see clause
7.2.3.2.9.2).
Table 7.2.3.2.5.3.1: Void
###### 7.2.3.2.5.4 Progress indicator
If the O-MGCF supports the PSTN XML body as a network option and receives it
in the 180 or 183, the O-MGCF shall store a \"ProgressIndicator\" element from
the PSTN XML body on a per dialog basis and shall add itionaly map it into a
Progress Indicator in the ACM as shown in table 7.2.3.2.5.4.1.
Table 7.2.3.2.5.4.1: Handling of the progress indicator
* * *
←ACM ←180/183 Access transport parameter PSTN XML body with Progress indicator
with \"Coding Standard\" value \"00 (ITU-T standardized coding)\" and with
\"Progress Description\" No. (Value of PI) Progress indicator (NOTE) Progress
indicator No. 1 / 2 Progress indicator (NOTE) Progress indicator No. 8 NOTE:
The entire Progress Indicator, including the \"Progress Description\",
\"Coding Standard\" and \"Location\" parameters shall be copied.
* * *
Table 7.2.3.2.5.4.2: Void
###### 7.2.3.2.5.5 Cause Value
If the O-MGCF sends the ACM upon reception of a SIP 183 provisional response
containing a SIP reason header with a Q.850 Cause value, the O-MGCF may
include the received Cause value within the ACM as a network option. The
mapping of the Cause Indicators parameter to the Reason header as shown in
table 8a shall be applied. IETF RFC 6432 [115] describes the use of the Reason
header field in responses. The Reason header field itself is described in IETF
RFC 3326 [116].
If, as a network option, the O-MGCF supports the location header field
parameter as described in IETF RFC 8606 [155], the O-MGCF shall derive the
ISUP cause location from the location parameter in the SIP Reason header field
as shown in table 8c (see subclause 7.2.3.1.7).
##### 7.2.3.2.6 Sending of the Call Progress message (CPG)
###### 7.2.3.2.6.0 General
If the Address Complete Message (ACM) has already been sent, the O-MGCF shall
send the Call Progress message (CPG) in the following cases:
\- Upon receipt of the SIP 180 Ringing provisional response. An O-MGCF should
initiate the sending of an awaiting answer indication only if according to
IETF RFC 5009 [89] backward early media is not authorized (the most recently
received P-Early-Media header field does not authorize the backward early
media or the P-Early-Media header field has not yet been received).
{width="3.03125in" height="1.1854166666666666in"}
Figure 18: Sending of CPG(Alerting) (Receipt of 180 Ringing response and
backward early media is not authorized)
Figure 18a: Sending of CPG(Alerting) (Receipt of 180 Ringing response with
authorization of early media)
Based on local knowledge that the call is transited to a PSTN network, the
O-MGCF may decide not to generate the awaiting answer indication when
receiving the 180 Ringing message and backward early media is not authorized
according to IETF RFC 5009 [89].
\- At an O-MGCF upon receipt of a 183 Session Progress that includes the first
P-Early-Media header field authorizing backward early media.
Figure 18b: Sending of CPG(in-band information available)
\- Upon receipt of the 181 Call is Being Forwarded provisional response.
Figure 18c: Sending of CPG(Progress)
\- As a network option, reception of 183 containing a SIP reason header with a
Q.850 Cause Value.
[]{.underline}
Figure 18d: Sending of CPG (Receipt of 183 Session Progress containing SIP
Reason header)
If the O-MGCF receives a 18x response with P-Early-Media header that changes
the authorization of early media, the O-MGCF terminates the sending of the
awaiting answer indication if the header authorizes backward early media and
initiates the sending of the awaiting answer indication if the header removes
authorization of backward early media and if the O-MGCF has received the 180
Ringing response.
###### 7.2.3.2.6.1 Handling of the progress indicator
If the O-MGCF supports the PSTN XML body as a network option and receives it
in the 180 or 183, any \"ProgressIndicator\" element in the PSTN XML body
shall be stored on a per-dialog basis as well as mapped as shown in tables
7.2.3.2.6.1.1 and 7.2.3.2.6.1.3.
Table 7.2.3.2.6.1.1: Mapping of progress indicator in PSTN XML body into ATP
+----------------------------------+----------------------------------+ | ←CPG | ←180/183 | +----------------------------------+----------------------------------+ | Access transport parameter | PSTN XML body with Progress | | | indicator X | +----------------------------------+----------------------------------+ | Progress indicator (NOTE 1, NOTE | Progress indicator No. 1 / 2 | | 3) | | +----------------------------------+----------------------------------+ | Progress indicator (NOTE 2, NOTE | Progress indicator No. 4 | | 3) | | +----------------------------------+----------------------------------+ | Progress indicator No. 4 (NOTE | Progress indicator No. 7 | | 2, NOTE 4) | | +----------------------------------+----------------------------------+ | NOTE 1: Values 1 (\"call is not | | | end-to-end ISDN: further call | | | progress information may be | | | available in-band\") or 2 | | | (\"destination address is | | | non-ISDN\") shall be sent if | | | Value 4 (\"Call has returned to | | | the ISDN\") has been sent since | | | value 1 or 2 was previously sent | | | or if no value 1 or 2 was | | | previously sent. | | | | | | NOTE 2: Value 4 (\"Call has | | | returned to the ISDN\") shall be | | | sent if value 1 (\"call is not | | | end-to-end ISDN: further call | | | progress information may be | | | available in-band\") or 2 | | | (\"destination address is | | | non-ISDN\") was sent previously | | | and no value 4 has been | | | signalled since. | | | | | | NOTE 3: The entire Progress | | | Indicator, including the | | | \"Progress Description\", | | | \"Coding Standard\" and | | | \"Location\" parameters shall be | | | copied. | | | | | | NOTE 4: The Progress Indicator | | | \"Coding Standard\" parameter | | | shall be set to \"00 (ITU-T | | | standardized coding)\". The | | | default value for the Progress | | | Indicator \"Location\" parameter | | | is \"0100 (Public Network | | | serving remote user)\". | | +----------------------------------+----------------------------------+
Table 7.2.3.2.6.1.2: Void
Table 7.2.3.2.6.1.3: Mapping of progress indicator in PSTN XML body into Event
Indicator
+----------------------------------+----------------------------------+ | ←CPG | ←180/183 | +----------------------------------+----------------------------------+ | Event indicator | PSTN XML body with Progress | | | indicator with \"Coding | | | Standard\" value \"00 (ITU-T | | | standardized coding)\" and with | | | Progress Description\" value No. | | | X | +----------------------------------+----------------------------------+ | \"In-band information or | No. 8 | | appropriate pattern is now | | | available\" | \"In-band information or | | | appropriate pattern is now | | | available\" | +----------------------------------+----------------------------------+
##### 7.2.3.2.7 Coding of the CPG
###### 7.2.3.2.7.0 General
The description of the following ISDN user part parameters can be found in
ITU-T Recommendation Q.763 [4].
###### 7.2.3.2.7.1 Event information
bits G-A Event indicator
0 0 0 0 0 0 1 _alerting_ if 180 Ringing response received
0 0 0 0 0 1 0 _progress_ , if 181 Call is Being Forwarded response received
0 0 0 0 0 1 1 _in-band information or an appropriate pattern is now available_
, if the received 183 Session\ Progress response and most recently received
P-Early-Media header authorizes backward early media
NOTE: In national networks other values of the Event indicator may be used.
If the O-MGCF supports the PSTN XML body as a network option and receives in
the 180 or 183 a \"ProgressIndicator\" element in the PSTN XML body with a
\"Coding Standard\" value \"00 (ITU-T standardized coding)\" and with Progress
Description\" value No. 8, instead of the mapping above, the O-MGCF shall map
this \"Progress Indicator\" into the \"Event Indicator\" within the CPG as
shown in table 7.2.3.2.6.1.3.
###### 7.2.3.2.7.2 Access Transport Parameter
If the O-MGCF supports the PSTN XML body as a network option and if a PSTN XML
body is received within the 180 ringing or 183 session progress, the O-MGCF
shall store the contained information as described in clause 7.2.3.2.5.3, and
additionally shall map this \"Progress Indicator\" into the ATP within the CPG
as shown in table 7.2.3.2.6.1.1.
NOTE: Multiple 18x responses can be received, both within a single dialog and
in multiple dialogs. The PSTN XML bodies are stored on a per-dialog basis to
be mapped to the ATP parameter on receipt of the 200 OK (see clause
7.2.3.2.9.2).
###### 7.2.3.2.7.3 Void
Table 17h: Void
Table 17j: Void
###### 7.2.3.2.7.4 Handling of Backward Call indicators
The Backward Call indicator shall be derived as shown in clause 7.2.3.2.5.1.
The Backward Call Indicators parameter is optional in the CPG message and
shall only be included if any indicators have changed from those previously
sent.
###### 7.2.3.2.7.5 Optional Backward call indicators
Bit A 1 \"in-band information or an appropriate pattern is now available\"
shall be set if 181 Call is Being\ Forwarded response is received and
according to IETF RFC 5009 [89] the backward early media is\ authorized.
Table 17k: Sending criteria of Optional backward call indicators parameter
+----------------------------------+----------------------------------+ | ←CPG | ← 181 Call is Being Forwarded | +----------------------------------+----------------------------------+ | Optional backward call | P-Early-Media header authorizing | | indicators parameter | backward early media | | | | | In-band information indicator | | | | | | in-band information or an | | | appropriate pattern is\ | | | now available | | +----------------------------------+----------------------------------+
###### 7.2.3.2.7.6 Cause Value
If the O-MGCF sends the CPG upon reception of a SIP 183 provisional response
containing a SIP reason header with a Q.850 Cause value, the O-MGCF may
include the received Cause value within the ACM as a network option. The
mapping of the Cause Indicators parameter to the Reason header as shown in
table 8a shall be applied. IETF RFC 6432 [115] describes the use of the Reason
header field in responses. The Reason header field itself is described in IETF
RFC 3326 [116].
If, as a network option, the O-MGCF supports the location header field
parameter as described in IETF RFC 8606 [155], the O-MGCF shall derive the
ISUP cause location from the location parameter in the SIP Reason header field
as shown in table 8c (see subclause 7.2.3.1.7).
##### 7.2.3.2.7a Receipt of 200 OK(INVITE)
Upon receipt of the first 200 OK (INVITE), the O-MGCF shall send an Answer
Message (ANM) or Connect message (CON) as described in clauses 7.2.3.2.8 to
7.2.3.2.11.
The O-MGCF shall not progress any further early dialogues to established
dialogues. Therefore, upon the reception of a subsequent final 200 (OK)
response for any further dialogue for an INVITE request (e.g., due to
forking), the O-MGCF shall:
1) acknowledge the response with an ACK request; and
2) send a BYE request to this dialog in order to terminate it.
If the received 200 OK (INVITE) response contains a Feature-Caps header field,
defined in IETF RFC 6809 [142] with a \"+g.3gpp.ics\" header field parameter
as specified in clause B.4 of 3GPP TS 24.292 [141] then according to operator
policy the O-MGCF may mark a call as an \"ICS call\".
##### 7.2.3.2.7b Internal through connection of the bearer path
The through connection procedure is described in clause 9.2.3.3.7.
##### 7.2.3.2.8 Sending of the Answer Message (ANM)
Upon receipt of the first 200 OK (INVITE), if the Address Complete Message
(ACM) has already been sent, the O-MGCF shall send the Answer Message (ANM) to
the preceding exchange.
NOTE: Through connection and the stop of awaiting answer indication are
described in clause 9.2.3.3
Figure 19: Sending of ANM
##### 7.2.3.2.9 Coding of the ANM
###### 7.2.3.2.9.1 Backwards Call Indicators
If Backwards Call Indicators are included in the ANM, then the coding of these
parameters shall be as described in clause 7.2.3.2.5.1. The Backward Call
Indicators parameter is optional in the ANM message and shall only be included
if any indicators have changed from those previously sent.
###### 7.2.3.2.9.2 Access Transport Parameter
If the O-MGCF supports the PSTN XML body as a network option and if a PSTN XML
body is received within the 200 OK(INVITE) or has been previously stored from
a 18x message, the O-MGCF shall map the most recently received information for
the established dialog (i.e. the dialog for which the first 200 OK has been
received) into the ANM as shown in table 7.2.3.2.9.2.1 except Progress
Indicator value No. 3 or No. 8.
Table 7.2.3.2.9.2.1: Mapping of PSTN XML elements into ISUP Parameters
+----------------------+----------------------+----------------------+ |  ANM |  200 OK / stored | | | | information from | | | | previous 18x | | +----------------------+----------------------+----------------------+ | ISUP Parameter | Content | PSTN XML (NOTE 9) | +----------------------+----------------------+----------------------+ | Access Transport | Progress indicator | ProgressIndicator | | Parameter | (NOTE 5, NOTE 8) | with \"Coding | | | | Standard\" value | | | | \"00 (ITU-T | | | | standardized | | | | coding)\" and with | | | | \"Progress | | | | Description\" value | | | | No. 1 / 2 | +----------------------+----------------------+----------------------+ | | Progress indicator | ProgressIndicator | | | with \"Progress | with \"Coding | | | Description\" value | Standard\" value | | | No. 4 (NOTE 4, NOTE | \"00 (ITU-T | | | 6, NOTE 9) | standardized | | | | coding)\" and with | | | | \"Progress | | | | Description\" value | | | | No. 7 | +----------------------+----------------------+----------------------+ | | Progress indicator | ProgressIndicator | | | (NOTE 6, NOTE 8) | with \"Coding | | | | Standard\" value | | | | \"00 (ITU-T | | | | standardized | | | | coding)\" and with | | | | \"Progress | | | | Description\" value | | | | No. 4 | +----------------------+----------------------+----------------------+ | | Progress indicator | ProgressIndicator | | | (NOTE 7, NOTE 8) | with \"Coding | | | | Standard\" value | | | | \"00 (ITU-T | | | | standardized | | | | coding)\" and with | | | | \"Progress | | | | Description\" value | | | | No. 5 | +----------------------+----------------------+----------------------+ | | High layer | Hi | | | compatibility (NOTE | ghLayerCompatibility | | | 1) | | +----------------------+----------------------+----------------------+ | | Bearer Capability | BearerCapability | | | | (NOTE 2) | +----------------------+----------------------+----------------------+ | | Bearer Capability | BearerCapability | | | (\"UDI-TA\") | (\"UDI-TA\") (NOTE | | | | 3) | +----------------------+----------------------+----------------------+ | NOTE 1: This | | | | information element | | | | shall only be mapped | | | | if the O-MGCF | | | | transfers media | | | | types listed in | | | | table 10b without | | | | transcoding. | | | | | | | | NOTE 2: Applicable | | | | if the O-MGCF has | | | | not propagated UDI | | | | fallback signalling | | | | according to | | | | clause 7.2.3.2.1.5. | | | | | | | | NOTE 3: Applicable | | | | if the O-MGCF has | | | | propagated UDI | | | | fallback signalling | | | | according to | | | | clause 7.2.3.2.1.5. | | | | Only the value | | | | \"UDI-TA\" within | | | | the PSTN XML BC | | | | shall be mapped. | | | | Other values within | | | | the PSTN XML BC are | | | | mapped to TMU as | | | | described in | | | | clause 7.2.3.2.9.3. | | | | | | | | NOTE 4: | | | | ProgressIndicator | | | | No. 7 is not mapped | | | | into the ISUP ATP. | | | | However, it may be | | | | mapped into PI=4. | | | | | | | | NOTE 5: Values 1 | | | | (\"call is not | | | | end-to-end ISDN: | | | | further call | | | | progress information | | | | may be available | | | | in-band\") or 2 | | | | (\"destination | | | | address is | | | | non-ISDN\") shall be | | | | sent if Value 4 | | | | (\"Call has returned | | | | to the ISDN\") has | | | | been sent since | | | | value 1 or 2 was | | | | previously sent or | | | | if no value 1 or 2 | | | | was previously sent. | | | | | | | | NOTE 6: Value 4 | | | | (\"Call has returned | | | | to the ISDN\") shall | | | | be sent if value 1 | | | | (\"call is not | | | | end-to-end ISDN: | | | | further call | | | | progress information | | | | may be available | | | | in-band\") or 2 | | | | (\"destination | | | | address is | | | | non-ISDN\") was sent | | | | previously and no | | | | value 4 has been | | | | signalled since. | | | | | | | | NOTE 7: This value | | | | indicates a bearer | | | | service change and | | | | is present with an | | | | associated | | | | BearerCapability and | | | | indicates that | | | | fallback has | | | | occurred (i.e. TMR | | | | and TMR Prime | | | | present in IAM and | | | | the destination ISDN | | | | user has accepted | | | | the BearerCapability | | | | equating to TMR | | | | Prime). | | | | | | | | NOTE 8: The entire | | | | Progress Indicator, | | | | including the | | | | \"Progress | | | | Description\", | | | | \"Coding Standard\" | | | | and \"Location\" | | | | parameters shall be | | | | copied. | | | | | | | | NOTE 9: The Progress | | | | Indicator \"Coding | | | | Standard\" parameter | | | | shall be set to \"00 | | | | (ITU-T standardized | | | | coding)\". The | | | | default value for | | | | the Progress | | | | Indicator | | | | \"Location\" | | | | parameter is \"0100 | | | | (Public Network | | | | serving remote | | | | user)\". | | | +----------------------+----------------------+----------------------+
###### 7.2.3.2.9.3 Transmission Medium Used parameter (TMU)
The procedures in the present clause shall only apply if the O-MGCF supports
the PSTN XML body, and has propagated UDI-TA fallback signalling according to
clause 7.2.3.2.1.5.
If a Bearer Capability element within a PSTN XML body is received within the
first 200 OK(INVITE) or has been previously stored from a 18x message relating
to the now established dialog (i.e. the dialogue for which the first 200 OK
has been received), the O-MGCF shall map the most recently received
information (if any) into a TMU within the ANM as shown in table
7.2.3.2.9.3.1. If the most recently received PSTN XML BearerCapability is
\"UDI-TA\", it shall be mapped into an ISUP Access Transport Parameter Bearer
Capability (see clause 7.2.3.2.9.2).
NOTE: The TMU is only included if both the TMR and TMR Prime were received in
the ISUP IAM and fallback has occurred.
Table 7.2.3.2.9.3.1 - Mapping to TMU parameter
* * *
 ANM  200 OK / stored information from previous 18x TMU PSTN XML
BearerCapability TMU = \"Speech\" PSTN XML BearerCapability = \"Speech\" TMU=
\"3.1 kHz audio\" PSTN XML BearerCapability = \"3.1 kHz audio\" No mapping
(fallback has not occurred) PSTN XML BearerCapability = \"UDI-TA\" TMU = \"3.1
kHz audio\" PSTN XML BearerCapability not present
* * *
##### 7.2.3.2.10 Sending of the Connect message (CON)
Upon receipt of the first 200 OK (INVITE), if the Address Complete Message
(ACM) has not yet been sent, the O-MGCF shall send the Connect message (CON)
to the preceding exchange.
Figure 20: Sending of CON
##### 7.2.3.2.11 Coding of the CON
###### 7.2.3.2.11.0 General
The description of the following ISDN user part parameters can be found in
ITU-T Recommendation Q.763 [4].
###### 7.2.3.2.11.1 Backward call indicators
The Called Party\'s status indicator (Bit DC) of BCI parameter shall be set to
\"no indication\". The other BCI indicators shall be set as described in
clause 7.2.3.2.5.1
###### 7.2.3.2.11.2 Access Transport Parameter
The O-MGCF shall apply the same procedure as described for the ANM in clause
7.2.3.2.9.2.
###### 7.2.3.2.11.3 Transmission medium used parameter
The O-MGCF shall apply the same procedure as described for the ANM in clause
7.2.3.2.9.3.
##### 7.2.3.2.11A Receipt of a reINVITE request
When a reINVITE request is received from the network containing a Call-Info
header field the MGCF may instruct the IM-MGW to send media available at the
associated URL to the PSTN leg of the communication.
##### 7.2.3.2.12 Receipt of Status Codes 4xx, 5xx or 6xx
Figure 21: Receipt of Status codes 4xx, 5xx or 6xx
If a Reason header as described in IETF RFC 6432 [115] is included in a 4xx,
5xx, 6xx response, then the Cause Value of the Reason header shall be mapped
to the ISUP Cause Value field in the ISUP REL message. The Reason header field
itself is described in IETF RFC 3326 [116]. The mapping of the Reason header
to the Cause Indicators parameter is shown in table 8a (see clause 7.2.3.1.7).
Otherwise coding of the Cause value field in the REL message is derived from
the SIP Status code received according to table 18. The Cause Indicators
Parameter Values are defined in ITU-T Recommendation Q.850 [38].
If, as a network option, the O-MGCF supports the location header field
parameter as described in IETF RFC 8606 [155], the O-MGCF shall derive the
ISUP cause location from the location parameter in the SIP Reason header field
as shown in table 8c (see subclause 7.2.3.1.7).
In all cases where SIP itself specifies additional SIP side behaviour related
to the receipt of a particular INVITE response these procedures should be
followed in preference to the immediate sending of a REL message to BICC/ISUP.
If there are no SIP side procedures associated with this response, the REL
shall be sent immediately.
NOTE Depending upon the SIP side procedures applied at the O-MGCF it is
possible that receipt of certain 4xx/5xx/6xx responses to an INVITE may in
some cases not result in any REL message being sent to the BICC/ISUP network.
For example, if a 401 Unauthorized response is received and the O-MGCF
successfully initiates a new INVITE containing the correct credentials, the
call will proceed.
When the O-MGCF receives a 415 Unsupported Media Type response, as a result
from a multipart MIME body in an initial INVITE request not being accepted,
and when the handling of all the MIME bodies in the initial INVITE request
except for the SDP MIME body are optional (Content-Disposition header
parameter \"handling\" is set to optional), the O-MGCF shall send an ACK
request and send a new initial INVITE request with SDP as only MIME body in
accordance with clause 8.1.3.5 of IETF RFC 3261 [19].
Table 18: 4xx/5xx/6xx Received on SIP side of O-MGCF
+----------------------------------+----------------------------------+ | ←REL (cause value) | ←4xx/5xx/6xx SIP Message | +----------------------------------+----------------------------------+ | Cause value No 111 (Protocol | 400 Bad Request | | error, unspecified) | | +----------------------------------+----------------------------------+ | Cause value No 127 | 401 Unauthorized | | (Interworking, unspecified) | | +----------------------------------+----------------------------------+ | Cause value No 127 | 402 Payment Required | | (Interworking, unspecified) | | +----------------------------------+----------------------------------+ | Cause value No 79 (Service or | 403 Forbidden | | option not implemented, | | | unspecified) | | +----------------------------------+----------------------------------+ | Cause value No 1 (Unallocated | 404 Not Found | | (unassigned) number) | | +----------------------------------+----------------------------------+ | Cause value No 127 | 405 Method Not Allowed | | (Interworking, unspecified) | | +----------------------------------+----------------------------------+ | Cause value No 127 | 406 Not Acceptable | | (Interworking, unspecified) | | +----------------------------------+----------------------------------+ | Cause value No 127 | 407 Proxy authentication | | (Interworking, unspecified) | required | +----------------------------------+----------------------------------+ | Cause value No 102 (Recovery on | 408 Request Timeout | | timer expiry) | | +----------------------------------+----------------------------------+ | Cause value No 22 (Number | 410 Gone | | changed) | | +----------------------------------+----------------------------------+ | Cause value No 127 | 413 Request Entity too long | | (Interworking, unspecified) | | +----------------------------------+----------------------------------+ | Cause value No 111 (Protocol | 414 Request-URI too long | | error, unspecified) | | +----------------------------------+----------------------------------+ | Cause value No 127 | 415 Unsupported Media type | | (Interworking, unspecified) | | +----------------------------------+----------------------------------+ | Cause value No 111 (Protocol | 416 Unsupported URI scheme | | error, unspecified) | | +----------------------------------+----------------------------------+ | Cause value No 79 (Service or | 417 Unknown Resource-Priority | | option not implemented, | | | unspecified) | | +----------------------------------+----------------------------------+ | Cause value No 111 (Protocol | 420 Bad Extension | | error, unspecified) | | +----------------------------------+----------------------------------+ | Cause value No 111 (Protocol | 421 Extension required | | error, unspecified) | | +----------------------------------+----------------------------------+ | Cause value No 31 (Normal, | 422 Session Interval Too Small | | unspecified) | | +----------------------------------+----------------------------------+ | Cause value No 127 | 423 Interval Too Brief | | (Interworking, unspecified) | | +----------------------------------+----------------------------------+ | Cause value No 127 | 428 Use Identity Header (NOTE 5) | | (Interworking, unspecified) | | +----------------------------------+----------------------------------+ | Cause value No 24 (Call rejected | 433 Anonymity Disallowed (NOTE | | due to feature at the | 1) | | destination) | | +----------------------------------+----------------------------------+ | Cause value No 127 | 436 Bad Identity Info (NOTE 5) | | (Interworking, unspecified) | | +----------------------------------+----------------------------------+ | Cause value No 127 | 437 Unsupported Credential | | (Interworking, unspecified) | (NOTE 5) | +----------------------------------+----------------------------------+ | Cause value No 127 | 438 Invalid Identity Header | | (Interworking, unspecified) | (NOTE 5) | +----------------------------------+----------------------------------+ | Cause value No 127 | 440 Max-Breadth Exceeded | | (Interworking, unspecified) | | +----------------------------------+----------------------------------+ | Cause value No 20 (Subscriber | 480 Temporarily Unavailable | | absent) | | +----------------------------------+----------------------------------+ | Cause value No 127 | 481 Call/Transaction does not | | (Interworking, unspecified) | exist | +----------------------------------+----------------------------------+ | Cause value No 127 | 482 Loop detected | | (Interworking, unspecified) | | +----------------------------------+----------------------------------+ | Cause value No 25 (Exchange | 483 Too many hops | | routing error) | | +----------------------------------+----------------------------------+ | Cause value No 28 (Invalid | 484 Address Incomplete | | number format (address | | | incomplete)) | | +----------------------------------+----------------------------------+ | Cause value No 1 (Unallocated | 485 Ambiguous | | (unassigned) number) | | +----------------------------------+----------------------------------+ | Cause value No 17 (User busy) | 486 Busy Here | +----------------------------------+----------------------------------+ | Cause value No 127 | 487 Request terminated | | (Interworking, unspecified) or | | | not interworked. (NOTE 2) | | +----------------------------------+----------------------------------+ | Cause value No 50 (Requested | 488 Not acceptable here | | facility not subscribed) | | +----------------------------------+----------------------------------+ | Cause value No 127 | 493 Undecipherable | | (Interworking, unspecified) | | +----------------------------------+----------------------------------+ | Cause value No 127 | 500 Server Internal error | | (Interworking, unspecified) | | +----------------------------------+----------------------------------+ | Cause value No 79 (Service or | 501 Not implemented | | option not implemented, | | | unspecified) | | +----------------------------------+----------------------------------+ | Cause value No 27 (Destination | 502 Bad Gateway | | out of order) | | +----------------------------------+----------------------------------+ | Cause value No 41 (Temporary | 503 Service Unavailable | | failure) | | +----------------------------------+----------------------------------+ | Cause value No 102 (Recovery on | 504 Server timeout | | timer expiry) | | +----------------------------------+----------------------------------+ | Cause value No 127 | 505 Version not supported | | (Interworking, unspecified) | | +----------------------------------+----------------------------------+ | Cause value No 95 (Invalid | 513 Message too large | | message, unspecified) | | +----------------------------------+----------------------------------+ | Cause value No 127 | 580 Precondition failure | | (Interworking, unspecified) | | +----------------------------------+----------------------------------+ | Cause value No 17 (User busy) | 600 Busy Everywhere | +----------------------------------+----------------------------------+ | Cause value No 21 (Call | 603 Decline | | rejected) | | +----------------------------------+----------------------------------+ | Cause value No 2 (No route to | 604 Does not exist anywhere | | specified transit network) | | +----------------------------------+----------------------------------+ | Cause value No 88 (Incompatible | 606 Not Acceptable | | destination) | | +----------------------------------+----------------------------------+ | Cause value No 21 (Call | 607 Unwanted (NOTE 4) | | rejected) | | +----------------------------------+----------------------------------+ | NOTE 1: Anonymity Disallowed, | | | IETF RFC 5079 [77] refers. | | | | | | NOTE 2: No interworking if the | | | O-MGCF previously issued a | | | CANCEL request for the INVITE. | | | | | | NOTE 3: The 4xx/5xx/6xx SIP | | | responses that are not covered | | | in this table are not | | | interworked. | | | | | | NOTE 4: The \"607 Unwanted\" SIP | | | response code is defined in | | | IETF RFC 8197 [154]. | | | | | | NOTE 5: The 428, 436, 437 and | | | 438 SIP response codes are | | | defined in | | | IETF RFC 8224 [153]. | | +----------------------------------+----------------------------------+
If the O-MGCF supports the PSTN XML body as a network option and if a PSTN XML
body is received within the 4xx/5xx/6xx, the O-MGCF shall map the contained
information into the Access Transport Parameter of the REL as shown in clause
7.2.3.2.9.2.
When a 4xx, 5xx or 6xx SIP response to an INVITE request is received from the
network containing an Error-Info header field, the O-MGCF, supporting the
capabilities associated with the Error-Info header field, may instruct the IM-
MGW to play out media available at the associated URL towards PSTN.
###### 7.2.3.2.12.1 Special handling of 404 Not Found and 484 Address
Incomplete responses after sending of INVITE without determining the end of
address signalling
This clause is only applicable when the network option of Sending of INVITE
without determining the end of address signalling is being used (see clause
7.2.3.2.1.a).
On receipt of a 404 Not Found or 484 Address Incomplete response while Ti/w2
is running, the O-MGCF shall start timer Ti/w3, if there are no other pending
INVITE transactions for the corresponding call.
At the receipt of a SAM, a SIP 18x provisional response or a SIP 200 OK
(INVITE), the O-MGCF shall stop Ti/w2 and Ti/w3.
The O-MGCF shall send a REL message with Cause Value 28 towards the BICC/ISUP
network if Ti/w3 expires.
##### 7.2.3 2.13 Receipt of a BYE
Figure 22: Receipt of BYE method
If a Reason header field with Q.850 Cause Value is included in the BYE
request, then the Cause Value shall be mapped to the ISUP Cause Value field in
the ISUP REL as shown in table 8a (see clause 7.2.3.1.7). Otherwise, the
O-MGCF sends a REL message with Cause Code value 16 (Normal Call Clearing).
If, as a network option, the O-MGCF supports the location header field
parameter as described in IETF RFC 8606 [155], the O-MGCF shall derive the
ISUP cause location from the location parameter in the SIP Reason header field
as shown in table 8c (see subclause 7.2.3.1.7).
If the O-MGCF supports the PSTN XML body as a network option and if a PSTN XML
body is received within the BYE, the O-MGCF shall map the contained
information into the Access Transport Parameter of the REL as shown in clause
7.2.3.2.9.2.
If a Reason header field with SIP status code \"607 (Unwanted)\" (defined in
IETF RFC 8197 [154]) is included in the BYE request, then the O-MGCF shall
send a REL message with the Cause Code value \"21 (Call rejected)\".
##### 7.2.3.2.14 Receipt of the Release Message
In the case that the REL message is received and a final response (i.e. 200 OK
(INVITE)) has already been received the O-MGCF shall send a BYE request. If
the final response (i.e. 200 OK (INVITE)) has not already been received the
O-MGCF shall send a CANCEL method.
A Reason header field containing the received (Q.850) Cause Value of the REL
message shall be added to the CANCEL or BYE request. The mapping of the Cause
Indicators parameter to the Reason header is shown in table 9a (see clause
7.2.3.1.8).
If the O-MGCF supports the PSTN XML body as a network option, the O-MGCF shall
map the contained information into a PSTN XML body within the BYE or CANCEL as
shown in table 9aa.
##### 7.2.3.2.15 Receipt of RSC, GRS or CGB (H/W oriented)
Upon receipt of a RSC, GRS or CGB (H/W oriented) message the following applies
independently for each affected circuit:
NOTE: For the RSC message, the circuit identified by the CIC is affected.\ For
the GRS message, the affected circuits are identified by the CIC and the Range
subfield of the Range and Status parameter.\ For the CGB message, the affected
circuits are identified by the CIC and the Range and Status parameter.
If a final response (i.e. 200 OK (INVITE) has already been received, the
O-MGCF shall send a BYE method. If a final response (i.e. 200 OK (INVITE)) has
not already been received, the O-MGCF shall send a CANCEL method.
A Reason header field containing the (Q.850) Cause Value of the REL message
generated by the ISUP procedures shall be added to the SIP message (BYE or
CANCEL request) to be sent by the SIP side of the O‑MGCF.
##### 7.2.3.2.16 Autonomous Release at O-MGCF
If the O-MGCF determines due to internal procedures that the call shall be
released then the MGCF shall send
\- A BYE method if the ACK has been sent.
\- A CANCEL method before 200 OK (INVITE) has been received.
NOTE: The MGCF shall send the ACK method before it sends the BYE, if 200 OK
(INVITE) is received.
A Reason header field containing the (Q.850) Cause Value of the REL message
sent by the O‑IWU shall be added to the SIP Message (BYE or CANCEL request) to
be sent by the SIP side of the O‑IWU.
Table 18a: Autonomous Release at O-MGCF
+----------------------+----------------------+----------------------+ | REL  | Trigger event |  SIP | | | | | | Cause parameter | | | +----------------------+----------------------+----------------------+ | As determined by | COT received with | CANCEL or BYE | | BICC/ISUP procedure. | the Continuity | according to the | | | Indicators parameter | rules described in | | | set to \"_continuity | this subclause. | | | check failed_ \" | | | | (ISUP only) or the | | | | BICC/ISUP timer T8 | | | | expires. | | +----------------------+----------------------+----------------------+ | REL with cause value | Internal resource | As determined by SIP | | 47 (resource | reservation | procedure | | unavailable, | unsuccessful | | | unspecified). | | | +----------------------+----------------------+----------------------+ | As determined by | BICC/ISUP procedures | CANCEL or BYE | | BICC/ISUP procedure. | result in generation | according to the | | | of autonomous REL on | rules described in | | | BICC/ISUP side. | this subclause. | +----------------------+----------------------+----------------------+ | Depending on the SIP | SIP procedures | As determined by SIP | | release reason. | result in a decision | procedure. | | | to release the call. | | +----------------------+----------------------+----------------------+
##### 7.2.3.2.17 Special handling of 580 precondition failure received in
response to either an INVITE or UPDATE
A 580 Precondition failure response may be received as a response either to an
INVITE or to an UPDATE request.
###### 7.2.3.2.17.1 580 Precondition failure response to an INVITE
Release with cause code as indicated in table 18 is sent immediately to the
BICC/ISUP network.
###### 7.2.3.2.17.2 580 Precondition failure response to an UPDATE within an
early dialog
A BYE request is sent for the early dialog within which the UPDATE was sent.
If all the early dialogs that were generated from the INVITE request have
answered the respective UPDATE request with 580 Precondition failure response
then the O-MGCF shall send the Release message with Cause Code \'127
Interworking\' to the ISUP network.
##### 7.2.3.2.18 Sending of CANCEL
Figure 23: Receipt of COT (failure)
CANCEL shall be sent if the Continuity message is received with the Continuity
Indicators parameter set to \"_continuity check failed_ \" or the ISUP (or
BICC) timer T8 expires.
A Reason header field containing the (Q.850) Cause Value 41 Temporary Failure
shall be added to the CANCEL request to be sent by the SIP side of the O‑MGCF.
##### 7.2.3.2.19 Receipt of SIP redirect (3xx) response
Figure 24: Receipt of SIP response code 3xx
When receiving a SIP response with a response code 3xx, the default behaviour
of the O-MGCF is to release the call with a cause code value 127 (Interworking
unspecified).
NOTE: The O-MGCF may also decide for example to redirect the call towards the
URIs in the Contact header field of the response as an operator option, but
such handling is outside of the scope of the present document.
##### 7.2.3.2.20 Sending of INFO for overlap signalling using the in-dialog
method
###### 7.2.3.2.20.1 General
SIP INFO request (\"legacy\" mode of usage of the INFO method as defined in
IETF RFC 6086 [133]) is used to carry additional digits when overlap
signalling is sent using the in-dialog method as described in clause
7.2.3.2.1a.2, which is a network option. Clause 7.2.3.2.1a.2 also describes
when the O-MGCF sends a SIP INFO request.
###### 7.2.3.2.20.2 Encoding of the INFO
Table 18b provides a summary of how the header fields within the outgoing INFO
messages are populated when in-dialog SIP INFO requests are used for overlap
dialling.
Table 18b: Interworked contents of the INFO message
* * *
SAM→ INFO→ Digits See TS 24.229 [9] clause 7.12.1.2
* * *
#### 7.2.3.3 Timers
Table 19: Timers for interworking
+----------+----------+----------+----------+----------+----------+ | Symbol | Time-out | Cause | Normal | At | R | | | value | for | ter | expiry | eference | | | | in | mination | | | | | | itiation | | | | +----------+----------+----------+----------+----------+----------+ | Ti/w1 | 4 s to 6 | When | At the | Send | 7. | | | s | last | receipt | INVITE, | 2.3.2.1\ | | | (default | address | of fresh | send the | 7. | | | of 4 s) | message | address | address | 2.3.2.4\ | | | | is | info | complete | (NOTE 1) | | | | received | rmation. | message | | | | | and the | | | | | | | minimum | | | | | | | number | | | | | | | of | | | | | | | digits | | | | | | | required | | | | | | | for | | | | | | | routing | | | | | | | the call | | | | | | | have | | | | | | | been | | | | | | | r | | | | | | | eceived. | | | | +----------+----------+----------+----------+----------+----------+ | Ti/w2 | 4 s to | When | On | Send ACM | 7. | | | 20 s | INVITE | r | (no | 2.3.2.4\ | | | (default | is sent | eception | ind | 7 | | | of 4 s) | unless | of 180 | ication) | .2.3.2.1 | | | | the ACM | Ringing | | | | | | has | , or 183 | | (NOTE 2) | | | | already | Session | | | | | | been | Progress | | | | | | sent. | and | | | | | | | P-Ear | | | | | | | ly-Media | | | | | | | header | | | | | | | aut | | | | | | | horizing | | | | | | | backward | | | | | | | early | | | | | | | media, | | | | | | | or 181 | | | | | | | Call is | | | | | | | Being | | | | | | | Fo | | | | | | | rwarded, | | | | | | | or | | | | | | | 404 Not | | | | | | | Found or | | | | | | | 484 | | | | | | | Address | | | | | | | In | | | | | | | complete | | | | | | | for an | | | | | | | INVITE | | | | | | | tra | | | | | | | nsaction | | | | | | | for | | | | | | | which | | | | | | | Ti/w3 is | | | | | | | running, | | | | | | | or 200 | | | | | | | OK | | | | | | | ( | | | | | | | INVITE). | | | +----------+----------+----------+----------+----------+----------+ | Ti/w3 | 4‑6 | On | At the | Send REL | 7.2 | | | seconds | receipt | receipt | with | .3.2.1A, | | | (default | of 404 | of SAM | Cause | 7.2. | | | of 4 | Not | | Value 28 | 3.2.12.1 | | | seconds) | Found or | | to the | | | | | 484 | | B | (NOTE 3) | | | | Address | | ICC/ISUP | | | | | In | | side. | | | | | complete | | | | | | | if there | | | | | | | are no | | | | | | | other | | | | | | | pending | | | | | | | INVITE | | | | | | | tran | | | | | | | sactions | | | | | | | for the | | | | | | | corre | | | | | | | sponding | | | | | | | call. | | | | +----------+----------+----------+----------+----------+----------+ | NOTE 1: | | | | | | | This | | | | | | | timer is | | | | | | | used | | | | | | | when | | | | | | | overlap | | | | | | | si | | | | | | | gnalling | | | | | | | is | | | | | | | received | | | | | | | from | | | | | | | B | | | | | | | ICC/ISUP | | | | | | | network | | | | | | | and | | | | | | | c | | | | | | | onverted | | | | | | | to | | | | | | | en-block | | | | | | | si | | | | | | | gnalling | | | | | | | at the | | | | | | | MGCF. | | | | | | | | | | | | | | NOTE 2: | | | | | | | This | | | | | | | timer is | | | | | | | used to | | | | | | | send an | | | | | | | early | | | | | | | ACM if a | | | | | | | delay is | | | | | | | enc | | | | | | | ountered | | | | | | | in | | | | | | | r | | | | | | | eceiving | | | | | | | a | | | | | | | response | | | | | | | from the | | | | | | | su | | | | | | | bsequent | | | | | | | SIP | | | | | | | network. | | | | | | | | | | | | | | NOTE 3: | | | | | | | This | | | | | | | timer is | | | | | | | known as | | | | | | | the | | | | | | | \"SIP | | | | | | | dialog | | | | | | | pr | | | | | | | otection | | | | | | | timer\". | | | | | | | This | | | | | | | timer is | | | | | | | only | | | | | | | used | | | | | | | where | | | | | | | the | | | | | | | O‑MGCF | | | | | | | is | | | | | | | co | | | | | | | nfigured | | | | | | | to send | | | | | | | INVITE | | | | | | | before | | | | | | | end of | | | | | | | address | | | | | | | si | | | | | | | gnalling | | | | | | | is | | | | | | | det | | | | | | | ermined. | | | | | | +----------+----------+----------+----------+----------+----------+
## 7.3 Interworking between CS networks supporting BICC and the IM CN
subsystem
The control plane between CS networks supporting BICC and the IM CN subsystem
supporting SIP, where the underlying network is SS7 and IP respectively is as
shown in figures 25, 26 and 27.
Figure 25: Control Plane interworking between CS networks supporting BICC over
MTP3 and the IM CN subsystem
Figure 26: Control Plane interworking between CS networks supporting BICC over
MTP3B over AAL5 and the IM CN subsystem
Figure 27: Control Plane interworking between CS networks supporting BICC\
over STC and M3UA and the IM CN subsystem
### 7.3.1 Services performed by network entities in the control plane
Services offered by the network entities in the control plane are as detailed
in clause 7.2.1.
If ATM transport is applied between the SS7 Signalling function and the
Signalling Gateway Function, they shall apply MTP3B (ITU-T Recommendation
Q.2210 [46]) over SSCF (ITU-T Recommendation Q.2140 [45]) over SSCOP (ITU-T
Recommendation Q.2110 [44]) over AAL5 (ITU-T Recommendation I.363.5 [43]) as
depicted in figure 26.
If IP transport is applied between the SS7 Signalling function and the MGCF,
they shall support and apply M3UA, SCTP and IP (either Ipv4, see RFC 791 [16],
or Ipv6, see RFC 2460 [39]), as depicted in figure 27.
### 7.3.2 Signalling interactions between network entities in the control
plane
#### 7.3.2.1 Signalling between the SS7 signalling function and MGCF
See clause 7.2.2.1.
##### 7.3.2.1.1 Signalling from MGCF to SS7 signalling function
See clause 7.2.2.1.1.
##### 7.3.2.1.2 Signalling from SS7 signalling function to MGCF
See clause 7.2.2.1.2.
##### 7.3.2.1.3 Services offered by STC, SCTP and M3UA
See clause 7.2.2.1.3.
###### 7.3.2.1.3.1 Services offer by SCTP
See clause 7.2.2.1.3.1.
###### 7.3.2.1.3.2 Services offered by M3UA
See clause 7.2.2.1.3.2.
###### 7.3.2.1.3.3 Services offered by STC
STC provides the services for the transparent transfer of STC user
information, e.g. BICC, between STC users, i.e. the SS7 signalling function
and the MGCF (see 3GPP TS 29.205 [14]).
STC performs the functions of data transfer service availability reporting and
congestion reporting to the STC user and User part availability control. See
ITU-T Recommendation Q.2150.1 [29].
#### 7.3.2.2 Signalling between the MGCF and SIP signalling function
See clause 7.2.2.2.
### 7.3.3 SIP-BICC protocol interworking
#### 7.3.3.1 Incoming call interworking from SIP to BICC at I-MGCF
##### 7.3.3.1.1 Sending of IAM
Clause 7.2.3.1.1 is applicable with the clarification that the Continuity
Check procedure applies.
Figure 28: Void
##### 7.3.3.1.2 Coding of IAM
The description of the following ISDN user part parameters can be found in
ITU-T Recommendation Q.763 [4].
###### 7.3.3.1.2.1 Called party number
See clause 7.2.3.1.2.1.
###### 7.3.3.1.2.2 Nature of connection indicators
bits [BA]{.underline} Satellite indicator
0 0 _no satellite circuit in the connection_
bits [DC]{.underline} Continuity indicator (BICC)
0 0 _no COT to be expected_ , if the received SDP does not contain
precondition information or indicates that all preconditions are fulfilled,
and all local resource reservation is completed.
1 0 _COT to be expected_ , if the received SDP indicates that precondition is
not fulfilled or any local resource reservation is not completed.
Bit [E]{.underline} Echo control device indicator
1 _outgoing echo control device included_
###### 7.3.3.1.2.3 Forward call indicators
See clause 7.2.3.1.2.3.
###### 7.3.3.1.2.4 Calling party\'s category
See clause 7.2.3.1.2.4.
###### 7.3.3.1.2.4A Originating Line Information
See clause 7.2.3.1.2.4A
###### 7.3.3.1.2.5 Transmission medium requirement
See clause 7.2.3.1.2.5.
###### 7.3.3.1.2.6 Calling party number
See clause 7.2.3.1.2.6.
###### 7.3.3.1.2.7 Generic number
See clause 7.2.3.1.2.7.
###### 7.3.3.1.2.8 User service information
See clause 7.2.3.1.2.8.
###### 7.3.3.1.2.9 Hop counter (National option)
See clause 7.2.3.1.2.9.
###### 7.3.3.1.2.10 Location Number
See clause 7.2.3.1.2.11.
###### 7.3.3.1.2.11 Support of ICS call
See clause 7.2.3.1.2.12.
###### 7.3.3.1.2.12 UID capability indicators (National option)
See clause 7.2.3.1.2.13.
##### 7.3.3.1.2A Coding of the IAM when Number Portability is supported
See clause 7.2.3.1.2A.
##### 7.3.3.1.2B Coding of the IAM for Carrier Routeing
See clause 7.2.3.1.2B.
###### 7.3.3.1.2.13 Called IN number and original called IN number (optional)
See clause 7.2.3.1.2.14.
##### 7.3.3.1.3 Sending of COT
Figure 29: Sending of COT
If the IAM has already been sent, then the Continuity message shall be sent
indicating \"continuity check successful\", when all of the following
conditions have been met.
\- When the requested remote preconditions (if any) in the IMS have been met.
\- The media stream previously set to inactive mode is set to active (as
specified in IETF RFC 4566 [56]).
\- Local preconditions have been fulfilled.
##### 7.3.3.1.3A Sending of SAM
See clause 7.2.3.1.3A.
##### 7.3.3.1.4 Sending of 180 Ringing
See clause 7.2.3.1.4.
##### 7.3.3.1.4A Sending of 183 Session Progress for early media scenarios
See clause 7.2.3.1.4A.
##### 7.3.3.1.4B Sending of 181 Call is being forwarded
See clause 7.2.3.1.4B.
##### 7.3.3.1.4C Sending of 183 Session Progress for overlap signalling using
the in-dialog method
See clause 7.2.3.1.4C.
NOTE: If the network option of overlap signalling using the in-dialog method
is applied at the I-MGCF in combination with the optional codec negotiation
interworking with BICC in clause B.2., in order to meet the requirement in
clause B.2.1 that the I-MGCF suspends the SDP answer procedure until it
receives backward codec information from BICC, the 183 session progress
response will not contain the SDP answer.
##### 7.3.3.1.4D Sending of 183 Session Progress to carry ISUP Cause
See clause 7.2.3.1.4D.
##### 7.3.3.1.4E Sending of 183 Session Progress for ICS call
See clause 7.2.3.1.4E.
##### 7.3.3.1.5 Sending of the 200 OK (INVITE)
See clause 7.2.3.1.5.
##### 7.3.3.1.6 Sending of the Release message (REL)
See clause 7.2.3.1.6.
##### 7.3.3.1.7 Coding of the REL
See clause 7.2.3.1.7.
##### 7.3.3.1.8 Receipt of the Release Message
See clause 7.2.3.1.8.
##### 7.3.3.1.9 Receipt of RSC, GRS or CGB (H/W oriented)
See clause 7.2.3.1.9.
##### 7.3.3.1.9a Receipt of REFER
See clause 7.2.3.1.9a.
##### 7.3.3.1.9b Autonomous Release at I-MGCF
See clause 7.2.3.1.10.
##### 7.3.3.1.10 Internal through connection of the bearer path
The through connection procedure is described in clauses 9.2.2.1.5 and
9.2.2.2.5.
##### 7.3.3.1.11 Out of Band DTMF
If a SIP UA sends DTMF tones to the IM-MGW, the IM-MGW may report this
information via the Mn interface to the MGCF. The MGCF shall send to the BICC
network the APM message with the following values for the different
parameters:
\- Action indicator in accordance with the requested DTMF transport function;
\- Signal in accordance with which DTMF digit to send;
\- Duration in accordance with the required duration of the DTMF digit.
If the BICC network sends an APM message with DTMF signal, duration and action
indicator to the MGCF, the MGCF may send this information to the IM-MGW via
the Mn interface. The IM-MGW shall send the corresponding DTMF signal and
duration information on the user plane of the IM CN subsystem according to RFC
4733 [105].
The interactions with the IM-MGW are shown in clause 9.2.8.
#### 7.3.3.2 Outgoing Call Interworking from BICC to SIP at O-MGCF
##### 7.3.3.2.1 Sending of INVITE
The following particularities apply for a BICC IAM received case, with regard
to the already specified in clause 7.2.3.2.1.
The O-MGCF should defer sending the INVITE request until the BICC bearer setup
and any local resource reservation is completed.
NOTE: If the O-MGCF sends the INVITE request before the BICC bearer setup and
any local resource reservation is completed, the following considerations
apply: If the receiving terminal is not supporting the SIP precondition,
clipping may occur. Furthermore, if the MGCF sets the SDP \"inactive\"
attribute in the initial INVITE request and the receiving terminal is not
supporting the SIP precondition and the SIP UPDATE method, the interworking
procedures within the present specification do not describe all necessary
signalling interactions required to set up a call, in particular with respect
to the sending of the re-INVITE that may also cause additional delay in the
call setup. In addition, the interworking of the ringing indication might not
be possible if the peer sends the ringing indication only as response to a re-
INVITE.
The BICC bearer setup is completed when one of the following conditions is
met:
\- The event Bearer Set-up indication - for the forward bearer set-up case
where the incoming Connect Type is \"notification not required\", which
indicate successful completion of bearer set-up, is received by the Incoming
bearer set-up procedure (ITU-T Recommendation Q.1902.4 [30] clause 7.5);
\- Bearer Set-up Connect indication for the backward call set-up case, which
indicate successful completion of bearer set-up, is received by the Incoming
bearer set-up procedure (ITU-T Recommendation Q.1902.4 [30] clause 7.5);
\- BNC set-up success indication for cases using bearer control tunnelling
which indicate successful completion of bearer set-up, is received by the
Incoming bearer set-up procedure (ITU-T Recommendation Q.1902.4 [30] clause
7.5).
##### 7.3.3.2.1a Sending of INVITE without determining the end of address
signalling
See clause 7.2.3.2.1a.
##### 7.3.3.2.2 Coding of the INVITE
###### 7.3.3.2.2.1 Request-URI and To header field
See clause 7.2.3.2.2.1
###### 7.3.3.2.2.2 SDP Media Description
If the O-MGCF sends the INVITE request without waiting for the BICC bearer
setup and any local resource reservation to complete, (which is not
recommended according to clause 7.3.3.2.1) it shall indicate that SIP
preconditions are not met when the initial INVITE request indicates support of
the SIP preconditions.
The O-MGCF shall include the AMR codec transported according to IETF RFC 4867
[23] with the options listed in clause 12.3.1of 3GPP TS 26.114 [104] in the
SDP offer. Within the SDP offer, the O-MGCF should also provide SDP RR and RS
bandwidth modifiers specified in IETF RFC 3556 [59] as detailed in clause
7.3.1 of 3GPP TS 26.114 [104].
###### 7.3.3.2.2.3 P-Asserted-Identity and privacy header fields
See clause 7.2.3.2.2.3
###### 7.3.3.2.2.3A \"cpc\" URI Parameter in P-Asserted-Identity Header
See clause 7.2.3.2.2.3A.
###### 7.3.3.2.2.3B \"oli\" URI Parameter in P-Asserted-Identity Header
See clause 7.2.3.2.2.3B.
###### 7.3.3.2.2.4 Max Forwards header
See clause 7.2.3.2.2.4
###### 7.3.3.2.2.5 IMS Communication Service Identifier
For speech and video calls, the O-MGCF shall insert an IMS Communication
Service Identifier, indicating the IMS Multimedia Telephony Communication
Service.
The IMS Communication Service Identifier for the IMS Multimedia Telephony
Communication Service is defined in 3GPP TS 24.173 [88].
###### 7.3.3.2.2.6 P-Access-Network-Info
See clause 7.2.3.2.2.9.
##### 7.3.3.2.2A Coding of the INVITE when number portability is supported
See clause 7.2.3.2.2A.
##### 7.3.3.2.2B Coding of the INVITE for Carrier Routeing
See clause 7.2.3.2.2B.
##### 7.3.3.2.2C Coding of INVITE with instance-id in form of IMEI URN
See clause 7.2.3.2.2C.
###### 7.3.3.2.2.7 PSAP Call-back indication
See clause 7.2.3.2.2.10.
###### 7.3.3.2.2.8 History-Info header field (optional)
See clause 7.2.3.2.2.11.
##### 7.3.3.2.3 Sending of UPDATE
This clause only applies if the O-MGCF sends the INVITE request before SIP
preconditions are met (see clause 7.3.3.2.1).
Figure 30: Receipt of COT (success)
The UPDATE request with a new SDP offer shall be sent for each early SIP
dialogue for which the received provisional response indicated support of
preconditions confirming that all the required local preconditions have been
met when all the following conditions are met.
1\. A Continuity message, with the Continuity Indicators parameter set to
\"continuity check successful\" shall be received.
2\. The reservation of requested local resources has been completed.
In addition, depending on which bearer set-up procedure used for the call one
of the following condition shall be met:
\- The event Bearer Set-up indication - for the forward bearer set-up case
where the incoming Connect Type is \"notification not required\", which
indicate successful completion of bearer set-up, is received by the Incoming
bearer set-up procedure (ITU-T Recommendation Q.1902.4 [30] clause 7.5);
\- Bearer Set-up Connect indication for the backward call set-up case, which
indicate successful completion of bearer set-up, is received by the Incoming
bearer set-up procedure (ITU-T Recommendation Q.1902.4 [30] clause 7.5);
\- BNC set-up success indication for cases using bearer control tunnelling
which indicate successful completion of bearer set-up, is received by the
Incoming bearer set-up procedure, (ITU-T Recommendation Q.1902.4 [30] clause
7.5).
NOTE: This procedure applies regardless of whether the early SIP dialog
existed prior to the preconditions being fulfilled or is subsequently created.
##### 7.3.3.2.4 Sending of ACM and Awaiting Answer indication
See clause 7.2.3.2.4
The sending of an awaiting answer indication is described in clause 9.2.3.1.
and clause 9.2.3.2.
##### 7.3.3.2.5 Coding of the ACM
###### 7.3.3.2.5.1 Backward call indicators
See clause 7.2.3.2.5.1
##### 7.3.3.2.6 Sending of the Call Progress message (CPG)
See clause 7.2.3.2.6.
##### 7.3.3.2.7 Coding of the CPG
###### 7.3.3.2.7.1 Event information
See clause 7.2.3.2.7.1.
###### 7.3.3.2.7.2 Optional Backward call indicators
See clause 7.2.3.2.7.5.
##### 7.3.3.2.7a Receipt of 200 OK (INVITE)
See clause 7.2.3.2.7a.
##### 7.3.3.2.7b Internal through connection of the bearer path
The through connection procedure is described in clauses 9.2.3.1.7 and
9.2.3.2.7.
##### 7.3.3.2.8 Sending of the Answer Message (ANM)
See clause 7.2.3.2.8.
##### 7.3.3.2.9 Coding of the ANM
See clause 7.2.3.2.9.
##### 7.3.3.2.10 Sending of the Connect message (CON)
See clause 7.2.3.2.10.
##### 7.3.3.2.11 Coding of the CON
See clause 7.2.3.2.11.
###### 7.3.3.2.11.1 Void
##### 7.3.3.2.11A Receipt of re-INVITE requests
See clause 7.2.3.2.11A.
##### 7.3.3.2.12 Receipt of Status Codes 4xx, 5xx or 6xx
See clause 7.2.3.2.12.
##### 7.3 3.2.13 Receipt of a BYE
See clause 7.2.3.2.13.
##### 7.3.3.2.14 Receipt of the Release Message
See clause 7.2.3.2.14.
##### 7.3.3.2.15 Receipt of RSC, GRS or CGB (H/W oriented)
See clause 7.2.3.2.15.
##### 7.3.3.2.16 Out of Band DTMF
If a SIP UA sends DTMF tones to the IM-MGW, the IM-MGW may report this
information via the Mn interface to the MGCF. The MGCF shall send to the BICC
network the APM message with the following values for the different
parameters:
\- Action indicator in accordance with the requested DTMF transport function;
\- Signal in accordance with which DTMF digit to send;
\- Duration in accordance with the required duration of the DTMF digit.
If the BICC network sends an APM message with DTMF signal, duration and action
indicator to the MGCF, the MGCF may send this information to the IM-MGW via
the Mn interface. The IM-MGW shall send the corresponding DTMF signal and
duration information on the user plane of the IM CN subsystem according to
4733 [105].
The interaction with the IM-MGW is shown in clause 9.2.8.
##### 7.3.3.2.17 Sending of CANCEL
See clause 7.2.3.2.18.
##### 7.3.3.2.18 Autonomous Release at O-MGCF
See clause 7.2.3.2.16.
##### 7.3.3.2.19 Special handling of 580 precondition failure received in
response to either an INVITE or UPDATE
See clause 7.2.3.2.17.
##### 7.3.3.2.20 Receipt of SIP redirect (3xx) response
See clause 7.2.3.2.19.
##### 7.3.3.2.21 Sending of INFO for overlap signalling using the in-dialog
method
See clause 7.2.3.2.20.
#### 7.3.3.3 Timers
See clause 7.2.3.3.
## 7.4 Supplementary Services
The following clauses describe the MGCF behaviour related to supplementary
services as defined in ITU-T Recommendations Q.730 to ITU-T Q.737 [42] when
interworking with an IMS which does not use a Multimedia Telephony Application
Server (MTAS) providing supplementary services according to 3GPP according to
3GPP TS 24.173 [88]. The support of these supplementary services is optional.
If the supplementary services are supported, the procedures described within
this clause shall be applied.
### 7.4.1 Calling line identification presentation/restriction (CLIP/CLIR)
The inter working between the Calling Party Number parameter and the
P-Asserted-Identity header field and vice versa used for the CLIP-CLIR service
is defined in the clauses 7.2.3.1.2.6 and 7.2.3.2.2.3. This inter working is
essentially the same as for basic call and differs only in that if the CLIR
service is invoked the \"Address Presentation Restriction Indicator (APRI)\"
(in the case of ISUP to SIP calls) or the \"priv value\" of the \"calling\"
Privacy header field (in the case of SIP to ISUP calls) is set to the
appropriate \"restriction/privacy\" value.
In the specific case of ISUP originated calls, use of the CLIP service
additionally requires the ability to determine whether the number was network
provided or provided by the access signalling system. Due to the possible SIP
indication of the P-Asserted-Identity header field the Screening indicator is
set to network provided as default. For the CLIP-CLIR service the mapping of
the APRI from privacy header at the O-MGCF is described within table 16 in
clause 7.2.3.2.2.3.
At the O-MGCF the presentation restricted indication shall be mapped to the
Privacy header field values \"id\" and \"header\". This is described in table
12 in clause 7.2.3.2.2.3.
### 7.4.2 Connected line presentation and restriction (COLP/COLR)
#### 7.4.2.0 General
The COLP/COLR services are only to be interworked between trusted nodes \-
that is before passing any COLP/COLR information over the SIP-BICC/ISUP
boundary the MGCF shall satisfy itself that the nodes on the BICC/ISUP side to
which the information is to be passed are trusted.
The procedure within clause 7.5.2 for the generic number (\"additional
connected number\") mapping shall apply.
#### 7.4.2.1 Incoming Call Interworking from SIP to BICC/ISUP at the I-MGCF
##### 7.4.2.1.1 INVITE to IAM interworking (SIP to ISUP/BICC calls)
In the case of SIP to ISUP/BICC calls the I-MGCF may invoke the COLP service
as an operator option by setting the \"Connected Line Identity Request
indicator\" field of the \"Optional forward call indicators\" parameter of the
IAM to \"requested\".
NOTE: This implies that all outgoing calls will invoke the COLP service.
##### 7.4.2.1.2 ANM/CON to 200 OK (INVITE)
Tables 20 and 21 specify the interworking required in the case when the COLP
has been automatically requested on behalf of the originating SIP node. The
table also indicates the inter workings required if the COLP service has been
invoked and the called party has or has not invoked the COLR service.
Table 20: Mapping to P-Asserted-Identity and Privacy Header Fields
* * *
SIP Component Setting P-Asserted-Identity See table 21 Privacy See table 22
* * *
Table 21: Mapping of connected number parameter to SIP P-Asserted-Identity
header fields
+----------------+----------------+----------------+----------------+ | BICC/ISUP | Value | SIP component | Value | | parameter / | | | | | field | | | | +----------------+----------------+----------------+----------------+ | Connected | | P-Ass | | | Number | | erted-Identity | | | | | header field | | +----------------+----------------+----------------+----------------+ | Nature of | \"_national | Tel URI or SIP | Add CC (of the | | Address | (significant) | URI | country where | | Indicator | number_ \" | | the MGCF is | | | | (NOTE 1) | located) to | | | | | Connected PN | | | | | address | | | | | signals to | | | | | construct | | | | | E.164 number | | | | | in URI. Prefix | | | | | number with | | | | | \"+\". | +----------------+----------------+----------------+----------------+ | | \" | | Map complete | | | _international | | Connected | | | number_ \" | | address | | | | | signals to | | | | | construct | | | | | E.164 number | | | | | in URI. Prefix | | | | | number with | | | | | \"+\". | +----------------+----------------+----------------+----------------+ | Address signal | If NOA is | Tel URI or SIP | CC+NDC+SN as | | | \"_national | URI | E.164 number | | | (significant) | | in URI. Prefix | | | number\"_ then | (NOTE 1) | number with | | | the format of | | \"+\". | | | the address | | | | | signals is: | | | | | | | | | | NDC + SN | | | | | | | | | | If NOA is | | | | | \" | | | | | _international | | | | | number\"_ | | | | | | | | | | then the | | | | | format of the | | | | | address | | | | | signals is: | | | | | | | | | | CC + NDC + SN | | | +----------------+----------------+----------------+----------------+ | NOTE 1: A tel | | | | | URI or a SIP | | | | | URI with | | | | | \"user=phone\" | | | | | is used | | | | | according to | | | | | operator | | | | | policy. | | | | +----------------+----------------+----------------+----------------+
Table 22: Mapping of BICC/ISUP APRIs into SIP privacy header fields
+----------------+----------------+----------------+----------------+ | BICC/ISUP | Value | SIP component | Value | | parameter / | | | | | field | | | | +----------------+----------------+----------------+----------------+ | Connected | | Privacy header | priv-value | | Number | | field | | +----------------+----------------+----------------+----------------+ | APRI | * | Priv-value | \"id\" | | | \"presentation | | | | (See to | restricted\"_| | (\"id\" | | determine | | | included only | | which APRI to | | | if the | | use for this | | | P-Ass | | mapping) | | | erted-Identity | | | | | header is | | | | | included in | | | | | the SIP | | | | | INVITE) | +----------------+----------------+----------------+----------------+ | | \ | Priv-value | omit Privacy | | | "_ presentation | | header | | | allowed\"* | | | | | | | or Privacy | | | | | header without | | | | | \"id\" and | | | | | \"header\" if | | | | | other privacy | | | | | service is | | | | | needed | +----------------+----------------+----------------+----------------+
#### 7.4.2.2 Outgoing Call Interworking from BICC/ISUP to SIP at O-MGCF
##### 7.4.2.2.1 IAM to INVITE interworking (ISUP to SIP calls)
The O-MGCF determines that the COLP service has been requested by the calling
party by parsing the \"Optional Forward Call Indicators\" field of the
incoming IAM. If the \"Connected Line Identity Request indicator\" is set to
\"requested\" then the BICC/ISUP to SIP interworking node shall ensure that
any backwards \"connected party\" information is interworked to the
appropriate parameters of the ISUP ANM or CON message sent backwards to the
calling party as detailed within this subclause.
The O-MGCF has to store the status of the \"Connected Line Identity Request
indicator\".
##### 7.4.2.2.2 18x to ANM or CON interworking
If the P-Asserted-Identity header field is included within a 18x SIP response,
the identity shall be stored within the O-MGCF together with information about
the SIP dialogue of the 18x SIP response and shall be included within the ANM
or CON message if required by the procedures described in clause 7.4.2.2.3. In
accordance with ISUP procedures, a connected number shall not be included
within the ACM message. The mapping of the of the P-Asserted-Identity and
Privacy header fields is shown in tables 23 and 24.
##### 7.4.2.2.3 200 OK (INVITE) to ANM/CON interworking
Tables 23 and 24 specify the interworking required in the case when the
calling party has invoked the COLP service. The tables also indicate the
interworking procedures required if the calling party has invoked the COLP
service and the called party has or has not invoked the COLR service.
If no P-Asserted-Identity header field is provided within the 200 OK (INVITE)
message, the stored information previously received in the last provisional
18x response of the same SIP dialogue shall be used.
NOTE: Due to forking, other P-Asserted-Identities might have been received in
different SIP dialogues.
If the Calling Party has requested the COLP service (as indicated by the
stored request status) but the 200 OK (INVITE) and previous 18x provisional
responses do not include a P-Asserted-Identity header field, the O-MGCF shall
set up a network provided Connected Number with an Address not Available
indication.
If the P-Asserted-Identity is available then the Connected number has to be
setup with the screening indication network provided. The mapping of the
P-Asserted-Identity and Privacy (if available) is shown in table 24.
Table 23: Connected number parameter mapping
* * *
 ANM/CON  200 OK INVITE Connected Number (Network Provided) P-Asserted-
Identity Address Presentation Restricted Indicator Privacy
* * *
Table 24: Mapping of P-Asserted-Identity and privacy headers to the ISUP/BICC
connected number parameter
+----------------+----------------+----------------+----------------+ | SIP component | Value | BICC/ISUP | Value | | | | parameter / | | | | | field | | +----------------+----------------+----------------+----------------+ | P-Ass | E.164 number | Connected | | | erted-Identity | | Number | | | header field | | | | | (NOTE) | | | | +----------------+----------------+----------------+----------------+ | | Number | \"Complete\" | | | | incomplete | | | | | indicator | | | +----------------+----------------+----------------+----------------+ | | Numbering Plan | \" | | | | Indicator | ISDN/Telephony | | | | | (E.164)\" | | +----------------+----------------+----------------+----------------+ | | Nature of | If CC encoded | | | | Address | in the URI is | | | | Indicator | equal to the | | | | | CC of the | | | | | country where | | | | | MGCF is | | | | | located AND | | | | | the next | | | | | BICC/ISUP node | | | | | is located in | | | | | the same | | | | | country then | | | | | | | | | | set to | | | | | \"national | | | | | (significant) | | | | | number\" | | | | | | | | | | else set to | | | | | \ | | | | | "international | | | | | number\" | | +----------------+----------------+----------------+----------------+ | | Address | Depends on | | | | Presentation | priv-value in | | | | Restricted | Privacy | | | | Indicator | header. | | | | (APRI) | | | +----------------+----------------+----------------+----------------+ | | Screening | Network | | | | indicator | Provided | | +----------------+----------------+----------------+----------------+ | Addr-spec | \"CC\" \"NDC\" | Address signal | if NOA is | | | \"SN\" from | | \"national | | | the URI | | (significant) | | | | | number\" then | | | | | set to \"NDC\" | | | | | + \"SN\". | | | | | | | | | | If NOA is | | | | | \ | | | | | "international | | | | | number\" | | | | | | | | | | then set to | | | | | \"CC\"+\ | | | | | "NDC\"+\"SN\". | +----------------+----------------+----------------+----------------+ | Privacy header | | APRI | Presentation | | field is not | | | allowed | | present | | | | +----------------+----------------+----------------+----------------+ | Privacy header | priv-value | APRI | \"Address | | field | | | Presentation | | | | | Restricted | | | | | Indicator\" | +----------------+----------------+----------------+----------------+ | priv-value | \"header\" | APRI | Presentation | | | | | restricted | +----------------+----------------+----------------+----------------+ | | \"user\" | APRI | Presentation | | | | | restricted | +----------------+----------------+----------------+----------------+ | | \"none\" | APRI | Presentation | | | | | allowed | +----------------+----------------+----------------+----------------+ | | \"id\" | APRI | Presentation | | | | | restricted | +----------------+----------------+----------------+----------------+ | NOTE: It is | | | | | possible that | | | | | a | | | | | P-Ass | | | | | erted-Identity | | | | | header field | | | | | includes both | | | | | a tel URI and | | | | | a SIP URI. In | | | | | this case, | | | | | either the tel | | | | | URI or the SIP | | | | | URI with | | | | | user=\"phone\" | | | | | and a specific | | | | | host portion, | | | | | as selected by | | | | | operator | | | | | policy, may be | | | | | used. | | | | +----------------+----------------+----------------+----------------+
### 7.4.3 Direct Dialling In (DDI)
A direct dialling in call is a basic call and no additional treatment is
required by the MGCF.
### 7.4.4 Malicious call identification
The actions of the MGCF at the ISUP/BICC side are described in ITU-T
Recommendation Q.731.7 [42] under the clause \"Interactions with other
networks\".
### 7.4.5 Subaddressing (SUB)
#### 7.4.5.1 General
The ISDN subaddress **information** in ISUP is transported within the Access
Transport Parameter. The coding of the subaddress parameter within the Access
Transport Parameter is described within ETSI EN 300 403‑1 [96]. The isdn-
subaddress parameter **\"isub\"** carried within a tel or SIP URI is defined
within IETF RFC 3966 [97]. The isdn-subaddress encoding type parameter
**\"isub-encoding\"** carried within a tel or SIP URI is defined within IETF
RFC 4715 [108] and extended within 3GPP TS 24.229 [9].
#### 7.4.5.2 Interworking at I-MGCF
The mapping in table 24ba of the isdn-subaddress parameter received within a
tel or SIP URI of the initial INVITE request to the ISUP Access Transport
Parameter encapsulating the subaddress **information** (calling party
subaddress and/or c**alled party subaddress information elements**) to be sent
within the IAM message shall be applied.
The mapping in table 24bb of the subaddress **information** (connected
subaddress information element) received within an ANM message or a CON
message containing the ISUP Access Transport Parameter to the isdn-subaddress
parameters **\"isub\" and \"isub-encoding\"** of a tel or SIP URI to be sent
within a 200 OK (INVITE) shall be applied.
Table 24ba: Mapping of the isdn-subaddress received in an initial INVITE to
the subaddress information sent in the IAM
+----------+----------+----------+----------+----------+----------+ | SIP | ISUP | | | | | | Message | Message | | | | | | INVITE | IAM | | | | | +----------+----------+----------+----------+----------+----------+ | Source | Source | ISUP | Derived | | | | SIP | c | P | value of | | | | header | omponent | arameter | p | | | | field | value | field | arameter | | | | and | | | field | | | | c | | | | | | | omponent | | | | | | +----------+----------+----------+----------+----------+----------+ | To | \ | isub- | Access | called | Type of | | header | "isub=\" | encoding | T | party | su | | field | 1*uric\ | not | ransport | su | baddress | | i | \ | present | P | baddress | = | | ncluding | \"uric\" | | arameter | | \"NSAP\" | | the | co | | | | (000) | | isdn-su | ntaining | | | | | | baddress | the | | | | | | | su | | | | | | (NOTE 1) | baddress | | | | | | | digits | | | | | +----------+----------+----------+----------+----------+----------+ | | | \" | | | | | | | isub-enc | | | | | | | oding=ns | | | | | | | ap-ia5\" | | | | +----------+----------+----------+----------+----------+----------+ | | | \" | | | Type of | | | | isub-enc | | | su | | | | oding=ns | | | baddress | | | | ap-bcd\" | | | = | | | | | | | \"NSAP\" | | | | | | | (000) | +----------+----------+----------+----------+----------+----------+ | | | \"isub | | | Type of | | | | -encodin | | | su | | | | g=nsap\" | | | baddress | | | | | | | = | | | | | | | \"NSAP\" | | | | | | | (000) | +----------+----------+----------+----------+----------+----------+ | | | \"isub-e | | | Type of | | | | ncoding= | | | su | | | | user-spe | | | baddress | | | | cified\" | | | = \"user | | | | (NOTE 2) | | | spe | | | | | | | cified\" | | | | | | | (010) | | | | | | | (NOTE 2) | +----------+----------+----------+----------+----------+----------+ | | \ | No | | | | | | "isub=\" | mapping | | | | | | 1*uric | | | | | | | ( | | | | | | | \"uric\" | | | | | | | co | | | | | | | ntaining | | | | | | | the | | | | | | | su | | | | | | | baddress | | | | | | | digits) | | | | | | | and | | | | | | | isub- | | | | | | | encoding | | | | | | | does not | | | | | | | contain | | | | | | | \"ns | | | | | | | ap-ia5\" | | | | | | | or | | | | | | | \"ns | | | | | | | ap-bcd\" | | | | | | | or | | | | | | | \"nsap\" | | | | | | | or | | | | | | | \" | | | | | | | user-spe | | | | | | | cified\" | | | | | | | value | | | | | | | (NOTE 2) | | | | | +----------+----------+----------+----------+----------+----------+ | P-A | \" | isub- | Access | calling | Type of | | sserted- | ;isub=\" | encoding | T | party | su | | Identity | 1*uric | not | ransport | su | baddress | | header | | present | P | baddress | = | | Field | \"uric\" | | arameter | | \"NSAP\" | | | co | | | | (000) | | i | ntaining | | | | | | ncluding | the | | | | | | the | su | | | | | | isdn-su | baddress | | | | | | baddress | digits | | | | | +----------+----------+----------+----------+----------+----------+ | | | \" | | | | | | | isub-enc | | | | | | | oding=ns | | | | | | | ap-ia5\" | | | | +----------+----------+----------+----------+----------+----------+ | | | \" | | | Type of | | | | isub-enc | | | su | | | | oding=ns | | | baddress | | | | ap-bcd\" | | | = | | | | | | | \"NSAP\" | | | | | | | (000) | +----------+----------+----------+----------+----------+----------+ | | | \"isub | | | Type of | | | | -encodin | | | su | | | | g=nsap\" | | | baddress | | | | | | | = | | | | | | | \"NSAP\" | | | | | | | (000) | +----------+----------+----------+----------+----------+----------+ | | | \"isub-e | | | Type of | | | | ncoding= | | | su | | | | user-spe | | | baddress | | | | cified\" | | | = \"user | | | | (NOTE 2) | | | spe | | | | | | | cified\" | | | | | | | (010) | | | | | | | (NOTE 2) | +----------+----------+----------+----------+----------+----------+ | | \ | No | | | | | | "isub=\" | mapping | | | | | | 1*uric | | | | | | | ( | | | | | | | \"uric\" | | | | | | | co | | | | | | | ntaining | | | | | | | the | | | | | | | su | | | | | | | baddress | | | | | | | digits) | | | | | | | and | | | | | | | isub- | | | | | | | encoding | | | | | | | does not | | | | | | | contain | | | | | | | \"n | | | | | | | sap-ia5" | | | | | | | or | | | | | | | "n | | | | | | | sap-bcd" | | | | | | | or | | | | | | | \"nsap\" | | | | | | | or | | | | | | | \" | | | | | | | user-spe | | | | | | | cified\" | | | | | | | value | | | | | | | (NOTE 2) | | | | | +----------+----------+----------+----------+----------+----------+ | NOTE 1: | | | | | | | As an | | | | | | | operator | | | | | | | option, | | | | | | | an | | | | | | | isdn-su | | | | | | | baddress | | | | | | | within | | | | | | | the | | | | | | | Req | | | | | | | uest-URI | | | | | | | may also | | | | | | | be | | | | | | | mapped | | | | | | | into the | | | | | | | ISUP | | | | | | | Access | | | | | | | T | | | | | | | ransport | | | | | | | pa | | | | | | | rameter. | | | | | | | | | | | | | | NOTE 2: | | | | | | | The | | | | | | | inte | | | | | | | rworking | | | | | | | between | | | | | | | \" | | | | | | | user-spe | | | | | | | cified\" | | | | | | | encod | | | | | | | ing-type | | | | | | | p | | | | | | | arameter | | | | | | | and | | | | | | | \" | | | | | | | user-spe | | | | | | | cified\" | | | | | | | type of | | | | | | | su | | | | | | | baddress | | | | | | | is an | | | | | | | operator | | | | | | | option. | | | | | | +----------+----------+----------+----------+----------+----------+
Table 24bb: Mapping of the subaddress information received in an ANM or CON to
the isdn subaddress sent in the 200 OK (INVITE)
+----------------+----------------+----------------+----------------+ | ISUP Message | SIP Message | | | | ANM or CON | 200 (OK) | | | +----------------+----------------+----------------+----------------+ | ISUP Parameter | Source | Source SIP | Derived value | | field | component | header field | of parameter | | | value | and component | field | +----------------+----------------+----------------+----------------+ | Access | connected | P-Ass | \";isub=\" | | Transport | subaddress and | erted-Identity | 1*uric and | | Parameter | Type of | including the | \"isub-encod | | | subaddress = | i | ing=nsap-ia5\" | | | \"NSAP\" (000) | sdn-subaddress | | | | | | The subaddress | | | | | digits | | | | | included into | | | | | the \"uric\" | | | | | shall be | | | | | derived from | | | | | the Access | | | | | Transport | | | | | Parameter. | +----------------+----------------+----------------+----------------+ | | connected | | \";isub=\" | | | subaddress and | | 1*uric and | | | Type of | | \"is | | | subaddress = | | ub-encoding=us | | | \"user | | er-specified\" | | | specified\" | | | | | (010) (NOTE) | | The subaddress | | | | | digits | | | | | included into | | | | | the \"uric\" | | | | | shall be | | | | | derived from | | | | | the Access | | | | | Transport | | | | | Parameter. | | | | | (NOTE) | +----------------+----------------+----------------+----------------+ | | connected | No mapping | | | | subaddress | | | | | | | | | | and Type of | | | | | subaddress ≠ | | | | | \"NSAP\" (000) | | | | | or \"user | | | | | specified\" | | | | | (010) (NOTE) | | | +----------------+----------------+----------------+----------------+ | NOTE: The | | | | | interworking | | | | | between | | | | | \"us | | | | | er-specified\" | | | | | encoding-type | | | | | parameter and | | | | | \"us | | | | | er-specified\" | | | | | type of | | | | | subaddress is | | | | | an operator | | | | | option. | | | | +----------------+----------------+----------------+----------------+
#### 7.4.5.3 Interworking at O-MGCF
The mapping in table 24bc of the **subaddress information** received in the
Access Transport Parameter (calling party subaddress and/or **called party
subaddress information elements**) of the IAM message to the isdn-subaddress
parameters **\"isub\" and \"isub-encoding\"** of a tel or SIP URI to be sent
within the initial INVITE request shall be applied.
The mapping in table 24bd of the isdn-subaddress information received within a
tel or SIP URI of a 200 OK (INVITE) to the subaddress **information** of the
ISUP Access Transport Parameter (connected subaddress information element) to
be sent within the ANM or CON message shall be applied.
Table 24bc: Mapping of the subaddress information received in an IAM to the
isdn-subaddress sent in the INVITE
+----------------+----------------+----------------+----------------+ | ISUP IAM | SIP INVITE | | | | Message | Message | | | +----------------+----------------+----------------+----------------+ | ISUP Parameter | Source | Source SIP | Derived value | | field | component | header field | of parameter | | | value | and component | field | +----------------+----------------+----------------+----------------+ | Access | called party | To header | \";isub=\" | | Transport | subaddress and | field | 1*uric and | | Parameter | Type of | including the | \"isub-encod | | | subaddress = | is | ing=nsap-ia5\" | | | \"NSAP\" (000) | dn-subaddress, | | | | | and, as an | The subaddress | | | | operator | digits | | | | option, | included into | | | | Request URI | the \"uric\" | | | | | shall be | | | | | derived from | | | | | the Access | | | | | Transport | | | | | Parameter. | +----------------+----------------+----------------+----------------+ | | called party | | \";isub=\" | | | subaddress and | | 1*uric and | | | Type of | | \"is | | | subaddress = | | ub-encoding=us | | | \"user | | er-specified\" | | | specified\" | | | | | (010) (NOTE) | | The subaddress | | | | | digits | | | | | included into | | | | | the \"uric\" | | | | | shall be | | | | | derived from | | | | | the Access | | | | | Transport | | | | | Parameter. | | | | | (NOTE) | +----------------+----------------+----------------+----------------+ | | called party | No mapping | | | | subaddress and | | | | | Type of | | | | | subaddress ≠ | | | | | \"NSAP\" (000) | | | | | OR \"user | | | | | specified\" | | | | | (010) (NOTE) | | | +----------------+----------------+----------------+----------------+ | | calling party | P-Ass | \";isub=\" | | | subaddress and | erted-Identity | 1*uric and | | | Type of | header field | \"isub-encod | | | subaddress = | including the | ing=nsap-ia5\" | | | \"NSAP\" (000) | i | | | | | sdn-subaddress | The subaddress | | | | | digits | | | | | included into | | | | | the \"uric\" | | | | | shall be | | | | | derived from | | | | | the Access | | | | | Transport | | | | | Parameter. | +----------------+----------------+----------------+----------------+ | | calling party | | \";isub=\" | | | subaddress and | | 1*uric and | | | Type of | | \"is | | | subaddress = | | ub-encoding=us | | | \"user | | er-specified\" | | | specified\" | | | | | (010) (NOTE) | | The subaddress | | | | | digits | | | | | included into | | | | | the \"uric\" | | | | | shall be | | | | | derived from | | | | | the Access | | | | | Transport | | | | | Parameter. | | | | | (NOTE) | +----------------+----------------+----------------+----------------+ | | calling party | No mapping | | | | Subaddress and | | | | | Type of | | | | | Subaddress ≠ | | | | | \"NSAP\" (000) | | | | | or \"user | | | | | specified\" | | | | | (010) (NOTE) | | | +----------------+----------------+----------------+----------------+ | NOTE: The | | | | | interworking | | | | | between | | | | | \"us | | | | | er-specified\" | | | | | encoding-type | | | | | parameter and | | | | | \"us | | | | | er-specified\" | | | | | type of | | | | | subaddress is | | | | | an operator | | | | | option. | | | | +----------------+----------------+----------------+----------------+
Table 24bd: Mapping of the isdn subaddress received in a 200OK to the
subaddress information sent in the ANM or CON
+----------+----------+----------+----------+----------+----------+ | SIP | ISUP | | | | | | Message | Message | | | | | | 200 (OK) | ANM or | | | | | | | CON | | | | | +----------+----------+----------+----------+----------+----------+ | Source | Source | ISUP | Derived | | | | SIP | c | P | value of | | | | header | omponent | arameter | p | | | | field | value | field | arameter | | | | and | | | field | | | | c | | | | | | | omponent | | | | | | +----------+----------+----------+----------+----------+----------+ | P-A | \ | isub- | Access | c | Type of | | sserted- | "isub=\" | encoding | T | onnected | su | | Identity | 1*uric | not | ransport | su | baddress | | header | | present | P | baddress | = | | Field | \"uric\" | | arameter | | \"NSAP\" | | | co | | | | (000) | | i | ntaining | | | | | | ncluding | the | | | | | | the | su | | | | | | isdn-su | baddress | | | | | | baddress | digits | | | | | +----------+----------+----------+----------+----------+----------+ | | | \" | | | | | | | isub-enc | | | | | | | oding=ns | | | | | | | ap-ia5\" | | | | +----------+----------+----------+----------+----------+----------+ | | | \" | | | Type of | | | | isub-enc | | | su | | | | oding=ns | | | baddress | | | | ap-bcd\" | | | = | | | | | | | \"NSAP\" | | | | | | | (000) | +----------+----------+----------+----------+----------+----------+ | | | \"isub | | | Type of | | | | -encodin | | | su | | | | g=nsap\" | | | baddress | | | | | | | = | | | | | | | \"NSAP\" | | | | | | | (000) | +----------+----------+----------+----------+----------+----------+ | | | \"isub-e | | | Type of | | | | ncoding= | | | su | | | | user-spe | | | baddress | | | | cified\" | | | = | | | | (NOTE) | | | \" | | | | | | | user-spe | | | | | | | cified\" | | | | | | | (010) | | | | | | | (NOTE) | +----------+----------+----------+----------+----------+----------+ | | \ | No | | | | | | "isub=\" | mapping | | | | | | 1*uric | | | | | | | ( | | | | | | | \"uric\" | | | | | | | co | | | | | | | ntaining | | | | | | | the | | | | | | | su | | | | | | | baddress | | | | | | | digits) | | | | | | | and | | | | | | | isub- | | | | | | | encoding | | | | | | | does not | | | | | | | contain | | | | | | | \"ns | | | | | | | ap-ia5\" | | | | | | | or | | | | | | | \"ns | | | | | | | ap-bcd\" | | | | | | | or | | | | | | | \"nsap\" | | | | | | | or | | | | | | | \" | | | | | | | user-spe | | | | | | | cified\" | | | | | | | value | | | | | | | (NOTE) | | | | | +----------+----------+----------+----------+----------+----------+ | NOTE: | | | | | | | The | | | | | | | inte | | | | | | | rworking | | | | | | | between | | | | | | | \" | | | | | | | user-spe | | | | | | | cified\" | | | | | | | encod | | | | | | | ing-type | | | | | | | p | | | | | | | arameter | | | | | | | and | | | | | | | \" | | | | | | | user-spe | | | | | | | cified\" | | | | | | | type of | | | | | | | su | | | | | | | baddress | | | | | | | is an | | | | | | | operator | | | | | | | option. | | | | | | +----------+----------+----------+----------+----------+----------+
### 7.4.6 Call Forwarding Busy (CFB)/ Call Forwarding No Reply (CFNR) / Call
Forwarding Unconditional (CFU) / Call Deflection (CD)
#### 7.4.6.1 General
A MGCF within an IMS network applying the Communication Diversion service uses
the procedures defined in clause 7.5.4.
This clause describes additional interworking of call forwarding service
information between a PSTN/PLMN network and an IMS network. This can also be
used when interworking between SIP networks (e.g., IMS network interworking
with enterprise networks making use of the History-Info header field with an
escaped Reason header field as described in IETF RFC 7044 [91]). The
procedures support the interworking of the diversion reason within the
History-Info header field using an escaped Reason header field defined by IETF
RFC 3326 [116] as described in IETF RFC 7044 [91] and also support the
diversion cause using the \"cause\" URI parameter as described by IETF RFC
4458 [113].
If the MGCF is supporting the interworking of Call Forwarding and also
applying the Communication Diversion services as defined by 3GPP TS 24.604
[60], it uses both IETF RFC 7044 [91] and IETF RFC 4458 [113] to signal the
diversion reason. An IMS network supporting the interworking of Call
Forwarding and not applying the IMS Communication Diversion supplementary
service according to 3GPP TS 24.604 [60] uses IETF RFC 7044 [91] and can also
use IETF RFC 4458 [113] based on network option.
When interworking the SIP History-Info header field to ISUP, and both the
diversion reason based on IETF RFC 7044 [91] and IETF RFC 4458 [113] are
present for the same diversion instance, the MGCF should use the \"cause\" URI
parameter per IETF RFC 4458 [113] for deriving the ISUP. When the \"cause\"
URI parameter per IETF RFC 4458 [113] is used, the corresponding interworking
as described in clause 7.5.4 shall be applied for that diversion instance.
Otherwise, the interworking as defined in the present clause should be
applied.
When interworking from ISUP to the History-Info header field, to signal the
diversion reason the MGCF should use the escaped Reason header field from IETF
RFC 7044 [91] and apply the interworking procedures in the present subclause.
The MGCF should also apply the interworking procedures described in clause
7.5.4 to use the \"cause\" URI parameter from IETF RFC 4458 [113] to signal
the diversion reason.
In the event that the interworking procedures described in this clause as well
as the interworking procedures in clause 7.5.4 are not applied, the actions of
the MGCF at the ISUP/BICC side as described in ITU-T Recommendation Q.732.2-5
[42] under the clause \"Interactions with networks not providing any call
diversion information\" may be applied as a network option.
#### 7.4.6.2 Interworking at the O-MGCF
##### 7.4.6.2.1 General
This clause describes the optional mapping of Call Forwarding information at
the O-MGCF to the protocol-cause specified in IETF RFC 3326 [116].
##### 7.4.6.2.2 Interworking SIP to ISUP
Table 7.4.6.2.2.1: Mapping of SIP messages to ISUP messages
* * *
←Message sent to ISUP ←Message Received from SIP  
ACM indicating call forwarding 181 (Call Is Being Forwarded) response See
table 7.4.6.2.2.6 CPG indicating call forwarding (see NOTE) 181 (Call Is Being
Forwarded) response See table 7.4.6.2.2.7 ACM indicating ringing 180 (Ringing)
response See table 7.4.6.2.2.8 CPG indicating alerting (see NOTE) 180
(Ringing) response See table 7.4.6.2.2.9 ANM 200 (OK) response See table
7.4.6.2.2.10 CON 200 (OK) response (Neither a 181 (Call Is Being Forwarded)
response nor a 180 (Ringing) response was received) See table 7.4.6.2.2.10
NOTE: A CPG will be sent if an ACM was already sent.
* * *
Table 7.4.6.2.2.2: Mapping of History-Info header field to ISUP Redirection
number
+----------------+----------------+----------------+----------------+ | Source SIP | Source | Redirection | Derived value | | header field | Component | number | of parameter | | and component | value | | field | +----------------+----------------+----------------+----------------+ | hi-t | CC | Nature of | If CC is equal | | argeted-to-uri | | address | to the country | | of the | | indicator | code of the | | hi-entry | | | country where | | following the | | | O‑MGCF is | | last hi-entry | | | located AND | | containing a | | | the next ISUP | | Reason | | | node is | | \"headers\" | | | located in the | | component as | | | same country, | | defined in | | | then set to | | IETF R | | | \"_national | | FC 7044 [91] | | | (significant) | | with cause | | | number_ \" else | | value as | | | set to | | listed in | | | \" | | table | | | _international | | 7.4.6.2.2.4. | | | number_ \". | | | | | | | Appropriate | | | | | global number | | | | | portion of the | | | | | hi-ta | | | | | rgeted-to-uri, | | | | | assumed to be | | | | | in form\ | | | | | \"+\" CC + NDC | | | | | + SN. (NOTE) | | | | +----------------+----------------+----------------+----------------+ | | CC, NDC, SN | Address | If NOA is | | | | signals | \"_national | | | | | (significant) | | | | | number_ \" then | | | | | set to\ | | | | | NDC + SN. | | | | | | | | | | If NOA is | | | | | \" | | | | | _international | | | | | number_ \" | | | | | | | | | | then set to CC | | | | | + NDC + SN. | +----------------+----------------+----------------+----------------+ | NOTE: If the | | | | | SIP URI | | | | | doesn\'t | | | | | contain | | | | | \"_| | | | | user=phone_ \", | | | | | mapping to | | | | | redirection | | | | | number is | | | | | impossible, | | | | | therefore no | | | | | need to | | | | | generate | | | | | Redirection | | | | | number and | | | | | Redirection | | | | | number | | | | | restriction | | | | | parameter (per | | | | | table | | | | | 7.4.6.2.2.3), | | | | | Notification | | | | | subscription | | | | | options can\'t | | | | | be set as | | | | | \ | | | | | "_presentation | | | | | allowed with | | | | | redirection | | | | | number_ \". | | | | +----------------+----------------+----------------+----------------+
Table 7.4.6.2.2.3: Mapping of History-Info header field to ISUP Redirection
number restriction
* * *
Source SIP header field and component Source Component value Redirection
number restriction Derived value of parameter field Privacy header field,
or/and Privacy \"headers\" component of the hi-entry following the last hi-
entry containing a Reason \"headers\" component as defined in IETF RFC 7044
[91] with cause value as listed in table 7.4.6.2.2.4 \"_history_ \" or
\"_session_ \" or \"_header_ \" Presentation restricted indicator
\"_Presentation restricted_ \" Privacy \"headers\" component of the hi-
targeted-to-uri and Privacy header field absent or \"_none_ \" \"_Presentation
allowed_ \" or absent
* * *
Table 7.4.6.2.2.4: Mapping of hi-targeted-to-uri to ISUP Call Diversion
Information
+----------------+----------------+----------------+----------------+ | Source SIP | Source | Call Diversion | Derived value | | header field | Component | Information | of parameter | | and component | value | | field | +----------------+----------------+----------------+----------------+ | Privacy | | Notification | If the | | \"headers\" | | subscription | priv-value | | component of | | options | \"_history_ \" | | the | | | or | | hi-t | | | \"_session_ \" | | argeted-to-uri | | | or | | or/and Privacy | | | \"_header_ \" | | header field | | | is received | | | | | within the | | | | | Privacy header | | | | | field or the | | | | | priv-value | | | | | \"_history_ \" | | | | | is received | | | | | within the | | | | | \"headers\" | | | | | component of | | | | | the | | | | | hi-t | | | | | argeted-to-uri | | | | | representing | | | | | the diverting | | | | | URI(s) and | | | | | within the | | | | | hi-t | | | | | argeted-to-uri | | | | | representing | | | | | diverted-to | | | | | URI then | | | | | \ | | | | | "_presentation | | | | | not allowed\"_ | | | | | shall be set. | | | | | | | | | | Otherwise, if | | | | | the priv-value | | | | | \"_history_ \" | | | | | is received | | | | | only within | | | | | the | | | | | \"headers\" | | | | | component of | | | | | the | | | | | hi-t | | | | | argeted-to-uri | | | | | representing | | | | | the | | | | | diverted-to | | | | | URI then | | | | | \ | | | | | "_presentation | | | | | allowed | | | | | without | | | | | redirection | | | | | number\" shall | | | | | be set._ | | | | | | | | | | (NOTE 1, | | | | | NOTE 2) | | | | | | | | | | Otherwise, | | | | | \ | | | | | "_presentation | | | | | allowed with | | | | | redirection | | | | | number\"_ | | | | | shall be set. | +----------------+----------------+----------------+----------------+ | hi-ta | **Cause | Redirecting | | | rgeted-to-uri; | parameter | reason | | | Reason | value** | | | | \"headers\" | | | | | component as | | | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | with cause | | | | | parameter | | | | +----------------+----------------+----------------+----------------+ | | 302 | | _Deflection | | | | | immediate | | | | | response_ | +----------------+----------------+----------------+----------------+ | | 486 | | _User busy_ | +----------------+----------------+----------------+----------------+ | | 408 | | _No reply_ | +----------------+----------------+----------------+----------------+ | | 503 | | _Mobile | | | | | subscriber not | | | | | reachable_ | +----------------+----------------+----------------+----------------+ | | all other | | _Unknown_ | | | cause values | | | +----------------+----------------+----------------+----------------+ | NOTE 1: | | | | | diverting URI | | | | | corresponds to | | | | | the | | | | | hi-t | | | | | argeted-to-uri | | | | | of the | | | | | hi-entry | | | | | containing a | | | | | hi-index value | | | | | that match the | | | | | \"mp\" header | | | | | field | | | | | parameter | | | | | value of the | | | | | diverted-to | | | | | URI. If the | | | | | diverted-to | | | | | URI does not | | | | | contain the | | | | | \"mp\" header | | | | | field | | | | | parameter, the | | | | | diverting URI | | | | | corresponds to | | | | | the | | | | | hi-t | | | | | argeted-to-uri | | | | | of the last | | | | | hi-entry | | | | | containing a | | | | | Reason | | | | | \"headers\" | | | | | component with | | | | | cause | | | | | parameter. | | | | | | | | | | NOTE 2: | | | | | diverted-to | | | | | URI | | | | | corresponds to | | | | | the | | | | | hi-t | | | | | argeted-to-uri | | | | | of the | | | | | hi-entry | | | | | following the | | | | | last hi-entry | | | | | containing a | | | | | Reason | | | | | \"headers\" | | | | | component with | | | | | cause | | | | | parameter and | | | | | is mapped to | | | | | the | | | | | Redirection | | | | | number, see | | | | | tabl | | | | | e 7.4.6.2.2.2. | | | | +----------------+----------------+----------------+----------------+
Table 7.4.6.2.2.5: Void
Table 7.4.6.2.2.6: Mapping of 181 (Call Is Being Forwarded)  ACM when ACM was
not previously sent
+----------------+----------------+----------------+----------------+ | Source SIP | Source | ISUP Parameter | Derived value | | header field | Component | | of parameter | | and component | value | | field | +----------------+----------------+----------------+----------------+ | 181 (Call Is | | ACM | | | Being | | | | | Forwarded) | | | | +----------------+----------------+----------------+----------------+ | | | Generic | _Call is | | | | notification | diverting_ | | | | indicator | | | | | | | | | | _Notification | | | | | indicator_ | | +----------------+----------------+----------------+----------------+ | History-Info | See table | Redirection | See table | | header field | 7.4.6.2.2.2 | number | 7.4.6.2.2.2 | +----------------+----------------+----------------+----------------+ | Privacy | See table | Redirection | See table | | \"headers\" | 7.4.6.2.2.3 | number | 7.4.6.2.2.3 | | component of | | restriction | | | the | | | | | hi-t | | | | | argeted-to-uri | | | | | or/and Privacy | | | | | header field | | | | +----------------+----------------+----------------+----------------+ | Privacy | See table | Call diversion | See table | | \"headers\" | 7.4.6.2.2.4 | information | 7.4.6.2.2.4 | | component of | | _Notification | | | the | | subscription | | | hi-t | | options_ | | | argeted-to-uri | | | | | or/and Privacy | | | | | header field | | | | +----------------+----------------+----------------+----------------+ | hi-ta | See table | Call diversion | See table | | rgeted-to-uri; | 7.4.6.2.2.4 | information | 7.4.6.2.2.4 | | Reason | | | | | \"headers\" | | _Redirecting | | | component as | | reason_ | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | with cause | | | | | parameter | | | | +----------------+----------------+----------------+----------------+
Table 7.4.6.2.2.7: Mapping of 181 (Call Is Being Forwarded)  CPG if ACM was
already sent
+----------------+----------------+----------------+----------------+ | Source SIP | Source | ISUP Parameter | Derived value | | header field | Component | | of parameter | | and component | value | | field | +----------------+----------------+----------------+----------------+ | 181 (Call Is | | CPG | | | Being | | | | | Forwarded) | | | | | response | | | | +----------------+----------------+----------------+----------------+ | | | Generic | _Call is | | | | notification | diverting_ | | | | indicator | | | | | | | | | | _Notification | | | | | indicator_ | | +----------------+----------------+----------------+----------------+ | hi-ta | 486 | Event | _CFB_ | | rgeted-to-uri; | | information | (national use) | | Reason | | | | | \"headers\" | | Event | | | component as | | indicator | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | with cause | | | | | parameter | | | | +----------------+----------------+----------------+----------------+ | | 408 (see NOTE) | | _CFNR_ | | | | | (national use) | +----------------+----------------+----------------+----------------+ | | all other | | _Progress_ | | | values, or if | | | | | appropriate | | | | | \"national | | | | | use\" value | | | | | (CFB, CFNR or | | | | | _CFU) is not | | | | | used in a | | | | | network, or if | | | | | no | | | | | hi-ta | | | | | rgeted_ -to-uri | | | | | \"cause\" URI | | | | | parameter is | | | | | contained in | | | | | the SIP 181 | | | | | (Call Is Being | | | | | Forwarded) | | | | | response. | | | +----------------+----------------+----------------+----------------+ | History-Info | See table | Redirection | See table | | header field | 7.4.6.2.2.2 | number | 7.4.6.2.2.2 | +----------------+----------------+----------------+----------------+ | Privacy | See table | Redirection | See table | | \"headers\" | 7.4.6.2.2.3 | number | 7.4.6.2.2.3 | | component of | | restriction | | | the | | | | | hi-t | | | | | argeted-to-uri | | | | | or/and Privacy | | | | | header field | | | | +----------------+----------------+----------------+----------------+ | Privacy | See table | Call diversion | See table | | \"headers\" | 7.4.6.2.2.4 | information | 7.4.6.2.2.4 | | component of | | _Notification | | | the | | subscription | | | hi-t | | options_ | | | argeted-to-uri | | | | | or/and Privacy | | | | | header field | | | | +----------------+----------------+----------------+----------------+ | hi-ta | See table | Call diversion | See table | | rgeted-to-uri; | 7.4.6.2.2.4 | information | 7.4.6.2.2.4 | | Reason | | _Redirecting | | | \"headers\" | | reason_ | | | component as | | | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | with cause | | | | | parameter | | | | +----------------+----------------+----------------+----------------+ | NOTE: This | | | | | appears in the | | | | | cases of CFNR. | | | | +----------------+----------------+----------------+----------------+
Table 7.4.6.2.2.8: Mapping of 180 (Ringing)  ACM when ACM was not previously
sent
+----------------+----------------+----------------+----------------+ | Source SIP | Source | ISUP Parameter | Derived value | | header field | Component | | of parameter | | and component | value | | field | +----------------+----------------+----------------+----------------+ | 180 (Ringing) | | ACM | | | response | | | | +----------------+----------------+----------------+----------------+ | History-Info | If | Generic | _Call is | | header field | hi-t | notification | diverting_ | | | argeted-to-uri | indicator | | | | of at least | | | | | one | _Notification | | | | History-Info | indicator_ | | | | hi-entry | | | | | contains a | | | | | Reason | | | | | \"headers\" | | | | | component as | | | | | defined in | | | | | IETF RF | | | | | C 7044 [91]. | | | +----------------+----------------+----------------+----------------+ | History-Info | See table | Redirection | See table | | header field | 7.4.6.2.2.2 | number (NOTE) | 7.4.6.2.2.2 | +----------------+----------------+----------------+----------------+ | Privacy | See table | Redirection | See table | | \"headers\" | 7.4.6.2.2.3 | number | 7.4.6.2.2.3 | | component of | | restriction | | | the | | (NOTE) | | | hi-t | | | | | argeted-to-uri | | | | | or/and Privacy | | | | | header field | | | | +----------------+----------------+----------------+----------------+ | Privacy | See table | Call diversion | See table | | \"headers\" | 7.4.6.2.2.4 | information | 7.4.6.2.2.4 | | component of | | _Notification | | | the | | subscription | | | hi-t | | options_ | | | argeted-to-uri | | (NOTE) | | | or/and Privacy | | | | | header field | | | | +----------------+----------------+----------------+----------------+ | hi-ta | See table | Call diversion | See table | | rgeted-to-uri; | 7.4.6.2.2.4 | information | 7.4.6.2.2.4 | | Reason | | _Redirecting | | | \"headers\" | | reason_ (NOTE) | | | component as | | | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | with cause | | | | | parameter | | | | +----------------+----------------+----------------+----------------+ | NOTE: | | | | | Parameter | | | | | shall only be | | | | | supplied if | | | | | hi-t | | | | | argeted-to-uri | | | | | contains a | | | | | Reason | | | | | \"headers\" | | | | | component, as | | | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | with cause | | | | | value as | | | | | listed in | | | | | table | | | | | 7.4.6.2.2.4. | | | | +----------------+----------------+----------------+----------------+
The mapping described within table 7.4.6.2.2.8 can only appear if the
communication has already undergone a **Communications diversion** in the IMS
and the 180 (Ringing) is the first provisional response sent in backward
direction.
The O-MGCF can indicate the call diversion information in the mapping of 180
(Ringing) provisional response to a CPG message in fact if the response before
was a 181 (Call Is Being Forwarded).
Table 7.4.6.2.2.9: Mapping of 180 (Ringing)  CPG if ACM was already sent
+----------------+----------------+----------------+----------------+ | Source SIP | Source | ISUP Parameter | Derived value | | header field | Component | | of parameter | | and component | value | | field | +----------------+----------------+----------------+----------------+ | 180 (Ringing) | | CPG | | | response | | | | +----------------+----------------+----------------+----------------+ | | | Generic | Call is | | | | notification | diverting | | | | indicator | | | | | | | | | | _Notification | | | | | indicator_ | | +----------------+----------------+----------------+----------------+ | History-Info | | Event | ALERTING | | header field | | information | | | | | | | | | | Event | | | | | indicator | | +----------------+----------------+----------------+----------------+ | History-Info | See table | Redirection | See table | | header field | 7.4.6.2.2.2 | number (NOTE) | 7.4.6.2.2.2 | +----------------+----------------+----------------+----------------+ | Privacy | See table | Redirection | See table | | \"headers\" | 7.4.6.2.2.3 | number | 7.4.6.2.2.3 | | component of | | restriction | | | the | | (NOTE) | | | hi-t | | | | | argeted-to-uri | | | | | or/and Privacy | | | | | header field | | | | +----------------+----------------+----------------+----------------+ | Privacy | See table | Call diversion | See table | | \"headers\" | 7.4.6.2.2.4 | information | 7.4.6.2.2.4 | | component of | | _Notification | | | the | | subscription | | | hi-t | | options_ | | | argeted-to-uri | | (NOTE _)_ | | | or/and Privacy | | | | | header field | | | | +----------------+----------------+----------------+----------------+ | hi-ta | See table | Call diversion | See table | | rgeted-to-uri; | 7.4.6.2.2.4 | information | 7.4.6.2.2.4 | | Reason | | _Redirecting | | | \"headers\" | | reason_ (NOTE) | | | component as | | | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | with cause | | | | | parameter | | | | +----------------+----------------+----------------+----------------+ | NOTE: | | | | | Parameter | | | | | shall only be | | | | | supplied if | | | | | hi-t | | | | | argeted-to-uri | | | | | contains a | | | | | Reason | | | | | \"headers\" | | | | | component, as | | | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | with cause | | | | | value as | | | | | listed in | | | | | table | | | | | 7.4.6.2.2.4. | | | | +----------------+----------------+----------------+----------------+
The mapping in table 7.4.6.2.2.9 appears when a 181 (Call Is Being Forwarded)
provisional response previously was mapped to an ACM. Therefore the state
machine of the O-MGCF knows that a CDIV is in progress.
Table 7.4.6.2.2.10: Mapping of 200 (OK) response
* * *
Source SIP header field and component Source Component value ISUP Parameter
Derived value of parameter field 200 (OK) response ANM/CON (NOTE)  
History-Info header field See table 7.4.6.2.2.2 Redirection number See table
7.4.6.2.2.2 Privacy \"headers\" component of the hi-targeted-to-uri or/and
Privacy header field See table 7.4.6.2.2.3 Redirection number restriction See
table 7.4.6.2.2.3 NOTE:Redirection number shall only be supplied if 200 (OK)
response is mapped to ANM message.
* * *
##### 7.4.6.2.3 Interworking ISUP to SIP
For the interworking of 180 (Ringing) response and 200 (OK) response (to the
INVITE request) to the regarding ISUP messages and parameters no additional
procedures beyond the basic call procedures are needed.
To interwork the redirecting number at the O-MGCF it can be needed to create
placeholder History-Info hi-entries. Such a History-Info hi-entry shall
contain a hi-targeted-to-uri set to an \"Unknown User Identity\" (value
\"sip:unknown\@unknown.invalid\" as defined in 3GPP TS 23.003 [74]), a Reason
\"headers\" component with a cause parameter, a hi-index and an \"mp\" header
field parameter as described within table 7.4.6.2.3.1.
Table 7.4.6.2.3.1: Mapping of IAM to SIP INVITE request
+----------------+----------------+----------------+----------------+ | ISUP Parameter | Derived value | SIP component | Value | | or IE | of parameter | | | | | field | | | +----------------+----------------+----------------+----------------+ | IAM | | INVITE request | | +----------------+----------------+----------------+----------------+ | Redirecting | | History-Info | IF Redirection | | number | | header field | counter | | | | | exceeds 1 | | | | | | | | | | hi-t | | | | | argeted-to-uri | | | | | of the | | | | | | | | | | penultimate | | | | | created | | | | | | | | | | hi-entry | | | | | (NOTE 9) | | | | | | | | | | IF Redirecting | | | | | number is | | | | | | | | | | available | | | | | | | | | | set to the | | | | | value of the | | | | | | | | | | Redirecting | | | | | number | | | | | | | | | | ELSE | | | | | | | | | | set to the | | | | | | | | | | Unknown User | | | | | | | | | | Identity | | | | | (NOTE 10) | | | | | | | | | | ELSE | | | | | | | | | | no mapping | | | | | (NOTE 8) | +----------------+----------------+----------------+----------------+ | Nature of | \"_national | hi-t | Add CC (of the | | address | (significant) | argeted-to-uri | country where | | indicator: | number\"_ | | the MGCF is | | | | | located) to | | | | | Redirecting | | | | | number Address | | | | | Signals to | | | | | construct | | | | | E.164 number | | | | | in URI. | +----------------+----------------+----------------+----------------+ | | _\ | | Map complete | | | "international | | Redirecting | | | number\"_ | | number Address | | | | | Signals to | | | | | E.164 number | | | | | in URI. | +----------------+----------------+----------------+----------------+ | Address | If NOA is | hi-t | **Addr-spec** | | Signals | \"_national | argeted-to-uri | | | | (significant) | | \"+\" CC NDC | | | number\"_ then | | SN mapped to | | | the format of | | userinfo | | | the Address | | portion of SIP | | | Signals is: | | URI. | | | | | | | | NDC + SN | | (NOTE 5) | | | | | | | | If NOA is | | Add | | | \" | | \ | | | _international | | "user=phone\". | | | number\"_ | | | | | | | | | | then the | | | | | format of the | | | | | Address | | | | | Signals is: | | | | | | | | | | CC + NDC + SN | | | +----------------+----------------+----------------+----------------+ | Redirecting | **_APRI_** | Privacy | ** | | number | | \"headers\" | _Priv-value_**| | | | component of | | | | | the | | | | | penultimate | | | | | hi-t | | | | | argeted-to-uri | | | | | entry in the | | | | | History-Info | | | | | header | | +----------------+----------------+----------------+----------------+ | | \ | | \"_history _\" | | | "_ presentation | | | | | restricted _\" | | | +----------------+----------------+----------------+----------------+ | | \ | | Privacy header | | | "_ presentation | | field absent | | | allowed _\" | | or \"_ none*\" | | | | | (NOTE 3) | +----------------+----------------+----------------+----------------+ | Redirection | _**Redirecting | Privacy | ** | | Information | indicator** _| \"headers\" |_ Priv-value** _| | | | component of | | | | | the | | | | | penultimate | | | | | hi-t | | | | | argeted-to-uri | | | | | entry in the | | | | | History-Info | | | | | header | | +----------------+----------------+----------------+----------------+ | |_ Call | | Privacy header | | | diverted _| | field absent | | | | | or \"_ none _\" | | | | | (NOTE 4) | +----------------+----------------+----------------+----------------+ | |_ Call | | \"_history_ \" | | | diverted, all | | | | | redirection | | | | | information | | | | | presentation | | | | | restricted _| | | +----------------+----------------+----------------+----------------+ | Redirection | Redirection | hi-index and | Number of | | Information | counter | \"mp\" header | diversions is | | | | field | shown to the | | | 1 | parameter | number of | | | | (NOTE 7) | levels in | | | | | hi-index. | | | | | | | | | | Index for | | | | | Original | | | | | called number | | | | | = 1 | | | | | | | | | | Index for | | | | | Called party | | | | | number = 1.1 | | | | | and addition | | | | | of \"mp=1\" | +----------------+----------------+----------------+----------------+ | | 2 | | Index for | | | | | Original | | | | | called number | | | | | = 1 | | | | | | | | | | Index for | | | | | Redirecting | | | | | number = 1.1 | | | | | and addition | | | | | of \"mp=1\" | | | | | | | | | | Index for | | | | | Called party | | | | | number = 1.1.1 | | | | | and addition | | | | | of \"mp=1.1\" | +----------------+----------------+----------------+----------------+ | | N | | Index for | | | | | Original | | | | | called number | | | | | = 1 | | | | | | | | | | Placeholder | | | | | History-Info | | | | | hi-entry with | | | | | Index = 1.1 | | | | | and addition | | | | | of \"mp=1\" | | | | | | | | | | ... | | | | | | | | | | Fill up | | | | | | | | | | ... | | | | | | | | | | Index for | | | | | Redirecting | | | | | number = | | | | | 1.[(N-1)* | | | | | \".1\"] and | | | | | addition of | | | | | \"mp\" set to | | | | | the hi-index | | | | | value of the | | | | | hi-t | | | | | argeted-to-uri | | | | | that precede. | | | | | | | | | | Index for | | | | | Called party | | | | | number | | | | | | | | | | = 1.N* \".1\" | | | | | (e.g. N=3  | | | | | 1.1.1.1) and | | | | | addition of | | | | | \"mp=1.\ | | | | | [(N-1)*].1\" | +----------------+----------------+----------------+----------------+ | Redirection |__Redirecting | hi-ta |__Cause | | Information | Reason and_ _| rgeted-to-uri; | parameter | | | | Reason | value_ _| | |__Original | \"headers\" | | | | Redirection | component as | | | | Reason_ _| defined in | | | | | IETF R | | | | (NOTE 1) | FC 7044 [91] | | | | | with cause | | | | | parameter. | | | | | | | | | | For a | | | | | placeholder | | | | | History-Info | | | | | hi-entry the | | | | | value \"404\" | | | | | shall be taken | | | | | (NOTE 2). | | | | | | | | | | Cause | | | | | parameter for | | | | | redirecting | | | | | reason will be | | | | | put in the | | | | | entry of | | | | | redirecting | | | | | number, and | | | | | cause | | | | | parameter for | | | | | original | | | | | redirection | | | | | reason will be | | | | | put in the | | | | | entry of | | | | | original | | | | | called number. | | +----------------+----------------+----------------+----------------+ | |_ unknown/not | | 404 | | | available _| | | +----------------+----------------+----------------+----------------+ | | * | | 302 | | | unconditional_ | | | +----------------+----------------+----------------+----------------+ | | _User Busy_ | | 486 | +----------------+----------------+----------------+----------------+ | | _No reply_ | | 408 | +----------------+----------------+----------------+----------------+ | | _Deflection | | 302 | | | during | | | | | alerting_ | | | +----------------+----------------+----------------+----------------+ | | _Deflection | | 302 | | | immediate | | | | | response_ | | | +----------------+----------------+----------------+----------------+ | | _Mobile | | 503 | | | subscriber not | | | | | reachable_ | | | +----------------+----------------+----------------+----------------+ | Called Party | _See_ | History-Info | URI of the | | Number | Redirecting | header field | last | | | number | see | hi-t | | | | hi-t | argeted-to-uri | | | Nature of | argeted-to-uri | entry of | | | address | | History-Info | | | indicator and | | header field | | | Address signal | | | | | | | (NOTE 6) | +----------------+----------------+----------------+----------------+ | Original | _See_ | History-Info | URI of first | | called number | Redirecting | header field | hi-t | | | number | see | argeted-to-uri | | | | hi-t | entry of | | | Nature of | argeted-to-uri | History-Info | | | address | | header field | | | indicator and | | (NOTE 5, | | | Address signal | | NOTE 9) | | | | | | | | | | IF the | | | | | Original | | | | | called number | | | | | is available: | | | | | | | | | | set to the | | | | | value of the | | | | | | | | | | Original | | | | | called number | | | | | | | | | | ELSE | | | | | | | | | | IF the | | | | | Redirection | | | | | counter | | | | | | | | | | equals 1 AND | | | | | the | | | | | | | | | | Redirecting | | | | | number is | | | | | | | | | | available, | | | | | | | | | | set to the | | | | | value of | | | | | | | | | | the | | | | | Redirecting | | | | | | | | | | number | | | | | | | | | | ELSE | | | | | | | | | | set to the | | | | | | | | | | Unknown User | | | | | | | | | | Identity | | | | | (NOTE 10) | +----------------+----------------+----------------+----------------+ | Original | **APRI** | Privacy | **Priv-value** | | called number | | \"headers\" | | | | | component of | | | | | the first | | | | | hi-t | | | | | argeted-to-uri | | | | | entry of | | | | | History-Info | | | | | header | | +----------------+----------------+----------------+----------------+ | | \ | | \"_history_ \" | | | "_presentation | | | | | restricted_ \" | | | +----------------+----------------+----------------+----------------+ | | \ | | Privacy header | | | "_presentation | | field absent | | | allowed_ \" | | or \"_none_ \" | +----------------+----------------+----------------+----------------+ | NOTE 1: | | | | | Original | | | | | Redirection | | | | | Reason | | | | | contains only | | | | | the | | | | | \"unknown/not | | | | | available \" | | | | | parameter | | | | | | | | | | NOTE 2: For | | | | | all | | | | | History-Info | | | | | hi-entries | | | | | except the | | | | | last one a | | | | | cause | | | | | parameter in | | | | | Reason | | | | | \"headers\" | | | | | component as | | | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | has to be | | | | | included. | | | | | | | | | | NOTE 3: If the | | | | | Redirecting | | | | | indicator has | | | | | the value | | | | | \"Call | | | | | diverted, all | | | | | redirection | | | | | information | | | | | presentation | | | | | restricted\", | | | | | the privacy | | | | | value | | | | | \"history\" | | | | | shall be set. | | | | | | | | | | NOTE 4: If the | | | | | redirecting | | | | | number APRI | | | | | has the value | | | | | \"presentation | | | | | restricted\", | | | | | the privacy | | | | | value | | | | | \"history\" | | | | | shall be set. | | | | | | | | | | NOTE 5: Used | | | | | URI scheme | | | | | shall be SIP | | | | | URI. The | | | | | Reason | | | | | \"headers\" | | | | | component with | | | | | a cause | | | | | parameter | | | | | cannot be | | | | | added if | | | | | hi-t | | | | | argeted-to-uri | | | | | is a tel URI. | | | | | | | | | | NOTE 6: The | | | | | used URI | | | | | scheme can be | | | | | tel or SIP | | | | | since the last | | | | | hi-t | | | | | argeted-to-uri | | | | | entry of the | | | | | History-Info | | | | | header field | | | | | does not | | | | | contain the | | | | | Reason | | | | | \"headers\" | | | | | component with | | | | | a cause | | | | | parameter. | | | | | | | | | | NOTE 7: The | | | | | h | | | | | i-target-param | | | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | defines the | | | | | mp-param | | | | | \"mp\" as a | | | | | header field | | | | | parameter that | | | | | contains the | | | | | value of the | | | | | hi-index in | | | | | the hi-entry | | | | | with an | | | | | hi-t | | | | | argeted-to-uri | | | | | that reflects | | | | | the | | | | | Request-URI | | | | | that was | | | | | retargeted, | | | | | thus | | | | | identifying | | | | | the \"mapped | | | | | from\" target. | | | | | Since the | | | | | hi-entries are | | | | | created based | | | | | on the | | | | | redirection | | | | | counter to | | | | | reflect the | | | | | diverti | | | | | ng/diverted-to | | | | | entries, the | | | | | h | | | | | i-target-param | | | | | \"mp\" shall | | | | | be present in | | | | | each entry | | | | | except the | | | | | first one. | | | | | | | | | | NOTE 8: If the | | | | | Original | | | | | called number | | | | | parameter is | | | | | not available | | | | | and if the | | | | | value of the | | | | | Redirecting | | | | | counter is | | | | | equal to one, | | | | | the | | | | | Redirecting | | | | | number | | | | | parameter is | | | | | used for the | | | | | first | | | | | hi-t | | | | | argeted-to-uri | | | | | entry of the | | | | | History-Info | | | | | header field. | | | | | | | | | | NOTE 9: If a | | | | | further SIP to | | | | | ISUP | | | | | interworking | | | | | occurs, | | | | | parameters not | | | | | present in the | | | | | original | | | | | message can | | | | | then be | | | | | included. | | | | | | | | | | NOTE 10: The | | | | | \" | | | | | History-Info\" | | | | | header field | | | | | may contain an | | | | | \"Unknown User | | | | | Identity\". An | | | | | \"Unknown User | | | | | Identity\" | | | | | includes | | | | | information | | | | | that does not | | | | | point to the | | | | | served user | | | | | and indicates | | | | | that the | | | | | user\'s | | | | | identity is | | | | | unknown. The | | | | | encoding of | | | | | the \"Unknown | | | | | User | | | | | Identity\" | | | | | shall be as | | | | | defined in | | | | | 3GPP TS | | | | | 23.003 [74]. | | | | +----------------+----------------+----------------+----------------+
#### 7.4.6.3 Interworking at the I-MGCF
##### 7.4.6.3.1 General
This clause describes the interworking of the Call Forwarding information at
the I-MGCF.
##### 7.4.6.3.2 Interworking from SIP to ISUP
Table 7.4.6.3.2.1: Mapping of SIP to ISUP messages
* * *
Message received from SIP Message send to BICC/ISUP INVITE request IAM
* * *
Table 7.4.6.3.2.2: Mapping of History-Info header field to ISUP Redirecting
number
+----------------+----------------+----------------+----------------+ | Source SIP | Source | Redirecting | Derived value | | header field | Component | number | of parameter | | and component | value | | field | +----------------+----------------+----------------+----------------+ | latest | | Redirecting | | | History-Info | | number | | | header field | | | | | entry | | | | | containing a | | | | | Reason | | | | | \"headers\" | | | | | component as | | | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | with cause | | | | | parameter | | | | | (NOTE 1) | | | | +----------------+----------------+----------------+----------------+ | hi-t | CC | Nature of | If CC is equal | | argeted-to-uri | | address | to the country | | | | indicator | code of the | | appropriate | | | country where | | global number | | | MGCF is | | portion of the | | | located AND | | URI, assumed | | | the next ISUP | | to be in form\ | | | node is | | \"+\" CC + NDC | | | located in the | | + SN | | | same country, | | | | | then set to | | | | | \"_national | | | | | (significant) | | | | | number_ \" else | | | | | set to | | | | | \" | | | | | _international | | | | | number_ \" | +----------------+----------------+----------------+----------------+ | | CC, NDC, SN | Address | If NOA is | | | | signals | \"_national | | | | | (significant) | | | | | number_ \" then | | | | | set to\ | | | | | NDC + SN. | | | | | | | | | | If NOA is | | | | | \" | | | | | _international | | | | | number_ \" | | | | | | | | | | then set to CC | | | | | + NDC + SN | +----------------+----------------+----------------+----------------+ | Privacy header | | APRI | If the | | field or/and | | | priv-value | | Privacy | | | \"_history_ \" | | \"headers\" | | | or | | component of | | | \"_session_ \" | | the hi-entry | | | or | | | | | \"_header_ \" | | in | | | is received | | History-Info | | | within the | | header field | | | Privacy header | | as specified | | | field or if | | in this table | | | the priv-value | | (NOTE 2) | | | \"_history_ \" | | | | | is received | | | | | within the | | | | | \"headers\" | | | | | component of | | | | | the | | | | | hi-t | | | | | argeted-to-uri | | | | | in the latest | | | | | hi-entry | | | | | containing a | | | | | Reason | | | | | \"headers\" | | | | | component as | | | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | with cause | | | | | parameter, | | | | | then | | | | | \ | | | | | "_presentation | | | | | restricted_ \" | | | | | shall be set. | | | | | | | | | | Otherwise, | | | | | \ | | | | | "_presentation | | | | | allowed\" | | | | | shall be set._ | +----------------+----------------+----------------+----------------+ | NOTE 1: If the | | | | | SIP URI | | | | | doesn\'t | | | | | contain | | | | | \"_| | | | | user=phone_ \", | | | | | mapping to | | | | | redirecting | | | | | number is | | | | | impossible, | | | | | therefore no | | | | | need to | | | | | generate | | | | | Redirecting | | | | | number. | | | | | | | | | | NOTE 2: It is | | | | | possible that | | | | | an entry of | | | | | the | | | | | History-Info | | | | | header field | | | | | itself is | | | | | marked as | | | | | restricted or | | | | | the whole | | | | | History-Info | | | | | header. | | | | +----------------+----------------+----------------+----------------+
Table 7.4.6.3.2.3: Mapping of History-Info header to ISUP Redirection
Information
+----------------+----------------+----------------+----------------+ | Source SIP | Source | Redirection | Derived value | | header field | Component | Information | of parameter | | and component | value | | field | +----------------+----------------+----------------+----------------+ | Privacy header | **_\"__| Redirecting |_ Call | | field, and in | history**\"**_| indicator | diverted, all | | History-Info | or | | redirection | | header field | \"_ session _\" | | information | | in the Privacy | or | | presentation | | \"headers\" | \"_ header _\" | | restricted_ | | component of | | | | | the last | for the | | | | hi-t | Privacy SIP | | | | argeted-to-uri | header or for | | | | containing a | the | | | | Reason | hi-t | | | | \"headers\" | argeted-to-uri | | | | component as | entry | | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | with cause | | | | | parameter | | | | | value as | | | | | listed in the | | | | | cause | | | | | parameter row | | | | | in this table | | | | +----------------+----------------+----------------+----------------+ | | Privacy header | | _Call | | | field and the | | diverted_ | | | privacy | | | | | component of | | | | | the | | | | | hi-t | | | | | argeted-to-uri | | | | | entry either | | | | | absent | | | | | | | | | | or | | | | | | | | | | set to | | | | | \"_none_ \" | | | +----------------+----------------+----------------+----------------+ | | | Original | _Unknown/not | | | | redirection | available_ | | | | reason | | +----------------+----------------+----------------+----------------+ | Cause | **Cause | Redirecting | | | parameter in | parameter | Reason | | | the last | value __| | | | hi-t | | | | | argeted-to-uri | | | | | containing a | | | | | Reason | | | | | \"headers\" | | | | | component as | | | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | +----------------+----------------+----------------+----------------+ | | 302 | |_ Deflection | | | | | immediate | | | | | response_ | +----------------+----------------+----------------+----------------+ | | 486 | | _User busy_ | +----------------+----------------+----------------+----------------+ | | 408 | | _No reply_ | +----------------+----------------+----------------+----------------+ | | 503 | | _Mobile | | | | | subscriber not | | | | | reachable_ | +----------------+----------------+----------------+----------------+ | | All other | | _unknown_ | | | values | | | +----------------+----------------+----------------+----------------+ | History-Info | | Redirection | number of | | header field | | counter | History-Info | | | | | hi-entry(ies) | | | | | containing a | | | | | Reason | | | | | \"headers\" | | | | | component with | | | | | a cause | | | | | parameter | | | | | (NOTE 1, | | | | | NOTE 2) | +----------------+----------------+----------------+----------------+ | NOTE 1: If the | | | | | determined | | | | | number of | | | | | redirection in | | | | | SIP exceeds | | | | | the ISUP | | | | | maximum | | | | | parameter | | | | | value, the | | | | | MGCF shall set | | | | | the | | | | | Redirection | | | | | counter to its | | | | | maximum value. | | | | | For instance, | | | | | in ISUP ITU-T | | | | | Q.763 [4], | | | | | the | | | | | Redirection | | | | | counter | | | | | parameter | | | | | cannot exceed | | | | | 5. | | | | | | | | | | NOTE 2: The | | | | | Redirection | | | | | counter value | | | | | will be | | | | | incremented | | | | | regardless of | | | | | the SIP URI | | | | | format. | | | | +----------------+----------------+----------------+----------------+
Table 7.4.6.3.2.4: Mapping of History-Info header field to ISUP Original
Called number
+----------------+----------------+----------------+----------------+ | Source SIP | Source | Original | Derived value | | header field | Component | called number | of parameter | | and component | value | | field | +----------------+----------------+----------------+----------------+ | | | Numbering Plan | \"_ISDN | | | | Indicator | (Telephony) | | | | | numbering plan | | | | | ( | | | | | Recommendation | | | | | E.164)_ \" | +----------------+----------------+----------------+----------------+ | hi-t | CC | Nature of | If CC is equal | | argeted-to-uri | | address | to the country | | of 1^st^ | | indicator | code of the | | hi-t | | | country where | | argeted-to-uri | | | MGCF is | | containing a | | | located AND | | Reason | | | the next ISUP | | \"headers\" | | | node is | | component as | | | located in the | | defined in | | | same country, | | IETF R | | | then set to | | FC 7044 [91] | | | \"_national | | with cause | | | (significant) | | parameter; | | | number_ \" else | | | | | set to | | appropriate | | | \" | | global number | | | _international | | portion of the | | | number_ \" | | URI, assumed | | | | | to be in form\ | | | | | \"+\" CC + NDC | | | | | + SN | | | | | | | | | | (NOTE 1) | | | | +----------------+----------------+----------------+----------------+ | | CC, NDC, SN | Address | If NOA is | | | | signals | \"_national | | | | | (significant) | | | | | number_ \" then | | | | | set to\ | | | | | NDC + SN. | | | | | | | | | | If NOA is | | | | | \" | | | | | _international | | | | | number_ \" | | | | | | | | | | then set to CC | | | | | + NDC + SN | +----------------+----------------+----------------+----------------+ | Privacy | \"_history_ \" | APRI | \ | | \"headers\" | or | | "_presentation | | component | \"_ session _\" | | restricted_ \" | | | or | | | | in | \"_header_ \" | | | | History-Info | | | | | header field | | | | | of the | | | | | History-Info | | | | | header field | | | | | entry as | | | | | defined above | | | | | in this table | | | | | (NOTE 2) | | | | +----------------+----------------+----------------+----------------+ | | Privacy header | | \ | | | field absent | | "_presentation | | | or \"_ none _\" | | allowed_ \" | +----------------+----------------+----------------+----------------+ | NOTE 1: If it | | | | | is SIP URI and | | | | | doesn\'t | | | | | contain | | | | | \"_| | | | | user=phone_ \", | | | | | mapping to | | | | | Original | | | | | Called number | | | | | is impossible, | | | | | therefore no | | | | | need to | | | | | generate | | | | | Original | | | | | Called number. | | | | | | | | | | NOTE 2: It is | | | | | possible that | | | | | an entry of | | | | | the | | | | | History-Info | | | | | header field | | | | | itself is | | | | | marked as | | | | | restricted or | | | | | the whole | | | | | History-Info | | | | | header. | | | | +----------------+----------------+----------------+----------------+
Table 7.4.6.3.2.5: Mapping of INVITE to IAM
* * *
INVITE IAM  
History-Info header field See table 7.4.6.3.2.2 Redirecting number See table
7.4.6.3.2.2 History-Info header field See table 7.4.6.3.2.3 Redirection
Information See table 7.4.6.3.2.3 History-Info header field See table
7.4.6.3.2.4 Original Called Number _See_ table 7.4.6.3.2.4
* * *
##### 7.4.6.3.3 Interworking from ISUP to SIP
Table 7.4.6.3.3.1: Mapping of ISUP to SIP Messages
* * *
←Message sent to SIP ←Message Received from BICC/ISUP  
181 (Call Is Being Forwarded) ACM no indication with Redirection number and
Call diversion information parameters (CFU, CFB, Cdi) See table 7.4.6.3.3.3
180 (Ringing) ACM indicating ringing, OBCI: \"Call diversion may occur\"
(CFNR, Cda) See clause 7.2.3.1.4 181 (Call Is Being Forwarded) CPG indicating
progress or subsequent diversion indicated in the CPG with Redirection number
and Call diversion information parameters (CFNR, Cda) See table 7.4.6.3.3.4
180 (Ringing) CPG indicating ringing and Redirection number restriction
parameter See table 7.4.6.3.3.5 200 (OK) ANM and Redirection number
restriction parameter See table 7.4.6.3.3.6
* * *
Table 7.4.6.3.3.2: Mapping of ISUP Redirection Number Restriction to History-
Info header field
+----------------+----------------+----------------+----------------+ | Redirection | Derived value | SIP component | Value | | Number | of parameter | | | | Restriction | field | | | +----------------+----------------+----------------+----------------+ | Presentation | \ | Privacy | \"_History_ \" | | restricted | "_Presentation | \"headers\" | | | indicator | restricted_ \" | component of | | | | | the | | | | | hi-t | | | | | argeted-to-uri | | +----------------+----------------+----------------+----------------+ | | \ | | Privacy header | | | "_Presentation | | field absent | | | allowed_ \" or | | | | | absent AND a | | or | | | previously | | | | | received | | \"_none_ \" | | | notification | | | | | subscription | | | | | options was | | | | | NOT | | | | | \ | | | | | "_presentation | | | | | not allowed_ \" | | | | | OR was NOT | | | | | \ | | | | | "_presentation | | | | | allowed | | | | | without | | | | | redirection | | | | | number_ \" | | | +----------------+----------------+----------------+----------------+
Table 7.4.6.3.3.3: Mapping of ACM  181 (Call Is Being Forwarded) response
+----------------+----------------+----------------+----------------+ | ISUP Parameter | Derived value | SIP component | Value | | | of parameter | | | | | field | | | +----------------+----------------+----------------+----------------+ | Generic | Call is | | | | notification | diverting | | | | indicator | | | | | | | | | | _Notification | | | | | indicator_ | | | | +----------------+----------------+----------------+----------------+ | | | 1^st^ hi-entry | Unknown User | | | | of | Identity | | | | History-info | (NOTE 4) | | | | header having | | | | | an index = 1 | | | | | (NOTE 1) | | +----------------+----------------+----------------+----------------+ | Redirection | | 2^nd^ hi-entry | hi-ta | | number | | of | rgeted-to-uri: | | | | History-Info | | | | | header field | | | | | having an | | | | | index 1.1 | | +----------------+----------------+----------------+----------------+ | Nature of | \"_national | hi-t | Add CC (of the | | address | (significant) | argeted-to-uri | country where | | indicator: | number\"_ | | the MGCF is | | | | | located) to | | | | | Redirection | | | | | number Address | | | | | Signals to | | | | | construct | | | | | E.164 number | | | | | in URI. | +----------------+----------------+----------------+----------------+ | | _\ | | Map complete | | | "international | | Redirection | | | number\"_ | | number Address | | | | | Signals to | | | | | E.164 number | | | | | in URI. | +----------------+----------------+----------------+----------------+ | Address | If NOA is | hi-t | **Addr-spec** | | Signals | \"_national | argeted-to-uri | | | | (significant) | | \"+\" CC NDC | | | number\"_ then | | SN mapped to | | | the format of | | userinfo | | | the Address | | portion of SIP | | | Signals is: | | URI | | | | | | | | NDC + SN | | (NOTE 3) | | | | | | | | If NOA is | | Add | | | \" | | \ | | | _international | | "user=phone\". | | | number\"_ | | | | | | | | | | then the | | | | | format of the | | | | | Address | | | | | Signals is: | | | | | | | | | | CC + NDC + SN | | | +----------------+----------------+----------------+----------------+ | Call diversion | **_Redirecting | Reason |_ *Cause | | information | Reason** _| \"headers\" | parameter | | | | component as | value_ _| | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | with cause | | | | | parameter in | | | | | the | | | | | penultimate | | | | | hi-entry | | | | | | | | | | (NOTE 2) | | +----------------+----------------+----------------+----------------+ | |_ Unknown _| | 404 | +----------------+----------------+----------------+----------------+ | | * | | 302 | | | Unconditional_ | | | +----------------+----------------+----------------+----------------+ | | _User busy_ | | 486 | +----------------+----------------+----------------+----------------+ | | _No reply_ | | 408 | +----------------+----------------+----------------+----------------+ | | _Deflection | | 302 | | | immediate | | | | | response_ | | | +----------------+----------------+----------------+----------------+ | | _Deflection | | 302 | | | during | | | | | alerting_ | | | +----------------+----------------+----------------+----------------+ | | _Mobile | | 503 | | | subscriber not | | | | | reachable_ | | | +----------------+----------------+----------------+----------------+ | | * | Privacy | | | | **Notification | \"headers\" | | | | subscription | component | | | | options** _| associated | | | | | with | | | | | Redirection | | | | | number | | | | | hi-t | | | | | argeted-to-uri | | | | | | | | | | (NOTE 2) | | +----------------+----------------+----------------+----------------+ | |_ unknown _| | Escaped | | | | | Privacy value | | | | | is set | | | | | according to | | | | | the rules of | | | | | TS | | | | | 24.604 [60] | | | | | cl | | | | | ause 4.5.2.6.4 | | | | | item c | +----------------+----------------+----------------+----------------+ | |_ presentation | | A 181 (Call Is | | | not allowed _| | Being | | | | | Forwarded) | | | | | shall_ _not_ _| | | | | be sent | +----------------+----------------+----------------+----------------+ | |_ presentation | | Escaped | | | allowed with | | Privacy value | | | redirection | | is set | | | number _| | according to | | | | | the rules of | | | | | TS | | | | | 24.604 [60] | | | | | cl | | | | | ause 4.5.2.6.4 | | | | | item c | +----------------+----------------+----------------+----------------+ | |_ presentation | | Escaped | | | allowed | | Privacy value | | | without | | is set | | | redirection | | according to | | | number* | | the rules of | | | | | TS | | | | | 24.604 [60] | | | | | cl | | | | | ause 4.5.2.6.4 | | | | | item c | +----------------+----------------+----------------+----------------+ | NOTE 1: It is | | | | | necessary to | | | | | create two | | | | | History-Info | | | | | header entries | | | | | to carry both | | | | | Redirection | | | | | number and | | | | | Call diversion | | | | | information. | | | | | Since the | | | | | original | | | | | called number | | | | | is not | | | | | available from | | | | | the ISUP | | | | | message a | | | | | hi-t | | | | | argeted-to-uri | | | | | set to an | | | | | \"Unknown User | | | | | Identity\" is | | | | | included in | | | | | the first | | | | | entry. Only | | | | | two entries | | | | | are provided | | | | | because the | | | | | number of | | | | | diversions is | | | | | not available. | | | | | | | | | | NOTE 2: Needs | | | | | to be stored | | | | | for a possible | | | | | inclusion into | | | | | subsequent | | | | | messages. | | | | | | | | | | NOTE 3: Used | | | | | URI scheme | | | | | shall be SIP | | | | | URI. The | | | | | Reason | | | | | \"headers\" | | | | | component with | | | | | a cause | | | | | parameter | | | | | cannot be | | | | | added if | | | | | hi-t | | | | | argeted-to-uri | | | | | is a tel URI. | | | | | | | | | | NOTE 4: The | | | | | \" | | | | | History-Info\" | | | | | header field | | | | | may contain an | | | | | \"Unknown User | | | | | Identity\". An | | | | | \"Unknown User | | | | | Identity\" | | | | | includes | | | | | information | | | | | that does not | | | | | point to the | | | | | served user | | | | | and indicates | | | | | that the | | | | | user\'s | | | | | identity is | | | | | unknown. The | | | | | encoding of | | | | | the \"Unknown | | | | | User | | | | | Identity\" | | | | | shall be as | | | | | defined in | | | | | 3GPP TS | | | | | 23.003 [74]. | | | | +----------------+----------------+----------------+----------------+
Table 7.4.6.3.3.4: Mapping of CPG  181 (Call Is Being Forwarded) response
+----------------+----------------+----------------+----------------+ | ISUP Parameter | Derived value | SIP component | Value | | | of parameter | | | | | field | | | +----------------+----------------+----------------+----------------+ | Event | Progress | | | | information | | | | | | | | | | Event | | | | | Indicator | | | | +----------------+----------------+----------------+----------------+ | Generic | Call is | | | | notification | diverting | | | | indicator | | | | | | | | | | _Notification | | | | | indicator_ | | | | +----------------+----------------+----------------+----------------+ | | | 1^st^ hi-entry | Unknown User | | | | of | Identity | | | | History-Info | (NOTE 4) | | | | header having | | | | | an index =1 | | | | | (NOTE 1) | | +----------------+----------------+----------------+----------------+ | Redirection | | 2^nd^ hi-entry | hi-ta | | number | | of | rgeted-to-uri: | | | | History-Info | | | | | header field | | | | | having an | | | | | index = 1.1 | | +----------------+----------------+----------------+----------------+ | Nature of | \"_national | hi-t | Add CC (of the | | address | (significant) | argeted-to-uri | country where | | indicator | number\"_ | | the MGCF is | | | | | located) to | | | | | Redirection | | | | | number Address | | | | | Signals to | | | | | construct | | | | | E.164 number | | | | | in URI. | +----------------+----------------+----------------+----------------+ | | _\ | hi-t | Map complete | | | "international | argeted-to-uri | Redirection | | | number\"_ | | number Address | | | | | Signals to | | | | | E.164 number | | | | | in URI. | +----------------+----------------+----------------+----------------+ | Address | If NOA is | hi-t | **Addr-spec** | | Signals | \"_national | argeted-to-uri | | | | (significant) | | \"+\" CC NDC | | | number\"_ then | | SN mapped to | | | the format of | | userinfo | | | the Address | | portion of SIP | | | Signals is: | | URI | | | | | | | | NDC + SN | | (NOTE 3) | | | | | | | | If NOA is | | Add | | | \" | | \ | | | _international | | "user=phone\". | | | number\"_ | | | | | | | | | | then the | | | | | format of the | | | | | Address | | | | | Signals is: | | | | | | | | | | CC + NDC + SN | | | +----------------+----------------+----------------+----------------+ | Call diversion | **_Redirecting | Reason |_** Cause | | information | Reason** _| \"headers\" | parameter | | | | component as | value_** | | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | with cause | | | | | parameter in | | | | | the | | | | | penultimate | | | | | hi-entry | | | | | | | | | | (NOTE 2) | | +----------------+----------------+----------------+----------------+ | | _Unknown_ | | 404 | +----------------+----------------+----------------+----------------+ | | * | | 302 | | | Unconditional _| | | +----------------+----------------+----------------+----------------+ | |_ User busy _| | 486 | +----------------+----------------+----------------+----------------+ | |_ No reply _| | 408 | +----------------+----------------+----------------+----------------+ | |_ Deflection | | 302 | | | immediate | | | | | response _| | | +----------------+----------------+----------------+----------------+ | |_ Deflection | | 302 | | | during | | | | | alerting _| | | +----------------+----------------+----------------+----------------+ | |_ Mobile | | 503 | | | subscriber not | | | | | reachable _| | | +----------------+----------------+----------------+----------------+ | | * | Privacy | | | |__Notification | \"headers\" | | | | subscription | component | | | | options_**| associated | | | | | with | | | | | Redirection | | | | | number | | | | | hi-t | | | | | argeted-to-uri | | | | | | | | | | (NOTE 2) | | +----------------+----------------+----------------+----------------+ | |_unknown_ | | Escaped | | | | | Privacy value | | | | | is set | | | | | according to | | | | | the rules of | | | | | TS | | | | | 24.604 [60] | | | | | cl | | | | | ause 4.5.2.6.4 | | | | | item c | +----------------+----------------+----------------+----------------+ | | _presentation | | A 181 Call is | | | not allowed_ | | Being | | | | | Forwarded | | | | | shall **not __| | | | | be sent | +----------------+----------------+----------------+----------------+ | |_ presentation | | Escaped | | | allowed with | | Privacy value | | | redirection | | is set | | | number_ | | according to | | | | | the rules of | | | | | TS | | | | | 24.604 [60] | | | | | cl | | | | | ause 4.5.2.6.4 | | | | | item c | +----------------+----------------+----------------+----------------+ | | _presentation | | Escaped | | | allowed | | Privacy value | | | without | | is set | | | redirection | | according to | | | number_ | | the rules of | | | | | TS | | | | | 24.604 [60] | | | | | cl | | | | | ause 4.5.2.6.4 | | | | | item c | +----------------+----------------+----------------+----------------+ | NOTE 1: It is | | | | | necessary to | | | | | create two | | | | | History-Info | | | | | header entries | | | | | to carry both | | | | | Redirection | | | | | number and | | | | | Call diversion | | | | | information. | | | | | Since the | | | | | original | | | | | called number | | | | | is not | | | | | available from | | | | | the ISUP | | | | | message a | | | | | hi-t | | | | | argeted-to-uri | | | | | set to an | | | | | \"Unknown User | | | | | Identity\" is | | | | | included in | | | | | the first | | | | | entry. Only | | | | | two entries | | | | | are provided | | | | | because the | | | | | number of | | | | | diversions is | | | | | not available. | | | | | | | | | | NOTE 2: Needs | | | | | to be stored | | | | | for a possible | | | | | inclusion into | | | | | subsequent | | | | | messages. | | | | | | | | | | NOTE 3: Used | | | | | URI scheme | | | | | shall be SIP | | | | | URI. The | | | | | Reason | | | | | \"headers\" | | | | | component with | | | | | a cause | | | | | parameter | | | | | cannot be | | | | | added if | | | | | hi-t | | | | | argeted-to-uri | | | | | is a tel URI. | | | | | | | | | | NOTE 4: The | | | | | \" | | | | | History-Info\" | | | | | header field | | | | | may contain an | | | | | \"Unknown User | | | | | Identity\". An | | | | | \"Unknown User | | | | | Identity\" | | | | | includes | | | | | information | | | | | that does not | | | | | point to the | | | | | served user | | | | | and indicates | | | | | that the | | | | | user\'s | | | | | identity is | | | | | unknown. The | | | | | encoding of | | | | | the \"Unknown | | | | | User | | | | | Identity\" | | | | | shall be as | | | | | defined in | | | | | 3GPP TS | | | | | 23.003 [74]. | | | | +----------------+----------------+----------------+----------------+
Table 7.4.6.3.3.5 addresses two separate conditions: the CPG message is
received from the diverting exchange in which case the Call diversion
information parameter is included; and the CPG message is received from the
diverted-to exchange in which case the Call diversion information parameter is
not included. Interworking for both conditions is shown.
Table 7.4.6.3.3.5: Mapping of CPG  180 (Ringing) response
+----------------+----------------+----------------+----------------+ | ISUP Parameter | Derived value | SIP component | Value | | | of parameter | | | | | field | | | +----------------+----------------+----------------+----------------+ | Event | Alerting | | | | information | | | | | | | | | | Event | | | | | Indicator | | | | +----------------+----------------+----------------+----------------+ | | | 1^st^ hi-entry | Unknown User | | | | of | Identity | | | | History-Info | (NOTE 3) | | | | header having | | | | | an index = 1 | | | | | | | | | | (NOTE 1) | | +----------------+----------------+----------------+----------------+ | Call diversion | **_Redirecting | Reason |_** Cause | | information | Reason** _| \"headers\" | parameter | | | | component as | value_** | | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | with cause | | | | | parameter in | | | | | the | | | | | penultimate | | | | | hi-entry | | | | | | | | | | (NOTE 2) | | +----------------+----------------+----------------+----------------+ | | _Unknown_ | | 404 | +----------------+----------------+----------------+----------------+ | | * | | 302 | | | Unconditional _| | | +----------------+----------------+----------------+----------------+ | |_ User busy _| | 486 | +----------------+----------------+----------------+----------------+ | |_ No reply _| | 408 | +----------------+----------------+----------------+----------------+ | |_ Deflection | | 302 | | | immediate | | | | | response _| | | +----------------+----------------+----------------+----------------+ | |_ Deflection | | 302 | | | during | | | | | alerting _| | | +----------------+----------------+----------------+----------------+ | |_ Mobile | | 503 | | | subscriber not | | | | | reachable _| | | +----------------+----------------+----------------+----------------+ | | * | Privacy | | | |__Notification | \"headers\" | | | | subscription | component | | | | options_**| associated | | | | | with | | | | | Redirection | | | | | number | | | | | hi-t | | | | | argeted-to-uri | | | | | | | | | | (NOTE 2) | | +----------------+----------------+----------------+----------------+ | |_unknown_ | | Escaped | | | | | Privacy value | | | | | is set | | | | | according to | | | | | the rules of | | | | | TS | | | | | 24.604 [60] | | | | | cl | | | | | ause 4.5.2.6.4 | | | | | item c | +----------------+----------------+----------------+----------------+ | | _presentation | | The 180 | | | not allowed_ | | (Ringing) | | | | | response shall | | | | | be sent | | | | | **without __| | | | | the the | | | | | History-Info | | | | | header field | | | | | included | +----------------+----------------+----------------+----------------+ | |_ presentation | | Escaped | | | allowed with | | Privacy value | | | redirection | | is set | | | number_ | | according to | | | | | the rules of | | | | | TS | | | | | 24.604 [60] | | | | | cl | | | | | ause 4.5.2.6.4 | | | | | item c | +----------------+----------------+----------------+----------------+ | | _presentation | | Escaped | | | allowed | | Privacy value | | | without | | is set | | | redirection | | according to | | | number_ | | the rules of | | | | | TS | | | | | 24.604 [60] | | | | | cl | | | | | ause 4.5.2.6.4 | | | | | item c | +----------------+----------------+----------------+----------------+ | Redirection | | 2^nd^ hi-entry | See table | | number | | of | 7.4.6.3.3.3 | | | | History-Info | | | | | header field | | | | | having an | | | | | index = 1.1 | | +----------------+----------------+----------------+----------------+ | If no Call | | Reason | Value stored | | diversion | | \"headers\" | from a | | information | | component as | previous | | parameter is | | defined in | received ACM | | present | | IETF R | or CPG. See | | | | FC 7044 [91] | tables | | | | with cause | 7.4.6.3.3.3 | | | | parameter in | and | | | | the | 7.4.6.3.3.4 | | | | penultimate | | | | | hi-entry | | +----------------+----------------+----------------+----------------+ | | | Privacy | Value stored | | | | \"headers\" | from a | | | | component | previous | | | | associated | received ACM | | | | with | or CPG. See | | | | Redirection | tables | | | | number | 7.4.6.3.3.3 | | | | hi-t | and | | | | argeted-to-uri | 7.4.6.3.3.4 | +----------------+----------------+----------------+----------------+ | Redirection | | | See table | | number | | | 7.4.6.3.3.2 | | restriction | | | | +----------------+----------------+----------------+----------------+ | NOTE 1: It is | | | | | necessary to | | | | | create two | | | | | History-Info | | | | | header entries | | | | | to carry both | | | | | Redirection | | | | | number and | | | | | Redirecting | | | | | reason. Since | | | | | the original | | | | | called number | | | | | is not | | | | | available from | | | | | the ISUP | | | | | message a | | | | | hi-t | | | | | argeted-to-uri | | | | | set to an | | | | | \"Unknown User | | | | | Identity\" is | | | | | included in | | | | | the first | | | | | entry. Only | | | | | two entries | | | | | are provided | | | | | because the | | | | | number of | | | | | diversions is | | | | | not available. | | | | | | | | | | NOTE 2: Needs | | | | | to be stored | | | | | for a possible | | | | | inclusion into | | | | | subsequent | | | | | messages. | | | | | | | | | | NOTE 3: The | | | | | \" | | | | | History-Info\" | | | | | header field | | | | | may contain an | | | | | \"Unknown User | | | | | Identity\". An | | | | | \"Unknown User | | | | | Identity\" | | | | | includes | | | | | information | | | | | that does not | | | | | point to the | | | | | served user | | | | | and indicates | | | | | that the | | | | | user\'s | | | | | identity is | | | | | unknown. The | | | | | encoding of | | | | | the \"Unknown | | | | | User | | | | | Identity\" | | | | | shall be as | | | | | defined in | | | | | 3GPP TS | | | | | 23.003 [74]. | | | | +----------------+----------------+----------------+----------------+
Table 7.4.6.3.3.6: Mapping of ANM  200 (OK) response (to INVITE request)
+----------------+----------------+----------------+----------------+ | ISUP Parameter | Derived value | SIP component | Value | | | of parameter | | | | | field | | | +----------------+----------------+----------------+----------------+ | | | 1^st^ hi-entry | Unknown User | | | | of | Identity | | | | History-Info | (NOTE 2) | | | | header having | | | | | an index = 1 | | | | | (NOTE 1) | | +----------------+----------------+----------------+----------------+ | Redirection | | 2^nd^ hi-entry | See table | | number | | of | 7.4.6.3.3.3 | | | | History-Info | | | | | header field | | | | | having an | | | | | index = 1.1 | | +----------------+----------------+----------------+----------------+ | | | Reason | Value stored | | | | \"headers\" | from a | | | | component as | previously | | | | defined in | received ACM | | | | IETF R | or CPG. See | | | | FC 7044 [91] | tables | | | | with cause | 7.4.6.3.3.3 | | | | parameter in | and | | | | the | 7.4.6.3.3.4 | | | | penultimate | | | | | hi-entry | | +----------------+----------------+----------------+----------------+ | Redirection | | | See table | | number | | | 7.4.6.3.3.2 | | restriction | | | | +----------------+----------------+----------------+----------------+ | NOTE 1: It is | | | | | necessary to | | | | | create two | | | | | hi-entries of | | | | | History-Info | | | | | header field | | | | | to carry both | | | | | Redirection | | | | | number and | | | | | Redirecting | | | | | reason. Since | | | | | the original | | | | | called number | | | | | is not | | | | | available from | | | | | the ISUP | | | | | message a | | | | | hi-t | | | | | argeted-to-uri | | | | | set to an | | | | | \"Unknown User | | | | | Identity\" is | | | | | included in | | | | | the first | | | | | entry. Only | | | | | two entries | | | | | are provided | | | | | because the | | | | | number of | | | | | diversions is | | | | | not available. | | | | | | | | | | NOTE 2: The | | | | | \" | | | | | History-Info\" | | | | | header field | | | | | may contain an | | | | | \"Unknown User | | | | | Identity\". An | | | | | \"Unknown User | | | | | Identity\" | | | | | includes | | | | | information | | | | | that does not | | | | | point to the | | | | | served user | | | | | and indicates | | | | | that the | | | | | user\'s | | | | | identity is | | | | | unknown. The | | | | | encoding of | | | | | the \"Unknown | | | | | User | | | | | Identity\" | | | | | shall be as | | | | | defined in | | | | | 3GPP TS | | | | | 23.003 [74]. | | | | +----------------+----------------+----------------+----------------+
### 7.4.7 Void
### 7.4.8 Explicit Call Transfer (ECT)
When the MGCF receives a FAC message with Generic notification indicator coded
as \"Call transfer active\" or \"call transfer alerting\" and a CPG with
Generic notification indicator coded as \"Remote hold\" was received
previously for the current communication, the action described in table 24be
applies. In all other cases the actions of the MGCF at the ISUP/BICC side are
described in ITU-T Recommendation Q.732.7 [42] under the clause \"Interactions
with other networks\".
Table 24be: Mapping between ISUP and SIP for the Explicit Communication
Transfer supplementary service
* * *
ISUP message Mapping FAC with a \"call transfer, active\" or \"call transfer,
alerting\" Generic notification indicator As described for CPG message with a
\"remote retrieval\" Generic notification indicator in Clause 7.4.10.2
* * *
### 7.4.9 Call Waiting
The actions of the MGCF at the ISUP/BICC side are described in ITU-T Q.733.1
[42] under the clause \"Interactions with other networks\".
### 7.4.10 Call Hold
The service is interworked as indicated in 3GPP TS 23.228 [12].
#### 7.4.10.1 Session hold initiated from the IM CN subsystem side
The IMS network makes a hold request by sending an UPDATE or re-INVITE request
containing an SDP offer with:
\- an \"_a=inactive_ \" SDP attribute if the stream was a \"_recvonly_ \"
media stream; or
\- an \"_a=sendonly_ \" SDP attribute if the stream was a \"_sendrecv_ \"
media stream.
Upon receipt of the hold request from the IMS network, the MGCF shall send a
CPG message to the CS side with a \"_remote hold_ \" _Generic notification
indicator_. Towards the IMS network the MGCF shall send a 200 OK final
response containing an SDP answer with:
\- an \"_a=inactive_ \" SDP attribute if the received SDP offer contained an
\"_a=inactive_ \" SDP attribute; or
\- an \"_a=recvonly_ \" SDP attribute if the received SDP offer contained an
\"_a=sendonly_ \" SDP attribute.
To resume the session, the IMS network sends an UPDATE or re-INVITE request
containing an SDP offer with:
\- an \"_a=recvonly_ \" SDP attribute if the stream was an \"_inactive_ \"
media stream; or
\- an \"_a=sendrecv_ \" SDP attribute or without any direction SDP attribute
(\"_a=sendrecv_ \"_,_ \"_a=recvonly_ \"_,_ \"_a=sendonly_ \"_,_ \"_a=inactive_
\") if the stream was a \"_sendonly_ \" media stream.
Upon receipt of the resume request from the IMS network, the MGCF shall send a
CPG message to the CS side with a \"_remove retrieval_ \" _Generic
notification indicator_. Towards the IMS network the MGCF shall send a 200 OK
final response containing an SDP answer with:
\- an \"_a=sendonly_ \" SDP attribute if the received SDP offer contained an
\"_a=recvonly_ \" SDP attribute; or
\- an \"_a=sendrecv_ \" SDP attribute or without any direction SDP attribute
(\"_a=sendrecv_ \"_,_ \"_a=recvonly_ \"_,_ \"_a=sendonly_ \"_,_ \"_a=inactive_
\") if the received SDP offer contained an \"_a=sendrecv_ \" SDP attribute.
However, the I-MGCF shall not send a CPG message upon reception of SDP offer
containing \"_a=inactive_ \" SDP attribute within an initial INVITE request
establishing a new SIP dialogue and upon reception of the first subsequent SDP
offer activating those media.
The user plane interworking of the hold/resume request is described in the
clause 9.2.9.
Figure 30a: Session hold/resume initiated from the IM CN subsystem side
#### 7.4.10.2 Session hold initiated from the CS network side
If an MGCF receives a CPG message with a \"_remote hold_ \" _Generic
notification indicator_ and there is no dialog established towards the IMS UE
the MGCF shall send, when the first dialog is established, an UPDATE or re-
INVITE request containing an SDP offer with:
\- an \"_a=sendonly_ \" SDP attribute if the stream on this dialog was a
\"_sendrecv_ \" media stream; or
\- an \"_a=inactive_ \" SDP attribute if the stream on this dialog was a
\"_recvonly_ \" media stream,
NOTE 1: If a media stream directionality towards the IMS UE was \"sendonly\"
or \"inactive\" a call hold request is not interworked.
as described in IETF RFC 3264 [36]. For an early dialog an UPDATE request
shall be used.
When an MGCF receives a CPG message with a \"_remote hold_ \" _Generic
notification indicator_ and the media on the IMS side are \"_sendrecv_ \" or
\"_recvonly_ \", the MGCF shall forward the hold request by sending an UPDATE
request on the early dialog which was last established containing an SDP offer
with:
\- an \"_a=sendonly_ \" SDP attribute if the stream on this dialog was a
\"_sendrecv_ \" media stream;\" or
\- an \"_a=inactive_ \" SDP attribute\" if the stream on this dialog was a
\"_recvonly_ \" media stream,
NOTE 2: If a media stream directionality towards the IMS UE was \"sendonly\"
or \"inactive\" a call hold request is not interworked.
as described in IETF RFC 3264 [36].
If an additional early dialog is established during the \"_remote hold_ \"
condition the MGCF shall send on this new dialog an UPDATE request containing
an SDP offer with an \"_a=sendonly_ \" or an \"_a=inactive_ \" SDP attribute,
depending on media stream directionality on this dialog, as described above.
If an UPDATE request with an SDP offer is received on one of the early dialogs
for a call in the \"_remote hold_ \" condition the MGCF shall send an
appropriate SDP answer. If the MGCF had not invoked a call hold service
towards the IMS on that dialog before, the MGCF shall then send a new UPDATE
request including an SDP offer with an \"_a=sendonly_ \" or an \"_a=inactive_
\" SDP attribute, depending on media stream directionality on this dialog, as
described above.
If an MGCF receives a 200 OK (INVITE) response on an early dialog for the call
in a \"_remote hold_ \" condition and if the MGCF on the dialog where 200 OK
(INVITE) response was received had not invoked a call hold service before, the
MGCF shall send an UPDATE or re-INVITE request (according to implementation
option) containing an SDP offer with an \"_a=_ sendonly\" or an \"_a=_
inactive\" SDP attribute, depending on media stream directionality on this
dialog, as described above. If the Contact header field of the received 200 OK
(INVITE) response contained an \"_isfocus_ \" media feature tag, defined in
IETF RFC 3840 [135], the MGCF shall order the IM-MGW to disconnect the media
towards the IMS.
If the MGCF receives a CPG with _Generic Notification Indicator_ \"_remote
hold_ \" and there is a confirmed dialog on IMS side then the MGCF shall send
a SIP re-INVITE or UPDATE request (according to implementation option)
containing an SDP offer with an \"_a=_ sendonly\" or an \"_a=_ inactive\" SDP
attribute, depending on media stream directionality on this dialog, as
described above.
If the MGCF receives a CPG with a _Generic Notification Indicator_ \"_remote
retrieval_ \" and there is an early dialog on IMS side then a SIP UPDATE
request containing an SDP offer with:
\- an \"_a=recvonly_ \" SDP attribute if the stream was an \"_inactive_ \"
media stream; or
\- an \"_a=sendrecv_ \" SDP attribute or without any direction SDP attribute
(\"_a=sendrecv_ \"_,_ \"_a=recvonly_ \"_,_ \"_a=sendonly_ \"_,_ \"_a=inactive_
\") if the stream was a \"_sendonly_ \" media stream,
shall be sent if the call hold service had been invoked on this early dialog
before. For each subsequent early dialog for which the MGCF receives an 18x
response or an UPDATE request with an SDP offer, the MGCF shall send a SIP
UPDATE request with the SDP offer indicating call retrieval (as described
above) after a possible SDP answer to the SDP offer, if that dialog had
received a call hold indication before.
If the MGCF receives a CPG with _Generic Notification Indicator_ \"_remote
retrieval_ \" and there is a confirmed dialog on IMS side then a SIP re-INVITE
or UPDATE request (according to implementation option) containing an SDP offer
with:
\- an \"_a=recvonly_ \" SDP attribute if the stream was an \"_inactive_ \"
media stream; or
\- an \"_a=sendrecv_ \" SDP attribute if the stream was a \"_sendonly_ \"
media stream,
shall be sent for this dialog only if the call hold service had been invoked
for this dialog before.
If link aliveness information is required at the IM-MGW while the media are on
hold, and RTCP was previously disabled the MGCF should provide modified SDP RR
and RS bandwidth modifiers specified in IETF RFC 3556 [59] within the UPDATE
or re-INVITE request holding and retrieving the media to temporarily enable
RTCP while the media are on hold, as detailed in clause 7.3.1 of 3GPP TS
26.114 [104]. If no link aliveness information is required at the IM-MGW or
RTCP was previously enabled, the MGCF should provide the SDP RR and RS
bandwidth modifiers previously used.
The interworking does not impact the user plane with the following exceptions:
\- the MGCF provides modified SDP RR and RS bandwidth modifiers within the
UPDATE or re-INVITE request;
\- the Contact header of the IMS remote party contains the \"_isfocus_ \"
media feature tag; or
\- the MGCF has identified a speech call as an \"ICS call\" as specified in
clause 7.2.3.1.2.12 or in clause 7.2.3.2.7a.
If the MGCF provides modified SDP RR and RS bandwidth modifiers to the IMS
side, the MGCF shall also provide modified SDP RR and RS bandwidths to the IM-
MGW, as described in the clause 9.2.10.
If there is a confirmed dialog on the IMS side for which the MGCF received the
Contact header of the IMS remote party (in the initial INVITE request or in
the 200 OK (INVITE) response) with the \"_isfocus_ \" media feature tag,
defined in IETF RFC 3840 [135], then upon reception of the CPG message with:
\- a \"_remote hold_ \" _Generic notification indicator_ the MGCF shall
request the IM-MGW to suspend sending media towards the IMS side; or
\- a \"_remote retrieval_ \" _Generic notification indicator_ the MGCF shall
request the IM-MGW to re-establish communication towards the IMS network if
the MGCF requested the IM-MGW to suspend sending media on the \"_remote hold_
\" request,
prior to sending of the UPDATE or re-INVITE request to the IMS side.
NOTE 3: If a participant of a conference invokes a hold request, it is not
desirable to provide an announcement to the conference.
For a speech call that is identified as the \"ICS call\", upon reception of
the CPG message with:
\- a \"_remote hold\"_ _Generic notification indicator_ the MGCF shall request
the IM-MGW to suspend sending media towards the IMS side; or
\- a \"_remote retrieval_ \" _Generic notification indicator_ the MGCF shall
request the IM-MGW to re-establish communication towards the IMS network if
the MGCF requested the IM-MGW to suspend sending media on the \"_remote hold_
\" request,
prior to sending of the UPDATE or re-INVITE request to the IMS side.
Figure 30b: Session hold/resume initiated from the CS network side
### 7.4.11 Call Completion on busy subscriber
The actions of the MGCF at the ISUP/BICC side are described in ITU-T
Recommendation Q.733.3 [42] under the clause \"Interactions with other
networks\".
### 7.4.12 Completion of Calls on No Reply (CCNR)
The actions of the MGCF at the ISUP/BICC side are described in ITU-T
Recommendation Q.733.5 [42] under the clause \"Interactions with other
networks\".
### 7.4.13 Terminal Portability (TP)
Terminal Portability is defined as an ISUP supplementary service within ITU-T
Rec. Q.733.4. [42].
A Suspend message containing the Suspend/Resume indicators set to \"ISDN
subscriber initiated\" shall be treated like a CPG with \"remote hold\" in
Clause 7.4.10 Resume message containing the Suspend/Resume indicators set to
\"ISDN subscriber initiated\" shall be treated like a CPG with \"remote
retrieval\" in Clause 7.4.10.
### 7.4.14 Conference calling (CONF) / Three-Party Service (3PTY)
The default behaviour of the MGCF at the ISUP/BICC side is described in ITU-T
Recommendation Q.734.1[42] under the clause \"Interactions with other
networks\". In addition, the MGCF may apply the interworking from ISUP to SIP
described in Table 24aa.
Alternatively, the MGCF may apply the interworking to the Conference
supplementary service described in clause 7.5.6.
Table 24aa: Mapping between ISUP and SIP for the Conference Calling (CONF) and
Three-Party Service (3PTY) supplementary service
* * *
ISUP message Mapping CPG with a \"Conference established\" Generic
notification indicator As described for CPG message with a \"remote
retrieval\" Generic notification indicator in Clause 7.4.10.2 CPG with a
\"Conference disconnected\" Generic notification indicator As described for
CPG message with a \"remote retrieval\" Generic notification indicator in
Clause 7.4.10.2 CPG with an \"isolated\" Generic notification indicator As
described for CPG message with a \"remote hold\" Generic notification
indicator in Clause 7.4.10.2 CPG with a \"reattached\" Generic notification
indicator As described for CPG message with a \"remote retrieval\" Generic
notification indicator in Clause 7.4.10.2
* * *
### 7.4.15 Void
### 7.4.16 Closed User Group (CUG)
The actions of the MGCF at the ISUP/BICC side are described in ITU-T
Recommendation Q.735.1[42] under the clause 1.5.2.4.2 \"Exceptional
procedures\".
### 7.4.17 Multi-Level Precedence and Pre-emption (MLPP)
The actions of the MGCF at the ISUP/BICC side are described in ITU-T
Recommendation Q.735.3 [42] under the clause \"Interactions with other
networks\".
### 7.4.18 Global Virtual Network Service (GVNS)
The actions of the MGCF at the ISUP/BICC side are described in ITU-T
Recommendation Q.735.6 [42] under the clause \"Interactions with other
networks\".
### 7.4.19 International telecommunication charge card (ITCC)
An International Telecommunication charge card call is a basic call and no
additional treatment is required by the MGCF.
### 7.4.20 Reverse charging (REV)
The actions of the MGCF at the ISUP/BICC side are described in ITU-T
Recommendation Q.736.3 [42] under the clause \"Interactions with other
networks\".
### 7.4.21 User-to-User Signalling (UUS)
#### 7.4.21.0 General
Procedures for the ISDN supplementary service \"User-to-user signalling\" are
specified in ITU‑T Recommendation Q.737.1 [42].
#### 7.4.21.1 User-to-User Signalling (UUS) service 1 (implicit)
##### 7.4.21.1.0 General
The coding of the User-user information element is described within ITU-T
Recommendation Q.931 [149]. The User-user information element is carried
within the ISDN user part parameter user-to-user information, as defined in
ITU-T Recommendation Q.763 [4]. The User-to-User header field is defined
within IETF RFC 7433 [99]. A package for interworking user-to-user information
with the ISDN is defined by IETF RFC 7434 [99A].
##### 7.4.21.1.1 Void
##### 7.4.21.1.2 User-to-user information Interworking from SIP to ISUP
On the receipt of a User-to-User header field with the \"_purpose_ \" header
field parameter set to \"_isdn-uui_ \", or a User-to-User header field without
a \"_purpose_ \" parameter, with \"_encoding_ \" header field parameter set to
\"_hex_ \" or without an \"_encoding_ \" parameter, with \"_content_ \" header
field parameter set to \"_isdn-uui_ \" or without a \"_content_ \" parameter,
that is valid as defined by IETF RFC 7434 [99A], the MGCF shall map the
content of the \"_uui-data_ \" field to the \"_protocol discriminator_ \" and
\"_user information_ \" parameters of the User-user information element.
The \"_length of user-user contents_ \" parameter shall be set by the MGCF
according to the normal procedures.
The MGCF maps the messages transporting the user-to-user information according
to the normal interworking procedures (see table 24ab).
Table 24ab: Mapping of the User-to-User header field to the ISUP user-to-user
information parameter
* * *
SIP parameter   ISUP parameter  
SIP header field Source component value ISUP parameter name ISUP parameter
field User-to-User uui-data User-to-user Protocol discriminator and user
information
* * *
##### 7.4.21.1.3 User-to-user information Interworking from ISUP to SIP
On the receipt of the user-to-user information parameter the MGCF shall map
the protocol discriminator and user information parameter fields to the uui-
data field of the User-to-User header field (see table 24ac).
If sent, the \"_purpose_ \", \"_content_ \" and \"_encoding_ \" header field
parameters are not mapped and are set in accordance with IETF RFC 7434 [99A]
The MGCF maps the messages transporting the user-to-user information
parameters according to the normal interworking procedures.
Table 24ac: Mapping of the ISUP user-to-user information parameter to the
User-to-User header field
* * *
 ISUP parameter  SIP parameter  
ISUP parameter name ISUP parameter field SIP header field Source component
value User-to-user Protocol discriminator and user information User-to-User
uui-data (NOTE) NOTE: The MGCF shall always send uui-data as a token (see IETF
RFC 7433 [99]). The letters used for the hex digits shall always be capital
form.
* * *
#### 7.4.21.2 User-to-User Signalling (UUS) service 1 (explicit)
The actions of the MGCF at the ISUP/BICC side are described in ITU-T
Recommendation Q.737.1 [42] under the clause \"Interaction with other
networks\".
#### 7.4.21.3 User-to-User Signalling (UUS) service 2 (explicit)
The actions of the MGCF at the ISUP/BICC side are described in ITU-T
Recommendation Q.737.1 [42] under the clause \"Interaction with other
networks\".
#### 7.4.21.4 User-to-User Signalling (UUS) service 3 (explicit)
The actions of the MGCF at the ISUP/BICC side are described in ITU-T
Recommendation Q.737.1 [42] under the clause \"Interaction with other
networks\".
### 7.4.22 Multiple Subscriber Number (MSN)
A MSN call is a basic call and no additional treatment is required by the
MGCF.
### 7.4.23 Anonymous Call rejection
#### 7.4.23.0 General
The Anonymous Call rejection (ACR) supplementary service in the CS domain is
described within 3GPP TS 23.088 [134]. The ETSI ACR service is described
within ETSI EN 300 356-21 [71].
#### 7.4.23.1 ISUP-SIP protocol interworking at the I-MGCF
If ISUP Cause Value field in the ISUP REL includes Cause Value 24 _\"call
rejected due to feature at the destination\"_ the I-MGCF shall map this to a
433 (Anonymity Disallowed) SIP response code as described in RFC 5079 [77].
#### 7.4.23.2 SIP-ISUP protocol interworking at the O-MGCF
SIP response code 433 (Anonymity Disallowed) shall be mapped to the ISUP Cause
Value field 24 _\"call rejected due to feature at the destination\"_ in the
ISUP REL.
### 7.4.24 Customized Alerting Tones (CAT) in the 3GPP CS domain
The Customized Alerting Tones (CAT) in the 3GPP CS domain service is described
in 3GPP TS 23.205 [27].
To pass CAT early media from the CS network towards the IM CN subsystem, no
special interworking procedures beyond basic call at the I-MGCF are required.
The procedure to supply the \"P-Early-Media\" header field is described in
clause 7.2.3.1.4, clause 7.2.3.1.4A and clause 7.2.3.1.4B.
## 7.5 IMS Supplementary Services
The following clauses describe the MGCF behaviour related to supplementary
services as defined in ITU-T Recommendations Q.730 to ITU-T Q.737 [42] when
interworking with an IMS which uses a Multimedia Telephony Application Server
(MTAS) providing supplementary services according to 3GPP TS 24.173 [88]. The
support of the related procedures is optional.
### 7.5.1 Originating Identification Presentation (OIP) and Originating
Identification Restriction (OIR)
The mapping of Originating Identification Presentation (OIP) and Originating
Identification Restriction (OIR); supplementary service with the CLIP/CLIR
PSTN/ISDN Supplementary Service is the same mapping as described in clause
7.4.1. The Service itself is described within 3GPP TS 24.607 [63].
### 7.5.2 Terminating Identification Presentation (TIP) and Terminating
Identification Restriction (TIR)
#### 7.5.2.1 General
The protocol specification of the Terminating Identification Presentation and
Terminating Identification Restriction supplementary services is described in
3GPP TS 24.608 [64].
The procedures for mapping of the connected number described within clause
7.4.2 shall apply.
#### 7.5.2.2 Interworking at the O-MGCF
For the mapping of IAM to the INVITE request:
If an Optional forward call indicators parameter in the IAM is received where
the bit H Connected line identity request indicator is set to \"requested\",
then the option tag \"from-change\" shall be add to the Supported header
field. See table 7.5.2.2.1.
Table 7.5.2.2.1: Mapping of ISUP IAM to SIP INVITE request
* * *
ISUP Parameter Derived value of parameter field Source SIP header field and
component Source Component value Optional forward call indicator _Connected
line identity request indicator_ is set to \"requested\" Supported \"from-
change\"
* * *
NOTE: The presence of \"from-change\" enables the reception of Generic Number
with Number qualifier parameter field set to additional connected, if
available. As per 3GPP TS 24.608 [64] the presence of \"from-change\" tag is
not a criterion for TIP service.
If a provisional or final response including the option tag \"from-change\" is
received, then the O-MGCF shall:
\- if a 200 (OK) response to the INVITE request is received, start timer
T~TIR1~; and
\- store the 200 (OK) response, without interworking it.
Otherwise the 200 (OK) response (to the INVITE request) shall be mapped as
described in clause 7.2.3.2.7a.
If an UPDATE request is received containing a changed From header field before
the timer TTIR1 expired, then the O‑MGCF shall:
\- stop timer T~TIR1;~
\- map the From header field received in the UPDATE request to the Generic
number in the ANM as shown in table 7.5.2.2.2 and table 7.5.2.2.3;
\- if the UPDATE request includes a P-Asserted-Identity header field that is
different from the one within the stored 200 (OK) response, the latest
received P-Asserted-Identity header field shall be mapped to the connected
number as described table 24; and
\- map the parameters needed to be mapped of the stored 200 (OK) response to
an ANM as described in clause 7.4.2.2.3, modified by the changed mapping steps
of the From and P-Asserted-Identity header fields.
When T~TIR1~ expires, then the stored 200 (OK) response (to the INVITE
request) response shall be mapped as described in clause 7.4.2.2.3.
Table 7.5.2.2.2: Mapping of SIP UPDATE request to ISUP ANM/CON
* * *
ANM/CON UPDATE Generic number From header field
* * *
Table 7.5.2.2.3: Mapping of SIP From header field to ISUP Generic Number\
(\"additional connected number\") parameter
+----------------+----------------+----------------+----------------+ | Source SIP | Source | Generic Number | Derived value | | header field | component | parameter | of parameter | | and component | value | field | field | +----------------+----------------+----------------+----------------+ | - | - | Number | \"_additional | | | | Qualifier | connected | | | | Indicator | number_ \" | +----------------+----------------+----------------+----------------+ | From, userinfo | CC | Nature of | If CC is equal | | component of | | Address | to the country | | URI assumed to | | Indicator | code of the | | be in form\ | | | country where | | \"+\" CC + NDC | | | I‑MGCF is | | + SN | | | located AND | | | | | the next ISUP | | | | | node is | | | | | located in the | | | | | same country, | | | | | then set to | | | | | _\"national | | | | | (significant) | | | | | number\"_ else | | | | | set to | | | | | \" | | | | | _international | | | | | number_ \" | +----------------+----------------+----------------+----------------+ | - | - | Number | \"_complete_ \" | | | | Incomplete | | | | | Indicator | | +----------------+----------------+----------------+----------------+ | - | - | Numbering Plan | \"_ISDN | | | | Indicator | (Telephony) | | | | | numbering plan | | | | | ( | | | | | Recommendation | | | | | E.164)_ \" | +----------------+----------------+----------------+----------------+ | Privacy, | Privacy header | Address | \ | | priv‑value | field absent | Presentation | "_presentation | | component | | Restricted | allowed_ \" | | | | Indicator | | | | | (APRI) | | +----------------+----------------+----------------+----------------+ | | \"_none_ \" | | \ | | | | | "_presentation | | | | | allowed_ \" | +----------------+----------------+----------------+----------------+ | | \"_header_ \" | | \ | | | | | "_presentation | | | | | allowed_ \" | +----------------+----------------+----------------+----------------+ | | \"_user_ \" | | \ | | | | | "_presentation | | | | | restricted_ \" | +----------------+----------------+----------------+----------------+ | | _\"id\"_ | | \ | | | | | "_presentation | | | | | allowed_ \" | +----------------+----------------+----------------+----------------+ | - | - | Screening | \"_user | | | | Indicator | provided, not | | | | | verified_ \" | +----------------+----------------+----------------+----------------+ | From, userinfo | CC, NDC, SN | Address | If NOA is | | component | | Signals | \"_national | | assumed to be | | | (significant) | | in form\ | | | number_ \" then | | \"+\" CC + NDC | | | set to | | + SN | | | | | | | | NDC + SN. | | | | | | | | | | If NOA is | | | | | \" | | | | | _international | | | | | number_ \" | | | | | | | | | | then set to CC | | | | | + NDC + SN | +----------------+----------------+----------------+----------------+
#### 7.5.2.3 Interworking at the I-MGCF
For the mapping of INVITE request to IAM:
\- the bit H _Connected line identity request indicator_ of the Optional
forward call indicators parameter in the IAM shall be set to \"requested\".
Table 7.5.2.3.1: Void
If a received ISUP ANM includes an ISUP Generic Number (\"additional connected
number\") parameter, then the\ I-MGCF shall send a 200 (OK) response (to the
INVITE request) including an option tag \"from-change\" If the initial INVITE
was received and the Supported header field contains the \"from-change\" tag,
the 200 (OK) response is followed by an UPDATE request, containing the
\"additional connected number\" copied into the From header field as shown in
table 7.5.2.3.2.
The To header field of the UPDATE request is derived from the P-Asserted-
Identity header field received within the initial INVITE request.
Table 7.5.2.3.2: Mapping of ANM Generic Number (\"additional connected
number\")\ to SIP From header field in a SIP UPDATE request
+----------------+----------------+----------------+----------------+ | ISUP | Value | SIP component | Value | | P | | | | | arameter/field | | | | +----------------+----------------+----------------+----------------+ | Generic Number | \"_additional | From header | display‑name | | | connected | field | (optional) and | | Number | number_ \" | | addr‑spec | | Qualifier | | | | | Indicator | | | | +----------------+----------------+----------------+----------------+ | Nature of | _\"national | Addr‑spec | Add \"+\" CC | | Address | (significant) | | (of the | | Indicator | number\"_ | | country where | | | | | the IWU is | | | | | located) to | | | | | Generic Number | | | | | Address | | | | | Signals then | | | | | map to user | | | | | portion of URI | | | | | scheme used | +----------------+----------------+----------------+----------------+ | | _\ | | Map complete | | | "international | | Generic Number | | | number\"_ | | Address | | | | | Signals used | | | | | prefixed with | | | | | a \"+\" to | | | | | user portion | | | | | of URI scheme | | | | | used | +----------------+----------------+----------------+----------------+ | Address | \ | []{.underline} | No Privacy | | Presentation | "_presentation | | header field | | restriction | allowed_ \" | | or not | | indicator | | | \"_user_ \" | | (APRI) | | | | +----------------+----------------+----------------+----------------+ | []{.underline} | \ | []{.underline} | \"_user_ \" | | | "_presentation | | | | | restricted_ \" | | | +----------------+----------------+----------------+----------------+ | Address | if NOA is | Display‑name | display‑name | | Signals | \"_national | (optional) | shall be | | | (significant) | | mapped from | | | number\"_ then | | Address | | | the format of | | Signals, if | | | the address | | network policy | | | signals is: | | allows it | | | | | | | | NDC + SN | | | | | | | | | | If NOA is | | | | | \" | | | | | _international | | | | | number\"_ | | | | | | | | | | then the | | | | | format of the | | | | | address | | | | | signals is: | | | | | | | | | | CC + NDC + SN | | | +----------------+----------------+----------------+----------------+ | | | Addr‑spec | \"+\" CC NDC | | | | | SN mapped to | | | | | user portion | | | | | of URI scheme | | | | | used | +----------------+----------------+----------------+----------------+
A received connected number in an ANM shall be mapped to the P-Asserted-
Identity header field as shown in table 21 of the UPDATE request.
#### 7.5.2.4 Timer
Table 7.5.2.4.1 TIR timer definition
* * *
Symbol Timeout\ Cause for initiation Normal termination At expiry value
T~TIR1~ 100 - 2000 milliseconds (default 100 milliseconds) On receipt of
provisional or final response including the option tag \"from-change\" At the
receipt of an UPDATE map the received 200OK to an ANM
* * *
### 7.5.3 void
### 7.5.4 Communication Diversion (CDIV)
#### 7.5.4.1 General
The protocol specification of the Communication Diversion supplementary
service is described in 3GPP TS 24.604 [60]. The mapping of Communication
Diversion supplementary service with Call Diversion services PSTN/ISDN
supplementary service including the mapping of the optional History-Info
header field as defined in IETF RFC 7044 [91] is described.
The hi-target-param \"mp\" header field parameter as defined in IETF RFC 7044
[91] indicates that the target of the Request-URI was changed.
In case of interworking with networks which do not provide any notification of
the communication diversion or communication redirection information (e.g.
redirection counter) in the signalling system, the communication continues
according to the basic call procedures.
In case of interworking with networks not supporting IETF RFC 7044 [91] the
\"mp\" header field parameter may not appear.
#### 7.5.4.2 Interworking at the O-MGCF
##### 7.5.4.2.1 General
For the mapping of IAM to the INVITE request no additional procedures beyond
the basic call and interworking procedures are needed unless Call Diversion
services within the ISUP Network appeared as described in clause 7.5.4.2.2.
With regard to the backward messages the following mapping is valid.
Table 7.5.4.2.1.1: Mapping of SIP messages to ISUP messages
* * *
←Message sent to ISUP ←Message Received from SIP  
ACM indicating call forwarding 181 (Call Is Being Forwarded) response See
table 7.5.4.2.1.6 CPG indicating call forwarding (see NOTE) 181 (Call Is Being
Forwarded) response See table 7.5.4.2.1.7 ACM indicating ringing 180 (Ringing)
response See table 7.5.4.2.1.8 CPG indicating alerting (see NOTE) 180
(Ringing) response See table 7.5.4.2.1.9 ANM 200 (OK) response See table
7.5.4.2.1.10 CON 200 (OK) response (Neither a 181 (Call Is Being Forwarded)
response nor a 180 (Ringing) response was received) See table 7.5.4.2.1.10
NOTE: A CPG will be sent if an ACM was already sent.
* * *
Table 7.5.4.2.1.2: Mapping of History-Info header field to ISUP Redirection
number
+----------------+----------------+----------------+----------------+ | Source SIP | Source | Redirection | Derived value | | header field | Component | number | of parameter | | and component | value | | field | +----------------+----------------+----------------+----------------+ | hi-t | CC | Nature of | If CC is equal | | argeted-to-uri | | address | to the country | | of the last | | indicator | code of the | | History-Info | | | country where | | hi-entry | | | O‑MGCF is | | containing a | | | located AND | | \"cause\" URI | | | the next ISUP | | parameter, as | | | node is | | defined in | | | located in the | | IETF RFC 4458 | | | same country, | | [113]. | | | then set to | | (NOTE 2) | | | "_national | | | | | (significant) | | The global | | | number_ " else | | number portion | | | set to | | of the | | | " | | hi-t | | | _international | | argeted-to-uri | | | number_ ". | | is assumed to | | | | | be in form\ | | | | | "+" CC + NDC + | | | | | SN.(NOTE 1) | | | | +----------------+----------------+----------------+----------------+ | | CC, NDC, SN | Address | If NOA is | | | | signals | "_national | | | | | (significant) | | | | | number_ " then | | | | | set to NDC + | | | | | SN. | | | | | | | | | | If NOA is | | | | | " | | | | | _international | | | | | number_ " | | | | | | | | | | then set to CC | | | | | + NDC + SN. | +----------------+----------------+----------------+----------------+ | NOTE 1: If the | | | | | SIP URI | | | | | doesn't | | | | | contain | | | | | " | | | | | _user=phone_ ", | | | | | mapping to | | | | | redirection | | | | | number is | | | | | impossible, | | | | | therefore no | | | | | need to | | | | | generate | | | | | Redirection | | | | | number and | | | | | Redirection | | | | | number | | | | | restriction | | | | | parameter (per | | | | | table | | | | | 7.5.4.2.1.3), | | | | | Notification | | | | | subscription | | | | | options can't | | | | | be set as | | | | | "presentation | | | | | allowed with | | | | | redirection | | | | | number". | | | | | | | | | | NOTE 2: The | | | | | h | | | | | i-target-param | | | | | parameter set | | | | | to \"mp\" as | | | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | indicates that | | | | | the target of | | | | | the | | | | | Request-URI | | | | | was changed | | | | | and appears in | | | | | this | | | | | hi-ta | | | | | rgeted-to-uri. | | | | | In case of | | | | | interworking | | | | | with networks | | | | | not supporting | | | | | IETF R | | | | | FC 7044 [91] | | | | | the \"mp\" | | | | | header field | | | | | parameter may | | | | | not appear. | | | | +----------------+----------------+----------------+----------------+
Table 7.5.4.2.1.3: Mapping of History-Info header field to ISUP Redirection
number restriction
+----------------+----------------+----------------+----------------+ | Source SIP | Source | Redirection | Derived value | | header field | Component | number | of parameter | | and component | value | restriction | field | +----------------+----------------+----------------+----------------+ | Privacy | "_history_ " or | Presentation | "_Presentation | | \"headers\" | "_ session _" or | restricted | restricted_ " | | component of | "_header_ " | indicator | | | the | | | | | hi-t | | | | | argeted-to-uri | | | | | or/and Privacy | | | | | header field | | | | +----------------+----------------+----------------+----------------+ | | Privacy | | "_Presentation | | | \"headers\" | | allowed_ " or | | | component of | | absent | | | the | | | | | hi-t | | | | | argeted-to-uri | | | | | and Privacy | | | | | header field | | | | | absent | | | | | | | | | | or "_none_ " | | | +----------------+----------------+----------------+----------------+
Table 7.5.4.2.1.4: Mapping of hi-targeted-to-uri to ISUP Call diversion
information
+----------------+----------------+----------------+----------------+ | Source SIP | Source | Call diversion | Derived value | | header field | Component | information | of parameter | | and component | value | | field | +----------------+----------------+----------------+----------------+ | Privacy | | Notification | If the | | \"headers\" | | subscription | priv-value | | component of | | options | "_history_ " or | | the | | | "_session_ " or | | hi-t | | | "_header_ " is | | argeted-to-uri | | | received | | or/and Privacy | | | within the | | header field | | | Privacy header | | | | | field or the | | | | | priv-value | | | | | \"_history_ \" | | | | | is received | | | | | within the | | | | | \"headers\" | | | | | component of | | | | | the | | | | | hi-t | | | | | argeted-to-uri | | | | | representing | | | | | the diverting | | | | | URI(s) and | | | | | within the | | | | | hi-t | | | | | argeted-to-uri | | | | | representing | | | | | diverted-to | | | | | URI then | | | | | "_presentation | | | | | not allowed"_ | | | | | shall be set. | | | | | | | | | | Otherwise, if | | | | | the priv-value | | | | | "_history_ " is | | | | | received only | | | | | within the | | | | | \"headers\" | | | | | component of | | | | | the | | | | | hi-t | | | | | argeted-to-uri | | | | | representing | | | | | the | | | | | diverted-to | | | | | URI then | | | | | "_presentation | | | | | allowed | | | | | without | | | | | redirection | | | | | number"_ shall | | | | | be set. | | | | | (NOTE 1, | | | | | NOTE 2) | | | | | | | | | | Otherwise, | | | | | \ | | | | | "_presentation | | | | | allowed with | | | | | redirection | | | | | number\"_ | | | | | shall be set. | +----------------+----------------+----------------+----------------+ | \"cause\" URI | **Cause | Redirecting | | | parameter, as | value** | reason | | | defined in | | | | | IETF RFC | | | | | 4458 [113] | | | | | of the last | | | | | History-Info | | | | | hi-entry | | | | | containing | | | | | hi-t | | | | | argeted-to-uri | | | | | with \"cause\" | | | | | URI parameter. | | | | | (NOTE 3) | | | | +----------------+----------------+----------------+----------------+ | | _404_ | | _Unknown_ | +----------------+----------------+----------------+----------------+ | | 302 | | * | | | | | Unconditional _| +----------------+----------------+----------------+----------------+ | | 486 | |_ User busy _| +----------------+----------------+----------------+----------------+ | | 408 | |_ No reply _| +----------------+----------------+----------------+----------------+ | | 480 | |_ Deflection | | | | | immediate | | | | | response _| +----------------+----------------+----------------+----------------+ | | 503 | |_ Mobile | | | | | subscriber not | | | | | reachable _| +----------------+----------------+----------------+----------------+ | | 487 | |_ Deflection | | | | | during | | | | | alerting* | +----------------+----------------+----------------+----------------+ | NOTE 1: | | | | | diverting URI | | | | | corresponds to | | | | | the | | | | | hi-t | | | | | argeted-to-uri | | | | | of the | | | | | hi-entry | | | | | containing a | | | | | hi-index value | | | | | that match the | | | | | \"mp\" header | | | | | field | | | | | parameter | | | | | value of the | | | | | diverted-to | | | | | URI. If the | | | | | diverted-to | | | | | URI does not | | | | | contain the | | | | | \"mp\" header | | | | | field | | | | | parameter, the | | | | | diverting URI | | | | | corresponds to | | | | | the | | | | | hi-t | | | | | argeted-to-uri | | | | | of the | | | | | hi-entry | | | | | before the | | | | | last hi-entry | | | | | containing | | | | | \"cause\" URI | | | | | parameter. | | | | | | | | | | NOTE 2: | | | | | diverted-to | | | | | URI | | | | | corresponds to | | | | | the | | | | | hi-t | | | | | argeted-to-uri | | | | | of the last | | | | | hi-entry | | | | | containing | | | | | \"cause\" URI | | | | | parameter and | | | | | is mapped to | | | | | the | | | | | Redirection | | | | | number, see | | | | | tabl | | | | | e 7.5.4.2.1.2. | | | | | | | | | | NOTE 3: The | | | | | h | | | | | i-target-param | | | | | parameter set | | | | | to \"mp\" as | | | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | indicates that | | | | | the target of | | | | | the | | | | | Request-URI | | | | | was changed | | | | | and appears in | | | | | this | | | | | hi-ta | | | | | rgeted-to-uri. | | | | | In case of | | | | | interworking | | | | | with networks | | | | | not supporting | | | | | IETF R | | | | | FC 7044 [91] | | | | | the \"mp\" | | | | | header field | | | | | parameter may | | | | | not appear. | | | | +----------------+----------------+----------------+----------------+
Table 7.5.4.2.1.5: Void
Table 7.5.4.2.1.6: Mapping of 181 (Call Is Being Forwarded)  ACM if no ACM
was sent before
+----------------+----------------+----------------+----------------+ | Source SIP | Source | ISUP Parameter | Derived value | | header field | Component | | of parameter | | and component | value | | field | +----------------+----------------+----------------+----------------+ | 181 (Call Is | | ACM | | | Being | | | | | Forwarded) | | | | +----------------+----------------+----------------+----------------+ | | | Generic | _Call is | | | | notification | diverting_ | | | | indicator | | | | | | | | | | _Notification | | | | | indicator_ | | +----------------+----------------+----------------+----------------+ | History-Info | See table | Redirection | See table | | header field | 7.5.4.2.1.2 | number | 7.5.4.2.1.2 | +----------------+----------------+----------------+----------------+ | Privacy | See table | Redirection | See table | | \"headers\" | 7.5.4.2.1.3 | number | 7.5.4.2.1.3 | | component of | | restriction | | | the | | | | | hi-t | | | | | argeted-to-uri | | | | | or/and Privacy | | | | | header field | | | | +----------------+----------------+----------------+----------------+ | Privacy | See table | Call diversion | See table | | \"headers\" | 7.5.4.2.1.4 | information | 7.5.4.2.1.4 | | component of | | _Notification | | | the | | subscription | | | hi-t | | options_ | | | argeted-to-uri | | | | | or/and Privacy | | | | | header field | | | | +----------------+----------------+----------------+----------------+ | hi-ta | See table | Call diversion | See table | | rgeted-to-uri; | 7.5.4.2.1.4 | information | 7.5.4.2.1.4 | | \"cause\" URI | | _Redirecting | | | parameter as | | reason_ | | | defined in | | | | | IETF RFC 4458 | | | | | [113] of the | | | | | last | | | | | History-Info | | | | | hi-entry | | | | | containing | | | | | such \"cause\" | | | | | URI parameter. | | | | | (NOTE) | | | | +----------------+----------------+----------------+----------------+ | NOTE: The | | | | | h | | | | | i-target-param | | | | | parameter set | | | | | to \"mp\" as | | | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | indicates that | | | | | the target of | | | | | the | | | | | Request-URI | | | | | was changed | | | | | and appears in | | | | | this | | | | | hi-ta | | | | | rgeted-to-uri. | | | | | In case of | | | | | interworking | | | | | with networks | | | | | not supporting | | | | | IETF R | | | | | FC 7044 [91] | | | | | the \"mp\" | | | | | header field | | | | | parameter may | | | | | not appear. | | | | +----------------+----------------+----------------+----------------+
Table 7.5.4.2.1.7: Mapping of 181 (Call Is Being Forwarded) CPG if ACM was
already sent
+----------------+----------------+----------------+----------------+ | Source SIP | Source | ISUP Parameter | Derived value | | header field | Component | | of parameter | | and component | value | | field | +----------------+----------------+----------------+----------------+ | 181 (Call Is | | CPG | | | Being | | | | | Forwarded) | | | | | response | | | | +----------------+----------------+----------------+----------------+ | | | Generic | _Call is | | | | notification | diverting_ | | | | indicator | | | | | | | | | | _Notification | | | | | indicator_ | | +----------------+----------------+----------------+----------------+ | \"cause\" URI | 486 | Event | _CFB_ | | parameter, as | | information | (national use) | | defined in | | | | | IETF RFC 4458 | | Event | | | [113] of the | | indicator | | | last | | | | | History-Info | | | | | hi-entry | | | | | containing | | | | | hi-t | | | | | argeted-to-uri | | | | | with \"cause\" | | | | | URI parameter. | | | | | (NOTE 2) | | | | +----------------+----------------+----------------+----------------+ | | 408 (see | | _CFNR_ | | | NOTE 1) | | (national use) | +----------------+----------------+----------------+----------------+ | | 302 | | _CFU_ | | | | | (national use) | +----------------+----------------+----------------+----------------+ | | Any other | | _PROGRESS_ | | | value, or if | | | | | appropriate | | | | | \"national | | | | | use\" value | | | | | (CFB, CFNR or | | | | | CFU) is not | | | | | used in a | | | | | network. or if | | | | | no agreement | | | | | exists between | | | | | operators to | | | | | use these | | | | | values, or if | | | | | no | | | | | hi-t | | | | | argeted-to-uri | | | | | with \"cause\" | | | | | URI parameter | | | | | is contained | | | | | in the SIP | | | | | 181. | | | +----------------+----------------+----------------+----------------+ | History-Info | See table | Redirection | See table | | header field | 7.5.4.2.1.2 | number | 7.5.4.2.1.2 | +----------------+----------------+----------------+----------------+ | Privacy | See table | Redirection | See table | | \"headers\" | 7.5.4.2.1.3 | number | 7.5.4.2.1.3 | | component of | | restriction | | | the | | | | | hi-t | | | | | argeted-to-uri | | | | | or/and Privacy | | | | | header field | | | | +----------------+----------------+----------------+----------------+ | Privacy | See table | Call diversion | See table | | \"headers\" | 7.5.4.2.1.4 | information | 7.5.4.2.1.4 | | component of | | _Notification | | | the | | subscription | | | hi-t | | options_ | | | argeted-to-uri | | | | | or/and Privacy | | | | | header field | | | | +----------------+----------------+----------------+----------------+ | hi-ta | See table | Call diversion | See table | | rgeted-to-uri; | 7.5.4.2.1.4 | information | 7.5.4.2.1.4 | | \"cause\" URI | | _Redirecting | | | parameter, as | | reason_ | | | defined in | | | | | IETF RF | | | | | C 4458 [113] | | | | | of the last | | | | | History-Info | | | | | hi-entry | | | | | containing | | | | | such \"cause\" | | | | | URI parameter. | | | | | (NOTE 2) | | | | +----------------+----------------+----------------+----------------+ | NOTE 1: This | | | | | appears in the | | | | | cases of CFNR. | | | | | | | | | | NOTE 2: The | | | | | h | | | | | i-target-param | | | | | parameter set | | | | | to \"mp\" as | | | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | indicates that | | | | | the target of | | | | | the | | | | | Request-URI | | | | | was changed | | | | | and appears in | | | | | this | | | | | hi-ta | | | | | rgeted-to-uri. | | | | | In case of | | | | | interworking | | | | | with networks | | | | | not supporting | | | | | IETF R | | | | | FC 7044 [91] | | | | | the \"mp\" | | | | | header field | | | | | parameter may | | | | | not appear. | | | | +----------------+----------------+----------------+----------------+
Table 7.5.4.2.1.8: Mapping of 180 (Ringing)  ACM if no ACM was sent before
+----------------+----------------+----------------+----------------+ | Source SIP | Source | ISUP Parameter | Derived value | | header field | Component | | of parameter | | and component | value | | field | +----------------+----------------+----------------+----------------+ | 180 (Ringing) | | ACM | | | response | | | | +----------------+----------------+----------------+----------------+ | History-Info | If | Generic | _Call is | | header field | hi-t | notification | diverting_ | | | argeted-to-uri | indicator | | | | of at least | | | | | one | _Notification | | | | History-Info | indicator_ | | | | hi-entry | | | | | contains a | | | | | \"cause\" URI | | | | | parameter, as | | | | | defined in | | | | | IETF RFC 4458 | | | | | [113]. | | | +----------------+----------------+----------------+----------------+ | History-Info | See table | Redirection | See table | | header field | 7.5.4.2.1.2 | number | 7.5.4.2.1.2 | | | | (NOTE 1) | | +----------------+----------------+----------------+----------------+ | Privacy | See table | Redirection | See table | | \"headers\" | 7.5.4.2.1.3 | number | 7.5.4.2.1.3 | | component of | | restriction | | | the | | (NOTE 1) | | | hi-t | | | | | argeted-to-uri | | | | | or/and Privacy | | | | | header field | | | | +----------------+----------------+----------------+----------------+ | Privacy | See table | Call diversion | See table | | \"headers\" | 7.5.4.2.1.4 | information | 7.5.4.2.1.4 | | component of | | _Notification | | | the | | subscription | | | hi-t | | options_ (NOTE | | | argeted-to-uri | | 1) | | | or/and Privacy | | | | | header field | | | | +----------------+----------------+----------------+----------------+ | hi-ta | See table | Call diversion | See table | | rgeted-to-uri; | 7.5.4.2.1.4 | information | 7.5.4.2.1.4 | | \"cause\" URI | | _Redirecting | | | parameter, as | | reason_ | | | defined in | | (NOTE 1) | | | IETF RFC 4458 | | | | | [113] of the | | | | | last | | | | | History-Info | | | | | hi-entry | | | | | containing | | | | | such \"cause\" | | | | | URI parameter. | | | | | (NOTE 2) | | | | +----------------+----------------+----------------+----------------+ | NOTE 1: | | | | | Parameter | | | | | shall only be | | | | | supplied if | | | | | hi-t | | | | | argeted-to-uri | | | | | of at least | | | | | one | | | | | History-Info | | | | | hi-entry | | | | | contains a | | | | | \"cause\" URI | | | | | parameter, as | | | | | defined in | | | | | IETF RFC 4458 | | | | | [113]. | | | | | | | | | | NOTE 2: The | | | | | h | | | | | i-target-param | | | | | parameter set | | | | | to \"mp\" as | | | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | indicates that | | | | | the target of | | | | | the | | | | | Request-URI | | | | | was changed | | | | | and appears in | | | | | this | | | | | hi-ta | | | | | rgeted-to-uri. | | | | | In case of | | | | | interworking | | | | | with networks | | | | | not supporting | | | | | IETF R | | | | | FC 7044 [91] | | | | | the \"mp\" | | | | | header field | | | | | parameter may | | | | | not appear. | | | | +----------------+----------------+----------------+----------------+
The mapping described within table 7.5.4.2.1.8 can only appear if the
communication has already undergone a Communications diversion in the IMS and
the 180 (Ringing) is the first provisional response sent in backward
direction.
The O-MGCF can indicate the call diversion information in the mapping of the
180 (Ringing) provisional response to a CPG message in fact if the response
before was a 181 (Call Is Being Forwarded).
Table 7.5.4.2.1.9: Mapping of 180 (Ringing)  CPG if ACM was already sent
+----------------+----------------+----------------+----------------+ | Source SIP | Source | ISUP Parameter | Derived value | | header field | Component | | of parameter | | and component | value | | field | +----------------+----------------+----------------+----------------+ | 180 (Ringing) | | CPG | | | response | | | | +----------------+----------------+----------------+----------------+ | History-Info | If | Generic | _Call is | | header field | hi-t | notification | diverting_ | | | argeted-to-uri | indicator | | | | of at least | | | | | one | _Notification | | | | History-Info | indicator_ | | | | hi-entry | | | | | contains a | | | | | \"cause\" URI | | | | | parameter, as | | | | | defined in | | | | | IETF RFC 4458 | | | | | [113]. | | | +----------------+----------------+----------------+----------------+ | | | Event | _ALERTING_ | | | | information | | | | | | | | | | Event | | | | | indicator | | +----------------+----------------+----------------+----------------+ | History-Info | See table | Redirection | See table | | header field | 7.5.4.2.1.2 | number | 7.5.4.2.1.2 | | | | | | | | | (NOTE 1) | | +----------------+----------------+----------------+----------------+ | Privacy | See table | Redirection | See table | | \"headers\" | 7.5.4.2.1.3 | number | 7.5.4.2.1.3 | | component of | | restriction | | | the | | (NOTE 1) | | | hi-t | | | | | argeted-to-uri | | | | | or/and Privacy | | | | | header field | | | | +----------------+----------------+----------------+----------------+ | Privacy | See table | Call diversion | See table | | \"headers\" | 7.5.4.2.1.4 | information | 7.5.4.2.1.4 | | component of | | _Notification | | | the | | subscription | | | hi-t | | options_ | | | argeted-to-uri | | (NOTE 1) | | | or/and Privacy | | | | | header field | | | | +----------------+----------------+----------------+----------------+ | hi-ta | See table | Call diversion | See table | | rgeted-to-uri; | 7.5.4.2.1.4 | information | 7.5.4.2.1.4 | | \"cause\" URI | | _Redirecting | | | parameter, as | | reason_ | | | defined in | | (NOTE 1) | | | IETF RFC 4458 | | | | | [113] of the | | | | | last | | | | | History-Info | | | | | hi-entry | | | | | containing | | | | | such \"cause\" | | | | | URI parameter. | | | | | (NOTE 2) | | | | +----------------+----------------+----------------+----------------+ | NOTE 1: | | | | | Parameter | | | | | shall only be | | | | | supplied if | | | | | hi-t | | | | | argeted-to-uri | | | | | of at least | | | | | one | | | | | History-Info | | | | | hi-entry | | | | | contains a | | | | | \"cause\" URI | | | | | parameter, as | | | | | defined in | | | | | IETF RFC 4458 | | | | | [113]. | | | | | | | | | | NOTE 2: The | | | | | h | | | | | i-target-param | | | | | parameter set | | | | | to \"mp\" as | | | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | indicates that | | | | | the target of | | | | | the | | | | | Request-URI | | | | | was changed | | | | | and appears in | | | | | this | | | | | hi-ta | | | | | rgeted-to-uri. | | | | | In case of | | | | | interworking | | | | | with networks | | | | | not supporting | | | | | IETF R | | | | | FC 7044 [91] | | | | | the \"mp\" | | | | | header field | | | | | parameter may | | | | | not appear. | | | | +----------------+----------------+----------------+----------------+
The mapping in table 7.5.4.2.1.9 appears when a 181 (Call Is Being Forwarded)
provisional response previously was mapped to an ACM. Therefore the state
machine of the O-MGCF knows that a CDIV is in progress.
Table 7.5.4.2.1.10: Mapping of 200 (OK) response
* * *
Source SIP header field and component Source Component value ISUP Parameter
Derived value of parameter field 200 (OK) response ANM/CON  
History-Info header field See table 7.5.4.2.1.2 Redirection number(NOTE) See
table 7.5.4.2.1.2 Privacy \"headers\" component of the hi-targeted-to-uri
or/and Privacy header field See table 7.5.4.2.1.3 Redirection number
restriction See table 7.5.4.2.1.3 NOTE: Redirection number shall only be
supplied if 200 (OK) response is mapped to ANM message.
* * *
##### 7.5.4.2.2 Call Diversion within the ISUP Network appeared
The following scenario shows if a Call Diversion service appears in the
ISUP/PSTN and the diverted-to number is within the SIP network. Table
7.5.4.2.2.1 should be seen as an example.
For the mapping of 180 (Ringing) response and 200 (OK) response (to the INVITE
request) to the regarding ISUP messages and parameters no additional
procedures beyond the basic call procedures are needed.
To interwork the redirecting number at the O-MGCF it can be needed to create
placeholder History-Info hi-entries. Such a History-Info hi-entry shall
contain a hi-targeted-to-uri set to an \"Unknown User Identity\" (value
\"sip:unknown\@unknown.invalid\" as defined in 3GPP TS 23.003 [74]), a
\"cause\" URI parameter, a hi-index and an \"mp\" header field parameter as
described within table 7.5.4.2.2.1.
Table 7.5.4.2.2.1: Mapping of IAM to SIP INVITE request
+----------------+----------------+----------------+----------------+ | ISUP Parameter | Derived value | SIP component | Value | | or IE | of parameter | | | | | field | | | +----------------+----------------+----------------+----------------+ | IAM | | INVITE request | | +----------------+----------------+----------------+----------------+ | Redirecting | | History-Info | IF Redirection | | number | | header field | counter | | | | | exceeds 1 | | | | | | | | | | hi-t | | | | | argeted-to-uri | | | | | of the | | | | | | | | | | penultimate | | | | | created | | | | | hi-entry | | | | | | | | | | (NOTE 9) | | | | | | | | | | IF Redirecting | | | | | number is | | | | | available | | | | | | | | | | set to the | | | | | value of the | | | | | | | | | | Redirecting | | | | | number | | | | | | | | | | ELSE | | | | | | | | | | set to the | | | | | Unknown User | | | | | | | | | | Identity | | | | | (NOTE 10) | | | | | | | | | | ELSE | | | | | | | | | | no mapping | | | | | (NOTE 8) | +----------------+----------------+----------------+----------------+ | Nature of | \"_national | hi-t | Add CC (of the | | address | (significant) | argeted-to-uri | country where | | indicator | number\"_ | | the MGCF is | | | | | located) to | | | | | Redirecting | | | | | number Address | | | | | Signals to | | | | | construct | | | | | E.164 number | | | | | in URI. | +----------------+----------------+----------------+----------------+ | | _\ | | Map complete | | | "international | | Redirecting | | | number\"_ | | number Address | | | | | Signals to | | | | | E.164 number | | | | | in URI. | +----------------+----------------+----------------+----------------+ | Address | If NOA is | hi-t | **Addr-spec** | | Signals | \"_national | argeted-to-uri | | | | (significant) | | \"+\" CC NDC | | | number\"_ then | | SN mapped to | | | the format of | | userinfo | | | the Address | | portion of SIP | | | Signals is: | | URI. (NOTE 5) | | | | | | | | NDC + SN | | Add | | | | | \ | | | If NOA is | | "user=phone\". | | | \" | | | | | _international | | | | | number\"_ | | | | | | | | | | then the | | | | | format of the | | | | | Address | | | | | Signals is: | | | | | | | | | | CC + NDC + SN | | | +----------------+----------------+----------------+----------------+ | Redirecting | APRI | Privacy header | Priv-value | | number | | field that | | | | | | | | | | corresponds to | | | | | the | | | | | penultimate | | | | | hi-t | | | | | argeted-to-uri | | | | | entry in the | | | | | History-Info | | | | | header | | +----------------+----------------+----------------+----------------+ | | \ | | \"_history_ \" | | | "_presentation | | | | | restricted_ \" | | | +----------------+----------------+----------------+----------------+ | | \ | | Privacy header | | | "_presentation | | field absent | | | allowed_ \" | | or \"_none_ \" | | | | | (NOTE 3) | +----------------+----------------+----------------+----------------+ | Redirection | Redirecting | Privacy header | Priv-value | | information | indicator | field that | | | | | | | | | | corresponds to | | | | | the | | | | | penultimate | | | | | hi-t | | | | | argeted-to-uri | | | | | entry in the | | | | | History-Info | | | | | header | | +----------------+----------------+----------------+----------------+ | | _Call | | Privacy header | | | diverted_ | | field absent | | | | | or \"_none_ \" | | | | | (NOTE 4) | +----------------+----------------+----------------+----------------+ | | _Call | | \"_ history _\" | | | diverted, all | | | | | redirection | | | | | information | | | | | presentation | | | | | restricted_ | | | +----------------+----------------+----------------+----------------+ | Redirection | Redirection | hi-index and | Number of | | information | counter | \"mp\" header | diversions is | | | | field | shown to the | | | 1 | parameter | number of | | | | (NOTE 7) | levels in | | | | | hi-index | | | | | | | | | | Index for | | | | | Original | | | | | called number | | | | | = 1 | | | | | | | | | | Index for | | | | | Called party | | | | | number = 1.1 | | | | | and addition | | | | | \"mp=1\" | +----------------+----------------+----------------+----------------+ | | 2 | | Index for | | | | | Original | | | | | called number | | | | | = 1 | | | | | | | | | | Index for | | | | | Redirecting | | | | | number = 1.1 | | | | | and addition | | | | | of \"mp=1\" | | | | | | | | | | Index for | | | | | Called party | | | | | number = 1.1.1 | | | | | and addition | | | | | of \"mp=1.1\" | +----------------+----------------+----------------+----------------+ | | N | | Index for | | | | | Original | | | | | called number | | | | | = 1 | | | | | | | | | | Placeholder | | | | | History entry | | | | | with Index = | | | | | 1.1 and | | | | | addition of | | | | | \"mp=1\" | | | | | | | | | | ... | | | | | | | | | | Fill up | | | | | | | | | | ... | | | | | | | | | | Index for | | | | | Redirecting | | | | | number = | | | | | 1.[(N-1)* | | | | | \".1\"] and | | | | | addition of | | | | | \"mp\" header | | | | | field | | | | | parameter set | | | | | to the | | | | | hi-index value | | | | | of the | | | | | hi-t | | | | | argeted-to-uri | | | | | that precede. | | | | | | | | | | Index for | | | | | Called party | | | | | number = 1.N* | | | | | \".1\" (e.g. | | | | | N=3  1.1.1.1) | | | | | and addition | | | | | of | | | | | mp=1 | | | | | .[(N-1)*].1 | +----------------+----------------+----------------+----------------+ | Redirection | **Redirecting | hi-ta |** cause | | information | reason and**| rgeted-to-uri; | value** | | | | \"cause\" URI | | | | **Original | parameter, as | | | | redirection | defined in | | | | reason** | IETF RFC | | | | | 4458 [113]. | | | | (NOTE 1) | | | | | | The | | | | | Redirecting | | | | | reason shall | | | | | be mapped to | | | | | the last | | | | | hi-ta | | | | | rgeted-to-uri. | | | | | | | | | | If the | | | | | redirection | | | | | counter is 2 | | | | | or higher, the | | | | | Original | | | | | redirection | | | | | Reason shall | | | | | be mapped to | | | | | the second | | | | | hi-ta | | | | | rgeted-to-uri. | | | | | | | | | | If the | | | | | redirection | | | | | counter is 3 | | | | | or higher, for | | | | | each | | | | | hi-t | | | | | argeted-to-uri | | | | | following a | | | | | placeholder | | | | | History-Info | | | | | hi-entry the | | | | | value \"404\" | | | | | shall be taken | | | | | (NOTE 2) | | +----------------+----------------+----------------+----------------+ | | _unknown/not | | 404 | | | available_ | | | +----------------+----------------+----------------+----------------+ | | * | | 302 | | | unconditional _| | | +----------------+----------------+----------------+----------------+ | |_ User Busy _| | 486 | +----------------+----------------+----------------+----------------+ | |_ No reply _| | 408 | +----------------+----------------+----------------+----------------+ | |_ Deflection | | 487 | | | during | | | | | alerting _| | | +----------------+----------------+----------------+----------------+ | |_ Deflection | | 480 | | | immediate | | | | | response _| | | +----------------+----------------+----------------+----------------+ | |_ Mobile | | 503 | | | subscriber not | | | | | reachable _| | | +----------------+----------------+----------------+----------------+ | Called party |_ See _| History-Info | URI of the | | number | Redirecting | header field | last | | | number Nature | see | hi-t | | | of address | hi-t | argeted-to-uri | | | indicator and | argeted-to-uri | entry of | | | Address signal | | History-Info | | | | | header field | +----------------+----------------+----------------+----------------+ | Original |_ See _| History-Info | URI of first | | called number | Redirecting | header field | hi-t | | | number Nature | see | argeted-to-uri | | | of address | hi-t | entry of | | | indicator and | argeted-to-uri | History-Info | | | Address signal | | header field | | | | | (NOTE 6, | | | | | NOTE 9) | | | | | | | | | | IF the | | | | | Original | | | | | called number | | | | | is available: | | | | | | | | | | set to the | | | | | value of the | | | | | Original | | | | | | | | | | called number | | | | | | | | | | ELSE | | | | | | | | | | IF the | | | | | Redirection | | | | | counter equals | | | | | | | | | | 1 AND the | | | | | Redirecting | | | | | number is | | | | | | | | | | available, | | | | | | | | | | set to the | | | | | value of the | | | | | | | | | | Redirecting | | | | | number | | | | | | | | | | ELSE | | | | | | | | | | set to the | | | | | Unknown User | | | | | | | | | | Identity | | | | | (NOTE 10) | +----------------+----------------+----------------+----------------+ | Original |__APRI_ _| Privacy header |__Priv-value_ _| | called number | | field of the | | | | | first | | | | | hi-t | | | | | argeted-to-uri | | | | | entry of | | | | | History-Info | | | | | header | | +----------------+----------------+----------------+----------------+ | | \ | | \"_ history _\" | | | "_ presentation | | | | | restricted _\" | | | +----------------+----------------+----------------+----------------+ | | \ | | Privacy header | | | "_ presentation | | field absent | | | allowed _\" | | or \"_ none _\" | +----------------+----------------+----------------+----------------+ | NOTE 1: | | | | | Original | | | | | redirection | | | | | reason | | | | | contains the | | | | | \"unknown/not | | | | | available\" | | | | | value. Based | | | | | on operator | | | | | agreement or | | | | | national | | | | | regulatory | | | | | requirements | | | | | other values | | | | | of original | | | | | redirection | | | | | reason may be | | | | | used. | | | | | | | | | | NOTE 2: For | | | | | all | | | | | History-Info | | | | | hi-entries | | | | | except the | | | | | first one a | | | | | \"cause\" URI | | | | | parameter as | | | | | defined in | | | | | IETF RF | | | | | C 4458 [113] | | | | | has to be | | | | | included. | | | | | | | | | | NOTE 3: If the | | | | | Redirecting | | | | | indicator has | | | | | the value | | | | | \"_ Call | | | | | diverted, all | | | | | redirection | | | | | information | | | | | presentation | | | | | restricted _\", | | | | | the privacy | | | | | value | | | | | \"_ history _\" | | | | | shall be set. | | | | | | | | | | NOTE 4: If the | | | | | Redirecting | | | | | number APRI | | | | | has the value | | | | | \ | | | | | "_ presentation | | | | | restricted _\", | | | | | the privacy | | | | | value | | | | | \"_ history*\" | | | | | shall be set. | | | | | | | | | | NOTE 5: Used | | | | | URI scheme | | | | | shall be SIP | | | | | URI. The | | | | | \"cause\" URI | | | | | parameter | | | | | cannot be | | | | | added if | | | | | hi-t | | | | | argeted-to-uri | | | | | is a tel URI. | | | | | | | | | | NOTE 6: The | | | | | used URI | | | | | scheme can be | | | | | tel URI or SIP | | | | | URI since the | | | | | first | | | | | hi-t | | | | | argeted-to-uri | | | | | entry of the | | | | | History-Info | | | | | header field | | | | | does not | | | | | contain the | | | | | \"cause\" URI | | | | | parameter. | | | | | | | | | | NOTE 7: The | | | | | h | | | | | i-target-param | | | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | defines the | | | | | \"mp\" as a | | | | | header field | | | | | parameter that | | | | | contains the | | | | | value of the | | | | | hi-index in | | | | | the hi-entry | | | | | with an | | | | | hi-t | | | | | argeted-to-uri | | | | | that reflects | | | | | the | | | | | Request-URI | | | | | that was | | | | | retargeted, | | | | | thus | | | | | identifying | | | | | the \"mapped | | | | | from\" target. | | | | | Since the | | | | | hi-entries are | | | | | created based | | | | | on the | | | | | redirection | | | | | counter to | | | | | reflect the | | | | | diverti | | | | | ng/diverted-to | | | | | entries, the | | | | | h | | | | | i-target-param | | | | | \"mp\" header | | | | | field | | | | | parameter | | | | | shall be | | | | | present in | | | | | each entry | | | | | except the | | | | | first one. | | | | | | | | | | NOTE 8: If the | | | | | Original | | | | | called number | | | | | parameter is | | | | | not available | | | | | and if the | | | | | value of the | | | | | Redirecting | | | | | counter is | | | | | equal to one, | | | | | the | | | | | Redirecting | | | | | number | | | | | parameter is | | | | | used for the | | | | | first | | | | | hi-t | | | | | argeted-to-uri | | | | | entry of the | | | | | History-Info | | | | | header field. | | | | | | | | | | NOTE 9: If a | | | | | further SIP to | | | | | ISUP | | | | | interworking | | | | | occurs, | | | | | parameters not | | | | | present in the | | | | | original | | | | | message can | | | | | then be | | | | | included. | | | | | | | | | | NOTE 10: The | | | | | \" | | | | | History-Info\" | | | | | header field | | | | | may contain an | | | | | \"Unknown User | | | | | Identity\". An | | | | | \"Unknown User | | | | | Identity\" | | | | | includes | | | | | information | | | | | that does not | | | | | point to the | | | | | served user | | | | | and indicates | | | | | that the | | | | | user\'s | | | | | identity is | | | | | unknown. The | | | | | encoding of | | | | | the \"Unknown | | | | | User | | | | | Identity\" | | | | | shall be as | | | | | defined in | | | | | 3GPP TS | | | | | 23.003 [74]. | | | | +----------------+----------------+----------------+----------------+
#### 7.5.4.3 Interworking at the I-MGCF
Table 7.5.4.3.1: Mapping of SIP to ISUP messages
* * *
Message received from SIP Message send to BICC/ISUP INVITE request IAM
* * *
Table 7.5.4.3.2: Mapping of History-Info header field to ISUP Redirecting
number
+----------------+----------------+----------------+----------------+ | Source SIP | Source | Redirecting | Derived value | | header field | Component | number | of parameter | | and component | value | | field | +----------------+----------------+----------------+----------------+ | In | | Redirecting | | | History-Info | | number | | | SIP header | | | | | field, | | | | | hi-t | | | | | argeted-to-uri | | | | | in hi-entry | | | | | having a | | | | | hi-index that | | | | | match the | | | | | \"mp\" header | | | | | field | | | | | parameter | | | | | value of the | | | | | last hi-entry | | | | | containing an | | | | | \"mp\" header | | | | | field | | | | | parameter and | | | | | a \"cause\" | | | | | URI parameter, | | | | | as defined in | | | | | IETF RFC | | | | | 4458 [113]. | | | | | (NOTE 1) | | | | | (NOTE 3) | | | | +----------------+----------------+----------------+----------------+ | hi-t | CC | Nature of | If CC is equal | | argeted-to-uri | | address | to the country | | | | indicator | code of the | | appropriate | | | country where | | global number | | | MGCF is | | portion of the | | | located AND | | URI, assumed | | | the next ISUP | | to be in form\ | | | node is | | \"+\" CC + NDC | | | located in the | | + SN | | | same country, | | | | | then set to | | | | | \"_national | | | | | (significant) | | | | | numbe_ r\" else | | | | | set to | | | | | \" | | | | | _international | | | | | number_ \" | +----------------+----------------+----------------+----------------+ | | CC, NDC, SN | Address | If NOA is | | | | signals | \"_national | | | | | (significant) | | | | | number_ \" then | | | | | set to\ | | | | | NDC + SN. | | | | | | | | | | If NOA is | | | | | \" | | | | | _international | | | | | number_ \" | | | | | | | | | | then set to CC | | | | | + NDC + SN | +----------------+----------------+----------------+----------------+ | Privacy header | | APRI | If the | | field or/and | | | priv-value | | priv‑value | | | \"_history_ \" | | component of | | | or | | the hi-entry | | | \"_session_ \" | | in | | | or | | History-Info | | | \"_header_ \" | | header field | | | is received | | (NOTE 2) | | | within the | | | | | Privacy header | | | | | field or if | | | | | the priv-value | | | | | \"_history_ \" | | | | | is received | | | | | within the | | | | | \"headers\" | | | | | component of | | | | | the | | | | | hi-t | | | | | argeted-to-uri | | | | | in hi-entry | | | | | before last | | | | | hi-entry | | | | | containing a | | | | | \"cause\" URI | | | | | parameter then | | | | | \ | | | | | "_presentation | | | | | restricted_ \" | | | | | shall be set. | | | | | | | | | | Otherwise, | | | | | \ | | | | | "_presentation | | | | | allowed\" | | | | | shall be set._ | +----------------+----------------+----------------+----------------+ | NOTE 1: If the | | | | | SIP URI | | | | | doesn't | | | | | contain | | | | | \"_| | | | | user=phone_ \", | | | | | mapping to | | | | | redirecting | | | | | number is | | | | | impossible, | | | | | therefore no | | | | | need to | | | | | generate | | | | | Redirecting | | | | | number. | | | | | | | | | | NOTE 2: It is | | | | | possible that | | | | | an entry of | | | | | the | | | | | History-Info | | | | | header field | | | | | itself is | | | | | marked as | | | | | restricted or | | | | | the whole | | | | | History-Info | | | | | header. | | | | | | | | | | NOTE 3: The | | | | | h | | | | | i-target-param | | | | | parameter set | | | | | to \"mp\" as | | | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | indicates that | | | | | the target of | | | | | the | | | | | Request-URI | | | | | was changed | | | | | and appears in | | | | | the | | | | | hi-ta | | | | | rgeted-to-uri. | | | | | In case of | | | | | interworking | | | | | with networks | | | | | not supporting | | | | | IETF R | | | | | FC 7044 [91] | | | | | the \"mp\" | | | | | header field | | | | | parameter may | | | | | not appear. If | | | | | the \"mp\" | | | | | header field | | | | | parameter is | | | | | missing in the | | | | | last hi-entry | | | | | containing a | | | | | \"cause\" URI | | | | | parameter as | | | | | defined in | | | | | IETF RFC | | | | | 4458 [113], | | | | | the hi-entry | | | | | to use is the | | | | | entry just | | | | | before. | | | | +----------------+----------------+----------------+----------------+
Table 7.5.4.3.3: Mapping of History-Info header to ISUP Redirection
information
+----------------+----------------+----------------+----------------+ | Source SIP | Source | Redirection | Derived value | | header field | Component | information | of parameter | | and component | value | | field | +----------------+----------------+----------------+----------------+ | Privacy header | \"_history_ \" | Redirecting | _Call | | field and | or | indicator | diverted, all | | priv‑value of | \"_ session _\" | | redirection | | hi-entry | or | | information | | having a | \"_ header _\" | | presentation | | hi-index that | | | restricted_ | | match the | for the | | | | \"mp\" header | Privacy header | | | | field | field or for | | | | parameter | the | | | | value of the | hi-t | | | | last hi-entry | argeted-to-uri | | | | containing an | entry | | | | \"mp\" header | | | | | field | | | | | parameter and | | | | | a \"cause\" | | | | | URI parameter | | | | | as defined in | | | | | IETF RF | | | | | C 4458 [113] | | | | | of the | | | | | History-Info | | | | | header field. | | | | | (NOTE 3) | | | | +----------------+----------------+----------------+----------------+ | | Privacy header | | _Call | | | field and the | | diverted_ | | | privacy | | | | | component of | | | | | the | | | | | hi-t | | | | | argeted-to-uri | | | | | entry either | | | | | absent | | | | | | | | | | or | | | | | | | | | | \"_none_ \" | | | +----------------+----------------+----------------+----------------+ | | | Original | _Unknown/not | | | | redirection | available_ | | | | reason | (NOTE 4) | +----------------+----------------+----------------+----------------+ | Cause value in | **Cause | Redirecting |**_Redirecting | | the last | parameter | reason | reason_**| | hi-t | value** | | | | argeted-to-uri | | | | | containing a | | | | | \"cause\" URI | | | | | parameter as | | | | | defined in | | | | | IETF RF | | | | | C 4458 [113] | | | | | (NOTE 3) | | | | +----------------+----------------+----------------+----------------+ | | 404 | | _Unknown/not | | | | | available_ | +----------------+----------------+----------------+----------------+ | | 302 | | * | | | | | Unconditional _| +----------------+----------------+----------------+----------------+ | | 486 | |_ User busy _| +----------------+----------------+----------------+----------------+ | | 408 | |_ No reply _| +----------------+----------------+----------------+----------------+ | | 480 | |_ Deflection | | | | | immediate | | | | | response _| +----------------+----------------+----------------+----------------+ | | 487 | |_ Deflection | | | | | during | | | | | alerting _| +----------------+----------------+----------------+----------------+ | | 503 | |_ Mobile | | | | | subscriber not | | | | | reachable* | +----------------+----------------+----------------+----------------+ | History-Info | | Redirection | number of | | header field | | counter | History-Info | | | | | hi-entry(ies) | | | | | containing a | | | | | \"cause\" URI | | | | | parameter with | | | | | value as | | | | | listed as | | | | | cause | | | | | parameter | | | | | value in this | | | | | table (NOTE 1, | | | | | NOTE 2) | +----------------+----------------+----------------+----------------+ | NOTE 1: If the | | | | | determined | | | | | number of | | | | | redirection in | | | | | SIP exceeds | | | | | the ISUP | | | | | maximum | | | | | parameter | | | | | value, the | | | | | MGCF shall set | | | | | the | | | | | Redirection | | | | | counter to its | | | | | maximum value. | | | | | For instance, | | | | | in ISUP | | | | | ITU- | | | | | T Q.763 [4], | | | | | the | | | | | Redirection | | | | | counter | | | | | parameter | | | | | cannot exceed | | | | | 5. | | | | | | | | | | NOTE 2: The | | | | | Redirection | | | | | counter value | | | | | will be | | | | | incremented | | | | | regardless of | | | | | the SIP URI | | | | | format. | | | | | | | | | | NOTE 3: The | | | | | h | | | | | i-target-param | | | | | parameter set | | | | | to \"mp\" as | | | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | indicates that | | | | | the target of | | | | | the | | | | | Request-URI | | | | | was changed | | | | | and appears in | | | | | the | | | | | hi-ta | | | | | rgeted-to-uri. | | | | | In case of | | | | | interworking | | | | | with networks | | | | | not supporting | | | | | IETF R | | | | | FC 7044 [91] | | | | | the \"mp\" | | | | | header field | | | | | parameter may | | | | | not appear. If | | | | | the \"mp\" | | | | | header field | | | | | parameter is | | | | | missing in the | | | | | last hi-entry | | | | | containing a | | | | | \"cause\" URI | | | | | parameter as | | | | | defined in | | | | | IETF RFC | | | | | 4458 [113], | | | | | the hi-entry | | | | | to use is the | | | | | entry just | | | | | before. | | | | | | | | | | NOTE 4: Based | | | | | on the | | | | | operator | | | | | agreement or | | | | | national | | | | | regulatory | | | | | requirements | | | | | other values | | | | | of original | | | | | redirection | | | | | reason may be | | | | | used. | | | | +----------------+----------------+----------------+----------------+
Table 7.5.4.3.4: Mapping of History-Info header field to ISUP Original called
number
+----------------+----------------+----------------+----------------+ | Source SIP | Source | Original | Derived value | | header field | Component | called number | of parameter | | and component | value | | field | +----------------+----------------+----------------+----------------+ | | | Numbering Plan | \"_ISDN | | | | Indicator | (Telephony) | | | | | numbering plan | | | | | ( | | | | | Recommendation | | | | | E.164)_ \" | +----------------+----------------+----------------+----------------+ | hi-t | CC | Nature of | If CC is equal | | argeted-to-uri | | address | to the country | | of hi-entry | | indicator | code of the | | having a | | | country where | | hi-index that | | | MGCF is | | match the | | | located AND | | \"mp\" header | | | the next ISUP | | field | | | node is | | parameter | | | located in the | | value of the | | | same country, | | first | | | then set to | | hi-t | | | \"_national | | argeted-to-uri | | | (significant) | | containing an | | | number_ \" else | | \"mp\" header | | | set to | | field | | | \" | | parameter and | | | _international | | a \"cause\" | | | number_ \" | | URI parameter, | | | | | as defined in | | | | | IETF RFC | | | | | 4458 [113]; | | | | | the | | | | | | | | | | global number | | | | | portion of the | | | | | URI, is | | | | | assumed to be | | | | | in form\ | | | | | \"+\" CC + NDC | | | | | + SN | | | | | | | | | | (NOTE 1) | | | | | (NOTE 3) | | | | +----------------+----------------+----------------+----------------+ | | CC, NDC, SN | Address | If NOA is | | | | signals | \"_national | | | | | (significant) | | | | | number_ \" then | | | | | set to\ | | | | | NDC + SN. | | | | | | | | | | If NOA is | | | | | \" | | | | | _international | | | | | number_ \" | | | | | | | | | | then set to CC | | | | | + NDC + SN | +----------------+----------------+----------------+----------------+ | priv‑value | \"_history_ \" | APRI | \ | | component | or | | "_presentation | | | \"_ session _\" | | restricted_ \" | | in | or | | | | History-Info | \"_header_ \" | | | | header field | | | | | of the | | | | | History-Info | | | | | header field | | | | | entry as | | | | | defined above | | | | | in this table | | | | | (NOTE 2) | | | | +----------------+----------------+----------------+----------------+ | | Privacy header | | \ | | | field absent | | "_presentation | | | or \"_ none _\" | | allowed_ \" | +----------------+----------------+----------------+----------------+ | NOTE 1: If it | | | | | is SIP URI and | | | | | doesn't | | | | | contain | | | | | \"_| | | | | user=phone_ \", | | | | | mapping to | | | | | Original | | | | | called number | | | | | is impossible, | | | | | therefore no | | | | | need to | | | | | generate | | | | | Original | | | | | called number. | | | | | | | | | | NOTE 2: It is | | | | | possible that | | | | | an entry of | | | | | the | | | | | History-Info | | | | | header field | | | | | itself is | | | | | marked as | | | | | restricted or | | | | | the whole | | | | | History-Info | | | | | header. | | | | | | | | | | NOTE 3: The | | | | | h | | | | | i-target-param | | | | | parameter set | | | | | to \"mp\" as | | | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | indicates that | | | | | the target of | | | | | the | | | | | Request-URI | | | | | was changed | | | | | and appears in | | | | | the | | | | | hi-ta | | | | | rgeted-to-uri. | | | | | In case of | | | | | interworking | | | | | with networks | | | | | not supporting | | | | | IETF R | | | | | FC 7044 [91] | | | | | the \"mp\" | | | | | header field | | | | | parameter may | | | | | not appear. If | | | | | the \"mp\" | | | | | header field | | | | | parameter is | | | | | missing in the | | | | | first hi-entry | | | | | containing a | | | | | \"cause\" URI | | | | | parameter as | | | | | defined in | | | | | IETF RFC | | | | | 4458 [113], | | | | | the hi-entry | | | | | to use is the | | | | | hi-entry | | | | | preceding the | | | | | first hi-entry | | | | | containing the | | | | | \"cause\" URI | | | | | parameter. | | | | +----------------+----------------+----------------+----------------+
Table 7.5.4.3.5: Mapping of INVITE to IAM
* * *
INVITE IAM  
History-Info header field See table 7.5.4.3.2 Redirecting number See table
7.5.4.3.2 History-Info header field See table 7.5.4.3.3 Redirection
information See table 7.5.4.3.3 History-Info header field See table 7.5.4.3.4
Original called number _See_ table 7.5.4.3.4
* * *
Table 7.5.4.3.6: Mapping of ISUP to SIP Messages
* * *
←Message sent to SIP ←Message Received from BICC/ISUP  
181 (Being forwarded) ACM no indication with Redirection number and Call
diversion information parameters (CFU, CFB, Cdi) See table 7.5.4.3.8 180
(Ringing) ACM indicating ringing, oBCi: \"_Call diversion may occur_ \" (CFNR,
Cda) See subclause 7.2.3.1.4 181 (Being forwarded) CPG indicating progress or
subsequent diversion indicated in the CPG with Redirection number and Call
diversion information parameters (CFNR, Cda) See table 7.5.4.3.9 180 (Ringing)
CPG indicating ringing and Redirection number restriction parameter See table
7.5.4.3.10 200 (OK) ANM and Redirection number restriction parameter See table
7.5.4.3.11
* * *
Table 7.5.4.3.7: Mapping of ISUP Redirection number restriction to History-
Info header field
+----------------+----------------+----------------+----------------+ | Redirection | Derived value | SIP component | Value | | number | of parameter | | | | restriction | field | | | +----------------+----------------+----------------+----------------+ | Presentation | \ | privacy | \"_history_ \" | | restricted | "_Presentation | \"headers\" | | | indicator | restricted_ \" | component of | | | | | the | | | | | hi-t | | | | | argeted-to-uri | | +----------------+----------------+----------------+----------------+ | | \ | | Privacy header | | | "_presentation | | field absent | | | allowed_ \" or | | | | | absent AND any | | or | | | previously | | | | | received | | \"_none_ \" | | | notification | | | | | subscription | | | | | options was | | | | | NOT | | | | | \ | | | | | "_presentation | | | | | not allowed_ \" | | | | | AND was NOT | | | | | \ | | | | | "_presentation | | | | | allowed | | | | | without | | | | | redirection | | | | | number_ \" | | | +----------------+----------------+----------------+----------------+
Table 7.5.4.3.8: Mapping of ACM  181 (Call Is Being Forwarded) response
+----------------+----------------+----------------+----------------+ | ISUP Parameter | Derived value | SIP component | Value | | | of parameter | | | | | field | | | +----------------+----------------+----------------+----------------+ | Generic | Call is | | | | notification | diverting | | | | indicator | | | | | | | | | | _Notification | | | | | indicator_ | | | | +----------------+----------------+----------------+----------------+ | Redirection | | History-Info | hi-ta | | number | | header field | rgeted-to-uri: | | | | with one | | | | | hi-entry and | | | | | the | | | | | h | | | | | i-target-param | | | | | \"mp\" header | | | | | field | | | | | parameter | | +----------------+----------------+----------------+----------------+ | Nature of | \"_national | hi-t | Add CC (of the | | address | (significant) | argeted-to-uri | country where | | indicator: | number_ \" | | the MGCF is | | | | | located) to | | | | | Redirection | | | | | number Address | | | | | Signals to | | | | | construct | | | | | E.164 number | | | | | in URI. | +----------------+----------------+----------------+----------------+ | | \" | | Map complete | | | _international | | Redirection | | | number_ \" | | number Address | | | | | Signals to | | | | | E.164 number | | | | | in URI. | +----------------+----------------+----------------+----------------+ | Address | If NOA is | hi-t | **Addr-spec** | | Signals | \"_national | argeted-to-uri | | | | (significant) | | \"+\" CC NDC | | | number_ \" then | | SN mapped to | | | the format of | | userinfo | | | the Address | | portion of SIP | | | Signals is: | | URI. (NOTE 2) | | | | | | | | NDC + SN | | Add | | | | | \ | | | If NOA is | | "user=phone\". | | | \" | | | | | _international | | | | | number_ \" | | | | | | | | | | then the | | | | | format of the | | | | | Address | | | | | Signals is: | | | | | | | | | | CC + NDC + SN | | | +----------------+----------------+----------------+----------------+ | Call diversion | **_Redirecting | IETF RF |_ *cause | | information | reason** _| C 4458 [113] | value_ _| | | | \"cause\" URI | | | | | parameter in | | | | | the | | | | | hi-t | | | | | argeted-to-uri | | | | | (NOTE 1) | | +----------------+----------------+----------------+----------------+ | |_ Unknown _| | 404 | +----------------+----------------+----------------+----------------+ | | * | | 302 | | | Unconditional_ | | | +----------------+----------------+----------------+----------------+ | | _User busy_ | | 486 | +----------------+----------------+----------------+----------------+ | | _No reply_ | | 408 | +----------------+----------------+----------------+----------------+ | | _Deflection | | 480 | | | immediate | | | | | response_ | | | +----------------+----------------+----------------+----------------+ | | _Deflection | | 487 | | | during | | | | | alerting_ | | | +----------------+----------------+----------------+----------------+ | | _Mobile | | 503 | | | subscriber not | | | | | reachable_ | | | +----------------+----------------+----------------+----------------+ | | * | privacy | | | | **Notification | \"headers\" | | | | subscription | component of | | | | options** _| the | | | | | hi-t | | | | | argeted-to-uri | | | | | (NOTE 1) | | +----------------+----------------+----------------+----------------+ | |_ unknown _| | Escaped | | | | | Privacy value | | | | | is set | | | | | according to | | | | | the rules of | | | | | 3GPP TS | | | | | 24.604 [60] | | | | | subcl | | | | | ause 4.5.2.6.4 | | | | | item c | +----------------+----------------+----------------+----------------+ | |_ presentation | | A 181 Being | | | not allowed _| | Forwarded | | | | | shall_ _not_ _| | | | | be sent | +----------------+----------------+----------------+----------------+ | |_ presentation | | Escaped | | | allowed with | | Privacy value | | | redirection | | is set | | | number _| | according to | | | | | the rules of | | | | | 3GPP TS | | | | | 24.604 [60] | | | | | subcl | | | | | ause 4.5.2.6.4 | | | | | item c | +----------------+----------------+----------------+----------------+ | |_ presentation | | Escaped | | | allowed | | Privacy value | | | without | | is set | | | redirection | | according to | | | number* | | the rules of | | | | | 3GPP TS | | | | | 24.604 [60] | | | | | subcl | | | | | ause 4.5.2.6.4 | | | | | item c | +----------------+----------------+----------------+----------------+ | NOTE 1: Needs | | | | | to be stored | | | | | for a possible | | | | | inclusion into | | | | | subsequent | | | | | messages. | | | | | | | | | | NOTE 2: Used | | | | | URI scheme | | | | | shall be SIP | | | | | URI. The | | | | | \"cause\" URI | | | | | parameter | | | | | cannot be | | | | | added if | | | | | hi-t | | | | | argeted-to-uri | | | | | is a tel URI. | | | | +----------------+----------------+----------------+----------------+
Table 7.5.4.3.9: Mapping of CPG  181 (Call Is Being Forwarded) response
+----------------+----------------+----------------+----------------+ | ISUP Parameter | Derived value | SIP component | Value | | | of parameter | | | | | field | | | +----------------+----------------+----------------+----------------+ | Event | _PROGRESS_ | | | | information | | | | | | | | | | _Event | | | | | Indicator_ | | | | +----------------+----------------+----------------+----------------+ | Generic | Call is | | | | notification | diverting | | | | indicator | | | | | | | | | | _Notification | | | | | indicator_ | | | | +----------------+----------------+----------------+----------------+ | Redirection | | History-Info | hi-ta | | number | | header field | rgeted-to-uri: | | | | with one | | | | | hi-entry and | | | | | the | | | | | h | | | | | i-target-param | | | | | \"mp\" header | | | | | field | | | | | parameter | | +----------------+----------------+----------------+----------------+ | Nature of | \"_national | hi-t | Add CC (of the | | address | (significant) | argeted-to-uri | country where | | indicator | number_ \" | | the MGCF is | | | | | located) to | | | | | Redirection | | | | | number Address | | | | | Signals to | | | | | construct | | | | | E.164 number | | | | | in URI. | +----------------+----------------+----------------+----------------+ | | \" | hi-t | Map complete | | | _international | argeted-to-uri | Redirection | | | number_ \" | | number Address | | | | | Signals to | | | | | E.164 number | | | | | in URI. | +----------------+----------------+----------------+----------------+ | Address | If NOA is | hi-t | **Addr-spec** | | Signals | \"_national | argeted-to-uri | | | | (significant) | | \"+\" CC NDC | | | number_ \" then | | SN mapped to | | | the format of | | userinfo | | | the Address | | portion of SIP | | | Signals is: | | URI. (NOTE 2) | | | | | | | | NDC + SN | | Add | | | | | \ | | | If NOA is | | "user=phone\". | | | \" | | | | | _international | | | | | number_ \" | | | | | | | | | | then the | | | | | format of the | | | | | Address | | | | | Signals is: | | | | | | | | | | CC + NDC + SN | | | +----------------+----------------+----------------+----------------+ | Call diversion | **_Redirecting | IETF RF |_ *cause | | information | reason** _| C 4458 [113] | value_ _| | | | \"cause\" URI | | | | | parameter in | | | | | the | | | | | hi-t | | | | | argeted-to-uri | | | | | (NOTE 1) | | +----------------+----------------+----------------+----------------+ | |_ Unknown _| | 404 | +----------------+----------------+----------------+----------------+ | | * | | 302 | | | Unconditional_ | | | +----------------+----------------+----------------+----------------+ | | _User busy_ | | 486 | +----------------+----------------+----------------+----------------+ | | _No reply_ | | 408 | +----------------+----------------+----------------+----------------+ | | _Deflection | | 480 | | | immediate | | | | | response_ | | | +----------------+----------------+----------------+----------------+ | | _Deflection | | 487 | | | during | | | | | alerting_ | | | +----------------+----------------+----------------+----------------+ | | _Mobile | | 503 | | | subscriber not | | | | | reachable_ | | | +----------------+----------------+----------------+----------------+ | | * | privacy | | | | **Notification | \"headers\" | | | | subscription | component of | | | | options** _| the | | | | | hi-t | | | | | argeted-to-uri | | | | | (NOTE 1) | | +----------------+----------------+----------------+----------------+ | |_ unknown _| | Escaped | | | | | Privacy value | | | | | is set | | | | | according to | | | | | the rules of | | | | | 3GPP TS | | | | | 24.604 [60] | | | | | subcl | | | | | ause 4.5.2.6.4 | | | | | items c | +----------------+----------------+----------------+----------------+ | |_ presentation | | A 181 Being | | | not allowed _| | Forwarded | | | | | shall_ _not_ _| | | | | be sent | +----------------+----------------+----------------+----------------+ | |_ presentation | | Escaped | | | allowed with | | Privacy value | | | redirection | | is set | | | number _| | according to | | | | | the rules of | | | | | 3GPP TS | | | | | 24.604 [60] | | | | | subcl | | | | | ause 4.5.2.6.4 | | | | | items c | +----------------+----------------+----------------+----------------+ | |_ presentation | | Escaped | | | allowed | | Privacy value | | | without | | is set | | | redirection | | according to | | | number* | | the rules of | | | | | 3GPP TS | | | | | 24.604 [60] | | | | | subcl | | | | | ause 4.5.2.6.4 | | | | | items c | +----------------+----------------+----------------+----------------+ | NOTE 1: Needs | | | | | to be stored | | | | | for a possible | | | | | inclusion into | | | | | subsequent | | | | | messages. | | | | | | | | | | NOTE 2: Used | | | | | URI scheme | | | | | shall be SIP | | | | | URI. The | | | | | \"cause\" URI | | | | | parameter | | | | | cannot be | | | | | added if | | | | | hi-t | | | | | argeted-to-uri | | | | | is a tel URI. | | | | +----------------+----------------+----------------+----------------+
Table 7.5.4.3.10 addresses two separate conditions: the CPG is received from
the diverting exchange in which case the Call diversion information parameter
is included; and the CPG is received from the diverted-to exchange in which
case the Call diversion information parameter is not included. Interworking
for both conditions is shown.
Table 7.5.4.3.10: Mapping of CPG  180 (Ringing) response
+----------------+----------------+----------------+----------------+ | ISUP Parameter | Derived value | SIP component | Value | | | of parameter | | | | | field | | | +----------------+----------------+----------------+----------------+ | Event | _ALERTING_ | | | | information | | | | | | | | | | _Event | | | | | Indicator_ | | | | +----------------+----------------+----------------+----------------+ | Redirection | | History-Info | See table | | number | | header field | 7.5.4.3.8 | | | | with one | | | | | hi-entry and | | | | | the | | | | | h | | | | | i-target-param | | | | | \"mp\" header | | | | | field | | | | | parameter | | +----------------+----------------+----------------+----------------+ | Call diversion | **_Redirecting | IETF RF |_ *cause | | information | reason** _| C 4458 [113] | value_ _| | | | | | | | | \"cause\" URI | | | | | parameter in | | | | | the | | | | | hi-t | | | | | argeted-to-uri | | | | | (NOTE 1) | | +----------------+----------------+----------------+----------------+ | |_ Unknown _| | 404 | +----------------+----------------+----------------+----------------+ | | * | | 302 | | | Unconditional_ | | | +----------------+----------------+----------------+----------------+ | | _User busy_ | | 486 | +----------------+----------------+----------------+----------------+ | | _No reply_ | | 408 | +----------------+----------------+----------------+----------------+ | | _Deflection | | 480 | | | immediate | | | | | response_ | | | +----------------+----------------+----------------+----------------+ | | _Deflection | | 487 | | | during | | | | | alerting_ | | | +----------------+----------------+----------------+----------------+ | | _Mobile | | 503 | | | subscriber not | | | | | reachable_ | | | +----------------+----------------+----------------+----------------+ | | * | privacy | | | | **Notification | \"headers\" | | | | subscription | component of | | | | options** _| the | | | | | hi-t | | | | | argeted-to-uri | | | | | (NOTE 1) | | +----------------+----------------+----------------+----------------+ | |_ unknown _| | Escaped | | | | | Privacy value | | | | | is set | | | | | according to | | | | | the rules of | | | | | 3GPP TS | | | | | 24.604 [60] | | | | | subcl | | | | | ause 4.5.2.6.4 | | | | | item c | +----------------+----------------+----------------+----------------+ | |_ presentation | | The 180 | | | not allowed _| | Ringing | | | | | response shall | | | | | be sent | | | | |__without_ _| | | | | the | | | | | History-Info | | | | | header field | | | | | included | +----------------+----------------+----------------+----------------+ | |_ presentation | | Escaped | | | allowed with | | Privacy value | | | redirection | | is set | | | number _| | according to | | | | | the rules of | | | | | 3GPP TS | | | | | 24.604 [60] | | | | | subcl | | | | | ause 4.5.2.6.4 | | | | | item c | +----------------+----------------+----------------+----------------+ | |_ presentation | | Escaped | | | allowed | | Privacy value | | | without | | is set | | | redirection | | according to | | | number* | | the rules of | | | | | 3GPP TS | | | | | 24.604 [60] | | | | | subcl | | | | | ause 4.5.2.6.4 | | | | | item c | +----------------+----------------+----------------+----------------+ | If no Call | | IETF RF | Value stored | | diversion | | C 4458 [113] | from a | | information | | \"cause\" URI | previously | | parameter is | | parameter in | received ACM | | present | | the | or CPG. See | | | | hi-t | tables | | | | argeted-to-uri | 7.5.4.3.8 and | | | | | 7.5.4.3.9. | +----------------+----------------+----------------+----------------+ | | | privacy | Value stored | | | | \"headers\" | from a | | | | component of | previously | | | | the | received ACM | | | | hi-t | or CPG. See | | | | argeted-to-uri | tables | | | | | 7.5.4.3.8 and | | | | | 7.5.4.3.9. | +----------------+----------------+----------------+----------------+ | Redirection | | | See table | | number | | | 7.5.4.3.7 | | restriction | | | | | (NOTE 2) | | | | +----------------+----------------+----------------+----------------+ | NOTE 1: Needs | | | | | to be stored | | | | | for a possible | | | | | inclusion into | | | | | subsequent | | | | | messages. | | | | | | | | | | NOTE 2: This | | | | | parameter may | | | | | appear without | | | | | call diversion | | | | | information | | | | | parameter and | | | | | redirection | | | | | number. In | | | | | such cases, | | | | | the O-MGCF | | | | | shall send the | | | | | previously | | | | | sent and | | | | | stored | | | | | History-Info | | | | | header field | | | | | and set the | | | | | priv-value in | | | | | the | | | | | History-Info | | | | | header field | | | | | as described | | | | | in | | | | | ta | | | | | ble 7.5.4.3.7. | | | | +----------------+----------------+----------------+----------------+
Table 7.5.4.3.11: Mapping of ANM  200 (OK) response (to INVITE request)
* * *
ISUP Parameter Derived value of parameter field SIP component Value
Redirection number History-Info header field with one hi-entry and the hi-
target-param \"mp\" header field parameter See table 7.5.4.3.8 IETF RFC 4458
[113] \"cause\" URI parameter in the hi-targeted-to-uri Value stored from a
previous received ACM or CPG. See tables 7.5.4.3.8 and 7.5.4.3.9. Redirection
number restriction (NOTE) See table 7.5.4.3.7 NOTE: This parameter may appear
without Call diversion information parameter and Redirection number. In such
cases, the O-MGCF shall send the previously sent and stored History-Info
header field and set the priv-value in the History-Info header field as
described in table 7.5.4.3.7.
* * *
### 7.5.5 Communication Hold (HOLD)
The mapping of Communication Hold supplementary service with Call Hold
PSTN/ISDN Supplementary Service is the same mapping as described in clause
7.4.10. The Service itself is described within 3GPP TS 24.610 [65].
### 7.5.6 Conference call (CONF)
#### 7.5.6.1 General
The protocol description of the CONF supplementary service is described in
3GPP TS 24.605 [61]. In this clause the interworking from the conference event
package in accordance with IETF RFC 4575 [100] to the messages of the
PSTN/ISDN CONF supplementary service is described. Note that an interworking
from the PSTN/ISDN to the IMS is out of scope.
#### 7.5.6.2 Subscribing for the conference event package
Based on local policy, the MGCF may subscribe for the conference event package
on behalf of the PSTN/ISDN participant after the participant joins or is added
to a conference.
When the conference event package option is implemented, and one of the
following events occurs at the MGCF:
\- a 200 (OK) response is received as a response to an initial INVITE request
originated by the MGCF, where the Contact header field contains an \"isfocus\"
parameter; or
\- an ACK message is received which acknowledges a 200 (OK) response to the
initial INVITE request, and the initial INVITE request is originated by the
conferencing AS and contains an \"isfocus\" parameter in the Contact header
field;
then the following steps shall be performed:
1) a SUBSCRIBE request shall be created according to IETF RFC 4575 [100],
using the updated procedures from IETF RFC 6665 [138];
2) the Request URI is set to the Contact address of the conferencing AS;
3) the P-Asserted-Identity header field, the From header field and the Privacy
header field are set with the same value as:
\- the P-Asserted-Identity header field, the From header field and the Privacy
header field in the initial INVITE request originated by the MGCF; or
\- the P-Asserted-Identity header field, the To header field and the Privacy
header field in a 18x or 2xx response sent by the MGCF to the initial INVITE
request from the conferencing AS.
#### 7.5.6.3 Interworking the notification
NOTE: There is a need to differentiate between the procedures of interworking
for a full and a partial type of notification.
When a full type of notification is received a check is made of the content.
If the changes with respect a previous version of the notification have not
been sent on to the PSTN/ISDN for this session, the MGCF shall perform an ISUP
interaction towards the PSTN/ISDN. If the changes with respect a previous
version of the notification have been sent to the PSTN/ISDN for this session,
the MGCF shall not perform an ISUP interaction towards the PSTN/ISDN.
When a partial notification is received then it is assumed that a value of a
received notification has changed, so the MGCF performs an ISUP interaction
towards the PSTN/ISDN, as follows:
\- Conference established:
Upon the receipt of a conference information document with the \ element _active_ is set to \"true\", the MGCF shall send a CPG
message to the PSTN/ISDN with a notification \"_conference established_ \".
\- Participant added:
Upon the receipt of a conference information document with the \ and the element _status of endpoint‑status-type_ is set to \"connected\"
and it was not set to \"on-hold\" before and the Contact URI in the element
_entity_ is not the address of the served PSTN/ISDN participant, the MGCF
shall send a CPG message to the PSTN/ISDN with a notification \"_other party
added_ \".
\- Served PSTN/ISDN participant isolated:
Upon the receipt of a conference information document with the \ and the element _status of endpoint‑status-type_ is set to \"on-hold\"
and it was set to \"connected\" before and the Contact URI in the element
_entity_ is the address of the served PSTN/ISDN participant, the MGCF shall
send a CPG message to the PSTN/ISDN with a notification \"_isolated_ \".
\- Other participant isolated:
Upon the receipt of a conference information document with the \ and the element _status of endpoint‑status-type_ is set to \"on-hold\"
and it was set to \"connected\" before and the Contact URI in the element
_entity_ is not the address of the served PSTN/ISDN participant, the MGCF
shall send a CPG message to the PSTN/ISDN with a notification \"_other party
isolated_ \".
\- Served PSTN/ISDN participant reattached:
Upon the receipt of a conference information document with the \ and the element _status of endpoint‑status-type_ is set to \"connected\"
and it was set to \"on-hold\" before and the Contact URI in the element
_entity_ is the address of the served PSTN/ISDN participant, the MGCF shall
send a CPG message to the PSTN/ISDN with a notification \"_reattached_ \".
\- Other participant reattached:
Upon the receipt of a conference information document with the \ and the element _status of endpoint‑status-type_ is set to \"connected\"
and it was set to \"on-hold\" before and the Contact URI in the element
_entity_ is not the address of the served PSTN/ISDN participant, the MGCF
shall send a CPG message to the PSTN/ISDN with a notification \"_other party
reattached_ \".
\- Other party disconnected:
Upon the receipt of a conference information document with the \ and the element _status of endpoint‑status-type_ is set to
\"disconnected\" and the element _joining-method of joining-type_ is not set
to \"focus-owner\", the MGCF shall send a CPG message to the PSTN/ISDN with a
notification \"_other party disconnected_ \".
### 7.5.7 Anonymous Communication Rejection (ACR) and Communication Barring
(CB)
The Anonymous Communication rejection (ACR) and Communication Barring (CB)
services are described within 3GPP TS 24.611 [67].
The mapping of Anonymus Communication Rejection supplementary service with
Anonymus Call Rejection PSTN/ISDN Supplementary Service is described in clause
7.4.23.
The mapping for Communication Barring is in accordance with the basic call
procedures as described in clauses 7.2.3.1.8 and 7.2.3.2.12.
### 7.5.8 Message Waiting Indication (MWI)
The Message Waiting Indication supplementary service is described within 3GPP
TS 24.606 [62].
### 7.5.9 Malicious Communication Identification (MCID)
#### 7.5.9.0 General
The protocol specification of the Malicious Communication Identification
supplementary service is described in 3GPP TS 24.616 [102]. The XML MCID body
used in related SIP messages is also specified in 3GPP TS 24.616 [102].
#### 7.5.9.1 Interworking at the O-MGCF
##### 7.5.9.1.0 General
If the MGCF supports the interworking of the MCID service the O-MGCF shall map
a SIP INFO request (\"legacy\" mode of usage of the INFO method as defined in
IETF RFC 6086 [133]) containing a XML mcid body with MCID XML Request schema
to an Identification Request (IDR) message and an Identification response
(IRS) message to a SIP INFO request containing a XML mcid body with MCID XML
Response schema in accordance with table 7.5.9.1.1.
The IDR message shall be generated upon reception of the SIP INFO request
containing a XML mcid body with MCID XML Request schema.
The SIP INFO request containing a XML mcid body with MCID XML Response schema
shall be generated upon reception of the IRS message.
Table 7.5.9.1.1 Mapping between ISUP IDR and IRS and SIP messages
* * *
ISUP Message SIP Message IDR INFO containing a XML mcid body with MCID XML
Request schema IRS INFO containing a XML mcid body with MCID XML Response
schema
* * *
##### 7.5.9.1.1 Interworking of the MCID XML Request schema with the ISUP MCID
request indicators
If the MGCF supports the interworking of the MCID service O-MGCF shall map the
codes in the MCID XML elements to MCID request indicator and holding indicator
parameter fields in accordance with table 7.5.9.1.1.1.
Table 7.5.9.1.1.1 Mapping between ISUP MCID request and holding indicators and
MCID XML elements
* * *
ISUP Parameter XML Element  
bit A: MCID request indicator McidRequestIndicator 0 MCID not requested type=0
1 MCID requested type=1 []{.underline}  
bit B: Holding indicator (national use) HoldingIndicator 0 holding not
requested type=0 1 holding requested type=1
* * *
##### 7.5.9.1.2 Interworking of the ISUP MCID response indicators with the
MCID XML Response schema
If the MGCF supports the interworking of the MCID service the O-MGCF shall map
the codes in the MCID response indicator and hold provided indicator parameter
field to the MCID XML elements in accordance with table 7.5.9.1.2.1.
Table 7.5.9.1.2.1 Mapping between ISUP MCID response and hold provided
indicators and MCID XML elements
* * *
ISUP Parameter XML Element  
bit A: MCID response indicator McidResponseIndicator 0 MCID not included
type=0 1 MCID included type=1
bit B: _Hold provided indicator (national use)_ HoldingProvidedIndicator 0
holding not provided type=0 1 holding provided type=1
* * *
##### 7.5.9.1.3 Interworking of the ISUP Calling Party Number in an
Identification Response with the OrigPartyIdentity within the MCID XML
Response schema
If the O-MGCF supports the interworking of the MCID service and receives an
ISUP Identification Response containing a Calling Party Number with the
screening indicator set to \"_user provided, verified and passed_ \" or
\"_network provided_ \", the O-MGCF shall map the Calling Party Number to the
MCID XML Response schema OrigPartyIdentity element applying the same mapping
procedures as described in table 14 for the mapping into the SIP P-Asserted-
Identity header and shall map the Calling Party Number APRI to the MCID XML
Response schema OrigPartyPresentationRestriction element. If the Calling Party
Number APRI has a value of \"_presentation allowed_ \" then the MCID XML
Response schema OrigPartyPresentationRestriction element shall be set to
\"_false_ \", otherwise it shall be set to \"_true_ \".
##### 7.5.9.1.4 Interworking of the ISUP Generic Number in an Identification
Response with the GenericNumber within the MCID XML Response schema
If the O-MGCF supports the interworking of the MCID service and receives an
ISUP Identification Response containing a Generic Number with the screening
indicator set to \"_user provided, verified and passed_ \", or \"_user
provided, not verified_ \", or \"_network provided_ \", the O-MGCF shall map
the Generic Number to the MCID XML Response schema GenericNumber element
applying the same mapping procedures as described in table 13 for the mapping
into the SIP From header and shall map the Generic Number APRI to the MCID XML
Response schema GenericNumberPresentationRestriction element. If the Generic
Number APRI has a value of \"_presentation allowed_ \" then the MCID XML
Response schema GenericNumberPresentationRestriction element shall be set to
\"_false_ \", otherwise it shall be set to \"_true_ \".
#### 7.5.9.2 Interworking at the I-MGCF
##### 7.5.9.2.1 General
If the MGCF supports the interworking of the MCID service the I-MGCF shall map
an Identification Request (IDR) message to a SIP INFO request (\"legacy\" mode
of usage of the INFO method as defined in IETF RFC 6086 [133]) containing a
XML mcid body with MCID XML Request schema and a SIP INFO request containing a
XML mcid body with MCID XML Response schema to an Identification response
(IRS) message in accordance with table 7.5.9.1.1.
##### 7.5.9.2.2 Interworking of identification Request
The SIP INFO request containing a XML mcid body with MCID XML Request schema
shall be generated upon reception of the IDR message. The I-MGCF shall map the
codes in the MCID request indicator and holding indicator parameter fields to
the MCID XML elements in accordance with table 7.5.9.1.1.1.
##### 7.5.9.2.3 Interworking of identification Response
The IRS message shall be generated upon reception of the SIP INFO request
containing a XML mcid body with MCID XML Response schema. The I-MGCF shall map
the codes in the MCID XML elements to the MCID response indicator and hold
provided indicator parameter fields in accordance with table 7.5.9.1.2.1.
If the received MCID XML Response schema contains an OrigPartyIdentity
element, the I-MGCF shall map the OrigPartyIdentity to the Calling Party
Number within the IRS applying the same mapping procedure as described in
table 5 for the mapping from the SIP P-Asserted-Identity header, with the
exception that the I-MGCF shall map the MCID XML Response schema
OrigPartyPresentationRestriction element to the Calling Party Number APRI. If
the MCID XML Response schema OrigPartyPresentationRestriction element has the
value \"_true_ \", the Calling Party Number APRI shall be set to
\"_presentation restricted_ \", and otherwise the Calling Party Number APRI
shall be set to \"_presentation allowed_ \".
If the received MCID XML Response schema contains an GenericNumber element,
the I-MGCF shall map the GenericNumber to the Generic Number within the IRS
applying the same mapping procedure as described in table 6 for the mapping
from the From header, with the exception that the I-MGCF shall map the MCID
XML Response schema GenericNumber PresentationRestriction element to the
Generic Number APRI. If the MCID XML Response schema
GenericNumberPresentationRestriction element has the value \"_true_ \", the
Generic Number APRI shall be set to \"_presentation restricted_ \", and
otherwise the Generic Number APRI shall be set to \"_presentation allowed_ \".
### 7.5.10 Closed User Group (CUG)
#### 7.5.10.0 General
The protocol specification of the Closed User Group supplementary service is
described in 3GPP TS 24.654 [101].
#### 7.5.10.1 Interworking at the I-MGCF
If the I-MGCF supports the interworking of CUG supplementary service, the
I-MGCF shall map between the SIP and ISUP messages in accordance with table
7.5.10.1.1.
Table 7.5.10.1.1: Mapping of SIP messages to ISUP messages
* * *
SIP Message ISUP Message INVITE request containing a XML cug body with CUG XML
schema IAM containing the Closed user group interlock code Parameter and the
closed user group call indicator of the Optional Forward Call Indicator
Parameter
* * *
If the MGCF supports the interworking of CUG supplementary service, the I-MGCF
shall interwork the CUG XML schema with the ISUP Closed user group interlock
code parameter and the _Closed user group call indicator_ of the optional
forward call indicator parameter in accordance with tables 7.5.10.1.2 and
7.5.10.1.3.
Table 7.5.10.1.2: Mapping of the SIP XML CUG Element to the ISUP closed
usergroup interlock code parameter
* * *
CUG XML Element Source component value ISUP Closed user group interlock code
Parameter derived value of parameter field networkIndicator
networkIdentityType = 4 hexbinary coded digits (NOTE) _\"Network Identity\"_
Octet 1 & Octet 2 including 4 binary coded digits derived from XML Network
Identity cugInterlockBinaryCode sixteenbitType = 16 bit coded value _\"Binary
Code\"_ Octet 3 & Octet 4 including a 16 bit Binary Code derived from the XML
Binary Code NOTE: ISUP Closed user group interlock code Parameter Octet 1
contains \"Network Identity\" (NI) digits 1 & 2 and Octet 2 contains \"Network
Identity\" digits 3 & 4.The networkidentityType is filled with \"Octet1 &
Octet 2\" = \"NI digit 1, NI digit 2, NI digit 3, NI digit 4\". Example: Digit
1=0, Digit 2=4, Digit 3=9, Digit 4=0 so the networkidentityType is encoded
with \"0490\".
* * *
Table 7.5.10.1.3: Mapping of the SIP XML CUG Element to the ISUP closed user
group call indicator included in the optional Forward Call Indicator Parameter
* * *
CUG XML Element Source component value ISUP \"Optional Forward Call
Indicator\" Parameter derived value of parameter field
cugCommunicationIndicator Type=00 _\"closed user group call_ \" indicator non-
CUG call Type=01 spare Type=10 closed user group call, outgoing access allowed
Type=11 closed user group call, outgoing access not allowed
* * *
If the I-MGCF supports the interworking of CUG supplementary service, then if
an INVITE request with the MIME including a cug XML element is received and
the terminating network is not supporting CUG, the I-MGCF shall behave as
shown in table 7.5.10.1.4.
Table 7.5.10.1.4: Action at the I-MGCF with a PSTN/ISDN network without CUG
capability
* * *
cugCommunicationIndicator in INVITE request Action at the I-MGCF Type=11 (CUG
without outgoing access) Release the communication with 403 Type=10 (CUG with
outgoing access) Treat the communication as an ordinary call (NOTE) Non-CUG
Treat the communication as an ordinary call NOTE: The
cugCommunicationIndicator shall not be mapped or if appropriate the CUG call
indicator of the optional forward call indicator shall be set to non-CUG call.
* * *
#### 7.5.10.2 Interworking at the O-MGCF
If the MGCF supports the interworking of CUG supplementary service, the O-MGCF
shall map between the SIP and ISUP messages in accordance with table
7.5.10.2.1
Table 7.5.10.2.1: Mapping of ISUP messages to SIP messages
* * *
ISUP Message SIP Message IAM containing the Closed user group interlock code
Parameter and the closed user group call indicator of the Optional Forward
Call Indicator Parameter INVITE request containing a XML cug body with CUG XML
schema
* * *
If the MGCF supports the interworking of CUG supplementary service, the MGCF
shall interwork the CUG XML schema with the ISUP Closed user group interlock
code parameter and the _Closed user group call indicator_ of the optional
forward call indicator parameter in accordance with tables 7.5.10.2.2 and
table 7.5.10.2.3.
Table 7.5.10.2.2: Mapping of the ISUP closed usergroup interloccode to SIP XML
CUG element
* * *
ISUP Closed user group interlock code Parameter Source component value CUG XML
Element derived value of parameter field _\"Network Identity\"_ Octet 1 &
Octet 2 including 4 binary coded digits networkIndicator networkIdentityType =
4 hexbinary coded digits derived from Network Identity (NOTE) _\"Binary
Code\"_ Octet 3 & Octet 4 including a 16 bit Binary Code
cugInterlockBinaryCode sixteenbitType = 16 bit coded value derived from Binary
Code NOTE: ISUP Closed user group interlock code Parameter Octet 1 contains
\"Network Identity\" (NI) digits 1 & 2 and Octet 2 contains \"Network
Identity\" digits 3 & 4.The networkidentityType shall be filled with \"Octet1
& Octet 2\" = \"NI digit 1, NI digit 2, NI digit 3, NI digit 4\". Example:
Digit 1=0, Digit 2=4, Digit 3=9, Digit 4=0 so the networkidentityType is
encoded with \"0490\".
* * *
Table 7.5.10.2.3: Mapping of the ISUP Closed user group call indicator to SIP
XML CUG element
* * *
ISUP Optional Forward Call Indicator Parameter Source component value CUG XML
Element derived value of parameter field closed user group call indicator non-
CUG call cugCommunicationIndicator Type=00 spare Type=01 closed user group
call, outgoing access allowed Type=10 closed user group call, outgoing access
not allowed Type=11
* * *
If the MGCF supports the interworking of CUG supplementary service, but the
IMS is not supporting CUG, the procedures described in ITU Q.735.1 [42] shall
apply if an INVITE request with the MIME body including a cug XML element is
sent and the O-MGCF supports CUG supplementary service.
### 7.5.11 CCBS/CCNR
#### 7.5.11.0 General
The protocol specification of the Completion of Communications to Busy
Subscriber and Completion of Communications by No Reply supplementary services
is described in 3GPP TS 24.642 [112].
SIP SUBSCRIBE and NOTIFY methods shall be used in accordance with the
procedures defined in IETF RFC 6665 [138].
#### 7.5.11.1 Interworking at the I-MGCF
If the I-MGCF supports the interworking of CCBS/CCNR supplementary services,
the I-MGCF shall map between the SIP and ISUP messages in accordance with
table 7.5.11.1.1.
Table 7.5.11.1.1: Mapping of ISUP and SIP messages
+----------------+----------------+--------------+----------------+ | SIP Message | Parameter | ISUP Message | Parameter | +----------------+----------------+--------------+----------------+ | ← 180 Ringing | Call-Info | ← ACM | Called | | | header field | | party\'s | | | with purpose | | status | | | header field | | indicator set | | | parameter set | | to | | | to | | \"Subscriber | | | \"cal | | free\" and | | | l-completion\" | | | | | and \"m\" | | CCNR possible | | | header field | | indicator set | | | parameter set | | to \"CCNR | | | to \"NR\" (no | | possible\"\ | | | reply)\ | | (NOTE 2) | | | (NOTE 1) | | | +----------------+----------------+--------------+----------------+ | ← 180 Ringing | Call-Info | ← CPG | Event | | | header field | | indicator set | | | with purpose | | to | | | header field | | \"Alerting\" | | | parameter set | | and | | | to | | | | | \"c | | CCNR possible | | | all-completion | | indicator set | | | and \"m\" | | to \"CCNR | | | header field | | possible\"\ | | | parameter set | | (NOTE 2) | | | to \"NR\" (no | | | | | reply) | | | | | | | | | | (NOTE 1) | | | +----------------+----------------+--------------+----------------+ | ← 486 Busy | Call-Info | ← REL | Cause | | here | header field | | Indicator\ | | | with purpose | | cause #17 | | | header field | | with | | | parameter set | | Diagnostic | | | to | | (CCBS | | | \"cal | | indicator set | | | l-completion\" | | to \"CCBS | | | and \"m\" | | possible\")\ | | | header field | | (NOTE 3) | | | parameter set | | | | | to \"BS\" | | | | | (busy | | | | | subscriber) | | | | | | | | | | (NOTE 1) | | | +----------------+----------------+--------------+----------------+ | → INVITE | Request-URI | → IAM | CCSS parameter | | | contains \"m\" | | set to \"CCSS | | | SIP URI | | call\"\ | | | parameter or | | (NOTE 2) (NOTE | | | Call-Info | | 4) | | | header field | | | | | contains | | | | | \"purpose\" | | | | | header field | | | | | parameter set | | | | | to | | | | | \"cal | | | | | l-completion\" | | | | | and \"m\" | | | | | header field | | | | | parameter.\ | | | | | (NOTE 1) | | | +----------------+----------------+--------------+----------------+ | NOTE 1: The | | | | | coding shall | | | | | be in | | | | | accordance | | | | | with | | | | | IETF RFC | | | | | 6910 [106]. | | | | | | | | | | NOTE 2: The | | | | | coding shall | | | | | be in | | | | | accordance | | | | | with ITU-T | | | | | recommendation | | | | | Q.763 [4]. | | | | | | | | | | NOTE 3: The | | | | | coding shall | | | | | be in | | | | | accordance | | | | | with ITU-T | | | | | recommendation | | | | | Q.850 [38]. | | | | | | | | | | NOTE 4: CCSS | | | | | parameter set | | | | | to the value | | | | | \"CCSS call\" | | | | | is included in | | | | | the IAM if | | | | | Request-URI | | | | | contains the | | | | | SIP URI | | | | | parameter | | | | | \"m\" i.e. | | | | | creation of | | | | | the CCSS | | | | | parameter does | | | | | not depend on | | | | | the received | | | | | value of the | | | | | SIP URI | | | | | parameter | | | | | \"m\". | | | | +----------------+----------------+--------------+----------------+
If the I-MGCF supports the interworking of CCBS/CCNR supplementary services,
the I-MGCF shall map between the SIP and TCAP messages in accordance with
table 7.5.11.1.2 and table 7.5.11.1.3.
Table 7.5.11.1.2: Mapping of SIP messages to TCAP messages
+----------------+----------------+----------------+----------------+ | SIP Message | Parameter | TCAP Message | Parameter | +----------------+----------------+----------------+----------------+ | SUBSCRIBE with | Request-URI | TC-Begin CCBS | Cal | | m-parameter in | (NOTE 5) | REQUEST | ledPartyNumber | | Request-URI | | (invoke) | (NOTE 3) | | set to \"BS\" | | | | | or containing | | | | | Call-Info | | | | | header field | | | | | with | | | | | \"purpose\" | | | | | parameter set | | | | | to | | | | | \"cal | | | | | l-completion\" | | | | | and | | | | | m-parameter | | | | | set to \"BS\"\ | | | | | (NOTE 1) | | | | +----------------+----------------+----------------+----------------+ | | P-Ass | | Call | | | erted-Identity | | ingPartyNumber | | | | | (NOTE 4) | +----------------+----------------+----------------+----------------+ | | | | R | | | | | etainSupported | | | | | (NOTE 2) | +----------------+----------------+----------------+----------------+ | SUBSCRIBE with | Request-URI | TC-Begin CCNR | Cal | | m-parameter in | (NOTE 5) | REQUEST | ledPartyNumber | | Request-URI | | (invoke) | (NOTE 3) | | set to \"NR\" | | | | | or containing | | | | | Call-Info | | | | | header field | | | | | with | | | | | \"purpose\" | | | | | parameter set | | | | | to | | | | | \"cal | | | | | l-completion\" | | | | | and | | | | | m-parameter | | | | | set to \"NR\"\ | | | | | (NOTE 1) | | | | +----------------+----------------+----------------+----------------+ | | P-Ass | | Call | | | erted-Identity | | ingPartyNumber | | | | | (NOTE 4) | +----------------+----------------+----------------+----------------+ | | | | R | | | | | etainSupported | | | | | (NOTE 2) | +----------------+----------------+----------------+----------------+ | PUBLISH with | | TC-Cont CCBS | | | m-parameter in | | SUSPEND | | | Request-URI or | | | | | m-parameter in | | | | | Call-Info | | | | | header field | | | | | set to \"BS\" | | | | | and body | | | | | containing | | | | | PIDF basic | | | | | status set to | | | | | \"closed\". | | | | +----------------+----------------+----------------+----------------+ | PUBLISH with | | TC-Cont CCBS | | | m-parameter in | | RESUME | | | Request-URI or | | | | | m-parameter in | | | | | Call-Info | | | | | header field | | | | | set to \"BS\" | | | | | and body | | | | | containing | | | | | PIDF basic | | | | | status set to | | | | | \"open\". | | | | +----------------+----------------+----------------+----------------+ | PUBLISH with | | TC-Cont CCBS | | | m-parameter in | | SUSPEND | | | Request-URI or | | | | | m-parameter in | | | | | Call-Info | | | | | header field | | | | | set to \"NR\" | | | | | and body | | | | | containing | | | | | PIDF basic | | | | | status set to | | | | | \"closed\". | | | | +----------------+----------------+----------------+----------------+ | PUBLISH with | | TC-Cont CCBS | | | m-parameter in | | RESUME | | | Request-URI or | | | | | m-parameter in | | | | | Call-Info | | | | | header field | | | | | set to \"NR\" | | | | | and body | | | | | containing | | | | | PIDF basic | | | | | status set to | | | | | \"open\". | | | | +----------------+----------------+----------------+----------------+ | SUBSCRIBE with | | TC-End CCBS | | | m-parameter in | | CANCEL | | | Request-URI or | | | | | m-parameter in | | | | | Call-Info | | | | | header field | | | | | set to \"BS\" | | | | | and with | | | | | Expires header | | | | | set to | | | | | \"zero\". | | | | +----------------+----------------+----------------+----------------+ | SUBSCRIBE with | | TC-End CCBS | | | m-parameter in | | CANCEL | | | Request-URI or | | | | | m-parameter in | | | | | Call-Info | | | | | header field | | | | | set to \"NR\" | | | | | and with | | | | | Expires header | | | | | set to | | | | | \"zero\". | | | | +----------------+----------------+----------------+----------------+ | NOTE 1: | | | | | Expires header | | | | | defines | | | | | subscription | | | | | duration / CC | | | | | service | | | | | duration timer | | | | | (CC-T3). | | | | | | | | | | NOTE 2: | | | | | Parameter is | | | | | set by | | | | | default, as | | | | | retention | | | | | option is | | | | | supported in | | | | | IMS by | | | | | default. | | | | | | | | | | NOTE 3: | | | | | Mapping of the | | | | | Request-URI to | | | | | the | | | | | Cal | | | | | ledPartyNumber | | | | | is done | | | | | according to | | | | | table 2 in | | | | | claus | | | | | e 7.2.3.1.2.1. | | | | | | | | | | NOTE 4: | | | | | Mapping of the | | | | | P-Ass | | | | | erted-Identity | | | | | header field | | | | | to the | | | | | Call | | | | | ingPartyNumber | | | | | is done | | | | | according to | | | | | table 5 in | | | | | claus | | | | | e 7.2.3.1.2.6. | | | | | | | | | | NOTE 5: If URI | | | | | of the MGCF | | | | | was returned | | | | | in the | | | | | Call-Info | | | | | header field | | | | | in the 180 | | | | | Ringing or 486 | | | | | Busy Here | | | | | messages | | | | | described in | | | | | table | | | | | 7.5.11.1.1, | | | | | then the MGCF | | | | | needs to | | | | | remember the | | | | | Request-URI of | | | | | the original | | | | | INVITE for | | | | | mapping to the | | | | | Call | | | | | edPartyNumber. | | | | +----------------+----------------+----------------+----------------+
Table 7.5.11.1.3: Mapping of TCAP messages to SIP messages
* * *
TCAP Message Parameter SIP Message Parameter TC-Cont CCBS REQUEST (return
result) RetainSupported NOTIFY with cc-state parameter set to \"queued\" cc-
service-retention TC-End CCBS/CCNR REQUEST (error result) ShortTermDenial 480
Temporarily Unavailable  
TC-End CCBS/CCNR REQUEST (error result) LongTermDenial 403 Forbidden  
TC-End CCBS CANCEL NOTIFY with the \"reason\" Subscription-State header field
parameter set to \"noresource\"  
TC-Cont REMOTE USER FREE NOTIFY with cc-state set to \"ready\" (NOTE)  
NOTE: This does not terminate the subscribtion AS-AS.
* * *
#### 7.5.11.2 Interworking at the O-MGCF
If the O-MGCF supports the interworking of CCBS/CCNR supplementary services,
the O-MGCF shall map between the ISUP and SIP messages in accordance with
table 7.5.11.2.1.
Table 7.5.11.2.1: Mapping of SIP and ISUP messages
+----------------+----------------+----------------+----------------+ | ISUP Message | Parameter | SIP Message | Parameter | +----------------+----------------+----------------+----------------+ | ← ACM | Called | ← 180 Ringing | Call-Info | | | party\'s | | header field | | | status | | with purpose | | | indicator set | | header field | | | to | | parameter set | | | \"Subscriber | | to | | | free\" and | | \"call | | | | | -completion\"\ | | | CCNR possible | | (NOTE 1) | | | indicator set | | | | | to \"CCNR | | | | | possible\"\ | | | | | (NOTE 2) | | | +----------------+----------------+----------------+----------------+ | ← CPG | Event | | | | | indicator set | | | | | to | | | | | \"Alerting\" | | | | | and | | | | | | | | | | CCNR possible | | | | | indicator set | | | | | to \"CCNR | | | | | possible\"\ | | | | | (NOTE 2) (NOTE | | | | | 4) | | | +----------------+----------------+----------------+----------------+ | ← REL | Cause | ← 486 Busy | Call-Info | | | Indicator\ | here | header field | | | cause #17 or | | with purpose | | | #34 with | | header field | | | Diagnostic | | parameter set | | | (CCBS | | to | | | indicator set | | \"call | | | to \"CCBS | | -completion\"\ | | | possible\")\ | | (NOTE 1) | | | (NOTE 3) | | | +----------------+----------------+----------------+----------------+ | → IAM | CCSS parameter | → INVITE | Request URI | | | set to \"CCSS | | contains | | | call\"\ | | m-parameter | | | (NOTE 2) | | and a | | | | | Call-Info | | | | | header field | | | | | field, with | | | | | purpose header | | | | | field | | | | | parameter set | | | | | to | | | | | \"call | | | | | -completion\", | | | | | and an | | | | | m-parameter\ | | | | | (NOTE 1) (NOTE | | | | | 5) | +----------------+----------------+----------------+----------------+ | NOTE 1: The | | | | | coding shall | | | | | be in | | | | | accordance | | | | | with | | | | | IETF RFC | | | | | 6910 [106]. | | | | | | | | | | NOTE 2: The | | | | | coding shall | | | | | be in | | | | | accordance | | | | | with ITU-T | | | | | recommendation | | | | | Q. 763 [4]. | | | | | | | | | | NOTE 3: The | | | | | coding shall | | | | | be in | | | | | accordance | | | | | with ITU-T | | | | | recommendation | | | | | Q. 850 [38]. | | | | | | | | | | NOTE 4: A CPG | | | | | will be sent | | | | | if an ACM was | | | | | already sent. | | | | | | | | | | NOTE 5: Based | | | | | on the | | | | | operator | | | | | policy the | | | | | \"m\" SIP URI | | | | | parameter in | | | | | the | | | | | Request-URI | | | | | and | | | | | m-parameter in | | | | | Call-Info | | | | | header field | | | | | is set to the | | | | | value \"BS\" | | | | | or \"NR\". | | | | +----------------+----------------+----------------+----------------+
If the O-MGCF supports the interworking of CCBS/CCNR supplementary services,
the O-MGCF shall map between the TCAP and SIP messages in accordance with
table 7.5.11.2.2 and table 7.5.11.2.3.
Table 7.5.11.2.2: Mapping of TCAP messages to SIP messages
+----------------+----------------+----------------+----------------+ | TCAP Message | Parameter | SIP Message | Parameter | +----------------+----------------+----------------+----------------+ | TC-Begin CCBS | Cal | SUBSCRIBE with | To header | | REQUEST | ledPartyNumber | m-parameter in | (NOTE 2) | | (invoke) | | Request URI | | | | | and | | | | | m-parameter in | | | | | Call-Info | | | | | header field | | | | | set to \"BS\" | | | | | (NOTE 1) | | +----------------+----------------+----------------+----------------+ | | | | Request-URI | | | | | (NOTE 2) | +----------------+----------------+----------------+----------------+ | | Call | | From header | | | ingPartyNumber | | (NOTE 3) | +----------------+----------------+----------------+----------------+ | | | | P-Ass | | | | | erted-Identity | | | | | (NOTE 4) | +----------------+----------------+----------------+----------------+ | TC-Begin CCNR | Cal | SUBSCRIBE with | To header | | REQUEST | ledPartyNumber | m-parameter in | (NOTE 2) | | (invoke) | | Request URI | | | | | and | | | | | m-parameter in | | | | | Call-Info | | | | | header field | | | | | set to \"NR\" | | | | | (NOTE 1) | | +----------------+----------------+----------------+----------------+ | | | | Request-URI | | | | | (NOTE 2) | +----------------+----------------+----------------+----------------+ | | Call | | From header | | | ingPartyNumber | | (NOTE 3) | +----------------+----------------+----------------+----------------+ | | | | P-Ass | | | | | erted-Identity | | | | | (NOTE 4) | +----------------+----------------+----------------+----------------+ | TC-Cont CCBS | | PUBLISH with | | | SUSPEND | | m-parameter in | | | | | Request URI | | | | | and | | | | | m-parameter in | | | | | Call-Info | | | | | header field | | | | | set to \"BS\" | | | | | and body | | | | | containing | | | | | PIDF basic | | | | | status set to | | | | | \"closed\". | | +----------------+----------------+----------------+----------------+ | | | PUBLISH with | | | | | m-parameter in | | | | | Request URI | | | | | and | | | | | m-parameter in | | | | | Call-Info | | | | | header field | | | | | set to \"NR\" | | | | | and body | | | | | containing | | | | | PIDF basic | | | | | status set to | | | | | \"closed\". | | +----------------+----------------+----------------+----------------+ | TC-Cont CCBS | | PUBLISH with | | | RESUME | | m-parameter in | | | | | Request URI | | | | | and | | | | | m-parameter in | | | | | Call-Info | | | | | header field | | | | | set to \"BS\" | | | | | and body | | | | | containing | | | | | PIDF basic | | | | | status set to | | | | | \"open\". | | +----------------+----------------+----------------+----------------+ | | | PUBLISH with | | | | | m-parameter in | | | | | Request URI | | | | | and | | | | | m-parameter in | | | | | Call-Info | | | | | header field | | | | | set to \"NR\" | | | | | and body | | | | | containing | | | | | PIDF basic | | | | | status set to | | | | | \"open\". | | +----------------+----------------+----------------+----------------+ | TC-End CCBS | | SUBSCRIBE with | | | CANCEL | | m-parameter in | | | | | Request URI | | | | | and | | | | | m-parameter in | | | | | Call-Info | | | | | header field | | | | | set to \"BS\" | | | | | and with | | | | | Expires header | | | | | set to \"0\" | | +----------------+----------------+----------------+----------------+ | | | SUBSCRIBE with | | | | | m-parameter in | | | | | Request URI | | | | | and | | | | | m-parameter in | | | | | Call-Info | | | | | header field | | | | | set to \"NR\" | | | | | and with | | | | | Expires header | | | | | set to \"0\" | | +----------------+----------------+----------------+----------------+ | NOTE 1: | | | | | Expires header | | | | | defines | | | | | subscription | | | | | duration / CC | | | | | service | | | | | duration timer | | | | | (CC-T3). | | | | | | | | | | NOTE 2: For | | | | | the mapping of | | | | | the | | | | | Cal | | | | | ledPartyNumber | | | | | to the To | | | | | header and | | | | | Request-URI | | | | | see table 10a | | | | | in | | | | | claus | | | | | e 7.2.3.2.2.1. | | | | | | | | | | NOTE 3: For | | | | | the mapping of | | | | | the | | | | | Call | | | | | ingPartyNumber | | | | | to the From | | | | | header see | | | | | table 15 in | | | | | claus | | | | | e 7.2.3.2.2.3. | | | | | If no | | | | | Call | | | | | ingPartyNumber | | | | | is available, | | | | | the From | | | | | header shall | | | | | be set to a | | | | | SIP URI with | | | | | addr-spec of | | | | | Unavailable | | | | | User Identity | | | | | as defined in | | | | | TS | | | | | 23.003 [74]. | | | | | | | | | | NOTE 4: For | | | | | the mapping of | | | | | the | | | | | Call | | | | | ingPartyNumber | | | | | to the | | | | | P-Ass | | | | | erted-Identity | | | | | header see | | | | | table 14 in | | | | | claus | | | | | e 7.2.3.2.2.3. | | | | | If no | | | | | Call | | | | | ingPartyNumber | | | | | is available, | | | | | a | | | | | P-Ass | | | | | erted-Identity | | | | | header shall | | | | | not be | | | | | inserted. | | | | +----------------+----------------+----------------+----------------+
Table 7.5.11.2.3: Mapping of SIP messages to TCAP messages
* * *
SIP Message Parameter TCAP Message Parameter NOTIFY with cc-state parameter
set to \"queued\" cc-service-retention TC Cont CCBS/CCNR REQUEST (return
result) RetainSupported 480 Temporarily unavailable TC-End CCBS/CCNR REQUEST
(error result) ShortTermDenial 403 Forbidden TC-End CCBS/CCNR REQUEST (error
result) LongTermDenial NOTIFY with the Subscription-State header field set to
\"terminated\" and the \"reason\" parameter set to \"noresource\" TC-End CCBS
CANCEL  
NOTIFY with cc-state set to \"ready\" (NOTE) TC-Cont REMOTE USER FREE  
NOTE: This does not terminate the subscription AS-AS.
* * *
### 7.5.12 Communication Waiting (CW)
#### 7.5.12.0 General
The protocol specification of the Communication Waiting supplementary service
is described in 3GPP TS 24.615 [111].
#### 7.5.12.1 Interworking at the I-MGCF
With regard to the backward messages of the Call Waiting PSTN/ISDN
supplementary service, the following mapping is valid:
Table 7.5.12.1: Mapping of ISUP messages to SIP Massages
+----------------------------------+----------------------------------+ | Message Received from BICC/ISUP | Message sent to SIP | +----------------------------------+----------------------------------+ | ACM or CPG with generic | 180 Ringing with an Alert-Info | | notification indicator \"Call is | header field set to | | a waiting call\" (NOTE 1). | \" | | | urn:alert:service:call-waiting\" | | | (NOTE 2). | +----------------------------------+----------------------------------+ | NOTE 1: The coding shall be in | | | accordance with ITU-T | | | recommendation Q.733 [42]. | | | | | | NOTE 2: The coding shall be in | | | accordance with | | | IETF RFC 7462 [107]. | | +----------------------------------+----------------------------------+
#### 7.5.12.2 Interworking at the O-MGCF
With regard to the backward messages of the Communication Waiting service, the
following mapping is valid:
Table 7.5.12.2: Mapping of SIP messages to ISUP messages
+----------------------------------+----------------------------------+ | ←Message sent to ISUP | ←Message Received from SIP | +----------------------------------+----------------------------------+ | ACM or CPG with generic | 180 Ringing with an Alert-Info | | notification indicator \"Call is | header field set to | | a waiting call\" (NOTE 1). | \" | | | urn:alert:service:call-waiting\" | | | (NOTE 2). | +----------------------------------+----------------------------------+ | NOTE 1: The coding shall be in | | | accordance with ITU-T | | | recommendation Q733 [42]. | | | | | | NOTE 2: The coding shall be in | | | accordance with | | | IETF RFC 7462 [107]. | | +----------------------------------+----------------------------------+
### 7.5.13 Customized Alerting Tones (CAT)
#### 7.5.13.1 General
The Customized Alerting Tones supplementary service is described in 3GPP TS
24.182 [132].
The interworking procedures in this clause enable the transport of customized
alerting tones provided by an AS in the IM CN subsystem towards a caller in a
CS network.
Based on operator options, one of three different models described in 3GPP TS
24.182 [132] is used in an IM CN subsystem to provide the CAT service. The CAT
interworking procedures at the O-MGCF differ between these models and are
described separately for each model in the subsequent clauses. Support of the
interworking procedures for each of those models is optional.
I-MGCF procedures are not affected.
#### 7.5.13.2 Early session model
##### 7.5.13.2.1 Interworking at the O-MGCF
When CAT service is provided by using early session model as specificed in
3GPP TS 24.182 [132], and if the O-MGCF supports early-sesssion as a network
option, then it shall include the option tag \"early-session\", as defined in
IETF RFC 3959 [131], in Supported header field in each outgoing initial SIP
INVITE request.
After receiving the first SIP 18x response including an early-session SDP,
then the O-MGCF shall send the address complete message (ACM) or Call Progress
message (CPG) with the Optional backward call indicators parameter set to
\"in-band information or an appropriate pattern is now available\". If the SIP
18x response is the SIP 180 Ringing response, then additionally the Called
party\'s status indicator in the ACM message shall be set to \"subscriber
free\" or the Event information in the CPG message shall be set to
\"ALERTING\".
If the O-MGCF applies codec interworking procedures according to Annex B, it
shall interwork the \"session\" disposition SDP (rather than the \"early
session\" disposition SDP).
##### 7.5.13.2.2 MGCF - IM-MGW Interaction for CAT service
###### 7.5.13.2.2.1 General
When the IMS CAT is provided by using early session model as described in 3GPP
TS 24.182 [132], the procedures described in clauses 9.2.3.1 to 9.2.3.3 shall
be applied with the following additions.
###### 7.5.13.2.2.2 IM CN subsystem side Early Session establishment
If the MGCF supports early-session as a network option, upon receipt of a SIP
18x response with an early-session SDP, the MGCF shall use the Configure IMS
Resources procedure (signals 10 and 11 in figure 7.5.13.2.2.5-1, signals 7 and
8 in figure 7.5.13.2.2.5-2) to provide configuration data (derived from early
session SDP received in signal 8 in figure 7.5.13.2.2.5-1 and local
configuration data) to the IM-MGW as detailed below:
\- The MGCF shall indicate the remote IP address and UDP port, i.e. the
destination IP address and UDP port for data sent in the user plane towards
the IM CN subsystem,
\- The MGCF shall indicate the remote codec(s), i.e. the speech codec(s) for
data sent in the user plane towards the IM CN subsystem.
\- The MGCF should select the same codec(s) for early-session SDP with the
codec(s) used for normal session SDP.
\- The MGCF may indicate the local codec(s) and the local IP address and UDP
port. The MGCF shall indicate the local codec(s) if a change is required.
\- The MGCF may indicate that IP interface type is for MboIP.
The IM-MGW shall reply with the selected remote codec(s) and reserve resources
for these codec(s). If local codec(s) were received, the IM-MGW shall also
reply with the selected local codec(s) and reserve the corresponding
resources.
The MCGF shall send the local codec(s), UDP port and IP address in the early-
session SDP to the IMS in the PRACK messages (signal 12 in figure
7.5.13.2.2.5-1 and 7.5.13.2.2.5-2).
###### 7.5.13.2.2.3 IM CN subsystem side normal Session establishment
When the MGCF receives a SIP 200(OK) response to the SIP INVITE request
(signal 14 in figure 7.5.13.2.2.5-1, signal 15 in figure 7.5.13.2.2.5-2), it
shall request the IM-MGW use the Configure IMS Resources procedure for normal
session SDP (signals 15 and 16 in figure 7.5.13.2.2.5-1, signal 16 and 17 in
figure 7.5.13.2.2.5-2) to provide configuration data (derived from SDP
received in signal 8 in figure 7.5.13.2.2.5-1 and local configuration data) to
the IM-MGW as detailed below:
\- The MGCF shall indicate the remote IP address and UDP port, i.e. the
destination IP address and UDP port for data sent in the user plane towards
the IM CN subsystem,
\- The MGCF shall indicate the remote codec(s), i.e. the speech codec(s) for
data sent in the user plane towards the IM CN subsystem.
\- The MGCF may indicate the local codec(s) and the local IP address and UDP
port. The MGCF shall indicate the local codec(s) if a change is required.
\- The MGCF may indicate that IP interface type is for MboIP.
The IM-MGW shall reply with the selected remote codec(s) and reserve resources
for these codec(s). If local codec(s) were received, the IM-MGW shall also
reply with the selected local codec(s) and reserve the corresponding
resources.
###### 7.5.13.2.2.4 Called party alerting
If the MGCF supports early-session as a network option, upon receipt of a SIP
18x provisional response with an early-session SDP, the MGCF shall not request
the IM-MGW to provide an awaiting answer indication (ringing tone) to the
calling party.
###### 7.5.13.2.2.5 Message sequence chart
Figure 7.5.13.2.2.5-1 shows an example message sequence chart for an CS
network originating Session Setup with ISUP, where IMS CAT is provided by
early session model.
Figure 7.5.13.2.2.5-1: CS Network Originating Session with Early Session SDP,
ISUP (message sequence chart)
Figure 7.5.13.2.2.5-2 shows an example message sequence chart for an CS
network originating Session Setup with BICC, where IMS CAT is provided by
early session model.
Figure 7.5.13.2.2.5-2: CS Network Originating Session with Early Session SDP,
BICC (message sequence chart)
#### 7.5.13.3 Forking model
Interworking at O-MGCF follows the basic call interworking procedures using
the P-Early-Media header field and related procedures as described in clause
7.2.3.2.1, 7.2.3.2.2, 7.2.3.2.4, 7.2.3.2.5, 7.2.3.2.6, 7.2.3.2.7, 7.2.3.2.8,
and 7.2.3.2.9.
The O-MGCF shall apply the procedures in clause 9.2.3.4 and shall use the
P-Early-Media header field that authorizes early media as trigger to configure
the IM-MGW as described in Clause 9.2.3.4.2.
#### 7.5.13.4 Gateway model
Interworking at O-MGCF follow the basic call interworking procedures using the
P-Early-Media header field and related procedures as described in clause
7.2.3.2.1, 7.2.3.2.2, 7.2.3.2.4, 7.2.3.2.5, 7.2.3.2.6, 7.2.3.2.7, 7.2.3.2.8,
and 7.2.3.2.9.
Example callflows are shown in annex J
# 8 User plane interworking
## 8.1 Interworking between IM CN subsystem and bearer independent CS network
When the IM CN subsystem interworks with the bearer independent CS networks
(e.g. CS domain of a PLMN, 3GPP TS 29.414 [25], 3GPP TS 29.415 [26], 3GPP TS
23.205 [27]), then the Transport Network Layer (TNL) of the bearer independent
CS network can be based e.g. on IP/UDP/RTP, or IP/UDP/RTP/IuFP, or ATM/AAL2/
framing protocol (e.g. Iu framing) transport techniques. Figure 31 shows the
user plane protocol stacks for the IM CS subsystem and bearer independent CS
network interworking. If the same or TrFO-compatible codec configuration(s)
is/are used on the CS network side and on the IMS side, then transcoding is
not required. However, there is still a need to interwork between
RTP/UDP/IP/L2/L1 to TNL/L1.
Figure 31/1: IM CN subsystem to bearer independent CS network user plane
protocol stack
### 8.1.1 Transcoder-less Mb to Nb Interworking
Figure 31/2: IM CN subsystem to bearer independent CS network user plane
protocol stack (optional in the event the codecs on both sides are the same)
If no transcoder is inserted, the IM-MGW shall interwork the following
procedures between the Nb and Mb interfaces.
#### 8.1.1.1 Initialisation
There is no need to interwork initialisation procedures between Nb and Mb
interfaces see 3GPP TS 29.415 [26].
#### 8.1.1.2 Time alignment
The purpose of the time alignment procedure on the Nb interface is to minimise
the buffer delay in the RNC for downlink transmissions by adjusting the
vocoder time reference within the network. No such procedure exists on the Mb
interface, so the IM-MGW shall return NACK indication time alignment not
supported according to 3GPP TS 29.415 [26].
#### 8.1.1.3 Rate control
##### 8.1.1.3.1 General
The rate control procedure signals to the peer entity the maximum rate among
the currently allowed rates at which it can receive codec frames. Rate control
only applies to AMR, AMR-WB and EVS codec configurations with multiple active
modes. For the EVS codec, the rate control procedure also signals to the peer
entity the maximum mode among the currently allowed modes at which it can
receive codec frames.
##### 8.1.1.3.2 Rate control for AMR and AMR-WB codecs
For AMR and AMR-WB codecs:
\- On the Nb interface, IuFP provides for rate control via the exchange of
RATE CONTROL and RATE CONTROL ACK PDUs
\- On the Mb interface, IETF RFC 4867 [23] provides for in-band rate control
via the Codec Mode Request (CMR) field of every codec frame (Speech or SID)
and CMR-Only frames.
\- Interworking of rate control procedures at an IM-MGW between an Mb
interface and a corresponding Nb interface only applies when the IM-MGW
bridges compatible codec configurations between the interfaces without
applying a transcoding function.
\- An IM-MGW receiving a CMR from an Mb interface shall initiate the IuFP rate
control procedure on the corresponding Nb interface.
\- An IM-MGW receiving a rate control request on an Nb interface shall adjust
the CMR field of outgoing speech frames on the corresponding Mb interface.
##### 8.1.1.3.3 Rate and Mode control for the EVS codec
For the EVS codec:
\- On the Nb interface, CMR for EVS (EVS-CMR) as specified in 3GPP TS 26.453
[152] subclause 4.5 provides for in-band rate and mode control via the Codec
Mode Request (CMR) field of every codec frame (Speech or SID) and CMR-Only
frame.
\- On the Mb interface, EVS-CMR as specified in 3GPP TS 26.445 [147] subclause
A.2.2.1.1 provides for in-band rate and mode control via the Codec Mode
Request (CMR) field of the codec frame in RTP. Alternatively RTCP-APP packets
may be used with corresponding control commands as specified in 3GPP TS 26.114
[104]. The rate and mode control on the Mb interface depends on the SDP
offer/answer procedure. It may also be disabled, in which case transcoding is
mandatory.
\- Interworking of rate control procedures at an IM-MGW between an Mb
interface and a corresponding Nb interface only applies when the IM-MGW
bridges compatible codec configurations between the interfaces without
applying a transcoding function.
\- An IM-MGW receiving an EVS-CMR from an Nb interface may filter and modify
the EVS-CMR contents based on configured policies and shall perform one of the
following alternatives:
1)if CMR in RTP is required in every RTP packets on the Mb interface
(cmr=1),include the resulting contents into the EVS-CMR field of the
corresponding outgoing frame or CMR-Only frame on the Mb interface;
2)if CMR in RTP is enabled \"on demand\" on the Mb interface (cmr=0 or
omitted), include the resulting contents into the EVS-CMR field of the
outgoing codec frame or CMR-Only frame on the corresponding Mb interface only
if it is different from the previously sent EVS-CMR value, and send the new
EVS-CMR value at least 3 times within the next 100 ms to provide a minimum of
error robustness, if necessary using also additional CMR-Only frames in speech
pauses;
3)if CMR in RTP is disabled on the Mb interface (cmr=-1) and if RTCP-APP is
enabled on the Mb interface, translate the resulting contents into a
corresponding RTCP-APP command and send it at least 3 times within the next
100 ms to provide a minimum of error robustness, if the resulting RTCP-APP
command is different from the previously sent RTCP-APP command; or
4)if CMR in RTP is disabled on the Mb interface (cmr=-1) and if RTCP-APP is
disabled on the Mb interface, applying a transcoding function. In this case
the rate and mode control on the Nb interfaceis terminated in the IM-MGW.
\- An IM-MGW receiving an EVS-CMR on an Mb interface may filter and modify the
EVS-CMR contents based on configured policies and shall include the resulting
contents into the EVS-CMR field of the outgoing codec frame or CMR-Only frame
on the corresponding Nb interface.
\- The rules by which the IM-MGW may filter and modify the EVS-CMR contents
consist of the following:
1) The IM-MGW shall not modify the EVS-CMR to increase the maximum bit rate;
2) If the IM-MGW observes the incoming stream of speech frames or packets and
determines that a lower EVS mode is more appropriate, the IM-MGW may modify
the EVS-CMRs sent in the opposite direction of the observed speech flow;
3) If the IM-MGW modifies the EVS-CMR to decrease the maximum bit rate and the
resulting maximum bit rate no longer support the originally requested maximum
audio bandwidth, then the maximum audio bandwidth may be reduced by the IM-MGW
to the next lower one that fits to the reduced maximum bit rate;
4) The IM-MGW shall not modify the EVS-CMR in a way that results in a change
of the major operation mode (EVS primary mode or EVS AMR-WB IO mode);
NOTE: The IM-MGW can be forced to change the major operation mode of an
incoming EVS-CMR when interworking between EVS and AMR-WB, during handover or
after handover.
5) When channel-aware mode is used, if the IM-MGW observes the incoming stream
of speech frames or packets and determines that other channel-aware mode
parameters are more appropriate, the IM-MGW may modify the EVS-CMRs, flowing
in the opposite direction of the observed speech flow to change the received
channel-aware offset to a bigger one (e.g. from 2 to 3) and the received
channel-aware depth to a lower, more robust one;
6) When channel-aware mode is used, the IM-MGW shall not reduce the received
channel-aware offset or modify the received channel-aware depth a less robust
one;
7) The IM-MGW should not block the channel-aware mode;
8) The IM-MGW may modify the EVS primary mode in the received EVS-CMR to the
EVS Variable Bit Rate mode.
##### 8.1.1.3.4 Interworking of rate control between compatible AMR-WB and EVS
codec configurations
The EVS codec includes the EVS AMR-WB IO major operation mode and is therefore
TrFO-compatible to the AMR-WB codec, if the mode-set and mode-change-period
parameters are TrFO-compatible. For example, AMR-WB on one IM-MGW termination
and EVS on the other IM-MGW termination are TrFO-compatible codecs, if the
mode-set parameters are TrFO-compatible and mode-change-period=2 on both
sides.
If the IM-MGW bridges compatible EVS codec configurations and AMR-WB codec
configurations:
\- If the codec of the incoming termination is EVS and the codec of the
outgoing termination is AMR-WB, then the rate control procedure for AMR-WB
shall apply at the outgoing termination, with the maximum rate equal to or
lower than the maximum rate received in the EVS-CMR. The IM-MGW shall map
received EVS-CMRs to the selected mode-set of the outgoing AMR-WB termination.
\- If the codec of the incoming termination is AMR-WB and the codec of the
outgoing termination is EVS, then the rate control procedure for AMR-WB shall
apply on the incoming termination and shall determine the maximum rate
included in the EVS-CMR sent by the IM-MGW. The IM-MWG shall request the EVS
AMR-WB IO major operation mode in the outgoing EVS-CMR.
\- The IM-MGW may filter and modify the CMR contents according to the
following rules:
1) The IM-MGW shall not modify the EVS-CMR to increase the maximum bit rate;
2) If the IM-MGW observes the incoming stream of speech frames or packets and
determines that a lower EVS mode is more appropriate, the IM-MGW may modify
the EVS-CMRs sent in the opposite direction of the observed speech flow.
If the IM-MGW bridges EVS codec configurations and AMR-WB codec configurations
which are not compatible, the IM-MGW shall apply transcoding and shall handle
the independent rate and mode control procedures towards the incoming and the
outgoing networks.
##### 8.1.1.3.5 Interworking between rate control and RTCP-APP-CMR messages
for MTSI
An IM-MGW may support the MTSI service defined in 3GPP TS 24.173 [88] and may
then support codecs according to 3GPP TS 26.114 [104].
NOTE 1: Alternative codec specifications for the MTSI service are listed in
3GPP TS 24.173 [88].
If the IM-MGW supports the MTSI service with the codecs according to 3GPP TS
26.114 [104] the IM-MGW should support reception of RTCP-APP-CMR messages as
specified in the clause 10.2.1 of 3GPP TS 26.114 [104] which can be sent by a
MTSI client in the terminal. If the IM-MGW is in TrFO then RTCP-APP-CMR
messages should be translated to the appropriate rate control method on the CS
side (e.g. IuFP rate control or RTP based CMR) in the same way as for an RTP
based CMR, described in the preceding subclauses.
NOTE 2: When the IM-MGW is transcoding at the Mb interface then any RTCP-APP-
CMR requests received from the MTSI client in the terminal when the IM-MGW is
transcoding will result in a change to to DL codec mode towards the MTSI
client terminal.
#### 8.1.1.4 Frame quality indication
The Nb interface signals frame quality with the Frame Quality Classification
(FQC) field of each speech frame PDU. See 3GPP TS 26.102 [50] and 3GPP TS
29.415 [26] for details. The FQC may have possible values: 0=frame_good;
1=frame_bad; 2=frame_bad_due_to_radio; and 3=spare. The Mb interface signals
frame quality with the Q bit (frame quality indicator) field of each speech
frame, as defined in IETF RFC 4867 [23]. The Q bit may have values:
1=speech_good; and 0=speech_bad or sid_bad.
Tables 24a and 24b provide the mapping between Mb and Nb interfaces.
Table 24a: Mapping of Mb (Q bit) onto Nb (FQC)
* * *
Mb - Qbit Mb - FT Nb - FQC 1 X 0 0 X 1
* * *
Table 24b: Mapping Nb onto Mb
* * *
Nb - FQC Mb - Qbit Mb - FT 0 1 NC 1 0 NO_DATA 2 0 NC
* * *
#### 8.1.1.5 Framing
Even when the IM-MGW bridges compatible codec configurations between the Nb
and Mb interfaces, the IM-MGW shall perform translation between the frame
formats defined for the two interfaces, since all codec configurations have
different framing procedures for the two interfaces. The framing details for
Nb are defined in 3GPP TS 26.102 [50] and 3GPP TS 29.415 [26], although they
do not describe the framing for ITU-T codecs other than G.711. The framing
details for Mb are defined in IETF RFC 4867 [23], IETF RFC 3550 [51], IETF RFC
3551 [52] and IETF RFC 3555 [53].
#### 8.1.1.6 Transcoding
Transcoding at the IM-MGW is avoided when the IM-MGW bridges compatible codec
configurations between the Nb and Mb interfaces. Otherwise transcoding is
necessary, which eliminates the need to interwork other user plane procedures
between the interfaces.
#### 8.1.1.7 Discontinuous transmission
When the IM-MGW bridges compatible codec configurations between the Nb and Mb
interfaces, the DTX procedures are normally interworked transparently by
translating between the framing formats on the interfaces. All the ITU-T, AMR,
AMR-WB and EVS codecs have configurations that are compatible between the Mb
and Nb interfaces.
For the AMR, AMR-WB and EVS codecs, DTX is always enabled on the CS radio
Interface in the uplink direction and the transport channel for DTX in the
downlink is always provided.
If the IMS side requires interworking without DTX in its media-receive
direction, then the IM-MGW shall insert transcoding in this direction. The IMS
side may apply in its media-sending direction DTX or not, the CS side is
prepared for both alternatives without transcoding.
#### 8.1.1.8 Timing and sequence information
The IM-MGW shall always correct out-of-sequence delivery between Nb and Mb
interfaces, either by re-ordering frames, or by dropping frames that are out
of sequence.
When the IuFP frame numbers are based on time and if the IM-MGW bridges
compatible codec configurations between the Nb and Mb interfaces, it shall
either correct jitter before forwarding PDUs or interwork the RTP timestamp
(see RFC 3550 [51]) with the IuFP Frame Number (see 3GPP TS 29.415 [26]) so
that both the RTP timestamp and IuFP frame number similarly reflect the
nominal sampling instant of the user data in the packet.
NOTE: Correcting jitter may cause additional delay.
The RTP sequence number (see RFC 3550 [51]) is handled independently on Mb,
i.e. it is not interworked with the IuFP Frame Number (see 3GPP TS 29.415
[26]).
## 8.2 Interworking between IM CN subsystem and TDM-based CS network
It shall be possible for the IM CN subsystem to interwork with the TDM based
CS networks (e.g. PSTN, ISDN or CS domain of a PLMN). Figure 32 describes the
user plane protocol stack to provide the particular interworking.
Figure 32: IM CN subsystem to TDM-based CS network user plane protocol stack
## 8.3 Transcoding requirements
The IM CN subsystem supports the AMR codec as the native codec for basic voice
services. For IM CN subsystem terminations, the IM MGW shall support the
transport of AMR over RTP according to IETF RFC 4867 [23]. The MGCF shall
support the options of IETF RFC 4867 [23] listed within subclause 12.3.1 of
3GPP TS 26.114 [104].
It shall be possible for the IM CN subsystem to interwork with the CS networks
(e.g. PSTN, ISDN or a CS domain of a PLMN) by supporting AMR to G.711
transcoding (see ITU-T Recommendation G.711 [1]) in the IM-MGW. The IM-MGW may
also perform transcoding between AMR and other codec types supported by CS
networks.
## 8.4 Diffserv code point requirements
The IM-MGW shall perform DiffServ Code Point (DSCP) markings (see RFC 2474
[21]) on the IP packets sent towards the IM CN subsystem entity like UE or
MRFP across the Mb interface to allow DiffServ compliant routers and GGSNs to
schedule the traffic accordingly.
The IETF Differentiated Services architecture (see RFC 2475 [22]) shall be
used to provide QoS for the external bearer service.
The DSCP shall be operator configurable.
## 8.5 DTMF handling
When sending DTMF inband towards the CS network, the MGW shall comply with the
encoding requirements in 3GPP TS 23.014 [103]; in particular the requirements
for the minimum length of a tone and for the minimum gap between two
subsequent tones shall be ensured.
When detecting DTMF digits arriving from the CS side, the MGW shall comply
with 3GPP TS 23.014 [103] (by checking that a valid digit with minimum
duration and minimum gap has been received) before initiating an RTP Telephony
Event to the IMS interface.
When sending DTMF towards the IMS side according to the IETF RFC 4733 [105]
RTP Payload format, the MGW shall comply with the DTMF encoding requirements
of Annex G.2 of 3GPP TS 26.114 [104], in particular the minimum duration of
65ms shall be ensured. It is optional if the RTP Telephony Event is sent as a
number of \"RTP Events\" with interim durations (e.g. every 20ms or 40ms in
line with the speech packetisation time) or as a single \"RTP Event\" with the
at least 65ms duration.
# 9 MGCF - IM-MGW Interaction
## 9.1 Overview
The MGCF shall control the functions of the IM-MGW, which are used to provide
the connection between media streams of an IP based transport network and
bearer channels from a CS network.
The MGCF shall interact with the IM-MGW across the Mn reference point. The
MGCF shall terminate the signalling across the Mn interface towards the IM-MGW
and the IM-MGW shall terminate the signalling from the MGCF.
The signalling interface across the Mn reference point shall be defined in
accordance with ITU-T Recommendation H.248.1 [2] and shall conform to 3GPP
specific extensions as detailed in 3GPP TS 29.332 [15].
The present specification describes Mn signalling procedures and their
interaction with BICC/ISUP and SIP signalling in the control plane, and with
user plane procedures. 3GPP TS 29.332 [15] maps these signalling procedures to
H.248 messages and defines the required packages and parameters.
## 9.2 Mn signalling interactions
The following paragraphs describe the Mn interface procedures triggered by SIP
and BICC signalling relayed in MGCF.
The SIP signalling occurring at the MGCF is described in 3GPP TS 24.229 [9].
All message sequence charts in this clause are examples.
### 9.2.1 Network model
Figure 33 shows the network model, applicable to BICC and ISUP cases. The
broken line represents the call control signalling. The dotted line represents
the bearer control signalling (if applicable) and the user plane. The MGCF
uses one context with two terminations in the IM-MGW. The termination T1 is
used towards the IM CN subsystem entity and the bearer termination T2 is used
for the bearer towards the succeeding CS network element.
Figure 33: Network model
### 9.2.2 Basic IM CN subsystem originated session
#### 9.2.2.1 BICC forward bearer establishment
##### 9.2.2.1.1 IM-MGW selection
The MGCF shall select an IM-MGW for the bearer connection before it performs
the CS network side bearer establishment. This may happen either before
sending the IAM or after receiving the APM message (signal 5 or signal 6 in
figure 34). In the latter case, the IM-MGW selection may be based on a
possibly received MGW-id from the succeeding node.
##### 9.2.2.1.2 CS network side bearer establishment
The MGCF shall either select bearer characteristics or request the IM-MGW to
select and provide the bearer characteristics for the CS network side bearer
connection before sending the IAM. In the latter case the MGCF shall use the
Prepare Bearer procedure, not shown in figure 34, to request the IM-MGW to
select the bearer characteristics. After the succeeding node has provided a
bearer address and a binding reference in the APM, the MGCF shall use the
Establish Bearer procedure to request the IM-MGW to establish a bearer towards
the destination CS-MGW. The MGCF shall provide the IM-MGW with the bearer
address, the binding reference and the bearer characteristics (signal 7 in
figure 34).
##### 9.2.2.1.3 IM CN subsystem side termination reservation
On receipt of an initial INVITE (signal 1 in figure 34) the MGCF shall
initiate the Reserve IMS Connection Point and Configure Remote Resources
procedure (signal 3 and 4 in figure 34). From the received SDP and local
configuration data the MGCF:
\- Shall send the appropriate remote codec(s), the remote UDP port and the
remote IP address to the IM-MGW. The remote UDP port and IP address refer to
the destination of user plane data sent towards the IM CN subsystem. The
remote codec(s) are the codec(s) the IM-MGW may select for user plane data
sent towards the IM CN subsystem.
\- Shall indicate to the IM-MGW the appropriate local codec(s) and request a
local IP address and UDP port. The local IP address and UDP port are used by
the IM-MGW to receive user plane data from the IM CN subsystem. The local
codec(s) are the codec(s) the IM-MGW may select to receive user plane data
from the IM CN subsystem.
\- If DTMF support together with speech support is required, the reserve value
indicator shall be set to \"true\".
\- May indicate that IP interface type is for MboIP.
The IM-MGW
\- Shall reply to the MGCF with the selected local codec(s) and the selected
remote codec(s) and the selected local UDP port and IP address.
\- Shall reserve resources for those codec(s).
The MCGF shall send the local codec(s), UDP port and IP address to the IMS in
the Session Progress (signal 9 in figure 34).
##### 9.2.2.1.4 IM CN subsystem side session establishment
Dependent on what the MGCF receives in the PRACK message (signal 10 in figure
34), the MGCF may initiate the Configure IMS Resources procedure. If no SDP is
received, or if the received SDP does not contain relevant changes compared to
the previous SDP sent to the IMS in signal 9 in figure 34, the procedure is
not invoked. Otherwise the MGCF shall use the Configure IMS Resources
procedure to provide to the IM-MGW:
\- The appropriate remote codec(s), the remote UDP port and the remote IP
address.
\- Optionally the appropriate local codec(s), UDP port and IP address.
\- If DTMF support together with speech support is required, the reserve value
indicator shall be set to \"true\".
\- May indicate that IP interface type is for MboIP.
The IM-MGW shall:
\- Reply to the MGCF with the selected remote codec(s),
\- Reply to the MGCF with the selected local codec(s)if the MGCF supplied
local codec(s),
\- Update the codec reservation and remote IP address and remote UDP port in
accordance with the received information.
The MGCF shall include the selected codec(s) and UDP port and IP address in a
200 OK (PRACK) (signal 11 in figure 34) sent back to the IMS.
##### 9.2.2.1.5 Through-connection
During the Prepare Bearer and Establish Bearer procedures, the MGCF shall
either use the Change Through-Connection procedure to request the IM-MGW to
backward through-connect the BICC terminations, or the MGCF shall use this
procedure to both-way through-connect the BICC termination already on this
stage (signal 7 in figure 34). During the Reserve IMS Connection Point
procedure:
\- if the MGCF has been identified a call as an \"ICS call\" as specified in
clause 7.3.3.1.2.12 the MGCF shall request the IM MGW to suspend sending media
towards the IMS side by setting the through-connection of the IM CN subsystem
side termination to \"not through-connected\" using the Change IMS Through
Connection procedure (signal 3 in figure 34); and
\- otherwise the MGCF shall use the Change IMS Through-Connection procedure to
request the IM-MGW to backward through-connect the IMS termination (signal 3
in figure 34).
When the MGCF receives a BICC ACM or CPG message with an UID action indicators
parameter with the through-connection instruction indicator set to \"_through-
connect in both directions_ \" the MGCF shall request the IM-MGW to both-way
through-connect the terminations using the Change IMS Through-Connection or
Change Through-Connection procedures (signal 18 in figure 34), unless those
terminations are already both-way through-connected.
When the MGCF receives the BICC:ANM answer indication, it shall request the
IM-MGW to both-way through-connect the termination using the Change Through-
Connection or Change IMS Through-Connection procedures (signal 24 in figure
34), unless those terminations are already both-way through-connected.
##### 9.2.2.1.6 Codec handling
The IM-MGW may include a speech transcoder based upon the speech coding
information provided to each termination.
##### 9.2.2.1.7 Failure handling in MGCF
If any procedure between the MGCF and the IM-MGW is not completed successfully
the default action by the MGCF is to release the session, as described in
clause 9.2.6. If the MGCF receives a Bearer Released procedure from the IM-MGW
the default action by the MGCF is to release the session as described in
clause 9.2.7.
NOTE: As an implementation option the MGCF may also decide for example to only
release the resources in the IM-MGW that caused the failure, possibly select a
new IM-MGW for the connection and continue the call establishment using new
resources in the selected IM-MGW but such handling is outside of the scope of
the present document.
##### 9.2.2.1.8 Message sequence chart
Figure 34 shows the message sequence chart for the IM CN subsystem originating
session with BICC forward bearer establishment where the selection of IM-MGW
is done before the sending of the IAM. In the chart the MGCF requests the
seizure of an IM CN subsystem side termination. When the APM is received from
the succeeding node, the MGCF requests the seizure of a CS network side bearer
termination and the establishment of the bearer. When the MGCF receives an
answer indication, it requests the IM-MGW to both-way through-connect the
terminations. Dashed lines represent optional or conditional messages.
Figure 34: Basic IM CN Subsystem originating session, BICC forward bearer
establishment\ (message sequence chart)
#### 9.2.2.2 BICC backward bearer establishment
##### 9.2.2.2.1 IM-MGW selection
The MGCF shall select an IM-MGW for the bearer connection before it performs
the IM CN subsystem session establishment or the CS network side bearer
establishment, and before it sends the IAM (signal 8 in figure 35).
##### 9.2.2.2.2 IM CN subsystem side termination reservation
On receipt of an initial INVITE (signal 1in figure 35) the MGCF shall initiate
the Reserve IMS Connection Point and Configure Remote Resources procedure
(signal 3 and 4 in figure 35). From the received SDP and local configuration
data the MGCF:
\- Shall send the appropriate remote codec(s), the remote UDP port and the
remote IP address to the IM-MGW. The remote UDP port and IP address refer to
the destination of user plane data sent towards the IM CN subsystem. The
remote codec(s) are the codec(s) the IM-MGW may select for user plane data
sent towards the IM CN subsystem.
\- Shall indicate to the IM-MGW the appropriate local codec(s) and request a
local IP address and UDP port. The local UDP port and IP address are used by
the IM-MGW to receive user plane data from the IM CN subsystem. The local
codec(s) are the codec(s) the IM-MGW may select to receive user plane data
from the IM CN subsystem.
\- If DTMF support together with speech support is required, the reserve value
indicator shall be set to \"true\".
\- May indicate that IP interface type is for MboIP.
The IM-MGW shall
\- Reply to the MGCF with the selected local codec(s) and the selected remote
codec(s) and the selected local UDP port and IP address.
\- Reserve resources for those codec(s).
The MCGF shall send the local codec(s), UDP port and IP address to the IMS in
the Session Progress (signal 5 in figure 35).
##### 9.2.2.2.3 IM CN subsystem side session establishment
Dependent on what the MGCF receives in the PRACK message (signal 9 in figure
35) the MGCF may initiate the Select Configure IMS Resources procedure
(signals 10 and 11 in figure 35). If no SDP is received, or if the received
SDP does not contain relevant changes compared to the previous SDP the
procedure is not invoked. Otherwise the MGCF shall use the Configure IMS
Resources procedure to provide to the IM-MGW:
\- the appropriate remote codec(s), the remote UDP port and the remote IP
address.
\- optionally if DTMF support together with speech support is required, the
reserve value indicator shall be set to \"true\".
\- May indicate that IP interface type is for MboIP.
The IM-MGW shall:
\- Reply to the MGCF with the selected remote codec(s).
\- Reply to the MGCF with the selected local codec(s), if the MGCF supplied
local codec(s).
\- Update the codec reservation and remote IP address and remote UDP port in
accordance with the received information.
The MGCF shall include the selected codec(s), IP address and UDP port in an
200 OK (PRACK) (signal 12 in figure 35) sent back to the IMS
##### 9.2.2.2.4 CS network side bearer establishment
The MGCF shall request the IM-MGW to prepare for the CS network side bearer
establishment using the Prepare Bearer procedure before sending the IAM to the
succeeding node. Within this procedure, the MGCF shall request the IM-MGW to
provide a bearer address and a binding reference, and the MGCF shall either
provide the IM-MGW with the preferred bearer characteristics or it shall
request the IM-MGW to select and provide the bearer characteristics (signal 6
in figure 35). After the IM-MGW has replied with the bearer address, the
binding reference and the bearer characteristics (if requested), the MGCF
sends the IAM to the succeeding node (signal 8 in figure 35).
##### 9.2.2.2.5 Through-connection
During the Prepare Bearer procedure, the MGCF shall either use the Change
Through-Connection procedure to request the IM-MGW to backward through-connect
the BICC termination, or the MGCF shall use this procedure to both-way
through-connect the BICC termination already on this stage (signal 6 in figure
35). During the Reserve IMS Connection Point procedure:
\- if the MGCF has been identified a call as an \"ICS call\" as specified in
clause 7.3.3.1.2.12 the MGCF shall request the IM‑MGW to suspend sending media
towards the IMS side by setting the through-connection of the IM CN subsystem
side termination to \"not through-connected\" using the Change IMS
Through‑Connection procedure (signal 3 in figure 35); and
\- otherwise the MGCF shall use the Change IMS Through-Connection procedure to
request the IM-MGW to backward through-connect the IMS termination (signal 3
in figure 35).
When the MGCF receives an BICC ACM or CPG message with an UID action
indicators parameter with the through-connection instruction indicator set to
\"_through-connect in both directions_ \" the MGCF shall request the IM-MGW to
both-way through-connect the terminations using the Change IMS Through-
Connection or Change Through-Connection procedures (signal 17 in figure 35),
unless those terminations are already both-way through-connected.
When the MGCF receives the BICC:ANM answer indication, it shall request the
IM-MGW to both-way through-connect the terminations using the Change Through-
Connection or Change IMS Through-Connection procedures (signal 23 in figure
35), unless those terminations are already both-way through-connected.
##### 9.2.2.2.6 Codec handling
The IM-MGW may include a speech transcoder based upon the speech coding
information provided to each termination.
##### 9.2.2.2.7 Failure handling in MGCF
If any procedure between the MGCF and the IM-MGW is not completed successfully
the default action by the MGCF is to release the session as described in
clause 9.2.6. If the MGCF receives a Bearer Released procedure from the IM-MGW
the default action by the MGCF is to release the session, as described in
clause 9.2.7.
NOTE: As an implementation option the MGCF may also decide for example to only
release the resources in the IM-MGW that caused the failure, possibly select a
new IM-MGW for the connection and continue the call establishment using new
resources in the selected IM-MGW but such handling is outside of the scope of
the present document.
##### 9.2.2.2.8 Message sequence chart
Figure 35 shows the message sequence chart for the IM CN subsystem originating
session with BICC backward bearer establishment. In the chart the MGCF
requests the seizure of an IM CN subsystem side termination and a CS network
side bearer termination. When the MGCF receives an answer indication, it
requests the IM-MGW to both-way through-connect the terminations. Dashed lines
represent optional or conditional messages.
Figure 35: Basic IM CN Subsystem originating session, BICC backward bearer
establishment (message sequence chart)
#### 9.2.2.3 ISUP
##### 9.2.2.3.1 IM-MGW selection
The MGCF shall select an IM-MGW with circuits to the given destination in the
CS domain before it performs the IM CN subsystem session establishment and
before it sends the IAM (signal 8 in figure 36).
##### 9.2.2.3.2 IM CN subsystem side termination reservation
On receipt of an initial INVITE (signal 1 in figure 36) the MGCF shall
initiate the Reserve IMS Connection Point and Configure Remote Resources
procedure (signal 3 and 4 in figure 36). From the received SDP and local
configuration data the MGCF:
\- shall send the appropriate remote codec(s), the remote UDP port and the
remote IP address to the IM-MGW. The remote UDP port and IP address refer to
the destination of user plane data sent towards the IM CN subsystem. The
remote codec(s) are the codec(s) the IM-MGW may select for user plane data
sent towards the IM CN subsystem.
\- shall indicate to the IM-MGW the appropriate local codec(s) and request a
local IP address and UDP port. The local IP address and UDP port are used by
the IM-MGW to receive user plane data from the IM CN subsystem. The local
codec(s) are the codec(s) the IM-MGW may select to receive user plane data
from the IM CN subsystem.
\- If DTMF support together with speech support is required, the reserve value
indicator shall be set to \"true\".
\- May indicate that IP interface type is for MboIP.
The IM-MGW shall
\- reply to the MGCF with the selected local codec(s) and the selected remote
codec(s) and the selected local UDP port and IP address.
\- reserve resources for those codec(s).
The MCGF shall send selected local codec(s) and the selected remote codec and
the selected local UDP port and IP address to the IMS in the Session Progress
(signal 5 in figure 36)
##### 9.2.2.3.3 IM CN subsystem side session establishment
Dependent on what the MGCF receives in the PRACK message (signal 9 in figure
35) the MGCF may initiate the Configure IMS Resources procedure. If no SDP is
received, or if the received SDP does not contain relevant changes compared to
the previous SDP, the procedure is not invoked. Otherwise the MGCF shall use
the Configure IMS Resources procedure to provide to the IM-MGW:
\- the appropriate remote codec(s), the remote UDP port and the remote IP
address.
\- optionally the appropriate local codec(s), UDP port and IP address.
\- If DTMF support together with speech support is required, the reserve value
indicator shall be set to \"true\".
\- May indicate that IP interface type is for MboIP.
The IM-MGW shall:
\- reply to the MGCF with the selected remote codec.
\- reply to the MGCF with the selected local codec(s), if the MGCF supplied
local codec(s).
\- update the codec reservation and remote IP address and UDP port in
accordance with the received information.
The MGCF shall include the selected codec(s) UDP port and IP address in 200 OK
(PRACK) (signal 12 in figure 36) sent back to the IMS.
##### 9.2.2.3.4 CS network side circuit reservation
The MGCF shall request the IM-MGW to reserve a circuit using the Reserve TDM
Circuit procedure. The MGCF sends the IAM to the succeeding node including the
reserved circuit identity.
##### 9.2.2.3.5 Through-connection
During the Reserve TDM Circuit and Reserve IMS Connection Point procedures,
the MGCF shall either use the Change TDM Through-Connection procedure to
request the IM-MGW to backward through-connect the termination, or the MGCF
shall use this procedure to both-way through-connect the TDM termination
already on this stage (signal 6 in figure 36). During the Reserve IMS
connection Point procedure:
\- if the MGCF has been identified a call as an \"ICS call\" as specified in
clause 7.2.3.1.12 the MGCF shall request the IM‑MGW to suspend sending media
towards the IMS side by setting the through-connection of the IM CN subsystem
side termination to \"not through-connected\" using the Change IMS
Through‑Connection procedure (signal 3 in figure 36); and
\- otherwise the MGCF shall use the Change IMS through-connection procedure to
request the IM-MGW to backward through-connect the IMS termination (signal 3
in figure 36).
When the MGCF receives an ISUP ACM or CPG message with an UID action
indicators parameter with the through-connection instruction indicator set to
\"_through-connect in both directions_ \" the MGCF shall request the IM-MGW to
both-way through-connect the terminations using the Change IMS Through-
Connection or Change TDM Through-Connection procedures (signal 17 in figure
36), unless those terminations are already both-way through-connected.
When the MGCF receives the ISUP:ANM answer indication, it shall request the
IM-MGW to both-way through-connect the terminations using the Change IMS
Through-Connection or Change TDM Through-Connection procedures (signal 23 in
figure 36), unless those terminations are already both-way through-connected.
##### 9.2.2.3.6 Continuity check
The MGCF may request a continuity check on the connection towards the CS
network within the IAM message. In this case, the MGCF shall use the
Continuity Check procedure towards the IM-MGW to request the generation of a
continuity check tone on the TDM termination. The IM-MGW shall then use the
Continuity Check Verify procedure to notify the MGCF of an incoming continuity
check tone on the corresponding circuit. In addition to other conditions
detailed in Clause 7, the MGCF shall wait until receiving this notification
before sending the COT. (Not depicted in figure 36)
##### 9.2.2.3.7 Codec handling
The IM-MGW may include a speech transcoder based upon the speech coding
information provided to each termination.
##### 9.2.2.3.8 Voice processing function
A voice processing function located on the IM-MGW may be used to achieve
desired acoustic quality on the terminations. If the voice processing function
is used, the MGCF shall request the activation of it in the termination
towards the CS network using the Activate TDM Voice Processing Function
procedure (signal 23 in figure 36).
##### 9.2.2.3.9 Failure handling in MGCF
If any procedure between the MGCF and the IM-MGW is not completed successfully
session shall be released as described in clause 9.2.6. If the MGCF receives a
Bearer Released procedure from the IM-MGW the default action by the MGCF is to
release the session as described in clause 9.2.7.
##### 9.2.2.3.10 Message sequence chart
Figure 36 shows the message sequence chart for the IM CN subsystem originating
session. In the chart the MGCF requests the seizure of an IM CN subsystem side
termination and a CS network side bearer termination. When the MGCF receives
an answer indication, it requests the IM-MGW to both-way through-connect the
terminations. The MGCF requests the possible activation of the voice
processing functions for the bearer terminations. Dashed lines represent
optional or conditional messages.
Figure 36: Basic IM CN Subsystem originating session, ISUP (message sequence
chart)
### 9.2.3 Basic CS network originated session
#### 9.2.3.1 BICC forward bearer establishment
##### 9.2.3.1.1 IM-MGW selection
The MGCF shall select an IM-MGW for the bearer connection before it performs
the IM CN subsystem session establishment or the CS network side bearer
establishment.
##### 9.2.3.1.2 IM CN subsystem side termination reservation
The MGCF shall derive from configuration data one or several appropriate local
codec(s) the IM-MGW may use to receive user plane data from the IM CN
subsystem. The MGCF shall use the Reserve IMS Connection Point procedure
(signals 2 and 3 in figure 37). Within this procedure, the MGCF shall indicate
the local codec(s) and request a local IP address and UDP port from the IM-
MGW. The local IP address and UDP port are used by the IM-MGW to receive user
plane data from the IM CN subsystem. If DTMF support together with speech
support is required, or if the resources for multiple speech codecs shall be
reserved at this stage, the reserve value indicator shall be set to \"true\".
The MGCF may also indicate that the IP interface type is for MboIP.
The IM-MGW shall reply to the MGCF with the selected local codec(s) and the
selected local IP address and UDP port.
The MGCF shall send this information in the INVITE (signal 4 in figure 37) to
the IM CN subsystem.
##### 9.2.3.1.3 IM CN subsystem side session establishment
The MGCF shall use the Configure IMS Resources procedure (signals 7 and 8 or
23a and 23b in figure 37) to provide configuration data (derived from SDP
received in signal 6 in figure 37 and local configuration data) to the IM-MGW
as detailed below:
\- The MGCF shall indicate the remote IP address and UDP port, i.e. the
destination IP address and UDP port for data sent in the user plane towards
the IM CN subsystem,
\- The MGCF shall indicate the remote codec(s), i.e. the speech codec(s) for
data sent in the user plane towards the IM CN subsystem.
\- The MGCF may indicate the local codec(s) and the local IP address and UDP
port. The MGCF shall indicate the local codec(s) if a change is required.
\- IF DTMF support together with speech support is required, the reserve value
indicator shall be set to \"true\".
\- The MGCF may indicate that IP interface type is for MboIP.
The IM-MGW shall reply with the selected remote codec(s) and reserve resources
for these codec(s). If local codec(s) were received, the IM-MGW shall also
reply with the selected local codec(s) and reserve the corresponding
resources.
If the selected local codec(s) differ from the codec(s) received in the SDP of
signal 6 in figure 37 (if any), the MGCF shall send the local reserved
codec(s), and the local IP address and UDP port in the PRACK (signal 9 in
figure 37) to the IMS.
If the selected local codec(s) differ from the codec(s) received in the SDP of
signal 23 in figure 37 (if any), the MGCF shall send the local reserved
codec(s), and the local IP address and UDP port in an re-INVITE or UPDATE (not
depicted in figure 37) to the IMS.
##### 9.2.3.1.4 CS network side bearer establishment
The MGCF shall request the IM-MGW to prepare for the CS network side bearer
establishment using the Prepare Bearer procedure (signals 11 and 12 in figure
37). Within this procedure, the MGCF shall request the IM-MGW to provide a
bearer address, a binding reference and optionally notify when the bearer is
established. The MGCF shall also provide the IM-MGW with the bearer
characteristics that was received from the preceding node in the IAM. After
the IM-MGW has replied with the bearer address and the binding reference, the
MGCF provides the APM message (signals 13 in figure 37) to the preceding node.
The MGCF may also provide the IM-MGW-id in the APM message.
##### 9.2.3.1.5 Called party alerting
The MGCF shall request the IM-MGW to provide an awaiting answer indication
(ringing tone) to the calling party using the Send Tone procedure (signals 20
and 21 in figure 37) , when the following condition is satisfied:
\- the MGCF receives the first 180 Ringing message, unless this message or
some previous SIP provisional response contained a P-Early-Media header field
that authorizes early media.
##### 9.2.3.1.6 Called party answer
When the MGCF receives a 200 OK message (signal 23 in figure 34), it shall
request the IM-MGW to stop providing the ringing tone to the calling party
using the Stop Tone procedure (signals 26 and 27 in figure 37).
##### 9.2.3.1.7 Through-Connection
During the Prepare Bearer procedure, the MGCF shall either use the Change
Through-Connection procedure to request the IM-MGW to backward through-connect
the BICC termination, or the MGCF shall use this procedure to both-way
through-connect the BICC termination already on this stage (signals 11 and 12
in figure 37). During the Reserve IMS Connection Point procedure, the MGCF
shall use the Change IMS Through-Connection procedure to request the IM-MGW to
backward through-connect the IMS termination (signals 2 and 3 in figure 37).
When the MGCF receives the SIP 200 OK(INVITE) (signal 23 in figure 37), it
requests the IM-MGW to both-way through-connect the terminations using the
Change IMS Through-Connection or Change Through-Connection procedures (signals
28 and 29 in figure 37), unless those terminations are already both-way
through-connected.
##### 9.2.3.1.8 Codec handling
The IM-MGW may include a speech transcoder based upon the speech coding
information provided to each termination.
##### 9.2.3.1.9 Failure handling in MGCF
If any procedure between the MGCF and the IM-MGW is not completed
successfully, the default action by the MGCF is to release the session as
described in clause 9.2.6. If the MGCF receives a Bearer Released procedure
from the IM-MGW the default action by the MGCF is to release the session, as
described in clause 9.2.7.
NOTE: As an implementation option the MGCF may also decide for example to only
release the resources in the IM-MGW that caused the failure, possibly select a
new IM-MGW for the connection and continue the call establishment using new
resources in the selected IM-MGW but such handling is outside of the scope of
the present document.
##### 9.2.3.1.10 Message sequence chart
Figure 37 shows the message sequence chart for the CS network originating
session with BICC forward bearer establishment. In the chart the MGCF requests
the seizure of the IM CN subsystem side termination and CS network side bearer
termination. When the MGCF receives an answer indication, it requests the IM-
MGW to both-way through-connect the terminations. Dashed lines represent
optional or conditional messages.
Figure 37/1: Basic CS Network Originating Session, Forward Bearer
Establishment (message sequence chart)
Figure 37/2: Basic CS Network Originating Session, Forward Bearer
Establishment\ (message sequence chart continue)
#### 9.2.3.2 BICC Backward bearer establishment
##### 9.2.3.2.1 IM-MGW selection
The MGCF shall select an IM-MGW for the bearer connection before it performs
the IM CN subsystem session establishment or the CS network side bearer
establishment.
##### 9.2.3.2.2 CS network side bearer establishment
The MGCF shall request the IM-MGW to establish a bearer using the Establish
Bearer procedure (signals 2 and 3 in figure 38). The MGCF provides the IM-MGW
with the bearer address, the binding reference and the bearer characteristics
that were received from the preceding node in the IAM (signal 1 in figure 38).
##### 9.2.3.2.3 IM CN subsystem side termination reservation
The MGCF shall derive from configuration data one or several appropriate local
codec(s) the IM-MGW may use to receive user plane data from the IM CN
subsystem. The MGCF shall use the Reserve IMS Connection Point procedure
(signals 2 and 3 in figure 38). Within this procedure, the MGCF shall indicate
the local codec(s) and request a local IP address and UDP port from the IM-
MGW. The local IP address and UDP port are used by the IM-MGW to receive user
plane data from the IM CN subsystem. If DTMF support together with speech
support is required, or if the resources for multiple speech codecs shall be
reserved at this stage, the reserve value indicator shall be set to \"true\".
The MGCF may also indicate that the IP interface type is for MboIP.
The IM-MGW shall reply to the MGCF with the selected local codec(s) and the
selected local IP address and UDP port.
The MGCF shall send this information in the INVITE (signal 6 in figure 38) to
the IM CN subsystem.
##### 9.2.3.2.4 IM CN subsystem side session establishment
The MGCF shall use the Configure IMS Resources procedure (signals 9 and 10 or
22a and 22b in figure 38) to provide configuration data (derived from SDP
received in signal 8 in figure 38 and local configuration data) to the IM-MGW
as detailed below:
\- The MGCF shall indicate the remote IP address and UDP port, i.e. the
destination IP address and UDP port for data sent in the user plane towards
the IM CN subsystem
\- The MGCF shall indicate the remote codec(s), i.e. the speech codec(s) for
data sent in the user plane towards the IM CN subsystem.
\- The MGCF may indicate the local codec(s) and the local IP address and UDP
port. The MGCF shall indicate the local codec(s) if a change is required.
\- If DTMF support together with speech support is required, the reserve value
indicator shall be set to \"true\".
\- The MGCF may indicate that IP interface type is for MboIP.
The IM-MGW shall reply with the selected remote codec(s) and reserve resources
for this codec. If local codec(s) were received, the IM-MGW shall also reply
with the selected local codec(s) and reserve the corresponding resources.
If the selected local codec(s) differ from the codec(s) received in the SDP of
signal 8 in figure 38 (if any), the MGCF shall send the reserved speech
codec(s), and the local IP address and UDP port in the PRACK (signal 11 in
figure 38) to the IMS.
If the selected local codec(s) differ from the codec(s) received in the SDP of
signal 22 in figure 38 (if any), the MGCF shall send the local reserved
codec(s), and the local IP address and UDP port in an re-INVITE or UPDATE (not
depicted in figure 38) to the IMS.
##### 9.2.3.2.5 Called party alerting
The MGCF shall request the IM-MGW to provide an awaiting answer indication
(ringing tone) to the calling party using the Send Tone procedure (signals 19
and 20 in figure 38) , when the following conditions is satisfied:
\- the MGCF receives the first 180 Ringing message, unless this message or
some previous SIP provisional response contained a P-Early-Media header field
that authorizes early media.
##### 9.2.3.2.6 Called party answer
When the MGCF receives a 200 OK message (signal 22 in figure 38), it shall
request the IM-MGW to stop providing the ringing tone to the calling party
using the Stop Tone procedure (signals 23 and 24 in figure 38).
##### 9.2.3.2.7 Through-Connection
During the Establish Bearer procedure, the MGCF shall either use the Change
Through-Connection procedure to request the IM-MGW to backward through-connect
the BICC termination, or the MGCF shall use this procedure to both-way
through-connect the BICC termination already on this stage (signals 2 and 3 in
figure 38). During the Reserve IMS Connection Point procedure, the MGCF shall
use the Change IMS Through-Connection procedure to request the IM-MGW to
backward through-connect the IMS termination (signals 4 and 5 in figure 38).
When the MGCF receives the SIP 200 OK(INVITE) (signal 22 in figure 38), it
shall request the IM-MGW to both-way through-connect the bearer using the
Change IMS Through-Connection or Change Through-Connection procedure (signals
25 and 26 in figure 38), unless those terminations are already both-way
through-connected.
##### 9.2.3.2.8 Codec handling
The IM-MGW may include a speech transcoder based upon the speech coding
information provided to each termination.
##### 9.2.3.2.9 Failure handling in MGCF
If any procedure between the MGCF and the IM-MGW is not completed
successfully, the default action by the MGCF is to release the session as
described in clause 9.2.6. If the MGCF receives a Bearer Released procedure
from the IM-MGW the default action by the MGCF is to release the session as
described in clause 9.2.7.
NOTE: As an implementation option the MGCF may also decide for example to only
release the resources in the IM-MGW that caused the failure, possibly select a
new IM-MGW for the connection and continue the call establishment using new
resources in the selected IM-MGW but such handling is outside of the scope of
the present document.
##### 9.2.3.2.10 Message sequence chart
Figure 38 shows the message sequence chart for the CS network originating
session with BICC backward bearer establishment. In the chart the MGCF
requests seizure of the IM CN subsystem side termination and CS network side
bearer termination. When the MGCF receives an answer indication, it requests
the IM-MGW to both-way through-connect the terminations. Dashed lines
represent optional or conditional messages.
Figure 38/1: Basic CS Network Originating Session, BICC Backward Bearer
Establishment (message sequence chart)
Figure 38/2: Basic CS Network Originating Session, BICC Backward Bearer
Establishment\ (message sequence chart continue)
#### 9.2.3.3 ISUP
##### 9.2.3.3.1 IM-MGW selection
The MGCF selects the IM-MGW based on the received circuit identity in the IAM.
##### 9.2.3.3.2 CS network side circuit reservation
The MGCF shall request the IM-MGW to reserve a circuit using the Reserve TDM
Circuit procedure.
##### 9.2.3.3.3 IM CN subsystem side termination reservation
The MGCF shall derive from configuration data one or several appropriate local
codec(s) the IM-MGW may use to receive user plane data from the IM CN
subsystem. The MGCF shall use the Reserve IMS Connection Point procedure
(signals 2 and 3 in figure 39). Within this procedure, the MGCF shall indicate
the local codec(s) and request a local IP address and UDP port from the IM-
MGW. The local IP address and UDP port are used by the IM-MGW to receive user
plane data from the IM CN subsystem. If DTMF support together with speech
support is required, or if the resources for multiple speech codecs shall be
reserved at this stage, the reserve value indicator shall be set to \"true\".
The MGCF may also indicate that the IP interface type is for MboIP.
The IM-MGW shall reply to the MGCF with the selected local codec(s) and the
selected local IP address and UDP port.
The MGCF shall send this information in the INVITE (signal 6 in figure 39) to
the IM CN subsystem.
##### 9.2.3.3.4 IM CN subsystem side session establishment
The MGCF shall use the Configure IMS Resources procedure (signals 9 and 10 or
22a and 22b in figure 39) to provide configuration data (derived from SDP
received in signal 8 in figure 39 and local configuration data) as detailed
below:
\- The MGCF shall indicate the remote IP address and UDP port, i.e. the
destination IP address and UDP port for data sent in the user plane towards
the IM CN subsystem.
\- The MGCF shall indicate the remote codec(s), i.e. the speech codec(s) for
data sent in the user plane towards the IM CN subsystem.
\- The MGCF may indicate the local codec(s) and the local IP address and UDP
port. The MGCF shall indicate the local codec(s) if a change is required.
\- If DTMF support together with speech support is required, the reserve value
indicator shall be set to \"true\".
\- The MGCF may indicate that IP interface type is for MboIP.
The IM-MGW shall reply with the selected remote codec(s) and reserve resources
for these codec(s). If local codec(s) were received, the IM-MGW shall also
reply with the selected local codec(s) and reserve the corresponding
resources.
If the selected local codec(s) differ from the codec(s) received in the SDP of
signal 8 in figure 39 (if any), the MGCF shall send the reserved speech
codec(s), and the local IP address and UDP port in the PRACK (signal 11 in
figure 39) to the IMS.
If the selected local codec(s) differ from the codec(s) received in the SDP of
signal 22 in figure 39 (if any), the MGCF shall send the local reserved
codec(s), and the local IP address and UDP port in an re-INVITE or UPDATE (not
depicted in figure 39) to the IMS.
##### 9.2.3.3.5 Called party alerting
The MGCF shall request the IM-MGW to provide an awaiting answer indication
(ringing tone) to the calling party using the Send TDM Tone procedure (signals
19 and 20in figure 39), when the following condition is satisfied:
\- the MGCF receives the first 180 Ringing message, unless this message or
some previous SIP provisional response contained a P-Early-Media header field
that authorizes early media.
##### 9.2.3.3.6 Called party answer
When the MGCF receives a 200 OK message (signal 22 in figure 39), it shall
request the IM-MGW to stop providing the ringing tone to the calling party
using the Stop TDM Tone procedure (signals 23 and 24 in figure 39).
##### 9.2.3.3.7 Through-Connection
Within the Reserve TDM Circuit procedure, the MGCF shall either use the Change
TDM Through-Connection procedure to request the IM-MGW to backward through-
connect the TDM termination, or the MGCF shall use this procedure to both-way
through-connect the TDM termination already on this stage (signals 2 and 3 in
figure 39). During the Reserve IMS Connection Point procedure, the MGCF shall
use the Change IMS Through-Connection procedure to request the IM-MGW to
backward through-connect the IMS termination (signals 4 and 5 in figure 39).
When the MGCF receives the SIP 200 OK(INVITE) message, it shall request the
IM-MGW to both-way through-connect the terminations using the Change IMS
Through-Connection or Change TDM Through-Connection procedure (signals 25 and
26 in figure 39), unless those terminations are already both-way through-
connected.
##### 9.2.3.3.8 Continuity Check
If a continuity check on the connection towards the CS network is requested in
the IAM message, the MGCF shall use the Continuity Check Response procedure
towards the IM-MGW to request loop-back of a received continuity check tone on
the TDM circuit. Upon reception of the COT message, the MGCF shall use the
Continuity Check Response procedure towards the IM-MGW to request the removal
of the loop-back. (Not depicted in figure 39)
##### 9.2.3.3.9 Codec handling
The IM-MGW may include a speech transcoder based upon the speech coding
information provided to each termination.
##### 9.2.3.3.10 Voice Processing function
A voice processing function located on the IM-MGW may be used to achieve
desired acoustic quality on the terminations. If the voice processing function
is used, the MGCF shall request the activation of it in the termination
towards the CS network using the Activate TDM Voice Processing Function
procedure (signal 23 in figure 39).
##### 9.2.3.3.11 Failure handling in MGCF
If any procedure between the MGCF and the IM-MGW is not completed
successfully, the session shall be released as described in clause 9.2.6. If
the MGCF receives a Bearer Released procedure from the IM-MGW the default
action by the MGCF is to release the session as described in clause 9.2.7.
##### 9.2.3.3.12 Message sequence chart
Figure 39 shows the message sequence chart for the CS network originating
Session with ISUP. In the chart the MGCF requests seizure of the IM CN
subsystem side termination and CS network side bearer termination. When the
MGCF receives an answer indication, it requests the IM-MGW to both-way
through-connect the terminations. The MGCF may request the possible activation
of the voice processing functions for the terminations. Dashed lines represent
optional or conditional messages.
Figure 39/1: Basic CS Network Originating Session, ISUP (message sequence
chart)
Figure 39/2: Basic CS Network Originating Session, ISUP (message sequence
chart continue)
#### 9.2.3.4 Handling of Forking
The procedures described in clauses 9.2.3.1 to 9.2.3.3 shall be applied with
the following additions.
##### 9.2.3.4.1 Detection of Forking
According to SIP procedures, the O-MGCF inspects the tags in the \"to\" SIP
header fields of provisional and final responses to identify the SIP dialogue
the response belongs to. If responses belonging to different dialogues are
received (signals 8 and 13 in figure 39a), the INVITE request (signal 6 in
figure 39a) has been forked.
##### 9.2.3.4.2 IM CN subsystem side session establishment
If one or more SIP early dialog exists and:
a) if the O-MGCF has not already received a P-Early-Media header field that
authorizes backward early media (the received em-param(s) in the P-Early-Media
header field includes \"sendrecv\" or \"sendonly\") on any of existing SIP
early dialog, then upon reception of a provisional 18x response with an SDP
answer creating a new early dialog (signal 13 in figure 39a/1) and:
1) with the P-Early-Media header field that authorizes backward early media
(the received em-param(s) in the P-Early-Media header field includes
\"sendrecv\" or \"sendonly\"), the O-MGCF shall use the Configure IMS
Resources procedure (signals 14 and 15 in figure 39a/1) and shall provide to
the IM-MGW:
\- the remote IP address and UDP port, and the remote codec selected from the
received SDP answer.
The IM-MGW may be configured to use the remote IP address and port information
as source filter for incoming packets to prevent that backward early media
from other early SIP dialogs interfere. The O-MGCF may also provide an IP
address and port source filter that disallows backward early media from other
early dialogs without an early media authorization in order to prevent that
such unauthorized backward early media interfere with the authorized backward
early media. (NOTE 1); and
\- local configuration data, corresponding to the SIP early dialog of the SIP
provisional response containing a P-Early-Media header field that authorizes
backward early media; or
2) without the P-Early-Media header field or with the P-Early-Media header
field that does not authorize backward early media (the received em-param(s)
in the P-Early-Media header field includes \"inactive\" or \"recvonly\"), the
O-MGCF may either:
\- refrain from reconfiguring the IM-MGW; or
\- use the Configure IMS Resources procedure (signals 14 and 15 in figure
39a/1) as detailed below:
i) the O-MGCF may compare the selected local codecs of the different dialogs
(which the O-MGCF selects due to the received SDP answer and local
configuration data). If different local codecs are selected for the different
dialogs, the O-MGCF may include all these codecs in the \"local IMS
resources\", and set the \"reserve value\" to indicate that resources for all
these codecs shall be reserved. Alternatively, the O-MGCF may only include the
codecs received in the last received SDP in the \"local IMS resources\"; and
ii) the O-MGCF may update the \"remote IMS resources\" with the information
received in the latest SDP answer. The MGCF should provide the remote IP
address and UDP port, and the remote codec selected from the received SDP
answer and local configuration data. (NOTE 2); or
b) if the O-MGCF has already received a P-Early-Media header field that
authorizes backward early media (the received em-param(s) in the P-Early-Media
header field includes \"sendrecv\" or \"sendonly\") on any of existing early
dialog, then upon reception of a provisional 18x response with an SDP answer
creating a new early dialog (signal 13 in figure 39a/1) and:
1) with the P-Early-Media header field that authorizes backward early media
(the received em-param(s) in the P-Early-Media header field includes
\"sendrecv\" or \"sendonly\"), the O-MGCF may either:
\- refrain from reconfiguring the IM-MGW; or
\- use the Configure IMS Resources procedure (signals 14 and 15 in figure
39a/1) to provide to the IM-MGW the remote IP address and UDP port, and the
remote codec selected from the received SDP answer and local configuration
data, corresponding to the SIP early dialog of the SIP provisional response
containing the P-Early-Media header field that authorizes backward early
media. The IM-MGW may be configured to use the remote IP address and port
information as source filter for incoming packets to prevent that backward
early media from another early SIP dialog interfere. The O-MGCF may also
provide an IP address and port source filter that disallows backward early
media from other early dialogs without an early media authorization in order
to prevent that such unauthorized backward early media interfere with the
authorized backward early media. (NOTE 1, NOTE 2); or
2) without the P-Early-Media header field or with the P-Early-Media header
field that does not authorize backward early media (the received em-param(s)
in the P-Early-Media header field includes \"inactive\" or \"recvonly\"), the
O-MGCF shall store the received SDP answer and shall refrain from
reconfiguring the IM-MGW.
NOTE 1: The O-MGCF can use the P-Early-Media header field (IETF RFC 5009 [89])
to determine whether the media associated with a forked dialog is authorized
and thus eligible for a through connection. In the presence of backward early
media for multiple dialogs due to forking, if the IM-MGW is able to identify
the media associated with a dialog (i.e., if symmetric RTP is used by the peer
and the IM-MGW can use the remote SDP information to determine the source of
the media), then the O-MGCF/IM-MGW can selectively establish a through-
connection for an authorized backward early media flow.
NOTE 2: This behaviour is beneficial if forking is applied in a sequential
manner.
If the O-MGCF has not already received a P-Early-Media header field that
authorizes backward early media (the received em-param(s) in the P-Early-Media
header field includes \"sendrecv\" or \"sendonly\") on any of existing SIP
early dialog, then:
a) upon reception of a SIP message with the P-Early-Media header field that
authorizes backward early media (the received em-param(s) in the P-Early-Media
header field includes \"sendrecv\" or \"sendonly\") on existing early dialog;
and
NOTE 3: For the existing early dialog the P-Early-Media header field can be
received within the UPDATE requests, 2xx responses to the PRACK and the UPDATE
requests, and in the subsequent 18x provisional responses (as specified in
IETF RFC 5009 [89]). Subsequent 18x provisional response is every 18x
provisional response except the first 18x provisional response, received
within the one early dialog. Reception of the first 18x provisional response
which creates a new early dialog is described in at the beginning of this
subclause).
b) if the O-MGCF has received an SDP body on the early dialog on which the SIP
message with the P-Early-Media header field that authorizes backward early
media was received,
the O-MGCF shall provide to the IM-MGW the remote IP address and UDP port, and
the remote codec selected from the latest received SDP body corresponding to
the early dialog on which the SIP message with the P-Early-Media header field
that authorizes backward early media was received.
Upon reception of:
a) a SIP message with the P-Early-Media header field that removes
authorization of backward early media (the received em-param(s) in the
P-Early-Media header field includes \"inactive\" or \"recvonly\") on the early
dialog for which:
1) the P-Early-Media header field authorizing backward early media was
previously received (the received em-param(s) in the P-Early-Media header
field includes \"sendrecv\" or \"sendonly\"); and
2) the O-MGCF provided to the IM-MGW the remote IP address and UDP port, and
the remote codec selected from the latest received SDP body corresponding to
this early dialog and this remote IP address and UDP port, are the most
recently sent the remote IP address and UDP port to the IM-MGW; or
b) a 199 Early Dialog Terminated provisional response corresponding to the SIP
early dialog for which:
1) the P-Early-Media header field authorizing backward early media was
previously received (the received em-param(s) in the P-Early-Media header
field includes \"sendrecv\" or \"sendonly\"); and
2) the O-MGCF provided to the IM-MGW the remote IP address and UDP port, and
the remote codec selected from the latest received SDP body corresponding to
this early dialog and this remote IP address and UDP port, are the most
recently sent the remote IP address and UDP port to the IM-MGW,
the O-MGCF shall check if the P-Early-Media header field that authorizes
backward early media (the received em-param(s) in the P-Early-Media header
field includes \"sendrecv\" or \"sendonly\") was received on any other early
dialog and that the authorization of backward early media on that early dialog
has not changed. If such early dialog:
a) exists the O-MGCF shall provide to the IM-MGW using the Configure IMS
Resources procedure, the remote IP address and UDP port, and the remote codec
selected from the latest received SDP body on that early dialog. If there is
more than one such early dialog, the O-MGCF shall select the early dialog
where the P-Early-Media header field was most recently received; or
b) does not exist and if:
1) the O-MGCF has already received the 180 Ringing provisional response on any
of existing SIP early dialog; or
2) the received SIP message is the 180 Ringing provisional response,
the O-MGCF shall request the IM-MGW to provide an awaiting answer indication
(ringing tone) to the calling party using the Send Tone procedure (signals 27
and 28 in figure 39a/2).
##### 9.2.3.4.3 IM CN subsystem side session establishment completion
Upon reception of the first final 2xx response (signal 32 in figure 39a), the
MGCF shall use the Configure IMS Resources procedure (signals 35 and 36 in
figure 39a) as detailed below unless the IM-MGW is already configured
accordingly:
\- If the remote IMS resources configured at the IM-MGW do not match the
remote resources selected for the established dialogue of the final response,
the MGCF shall provide the remote IP address and UDP port from the latest
received SDP of this established dialogue, and the remote codec selected from
the latest received SDP of this established dialogue and local configuration
data within the \"remote IMS resources\".
\- If the local IMS resources configured at the IM-MGW contain more codecs
than selected for the established dialogue of the final response, the MGCF
should update the \"local IMS resources\" with the selected local codec
derived from the latest SDP of this established dialogue and local
configuration data. The \"reserve value\" may be cleared unless it is required
for DTMF.
\- The IM-MGW may be configured to use the remote IP address and port
information as source filter for incoming packages to prevent that early media
from other early SIP dialogues interfere with the media of the established
dialogue. The MGCF may also provide an IP address and port source filter that
disallows early media from other early dialogues in order to prevent that such
early media interfere with the media of the established dialogue. If the MGCF
has provided a source filter selecting media of another SIP early dialogue, it
shall remove or update this source filter.
##### 9.2.3.4.4 Message sequence chart
Figure 39a shows an example message sequence chart for a CS network
originating Session Setup with ISUP, where forking occurs.
Figure 39a/1: CS Network Originating Session with forking, ISUP (message
sequence chart)
Figure 39a/2: CS Network Originating Session with forking, ISUP (message
sequence chart continue)
### 9.2.4 Session release initiated from IM CN subsystem side
#### 9.2.4.1 BICC
##### 9.2.4.1.1 Session release in the IM CN subsystem side
When the MGCF has received a BYE message from the IM CN subsystem side, the
MGCF shall release resources in the IM-MGW serving the relevant Mb interface
connection by using the \"Release IMS Termination\" procedure (signals 5 and 6
in figure 40). After receiving the BYE message, the MGCF shall also send a 200
OK [BYE] message towards the IM CN subsystem (signal 2 in figure 40).
##### 9.2.4.1.2 Session release in the CS network side
When the MGCF has received a BYE message from the IM CN subsystem side, the
MGCF shall send a REL message to the succeeding node (signal 3 in figure 40).
Once the succeeding node has responded with the RLC message (signal 6 in
figure 40), the MGCF shall release the resources for the CS network side in
the IM-MGW. If any resources were seized in the IM-MGW, the MGCF shall use the
\"Release Bearer\", \"Change Through-Connection\" and \"Release Termination\"
procedures (signals 7 to 10 in figure 40) to indicate to the IM-MGW that the
CS network side bearer termination shall be removed and the bearer shall be
released towards the succeeding MGW.
##### 9.2.4.1.3 Message sequence chart
Figure 40 shows the message sequence chart for the session release initiated
from the IM CN subsystem side.
Figure 40: Session release from IM CN subsystem side for BICC (message
sequence chart)
#### 9.2.4.2 ISUP
##### 9.2.4.2.1 Session release in the IM CN subsystem side
When the MGCF has received a BYE message from the IM CN subsystem side, the
MGCF shall release resources in the IM-MGW serving the relevant Mb interface
connection by using the \"Release IMS Termination\" procedure (signals 4 and 5
in figure 41). After receiving the BYE message, the MGCF shall also send a 200
OK [BYE] message towards the IM CN subsystem (signal 2 in figure 41).
##### 9.2.4.2.2 Session release in the CS network side
When the MGCF has received a BYE message from the IM CN subsystem side, the
MGCF shall send a REL message to the succeeding node (signal 3 in figure 41).
After sending the REL message, the MGCF shall expect a RLC message (signal 8
in figure 41) from the succeeding node. The MGCF shall also release the
resources for the CS network side in the IM-MGW. If any resources were seized
in the IM-MGW, the MGCF shall use the \"Release TDM Termination\" procedure
(signals 6 to 7 in figure 41) to indicate to the IM-MGW that the CS network
side bearer termination can be released.
##### 9.2.4.2.3 Message sequence chart
Figure 41 shows the message sequence chart for the session release initiated
from the IM CN subsystem side.
Figure 41: Session release from IM CN subsystem side for ISUP (message
sequence chart)
### 9.2.5 Session release initiated from CS network side
#### 9.2.5.1 BICC
##### 9.2.5.1.1 Session release in the CS network side
When the MGCF receives a REL message from the preceding node (signal 1 in
figure 42), the MGCF shall release resources for the CS network side in the
IM-MGW. If any resources were seized in the IM-MGW, the MGCF shall use the
\"Release Bearer\", \"Change Through-Connection\" and \"Release Termination\"
procedures to indicate to the IM-MGW that the CS network side bearer
termination shall be removed and the bearer shall be released towards the
preceding MGW (signal 3 to 6 in figure 42). After completion of resource
release, the MGCF shall send a RLC message towards the preceding node.
##### 9.2.5.1.2 Session release in the IM CN subsystem side
When the MGCF receives a REL message from the preceding node (signal 1 in
figure 42), the MGCF shall send a BYE message to the IM CN subsystem (signal 2
in figure 42) and the MGCF shall release the resources in the IM-MGW serving
the relevant Mb interface connection by using the \"Release IMS Termination\"
procedure (signals 7 and 8 in figure 42). The MGCF shall also expect to
receive a 200 OK [BYE] message from the IM CN subsystem side (signal 10 in
figure 42).
##### 9.2.5.1.3 Message sequence chart
Figure 42 shows the message sequence chart for the session release initiated
from the CS network side.
Figure 42: Session release from CS network side for BICC (message sequence
chart)
#### 9.2.5.2 ISUP
##### 9.2.5.2.1 Session release in the CS network side
When the MGCF receives a REL message from the preceding node (signal 1 in
figure 43), the MGCF shall release resources for the CS network side in the
IM-MGW. If any resources were seized in the IM-MGW, the MGCF shall use the
\"Release TDM Termination procedures\" to indicate to the IM-MGW that the CS
network side bearer termination can be released (signal 3 to 4 in figure 43).
After completion of resource release, the MGCF shall send a RLC message
towards the preceding node.
##### 9.2.5.2.2 Session release in the IM CN subsystem side
When the MGCF receives a REL message from the preceding node (signal 1 in
figure 43), the MGCF shall send a BYE message to the IM CN subsystem (signal 2
in figure 43) and the MGCF shall release the resources in the IM-MGW serving
the relevant Mb interface connection by using the \"Release IMS Termination\"
procedure (signal 5 to 6 in figure 43). The MGCF shall also expect to receive
a 200 OK [BYE] message from the IM CN subsystem side (signal 8 in figure 43).
##### 9.2.5.2.3 Message sequence chart
Figure 43 shows the message sequence chart for the session release initiated
from the CS network side.
Figure 43: Session release from CS network side for ISUP (message sequence
chart)
### 9.2.6 Session release initiated by MGCF
#### 9.2.6.1 BICC
##### 9.2.6.1.1 Session release in the CS network side
The MGCF shall send a REL message to the succeeding node on the CS network
side (signal 1 in figure 44) Once the succeeding node has responded with the
RLC message (signal 3 in figure 44), the MGCF shall release the resources for
the CS network side in the IM-MGW. If any resources were seized in the IM-MGW,
the MGCF shall use the \"Release Bearer\", \"Change Through-Connection\" and
\"Release Termination\" procedures to indicate to the IM-MGW that the CS
network side bearer termination shall be removed and the bearer shall be
released towards the succeeding MGW (signal 4 to 7 in figure 44).
##### 9.2.6.1.2 Session release in the IM CN subsystem side
The MGCF shall sends a BYE message to the IM CN subsystem side (signal 2 in
figure 44) and the MGCF shall release the resources in the IM-MGW serving the
relevant Mb interface connection by using the \"Release IMS Termination\"
procedure (signals 8 and 9 in figure 44). The MGCF shall also expect to
receive a 200 OK [BYE] message is received from the IM CN subsystem side
(signal 10 in figure 44).
##### 9.2.6.1.3 Message sequence chart
Figure 44 shows the message sequence chart for the session release initiated
by the MGCF.
Figure 44: Session release initiated by MGCF for BICC (message sequence chart)
#### 9.2.6.2 ISUP
##### 9.2.6.2.1 Session release in the CS network side
The MGCF shall send a REL message to the succeeding node on the CS network
side (signal 2 in figure 45) and the MGCF shall release the resources for the
CS network side in the IM-MGW. If any resources were seized in the IM-MGW, the
MGCF shall use the \"Release TDM Termination\" procedure to indicate to the
IM-MGW that the CS network side termination shall be released (signal 5 to 6
in figure 45). The MGCF shall also expect to receive a RLC message from the
succeeding node on the CS network side (signal 7 in figure 45).
##### 9.2.6.2.2 Session release in the IM CN subsystem side
The MGCF shall send a BYE message to the IM CN subsystem side (signal 1 in
figure 45) and the MGCF shall release the resources in the IM-MGW serving the
relevant Mb interface connection by using the \"Release IMS Termination\"
procedure (signal 5 to 6 in figure 45). The MGCF shall also expect to receive
a 200 OK [BYE] message from the IM CN subsystem side (signal 8 in figure 45).
##### 9.2.6.2.3 Message sequence chart
Figure 45 shows the message sequence chart for the session release initiated
by the MGCF.
Figure 45: Session release initiated by MGCF for ISUP (message sequence chart)
### 9.2.7 Session release initiated by IM-MGW
#### 9.2.7.1 BICC
##### 9.2.7.1.1 Session release in the CS network side
Upon receiving from the IM-MGW a \"Bearer Released\" procedure (signal 1a and
2a in figure 46) or \"IMS Bearer Released\" procedure (signal 1b and 2b in
figure 46) or a \"MGW Out-of-Service\" procedure indicating an immediate
release (H248 ServiceChangeMethod=\"Forced\") (not depicted in figure 46), the
MGCF shall send a REL message to the succeeding node on the CS network side
(signal 3 in figure 46). Once the succeeding node has responded with the RLC
message (signal 5 in figure 46), the MGCF shall release the resources for the
CS network side in the IM-MGW, unless the \"MGW Out-of-Service\" procedure was
received. If any resources were seized in the IM-MGW, the MGCF shall use the
\"Release Termination\" procedure to indicate to the IM-MGW that the CS
network side bearer termination shall be removed (signals 6 and 7 in figure
46).
NOTE: Other actions related to MGW Out-Of-Service procedure is defined in 3GPP
TS 23.205 [27].
##### 9.2.7.1.2 Session release in the IM CN subsystem side
Upon receiving from the IM-MGW a \"Bearer Released\" procedure (signals 1a and
2a in figure 46) or \"IMS Bearer Released\" procedure (signal 1b and 2b in
figure 46) or a \"MGW Out-of-Service\" procedure indicating an immediate
release (H248 ServiceChangeMethod=\"Forced\") (not depicted in figure 46), the
MGCF shall send a BYE/CANCEL message to the IM CN subsystem side (signal 4 in
figure 46) Upon receiving from the IM-MGW a \"Bearer Released\" procedure or
\"IMS Bearer Released\" procedure, the MGCF shall also release the resources
in the IM-MGW serving the relevant Mb interface connection by using the
\"Release IMS Termination\" procedure (signals 8 and 9 in figure 46). The MGCF
shall also expect to receive a 200 OK [BYE] message from the IM CN subsystem
side (signal 10 in figure 46).
NOTE: Other actions related to MGW-Out-Of-Service procedure is defined in 3GPP
TS 23.205 [27]
##### 9.2.7.1.3 Message sequence chart
Figure 46 shows the message sequence chart for the session release initiated
by the IM-MGW.
Figure 46: Session release initiated by the IM-MGW for BICC (message sequence
chart)
#### 9.2.7.2 ISUP
##### 9.2.7.2.1 Session release in the CS network side
Upon receiving from the IM-MGW a \"Termination Out-of-Service\" procedure
indicating an immediate release (signals 1a and 2a in figure 47), a \"Bearer
Released\" procedure (signal 1b and 2b in figure 47), a \"IMS Bearer
Released\" procedure (signal 1c and 2c in figure 47) or a \"MGW Out-of-Service
procedure\" (not depicted in figure 47) indicating an immediate release (H248
ServiceChangeMethod=\"Forced\") the MGCF shall send a REL message to the
succeeding node (signal 3 in figure 47). Upon receiving from the IM-MGW a
\"Termination Out-of-Service\" message procedure indicating an immediate
release or a \"Bearer Released\" procedure, the MGCF shall also release the
resources for the corresponding CS network side termination(s) in the IM-MGW.
If any resources were seized in the IM-MGW, the MGCF shall use the \"Release
TDM Termination\" procedure to indicate to the IM-MGW that the CS network side
bearer termination can be removed (signals 7 and 8 in figure 47). The MGCF
also expects to receive a RLC message on the CS network side (signal 9 in
figure 47) before the circuit is reselectable.
NOTE: Other actions related to \"MGW-Out-Of-Service\" procedure are defined in
3GPP TS 23.205 [27].
##### 9.2.7.2.2 Session release in the IM CN subsystem side
Upon receiving from the IM-MGW a \"Termination Out-of-Service\" procedure
indicating an immediate release (signal 1a and 2a in figure 47) on the CS
termination in the context, a \"Bearer Released\" procedure (signal 1b and 2b
in figure 47), an \"IMS Bearer Released\" procedure (signal 1c and 2c in
figure 47) or a \"MGW Out-of-Service procedure\" (not depicted in figure 47)
indicating an immediate release, (H248 ServiceChangeMethod=\"Forced\") the
MGCF shall send a BYE/CANCEL message to the IM CN subsystem side (signal 4 in
figure 47). Upon receiving from the IM-MGW a \"Termination Out-of-Service\"
procedure indicating an immediate release on the CS termination in the
context, a \"Bearer Released\" procedure or an \"IMS Bearer Released\"
procedure, the MGCF shall also release the resources in the IM-MGW for the
corresponding terminations towards the IM CN subsystem using the \"Release IMS
Termination\" procedure (signals 5 and 6 in figure 47). The MGCF also expects
to receive a 200 OK [BYE] message from the IM CN subsystem side (signal 10 in
figure 47).
NOTE: Other actions related to \"MGW-Out-Of-Service\" procedure are defined in
3GPP TS 23.205 [27].
##### 9.2.7.2.3 Message sequence chart
Figure 47 shows the message sequence chart for the session release initiated
by the IM-MGW.
Figure 47: Session release initiated by the IM-MGW for ISUP (message sequence
chart)
### 9.2.8 Handling of RTP telephone events
DTMF digits, telephony tones and signals (telephone events) can be transferred
using different mechanisms. For the IM CN Subsystem, 3GPP TS 24.229 [9]
defines the usage of the RTP payload format defined for DTMF Digits, Telephony
Tones and Telephony Signals in RFC 4733 [105]. When BICC signalling is used in
the CS network, telephony signals may be sent either inband or out-of-band as
defined in ITU-T Recommendation Q.1902.4 [30] and in ITU-T Recommendation
Q.765.5 [35]. If ISUP signalling is used the DTMF tones are sent inband. The
following paragraphs describe the Mn interface procedures to transfer DTMF
between RTP format defined in RFC 4733 [105] and the CS CN.
Before the actual usage of the telephony signals can occur the
sending/receiving of telephone events need to be agreed with the SDP offer-
answer mechanism defined in RFC 3264 [36]. The outcome of the negotiation can
be e.g. that no telephone events are sent in RTP payload, telephone events are
sent only in one direction or in both directions. If the outcome of the
negotiation is that RTP payload telephone-events are sent in both directions,
the IM-MGW may nevertheless be configured to interwork only mobile originated
telephone-events.
When the offer-answer mechanism based session parameters negotiation results
in an agreement that telephone events are sent in the RTP payload and the
needed preconditions are fulfilled, telephone events can be sent in RTP
payload. This negotiation can be done at call control signalling phase or
during an ongoing call.
If the MGCF and IM-MGW support the reception and/or transmission of the RTP
MIME type \"telephone event\" (as defined in RFC 4733 [105]) with the IMS, the
following applies:
\- For CS Network Originating Sessions, the MGCF shall include the MIME type
\"telephone events\" with default events in the first SDP offer. After the
usage of telephone events is agreed in the subsequent offer-answer parameter
exchanges and the needed preconditions defined in RFC 3312 [37] are fulfilled,
telephone events can be sent as RTP payload.
\- In case of IM CN Subsystem Originating Sessions, the MGCF shall accept the
MIME type \"telephone events\" with default events in any SDP answer when it
received such an offer.
#### 9.2.8.1 Sending DTMF digits out-of-band to CS CN (BICC)
For the IM CN subsystem terminated session, the MGCF shall use the \"Configure
IMS Resources\" procedure as described in clause 9.2.3. For the IM CN
subsystem originating session, the MGCF shall use the \"Reserve IMS Connection
Point and Configure Remote Resources\" procedure as described in clause 9.2.2.
If DTMF is supported, the MGCF shall include \"telephone event\" along with
the selected speech codecs within the \"local IMS resources\" Parameter of
these procedures. The same termination shall be used to receive and transmit
DTMF and speech of the same call.
Furthermore, the MGCF shall use the \"Detect IMS RTP Tel Signal\" procedure to
request the MGW to detect incoming telephone events from the IMS and notify
the MGCF about the detected events. The MGW shall use the \"Notify IMS RTP Tel
Event\" procedure for this notification. The termination used to receive DTMF
shall be placed in the same context used for the speech of the same call. The
MGCF shall request to be notified when the MGW detects the end of a digit and
may also request to be notified when the MGW detects the start of a digit. An
IM-MGW not supporting the notification about the detection of the start of a
digit may ignore the request to provide this notification. If the IM-MGW
received a \"Detect IMS RTP Tel Event\" procedure for a termination, the IM-
MGW shall not forward inband to the CS network any DTMF received at this
termination.
Figure 48 shows an example message sequence chart when a DTMF digit is
received from the IM CN subsystem in the RTP payload and the MGCF has
requested to be notified only about the detection of the end of a digit.
Figure 48a shows an example message sequence chart when a DTMF digit is
received from the IM CN subsystem in the RTP payload and the MGCF has
requested to be notified about the detection of the start and the end of a
digit.
Figure 48: Activation of notification of DTMF digits received in RTP and
examples of sending the digits out-of-band to CS CN, a whole digit received by
IM-MGW before sending further (message sequence chart)
Figure 48a: Activation of notification of DTMF digits received in RTP and
examples of sending the digits out-of-band to CS CN, IM-MGW starts sending the
digit further when the start of the digit is recognized (message sequence
chart)
#### 9.2.8.2 Sending and receiving DTMF digits inband to/from CS CN (ISUP or
BICC)
For the IM CN subsystem terminated session, the MGCF shall use the \"Configure
IMS Resources\" procedure as described in clause 9.2.3. For the IM CN
subsystem originating session, the MGCF shall use the \"Reserve IMS Connection
Point and Configure Remote Resources\" procedure as described in clause 9.2.2.
If DTMF is supported and the MGCF wants to configure the IM_MGW to send and
receive DTMF to/from the CS network side, the MGCF shall include \"telephone
event\" along with the selected speech codecs within the \"local IMS
resources\" parameter of these procedures to request the MGW to detect
incoming telephone events and transform them into speech signals on the CS
side and shall not apply the \"Detect IMS RTP Tel Event\" procedure. When
receiving this configuration, an MGW supporting DTMF shall detect DTMF encoded
according as RTP Tel Event and transform this into DTMF tones encoded within
the speech codec used at the CS CN network and may in addition optionally
detect incoming telephone events received inband from the CS CN network and
transform them into telephone events on the IMS side. The same termination
shall be used to receive and transmit DTMF and speech of the same call.
Figure 49 shows the message sequence chart to configure the IM-MGW to receive
DTMF detection on the IMS side and transfer the DTMF inband on the CS side.
When receiving this configuration, the IM-MGW may in addition optionally
detect DTMF inband on the CS side and transmit DTMF on the IMS side.
Figure 49: Activation of processing of DTMF digits received in RTP for sending
the digits inband to CS CN (message sequence chart)
#### 9.2.8.3 Receiving DTMF digits out-of-band from CS CN (BICC)
For the IM CN subsystem terminated session, the MGCF shall use the \"Configure
IMS Resources\" procedure as described in clause 9.2.3. For the IM CN
subsystem originating session, the MGCF shall use the \"Reserve IMS Connection
Point and Configure Remote Resources\" procedure as described in clause 9.2.2.
If DTMF is supported, the MGCF shall include \"telephone event\" along with
the selected speech codecs within the \"local IMS resources\" Parameter of
these procedures. The same termination shall be used to receive and transmit
DTMF and speech of the same call.
Furthermore, the MGCF shall use the \"Send IMS RTP Tel Event\" and may use the
\"Stop IMS RTP Tel Event\" procedures to request the MGW to play out DTMF to
the IM CN subsystem whenever it receives out-of-band DTMF indications from the
BICC network.
Figure 49a shows an example message sequence chart when DTMF digits are
transmitted to the IM CN subsystem in the RTP payload. For the first digit,
the received APM message contains all information including the duration and
only a single notification is received. For the second digit, the start and
the end of the DTMF digit are notified separately.
Figure 49a: Examples of receiving DTMF digits out-of-band from the CS CN\ and
transmitting them in RTP (message sequence chart)
### 9.2.9 Session hold initiated from IM CN subsystem
The network model in the clause 9.2.1 shall apply here.
**Hold request**
When the IMS network makes a hold request by sending an UPDATE or re-INVITE
message (signal 1 of figure 50), the MGCF shall request the IM-MGW to suspend
sending media towards the IMS side by changing the through-connection of the
IM CN subsystem side termination to \"not through-connected\" (signal 2 of
figure 50). If the IMS side provides modified SDP RR or RS bandwidth
modifiers, as specified in IETF RFC 3556 [59], within the hold request, the
MGCF shall use the Configure IMS Resources Mn procedure to forward this
information to the IM-MGW (not depicted in figure 50, but may be combined with
signal 2). The MGCF shall send a CPG (Hold) message to the succeeding CS
network node to indicate that the session is on hold (signal 4 of figure 50).
Simultaneously a SIP message acknowledging the Hold request is sent to the IMS
side (signal 7 of figure 50, acknowledged by signal 7.a if the INVITE method
is used).
If the MGCF has identified a speech call as an \"ICS call\" as specified in
clause 7.2.3.1.2.12 or in clause 7.2.3.2.7a the MGCF shall not apply an
announcement to the party on hold. Otherwise, an announcement may be applied
to the party on hold, depending on the held party\'s status, using the Play
Announcement procedure (for BICC) or the Play TDM Announcement procedure (for
ISUP, signal 5 in figure 50). The hold operation shall not block RTCP flows.
**Resume request**
When the IMS network makes a request to retrieve the session on hold by
sending an UPDATE or re-INVITE message (signal 8 of figure 50), the MGCF shall
request the IM-MGW to re-establish communication towards the IMS network by
changing the through-connection of the IM CN subsystem side termination to
both-way through-connected (signal 11 of figure 50). If the IMS side provides
modified SDP RR or RS bandwidth modifiers, as specified in IETF RFC 3556 [59],
within the retrieve request, the MGCF shall use the Configure IMS Resources Mn
procedure to forward this information to the IM-MGW (not depicted in figure
50, but may be combined with signal 11). Possible announcements to the party
on hold shall be stopped using the Stop Announcement procedure (for BICC) or
the Stop TDM Announcement procedure (for ISUP, signal 9 in figure 50). The
MGCF shall send a CPG (Retrieve) message to the succeeding CS network node to
indicate that the session is retrieved (signal 13 of figure 50).
**Message sequence chart**
Figure 50 shows the message sequence chart for the call hold and retrieval
procedures.
NOTE: For an \"ICS call\" signals 5, 6, 9 and 10 will not be sent since the
MGCF will not request an announcement from the IM-MGW.
Figure 50: Session hold/resume from IM CN subsystem
### 9.2.10 Session hold initiated from CS network
When an MGCF receives a CPG message with a \"_remote hold\"_ Generic
notification indicator (signal 1 of figure 51), the MGCF forwards the hold
request by sending an UPDATE or re-INVITE message containing SDP with
\"_sendonly_ \" or \"inactive\" media (signal 4 of figure 51).
When an MGCF receives a CPG message with a \"_remote retrieval_ \" Generic
notification indicator (signal 6 of figure 51), the MGCF forwards the resume
request by sending an UPDATE or re-INVITE message containing SDP with
\"_sendrecv_ \" or \"recvonly\" media (signal 9 of figure 51).
If the MGCF receives a CPG with _\"remote hold\"_ or _\"remote retrieval\"_
before answer, it shall forward the request using an UPDATE message. If the
MGCF receives a CPG with _\"remote hold\"_ or _\"remote retrieval\"_ after
answer, it should forward the request using re-INVITE but may use UPDATE.
If link aliveness information is required at the IM-MGW while the media are on
hold, and RTCP was previously disabled the MGCF should provide to the modified
SDP RR and RS bandwidth modifiers specified in IETF RFC 3556 [59] within the
SDP offers in the UPDATE or re-INVITE messages holding and retrieving the
media as detailed in clause 7.3.1 of 3GPP TS 26.114 [104]. If no link
aliveness information is required at the IM-MGW or RTCP was previously
enabled, the MGCF should provide the SDP RR and RS bandwidth modifiers
previously used.
The interworking does not impact the user plane, unless the MGCF:
\- provides modified SDP RR and RS bandwidth modifiers in the UPDATE or re-
INVITE messages. If the MGCF provides modified SDP RR and RS bandwidth
modifiers in the UPDATE or re-INVITE messages, the MGCF shall also provide
modified SDP RR and RS bandwidths to the IM-MGW using the Configure IMS
Resources procedures (signals 2-3 and 7-8 of figure 51); or
\- has identified a speech call as an \"ICS call\" as specified in clause
7.2.3.1.2.12 or in clause 7.2.3.2.7a. When the MGCF receives from the CS
network:
a) a hold request the MGCF shall request the IM-MGW to suspend sending media
towards the IMS side by changing the through-connection of the IM CN subsystem
side termination to \"not through-connected\" (not depicted in figure 51, but
may be combined with signal 2) prior to sending of the UPDATE or re-INVITE
message containing the SDP offer with \"_sendonly_ \" or \"inactive\" media;
b) a request to retrieve the session on hold and if the MGCF requested the IM-
MGW to suspend sending media on the hold request the MGCF shall request the
IM-MGW to re-establish communication towards the IMS network by changing the
through-connection of the IM CN subsystem side termination to \"both-way
through-connected\" (not depicted in figure 51, but may be combined with
signal 7) prior to sending of the UPDATE or re-INVITE message containing the
SDP offer with \"_sendrecv_ \" or \"recvonly\" media; or
\- has received for a confirmed dialog towards IMS side the Contact header (in
the initial INVITE request or in the 200 OK (INVITE) response) with the
\"_isfocus_ \" media feature tag, defined in IETF RFC 3840 [135]. When the
MGCF receives from the CS network:
a) a hold request the MGCF shall request the IM-MGW to suspend sending media
towards the IMS side by changing the through-connection of the IM CN subsystem
side termination to \"not through-connected\" (not depicted in figure 51, but
may be combined with signal 2) prior to sending of the UPDATE or re-INVITE
message containing the SDP offer with \"_sendonly_ \" or \"_inactive_ \"
media; or
b) a request to retrieve the session on hold and if the MGCF requested the IM-
MGW to suspend sending media on the hold request the MGCF shall request the
IM-MGW to re-establish communication towards the IMS network by changing the
through-connection of the IM CN subsystem side termination to \"both-way
through-connected\" (not depicted in figure 51, but may be combined with
signal 7) prior to sending of the UPDATE or re-INVITE message containing the
SDP offer with \"_sendrecv_ \" or \"_recvonly_ \" media.
**Message sequence chart**
Figure 51 shows the message sequence chart for the call hold and retrieval
procedures.
Figure 51: Session hold/resume from CS network
### 9.2.11 Explicit Congestion Notification Support
#### 9.2.11.1 General
A MGCF and IM-MGW may support Multimedia Telephony using Explicit Congestion
Notification (see IETF RFC 3168 [129], IETF RFC 6679 [130], and 3GPP TS 26.114
[104]), and may then act as an ECN endpoint to enable ECN with a local ECN-
capable terminal within a local network that properly handles ECN-marked
packets.
#### 9.2.11.1a Incoming Call Interworking from SIP to ISUP/BICC at I-MGCF
If the MGCF receives a SDP Offer containing ECN negotiation, see IETF RFC 6679
[130], and if all of the following statements are true:
\- the MGCF supports ECN according to 3GPP TS 26.114 [104];
\- the IM-MGW supports ECN according to 3GPP TS 26.114 [104];
\- the IM-MGW knows (via configuration) that the preceding (IMS) network
supports ECN according to 3GPP TS 26.114 [104]; and
\- the IM-MGW supports at least some of the initialisation methods offered
within the \"a=ecn-capable-rtp\",
NOTE 1: Only the \"leap\" initialisation method is supported over the Mn
interface in this release.
The MGCF shall:
\- act as an end point for ECN;
\- select an initialisation method supported by the IM-MGW;
\- determine if application specific feedback or ECN feedback messages shall
be used, taking into account whether the IM-MGW supports ECN feedback
messages, and the negotiation procedures in 3GPP TS 26.114 [104];
\- determine if ECN XR summary reports can be used, taking into account
whether they are supported at the IM-MGW and the negotiation procedures in
3GPP TS 26.114 [104];
\- return an SDP Answer according to 3GPP TS 26.114 [104] and the capabilities
of the IM-MGW, containing the \"a=ecn-capable-rtp\" attribute; and
NOTE 2: ECN XR summary reports and RTCP AVPF ECN feedback message are not
supported in this release.
\- indicate to the IM-MGW that it shall apply the ECN procedures (according to
3GPP TS 26.114 [104]) and act as an ECT endpoint.
The IM-MGW should not send RTCP XR ECN summary reports.
#### 9.2.11.1b Outgoing Call Interworking from ISUP/BICC to SIP at O-MGCF
When creating the SDP Offer the MGCF may initiate ECN negotiation (in
accordance with 3GPP TS 26.114 [104]) , indicating the capabilities of the IM-
MGW (e.g. supported initialisation methods, support of ECN feedback message,
and support of ECN XR summary reports).
NOTE: ECN XR summary reports and RTCP AVPF ECN feedback message are not
supported in this release.
If the MGCF receives the SDP Answer also containing ECN attributes (indicating
successful ECN negotiation) then it shall indicate to the IM-MGW that it shall
apply the ECN procedures (according to 3GPP TS 26.114 [104]) and act as an ECT
endpoint.
The IM-MGW should not send RTCP XR ECN summary reports.
#### 9.2.11.1c Detection of ECN failures by IM-MGW
If the IM-MGW detects an ECN-related error case, for example non-ECT in the
received packets when ECT(0) was expected or detecting a very high packet loss
rate when ECN is used, the IM-MGW shall notify the MGCF. The MGCF should then
initiate a session re-negotiation to disable ECN.
#### 9.2.11.2 Message sequence chart
Figure 9.2.11.2.1 shows the message sequence chart example for requesting
Explicit Congestion Notification.
Figure 9.2.11.2.1: Procedure to Request ECN
Upon receipt of a request to apply Explicit Congestion Notification the IM-MGW
shall set the ECN field of the IP header in accordance with 3GPP TS 26.114
[104] when sending any data packets.
Upon receipt of any IP headers indicating ECN Congestion Experienced (ECN-CE)
the IM-MGW shall trigger rate adaptation in accordance with 3GPP TS 26.114
[104].
Figure 9.2.11.2.2 shows the message sequence chart example for an ECN Failure
Event.
Figure 9.2.11.2.2: Procedure to Report ECN Failure
When the MGCF receives a Notification indicating that a failure has occurred,
the MGCF may trigger a new SDP offer to disable ECN.
### 9.2.12 Interactive Connectivity Establishment Support
#### 9.2.12.1 General
The MGCF and the IM-MGW may support ICE functionality as specified in IETF RFC
8445 [156] and IETF RFC 8839 [157], and 3GPP TS 24.229 [9] to support a UE
residing behind a remote NAT. The present clause describes the requirements
for MGCF and IM-MGW when the ICE procedures are supported.
Support of full ICE functionality is optional, but if ICE is supported, the
MGCF and IM-MGW shall at least support ICE lite as specified in IETF RFC 8445
[156]_._
The MGCF and IM-MGW shall only use host candidates as local ICE candidates.
NOTE 1: MGCF and IM-MGW are not located behind a NAT (from perspective of the
ICE deployment model according to figure 1 in IETF RFC 8445 [156]).
When the MGCF detects no ICE parameters in the received SDP, it shall not
configure the IM-MGW to apply any ICE and STUN related procedures (see IETF
RFC 8489 [158]) toward the call leg from where the SDP has been received.
Any IM-MGW supporting ICE shall advertise its support of incoming STUN
continuity check procedures. An IM-MGW supporting full ICE procedures shall in
addition advertise its support for originating STUN connectivity check
procedures.
If the IM-MGW does not indicate the support of STUN procedures, or if the MGCF
is configured not to apply ICE toward a call leg, the MGCF shall not configure
the IM-MGW to apply STUN procedures.
#### 9.2.12.2 ICE lite
If the MGCF is configured to use ICE lite, or supports only ICE lite, or
controls an IM-MGW that only support ICE lite, the procedures in the present
clause apply.
If the MGCF receives an initial SDP offer with ICE candidate information but
no \"a=ice-lite\" attribute, the MGCF:
\- shall request the IM-MGW for each media line where it decides to use ICE to
reserve an ICE host candidate and provide its address information and a
related ICE user name fragment and password;
NOTE 1: Requesting only one host candidate per m-line prevents that the MGCF
will receive \"a=remote-candidates\" SDP attributes in a subsequent SDP.
Requesting separate ufrag and password for each media line simplifies H.248
encoding.
\- shall configure the IM-MGW to act as STUN server at the host candidate
address, i.e. to answer STUN connectivity checks;
\- may provide received remote ICE candidates and the received related ICE
user name fragment and password to the IM-MGW;
\- if an \"a=ice-options\" attribute with the value \"ice2\" was present in
the received SDP offer, shall include the \"a=ice-options\" attribute with the
value \"ice2\" in the SDP answer it sends;
\- shall include the host candidate and related ICE user name fragment and
password received from the IM-MGW in the SDP answer it sends; and
\- shall include the \"a=ice-lite\" attribute in the SDP answer it sends.
If the MGCF receives SDP offer with ICE candidate information and an \"a=ice-
lite\" attribute, the MGCF shall not apply ICE and shall not include any ICE
related SDP attributes in the SDP answer.
NOTE 2: This avoids that the ICE lite peer needs to send extra SDP offers to
complete ICE procedures.
If the MGCF sends an SDP offer and ICE is to be applied, the MGCF:
\- shall request the IM-MGW to reserve a host candidate for each media line
where it decides to use ICE and provide its address information, user name
fragment and password;
\- shall configure the IM-MGW to act as STUN server at the host candidate
address, i.e. to answer STUN connectivity checks;
\- shall include the \"a=ice-options\" attribute with the value \"ice2\" in
the SDP offer;
\- shall include the host candidate provided by the IM-MGW and related ICE
user name fragment and password in the SDP offer; and
\- shall include the \"a=ice-lite\" attribute in the SDP offer.
If the MGCF then receives an SDP answer with candidate information from the
call leg where ICE is to be applied, the MGCF may provide received remote ICE
candidates and the received related ICE user name fragment and password to the
IM-MGW.
After the initial SDP offer-answer exchange, the MGCF can receive a new offer
from the peer that includes updated address and port information in the SDP
\"c=\" line, \"m=\" line, or \"a=rtcp\" line SDP attributes. If the ICE user
name fragment and password in the SDP offer differ from the ones received in
the previous SDP (i.e. the peer restarts ICE), the MGCF shall apply the same
procedures as for the initial SDP offer.
When receiving a request for a host candidate for a media line, the IM-MGW
shall allocate one host candidate for that media line and send it to the MGCF
within the reply. The IP address and port shall be the same as indicated
separately as Local IP Resources. The IM-MGW shall also indicate that it
supports ICE lite in the reply.
When receiving a request for an ICE user name fragment and password, the IM-
MGW shall generate an ICE user name fragment and password and send it to the
MGCF within the reply. The IM-MGW shall store the password and user name
fragment to be able to authenticate incoming STUN binding request according to
clause 7.3 of IETF RFC 8445 [156].
When receiving a request to act as STUN server, the IM-MGW shall be prepared
to answer STUN binding request according to clause 7.3 of IETF RFC 8445 [156].
Once a STUN binding request with the \"USE-CANDIDATE\" flag has been received,
the IM-MGW may send media towards the source of the binding request.
#### 9.2.12.3 Full ICE
If the MGCF supports and is configured to use full ICE, and controls an IM-MGW
that supports full ICE, the procedures in the present clause apply.
If the MGCF receives an initial SDP offer with ICE candidate information, the
MGCF:
\- shall request the IM-MGW for each media line where it decides to use ICE to
reserve an ICE host candidate and provide its address information and a
related ICE user name fragment and password;
NOTE 1: Requesting only one host candidate per m-line prevents that the MGCF
will receive \"a=remote-candidates\" SDP attributes in a subsequent SDP.
Requesting separate ufrag and password for each media line simplifies H.248
encoding.
\- shall request the IM-MGW to provide the desired pacing value for
connectivity checks (Ta timer value);
\- shall configure the IM-MGW to act as STUN server at the host candidate
address, i.e. to answer STUN connectivity checks;
\- shall provide received remote ICE candidates and the received related ICE
user name fragment and password to the IM-MGW;
\- shall provide the remote pacing value to the IM-MGW as follows:
a) if the \"a=ice-pacing\" attribute was present in the received SDP answer,
the received pacing value; or
b) otherwise the default pacing value of 50 ms;
\- if an \"a=ice-options\" attribute with the value \"ice2\" was present in
the received SDP offer, shall include the \"a=ice-options\" attribute with the
value \"ice2\" in the SDP answer it sends;
\- shall include the \"a=ice-pacing\" attribute with the pacing value provided
by the IM-MGW in the SDP answer it sends;
\- shall include the host candidate and related ICE user name fragment and
password received from the IM-MGW in the SDP answer it sends;
\- shall determine the role of MGCF in ICE (controlling or controlled)
according to clause 6.1.1 of IETF RFC 8445 [156];
\- shall configure the IM-MGW to perform connectivity checks in accordance
with the determined ICE role;
\- shall configure the IM-MGW to report connectivity check results; and
\- shall configure the IM-MGW to report a new peer reflexive candidate if
discovered during the connectivity check.
If the MGCF sends an SDP offer and ICE is to be applied, the MGCF:
\- shall request the IM-MGW to reserve a host candidate for each media line
were it decides to use ICE and provide its address information, ICE user name
fragment and password;
\- shall request the IM-MGW to provide the pacing value for connectivity
checks;
\- shall configure the IM-MGW to act as STUN server at the host candidate
address, i.e. to answer STUN connectivity checks;
\- shall include the \"a=ice-options\" attribute with the value \"ice2\" in
the SDP offer it sends;
\- shall include the \"a=ice-pacing\" attribute with the pacing value provided
by the IM-MGW in the SDP offer it sends; and
\- shall include the host candidate provided by the IM-MGW and related ICE
user name fragment and password in the SDP offer it sends.
If the MGCF then receives an SDP answer with candidate information from the
call leg where ICE is to be applied, the MGCF:
\- shall provide received remote ICE candidates and the received related ICE
user name fragment and password to the IM-MGW;
\- shall provide the remote pacing value to the IM-MGW as follows:
a) if the \"a=ice-pacing\" attribute was present in the received SDP answer,
the received pacing value; or
b) otherwise the default pacing value of 50 ms;
\- shall determine the role of MGCF in ICE (controlling or controlled)
according to clause 6.1.1 of IETF RFC 8445 [156];
\- shall configure the IM-MGW to perform connectivity checks in accordance
with the determined ICE role;
\- shall configure the IM-MGW to report connectivity check results; and
\- shall configure the IM-MGW to report a new peer reflexive candidate if
discovered during the connectivity check.
When the MGCF is informed by the IM-MGW about new peer reflexive candidate(s)
discovered by the connectivity checks, the MGCF shall configure the IM-MGW to
perform additional connectivity checks for those candidates,
When the MGCF is informed by the IM-MGW about successful candidate pairs
determined by the connectivity checks, the MGCF shall send a new SDP offer to
its peer with contents according to clause 4.4.1 of IETF RFC 8839 [157] if it
has the controlling role and the highest-priority candidate pair differs from
the default candidates in previous SDP.
After the initial SDP offer-answer exchange, the MGCF can receive a new offer
from the peer that includes updated address and port information in the SDP
\"c=\" line, \"m=\" line, or \"a=rtcp\" line SDP attributes. If the ICE user
name fragment and password in the SDP offer are the same as received in the
previous SDP, the MGCF shall then configure the IM-MGW to send media towards
the address and port in the SDP \"c=\" line, \"m=\" line. If the STUN user
name and password in the SDP offer differ from the ones received in the
previous SDP (i.e. the peer restarts ICE), the MGCF shall apply the same
procedures as for the initial SDP offer.
When receiving a request for a host candidate for a media line, the IM-MGW
shall allocate one host candidate for that media line and send it to the MGCF
within the reply. The IP address and port shall be the same as indicated
separately as Local IP Resources.
When receiving a request to provide a desired pacing value for connectivity
checks (Ta timer value), the IM-MGW shall calculate Ta timer value based on
the characteristics of the associated data or shall use the default value of
50 ms and provide it as desired Ta timer value. The IM-MGW shall compare the
own desired Ta timer value with the Ta timer value provided by the MGCF and
shall use the higher value for connectivity checks (as specified in IETF RFC
8445 [156]).
When receiving a request for an ICE user name fragment and password, the IM-
MGW shall generate an ICE user name fragment and password and send it to the
MGCF within the reply. The IM-MGW shall store the password and user name
fragment to be able to authenticate incoming STUN binding request according to
clause 7.3 of IETF RFC 8445 [156].
When receiving a request to act as STUN server, the IM-MGW shall be prepared
to answer STUN binding request according to clause 7.3 of IETF RFC 8445 [156].
Once a STUN binding request with the \"USE-CANDIDATE\" flag has been received,
the IM-MGW may send media towards the source of the binding request.
When receiving a request to perform connectivity checks and to report
connectivity check results, the IM-MGW:
\- shall compute ICE candidate pairs according to clause 6.1.2 of IETF RFC
8445 [156];
\- shall schedule checks for the ICE candidate pairs according to clause 6.1.4
of IETF RFC 8445 [156];
\- shall send STUN connectivity checks for the scheduled checks according to
clause 7.2 of IETF RFC 8445 [156];
\- shall inform the MGCF about successful candidate pairs determined by the
connectivity checks;
\- shall inform the MGCF about new peer reflexive candidate(s) discovered by
the connectivity checks; and
\- should send media using the highest priority candidate pair for which
connectivity checks have been completed.
#### 9.2.12.4 Procedures for Interactive Connectivity Establishment (ICE)
##### 9.2.12.4.1 ICE lite
Figure 9.2.12.4.1.1 shows a message sequence chart example for performing the
ICE lite procedure towards the offerer.
{width="6.288194444444445in" height="5.283333333333333in"}
Figure 9.2.12.4.1.1: Procedure for interactive connectivity establishment
using ICE lite towards the offerer
##### 9.2.12.4.2 Full ICE
Figure 9.2.12.4.2.1 shows a message sequence chart example for performing the
full ICE procedure towards the offerer.
{width="6.1409722222222225in" height="5.858333333333333in"}
Figure 9.2.12.4.2.1: Procedure for interactive connectivity establishment
using full ICE towards the offerer
##### 9.2.12.4.3 Connectivity check result notification (full ICE)
Figure 9.2.12.4.3.1 shows the message sequence chart example for an ICE
connectivity check result Event.
Figure 9.2.12.4.3.1: Procedure to report ICE connectivity check result
##### 9.2.12.4.4 New peer reflexive candidate notification (full ICE)
Figure 9.2.12.4.4.1 shows the message sequence chart example for additional
connectivity check when new peer reflexive candidate is discovered in full
ICE.
Figure 9.2.12.4.4.1: Procedure to perform additional connectivity check upon
the report of new peer reflexive candidate
### 9.2.13 Codec Parameters Handling
#### 9.2.13.1 Handling of common codec parameters
Table 9.2.13.1.1 describes the MGCF handling of codec related parameters
applicable to multiple codecs when the MGCF sends an SDP offer.
Table 9.2.13.1.1: MGCF handling of common codec parameters when the MGCF acts
as SDP offerer
* * *
Parameter Handling of common codec parameter in the sent SDP offer Handling of
common codec parameter in the received SDP answer ptime (NOTE) The MGCF may
add the parameter with a value according to configured preferences to the SDP
offer. If a ptime parameter is included in the received SDP answer, the MGCF
shall supply the parameter to the IM-MGW for the termination towards the
answerer in the remote descriptor. maxptime (NOTE) The MGCF may add the
parameter with a value according to the IM-MGW capabilities to the SDP offer.
If a maxptime parameter is included in the received SDP answer, the MGCF shall
supply the parameter to the IM-MGW for the termination towards the answerer in
the remote descriptor. NOTE 2: This SDP attribute is defined in IETF RFC 4566
[56]. It applies to all codecs offered in an SDP media line.
* * *
When receiving an SDP offer, the MGCF shall handle the codec related
parameters applicable to multiple codecs as described in table 9.2.13.1.2.
Table 9.2.13.1.2: MGCF handling of common codec parameters when the MGCF acts
as SDP answerer
* * *
Parameter Handling of common codec parameter in the received SDP offer
Handling of common codec parameter in the sent SDP answer ptime (NOTE) If a
ptime parameter is included in the received SDP offer, the MGCF shall supply
the parameter to the IM-MGW for the termination towards the offerer in the
remote descriptor. The MGCF may add the parameter with a value according to
configured preferences to the SDP answer. maxptime (NOTE) If a maxptime
parameter is included in the received SDP offer, the MGCF shall supply the
parameter to the IM-MGW for the termination towards the offerer in the remote
descriptor. The MGCF may add the parameter with a value according to the IM-
MGW capabilities to the SDP answer. NOTE: This SDP attribute is defined in
IETF RFC 4566 [56]. It applies to all codecs offered in an SDP media line.
* * *
IM-MGW handling of codec related parameters applicable to multiple codecs
shall follow table 5.13.1.2 in 3GPP TS 23.334 [145].
#### 9.2.13.2 Handling of EVS speech codec parameters when interworking with a
different codec
The Enhanced Voice Services (EVS) speech codec is defined in 3GPP TS 26.441
[146]. Its RTP payload type is defined in 3GPP TS 26.445 [147], and procedures
for its usage as IMS Multimedia Telephony speech codec are defined in 3GPP TS
26.114 [104].
The MGCF and the IM-MGW may support transcoding to and from the EVS speech
codec. If they do so, the procedures in the present clause apply.
Table 9.2.13.2.1 describes the MGCF handling of EVS codec parameters when the
MGCF sends an SDP offer for an EVS payload type, and that EVS payload type is
selected in the answer. In addition, rules for the parameter handling in 3GPP
TS 26.445 [147] shall apply.
Table 9.2.13.2.1: MGCF handling of EVS related SDP parameters when the MGCF
adds the EVS payload type to the SDP offer it sends out
+----------------------+----------------------+----------------------+ | Parameter | Handling for EVS | Handling if offered | | | payload type added | EVS payload type is | | | to an SDP offer | accepted in the SDP | | | | answer | +----------------------+----------------------+----------------------+ | evs-mode-switch | If the MGCF expects | If an | | (NOTE 1) | that interworking | evs-mode-switch | | | between AMR-WB and | parameter is | | | EVS is required, it | contained in the SDP | | | shall include the | answer, the MGCF | | | evs-mode-switch with | shall forward this | | | value 1. Otherwise | parameter to the | | | the MGCF shall not | IM-MGW for the | | | include the | termination towards | | | evs-mode-switch. | the answerer in the | | | | remote descriptor. | +----------------------+----------------------+----------------------+ | hf-only (NOTE 1) | If the MGCF is | If an hf-only | | | configured to | parameter is | | | negotiate using only | contained in the SDP | | | the header-full EVS | answer, the MGCF | | | RTP payload format, | shall forward this | | | the MGCF shall | parameter to the | | | include the hf-only | IM-MGW in the remote | | | parameter with a | descriptor. | | | value 1. | | +----------------------+----------------------+----------------------+ | dtx (NOTE 1) | If the usage of DTX | If a dtx parameter | | | is not desired in | is contained in the | | | the sending and | SDP answer, the MGCF | | | receiving direction | shall forward this | | | (e.g. due to DTX | parameter to the | | | capabilities of | IM-MGW in the remote | | | expected codecs to | descriptor. | | | transcode with), the | | | | MGCF shall include | | | | the dtx parameter | | | | with a value 0. | | +----------------------+----------------------+----------------------+ | dtx-recv (NOTE 1) | If receiving DTX is | If a dtx-recv | | | not desired and the | parameter is | | | dtx parameter is not | contained in the SDP | | | included, the MGCF | answer, the MGCF | | | shall include the | shall forward this | | | dtx-recv parameter | parameter to the | | | with a value 0. | IM-MGW in the remote | | | | descriptor. | | | If both the dtx and | | | | dtx-recv parameters | | | | are included, those | | | | parameters shall | | | | have the same value; | | | | however, inclusion | | | | of the dtx-recv | | | | parameter is not | | | | required if the dtx | | | | parameter is | | | | included. | | +----------------------+----------------------+----------------------+ | **br** (NOTE 1) | If the MGCF desires | If a br parameter is | | | the same bit rate | contained in the SDP | | | range for the send | answer, the MGCF | | | and receive | shall forward this | | | direction in EVS | parameter to the | | | primary mode, and | IM-MGW in the remote | | | wants to restrict | descriptor. | | | the bit rate range | | | | to match IM-MGW | | | | capabilities and | | | | possible configured | | | | policies, it shall | | | | supply the br | | | | parameter in the SDP | | | | offer it sends. | | | | Otherwise the MGCF | | | | shall not include | | | | this parameter in | | | | the SDP offer. | | | | | | | | If the MGCF also | | | | supplies the bw, | | | | bw-send or bw-recv | | | | parameter, the value | | | | of the br parameter | | | | shall be compatible | | | | with the values of | | | | those parameters. | | +----------------------+----------------------+----------------------+ | br-send (NOTE 1) | If the MGCF desires | If a br-send | | | a different bit rate | parameter is | | | (range) for the send | contained in the SDP | | | and receive | answer, the MGCF | | | direction in EVS | shall forward this | | | primary mode, and | parameter to the | | | wants to restrict | IM-MGW in the remote | | | the bit rate range | descriptor. | | | for the send | | | | direction to match | | | | IM-MGW capabilities | | | | and possible | | | | configured policies, | | | | it shall supply the | | | | br-send parameter in | | | | the SDP offer it | | | | sends. Otherwise the | | | | MGCF shall not | | | | include this | | | | parameter in the SDP | | | | offer. | | | | | | | | If the MGCF also | | | | supplies the bw or | | | | bw-send parameter, | | | | the value of the | | | | br-send parameter | | | | shall be compatible | | | | with the values of | | | | those parameters. | | +----------------------+----------------------+----------------------+ | br-recv (NOTE 1) | If the MGCF desires | If a br-recv | | | a different bit rate | parameter is | | | (range) for the send | contained in the SDP | | | and receive | answer, the MGCF | | | direction in EVS | shall forward this | | | primary mode, and | parameter to the | | | wants to restrict | IM-MGW in the remote | | | the bit rate range | descriptor. | | | for the receive | | | | direction to match | | | | IM-MGW capabilities | | | | and possible | | | | configured policies, | | | | it shall supply the | | | | br-recv parameter in | | | | the SDP offer it | | | | sends. Otherwise the | | | | MGCF shall not | | | | include this | | | | parameter in the SDP | | | | offer. | | | | | | | | If the MGCF also | | | | supplies the bw or | | | | bw-recv parameter, | | | | the value of the | | | | br-recv parameter | | | | shall be compatible | | | | with the values of | | | | those parameters. | | +----------------------+----------------------+----------------------+ | bw (NOTE 1) | If the MGCF desires | If a bw parameter is | | | the same sampling | contained in the SDP | | | bandwidth(s) for the | answer, the MGCF | | | send and receive | shall forward this | | | direction in EVS | parameter to the | | | primary mode, and | IM-MGW in the remote | | | wants to restrict | descriptor. | | | the sampling | | | | bandwidths to match | | | | IM-MGW capabilities, | | | | sampling bandwidths | | | | of expected codecs | | | | EVS will be | | | | transcoded to, and | | | | possible configured | | | | policies, it shall | | | | supply the bw | | | | parameter in the SDP | | | | offer it sends. | | | | Otherwise the MGCF | | | | shall not include | | | | this parameter in | | | | the SDP offer. | | +----------------------+----------------------+----------------------+ | bw-send (NOTE 1) | If the MGCF desires | If a bw-send | | | different sampling | parameter is | | | bandwidths for the | contained in the SDP | | | send and receive | answer, the MGCF | | | direction in EVS | shall forward this | | | primary mode, and | parameter to the | | | wants to restrict | IM-MGW in the remote | | | the sampling | descriptor. | | | bandwidths in the | | | | send direction to | | | | match IM-MGW | | | | capabilities, | | | | sampling bandwidths | | | | of expected codecs | | | | EVS will be | | | | transcoded to and | | | | possible configured | | | | policies, it shall | | | | supply the bw-send | | | | parameter in the SDP | | | | offer it sends. | | | | Otherwise the MGCF | | | | shall not include | | | | this parameter in | | | | the SDP offer. | | +----------------------+----------------------+----------------------+ | bw-recv (NOTE 1) | If the MGCF desires | If a bw-recv | | | different sampling | parameter is | | | bandwidths for the | contained in the SDP | | | send and receive | answer, the MGCF | | | direction in EVS | shall forward this | | | primary mode, and | parameter to the | | | wants to restrict | IM-MGW in the remote | | | the sampling | descriptor. | | | bandwidths in the | | | | receive direction to | | | | match IM-MGW | | | | capabilities, | | | | sampling bandwidths | | | | of expected codecs | | | | EVS will be | | | | transcoded to, and | | | | possible configured | | | | policies, it shall | | | | supply the bw-recv | | | | parameter in the SDP | | | | offer it sends. | | | | Otherwise the MGCF | | | | shall not include | | | | this parameter in | | | | the SDP offer. | | +----------------------+----------------------+----------------------+ | cmr (NOTE 1) | If the MGCF desires | If a cmr parameter | | | to disable codec | is contained in the | | | mode requests within | SDP answer, the MGCF | | | the RTP payload of | shall forward this | | | the EVS primary mode | parameter to the | | | (due to the IM-MGW | IM-MGW in the remote | | | capabilities or | descriptor. | | | policies), it shall | | | | include the cmr | | | | parameter with value | | | | -1 in the SDP offer | | | | it sends. | | +----------------------+----------------------+----------------------+ | ch-aw-recv (NOTE 1) | The MGCF shall | If a ch-aw-recv | | | include the | parameter is | | | ch-aw-recv parameter | contained in the SDP | | | in the SDP offer if | answer, the MGCF | | | it desires to | shall forward this | | | control the | parameter to the | | | channel-aware-mode | IM-MGW in the remote | | | of EVS in the | descriptor. | | | receive direction, | | | | e.g. to disable it | | | | with value -1. The | | | | MGCF shall consider | | | | the capabilities of | | | | the IM-MGW when it | | | | chooses an | | | | appropriate value. | | +----------------------+----------------------+----------------------+ | number of channels | The MGCF shall only | If a \"number of | | (NOTE 2) | include the \"number | channels\" parameter | | | of channels\" | is contained in the | | | parameter in the SDP | SDP answer, the MGCF | | | offer if it desires | shall forward this | | | to send or receive | parameter to the | | | multiple channels. | IM-MGW in the remote | | | If the desired | descriptor. | | | number of channels | | | | in the send and | | | | receive direction | | | | differs, the MGCF | | | | shall include the | | | | higher value. The | | | | MGCF should consider | | | | the number of | | | | channels of expected | | | | codecs EVS will be | | | | transcoded to. | | +----------------------+----------------------+----------------------+ | ch-send (NOTE 1) | The MGCF shall only | If a ch-send | | | include the ch-send | parameter is | | | parameter in the SDP | contained in the SDP | | | offer if it desires | answer, the MGCF | | | to send multiple | shall forward this | | | channels, with | parameter to the | | | different numbers of | IM-MGW in the remote | | | channels in the send | descriptor. | | | and receive | | | | direction. The MGCF | | | | should consider the | | | | number of channels | | | | of expected codecs | | | | EVS will be | | | | interworked with. | | +----------------------+----------------------+----------------------+ | ch-recv (NOTE 1) | The MGCF shall only | If a ch-recv | | | include the ch-recv | parameter is | | | parameter in the SDP | contained in the SDP | | | offer if it desires | answer, the MGCF | | | to receive multiple | shall forward this | | | channels, with | parameter to the | | | different numbers of | IM-MGW in the remote | | | channels in the send | descriptor. | | | and receive | | | | direction. The MGCF | | | | should consider the | | | | number of channels | | | | of expected codecs | | | | EVS will be | | | | interworked with.. | | +----------------------+----------------------+----------------------+ | mode-set (NOTE 4) | The MGCF shall only | If a mode-set | | | include the mode-set | parameter is | | | parameter in the SDP | contained in the SDP | | | offer if it desires | answer, the MGCF | | | to restrict the | shall forward this | | | mode-set of AMR-WB | parameter to the | | | IO mode. The MGCF | IM-MGW in the remote | | | should only restrict | descriptor. | | | the mode-set if the | | | | expected codec EVS | | | | will be interworked | | | | with is AMR-WB and | | | | has a restricted | | | | mode set. | | +----------------------+----------------------+----------------------+ | mode-change-period | The MGCF shall only | If a | | (NOTE 3) | include the | mode-change-period | | | mode-change-period | parameter is | | | parameter with value | contained in the SDP | | | 2 in the SDP offer | answer, the MGCF | | | if it desires to | shall forward this | | | restrict the mode | parameter to the | | | change period of | IM-MGW in the remote | | | received packets in | descriptor. | | | AMR-WB IO mode. The | | | | MGCF should only | | | | restrict the | | | | mode-change-period | | | | if the expected | | | | codec EVS will be | | | | interworked with is | | | | AMR-WB and has such | | | | a restriction. | | +----------------------+----------------------+----------------------+ | mo | The MGCF shall | If a | | de-change-capability | include the | mo | | (NOTE 3) | mo | de-change-capability | | | de-change-capability | parameter is | | | parameter with value | contained in the SDP | | | 2 or omit it in the | answer, the MGCF may | | | SDP offer. | forward this | | | | parameter to the | | | | IM-MGW in the remote | | | | descriptor. | +----------------------+----------------------+----------------------+ | mode-change-neighbor | The MGCF shall only | If a | | (NOTE 3) | include the | mode-change-neighbor | | | mode-change-neighbor | parameter is | | | parameter in the SDP | contained in the SDP | | | offer if it desires | answer, the MGCF | | | to restrict the mode | shall forward this | | | change within | parameter to the | | | received packets of | IM-MGW in the remote | | | AMR-WB IO mode to | descriptor. | | | neighboring modes. | | | | The MGCF should | | | | consider the | | | | mode-change-neighbor | | | | parameter of the | | | | expected codec EVS | | | | will be interworked | | | | with if this is | | | | AMR-WB. | | +----------------------+----------------------+----------------------+ | max-red (NOTE 5) | The MGCF shall only | If a max-red | | | include the max-red | parameter is | | | parameter in the SDP | contained in the SDP | | | offer if it desires | answer, the MGCF | | | to restrict the | shall forward this | | | maximum redundancy | parameter to the | | | of received packets. | IM-MGW in the remote | | | MGCF shall consider | descriptor. | | | the capabilities of | | | | the IM-MGW, and | | | | should consider a | | | | max-red parameter of | | | | the expected codec | | | | EVS will be | | | | interworked with if | | | | this is AMR-WB. | | +----------------------+----------------------+----------------------+ | 3g | If the IM-MGW | If a | | pp_mtsi_app_adapt | supports RTCP APP | 3g | | (NOTE 4) | based adaptation | pp_mtsi_app_adapt | | | messages defined in | attribute is | | | TS 26.114 [104], | contained in the SDP | | | and the MGCF has a | answer, the MGCF | | | policy to negotiate | shall forward this | | | the usage of those | parameter to the | | | messages, the MGCF | IM-MGW in the remote | | | shall include the | descriptor. | | | 3g | | | | pp_mtsi_app_adapt | | | | SDP attribute | | | | indicating the | | | | supported APP | | | | messages in the SDP | | | | offer. | | +----------------------+----------------------+----------------------+ | NOTE 1: This MIME | | | | parameter of the EVS | | | | RTP payload type is | | | | defined in | | | | TS 26.445 [147]. | | | | It is encapsulated | | | | within the SDP | | | | \"a=fmtp\" attribute | | | | defined | | | | I | | | | ETF RFC 4566 [56]. | | | | | | | | NOTE 2: This number | | | | of channels are | | | | encoded as | | | | \"encoding | | | | parameters\" of the | | | | SDP \"a=rtpmap\" | | | | attribute defined in | | | | I | | | | ETF RFC 4566 [56]. | | | | | | | | NOTE 3: This MIME | | | | parameter of the EVS | | | | RTP payload type | | | | relates to AMR-WB IO | | | | mode and is defined | | | | in | | | | I | | | | ETF RFC 4867 [23]. | | | | It is encapsulated | | | | within the SDP | | | | \"a=fmtp\" attribute | | | | defined | | | | I | | | | ETF RFC 4566 [56]. | | | | | | | | NOTE 4: This SDP | | | | attribute is defined | | | | in | | | | TS 26.114 [104]. | | | | It applies to all | | | | codecs offered in an | | | | SDP media line. | | | | However, some values | | | | are specific to EVS. | | | | | | | | NOTE 5: This MIME | | | | parameter of the EVS | | | | RTP payload type is | | | | defined in | | | | I | | | | ETF RFC 4867 [23]. | | | | It is encapsulated | | | | within the SDP | | | | \"a=fmtp\" attribute | | | | defined | | | | I | | | | ETF RFC 4566 [56]. | | | +----------------------+----------------------+----------------------+
When receiving an SDP offer that contains an EVS codec payload type, the MGCF
shall handle the EVS codec parameters as described in table 9.2.13.2.2. In
addition, rules for the parameter handling in 3GPP TS 26.445 [147] shall
apply.
Table 9.2.13.2.2: MGCF handling of EVS related SDP parameters when the MGCF
receives the EVS payload type in an SDP offer
+----------------------+----------------------+----------------------+ | Parameter | Handling of EVS | EVS payload type | | | payload type | supplied in the SDP | | | parameter received | answer | | | in the SDP offer | | +----------------------+----------------------+----------------------+ | evs-mode-switch | If an | If an | | (NOTE 1) | evs-mode-switch | evs-mode-switch | | | parameter is | parameter is | | | contained in the SDP | contained in the SDP | | | offer and the MGCF | offer, the MGCF | | | select the EVS | shall include the | | | payload type, the | evs-mode-switch | | | MGCF shall forward | parameter with | | | this parameter to | unmodified value in | | | the IM-MGW for the | the SDP answer. | | | termination towards | | | | the offerer in the | Otherwise, if the | | | remote descriptor. | MGCF decides to | | | | interwork between | | | | AMR-WB and EVS, it | | | | shall include the | | | | evs-mode-switch with | | | | value 1. | | | | | | | | Otherwise the MGCF | | | | shall not include | | | | the evs-mode-switch. | | | | | | | | If the MGCF supplies | | | | the evs-mode-switch | | | | in the SDP answer, | | | | it shall also supply | | | | it to the IM-MGW in | | | | the local descriptor | | | | for the termination | | | | towards the offerer | | | | with the same value. | +----------------------+----------------------+----------------------+ | hf-only (NOTE 1) | If an hf-only | If an hf-only | | | parameter is | parameter is | | | contained in the SDP | contained in the SDP | | | offer and the MGCF | offer, the MGCF | | | select the EVS | shall include the | | | payload type, the | hf-only parameter | | | MGCF shall forward | with unmodified | | | this parameter to | value in the SDP | | | the IM-MGW for the | answer. | | | termination towards | | | | the offerer in the | Otherwise, if the | | | remote descriptor. | MGCF is configured | | | | to negotiate using | | | | only the header-full | | | | EVS RTP payload | | | | format, the MGCF | | | | shall include the | | | | hf-only parameter | | | | with a value 1. | | | | | | | | If the MGCF supplies | | | | the hf-only | | | | parameter in the SDP | | | | answer, it shall | | | | also supply it to | | | | the IM-MGW in the | | | | local descriptor for | | | | the termination | | | | towards the offerer | | | | with the same value. | +----------------------+----------------------+----------------------+ | dtx (NOTE 1) | If a dtx parameter | If a dtx parameter | | | is contained in the | is contained in the | | | SDP offer and the | SDP offer, the MGCF | | | MGCF select the EVS | shall include the | | | payload type, the | dtx parameter with | | | MGCF shall forward | unmodified value in | | | this parameter to | the SDP answer. | | | the IM-MGW for the | | | | termination towards | If the dtx parameter | | | the offerer in the | is not contained in | | | remote descriptor. | the SDP offer and if | | | | a dtx-recv parameter | | | | is contained in the | | | | SDP offer, the MGCF | | | | may include the dtx | | | | parameter in the SDP | | | | answer , and the | | | | value of the dtx | | | | parameter shall then | | | | be identical to that | | | | of the dtx-recv | | | | parameter in the SDP | | | | offer (e.g, if that | | | | value matches DTX | | | | capabilities of | | | | expected codecs to | | | | transcode with). | | | | | | | | If the dtx parameter | | | | is not contained in | | | | the SDP offer and if | | | | the dtx-recv | | | | parameter is not | | | | contained in the SDP | | | | offer, and if the | | | | usage of DTX is not | | | | desired (e.g. due to | | | | DTX capabilities of | | | | expected codecs to | | | | transcode with), the | | | | MGCF shall include | | | | in the SDP answer | | | | the dtx parameter | | | | with a value 0. | | | | | | | | If the MGCF supplies | | | | the dtx parameter in | | | | the SDP answer, it | | | | shall also supply it | | | | to the IM-MGW in the | | | | local descriptor for | | | | the termination | | | | towards the offerer | | | | with the same value. | +----------------------+----------------------+----------------------+ | dtx-recv (NOTE 1) | If a dtx-recv | If no dtx parameter | | | parameter is | is included in the | | | contained in the SDP | SDP answer and if | | | offer and the MGCF | the reception of DTX | | | select the EVS | is not desired, the | | | payload type, the | MGCF shall include | | | MGCF shall forward | in the SDP answer | | | this parameter to | the dtx-recv | | | the IM-MGW for the | parameter with a | | | termination towards | value 0. | | | the offerer in the | | | | remote descriptor. | If both the dtx and | | | | dtx-recv parameters | | | | are included, those | | | | parameters shall | | | | have the same value; | | | | however, inclusion | | | | of the dtx-recv | | | | parameter is not | | | | required if the dtx | | | | parameter is | | | | included. | | | | | | | | If the MGCF supplies | | | | the dtx-recv | | | | parameter in the SDP | | | | answer, it should | | | | also supply it to | | | | the IM-MGW in the | | | | local descriptor for | | | | the termination | | | | towards the offerer | | | | with the same value. | +----------------------+----------------------+----------------------+ | **br** (NOTE 1) | If a br parameter is | If a br parameter is | | | contained in the SDP | contained in the SDP | | | offer, the MGCF | offer, the MGCF | | | shall check if the | shall select a bit | | | IM-MGW supports the | rate value, which is | | | indicated bit rates, | either the received | | | or a subset of them, | br value or a subset | | | in EVS primary mode | of it, based on | | | in the send and | IM-MGW capabilities | | | receive direction. | and possible | | | If the indicated bit | configured policies, | | | rates, and even each | and shall include | | | subset of them, are | the br parameter | | | not supported, the | with the selected | | | MGCF shall not | value that is also | | | select the EVS | supplied towards the | | | payload type. If the | IM-MGW in the SDP | | | MGCF selects the EVS | answer. | | | payload type, it | | | | shall forward this | Otherwise, if the | | | parameter to the | MGCF desires the | | | IM-MGW for the | same bit rate range | | | termination towards | for the send and | | | the offerer in the | receive direction in | | | remote descriptor. | EVS primary mode, | | | | and wants to | | | | restrict the bit | | | | rate range to match | | | | IM-MGW capabilities | | | | and possible | | | | configured policies, | | | | the MGCF shall | | | | supply the br | | | | parameter in the SDP | | | | answer it sends. | | | | | | | | Otherwise the MGCF | | | | shall not include | | | | this parameter in | | | | the SDP answer. | | | | | | | | If the MGCF also | | | | supplies the bw, | | | | bw-send or bw-recv | | | | parameter, the value | | | | of the br parameter | | | | shall be compatible | | | | with the values of | | | | those parameters. | | | | | | | | If the MGCF supplies | | | | the br parameter in | | | | the SDP answer, it | | | | shall also supply to | | | | the IM-MGW the br | | | | parameter in the | | | | local descriptor for | | | | the termination | | | | towards the offerer | | | | with the same value. | +----------------------+----------------------+----------------------+ | br-send (NOTE 1) | If a br-send | If a br-recv | | | parameter is | parameter is | | | contained in the SDP | contained in the SDP | | | offer, the MGCF | offer, the MGCF | | | shall check if the | shall select a bit | | | IM-MGW supports the | rate value, which is | | | indicated bit rates, | either the received | | | or a subset of them, | br-recv value or a | | | in EVS primary mode | subset of it, based | | | in the receive | on IM-MGW | | | direction. If the | capabilities and | | | indicated bit rates, | possible configured | | | and even each subset | policies, and the | | | of them, are not | MGCF shall include | | | supported, the MGCF | the br-send | | | shall not select the | parameter with the | | | EVS payload type. If | selected value that | | | the MGCF selects the | is also supplied | | | EVS payload type, it | towards the IM-MGW | | | shall forward this | in the SDP answer. | | | parameter to the | | | | IM-MGW for the | Otherwise, if the | | | termination towards | MGCF desires a | | | the offerer in the | different bit rate | | | remote descriptor. | (range) for the send | | | | and receive | | | | direction in EVS | | | | primary mode, and | | | | wants to restrict | | | | the bit rate range | | | | for the send | | | | direction to match | | | | IM-MGW capabilities | | | | and possible | | | | configured policies, | | | | it shall supply the | | | | br-send parameter in | | | | the SDP answer it | | | | sends. | | | | | | | | Otherwise the MGCF | | | | shall not include | | | | the br-send | | | | parameter in the SDP | | | | answer. | | | | | | | | If the MGCF also | | | | supplies the bw or | | | | bw-send parameter, | | | | the value of the | | | | br-send parameter | | | | shall be compatible | | | | with the values of | | | | those parameters. | | | | | | | | If the MGCF supplies | | | | the br-send | | | | parameter in the SDP | | | | answer, it shall | | | | also supply to the | | | | IM-MGW the br-send | | | | parameter in the | | | | local descriptor for | | | | the termination | | | | towards the offerer | | | | with the same value. | +----------------------+----------------------+----------------------+ | br-recv (NOTE 1) | If a br-recv | If a br-send | | | parameter is | parameter is | | | contained in the SDP | contained in the SDP | | | offer, the MGCF | offer, the MGCF | | | shall check if the | shall select a bit | | | IM-MGW supports the | rate value, which is | | | indicated bit rates, | either the received | | | or a subset of them, | br-send value or a | | | in EVS primary mode | subset of it, based | | | in the send | on IM-MGW | | | direction. If the | capabilities and | | | indicated bit rates, | possible configured | | | and even each subset | policies, and the | | | of them, are not | MGCF shall include | | | supported, the MGCF | the br-recv | | | shall not select the | parameter with the | | | EVS payload type. If | selected value that | | | the MGCF selects the | is also supplied | | | EVS payload type, it | towards the IM-MGW | | | shall forward this | in the SDP answer. | | | parameter to the | | | | IM-MGW for the | Otherwise, if the | | | termination towards | MGCF desires a | | | the offerer in the | different bit rate | | | remote descriptor. | (range) for the send | | | | and receive | | | | direction in EVS | | | | primary mode, and | | | | wants to restrict | | | | the bit rate range | | | | for the receive | | | | direction to match | | | | IM-MGW capabilities | | | | and possible | | | | configured policies, | | | | it shall supply the | | | | br-recv parameter in | | | | the SDP answer it | | | | sends. | | | | | | | | Otherwise the MGCF | | | | shall not include | | | | the br-recv | | | | parameter in the | | | | answer. | | | | | | | | If the MGCF also | | | | supplies the bw or | | | | bw-recv parameter, | | | | the value of the | | | | br-recv parameter | | | | shall be compatible | | | | with the values of | | | | those parameters. | | | | | | | | If the MGCF supplies | | | | the br-recv | | | | parameter in the SDP | | | | answer, it shall | | | | also supply to the | | | | IM-MGW the br-recv | | | | parameter in the | | | | local descriptor for | | | | the termination | | | | towards the offerer | | | | with the same value. | +----------------------+----------------------+----------------------+ | bw (NOTE 1) | If a bw parameter is | If a bw parameter is | | | contained in the SDP | contained in the SDP | | | offer, the MGCF | offer, the MGCF | | | shall check if the | shall select a | | | IM-MGW supports the | sampling bandwidth | | | indicated sampling | value, which is | | | bandwidth(s), or a | either the received | | | subset of them, in | bw value or a subset | | | EVS primary mode in | of it, based on | | | the send and receive | IM-MGW capabilities, | | | direction. If the | possible configured | | | indicated sampling | policies, and the bw | | | bandwidth(s), and | range of other | | | even each subset of | codecs to transcode | | | them, are not | with, and the MGCF | | | supported, the MGCF | shall include the bw | | | shall not select the | parameter with the | | | EVS payload type. If | selected value that | | | the MGCF selects the | is also supplied | | | EVS payload type, it | towards the IM-MGW | | | shall forward this | in the SDP answer. | | | parameter to the | | | | IM-MGW for the | Otherwise, if the | | | termination towards | MGCF desires the | | | the offerer in the | same sampling | | | remote descriptor. | bandwidth(s) for the | | | | send and receive | | | | direction in EVS | | | | primary mode, and | | | | wants to restrict | | | | the sampling | | | | bandwidth(s) to | | | | match IM-MGW | | | | capabilities, | | | | possible configured | | | | policies, and the bw | | | | range of other | | | | codecs to transcode | | | | with, the MGCF shall | | | | supply the bw | | | | parameter in the SDP | | | | answer it sends. | | | | | | | | Otherwise the MGCF | | | | shall not include | | | | this parameter in | | | | the answer. | | | | | | | | If the MGCF also | | | | supplies the br, | | | | br-send or br-recv | | | | parameter, the value | | | | of the bw parameter | | | | shall be compatible | | | | with the values of | | | | those parameters. | | | | | | | | If the MGCF supplies | | | | the bw parameter in | | | | the SDP answer, it | | | | shall also supply to | | | | the IM-MGW the bw | | | | parameter in the | | | | local descriptor for | | | | the termination | | | | towards the offerer | | | | with the same value. | +----------------------+----------------------+----------------------+ | bw-send (NOTE 1) | If a bw-send | If a bw-recv | | | parameter is | parameter is | | | contained in the SDP | contained in the SDP | | | offer, the MGCF | offer, the MGCF | | | shall check if the | shall select a | | | IM-MGW supports the | sampling bandwidths | | | indicated sampling | value, which is | | | bandwidths, or a | either the received | | | subset of them, in | bw-recv value or a | | | EVS primary mode in | subset of it, based | | | the receive | on IM-MGW | | | direction. If the | capabilities, | | | indicated sampling | possible configured | | | bandwidths, and even | policies, and the bw | | | each subset of them, | range of other | | | are not supported, | codecs to transcode | | | the MGCF shall not | with, and the MGCF | | | select the EVS | shall include the | | | payload type. If the | bw-send parameter | | | MGCF selects the EVS | with the selected | | | payload type, it | value in the SDP | | | shall forward this | answer. | | | parameter to the | | | | IM-MGW for the | Otherwise, if the | | | termination towards | MGCF desires a | | | the offerer in the | different sampling | | | remote descriptor. | bandwidths for the | | | | send and receive | | | | direction in EVS | | | | primary mode, and | | | | wants to restrict | | | | the sampling | | | | bandwidths for the | | | | send direction to | | | | match IM-MGW | | | | capabilities, | | | | possible configured | | | | policies, and the bw | | | | range of other | | | | codecs to transcode | | | | with, the MGCF shall | | | | supply the bw-send | | | | parameter in the SDP | | | | answer it sends. | | | | | | | | Otherwise the MGCF | | | | shall not include | | | | the br-send | | | | parameter in the SDP | | | | answer. | | | | | | | | If the MGCF also | | | | supplies the bw or | | | | bw-send parameter, | | | | the value of the | | | | br-send parameter | | | | shall be compatible | | | | with the values of | | | | those parameters. | | | | | | | | If the MGCF supplies | | | | the bw-send | | | | parameter in the SDP | | | | answer, it shall | | | | also supply to the | | | | IM-MGW the bw-send | | | | parameter in the | | | | local descriptor for | | | | the termination | | | | towards the offerer | | | | with the same value. | +----------------------+----------------------+----------------------+ | bw-recv (NOTE 1) | If a br-recv | If a bw-send | | | parameter is | parameter is | | | contained in the SDP | contained in the SDP | | | offer, the MGCF | offer, the MGCF | | | shall check if the | shall select a | | | IM-MGW supports the | sampling bandwidths | | | indicated sampling | value, which is | | | bandwidths, or a | either the received | | | subset of them, in | bw-send value or a | | | EVS primary mode in | subset of it, based | | | the send direction. | on IM-MGW | | | If the indicated | capabilities, | | | sampling bandwidths, | possible configured | | | and even each subset | policies, and the bw | | | of them, are not | range of other | | | supported, the MGCF | codecs to transcode | | | shall not select the | with, and the MGCF | | | EVS payload type. If | shall include the | | | the MGCF selects the | bw-recv parameter | | | EVS payload type, it | with the selected | | | shall forward the | value in the SDP | | | bw-recv parameter to | answer. | | | the IM-MGW for the | | | | termination towards | Otherwise, if the | | | the offerer in the | MGCF desires a | | | remote descriptor. | different sampling | | | | bandwidths for the | | | | send and receive | | | | direction in EVS | | | | primary mode, and | | | | wants to restrict | | | | the sampling | | | | bandwidths for the | | | | receive direction to | | | | match IM-MGW | | | | capabilities, | | | | possible configured | | | | policies, and the bw | | | | range of other | | | | codecs to transcode | | | | with, the MGCF shall | | | | supply the bw-recv | | | | parameter in the SDP | | | | answer it sends. | | | | | | | | Otherwise the MGCF | | | | shall not include | | | | the bw-recv | | | | parameter in the SDP | | | | answer. | | | | | | | | If the MGCF also | | | | supplies the br or | | | | br-recv parameter, | | | | the value of the | | | | bw-recv parameter | | | | shall be compatible | | | | with the values of | | | | those parameters. | | | | | | | | If the MGCF supplies | | | | the bw-send | | | | parameter in the SDP | | | | answer, it shall | | | | also supply it to | | | | the IM-MGW in the | | | | local descriptor for | | | | the termination | | | | towards the offerer | | | | with the same value. | +----------------------+----------------------+----------------------+ | cmr (NOTE 1) | If a cmr parameter | If a cmr parameter | | | is contained in the | is contained in the | | | SDP offer and the | SDP offer, the MGCF | | | MGCF select the EVS | shall include the | | | payload type, the | cmr parameter with | | | MGCF shall forward | unmodified value in | | | this parameter to | the SDP answer. | | | the IM-MGW for the | | | | termination towards | Otherwise, if the | | | the offerer in the | IM-MGW desires to | | | remote descriptor. | disable codec mode | | | | requests within the | | | | RTP payload of the | | | | EVS primary mode | | | | (due to the IM-MGW | | | | capabilities and | | | | possible configured | | | | policies), it shall | | | | include the cmr | | | | parameter with value | | | | -1 in the SDP answer | | | | it sends | | | | | | | | If the MGCF supplies | | | | the cmr parameter in | | | | the SDP answer, it | | | | shall also supply it | | | | to the IM-MGW in the | | | | local descriptor for | | | | the termination | | | | towards the offerer | | | | with the same value. | +----------------------+----------------------+----------------------+ | ch-aw-recv (NOTE 1) | If a ch-aw-recv | If the MGCF it | | | parameter is | desires to control | | | contained in the SDP | the channel-aware | | | offer the MGCF shall | mode of EVS in the | | | check if the IM-MGW | receive direction, | | | supports the | e.g. to disable it | | | indicated mode in | with value -1, it | | | the send direction. | shall include the | | | If the indicated | ch-aw-recv parameter | | | mode is not | in the SDP offer and | | | supported, the MGCF | shall also supply | | | shall not select the | the ch-aw-recv | | | EVS payload type. If | parameter to the | | | the MGCF selects the | IM-MGW in the local | | | EVS payload type, | descriptor for the | | | the MGCF shall | termination towards | | | forward this | the offerer with the | | | parameter to the | same value. The MGCF | | | IM-MGW for the | shall consider the | | | termination towards | capabilities of the | | | the offerer in the | IM-MGW when it | | | remote descriptor. | chooses an | | | | appropriate value. | +----------------------+----------------------+----------------------+ | number of channels | If a \"number of | If a \"number of | | (NOTE 2) | channels\" parameter | channels\" parameter | | | is contained in the | is contained in the | | | SDP offer the MGCF | SDP offer, the MGCF | | | shall check if the | shall include the | | | IM-MGW supports the | \"number of | | | indicated number of | channels\" parameter | | | channels. If the | with unmodified | | | indicated number of | value in the SDP | | | channels is not | answer and shall | | | supported, the MGCF | also supply it to | | | shall not select the | the IM-MGW in the | | | EVS payload type. If | local descriptor for | | | the MGCF selects the | the termination | | | EVS payload type, | towards the offerer | | | the MGCF shall | with the same value. | | | forward this | | | | parameter to the | | | | IM-MGW for the | | | | termination towards | | | | the offerer in the | | | | remote descriptor. | | +----------------------+----------------------+----------------------+ | ch-send (NOTE 1) | If a ch-send | If a ch-recv | | | parameter is | parameter is | | | contained in the SDP | contained in the SDP | | | offer the MGCF shall | offer, the MGCF | | | check if the IM-MGW | shall include the | | | supports the | ch-send parameter | | | indicated number of | with unmodified | | | channels in the | value in the SDP | | | receive direction. | answer and shall | | | If the indicated | also supply the | | | number of channels | ch-send parameter to | | | is not supported, | the IM-MGW in the | | | the MGCF shall not | local descriptor for | | | select the EVS | the termination | | | payload type. If the | towards the offerer | | | MGCF selects the EVS | with the same value. | | | payload type, the | | | | MGCF shall forward | | | | the ch-send | | | | parameter to the | | | | IM-MGW for the | | | | termination towards | | | | the offerer in the | | | | remote descriptor. | | +----------------------+----------------------+----------------------+ | ch-recv (NOTE 1) | If a ch-recv | If a ch-send | | | parameter is | parameter is | | | contained in the SDP | contained in the SDP | | | offer the MGCF shall | offer, the MGCF | | | check if the IM-MGW | shall include the | | | supports the | ch-recv parameter | | | indicated number of | with unmodified | | | channels in the send | value in the SDP | | | direction. If the | answer and shall | | | indicated number of | also supply the | | | channels is not | ch-recv parameter to | | | supported, the MGCF | the IM-MGW in the | | | shall not select the | local descriptor for | | | EVS payload type. If | the termination | | | the MGCF selects the | towards the offerer | | | EVS payload type for | with the same value. | | | transcoding, the | | | | MGCF shall forward | | | | the ch-recv | | | | parameter to the | | | | IM-MGW for the | | | | termination towards | | | | the offerer in the | | | | remote descriptor. | | +----------------------+----------------------+----------------------+ | mode-set (NOTE 3) | If a mode-set | If a mode-set | | | parameter is | parameter is | | | contained in the SDP | contained in the SDP | | | offer and the MGCF | offer, the MGCF | | | select the EVS | shall include the | | | payload type, the | mode-set parameter | | | MGCF shall forward | with unmodified | | | this parameter to | value in the SDP | | | the IM-MGW for the | answer. | | | termination towards | | | | the offerer in the | Otherwise, if AMR-WB | | | remote descriptor. | is used to interwork | | | | with, the MGCF | | | | should include the | | | | mode-set parameter | | | | with a value | | | | indicating the mode | | | | that was negotiated | | | | for AMR-WB (or omit | | | | it if no | | | | restrictions applied | | | | before). | | | | | | | | If the MGCF supplies | | | | the mode-set | | | | parameter in the SDP | | | | answer, it shall | | | | also supply it to | | | | the IM-MGW in the | | | | local descriptor for | | | | the termination | | | | towards the offerer | | | | with the same value. | +----------------------+----------------------+----------------------+ | mode-change-period | If a | If AMR-WB is used to | | (NOTE 3) | mode-change-period | interwork with, the | | | parameter is | MGCF should include | | | contained in the SDP | the | | | offer and the MGCF | mode-change-period | | | select the EVS | parameter with a | | | payload type, the | value indicating the | | | MGCF shall forward | mode that was | | | this parameter to | negotiated for | | | the IM-MGW for the | AMR-WB (or omit it | | | termination towards | if no restrictions | | | the offerer in the | applied before) in | | | remote descriptor. | the SDP answer. | | | | | | | | If the MGCF supplies | | | | the | | | | mode-change-period | | | | parameter in the SDP | | | | answer, it shall | | | | also supply it to | | | | the IM-MGW in the | | | | local descriptor for | | | | the termination | | | | towards the offerer | | | | with the same value. | +----------------------+----------------------+----------------------+ | mo | If a | If the MGCF selects | | de-change-capability | mo | the EVS payload | | (NOTE 3) | de-change-capability | type, the MGCF shall | | | (Note 4) parameter | include the | | | is contained in the | mo | | | SDP offer and the | de-change-capability | | | MGCF select the EVS | parameter with value | | | payload type, the | 2 or omit it in the | | | MGCF may forward | SDP answer. | | | this parameter to | | | | the IM-MGW for the | If the MGCF supplies | | | termination towards | the | | | the offerer in the | mo | | | remote descriptor. | de-change-capability | | | | parameter in the SDP | | | | answer, it may also | | | | supply it to the | | | | IM-MGW in the local | | | | descriptor for the | | | | termination towards | | | | the offerer with the | | | | same value. | +----------------------+----------------------+----------------------+ | mode-change-neighbor | If a | If AMR-WB is used to | | (NOTE 3) | mode-change-neighbor | interwork with, the | | | parameter is | MGCF should include | | | contained in the SDP | the | | | offer and the MGCF | mode-change-neighbor | | | select the EVS | parameter with a | | | payload type, the | value indicating the | | | MGCF shall forward | mode that was | | | this parameter to | negotiated for | | | the IM-MGW for the | AMR-WB (or omit it | | | termination towards | if no restrictions | | | the offerer in the | applied before) in | | | remote descriptor. | the SDP answer. | | | | | | | | If the MGCF supplies | | | | the | | | | mode-change-neighbor | | | | parameter in the SDP | | | | answer, it shall | | | | also supply it to | | | | the IM-MGW in the | | | | local descriptor for | | | | the termination | | | | towards the offerer | | | | with the same value. | +----------------------+----------------------+----------------------+ | max-red (NOTE 5) | If a max-red | The MGCF shall only | | | parameter is | include the max-red | | | contained in the SDP | parameter in the SDP | | | offer and the MGCF | answer if it desires | | | select the EVS | to restrict the | | | payload type, the | maximum redundancy | | | MGCF shall forward | of received packets. | | | this parameter to | When selecting the | | | the IM-MGW for the | value of the max-red | | | termination towards | parameter, the MGCF | | | the offerer in the | shall consider the | | | remote descriptor. | capabilities of the | | | | IM-MGW. | | | | | | | | If the MGCF supplies | | | | the max-red | | | | parameter in the SDP | | | | answer, it shall | | | | also supply it to | | | | the IM-MGW in the | | | | local descriptor for | | | | the termination | | | | towards the offerer | | | | with the same value. | +----------------------+----------------------+----------------------+ | 3g | If a | If the IM-MGW | | pp_mtsi_app_adapt | 3g | supports RTCP APP | | (NOTE 4) | pp_mtsi_app_adapt | based adaptation | | | SDP attribute is | messages defined in | | | contained in the SDP | TS 26.114 [104], | | | answer, and the MGCF | and the MGCF has a | | | select the EVS | policy to negotiate | | | payload type, the | the usage of those | | | MGCF shall forward | messages, the MGCF | | | this parameter to | shall include the | | | the IM-MGW the MGCF | 3g | | | shall forward this | pp_mtsi_app_adapt | | | parameter to the | SDP attribute | | | IM-MGW in the remote | indicating the | | | descriptor. | allowed APP messages | | | | in the SDP answer. | +----------------------+----------------------+----------------------+ | NOTE 1: This MIME | | | | parameter of the EVS | | | | RTP payload type is | | | | defined in | | | | TS 26.445 [147]. | | | | It is encapsulated | | | | within the SDP | | | | \"a=fmtp\" attribute | | | | defined | | | | I | | | | ETF RFC 4566 [56]. | | | | | | | | NOTE 2: This number | | | | of channels are | | | | encoded as | | | | \"encoding | | | | parameters\" of the | | | | SDP \"a=rtpmap\" | | | | attribute defined in | | | | I | | | | ETF RFC 4566 [56]. | | | | | | | | NOTE 3 This MIME | | | | parameter of the EVS | | | | RTP payload type | | | | relates to AMR-WB IO | | | | mode and is defined | | | | in | | | | I | | | | ETF RFC 4867 [23]. | | | | It is encapsulated | | | | within the SDP | | | | \"a=fmtp\" attribute | | | | defined | | | | I | | | | ETF RFC 4566 [56]. | | | | | | | | NOTE 4: This SDP | | | | attribute is defined | | | | in | | | | TS 26.114 [104]. | | | | It applies to all | | | | codecs offered in an | | | | SDP media line. | | | | However, some values | | | | are specific to EVS. | | | | | | | | NOTE 5: This MIME | | | | parameter of the EVS | | | | RTP payload type is | | | | defined in | | | | I | | | | ETF RFC 4867 [23]. | | | | It is encapsulated | | | | within the SDP | | | | \"a=fmtp\" attribute | | | | defined | | | | I | | | | ETF RFC 4566 [56]. | | | +----------------------+----------------------+----------------------+
IM-MGW handling of EVS codec parameters shall follow table 5.13.2.3 in 3GPP TS
23.334 [145]. The IM-MGW should support transcoding of EVS with bandwidths
(sampling rates) which are supported by codec the IM-MGW is capable to
transcode EVS to/from (e.g. NB for AMR, and WB for AMR-WB).
#### 9.2.13.3 Handling of EVS speech codec parameters when the EVS codec is
used end-to-end
The procedures in the present clause apply when the EVS speech codec is used
in both IMS and the CS domain.
The four allowed EVS codec configurations for the CS domain are specified in
3GPP TS 26.103 [57].
Table 9.2.13.3.1 describes the MGCF handling of EVS codec parameters when the
MGCF sends an SDP offer for an EVS payload type, which is supported in the CS
network, and that EVS payload type is selected in the SDP answer. In addition,
rules for the parameter handling in 3GPP TS 26.445 [147] shall apply.
Table 9.2.13.3.1: MGCF handling of EVS related SDP parameters when the MGCF
acts as SDP offerer
+----------------------+----------------------+----------------------+ | Parameter | Handling of EVS | Handling of EVS | | | codec parameter in | codec parameter in | | | the sent SDP offer | the received SDP | | | | answer | +----------------------+----------------------+----------------------+ | evs-mode-switch | The MGCF shall not | If an | | (NOTE 1) | include the | evs-mode-switch | | | evs-mode-switch | parameter is | | | parameter in the SDP | contained in the SDP | | | offer. | answer, the MGCF | | | | shall forward this | | | | parameter to the | | | | IM-MGW for the | | | | termination towards | | | | the answerer in the | | | | remote descriptor. | +----------------------+----------------------+----------------------+ | hf-only (NOTE 1) | If the MGCF is | If an hf-only | | | configured to | parameter is | | | negotiate using only | contained in the SDP | | | the header-full EVS | answer, the MGCF | | | RTP payload format, | shall forward this | | | the MGCF shall | parameter to the | | | include the hf-only | IM-MGW in the remote | | | parameter with a | descriptor. | | | value of 1 in the | | | | SDP offer. | | | | | | | | Using only the | | | | header-full EVS RTP | | | | payload format is | | | | recommended. | | +----------------------+----------------------+----------------------+ | dtx (NOTE 1) | The MGCF shall | If a dtx parameter | | | include the dtx | is contained in the | | | parameter in the SDP | SDP answer, the MGCF | | | offer and shall set | shall forward this | | | it to 1 i.e. DTX | parameter to the | | | enabled. | IM-MGW in the remote | | | | descriptor. | +----------------------+----------------------+----------------------+ | dtx-recv (NOTE 1) | The MGCF shall | If a dtx-recv | | | include the dtx-recv | parameter is | | | parameter in the SDP | contained in the SDP | | | offer and shall set | answer, the MGCF | | | it to 1 i.e. DTX | shall forward this | | | enabled. | parameter to the | | | | IM-MGW in the remote | | | | descriptor. | +----------------------+----------------------+----------------------+ | **br** (NOTE 1) | The MGCF shall | If a br parameter is | | | include the br | contained in the SDP | | | parameter in the SDP | answer, the MGCF | | | offer and shall set | shall forward this | | | it to a range | parameter to the | | | corresponding to the | IM-MGW in the remote | | | CS configuration | descriptor. | | | received in the | | | | Single Codec IE (see | | | | subclause B.2.5.5). | | +----------------------+----------------------+----------------------+ | br-send (NOTE 1) | The MGCF shall not | If a br-send | | | include the br-send | parameter is | | | parameter in the SDP | contained in the SDP | | | Offer. | answer, the MGCF | | | | shall forward this | | | | parameter to the | | | | IM-MGW in the remote | | | | descriptor. | +----------------------+----------------------+----------------------+ | br-recv (NOTE 1) | The MGCF shall not | If a br-recv | | | include the br-recv | parameter is | | | parameter in the SDP | contained in the SDP | | | Offer. | answer, the MGCF | | | | shall forward this | | | | parameter to the | | | | IM-MGW in the remote | | | | descriptor. | +----------------------+----------------------+----------------------+ | bw (NOTE 1) | The MGCF shall | If a bw parameter is | | | include the bw | contained in the SDP | | | parameter in the SDP | answer, the MGCF | | | offer and shall set | shall forward this | | | it to a range | parameter to the | | | corresponding to the | IM-MGW in the remote | | | CS configuration | descriptor. | | | received in the | | | | Single Codec IE (see | | | | subclause B.2.5.5). | | +----------------------+----------------------+----------------------+ | bw-send (NOTE 1) | The MGCF shall not | If a bw-send | | | include the bw-send | parameter is | | | parameter in the SDP | contained in the SDP | | | Offer. | answer, the MGCF | | | | shall forward this | | | | parameter to the | | | | IM-MGW in the remote | | | | descriptor. | +----------------------+----------------------+----------------------+ | bw-recv (NOTE 1) | The MGCF shall not | If a bw-recv | | | include the bw-recv | parameter is | | | parameter in the SDP | contained in the SDP | | | Offer. | answer, the MGCF | | | | shall forward this | | | | parameter to the | | | | IM-MGW in the remote | | | | descriptor. | +----------------------+----------------------+----------------------+ | cmr (NOTE 1) | If the MGCF desires | If a cmr parameter | | | to disable codec | is contained in the | | | mode requests on Mb | SDP answer, the MGCF | | | within the RTP | shall forward this | | | payload of the EVS | parameter to the | | | primary mode (due to | IM-MGW in the remote | | | the IM-MGW | descriptor. | | | capabilities or | | | | policies) and | | | | desires to use | | | | RTCP-APP instead for | | | | codec mode request, | | | | then it shall | | | | include the cmr | | | | parameter with a | | | | value of -1 in the | | | | SDP offer. | | | | | | | | Otherwise, the MGCF | | | | shall include the | | | | cmr parameter with a | | | | value of 1 in the | | | | SDP offer in order | | | | to request EVS-CMR | | | | in every RTP packet. | | | | | | | | The use of code mode | | | | requests on Mb | | | | within the RTP | | | | payload of the EVS | | | | primary mode is | | | | recommended. | | +----------------------+----------------------+----------------------+ | ch-aw-recv (NOTE 1) | The MGCF shall | If a ch-aw-recv | | | include the | parameter is | | | ch-aw-recv parameter | contained in the SDP | | | in the SDP offer and | answer, the MGCF | | | shall set it to an | shall forward this | | | allowed value for | parameter to the | | | the CS configuration | IM-MGW in the remote | | | received in the | descriptor. | | | Single Codec IE (see | | | | subclause B.2.5.5). | | +----------------------+----------------------+----------------------+ | number of channels | The MGCF shall | If a \"number of | | (NOTE 2) | include the number | channels\" parameter | | | of channels | is contained in the | | | parameter with a | SDP answer, the MGCF | | | value of 1 in the | shall forward this | | | SDP offer. | parameter to the | | | | IM-MGW in the remote | | | | descriptor. | +----------------------+----------------------+----------------------+ | ch-send (NOTE 1) | The MGCF shall not | If a ch-send | | | include the ch-send | parameter is | | | parameter in the SDP | contained in the SDP | | | offer. | answer, the MGCF | | | | shall forward this | | | | parameter to the | | | | IM-MGW in the remote | | | | descriptor. | +----------------------+----------------------+----------------------+ | ch-recv (NOTE 1) | The MGC shall not | If a ch-recv | | | include the ch-recv | parameter is | | | parameter in the SDP | contained in the SDP | | | offer. | answer, the MGCF | | | | shall forward this | | | | parameter to the | | | | IM-MGW in the remote | | | | descriptor. | +----------------------+----------------------+----------------------+ | mode-set (NOTE 4) | The MGCF shall | If a mode-set | | | include the mode-set | parameter is | | | parameter in the SDP | contained in the SDP | | | offer and shall set | answer, the MGCF | | | it as per the | shall forward this | | | received Single | parameter to the | | | Codec IE (see | IM-MGW in the remote | | | subclause B.2.5.5). | descriptor. | +----------------------+----------------------+----------------------+ | mode-change-period | The MGCF shall | If a | | (NOTE 3) | include the | mode-change-period | | | mode-change-period | parameter is | | | parameter in the SDP | contained in the SDP | | | offer and shall set | answer, the MGCF | | | it to 2. | shall forward this | | | | parameter to the | | | | IM-MGW in the remote | | | | descriptor. | +----------------------+----------------------+----------------------+ | mo | The MGCF shall | If a | | de-change-capability | either include the | mo | | (NOTE 3) | mo | de-change-capability | | | de-change-capability | parameter is | | | parameter with a | contained in the SDP | | | value of 2 or omit | answer, the MGCF may | | | it in the SDP offer. | forward this | | | | parameter to the | | | | IM-MGW in the remote | | | | descriptor. | +----------------------+----------------------+----------------------+ | mode-change-neighbor | The MGCF shall | If a | | (NOTE 3) | include the | mode-change-neighbor | | | mode-change-neighbor | parameter is | | | parameter in the SDP | contained in the SDP | | | offer and shall set | answer, the MGCF | | | it to 1. | shall forward this | | | | parameter to the | | | | IM-MGW in the remote | | | | descriptor. | +----------------------+----------------------+----------------------+ | max-red (NOTE 5) | The MGCF shall not | If a max-red | | | include the max-red | parameter is | | | parameter in the SDP | contained in the SDP | | | offer. | answer, the MGCF | | | | shall forward this | | | | parameter to the | | | | IM-MGW in the remote | | | | descriptor. (NOTE 6) | +----------------------+----------------------+----------------------+ | 3g | If the IM-MGW | If a | | pp_mtsi_app_adapt | supports RTCP APP | 3g | | (NOTE 4) | based adaptation | pp_mtsi_app_adapt | | | messages defined in | attribute is | | | TS 26.114 [104], | contained in the SDP | | | and the MGCF has a | answer, the MGCF | | | policy to negotiate | shall forward this | | | the usage of those | parameter to the | | | messages, the MGCF | IM-MGW in the remote | | | shall include the | descriptor. | | | 3g | | | | pp_mtsi_app_adapt | | | | SDP attribute | | | | indicating the | | | | supported APP | | | | messages in the SDP | | | | offer. | | +----------------------+----------------------+----------------------+ | NOTE 1: This MIME | | | | parameter of the EVS | | | | RTP payload type is | | | | defined in | | | | TS 26.445 [147]. | | | | It is encapsulated | | | | within the SDP | | | | \"a=fmtp\" attribute | | | | defined | | | | I | | | | ETF RFC 4566 [56]. | | | | | | | | NOTE 2: This number | | | | of channels is | | | | encoded as | | | | \"encoding | | | | parameters\" of the | | | | SDP \"a=rtpmap\" | | | | attribute defined in | | | | I | | | | ETF RFC 4566 [56]. | | | | | | | | NOTE 3: This MIME | | | | parameter of the EVS | | | | RTP payload type | | | | relates to the EVS | | | | AMR-WB IO major | | | | operation mode and | | | | is defined in | | | | I | | | | ETF RFC 4867 [23]. | | | | It is encapsulated | | | | within the SDP | | | | \"a=fmtp\" attribute | | | | defined | | | | I | | | | ETF RFC 4566 [56]. | | | | | | | | NOTE 4: This SDP | | | | attribute is defined | | | | in | | | | TS 26.114 [104]. | | | | It applies to all | | | | codecs offered in an | | | | SDP media line. | | | | However, some values | | | | are specific to EVS. | | | | | | | | NOTE 5: This MIME | | | | parameter of the EVS | | | | RTP payload type is | | | | defined in | | | | I | | | | ETF RFC 4867 [23]. | | | | It is encapsulated | | | | within the SDP | | | | \"a=fmtp\" attribute | | | | defined | | | | I | | | | ETF RFC 4566 [56]. | | | | | | | | NOTE 6: RTP | | | | redundancy is only | | | | applicable on the Mb | | | | interface. In such a | | | | case, the IM-MGW | | | | performs repacking. | | | | Transcoding is not | | | | required. | | | +----------------------+----------------------+----------------------+
When receiving an SDP offer that contains an EVS codec payload type, the MGCF
shall handle the EVS codec parameters as described in table 9.2.13.3.2. In
addition, rules for the parameter handling in 3GPP TS 26.445 [147] shall
apply.
Table 9.2.13.3.2: MGCF handling of EVS codec SDP parameters when the MGCF acts
as SDP answerer
+----------------------+----------------------+----------------------+ | Parameter | Handling of EVS | Handling of EVS | | | codec parameter in | codec parameter in | | | the received SDP | the sent SDP answer | | | offer | | +----------------------+----------------------+----------------------+ | evs-mode-switch | If an | If an | | (NOTE 1) | evs-mode-switch | evs-mode-switch | | | parameter is | parameter is | | | contained in the SDP | contained in the SDP | | | offer and the MGCF | offer, the MGCF | | | select the EVS | shall include the | | | payload type, the | evs-mode-switch | | | MGCF shall forward | parameter with | | | this parameter to | unmodified value in | | | the IM-MGW for the | the SDP answer. | | | termination towards | | | | the offerer in the | Otherwise the MGCF | | | remote descriptor.\ | shall not include | | | (NOTE 6) | the evs-mode-switch | | | | parameter. | +----------------------+----------------------+----------------------+ | hf-only (NOTE 1) | If an hf-only | If an hf-only | | | parameter is | parameter is | | | contained in the SDP | contained in the SDP | | | offer, the MGCF | offer, the MGCF | | | shall forward this | shall include the | | | parameter to the | hf-only parameter | | | IM-MGW for the | with unmodified | | | termination towards | value in the SDP | | | the offerer in the | answer. | | | remote descriptor. | | | | | Otherwise, if the | | | | hf-only parameter is | | | | not contained in the | | | | SDP offer and if the | | | | MGCF is configured | | | | to negotiate using | | | | only the header-full | | | | EVS RTP payload | | | | format, then the | | | | MGCF shall include | | | | the hf-only | | | | parameter with a | | | | value of 1. | | | | | | | | If the MGCF supplies | | | | the hf-only | | | | parameter in the SDP | | | | answer, it shall | | | | also supply it to | | | | the IM-MGW in the | | | | local descriptor for | | | | the termination | | | | towards the offerer. | +----------------------+----------------------+----------------------+ | dtx (NOTE 1) | If a dtx parameter | If a dtx parameter | | | is contained in the | is not contained in | | | SDP offer and the | the SDP offer and a | | | MGCF select the EVS | dtx-recv parameter | | | payload type, the | is not contained in | | | MGCF shall forward | the SDP offer, the | | | this parameter to | MGCF shall include | | | the IM-MGW for the | the dtx parameter | | | termination towards | with a value of 1 in | | | the offerer in the | the SDP answer. | | | remote descriptor. | | | | | If a dtx parameter | | | | is not contained in | | | | the SDP offer and a | | | | dtx-recv parameter | | | | is contained in the | | | | SDP offer with a | | | | value of 1, the MGCF | | | | shall include the | | | | dtx parameter in the | | | | SDP answer with a | | | | value identical to | | | | that of the dtx-recv | | | | parameter in the SDP | | | | offer. | | | | | | | | If a dtx parameter | | | | is contained in the | | | | SDP offer, the MGCF | | | | shall include the | | | | dtx parameter with | | | | unmodified value in | | | | the SDP answer. | | | | | | | | The MGCF shall also | | | | supply the dtx | | | | parameter to the | | | | IM-MGW in the local | | | | descriptor for the | | | | termination towards | | | | the offerer with the | | | | same value. | +----------------------+----------------------+----------------------+ | dtx-recv (NOTE 1) | If a dtx-recv | If no dtx parameter | | | parameter is | is included in the | | | contained in the SDP | SDP answer, the MGCF | | | offer and the MGCF | may include the | | | select the EVS | dtx-recv parameter | | | payload type, the | with a value of 1 in | | | MGCF shall forward | the SDP answer. | | | this parameter to | | | | the IM-MGW for the | The MGCF should also | | | termination towards | supply the dtx-recv | | | the offerer in the | parameter to the | | | remote descriptor. | IM-MGW in the local | | | | descriptor for the | | | | termination towards | | | | the offerer with the | | | | same value. | +----------------------+----------------------+----------------------+ | **br** (NOTE 1) | If a br parameter is | If a br parameter is | | | contained in the SDP | contained in the SDP | | | offer, the MGCF | offer, the MGCF | | | shall check if the | shall select a bit | | | IM-MGW supports the | rate value, which is | | | indicated bit rates, | either the received | | | or a subset of them, | br value or a subset | | | in EVS primary mode | of it, based on | | | in the send and | IM-MGW capabilities, | | | receive direction. | possible configured | | | If the indicated bit | policies and the CS | | | rates, and even each | configuration | | | subset of them, are | received Single | | | not supported, the | Codec IE (see | | | MGCF shall not | subclause B.2.5.5), | | | select the EVS | and shall include | | | payload type. If the | the br parameter | | | MGCF selects the EVS | with the selected | | | payload type, it | value that is also | | | shall forward this | supplied towards the | | | parameter to the | IM-MGW in the SDP | | | IM-MGW for the | answer. | | | termination towards | | | | the offerer in the | Otherwise, the MGCF | | | remote descriptor. | shall include the br | | | | parameter in the SDP | | | | answer and shall set | | | | it to a range | | | | corresponding to the | | | | CS configuration | | | | received in the | | | | Single Codec IE (see | | | | subclause B.2.5.5). | | | | | | | | If the MGCF also | | | | supplies the bw, | | | | bw-send or bw-recv | | | | parameter, the value | | | | of the br parameter | | | | shall be compatible | | | | with the values of | | | | those parameters. | | | | | | | | The MGCF shall also | | | | supply the br | | | | parameter to the | | | | IM-MGW in the local | | | | descriptor for the | | | | termination towards | | | | the offerer with the | | | | same value. | +----------------------+----------------------+----------------------+ | br-send (NOTE 1) | If a br-send | If a br-recv | | | parameter is | parameter is | | | contained in the SDP | contained in the SDP | | | offer, the MGCF | offer, the MGCF | | | shall check if the | shall select a bit | | | IM-MGW supports the | rate value, which is | | | indicated bit rates, | either the received | | | or a subset of them, | br-recv value or a | | | in EVS primary mode | subset of it, based | | | in the receive | on IM-MGW | | | direction. If the | capabilities, | | | indicated bit rates, | possible configured | | | and even each subset | policies and the br | | | of them, are not | parameter value | | | supported, the MGCF | included in the SDP | | | shall not select the | answer, and the MGCF | | | EVS payload type. If | shall include the | | | the MGCF selects the | br-send parameter | | | EVS payload type, it | with the selected | | | shall forward this | value that is also | | | parameter to the | supplied towards the | | | IM-MGW for the | IM-MGW in the SDP | | | termination towards | answer. | | | the offerer in the | | | | remote descriptor. | Otherwise the MGCF | | | | shall not include | | | | the br-send | | | | parameter in the SDP | | | | answer. | | | | | | | | If the MGCF also | | | | supplies the bw or | | | | bw-send parameter, | | | | the value of the | | | | br-send parameter | | | | shall be compatible | | | | with the values of | | | | those parameters. | +----------------------+----------------------+----------------------+ | br-recv (NOTE 1) | If a br-recv | If a br-send | | | parameter is | parameter is | | | contained in the SDP | contained in the SDP | | | offer, the MGCF | offer, the MGCF | | | shall check if the | shall select a bit | | | IM-MGW supports the | rate value, which is | | | indicated bit rates, | either the received | | | or a subset of them, | br-send value or a | | | in EVS primary mode | subset of it, based | | | in the send | on IM-MGW | | | direction. If the | capabilities, | | | indicated bit rates, | possible configured | | | and even each subset | policies and the br | | | of them, are not | parameter value | | | supported, the MGCF | included in the SDP | | | shall not select the | answer, and the MGCF | | | EVS payload type. If | shall include the | | | the MGCF selects the | br-recv parameter | | | EVS payload type, it | with the selected | | | shall forward this | value that is also | | | parameter to the | supplied towards the | | | IM-MGW for the | IM-MGW in the SDP | | | termination towards | answer. | | | the offerer in the | | | | remote descriptor. | Otherwise the MGCF | | | | shall not include | | | | the br-recv | | | | parameter in the | | | | answer. | | | | | | | | If the MGCF also | | | | supplies the bw or | | | | bw-recv parameter, | | | | the value of the | | | | br-recv parameter | | | | shall be compatible | | | | with the values of | | | | those parameters. | | | | | | | | If the MGCF supplies | | | | the br-recv | | | | parameter in the SDP | | | | answer, it shall | | | | also supply to the | | | | IM-MGW the br-recv | | | | parameter in the | | | | local descriptor for | | | | the termination | | | | towards the offerer | | | | with the same value. | +----------------------+----------------------+----------------------+ | bw (NOTE 1) | If a bw parameter is | If a bw parameter is | | | contained in the SDP | contained in the SDP | | | offer, the MGCF | offer, the MGCF | | | shall check if the | shall select a | | | IM-MGW supports the | sampling bandwidth | | | indicated sampling | value, which is | | | bandwidth(s), or a | either the received | | | subset of them, in | bw value or a subset | | | EVS primary mode in | of it, based on | | | the send and receive | IM-MGW capabilities, | | | direction. If the | possible configured | | | indicated sampling | policies and the CS | | | bandwidth(s), and | configuration | | | even each subset of | received in the | | | them, are not | Single Codec IE (see | | | supported, the MGCF | subclause B.2.5.5), | | | shall not select the | and the MGCF shall | | | EVS payload type. If | include the bw | | | the MGCF selects the | parameter with the | | | EVS payload type, it | selected value that | | | shall forward this | is also supplied | | | parameter to the | towards the IM-MGW | | | IM-MGW for the | in the SDP answer. | | | termination towards | | | | the offerer in the | Otherwise the MGCF | | | remote descriptor. | shall include the bw | | | | parameter in the SDP | | | | answer and shall set | | | | it to a range | | | | corresponding to the | | | | CS configuration | | | | received in the | | | | Single Codec IE (see | | | | subclause B.2.5.5). | | | | | | | | If the MGCF also | | | | supplies the br, | | | | br-send or br-recv | | | | parameter, the value | | | | of the bw parameter | | | | shall be compatible | | | | with the values of | | | | those parameters. | | | | | | | | The MGCF shall also | | | | supply the bw | | | | parameter to the | | | | IM-MGW in the local | | | | descriptor for the | | | | termination towards | | | | the offerer with the | | | | same value. | +----------------------+----------------------+----------------------+ | bw-send (NOTE 1) | If a bw-send | If a bw-recv | | | parameter is | parameter is | | | contained in the SDP | contained in the SDP | | | offer, the MGCF | offer, the MGCF | | | shall check if the | shall select a | | | IM-MGW supports the | sampling bandwidths | | | indicated sampling | value, which is | | | bandwidths, or a | either the received | | | subset of them, in | bw-recv value or a | | | EVS primary mode in | subset of it, based | | | the receive | on IM-MGW | | | direction. If the | capabilities, | | | indicated sampling | possible configured | | | bandwidths, and even | policies and the bw | | | each subset of them, | parameter value | | | are not supported, | included in the SDP | | | the MGCF shall not | answer, and the MGCF | | | select the EVS | shall include the | | | payload type. If the | bw-send parameter | | | MGCF selects the EVS | with the selected | | | payload type, it | value in the SDP | | | shall forward this | answer. | | | parameter to the | | | | IM-MGW for the | Otherwise the MGCF | | | termination towards | shall not include | | | the offerer in the | the br-send | | | remote descriptor. | parameter in the SDP | | | | answer. | | | | | | | | If the MGCF also | | | | supplies the bw or | | | | bw-send parameter, | | | | the value of the | | | | br-send parameter | | | | shall be compatible | | | | with the values of | | | | those parameters. | | | | | | | | If the MGCF supplies | | | | the bw-send | | | | parameter in the SDP | | | | answer, it shall | | | | also supply to the | | | | IM-MGW the bw-send | | | | parameter in the | | | | local descriptor for | | | | the termination | | | | towards the offerer | | | | with the same value. | +----------------------+----------------------+----------------------+ | bw-recv (NOTE 1) | If a br-recv | If a bw-send | | | parameter is | parameter is | | | contained in the SDP | contained in the SDP | | | offer, the MGCF | offer, the MGCF | | | shall check if the | shall select a | | | IM-MGW supports the | sampling bandwidths | | | indicated sampling | value, which is | | | bandwidths, or a | either the received | | | subset of them, in | bw-send value or a | | | EVS primary mode in | subset of it, based | | | the send direction. | on IM-MGW | | | If the indicated | capabilities, | | | sampling bandwidths, | possible configured | | | and even each subset | policies and the bw | | | of them, are not | parameter value | | | supported, the MGCF | included in the SDP | | | shall not select the | answer, and the MGCF | | | EVS payload type. If | shall include the | | | the MGCF selects the | bw-recv parameter | | | EVS payload type, it | with the selected | | | shall forward the | value in the SDP | | | bw-recv parameter to | answer. | | | the IM-MGW for the | | | | termination towards | Otherwise the MGCF | | | the offerer in the | shall not include | | | remote descriptor. | the bw-recv | | | | parameter in the SDP | | | | answer. | | | | | | | | If the MGCF also | | | | supplies the br or | | | | br-recv parameter, | | | | the value of the | | | | bw-recv parameter | | | | shall be compatible | | | | with the values of | | | | those parameters. | | | | | | | | If the MGCF supplies | | | | the bw-send | | | | parameter in the SDP | | | | answer, it shall | | | | also supply it to | | | | the IM-MGW in the | | | | local descriptor for | | | | the termination | | | | towards the offerer | | | | with the same value. | +----------------------+----------------------+----------------------+ | cmr (NOTE 1) | If a cmr parameter | If a cmr parameter | | | is contained in the | is contained in the | | | SDP offer, the MGCF | SDP offer, the MGCF | | | shall forward this | shall include the | | | parameter to the | cmr parameter with | | | IM-MGW for the | unmodified value in | | | termination towards | the SDP answer. | | | the offerer in the | | | | remote descriptor. | Otherwise, if the | | | | IM-MGW desires to | | | | disable codec mode | | | | requests within the | | | | RTP payload of the | | | | EVS primary mode | | | | (due to the IM-MGW | | | | capabilities and | | | | possible configured | | | | policies), it shall | | | | include the cmr | | | | parameter with value | | | | -1 in the SDP | | | | answer. | | | | | | | | Otherwise the MGCF | | | | shall include the | | | | cmr parameter with a | | | | value of 1 in the | | | | SDP answer. | | | | | | | | The MGCF shall also | | | | supply the cmr | | | | parameter to the | | | | IM-MGW in the local | | | | descriptor for the | | | | termination towards | | | | the offerer. | +----------------------+----------------------+----------------------+ | ch-aw-recv (NOTE 1) | If a ch-aw-recv | If the MGCF desires | | | parameter is | to control the | | | contained in the SDP | channel-aware mode | | | offer the MGCF shall | of EVS in the | | | check if the CS side | receive direction, | | | supports the | e.g. to disable it | | | indicated mode. If | with value -1, it | | | the indicated mode | shall include the | | | is not supported, | ch-aw-recv parameter | | | the MGCF shall set | in the SDP offer and | | | this parameter to -1 | shall also supply | | | and forward it to | the ch-aw-recv | | | the IM-MGW for the | parameter to the | | | termination towards | IM-MGW in the local | | | the offerer in the | descriptor for the | | | remote descriptor. | termination towards | | | | the offerer with the | | | | same value. The MGCF | | | | shall consider the | | | | capabilities of the | | | | IM-MGW when it | | | | chooses an | | | | appropriate value. | +----------------------+----------------------+----------------------+ | number of channels | If a \"number of | The MGCF shall | | (NOTE 2) | channels\" parameter | include the \"number | | | is contained in the | of channels\" | | | SDP offer the MGCF | parameter with a | | | shall check if the | value of 1 in the | | | IM-MGW supports the | SDP answer and shall | | | indicated number of | also supply it to | | | channels. If the | the IM-MGW in the | | | indicated number of | local descriptor for | | | channels is not | the termination | | | supported, the MGCF | towards the offerer | | | shall not select the | with the same value. | | | EVS payload type. If | | | | the MGCF selects the | | | | EVS payload type, | | | | the MGCF shall | | | | forward this | | | | parameter to the | | | | IM-MGW for the | | | | termination towards | | | | the offerer in the | | | | remote descriptor. | | +----------------------+----------------------+----------------------+ | ch-send (NOTE 1) | If a ch-send | If a ch-recv | | | parameter is | parameter is | | | contained in the SDP | contained in the SDP | | | offer the MGCF shall | offer, the MGCF | | | check if the IM-MGW | shall include the | | | supports the | ch-send parameter | | | indicated number of | with a value of 1 in | | | channels in the | the SDP answer and | | | receive direction. | shall also supply | | | If the indicated | the ch-send | | | number of channels | parameter to the | | | is not supported, | IM-MGW in the local | | | the MGCF shall not | descriptor for the | | | select the EVS | termination towards | | | payload type. If the | the offerer with the | | | MGCF selects the EVS | same value. | | | payload type, the | | | | MGCF shall forward | | | | the ch-send | | | | parameter to the | | | | IM-MGW for the | | | | termination towards | | | | the offerer in the | | | | remote descriptor. | | +----------------------+----------------------+----------------------+ | ch-recv (NOTE 1) | If a ch-recv | If a ch-send | | | parameter is | parameter is | | | contained in the SDP | contained in the SDP | | | offer the MGCF shall | offer, the MGCF | | | check if the IM-MGW | shall include the | | | supports the | ch-recv parameter | | | indicated number of | with a value of 1 | | | channels in the send | value in the SDP | | | direction. If the | answer and shall | | | indicated number of | also supply the | | | channels is not | ch-recv parameter to | | | supported, the MGCF | the IM-MGW in the | | | shall not select the | local descriptor for | | | EVS payload type. If | the termination | | | the MGCF selects the | towards the offerer | | | EVS payload type, | with the same value. | | | the MGCF shall | | | | forward the ch-recv | | | | parameter to the | | | | IM-MGW for the | | | | termination towards | | | | the offerer in the | | | | remote descriptor. | | +----------------------+----------------------+----------------------+ | mode-set (NOTE 3) | If a mode-set | If a mode-set | | | parameter is | parameter is | | | contained in the SDP | contained in the SDP | | | offer and the | offer, the MGCF | | | mode-set parameter | shall include the | | | does not include | mode-set parameter | | | mode set 0, the MGCF | with a value which | | | shall not select the | is either the | | | EVS payload type. | received mode-set | | | | parameter value or a | | | Otherwise, if a | subset of it, based | | | mode-set parameter | on the CS | | | is contained in the | configuration | | | SDP offer, the | received in the | | | mode-set parameter | Single Codec IE (see | | | includes mode set 0 | subclause B.2.5.5), | | | and the MGCF select | in the SDP answer. | | | the EVS payload | | | | type, the MGCF shall | Otherwise, the MGCF | | | forward this | shall include the | | | parameter to the | mode-set parameter | | | IM-MGW for the | in the SDP answer | | | termination towards | and shall set it to | | | the offerer in the | the range | | | remote descriptor. | corresponding to the | | | | CS configuration | | | | received in the | | | | Single Codec IE (see | | | | subclause B.2.5.5). | | | | | | | | The MGCF shall also | | | | supply the mode-set | | | | parameter to the | | | | IM-MGW in the local | | | | descriptor for the | | | | termination towards | | | | the offerer. | +----------------------+----------------------+----------------------+ | mode-change-period | If a | The MGCF shall | | (NOTE 3) | mode-change-period | include the | | | parameter is | mode-change-period | | | contained in the SDP | parameter in the SDP | | | offer and the MGCF | answer and shall set | | | select the EVS | it as per the | | | payload type, the | received Single | | | MGCF shall forward | Codec IE (see | | | this parameter to | subclause B.2.5.5). | | | the IM-MGW for the | | | | termination towards | The MGCF shall also | | | the offerer in the | supply the | | | remote descriptor. | mode-change-period | | | | parameter to the | | | | IM-MGW in the local | | | | descriptor for the | | | | termination towards | | | | the offerer. | +----------------------+----------------------+----------------------+ | mo | If a | The MGCF shall | | de-change-capability | mo | either include the | | (NOTE 3) | de-change-capability | mo | | | (NOTE 4) parameter | de-change-capability | | | is contained in the | parameter with a | | | SDP offer and the | value of 2 or omit | | | MGCF select the EVS | it in the SDP | | | payload type, the | answer. | | | MGCF may forward | | | | this parameter to | The MGCF may also | | | the IM-MGW for the | supply the | | | termination towards | mo | | | the offerer in the | de-change-capability | | | remote descriptor. | parameter to the | | | | IM-MGW in the local | | | | descriptor for the | | | | termination towards | | | | the offerer. | +----------------------+----------------------+----------------------+ | mode-change-neighbor | If a | The MGCF shall | | (NOTE 3) | mode-change-neighbor | include the | | | parameter is | mode-change-neighbor | | | contained in the SDP | parameter in the SDP | | | offer and the MGCF | answer and shall set | | | select the EVS | it as per the | | | payload type, the | received Single | | | MGCF shall forward | Codec IE (see | | | this parameter to | subclause B.2.5.5). | | | the IM-MGW for the | | | | termination towards | The MGCF shall also | | | the offerer in the | supply the | | | remote descriptor. | mode-change-neighbor | | | | to the IM-MGW in the | | | | local descriptor for | | | | the termination | | | | towards the offerer. | +----------------------+----------------------+----------------------+ | max-red (NOTE 5) | If a max-red | The MGCF shall only | | | parameter is | include the max-red | | | contained in the SDP | parameter in the SDP | | | offer and the MGCF | answer if it desires | | | select the EVS | to restrict the | | | payload type, the | maximum redundancy | | | MGCF shall forward | of received packets. | | | this parameter to | When selecting the | | | the IM-MGW for the | value of the max-red | | | termination towards | parameter, the MGCF | | | the offerer in the | shall consider the | | | remote descriptor. | capabilities of the | | | | IM-MGW. | | | | | | | | If the MGCF supplies | | | | the max-red | | | | parameter in the SDP | | | | answer, it shall | | | | also supply it to | | | | the IM-MGW in the | | | | local descriptor for | | | | the termination | | | | towards the offerer | | | | with the same value. | +----------------------+----------------------+----------------------+ | 3g | If a | If the IM-MGW | | pp_mtsi_app_adapt | 3g | supports RTCP APP | | (NOTE 4) | pp_mtsi_app_adapt | based adaptation | | | SDP attribute is | messages defined in | | | contained in the SDP | TS 26.114 [104], | | | answer, the MGCF | and the MGCF has a | | | shall forward this | policy to negotiate | | | parameter to the | the usage of those | | | IM-MGW in the remote | messages, the MGCF | | | descriptor. | shall include the | | | | 3g | | | | pp_mtsi_app_adapt | | | | SDP attribute | | | | indicating the | | | | allowed APP messages | | | | in the SDP answer. | +----------------------+----------------------+----------------------+ | NOTE 1: This MIME | | | | parameter of the EVS | | | | RTP payload type is | | | | defined in | | | | TS 26.445 [147]. | | | | It is encapsulated | | | | within the SDP | | | | \"a=fmtp\" attribute | | | | defined | | | | I | | | | ETF RFC 4566 [56]. | | | | | | | | NOTE 2: This number | | | | of channels are | | | | encoded as | | | | \"encoding | | | | parameters\" of the | | | | SDP \"a=rtpmap\" | | | | attribute defined in | | | | I | | | | ETF RFC 4566 [56]. | | | | | | | | NOTE 3 This MIME | | | | parameter of the EVS | | | | RTP payload type | | | | relates to EVS | | | | AMR-WB IO major | | | | operation mode and | | | | is defined in | | | | I | | | | ETF RFC 4867 [23]. | | | | It is encapsulated | | | | within the SDP | | | | \"a=fmtp\" attribute | | | | defined | | | | I | | | | ETF RFC 4566 [56]. | | | | | | | | NOTE 4: This SDP | | | | attribute is defined | | | | in | | | | TS 26.114 [104]. | | | | It applies to all | | | | codecs offered in an | | | | SDP media line. | | | | However, some values | | | | are specific to EVS. | | | | | | | | NOTE 5: This MIME | | | | parameter of the EVS | | | | RTP payload type is | | | | defined in | | | | I | | | | ETF RFC 4867 [23]. | | | | It is encapsulated | | | | within the SDP | | | | \"a=fmtp\" attribute | | | | defined | | | | I | | | | ETF RFC 4566 [56]. | | | | | | | | NOTE 6: The received | | | | evs-mode-switch | | | | parameter has no | | | | influence on the | | | | Config-EVS-Code. | | | +----------------------+----------------------+----------------------+
### 9.2.14 SDP Capability Negotiation (SDPCapNeg)
The SDP Capability Negotiation (SDPCapNeg) as specified in IETF RFC 5939 [150]
is adopted as an optional functionality to negotiate capabilities and their
associated configurations according to 3GPP TS 24.229 [9].
The requirements and procedures as described in subclause 5.2.3 of 3GPP TS
23.333 [151] for MRFC and MRFP, apply to the MGCF and the IM-MGW when
SDPCapNeg is used.
### 9.2.15 Rate adaptation for media endpoints
The MGCF and the IM-MGW may support rate adaptation for media endpoints using
the enhanced bandwidth negotiation mechanism defined in 3GPP TS 26.114 [104].
The requirements and procedures as described in subclause 5.25 of 3GPP TS
23.333 [151] for the MRFC and the MRFP, apply to the MGCF and the IM-MGW if
the MGCF and the IM-MGW perform media transcoding.
## 9.3 Mn Signalling procedures
This clause describes of logical signalling procedures (i.e. message
identifiers are not part of the protocol) between the MGCF and IM-MGW. The
procedures within this clause are intended to be implemented using the
standard H.248 procedure as defined in] ITU recommendation H.248.1 [2] with
appropriate parameter combinations.
### 9.3.1 Procedures related to terminations towards the IM CN Subsystem
A mapping of the procedures defined here to H.248 procedures and parameters is
provided in 3GPP TS 29.332 [15].
#### 9.3.1.1 Reserve IMS connection point
This procedure is used to reserve local connection addresses and local
resources.
Table 25: Procedures toward the IM Subsystem: Reserve IMS connection point
* * *
Procedure Initiated Information element name Information element required
Information element description Reserve IMS Connection Point MGCF
Context/Context Request M This information element indicates the existing
context or requests a new context for the bearer termination. Priority
information O This information element requests the IM-MGW to apply priority
treatment for the terminations and bearer connections in the specified
context. IMS Termination Request M This information element requests a new IMS
termination for the bearer to be established. Local IMS Resources/ M This
information element indicates the resource(s) (i.e. codecs) for which the IM-
MGW shall be prepared to receive user data, IP Interface Type O This
information element indicates the used interface type ReserveValue O This
information element indicates if multiple local IMS resources are to be
reserved. Local Connection Addresses Request M This information element
requests an IP address and port number on the IM-MGW that the remote end can
send user plane data to. Notify termination heartbeat M This information
element requests termination heartbeat indications. Notify Released Bearer O
This information element requests a notification of a released bearer. IP
Realm Identifier O This information element indicates the IP realm of the IP
termination. ECN Enable O This information element requests the IM-MGW to
apply ECN procedures ECN Initiation Method C This information element
specifies the ECN Initiation method and requests the IM-MGW to perform IP
header settings as an ECN endpoint. It may be included only if ECN is enabled.
Notify ECN Failure Event C This information element requests a notification if
an ECN failure occurs. It may only be supplied if ECN is enabled. Diffserv
Code Point O This information element requests the IM-MGW to apply a specific
Diffserv Code Point to the IP headers. ICE password request O This information
element is present if MGCF requests an ICE password. ICE Ufrag request O This
information element is present if MGCF requests an ICE ufrag. ICE host
candidate request O This information element is present if MGCF requests an
ICE host candidate. ICE pacing request O This information element is present
if MGCF requests a pacing value for connectivity checks (Ta timer value). It
is only applicable for full ICE. STUN server request O This information
element is present if MGCF requests the IM-MGW to answer STUN connectivity
checks for ICE. SDPCapNeg configuration O This information element provides
SDPCapNeg configuration(s) using as \"a=acap\", \"a=tcap\", \"a=pcfg\" and
\"a=acfg\" SDP attributes. Reserve IMS Connection Point Ack IM-MGW Context M
This information element indicates the context where the command was executed.
IMS Termination M This information element indicates the IMS termination where
the command was executed. Local IMS Resources M This information element
indicates the resources that the IM-MGW has reserved to receive the user plane
data from the IMS. Local Connection Addresses M This information element
indicates the IP address and port on the IM-MGW that shall receive user plane
data from IMS. ICE password C This information element shall be present only
if it was contained in the request. It indicates the ICE password assigned by
the IM-MGW. ICE Ufrag C This information element shall be present only if it
was contained in the request. It indicates the ICE Ufrag assigned by the IM-
MGW. ICE host candidate C This information element shall be present only if it
was contained in the request. It indicates the ICE host candidate assigned by
the IM-MGW. ICE pacing C This information element shall be present only if it
was contained in the request. It indicates a desired pacing value for
connectivity checks (Ta timer value). ICE lite indication C This information
element shall be present only if an ICE host candidate request was contained
in the request, and the IM-MGW supports ICE lite, but not full ICE. It
indicates that the IM-MGW only supports ICE lite. SDPCapNeg configuration C
This information element shall be present only if it was contained in the
request. It provides SDPCapNeg configuration(s) using as \"a=acap\",
\"a=tcap\", \"a=pcfg\" and \"a=acfg\" SDP attributes.
* * *
#### 9.3.1.2 Configure IMS resources
This procedure is used to select multimedia-processing resources for an Mb
interface connection.
Table 26: Procedures toward the IM Subsystem: Select Local,\ Select Remote IMS
Processing Resource
+-------------+-----------+-------------+-------------+-------------+ | Procedure | Initiated | Information | Information | Information | | | | element | element | element | | | | name | required | description | +-------------+-----------+-------------+-------------+-------------+ | Configure | MGCF | Context | M | This | | IMS | | | | information | | Resources | | | | element | | | | | | indicates | | | | | | the | | | | | | existing | | | | | | context. | +-------------+-----------+-------------+-------------+-------------+ | | | IMS | M | This | | | | Termination | | information | | | | | | element | | | | | | indicates | | | | | | the | | | | | | existing | | | | | | bearer | | | | | | t | | | | | | ermination. | +-------------+-----------+-------------+-------------+-------------+ | | | Local IMS | O | This | | | | Resources | | information | | | | | | element | | | | | | indicates | | | | | | the | | | | | | resources | | | | | | (i.e. | | | | | | codec) that | | | | | | the IM-MGW | | | | | | may use on | | | | | | the | | | | | | reception | | | | | | of user | | | | | | plane data. | +-------------+-----------+-------------+-------------+-------------+ | | | Remote IMS | M | This | | | | Resources | | information | | | | | | element | | | | | | indicates | | | | | | the | | | | | | resources | | | | | | (i.e. | | | | | | codec) that | | | | | | the IM-MGW | | | | | | may send | | | | | | user plane | | | | | | data to. | +-------------+-----------+-------------+-------------+-------------+ | | | Local | O | This | | | | Connection | | information | | | | Addresses | | element | | | | | | indicates | | | | | | the IP | | | | | | address and | | | | | | port on the | | | | | | IM-MGW that | | | | | | the IMS | | | | | | user can | | | | | | send user | | | | | | plane data | | | | | | to. | +-------------+-----------+-------------+-------------+-------------+ | | | Remote | M | This | | | | Connection | | information | | | | Addresses | | element | | | | | | indicates | | | | | | the IP | | | | | | address and | | | | | | port that | | | | | | the IM-MGW | | | | | | can send | | | | | | user plane | | | | | | data to. | +-------------+-----------+-------------+-------------+-------------+ | | | IP | O | This | | | | Interface | | information | | | | Type | | element | | | | | | indicates | | | | | | the used | | | | | | interface | | | | | | type | +-------------+-----------+-------------+-------------+-------------+ | | | Reserve | O | This | | | | Value | | information | | | | | | element | | | | | | indicates | | | | | | if multiple | | | | | | IMS | | | | | | resources | | | | | | are to be | | | | | | reserved. | +-------------+-----------+-------------+-------------+-------------+ | | | Remote | O | This | | | | Connection | | information | | | | Addresses | | element | | | | Source | | indicates | | | | Filter | | an optional | | | | | | source | | | | | | filter | | | | | | restricting | | | | | | the IP | | | | | | addresses | | | | | | and ports | | | | | | that the | | | | | | IM-MGW | | | | | | shall | | | | | | accept as | | | | | | source for | | | | | | incoming | | | | | | user plane | | | | | | data. If | | | | | | this | | | | | | information | | | | | | element is | | | | | | set, the | | | | | | IM-MGW | | | | | | shall | | | | | | silently | | | | | | discard | | | | | | incoming | | | | | | user plane | | | | | | data from | | | | | | disallowed | | | | | | sources. | +-------------+-----------+-------------+-------------+-------------+ | | | ECN Enable | O | This | | | | | | information | | | | | | element | | | | | | requests | | | | | | the IM-MGW | | | | | | to apply | | | | | | ECN | | | | | | procedures. | +-------------+-----------+-------------+-------------+-------------+ | | | ECN | C | This | | | | Initiation | | information | | | | Method | | element | | | | | | specifies | | | | | | the ECN | | | | | | Initiation | | | | | | method and | | | | | | requests | | | | | | the IM-MGW | | | | | | to perform | | | | | | IP header | | | | | | settings as | | | | | | an ECN | | | | | | endpoint. | | | | | | It may be | | | | | | included | | | | | | only if ECN | | | | | | is enabled. | +-------------+-----------+-------------+-------------+-------------+ | | | Notify ECN | C | This | | | | Failure | | information | | | | Event | | element | | | | | | requests a | | | | | | n | | | | | | otification | | | | | | if an ECN | | | | | | failure | | | | | | occurs. It | | | | | | may only be | | | | | | supplied if | | | | | | ECN is | | | | | | enabled. | +-------------+-----------+-------------+-------------+-------------+ | | | ICE | C | This | | | | C | | information | | | | onnectivity | | element | | | | Check | | requests | | | | | | the IM-MGW | | | | | | to perform | | | | | | ICE | | | | | | c | | | | | | onnectivity | | | | | | check as | | | | | | defined by | | | | | | IETF RFC 84 | | | | | | 45 [156]. | | | | | | It is only | | | | | | applicable | | | | | | for full | | | | | | ICE. | +-------------+-----------+-------------+-------------+-------------+ | | | Notify ICE | C | This | | | | C | | information | | | | onnectivity | | element | | | | Check | | requests a | | | | Result | | n | | | | | | otification | | | | | | of ICE | | | | | | c | | | | | | onnectivity | | | | | | check | | | | | | result. It | | | | | | is only | | | | | | applicable | | | | | | for full | | | | | | ICE. | +-------------+-----------+-------------+-------------+-------------+ | | | Notify New | C | This | | | | Peer | | information | | | | Reflexive | | element | | | | Candidate | | requests a | | | | | | n | | | | | | otification | | | | | | of new peer | | | | | | reflexive | | | | | | candidate | | | | | | was | | | | | | discovered | | | | | | during a | | | | | | c | | | | | | onnectivity | | | | | | check. It | | | | | | is only | | | | | | applicable | | | | | | for full | | | | | | ICE. | +-------------+-----------+-------------+-------------+-------------+ | | | Additional | C | This | | | | ICE | | information | | | | C | | element | | | | onnectivity | | requests | | | | Check | | the IM-MGW | | | | | | to perform | | | | | | additional | | | | | | ICE | | | | | | c | | | | | | onnectivity | | | | | | check as | | | | | | defined by | | | | | | IETF RFC 84 | | | | | | 45 [156]. | | | | | | It is only | | | | | | applicable | | | | | | for full | | | | | | ICE. | +-------------+-----------+-------------+-------------+-------------+ | | | ICE | O | This | | | | received | | information | | | | candidate | | element is | | | | | | present if | | | | | | MGCF | | | | | | indicates a | | | | | | received | | | | | | candidate | | | | | | for ICE. | +-------------+-----------+-------------+-------------+-------------+ | | | ICE | O | This | | | | received | | information | | | | password | | element is | | | | | | present if | | | | | | MGCF | | | | | | indicates a | | | | | | received | | | | | | password | | | | | | for ICE. | +-------------+-----------+-------------+-------------+-------------+ | | | ICE | O | This | | | | received | | information | | | | pacing | | element is | | | | | | present if | | | | | | MGCF | | | | | | indicates a | | | | | | received | | | | | | pacing | | | | | | value for | | | | | | c | | | | | | onnectivity | | | | | | checks (Ta | | | | | | timer | | | | | | value). It | | | | | | is only | | | | | | applicable | | | | | | for full | | | | | | ICE. | +-------------+-----------+-------------+-------------+-------------+ | | | Allowed | O | This | | | | RTCP APP | | information | | | | message | | element is | | | | types | | present if | | | | | | the MGCF | | | | | | allows the | | | | | | IM-MGW to | | | | | | send RTCP | | | | | | APP packets | | | | | | of the | | | | | | indicated | | | | | | types. The | | | | | | IM-MGW | | | | | | shall not | | | | | | send other | | | | | | RTCP APP | | | | | | packets. If | | | | | | the | | | | | | parameter | | | | | | is not | | | | | | supplied, | | | | | | the IM-MGW | | | | | | shall not | | | | | | send any | | | | | | RTCP APP | | | | | | packets. | +-------------+-----------+-------------+-------------+-------------+ | | | SDPCapNeg | O | This | | | | co | | information | | | | nfiguration | | element | | | | | | provides | | | | | | SDPCapNeg | | | | | | confi | | | | | | guration(s) | | | | | | using as | | | | | | \"a=acap\", | | | | | | \"a=tcap\", | | | | | | \"a=pcfg\" | | | | | | and | | | | | | \"a=acfg\" | | | | | | SDP | | | | | | attributes. | +-------------+-----------+-------------+-------------+-------------+ | | | Additional | O | This | | | | Bandwidth | | information | | | | Properties | | element | | | | | | indicates | | | | | | additional | | | | | | bandwidth | | | | | | properties | | | | | | using | | | | | | \" | | | | | | a=bw-info\" | | | | | | SDP | | | | | | a | | | | | | ttribute(s) | | | | | | as defined | | | | | | by | | | | | | 3 | | | | | | GPP TS 26.1 | | | | | | 14 [104]. | +-------------+-----------+-------------+-------------+-------------+ | Configure | IM-MGW | Context | M | This | | IMS | | | | information | | Resources | | | | element | | | | | | indicates | | Ack | | | | the context | | | | | | where the | | | | | | command was | | | | | | executed. | +-------------+-----------+-------------+-------------+-------------+ | | | IMS | M | This | | | | Termination | | information | | | | | | element | | | | | | indicates | | | | | | the IMS | | | | | | termination | | | | | | where the | | | | | | command was | | | | | | executed. | +-------------+-----------+-------------+-------------+-------------+ | | | Local IMS | O | This | | | | Resource | | information | | | | | | element | | | | | | indicates | | | | | | the | | | | | | resources | | | | | | that the | | | | | | IM-MGW has | | | | | | reserved to | | | | | | receive the | | | | | | user plane | | | | | | data from | | | | | | the far | | | | | | end. | +-------------+-----------+-------------+-------------+-------------+ | | | Remote IMS | M | This | | | | Resource | | information | | | | | | element | | | | | | indicates | | | | | | the | | | | | | resource | | | | | | (i.e. | | | | | | codec) that | | | | | | the IM-MGW | | | | | | shall use | | | | | | to send | | | | | | user data | | | | | | to. | +-------------+-----------+-------------+-------------+-------------+ | | | Local | O | This | | | | Connection | | information | | | | Address | | element | | | | | | indicates | | | | | | the IP | | | | | | address and | | | | | | port on the | | | | | | IM-MGW that | | | | | | the remote | | | | | | end can | | | | | | send user | | | | | | plane data | | | | | | to. | +-------------+-----------+-------------+-------------+-------------+ | | | Remote | M | This | | | | Connection | | information | | | | Address | | element | | | | | | indicates | | | | | | the IP | | | | | | address and | | | | | | port that | | | | | | the IM-MGW | | | | | | can send | | | | | | user plane | | | | | | data to. | +-------------+-----------+-------------+-------------+-------------+
#### 9.3.1.3 Reserve IMS Connection point and configure remote resources
This procedure is used to reserve multimedia-processing resources for an Mb
interface connection.
Table 27: Procedures toward the IM Subsystem: reserve local, reserve remote
IMS connection point
* * *
Procedure Initiated Information element name Information element required
Information element description Reserve IMS Connection Point and Configure
Remote Resources MGCF Context/Context Request M This information element
indicates the existing context or requests a new context for the bearer
termination. Priority information O This information element requests the IM-
MGW to apply priority treatment for the terminations and bearer connections in
the specified context. IMS Termination/IMS Termination Request M This
information element indicates the existing bearer termination or requests a
new IMS termination for the bearer to be established. Local IMS Resources M
This information element indicates the resource(s) (i.e. codecs) for which the
IM-MGW shall be prepared to receive user data, Remote IMS Resources M This
information element indicates the resources (i.e. codec) that the IM-MGW shall
use to send user data in the IMS. IP Interface Type O This information element
indicates the used interface type Reserve Value O This information element
indicates if multiple IMS resources are to be reserved. Local Connection
Address request M This information element requests an IP address and a port
number on the IM-MGW that the remote end can send user plane data to. Remote
Connection Addresses M This information element indicates the IP address and
ports at an IMS user that the IM-MGW can send user plane data to. Notify
termination heartbeat M This information element requests termination
heartbeat indications. Notify Released Bearer O This information element
requests a notification of a released bearer. IP Realm Identifier O This
information element indicates the IP realm of the IP termination. ECN Enable O
This information element requests the IM-MGW to apply ECN procedures and IP
header settings as an ECN endpoint. ECN Initiation Method C This information
element specifies the ECN Initiation method and requests the IM-MGW to perform
IP header settings as an ECN endpoint. It may be included only if ECN is
enabled. Notify ECN Failure Event C This information element requests a
notification if an ECN failure occurs. It may only be supplied if ECN is
enabled. Diffserv Code Point O This information element requests the IM-MGW to
apply a specific Diffserv Code Point to the IP headers. STUN server request O
This information element is present if MGCF requests the IM-MGW to answer STUN
connectivity checks for ICE. ICE Connectivity Check C This information element
requests the IM-MGW to perform ICE connectivity check as defined by IETF RFC
8445 [156]. It is only applicable for full ICE. Notify ICE Connectivity Check
Result C This information element requests a notification of ICE connectivity
check result. It is only applicable for full ICE. Notify New Peer Reflexive
Candidate C This information element requests a notification of new peer
reflexive candidate was discovered during a connectivity check. It is only
applicable for full ICE. ICE password request O This information element is
present if MGCF requests an ICE password. ICE Ufrag request O This information
element is present if MGCF requests an ICE ufrag. ICE host candidate request O
This information element is present if MGCF requests an ICE host candidate.
ICE pacing request O This information element is present if MGCF requests a
pacing value for connectivity checks (Ta timer value). It is only applicable
for full ICE. ICE received candidate O This information element is present if
MGCF indicates a received candidate for ICE. ICE received password O This
information element is present if MGCF indicates a received password for ICE.
ICE received Ufrag O This information element is present if MGCF indicates a
received Ufrag for ICE. ICE received pacing O This information element is
present if MGCF indicates a received pacing value for connectivity checks (Ta
timer value). It is only applicable for full ICE. Allowed RTCP APP message
types O This information element is present if the MGCF allows the IM-MGW to
send RTCP APP packets of the indicated types. The IM-MGW shall not send other
RTCP APP packets. If the parameter is not supplied, the IM-MGW shall not send
any RTCP APP packets. SDPCapNeg configuration O This information element
provides SDPCapNeg configuration(s) using as \"a=acap\", \"a=tcap\",
\"a=pcfg\" and \"a=acfg\" SDP attributes. Additional Bandwidth Properties O
This information element indicates additional bandwidth properties using
\"a=bw-info\" SDP attribute(s) as defined by 3GPP TS 26.114 [104]. Reserve IMS
Connection Point and Configure Remote Resources Ack IM-MGW Context M This
information element indicates the context where the command was executed. IMS
Termination M This information element indicates the IMS termination where the
command was executed. Local IMS Resources M This information element indicates
the resources that the IM-MGW has reserved to receive the user plane data from
IMS. Remote IMS Resources M This information element indicates the resource
(i.e. codec) that the IM-MGW shall use to send user data. Local Connection
Addresses M This information element indicates the IP address on the IM-MGW
that shall receive user plane data from the IMS. ICE password C This
information element shall be present only if it was contained in the request.
It indicates the ICE password assigned by the IM-MGW. ICE Ufrag C This
information element shall be present only if it was contained in the request.
It indicates the ICE Ufrag assigned by the IM-MGW. ICE host candidate C This
information element shall be present only if it was contained in the request.
It indicates the ICE host candidate assigned by the IM-MGW. ICE lite
indication C This information element shall be present only if an ICE host
candidate request was contained in the request, and the IM-MGW supports ICE
lite, but not full ICE. It indicates that the IM-MGW only supports ICE lite.
ICE pacing C This information element shall be present only if it was
contained in the request. It indicates a desired pacing value for connectivity
checks (Ta timer value). SDPCapNeg configuration C This information element
shall be present only if it was contained in the request. It provides
SDPCapNeg configuration(s) using as \"a=acap\", \"a=tcap\", \"a=pcfg\" and
\"a=acfg\" SDP attributes.
* * *
#### 9.3.1.4 Release IMS termination
This procedure is used by the MGCF to release a termination towards the IMS
and free all related resources.
Table 28: Release IMS termination
* * *
Procedure Initiated Information element name Information element required
Information element description Release IMS Termination MGCF Context M This
information element indicates the context for the bearer termination. Bearer
Termination M This information element indicates the bearer termination to be
released. Release IMS Termination Ack IM-MGW Context M This information
element indicates the context where the command was executed. Bearer
Termination M This information element indicates the bearer termination where
the command was executed.
* * *
#### 9.3.1.5 Detect IMS RTP Tel event
This procedure is used by the MGCF to request from the MGW the detection of
telephony events signalled within RTP according to RFC 4733 [105] and the
notification of received telephony events. This procedure is the same as that
is defined in the clause \"Detect DTMF\" in 3GPP TS 23.205 [27].
Table 29: VOID
#### 9.3.1.6 Notify IMS RTP Tel event
This procedure is used by the MGW to notify the MGCF about the detection of
telephony events signalled within RTP according to RFC 4733 [105]. This
procedure is the same as that defined in the clause \"Report DTMF\" in 3GPP TS
23.205 [27].
Table 30: VOID
#### 9.3.1.7 Void
#### 9.3.1.8 Send IMS RTP Tel event
This procedure is used by the MGCF to request from the MGW to signal a
telephone event within RTP according to RFC 4733 [105]. This procedure is the
same as that defined in the clause \"Send DTMF\" in 3GPP TS 23.205 [27].
#### 9.3.1.9 Stop IMS RTP Tel event
This procedure is used by the MGW to request from the MGW to stop signalling a
telephone event within RTP according to RFC 4733 [105]. This procedure is the
same as that defined in the clause \"Stop DTMF\" in 3GPP TS 23.205 [27].
#### 9.3.1.10 Termination heartbeat indication
This procedure is used to report indication of hanging termination.
Table 30a: Procedures between (G)MSC server and MGW: Hanging termination
indication
* * *
Procedure Initiated Information element name Information element required
Information element description Termination heartbeat indication MGW Context M
This information element indicates the context for the bearer termination.
Bearer Termination M This information element indicates the bearer termination
for which the termination heartbeat is reported. Termination heartbeat M
Hanging Termination event, as defined in TS 29.332 [15]. Termination heartbeat
indication Ack (G)MSC-S Context M This information element indicates the
context where the command was executed.
* * *
#### 9.3.1.11 IMS Bearer Released
This procedure is used by the IM-MGW to indicate towards the MGCF that an
error occurred on an IMS termination which requires the release of the
termination. This procedure is the same as that defined in the clause \"Bearer
Released\" in 3GPP TS 23.205 [27].
#### 9.3.1.12 End IMS RTP Tel event
This procedure is used by the MGCF to indicate to the IM-MGW to stop detection
of telephony events signalled within RTP according to IETF RFC 4733 [105].
This procedure is the same as that is defined in the clause \"Stop Detect
DTMF\" in 3GPP TS 23.205 [27].
#### 9.3.1.13 IMS Send Tone
This procedure is used by the MGCF to order the IM-MGW to generate a tone at
termination towards IMS. This procedure is the same as that defined in the
clause \"Send Tone\" in 3GPP TS 23.205 [27].
#### 9.3.1.14 IMS Stop Tone
This procedure is used by the MGCF to order the IM-MGW to stop generating a
tone at a termination towards IMS. This procedure is the same as that defined
in the clause \"Stop Tone\" in 3GPP TS 23.205 [27].
#### 9.3.1.15 IMS Tone Completed
This procedure is used by the IM-MGW to indicate to the MGCF that a tone has
finished being generated at a termination. This procedure is the same as that
defined in the clause \"Tone Completed\" in 3GPP TS 23.205 [27].
#### 9.3.1.16 ECN Failure Indication
This procedure is used to report ECN related errors (see clause 9.2.11.1c).
Table 9.3.1.16.1: Procedures toward the IM Subsystem: ECN Failure Indication
* * *
Procedure Initiated Information element name Information element required
Information element description ECN Failure Indication IM-MGW Context M This
information element indicates the context for the bearer termination. Bearer
Termination M This information element indicates the bearer termination for
which the ECN failure is reported. ECN Failure Indication M This IE indicates
an ECN failure event. ECN Failure Indication Ack MGCF Context M This
information element indicates the context where the command was executed.
Bearer Termination M This information element indicates the bearer termination
where the command was executed
* * *
#### 9.3.1.17 ICE Connectivity Check Result Notification
This procedure is used to report ICE connectivity check result for Full ICE.
Table 9.3.1.17.1: Procedures between MGCF and IM-MGW: ICE Connectivity Check
Result Notification
* * *
Procedure Initiated Information element name Information element required
Information element description ICE Connectivity Check Result Notification IM-
MGW Context M This information element indicates the context for the bearer
termination. Bearer Termination M This information element indicates the
bearer termination for which the ICE Connectivity Check Result is reported.
ICE Connectivity Check Result M This information element indicates an ICE
Connectivity Check Result event. ICE Connectivity Check Result Notification
Ack MGCF Context M This information element indicates the context where the
command was executed. Bearer Termination M This information element indicates
the bearer termination where the command was executed.
* * *
#### 9.3.1.18 ICE New Peer Reflexive Candidate Notification
This procedure is used to report ICE new peer reflexive candidate for Full
ICE.
Table 9.3.1.18.1: Procedures between MGCF and IM-MGW: ICE New Peer Reflexive
Candidate Notification
* * *
Procedure Initiated Information element name Information element required
Information element description ICE New Peer Reflexive Candidate Notification
IM-MGW Context M This information element indicates the context for the bearer
termination. Bearer Termination M This information element indicates the
bearer termination for which the ICE New Peer Reflexive Candidate is reported.
ICE New Peer Reflexive Candidate M This information element indicates an ICE
New Peer Reflexive Candidate event. ICE New Peer Reflexive Candidate
Notification Ack MGCF Context M This information element indicates the context
where the command was executed. Bearer Termination M This information element
indicates the bearer termination where the command was executed.
* * *
### 9.3.2 Procedures related to a termination towards an ISUP network
A mapping of the procedures defined here to H.248 procedures and parameters is
provided in 3GPP TS 29.332 [15].
#### 9.3.2.1 Reserve TDM circuit
This procedure is used by the MGCF to reserve a TDM circuit in the IM-MGW
towards the preceding/succeeding CS network element.
Table 31: Reserve TDM circuit procedure
* * *
Procedure Initiated Information element name Information element required
Information element description Reserve TDM Circuit MGCF Context/Context
Request M This information element indicates the existing context or requests
a new context for the bearer termination. Bearer Termination M This
information element indicates the physical bearer termination for the TDM
circuit. Bearer Service Characteristics M This information element indicates
the bearer service requested by the user. Notify termination heartbeat O This
information element requests termination heartbeat indications. Notify
Released Bearer O This information element requests a notification of a
released bearer Reserve Circuit Ack IM-MGW Context M This information element
indicates the context where the command was executed.
* * *
#### 9.3.2.2 Change TDM through-connection
This procedure is used by the MGCF to modify the through-connection (forward,
backward, both-way, inactive) of a TDM termination at the IM-MGW towards the
PSTN.
This procedure is the same as Change Through Connection in 3GPP TS 23.205
[27].
#### 9.3.2.3 Activate TDM voice-processing function
This procedure is used by the MGCF to activate or de-activate a voice
processing function of a TDM termination at the IM-MGW towards the PSTN. This
voice processing function may include a cancellation for electronic echoes.
This procedure is the same as Activate Voice Processing Function in 3GPP TS
23.205 [27].
#### 9.3.2.4 Send TDM tone
This procedure is used by the MGCF to order the IM-MGW to generate a tone at a
TDM termination towards the PSTN.
This procedure is the same as Send Tone in 3GPP TS 23.205 [27].
#### 9.3.2.5 Stop TDM tone
This procedure is used by the MGCF to order the IM-MGW to stop generating a
tone at a TDM termination towards the PSTN.
This procedure is the same as Stop tone in 3GPP TS 23.205 [27].
#### 9.3.2.6 Play TDM announcement
This procedure is used by the MGCF to order the IM-MGW to generate an
announcement at a TDM termination towards the PSTN. The MGCF may request a
notification that the announcement is completed. This procedure is the same as
Play Announcement in 3GPP TS 23.205 [27]. This procedure is optional.
#### 9.3.2.7 TDM announcement completed
This procedure is used by the IM-MGW to notify the MGCF that an announcement
at a TDM termination towards the PSTN is completed. This procedure is the same
as Announcement Completed in 3GPP TS 23.205 [27]. This procedure is optional.
#### 9.3.2.8 Stop TDM announcement
This procedure is the same as Stop Announcement 3GPP TS 23.205 [27]. This
procedure is used by the MGCF to order the IM-MGW to stop generating an
announcement at a TDM termination towards the PSTN. This procedure is
optional.
#### 9.3.2.9 Continuity check
This procedure is used by the MGCF to order the IM-MGW to generate a
continuity check tone at a TDM termination towards the PSTN and to inform the
MGCF about the result of the continuity check as soon as the continuity check
tone is received or a time-out occurs. This procedure is optional.
Table 32: Continuity check procedure
* * *
Procedure Initiated Information element name Information element required
Information element description Continuity check MGCF Context/Context Request
M This information element indicates the existing context or requests a new
context for the bearer termination. TDM Termination M This information element
indicates the existing bearer termination Request for continuity tone sending
M This information request the IM-MGW to apply the continuity check procedure
on the indicated TDM termination Request for continuity check tone detection M
This information request the IM-MGW to inform e continuity check procedure on
the indicated TDM termination
* * *
#### 9.3.2.10 Continuity check verify
This procedure is used by the IM-MGW to indicate towards the MGCF that the
continuity check at a TDM termination towards the PSTN has been completed and
to return the result of the check: success or failure. This procedure is
optional.
Table 33: Continuity check verify procedure
+-------------+-----------+-------------+-------------+-------------+ | Procedure | Initiated | Information | Information | Information | | | | element | element | element | | | | name | required | description | +-------------+-----------+-------------+-------------+-------------+ | Continuity | IM-MGW | Context/t | M | This | | check | | | | information | | | | | | element | | Verify | | | | indicates | | | | | | the context | | | | | | where the | | | | | | command was | | | | | | executed. | +-------------+-----------+-------------+-------------+-------------+ | | | TDM | M | This | | | | Termination | | information | | | | | | element | | | | | | indicates | | | | | | the TDM | | | | | | termination | | | | | | involved in | | | | | | the | | | | | | procedure | +-------------+-----------+-------------+-------------+-------------+ | | | Outcome of | M | This | | | | the | | information | | | | continuity | | element | | | | check | | indicates | | | | | | the outcome | | | | | | of the | | | | | | continuity | | | | | | check | | | | | | (su | | | | | | ccessful/un | | | | | | successful) | +-------------+-----------+-------------+-------------+-------------+
#### 9.3.2.11 Continuity check response
This procedure is used by the MGCF to order the IM-MGW to loop back an
incoming continuity check tone at a TDM termination towards the PSTN. This
procedure is optional.
Table 34: Continuity check response procedure
* * *
Procedure Initiated Information element name Information element required
Information element description Continuity check response MGCF Context/Context
Request M This information element indicates the existing context or requests
a new context for the bearer termination. TDM Termination M This information
element indicates the existing bearer termination Request for loop back of the
continuity tone M This information request the IM-MGW to loop back the
continuity check tone on the indicated TDM termination
* * *
#### 9.3.2.12 Release TDM termination
This procedure is used by the MGCF to release a TDM termination at the IM-MGW
towards the PSTN and free all related resources.
Table 35: Release TDM termination procedure
* * *
Procedure Initiated Information element name Information element required
Information element description Release TDM Termination MGCF Context M This
information element indicates the context for the bearer termination. Bearer
Termination M This information element indicates the bearer termination to be
released. Release TDM Termination Ack IM-MGW Context M This information
element indicates the context where the command was executed. Bearer
Termination M This information element indicates the bearer termination where
the command was executed.
* * *
#### 9.3.2.13 Termination Out-of-Service
This procedure is used by the IM-MGW to indicate towards the MGCF that one or
several physical termination(s) will go out of service. This procedure is the
same as Termination Out-of-Service in 3GPP TS 23.205 [27].
#### 9.3.2.14 Termination heartbeat indication
This procedure is used to report indication of hanging termination.
Table 35a: Procedures between (G)MSC server and MGW: Hanging termination
indication
* * *
Procedure Initiated Information element name Information element required
Information element description Termination heartbeat indication MGW Context M
This information element indicates the context for the bearer termination.
Bearer Termination M This information element indicates the bearer termination
for which the termination heartbeat is reported. Termination heartbeat M
Hanging termination event, as defined in TS 29.332 [15]. Termination heartbeat
indication Ack (G)MSC-S Context M This information element indicates the
context where the command was executed.
* * *
#### 9.3.2.15 Bearer Released
This procedure is used by the IM-MGW to indicate towards the MGCF that an
error occurred on a physical termination which requires the release of the
termination. This procedure is the same as Bearer Released in 3GPP TS 23.205
[27].
#### 9.3.2.16 TDM tone completed
This procedure is used by the IM-MGW to MGCF to indicate that a tone has
finished being generated at a TDM termination.
This procedure is the same as Tone Completed in 3GPP TS 23.205 [27].
### 9.3.3 Procedures related to a termination towards a BICC network
The call related procedures detailed in table 36 shall be supported. Those
procedures are defined in 3GPP TS 29.332 [15].
Table 36: Required procedures defined in TS 29.332 [15]
* * *
Procedure defined in TS 29.332 [15] Remarks Establish Bearer  
Prepare Bearer  
Change Through-Connection  
Release Bearer  
Release Termination  
Bearer Established  
Bearer Released  
Send Tone  
Stop Tone  
Tone completed  
Play Announcement Optional Stop Announcement Optional Announcement Completed
Optional Confirm Char Optional Modify Bearer Characteristics Optional Reserve
Char Optional Bearer Modified Optional Activate Voice Processing Function
Optional Tunnel Information Down Conditional: For IP Transport at BICC
termination Tunnel Information Up Conditional: For IP Transport at BICC
termination Termination Out-of-Service  
Termination heartbeat indication
* * *
### 9.3.4 Non-call related procedures
The procedures from 3GPP TS 23.205 [27] detailed in table 37 shall be applied
for the IM‑MGW handling component of the Mn interface.
Table 37: Non-call related procedures
+----------------------+----------------------+----------------------+ | Procedure defined in | Corresponding | Remarks | | | Procedure defined in | | | TS 29.332 [15] | TS 23.205 [27] | | +----------------------+----------------------+----------------------+ | IM-MGW Out of | MGW Out of Service | | | service | | | +----------------------+----------------------+----------------------+ | IM-MGW Communication | MGW Communication Up | | | Up | | | +----------------------+----------------------+----------------------+ | IM-MGW Restoration | MGW Restoration | | +----------------------+----------------------+----------------------+ | IM-MGW Register | MGW Register | | +----------------------+----------------------+----------------------+ | IM-MGW Re-register | MGW Re-register | | +----------------------+----------------------+----------------------+ | MGCF Ordered | (G)MSC Server | | | Re-register | Ordered Re-register | | +----------------------+----------------------+----------------------+ | MGCF Restoration | (G)MSC Server | | | | Restoration | | +----------------------+----------------------+----------------------+ | MGCF Out of Service | (G)MSC Server Out of | | | | Service | | +----------------------+----------------------+----------------------+ | Termination | Termination | The \"Termination | | Out-of-Service | Out-of-Service | Out-of-Service | | | | procedure\" is used | | | | as call-related | | | | H.248 command as | | | | well | +----------------------+----------------------+----------------------+ | Termination | Termination | | | Restoration | Restoration | | +----------------------+----------------------+----------------------+ | Audit Value | Audit Value | | +----------------------+----------------------+----------------------+ | Audit Capability | Audit Capability | | +----------------------+----------------------+----------------------+ | Command Rejected | Command Rejected | The \"Command | | | | Rejected\" procedure | | | | may be used in | | | | response both to | | | | call-related and | | | | non-call-related | | | | H.248 Commands. | +----------------------+----------------------+----------------------+ | IM-MGW Capability | Capability Update | | | Change | | | +----------------------+----------------------+----------------------+ | IM-MGW Resource | MGW Resource | | | Congestion Handling | Congestion Handling | | | - Activate | - Activate | | +----------------------+----------------------+----------------------+ | IM-MGW Resource | MGW Resource | | | Congestion Handling | Congestion Handling | | | - Indication | - Indication | | +----------------------+----------------------+----------------------+ | Control association | Control association | | | monitoring | monitoring | | +----------------------+----------------------+----------------------+ | Inactivity timeout | Inactivity timeout | | | activation | activation | | +----------------------+----------------------+----------------------+ | Inactivity timeout | Inactivity timeout | | | indication | indication | | +----------------------+----------------------+----------------------+ | Hanging termination | Hanging termination | | | detection | detection | | +----------------------+----------------------+----------------------+ | Hanging termination | Hanging termination | | | detection | detection | | +----------------------+----------------------+----------------------+
### 9.3.5 Multiple IP Realms
The procedures to support multiple IP realms in the present clause are
optional.
Figure 9.3.5.1 shows a scenario where multiple IP realms are applied.
Figure 9.3.5.1 Multiple IP realms scenario
Shown in figure 9.3.5, the IM CN1 and CS CN1 represent separate IP realms. The
definition of IP realm is specified in IETF RFC 2663[90].
The termination1 and termination2 are connected with different IP realms in
the IM-MGW separately.
For establishing session when multiple IP realms are used in the IM-MGW, the
MGCF may indicate the IP realm identifier to the IM-MGW. The IM-MGW shall
assign the IP termination with the indicated IP realm.
A default IP realm may be configured in IM-MGW such that if the IM-MGW has not
received the IP realm identifier and the IM-MGW supports multiple IP realms
then the default IP realm shall be used.
If the IM-MGW does not support the option to indicate an IP realm then it is
free to select any IP port.
## 9.4 Multimedia Priority Service (MPS) Support
### 9.4.1 General
The Multimedia Priority Service (MPS) is specified in 3GPP TS 22.153 [136].
The MGCF/IM-MGW may support the priority treatment of a call/session
identified as an MPS call/session. If MPS is supported then upon receipt of
the MPS priority information in the call control signalling:
\- The MGCF shall recognise the call/session as having priority.
\- The MGCF shall send the Priority information for a context to the IM-MGW to
enable the priority treatment described below related to the IM-MGW.
\- The MGCF shall apply priority handling to H.248 transactions related to
priority calls/sessions when network resources are congested, e.g.,
preferential treatment in any queues or buffers.
\- If the H.248 control association utilises a transport with the possibility
for prioritisation, the MGCF may apply priority using the appropriate
prioritisation procedures.
\- If the MPS Priority service requires a specific MPS DSCP setting, the MGCF
shall configure the IM-MGW to apply a specific MPS DSCP marking to the user
data transport packets to indicate that the packets are of a higher priority
than those for normal calls.
\- If the IM-MGW receives an indication to apply a specific MPS DSCP marking
to the user data transport packets, it shall apply this DSCP marking to the IP
headers.
NOTE 1: Support of Diffserv procedures by the IMS-MGW assumes an operator uses
Diffserv for prioritising user plane traffic related to an MPS call/session.
\- When the MGCF marks a Context with Priority information, the IM-MGW may use
the Priority information for selecting resources for the media and signalling
transport with priority. The following actions may be taken by the IM-MGW if
it has reached a congested state:
i) seize priority reserved resources; or
ii) if resources are completely congested, indicate that in a Command Response
error code.
NOTE 2: The Priority information can be used to derive Layer 2 QoS marking and
trigger priority identification and priority treatment for other QoS
technologies than Diffserv.
This clause describes the Mn signalling procedures and their interactions with
SIP signalling in the control plane and with user plane procedures to support
the requirements for MPS. These Mn signalling procedures may or may not apply
depending on the network configuration (e.g. whether the IM-MGW is shared by
multiple MGCFs or whether the MGCF controls multiple IM-MGWs for a given route
- Media Gateway Group).
The MGCF can receive a SIP INVITE with MPS priority information (see 3GPP TS
23.228 [12], clause 5.21).
### 9.4.2 IM-MGW Resource Congestion in ADD response, request is queued
If the MGCF requests a resource via the Reserve IMS Connection Point and
configure remote resources procedure or Reserve IMS Connection Point procedure
and receives an error indicating that the requested resource could not be
seized (e.g. H.248 error code #510 \"insufficient resources\") and the MGCF
does not an have alternative IM-MGW through which it can route the
call/session, the MGCF queues the priority call/session and gives it priority
over any further Reserve IMS Connection Point and configure remote resources
or Reserve IMS Connection Point procedures for lower priority calls/sessions
towards this IM-MGW until the requested resource for this queued call/session
is successfully seized. The example sequence is shown in Figure 9.4.2.1.
Figure 9.4.2.1: Request to Reserve MPS priority call resources when IM-MGW is
congested
### 9.4.3 IM-MGW Resource Congestion in ADD response, MGCF seizes new IM-MGW
If the MGCF requests a resource via the Reserve IMS Connection Point and
configure remote resources procedure or Reserve IMS Connection Point procedure
and receives an error indicating that the requested resources could not be
seized due to congestion (e.g. H.248 error code #510 \"insufficient
resources\") and Media Gateway Groups are implemented the MGCF seizes a new
IM-MGW from the same Media Gateway Group before resorting to any queuing of
the priority call/session (as described in clause 9.4.2) to enable the MPS
call/session to proceed as early as possible.
### 9.4.4 IM-MGW Priority Resource Allocation
If the IM-MGW supports the Priority information (e.g. determined through
provisioning or package profile), the MGCF requests a resource via the Reserve
IMS Connection Point and configure remote resources procedure or Reserve IMS
Connection Point procedure and includes the Priority information. The IM-MGW
may then provide priority allocation of resources once a congestion threshold
is reached. The example sequence is shown in Figure 9.4.4.1. If the IM-MGW is
completely congested it shall indicate this to the MGCF as described in clause
9.4.2.
Figure 9.4.4.1: Request to reserve MPS priority call resources when IM-MGW is
congested, priority resources are allocated
The IM-MGW may also provide priority allocation for resources requested via a
subsequent Configure IMS resources procedure not including Priority
information if the related context has been marked with priority information
during the Reserve IMS Connection Point procedure or Reserve IMS Connection
point and configure remote resources procedure.
### 9.4.5 IM-MGW Priority User Data marking
The MGCF may request the streams associated to an MPS call/session to be
marked with a certain priority code point as described in clause 8.4. The IM-
MGW shall then mark each IP packet header accordingly. The example sequence is
shown in Figure 9.4.5.1.
Figure 9.4.5.1: Request to reserve IMS resources and apply DSCP marking for
MPS
###### ## Annex A (informative): Void
###### ## Annex B (normative): Codec Negotiation between a BICC CS network and
the IM CN subsystem
# B.1 Introduction
This annex describes optional procedures for interworking of codec negotiation
between a BICC CS network and the IM CN subsystem.
# B.2 Control plane interworking
The following optional procedures apply in addition to the procedures of
clause 7.3 when both the BICC CS network and the IM CN subsystem support codec
negotiation. All five variations of the bearer set-up procedures defined in
clauses 7.4 and 7.5 of ITU-T Q.1902.4 [30] are supported. The codec
negotiation procedures are also independent of the procedures for interworking
between continuity procedures and SDP preconditions.
## B.2.1 Incoming call interworking from SIP to BICC at I-MGCF
### B.2.1.1 Sending of IAM
When the I-MGCF receives an INVITE with SDP offer, the I-MGCF shall follow the
procedures of clause B.2.5 to convert the list of codecs in the SDP offer into
a Supported Codec List for transmission in the outgoing IAM, according to
clause 8.3.1 of ITU-T Q.1902.4 [30], and deleting those codecs not supported
at the IM-MGW. When generating the Supported Codec List, the I-MGCF should add
to the SDP offer all codec configurations for which it can provide
transcoding. The I-MGCF shall allocate any IM-MGW resources as necessary to
support the chosen bearer set-up procedures towards the BICC CS network.
When the I-MGCF receives an INVITE without SDP offer, the I-MGCF shall
continue call establishment without interworking of codec negotiation
procedures. The mid-call interworking procedures of clause B.2.3 and clause
B.2.4 may still apply.
### B.2.1.2 Sending of SDP answer
The I-MGCF shall suspend the SDP answer procedure until it receives backward
codec information from the BICC serving node terminating codec negotiation.
When the I-MGCF receives the backward codec information, it shall select a
codec configuration for use on the bearer interface to the IM CN subsystem
from the codecs in the SDP offer, format an SDP answer based on this selected
codec, send the SDP answer to the offerer in the appropriate SIP message
(e.g., a reliable 18x response), and complete bearer establishment procedures.
To avoid allocating a transcoder at the IM-MGW, the I-MGCF should preferably
select a codec for the IM CN subsystem by converting the Selected Codec from
the BICC CS network into an SDP answer according to the procedures of clause
B.2.5, if allowed by the SDP offer/answer rules. Otherwise the I-MGCF should
select the highest priority codec from the codecs in the received SDP offer
supported by the IM-MGW for insertion in the SDP answer. Note that the I-MGCF
stores the Available Codec List and does not send it to the offerer in the SDP
answer. Codec negotiation is complete so it is not necessary for the offerer
to begin a second phase offer/answer exchange using the PRACK request.
## B.2.2 Outgoing call interworking from BICC to SIP at O-MGCF
### B.2.2.1 Sending of INVITE
When the O-MGCF receives an IAM, the O-MGCF shall follow the procedures of
clause B.2.5 to convert the Supported Codec List from the IAM into an SDP
offer for transmission in the outgoing INVITE request, according to RFC 3264,
deleting those codecs not supported at the IM-MGW. When generating the SDP
offer, the O-MGCF should include all codec configurations for which it can
provide transcoding in addition to those converted from the Supported Codec
List. The O-MGCF shall include at least one AMR codec configuration in the SDP
offer. The O-MGCF shall allocate any IM-MGW resources as necessary to support
the inclusion of session address information in the SDP offer towards the IM
CN subsystem.
### B.2.2.2 Responding to serving node initiating codec negotiation
The O-MGCF shall suspend the incoming bearer set-up procedure while waiting
for receipt of the SDP answer from the IM CN subsystem. When the O-MGCF
receives the SDP answer while suspending the incoming bearer set-up procedure,
it shall select a codec configuration for use on the bearer interface to the
IM CN subsystem from the codecs in the SDP answer, construct the Available
Codec List for the BICC CS network from the list of codecs received in the
Supported Codec List by removing codecs not supported at the IM-MGW, choose
the Selected Codec for the BICC CS network from the codecs in the Available
Codec List, initiate the second SDP offer/answer exchange with the IM CN
subsystem using the codec selected for the IM CN subsystem, if necessary, and
resume the incoming bearer set-up procedure in the BICC CS network. The O-MGCF
should select codecs for the bearer interfaces to the BICC CS network and IM
CN subsystem in such a way as to avoid transcoding at the IM-MGW and minimize
speech degradation, if possible, according to clause B.2.5. Otherwise the
O-MGCF should choose the highest priority codec from the Available Codec List
as the Selected Codec for the BICC CS network, and the highest priority codec
from the codecs in the SDP answer as the codec for the IM CN subsystem. If the
SDP answer only included a single voice codec, then there is no need for a
second SDP offer/answer exchange, and the codec selected for the IM CN
subsystem is the codec in the SDP answer.
Certain BICC timers or events can force completion of the incoming bearer set-
up procedure before the O-MGCF receives the SDP answer from the IM CN
subsystem. In this case, the O-MGCF shall perform the terminating codec
negotiation procedure according to clause 8.3.3 of ITU-T Q.1902.4 [30],
including all supported codecs in the Available Codec List, and shall resume
the incoming bearer set-up procedure without waiting any longer for the SDP
answer.
When an SDP answer arrives from the IM CN subsystem in response to the SDP
offer in an INVITE request after the BICC incoming bearer set-up procedure has
started, the O-MGCF shall select a codec configuration for use on the bearer
interface to the IM CN subsystem from the codecs in the SDP answer, choose a
new Selected Codec for the BICC CS network from the codecs in the Available
Codec List constructed during incoming bearer set-up, and initiate the second
SDP offer/answer exchange with the IM CN subsystem using the codec selected
for the IM CN subsystem, if necessary. The O-MGCF should select codecs for the
bearer interfaces to the BICC CS network and IM CN subsystem in such a way as
to avoid transcoding at the IM-MGW and minimize speech degradation, if
possible, according to clause B.2.5. Otherwise the O-MGCF should select the
highest priority codecs from the available options for the two bearer
interfaces. If the SDP answer only included a single voice codec, then there
is no need for a second SDP offer/answer exchange, and the codec selected for
the IM CN subsystem is the codec in the SDP answer. When the call in the BICC
CS network enters a state capable of supporting codec modification, if the new
Selected Codec is different from the Selected Codec chosen during the incoming
bearer set-up procedure for the BICC CS network, the O-MGCF should initiate
the codec modification procedure towards the BICC CS network using the new
Selected Codec, according to clause 10.4.1 of ITU-T Q.1902.4 [30].
## B.2.3 Mid-call interworking from SIP to BICC at I-MGCF or O-MGCF
### B.2.3.1 Receipt of SDP offer
When the MGCF receives a SIP message (e.g. UPDATE request or re-INVITE
request) with an SDP offer that is not associated with incoming call bearer
establishment or preconditions, if the call is in a state capable of
supporting BICC codec negotiation, the MGCF shall follow the procedures of
clause B.2.5 to convert the list of codecs in the SDP offer into a Supported
Codec List, delete those codecs in the Supported Codec List not supported at
the IM-MGW, and initiate the mid-call codec negotiation procedure according to
clause 10.4.4 of ITU-T Q.1902.4 [30], by sending an APM with the Supported
Codec List and an Action indicator set to \"mid-call codec negotiation\". When
generating the Supported Codec List, the MGCF should add to the SDP offer all
codec configurations for which it can provide transcoding.
When the MGCF receives a SIP message with an SDP offer that is not associated
with incoming call bearer establishment or preconditions, if the call is not
in a state capable of supporting BICC codec negotiation, the MGCF shall
respond to the SDP offer with existing procedures for the IM CN subsystem.
When the call is in a state capable of supporting BICC codec negotiation, the
MGCF may send a re-INVITE request without SDP towards the IM CN subsystem,
soliciting a response with an SDP offer, thereby restarting the codec
negotiation interworking procedure.
### B.2.3.2 Generating SDP answer
After initiating a BICC codec negotiation procedure towards the BICC CS
network in response to receipt of a SIP message with an SDP offer from the IM
CN subsystem, the MGCF shall suspend the SDP answer procedure until it
receives codec information from the succeeding BICC serving node. If the
succeeding serving node returns a successful response, the MGCF shall select a
codec configuration for use on the bearer interface to the IM CN subsystem
from the codecs in the SDP offer, format an SDP answer based on this selected
codec, send the SDP answer to the offerer in the appropriate SIP message (e.g.
200 OK (UPDATE) or 200 OK (INVITE)), send an APM to the succeeding serving
node with an Action indicator set to \"successful codec modification\", and
complete bearer establishment procedures. To avoid allocating a transcoder at
the IM-MGW, the MGCF should preferably select a codec for the IM CN subsystem
by converting the Selected Codec from the BICC CS network into an SDP answer
according to the procedures of clause B.2.5, if allowed by the SDP
offer/answer rules. Otherwise the MGCF should select the highest priority
codec from the codecs in the received SDP offer supported by the IM-MGW for
insertion in the SDP answer. Note that the MGCF stores the Available Codec
List and does not send it to the offerer in the SDP answer.
If the succeeding serving node returns an Action indicator set to \"mid-call
codec negotiation failure\", the MGCF either should send a 488 response to the
SDP offerer indicating rejection of the initial SDP offer, or should select
the highest priority codec from the codecs in the received SDP offer supported
by the IM-MGW, format an SDP answer based on this selected codec, and send the
SDP answer to the offerer in the appropriate SIP message. If the MGCF sends a
488 response to the SDP offerer, it should continue the call with the bearer
configuration in place before initiating this codec negotiation procedure.
## B.2.4 Mid-call interworking from BICC to SIP at I-MGCF or O-MGCF
### B.2.4.1 Receipt of mid-call codec negotiation request
When the MGCF receives an APM with an Action indicator set to \"mid-call codec
negotiation\", the MGCF shall follow the procedures of clause B.2.5 to convert
the Supported Codec List from the APM into an SDP offer for transmission in an
appropriate SIP message (e.g. re-INVITE request) towards the IM CN subsystem,
according to RFC 3264 [36], deleting those codecs not supported at the IM-MGW.
When generating the SDP offer, the MGCF should include all codec
configurations for which it can provide transcoding in addition to those
converted from the Supported Codec List. The MGCF shall include at least one
AMR codec configuration in the SDP offer.
### B.2.4.2 Responding to serving node initiating mid-call codec negotiation
The MGCF shall delay responding to the mid-call codec negotiation from the
BICC CS network until it receives a response to the SDP offer from the IM CN
subsystem. If the MGCF receives an SDP answer, it shall construct the
Available Codec List for the BICC CS network from the list of codecs received
in the Supported Codec List by removing codecs not supported at the IM-MGW,
choose the Selected Codec for the BICC CS network from the codecs in the
Available Codec List, and complete the mid-call codec negotiation procedure
towards the preceding serving node according to clause 10.4.5 of ITU-T
Q.1902.4 [30]. The MGCF should choose the Selected Codec for the BICC CS
network in such a way as to avoid transcoding at the IM-MGW and minimize
speech degradation, if possible, according to clause B.2.5. Otherwise the MGCF
should choose the highest priority codec from the Available Codec List for the
Selected Codec for the BICC CS network. If the MGCF receives an APM from the
preceding serving node with an Action indicator set to \"codec modification
failure\", then the MGCF may initiate a new SDP offer/answer exchange towards
the IM CN subsystem in an attempt to recreate the bearer configuration in
place before this codec negotiation procedure began.
If the MGCF receives a 488 response or other failure response (e.g. 3xx-6xx)
to the SDP offer, either it should reject the mid-call codec negotiation from
the BICC CS network by sending an APM with an Action indicator set to \"mid-
call codec negotiation failure\" towards the preceding serving node, or it
should continue as if it received an SDP answer with no change in codec
selected for the IM CN subsystem. If the MGCF sends an APM with an Action
indicator set to \"mid-call codec negotiation failure\", it should continue
the call with the bearer configuration in place before initiating this codec
negotiation procedure.
### B.2.4.3 Receipt of codec modification request
If the MGCF receives an APM from a BICC CS network that includes an Action
indicator set to \"modify codec\" with no change in the selected codec, it
shall act as a serving node terminating codec modification, according to
clause 10.4.2 of ITU-T Q.1902.4 [30], without interworking the procedure with
the IM CN subsystem.
If the MGCF receives an APM from a BICC CS network that includes an Action
indicator set to \"modify codec\" and the new selected codec in the message is
different from the Selected Codec at the IM-MGW bearer interface to the BICC
CS network, the MGCF either may act as a serving node terminating codec
modification, according to clause 10.4.2 of ITU-T Q.1902.4 [30], without
interworking the procedure with the IM CN subsystem, or may follow the
procedures of clause B.2.5 to convert the new Available Codec List (with new
priority order) from the APM into an SDP offer for transmission in an
appropriate SIP message (e.g. re-INVITE request) towards the IM CN subsystem,
according to RFC 3264 [36], deleting those codecs not supported at the IM-MGW.
When generating the SDP offer, the MGCF should include all codec
configurations for which it can provide transcoding in addition to those
converted from the new Available Codec List. The MGCF shall include at least
one AMR codec configuration in the SDP offer.
If the MGCF sends a SIP message with an SDP offer towards the IM CN subsystem
in response to receipt of a BICC codec modification request, then it shall
delay responding to the BICC codec modification request until it receives a
response to the SDP offer from the IM CN subsystem. When the MGCF receives
either an SDP answer or a rejection of the SDP offer within the appropriate
SIP message (e.g. 200 OK (INVITE)) from the IM CN subsystem, it shall decide
whether to accept or reject the BICC codec modification procedure and complete
the procedure for a BICC serving node terminating codec modification,
according to clause 10.4.2 of ITU-T Q.1902.4 [30].
If the MGCF sends an APM with an Action indicator set to \"codec modification
failure\" in response to receipt of a codec modification request, the
preceding BICC serving node may retry the request with a mid-call codec
negotiation using an APM including an Action indicator set to \"mid-call
negotiation\" and a Supported Codec List with a new priority order encouraging
selection of a new codec.
## B.2.5 Codec parameter translation between BICC CS network and the IM CN
subsystem
The IM CN subsystem uses the Session Description Protocol (SDP, defined in
IETF RFC 4566 [56]) to select and potentially re-negotiate the codec type and
configuration and associated bearer format attributes to be used in the user
plane. IETF RFC 3550 [51] defines the Real Time Protocol (RTP) for framing of
all codecs in the user plane, IETF RFC 3551 [52] and IETF RFC 3555 [53] define
the framing details for many of the ITU-T codecs, and IETF RFC 4867 [23]
defines framing details for the AMR family of codecs. This clause will focus
only on codec-specific SDP parameters]. The signalling plane of the IM CN
subsystem uses SDP offer/answer procedures defined in IETF RFC 3264 [36] to
select the desired codec type and configuration for the user plane from a
prioritized list of codec types and configurations and to re-negotiate the
user plane attributes as necessary.
The bearer independent CS network uses the Single Codec and Codec List
information elements of the Application Transport Mechanism (APM) defined in
ITU-T Recommendation Q.765.5 [35] to negotiate (offer and select) and
potentially re-negotiate the codec type and configuration and associated
bearer format attributes to be used in the user plane. 3GPP TS 29.414 [25] and
3GPP TS 29.415 [26] define the IuFP framing protocol for all codecs in the
user plane for both ATM and IP transport, and 3GPP TS 26.102 [50] provides the
framing details for AMR and PCM family codecs. The Codec List information
element of the APM comprises multiple instances of the Single Codec
information element in priority order, as shown in figure 13 of ITU-T
Recommendation Q.765.5 [35]. Figure 14 of ITU-T Recommendation Q.765.5 [35]
defines the Single Codec information element. Clause 11.1.7.2 of ITU-T
Recommendation Q.765.5 [35] defines the encoding of the Single Codec
information element for the ITU-T codecs. 3GPP TS 26.103 [57] defines the
encoding of the Single Codec information element for the 3GPP codecs, and
table 7.11.3.1.3-2 of 3GPP TS 28.062 [58] defines the preferred configurations
of the narrowband AMR codecs (Config-NB-Code) for interoperation with TFO. The
signalling plane of the bearer independent CS network uses the APM to
negotiate the desired codec type and configuration for the user plane from the
prioritized list of codec types and to re-negotiate the user plane attributes
as necessary.
The following clauses define the translations between the SDP payload format
parameters of the IM CN subsystem and the corresponding subfields of the
Single Codec information element of the bearer independent CS network for
certain 3GPP and ITU-T codecs. Following these translation rules will in many
cases allow the IM-MGW to perform interworking between the framing protocols
on the bearer interfaces to the BICC CS network and the IM CN subsystem
without transcoding. Implementations may signal other codec types not listed
herein or other codec configurations of codec types listed herein.
Implementations may also choose to perform transcoding between codec
configurations signalled separately for the bearer interfaces to the networks,
if necessary, but voice quality may suffer.
### B.2.5.1 Codec parameters for 3GPP AMR-NB codecs
Table B.1 shows the correspondence between the codec format parameters in the
Single Codec information element (3GPP TS 26.103 [57]) and the SDP for the
3GPP narrowband AMR codecs (IETF RFC 4867 [23]).
Table B.1: Mapping between Single Codec subfields and SDP parameters for 3GPP
AMR-NB codecs
+-------------+-------------+-------------+-------------+-------------+ | Single | SDP payload | | | | | Codec | format | | | | | information | parameters | | | | | element | | | | | +-------------+-------------+-------------+-------------+-------------+ | Codec | ACS, SCS, | Payload | Encoding | Other | | Ide | OM, MACS | Type number | name | Parameters | | ntification | | | | | | | | | | (NOTE 1) | | | | | | (NOTE 2) | +-------------+-------------+-------------+-------------+-------------+ | FR_AMR or | OM=0 or | dynamic | AMR | mode | | OHR_AMR or | | | | -set=values | | | Selected | | | co | | HR_AMR | Codec Type | | | rresponding | | | | | | to ACS | | | | | | (NOTE 3) | +-------------+-------------+-------------+-------------+-------------+ | FR_AMR or | (OM=1 or OM | dynamic | AMR | mode | | OHR_AMR or | not | | | -set=select | | | present) | | | from values | | HR_AMR | and | | | co | | | | | | rresponding | | | (Supported | | | to ACS, SCS | | | Codec List | | | and MACS | | | or | | | (NOTE 3) | | | Available | | | | | | Codec List) | | | | +-------------+-------------+-------------+-------------+-------------+ | UMTS_AMR | OM=0 or | dynamic | AMR | mode | | | | | | -set=values | | | Selected | | | co | | | Codec Type | | | rresponding | | | | | | to ACS | +-------------+-------------+-------------+-------------+-------------+ | UMTS_AMR | (OM=1 or OM | dynamic | AMR | mode | | | not | | | -set=select | | | present) | | | from values | | | and | | | co | | | | | | rresponding | | | (Supported | | | to ACS, SCS | | | Codec List | | | and MACS | | | or | | | (NOTE 4) | | | Available | | | | | | Codec List) | | | | +-------------+-------------+-------------+-------------+-------------+ | U | OM=0 or | dynamic | AMR | mode | | MTS_AMR_2 | | | | -set=values | | | Selected | | | co | | | Codec Type | | | rresponding | | | | | | to ACS | | | | | | (NOTE 5) | +-------------+-------------+-------------+-------------+-------------+ | U | (OM=1 or OM | dynamic | AMR | mode | | MTS_AMR_2 | not | | | -set=select | | | present) | | | from values | | | and | | | co | | | | | | rresponding | | | (Supported | | | to ACS, SCS | | | Codec List | | | and MACS | | | or | | | (NOTE 3) | | | Available | | | (NOTE 5) | | | Codec List) | | | | +-------------+-------------+-------------+-------------+-------------+ | NOTE 1: | | | | | | Table 1 of | | | | | | IETF RFC | | | | | | 4867 [23] | | | | | | provides | | | | | | the | | | | | | cor | | | | | | respondence | | | | | | between | | | | | | codec rates | | | | | | and AMR | | | | | | modes for | | | | | | use when | | | | | | generating | | | | | | the | | | | | | \ | | | | | | "mode-set\" | | | | | | parameter. | | | | | | When all | | | | | | modes are | | | | | | selected | | | | | | for use, | | | | | | the | | | | | | \ | | | | | | "mode-set\" | | | | | | parameter | | | | | | shall not | | | | | | be included | | | | | | in SDP. | | | | | | | | | | | | NOTE 2: SDP | | | | | | payload | | | | | | format | | | | | | con | | | | | | figurations | | | | | | in this | | | | | | table with | | | | | | only one | | | | | | value in | | | | | | the | | | | | | \ | | | | | | "mode-set\" | | | | | | parameter | | | | | | shall not | | | | | | include the | | | | | | \"mode-chan | | | | | | ge-period\" | | | | | | and | | | | | | \" | | | | | | mode-change | | | | | | -neighbor\" | | | | | | parameters. | | | | | | | | | | | | NOTE 3: | | | | | | Payload | | | | | | types for | | | | | | FR_AMR, | | | | | | OHR_AMR | | | | | | and HR_AMR | | | | | | with more | | | | | | than one | | | | | | value in | | | | | | the | | | | | | \ | | | | | | "mode-set\" | | | | | | parameter | | | | | | shall | | | | | | include the | | | | | | \"m | | | | | | ode-change- | | | | | | period=2\", | | | | | | \"mode | | | | | | -change-cap | | | | | | ability=2\" | | | | | | parameters | | | | | | and should | | | | | | include the | | | | | | \"mo | | | | | | de-change-n | | | | | | eighbor=1\" | | | | | | parameter. | | | | | | | | | | | | NOTE 4: | | | | | | IETF RFC | | | | | | 4867 [23] | | | | | | does not | | | | | | currently | | | | | | provide a | | | | | | mechanism | | | | | | to signal | | | | | | the SCS, | | | | | | MACS or OM | | | | | | parameters | | | | | | in SDP, nor | | | | | | does it | | | | | | distinguish | | | | | | between the | | | | | | different | | | | | | AMR-NB | | | | | | codec | | | | | | types. Each | | | | | | AMR-NB | | | | | | codec type | | | | | | in the | | | | | | Supported | | | | | | Codec List | | | | | | or the | | | | | | Available | | | | | | Codec List | | | | | | with OM=1 | | | | | | should be | | | | | | translated | | | | | | into a list | | | | | | of SDP | | | | | | payload | | | | | | formats in | | | | | | priority | | | | | | order, | | | | | | where each | | | | | | includes a | | | | | | \ | | | | | | "mode-set\" | | | | | | parameter | | | | | | with a | | | | | | unique | | | | | | value | | | | | | derived | | | | | | from the | | | | | | ACS, SCS | | | | | | and MACS. | | | | | | Each | | | | | | \ | | | | | | "mode-set\" | | | | | | should | | | | | | correspond | | | | | | to a codec | | | | | | co | | | | | | nfiguration | | | | | | that is | | | | | | compatible | | | | | | with the | | | | | | given codec | | | | | | type | | | | | | according | | | | | | to the | | | | | | co | | | | | | mpatibility | | | | | | rules | | | | | | defined in | | | | | | clauses 11 | | | | | | and 12 of | | | | | | TS 28. | | | | | | 062 [58]. | | | | | | | | | | | | NOTE 5: | | | | | | Payload | | | | | | types for | | | | | | U | | | | | | MTS_AMR_2 | | | | | | should | | | | | | include the | | | | | | \"m | | | | | | ode-change- | | | | | | period=2\", | | | | | | \"mode | | | | | | -change-cap | | | | | | ability=2\" | | | | | | and | | | | | | \"mo | | | | | | de-change-n | | | | | | eighbor=1\" | | | | | | parameters, | | | | | | normally | | | | | | used for | | | | | | signalling | | | | | | GSM AMR | | | | | | codecs, to | | | | | | assure | | | | | | end-to-end | | | | | | inter | | | | | | operability | | | | | | with OoBTC | | | | | | and TFO. | | | | | | Its actual | | | | | | c | | | | | | apabilities | | | | | | would | | | | | | otherwise | | | | | | be | | | | | | signalled | | | | | | without | | | | | | these | | | | | | parameters. | | | | | +-------------+-------------+-------------+-------------+-------------+
**Definitions:**
**Supported Codec List** : contains the offered Codec Types and Configuration-
possibilities of the node initiating codec negotiation in BICC (see also 3GPP
TS 23.153). The Supported Codec List is sent from the initiating node forward
to the terminating node. The Supported Codec List corresponds to an SDP offer
during codec negotiation.
**Available Codec List** : contains the offered Codec Types and Configuration-
possibilities of the contiguous portion of the connection between initiating
and terminating BICC nodes, including all intermediate nodes through the BICC
network(s). The Available Codec List is sent from the BICC node terminating
codec negotiation backward to the initiating node. The Available Codec List
corresponds to information sometimes available in a first-round SDP answer.
The Available Codec List might not represent an end-to-end view of the
available Codec Types and Configuration-possibilities when traversing both
BICC and SIP networks.
**Selected Codec Type** : is determined by the node terminating codec
negotiation. It specifies exactly the Codec Type and one unique Codec
Configuration for the call. The Selected Codec Type corresponds to the final
SDP answer.
When translating from a Single Codec information element to the equivalent SDP
payload format parameters, where either OM=0 (in the Supported or Available
Codec List) or the information element is the Selected Codec Type, the SDP
shall include a single payload type and any associated parameters from the
corresponding row in table B.1. When translating from a Single Codec
information element to the equivalent SDP payload format parameters, where
OM=1 in the Supported or Available Codec List, the SDP shall only include
payload formats corresponding to Codec Configurations compatible with the
offered ACS, SCS and MACS, according to table B.1. Since the number of
compatible payload formats can be large, implementations should select a
reasonable subset of the higher-priority payload formats for inclusion in the
SDP. When translating a list of Single Codec information elements into SDP,
duplicate payload types (matching on all parameters) shall be removed.
The following guidelines shall apply when translating from an SDP payload
format specification to a Single Codec information element:
\- If there is no \"mode-set\" parameter for a payload format in the SDP and
the SDP is to be translated into a Supported or Available Codec List, then the
corresponding Single Codec subfields shall be OM=1, MACS=8, all SCS modes
offered, and ACS modes offered. Alternatively it is sufficient to specify only
the Codec Type (see below) and omit the other parameters.
\- If there is no \"mode-set\" parameter for a payload format in an SDP answer
that is to be translated into a Selected Codec Type, then the corresponding
Single Codec subfields shall be derived from the payload type in the SDP offer
(to which the SDP answer was sent in response).
\- If there is a \"mode-set\" parameter for a payload format in the SDP, then
the corresponding Single Codec subfields shall be OM=0 and ACS modes selected
according to the value of \"mode-set\". The SCS shall be set identical to the
ACS and MACS shall be set to the number of modes in the ACS. If this \"mode-
set\" does not represent a valid configuration for the Codec Type (determined
by OoBTC procedures), then the payload format shall not be translated.
\- If a payload format in an SDP offer that is to be translated into a
Supported Codec List includes \"mode-change-period=2\" parameter or includes
\"mode-change-capability=2\" parameter, then the Codec Identification value
for the corresponding Single Codec shall be FR_AMR.
\- If a payload format in an SDP answer that is to be translated into a
Selected Codec Type or Available Codec List includes \"mode-change-period=2\",
then the Codec Identification value for the corresponding Single Codec shall
be one of FR_AMR, HR_AMR, OHR_AMR or UMTS_AMR_2, if offered in the Supported
Codec List.
\- If a payload format in an SDP offer that is to be translated into a
Supported Codec List does not include \"mode-change-period=2\" parameter and
does not include \"mode-change-capability=2\" parameter, then the Codec
Identification value for the corresponding Single Codec shall be UMTS_AMR.
\- If a payload format in an SDP answer that is to be translated into a
Selected Codec Type or Available Codec List does not include \"mode-change-
period=2\" parameter and does not include \"mode-change-capability=2\"
parameter, then the Codec Identification value for the corresponding Single
Codec shall be one of UMTS_AMR_2, FR_AMR, HR_AMR, OHR_AMR or UMTS_AMR, if
offered in the Supported Codec List.
### B.2.5.2 Codec parameters for 3GPP AMR-WB codecs
Table B.2 shows the correspondence between the codec format parameters in the
Single Codec information element (3GPP TS 26.103 [57]) and the SDP for the
3GPP wideband AMR codecs (IETF RFC 4867 [23]).
Table B.2: Mapping between Single Codec subfields and SDP parameters for 3GPP
AMR-WB codecs
+-------------+-------------+-------------+-------------+-------------+ | Single | SDP payload | | | | | Codec | format | | | | | information | parameters | | | | | element | | | | | +-------------+-------------+-------------+-------------+-------------+ | Codec | Con | Payload | Encoding | Other | | Ide | fig-WB-Code | Type number | name | Parameters | | ntification | | | | | | | | | | (NOTE 1) | +-------------+-------------+-------------+-------------+-------------+ | FR_AMR-WB | 0 | dynamic | AMR-WB | mod | | or | | | | e-set=0,1,2 | | | | | | | | OHR_AMR-WB | | | | | +-------------+-------------+-------------+-------------+-------------+ | OFR_AMR-WB | 0 | dynamic | AMR-WB | mod | | or\ | | | | e-set=0,1,2 | | U | | | | | | MTS_AMR-WB | | | | (NOTE 2) | +-------------+-------------+-------------+-------------+-------------+ | OFR_AMR-WB | 1 | dynamic\ | AMR-WB\ | mode | | or\ | | dynamic\ | AMR-WB\ | -set=0,1,2\ | | U | | dynamic | AMR-WB | mode-s | | MTS_AMR-WB | | | | et=0,1,2,8\ | | | | | | mode- | | | | | | set=0,1,2,4 | | | | | | | | | | | | (NOTE 2) | +-------------+-------------+-------------+-------------+-------------+ | OFR_AMR-WB | 2 | dynamic | AMR-WB | mode- | | or\ | | | | set=0,1,2,4 | | U | | | | | | MTS_AMR-WB | | | | (NOTE 2) | +-------------+-------------+-------------+-------------+-------------+ | OFR_AMR-WB | 3 | dynamic\ | AMR-WB\ | mode-s | | or\ | | dynamic\ | AMR-WB\ | et=0,1,2,4\ | | U | | dynamic | AMR-WB | mode-s | | MTS_AMR-WB | | | | et=0,1,2,8\ | | | | | | mod | | | | | | e-set=0,1,2 | | | | | | | | | | | | (NOTE 2) | +-------------+-------------+-------------+-------------+-------------+ | OFR_AMR-WB | 4 | dynamic | AMR-WB | mode- | | or\ | | | | set=0,1,2,8 | | U | | | | | | MTS_AMR-WB | | | | (NOTE 2) | +-------------+-------------+-------------+-------------+-------------+ | OFR_AMR-WB | 5 | dynamic\ | AMR-WB\ | mode-s | | or\ | | dynamic\ | AMR-WB\ | et=0,1,2,8\ | | U | | dynamic | AMR-WB | mode-s | | MTS_AMR-WB | | | | et=0,1,2,4\ | | | | | | mod | | | | | | e-set=0,1,2 | | | | | | | | | | | | (NOTE 2) | +-------------+-------------+-------------+-------------+-------------+ | NOTE 1: | | | | | | Payload | | | | | | types for | | | | | | FR_AMR-WB, | | | | | | OHR_AMR-WB | | | | | | and | | | | | | OFR_AMR-WB | | | | | | shall | | | | | | include the | | | | | | \" | | | | | | mode-change | | | | | | -period=2\" | | | | | | and | | | | | | \"mode | | | | | | -change-cap | | | | | | ability=2\" | | | | | | parameters | | | | | | and should | | | | | | include the | | | | | | \" | | | | | | mo | | | | | | de-change-n | | | | | | eighbor=1\" | | | | | | parameter. | | | | | | | | | | | | NOTE 2: | | | | | | Payload | | | | | | types for | | | | | | U | | | | | | MTS_AMR-WB | | | | | | should | | | | | | include the | | | | | | \"m | | | | | | ode-change- | | | | | | period=2\", | | | | | | \"mode | | | | | | -change-cap | | | | | | ability=2\" | | | | | | and | | | | | | \"mo | | | | | | de-change-n | | | | | | eighbor=1\" | | | | | | parameters, | | | | | | normally | | | | | | used for | | | | | | signalling | | | | | | GSM AMR-WB | | | | | | codecs, to | | | | | | assure | | | | | | end-to-end | | | | | | inter | | | | | | operability | | | | | | with OoBTC | | | | | | and TFO. | | | | | | Its actual | | | | | | c | | | | | | apabilities | | | | | | would | | | | | | otherwise | | | | | | be | | | | | | signalled | | | | | | without | | | | | | these | | | | | | parameters. | | | | | +-------------+-------------+-------------+-------------+-------------+
When translating from a Single Codec information element to the equivalent SDP
payload format parameters, the SDP shall include a distinct payload type and
any associated parameters for each row in the table that matches the Config-
WB-Code parameter. For example, OFR_AMR-WB with Config-WB-Code=3 can generate
three SDP payload types for AMR-WB, each including the \"mode-change-
period=2\" parameter, the \"mode-change-neighbor=1\" parameter, and the
\"mode-set\" parameter with value sets \"0,1,2,4\", \"0,1,2,8\", and
\"0,1,2\", respectively. When translating a list of Single Codec information
elements into SDP, duplicate payload types (matching on all parameters) shall
be removed.
The following guidelines shall apply when translating from one or more SDP
payload format specifications to a Single Codec information element:
\- Payload formats that match except for different values of \"mode-set\"
shall be represented with the fewest values of Config-WB-Code, while retaining
the priority represented by the order of the payload formats in the SDP. For
example, three SDP payload types for AMR-WB, each including the \"mode-change-
period=2\" parameter, the \"mode-change-neighbor=1\" parameter, and the
\"mode-set\" parameter with value sets \"0,1,2,4\", \"0,1,2,8\", and
\"0,1,2\", respectively, will generate Config-WB-Code=3.
\- If there is no \"mode-set\" parameter for a payload format in the SDP and
the SDP is to be translated into a Supported or Available Codec List, then the
corresponding Single Codec shall have a Config-WB-Code value of 1.
\- If there is no \"mode-set\" parameter for a payload format in an SDP answer
that is to be translated into a Selected Codec Type, then the corresponding
Config-WB-Code value shall be derived from the payload type in the SDP offer
(to which the SDP answer was sent in response).
\- If a payload format in an SDP offer that is to be translated into a
Supported Codec List includes \"mode-change-period=2\" parameter or includes
\"mode-change-capability=2\" parameter, then the Codec Identification value
for the corresponding Single Codec shall be OFR_AMR-WB.
\- If a payload format in an SDP answer is to be translated into a Selected
Codec Type or Available Codec List, then the Codec Identification value for
the corresponding Single Codec shall be one of OFR_AMR-WB, FR_AMR-WB, OHR_AMR-
WB or UMTS_AMR-WB, if offered in the Supported Codec List.
\- If a payload format in an SDP offer that is to be translated into a
Supported Codec List does not include \"mode-change-period=2\" parameter and
does not include \"mode-change-capability=2\" parameter, then the payload
format shall not be translated.
### B.2.5.3 Codec parameters for 3GPP non-AMR codecs
Table B.3 shows the correspondence between the codec format parameters in the
Single Codec information element (3GPP TS 26.103 [57]) and the SDP for the
3GPP non-AMR codecs (IETF RFC 4867 [23], IETF RFC 3551 [52], IETF RFC 3555
[53] and IETF RFC 5993 [114]).
Table B.3: Mapping between Single Codec subfields and SDP parameters for 3GPP
non-AMR codecs
+----------------+----------------+---------------+----------------+ | Single Codec | SDP payload | | | | information | format | | | | element | parameters | | | +----------------+----------------+---------------+----------------+ | Codec | Payload Type | Encoding name | Other | | Identification | number | | Parameters | +----------------+----------------+---------------+----------------+ | GSM FR | 3 | GSM | | +----------------+----------------+---------------+----------------+ | GSM HR | dynamic | GSM-HR-08 | | +----------------+----------------+---------------+----------------+ | GSM EFR (NOTE | dynamic | GSM-EFR | | | 1) | | | | +----------------+----------------+---------------+----------------+ | GSM EFR (NOTE | dynamic | AMR | mode-set=7 | | 2) | | | | +----------------+----------------+---------------+----------------+ | TDMA EFR (NOTE | dynamic | AMR | mode-set=4 | | 2) | | | | +----------------+----------------+---------------+----------------+ | PDC EFR (NOTE | dynamic | AMR | mode-set=3 | | 2) | | | | +----------------+----------------+---------------+----------------+ | NOTE 1: This | | | | | translation | | | | | for GSM EFR | | | | | (GSM-EFR) is | | | | | preferred to | | | | | the | | | | | alternative | | | | | (AMR | | | | | mode-set=7) if | | | | | it is | | | | | supported by | | | | | the IM-MGW. | | | | | | | | | | NOTE 2: AMR | | | | | DTX is not | | | | | compatible | | | | | with the DTX | | | | | schemes for | | | | | any of the | | | | | codecs in this | | | | | list. The | | | | | IM-MGW may | | | | | support these | | | | | configurations | | | | | without | | | | | transcoding by | | | | | providing | | | | | interworking | | | | | between the | | | | | DTX procedures | | | | | and frame | | | | | encodings on | | | | | the bearer | | | | | interfaces to | | | | | the BICC CS | | | | | network and | | | | | the IM CN | | | | | subsystem. | | | | +----------------+----------------+---------------+----------------+
### B.2.5.4 Codec parameters for ITU-T codecs
Table B.4 shows the correspondence between the codec format parameters in the
Single Codec information element (Clause 11.1.7 of ITU-T Q.765.5 [35]) and the
SDP for the ITU-T codecs (Table 4 of RFC 3551 [52], and RFC 3555 [53]).
Table B.4: Mapping between Single Codec subfields and SDP parameters for ITU-T
codecs
* * *
Single Codec information element SDP payload format parameters
Codec Type subfield Codec Name Codec Configuration subfield (dcba) Payload
Type number Encoding name Other Parameters
00000001 G.711 64 kbit/s A-law N/A 8 PCMA
00000010 G.711 64 kbit/s μ-law N/A 0 PCMU
00000011 G.711 56 kbit/s A-law N/A N/A N/A
00000100 G.711 56 kbit/s μ-law N/A N/A N/A
00000101 G.722 (SB-ADPCM) N/A 9 G722
00000110 G.723.1 N/A 4 G723 annexa=no
00000111 G.723.1 Annex A (silence suppression) N/A 4 G723
00001000 G.726 (ADPCM) xxx1\ dynamic\ G726-16\  
xx1x\ dynamic\ G726-24\  
x1xx\ dynamic\ G726-32\  
1xxx dynamic G726-40
00001001 G.727 (Embedded ADPCM) xxxx N/A N/A
00001010 G.728 111\ 15 G728  
(subsets of defined rates not supported)
00001011 G.729 (CS-ACELP) xx1\ dynamic\ G729D\ annexb=no\ x1x\ 18\ G729\
annexb=no\ 1xx dynamic G729E annexb=no
00001100 G.729 Annex B (silence suppression) xx1\ dynamic\ G729D\  
x1x\ 18\ G729\  
1xx dynamic G72\"E\"
NOTE: An \"x\" in a bit position of the Codec Configuration subfield indicates
a \"don\'t care\" value. The SDP payload description for each listed codec
includes a clock rate of 8000 Hz. TS 26.102 [50] only describes the BICC CS
network framing for the PCM codecs.
* * *
When translating from a Single Codec information element to the equivalent SDP
payload format parameters, the SDP shall include a distinct payload type and
any associated parameters for each matching instance of the Codec
Configuration subfield. For example, G.726 (ADPCM) with Codec Configuration
subfield \"0101\" shall generate SDP payload types for G726-32 and G726-16.
When translating from an SDP payload format specification to the Single Codec
information element, each SDP payload type should be represented by one
matching Single Codec information element. For example, SDP payload types for
G729 and G729E may generate one Single Codec information element for \"G.729
Annex B\" with Codec Configuration subfield \"110\". The G729 and G729E codecs
may alternately be represented by two Single Codec information elements for
\"G.729 Annex B\" with Codec Configuration subfields \"100\" and \"010\",
respectively, if it is necessary to indicate preference between them.
#### B.2.5.5 Codec parameters for 3GPP EVS codec
Table B.2.5.5.1 and table B.2.5.5.2 show the correspondence between the codec
format parameters in the Single Codec information element (3GPP TS 26.103
[57]) and the SDP for the 3GPP EVS codec (3GPP TS 26.445 [147]).
Table B.2.5.5.1: Mapping from Single Codec subfields UMTS_EVS (Config-EVS-Code
/ Config-EVS-Code 2) to SDP parameters for 3GPP EVS codec
+-------------+-------------+-------------+-------------+-------------+ | Single | SDP payload | | | | | Codec | format | | | | | information | parameters | | | | | element | | | | | +-------------+-------------+-------------+-------------+-------------+ | Codec Type | Conf | Payload | Encoding | Other | | | ig-EVS-Code | Type number | name | Parameters | | | / | | | (NOTE 1) | | | Conf | | clock rate | | | | ig-EVS-Code | | | | | | 2 (NOTE 2) | | encoding | | | | | | parameters | | +-------------+-------------+-------------+-------------+-------------+ | UMTS_EVS | 0 | Dynamic | EVS | br=5.9-8 | | | | | | | | | | | 16000 | bw=nb-wb | | | | | | | | | | | 1 | mode-set=0 | | | | | | | | | | | | mode-chang | | | | | | e-period=2\ | | | | | | [mode- | | | | | | change-capa | | | | | | bility=2]\ | | | | | | mode-change | | | | | | -neighbor=1 | | | | | | | | | | | | [d | | | | | | tx-recv=1] | | | | | | | | | | | | [dtx=1] | | | | | | | | | | | | cmr=1 | | | | | | | | | | | | ch | | | | | | -aw-recv=-1 | +-------------+-------------+-------------+-------------+-------------+ | UMTS_EVS | 1 | Dynamic | EVS | br=5.9-13.2 | | | | | | | | | | | 16000 | bw=nb-swb | | | | | | | | | | | 1 | mode-set=0, | | | | | | 1, 2 | | | | | | | | | | | | mode-chang | | | | | | e-period=2\ | | | | | | [mode- | | | | | | change-capa | | | | | | bility=2]\ | | | | | | mode-change | | | | | | -neighbor=1 | | | | | | | | | | | | [d | | | | | | tx-recv=1] | | | | | | | | | | | | [dtx=1]\ | | | | | | cmr=1 | | | | | | | | | | | | ch-aw- | | | | | | recv={-1;0} | +-------------+-------------+-------------+-------------+-------------+ | UMTS_EVS | 2 | Dynamic | EVS | br=5.9-24.4 | | | | | | | | | | | 16000 | bw=nb-fb | | | | | | | | | | | 1 | mode-set=0, | | | | | | 1, 2 | | | | | | | | | | | | mode-chang | | | | | | e-period=2\ | | | | | | [mode- | | | | | | change-capa | | | | | | bility=2]\ | | | | | | mode-change | | | | | | -neighbor=1 | | | | | | | | | | | | [d | | | | | | tx-recv=1] | | | | | | | | | | | | [dtx=1]\ | | | | | | cmr=1 | | | | | | | | | | | | ch-aw- | | | | | | recv={-1;0} | +-------------+-------------+-------------+-------------+-------------+ | UMTS_EVS | 3 (NOTE 3) | Dynamic | EVS | br=9.6-13.2 | | | | | | | | | | | 16000 | bw=swb | | | | | | | | | | | 1 | mode-set=0, | | | | | | 1, 2 | | | | | | | | | | | | mode-chang | | | | | | e-period=2\ | | | | | | [mode- | | | | | | change-capa | | | | | | bility=2]\ | | | | | | mode-change | | | | | | -neighbor=1 | | | | | | | | | | | | [d | | | | | | tx-recv=1] | | | | | | | | | | | | [dtx=1]\ | | | | | | cmr=1 | | | | | | | | | | | | ch-aw- | | | | | | recv={-1;0} | +-------------+-------------+-------------+-------------+-------------+ | NOTE 1: | | | | | | Square | | | | | | brackets | | | | | | \"[ ]\" | | | | | | indicate | | | | | | that the | | | | | | enclosed | | | | | | parameters | | | | | | may be | | | | | | omitted. | | | | | | Curved | | | | | | brackets | | | | | | \"{ }\" | | | | | | indicate a | | | | | | list of | | | | | | alternative | | | | | | values, | | | | | | separated | | | | | | by \";\". | | | | | | | | | | | | NOTE 2: If | | | | | | both | | | | | | Conf | | | | | | ig-EVS-Code | | | | | | and | | | | | | Conf | | | | | | ig-EVS-Code | | | | | | 2 subfields | | | | | | are | | | | | | included in | | | | | | the Single | | | | | | Codec | | | | | | information | | | | | | element, | | | | | | the SDP | | | | | | includes a | | | | | | distinct | | | | | | payload and | | | | | | any | | | | | | associated | | | | | | parameter | | | | | | for each | | | | | | subfield. | | | | | | | | | | | | NOTE 3: | | | | | | This value | | | | | | is not | | | | | | applicable | | | | | | to | | | | | | Conf | | | | | | ig-EVS-Code | | | | | | 2 subfield. | | | | | +-------------+-------------+-------------+-------------+-------------+
When translating a list of Single Codec information elements into SDP,
duplicate payload types (matching on all parameters) shall be removed.
NOTE: the number of Codecs included in the BICC-Offer is limited to 8. It is
therefore not always possible to include more than one EVS Single Codec
information element in a BICC-Offer. The EVS Single Codec information element
can contain up to 2 EVS configurations in a BICC-Offer.
Table B.2.5.5.2: Mapping from SDP parameters for 3GPP EVS to Single Codec
subfields UMTS_EVS (Config-EVS-Code / Config-EVS-Code 2)
+-------------+-------------+-------------+------------+-------------+ | SDP payload | Single | | | | | format | Codec | | | | | parameters | Information | | | | | | Element | | | | +-------------+-------------+-------------+------------+-------------+ | Payload | encoding | Other | Codec Type | Confi | | Type number | name | Parameters | | g-EVS-Code/ | | | | (NOTE 1) | | Conf | | | clock rate | | | ig-EVS-Code | | | | | | 2 (NOTE 3) | | | encoding | | | | | | parameters | | | | | | (NOTE 1) | | | | +-------------+-------------+-------------+------------+-------------+ | Dynamic | EVS | br=5 | UMTS_EVS | 0 if no | | | | .9[-br2]; | | br2; | | | 16000 | br2 = {8; | | | | | | ....128} | | 0 if br2=8; | | | [1] | | | | | | | b | | 1 if | | | | w=nb-bw2]; | | br2=13.2; | | | | bw2 | | | | | | = | | 2 if | | | | {wb;swb;fb} | | br2=24.4; | | | | | | | | | | [dtx=1] | | 2 if br2 > | | | | | | 24.4 | | | | [m | | | | | | ode-set={0; | | | | | | 0,1,2}]\ | | | | | | [m | | | | | | ode-change- | | | | | | period=2]\ | | | | | | [mode- | | | | | | change-capa | | | | | | bility=2]\ | | | | | | [mo | | | | | | de-change-n | | | | | | eighbor=1] | | | | | | | | | | | | [ | | | | | | cmr={0,1}] | | | | | | NOTE 2 | | | +-------------+-------------+-------------+------------+-------------+ | Dynamic | EVS\ | br=9.6-br2; | UMTS_EVS | 3 (NOTE 4) | | | 16000\ | br2 = | | | | | [1] | {13.2; | | | | | | ...128} | | | | | | | | | | | | bw=swb | | | | | | | | | | | | [dtx=1] | | | | | | | | | | | | [m | | | | | | ode-set={0; | | | | | | 0,1,2}]\ | | | | | | [m | | | | | | ode-change- | | | | | | period=2]\ | | | | | | [mode- | | | | | | change-capa | | | | | | bility=2]\ | | | | | | [mo | | | | | | de-change-n | | | | | | eighbor=1] | | | | | | | | | | | | [ | | | | | | cmr={0,1}] | | | | | | NOTE 2 | | | +-------------+-------------+-------------+------------+-------------+ | NOTE 1: | | | | | | Square | | | | | | brackets | | | | | | \"[ ]\" | | | | | | indicate | | | | | | that the | | | | | | enclosed | | | | | | parameters | | | | | | may be | | | | | | omitted. | | | | | | Curved | | | | | | brackets | | | | | | \"{ }\" | | | | | | indicate a | | | | | | list of | | | | | | alternative | | | | | | values, | | | | | | separated | | | | | | by \";\". | | | | | | | | | | | | NOTE 2: | | | | | | This | | | | | | mapping | | | | | | also | | | | | | applies if | | | | | | a cmr | | | | | | parameter | | | | | | with a | | | | | | value | | | | | | \"-1\" is | | | | | | received in | | | | | | the SDP | | | | | | body and if | | | | | | the IM-MGW | | | | | | supports | | | | | | R | | | | | | TCP-APP-CMR | | | | | | message as | | | | | | described | | | | | | in | | | | | | subclause | | | | | | 8.1.1.3.5. | | | | | | | | | | | | NOTE 3: If | | | | | | the Single | | | | | | Codec | | | | | | Information | | | | | | Element is | | | | | | included in | | | | | | a Selected | | | | | | Codec | | | | | | (BICC), | | | | | | only | | | | | | Conf | | | | | | ig-EVS-Code | | | | | | is | | | | | | included. | | | | | | | | | | | | NOTE 4: | | | | | | This value | | | | | | is not | | | | | | applicable | | | | | | to | | | | | | Conf | | | | | | ig-EVS-Code | | | | | | 2 subfield. | | | | | +-------------+-------------+-------------+------------+-------------+
The IM-MGW can handle the call without transcoding only if the received SDP
offer or SDP answer is compliant with one of the entries in table B.2.5.5.2.
The following guidelines shall apply when translating from one or more SDP
payload format specifications to a Single Codec information element:
\- Payload formats that match except for different values of \"mode-set\"
shall be represented with the fewest values of Config-EVS-Code 1 and
optionally Config-EVS-Code 2, while retaining the priority represented by the
order of the payload formats in the SDP.
# B.3 MGCF - IM-MGW interaction during interworking of codec negotiation
## B.3.1 Basic IM CN subsystem originated session
This clause shows an example of the interworking of codec negotiation between
an IM CN subsystem and a BICC CS network during session establishment for an
IM CN subsystem originated session. The example applies to BICC forward bearer
establishment. Similar procedures apply to the other four versions of bearer
establishment procedure applicable to the BICC CS network. The exchange of
codec information is identical in all five cases, but there are differences in
the sequence of operations associated with bearer establishment within the
BICC CS network.
## B.3.1.1 BICC forward bearer establishment
#### B.3.1.1.1 IM-MGW selection
The MGCF shall select an IM-MGW for the bearer connection before it performs
the CS network side bearer establishment. This may happen either before
sending the IAM or after receiving the APM message (signal 3 or signal 4 in
figure B.1). In the latter case, the IM-MGW selection may be based on a
possibly received MGW-id from the succeeding node.
#### B.3.1.1.2 CS network side bearer establishment
The MGCF shall either select bearer characteristics or request the IM-MGW to
select and provide the bearer characteristics for the CS network side bearer
connection before sending the IAM. In the latter case the MGCF shall use the
Prepare Bearer procedure, not shown in figure B.1, to request the IM-MGW to
select the bearer characteristics. After the succeeding node has provided a
bearer address and a binding reference in the APM, the MGCF shall use the
Establish Bearer procedure to request the IM-MGW to establish a bearer towards
the destination CS-MGW. The MGCF shall provide the IM-MGW with the bearer
address, the binding reference and the bearer characteristics (signal 5 in
figure B.1).
#### B.3.1.1.3 IM CN subsystem side session establishment
When the MGCF receives the Selected Codec from the succeeding serving node in
the CS network (signal 4 in figure B.1) and selects a codec for use in the IM
CN subsystem, the MGCF shall initiate the Reserve IMS Connection Point and
Configure Remote Resources procedure (signal 7 and 8 in figure B.1). From the
received SDP and selected configuration data the MGCF:
\- Shall send the appropriate remote codec(s), the remote UDP port and the
remote IP address to the IM-MGW. The remote UDP port and IP address refer to
the destination of user plane data sent towards the IM CN subsystem. The
remote codec(s) are the codec(s) the IM-MGW may select for user plane data
sent towards the IM CN subsystem.
\- Shall indicate to the IM-MGW the appropriate local codec(s) and request a
local IP address and UDP port. The local IP address and UDP port are used by
the IM-MGW to receive user plane data from the IM CN subsystem. The local
codec(s) are the codec(s) the IM-MGW may select to receive user plane data
from the IM CN subsystem.
\- If DTMF support together with speech support is required, the reserve value
indicator shall be set to \"true\".
The IM-MGW:
\- Shall reply to the MGCF with the selected local codec(s) and the selected
remote codec(s) and the selected local UDP port and IP address.
\- Shall reserve resources for those codec(s).
The MCGF shall send the local codec(s), UDP port and IP address to the IMS in
the Session Progress (signal 9 in figure B.1).
#### B.3.1.1.4 Through-connection
During the Prepare Bearer and Establish Bearer procedures, the MGCF shall
either use the Change Through-Connection procedure to request the IM-MGW to
backward through-connect the BICC terminations, or the MGCF shall use this
procedure to both-way through-connect the BICC termination already on this
stage (signal 5 in figure B.1). During the Reserve IMS Connection Point
procedure:
\- if the MGCF has been identified a call as an \"ICS call\" as specified in
clause 7.3.3.1.2.n the MGCF shall request the IM‑MGW to suspend sending media
towards the IMS side by setting the through-connection of the IM CN subsystem
side termination to \"not through-connected\" using the Change IMS
Through‑Connection procedure (signal 7 in figure B.1); and
\- otherwise the MGCF shall use the Change IMS Through-Connection procedure to
request the IM-MGW to backward through-connect the IMS termination (signal 7
in figure B.1).
When the MGCF receives the BICC:ANM answer indication, it shall request the
IM-MGW to both-way through-connect the termination using the Change Through-
Connection or Change IMS Through-Connection procedures (signal 20 in figure
B.1), unless those terminations are already both-way through-connected.
#### B.3.1.1.5 Codec handling
The IM-MGW may include a speech transcoder based upon the speech coding
information provided to each termination.
#### B.3.1.1.6 Failure handling in MGCF
If any procedure between the MGCF and the IM-MGW is not completed successfully
the default action by the MGCF is to release the session, as described in
clause 9.2.6. If the MGCF receives a Bearer Released procedure from the IM-MGW
the default action by the MGCF is to release the session as described in
clause 9.2.7.
NOTE: As an implementation option the MGCF may also decide for example to only
release the resources in the IM-MGW that caused the failure, possibly select a
new IM-MGW for the connection and continue the call establishment using new
resources in the selected IM-MGW but such handling is outside of the scope of
the present document.
#### B.3.1.1.7 Message sequence chart
Figure B.1 shows the message sequence chart for the IM CN subsystem
originating session with BICC forward bearer establishment where the selection
of IM-MGW is done after receipt of the APM. The MGCF then requests the seizure
of a CS network side bearer termination and the establishment of the bearer.
When the MGCF receives an answer indication, it requests the IM-MGW to both-
way through-connect the terminations.
Figure B.1: Basic IM CN Subsystem originating session, BICC forward bearer
establishment\ (message sequence chart)
## B.3.2 Basic CS network originated session
This clause shows an example of the interworking of codec negotiation between
a BICC CS network and an IM CN subsystem during session establishment for a
BICC CS network originated session. The example applies to BICC forward bearer
establishment. Similar procedures apply to the other four versions of bearer
establishment procedure applicable to the BICC CS network. The exchange of
codec information is identical in all five cases, but there are differences in
the sequence of operations associated with bearer establishment within the
BICC CS network.
### B.3.2.1 BICC forward bearer establishment
#### B.3.2.1.1 IM-MGW selection
The MGCF shall select an IM-MGW for the bearer connection before it performs
the IM CN subsystem session establishment or the CS network side bearer
establishment.
#### B.3.2.1.2 IM CN subsystem side termination reservation
The MGCF shall derive from the codec negotiation procedure one or several
appropriate local codec(s) the IM-MGW may use to receive user plane data from
the IM CN subsystem. The MGCF shall use the Reserve IMS Connection Point
procedure (signals 2 and 3 in figure B.2/1). Within this procedure, the MGCF
shall indicate the local codec(s) and request a local IP address and UDP port
from the IM-MGW. The local IP address and UDP port are used by the IM-MGW to
receive user plane data from the IM CN subsystem. If DTMF support together
with speech support is required, or if the resources for multiple speech
codecs shall be reserved at this stage, the reserve value indicator shall be
set to \"true\".
The IM-MGW shall reply to the MGCF with the selected local codec(s) and the
selected local IP address and UDP port.
The MGCF shall send this information in the INVITE (signal 4 in figure B.2/1)
to the IM CN subsystem.
#### B.3.2.1.3 IM CN subsystem side session establishment
The MGCF shall use the Configure IMS Resources procedure (signals 7 and 8 in
figure B.2/1) to provide configuration data (derived from SDP received in
signal 6 in figure B.2/1 and the codec negotiation procedure) to the IM-MGW as
detailed below:
\- The MGCF shall indicate the remote IP address and UDP port, i.e. the
destination IP address and UDP port for data sent in the user plane towards
the IM CN subsystem,
\- The MGCF shall indicate the remote codec(s), i.e. the speech codec(s) for
data sent in the user plane towards the IM CN subsystem.
\- The MGCF may indicate the local codec(s) and the local IP address and UDP
port. The MGCF shall indicate the local codec(s) if a change is required.
\- IF DTMF support together with speech support is required, the reserve value
indicator shall be set to \"true\".
The IM-MGW shall reply with the selected remote codec(s) and reserve resources
for these codec(s). If local codec(s) were received, the IM-MGW shall also
reply with the selected local codec(s) and reserve the corresponding
resources.
If the selected local codec(s) differ from the codec(s) received in the SDP of
signal 6 in figure B.2/1, the MGCF shall send the local reserved codec(s), and
the local IP address and UDP port in the PRACK (signal 9 in figure B.2/1) to
the IMS.
#### B.3.2.1.4 CS network side bearer establishment
The MGCF shall request the IM-MGW to prepare for the CS network side bearer
establishment using the Prepare Bearer procedure (signals 11 and 12 in figure
B.2/1). Within this procedure, the MGCF shall request the IM-MGW to provide a
bearer address, a binding reference and optionally notify when the bearer is
established. The MGCF shall also provide the IM-MGW with the bearer
characteristics determined by the codec negotiation procedure. After the IM-
MGW has replied with the bearer address and the binding reference, the MGCF
provides the APM message (signal 13 in figure B.2/1) to the preceding node.
The MGCF may also provide the IM-MGW-id in the APM message.
#### B.3.2.1.5 Called party alerting
The MGCF shall request the IM-MGW to provide an awaiting answer indication
(ringing tone) to the calling party using the Send Tone procedure (signals 21
and 22 in figure B.2/1), when the following condition is satisfied:
\- the MGCF receives the first 180 Ringing message
#### B.3.2.1.6 Called party answer
When the MGCF receives a 200 OK message (signal 23 in figure B.2/2), it shall
request the IM-MGW to stop providing the ringing tone to the calling party
using the Stop Tone procedure (signals 26 and 27 in figure B.2/2).
#### B.3.2.1.7 Through-Connection
During the Prepare Bearer procedure, the MGCF shall either use the Change
Through-Connection procedure to request the IM-MGW to backward through-connect
the BICC termination, or the MGCF shall use this procedure to both-way
through-connect the BICC termination already on this stage (signals 11 and 12
in figure B.2/1). During the Reserve IMS Connection Point procedure, the MGCF
shall use the Change IMS Through-Connection procedure to request the IM-MGW to
backward through-connect the IMS termination (signals 2 and 3 in figure
B.2/1).
When the MGCF receives the SIP 200 OK(INVITE) (signal 23 in figure B.2/2), it
requests the IM-MGW to both-way through-connect the terminations using the
Change IMS Through-Connection or Change Through-Connection procedures (signals
28 and 29 in figure B.2/2), unless those terminations are already both-way
through-connected.
#### B.3.2.1.8 Codec handling
The IM-MGW may include a speech transcoder based upon the speech coding
information provided to each termination.
#### B.3.2.1.9 Failure handling in MGCF
If any procedure between the MGCF and the IM-MGW is not completed
successfully, the default action by the MGCF is to release the session as
described in clause 9.2.6. If the MGCF receives a Bearer Released procedure
from the IM-MGW the default action by the MGCF is to release the session, as
described in clause 9.2.7.
NOTE: As an implementation option the MGCF may also decide for example to only
release the resources in the IM-MGW that caused the failure, possibly select a
new IM-MGW for the connection and continue the call establishment using new
resources in the selected IM-MGW but such handling is outside of the scope of
the present document.
#### B.3.2.1.10 Message sequence chart
Figures B.2/1 and B.2/2 show the message sequence chart for the CS network
originating session with BICC forward bearer establishment.
Figure B.2/1: Basic CS Network Originating Session, BICC forward bearer
establishment\ (message sequence chart)
Figure B.2/2: Basic CS Network Originating Session, BICC forward bearer
establishment\ (message sequence chart continued)
## B.3.3 CS network initiated mid-call codec negotiation
Figure B.3 shows the CS network initiated mid-call codec negotiation procedure
interworking with the IM CN subsystem. When the MGCF selects the codecs for
the CS network and the IM CN subsystem (after signal 3 in figure B.3), the
MGCF shall modify the CS network termination and the IM CN subsystem
termination on the IM-MGW to conform to the newly selected configuration data
on the two interfaces. The MGCF may perform bearer operations (not shown) at
the IM-MGW before interworking the initial codec modification request (signal
2 in figure B.3) to determine new connection information, if necessary, or to
verify resource availability.
Figure B.3: CS network initiated mid-call codec negotiation\ (message sequence
chart)
## B.3.4 IM CN subsystem initiated mid-call codec negotiation
Figure B.4 shows the IM CN subsystem initiated mid-call codec negotiation
procedure interworking with a BICC CS network. When the MGCF selects the
codecs for the CS network and the IM CN subsystem (after signal 3 in figure
B.4), the MGCF shall modify the CS network termination and the IM CN subsystem
termination on the IM-MGW to conform to the newly selected configuration data
on the two interfaces. The MGCF may perform bearer operations (not shown) at
the IM-MGW before interworking the initial codec modification request (signal
2 in figure B.3) to determine new connection information, if necessary, or to
verify resource availability. The MGCF may also perform bearer operations (not
shown) at the IM-MGW after sending the final APM (signal 8 in figure B.4) to
modify transport bandwidth, if necessary.
Figure B.4: IM CN subsystem initiated mid-call codec negotiation\ (message
sequence chart)
###### ## Annex C (normative): Interworking of CPC parameter
The CPC extension to tel-URI Parameter is defined in clause 7.2A.12 of 3GPP TS
24.229 [9]. The SIP \"Accept-Language\" header is defined in IETF RFC 3261
[19].
# C.1 Interworking SIP to ISUP
Table C.1.1 shows the mapping of a \"cpc\" URI parameter received within tel
URI or the userinfo part of SIP URI with user=\"phone\" in a P-Asserted-
Identity header in the initial INVITE request to the Calling party\'s category
parameter in the ISUP IAM. When the \"cpc\" URI parameter value \"operator\"
is received the I-MGCF shall use an Accept-Language header field to determine
the value of the Calling party\'s category parameter.
Table C.1.1: Mapping of the CPC parameter to the ISUP Calling party\'s
category parameter
+------------------------+-----------------+------------------------+ | SIP Parameters | ISUP Parameters | | +------------------------+-----------------+------------------------+ | \"cpc\" URI parameter | Accept-Language | Calling party\'s | | in\ | | category | | P-Asserted-Identity | | | | (NOTE 2) | | | +------------------------+-----------------+------------------------+ | operator | fr | operator, language | | | | French | +------------------------+-----------------+------------------------+ | operator | en | operator, language | | | | English | +------------------------+-----------------+------------------------+ | operator | de | operator, language | | | | German | +------------------------+-----------------+------------------------+ | operator | ru | operator, language | | | | Russian | +------------------------+-----------------+------------------------+ | operator | es | operator, language | | | | Spanish | +------------------------+-----------------+------------------------+ | ordinary | | ordinary calling | | | | subscriber | +------------------------+-----------------+------------------------+ | test | | test call | +------------------------+-----------------+------------------------+ | payphone | | payphone | +------------------------+-----------------+------------------------+ | unknown | | calling party\'s | | | | category unknown at | | | | this time (national | | | | use) | +------------------------+-----------------+------------------------+ | mobile-hplmn | | mobile terminal | | | | located in the home | | | | PLMN | +------------------------+-----------------+------------------------+ | mobile-vplmn | | mobile terminal | | | | located in a visited | | | | PLMN | +------------------------+-----------------+------------------------+ | emergency | | emergency service call | | | | per ANSI Standard | | | | ATI | | | | S-1000113.2005 [117] | | | | (NOTE 1) | +------------------------+-----------------+------------------------+ | NOTE 1: This is a | | | | national/regional | | | | specific value. | | | | Interworking shall | | | | only occur when | | | | interconnecting with | | | | indicated national | | | | network. | | | | | | | | NOTE 2: In case the | | | | \"cpc\" URI parameter | | | | is absent or contains | | | | values that are not | | | | mapped per this table | | | | then the ISUP shall | | | | contain the default | | | | CPC value \"ordinary | | | | calling subscriber\". | | | +------------------------+-----------------+------------------------+
In case the Accept-Language header field is not received or contains values
that are not in this table then based on operator policy the Calling party\'s
category parameter shall contain the CPC value \"operator, language X\" (where
X is one of the following languages: French, English, German, Russian or
Spanish) or national/regional specific value.
# C.2 Interworking ISUP to SIP
Table C.2.1 shows the mapping of a Calling party\'s category received in an
ISUP IAM to a \"cpc\" URI parameter within tel URI or the userinfo part of SIP
URI with user=\"phone\" in the P-Asserted-Identity header. When the Calling
party\'s category parameter value \"operator, language x\" is received the
O-MGCF shall generate an Accept-Language header field with the value that
corresponds to language x.
Table C.2.1: Mapping of the ISUP Calling party\'s category parameter to the
CPC parameter
+------------------------+------------------------+-----------------+ | ISUP Parameter | SIP Parameters | | +------------------------+------------------------+-----------------+ | calling party\'s | \"cpc\" URI parameter | Accept-Language | | category | in P-Asserted-Identity | | +------------------------+------------------------+-----------------+ | operator, language | operator | fr | | French | | | +------------------------+------------------------+-----------------+ | operator, language | operator | en | | English | | | +------------------------+------------------------+-----------------+ | operator, language | operator | de | | German | | | +------------------------+------------------------+-----------------+ | operator, language | operator | ru | | Russian | | | +------------------------+------------------------+-----------------+ | operator, language | operator | es | | Spanish | | | +------------------------+------------------------+-----------------+ | ordinary calling | ordinary | - | | subscriber | | | +------------------------+------------------------+-----------------+ | test call | test | | +------------------------+------------------------+-----------------+ | payphone | payphone | | +------------------------+------------------------+-----------------+ | calling party\'s | unknown | | | category unknown at | | | | this time (national | | | | use) | | | +------------------------+------------------------+-----------------+ | mobile terminal | mobile-hplmn | | | located in the home | | | | PLMN | | | +------------------------+------------------------+-----------------+ | mobile terminal | mobile-vplmn | | | located in a visited | | | | PLMN | | | +------------------------+------------------------+-----------------+ | emergency service call | emergency | | | per ANSI Standard | | | | ATI | | | | S-1000113.2005 [117] | | | | (NOTE 1) | | | +------------------------+------------------------+-----------------+ | NOTE 1: This is a | | | | national/regional | | | | specific value. | | | | Interworking shall | | | | only occur when | | | | interconnecting with | | | | indicated national | | | | network. | | | | | | | | NOTE 2: In case the | | | | calling party\'s | | | | category contains | | | | values that are not in | | | | this table then based | | | | on operator policy the | | | | \"cpc\" URI parameter | | | | may be omitted or may | | | | contain | | | | national/regional | | | | specific value. | | | +------------------------+------------------------+-----------------+
###### ## Annex D (informative): Void
###### ## Annex E (normative): Multimedia interworking between the IP
Multimedia Core Network (CN) Subsystem (IMS) and Circuit Switched (CS)
networks
# E.1 Basic Multimedia calls interworking between the IMS and CS Networks
scenarios
The Interworking between Circuit switched multimedia telephony service, as
described in 3GPP TS 26.110 [78] and 3GPP TS 26.111 [79], and packet switched
multimedia services, as described in 3GPP TS 26.114 [104] is addressed.
NOTE: Examples in the present Annex assume that the ITU-T H.263 [84] video
codec is used at the CS side. However, in the present release of 3GPP TS
26.114 [104], the H,263 video codec is no longer recommended (although it has
been mandated in previous releases).
{width="6.533333333333333in" height="4.6618055555555555in"}
Figure E.1.1.1 Overview of relevant CS-Domain Protocols (from TS 26.110 [78])
# E.2 Control plane interworking
## E.2.1 General
In addition to the control plane Interworking between SIP and ISUP or BICC,
interactions between the H.245 signalling at the CS side and SIP/SDP
signalling are described.
The establishment of the H.223 multiplexing protocol and the subsequent H.245
signalling procedures take place after the set-up and both-way through-
connection of the CS bearer.
## E.2.2 Functionalities required in the MGCF for multimedia calls support
In addition to the control plane Interworking between SIP and ISUP or BICC,
the MGCF needs to mediate interactions between the H.245 signalling or MONA
(Media Oriented Negotiation Acceleration) procedures at the CS side and
SIP/SDP signalling at the IMS side. The interactions between H.245 signalling
or MONA procedures and SIP/SDP signalling should aim at avoiding media
transcoding by selecting the same codec for the CS side and the PS side.
NOTE: Detailed procedures for the mapping between SDP parameters and H.245
parameters are not specified in the present release.
## E.2.3 IM CN subsystem originated session
### E.2.3.1 Preconditions used at IMS side
#### E.2.3.1.1 Interactions between H.245 or MONA and SIP/SDP
Figure E.2.3.1.1.1 shows examples of interactions between H.245 or MONA
procedures and SIP/SDP for IM CN subsystem originated session. Most SIP and
ISUP or BICC messages are intentionally omitted, since the SDP may be embedded
in various SIP messages and since the in‑band H.245 Messages are not tightly
coupled with out-of-band ISUP or BICC messages.
Figure E.2.3.1.1.1 assumes that the IMS peer uses the SIP precondition
extension to indicate that preconditions have not yet been met.
Figure E.2.3.1.1.1: Interactions between H.245 and SIP/SDP for IM CN subsystem
originated session\ IMS peer indicates unmet local preconditions
Upon receipt of a SIP INVITE request containing speech and video Codecs
(signal 1 in figure E.2.3.1.1.1) the Interworking Node (consisting of MGCF and
IM-MGW) starts the call set-up for multimedia call at the CS side by sending
an IAM requesting an UDI bearer (signal 2 in figure E.2.3.1.1.1).
If SDP local preconditions, which are not yet met, are contained in signal 1,
the Interworking node should immediately send an SDP answer to allow for the
IMS-side bearer set-up to progress. The Interworking node selects codecs
supported by the IM-MGW and likely to be supported within the CS network and
communicates the selected codecs towards the IMS side within an SDP answer
message (signal 3 in figure E.2.3.1.1.1). If theses codecs are contained in
the SDP offer, the Interworking Node should select the H.263 codec and may
select other codec from the SDP offer in addition. The interworking node
should include a b:AS bandwidth modifier with a bandwidth suitable for the
selected codec(s), but not higher than 64kbit/s plus RTP/UDP/IP overhead, in
the SDP answer to request that the peer does not send media with a higher
bandwidth.
The Interworking Node shall engage in an H.223 bearer setup (step 6 in figure
E.2.3.1.1.1). If the interworking Node supports MONA (Media Oriented
Negotiation Acceleration), it shall first attempt a MONA Channel establishment
method negotiation according to Annex K of ITU-T Recommendation H.324 [81]. If
the interworking node does not support MONA, it shall use the multiplexing
level negotiation procedures of Annex C of H.324 [81]. If the Interworking
Node supports MONA, but the remote peer does not do so, a fallback to the
multiplexing level negotiation procedures of Annex C of H.324 [81] will occur.
If both the Interworking Node and the remote CS terminal support MONA
procedures, the MONA procedures as per ITU-T Recommendation H.324 Annex K [81]
may be used to replace the H.245 negotiation (signals 7 - 9) as shown in
figure E.2.3.1.1.1.
If MONA procedures are not used, the following applies:
\- After the completion of the H.223 bearer setup at the CS side, the
Interworking Node shall send a Terminal Capability Set message describing its
own capabilities (signal 7 in figure E.2.3.1.1.1). Unless the Interworking
Node supports transcoding, the Interworking Node shall only send codecs that
have been offered at the IM CN subsystem side (as received in signal 1 in
figure E.2.3.1.1.1) within this message.
\- The Interworking Node will receive an H.245 Terminal Capability Set message
describing the supported Codecs at the peer\'s side (signal 8 in figure
E.2.3.1.1.1).
\- The codecs contained both in the sent and received terminal capability set
messages may be selected at the CS side. The final decision of the selected
codecs at the CS side is taken when the H.245 open logical Channels message
(signal 9 in figure E.2.3.1.1.1) is sent or received. The direction of this
message is determined by the procedure in H.245 [82] Annex C.2.
If the Interworking Node does not transcode, it should indicate the codecs
selected within the H.245 negotiation (signal 11 in figure E.2.3.1.1.1) or
within the MONA procedures and enable any media that have previously been put
on hold at the IMS side after the completion of the H.245 negotiation or MONA
procedures.
The interworking node should include in step 11 of figure E.2.3.1.1.1 the SDP
\"a\" attribute \"3gpp_MaxRecvSDUSize\" indicating the maximum SDU size of the
application data that can be transmitted to the receiver without segmentation,
as specified in clause 12.2.4.6 of 3GPP TS 26.114 [104].
### E.2.3.2 Preconditions not used at IMS side
#### E.2.3.2.1 Interactions between H.245 or MONA and SIP/SDP
Figure E.2.3.2.1.1 shows examples of interactions between H.245 or MONA
procedures and SIP/SDP for IM CN subsystem originated session. Most SIP and
ISUP or BICC messages are intentionally omitted, since the SDP may be embedded
in various SIP messages and since the in‑band H.245 Messages are not tightly
coupled with out-of-band ISUP or BICC messages.
Figure E.2.3.2.1.1 assumes that the IMS peer does not use the SIP precondition
extension.
Figure E.2.3.2.1.1 Interactions between H.245 and SIP/SDP for IM CN subsystem
originated session\ IMS peer does not use SIP preconditions
Upon receipt of a SIP INVITE request containing speech and video Codecs
(signal 1 in figure E.2.3.2.1.1) the Interworking Node (consisting of MGCF and
IM-MGW) starts the call set-up for multimedia call at the CS side by sending
an IAM requesting an UDI bearer (signal 2 in figure E.2.3.2.1.1).
If no unmet local SDP preconditions are contained in signal 1, the
Interworking node should defer sending an SDP answer until the H.245
negotiation or MONA procedures is/are completed.
The Interworking Node shall engage in an H.223 bearer setup (step 5 in figure
E.2.3.2.1.1). If the interworking Node supports MONA (Media Oriented
Negotiation Acceleration), it shall first attempt a MONA Channel establishment
method negotiation according to Annex K of ITU-T Recommendation H.324 [81]. If
the interworking node does not support MONA, it shall use the multiplexing
level negotiation procedures of Annex C of H.324 [81]. If the Interworking
Node supports MONA, but the remote peer does not do so, a fallback to the
multiplexing level negotiation procedures of Annex C of H.324 [81] will occur.
If both the Interworking Node and the remote CS terminal support MONA
procedures, the MONA procedures as per ITU-T Recommenation H.324 [81] Annex K
may be used to replace the H.245 negotiation (signals 6 - 8) as shown in
figure E.2.3.2.1.1.
If MONA procedures are not used, the following applies:
\- After the completion of the H.223 bearer setup at the CS side, the
Interworking Node shall send a Terminal Capability Set message describing its
own capabilities (signal 6 in figure E.2.3.2.1.1). Unless the Interworking
Node supports transcoding, the Interworking Node shall only send codecs that
have been offered at the IM CN subsystem side (as received in signal 1 in
figure E.2.3.2.1.1) within this message.
\- The Interworking Node will receive an H.245 Terminal Capability Set message
describing the supported Codecs at the peer\'s side (signal 7 in figure
E.2.3.2.1.1).
\- The codecs contained both in the sent and received terminal capability set
message may be selected at the CS side. The final decision of the selected
codecs at the CS side is taken when the H.245 open logical Channels message
(signal 8 in figure E.2.3.2.1.1) is sent or received. The direction of this
message is determined by the procedure in H.245 [82] Annex C.2.
If the Interworking Node does not transcode, it shall send an SDP answer
(signal 9 in figure E.2.3.2.1.1) indicating the codecs selected within the
H.245 negotiation or within the MONA procedures after the completion of the
H.245 negotiation or MONA procedures. The interworking node should include a
b:AS bandwidth modifier with a bandwidth suitable for the selected codec(s),
but not higher than 64kbit/s plus RTP/UDP/IP overhead, in the SDP answer to
request that the peer does not send media with a higher bandwidth.
The interworking node should include in Step 9 of figure E.2.3.2.1.1 the SDP
\"a\" attribute \"3gpp_MaxRecvSDUSize\" indicating the maximum SDU size of the
application data that can be transmitted to the receiver without segmentation,
as specified in clause 12.2.4.6 of 3GPP TS 26.114 [104].
### E.2.3.3 Fallback to speech at session establishment
If SCUDIF Fallback (see 3GPP TS 23.172 [121]) occurs on the CS side, the APM
message contains a speech codec as \"Selected Codec\". The MGCF shall then
disable the video \"m-line\" in the first SDP answer, if not yet sent, and
complete the call-setup in the same way as for a normal speech call. If the
SDP answer was already sent (precondition used), the MGCF shall update the SIP
session to speech by sending a SIP UPDATE message with a relevant SDP.
If in a non-SCUDIF case (ISUP or BICC without SCUDIF) the called CS terminal
or network rejects the video call setup by sending a REL message to the MGCF,
the MGCF releases the CS video call being established, re-establishes the CS
call in a speech only mode sending a new IAM with a speech BCIE to the CS
network and updates the IM CN leg codecs to a speech only codec. Then the
call/session continues as in a speech only case. If the interworking node does
not support the fallback, it shall release the session.
## E.2.4 CS network originated session
### E.2.4.1 Interactions between SIP/SDP and H.245 or MONA
#### E.2.4.1.1 Normal Call setup
Figure E.2.4.1.1 shows examples of interactions between H.245 or MONA and
SIP/SDP for the CS network originated session. Most SIP and ISUP or BICC
messages are intentionally omitted, since the SDP may be embedded in various
SIP messages and since the in‑band H.245 Messages are not tightly coupled with
out-of-band ISUP or BICC messages.
NOTE: Messages 3 and 5 may be combined in some scenarios.
Figure E.2.4.1.1: Interactions between H.245 and SIP/SDP for CS network
originated session
Upon receipt of an IAM request for a multimedia Call (signal 1 in figure
E.2.4.1.1) the Interworking Node (consisting of MGCF and IM-MGW) starts the
call set-up for multimedia call at the IM CN subsystem side by sending an
INVITE request (signal 2 in figure E.2.4.1.1). For the INVITE request, the
Interworking Node selects codecs supported by the IM-MGW and likely to be
supported within the CS Network. The Interworking Node should select the H.263
codec and may select other codec in addition. The interworking node should add
a b:AS bandwidth modifier with a bandwidth suitable for the selected codec(s),
but not higher than 64kbit/s plus RTP/UDP/IP overhead, in the SDP offer to
request that the peer does not send media with a higher bandwidth.
NOTE: The SDP coding to express that either a combined voice and video call,
or a voice call, or a Clearmode codec, or some other data call is desired is
not defined in the present release.
The Interworking Node shall engage in an H.223 bearer setup (step 7 in figure
E.2.4.1.1). If the interworking Node supports MONA (Media Oriented Negotiation
Acceleration), it shall first attempt a MONA Channel establishment method
negotiation according to Annex K of ITU-T Recommendation H.324 [81]. If the
interworking node does not support MONA, it shall use the multiplexing level
negotiation procedures of Annex C of H.324 [81]. If the Interworking Node
supports MONA, but the remote peer does not do so, a fallback to the
multiplexing level negotiation procedures of Annex C of H.324 [81] will occur.
If both the Interworking Node and the remote CS terminal support MONA
procedures, the MONA procedures as per ITU-T Recommendation H.324 [81] Annex K
may be used to replace the H.245 negotiation (signals 8, 11 and 12) as shown
in figure E.2.4.1.1. Furthermore, the SIP codec renegotiation in signals 9 and
10 is then also not applicable.
If MONA procedures are not used, the following applies:
\- After the completion of the H.223 bearer setup at the CS side the
Interworking Node will receive a H.245 Terminal Capability Set message
describing the supported Codecs at the peer\'s side (signal 8 in figure
E.2.4.1.1).
\- Due to information received in a Terminal Capability Set message (signal 8
in figure E.2.4.1.1), the Interworking node may send an SDP offer at the IMS
side (signal 9 in figure E.2.4.1.1), to offer additional codecs supported at
the CS side but not contained in the first SDP offer (signal 2 in figure
E.2.4.1.1), or to restrict the selected codecs at the IMS side to codecs which
are available at the CS side.
NOTE: It is not clear if the addition of codecs not included in previous SDP
exchange has any impacts on IMS procedures, e.g. resource reservation related
procedures.
\- The Interworking Node shall send a Terminal Capability Set message
describing its own capabilities (signal 11 in figure E.2.4.1.1). Unless the
Interworking Node supports transcoding, the Interworking node shall only send
codecs that are also negotiated at the IM CN subsystem side (as received in
signal 3 in figure E.2.4.1.1) within this message. The Interworking Node may
defer sending the Terminal Capability Set message for some time to attempt to
receive the peer\'s Terminal Capability set message and perform a possible
IMS-side codec re-negotiation. However, to avoid blocking situations, the
Interworking Node shall not defer sending the Terminal Capability Set message
for an excessive period of time.
\- The codecs contained both in the sent and received Terminal Capability Set
message may be selected at the CS side. The final decision of the selected
codecs at the CS side is taken when the H.245 open logical Channels message
(signal 12 in figure E.2.4.1.1) is sent or received. The direction of this
message is determined by the procedure in H.245 [82] Annex C.2.
If the Interworking Node does not transcode, it should indicate the codecs
selected within the H.245 negotiation or within MONA procedures after the
completion of the H.245 negotiation (signal 13 in figure E.2.4.1.1) or MONA
procedures.
The interworking node should include in Step 11 of figure E.2.4.1.1 the SDP
\"a\" attribute \"3gpp_MaxRecvSDUSize\" indicating the maximum SDU size of the
application data that can be transmitted to the receiver without segmentation,
as specified in clause 12.2.4.6 of 3GPP TS 26.114 [104].
#### E.2.4.1.2 Call setup if multimedia call can not be recognized in an
unambiguous manner
If the Interworking Node is not able to determine from the information within
the IAM request whether a multimedia call or some other type of data call is
requested (for example, if only TMR=UDI but no BC IE is contained in the IAM),
the Interworking Node may also include appropriate codecs for other possible
types of data call it supports in the INVITE request. If video and audio
codecs are contained in the first SDP answer (signal 3), the Interworking Node
should continue to attempt to set up a multimedia call as described in clause
E.2.4.1.1. Otherwise, calls are set up as described in clause 7.2.3.2.
#### E.2.4.1.3 Fallback to speech during call setup
The called party can reject the video component in the SDP offer (signal 2 in
figure E.2.4.1.1) by returning an SDP answer where the video related m-line is
disabled (in signal 3 in figure E.2.4.1.1).
If the MGCF receives an SDP answer during call setup where the video related
m-line is disabled, it shall react as follows:
\- If the MGCF has received a SCUDIF call setup from the CS side (MuMe and
speech codecs in IAM message, see 3GPP TS 23.172 [121]), the MGCF shall apply
a SCUDIF fallback to speech on the CS side. The MGCF shall use a speech codec
as Selected Codec and exclude the MuMe codec from the available codec list.
\- If the MGCF has received a multimedia call setup without SCUDIF from the CS
side, and the CS network supports CS fallback, the MGCF should terminate the
call.
NOTE 1: A call termination can trigger the caller\'s device to set up a new
speech call.
NOTE 2: Other procedures to maintain the CS call, e.g. disabling the video
component on the CS side or providing a suitable video announcement and
discarding received video media from the CS side, are FFS.
### E.2.4.2 CS originated - IM CN transit - CS terminated
Figure E.2.4.2.1 describes ISUP and SIP/SDP interactions in a CS originated -
IM CN transit - CS terminated case with a clear channel through the IM CN. An
interworking node A receives an IAM message with a UDI H.223 & H.245 video
call request (message 1). If the interworking node A supports both CS/IMS
video interworking and a clearmode codec / clear channel, it may send both
audio and video codecs and a clearmode codec and a UDI & H.223 & H.245 video
indication in the INVITE message towards the IMS (message 2). The message is
received by an interworking node B. The interworking node B sends an IAM
message with a UDI & H.223 & H.245 video call request to the terminating CS
network (message 3). If the interworking node B supports a clearmode codec /
clear channel, it may send a SIP response with a clearmode codec towards the
calling side to indicate that a clear channel can be established between the
IMS interworking nodes (message 5). After the called party answers, the
interworking node B sends a SIP 200 OK (Invite) with the clearmode codec to
the calling node to indicate that a clear channel can be established (message
11). After the called party has answered the call, either MONA procedures are
performed and the H.223 bearer is established or the H.223 bearer is
established and the H.245 signalling is performed (step 14 in figure
E.2.4.2.1).
If the interworking node A does not support CS-IMS video interworking, but
supports a clearmode codec / clear channel, it sends the INVITE message with a
clearmode codec and UDI & H.223 & H.245 indication, but without a video codec,
to allow the establishment of a CS video call through a clear channel. The
interworking node A may also send an audio codec (alone or with a clearmode
codec) to allow a fallback to speech. The interworking node B either accepts
the clearmode and sends the corresponding IAM message with a UDI & H.223 &
H.245 request (message 3) and SIP response with a clearmode codec (message 5
or 11), or accepts the speech mode and sends the corresponding IAM message
with a speech request (message 3) and SIP response with a speech codec
(messages 5, 11), or rejects the INVITE message if the requested codec(s)
cannot be supported.
The format of the indication of UDI & H.223 & H.245 from interworking node A
to interworking node B is defined in Annex F \"PSTN XML Scheme\". UDI & H.223
& H.245 indication is conveyed in PSTN XML body within \"BearerCapabilty\"
(\"InformationTransferCapability\" and \"UserInfoLayerProtocol\") and
\"LowLayerCompatibility\" elements. Elements are defined in ETSI EN 300 403‑1
(V1.3.2) [96] clause 4.5.5 and in ISUP transported in the ATP is in
Q.761-Q.764 [4] clause 3.5.
Figure E.2.4.2.1: ISUP and SIP/SDP interactions in a CS originated - IM CN
transit\ \- CS terminated case with a clear channel through the IM CN
## E.2.5 Service change
#### E.2.5.2.1 SCUDIF
##### E.2.5.2.1.0 General
SCUDIF is standardised in 3GPPP 3GPP TS 23.172 [121].
##### E.2.5.2.1.1 IM CN subsystem originated change
###### E.2.5.2.1.1.1 Change from multimedia to speech
Figure E.2.5.2.1.1.1.1 shows an IM CN subsystem originated modification from
multimedia to speech during an ongoing session when the CS leg supports BICC.
The interworking node receives an INVITE message that indicates the dropping
of the video media from the session, message 1. The interworking node can only
accept the dropping of the media component and sends a corresponding codec
modification request to the BICC network, message 2, and acknowledges the
INVITE with a 200 OK message. The BICC network indicates a successful codec
modification, message 5.
Figure E.2.5.2.1.1.1.1: IM CN subsystem originated modification\ from
multimedia to speech when the CS leg supports BICC
NOTE: Handling of a case, where a codec is received in BICC negotiation but
not included in the available codec list negotiated previously, is not defined
in the present release.
###### E.2.5.2.1.1.2 Change from speech to multimedia
Figure E.2.5.2.1.1.2.1 shows an IM CN subsystem originated modification from
speech to multimedia during an ongoing session when the CS leg supports BICC.
The interworking node receives an INVITE message that offers the adding of a
video media to the ongoing speech session, message 1. The interworking node
accepts the offer and sends a corresponding codec modification request to the
BICC network, message 2. The BICC network indicates a successful codec
modification, message 3. The interworking node acknowledges the INVITE with a
200 OK message after the MONA or H.245 in‑band negotiation in step 4 is
completed.
If the codec modification is not successful in the BICC network, the
interworking node responds to the INVITE message with the speech codec in the
200 OK message to retain the speech only session.
Figure E.2.5.2.1.1.2.1: IM CN subsystem originated modification\ from speech
to multimedia when the CS leg supports BICC
##### E.2.5.2.1.2 CS network originated change
###### E.2.5.2.1.2.1 Change from multimedia to speech
Figure E.2.5.2.1.2.1.1 shows a CS network originated modification from
multimedia to speech during an ongoing session when the CS leg supports BICC.
The interworking node receives a Modify Codec message that indicates the
dropping of the video media from the session, message 1. The interworking node
accepts the dropping of the video component and sends a corresponding INVITE
message to the IM CN subsystem, message 2, and acknowledges the codec
modification request to the BICC network, message 3. The IM CN subsystem
acknowledges the INVITE dropping the video media with a 200 OK, message 4.
Figure E.2.5.2.1.2.1.1: CS network originated modification\ from multimedia to
speech when the CS leg supports BICC
###### E.2.5.2.1.2.2 Change from speech to multimedia
Figure E.2.5.2.1.2.2.1 shows a CS network originated modification from speech
to multimedia during an ongoing session when the CS leg supports BICC. The
interworking node receives a Modify Codec message that indicates the adding of
a video media to the ongoing speech session, message 1. The interworking node
accepts the offer and sends a corresponding INVITE message to the IM CN
subsystem, message 2. The IM CN subsystem acknowledges the INVITE adding the
video media with a 200 OK, message 3, and acknowledges the codec modification
request to the BICC network, message 4. The interworking node may have to
update the codecs, messages 7 and 8, after the MONA or H.245 in‑band
negotiation in step 6.
If the IM CN subsystem does not accept the addition of the video media to the
session, the interworking node rejects the modify codec request to retain the
speech only session.
Figure E.2.5.2.1.2.2.1: CS network originated modification\ from speech to
multimedia when the CS leg supports BICC
#### E.2.5.2.2 Non-SCUDIF case (ISUP or BICC without SCUDIF)
##### E.2.5.2.2.1 Change from multimedia to audio
Figure E.2.5.2.2.1.1 shows an IM CN subsystem originated modification from
multimedia to audio during an ongoing session when the CS leg supports ISUP or
BICC without SCUDIF. The interworking node receives an INVITE message that
indicates the dropping of the video media from the session, message 1. The
interworking node can only accept the dropping of the media component and
acknowledges the INVITE with a 200 OK, message 2. There are three alternative
ways to handle the issue:
\- The video component stays on in the CS leg. The interworking node may use
the video component to send an announcement to the CS terminal to inform the
user about the change of the end-to-end connection to audio only. Refer to
figure E.2.5.2.2.1.1.
\- The interworking node initiates an H.245 in‑band negotiation to close the
video channel.
\- The interworking node terminates the session.
Figure E.2.5.2.2.1.1: IM CN subsystem originated modification\ from multimedia
to speech when the CS leg supports ISUP or BICC without SCUDIF
##### E.2.5.2.2.2 Change from speech to multimedia
Figure E.2.5.2.2.2.1 shows an IM CN subsystem originated attempt to change
from speech to multimedia during an ongoing session when the CS leg supports
ISUP or BICC without SCUDIF. The interworking node receives an INVITE message
that offers the adding of a video media to the ongoing speech session, message
1. The interworking node turns down the offer and responds to the INVITE
message with the speech codec in the 200 OK message to retain the speech only
session, message 2.
Figure E.2.5.2.2.2.1: IM CN subsystem originated modification\ from speech to
multimedia when the CS leg supports ISUP or BICC without SCUDIF
## E.2.6 Call release
### E.2.6.1 Call release initiated from the IM CN subsystem side
When the MGCF has received a BYE message (signal 1 in figure E.2.6.1.1) from
the IM CN subsystem side, the MGCF may end the H.245 session between the IM-
MGW and the CS network side (signal 3 in figure E.2.6.1.1) firstly.
NOTE: A call release using only ISUP/BICC signalling at the CS side proceeds
faster. H.324 terminals can handle situations where they do not receive H.245
call release signalling (see clause 7.5.2 of ITU-T Recommendation H.324 [81]),
and this scenario also occurs e.g. at loss of coverage or when a node
transporting H.223 transparently releases the call.
The procedure of ending the H.245 session is defined in the clause E.4. After
receiving the BYE message, the MGCF shall also send a 200 OK [BYE] message
(signal 2 in figure E.2.6.1.1) towards the IM CN subsystem.
After ending the H.245 session, the MGCF shall send a REL message (signal 4 in
figure E.2.6.1.1) to the succeeding node. If the IM CN subsystem interworks
with ISUP based CS network, the interworking node shall release the resources
for the IMS side and the CS network side (signal 6 in figure E.2.6.1.1) after
sending the REL message. If the IM CN subsystem interworks with BICC based CS
network, the interworking node shall release the resources for the IMS side
and the CS network side (signal 6 in figure E.2.6.1.1) upon receiving the RLC
message (signal 5 in figure E.2.6.1.1) from the CS network side. The
procedures of releasing the resources for the IMS side and the CS network side
are specified in the present 3GPP TS in clause 7.
Figure E.2.6.1.1 shows the message sequence chart for the multimedia call
release initiated from the IM CN subsystem side.
NOTE: Signal 7 is omitted when IM CN subsystem interworks with BICC based CS
network and Signal 5 is omitted when IM CN subsystem interworks with ISUP
based CS network.
Figure E.2.6.1.1: Call release initiated from the IM CN subsystem side
### E.2.6.2 Call release initiated from the CS network side
If the CS network side initiates the call release, it possibly ends the H.245
session with explicit signalling (signal 1 in figure E.2.6.2.1). The CS
network side sends a REL message (signal 2 in figure E.2.6.2.1) towards the IM
CN subsystem. The procedure of ending the H.245 session is defined in the
clause E.4.
When the MGCF receives a REL message (signal 2 in figure E.2.6.2.1) from the
preceding node, the MGCF sends a BYE message (signal 3 in figure E.2.6.2.1) to
the IM CN subsystem. After receiving the REL message, the interworking node
also releases the resources for the IMS side and the CS network side (signal 4
in figure E.2.6.2.1). The procedure of the releasing the resources for the IMS
side and the CS network side are specified in the present 3GPP TS in clause 7.
After completion of resource release, the MGCF sends a RLC message (signal 5
in figure E.2.6.2.1) towards the preceding node. Figure E.2.6.2.1 shows the
message sequence chart for the multimedia call release initiated from the CS
network side.
Figure E.2.6.2.1: Call release initiated from the CS network side
### E.2.6.3 Call release initiated from the interworking node
The interworking node may end the H.245 session between the IM-MGW and the CS
network side (signal 1 in figure E.2.6.3.1) firstly. The procedure of ending
the H.245 session is defined in the clause E.4.
NOTE: A Call Release using only SIP and ISUP/BICC signalling may proceed
faster. H.324 terminals can handle situations where they do not receive H.245
call release signalling (see clause 7.5.2 of ITU-T Recommendation H.324 [81]),
and this scenario also occurs e.g. at loss of coverage or when a node
transporting H.223 transparently releases the call.
To release the call, the MGCF shall send a REL message (signal 2 in figure
E.2.6.3.1) to the succeeding node on the CS network side. The MGCF shall also
send a BYE message (signal 3 in figure E.2.6.3.1) to the IM CN subsystem side.
If the IM CN subsystem interworks with ISUP based CS network, the interworking
node shall release the resources for the IMS side and the CS network side
(signal 5 in figure E.2.6.3.1) after sending the REL message. If the IM CN
subsystem interworks with BICC based CS network, the interworking node shall
release the resources for the IMS side and the CS network side upon receiving
the RLC message (signal 4 in figure E.2.6.3.1) from the CS network side. The
procedures of releasing the resources for the IMS side and the CS network side
are specified in the present 3GPP TS in clause 7. Figure E.2.6.3.1 shows the
message sequence chart for the multimedia call release initiated from the
interworking node.
{width="5.763194444444444in" height="3.7493055555555554in"}
NOTE: Signal 6 is omitted when IM CN subsystem interworks with BICC based CS
network and Signal 4 is omitted when IM CN subsystem interworks with ISUP
based CS network.
Figure E.2.6.3.1: Call release initiated from the interworking node
# E.3 User plane interworking
## E.3.1 Functionalities required in the IM-MGW for multimedia calls support
To enable a multimedia Interworking, the IM-MGW needs to support the reframing
of the H.263 video codec and the AMR audio codec between CS transport and PS
transport as a minimum. The IM-MGW may also support the reframing of other
codecs and the transcoding of audio and/or video codecs.
At the CS side, the IM-MGW needs to terminate the H.223 protocol and multiplex
/ de-multiplex audio, video and H.245 signalling. How H.245 related
information (e.g. H.245 messages or extracted information) is communicated
between the MGCF and the IM-MGW is described in clause E.4.
# E.4 MGCF and IM-MGW interactions
## E.4.1 Introduction
This clause describes requirements for extensions to the Mn interface protocol
in 3GPP TS 29.332 [15] needed to support the Interworking of multimedia calls.
ITU-T Recommendation H.248.1 [2] is used at the Mn interface.
The H.245 signalling shall be handled by the MGCF. Upon reception of the H.245
messages from the CS side at the IM-MGW, the IM-MGW shall forward those H.245
messages as binary data within H.248 messages over the Mn interface towards
the MGCF. Upon reception of encapsulated binary H.245 messages within H.248
messages, the IM-MGW shall forward those H.245 messages towards the CS side.
NOTE: Procedures to support MONA (see Annex K of ITU-T Recommendation H.324
[81]) over the Mn interface are not defined in the present Release.
Furthermore, the signalling flows in clause E.2 may not show MONA related
signalling in sufficient detail for MONA related Mn interface interactions.
## E.4.2 Mn signalling interactions
### E.4.2.1 Introduction
The following Clauses describe the Mn interface procedures triggered by H.245
signalling received in the IM-MGW and SIP and RTCP and BICC or ISUP signalling
received in the MGCF.
All message sequence charts in these Clauses are examples.
### E.4.2.2 H.248 Context Model
The H.248 context model depicted in figure E.4.2.2.1 shall be applied for
Multimedia Interworking.
Figure E.4.2.2.1: H.248 Context Model for Multimedia Interworking
### E.4.2.3 Transport of H.245 messages between the MGCF and IM-MGW
#### E.4.2.3.1 General
H.245 messages shall be transported between the IM-MGW and MGCF over the Mn
interface using H.248 Events (from the IM‑MGW towards the MGCF) and H.248
Signals (from the MGCF towards the IM-MGW). The Events/Signals shall contain
the following information:
\- H.245 message (binary).
#### E.4.2.3.2 Transport from MGCF to IM-MGW
Figure E.4.2.3.2.1: Mn signalling interactions for sending H.245 message
In Signal 1, the MGCF requests the IM-MGW to send an H.245 message to the CS
side. To request the IM-MGW to send a H.245 message to the CS side, the MGCF
shall sent an H.248 signal to the IM-MGW with the complete H.245 message
content.
NOTE: In order for this command to succeed, Termination T1 towards the CS side
needs to be configured. If a sending of an H.245 message and a removal of
termination T1 is desired, the MGCF needs to apply signal 1 before removing
T1.
Upon reception of this signal, the IM-MGW shall send the encapsulated H.245
message within the H.248 signal, through the H.245 control channel to the CS
side (signal 3).
#### E.4.2.3.3 Transport from IM-MGW to MGCF
Figure E.4.2.3.3.1: Mn signalling interactions for receiving H.245 message
In signal 1, the MGCF requests the IM-MGW to detect received H.245 message
from the CS side and forward them to the MGCF. To request the IM-MGW to detect
and forward a H.245 message to the CS side, the MGCF shall send a suitable
H.248 event to the IM-MGW. The event may be indicated through an H.248 ADD
command.
In signal 3, the IM-MGW receives an H.245 message from the CS side. Upon
reception of an H.245 message from the CS side, the IM-MGW shall de-multiplex
the H.245 message from the H.223 stream and forward the H.245 message to the
MGCF within an H.248 Notify command (signal 4).
### E.4.2.4 Call establishment procedure
The following information shall be provided from the MGCF towards the IM-MGW:
\- Properties to start H.223 Negotiation.
\- Request for events for Notification of H.245 message received by the IM-
MGW.
\- Signals to provide H.245 messages that the IM-MGW shall send towards the CS
side.
\- Properties to provide incoming and outgoing H.223 multiplex table.
\- Properties to provide H.223 logical channel parameters.
\- Property to provide remote H.223 capabilities.
The Highest Multiplexing Level shall be predefined in the IM-MGW.
{width="6.590277777777778in" height="7.8694444444444445in"}
NOTE 1: All H.245 messages (from Signal 9 to Signal 18) are transported
through the IM-MGW between the MGCF and the CS side, using the procedures
described in clause E.4.2.3
NOTE 2: Signals 21 and 22 are omitted if the same codec information has
already been provisioned in signal 3.
Figure E.4.2.4.1: Mn signalling interactions for H.245 termination at the MGCF
The MGCF shall request terminations towards the CS network (Signal 1 and 2)
and towards the IMS (Signal 3 and 4). For the terminations towards the IMS,
the MGCF provides an estimate about the applicable codecs in the required
information elements \"Local IMS Resources\" (for both \"Reserve IMS
Connection Point\" procedure and \"Reserve IMS Connection Point and Configure
Remote Resources\" procedure) and possibly \"Remote IMS Resources\" (only for
\"Reserve IMS Connection Point and Configure Remote Resources\" procedure).
The MGCF shall request that the H.223 stream is (de-)multiplexed at the MUX
termination T2, and that the H.245 control in H.223 Logical channel 0 is
separated (signal 6). Furthermore, the MGCF shall request that the H.223
negotiation is started, and shall request to be notified about all H.245
messages received by the IM-MGW.
The IM-MGW shall start the H.223 Multiplexing Level Negotiation after receipt
of the corresponding request from the MGCF and CS bearer establishment (Signal
8).
Upon reception of a H.245 Terminal Capability Set message (Signal 9), the MGCF
sends a H.245 Acknowledgment message (Signal 10).
The MGCF shall know the H.324 related capabilities of the IM-MGW before
starting the H.245 capability negotiation with the CS side, e.g. through
configuration. The H.245 Terminal Capability Set message send by the MGCF
(Signal 11) should include the codecs which are supported by both the IMS side
and the IM-MGW, and the codecs which could be transcoded by the IM-MGW from
the codecs supported by the IMS side.
The MGCF may defer sending the Terminal Capability Set message (Signal 11) for
some time to wait for codec information from the CS peer\'s Terminal
Capability Set message and perform a possible IMS-side codec re-negotiation.
To avoid blocking situations, the MGCF shall not defer sending the signal for
an excessive period of time.
To avoid the CS side selecting the codecs that need to be transcoded at the
IM-MGW, the MGCF should aim to be the leader in the procedures in H.245 [82]
Annex C.2 (Signals 9 to 12). The MGCF shall set the Terminal Type parameter as
a number larger than 128 in the message in H.245 [82] Annex B.1.1. The
procedure in H.245 [82] Annex C.2 could be combined with the messages used for
the H.245 capability exchange.
The codecs contained both in the sent and received terminal capability set
message may be selected at the CS side. The final decision of the selected
codecs at the CS side is taken with the H.245 open logical channel procedure
(Signals 13 to 16).
After the completion of the H.245 multiplex table exchange procedure (Signals
17 to 20), the MGCF shall configure the multiplexing termination T2 by
indicating to the IM-MGW the contents of the incoming and outgoing multiplex
tables (Signal 21).
If codec information needs to be changed compared to what has been provisioned
in signal 3, the MGCF shall also configure T3 with the appropriate video
and/or speech codec(s) (signal 23).
The call is in the active state.
### E.4.2.5 Handling of H.245 indication message
#### E.4.2.5.1 Overview
The MGCF shall support the following H.245 indication messages: Function Not
Understood Indication / Function Not Supported Indication, Jitter Indication.
The MGCF may support the H.245 User Input Indication message. All these H.245
messages are conveyed between the MGCF and the CS side through the IM-MGW, as
described in clause E.4.2.3.
#### E.4.2.5.2 Function Not Understood / Function Not Supported message
This indication message is used to return requests, responses and commands
that are not understood back to the transmitter.
If the MGCF receives a Function Not Understood or Function Not Supported
message from the CS side, the MGCF may choose to attempt simpler H.245
interaction than the previous H.245 interaction that caused this indication.
If this is not possible, the MGCF may release the call.
If the MGCF receives a H.245 request, response or command that can not be
understood, the MGCF shall send H.245 Function Not Supported indication
message to the CS side.
#### E.4.2.5.3 User Input Indication message
The User-Input-Indication message is used e.g. to transport the in-band DTMF
information in the H.324 system.
The MGCF and IM-MGW may support transporting the DTMF information both from
the CS side to the IMS side, and from the IMS side to the CS side.
Upon Receipt of a H.245 User-Input-Indication message, the MGCF may apply the
procedures in clause 9.2.8.3 to request the IM-MGW to send corresponding RTP
telephone-event(s) towards the IMS side.
Upon receipt of RTP telephone events from the IMS, the MGCF will be notified
by the IM-MGW using the procedures in clause 9.2.8.1, if the MGCF has
previously configured the IM-MGW as also described in this subclause. Upon
receipt of the notification, the MGCF may send a H.245 User-Input-Indication
message to the CS side.
### E.4.2.6 Handling of H.245 Command message
#### E.4.2.6.1 Overview
The MGCF shall support the End Session command message. The MGCF may support
the Flow Control command message and the videoFastUpdatePicture message. All
these H.245 messages are conveyed between the MGCF and the CS side by the IM-
MGW, as described in clause E.4.2.3.
#### E.4.2.6.2 Flow control command
The flow control command is used to restrict the upper limit of bit rate of
either a single logical channel or the whole multiplex stream. The MGCF may
support the flow control command received from the CS side.
NOTE: It is very unlikely that the MGCF will receive a Flow control command,
as the capability of controlling the video bit rate during a video call was
neither implemented nor tested for Ues offering 3G-324M since R99, due to the
lack of such a necessity in WCDMA where a fixed 64 kbps bearer is maintained
to continuously transport 3G-324M PDUs.
{width="5.896527777777778in" height="4.783333333333333in"}
Figure E.4.2.6.2.1: Mn procedure of Flow control command
In Signal 1, the MGCF receives the Flow Control Command from the CS side.
If the minimum bitrate of the current codec is larger than the bitrate
requested by the H.245 Flow Control Command message, the MGCF indicates the
IM-MGW to stop the transmission of the media stream over the logical channel
(signal 2). Then the MGCF may select another codec that can satisfy the
requested bitrate limit. In signal 4, the MGCF closes the old logical channel
and opens a new logical channel with new codec to satisfy the bitrate limit in
the CS side. In signal 6, the MGCF indicates the IM-MGW to modify the LCN,
codec and stream mode of the multiplexing termination. In signal 8, the MGCF
sends flow control indication message to CS side with the current maximum
bitrate. If the MGCF chooses to change the CS-side codec, the MGCF may also
adjust the codec at the IMS side accordingly. To do so, the MGCF may need to
re-negotiate the codec at the IMS side using a SIP re-INVITE message (signals
9 and 10). In addition, the MGCF may modify the codec of IMS termination
accordingly (signal 11).
The MGCF may also apply interworking procedure towards RTCP at the IMS side as
described in clause E.4.2.8 when receiving a H.245 Flow Control Command.
#### E.4.2.6.3 End Session Command
The end session command is used to close the H.245 control channel after all
the logical channels have been closed.
The MGCF may send an end session command to the CS side through the IM-MGW to
release a call.
If the MGCF receives an end session command from the CS side, it shall release
the call if the call is in the active state.
#### E.4.2.6.4 videoFastUpdatePicture
The MGCF may apply interworking procedure towards RTCP as described in clause
E.4.2.8 when receiving a H.245 videoFastUpdatePicture message. The MGCF may
also be triggered by the procedures in clause E.4.2.8 to send a H.245
videoFastUpdatePicture message.
When receiving frequent H.245 videoFastUpdatePicture messages for a SCUDIF
call (see 3GPP TS 23.172 [121]), an MGCF should initiate a service-change from
multimedia to speech and remove the IMS MTSI video component with SIP/SDP
signalling. When receiving frequent H.245 videoFastUpdatePicture messages for
a non-SCUDIF call, an MGCF should disable the CS video and remove the IMS MTSI
video component with SIP/SDP signalling.
NOTE: In a congestion situation at the IMS side, frequent packet losses might
occur and dropping the video component may serve as a counter-measure to
reduce the packet loss frequency. However, CS terminals might not be able to
initiate such a switch-over to voice, but might rather react with repeated
H.245 videoFastUpdatePicture message.
### E.4.2.7 Mn Signalling Interactions to support the Media Oriented
Negotiation Acceleration (MONA)
#### E.4.2.7.1 Overview
Media Oriented Negotiation Acceleration (MONA), as specified in ITU-T H.324
[81] provides simplified procedures that allow for a faster call set-up of a
H.324 Multimedia call than standard H.324 procedures, and also allow for a
fallback to standard H.324 procedures if either party does not support the
enhanced procedures.
The support of MONA is optional for an IM-MGW and MGCF supporting multimedia
interworking, as no call failure but only a fallback to standard H.324 setup
procedures will occur if the procedures are not supported.
MONA \"preference message\" signalling is used instead of H.324 Multiplexing
level negotiation. Should standard H.324 Multiplexing level stuffing flags be
received, a fallback to standard H.324 procedures is triggered. The sending of
MONA preference messages is repeated by each MONA capable H.324 terminal until
a reception is acknowledged by the peer. During this phase, two PDU types may
optionally be attached by MONA terminals to these preference messages:
\- Media Preconfigured Channel (MPC) PDUs: MONA defines a small number of
preconfigured H.223 channels for the most widespread audio and video codecs
(AMR, AMR-WB, H.264 MPEG4 and H.263). Media PDUs for these codecs may be
attached to the MONA \"preference message\" during the call setup.
\- Signalling Preconfigured Channel (SPC) PDUs: These PDUs are H.245 generic
request messages with special parameters defined by MONA. These PDUs may also
be attached to MONA preference messages.
According to MONA, each MONA capable terminal shall support at least one of
these PDU types. The MONA capability of the IM-MGW can be audited by the MGCF.
The MONA preference message exchange in combination with attached MPC or SPC
PDUs may result in the establishment of the desired media channels without
further H.245 signalling. Otherwise, H.245 will be used after the MONA
preference message exchange is acknowledged to negotiate media channels, but
MONA defines some accelerated H.245 procedures (ACP) to speed up these H.245
procedures.
The design of Mn procedures to support MONA is guided by the following
considerations:
\- The H.245 handling should be performed in the MGCF to keep procedures
aligned as far as possible with standard Mn procedures to support H.324
interworking.
\- The MGCF should also control MONA preference message exchange procedures in
order to maintain the agreed architectural work split between MGCF and IM-MGW
in analogy to the H.245 handling.
\- However, the IM-MGW needs to understand the MONA preference messages at
least to a sufficient degree to de-encapsulate the possibly attached MPC and
SBC PDUs.
\- Furthermore, the frequent retransmissions of MONA preference messages
required by MONA procedures are to be performed by the IM-MGW autonomously to
avoid unnecessary load at the Mn interface and the MGCF.
\- Furthermore, for resource reservation at the IM-MGW, it is assumed that the
IM-MGW has knowledge about supported predefined Media Preconfigured Channel
configurations as specified in clause K.9.2 of H.324 [81] in order to limit
the amount of information transferred in the Mn interface when establishing
MPC channels. The offered channel resources are reserved by the IM-MGW.
\- In order to avoid increasing call establishment time when interworking with
legacy terminals and at the same time avoid unnecessary load at the Mn
interface, the MGCF may initiate both MONA and legacy H.245 procedures
simultaneously in parallel. The MGCF shall in this case arm a legacy detection
event with an embedded signal descriptor including the initial legacy H.245
message. The IM-MGW will only send the signal in case a fallback condition to
legacy is detected.
#### E.4.2.7.2 Mn Interactions for MONA preference messages
NOTE 1: MONA preference messages are repeated several times. One repetition is
shown for each such message, with the same signal number as the first message.
NOTE 2: The Context model in figure E.4.2.2.1 is assumed in this call flow.
Figure E.4.2.7.2.1: Mn signalling interactions for MONA preference messages
The MGCF shall request terminations towards the CS network (Signal 1 and 2)
and towards the IMS (Signal 3 and 4). For the terminations towards the IMS,
the MGCF provides an estimate about the applicable codecs in the required
information elements \"Local IMS Resources\" (for both \"Reserve IMS
Connection Point\" procedure and \"Reserve IMS Connection Point and Configure
Remote Resources\" procedure) and possibly \"Remote IMS Resources\" (only for
\"Reserve IMS Connection Point and Configure Remote Resources\" procedure).
The MGCF shall request that the H.223 stream is (de-)multiplexed at the MUX
termination T2 (signal 6). Furthermore, the MGCF shall request that MONA
preferences negotiation is started, and shall provision the MONA preferences
to be indicated by the IM-MGW. The MGCF shall encode the MONA preferences as
described in clause K.6 of ITU-T H.324 [81]. The MGCF shall take the H.324
related capabilities of the IM-MGW into account in the MONA preferences. The
MGCF can know these capabilities by configuration. The IM-MGW will only
support symmetric codec usage. If several codec alternatives are offered for
MPC, it is the responsibility of the MGCF to ensure that symmetric codecs are
established by not selecting transmit codec until the receive channel has been
opened by MPC media. The MGCF shall also request to be notified about the
reception of the remote MONA preferences and about the completion of the MONA
preference exchange, or an H.245 message on the H.223 control channel. The
MGCF may also initiate standard H.245 signalling in parallel in order to
minimize the time for a legacy interworking fallback. This is done by arming a
legacy detection event including an embedded signal descriptor. The embedded
signal is the initial H.245 message out signal (including H.245 TCS+MSD) to
send in case fallback to legacy interworking is detected. The IM-MGW will only
send the embedded signal in case it detects H.223 related indications of a
legacy interworking as specified in clause K.7.1.2 in H.324 [81]. Upon
receiving the legacy detected event, the MGCF continues with standard H.245
call setup procedures waiting for the reception of a remote H.245 TCS as well
as acknowledgements on the sent H.245 TCS+MSD. If the MGCF indicates the
capability to receive SPC PDUs within the MONA preferences, it shall also
request to be notified about incoming SPC PDUs, as detailed in clause
E.4.2.7.4. If the MGCF indicates the capability to receive any MPC PDUs within
the MONA preferences, it shall also request to be notified about incoming MPC
PDUs, as detailed in clause E.4.2.7.3.
The IM-MGW shall start sending MONA preference messages after receipt of the
corresponding request from the MGCF and CS bearer establishment (Signal 8).
The IM-MGW shall repeat sending those messages and increment the
acknowledgment bits of sent MONA preference messages when receiving incoming
MONA preference messages according to MONA procedures (signals 8, 10, 14).
After sending at least 10 MONA preference messages, while the IM-MGW continues
to send and receive MONA preference messages, it shall attach MPC or SPC PDUs
if requested to do so by the MGCF as described in clauses E.4.2.7.3 and
E.4.2.7.4, respectively. If the IM-MGW receives preference messages with an
attachment, it shall inspect the first octet of that attachment that will
contain a MUX code according to table K.15 of ITU-T H.324 [81] that identifies
the attached PDU as either a MPC PDU of one of the predefined channels or a
SPC PDU. The IM-MGW shall handle the attached MPC or SPC PDUs as described in
clause E.4.2.7.3 and E.4.2.7.4, respectively.
After sending at least 10 MONA preference messages, the IM-MGW should insert
stuffing flags indicating the multiplexing level received from the MGCF
between MONA preference messages as described in clause K.7.1.1 of ITU-T H.324
[81].
The IM-MGW shall notify the MGCF when receiving the first incoming MONA
preference message (Signals 11 and 12) and forward the received information.
Subsequent incoming MONA preference message will be identical apart from
possible increments in the acknowledgement bits. The IM-MGW shall not notify
the MGCF about these messages. Upon reception of the notification of a MONA
preference message, the MGCF shall compare the received MONA preferences
message with the preferences message it sent and react as described in clause
7.1 of ITU-T H.324 [81].
When receiving an incoming MONA preference message with acknowledgment bits 10
or receiving the first non-empty H.223 MUX PDU, the IM-MGW shall notify the
MGCF about the completion of the MONA preference exchange procedure (signals
16 and 17). The notification shall be only triggered by the one of the two
events which occurs first. If the IM-MGW is not configured to send and detect
SPCs, the IM-MGW shall then stop sending MONA preference messages and, if a
MONA preference message with acknowledgment bits 10 has been received, it
shall also stop receiving MONA preference messages. If the IM-MGW is
configured to send and detect SPCs, the IM-MGW shall continue sending and
receiving MONA Preference messages encapsulating the SPC/MOS messages until
the MGCF configures the IM-MGW stop sending and detecting SPCs.
NOTE: In the unlikely case that a first non-empty H.223 MUX-PDU is received
before the first MONA Preference Message has been received, the IM-MGW will
continue the detection of incoming MONA Preference Messages and will apply the
Notify-MONA-preference-Reception-procedure after the Notify-MONA-preference-
completed procedure.
After receiving the notification about the completion of the MONA preference
exchange procedure, and a completion of the possible subsequent accelerated
H.245 setup procedures, the MGCF shall configure the multiplexing termination
T2 by indicating to the IM-MGW the contents of the incoming and outgoing
multiplex tables (Signal 19), and may modify the selected codecs at both the
MUX and the IMS side (signal 21).
#### E.4.2.7.3 Mn Interactions for MONA MPCs
NOTE 1: MONA preference messages are repeated several times. One repetition is
shown for each such message, with the same signal number as the first message.
NOTE 2: The Context model in figure E.4.2.2.1 is assumed in this call flow.
Figure E.4.2.7.3.1: Mn interactions for MONA MPCs
If the MGCF indicates the ability to receive any predefined MPCs channel types
in the MONA preferences messages, the MGCF shall request the IM-MGW to report
the channel type of received MPC PDUs (Signal 1 in figure E.4.2.7.3.1, Event
\"MPC Reception\").
If the MGCF intends to use MPCs for sending media during the MONA setup, the
MGCF shall request the IM-MGW to send available media encoded according to the
media predefined channel types defined by MONA (signal 1 in figure
E.4.2.7.3.1, Signal \"MPC MUX Code\" ) while the MONA preference exchange
described in clause E.4.2.7.2 is ongoing. The MGCF should select channel types
for codecs which are supported by both the IMS side and the IM-MGW, and/or for
codecs which could be transcoded by the IM-MGW from the codecs supported by
the IMS side. The MGCF shall only include one channel type per each desired
media type (audio, video) in the \"MPC MUX Code\" signal. The MGCF may also
configure the MGW to receive these channels at the same time by supplying the
Incoming Multiplex Table IE in the Add Multiplex Termination Procedure.
Upon reception of this request, the IM-MGW shall forward any media received
from the IMS side in MPC PDUs of the corresponding predefined channel type
attached to MONA preference messages, transcoding the media if required
(Signal 4).
According to the procedures in clause E.4.2.7.2, the IM-MGW will notify the
MGCF (signal 6) when receiving the first incoming MONA preference message
(Signals 5). The MGCF shall then analyse the Media Preconfigured Channel
Receive bits within the MONA preference message and configure the MGW
accordingly:
\- If MPC(s) that the MGCF has previously configured within the \"MPC MUX
Code\" signal are supported according to these bits, the MGCF shall configure
the IM-MGW to send these MPC using the predefined channels (signal 10) by
supplying the corresponding Outgoing Multiplex Table in the Configure
Multiplex Termination procedure (signal 8).
\- If some of the MPC(s) that the MGCF has previously configured within the
\"MPC MUX Code\" signal are not supported according to these bits, the MGCF
shall configure the IM-MGW to terminate the media on those MPC(s) by modifying
the MPC Mux Code signal using the Configure Multiplex Termination procedure.
In addition, the MGCF may configure the IM-MGW to send media on other
supported MPC(s) by supplying the corresponding Outgoing Multiplex Table in
the Configure Multiplex Termination procedure (not shown in figure
E.4.2.7.3.1).
\- If all of the MPC(s) that the MGCF has previously configured within the
\"MPC MUX Code\" signal are not supported according to these bits, the MGCF
shall configure the IM-MGW to terminate MPC operations in those unsupported
channels. The MGCF shall either remove the MPC Mux Code signal using the Stop
MPC procedure or configure the IM-MGW to send media on other supported MPC(s)
by supplying the corresponding Outgoing Multiplex Table in the Configure
Multiplex Termination procedure (not shown in figure E.4.2.7.3.1).
When the MGCF provides an Outgoing Multiplex Table, the IM-MGW shall terminate
sending any MPC PDUs as attachments to MONA preference message.
NOTE: Any previously provisioned \"MPC MUX Code\" signal becomes irrelevant.
When being notified about the receipt of the first incoming MONA preference
message, the MGCF may also analyse the Media Preconfigured Channel Receive
bits within the MONA preference message and configure the MGW with a suitable
Incoming Multiplex Table using the Configure Multiplex Termination procedure
(not shown in figure E.4.2.7.3.1).
If the IM-MGW receives the first MONA preference message with attached MPC PDU
of a given predefined channel type (signal 12), or if the IM-MGW receives the
first non-empty H.223 MUX PDU of a given predefined channel type which has
been configured with the Incoming Multiplex Table, and the MGCF has requested
a notification about such an event, the IM-MGW shall notify the MGCF about the
received channel type (signal 13). The IM-MGW shall not notify the MGCF about
subsequent receptions of MPC PDUs of the same channel type.
Upon reception of such a notification, if the IM-MGW supports the indicated
channel type and has not yet been configured to receive media of that channel
type, and if the MGCF has previously indicated the capability to receive MPCs
of that channel type within MONA preference messages, the MGCF shall configure
the IM-MGW to receive media of that channel type and forward them to the IMS
side by supplying the Incoming Multiplex Table IE in the Configure Multiplex
Termination procedure (Signal 15).
If the MGCF determines (e.g. after receipt of signal 5 or signal 12) that some
desired media channels can not be established using the MPC procedures, the
MGCF should use accelerated H.245 procedures as defined by MONA to set up
media channels. Corresponding H.245 messages shall be transported
transparently between the IM-MGW and the MGCF using the \"Signal H.245
message\" and \"Notify H.245 message\" procedures.
The MGCF can receive a forwarded MONA preference message from the IM-MGW when
the MGCF has already configured the IM-MGW to send media on an MPC. If the
processing of this message in the MGCF leads to the conclusion that MPC
procedures need to be aborted because SPC preferred (SPP) is determined, the
MGCF shall configure the IM-MGW to terminate MPC operations by removing the
MPC related event MPC-reception and MPC Mux Code signal using the Stop MPC
procedure.
#### E.4.2.7.4 Mn Interactions for MONA SPCs
##### E.4.2.7.4.1 General
H.245 PDUs for SPC shall be transported between the IM-MGW and MGCF over the
Mn interface using H.248 Events (from the IM‑MGW towards the MGCF) and H.248
Signals (from the MGCF towards the IM-MGW). The Events/Signals shall contain
the following information:
\- H.245 message (binary).
The related procedures are distinct from the procedures in clause E.4.2.3,
since the PDUs are received or sent by the IM-MGW using the SPC, i.e. as
attachment to MONA preference messages.
If the MGCF supports SPCs, it shall comply with the SPC procedures in clause
K.8 of ITU-T H.324 [81]. The repetition of sending the same SPCs will be
handled by the IM-MGW. When the MGCF receives an acknowledgement from the CS
side it shall request the IM-MGW to stop the repetition sending of the SPCs,
Within the sent SPC PDUs, the MGCF should include the codecs which are
supported by both the IMS side and the IM-MGW, and the codecs which could be
transcoded by the IM-MGW from the codecs supported by the IMS side.
##### E.4.2.7.4.2 Transport from MGCF to IM-MGW
NOTE 1: MONA preference messages are repeated several times. One repetition is
shown for each such message, with the same signal number as the first message.
NOTE 2: The Context model in figure E.4.2.2.1 is assumed in this call flow.
Figure E.4.2.7.4.2.1: Mn interactions for sending MONA SPCs
In Signal 1, the MGCF requests the IM-MGW to send an H.245 message to the CS
side. To request the IM-MGW to send a H.245 message to the CS side, the MGCF
shall sent an H.248 signal to the IM-MGW with the complete H.245 message
content.
Upon reception of this signal, the IM-MGW shall send the encapsulated H.245
message within the H.248 signal, as attachment to a MONA preference message as
described in clause K.9.4 of ITU-T H.324 [81] (signal 3). It should repeat
sending this H.245 message as attachment to subsequent MONA preference
messages.
##### E.4.2.7.4.3 Transport from IM-MGW to MGCF
NOTE 1: MONA preference messages are repeated several times. One repetition is
shown for each such message, with the same signal number as the first message.
NOTE 2: The Context model in figure E.4.2.2.1 is assumed in this call flow.
Figure E.4.2.7.4.3.1: Mn interactions for receiving MONA SPCs
In signal 1, the MGCF requests the IM-MGW to detect received H.245 message
from the CS side in SPC PDUs attached to MONA preference messages and forward
them to the MGCF. To request the IM-MGW to detect and forward these H.245
message, the MGCF shall send a suitable H.248 event to the IM-MGW. The event
may be indicated through an H.248 ADD command.
In signal 3, the IM-MGW receives an H.245 message from the CS side attached as
SPC PDU to a MONA preference message. Upon reception of such an H.245 message
from the CS side, the IM-MGW may check, based on bitwise comparison of the
previously received H.245 message, if it has already forwarded the same H.245
message to the MGCF, in which case the IM-MGW may choose not to forward the
same H.245 message to the MGCF. Otherwise the IM-MGW shall forward the H.245
message to the MGCF within an H.248 Notify command (signal 4).
NOTE: According to H.324 [81] a MOS request Ack message shall be sent to every
received MOS request. If the IM-MGW chooses, based on the bitwise comparison,
not to forward the received H.245 message to the MGCF, no MOS request Ack
message will be generated. However, the MGCF will request the IM-MGW to
automatically retransmit the MOS request Ack message generated by the MGCF
itself.
If the IM-MGW does not support forwarding SPC PDUs or has not been requested
by the MGCF to forward these PDUs, it shall discard received SPC PDUs.
##### E.4.2.7.4.4 Termination of SPC procedure
NOTE 2: The Context model in figure E.4.2.2.1 is assumed in this call flow.
Figure E.4.2.7.4.4.1: Mn interactions for terminating SPC procedure
If the processing of an incoming MONA Preference Message in the MGCF leads to
the conclusion that SPC procedures need to be aborted as a result of the test
of the SPC bits, the MGCF shall configure the IM-MGW to terminate SPC
operations by removing the SPC related event SPC-reception and SPCout signal
using the Stop SPC procedure. In this case, H.245 signalling may be started
simultaneously.
If the MGCF determines the completion of the SPC procedures according to
clause K.8 of ITU-T H.324 [81] (based on incoming signal 1 in figure
E.4.2.7.4.4.1), the MGCF shall configure the IM-MGW to stop sending and
detecting SPCs (signal 4 in figure E.4.2.7.4.4.1).
#### E.4.2.7.5 Mn Interactions for fallback from MONA procedures to standard
H.324 setup
NOTE 1: MONA preference messages are repeated several times. One repetition is
shown for each such message, with the same signal number as the first message.
NOTE 2: The Context model in figure E.4.2.2.1 is assumed in this call flow.
Figure E.4.2.7.5.1: Mn signalling interactions for fallback from MONA
procedures to standard H.324 setup
When the MGCF requests that the MONA preferences negotiation is started, the
MGCF may also initiate standard H.245 signalling towards the IM-MGW that shall
only be sent in case the IM-MGW detects legacy interworking. The MGCF arms an
event to detect legacy interworking with an embedded signal descriptor
including an H.245 message out signal. The embedded H.245 signal is the
initial H.245 TCS+MSD signal to send in case fallback to legacy interworking
is detected. The MGCF shall also request to be notified about a H.245 message
on the H.223 control channel. The MGCF shall also provision a multiplexing
level which will be advertised by the IM-MGW (Signal 6).
If the IM-MGW detects a legacy interworking condition (signal 9), it shall
stop sending MONA preference messages, including those MONA messages used to
encapsulate MPC or SPC. The IM-MGW shall engage in normal H.324 multiplexing
level negotiations. In case the MGCF armed a legacy detection event, the
embedded H.245 signal shall be sent by the IM-MGW (signal 10). The legacy
detection event is sent to the MGCF (signal 11).
The MGCF shall upon detection of legacy interworking stop MONA procedures and
continue with standard H.245 call set up procedures, as depicted in figure
E.4.2.4.1 starting with step 9.
If the IM-MGW receives a normal H.245 message (not depicted), it shall also
forward this message to the MGCF. If the MGCF receives such a H.245 message
during the MONA call setup, and this H.245 message is a normal Terminal
Capability Set message, the MGCF shall also stop MONA procedures and continue
with standard H.245 call set up procedures, as depicted in figure E.4.2.4.1
starting with step 9.
To stop MONA related procedures at the IM-MGW, the MGCF shall remove the MONA
related signals that were active (MONA Preferences, SPCout, MPC Mux Code; note
that MONA Preference and SPCout causes the MGW to send the MONA Preference
message or the contained H.245 message several times) and events
(MonaPreferenceReception, MonaPreferenceCompleted, SPC-reception and MPC-
reception, using the Stop MONA Negotiation procedure.
### E.4.2.8 Interworking between RTCP messages and H.245 messages
#### E.4.2.8.1 Overview
The following clauses describe the interworking procedures between the RTCP
messages listed in table E.4.2.8.1.1, which are used to enhance the quality of
the media distribution by MTSI terminals at the IMS side, and the
corresponding H.245 messages in 3G-324M at the CS side listed in table
E.4.2.8.1.1.
As the H.245 protocol is terminated at the MGCF and RTCP is received at the
IM-MGW, Mn procedures to support the transfer of RTCP related information are
defined in the following Clauses to support this interworking.
Table E.4.2.8.1.1: RTCP and H.245 messages that may be interworked
+----------------------+----------------------+----------------------+ | RTCP Messages | H.245 messages | Remarks | +----------------------+----------------------+----------------------+ | Picture Loss | Vi | | | Indication (PLI) | deoFastUpdatePicture | | | ([109]) | | | +----------------------+----------------------+----------------------+ | Temporary Maximum | Flow Control | This interworking | | Media Stream Bit | Command/ Flow | procedure is not | | Rate Request (TMMBR) | Control Indication | recommended. | | ([110]) | | | | | | The reception of | | | | TMMBR at the IMS | | | | side is expected to | | | | be more frequent | | | | than the reception | | | | of Flow Control | | | | Command at the CS | | | | side. | +----------------------+----------------------+----------------------+
NOTE 1: It is very unlikely that the MGCF will receive a Flow control command,
as the capability of controlling the video bit rate during a video call was
neither implemented nor tested for Ues offering 3G-324M since R99, due to the
lack of such a necessity in WCDMA where a fixed 64 kbps bearer is maintained
to continuously transport 3G-324M PDUs.
NOTE 2: Terminals are expected to support receiving the FlowControlCommand, as
this is a mandatory feature in clause 6.4.3 in H.324. But most terminals would
not really follow the received FlowControlCommand, but rather ignore it.
However, for older 3G-324M terminal lock-up or system crash was not uncommon
during IOTs. Therefore safe handling of this command is not guaranteed
absolutely
The interworking shown in table E.4.2.8.1.1 is only applicable if video is
relayed without transcoding.
If transcoding is applied, the IM-MGW should adopt its transcoder accordingly
if receiving the RTCP messages listed in table E.4.2.8.1.1, and the MGCF
should configure the transcoder in the IM-MGW accordingly if it receives the
H.245 messages in table E.4.2.8.1.1.
For an MGCF and IM-MGW that support video interworking as specified in the
present Annex E, the support of the procedures in the present clause E.4.2.8.2
and E.4.2.8.3 is optional.
#### E.4.2.8.2 IM CN subsystem originated RTCP messages
The MGCF may configure the IM-MGW to detect specific received RTCP packets and
forward information derived from it by providing a bit pattern(s) for bits
3-15 of incoming RTCP packets as filter criterion in an event descriptor of
event \"RTCP-interworking\". Bits 3-7 in the RTCP packet represent the
Feedback message type (FMT), and bits 8-15 in the RTCP packet represent the
Payload type (PT) RTCP header fields, see IETF RFC 4585 [109]. For instance,
to request that an AVPF Picture Loss Indication (PLI) packet is detected for
interworking, the MGCF needs to configure a combination of PT=206 (Payload-
specific FB message) and FMT=1 (see IETF RFC 4585 [109]). To request that a
AVPF Temporary Maximum Media Bit-rate Request (TMMBR) packet is detected for
interworking, the MGCF needs to configure a combination of PT=205 (transport
layer feedback message) and FMT=3 (see IETF RFC 5104 [110]).
A IM-MGW configured in this way shall check after receiving an incoming RTCP
Packet if it is of a desired type, as expressed by a bit pattern received from
the MGCF. An incoming RTCP message can be of compound format and contain
several RTCP packets. The IM-MGW shall then perform the check separately for
each packet. If the IM-MGW determines that the received RTCP packet is of a
desired type, the IM-MGW shall send information derived from the RTCP message
as ObservedEventsDescriptor Parameter(s) of event \"RTCP-interworking\" in an
H.248 \"Notify\" message to the MGCF.
The information derived from the RTCP message to be sent to the MGCF is listed
in table E.4.2.8.2.1. Information elements in table E.4.2.8.2.1 shall only be
sent if the corresponding RTCP message has been received.
Table E.4.2.8.2.1: RTCP information elements to be notified over Mn
* * *
RTCP message Information elements transported over Mn interface Remarks
Picture Loss Indication (PLI) ([109]) UpdatePicture  
Temporary Maximum Media Stream Bit Rate Request (TMMBR) ([110]) MaxBitRate
This information indicates the maximum media stream bit rate as received
within the TMMBR.
* * *
Figure E.4.2.8.2.2.1 shows examples of interactions between RTCP and H.245 for
IM CN subsystem originated feedback on the quality of the media distribution.
Figure E.4.2.8.2.2.1: Interactions between RTCP and H.245 for IM CN subsystem
originated RTCP feedback on the quality of the media distribution
In signal 1, the MGCF requests the IM-MGW to detect received RTCP feedback
message from the IMS side and notify the feedback information elements to the
MGCF when the interworking is required. To request the IM-MGW to detect and
notify these feedback information elements, the MGCF shall send the \"RTCP-
interworking\" H.248 event to the IM-MGW. The event may be indicated through
an H.248 MOD command.
In signal 3, the IM-MGW receives a RTCP feedback message from the IMS side.
In signal5, the IM-MGW notifies the feedback information elements from RTCP
message to the MGCF.
In signal7, the MGCF send the corresponding H.245 message to the CS side to
request for the media adaption.
#### E.4.2.8.3 CS network originated H.245 messages
Figure E.4.2.8.3.2.1 shows examples of interactions between H.245 and RTCP for
CS network originated feedback on the quality of the media distribution.
Figure E.4.2.8.3.2.1: Interactions between H.245 and RTCP for CS network
originated H.245 feedback on the quality of the media distribution
In signal 1, the MGCF receives an H.245 feedback message from the CS side.
In signal3, the MGCF requests the IM_MGW to send an RTCP message provisioning
the signal \"H.245 interworking\" with parameters identifying information to
be transported within this RTCP message.
In signal5, the IM-MGW send the corresponding RTCP message to the IMS side to
request for the media adaption.
To request the IM-MGW to send an RTCP message, the MGCF shall send the
corresponding information elements listed in table E.4.2.8.3.2.1 as parameters
of the \"H.245-interworking signal\" over the Mn interface.
Table E.4.2.8.3.2.1: Feedback information elements to be indicated
* * *
RTCP message Information elements transported over Mn interface Remarks
Picture Loss Indication (PLI) ([109]) UpdatePicture  
Temporary Maximum Media Stream Bit Rate Request (TMMBR) ([110]) MaxBitRate
This information indicates the maximum media stream bit rate to be sent within
the TMMBR.
* * *
## E.4.3 Mn Signalling procedures
### E.4.3.1 Overview
This clause describes the logical signalling procedures (i.e. message
identifiers are not part of the protocol) between the MGCF and IM-MGW. The
procedures within this clause are intended to be implemented using the
standard H.248 procedure as defined in ITU recommendation H.248.1 [2] with
appropriate parameter combinations.
### E.4.3.2 Add Multiplex Termination
This procedure is used to add a termination to multiplex/demultiplex H.223.
This procedure containing the MuxDescriptor with H.223 value enables the IM-
MGW to start the H.324 Multiplexing Level Negotiation.
Table E.4.3.2.1: Add Multiplex Termination Procedure
+-------------+-----------+-------------+-------------+-------------+ | Procedure | Initiated | Information | Information | Information | | | | element | element | element | | | | name | required | description | +-------------+-----------+-------------+-------------+-------------+ | Add | MGCF | Context | M | This | | Multiplex | | | | information | | Termination | | | | element | | | | | | indicates | | | | | | the | | | | | | existing | | | | | | context. | +-------------+-----------+-------------+-------------+-------------+ | | | Termination | M | This | | | | | | information | | | | | | element | | | | | | requests a | | | | | | new | | | | | | termination | +-------------+-----------+-------------+-------------+-------------+ | | | Mu | M | This | | | | xDescriptor | | information | | | | | | element | | | | | | indicates | | | | | | that data | | | | | | multiplexed | | | | | | according | | | | | | to H223 | | | | | | shall be | | | | | | received, | | | | | | and from | | | | | | which | | | | | | t | | | | | | ermination. | +-------------+-----------+-------------+-------------+-------------+ | | | Notify | M | This | | | | Termination | | information | | | | Heartbeat | | element | | | | | | requests | | | | | | termination | | | | | | heartbeat | | | | | | indications | +-------------+-----------+-------------+-------------+-------------+ | | | Notify | O | This | | | | Released | | information | | | | Bearer | | element | | | | | | requests a | | | | | | n | | | | | | otification | | | | | | of a | | | | | | released | | | | | | bearer. | +-------------+-----------+-------------+-------------+-------------+ | | | Incoming | M | This Event | | | | H.245 | | shall | | | | message | | indicate | | | | N | | that a | | | | otification | | N | | | | Request | | otification | | | | | | about H.245 | | | | | | messages | | | | | | received by | | | | | | the IM-MGW | | | | | | is | | | | | | requested | | | | | | by the MGCF | +-------------+-----------+-------------+-------------+-------------+ | | | MONA | O | This | | | | Preferences | | information | | | | | | element | | | | | | requests | | | | | | the MGW to | | | | | | start a | | | | | | MONA | | | | | | negotiation | | | | | | and | | | | | | provisions | | | | | | MONA | | | | | | preferences | | | | | | to be | | | | | | indicated | | | | | | by the | | | | | | IM-MGW, | | | | | | encoded as | | | | | | described | | | | | | in | | | | | | clause K.6 | | | | | | of ITU-T | | | | | | H | | | | | | .324 [81] | +-------------+-----------+-------------+-------------+-------------+ | | | MONA | O | This | | | | Preference | | information | | | | Reception | | element | | | | | | requests a | | | | | | n | | | | | | otification | | | | | | of the | | | | | | reception | | | | | | of the | | | | | | first MONA | | | | | | preference | | | | | | message. | +-------------+-----------+-------------+-------------+-------------+ | | | MONA | O | This | | | | Preference | | information | | | | Completed | | element | | | | | | requests a | | | | | | n | | | | | | otification | | | | | | of the | | | | | | reception | | | | | | of the | | | | | | first MONA | | | | | | preference | | | | | | message | | | | | | with | | | | | | indication | | | | | | that the | | | | | | MONA | | | | | | preference | | | | | | negotiation | | | | | | is | | | | | | completed. | +-------------+-----------+-------------+-------------+-------------+ | | | Legacy | O | This | | | | Detected | | information | | | | | | element | | | | | | requests a | | | | | | n | | | | | | otification | | | | | | of a legacy | | | | | | i | | | | | | nterworking | | | | | | condition. | | | | | | The Event | | | | | | Descriptor | | | | | | also embeds | | | | | | a signal | | | | | | descriptor | | | | | | including | | | | | | an H.245 | | | | | | message out | | | | | | signal | | | | | | which shall | | | | | | be send | | | | | | when legacy | | | | | | i | | | | | | nterworking | | | | | | is detected | +-------------+-----------+-------------+-------------+-------------+ | | | MPC | O | This | | | | Reception | | information | | | | | | element | | | | | | requests a | | | | | | n | | | | | | otification | | | | | | of the | | | | | | reception | | | | | | of the | | | | | | first MONA | | | | | | preference | | | | | | message | | | | | | with | | | | | | attached | | | | | | MPC. | +-------------+-----------+-------------+-------------+-------------+ | | | SPC | O | This | | | | Reception | | information | | | | | | element | | | | | | requests a | | | | | | n | | | | | | otification | | | | | | of the | | | | | | reception | | | | | | of a MONA | | | | | | preference | | | | | | message | | | | | | with | | | | | | attached | | | | | | SPC. | +-------------+-----------+-------------+-------------+-------------+ | | | Incoming | O | This | | | | Multiplex | | information | | | | Table | | element | | | | | | indicates | | | | | | the value | | | | | | of the H245 | | | | | | Multipl | | | | | | exEntrySend | | | | | | message and | | | | | | allows the | | | | | | MGW to | | | | | | identify | | | | | | incoming | | | | | | H.223 MUX | | | | | | PDUs of the | | | | | | channel | | | | | | types given | | | | | | in the | | | | | | table. | +-------------+-----------+-------------+-------------+-------------+ | | | MPC Mux | O | This | | | | Code | | information | | | | | | element | | | | | | requests | | | | | | the MGW to | | | | | | send | | | | | | available | | | | | | media in | | | | | | MPCs and | | | | | | indicates | | | | | | the channel | | | | | | type to use | | | | | | for sending | | | | | | media. | +-------------+-----------+-------------+-------------+-------------+ | Add | IM-MGW | Context | M | This | | Multiplex | | | | information | | Termination | | | | element | | | | | | indicates | | Ack | | | | the context | | | | | | where the | | | | | | command was | | | | | | executed. | +-------------+-----------+-------------+-------------+-------------+ | | | Termination | M | This | | | | | | information | | | | | | element | | | | | | indicates | | | | | | the new | | | | | | termination | | | | | | where the | | | | | | command was | | | | | | executed. | +-------------+-----------+-------------+-------------+-------------+
### E.4.3.3 Configure Multiplex Termination
This procedure is used to configure a termination to multiplex/demultiplex
H.223. It is also used to exclude some of the outgoing MPC channel types due
to the MONA Preference received from the peer.
Table E.4.3.3.1: Configure Multiplex Termination Procedure
* * *
Procedure Initiated Information element name Information element required
Information element description
Configure Multiplex Termination MGCF Context M This information element
indicates the existing context.
                                                 Termination                M                              This information element indicates the termination
                                                 Remote H223 Capability     O                              This information element indicates the remote H223 capabilities, as received by the MGCF. The element shall not be included if the MPC Mux Code IE is included.
                                                 Incoming Multiplex Table   O                              This information element indicates the value of the H245 MultiplexEntrySend message, as received by the MGCF from the remote H.245 peer. Either this element or the MPC Mux Code IE shall be included.
                                                 Outgoing Multiplex Table   O                              This information element indicates the value of the H245 MultiplexEntrySend message, as sent by the MGCF towards the remote H.245 peer. Either this element or the MPC Mux Code IE shall be included.
                                                 MPC Mux Code               O                              This information element requests the MGW to continue sending available media in MPC and indicates the channel type to use for sending media. It is used in this procedure only to restrict the list of channel types indicated previously in the Add Multiplex Termination procedure. Either this element or the Incoming and Outgoing Multiplex Table elements shall be included.
Configure Multiplex Termination\ IM-MGW Context M This information element
indicates the context where the command was executed. Ack
                                                 Termination                M                              This information element indicates the termination where the command was executed.
* * *
### E.4.3.4 Signal H245 Message
This procedure is used to send a H245 message to the IM-MGW that the IM-MGW
shall forward towards the CS side within H.223.
Table E.4.3.4.1: Signal H245 Message Procedure
* * *
Procedure Initiated Information element name Information element required
Information element description Signal H245 Message MGCF Context M This
information element indicates the existing context. Termination M This
information element indicates the termination Signal M This information
element indicates the signal to request forwarding of a H245 message towards
the CS side within H.223 H.245 message M This information element indicates
the H.245 message to be forwarded Signal H245 Message Ack IM-MGW Context M
This information element indicates the context where the command was executed.
Termination M This information element indicates the termination where the
command was executed.
* * *
### E.4.3.5 Notify H245 Message
This procedure is used by the IM-MGW to notify the MGCF that the IM-MGW has
received a H245 message from the CS side within H.223.
Table E.4.3.5.1: Notify H245 Message Procedure
* * *
Procedure Initiated Information element name Information element required
Information element description Notify H245 Message IM-MGW Context M This
information element indicates the existing context. Termination M This
information element indicates the termination Event M This information element
indicates the event to indicate that a H245 message has been received from the
CS side within H.223 H.245 message M information element indicates the
received H.245 message Notify H245 Message Ack MGCF Context M This information
element indicates the context where the command was executed. Termination M
This information element indicates the termination where the command was
executed.
* * *
### E.4.3.6 Notify MONA Preference Reception
This procedure is used by the IM-MGW to notify the MGCF that the IM-MGW has
received the first MONA preference Message from the CS side.
Table E.4.3.6.1: Notify MONA Preference Reception Procedure
* * *
Procedure Initiated Information element name Information element required
Information element description Notify H245 Message IM-MGW Context M This
information element indicates the existing context. Termination M This
information element indicates the termination Event M This information element
indicates the event to indicate that a MONA Preference Message has been
received MONA Preferences M This information element indicates the received
MONA preference message Notify H245 Message Ack MGCF Context M This
information element indicates the context where the command was executed.
Termination M This information element indicates the termination where the
command was executed.
* * *
### E.4.3.7 Notify MONA Preference Completed
This procedure is used by the IM-MGW to notify the MGCF that the IM-MGW has
received the first MONA preference Message with indication that the MONA
preference negotiation is completed.
Table E.4.3.7.1: Notify MONA Preference Completed Procedure
* * *
Procedure Initiated Information element name Information element required
Information element description Notify H245 Message IM-MGW Context M This
information element indicates the existing context. Termination M This
information element indicates the termination Event M This information element
indicates the event to indicate that the first MONA preference Message with
indication that the MONA preference negotiation is completed received Notify
H245 Message Ack MGCF Context M This information element indicates the context
where the command was executed. Termination M This information element
indicates the termination where the command was executed.
* * *
### E.4.3.8 Signal SPC
This procedure is used to send a H245 message to the IM-MGW that the IM-MGW
shall forward towards the CS side using the SPC, i.e. as attachment to MONA
preference messages.
Table E.4.3.8.1: Signal SPC Procedure
* * *
Procedure Initiated Information element name Information element required
Information element description Signal H245 Message MGCF Context M This
information element indicates the existing context. Termination M This
information element indicates the termination Signal M This information
element indicates the signal to request forwarding of a H245 message towards
the CS side using the SPC, i.e. as attachment to MONA preference messages
H.245 message M This information element indicates the H.245 message to be
forwarded Signal H245 Message Ack IM-MGW Context M This information element
indicates the context where the command was executed. Termination M This
information element indicates the termination where the command was executed.
* * *
### E.4.3.9 Notify SPC
This procedure is used by the IM-MGW to notify the MGCF that the IM-MGW has
received a H245 message from the CS side in SPC PDUs attached to MONA
preference messages.
Table E.4.3.9.1: Notify SPC Procedure
* * *
Procedure Initiated Information element name Information element required
Information element description Notify H245 Message IM-MGW Context M This
information element indicates the existing context. Termination M This
information element indicates the termination Event M This information element
indicates the event to indicate that a H245 message has been received from the
CS side in SPC PDUs attached to MONA preference messages H.245 message M
information element indicates the received H.245 message Notify H245 Message
Ack MGCF Context M This information element indicates the context where the
command was executed. Termination M This information element indicates the
termination where the command was executed.
* * *
### E.4.3.10 Notify MPC
This procedure is used by the IM-MGW to notify the MGCF that the IM-MGW has
received the first MONA preference message with attached MPC from the CS side.
Table E.4.3.10.1: Notify MPC Procedure
* * *
Procedure Initiated Information element name Information element required
Information element description Notify H245 Message IM-MGW Context M This
information element indicates the existing context. Termination M This
information element indicates the termination Event M This information element
indicates the event to indicate that the first MONA preference message with
attached MPC has been received. MuxCode M information element that indicates
the received Channel Type Notify H245 Message Ack MGCF Context M This
information element indicates the context where the command was executed.
Termination M This information element indicates the termination where the
command was executed.
* * *
### E.4.3.11 Notify Detection of Legacy Interworking
This procedure is used by the IM-MGW to notify the MGCF that the IM-MGW
detects a legacy interworking condition that causes it to abort MONA
procedures.
Table E.4.3.11.1: Notify Detection of Legacy Interworking Procedure
* * *
Procedure Initiated Information element name Information element required
Information element description Notify H245 Message IM-MGW Context M This
information element indicates the existing context. Termination M This
information element indicates the termination Event M This information element
indicates the event to indicate that a legacy interworking condition has been
detected. Notify H245 Message Ack MGCF Context M This information element
indicates the context where the command was executed. Termination M This
information element indicates the termination where the command was executed.
* * *
### E.4.3.12 Request RTCP-Interworking
This procedure is used by the MGCF to request the IM-MGW to detect the RTCP
feedback message on the quality of the media distribution requiring
interworking.
Table E.4.3.12.1: Request RTCP-Interworking
* * *
Procedure Initiated Information element name Information element required
Information element description Request RTCP-Interworking MGCF Context M This
information element indicates the existing context. Termination M This
information element indicates an existing RTCPfilter M This information
element provides one or several bit pattern(s) for bits 3-15 of an RTCP
packet. Information from RTCP packets that match those patterns shall be
notified to the MGCF. RTCP-Interworking M This information element requests a
notification about information derived from the incoming RTCP packet types
denoted by RTCPfilter. Request RTCP-Interworking Ack IM-MGW Context M This
information element indicates the context where the command was executed.
Termination M This information element indicates the new termination where the
command was executed.
* * *
### E.4.3.13 Notify RTCP-Interworking
This procedure is used by the IM-MGW to notify the MGCF the feedback
information elements when the IM-MGW detects a RTCP feedback message on the
quality of the media distribution requiring interworking.
Table E.4.3.13.1: Notify of RTCP-Interworking
* * *
Procedure Initiated Information element name Information element required
Information element description Notify RTCP-Interworking IM-MGW Context M This
information element indicates the existing context. Termination M This
information element indicates the termination UpdatePicture C This information
element shall be included upon reception of a RTCP PLI message. It indicates
the request of sending of full intra-pictures. MaxBitRate C This information
element shall be included upon reception of a RTCP TMMBR message. It shall
contain the bandwidth as indicated in the RTCP TMMBR message excluding the
overhead indicated in the RTCP TMMBR message. Notify RTCP-Interworking Ack
MGCF Context M This information element indicates the context where the
command was executed. Termination M This information element indicates the
termination where the command was executed.
* * *
### E.4.3.14 Signal-H.245-Interworking
This procedure is used by the MGCF to indicate the IM-MGW the feedback
information elements when a H.245 feedback message on the quality of the media
distribution requiring interworking is received.
Table E.4.3.14.1: Signal H.245-Interworking
* * *
Procedure Initiated Information element name Information element required
Information element description Signal H.245-Interworking MGCF Context M This
information element indicates the existing context. Termination M This
information element indicates the termination UpdatePicture C This information
element indicates the request to send a RTCP PLI message. MaxBitRate C This
information element indicates the request to send a RTCP TMBR message. It
shall contain the bandwidth as indicated in the RTCP TMMBR message excluding
the overhead indicated in the RTCP TMMBR message. Signal H.245-Interworking
Ack IM-MGW Context M This information element indicates the context where the
command was executed. Termination M This information element indicates the
termination where the command was executed.
* * *
### E.4.3.15 Stop MPC
This procedure is used by the MGC to indicate to the MG that it is no longer
allowed to send MPC media encapsulated in MONA Preference messages and that it
shall stop MPC detection.
Table E.4.3.15.1: Stop MPC
* * *
Procedure Initiated Information element\ Information element required
Information element description name
Stop MPC MGCF Context M This information element indicates the existing
context.
                             Termination            M                              This information element indicates the termination
                             Stop MPC Reception     M                              This information element indicates that the reception of MPC encapsulated in MONA Preference Messages shall be stopped.
                             Stop MPC Sending       M                              This information element requests that the sending of the MPC shall be stopped.
Stop MPC Ack IM-MGW Context M This information element indicates the context
where the command was executed.
                             Termination            M                              This information element indicates the termination where the command was executed.
* * *
### E.4.3.16 Stop SPC
This procedure is used by the MGC to indicate to the MG that it is no longer
allowed to send MPC media encapsulated in MONA Preference messages and that it
shall stop SPC detection.
Table E.4.3.16.1: Stop MPC
* * *
Procedure Initiated Information element\ Information element required
Information element description name
Stop SPC MGCF Context M This information element indicates the existing
context.
                             Termination            M                              This information element indicates the termination
                             Stop SPC Sending       M                              This information element requests that the sending of SPC encapsulated in MONA Preference messages shall be stopped.
                             Stop SPC Detection     M                              This information element requests that the detection of received SPC encapsulated in MONA Preference Message shall be stopped.
Stop SPC Ack IM-MGW Context M This information element indicates the context
where the command was executed.
                             Termination            M                              This information element indicates the termination where the command was executed.
* * *
### E.4.3.17 Stop MONA Negotiation
This procedure is used by the MGC to request the MG to stop all MONA
nogotiation related procedures.
Table E.4.3.17.1: Stop MONA Negotiation
+-------------+-----------+-------------+-------------+-------------+ | Procedure | Initiated | Information | Information | Information | | | | element\ | element | element | | | | name | required | description | +-------------+-----------+-------------+-------------+-------------+ | Stop MONA | MGCF | Context | M | This | | Negotiation | | | | information | | | | | | element | | | | | | indicates | | | | | | the | | | | | | existing | | | | | | context. | +-------------+-----------+-------------+-------------+-------------+ | | | Termination | M | This | | | | | | information | | | | | | element | | | | | | indicates | | | | | | the | | | | | | termination | +-------------+-----------+-------------+-------------+-------------+ | | | Stop MONA | M | This | | | | Preference | | information | | | | Message | | element | | | | Sending | | requests | | | | | | that the | | | | | | sending of | | | | | | MONA | | | | | | Preference | | | | | | messages be | | | | | | stopped. | +-------------+-----------+-------------+-------------+-------------+ | | | Stop MONA | M | This | | | | Detection | | information | | | | | | element | | | | | | requests | | | | | | that the | | | | | | detection | | | | | | of first | | | | | | MONA | | | | | | Preference | | | | | | Message and | | | | | | of the MONA | | | | | | negotiation | | | | | | completion | | | | | | be stopped. | +-------------+-----------+-------------+-------------+-------------+ | | | Stop SPC | C | This | | | | Sending | | information | | | | | | element | | | | | | requests | | | | | | that the | | | | | | sending of | | | | | | SPC | | | | | | e | | | | | | ncapsulated | | | | | | in MONA | | | | | | Preference | | | | | | messages be | | | | | | stopped. | | | | | | | | | | | | Required | | | | | | only if SPC | | | | | | sending was | | | | | | previously | | | | | | configured. | +-------------+-----------+-------------+-------------+-------------+ | | | Stop SPC | C | This | | | | Detection | | information | | | | | | element | | | | | | requests | | | | | | that the | | | | | | detection | | | | | | of received | | | | | | SPC | | | | | | e | | | | | | ncapsulated | | | | | | in MONA | | | | | | Preference | | | | | | Message be | | | | | | stopped. | | | | | | | | | | | | Required | | | | | | only if SPC | | | | | | reception | | | | | | was | | | | | | previously | | | | | | configured. | +-------------+-----------+-------------+-------------+-------------+ | | | Stop MPC | C | This | | | | Reception | | information | | | | | | element | | | | | | indicates | | | | | | that the | | | | | | reception | | | | | | of MPC | | | | | | e | | | | | | ncapsulated | | | | | | in MONA | | | | | | Preference | | | | | | Messages | | | | | | shall be | | | | | | stopped. | | | | | | | | | | | | Required | | | | | | only if MPC | | | | | | reception | | | | | | was | | | | | | previously | | | | | | configured. | +-------------+-----------+-------------+-------------+-------------+ | | | Stop MPC | C | This | | | | Sending | | information | | | | | | element | | | | | | requests | | | | | | that the | | | | | | sending of | | | | | | the MPC | | | | | | shall be | | | | | | stopped. | | | | | | | | | | | | Required | | | | | | only if MPC | | | | | | sending was | | | | | | previously | | | | | | configured. | +-------------+-----------+-------------+-------------+-------------+ | Stop MONA | IM-MGW | Context | M | This | | Negotiation | | | | information | | Ack | | | | element | | | | | | indicates | | | | | | the context | | | | | | where the | | | | | | command was | | | | | | executed. | +-------------+-----------+-------------+-------------+-------------+ | | | Termination | M | This | | | | | | information | | | | | | element | | | | | | indicates | | | | | | the | | | | | | termination | | | | | | where the | | | | | | command was | | | | | | executed. | +-------------+-----------+-------------+-------------+-------------+
###### ## Annex F (normative): PSTN XML Scheme
# F.1 Scope
This clause defines the PSTN XML Schema to be used for providing the
BearerCapability, Low Layer Compatibility, High Layer Compatibility and
Progress indicator embedded as body in SIP messages.
The support of this PSTN XML Schema is a network option.
# F.2 MIME type
The XML schema defined in the present Annex is registered at IANA as
\"application/vnd.etsi.pstn+xml\" MIME type.
If the XML scheme is embedded in SIP messages as body, the Content-Type header
shall be set to \"application/vnd.etsi.pstn+xml\" and the Content-Disposition
shall be set to \"signal\" with the \"handling\" parameter set to
\"optional\".
# F.3 XML Schema definition
\
\
\
\XML Schema definition for mapping of some PSTN into SIP
MIME Bodies\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
\
# F.4 IANA registration template
Within the present subclause, information required for an IANA registration at
[http://www.iana.org/cgi-bin/mediatypes.pl]{.underline} is provided.
1\. Media Type Name
Application
2\. Subtype name
\"vnd.etsi.pstn+xml\" (Vendor Tree)
3\. Required parameters
none
4\. Optional parameters
none
5\. Encoding considerations
binary
6\. Security considerations
The security considerations for XML in RFC 3023 apply.
Modifications of the MIME body by a man-in-the-middle can have severe
consequences:
The information derived from ISUP that can be transported with this MIME body
influence the call handling of the SIP session that is being setup.
However, this MIME body is used only attached to SIP messages, and
modifications of other parts of the SIP signalling will lead to comparable
consequences. Protection of the SIP signalling will also protect the present
MIME body. The SIP signalling should be protected as described in RFC 3261.
7\. Interoperability considerations
None
8\. Published specification
3GPP TS 29.163
9\. Applications which use this media type
This MIME type is used as a message body within SIP messages.
It is used for sending information derived from ISUP or DSS1 signalling with
no SIP equivalent.
10\. Additional information
Magic number(s): none (see RFC 3023)
File extension(s): \".xml\" (see RFC 3023)
Macintosh File Type Code(s): \"Text\" (see RFC 3023)
Object Identifier(s) or OID(s): none
11\. Intended usage
Limited Use
12\. Other Information/General Comment
The content of this MIME type is UTF-8 encoded. The charset parameter is not
used.
###### ## Annex G (informative): Void
NOTE: The former contents of this annex are now contained in 3GPP TS 24.229
[9].
###### ## Annex H (normative): Interworking of Originating Line Information
(OLI) parameter (network option)
# H.1 Interworking SIP to ISUP
The \"oli\" URI parameter received within tel URI or the userinfo part of SIP
URI with user=\"phone\" (as defined in clause 7.2A.12 of 3GPP TS 24.229 [9])
received in a P-Asserted-Identity header in the initial INVITE request shall
be used to set the ISUP IAM OLI parameter. In case the P-Asserted-Identity URI
\"oli\" parameter is absent then the ISUP IAM OLI parameter shall be omitted.
# H.2 Interworking ISUP to SIP
The ISUP IAM OLI parameter shall be used to set the \"oli\" URI parameter
within tel URI or the userinfo part of SIP URI with user=\"phone\" parameter
(as defined in clause 7.2A.12 of 3GPP TS 24.229 [9]) of a P-Asserted-Identity
header in the initial INVITE request. In case the ISUP IAM OLI parameter is
absent then the P-Asserted-Identity URI \"oli\" parameter shall be omitted
from the initial INVITE request.
###### ## Annex I (normative): GTT interworking between the IP Multimedia Core
Network (CN) Subsystem (IMS) and Circuit Switched (CS) networks
# I.1 Overview of GTT interworking between the IMS and Circuit Switched (CS)
networks
The support of Global Text Telephony (GTT) is optional, but may be required by
national regulatory requirements. If GTT is supported, the procedures
described within this Annex shall be applied.
Global Text Telephony (GTT) offers real time conversation in text, optionally
combined with voice. GTT is mainly used for distant conversation with hearing
or speech impaired users.
GTT is supported in IMS via the Real-Time Text protocol over RTP, using IETF
SIP/SDP for the negotiation of the text media and IETF RFC 4103 [124] RTP-text
for transport, with text coded according to ITU‑T Recommendation T.140 [123].
See 3GPP TS 23.226 [122] and 3GPP TS 26.114 [104].
In PSTN, different specified systems for text telephony exist and are used in
different regions, e.g. Baudot (in US), EDT, V.21, Bell103, Minitel and V.18.
They all use different modem technologies within PCM and different character
coding for the transmission of text. They are described in the annexes of
ITU-T Recommendation V.18 [125]. ITU-T Recommendation V.18 [125] is an
international text telephone modem standard with an automoding mechanism that
enables communication with all the different kinds of PSTN text telephone
systems. Any party of a GTT call may at any time initiate text or send voice.
Speech and text may be used in an alternating manner during a conversation on
the PSTN. It is also possible that speech is transferred in one direction and
text in the opposite direction. However, speech and text can not be used in
the same direction at the same time in most sub-modes of V.18.
In the 3GPP CS radio interface, a dedicated CTM modem is used (see 3GPP TS
26.226 [126]), which is terminated within the CS domain and interworked to
PTSN inband text telephony format.
Interworking between Real-Time Text over RTP within IMS and PSTN text
telephony is provided at the MGCF / IM-MGW by the MGCF triggering the
insertion of an Interworking (conversion) function within the IM-MGW which
then behaves in accordance with ITU‑T Recommendation V.18 [125] or any of its
specific sub-modes.
The support of this Interworking function between IP-based Real-Time Text over
RTP and modem based transmission of real-time text is optional both at the
MGCF and IM-MGW, but can be required by national regulatory bodies. If this
Interworking function is supported, the procedures described within this Annex
shall be applied.
The Interworking function in the IM-MGW shall support the detection of text
modem signals on the CS side and the conversion between text/modem signals and
Real-Time Text over RTP.
The IM_MGW shall support at least one of the sub-modes listed in ITU-T
Recommendation V.18 [125] (e.g. Baudot). The support of any of the sub-modes
is optional.
The procedures to detect and convert text/modem involve expensive MGW
resources. The present GTT interworking procedures intend to allow cost
effective implementations by avoiding additional load or resources in MGW for
calls not using text telephony (which represent most of the calls).
It is assumed that IMS terminals supporting text media will not automatically
offer text media, but that this will be instead governed by terminal
configuration options and user interactions to suit the communication
preferences and abilities of the user. However, an IMS terminal desiring to
set up a GTT call will offer Real-Time Text media, possibly in parallel to
voice media. The IMS-MGW shall then provide the conversion between Real-Time
Text over RTP and text/modem signals. On the contrary, if the mobile does not
request Real-Time Text support, no Interworking function is necessary. An IMS
Multimedia terminal configured to use Real-Time Text Telephony but receiving
an SDP offer for voice-only media will accept this offer and then send an own
subsequent SDP offer adding text media. When receiving such a subsequent offer
for text media, the IMS-MGW shall provide the conversion between Real-Time
Text over RTP and text/modem signals at the CS interface. On the contrary, if
the mobile does not offer Real-Time Text, no Interworking function is
necessary.
# I.2 Control plane interworking
## I.2.1 General
Before text conversation can begin, a call shall first be established, from
PSTN to IMS or vice-versa. The ISUP or BICC signalling to/from the PSTN
indicates a \"speech\" call, without any GTT indication.
The IMS user may request a text connection from the beginning of a call, or
add request for Real-Time Text media at a later stage in a call that was
originally established with audio only.
## I.2.2 Functionalities required in the MGCF for GTT calls support
In addition to the control plane interworking between SIP and ISUP or BICC
(see clause 7), the MGCF shall support the negotiation of the Real-Time Text
payload type (T.140 Text Conversation MIME media type as specified by IETF RFC
4103 [124]) in a distinct SDP m-line.
## I.2.3 IM CN subsystem originated session
### I.2.3.1 Initial INVITE with an SDP offer including a text media line
Figure I.2.3.1.1 shows an example call flow where the IMS terminal requests
Real-Time Text telephony by sending an SDP offer including one audio line and
one text media line within an initial INVITE message.
Figure I.2.3.1.1: IM CN subsystem originated session - Initial INVITE offering
audio and text
Upon receipt of a SIP INVITE request offering text media (possibly combined
with audio media) (signal 1 in figure I.2.3.1.1) the Interworking Node (MGCF)
starts the call set-up at the CS side by sending an IAM requesting a speech
with G.711 codec only or 3.1 Khz bearer (signal 2 in figure I.2.3.1.1), and
completes the call setup on IMS and CS side using the procedures specified in
clause 7, but returning an SDP answer including Real-Time Text media (possibly
combined with audio media if audio media has been offered) (signal 3 in figure
I.2.3.1.1).
The MGCF triggers the insertion an Interworking function in the IM-MGW for the
duration of the call if a Real-Time Text media stream is established.
The MGCF reserves corresponding Real-Time Text media resources in the IM-MGW
and activate the Interworking function, and if resources were available,
return an SDP answer with audio and Real-Time Text.
## I.2.4 CS network originated session
### I.2.4.1 General
When starting the session setup signalling from a CS based network towards the
IMS, the MGCF has no knowledge whether the CS side terminal supports and will
accept to use text telephony.
### I.2.4.2 Initial INVITE with an SDP offer including audio only
The MGCF offers only audio media when setting up a call towards the IMS and
waits for IMS terminals desiring Real-Time Text media to send a new offer
adding Real-Time Text media attribute prior to inserting an Interworking
function in the IM-MGW. If the MGCF receives a new offer adding Real-Time Text
media and applies signalling with OoBTC on the CS CN, the MGCF shall apply
appropriate OoBTC procedures to only select G.711 audio codec on the CS call
leg.
Figure I.2.4.2.1 shows an example call flow.
Figure I.2.4.2.1: CS originated session - Initial INVITE offering audio only
Upon receipt of an IAM request for a speech or 3.1 Khz audio call (signal 1 in
figure I.2.4.2.1) the Interworking Node (MGCF) starts the call set-up at the
IM CN subsystem side by sending an INVITE request (signal 2 in figure
I.2.4.2.1) offering audio media applying the interworking procedures in Clause
7.
IMS terminals supporting GTT and configured to use it will send a new SDP
offer including an audio and a Real-Time Text media line within a subsequent
UPDATE or re-INVITE request.
When GTT interworking between IMS and CS networks is required, the MGCF shall
reserve corresponding Real-Time Text media resources in the IM-MGW and thereby
request the insertion of the Interworking function, and if resources were
available, return an SDP answer with audio and Real-Time Text media
attributes.
## I.2.5 Subsequent SDP offer/answer exchange adding text to an audio session
If only audio media has been offered in the initial SDP offer, the IMS
terminal can also request GTT support by sending a new SDP offer including
audio and Real-Time Text when a SIP dialogue (early or confirmed) has already
been established.
The MGCF shall then trigger the insertion of an Interworking function in the
IM-MGW following the same principles as those specified in clause I.2.3.14.
However, if OoBTC signalling is supported and a codec other than PCM (default
G.711) has been selected at the CS network, then a codec modification is
required to G.711. Otherwise No additional ISUP or BICC signalling towards the
CS network is required.
# I.3 User plane interworking
## I.3.1 Functionalities required in the IM-MGW for GTT support
An IM-MGW supporting GTT interworking between IMS and CS network shall
support:
\- Real-Time Text as specified in 3GPP TS 26.114 [104] for a Multimedia
Telephony Service Indicator (MTSI) compliant IM-MGW; this includes:
\- requirement to support ITU-T Recommendation T.140 [123] Text Conversation
MIME media type and RTP-text transport as specified by IETF RFC 4103 [124] and
ITU-T Recommendation T.140 [123] Text Conversation presentation coding;
\- recommended support of redundancy coding variant specified in IETF RFC 4103
[124] for error resilience;
\- PSTN based text telephony using ITU‑T Recommendation V.18 [4] or any of its
specific sub-modes.
NOTE: One specific text telephone protocol of the ITU-T Recommendation V.18
standard, called \"_Baudot Code_ \" (Baudot modulation at 45.45 baud), is
particularly important for support of emergency calls in US.
## I.3.2 Monitoring of text/modem signals on the CS side
When the IMS session is setup with text media (possibly combined with audio
media), the MGCF thereby requests the IM-MGW to monitor the CS termination for
possible receipt of text telephone signals, in order to detect whether the CS
user wishes to transit from voice to text during a voice call. The IM-MGW
shall be provisioned with the text telephone mode(s) for which the termination
should be monitored. The presence of the text media in the IMS session is an
explicit indication that monitoring of text telephone signals is required.
When monitoring for text telephony signals the IM-MGW should listen on the CS
side voice line for text telephone signals, and shall not transmit modem tones
from the CS side termination to IMS side termination until one of the
following occurs:
1) If the PSTN terminal is a carrier-based device and transmits answer tone.
The IM-MGW shall then resolve the text telephone mode according to V.18
procedures and then operate in that mode;
2) If the PSTN terminal is a carrier-less device, the end user starts sending
characters such that these may be detected by the IM-MGW. The IM-MGW shall
then detect the text telephone mode and then operate in that mode.
If the IMS terminal transmits text characters first the IM-MGW shall initiate
a text connection toward the CS network and resolve the textphone type, so
that communication can continue in text mode.
See ITU-T Recommendation V.18 [125] for a detailed description of those
procedures.
## I.3.3 Multiplexing between the CS and IMS streams
The IM-MGW should remain in speech mode until such time that text is detected
from either user. The IM-MGW shall detect modem signals on the CS termination
and decide based on this detection if the media received from the CS side is
interworked to the speech or the text media stream on the IMS side. In the
media direction towards the CS network, the IM-MGW needs to multiplex both
media streams into the PCM signal.
The following procedures provide further information on the procedures to be
followed by the IM-MGW, for normative behaviour the ITU-T Recommendation V.18
[125] shall be followed.
\- Carrier text phone:
\- After a carrier mode text connection is established, loss of carrier can be
taken as the indication that the audio stream on the IMS termination shall be
connected with the (PCM) interface of the line on the CS termination.
\- When the text carrier reappears on the CS termination, or text is received
from the text media stream on the IMS termination, the IM-MGW connects the
text stream on the IMS termination with the (PCM) interface of the line on the
CS termination.
\- Carrierless text phone:
\- When the V.18 modem detects text, the textphone CS termination stops
feeding the audio stream of the IMS termination, and instead inserts the
detected and T.140 converted characters into the text stream of the IMS
termination. This mode is continued as long as characters keep coming from the
PSTN textphone. When no more characters arrive, and no textphone signal is
received within 1 second, the audio channel is again fed to the audio stream
of the IMS termination. If new text comes from the V.18 side, the process is
repeated.
\- If text is received from the text stream of the IMS termination when V.18
is not actively receiving text, no media shall be applied to the IMS audio
stream, and the characters are sent to the V.18 modem for transmission. When
all text is transmitted and no more is received for two seconds, the audio
channels are enabled again. Since the carrierless systems are one-way
alternate transmission systems, transmission of characters is possible only in
one direction at a time. Once started, reception is given priority. Characters
received from text stream of the IMS termination while V.18 is busy receiving
should be buffered (up to a reasonable limit).
## I.3.4 Conversion between text/modem and Real-Time Text over RTP
The legacy PSTN textphone modes have limited character sets. For all legacy
modes, the text received through the V.18 modem shall be converted if
necessary in the RTP/T.140 format for the text stream on the IMS termination,
according to the rules in ITU-T Recommendation. T.140 [123] and IETF RFC 4103
[124], and vice-versa.
Redundancy may be used as specified in IETF RFC 4103 [124]. Use or not of
redundancy is derived from the text media description configured on the IMS
termination (RTP/RED/T.140).
# I.4 MGCF and IM-MGW interactions
## I.4.1 Introduction
This clause describes requirements for extensions to the Mn interface protocol
in 3GPP TS 29.332 [15] needed to support the Interworking of Real-Time Text
Telephony media in IMS with text/modem calls in CS domain.
## I.4.2 Mn signalling interactions
### I.4.2.1 Introduction
The following clauses describe the Mn interface procedures.
All message sequence charts in these clauses are examples.
### I.4.2.2 H.248 Context Model
The H.248 context model depicted in figure I.4.2.2.1 shall be applied for
interworking Real-Time Text media in IMS to text/modem in CS.
Figure I.4.2.2.1: H.248 Context Model for GTT support
The H.248 context contains one IP termination (IMS side) with two streams (one
stream for Real-Time Text/RTP, another stream for audio/RTP), plus a TDM, AAL2
or IP termination (CS side) with one single stream carrying both voice via PCM
and V.18 text telephony.
### I.4.2.3 Specific Mn signalling for GTT
The following information shall be provided from the MGCF towards the IM-MGW:
\- SDP with audio and Real-Time Text m-lines for the IMS termination;
\- PCM (G.711) codec for the CS side termination.
This shall trigger the IM-MGW to insert an IWF to support RTT to PSTN text
telephony conversion. If the topology is incoming (or bothway) from the CS
network the IM-MGW shall monitor for text telephony and convert to RTT towards
the IMS network. If the topology is outgoing (or bothway) to the CS network
the IM-MGW shall multiplex RTT payload into the PCM stream.
### I.4.2.4 IM CN subsystem originated session between the MGCF and IM-MGW
#### I.4.2.4.1 Initial INVITE with an SDP offer including Real-Time Text
Figure I.4.2.4.1.1: Example Mn signalling interactions for IMS originated
session with audio and text
The Mn signalling interactions specified in clause 9.2.2.3 shall apply, with
the following differences.
When reserving the IMS termination, the MGCF shall configure two streams; one
for the audio and one for the Real-Time Text media line, with their respective
media description (signal 3 in figure I.4.2.4.1.1). Monitoring of text
telephony at the CS side termination is indicated by the inclusion of Real-
Time Text media at the IMS side termination and by the topology being bothway
or incoming from the CS side.
The text telephone mode(s) for which the CS side termination is monitored
shall be provisioned in the IM-MGW.
### I.4.2.5 CS network originated session
#### I.4.2.5.1 Initial INVITE with an SDP offer only including audio
Figure I.4.2.5.1.1: Mn signalling interactions for CS originated session \-
Initial INVITE with audio only
The Mn signalling interactions specified in clause 9.2.3.3 shall apply, with
the following differences.
Upon receipt of a subsequent SDP offer from the IMS terminal including the
audio and Real-Time Text media lines, the MGCF shall add an additional text
stream to the IMS termination and configure it with the remote media
description (signal 13 in figure I.4.2.5.1.1).
## I.4.3 Mn Signalling procedures
### I.4.3.1 Overview
This clause describes the logical signalling procedures (i.e. message
identifiers are not part of the protocol) between the MGCF and IM-MGW. The
procedures within this clause are intended to be implemented using the
standard H.248 procedure as defined in ITU recommendation H.248.1 [2] with
appropriate parameter combinations.
The procedures \"Reserve IMS connection point\" and \"Configure IMS
resources\" and \"Reserve IMS Connection point and configure remote
resources\" shall allow the configuration of two media streams; one for audio
and one for Real-Time Text on the IMS termination. See clause 9.3.1.
###### ## Annex J (informative): Call Flow for Customized Alerting Tone (CAT)
interworking between CS network and IMS
# J.1 Introduction
This annex describes procedures for interworking Customized Alerting Tone
(CAT) between the IMS and CS Networks.
# J.2 IMS CAT provided by the terminating IMS user using gateway model towards
user served in CS networks
Callflows for providing IMS CAT provided by the terminating IMS user towards
user served in CS networks are based on procedures specified in 3GPP TS 24.182
[132], with procedures for MGCF as shown in the following clauses.
## J.2.1 Callflow without using precondition mechanism
The following callflow shows the case when precondition mechanism is not used,
and 100rel extension is used.
Figure J.2.1: CAT gateway model callflow without using precondition mechanism
The content of the SDP message body described in figure J.2.1 is meant to be
as follows:
\- SDP_O in step 2 indicates the SDP offer inserted by the MGCF;
\- SDP_A_cat in step 3 indicates the SDP answer received by the MGCF, which in
general is the SDP answer generated by the CAT AS based on the content for CAT
media;
\- SDP_O_Regular in step 7 indicates the SDP offer received by the MGCF, which
in general is the SDP offer sent by the CAT AS based on the SDP answer
received by the terminating UE; and
\- SDP_A in step 8 indicates the SDP answer generated by the MGCF.
Upon receiving IAM (see figure J.2.1 step 1), MGCF sends SIP INVITE request
containing the SDP offer to terminating IMS (see figure J.2.1 step 2).
Upon receiving 183 (Session Progress) response to the SIP INVITE request
containing SDP answer (see figure J.2.1 step 3), MGCF sends ACM to the
originating CS network (see figure J.2.1 step 4). Also, MGCF sends a PRACK
request towards terminating IMS (see figure J.2.1 step 5). A 200 (OK) response
will be received later as a result of the PRACK request (see figure J.2.1 step
6).
Upon receiving SIP UPDATE request from terminating IMS with a SDP offer (see
figure J.2.1 step 7), MGCF sends a 200 (OK) response to the terminating IMS
with an SDP answer (see figure J.2.1 step 8).
Upon receiving 200 (OK) response to the INVITE request sent in figure J.2.1
step 2 (see figure J.2.1 step 9), MGCF sends an ANM to the originating CS
network (see figure J.2.1 step 10).
###### ## Annex K (normative): T.38 interworking between the IP Multimedia
Core Network (CN) Subsystem (IMS) and Circuit Switched (CS) networks
# K.1 General
This annex provides optional interworking procedures to support facsimile
transported according to ITU-T Recommendation T.38 [72] transported according
to IETF RFC 3362 [73] in the \"UDPTL\" transport format. Related Mn Signalling
Procedures are also described.
To enhance interoperability, recommendations for an MGCF T.38 configuration
are also provided.
NOTE: Alternatively, facsimile can also be transported as inband voice band
data over IP.
# K.2 Recommend T.38 configuration
UDPTL is recommended as T.38 transport.
NOTE: MTSI client use UDPTL as transport (see 3GPP TS 24.173 [88]).
Table X.2.1 lists values for the T.38 SDP attributers that are recommended to
be supported.
Table K.2.1: Recommended configuration for T.38 SDP attribute values
+-------------------------------------+-------------------------------+ | **T38FaxVersion** | Version 2 or higher. (NOTE 1) | +-------------------------------------+-------------------------------+ | **T38MaxBitRate** | 14 400 | +-------------------------------------+-------------------------------+ | **T38FaxFillBitRemoval** | FALSE | +-------------------------------------+-------------------------------+ | **T38FaxTranscodingMMR** | FALSE | +-------------------------------------+-------------------------------+ | **T38FaxTranscodingJBIG** | FALSE | +-------------------------------------+-------------------------------+ | **T38FaxRateManagement** | \'transferredTCF\' | +-------------------------------------+-------------------------------+ | **T38FaxMaxBuffer** | 1800 | +-------------------------------------+-------------------------------+ | **T38FaxMaxDatagram** | At least 150 | +-------------------------------------+-------------------------------+ | **T38FaxMaxIFP** | 40 (NOTE 2) | +-------------------------------------+-------------------------------+ | **T38FaxUdpEC** | \'t38UDPRedundancy\' | +-------------------------------------+-------------------------------+ | **T38FaxUdpECDepth** | Minred: 1; Maxred: 2 (NOTE 2) | +-------------------------------------+-------------------------------+ | **T38FaxUdpFECMaxSpan** | 3 (NOTE 2) | +-------------------------------------+-------------------------------+ | **T38ModemType** | \'t38G3FaxOnly\' (NOTE 2) | +-------------------------------------+-------------------------------+ | NOTE 1: Version 0 is the default | | | value that applies if the | | | T38FaxVersion SDP attribute is not | | | signalled. No SDP attributes are | | | defined in this T.38 version 0. | | | With version 4, default values for | | | the SDP attributes apply if the | | | attributes are omitted. | | | | | | NOTE 2: Only applicable for T.38 | | | version 4. | | +-------------------------------------+-------------------------------+
# K.3 Handling T.38 SDP attributes at the I-MGCF
Table K.3.1: Action at I-MGCF depending on SDP T.38 attribute values in SDP
offer
+----------------------+----------------------+----------------------+ | | Handling of received | Value provided in | | | SDP offer | sent SDP answer | +----------------------+----------------------+----------------------+ | **T38FaxVersion** | Accept any value. | If I-MGCF supports | | | Provide to the | received version, | | | IM-MGW the received | reply with that | | | value or the maximum | version. Otherwise | | | supported value at | reply with highest | | | the IM-MGW (whatever | supported version. | | | is lower). | Provide value sent | | | | in the answer also | | | | to the IM-MGW. | +----------------------+----------------------+----------------------+ | **T38MaxBitRate** | Accept any value in | Supply value | | | the offer. Provide | according to IM-MGW | | | to the IM-MGW the | capabilities in the | | | received value or | answer. | | | the maximum | | | | supported value at | | | | the IM-MGW (whatever | | | | is lower). | | +----------------------+----------------------+----------------------+ | **T3 | Accept offer with or | Do not include | | 8FaxFillBitRemoval** | without this | parameter in the | | | attribute. | answer. (NOTE 2). | +----------------------+----------------------+----------------------+ | **T3 | Accept offer with or | Do not include | | 8FaxTranscodingMMR** | without this | parameter in the | | | attribute. | answer. (NOTE 2) | +----------------------+----------------------+----------------------+ | **T38 | Accept offer with or | Do not include | | FaxTranscodingJBIG** | without this | parameter in the | | | attribute. | answer. (NOTE 2) | +----------------------+----------------------+----------------------+ | **T3 | Only accept calls | Supply | | 8FaxRateManagement** | with | \"transferredTCF\" | | | \"transferredTCF\" | value in the answer | | | in the offer for | | | | T38FaxVersion 2 or | | | | higher. Otherwise | | | | reject offer (NOTE | | | | 3). | | +----------------------+----------------------+----------------------+ | **T38FaxMaxBuffer** | Accept any value in | Supply value | | | the offer. Provide | according to IM-MGW | | | to the IM-MGW the | capabilities in the | | | received value or | answer. | | | the maximum | | | | supported value at | | | | the IM-MGW (whatever | | | | is lower). | | +----------------------+----------------------+----------------------+ | * | Accept any value in | Supply value | | _T38FaxMaxDatagram_ _| the offer. Provide | according to IM-MGW | | | to the IM-MGW the | capabilities in the | | | received value or | answer. | | | the maximum | | | | supported value at | | | | the IM-MGW (whatever | | | | is lower). | | +----------------------+----------------------+----------------------+ |__T38FaxMaxIFP_ _| Accept any value in | If T.38 version 4 is | | | the offer. If T.38 | indicated in the | | | version 4 is | answer, supply value | | | supported by the | according to IM-MGW | | | MGW, provide to the | capabilities in the | | | IM-MGW the received | answer. Otherwise | | | value or the maximum | omit the SDP | | | supported value at | attribute from the | | | the IM-MGW (whatever | answer. | | | is lower). | | +----------------------+----------------------+----------------------+ |__T38FaxUdpEC_ _| Accept value in the | Supply value | | | offer according to | according to IM-MGW | | | IM-MGW capabilities | capabilities in the | | | and provide it to | answer. | | | the IM-MGW. | | | | Otherwise reject | | | | offer (NOTE 3). | | +----------------------+----------------------+----------------------+ |__T38FaxUdpECDepth_ _| Accept any value in | If T.38 version 4 is | | | the offer. If T.38 | indicated in the | | | version 4 is | answer, supply value | | | supported by the | according to IM-MGW | | | IM-MGW, provide to | capabilities in the | | | the IM-MGW the | answer. Otherwise | | | received value. | omit the SDP | | | | attribute. | +----------------------+----------------------+----------------------+ |__T | Accept any value in | If T.38 version 4 is | | 38FaxUdpFECMaxSpan_ _| the offer. If T.38 | indicated in the | | | version 4 is | answer, supply value | | | supported by the | according to IM-MGW | | | IM-MGW, provide to | capabilities in the | | | the IM-MGW the | answer. Otherwise | | | received value. | omit the SDP | | | | attribute. | +----------------------+----------------------+----------------------+ |__T38ModemType_ _| Accept any value in | Do not include | | | the offer. If T.38 | parameter in the | | | version 4 is | answer. (NOTE 2) | | | supported by the | | | | IM-MGW, provide to | | | | the IM-MGW the | | | | received value. | | +----------------------+----------------------+----------------------+ |__T38VendorInfo_ * | Accept any value in | Do not include | | | the offer. | parameter in the | | | | answer. | +----------------------+----------------------+----------------------+ | NOTE 1: With Version | | | | 4, default values | | | | for the SDP | | | | attributes apply if | | | | the attributes are | | | | omitted. | | | | | | | | NOTE 2: In the Mn | | | | H.248 profile the | | | | IM-MGW does not | | | | modify the T.30 bit | | | | stream encapsulated | | | | within T.38 when | | | | passing it to or | | | | from the CS network. | | | | | | | | NOTE 3: If other | | | | offered media lines | | | | are acceptable, set | | | | port in media line | | | | to zero. Otherwise | | | | reject offer in | | | | INVITE request by | | | | sending the SIP | | | | status code 488 | | | | \"Not Acceptable | | | | Here\". | | | | | | | | NOTE 4: \"Any | | | | value\" means any | | | | valid value that | | | | conforms to ITU-T | | | | Recommendation | | | | T.38 [72]. | | | +----------------------+----------------------+----------------------+
# K.4 Handling T.38 SDP attributes at the O-MGCF
Table K.4.1: T.38 SDP attributes values supplied by the O-MGCF and actions at
O-MGCF depending on SDP attribute values in SDP answer
+----------------------+----------------------+----------------------+ | | Value provided in | Handling of received | | | sent SDP offer | SDP answer | +----------------------+----------------------+----------------------+ | **T38FaxVersion** | Supply highest | Accept any value. | | | version supported at | Provide to the | | | MGCF and IM-MGW, | IM-MGW the received | | | maximum 3 (NOTE 1). | value or the maximum | | | | supported value at | | | | the IM-MGW (whatever | | | | is lower). | +----------------------+----------------------+----------------------+ | **T38MaxBitRate** | Supply value | Accept any value and | | | according to IM-MGW | provide it to the | | | capabilities. | IM-MGW. | +----------------------+----------------------+----------------------+ | **T3 | Do not include | Accept offer with | | 8FaxFillBitRemoval** | parameter\ | value \"FALSE\" or | | | (NOTE 2). | parameter omitted. | | | | (NOTE 3) | +----------------------+----------------------+----------------------+ | **T3 | Do not include | Accept offer with | | 8FaxTranscodingMMR** | parameter\ | value \"FALSE\" or | | | (NOTE 2). | parameter omitted. | | | | (NOTE 3) | +----------------------+----------------------+----------------------+ | **T38 | Do not include | Accept offer with | | FaxTranscodingJBIG** | parameter\ | value \"FALSE\" or | | | (NOTE 2). | parameter omitted. | | | | (NOTE 3) | +----------------------+----------------------+----------------------+ | **T3 | Supply | Only accept calls | | 8FaxRateManagement** | \"transferredTCF\" | with | | | value. | \"transferredTCF\" | | | | in the answer for | | | | T38FaxVersion 2 or | | | | higher. (NOTE 3) | +----------------------+----------------------+----------------------+ | **T38FaxMaxBuffer** | Supply value | Accept any value and | | | according to IM-MGW | provide it to the | | | capabilities. | IM-MGW. | +----------------------+----------------------+----------------------+ | * | Supply value | Accept any value and | | _T38FaxMaxDatagram_ _| according to IM-MGW | provide it to the | | | capabilities | IM-MGW. | +----------------------+----------------------+----------------------+ |__T38FaxMaxIFP_ _| If T.38 version 4 is | Accept any value. If | | | indicated in the | T.38 version 4 is | | | offer, supply value | supported by the | | | according to IM-MGW | IM-MGW, provide it | | | capabilities. | to the IM-MGW. | | | Otherwise omit the | | | | parameter. | | +----------------------+----------------------+----------------------+ |__T38FaxUdpEC_ _| Supply value | Accept value | | | according to IM-MGW | according to MGW | | | capabilities. | capabilities and | | | | provide it to the | | | | IM-MGW. (NOTE 3) | +----------------------+----------------------+----------------------+ |__T38FaxUdpECDepth_ _| If T.38 version 4 is | Accept any value. If | | | indicated in the | T.38 version 4 is | | | offer, supply value | supported by the | | | according to IM-MGW | IM-MGW, provide it | | | capabilities. | to the IM-MGW. | | | Otherwise omit the | | | | parameter. | | +----------------------+----------------------+----------------------+ |__T | If T.38 version 4 is | Accept any value. If | | 38FaxUdpFECMaxSpan_ _| indicated in the | T.38 version 4 is | | | offer, supply value | supported by the | | | according to IM-MGW | IM-MGW, provide it | | | capabilities. | to the IM-MGW. | | | Otherwise omit the | | | | parameter. | | +----------------------+----------------------+----------------------+ |__T38ModemType_ _| Do not include | Accept any value. If | | | parameter\ | T.38 version 4 is | | | (NOTE 2). | supported by the | | | | IM-MGW, provide it | | | | to the IM-MGW. | +----------------------+----------------------+----------------------+ |__T38VendorInfo_ * | Do not include | Accept any value. | | | parameter. | | +----------------------+----------------------+----------------------+ | NOTE 1: With Version | | | | 4, default values | | | | for the SDP | | | | attributes apply if | | | | the attributes are | | | | omitted. | | | | | | | | NOTE 2: In the Mn | | | | H.248 profile the | | | | IM-MGW does not | | | | modify the T.30 bit | | | | stream encapsulated | | | | within T.38 when | | | | passing it to or | | | | from the CS network. | | | | | | | | NOTE 3: Due to SDP | | | | offer-answer | | | | procedures for this | | | | attribute, an | | | | unacceptable value | | | | in the SDP answer is | | | | due to a protocol | | | | error. The error | | | | handling at the | | | | O-MGCF is left | | | | unspecified. | | | | | | | | NOTE 4: \"Any | | | | value\" means any | | | | valid value that | | | | conforms to ITU-T | | | | Recommendation | | | | T.38 [72]. | | | +----------------------+----------------------+----------------------+
# K.5 Applicable T.38 SDP attributes at the Mn Interface
This clause lists T.38 related SDP attributes that can be signalled towards
the IM-MGW as part of the codec information within the \"Local IMS Resources\"
and \"Remote IMS Resources\" parameters within the \"Reserve IMS connection
point\", \"Configure IMS resources\" and \"Reserve IMS Connection point and
configure remote resources\" procedures described in clause 9.
Table K.5.1: Applicable T.38 SDP attributes at the Mn Interface
* * *
Attribute Remarks **T38FaxVersion** T.38 SDP attributes shall only be
provisioned for Version 2 or higher. Version 0 applies if attribute is
omitted. **T38MaxBitRate**  
**T38FaxMaxBuffer**  
**T38FaxMaxDatagram**  
**T38FaxMaxIFP** Only if T.38 version 4 is supported by the IM-MGW
**T38FaxUdpEC**  
**T38FaxUdpECDepth** Only if T.38 version 4 is supported by the IM-MGW
**T38FaxUdpFECMaxSpan** Only if T.38 version 4 is supported by the IM-MGW
**T38ModemType** Only if T.38 version 4 is supported by the IM-MGW
* * *
###### ## Annex L (normative): Interworking of called IN number and original
called IN number parameters
# L.0 General
The called IN number and original called IN number are optional parameters
defined in ITU-T Recommendation Q.763 [4].
The SIP History-Info header field (including the mp-param parameter) is
defined in IETF RFC 7044 [91], the cause-param URI parameter is defined in
IETF RFC 4458 [113] and the cause-param value \"380\" is defined in IETF RFC
8119 [148].
# L.1 Interworking SIP to ISUP
The I-MGCF may perform the following procedure based on the operator policy,
if the called IN number and original called IN number parameters are supported
in the CS network.
When receiving the History-Info header field in the incoming initial INVITE
request, the I-MGCF may include a called IN number and an original called IN
number parameters in the outgoing IAM as shown in table L.1.1 and table L.1.2.
Table L.1.1: Mapping of History-Info header field to called IN number
+----------------+----------------+----------------+----------------+ | Source SIP | Source | called IN | Derived value | | header field | Component | number | of parameter | | and component | value | | field | +----------------+----------------+----------------+----------------+ | | | Numbering plan | \"_ISDN | | | | indicator | (Telephony) | | | | | numbering plan | | | | | ( | | | | | Recommendation | | | | | E.164)_ \" | +----------------+----------------+----------------+----------------+ | hi-t | CC | Nature of | If CC is equal | | argeted-to-uri | | address | to the country | | of the | | indicator | code of the | | hi-entry with | | | country where | | a hi-index | | | I-MGCF is | | that matches | | | located AND | | the last | | | the next ISUP | | hi-entry with | | | node is | | cause-param | | | located in the | | URI parameter | | | same country, | | with the value | | | then set to | | \"380\" | | | \"national | | defined in | | | (significant) | | IETF RF | | | number\" else | | C 8119 [148] | | | set to | | and a mp-param | | | \ | | header field | | | "international | | parameter | | | number\". | | (NOTE 3); | | | | | | | | | | the global | | | | | number portion | | | | | of the | | | | | hi-t | | | | | argeted-to-uri | | | | | is assumed to | | | | | be in form\ | | | | | \"+\" CC + NDC | | | | | + SN (NOTE 1). | | | | +----------------+----------------+----------------+----------------+ | | CC, NDC, SN | Address | If NOA is | | | | signals | \"national | | | | | (significant) | | | | | number\" then | | | | | set to NDC + | | | | | SN. | | | | | | | | | | If NOA is | | | | | \ | | | | | "international | | | | | number\" | | | | | | | | | | then set to CC | | | | | + NDC + SN. | +----------------+----------------+----------------+----------------+ | Privacy header | \"history\" or | APRI | \"presentation | | field, or | \"session\" or | | restricted\" | | Privacy header | \"header\" | | | | field escaped | | | | | in the | | | | | hi-entry above | | | | | identified. | | | | | (NOTE 2). | | | | +----------------+----------------+----------------+----------------+ | | Privacy header | | \"presentation | | | field absent | | allowed\" | | | or \"none\" | | | +----------------+----------------+----------------+----------------+ | NOTE 1: If the | | | | | hi-t | | | | | argeted-to-uri | | | | | is a SIP URI | | | | | and does not | | | | | contain | | | | | \ | | | | | "user=phone\", | | | | | then mapping | | | | | to called IN | | | | | number is | | | | | impossible; | | | | | therefore, | | | | | there is no | | | | | need to | | | | | generate | | | | | called IN | | | | | number. | | | | | | | | | | NOTE 2: It is | | | | | possible that | | | | | an entry of | | | | | the | | | | | History-Info | | | | | header field | | | | | itself is | | | | | marked as | | | | | restricted or | | | | | the whole | | | | | History-Info | | | | | header field. | | | | | | | | | | NOTE 3: The | | | | | h | | | | | i-target-param | | | | | parameter set | | | | | to \"mp\" as | | | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | indicates that | | | | | the target of | | | | | the | | | | | Request-URI | | | | | was changed | | | | | and shall | | | | | appear in this | | | | | hi-ta | | | | | rgeted-to-uri. | | | | | Due to | | | | | backward | | | | | compatibility | | | | | rules the | | | | | h | | | | | i-target-param | | | | | may not appear | | | | | in each | | | | | concerned | | | | | hi-entry; so | | | | | that the | | | | | identification | | | | | of the | | | | | hi-entry shall | | | | | rely on the | | | | | cause-param | | | | | value. | | | | +----------------+----------------+----------------+----------------+
Table L.1.2: Mapping of History-Info header field to original called IN number
+----------------+----------------+----------------+----------------+ | Source SIP | Source | original | Derived value | | header field | Component | called IN | of parameter | | and component | value | number | field | +----------------+----------------+----------------+----------------+ | | | Numbering plan | \"_ISDN | | | | indicator | (Telephony) | | | | | numbering plan | | | | | ( | | | | | Recommendation | | | | | E.164)_ \" | +----------------+----------------+----------------+----------------+ | hi-t | CC | Nature of | If CC is equal | | argeted-to-uri | | address | to the country | | of the | | indicator | code of the | | hi-entry with | | | country where | | a hi-index | | | I-MGCF is | | that matches | | | located AND | | the first | | | the next ISUP | | hi-entry with | | | node is | | a cause-param | | | located in the | | URI parameter | | | same country, | | with the value | | | then set to | | \"380\" | | | \"national | | defined in | | | (significant) | | IETF RF | | | number\" else | | C 8119 [148] | | | set to | | and a mp-param | | | \ | | header field | | | "international | | parameter | | | number\" | | (NOTE 4); | | | | | | | | | | the global | | | | | number portion | | | | | of the | | | | | hi-t | | | | | argeted-to-uri | | | | | is assumed to | | | | | be in form\ | | | | | \"+\" CC + NDC | | | | | + SN (NOTE 2). | | | | +----------------+----------------+----------------+----------------+ | | CC, NDC, SN | Address | If NOA is | | | | signals | \"national | | | | | (significant) | | | | | number\" then | | | | | set to\ | | | | | NDC + SN. | | | | | | | | | | If NOA is | | | | | \ | | | | | "international | | | | | number\" | | | | | | | | | | then set to CC | | | | | + NDC + SN | +----------------+----------------+----------------+----------------+ | Privacy header | \"history\" or | APRI | \"presentation | | field, or | \"session\" or | | restricted\" | | Privacy header | \"header\" | | | | field escaped | | | | | in the | | | | | hi-entry above | | | | | identified | | | | | (NOTE 3). | | | | +----------------+----------------+----------------+----------------+ | | Privacy header | | \"presentation | | | field absent | | allowed\" | | | or \"none\" | | | +----------------+----------------+----------------+----------------+ | NOTE 1: The | | | | | original | | | | | called IN | | | | | number is | | | | | generated only | | | | | when there are | | | | | more than two | | | | | hi-entries | | | | | having a cause | | | | | URI parameter | | | | | set to the | | | | | value defined | | | | | in | | | | | IETF RFC | | | | | 8119 [148]. | | | | | | | | | | NOTE 2: If the | | | | | hi-t | | | | | argeted-to-uri | | | | | is a SIP URI | | | | | and does not | | | | | contain | | | | | \ | | | | | "user=phone\", | | | | | then mapping | | | | | to original | | | | | called IN | | | | | number is | | | | | impossible; | | | | | therefore, | | | | | there is no | | | | | need to | | | | | generate | | | | | original | | | | | called IN | | | | | number. | | | | | | | | | | NOTE 3: It is | | | | | possible that | | | | | an entry of | | | | | the | | | | | History-Info | | | | | header field | | | | | itself is | | | | | marked as | | | | | restricted or | | | | | the whole | | | | | History-Info | | | | | header field. | | | | | | | | | | NOTE 4: The | | | | | h | | | | | i-target-param | | | | | parameter set | | | | | to \"mp\" as | | | | | defined in | | | | | IETF R | | | | | FC 7044 [91] | | | | | indicates that | | | | | the target of | | | | | the | | | | | Request-URI | | | | | was changed | | | | | and shall | | | | | appear in this | | | | | hi-ta | | | | | rgeted-to-uri. | | | | | Due to | | | | | backward | | | | | compatibility | | | | | rules the | | | | | h | | | | | i-target-param | | | | | may not appear | | | | | in each | | | | | concerned | | | | | hi-entry; so | | | | | that the | | | | | identification | | | | | of the | | | | | hi-entry shall | | | | | rely on the | | | | | cause-param | | | | | value. | | | | +----------------+----------------+----------------+----------------+
# L.2 Interworking ISUP to SIP
The O-MGCF may perform the following procedure based on the operator policy,
if the History-Info header field is supported in the IMS network.
When receiving the called IN number parameter (and the original called IN
number parameter) in the incoming IAM, the O-MGCF may include the History-Info
header field in the outgoing initial INVITE request as shown in table L.2.1,
table L.2.2 and table L.2.3.
The O-MGCF should first create hi-entries for the original called IN number
and the called IN number and then thoses for the original called number and
the redirecting number.
NOTE: It is operator specific.if an IN number is used as a first dialled
number and call diversions are at the later position (it is often forbidden to
have a call diversion towards an IN service number) or the contrary.
Table L.2.1: Mapping of original called IN number to History-Info header field
+----------------+----------------+----------------+----------------+ | ISUP Parameter | Derived value | SIP component | Value | | | of parameter | | | | | field | | | +----------------+----------------+----------------+----------------+ | IAM | | Initial INVITE | | | | | request | | +----------------+----------------+----------------+----------------+ | Original | | History-Info | hi-t | | called IN | | header field | argeted-to-uri | | number | | | of the first | | | | | created | | | | | hi-entry. | +----------------+----------------+----------------+----------------+ | Nature of | \"_national | hi-t | Add CC (of the | | address | (significant) | argeted-to-uri | country where | | indicator | number\"_ | | the O-MGCF is | | | | | located) to | | | | | address | | | | | signals of | | | | | original | | | | | called IN | | | | | number, then | | | | | map to user | | | | | portion of URI | | | | | scheme used. | | | | | | | | | | **Addr-spec** | | | | | | | | | | \"+\" CC NDC | | | | | SN mapped to | | | | | user portion | | | | | of URI scheme | | | | | used. | +----------------+----------------+----------------+----------------+ | | _\ | | Map complete | | | "international | | address | | | number\"_ | | signals of | | | | | original | | | | | called IN | | | | | number to user | | | | | portion of URI | | | | | scheme used. | +----------------+----------------+----------------+----------------+ | Address | If NOA is | hi-t | \"+\" CC NDC | | signals | \"_national | argeted-to-uri | SN mapped to | | | (significant) | | user portion | | | number\"_ then | | of URI scheme | | | the format of | | used. | | | the address | | | | | signals is\ | | | | | NDC + SN. | | | | | | | | | | If NOA is | | | | | \" | | | | | _international | | | | | number\"_ then | | | | | the format of | | | | | the address | | | | | signals is\ | | | | | CC + NDC + SN. | | | +----------------+----------------+----------------+----------------+ | **_APRI_** | \"presentation | Privacy header | \"history\" | | | restricted\" | field escaped | | | | | in | | | | | hi-t | | | | | argeted-to-uri | | | | | corresponding | | | | | to original | | | | | called IN | | | | | number | | +----------------+----------------+----------------+----------------+ | | \"presentation | | Privacy header | | | allowed\" | | field absent | | | | | or \"none\" | +----------------+----------------+----------------+----------------+ | | | hi-index | \"index=1\" | +----------------+----------------+----------------+----------------+
Table L.2.2: Mapping of called IN number to History-Info header field
+----------------+----------------+----------------+----------------+ | ISUP Parameter | Derived value | SIP component | Value | | | of parameter | | | | | field | | | +----------------+----------------+----------------+----------------+ | IAM | | Initial INVITE | | | | | request | | +----------------+----------------+----------------+----------------+ | Called IN | | History-Info | If mapping of | | number | | header field | original | | | | | called IN | | | | | number is | | | | | performed, | | | | | then | | | | | hi-t | | | | | argeted-to-uri | | | | | of the second | | | | | created | | | | | hi-entry. | | | | | | | | | | Otherwise, | | | | | hi-t | | | | | argeted-to-uri | | | | | of the first | | | | | created | | | | | hi-entry. | +----------------+----------------+----------------+----------------+ | Nature of | \"_national | hi-t | Add CC (of the | | address | (significant) | argeted-to-uri | country where | | indicator | number\"_ | | the O-MGCF is | | | | | located) to | | | | | address | | | | | signals of | | | | | called IN | | | | | number, then | | | | | map to user | | | | | portion of URI | | | | | scheme used. | | | | | | | | | | **Addr-spec** | | | | | | | | | | \"+\" CC NDC | | | | | SN mapped to | | | | | user portion | | | | | of URI scheme | | | | | used. | +----------------+----------------+----------------+----------------+ | | _\ | | Map complete | | | "international | | address | | | number\"_ | | signals of | | | | | called IN | | | | | number to user | | | | | portion of URI | | | | | scheme used. | +----------------+----------------+----------------+----------------+ | Address | If NOA is | hi-t | \"+\" CC NDC | | signals | \"_national | argeted-to-uri | SN mapped to | | | (significant) | | user portion | | | number\"_ then | | of URI scheme | | | the format of | | used. | | | the address | | | | | signals is\ | | | | | NDC + SN. | | | | | | | | | | If NOA is | | | | | \" | | | | | _international | | | | | number\"_ then | | | | | the format of | | | | | the address | | | | | signals is\ | | | | | CC + NDC + SN. | | | +----------------+----------------+----------------+----------------+ | **_APRI_** | \"presentation | Privacy header | \"history\" | | | restricted\" | field escaped | | | | | in | | | | | hi-t | | | | | argeted-to-uri | | | | | corresponding | | | | | to called IN | | | | | number | | +----------------+----------------+----------------+----------------+ | | \"presentation | | Privacy header | | | allowed\" | | field absent | | | | | or \"none\" | +----------------+----------------+----------------+----------------+ | | | hi-ta | If mapping of | | | | rgeted-to-uri; | original | | | | cause-param | called IN | | | | URI parameter, | number is | | | | as defined in | performed, | | | | IETF RFC | then set to | | | | 8119 [148]. | \"380\". | | | | | | | | | | Otherwise, no | | | | | mapping is | | | | | performed. | +----------------+----------------+----------------+----------------+ | | | hi-index and | If mapping of | | | | h | original | | | | i-target-param | called IN | | | | | number is | | | | | performed, | | | | | then set to | | | | | \"index=1.1\" | | | | | and \"mp=1\". | | | | | | | | | | Otherwise, set | | | | | to \"index=1\" | | | | | and no | | | | | mp-param is | | | | | created. | +----------------+----------------+----------------+----------------+
Table L.2.3: Mapping of called party number to History-Info header field
+----------------+----------------+----------------+----------------+ | ISUP Parameter | Derived value | SIP component | Value | | | of parameter | | | | | field | | | +----------------+----------------+----------------+----------------+ | IAM | | Initial INVITE | | | | | request | | +----------------+----------------+----------------+----------------+ | Called party | | History-Info | If mapping of | | number | | header field | original | | | | | called IN | | | | | number is | | | | | performed, | | | | | then | | | | | hi-t | | | | | argeted-to-uri | | | | | of the third | | | | | created | | | | | hi-entry. | | | | | | | | | | Otherwise, | | | | | hi-t | | | | | argeted-to-uri | | | | | of the second | | | | | created | | | | | hi-entry. | +----------------+----------------+----------------+----------------+ | Nature of | \"_national | hi-t | Add CC (of the | | address | (significant) | argeted-to-uri | country where | | indicator | number\"_ | | the MGCF is | | | | | located) to | | | | | address | | | | | signals of | | | | | called party | | | | | number, then | | | | | map to user | | | | | portion of URI | | | | | scheme used. | | | | | | | | | | **Addr-spec** | | | | | | | | | | \"+\" CC NDC | | | | | SN mapped to | | | | | user portion | | | | | of URI scheme | | | | | used. | +----------------+----------------+----------------+----------------+ | | _\ | | Map complete | | | "international | | address | | | number\"_ | | signals of | | | | | called party | | | | | number to user | | | | | portion of URI | | | | | scheme used. | +----------------+----------------+----------------+----------------+ | Address | If NOA is | hi-t | \"+\" CC NDC | | signals | \"_national | argeted-to-uri | SN mapped to | | | (significant) | | user portion | | | number\"_ then | | of URI scheme | | | the format of | | used. | | | the address | | | | | signals is\ | | | | | NDC + SN. | | | | | | | | | | If NOA is | | | | | \" | | | | | _international | | | | | number\"_ then | | | | | the format of | | | | | the address | | | | | signals is\ | | | | | CC + NDC + SN. | | | +----------------+----------------+----------------+----------------+ | | | hi-ta | \"380\" | | | | rgeted-to-uri; | | | | | cause-param | | | | | URI parameter, | | | | | as defined in | | | | | IETF RFC | | | | | 8119 [148]. | | +----------------+----------------+----------------+----------------+ | | | hi-index and | If both | | | | h | original | | | | i-target-param | called IN | | | | | number and | | | | | called IN | | | | | number are | | | | | mapped to | | | | | hi-entries, | | | | | then set to | | | | | \ | | | | | "index=1.1.1\" | | | | | and | | | | | \"mp=1.1\". | | | | | | | | | | If original | | | | | called IN | | | | | number is not | | | | | mapped, but | | | | | called IN | | | | | number is | | | | | mapped to | | | | | hi-entry, then | | | | | set to | | | | | \"index=1.1\" | | | | | and \"mp=1\". | +----------------+----------------+----------------+----------------+
#
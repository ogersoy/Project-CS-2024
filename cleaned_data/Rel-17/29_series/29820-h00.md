# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# Introduction
PFCP was first developed in Rel-14 to support CP and UP separation feature in
EPC. From Rel-15 onwards PFCP has been reused for the interface between SMF
and UPF (i.e. N4 interface) in 5GC. Open interoperability is one of the
essential requirements of PFCP. Example scenarios requiring PFCP open
interoperability can be:
\- Vertical market is one important use case of 5G, where UPF can be deployed
locally on the customer side, while the SMF is centrally deployed on the
operator side, therefore the interoperability between SMF and UPF is
mandatory.
\- PDU session continuity when the UE moves between different SMF serving
areas is supported by I-SMF and PFCP IEs are signalled over N16a, thus the
interoperability regarding PFCP between the SMF and the I-SMF is mandatory.
This Technical Report aims to study the key issues which impact the
interoperability of PFCP and potential solutions to resolve the issues.
# 1 Scope
The present document identifies the scenarios where the PFCP interoperability
needs to be further enhanced for existing function and specifies the
corresponding requirements, identifies the key issues which impact the PFCP
interoperability, analyses potential solutions to address the key issues.
PFCP used in 4G (e.g. on Sxa, Sxb, Sxc interfaces) and 5G (e.g. on N4, N16a
interfaces) are both within scope of the study.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document in the same
Release as the present document.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.214: \"Architecture enhancements for control and user plane
separation of EPC nodes; Stage 2\".
[3] 3GPP TS 29.244: \"Interface between the Control Plane and the User Plane
Nodes; Stage 3\".
[4] 3GPP**** TS**** 23.502: \"Procedures for the 5G System; Stage 2\".
[5] 3GPP**** TS**** 23.501: \"System architecture for the 5G System (5GS);
Stage 2\".
[6] IETF RFC 2661: Layer Two Tunneling Protocol \"L2TP\"
[7] IETF RFC 3931: Layer Two Tunneling Protocol -- Version 3 (L2TPv3)
[8] IETF RFC 2865: Remote Authentication Dial In User Service (RADIUS)
[9] IETF RFC 2868: RADIUS Attributes for Tunnel Protocol Support
[10] 3GPP**** TS**** 33.210: \"Network Domain Security (NDS); IP network layer
security\"
[11] 3GPP**** TS**** 24.008: \"Mobile radio interface Layer 3 specification;
Core network protocols; Stage 3\".
[12] IETF RFC 1334: PPP Authentication Protocols
[13] IETF RFC 6357: Datagram Transport Layer Security Version 1.2
[14] 3GPP**** TS**** 29.061: \"Interworking between the Public Land Mobile
Network (PLMN) supporting packet based services and Packet Data Networks
(PDN)\"
[15] 3GPP TS 29.561: \"5G System; Interworking between 5G Network and external
Data Networks; Stage 3\"
[16] IETF RFC 7155: Diameter Network Access Server Application
[17] IETF RFC 5426: The Transport Layer Security (TLS) Protocol Version 1.2
[18] IETF RFC 8446: The Transport Layer Security (TLS) Protocol Version 1.3
# 3 Definitions of terms, symbols and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in 3GPP TR 21.905
[1] and the following apply. A term defined in the present document takes
precedence over the definition of the same term, if any, in 3GPP TR 21.905
[1].
**CP function** : A node with a Control Plane function (see 3GPP TS 23.214 [2]
and 3GPP TS 23.502 [4]) supporting one or more PFCP entities. A Control Plane
function, i.e. a Control Plane Node, is identified by the Node ID, that is set
to either an FQDN or an IP address.
**UP function** : A node with a User Plane function (see 3GPP TS 23.214 [2]
and 3GPP TS 23.502 [4]) supporting one or more PFCP entities. A User Plane
function, i.e. a User Plane Node, is identified by the Node ID, that is set to
either a FQDN or an IP address.
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
CP Control Plane
I-SMF Intermediate SMF
PFCP Packet Forwarding Control Protocol
SMF Session Management Function
UP User Plane
UPF User Plane Function
# 4 Overall Requirements
Besides the scenarios addressed by 3GPP TS 23.214 [2] and 3GPP TS 29.244 [3],
the study shall especially take following scenarios into account:
\- Scenario#1: multiple UP functions are controlled by one CP function, where
the UP functions are from different vendors.
\- Scenario#2: one UP function is controlled by multiple CP functions, where
the CP functions are from different vendors.
\- Scenario#3: multiple UP functions are controlled by a set of CP functions,
where the UP functions are from different vendors and the CP functions are
from same vendor.
\- Scenario#4: multiple UP functions are controlled by a set of CP functions,
where the UP functions are shared by several network slices.
\- Scenario#5: the UP function(s) are deployed on the customer side while the
CP function(s) are deployed on the operator side.
\- Scenario#6: CP function and UP function are implemented/developed as
virtualized/container based NF.
The following requirements shall be considered during the study:
\- Requirement#1: the study shall try to avoid multiple options which may
cause interoperability issues.
\- Requirement#2: the study shall identify the potential issues when the UP
functions are deployed on the customer side and determine if specific
extensions are required to address them.
\- Requirement#3: the study may consider protocol extensions for the widely
used features that are not supported by PFCP, provided the corresponding stage
2 requirements are defined, or they do not require stage 2 requirements.
\- Requirement#4: For use cases where multiple CP functions not part of an NF
set are considered, proposals shall take into account that each CP function
may not support the same functionality.
\- Requirement#5: For use cases where multiple UP functions are considered,
proposals shall take into account that each UP function may not support the
same functionality.
# 5 Key Issues
## 5.1 General
Key issue definitions should follow common template, which would make it
easier to reference them when specifying respective solutions:
\- Only one key issue shall be specified in a clause, identified with the
clause title;
\- The first clause shall describe in detail why the use case or scenario is
deemed problematic. This is essentially a justification for adding the key
issue to the study;
\- The next clause shall formally define the key issue with a short and clear
statement. This statement will be used to check how accurately the proposed
solution matches the requirement in the key issue.
## 5.2 Key Issue #1: UPF support for multiple network slices
### 5.2.1 Description of the use case
In 5G system, multiple network slices with different functions and performance
requirement may have different control plane functions, while they share the
same UPF. Therefore, the UPF is expected to serve PDU sessions with different
QoS and network separation requirements (in corresponding to different network
slice), and the UPF will allocate different user plane resource (e.g.
CPU/Memory/bandwidth/delay budget) to those PDU session.
### 5.2.2 Key issue definition
In current specifications, the S-NSSAI transmitted on the N4 interface is only
used for performance measurement, when UPF are shared by several network
slices (e.g. eMBB slice and IoT slice), UPF needs to know, which slice the
PFCP session (PDU session) is pertaining to.
In spite of the fact that the Network Instance ID transmitted on N4 interface
can provide the UPF with information about the network slice of the PDU
session, the definition of Network Instance ID is not clear in the current
specifications, and this approach also has some limitations, e.g. when an
operator would like to use the same Network Instance ID for different network
slices.
In order to solve the dilemma described above, this key issue aims at
addressing following aspects for scenario 4:
1\. Study possible protocol enhancement over PFCP to enable a UPF to support
multiple network slices.
2\. Study the potential missing functionalities to enable an UPF to support
multiple network slices.
## 5.3 Key Issue #2: Header Enrichment for HTTPS
### 5.3.1 Description of the use case
Lots of websites use HTTPS schema to provide various services, including
security sensitive service like personal banking. For those security sensitive
services, local regulations may require recording which user has invoked the
service. On the other hand, some value-added services (e.g. controlled by
operators) may also require providing useful user information (e.g. user
location) to the server, e.g. for making accurate service decision based on
user information. In order to support such kind of requirements, header
enrichment shall be supported for HTTPS, i.e. attaching the UE information
(e.g. MSISDN, user location) to the service requests sent from the UE.
### 5.3.2 Key issue definition
This key issue will study the following aspects:
\- How does the SMF instruct the UPF to perform Header Enrichment for HTTPS?
\- How does the UPF detect the HTTPS packets and attach header fields and
values to the detected HTTPS packets?
\- If security sensitive information is potentially transmitted to the server,
how to ensure the transmission in a safe way?
## 5.4 Key Issue #3: Interoperability issues caused by multiple options co-
existence
### 5.4.1 Description of the use case
As described in clause 3 in the WID of BEPoP (C4-203630), PFCP defines
multiple technical options to implement certain features, which can result in
between different implementations and potential interoperability issues.
Solutions for effective interoperability mechanism between CP and UP
function(s) need to be identified.
Additionally, new PFCP features have been defined at very new 3GPP release,
resulting in a large and ever-growing list of UP function features in
particular (e.g. 41 UP function features are defined in 3GPP Release 16). All
these features are defined as optional to support in 3GPP TS 29.244 [3], which
causes further potential deviations between CP function and UP function
implementations from different vendors and potential risks of interoperability
issues. It should be studied whether the support of certain features, that
relate to the core part of the PFCP protocol (e.g. PDI optimization feature)
could be recommended or mandated for NFs complying with 3GPP Release 17, in
order to harmonize the set of core features supported by CP function and UP
functions and help open interoperability between implementations from
different vendors.
### 5.4.2 Key issue definition
This key issue shall study solutions to:
a. End Marker: Identify whether End Marker should be allowed to be generated
only by one side of CP or UP function, or recommend in which scenarios should
be generated by CP function and in which scenarios should be generated by UP
function.
b. UE IP address allocation mode: Identify whether UE IP address should be
allowed to be allocated only by one side of CP or UP function, or recommend in
which scenarios should be allocated by CP function and in which scenarios
should be allocated by UP function.
c. DL data buffering: Identify whether downlink data should be allowed to be
buffered only by one side of CP or UP function, or recommend in which
scenarios should be buffered by CP function and in which scenarios should be
buffered by UP function.
d. Traffic redirection: Identify whether traffic redirection should be allowed
to be enforced only by UP function for EPS to align with 5GS, or propose
solutions to solve the interoperability issue caused by traffic redirection
between EPS and 5GS;
e. PDI optimization: Identify whether the support of certain features, that
relate to the core of the PFCP protocol (e.g. PDI optimization feature) could
be recommended or mandated for NFs complying with 3GPP Release 17.
## 5.5 Key Issue #4: Avoidance of conflict between UE IP address/prefix
allocated by SMF(s)
### 5.5.1 Description of the use case
In early stage of 5G deployment, the operator may choose CP function to
support the UE IP address/prefix allocation since CP function is required to
support this feature as mandatory. But along with the network and business
expansion, SSET and MPAS feature may be deployed. Then the operator may want
to have the same UE IP address/prefix allocation policy with SSET and MPAS to
ensure the solution continuity. In this case, a mechanism to support UE IP
address/prefix allocation in SMF should be introduced.
Since a PFCP session may be taken over by another SMF of the same SMF set and
different SMFs from different SMF sets could allocate UE IP address/prefix
simultaneously, the UE IP address/prefix allocation and usage may be quite
complex over N4 interface. So, the mechanism should avoid the UE IP
address/prefix allocation conflict.
### 5.5.2 Key issue definition
This key issue shall study:
\- How to avoid conflict between UE IP address/prefix allocated by SMF(s) from
one SMF set and/or from different SMF sets.
## 5.6 Key Issue #5: L2TP Tunnelling over Sgi/N6
### 5.6.1 Description of the use case
#### 5.6.1.1 General
L2TP (L2TPv2 described in RFC 2661/L2TPv3 described in RFC 3931) started off
as an extension to the PPP model by allowing the L2 and PPP endpoints to
reside on different devices interconnected by a packet-switched network. With
L2TP, a user has an L2 connection to an access concentrator (e.g. modem bank,
ADSL, DSLAM, etc), and the concentrator then tunnels individual PPP frames to
the Network Access Server (NAS).
L2TP involves the following concepts:
\- L2TP Access Concentrator (LAC)
A node that acts as one side of an L2TP tunnel endpoint and is a peer to the
L2TP Network Server (LNS). The LAC sits between an LNS and a remote system and
forwards packets to and from each.
\- L2TP Network Server (LNS)
A node that acts as one side of an L2TP Tunnel endpoint and is a peer to the
LAC. It is the logical termination point of a PPP session that is being
tunneled from the remote system by the LAC.
\- Network Access Server (NAS)
A device providing local network access to users across a remote access
network (e.g. PSTN). A NAS may also serve as a LAC, LNS or both.
Figure 5.6.1.1-1 describes a typical L2TP scenario to tunnel PPP frames
between the remote system and an LNS located at a home LAN. The remote system
initiates a PPP connection across the PSTN cloud to a LAC. The LAC then
tunnels the PPP connection across the internet/frame relay/ATM cloud to an
LNS, whereby access to a Home LAN is obtained.
Figure 5.6.1.1-1: Typical L2TP Scenario
The L2TP control connection (L2TP Tunnel) setup messages (SCCRQ: Start-
Control-Connection-Request, SCCRP: Start-Control-Connection-Reply, SCCCN:
Start-Control-Connection-Connected, ZLB Ack: Zero-Length Body Acknowledge) are
described below. The control connection can be teardown with StopCCN and ZLB
Ack messages.
Figure 5.6.1.1-2: L2TP Control Connection Setup
After control connection is started, the tunnel authentication takes place and
the tunnel is established. The L2TP session establishment phase occurs with
message exchanges (ICRQ: Incoming-Call-Request, ICRP: Incoming-Call-Reply,
ICCN: Incoming-Call-Connected, ZLB Ack: Zero-Length Body Acknowledge) as
described below.
The session connection can be teardown with CDN and ZLB Ack (Zero-Length Body
Acknowledge) messages. Finally, the LNS triggers normal AAA or PPP
authentication for the AAA server, e.g. RADIUS/Diameter server.
Figure 5.6.1.1-3: L2TP Session Establishment
With 5G, more focus is on the industrial applications of mobile networks, and
the use of L2TP and its practice is expected to become even more common. The
current ideology is that L2TP (mostly version 2/L2TPv2) is still prevalent in
the existing operator networks (by reusing existing infrastructure from old
dial-up connectivity), where it is possible for the UE to connect directly to
the corporate network. In other words, this protocol (i.e. L2TPv2) is probably
still used by many operators (in their LNS) to establish secured connection
from the UE all the way into a third-party network, for example a corporate
network. In addition, with mode corporate customers (like manufacturing, IoT,
etc.), the need for L2TP (and similar) is believed to increase further.
A scenario of using L2TP is described below, used 5GC as an example. PFCP
(described in 3GPP TS 29.244) is used on the N4 interface between SMF and UPF
to configure the rules of packet detection, forwarding action, QoS
enforcement, usage report and buffering for each PDU session.
Figure 5.6.1.1-4: L2TP Tunnels with 5GC
After CP/UP separation, it is difficult for the UP function to get necessary
parameters (e.g. LNS Ips, username, password, etc.) to set up the L2TP tunnel
to the third-party server. This information might be pre-configured on the CP,
or the CP might receive it from an external server as described in RFC 2865.
#### 5.6.1.2 L2TP Implementation Models
In practical deployments, an UP Function with LAC functionality may be
deployed in operator network domain, or in private enterprise network. And the
L2TP tunnel parameters may be locally configured in the CP Function as per
operator demand, or be locally configured in the UP Function located in
private enterprise network as per customers demand, or be configured in
external entities (e.g. Radius/AAA server).
According to various requirements and deployment situations, the L2TP
implementation can be classified into different implementation models.
**Model A:**
In this model, the UP Function (e.g. UPF) is located in the operator network
domain, and the L2TP tunnel parameters are configured in the CP Function (e.g.
SMF). The L2TP tunnel parameters include necessary parameters for setting up
L2TP tunnel towards the LNS (e.g. LNS address, tunnel password, etc.).
In order to trigger the UP Function to setup L2TP tunnel towards the LNS, the
CP Function shall provide the L2TP tunnel parameters to the UP Function over
Sxb/N4 interface.
Figure 5.6.1.2-1: L2TP Implementation Model A
**Model B:**
In this model, the L2TP tunnel parameters are configured in external entity
(e.g. RADIUS/AAA server) which may be located in operator network domain or in
private enterprise network.
The CP Function needs first retrieve the L2TP tunnel parameters from the
external entity, before it can provide such L2TP tunnel parameters to the UP
Function over Sxb/N4 interface. The external server address may be stored in
the local configuration of the CP Function or be retrieved from the
subscription data (e.g. like the dnAAA server address stored in the UE
subscription data).
Figure 5.6.1.2-2: L2TP Implementation Model B
**Model C:**
In this model, the UP Function (e.g. UPF) is deployed in a private enterprise
network, and the L2TP tunnel parameters are configured in the UP Function. The
L2TP tunnel parameters include necessary parameters for setting up L2TP tunnel
towards the LNS (e.g. LNS address, tunnel password, etc.).
As the UP Function knows the detailed L2TP tunnel parameters, it is no need
for the CP Function to provide L2TP tunnel parameters to the UP Function over
Sxb/N4. The UPF determines the trigger of L2TP tunnel establishment based on
its local policy.
Figure 5.6.1.2-3: L2TP Implementation Model C
In the above model A/B, the CP Function needs to determine whether the L2TP
tunnel is required for the PDN connection / PDU session. It can be done based
on the attribute of APN/DNN/S-NSSAI, which is either stored in the local
configuration of the CP Function, or retrieved from subscription data from
e.g. HSS/UDM.
### 5.6.2 Key issue definition
This key issue will address:
\- The information used by the CP Function to determine whether an L2TP tunnel
is required for a PDN connection / PDU session.
\- The information which is required to be communicated from the CP to the UP
to setup a L2TP control connection (an L2TP tunnel) and L2TP sessions (one
L2TP session per PDU session/PDN connection) from the UP function to an LNS
and how this information should be communicated considering the current
security/authentication aspects of L2TP.
\- The information which is required to be communicated from the UP to the CP
to indicate the success/failure of a L2TP control connection (an L2TP
tunnel)/L2TP session setup.
\- The enhancements (if any) which are required to the PFCP protocol to be
able to send this information, considering security aspects.
\- How can the UP inform the CP in the 5GS about the failures related to an
existing L2TP tunnel, and how L2TP sessions associated with the tunnel are
affected.
\- How to handle the use cases when the LNS assigns the UE IP address.
\- Whether and how to handle the possibility of multiple CP functions (e.g.
pertaining to a PGW/SMF SET) creating L2TP sessions (corresponding to PDU
sessions/PDN connections) over a L2TP tunnel, i.e. the L2TP tunnel is shared
by multiple PDU sessions/PDN connections but controlled by different CP
functions.
# 6 Solutions
## 6.1 Solution#1: Header Enrichment for HTTPS
### 6.1.1 Description
The solution is to address the Key Issue #2: Header Enrichment for HTTPS in
clause 5.3.
When HTTPS schema is used, HTTP messages are transmitted in encrypted SSL/TLS
packets. Before sending HTTP message to the remote server, the client shall
first perform SSL/TLS handshake procedure to set up SSL/TLS connection with
the remote server. In this solution, the SSL/TLS protocol refers to TLS
version 1.2 and onwards (see IETF RFC 5426 [17], IETF RFC 8846 [18]).
The initial SSL/TLS handshake messages are exchanged in clear text, which
provides possibility to the UP Function to insert some customized information
in the initial SSL/TLS handshake messages. A simple way is, when detecting an
initial SSL/TLS handshake message (i.e. ClientHello message) from an UE, the
UP Function can append additional SSL/TLS extension to the SSL/TLS handshake
message to carry customized field names and values.
In order to support Header Enrichment for HTTPS, both the CP Function (e.g.
SMF) and UP Function (e.g. UPF) shall be enhanced to support corresponding
functionalities.
To instruct the UP Function to detect SSL/TLS packets and perform Header
Enrichment for HTTPS, the CP Function shall:
\- Create UL PDR for detecting uplink SSL/TLS packets towards the remote
server;
\- Create FAR and associate it to the UL PDR. In the FAR, provide header field
names and values which are required to be inserted into SSL/TLS handshake
messages. And set the Header Type of Header Enrichment IE to \"SSL/TLS\" (or
set to \"HTTPS\").
Upon instruction from the SMF, the UP Function shall:
\- Install the UL PDR and FAR, and keep monitoring uplink IP packets from the
UE and check whether it is SSL/TLS packets;
\- Once SSL/TLS packets from the UE is detected, further inspect whether the
SSL/TLS packets carries initial SSL/TLS handshake message from the UE (i.e.
ClientHello message);
\- Once the initial SSL/TLS handshake message from the UE is detected, insert
additional SSL/TLS extension and carry the required field names and the values
in the additional SSL/TLS extension, and finally forward the altered SSL/TLS
packets onwards.
The encoding of required field names and values in the additional SSL/TLS
extension is implementation specific, e.g. based on the service agreement
between an operator and its customers. Operators should avoid inclusion of
security sensitive information in the SSL/TLS extension as much as possible.
If security sensitive information is regarded as necessary, it shall be
transmitted in a secure way.
NOTE: How the application server retrieves the enriched content at TLS layer
and sends to upper layers is out of scope for 3GPP.
SA3 has provided the following feedback on this solution, as per the LS
S3-214505:
\- Initial TLS packets are not a suitable way to transport the information.
Since a man-in-the-middle inserts information to be consumed by the server,
without consent from the client, it could be considered a privacy breach.
Also, TLS will often be terminated in a frontend, which may not the intended
receiver of the information.
\- If the endpoints is outside the 3GPP network domain, IMSI/SUPI, and IMEI
are internal identifiers that are not supposed to be sent outside the 3GPP
network domain. (NOTE: This is independent on whether appropriate security is
setup between the PSA UPF and AS).
\- Depending on regulations, sending other parameters related to subscribers
and users could require user consent: UE IP address, User location, and MSISDN
etc.
Taking SA3 feedback into account, the usage of this solution shall be limited,
i.e. only be used in the following cases: (a) the application server is inside
the operator network, or, (b) the application server is inside an operator
trusted domain (e.g. in an enterprise network which has secured tunnel with
the operator network). In addition, sending the IMSI/SUPI to an AS is limited
only when the AS is inside the operator network. When deploying this solution,
operators shall guarantee that user information transmission to the
application server shall comply with the regional regulations.
### 6.1.2 Impacts on services, entities and interfaces
CP Function:
\- Indicate to UP Function that detection of SSL/TLS handshake message is
required and indicated header field names and values are to be inserted to
SSL/TLS handshake message;
UP Function:
\- Detect SSL/TLS handshake message from UE;
\- Insert the required header field names and values to the detected SSL/TLS
handshake messages from UE.
### 6.1.3 Pros
This solution provides a feasible way for operators to support header
enrichment for HTTPS schema.
### 6.1.4 Cons
To ensure this solution works well, service agreements shall be made between
an operator and its customers, e.g. to determine the encoding of header fields
and the values in TLS extension.
## 6.2 Solution#2: UE IP address/prefix allocation by SMF in SMF Set
### 6.2.1 Description
#### 6.2.1.1 General
The description below is to address the solution for Key Issue# 4.
The SMF deployed in SMF set supports the UE IP address/prefix allocation by
SMF. Each SMF in the SMF set has an individual UE IP address/prefix list and
make a record for each UE IP address/prefix to indicate whether it is
available or not. The individual UE IP address/prefix list for each SMF in the
SMF set should not be the same to avoid the UE IP address/prefix allocation
conflict. For the UE IP addresses/prefixes partitioning between the SMFs of an
SMF set, it will depends on operator\'s policy.
The SMF allocate the available one from the UE IP address/prefix list by
checking the usage indication. When a UE IP address/prefix have been
allocated, the SMF marked this UE IP address/prefix as unavailable.
Each SMF also records all the UE IP address/prefix lists controlled by other
SMFs in SMF set and dynamically make a record for each IP address/prefix to
indicate whether the session using this IP address/prefix is controlled by
this SMF or not. This enables SMF keep tracks of whether it is currently
serving PFCP sessions with an UE IP address that is assigned to another SMF in
the set, such as to be able to signal to that other SMF that the UE IP address
is released when the SMF releases the PFCP session later. Then, each SMF in
SMF set records the whole UE IP address/prefix table which includes the
individual UE IP resource part and the recorded UE IP resource part.
#### 6.2.1.2 SMF recover
The SMF broadcasts the recovery message towards all other SMFs in SMF set
after recover from a failure. Upon receiving the recovery message, other SMFs
share the maintained IP address/prefix list with usage indication records. The
recovered SMF can make the record for its individual UE IP address/prefix list
to indicate whether it is available or not according to these shared
information. The other SMFs may redirect some of the PFCP sessions back to the
recovered SMF which originally created these PFCP sessions. The session
redirection can be triggered by other mechanism like SMF set load balance.
#### 6.2.1.3 Session release
The SMF broadcasts the available UE IP address(es)/prefix(s) message towards
all the SMFs in SMF set in case these UE IP address(es)/prefix(s) is released
and they are not belonging to its individual UE IP address/prefix list. The
SMF which originally allocate these UE IP address(es)/prefix(s) will change
the usage indicator to available again. If the SMF is failed, other SMFs in
the SMF set cannot reuse the UE IP addresses that were still available in the
failed SMF.
#### 6.2.1.4 SMF added/removed to/from SMF set
##### 6.2.1.4.1 General
If SMF(s) added/removed to/from the SMF set, the UE IP address/prefix resource
will be re-assigned depends on operator\'s policy. Each SMF will get the new
UE IP address/prefix table which is different from the old one.
The UE IP address/prefix resource re-assignment can be done by local
configuration or directly controlled by external entity.
##### 6.2.1.4.2 Solution based on local configuration
In local configuration case, some UE IP address(es)/prefix(es) originally
controlled by one SMF might be partitioned to another SMF within the same SMF
set. The SMFs in SMF set should coordinate with each other in order to
synchronize the UE IP address/prefix usage status. Two possible scenarios are
list as below.
\- UE IP address(es)/prefix(es) re-assigned to another target SMF but
originally controlled by a removed SMF.
\- UE IP address(es)/prefix(es) re-assigned to another target SMF but
originally controlled by a SMF in SMF set.
NOTE: The mechanism of this solution is to synchronize the UE IP
address/prefix usage status between SMFs in SMF set after UE IP
addresses/prefixes partitioning. There is no additional requirement on all the
ongoing PFCP sessions. No impact over N4 interface as well as all the existing
PFCP sessions and no requirement for other NFs interacting with the SMF/SMF
set.
For the UE IP address(es)/prefix(es) originally controlled by one SMF which is
removed from the SMF set but re-assigned to another target SMF, the target SMF
shall broadcasts these UE IP address(es)/prefix(es) towards all the other SMFs
in SMF set. Other SMFs share the maintained IP address/prefix list with usage
indication records. The target SMF can make the record for these individual UE
IP address(es)/prefix(es) to indicate whether it is available or not according
to these shared information. Optionally, the target SMF requires session
redirection according to local policy which can be implementation specific.
For the UE IP address(es)/prefix(es) originally controlled by one SMF but re-
assigned to another target SMF, the original SMF shall send all these UE IP
address(es)/prefix(es) with the recorded usage indicator value to the target
SMF and will not choose any available one from these IP resource when new IP
allocation requirement raised. The target SMF will update the usage indicator
value(s) accordingly and send a confirmation message back after receiving the
information from original SMF. After receiving the confirmation message from
target SMF, the original SMF shall change the UE IP address/prefix usage
indicator value to available if the corresponding session is not controlled by
the original SMF.
##### 6.2.1.4.3 Solution based on directly controlled by external entity
In the external entity controlled case, e.g. an OAM is implemented to re-
assignment the UE IP address/prefix table for the SMF in the SMF set:
When a new SMF is to be added to the SMF set, the OAM could require the
current SMFs in the SMF set to report their available UE IP address/prefix.
The current SMFs in the SMF set should report their available UE IP
address/prefix to the OAM (NOTE 1) and isolate or remove these UE IP
address/prefix from their IP address pool. Upon receiving these UE IP
address/prefix, OAM selects certain UE IP address/prefix based on its
configuration or operator\'s policy, and assigns them to the new SMF. The OAM
should subsequently assign the remaining UE IP address/prefix back to the
current SMFs in the SMF set (NOTE 2). Upon receiving, the current SMFs in the
SMF set should update their IP address pool respectively.
NOTE 1: In order to prevent SMF having no available IP address to allocate for
new session after it reporting its available UE IP address/prefix to the OAM
(before OAM assigning the remaining UE IP address/prefix back to this SMF),
SMF may decide to report only part of its available UE IP address/prefix to
the OAM according to its configuration or the policy issued by the OAM.
NOTE 2: In order to avoid disrupting the SMF\'s\' IP address pool planning in
the SMF set, OAM should try to assign the remaining available UE IP
address/prefix reported by certain SMF back to this SMF.
When a current SMF is to be removed from the SMF set, the OAM should require
this SMF to report all of its UE IP address/prefix. In particular, if the UE
IP addresses /prefixes of this SMF were assigned by the OAM previously and the
OAM holds the relevant records, the OAM can also directly read the records and
confirm the available UE IP address/prefix. The OAM could keep these UE IP
address/prefix on its own for the time being or assign these UE IP
address/prefix to certain SMFs in the SMF set, based on its configurations or
operator\'s policy. If the OAM assigns these UE IP address/prefix to certain
SMFs in the SMF set, the relevant SMFs in the SMF set should update their IP
address pool respectively.
### 6.2.2 Signalling flow
#### 6.2.2.1 General
This clause is only used to illustrate the general solution idea. There is no
restriction on the detailed interworking signalling. (e.g. message name,
message formats, Information Elements)
#### 6.2.2.2 SMF recover
After the SMF recovered from a failure, The SMF broadcasts the recovery
message towards all the other SMFs in SMF set. Upon receiving the recovery
message, other SMFs share the maintained IP address/prefix list with usage
indication records. Figure 6.2.2.2-1 illustrates the message between SMFs in
SMF set.
Figure 6.2.2.2-1: Procedures for SMFs in SMF set - SMF recover
#### 6.2.2.3 Session release
If the released UE IP address(es)/prefix(es) does not belong to the SMF\'s
individual UE IP address/prefix list, then the SMF will broadcasts the
available UE IP address(es)/prefix(s) message towards all the other SMFs in
SMF set. Figure 6.2.2.3-1 illustrates the signaling flow between SMFs in SMF
set.
Figure 6.2.2.3-1: Procedures for SMFs in SMF set - session release
#### 6.2.2.4 SMF added/removed to/from SMF set
As described in clause 6.2.1.4.2, two possible scenarios required the
signaling between SMFs in SMF set.
Figure 6.2.2.4-1 illustrates the signaling flow between SMFs in SMF set when
UE IP address(es)/prefix(es) re-assigned to another target SMF but originally
controlled by a removed SMF.
Figure 6.2.2.4-1: Procedures for SMFs in SMF set --UE IP
address(es)/prefix(es) re-assigned to another target SMF but originally
controlled by a removed SMF
Figure 6.2.2.4-2 illustrates the signaling flow between SMFs in SMF set when
UE IP address(es)/prefix(es) re-assigned to another target SMF but originally
controlled by a SMF in SMF set.
Figure 6.2.2.4-2: Procedures for SMFs in SMF set --UE IP
address(es)/prefix(es) re-assigned to another target SMF but originally
controlled by a SMF in SMF set
### 6.2.3 Impacts on services, entities and interfaces
The solution requires some inter SMF signalling within SMF set. This interface
is avoided to be further specified in SA2 and leaved as implementation
specific. So, it requires further checking and review by 3GPP CT4.
### 6.2.4 Pros
\- The proposed solution enables the UE IP address/prefix allocation by SMF if
SSET and MPAS feature deployed.
\- In early stage of 5G deployment, the operator may choose CP function to
support the UE IP address/prefix allocation since CP function is required to
support this feature as mandatory. But along with the network and business
expansion, SSET and MPAS feature may be deployed. Then the operator may want
to have the same UE IP address/prefix allocation policy with SSET and MPAS to
ensure the solution continuity. This solution ensures the customer can chooses
the same UE IP address/prefix allocation policy when SSET and MPAS feature
deployed.
\- From the UE IP planning point of view, the partitioning of UE IP
addresses/prefixes for each SMF in SMF set will be easy when the SMF is
added/removed from the SMF set. When new SMF added/removed to/from SMF set,
the UE IP resource in SMF set can be simply divided to each SMF as individual
UE IP addresses/prefixes list no mattter what is the real UE IP resource usage
status. And the available UE IP addresses/prefix for each SMF can be
contiguous.
### 6.2.5 Cons
\- This solution requires lots of inter SMF signalling within SMF set which
may implications on Nxx interface(new reference point between SMFs with SMF
set). Whether this solution is fits into the BEPoP SID scope require further
checking and review by 3GPP CT4.
\- This solution requires standardization/specification and implementation of
a new interface, messages and procedures between SMFs of an SMF set to
advertise the list of IP addresses assigned to SMFs.
\- This solution adds complexity to SMF implementation for the allocation of
IP addresses, re-allocation of IP addresses when an SMF is added or removed
from the set, and advertisement of release of IP addresses owned by a
different SMF of the SMF set.
\- It requires support of an OAM or external entity to decide the IP addresses
partitioning between the SMFs of an SMF set.
\- The solution statically allocates IP addresses to SMFs of the SMF set,
which might result in the SMF set failing to establish new sessions when IP
addresses are still available (e.g. an SMF has failed w/o restart, the IP
addresses of that SMF are not re-allocated to other SMFs).
\- Any failure to exchange these new messages between SMFs (e.g. transient
communication failure between 2 SMFs, SMF overload) can result in SMFs getting
out of synchronization with regard to IP addresses usage and result e.g. in
SMF trying to allocate an IP address that is already assigned to an existing
PFCP session.
\- This solution requires each SMF in SMF set records the whole UE IP
address/prefix table which includes the individual UE IP resource part, the
recorded UE IP resource part, and the usage indication of every UE IP
address/prefix.
## 6.3 Solution #3: Enabling SMF to map network slice information into Network
Instance
### 6.3.1 Description
S-NSSAI and Network Instance already can be transferred between SMF and UPF,
e.g. in PDR and FAR. However, UPF can only use S-NSSAI for performance
measurement so far. The UPF is not expected currently to use S-NSSAI to
identify the network slice when allocating resources to the PDU session. The
UPF cannot use the S-NSSAI IE to isolate resources for multiple network
slices.
On the other hand, the Network Instance is determined by the SMF and the SMF
may determine the Network Instance for N3, N6, N9 and N19 interfaces by taking
into account S-NSSAI as specified in clause 5.6.12 of 3GPP TS 23.501 [5].
Network Instance is encoded as an OctetString as specified in clause 8.2.4 of
3GPP TS 29.244 [3]. So a simple way is, the SMF maps the network slice
information, DNN, IP domain, etc. into the Network Instance when needed and
sends Network Instance to UPF via PFCP Session Establishment/Modification
request message. Upon receiving, the UPF use the information in the Network
Instance for traffic detection and routing as the same as required by network
slice, so as to achieve multiple network slice sharing. This mechanism
requires SMF to map between Network Instance and the network slice information
but it requires no extra stage 2 modifications and introduces no new call
flows or IEs, which means it can be applied under current 3GPP specifications.
Based on the above statement, it is beneficial to enable SMF to map the
network slice information into Network Instance and send it to UPF to realize
multiple network slice sharing.
### 6.3.2 Signalling flow
The procedure for SMF to map network slice information into Network Instance
is shown in Figure 6.106.86.86.8.2-1.
Figure 6.3.2-1: Procedures for SMF to map network slice information into
Network Instance
1\. Pre-configure the mapping between the network slice information and the
Network Instance on SMF.
2\. SMF sends the Network Instance from which the network slice can be derived
to UPF via PFCP Session Establishment/Modification Request message.
3\. Upon receiving above message, UPF use the information in the Network
Instance for traffic detection and routing as the same as required by network
slice, so as to achieve multiple network slice sharing.
4\. UPF send PFCP Session Establishment/Modification Response message to SMF.
### 6.3.3 Impacts on services, entities and interfaces
SMF:
\- SMF is pre-configured with the mapping between the network slice
information and the Network Instance.
UPF:
\- None.
## 6.4 Solution #4: Enabling UP function to buffer downlink data as the
preferred option
### 6.4.1 Description
Solution #4 addresses the Key Issue #3 (Interoperability issues caused by
multiple options co-existence), sub-key issue #3c (DL data buffering).
It is beneficial to enable UP function to buffer downlink data:
\- As specified in clause 5.8.3.1 of 3GPP TS 23.501 [5] and in clause 5.9.1 of
3GPP TS 23.214 [2], support for buffering in the UP function is mandatory and
optional in the CP function.
\- It is the UP function sending the buffered downlink data to the UE. If the
downlink data is enabled to be buffered in the CP function, the UP function
shall firstly forward these downlink data to the CP function when it needs to
be buffered and the CP function shall then forward these buffered data back to
the UP function when the UP connection is activated, which leads to extra data
transfers and delays.
Based on the above statement, CP function should preferably buffer the
downlink data in the UP function when needed. The CP function may buffer
itself downlink data when specifically requested e.g. in following scenarios:
\- Control Plane CioT 5GS Optimisation is used where the DL data will travel
over NAS through the CP function.
\- For Ues using power saving methods.
### 6.4.2 Impacts on services, entities and interfaces
CP function:
\- CP function should preferably buffer the downlink data in the UP function
when needed. The CP function may buffer itself downlink data when specifically
requested e.g. in following scenarios:
\- Control Plane CioT 5GS Optimisation is used where the DL data will travel
over NAS through the CP function.
\- For Ues using power saving methods.
UP function:
\- None.
## 6.5 Solution #5: Enabling UP function to construct End Marker as the
preferred option
### 6.5.1 Description
Solution #5 addresses the Key Issue #3 (Interoperability issues caused by
multiple options co-existence), sub-key issue #3e (End Marker).
It is beneficial to enable UP function to construct End Marker:
\- As specified in clause 5.3.2 of 3GPP TS 29.244 [3], if the UP function
indicated support of End Marker packets constructed in the UP function, the CP
function shall request the UP function to construct and send End Marker
packets by sending a Session Modification Request including FAR(s) with the
new downstream F-TEID and with the SNDEM (Send End Marker Packets) flag set.
\- As specified in clause 5.8 of 3GPP TS 23.214 [2] and clause 5.8.2.9 of 3GPP
TS 23.501 [5]. It is the UP function sending the End Marker to the source RAN
and source UP function via S1/N3 and S5/8/N9 interface respectively. If the
End Marker is constructed by CP function, the CP function shall construct the
End Marker packet(s) and send it to the UP function when the path switch is
finished, which leads to extra Sx/N4 signalling interactions and resource
consumption in the UP function and the CP function.
Based on the above statement, it is proposed to require Rel-17 onwards UPFs to
support constructing End Marker packets and to recommending constructing End
Marker in the UPF as the preferred option.
### 6.5.2 Impacts on services, entities and interfaces
CP function:
\- None.
UP function:
\- Support to construct End Marker in the UP function as mandatory.
## 6.6 Solution #6: Enforce traffic redirection in the UP function as the only
option
### 6.6.1 Description
Solution #6 addresses the Key Issue #3 (Interoperability issues caused by
multiple options co-existence), sub-key issue #3d (Traffic redirection).
It is beneficial to enable UP function to enforce traffic redirection:
\- As specified in clause 5.4.7 of 3GPP TS 29.244 [3], for 5GC, the traffic
redirection may be enforced in the UP function only. And if the traffic that
the UP function can support may be subject to traffic redirection, traffic
redirection enforcement in the UP function shall be supported by the UP
function.
\- As specified in clause 5.4.7 of 3GPP TS 29.244 [3] and in clause 5.11.3 of
3GPP TS 23.214 [2], to enforce the traffic redirection in the CP function, the
CP function shall instruct the UP function to forward the applicable user
traffic to the CP function, which leads to extra data transfers and delays.
\- If UP function is deployed on the customer side, it may be inappropriate to
forward user traffic data from the UP function to the CP function due to the
customers\' privacy issue.
Based on the above statement, it is proposed to remove from the 3GPP TS 29.244
[3], from Rel-17 onwards, the option to enforce traffic redirection in the CP
function. In other words, traffic redirection would always be enforced in the
UP function.
### 6.6.2 Impacts on services, entities and interfaces
CP function:
\- CP function shall determine to enforce traffic redirection in the UP
function when needed.
UP function:
\- Support to enforce traffic redirection in the UP function as mandatory.
## 6.7 Solution#7: Recommending the support of features relating to the core
part of the PFCP protocol
### 6.7.1 Description
This solution addresses the Key Issue #3 (Interoperability issues caused by
multiple options co-existence) and proposes to recommend the support of
features that relate to the core part of the PFCP protocol, by NFs complying
with 3GPP Release 17.
NOTE: Features relating to the \"core part of the PFCP protocol\" refers to
features that relate to the basic implementation of the PFCP packet processing
model and the basic interactions between the CP and UP functions to establish
PFCP sessions.
It is proposed specifically to recommend the support of the PDI Optimization
feature (KI#3e) by 3GPP Rel-17 onwards compliant CP and UP functions:
\- this feature has been specified in 3GPP Rel-15 (see C4-182311, from Huawei,
Deutsche Telekom, Cisco, Nokia, Nokia Shanghai Bell, Ericsson);
\- the feature introduced the concept of Traffic EndPoint, corresponding to a
GTP-U endpoint or an Sgi/N6 endpoint, to ease the identification of the PFCP
session an incoming packet corresponds to (according to the packet forwarding
model, see Figure 5.2.1-1 of 3GPP TS 29.244 [3]) and to optimize the Sx and N4
signalling by enabling to create once a traffic endpoint and to refer to it in
all the PFCP session\'s rules associated to a GTP-U or Sgi / N6 endpoint;
\- not supporting this feature requires to send the same Packet Detection
Information (PDI) for every rule associated to a GTP-U or Sgi / N6 endpoint
and causes a logical discrepancy between the processing flow and the actual UP
function implementation, resulting in extra complexity.
### 6.7.2 Impacts on services, entities and interfaces
CP Function:
\- support of the PDI Optimization feature (i.e. concept of Traffic
EndPoints), if not already supported by the CP function;
UP Function:
\- support of the PDI Optimization feature (i.e. concept of Traffic
EndPoints), if not already supported by the UP function;
### 6.7.3 Pros
\- all vendors\' CP function and UP function\'s implementations complying with
3GPP Rel-17 support the same behaviour and features regarding the core part of
the PFCP protocol;
\- Sx and N4 signalling is optimized by provisioning Traffic EndPoints only
once in the UP function and referring to them in all rules;
### 6.7.4 Cons
\- none.
## 6.8 Solution #8: L2TP Tunnel and Session Setup by UP Function
### 6.8.1 Description
The solution is to address the Key Issue #5: L2TP Tunnelling over Sgi/N6 as
defined in clause 5.6.
An L2TP Session is required between the LAC and LNS when an PDN connection or
PDU session is established between the UE and the LNS in the Data Network. An
L2TP Tunnel exists between a LAC-LNS pair controlling the connection and
consists of one or more L2TP Sessions. One or more L2TP tunnels can be
established between a LAC-LNS pair.
The UP function can setup an L2TP session towards the L2TP server for a PDN
connection / PDU session, upon the request from the CP Function over Sx/N4
interface during PDN connection / PDU session Establishment. The UP function
evaluates which L2TP Tunnel is to be selected, and setups an L2TP Tunnel if
the wanted L2TP Tunnel does not exist already, before setting up the L2TP
session.
One L2TP tunnel between the UP Function and the L2TP server can be shared by
multiple PDN connection / PDU session using the same parameter (e.g. Network
Instance, LNS address, Tunnel-Assignment-Id). A single L2TP tunnel can be
shared by multiple PDN connections / PDU sessions created by same CP Function
or by different CP Functions.
To request the UP Function to setup an L2TP session towards the L2TP server,
the CP Function shall:
\- In the PFCP Session Establishment Request, request the UP Function to setup
L2TP tunnel and session. Parameters needed to setup the L2TP tunnel (e.g. LNS
address, Tunnel-Password, etc.), parameters needed to setup the L2TP session
(e.g. Calling Number, Called Number) and User Authentication parameters (e.g.
PAP/CHAP, username, password), shall be provided by the CP Function in the
PFCP Session Establishment Request.
NOTE: This solution is based on L2TP version 2, which is widely deployed in
the network.
Upon receiving the request for L2TP session setup from the CP Function, the UP
Function shall:
\- Select an L2TP Tunnel or create an L2TP tunnel if no suitable tunnel
already exists; and
\- Setup an L2TP session.
The UP Function sends a PFCP Setup Session Establishment Response to the CP,
carrying the information of Created L2TP Tunnel and L2TP session.
In order to support L2TP tunnel establishment by the UP Function, an L2TP
capable UP Function shall be selected. The CP Function may use one of the
following methods to select an L2TP capable UP Function: CP Function selects
the target UP Function based on the local configuration, CP Function selects
the target UP Function based on the UP Function features during PFCP
Association Establishment procedure, CP Function discovers the target UP
Function from the NRF.
### 6.8.2 Protocol impact over N4/Sxb
#### 6.8.2.1 L2TP Support Negotiation
The UP function shall indicate its support of L2TP in the UP function feature
IE during PFCP Association Setup procedure. The UP Function is assumed to have
the connectivity towards all LNSs via the given network instance. Figure
6.8.2.1-1 illustrates the L2TP support negotiation during PFCP Association
Setup procedure.
Figure 6.8.2.1-1: L2TP Support Negotiation Procedure
The UP Function indicates L2TP support in UE Function Feature IE in PFCP
Association Setup Response if the PFCP Association is initiated by the CP
function.
1\. The CP Function sends PFCP Association Setup Request to the UP Function.
2\. The UP Function sends PFCP Association Setup Response to the CP Function.
Within the message, the UP Function Features IE is included to indicate the
L2TP support, and if so, the UP function may include the LAC address(es)
configured per Network Instance if the Network Instance, e.g. corresponding to
a DNN/APN has been configured with multiple LACs.
NOTE: The CP function needs to select a right UP function (with a LAC address
configured matching the one received from AAA server, e.g. RADIUS/Diameter
server if it is received) when it requests UP function to establish a L2TP
tunnel and L2TP session. See also clause 3.3 of IETF RFC 2868 [9], clause
4.5.4 of IETF RFC 7155 [16].
The UP Function indicates L2TP support in PFCP Association Setup Request if
the PFCP Association is initiated by the UP function.
1\. The UP Function sends PFCP Association Setup Request to the CP Function.
Within the message, the UP Function Features IE is included to indicate the
L2TP support, and if so, the UP function may include the LAC address(es)
configured per Network Instance if the Network Instance, e.g. corresponding to
a DNN/APN has been configured with multiple LACs.
2\. The CP Function sends PFCP Association Setup Response to the UP Function.
#### 6.8.2.2 L2TP Tunnel/Session Setup
When the CP Function receives PDN connection / PDU session establishment
request, if an L2TP session is required to support the PDN connection/PDU
session, the CP Function requests the UP Function to setup an L2TP session
towards the L2TP server. Figure 6.8.2.2-1 illustrates the L2TP session
setup/tunnel during PFCP Session Establishment procedure.
Figure 6.8.2.2-1: L2TP Session/Tunnel Setup Procedure
1\. The CP Function receives PDN Connection Establishment Request / PDU
Session Establishment Request from the UE.
The CP Function may determine that an L2TP tunnel is required for the PDN
connection / PDU session based on the attributes of APN/DNN/S-NSSAI, which may
be stored in the local configuration of the CP Function, or retrieved from UE
subscription data. Or the CP Function may determine the need of L2TP tunnel
based on the L2TP tunnel parameters retrieved from RADIUS/Diameter/AAA server
during authentication procedure. In the latter case, the CP Function gets the
RADIUS/Diameter/AAA server address from its local configuration or from the
subscription data (e.g. like the dnAAA address for secondary authentication
stored in the UE subscription data).
2\. The CP Function sends PFCP Session Establishment Request message to the UP
Function.
If the L2TP tunnel parameters are available at the CP Function, either from
the local configuration of the CP Function or retrieved from the RADIUS/AAA
server, the CP Function provides the information listed in bullet a/b/c/d as
demand to the UP Function.
If the L2TP tunnel parameters are available at the UP Function, the CP
Function may only provide the information listed in bullet b/c/d as demand to
the UP Function.
a) One or more L2TP Tunnel Information IE is included in the message to
provide parameters to control a L2TP tunnel establishment if there is need to
establish a new L2TP tunnel. This IE includes LNS Ipv4/Ipv6 address, LNS
hostname, tunnel password, LAC Ipv4/Ipv6 address, LAC hostname, Tunnel
Assignment ID, as specified in IETF RFC 2868 [9] and IETF RFC 7155 [16].
\- Multiple L2TP Tunnel Information IEs can be sent to provide the UP Function
with a list of possible L2TP tunnels that can be used to establish the L2TP
session. This can be used to ensure that the session is established even if a
specific LNS is temporarily unavailable, or to load balance sessions over many
different LNS\'s.
\- If more than one L2TP Tunnel Information IE is provided, the L2TP Tunnel
Preference IE should be also be provided, which instructs the UP Function on
how to prioritize among the L2TP Tunnel Information IEs.
b) The L2TP Session Information IE which includes information to control the
L2TP session setup. The L2TP Session Information includes the Called Number
(optional), Calling Number (optional), Private Group ID (optional) and the MRU
(Maximum Receive Unit in LCP/PPP to be set as the value of the MTU received
from UE or be configured in the CP function), and the information for
Configuration Options in IPCP/PPP, e.g. indications to instruct that the UP
Function shall request the LNS to allocate an IP address for the PDN
session/PDN connection, to provide DNS server address(es) and/or NBNS server
address(es) for the session.
c) The L2TP User Authentication IE (optional) may also be included in L2TP
Session Information IE, consisting of parameters such as authentication type,
Username and password, Challenge and Challenge Response which is either sent
by the UE through PCO in step 1 or as part of configured information on the
CP.
d) If the UE IP address should be allocated by the UP Function (or the LNS),
the CP Function indicates this as normal in the UE IP Address IEs in the PDR.
If the L2TP tunnel parameters are configured in the UP Function, the UP
Function determines the need of L2TP tunnel based on its local configuration.
How to make the decision of L2TP tunnel is implementation specific.
3\. The UP Function acting as LAC is responsible to setup the L2TP tunnels and
sessions towards the LNS on receiving the L2TP session request from the CP.
On receiving the PFCP Session Establishment Request from the CP Function, the
UP function determines whether to use an already established L2TP tunnel or
establish a new tunnel. The UP function may have already established L2TP
tunnel(s) based on local configured L2TP Tunnel Information.
If an existing L2TP Tunnel is used, the UP Function shall only setup new L2TP
session within the existing L2TP tunnel. Otherwise, the UP Function shall
perform both L2TP tunnel and L2TP session setup.
4\. The UP Function sends PFCP Session Establishment Response to the CP
Function, carrying the Created L2TP Session IE containing information about
the L2TP session to be used for statistics or diagnostics. The response
message may also carry an LT2P Cause IE (optional), which can be used to
provide additional L2TP specific failure information to CP Function in case
the session establishment failed.
The PFCP Session Establishment Response message may also include the DNS
Server Address, containing the DNS server information. It is also possible to
send multiple IEs to provide multiple DNS server addresses, in which case, the
order the IEs are put in the message indicates the priority, i.e. the first IE
contains the primary DNS server address and the second IE contains the
secondary DNS server address. In similar lines, NBNS Server Address may also
be included in the response message from UP Function to CP Function.
If the UE IP address was allocated by the UP Function (or the LNS), the UP
Function provides the allocated IP address to the CP Function as normal in the
UE IP Address IEs in the Created PDR IE and/or Created Traffic Endpoint IE.
5\. The CP Function sends PDN Connection Establishment Response / PDU Session
Establishment Response to UE, containing the DNS/NBNS Server Address info via
PCO.
#### 6.8.2.3 L2TP Session/Tunnel Release
Since the L2TP session is tightly connected to the PFCP session, when the PFCP
session is terminated, the L2TP session is automatically terminated by the UP
Function (LAC), without any need for additional indication or signalling. In
addition, it is also feasible for the LNS to initiate L2TP tunnel and session
release. When the last L2TP session in a L2TP tunnel is terminated, the UP
Function, may, terminate the L2TP tunnel as well. However, it is also possible
to retain the L2TP tunnel, though all L2TP sessions are terminated.
Figure 6.8.2.3-1: L2TP Session Release Procedure
For a general scenario, where the CP Function receives a PDN/PDU Session
Release Request from the UE, the PFCP session deletion procedure, described in
clause 6.3.4 in 3GPP TS 29.244 [3] is applicable. In this scenario and in
Figure 6.8.2.3-1, the UP Function (LAC) releases the L2TP sessions, based on
PFCP session termination, and can be summarized as:
1\. The UE sends a PDN Connection Release Request/PDU Session Release Request
to the CP Function.
2\. The CP Function initiates the PFCP session deletion procedure and sends a
PFCP Session Deletion Request to the UP Function (LAC) to delete the existing
PFCP session.
3\. The UP Function performs the L2TP session release, and tunnel release
(when applicable).
4\. The UP Function sends a PFCP Session Deletion Response to the CP Function
with a cause success if the corresponding PFCP session context is found.
5\. On receiving the PFCP Session Deletion Response, the CP Functions sends a
PDN Session Release Response/PDU Session Release Response to the UE.
When the LNS terminates a L2TP session or a L2TP tunnel, the following
applies:
\- The LNS terminates the L2TP session, in which case the UP Function will
need to report to the CP Function that the PFCP session is terminated. This
can be done by the UP Function sending a PFCP Session Report Request message
to the CP, as described in clause 5.18.2 in 3GPP TS 29.244 [3], with an
additional LT2P Cause IE indicating the reason for the termination.
\- The LNS terminates the L2TP tunnel, in which case the UP will need to
report to the CP that all the PFCP sessions on the tunnel are terminated. The
PFCP Session Report Request message, described in Scenario 1 above can be sent
by the UP Function to the CP Function, with an L2TP Cause IE indicating the
reason for the termination. That is, each session is terminated individually,
instead of having a node-level message, this avoids the need for the CP
Function to keep track of the Tunnel IDs per session.
\- The LAC should terminate all L2TP sessions towards an LNS when the
connectivity to an LNS is lost. This implies that the UP Function terminates
each PFCP session as described in Scenario 2 above.
NOTE 1: The L2TP session cannot be modified as specified in IETF RFC 2661 [6].
NOTE 2: L2TP Cause IE provides some causes related to L2TP, which can be a new
IE or use existing Cause IE.
### 6.8.3 Impacts on services, entities and interfaces
The Sx/N4 interface needs to be enhanced to convey information required to
setup the L2TP sessions/tunnels to the UP Function. The CP Function and UP
Function should be able to support the following new IEs for the new L2TP
functionality:
The PFCP Session Establishment Request message from CP Function to UP Function
consists of
\- L2TP Tunnel Information IE (Conditional: if received from AAA server, e.g.
Radius/Diameter server or configured in the CP function):
This IE contains information required to setup an LT2P tunnel to an LNS. It
contains LNS IP Address, LNS Host Name, Tunnel Password, Tunnel Preference,
Tunnel Assignment ID, LAC IP Address, LAC Host Name.
\- L2TP Session Information IE (Mandatory)
This IE contains the information to be used for the L2TP session creation. It
contains MRU, Called Number, Calling Number, Private Group ID and Request for
IP Indication, Request for DNS Indication, Request for NBNS Indication.
It may also contain the L2TP User Authentication IE which Authentication Type,
Authentication Name, Password, Challenge, Challenge Response.
The PFCP Session Establishment Response message from UP Function to CP
Function consists of
\- Created L2TP Session IE (Mandatory)
This IE provides the L2TP session information and is for statistics and
diagnostics purpose. It contains the following parameters of, LAC IP Address,
LAC Port, LAC Tunnel ID, LAC Session ID, LNS IP Address, LNS Port, LNS Tunnel
ID, LNS Session ID.
It, may, also contain the L2TP Cause IE. This L2TP Cause IE (Optional) that
contains the parameters of, Result Code.
The Created L2TP Session IE may also contain the DNS Server Address and NBNS
Server Address.
NOTE: AVPs introduced in IETF RFC 2661 [6] and IETF RFC 2868 which are used
over Sgi/N6 will be checked by CT3 and possibly be documented in 3GPP TS
29.061 [14] and 3GPP TS 29.561 ]15].
### 6.8.4 End to End Signalling Flow
The end to end signalling flow in this clause is for information. For the
procedure described below, it is a prerequisite that the UE is already
registered into the 5GC, and both SMF and UPF support L2TP feature.
NOTE 1: The scenario where the UE sends actual PPP frames/signaling towards
the LAC, which involves back and forth message exchanges between the UE and
LAC, for example, for LCP Negotiation is not in scope. The UE may send any
such LCP-based information or authentication information (authentication
protocol supported by the UE, that is, PAP/CHAP, and credentials such as
username/password) to the SMF via the PCO.
NOTE 2: The description is based on L2TP version 2, which is widely deployed
in the network.
NOTE 3: Similar end to end signalling flow applies for a PDN connection
creation procedure when the UE is registered in EPS and request to establish a
PDN connection towards a Packet Data Network requiring L2TP support.
Figure 6.8.4-1: Detailed L2TP Signalling for Tunnel/Session Setup
1\. The SMF receives a PDU session establishment request from the UE.
The UE may include additional (protocol) data (e.g. configuration parameters,
error codes or messages/events) associated with an external protocol or an
application in the PCO, e.g. the authentication information for PAP and/or
CHAP, IPCP/PPP information to request DNS and NBNS Server. The CP Function may
optionally be locally configured with the UE authentication information for a
given DNN/APN.
The SMF may determine that an L2TP session is required for the PDU session
based on local configuration (e.g. DNN/S-NSSAI). The SMF may retrieve the L2TP
Tunnel parameters from external servers such as RADIUS/Diameter/AAA server, as
described in step 2 below, or be configured locally.
The L2TP Tunnel parameters include the LNS Ipv4/Ipv6 address, LNS hostname,
Tunnel Password, Tunnel Assignment ID, Tunnel Private Group ID.
Based on operator configuration, the Calling Number and the Called Number
values may be configured to take the form of IMSI/MSISDN and APN Name,
respectively.\ \ The Tunnel Assignment ID is used to indicate to LAC (i.e. UP
function) the particular L2TP tunnel to which a L2TP session is to be
assigned, as described in clause 3.7 of IETF RFC 2868 [9] and clause 4.5.8 of
IETF RFC 7155 [16].\ \ NBNS server is s a server responsible for maintaining a
list of mappings between NetBIOS computer names and network addresses for a
network that uses NetBIOS as its naming service.
2\. The SMF may retrieve the L2TP Tunnel Parameters from the
RADIUS/Diameter/AAA Server by sending a \"Access Request\" message or
\"Diameter EAP Request (DER)\" message.
The following tunnel parameters can be retrieved, based on IETF RFC 2868 [9]
and IETF RFC 7155 [16]: Tunnel Password, Tunnel Assignment ID, Tunnel Private
Group ID. In addition, it can also, provide the L2TP version, LNS Ipv4/Ipv6
address, LNS hostname, which can also be locally configured on the CP
Function.
The Tunnel Private Group ID is used to identify the session as belonging to a
group that should receive some specific handling in the LNS. The Tunnel
Assignment ID (TAID) is used to select an L2TP tunnel and have all the
sessions created with the same TAID value in the same L2TP tunnel, and
sessions with other Tunnel Assignment ID (TAID) value shall not be created on
that tunnel.
The RADIUS/Diameter/AAA server responds with an \"Access Response\" message or
\"Diameter EAP Answer (DEA)\" message, containing the L2TP parameters, such
as, Tunnel Password, Tunnel Assignment ID (TAID), Tunnel Private Group ID, the
L2TP version, LNS Ipv4/Ipv6 address and LNS hostname.
3\. If L2TP protocol is determined to support the PDN connection/PDU session,
the SMF selects a UPF supporting L2TP and be configured with the LAC
name/addresses (which may be included in response from Radius/Diameter/AAA
server) and then requests the UPF to setup an L2TP session towards the L2TP
server (LNS). For a given DNN/APN requiring L2TP function, multiple LACs may
be configured to be connected multiple LNSs in the Data Network. A UPF may be
configured with the multiple LAC names and addresses for a given APN/DNN.
The SMF sends PFCP Session Establishment Request to the UPF, which includes
L2TP Tunnel Information for setting up a L2TP tunnel and L2TP Session
Information to setup a L2TP session, together with the information for
authentication used during L2TP Tunnel setup, as well as for L2TP session. See
clause 6.8.5.
The L2TP Tunnel Information includes Tunnel Password, Tunnel Assignment ID
(TAID), Tunnel Private Group ID, the L2TP version, LNS Ipv4/Ipv6 address and
LNS hostname.
The L2TP Session Information includes specific information related to the PDU
session, e.g. a Calling Number which may be set to UE\'s SUPI, an indication
to instruct that the UPF shall request the LNS to allocate an IP address for
the PDU session, indications to instruct that the UPF shall request the LNS to
provide DNS server addresses or NBNS server addresses, the MRU (Maximum
Receive Unit) to use (based on the MTU size).
If the UE IP address should be allocated by the UPF (or the LNS), the SMF
indicates this in the UE IP Address IEs in the PDRs and/or Traffic Endpoints.
4\. The UPF checks if any existing L2TP can be used to serve the PDU session
according to the information provided in the L2TP Tunnel Information.\ \ If
the UPF decides to setup a new L2TP tunnel, it initiates L2TP Tunnel
establishment by sending an SCCRQ message towards the LNS, the UPF will
allocate a Tunnel ID, and it may include a CHAP Challenge to authenticate the
LNS. The Challenge and Challenge Response (to be included in SCCCN) is
produced by the UPF using the Tunnel Password received from the SMF.
The LNS responds with an SCCRP message, containing its allocated Tunnel ID and
a CHAP Challenge Response to the Challenge in SCCRQ. Optionally, the SCCRP
message from the LNS may also contain a CHAP Challenge message towards the
UPF, to authenticate the UPF.
The UPF then responds with a Challenge response for tunnel authentication in
the SCCCN message. An L2TP Tunnel is established after the tunnel
authentication is successful, with the reception of the SCCCN message sent by
the UPF to the LNS.
If the UPF decides to use an already existing L2TP Tunnel for the requested
PDU Session from the SMF, it proceeds with step 5 below.
See also IETF RFC 2661 [6].
5\. Once the L2TP Tunnel is established (or already present) between the UPF
and the LNS for the PDU Session requested by the UE, the UPF proceeds with
L2TP Session setup towards the LNS.
The UPF sends an ICRQ message towards the LNS, which contains the Tunnel ID
assigned by the LNS, its assigned Session ID, and optionally, the Calling
Number and Called Number. The LNS responds with an ICRP message and provides
the Session ID assigned by it to the UPF.
The UPF then sends an ICCN message. The UPF includes the UE authentication
information from the SMF received via PCO in step 1. In addition, the UPF
(LAC) will act as a PPP endpoint to use LCP to communicate some link control
parameters, e.g. MRU; to use PAP/CHAP to perform an authentication procedure;
to use IPCP to request PDU Session IP Address, DNS and/or NBNS server
address(es).
If proxy authentication is employed, the same ICCN message also provides the
Proxy Authen Type and corresponding proxy authentication information to the
LNS. This authentication information includes the fields of Proxy Authen Name,
Proxy Authen Challenge, Proxy Authen ID and Proxy Authen Response.
If proxy authentication is successful, a success will be returned.
Otherwise, after the reception of the ICCN message, the LNS responds with a
ZLB Ack Message. After the reception of ZLB Ack message, the LAC and LNS will
use PPP LCP to communicate link specific control parameter, and indicate
Authentication type, then either PPP PAP/CHAP takes place. The PPP IPCP
transactions takes places to retrieve UE IP Address and/or DNS and/or NBNS
server address.
Note: In case the SMF sends a challenge and response for CHAP authentication,
but, the LNS requires PAP, the L2TP session setup will fail, since the
information required to perform PAP authentication is not available. If the UE
sends PAP information, but, the LNS requires CHAP, the password sent by the UE
can be used for CHAP authentication.
See also IETF RFC 2661 [6].
6\. The status of the L2TP session setup is sent by the UPF to the SMF in a
PFCP Session Establishment Response.
7\. The SMF sends a PDU Session Establishment Response to the UE and the user
data session is initiated, which contains the DNS and NBNS Server information.
### 6.8.5 Security Considerations for L2TP Tunnel and Session Management
#### 6.8.5.1 Security handling during an L2TP Tunnel Establishment
During an L2TP Tunnel establishment, LAC and LNS use CHAP-like tunnel
authentication mechanism to authenticate each other as specified in clause
5.1.1 of IETF RFC 2661 [6]. If an LAC or LNS wishes to authenticate the
identity of the peer it is contacting or being contacted by, a Challenge AVP
is included in the SCCRQ or SCCRP message. If a Challenge AVP is received in
an SCCRQ or SCCRP, a Challenge Response AVP MUST be sent in the following
SCCRP or SCCCN, respectively. If the expected response and response received
from a peer does not match, establishment of the tunnel MUST be disallowed.
To participate in tunnel authentication, a single shared secret MUST exist
between the LAC and LNS, i.e. the UP Function needs to have the same shared
secret as at the LNS to generate a CHAP Challenge or Challenge Response
towards the LNS. The UP Function should be able to receive this shared secret
from the CP Function, which receives such information from a radius server.
Such shared secret is retrieved by the CP Function from RADIUS via the
encrypted \"Tunnel-Password\" AVP in the Radius Access-Accept message (see
clause 3.5 of IETF RFC 2868 [9]). The CP Function possesses a shared secret,
that is also known to the RADIUS server, to be able to decrypt the \"Tunnel-
Password\" AVP. The CP Function, then, sends this shared secret decrypted from
the \"tunnel-password\" to the UP Function, and the UP Function generates a
Challenge or Challenge Response using this secret included in SCCRQ or SCCCN
to the LNS to establish L2TP Tunnel.
When the CP Function sends the L2TP tunnel password to the UP Function over N4
via PFCP, whether the tunnel password should be sent in a protected manner,
e.g. encrypted, and how is the encryption achieved needs SA3 to provide
further guideline.
#### 6.8.5.2 Security handling during an L2TP Session Establishment
In order to setup an L2TP session for a PDN connection or a PDU Session,
either PAP or CHAP authentication mechanisms may be used. The PPP
authentication mechanisms of PAP and CHAP are described in detail in IETF RFC
1334 [12].
Any PPP-based configuration information, e.g. for PAP or CHAP, is received
from the UE, which is included in the PCO, e.g. in the PDU Session
Establishment Request message or Create Session Request sent towards the CP
Function. The clause 10.5.6.3 in 3GPP TS 24.008 [11] specifies that the UE can
send the PAP/CHAP authentication information as configuration protocol option
lists in PCO to the CP Function.
The PAP authentication information from the UE in PCO consists of username and
password. However, when CHAP authentication is being used by the UE, the UE
sends the CHAP Challenge and Response in the PCO, which can be used by the UP
Function (as Proxy Authen Challenge and Proxy Authen Challenge Response
included in the ICCN message) and send towards the LAC to verify.
Whether such authentication information received from UE via PCO which is
related to establish a L2TP session, should be sent in a protected manner,
e.g. encrypted, and how is the encryption achieved needs SA3 to provide
further guideline.
#### 6.8.5.3 Potential alternative solutions
A security mechanism may be required to send aforementioned information
(Tunnel-Password (for L2TP tunnel), User name and password for PAP, Challenge
and Challenge Response for CHAP (for L2TP session) as described in 6.8.5.1 and
6.8.5.2 from the CP function to the UP function, based on operator policy,
e.g. when the CP function and UP function are in different security domains.
The following is a list of alternatives that can be considered:
\- Relying on the Network domain security, e.g. using IPSec, as specified in
3GPP TS 33.210 [10]. If so, there is no need to develop any further security
mechanism to protect the aforementioned information.
\- Using DTLS over N4/Sxb when supporting L2TP, as described in IETF RFC 6347
[13].
\- Using partial encryption of the sensitive data like RADIUS for tunnel
password, as described in IETF RFC 2868, clause 3.5, where CP function and UP
function is configured with a shared secret.
#### 6.8.5.4 Conclusions
As per suggested in SA3 LS (S3-212365), the NDS/IP mechanism (as specified in
3GPP TS 33.210 [10]) shall be used, if the information transferred from the CP
function to the UP function needs to be protected.
## 6.9 Solution#9: Enabling UPF to support multiple network slices
### 6.9.1 Description
This solution is to address Key Issue #1 \"UPF support for multiple network
slice sharing\". When UPF are shared by several network slices, UPF should
know which slice the PFCP session (PDU session) is pertaining to according to
information provided by the received S-NSSAI.
Although, in the current specifications, the Network Instance ID transmitted
on N4 interface can already provide the UPF with the information, this
approach may not work well in some cases, e.g. when a Network Instance ID is
selected for multiple different network slices based on operator\'s
configuration, UPF may not tell them apart only by the Network Instance ID.
And in the current specification, what Network Instance ID can be encoded as
is not clear that it may be encoded as a Domain Name or DNN or S-NSSAI or
other defined field (see clause 8.2.4 of 3GPP TS 29.244 [3]). Different
vendors or operators may have different definitions of Network Instance ID.
Using S-NSSAI to let UPF know which slice the PFCP session is pertaining to
would be a more direct approach. Therefore, it\'s proposed to release the
limitation that S-NSSAI is only used for performance measurement.
### 6.9.2 Procedure
The procedure for UPF to support multi-slice sharing is showed in Figure
6.9.2-1.
Figure 6.9.2-1: Procedures for the method that UPF supports multi-slice
sharing
1\. Pre-configure supported slice information in UPF.
2\. [Optional] Nnrf_NFManagement_NFRegister_request procedure as in clause
4.17.1 of TS 23.502, carrying supported slice ID.
3\. UE Registration procedure as in clause 4.2.2.2.2 of TS 23.502.
4\. PDU Session Establishment Request procedure as in clause 4.3.2.2.1 of TS
23.502.
5\. AMF searches for and selects a suitable SMF in NRF combining DNN,
location, slice identification and other information, as specified in clause
4.3.2.2.1 of TS 23.502.
6\. PDU Session Establishment request procedure as in 4.3.2.2.1 of TS 23.502.
7\. SMF retrieves the user subscription data from the UDM, as specified in
clause 4.3.2.2.1 of TS 23.502.
8\. [Optional] SMF searches for the appropriate UPF according to DNN, location
information and also supported slice ID from NRF, as the procedure in clause
4.17.4 of TS 23.502.
9\. SMF selects a UPF based on DNN, slice identification, location and other
information, as specified in clause 4.3.2.2.1 of TS 23.502.
10\. SMF sends a PFCP Session Establishment request with the slice ID to UPF,
as the procedure in clause 4.3.2.2.1 in TS 23.502.
11\. UPF performs corresponding resource allocation (e.g. GTP tunnel
resources, CPU resources, etc) and subsequent slice isolation according to the
received Network Instance ID, Pool ID (if received) and Network slice ID (i.e.
S-NSSAI IE).
12\. UPF returns PFCP Session Establishment response to SMF as in clause
4.3.2.2.1 in TS 23.502.
13\. PDU session establishment procedures, as specified in clause 4.3.2.2.1 of
TS 23.502.
### 6.9.3 Impacts
UPF:
\- UPF is pre-configured with the supported S-NSSAI;
\- UPF shall allocate resources to PDU sessions according to the Network
Instance ID, Pool ID (if received) and Network slice ID (i.e. S-NSSAI IE);
SMF:
\- None.
## 6.10 Solution #10: UP Controlled UE IP Portion
### 6.10.1 Description
This solution addresses the Key Issue #4 (Avoidance of conflict between UE IP
address/prefix allocated by SMF(s)) and proposes to update the UP Function
behaviour to support of UE IP Portions:
The UE IP address information may be configured in the UP Function, while
operators may request the UE IP address to be allocated by the CP Function, as
per the need of a specific deployment scenario. In this case, if one UP
Function is controlled by multiple CP Functions, clash of UE IP address
allocation may happen easily.
To avoid clash of UE IP allocation among multiple CP Functions, the UP
Function can divide the UE IP address information configured in the UP
Function into several portions and just provide one portion to each CP
Function at the beginning. During PFCP Association Setup procedure, the UP
Function provides one UE IP Portion to the CP Function.
A typical example is, if UE IP Address Pool(s) is configured in the UP
Function, the UP Function can divide multiple UE IP Address Pool(s) into
several portions or can divide one big UE IP Address Pool into multiple
subsets of UE IP Address Pool.
To support this functionality, the UP Function shall:
\- Divide the configured UE IP address information (e.g. UE IP Ranges, UE IP
Address Pools) into multiple UE IP Portions, when the UP Function is
controlled by multiple CP Functions;
\- Provide one UE IP Portion (or small subsets of UE IP Portions) to the CP
Function, during PFCP Association Setup procedure;
\- Keep monitoring to the usage of UE IP Portion assigned to a CP Function,
and provide subsequent UE IP Portion to the CP Function, if the previous UE IP
Portion is to be used out;
\- Recycle the UE IP Portion assigned to a CP Function, if all PFCP sessions
and PFCP association to that CP Function is released;
The CP Function shall:
\- Store the UE IP Portion information received from PFCP Association Setup
procedure or updated in PFCP Association Update procedure, and allocate UE IP
address from the assigned UE IP Portion;
In the case one UP Function serves multiple DNNs / multiple slices and is
controlled by multiple CP Functions, this solution can be used to avoid
conflict of UE IP address allocation. However, this solution does not work in
SMF SET deployment, due to one PDU session can be taken over by any other SMF
within the SMF SET if the previous SMF fails. Other mechanisms (e.g. solution
described in clause 6.2) may be used in this case.
### 6.10.2 Impacts on services, entities and interfaces
The behaviour of UP Function is enhanced to support UE IP Portion division and
assignment.
### 6.10.3 Pros
If UE IP address information is configured in the UP Function and UE IP
allocation is controlled by CP Function, clash of UE IP address allocation by
CP Function can be eliminated as much as possible, when one UP Function is
controlled by multiple CP Functions.
### 6.10.4 Cons
It requires a well-developed mechanism in the UP Function for UE IP portioning
and recycling.
This solution does not work in the SMF SET deployment, thus the applicability
of this solution is reduced.
Since the UP Function is configured with IP addresses in this solution, it is
questionable why not let the UP Function allocate the UE IP addresses upon
establishment of PFCP sessions as much as possible.
## 6.11 Solution #11: UE IP address allocation by DHCP or AAA Server in 5GC
### 6.11.1 Description
#### 6.11.1.1 General
This solution addresses the Key Issue #4 (Avoidance of conflict between UE IP
address/prefix allocated by SMF(s)).
UE IP address allocation per DNN and per S-NSSAI in (external) DHCP/DN-AAA
server is supported in 5GS specifications from 3GPP Rel-15 onwards. See clause
5.8.2.2 of 3GPP TS 23.501 [5] and clauses 10, 11 and 12 of 3GPP TS 29.561
[15].
The solution proposes to use DHCP or AAA severs in 5GC for the allocation of
UE IP addresses. SMFs send UE IP address allocation, renewal and release
related request messages to DHCP or AAA server, and maintain the corresponding
state information. The IP address allocation request sent to DHCP/AAA server
may include the IP address pool ID to identify which range of IP address is to
be allocated. In this case, SMFs are provisioned with separate IP address pool
ID(s), and the mapping between IP address pool ID and UPF Id, DNN, S-NSSAI, IP
version. The provision is done by OAM or during the N4 Association Setup
procedure (as per existing PFCP procedures).
#### 6.11.1.2 Using a DHCP server
DHCP provides a mechanism for passing a large set of configuration parameters
to hosts connected to a TCP/IP network (IP address, sub-net mask, domain name,
MTU, etc.) in an automatic manner. Moreover, DHCP may assign IP addresses to
clients for a finite lease time, allowing for sequential reassignment of
addresses to different users.
The SMF should request, renew and release IP addresses for PDU sessions using
similar DHCP procedures as those specified in clause 10 of 3GPP TS 29.561
[15]:
\- the SMF acts as a DHCP client towards the DHCP server;
\- the SMF may determine an IP address pool ID based on the selected UPF ID,
S-NSSAI, DNN, and IP version as described in clause 5.8.2.2.1 in 3GPP TS
23.501 [5] and includes the IP address pool ID within 3GPP Vendor-Specific-
Option and send it to the DHCP server.
but with the following differences:
\- one (or more) DHCPv4 or DHCPv6 server is deployed within the 5GC;
\- different SMFs of an SMF set may request, renew and release the IP address
assigned to given PDU session, e.g. when the PDU session is taken over by a
different SMF during the lifetime of the PDU session.
The lease time is chosen by the operator of the DHCP server and may be set to
a long time to minimize the need for IP address renewal. When the DHCP lease
time is approaching expiry, the SMF should request the DHCP server to renew
the IP address (keeping the IP address unchanged).
#### 6.11.1.3 Using a AAA server
Alternatively, the SMF should request, renew and release IP addresses for PDU
sessions using similar AAA procedures described in clauses 11 and 12 of 3GPP
TS 29.561 [15]:
\- the SMF acts as a RADIUS (or DIAMETER) client towards the AAA server;
\- the SMF may determine an IP address pool ID based on UPF ID, S-NSSAI, DNN,
and IP version as described in clause 5.8.2.2.1 in 3GPP TS 23.501 [5] and
includes the IP address pool ID within 3GPP-IP-Address-Pool-Info and send it
to the AAA; the AAA assigns IPv6 prefix or IPv4 address from the requested IP
address pool;
\- the SMF should indicate the type of IP address to be allocated by including
the 3GPP-Allocate-IP-Type subattribute in the Access-Request message;
but with the following differences:
\- one (or more) AAA server is deployed within the 5GC;
\- different SMFs of an SMF set may request, renew and release the IP address
assigned to given PDU session, e.g. when the PDU session is taken over by a
different SMF during the lifetime of the PDU session;
The lease time is chosen by the operator of the AAA server and may be set to a
long time to minimize the need for IP address renewal. When the lease time is
approaching expiry, the SMF should initiate a AAA re-authorization to renew
the IP address (keeping the IP address unchanged.
NOTE: The lease time is stored in the PDU session context. SMFs of an SMF set
share their contexts. So any SMF that may take over the control of the PDU
session can determine whether the lease time is approaching expiry.
### 6.11.2 Impacts on services, entities and interfaces
Impacts:
\- DCHP or AAA servers are deployed in the 5GC for the allocation of UE IP
addresses;
\- SMFs run existing DHCP or AAA procedures but towards a DHCP or AAA server
located in 5GC.
### 6.11.3 Pros
The solution has the following pros:
\- the solution supports UE IP addresses pools shared by SMFs from the same or
different SMF sets;
\- UE IP addresses are configured centrally in DHCP or AAA server, and
assigned consistently to all SMFs without collisions of UE IP address
allocation;
\- SMFs can be scaled-in or out in the SMF set without any impact to the UE IP
addresses configuration and allocation and without impacts to existing PFCP
sessions;
\- the solution has minimal impacts to SMF as it reuses existing procedures
supported towards DN;
\- central configuration and allocation of UE IP addresses allow monitoring
(e.g. KPIs) of the usage of IP addresses in the SMF set:
\- the solution does not require standardization work as it leverages existing
solutions;
\- the solution allows full sharing of all UE IP addresses across all SMFs (as
opposed to solutions based on IP addresses partitioning between different
SMFs).
### 6.11.4 Cons
The solution has the following pros:
\- it requires the deployment of DHCP and AAA servers in the 5GC for UE IP
address allocations;
\- it requires signalling between SMFs and the DHCP or AAA server during PDU
session establishments and release, and possibly for UE IP address renewal,
causing slight latency, but this is not different to what happens with
external DHCP and AAA servers.
## 6.12 Solution #12: UE IP address/prefix allocation by SMF self management
### 6.12.1 Description
#### 6.12.1.1 General
The description below is to address the solution for Key Issue# 4 and it is
based on solution#2 with some changes. The clause 6.2.1.1 in solution#2 can be
reused.
The SMFs of an SMF set share the same contexts data where the UE IP address is
part of the context information of a PDU session. So, each SMF in SMF set know
all the UE IP addresses which is been used in this SMF set by checking the
shared context data. These UE IP addresses information can be used for the
SMFs to synchronize the IP usage record during SMF recover, session release
and SMF added/removed to/from SMF set.
#### 6.12.1.2 SMF recover
If the SMF is recovered from a failure, it will check all the UE IP addresses
information from the shared context data and make the records for its
individual UE IP address/prefix list. If the UE IP address/prefix is included
in the shared context data, the SMF shall mark it as unavailable.
#### 6.12.1.3 Session release
If the SMF release the UE IP address(es)/prefix(s) which are not belonging to
its individual UE IP address/prefix list, these UE IP address/prefix might be
marked as unavailable by the original SMF without synchronization. In order to
avoid this, all the SMFs in SMF set can periodically check all the UE IP
addresses information from the shared context data and update the records for
its individual UE IP address/prefix list. If the UE IP address/prefix is not
included in the shared context data, the SMF will update the record as
available.
#### 6.12.1.4 SMF added/removed to/from SMF set
If SMF(s) added/removed to/from the SMF set, the UE IP address/prefix resource
will be re-assigned depends on operator\'s policy. Each SMF will get the new
UE IP address/prefix table which is different from the old one.
Some UE IP address(es)/prefix(es) originally controlled by one SMF might be
partitioned to another SMF within the same SMF set. Two possible scenarios are
list as below.
\- UE IP address(es)/prefix(es) originally controlled by one SMF which is
removed from the SMF set but re-assigned to another target SMF.
\- UE IP address(es)/prefix(es) originally controlled by one SMF but re-
assigned to another target SMF.
For the UE IP address(es)/prefix(es) originally controlled by one SMF which is
removed from the SMF set but re-assigned to another target SMF, the target SMF
will check all the UE IP addresses information from the shared context data
and make the records for these new individual UE IP address(es)/prefix(es). If
the UE IP address/prefix is included in the shared context data, the target
SMF shall mark it as unavailable.
For the UE IP address(es)/prefix(es) originally controlled by one SMF but re-
assigned to another target SMF, the original SMF shall mark all the UE IP
address(es)/prefix(es) as available when the PDU session is not controlled by
its own. The target SMF will check all the UE IP addresses information from
the shared context data and make the records for these new individual UE IP
address(es)/prefix(es). If the UE IP address/prefix is included in the shared
context data, the target SMF shall mark it as unavailable.
### 6.12.2 Impacts on services, entities and interfaces
The solution requires no impacts on services, entities and interfaces.
### 6.12.3 Pros
\- The proposed solution enables the UE IP address/prefix allocation by SMF if
SSET and MPAS feature deployed.
\- In early stage of 5G deployment, the operator may choose CP function to
support the UE IP address/prefix allocation since CP function is required to
support this feature as mandatory. But along with the network and business
expansion, SSET and MPAS feature may be deployed. Then the operator may want
to have the same UE IP address/prefix allocation policy with SSET and MPAS to
ensure the solution continuity. This solution ensures the customer can choose
the same UE IP address/prefix allocation policy when SSET and MPAS feature
deployed.
\- From the UE IP planning point of view, the partitioning of UE IP
addresses/prefixes for each SMF in SMF set will be easy when the SMF is
added/removed from the SMF set. When new SMF added/removed to/from SMF set,
the UE IP resource in SMF set can be simply divided to each SMF as individual
UE IP addresses/prefixes list no matter what is the real UE IP resource usage
status. And the available UE IP addresses/prefix for each SMF can be
contiguous.
\- No external server like AAA/DHCP required to be deployed for SMF set.
\- There is no signalling exchange between the SMF and the external server
during the PDU session establishments and release which will be time efficient
with no latency.
### 6.12.4 Cons
\- It requires support of an OAM or external entity to decide the IP addresses
partitioning between the SMFs of an SMF set.
\- The solution statically allocates IP addresses to SMFs of the SMF set,
which might result in the SMF set failing to establish new sessions when IP
addresses are still available (e.g. an SMF has failed w/o restart, the IP
addresses of that SMF are not re-allocated to other SMFs).
\- This solution requires each SMF in SMF set records the whole UE IP
address/prefix table which includes the individual UE IP resource part, the
recorded UE IP resource part, and the usage indication of every UE IP
address/prefix.
\- This solution is restricted to SMF set with share context, cannot cover the
different SMFs from different SMF sets scenario listed in key issue#4.
\- This solution adds complexity to SMF implementation for the allocation of
IP addresses, re-allocation of IP addresses when an SMF is added or removed
from the set, SMF recover and session release, to check all the UE IP
addresses information from the shared context data.
\- If the PDU session is served by original SMF, but the IP address is re-
assigned to the target SMF, the SMF shall periodically check all the UE IP
addresses information from the shared context data, otherwise the IP address
will be unavailable even the PDU session is released.
## 6.13 Solution #13: Per Slice UP Resource Allocation and Usage Report
### 6.12.1 Description
The solution is to address the Key Issue #1: UPF support for multiple network
slices in clause 5.2.
An operator may configure their UP Functions to support multiple slices, e.g.
a category of network slices with the same slice type but different slice
differentiator, for similar businesses belonging to different customers.
To support per slice UP resource management and usage report, the UP Function
shall:
\- Allocate the UP resource (e.g. UE IP address) taking into account the
Network Instance ID and the S-NSSAI IEs indicated by the CP Function in a PFCP
Session Establishment / Modification request;
\- Report the usage of UP resources for a specific network slice, periodically
or when the usage reaches the configured threshold;
The N4 interface thus needs the following enhancements:
\- Add S-NSSAI to the UE IP Address Usage Information IE, to support per slice
UE IP address usage report;
### 6.13.2 Impacts on services, entities and interfaces
This solution requires UP Function to allocate the UP resources per network
slice, and report the usage of UP resources at per slice granularity. N4
interface needs enhancements to support the report of UP resources at per
slice granularity.
### 6.13.3 Pros
This solution meets the operator requirements of allocating UP resources and
reporting the usage of UP resources at per slice granularity, especially for
certain deployment scenario where one UP Function serves different slices
targeting different customers.
### 6.13.4 Cons
Enhancements to the UP Function and N4 interface are required.
# 7 Evaluations and Conclusions
## 7.1 Evaluation and Conclusions of Solutions for Key Issue #1
### 7.1.1 Evaluation
For Key Issue #1 -- \"UPF support for multiple network slice sharing\",
candidate Solutions #3 and #9 have been proposed.
Candidate solution #3 proposes to map the network slice information, DNN, IP
domain, etc. into the Network Instance, and to configure the network instance
in SMF and UPF. When establish a PFCP session, the SMF will instruct UPF which
network instance should be used for the PFCP session. The network instance is
used to achieve multiple network slice sharing.
Candidate solution #9 proposes that UPF can use the S-NSSAI received from SMF
to know which slice the PFCP session (PDU Session) is pertaining to and shall
allocate resources to PDU sessions according to the Network Instance ID, Pool
ID (if received) and Network slice ID (i.e. S-NSSAI IE).
Table 7.1.1-1 summarizes the evaluation of candidate solutions for key issue
#1.
Table 7.1.1-1: Evaluation for Key Issue #1
+----------------------+----------------------+----------------------+ | Analysis | Solutions Overview | | +======================+======================+======================+ | | Solution #3 | Solution #9 | +----------------------+----------------------+----------------------+ | Impacts (software) | The Network is | UPF is implemented | | | pre-configured with | with a separate | | | a list of Network | logic to allocate | | | Instances mapped | user plane resource | | | from a few factors, | based on the | | | e.g. S-NSSAI, | S-NSSAI. | | | DNN/APN, which | | | | require relevant | | | | packets to be | | | | treated differently | | | | in the user plane. | | | | | | | | Note: The solution | | | | #3 corresponds to | | | | the solution defined | | | | in existing | | | | standards. | | +----------------------+----------------------+----------------------+ | Operational | SMF considers the | UPF shall allocate | | | network slice | resources to PDU | | | information, DNN, IP | sessions according | | | domain, etc. and | to the Network | | | select a Network | Instance ID, Pool ID | | | Instance as | (if received) and | | | configured by the | Network slice ID | | | network. | (i.e. S-NSSAI IE). | +----------------------+----------------------+----------------------+ | Standardization | It requires no extra | It introduces no new | | impacts | stage 2 | call flows or IEs in | | | modifications and | stage 2. | | | introduces no new | | | | call flows or IEs. | | +----------------------+----------------------+----------------------+ | Advantages | This solution has no | This solution has no | | | impact on SMF and | impact on SMF. | | | UPF. | | | | | UPF can know at once | | | | which slice the PDU | | | | session is | | | | pertaining to | | | | according to the | | | | S-NSSAI IE without | | | | having to derive | | | | this information | | | | from mappings. | +----------------------+----------------------+----------------------+ | Disadvantages | This solution | This solution | | | requires | requires UP function | | | provisioning of the | to have a separate | | | mappings in SMF and | logic other than | | | in UPF. | existing one which | | | | is using a single | | | This solution | parameter Network | | | requires the | Instance, to | | | operators to assign | allocate or manage | | | a distinct Network | the user plane | | | Instance ID for | resource, it leads | | | every network slice, | extra complexities. | | | which increase the | | | | provisioning effort | | | | in SMF and UPF. | | +----------------------+----------------------+----------------------+
### 7.1.2 Conclusions
The following conclusions are agreed:
\- Solution #3 is already supported in the existing standard and has no
standard impact on UPF and SMF, but in the scenario where UPF supports
multiple slices sharing, it needs the SMF to map the S-NSSAI to a specific NI
and require additional configuration.
\- Solution #9 and solution #13 provides the flexibility to fulfil the various
requirements for the scenario without changing the mapping of Network Instance
in SMF and can manage UPF resources at per slice level in a straightforward
way, but UPF implementation shall have a logic/configuration to select
resources using S-NSSAI together with Network Instance. In addition, solution
#13 supports per slice UP resource usage report with minimal impact on SMF.
Since both solutions can fulfil the scenario where UPF supports for multiple
slices, and they can be used to manage UPF resources at different level in the
various cases, it is concluded that solution #3 which relates to the solution
defined in the current specification shall be supported. In addition, solution
#9 and solution #13 may be supported to support the operator\'s requirement in
various business scenarios.
Solution #9 and solution #13 will be standardized in 3GPP Rel-17 as a possible
alternative optional solution to the existing solution#3.
## 7.2 Evaluation and Conclusions of Solutions for Key Issue #2
### 7.2.1 Evaluation
The Key Issue #2 \"Header Enrichment for HTTPS\" as described in clause 5.3
studies how to support the requirement of header enrichment when HTTPS scheme
is used.
SA3 commented that solution #1 \"Header Enrichment for HTTPS\" as described in
clause 6.1 has potential issues on the security aspect (see LS from SA3 in
S3-214505).
### 7.2.2 Conclusions
Based on the discussion in CT4#108-E meeting, no solution will be standardized
for the key issue #2.
## 7.3 Evaluation and Conclusions of Solutions for Key Issue #3
### 7.3.1 Evaluation
A large and ever-growing list of PFCP features have been specified since 3GPP
Rel-14, which causes potential deviations between CP function and UP function
implementations from different vendors and potential risks of interoperability
issues.
Table 7.3.1-1 summarizes the solutions that have been proposed regarding
specific technical options.
Table 7.3.1-1: Evaluation for Key Issue #3
+----------------------+----------------------+----------------------+ | Feature | Solutions | | +======================+======================+======================+ | | Solution Number | Solution Overview | +----------------------+----------------------+----------------------+ | | | | +----------------------+----------------------+----------------------+ | End Marker: packets | #5 (see clause 6.5) | Rel-17 onwards UPF | | generation by CP or | | shall support | | UP function (KI#3a) | | constructing End | | | | Marker packets. | | | | | | | | It is recommended to | | | | construct End Marker | | | | packets in the UPF | | | | as the preferred | | | | option. | +----------------------+----------------------+----------------------+ | UE IP address | No supplementary | Keep existing | | allocation mode: by | solution to existing | mechanism defined in | | CP or UP function | mechanism defined in | 3 | | (KI#3b) | 3GPP TS 29.244 [3] | GPP TS 29.244 [3]. | | | identified during | | | | the study. | | +----------------------+----------------------+----------------------+ | Downlink data | #4 (see clause 6.4) | Downlink data should | | buffering in CP or | | be buffered | | UP function (KI#3c) | | preferably in the UP | | | | function. | | | | | | | | Downlink data may be | | | | buffered in CP | | | | function when needed | | | | e.g. for Ues using | | | | power saving methods | | | | or when using | | | | Control Plane CioT | | | | 5GS Optimisation. | +----------------------+----------------------+----------------------+ | Traffic redirection | #6 (see clause 6.6) | Traffic redirection | | enforcement in CP or | | shall be enforced in | | UP function (KI#3d) | | the UP function. | | | | | | | | The option to | | | | enforce traffic | | | | redirection in the | | | | CP function in EPC | | | | will be removed from | | | | 3GPP Rel-17 onwards. | +----------------------+----------------------+----------------------+ | PDI optimization: | #7 (see clause 6.7) | 3GPP Rel-17 onwards | | Identify whether the | | CP and UP functions | | support of certain | | should support the | | features could be | | PDI Optimization | | recommended or | | feature. | | mandated for NFs | | | | complying with 3GPP | | | | Release 17 (KI#3e) | | | +----------------------+----------------------+----------------------+
### 7.3.2 Conclusions
The following conclusions are agreed:
\- End Marker packets generation: solution #5 is agreed.
\- UE IP address allocation mode: keep existing mechanism defined in 3GPP TS
29.244 [3].
\- Downlink data buffering: solution #4 is agreed.
\- Traffic redirection enforcement: solution #6 is agreed
\- PDI Optimization feature: solution #7 is agreed.
## 7.4 Evaluation and conclusions of solutions for key issue #4
### 7.4.1 Evaluation
Candidate solution #2, solution #11 and solution#12 have been proposed for Key
Issue #4 -- \"Avoidance of conflict between UE IP address/prefix allocated by
SMF(s)\". The candidate solutions provide different mechanisms to avoid the UE
IP address/prefix allocation by SMF in SMF set.
Within solution #2, two solutions are proposed in case SMF added/removed
to/from SMF set.
Table 7.4.1-1: Evaluation for Key Issue #4
+---------------+---------------+---------------+---------------+---+ | Analysis | Solution | | | | | | Overview | | | | +===============+===============+===============+===============+===+ | | Solution #2 | Solution #11 | Solution #12 | | +---------------+---------------+---------------+---------------+---+ | | Local | directly | | | | | configuration | controlled by | | | | | | external | | | | | | entity | | | +---------------+---------------+---------------+---------------+---+ | Enclosing | SMFs in the | SMFs in the | SMFs in the | | | scope | same SMF set | same SMF set | same SMF set | | | | | or different | | | | | | SMF sets. | | | +---------------+---------------+---------------+---------------+---+ | Impact(Inter | It requires a | No | No | | | SMFs) | new interface | requirement. | requirement. | | | | between SMFs | | | | | | in SMF set. | | | | | | | | | | | | It requires | | | | | | lots of inter | | | | | | SMF signaling | | | | | | within SMF | | | | | | set. | | | | +---------------+---------------+---------------+---------------+---+ | Im | No | It requires | It requires | | | pact(External | requirement. | an OAM or | the | | | Server) | | external | deployment of | | | | | entity to | DHCP and AAA | | | | | re-assign the | servers in | | | | | UE IP | the 5GC for | | | | | a | UE IP address | | | | | ddress/prefix | allocations | | | | | in case SMF | and the | | | | | added/removed | signalling | | | | | to/from SMF | interactions | | | | | set. | between SMFs | | | | | | and the DHCP | | | | | | or AAA server | | | | | | during PDU | | | | | | session | | | | | | e | | | | | | stablishments | | | | | | and release, | | | | | | and possibly | | | | | | during UE IP | | | | | | address | | | | | | renewal, | | | | | | which | | | | | | introduce | | | | | | slight | | | | | | latency. | | +---------------+---------------+---------------+---------------+---+ | Impact (IP | It requires | No IP | Same as | | | partitioning) | an OAM or | partitioning | Solution#2 | | | | external | required | | | | | entity (e.g. | within SMF | | | | | Operator\'s | set. | | | | | IP planner) | | | | | | to decide the | | | | | | IP addresses | | | | | | partitioning | | | | | | between the | | | | | | SMFs of an | | | | | | SMF set. | | | | +---------------+---------------+---------------+---------------+---+ | UE IP address | From the | The UE IP | Same as | | | planning and | operator | addresses are | Solution#2 | | | usage ratio | point of | configured | | | | | view, the | centrally in | | | | | available UE | DHCP or AAA | | | | | IP | server, and | | | | | add | assigned | | | | | resses/prefix | consistently | | | | | for each SMF | to all SMFs | | | | | can be | without | | | | | contiguous | collisions of | | | | | and well | UE IP address | | | | | planned. | allocation; | | | | | | | | | | | During SMF | Central | | | | | failure or | configuration | | | | | restart, some | and | | | | | UE IP | allocation of | | | | | addresses | UE IP | | | | | might not be | addresses | | | | | used by other | allow | | | | | SMFs since | monitoring | | | | | the UE IP | (e.g. KPIs) | | | | | addresses are | of the usage | | | | | statically | of IP | | | | | allocated to | addresses in | | | | | each SMF | the SMF set. | | | | | within SMF | | | | | | set. This is | | | | | | caused by | | | | | | static | | | | | | allocation | | | | | | (Local | | | | | | configuration | | | | | | solution) or | | | | | | transient | | | | | | period during | | | | | | OAM | | | | | | re-assignment | | | | | | (Directly | | | | | | controlled by | | | | | | external | | | | | | entity | | | | | | solution). | | | | +---------------+---------------+---------------+---------------+---+ | Impact | It requires | It requires | It requires | | | (SMF/SMF Set | each SMF in | the SMF acts | each SMF in | | | logical | SMF set | as a | SMF set | | | processing) | records the | DHCP/RADIUS | records the | | | | whole UE IP | (or DIAMETER) | whole UE IP | | | | a | client | a | | | | ddress/prefix | towards the | ddress/prefix | | | | table and the | DHCP/AAA | table and the | | | | IP usage | server which | IP usage | | | | indication | is the same | indication | | | | for each | behaviour as | for each | | | | ad | already | ad | | | | dress/prefix. | defined for | dress/prefix. | | | | | SMF (from | | | | | It requires | Rel-15 | It requires | | | | high | onwards). It | SMF to check | | | | reliability | reuses the | the shared | | | | for message | same UE IP | context data | | | | exchange | address | in different | | | | between SMFs | allocation as | cases. E.g. | | | | since any | already | SMF restart, | | | | failure (e.g. | supported for | SMF added or | | | | transient | UE IP address | removed from | | | | communication | allocation by | the set, IP | | | | failure | a DN-AAA. | re-assigned | | | | between 2 | | to the target | | | | SMFs, SMF | It requires | SMF. | | | | overload) can | the target | | | | | result in | SMF to check | It requires | | | | SMFs getting | the IP lease | the IP | | | | out of | time in | addresses | | | | sy | shared | allocation/ | | | | nchronization | context data | re-allocation | | | | with regard | for the PDU | when SMF is | | | | to IP | session which | added or | | | | addresses | is switched | removed from | | | | usage. | to this SMF. | the set. | | | | | And it | | | | | It requires | requires the | | | | | the IP | SMF to | | | | | addresses | initiate a | | | | | allocation/ | AAA | | | | | re-allocation | re- | | | | | when SMF is | authorization | | | | | added or | to renew the | | | | | removed from | IP | | | | | the set and | ad | | | | | also, it | dress(keeping | | | | | requires | the IP | | | | | advertisement | address | | | | | of releasing | upchanged) | | | | | IP addresses | when the | | | | | owned by a | lease time is | | | | | different SMF | approaching | | | | | of the SMF | expiry. | | | | | set. | | | | +---------------+---------------+---------------+---------------+---+
According to the evaluation table above, a brief evaluation for each solution
is list as below:
The solution #2 covered SMFs in the same SMF set and it requires a new
interface and lots of inter SMF signaling between SMFs in SMF set.
The solution #11 have covered SMFs in the same SMF set or different SMF sets
and it re-use the same IP allocation as already supported by DN-AAA. To avoid
the IP expiry, it requires the target SMF to check the IP lease time in shared
context data for the PDU session which is switched to this SMF. This solution
has re-used the current IP allocation mechanism with a few tweaks.
The solution #12 covered SMFs in the same SMF set and it re-use the
information in shared context data. But it requires the IP re-allocation when
SMF is added or removed and it may cause the SMF periodically checked the
shared context data for synchronization.
### 7.4.2 Conclusions
Solution#11 is adopted for KI#4. The following work is needed during the
normative phase:
\- The normative requirements related to this capability in CP function will
be specified in 3GPP TS 29.244 [3] based the clauses 5.21.1.
\- The major part of the IP allocation mechanism in solution #11 is already
supported. But with the special session handling in SMF set, e.g. PDU session
can be taken over by a different SMF during the lifetime of the PDU session,
there are some different requirements compared to the existing DHCP/AAA
procesures. Therefore, such information should be standardized in 3GPP TS
29.244 [3] clauses 5.21.2 based on the solution#11 as described in clause
6.11.1.
## 7.5 Evaluation and Conclusions of Solutions for Key Issue #5
### 7.5.1 Evaluation
The Key Issue #5 \"L2TP Tunnelling over SGi/N6\" as described in clause 5.6.
studies how to provide a solution to support L2TP, which is a common
technology widely deployed in operator\'s network and used e.g. by POS/ATM
machine to establish secured connection with its server, when CUPS (Control
Plane and User Plane Separation) is deployed.
One of potential alternative that the CP function is served as a LAC (L2TP
Access Concentrator) to establish L2TP tunnel with a LNS (L2TP Access
Concentrator) has been discussed but quickly abandoned since the solution will
force user plane path goes via control plane, which breaks the fundamentals of
CUPS.
Solution #8 \"L2TP Access Concentrator\" as described in clause 6.8 has
covered all aspects as defined in the key issue, therefore it is considered as
suitable solution.
### 7.5.2 Conclusions
The following conclusions are agreed:
\- the PFCP protocol extensions to support L2TP tunneling over N6/SGi for
5GC/EPS is to be standardized based on the solution#8 as described in 6.8 in
Rel-17.
\- The normative requirements related to transfer L2TP Tunnel Information and
L2TP Session Information from the CP function to the UP function together with
a short description of L2TP function is to be specified in 3GPP TS 29.244 [3]
based the clauses 6.8.1, 6.8.2 and 6.8.3.
\- Existing NDS/IP security mechanism (as specified in 3GPP TS 33.210 [10])
shall be used, if the information transferred from the CP function to the UP
function needs to be protected.
#
# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
The present document identifies impacts to services offered to subscribers
served by 5GC in case profiles at UDR are corrupted, lost, or became
inconsistent, and addresses how the impact can be minimized. The document will
focus on the following aspects:
\- Clarify the necessity on defining procedures for 5GC to allow NFs, e.g.
AMF, SMF, SMSF, NEF, PCF, AUSF to trigger correction and synchronization of
temporary data within the UDR in case any corruption, loss, or inconsistency
of data in UDR takes place, along with how NFs detect such case;
\- Whether similar issue needs to be addressed between other NFs;
\- Provide candidate solution(s) to solve the issue; and
\- Evaluate the candidate solution(s) and recommend any changes to
specifications if identified.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TR 23.527: \"5G System; Restoration procedures\".
[3] 3GPP TS 29.002: \"Mobile Application Part (MAP) specification\".
[4] 3GPP TS 29.272: \"Evolved Packet System (EPS); Mobility Management Entity
(MME) and Serving GPRS Support Node (SGSN) related interfaces based on
Diameter protocol\".
[5] 3GPP TR 29.519: \"5G System; Usage of the Unified Data Repository Service
for Policy Data, Application Data and Structured Data for Exposure; Stage 3\".
# 3 Definitions of terms, symbols and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in 3GPP TR 21.905
[1] and the following apply. A term defined in the present document takes
precedence over the definition of the same term, if any, in 3GPP TR 21.905
[1].
**example:** text used to clarify abstract rules by applying them literally.
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
\ \
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
\ \
# 4 Architectural Requirements and Assumptions
## 4.1 Architectural Requirements
Temporary data stored in UDR (i.e. data that are not subject to provisioning
at the UDR) are automatically updated in normal operation; the main
information is:
\- the identities of NFs (AMF, SMF, SMSF, AUSF) that are registered at the UDM
and related data,
\- Callback information and related data needed by the UDM to send appropriate
notifications,
\- data related to external provisioning,
\- other temporary data (e.g. policy data) are ffs.
The loss or corruption of these information seriously degrades the service
offered to subscribers.
5GC shall ensure the following:
\- The impact to user experience due to corruption of profiles stored at UDR
shall be avoided;
\- Burst signaling due to restoration of profiles shall be minimal.
\- All communication between UDR and serving NFs, e.g. AMF, SMF and SMSF, AUSF
are always via UDM.
\- Serving NFs shall be made aware when there is a potential inconsistency of
profiles with UDR and the profiles within themselves.
## 4.2 Architectural Assumptions
With the current specification of 5GC, there are following assumptions:
\- In case the profile in the UDR is corrupted, it is not obvious whether the
profile can be restored to the most recent status.
\- In case the profile cannot be restored to the most recent status, there are
situations where impact to user experience cannot be avoided.
The following table shows where the impact is foreseen.
Table 4.2-1: Impacts related to each NF when profiles at UDR are corrupted
+------+-------------------+-------------------+-------------------+ | | **NF\'s |** Subscription to | **Subscription to | | | registration | notifications of | notifications of | | | information** | subscriber data | policy update**| | | | change** | | +======+===================+===================+===================+ | AMF | Failure of MT | UDM subscriber | PCF policy | | | voice call may | data changed by | updated by e.g. | | | take place, when | e.g. operator | operator or via | | | T-ADS is used. | cannot be | NEF cannot be | | | | reflected in AMF, | reflected in AMF | | | Failure of | SMF, and SMSF, | and SMF, | | | 5GC-MT-LR may | respectively, and | respectively, and | | | take place | for actual | for actual | | | | service | service | | | | condition. | condition. | +------+-------------------+-------------------+-------------------+ | SMF | | | | +------+-------------------+-------------------+-------------------+ | SMSF | Failure of SMS MT | | N/A | | | may take place | | | +------+-------------------+-------------------+-------------------+ | AUSF | Failure of SoR | N/A | N/A | | | and UPU | | | | | procedures may | | | | | take place | | | +------+-------------------+-------------------+-------------------+
Editor\'s note: The table above requires update, e.g. on SMF impact for NF\'s
registration information.
# 5 Key Issues
## 5.1 Key Issue #1: Restoration of profile with AMF, SMF, SMSF and AUSF
It is assumed that profiles stored in AMF, SMF, and SMSF can be deviated in
case profiles stored in UDR is corrupted, or UDR may lose AUSF information
holding latest KAUSF.
This key issue will study the following aspects:
\- Consider scenarios (if any) where UDR data corruption takes place, and
profiles in UDR and those in AMF, SMF, and SMSF require synchronization.
Clarify which profile is mentioned.
NOTE: The corruption of UDR data can happen on various occasion that could
include data migration of UDR, however the key issue will not limit the reason
for the corruption.
\- Whether existing mechanisms (e.g. those specified in 3GPP TS 23.527 [2])
suffice or whether there are gaps to be addressed which could lead to
improvements compared to existing solutions.
\- Which NF and how that NF determines the synchronization is needed for the
scenarios described above.
\- Which NF and how that NF determines which data in an AMF, SMF, and SMSF
needs to be synchronized for the scenarios described above.
\- How the synchronization is achieved for those data in the AMF, SMF, and
SMSF, so that subscribers do not feel service degradation and signalling
congestion in 5GS does not occur.
\- How the details AUSF instance holding latest KAUSF is synchronized into
UDM/UDR so that HPLMN continues to have ability to send SoR and UPU
information to the UEs.
## 5.2 Key Issue #2: Restoration of profile with PCF
It is assumed that PCF will require notification from UDR in case UDR has
recovered from corruption, which could require explicit procedures to be
conducted by PCF.
This key issue will study how PCF as a NF consumer of UDR receives
notification regarding the recovery from corruption of UDR, along with the
information to be sent in the notification.
NOTE: The behavior of PCF, i.e. procedures upon receiving notification of UDR
recovery, is outside the scope of this study.
## 5.3 Key Issue #3: Restoration of profile with NEF
It is assumed that NEF will require notification from UDR in case UDR has
recovered from corruption, which could require explicit procedures to be
conducted by NEF.
This key issue will study how NEF as a NF consumer of UDR receives
notification regarding the recovery from corruption of NEF, along with the
information to be sent in the notification.
NOTE: The behavior of NEF, i.e. procedures upon receiving notification of UDR
recovery, is outside the scope of this study.
## 5.4 Key Issue #4: Granularity of Data
When the UDR detects potential loss or corruption of temporary data, it may
determine that the detected loss/corruption is limited to one or more specific
parts of its data (e.g. only SMSF registration data for an identified range of
UEs are impacted). This key issue will study the following aspects:
\- How can impacted parts of the UDR\'s temporary data be identified.
\- How can restoration procedures be limited to the identified parts (so that
non-corrupted parts are not unnecessarily restored).
## 5.5 Key Issue #5: **Handling Nudm_UECM without Authentication Status**
During Restart, UDR might have also lost UE\'s authentication status in the
serving network, apart from UECM data. Without this information, when AMFs
perform Nudm_UECM_Registration due to UDR Restart notification, UDM cannot
verify if UE is authenticated in the serving network, and hence cannot link
the Authentication confirmation to Nudm_UECM_Registration from AMF, as
specified in 3GPP TS 33.501 Clause 6.1.4. Therefore, UDM will reject the
Nudm_UECM_Registration request from the AMF.
This key issue will study the following aspects:
\- How and if UE\'s authentication status should be recovered.
\- How and if UDM can accept Nudm_UECM_Registration after losing UE\'s
Authentication Status during UDR Restart.
## 5.6 Key Issue #6: Notification Path
When the UDR detects potential loss or corruption of temporary data, consumers
of UDR consumers (e.g. consumers of the UDM) need to be notified. Consumers of
UDR consumers (e.g. the AMF) may not be aware of UDR existence and may be
outside the UDR\'s PLMN. This key issue will study the following aspects:
\- How can consumers of UDR consumers be agnostic of UDR existence.
\- Which NFs and services should belong to the notification path between UDR
and consumers of UDR consumers.
# 6 Solutions
## 6.1 Solution#1: Restoration for AMF
### 6.1.1 Description
This solution addresses key issue#1 and allows a graceful restoration (i.e.
signaling load for restoration is spread), which is not possible with existing
specification.
UDR or UDM triggers restoration. AMF identifies synchronization targets (w.r.t
UE). Synchronization timings are spread depending on UE\'s access to the
network.
This solution is described for two options. Option A corresponds to the case
where UDR is visible to AMF/SMF/SMSF. Option B corresponds to the case where
UDR is not visible to AMF/SMF/SMSF.
### 6.1.2 Procedures
#### 6.1.2.1 Restoration Indicator in AMF
A restoration indicator is provided in AMF for each SUPI record: \"Location
Information Confirmed (or Not Confirmed) in UDR\". This indicator is
associated with the registration time and an NF instance Id of UDR (only for
Option A), and indicates whether the UDR\'s record of the AMF address for the
UE is confirmed by the radio contact.
The indicator shall be set to \"Not Confirmed\" at any of the following
events:
\- The AMF receives a Registration request for an UE for which the AMF has no
SUPI record;
\- The AMF knows the associated UDR instance with which the UE is registered
failed and restarted.
The indicator shall be set to \"Confirmed\" at the following event:
\- Successful completion of Nudm_UECM_Registration via UDM to UDR.
#### 6.1.2.2 Registration of AMF to UDR
**Option A**
NFProfiles of UDRs contain supiRanges. By receiving NFProfiles of UDRs from
NRF, AMF ensures to have linkage of SUPI and the NF Instance ID of UDR that is
supposed to store the SUPI\'s registration information. When AMF performs
Nudm_UECM_Registration, the AMF stores association between SUPI, the UDR
Instance ID, the registration time, and an indicator \"Location Information
Confirmed in UDR\".
**Option B**
When AMF performs Nudm_UECM_Registration, the AMF stores association between
SUPI, the registration time, and an indicator \"Location Information Confirmed
in UDR\".
#### 6.1.2.3 Restart of UDR
**Option A**
When the UDR fails and restarts after reloading data from its back-up, the UDR
sends Nnrf_NFManagement_NFUpdate to NRF, setting the recovery time. Triggered
by the change of the recovery time, the NRF sends
Nnrf_NFManagement_NFStatusNotify to AMFs to notify the status of this
restarted UDR. This causes each AMF to mark \"Location Information Not
Confirmed in UDR\" for each UE context, if the UE context is associated with
this restarted UDR and if the UE context has stored a registration time
indicating the AMF registered to the UDR before the recovery time.
**Option B**
When the UDR fails and restarts after reloading data from its back-up, UDMs
associated with this restarted UDR recognize it in an implementation-specific
manner. The UDMs send Nnrf_NFManagement_NFUpdate to NRF, setting the \"partial
recovery time\" together with supiRanges that are impacted. Triggered by the
change of the partial recovery time, the NRF sends
Nnrf_NFManagement_NFStatusNotify to AMFs to notify the status of UDMs impacted
by this restarted UDR. This causes each AMF to mark \"Location Information Not
Confirmed in UDR\" for each UE context, if SUPI in the UE context belongs to
the supiRanges and if the UE context has stored a registration time indicating
the AMF registered to the UDM before the partial recovery time.
#### 6.1.2.4 Procedure in AMF during Restoration
At the Registration procedure or after detection of any activity (either
signalling or data) for a marked UE, the AMF performs Nudm_UECM_Registration
via UDM to UDR. Optionally the AMF further performs Nudm_SDM_Get and
Nudm_SDM_Subscribe via UDM to UDR and Npcf_AMPolicyControl_Create and
Npcf_UEPolicyControl_Create via PCR to UDR. Those operations may be delayed by
the AMF for a maximum operator-configuration-depending time period to avoid
high signalling load.
### 6.1.3 Impacts on services, entities and interfaces
**Option A**
AMF: Internal logic is impacted.
**Option B**
AMF: Internal logic is impacted.
UDM: \"partial recovery time\" together with supiRanges is added in NFProfile
of UDM.
UDM, UDR: Implementation-specific message(s) between UDM and UDR for UDM to
recognize restart of UDR is assumed.
## 6.2 Solution #2: Restoration for AMF and SMF with event exposure
### 6.2.1 Description
This solution addresses key issue#1 and key issue#2, and allows a graceful
restoration (i.e. signaling load for restoration is spread), which is not
possible with existing specification. This solution is a superset of
Solution#1. A new event exposure from AMF to SMF is required.
UDR or UDM triggers restoration. AMF identifies synchronization targets (w.r.t
UE). AMF triggers restoration for SMF. Synchronization timings are spread
depending on UE\'s access to the network. Synchronization timings for AMF and
for SMF for a particular UE are the same.
This solution is described for two options. Option A corresponds to the case
where UDR is visible to AMF/SMF/SMSF. Option B corresponds to the case where
UDR is not visible to AMF/SMF/SMSF.
### 6.2.2 Procedures
#### 6.2.2.1 Restoration Indicator in AMF
The same as in clause 6.1.2.1.
#### 6.2.2.2 Event Exposure from AMF
An event exposure service is provided by AMF to NF consumers that have
subscribed for the event \"UDR-Restoration-Required\". This event is detected
when the AMF has performed Nudm_UECM_Registration triggered by the indicator
\"Location Information Not Confirmed in UDR\" in the SUPI record.
#### 6.2.2.3 Registration of AMF to UDR
The same as in clause 6.1.2.2.
#### 6.2.2.4 Registration of SMF to UDR
When SMF performs Nudm_UECM_Registration, the SMF in parallel subscribes to
the AMF to be notified of the event \"UDR-Restoration-Required\". The AMF
stores the NF consumer that subscribes for the event and the arrival time of
the subscription in each UE context.
#### 6.2.2.5 Restart of UDR
The same as clause 6.1.2.3, except for the following.
Instead of the condition \"if the UE context has stored a registration time
indicating the AMF registered to the UDR/UDM before the (partial) recovery
time\", the following condition applies \"if the UE context has stored a
registration time and subscription arrival time(s) indicating at least one of
the AMF and the SMF(s) registered to the UDR/UDM before the (partial) recovery
time\".
#### 6.2.2.6 Procedure in AMF and SMF during Restoration
At the Registration procedure or after detection of any activity (either
signalling or data) for a marked UE, the AMF performs Nudm_UECM_Registration
via UDM to UDR. The AMF invokes Namf_EventExposure_Notify to provide the event
UDR-Restoration-Required to NF consumers (i.e. SMF(s)) that have subscribed
for the event. Optionally the AMF further performs Nudm_SDM_Get and
Nudm_SDM_Subscribe via UDM to UDR and Npcf_AMPolicyControl_Create and
Npcf_UEPolicyControl_Create via PCR to UDR. Those operations may be delayed by
the AMF for a maximum operator-configuration-depending time period to avoid
high signalling load.
Upon receiving the notification of the event, the SMF performs
Nudm_UECM_Registration via UDM to UDR. Optionally the SMF further performs
Nudm_SDM_Get and Nudm_SDM_Subscribe via UDM to UDR and
Npcf_SMPolicyControl_Create via PCR to UDR. Those operations may be delayed by
the SMF for a maximum operator-configuration-depending time period to avoid
high signalling load.
### 6.2.3 Impacts on services, entities and interfaces
Option A
AMF: Internal logic is impacted. A new event exposure is required.
SMF: Internal logic is impacted. A new subscription capability to a new event
exposure provided by AMF is required.
Option B
AMF: Internal logic is impacted. A new event exposure is required.
SMF: Internal logic is impacted. A new subscription capability to a new event
exposure provided by AMF is required.
UDM: \"partial recovery time\" together with supiRanges is added in NFProfile
of UDM.
UDM, UDR: Implementation-specific message(s) between UDM and UDR for UDM to
recognize restart of UDR is assumed.
## 6.3 Solution #3: Restoration for AMF and SMSF with event exposure
### 6.3.1 Description
This solution addresses key issue#1 and key issue3, and allows a graceful
restoration (i.e. signaling load for restoration is spread), which is not
possible with existing specification. This solution is a superset of
Solution#1. A new event exposure, which is the same as in clause 6.2, from AMF
to SMF is required.
UDR or UDM triggers restoration. AMF identifies synchronization targets (w.r.t
UE). AMF triggers restoration for SMSF. Synchronization timings are spread
depending on UE\'s access to the network. Synchronization timings for AMF and
for SMSF for a particular UE are the same.
This solution is described for two options. Option A corresponds to the case
where UDR is visible to AMF/SMF/SMSF. Option B corresponds to the case where
UDR is not visible to AMF/SMF/SMSF.
### 6.3.2 Procedures
#### 6.3.2.1 Restoration Indicator in AMF
The same as in clause 6.1.2.1.
#### 6.3.2.2 Event Exposure from AMF
The same as in clause 6.2.2.2.
#### 6.3.2.3 Registration of AMF to UDR
The same as in clause 6.1.2.2.
#### 6.3.2.4 Registration of SMSF to UDR
The same as clause 6.2.2.4, except that SMF is to be replaced with SMSF.
#### 6.3.2.5 Restart of UDR
The same as clause 6.2.2.5, except that SMF is to be replaced with SMSF.
#### 6.3.2.6 Procedure in AMF and SMSF during Restoration
At the Registration procedure or after detection of any activity (either
signalling or data) for a marked UE, the AMF performs Nudm_UECM_Registration
via UDM to UDR. The AMF invokes Namf_EventExposure_Notify to provide the event
UDR-Restoration-Required to NF consumers (i.e. SMSF) that have subscribed for
the event. Optionally the AMF further performs Nudm_SDM_Get and
Nudm_SDM_Subscribe via UDM to UDR and Npcf_AMPolicyControl_Create and
Npcf_UEPolicyControl_Create via PCR to UDR. Those operations may be delayed by
the AMF for a maximum operator-configuration-depending time period to avoid
high signalling load.
Upon receiving the notification of the event, the SMSF performs
Nudm_UECM_Registration and optionally Nudm_SDM_Get and Nudm_SDM_Subscribe via
UDM to UDR. Those operations may be delayed by the SMSF for a maximum
operator-configuration-depending time period to avoid high signalling load.
### 6.3.3 Impacts on services, entities and interfaces
The same as clause 6.2.3, except that SMF is to be replaced with SMSF.
## 6.4 Solution #4: Restoration for AMF and SMSF without event exposure
### 6.4.1 Description
This solution addresses key issue#1 and key issue3, and allows a graceful
restoration (i.e. signaling load for restoration is spread), which is not
possible with existing specification. This solution is a superset of
Solution#1. A new information element in a message from AMF to SMSF is
required.
UDR or UDM triggers restoration. AMF identifies synchronization targets (w.r.t
UE). AMF triggers restoration for SMSF. Synchronization timings are spread
depending on UE\'s access to the network. Synchronization timings for AMF and
for SMSF for a particular UE are the same.
This solution is described for two options. Option A corresponds to the case
where UDR is visible to AMF/SMF/SMSF. Option B corresponds to the case where
UDR is not visible to AMF/SMF/SMSF.
### 6.4.2 Procedures
#### 6.4.2.1 Restoration Indicator in AMF
The same as in clause 6.1.2.1.
#### 6.4.2.2 Registration of AMF to UDR
The same as in clause 6.1.2.2.
#### 6.4.2.3 Restart of UDR
The same as in clause 6.1.2.3.
#### 6.4.2.4 Procedure in AMF and SMSF during Restoration
At the Registration procedure or after detection of any activity (either
signalling or data) for a marked UE, the AMF performs Nudm_UECM_Registration
via UDM to UDR. Optionally the AMF further performs Nudm_SDM_Get and
Nudm_SDM_Subscribe via UDM to UDR and Npcf_AMPolicyControl_Create and
Npcf_UEPolicyControl_Create via PCR to UDR. Those operations may be delayed by
the AMF for a maximum operator-configuration-depending time period to avoid
high signalling load.
The AMF sends Nsmsf_SMService_Activate request to SMSF, including an
indication to request the SMSF to assist restoration of UDR.
Triggered by the indication that requests assistance to UDR restoration, the
SMSF performs Nudm_UECM_Registration and optionally Nudm_SDM_Get and
Nudm_SDM_Subscribe via UDM to UDR. Those operations may be delayed by the SMSF
for a maximum operator-configuration-depending time period to avoid high
signalling load.
### 6.4.3 Impacts on services, entities and interfaces
Option A
AMF, SMSF: Internal logic is impacted. Nsmsf_SMService_Activate request has a
new information element.
Option B
AMF, SMSF: Internal logic is impacted. Nsmsf_SMService_Activate request has a
new information element.
UDM: \"partial recovery time\" together with supiRanges is added in NFProfile
of UDM.
UDM, UDR: Implementation-specific message(s) between UDM and UDR for UDM to
recognize restart of UDR is assumed.
## 6.5 Solution#5: \ Propagate the change of the UDR NF status using
direct signalling between UDM and NFs
### 6.5.1 Introduction
This solution is to address Key Issue #1.
This solution defines a mechanisms where the UDR can indicate the detected
information that may introduce the corruption, inconsistency, loss of data to
the NFs (e.g. AMF/SMF/SMSF) using direct signalling between UDM and NFs when
the UDR detects that the corruption, loss or inconsistency of data may happen
because of some scenarios (e.g. the UDR fails and restarts, or migration of
the data from old UDR to new UDR etc), and AMF/SMF/SMSF can decide to do the
data synchronization based on these information.
### 6.5.2 Functional Description
When the UDR detects that the corruption, loss or inconsistency of data may
happen because of some scenarios (e.g. the UDR fails and restarts, or
migration of the data from old UDR to new UDR etc), the UDR invokes the
Nnrf_NFManage_NFUpdate to update the UDR NF profile accordingly,
Nnrf_NFManage_NFUpdate request is extended to include a partial update
indicator, if only a part of users are impacted (e.g. a part of users are
migrated from the old UDR to the new UDR), the partial update indicator set to
true.
When the NRF receives the Nnrf_NFManage_NFUpdate request from the UDR, the NRF
shall notify the UDM of the changes if the UDM subscribed to the
NFStatusNotify of this UDR, the NRF also include the received partial update
indicator in the notification, but NRF won\'t store the partial update
indicator as part of UDR NF profile.
When the UDM receives Nnrf_NFManage_NFStatusNotify, if partial update
indicator is received in the request and set to true, the UDM shall compare
the received NF status data with the UDR NF profile locally stored, and then
recognize out which data is changed. If the recovery time is changed, the UDM
will store received recovery time and user identifier ranges (e.g. SUPI ranges
and/or GPSI ranges) whose profile data is available in this UDR, if the user
identifier ranges that are available in the UDR are changed, the UDM will
recognize which user identifier ranges are changed (e.g. which user data
ranges are removed and which are added) and store the changed user identifier
ranges.
After above operation, when the UDM receives the first new request from the NF
service consumers (e.g. AMF/SMSF/SMF/NEF), the UDM may include the UDR
recovery indication, the recovery time of the UDR, the impacted user
identifier ranges (e.g. SUPI ranges) in a response header to NF service
consumers, the NF service consumers may trigger data synchronization operation
related to the users indicated in the response (e.g. AMF updates the
registration and get the UE subscription via UDM again) according to local
policy.
### 6.5.3 Procedures
Figure 6.5.3-1: Procedure for Partial update indication using direct
signalling between NFs
1\. The UDR detects that the corruption, loss or inconsistency of data may
happen because of some scenarios (e.g. the UDR fails and restarts, or
migration of the data from old UDR to new UDR etc).
2\. The UDR sends Nnrf_NFManagement_NFUpdate request to NRF, the request
includes the updated NF profile and optional the partial update indicator, the
NRF returns the response to the UDR.
3\. When the NRF receives the Nnrf_NFManage_NFUpdate request from the UDR, the
NRF shall notify the UDM of the changes if the UDM subscribed to the
NFStatusNotify of this UDR, the NRF also include the received partial update
indicator in the notification, but NRF won\'t store the partial update
indicator as part of UDR NF profile.
4\. When the UDM receives Nnrf_NFManage_NFStatusNotify, if partial update
indicator is received in the request and set to true, the UDM shall compare
the received NF status data with the UDR NF profile locally stored, and then
recognize out which data is changed. If the recovery time is changed, the UDM
will store received recovery time and user identifier ranges (e.g. SUPI ranges
and/or GPSI ranges) whose profile data is available in this UDR, if the user
identifier ranges that are available in the UDR are changed, the UDM will
recognize which user identifier ranges are changed (e.g. which user data
ranges are removed and which are added) and store the changed user identifier
ranges.
5\. After step 4, when the UDM receives the first new request (any request for
any user) from the NF service consumers (e.g. AMF/SMSF/SMF/NEF), the UDM may
include the UDR recovery indication, the recovery time of the UDR, the
impacted user identifier ranges (e.g. SUPI ranges) in a response header to NF
service consumers.
6\. The NF service consumers may trigger data synchronization operation
related to the users indicated in the response (e.g. AMF updates the
registration and get the UE subscription via UDM again) according to local
policy.
### 6.5.4 Impacts on services, entities and interfaces
UDM:
\- Support receiving partial update indicator in the
Nnrf_NFManagement_NFUpdate service operation, and to recognize the impacted NF
status data and store them.
\- Support indicating the recognized the UDR status data to NF service
consumer in the HTTP header which is piggybacked in any response message.
UDR:
\- Support indicating partial update indicator in the
Nnrf_NFManagement_NFUpdate service operation.
NRF:
\- Support indicating partial update indicator in the
Nnrf_NFManagement_NFUpdate service operation and Notify the partial update
indicator to the NFs which subscribed to the notify.
AMF/SMF/SMSF/NEF:
\- Support receiving the UDR status data indicated by the UDM in HTTP header
in response messageand triggering the operations related to the data
synchronization for impacted users.
## 6.6 Solution#6: \ Propagate the change of the UDR NF status via NRF
and UDM
### 6.6.1 Introduction
This solution is to address Key Issue #1.
This solution defines a mechanism where the UDR can indicate the detected
information that may introduce the corruption, inconsistency, loss of data to
the NFs (e.g. AMF/SMF/SMSF) via the NRF and UDM when the UDR detects that the
corruption, loss or inconsistency of data may happen because of some scenarios
(e.g. the UDR fails and restarts, or migration of the data from old UDR to new
UDR etc), and AMF/SMF/SMSF can decide to do the data synchronization based on
these information.
### 6.6.2 Functional Description
When the UDR detects that the corruption, loss or inconsistency of data may
happen because of some scenarios (e.g. the UDR fails and restarts, or
migration of the data from old UDR to new UDR etc), the UDR invokes the
Nnrf_NFManage_NFUpdate to indicate the updated information (e.g. the recovery
time, or the stored GPSI ranges or SUPI ranges), if the UDR can detect which
user ranges (e.g. GPSI range1 and GPSI range 2) are impacted, the UDR may
carry an extra information except for the updated UDR NF profile data in the
Nnrf_NFManage_NFUpdate request, and this extra information shall include the
impacted user identifier ranges (e.g. GPSI range1 and GPSI range 2) and the
impacted time, and this extra information won\'t be stored as part of the UDR
NF profile data in the NRF.
When the NRF receives the Nnrf_NFManage_NFUpdate request from the UDR, the NRF
shall notify the UDM of the changes if the UDM subscribed to the
NFStatusNotify of this UDR, when the extra information is included in the
Nnrf_NFManage_NFUpdate request, it will triggers the
Nnrf_NFManage_NFStatusNotify and Nnrf_NFManage_NFStatusNotify request shall
also include this extra information.
When the UDM receives Nnrf_NFManage_NFStatusNotify request, the UDM checks on
the changes of the UDR, if the UDM finds the recovery time is changed from the
request, the UDM may invoke Nnrf_NFManage_NFUpdate to include the UDR recovery
indication, the recovery time of the UDR, the impacted user identifier ranges
(e.g. SUPI ranges) which UDM get from the UDR profile (i.e. the users whose
profile data is available in that UDR NF profile), and when the NRF receives
the change indicated in the request by the UDM, the NRF won\'t store these
information as part of the UDM NF profile in the NRF but will notify the NFs
(e.g. AMF, SMF, SMSF) of this information if the NFs subscribed to the
NFStatusNotify of the UDM. The NFs that receive the notification may trigger
the related data synchronization operation according to the local policy (e.g.
AMF updates the registration and get the UE subscription via UDM again).
When the UDM receives Nnrf_NFManage_NFStatusNotify request and finds that an
extra information is included in the NFStatusNotify request, the UDM shall get
the impacted user identifier ranges and the impacted time from the extra
information and then invoke the Nnrf_NFManage_NFUpdate to include the UDR
recovery indication, the recovery time of the UDR (mapped from the impacted
time), the impacted user identifier ranges (mapped from the impacted user
identifier ranges), and when the NRF receives the change indicated in the
request by the UDM, the NRF won\'t store these information as part of the UDM
NF profile in the NRF but will notify the NFs (e.g. AMF, SMF, SMSF) of this
information if the NFs subscribed to the NFStatusNotify of the UDM. The NFs
that receive the notification may trigger the related data synchronization
operation according to the local policy (e.g. AMF updates the registration and
get the UE subscription via UDM again).
### 6.6.3 Procedures
Figure 6.6.3-1: Procedure for Partial update indication in extra information
1\. The UDR detects that the corruption, loss or inconsistency of data may
happen because of some scenarios (e.g. the UDR fails and restarts, or
migration of the data from old UDR to new UDR etc).
2\. _The UDR invokes the Nnrf_NFManage_NFUpdate to indicate the updated
information (e.g. the recovery time, or the stored GPSI ranges or SUPI
ranges), if the UDR can detect which user ranges (e.g. GPSI range1 and GPSI
range 2) are impacted, the UDR may carry an extra information except for the
updated UDR NF profile data in the Nnrf_NFManage_NFUpdate request, and this
extra information shall include the impacted user identifier ranges (e.g. GPSI
range1 and GPSI range 2) and the impacted time and this extra information
won\'t be stored as part of the UDR NF profile data in the NRF._
3\. When the NRF receives the Nnrf_NFManage_NFUpdate request from the UDR, the
NRF shall notify the UDM of the changes if the UDM subscribed to the
NFStatusNotify of this UDR, when the extra information is included in the
Nnrf_NFManage_NFUpdate request, it will triggers the
Nnrf_NFManage_NFStatusNotify and Nnrf_NFManage_NFStatusNotify request shall
also include this extra information.
4\. When the UDM receives Nnrf_NFManage_NFStatusNotify request, the UDM checks
on the changes of the UDR, if the UDM finds the recovery time is changed from
the request, the UDM may invoke Nnrf_NFManage_NFUpdate to include the UDR
recovery indication, the recovery time of the UDR, the impacted user
identifier ranges (e.g. SUPI ranges) which UDM get from the UDR profile (i.e.
the users whose profile data is available in that UDR NF profile), and if the
UDM finds that an extra information is included in the NFStatusNotify request,
the UDM shall get the impacted user identifier ranges and the impacted time
from the extra information and then invoke the Nnrf_NFManage_NFUpdate to
include the UDR recovery indication, the recovery time of the UDR (mapped from
the impacted time), the impacted user identifier ranges (mapped from the
impacted user identifier ranges).5. When the NRF receives the change indicated
in the request by the UDM, the NRF won\'t store this information as part of
the UDM NF profile in the NRF but will notify the NFs (e.g. AMF, SMF, SMSF) of
this information if the NFs subscribe to the NFStatusNotify of the UDM.
6\. The NFs may triger the data synchroniztion operation for users included in
the _received information according to the local policy_.
### 6.6.4 Impacts on services, entities and interfaces
UDM:
\- Support receiving the extra information in Nnrf_NFManagement_NFStatusNofity
and then triggering the Nnrf_NFManagement_NFUpdate to indicate the changes
related to UDR.
UDR:
\- Support sending the extra information in Nnrf_NFManagement_ NFUpdate to
indicate the impacted user ranges and impacted time.
NRF:
\- Support receiving the extra information in the Nnrf_NFManagement_NFUpdate
request sent by the UDR and Notify the UDM of the extra information.
\- Support receiving the extra information in the Nnrf_NFManagement_NFUpdate
request sent by the UDM and Notify the other NFs of the extra information.
AMF/SMF/SMSF:
\- Support receiving the changes related to UDR in
Nnrf_NFManagement_NFStatusNofity of the UDM status and trigger the operations
related to the data synchronization for each impacted user.
## 6.7 Solution#7: Unified solution
### 6.7.1 Introduction
This solution:
\- resolves key issues #1, #2, and #3 in a unified manner;
\- addresses all the front-ends of UDR (i.e. UDM, PCF, and NEF) and any NF
that consumes services from those front-ends; and
\- complies with the requirement \"All communication between UDR and serving
NFs [...] are always via UDM\" and assumes equivalent requirements for PCF and
NEF regarding resources defined in 3GPP TS 29.519 [5].
Under these principles, this solution has integrated and enhanced Solution
1\~4 Option B and Solution 6 in the following aspects:
\- Regarding UDR recovery notification to UDM, Option B uses a direct,
implementation-dependent message and Solution 6 uses specified messages via
NRF. This solution proposes to specify a direct message. The same applies also
to PCF and NEF.
\- Both Option B and Solution 6 use SUPI range and recoveryTime to limit
impacted profiles. This solution uses \"impacted resource names\" instead of
SUPI range, so that PCF/NEF case and/or non-per-UE profiles can be treated in
a unified manner. In addition, this solution proposes to use
lastReplicationTime, which indicates the timing that UDR replicates its
profile therein to its back-up last time before the UDR failure. This allows
NF to further limit impacted profiles and leads to less signaling traffic in
the synchronization phase.
\- Option B proposes that AMF/SMF invokes synchronization also to PCF when
AMF/SMF receives recovery notification (via NRF) from UDM. This solution
proposes differently that NF invokes synchronization only to UDM when the NF
receives recovery notification from UDM. Recovery notification from PCF
triggers synchronization to PCF.
\- Option B proposes a new AMF event exposure to give synchronization triggers
to SMF/SMSF. But this solution adopts Solution 6 and proposes that each NF
sets synchronization timing locally by itself. AMF may use UE\'s periodic
registration as the timing.
\- Option B describes messages to be invoked for synchronization. This
solution corrects some of those messages, so that duplicated resources are not
created in UDR as a consequence of synchronization, in case the related
profile in UDR was not actually lost in the UDR failure.
### 6.7.2 Functional Description
#### 6.7.2.1 Framework of the unified solution.
The solution is conducted with the following steps.
Step 1. When UDR fails and restarts after reloading data from its back-up, the
UDR sends its front-end (i.e. UDM, PCF, or NEF) a \"UDR recovery message\".
This message contains a \"scope\" that this failure impacts on.
Step 2. The frond-end reformats the message, names it as e.g. \"UDM recovery
message\", and forwards it to NF that has accessed the front-end before.
Step 3. The NF, taking into account the \"scope\" and local information,
identifies profiles therein that require synchronization. The NF further
identifies procedures that the NF needs to invoke for synchronization of each
of those profiles.
Step 4. The NF adjusts invocation timing of each of those procedures, in order
not to cause congestion in the system. The NF invokes necessary procedures.
#### 6.7.2.2 Concrete message and information element for each step in the
above-mentioned framework
Following message and information elements for each steps are considered.
\- W.r.t step 1 \"scope\": The scope is defined as a combination of impacted
resource names and an impacted period. The impacted period is represented as a
pair of \"lastReplicationTime\" and recoveryTime.
NOTE: How to aggregate multiple impacted resource names, e.g. which span a
certain SUPI ranges, and express them efficiently in information element(s) is
left to stage 3.
\- W.r.t. step 1 \"UDR recovery message\": UDR has a resource under each of
/subscription-data, /policy-data, /exposure-data, and /application-data to
store restoration related information. This resource, being of format of
scope, consists of impacted resource names, lastReplicationTime, and
recoveryTime. A front-end sends UDR Nudr_DataRepository_Subscribe for data
change notification for those resources. The front-end receives \"UDR recovery
message\" as Nudr_DataRepository_Notify.
\- W.r.t. step 2 e.g. \"UDM recovery message: NFProfile of a front-end has the
scope information consisting of impacted resource names,
\"partialLastReplicationTime\", and \"partialRecoveryTime\". NF sends NRF
Nnrf_NFManagement_NFStatusSubscribe for front-ends. A front-end updates NRF on
those scope information using Nnrf_NFManagement_NFUpdate. Then the NRF updates
NF on those scope information using Nnrf_NFManagement_NFStatusNotify, which
the NF takes as e.g. \"UDM recovery message\".
\- W.r.t. step 3 regarding identification of profiles that require
synchronization: A profile in NF may set a \"last synchronization time\". The
last synchronization time may be registrationTime in the case that the front-
end is UDM, NF is AMF/SMF/SMSF, and the registrationTime is conveyed from UDM
to AMF/SMF/SMSF at its registration. When NF finds that an impacted resource
name in the scope matches a profile therein, and that the last synchronization
time of the profile falls into the period between partialLastReplicationTime
and partialRecoveryTime in the scope, then the NF judges that the profile
requires synchronization.
\- W.r.t. step 3 regarding procedures that the NF needs to invoke for
synchronization: NF judges such procedures based on impacted resource names in
the scope.
\- The table below shows impacted resource names that UDR and each front-end
can include in the scope, and procedures that each NF receiving this scope
information needs to consider invoking for synchronization.
Table 6.7.2.2-1: Impacted resource names in the scope and procedures for
synchronization
+---------+---------+---------+---------+---------+---------+---------+ | | UDM | PCF | NE | | | | | | | | F(NOTE) | | | | +=========+=========+=========+=========+=========+=========+=========+ | | i | pr | i | pr | i | pr | | | mpacted | ocedure | mpacted | ocedure | mpacted | ocedure | | | r | | r | | r | | | | esource | | esource | | esource | | | | name | | name | | name | | +---------+---------+---------+---------+---------+---------+---------+ | **AMF** | /nudm- | Nud | /npcf | Np | N/A | N/A | | | uecm/v1 | m_UECM | -am-pol | cf_AMP | | | | | /{ueId} | _Regis | icy-con | olicyCo | | | | | | tration | trol/v1 | ntrol_ | | | | | | | /polici | Update. | | | | | | | es/{pol | If AMF | | | | | | | AssoId} | r | | | | | | | | eceives | | | | | | | | an | | | | | | | | error | | | | | | | | re | | | | | | | | sponse, | | | | | | | | the AMF | | | | | | | | sends | | | | | | | | N | | | | | | | | pcf_AM | | | | | | | | PolicyC | | | | | | | | ontrol\ | | | | | | | | _Create | | | +---------+---------+---------+---------+---------+---------+---------+ | | /nudm | Nudm_S | /npcf | Np | | | | | -sdm/v2 | DM_Get | -ue-pol | cf_UEP | | | | | /{supi} | | icy-con | olicyCo | | | | | | Nu | trol/v1 | ntrol_ | | | | | /nudm | dm_SDM | /polici | Update. | | | | | -sdm/v2 | _Modif | es/{pol | If AMF | | | | | /{ueId} | ySubscr | AssoId} | r | | | | | | iption. | | eceives | | | | | /nu | If AMF | | an | | | | | dm-sdm/ | r | | error | | | | | v2/shar | eceives | | re | | | | | ed-data | an | | sponse, | | | | | | error | | the AMF | | | | | /nudm- | re | | sends | | | | | sdm/v2/ | sponse, | | Np | | | | | shared- | the AMF | | cf_UEP | | | | | data-su | sends | | olicyCo | | | | | bscript | Nudm_S | | ntrol_ | | | | | ions/{s | DM_Sub | | Create. | | | | | ubscrip | scribe. | | | | | | | tionId} | | | | | | | | | | | | | | | | /nudm- | | | | | | | | sdm/v2/ | | | | | | | | group-d | | | | | | | | ata/gro | | | | | | | | up-iden | | | | | | | | tifiers | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | **SMF** | The | The | /npcf-s | Np | /3gpp- | Nnef | | | same | same | mpolicy | cf_SMP | pfd-man | _PFDMa | | | above | above, | control | olicyCo | agement | nagemen | | | | except | /v1/sm- | ntrol_ | /v1/{sc | t_Subs | | | | that | policie | Update. | sAsId}/ | cribe_ | | | | AMF is | s/{smPo | If SMF | transac | Modify. | | | | to be | licyId} | r | tions/{ | If SMF | | | | r | | eceives | transac | r | | | | eplaced | | an | tionId} | eceives | | | | with | | error | /applic | an | | | | SMF. | | re | ations/ | error | | | | | | sponse, | {appId} | re | | | | | | the SMF | | sponse, | | | | | | sends | | the SMF | | | | | | N | | sends | | | | | | pcf_SM | | Nne | | | | | | PolicyC | | f_PFDM | | | | | | ontrol\ | | anageme | | | | | | _Create | | nt_Sub | | | | | | | | scribe\ | | | | | | | | _Create | +---------+---------+---------+---------+---------+---------+---------+ | * | The | The | N/A | N/A | N/A | N/A | | _SMSF_ _| same | same | | | | | | | above | above, | | | | | | | | except | | | | | | | | that | | | | | | | | AMF is | | | | | | | | to be | | | | | | | | r | | | | | | | | eplaced | | | | | | | | with | | | | | | | | SMSF. | | | | | +---------+---------+---------+---------+---------+---------+---------+ | * | N/A | N/A | N/A | N/A | N/A | N/A | |_ GMLC**| (NOTE: | | | | | | | | GMLC | | | | | | | | uses | | | | | | | | only | | | | | | | | the GET | | | | | | | | method | | | | | | | | for | | | | | | | | te | | | | | | | | mporary | | | | | | | | info | | | | | | | | rmation | | | | | | | | usage.) | | | | | | +---------+---------+---------+---------+---------+---------+---------+ |**(in | N/A | N/A | /npcf-p | Npcf_ | N/A | N/A | | ternal) | | | olicyau | PolicyA | | | | AF**| | | thoriza | uthoriz | | | | | | | tion/v1 | ation_ | | | | | | | /app-se | Update. | | | | | | | ssions/ | If AF | | | | | | | {appSes | r | | | | | | | sionId} | eceives | | | | | | | | an | | | | | | | | error | | | | | | | | re | | | | | | | | sponse, | | | | | | | | the AF | | | | | | | | sends | | | | | | | | Npcf_ | | | | | | | | Polic | | | | | | | | yAuthor | | | | | | | | ization | | | | | | | | _ | | | | | | | | Create. | | | +---------+---------+---------+---------+---------+---------+---------+ |** NEF**| [Event | [Event | [Event | [Event | N/A | N/A | | | exp | exp | exp | exp | | | | | osure] | osure] | osure] | osure] | | | | | | | | | | | | | /nu | Nudm\ | /npc | Npcf | | | | | dm-ee/v | _EventE | f-event | _Event | | | | | 1/{ueId | xposure | exposur | Exposur | | | | | entity} | _Modif | e/v1/su | e_Subs | | | | | | ySubscr | bscript | cribe_ | | | | | | iption. | ions/{s | Modify. | | | | | | If NEF | ubscrip | If NEF | | | | | | r | tionId} | r | | | | | | eceives | | eceives | | | | | | an | | an | | | | | | error | | error | | | | | | re | | re | | | | | | sponse, | | sponse, | | | | | | the NEF | | the NEF | | | | | | sends | | sends | | | | | | Nu | | Npcf | | | | | | dm_Eve | | _Event | | | | | | ntExpos | | Exposur | | | | | | ure_Su | | e_Subs | | | | | | bscribe | | cribe_ | | | | | | | | Create. | | | +---------+---------+---------+---------+---------+---------+---------+ | | /nud | Nudm | The | The | | | | | m-pp/v1 | _Param | same in | same in | | | | | /{ueId} | eterPro | (in | (in | | | | | | vision\ | ternal) | ternal) | | | | | /n | _Update | AF | AF, | | | | | udm-pp/ | | | except | | | | | v1/5g-v | Nudm | | that AF | | | | | n-group | _Param | | is to | | | | | s/{extG | eterPro | | be | | | | | roupId} | vision\ | | r | | | | | | _Create | | eplaced | | | | | | | | with | | | | | | Nudm | | NEF. | | | | | | _Param | | | | | | | | eterPro | | | | | | | | vision\ | | | | | | | | _Delete | | | | | +---------+---------+---------+---------+---------+---------+---------+ | ** | [Event | [Event | [Event | [Event | [Event | [Event | | NWDAF** | exp | exp | exp | exp | exp | exp | | | osure] | osure] | osure] | osure] | osure] | osure] | | | | | | | | | | | | | | | /3g | Nnef | | | | | | | pp-moni | _Event | | | | | | | toring- | Exposur | | | | | | | event/v | e_Subs | | | | | | | 1/{scsA | cribe_ | | | | | | | sId}/su | Modify. | | | | | | | bscript | If | | | | | | | ions/{s | NWDAF | | | | | | | ubscrip | r | | | | | | | tionId} | eceives | | | | | | | | an | | | | | | | | error | | | | | | | | re | | | | | | | | sponse, | | | | | | | | the | | | | | | | | NWDAF | | | | | | | | sends | | | | | | | | Nnef | | | | | | | | _Event | | | | | | | | Exposur | | | | | | | | e_Subs | | | | | | | | cribe_ | | | | | | | | Create. | +---------+---------+---------+---------+---------+---------+---------+ | **IP- | FFS | FFS | N/A | N/A | N/A | N/A | | SM-GW** | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | NOTE: | | | | | | | | NEF | | | | | | | | acting | | | | | | | | as a | | | | | | | | fr | | | | | | | | ont-end | | | | | | | | does | | | | | | | | not | | | | | | | | send | | | | | | | | \"NEF | | | | | | | | r | | | | | | | | ecovery | | | | | | | | me | | | | | | | | ssage\" | | | | | | | | to | | | | | | | | e | | | | | | | | xternal | | | | | | | | AF. The | | | | | | | | NEF | | | | | | | | itself | | | | | | | | invokes | | | | | | | | ne | | | | | | | | cessary | | | | | | | | pro | | | | | | | | cedures | | | | | | | | for | | | | | | | | s | | | | | | | | ynchron | | | | | | | | ization | | | | | | | | based | | | | | | | | on the | | | | | | | | scope | | | | | | | | that | | | | | | | | the NEF | | | | | | | | r | | | | | | | | eceives | | | | | | | | from | | | | | | | | UDR, if | | | | | | | | the NEF | | | | | | | | has | | | | | | | | cashed | | | | | | | | pr | | | | | | | | ofiles. | | | | | | | +---------+---------+---------+---------+---------+---------+---------+
Editor\'s note: Procedures related to IP-SM-GW is FFS, awaiting progress of
Rel-17 SMS_SBI.
\- W.r.t. step 4 regarding invocation timing: NF sets locally. AMF may use
UE\'s periodic registration as the invocation timing.
### 6.7.3 Procedures
Figure 6.7.3-1: Procedure for Unified solution
0\. UDR has a resource under each of /subscription-data, /policy-data,
/exposure-data, and /application-data to store the restoration related
information. This resource is of format of scope, that is, consists of
impacted resource names, lastReplicationTime, and recoveryTime. A front-end
sends UDR Nudr_DataRepository_Subscribe for data change notification for those
resources.
A front-end has in its NFProfile the restoration related information of format
of scope, that is, consisting of impacted resource names,
partialLastReplicationTime, and partialRecoveryTime. NF that consumes services
of front-ends sends NRF Nnrf_NFManagement_NFStatusSubscribe for NF profile
update notification for those front-ends.
0a. A profile in NF sets a last synchronization time. The last synchronization
time may be registrationTime in the case that the front-end is UDM, NF is
AMF/SMF/SMSF, and the registrationTime is conveyed from UDM to AMF/SMF/SMSF at
its registration.
1\. When UDR fails and restarts after reloading data from its back-up, the UDR
sends its front-end Nudr_DataRepository_Notify including scope that this
failure impacts on.
2\. The frond-end copies values of impacted resource names,
lastReplicationTime, and recoveryTime onto impacted resource names,
partialLastReplicationTime, and partialRecoveryTime in its NF profile. The
front-end updates NRF using Nnrf_NFManagement_NFUpdate. The NRF updates NF
using Nnrf_NFManagement_NFStatusNotify.
3\. When the NF finds that an impacted resource name in the scope matches a
profile therein, and that the last synchronization time of the profile falls
into the period between partialLastReplicationTime and partialRecoveryTime in
the scope, then the NF judges that the profile requires synchronization. For
each of those profiles, the NF identifies procedures to invoke for
synchronization based on impacted resource names in the scope and on a
preconfigured table that maps impacted resource names in the scope to
procedures for synchronization.
4\. The NF locally adjusts invocation timing of each of those procedures, in
order not to cause congestion in the system. AMF may use UE\'s periodic
registration as the invocation timing. The NF invokes necessary procedures.
### 6.7.4 Impacts on services, entities and interfaces
UDR: A new resource needs to be created under each of /subscription-data,
/policy-data, /exposure-data, and /application-data. This resource consists of
impacted resource names, lastReplicationTime, and recoveryTime.
UDM, PCF, NEF: NFProfile needs to have new information consisting of impacted
resource names, partialLastReplicationTime, and partialRecoveryTime.
AMF/SMF/SMSF/(internal) AF/NEF/IP-SM-GW: Internal logic is impacted
Editor\'s note: Impact on IP-SM-GW needs to be checked according to outcome of
Rel-17 SMS_SBI.
## 6.8 Solution#8: Reset-IDs
### 6.8.1 Description
This solution addresses key issue#4 (Granularity of Data).
The concept of Reset-IDs is well known from legacy protocols (e.g. 3GPP TS
29.002 [3], 3GPP TS 29.272 [4]).
A Reset-ID uniquely identifies within the UDR a part of the UDR\'s temporary
data that may become subject to loss/corruption without impacts to other
parts. It is up to the UDR\'s internal implementation how Reset-IDs are
assigned; e.g. a Reset-ID may identify a hardware resource and may contain a
reset-counter.
When the UDR receives a request to store/update temporary data, it returns in
successful responses the Reset-ID associated with the part used for storage of
the temporary data. The UDR\'s consumer (e.g. UDM, NEF, PCF) forwards the
Reset-ID to its consumers (e.g. AMF, SMF, SMSF, NEF) in corresponding response
messages.
When the NF consumer (AMF/SMF/SMSF/NEF) receives Reset-IDs in successful
responses to registration requests, subscription requests or external
provisioning requests, it subscribes at the NRF (if not already done so) to
get notified on UDR restoration occurrences.
When the UDR detects loss or corruption of its data and the loss/corruption is
limited to one or more specific parts of the UDR\'s temporary data, it updates
its registration at the NRF with the associated Reset-IDs . The NRF then
notifies NFs (AMF/SMF/SMSF/NEF/PCF) that have subscribed to receiving such
notifications.
When the NF (AMF/SMF/SMSF/NEF/PCF) receives a notification from the NRF
indicating that parts of the UDR\'s temporary data have been lost/corrupted,
the NF takes appropriate action to synchronize registrations, subscriptions
and external provisionings as needed.
### 6.8.2 Procedures
#### 6.8.2.1 Preparation
In order to limit restoration of temporary data in the UDR to those parts that
are actually impacted by loss/corruption of data, the temporary data need to
be associated to Reset-IDs that are conveyed in relevant response messages
from UDR via UDM to the NFs that rely on temporary data being correctly stored
in the UDM/UDR.
In addition, NFs need to subscribe at the NFR to get notified when parts of
the UDR\'s temporary data are lost/corrupted.
#### 6.8.2.2 Detection
When the UDR detects loss or corruption of temporary data associated with one
or several Reset-IDs it updates the NRF with the set of associated Reset-IDs.
The NRF then notifies NFs that have previously subscribed to receive such
notifications.
#### 6.8.2.3 Re-synchronization
When the NF (AMF/SMF/SMSF/NEF) gets notified by the NFR, it re-synchronizes
registrations, subscriptions and external provisionings in the UDR via the
UDM. The re-synchronizations may be performed immediately or spread over time
to avoid high signalling load.
### 6.8.3 Impacts on services, entities and interfaces
The following Services are impacted:
Nudr_DataRepository service: Add Reset-IDs to successful response messages
when temporary data is created.
Nudm_UECM service: Add Reset-IDs to successful registration response messages.
Nudm_SDM service: Add Reset-IDs to successful SDM subscription response
messages.
Nudm_EE service: Add Reset-IDs to successful EE subscription response messages
Nudm_PP service: Add Reset-IDs to successful Parameter Provisioning response
messages.
Nnrf_NFManagement service: Allow UDRs to update the NRF with Reset-Ids and
allow NFs to subscribe to notifications of Reset-ID updates.
NFs (e.g. AMF, SMF, SMSF, NEF) that receive ResetIds in successful
registration/subscription responses need to subscribe at the NRF to get
notified when the UDR updates the NRFwith new reset-Ids.
## 6.9 Solution#9: Unified solution with Reset-ID or SUPI ranges
### 6.9.1 Introduction
This solution:
\- resolves key issues #1, #2, #3, and #4 in a unified manner, and
\- is based on Sol#7 and replaces the concept of impacted resource names with
a concept of impacted components, which are either Reset-IDs or SUPI ranges.
### 6.9.2 Functional Description
This solution is based on Sol#7. The differences are as follows:
\- In the preparation phase: The following steps are added. When UDR receives
a request to create or update a resource, the UDR may respond including a
Reset-ID which is associated with a part used for storage of the resource. A
front-end forwards the Reset-ID to NF. The NF stores in a relevant profile the
Reset-ID and the procedure in which the response included the Reset-ID.
\- In the notification phase: The impacted resource names are replaced with
impacted components, which are either Reset-IDs or SUPI ranges.
NOTE: NEF does not forward Reset-ID to external AF. The NEF itself invokes
necessary procedures for synchronization based on the scope that the NEF
receives from UDR (when the NEF acts as a front-end) or via NRF, if the NEF
has cashed profiles.
### 6.9.3 Procedures
Figure 6.9.3-1: Procedure for Unified solution with Reset-ID
0\. UDR has a resource under each of /subscription-data, /policy-data,
/exposure-data, and /application-data to store the restoration related
information. This resource is of format of scope, that is, consists of
impacted components (i.e. Reset-IDs or SUPI ranges), lastReplicationTime, and
recoveryTime. A front-end sends UDR Nudr_DataRepository_Subscribe for data
change notification for those resources.
A front-end has in its NFProfile the restoration related information of format
of scope, that is, consisting of impacted components (i.e. Reset-IDs or SUPI
ranges), partialLastReplicationTime, and partialRecoveryTime. NF that consumes
services of front-ends sends NRF Nnrf_NFManagement_NFStatusSubscribe for NF
profile update notification for those front-ends.
0a. When UDR receives a request to create or update a resource, the UDR may
respond including a Reset-ID which is associated with a part used for storage
of the resource. A front-end forwards the Reset-ID to NF. The NF stores in a
relevant profile the Reset-ID and the name of the procedure in which the
response included the Reset-ID.
The profile in NF sets a last synchronization time. The last synchronization
time may be registrationTime in the case that the front-end is UDM, NF is
AMF/SMF/SMSF, and the registrationTime is conveyed from UDM to AMF/SMF/SMSF at
its registration.
1\. When UDR fails and restarts after reloading data from its back-up, the UDR
sends its front-end Nudr_DataRepository_Notify including scope that this
failure impacts on.
2\. The frond-end copies values of impacted components (i.e. Reset-IDs or SUPI
ranges), lastReplicationTime, and recoveryTime onto impacted components (i.e.
Reset-IDs or SUPI ranges), partialLastReplicationTime, and partialRecoveryTime
in its NF profile. The front-end updates NRF using Nnrf_NFManagement_NFUpdate.
The NRF updates NF using Nnrf_NFManagement_NFStatusNotify.
3\. When the NF finds that a Reset-ID or a SUPI in the scope matches a profile
therein, and that the last synchronization time of the profile falls into the
period between partialLastReplicationTime and partialRecoveryTime in the
scope, then the NF judges that the profile requires synchronization. The NF
finds procedures to invoke for synchronization in the profile or in a pre-
configured manner.
4\. The NF locally adjusts invocation timing of each of those procedures, in
order not to cause congestion in the system. AMF may use UE\'s periodic
registration as the invocation timing. The NF invokes necessary procedures.
### 6.9.4 Impacts on services, entities and interfaces
UDR: Reset-ID needs to be added in a response message when temporary data is
created. A new resource needs to be created under each of /subscription-data,
/policy-data, /exposure-data, and /application-data. This resource consists of
impacted components (i.e. Reset-IDs or SUPI ranges), lastReplicationTime, and
recoveryTime.
UDM, PCF, NEF: Reset-ID needs to be added in a response message to NF when
Reset-ID is included in a response message coming from UDR. NFProfile needs to
have new information consisting of impacted components (i.e. Reset-IDs or SUPI
ranges), partialLastReplicationTime, and partialRecoveryTime.
AMF/SMF/SMSF/(internal) AF/NEF/IP-SM-GW: Internal logic is impacted.
Editor\'s note: Impact on IP-SM-GW needs to be checked according to outcome of
Rel-17 SMS_SBI.
## 6.10 Solution#10: Prevent overwriting of latest UECM Data
### 6.10.1 Description
This solution does not directly address KI#1, but works on top of Solution #1,
2, 3, 4, 7 & 8\. The solution describes how AMF/SMSF and UDM/UDR can avoid
overwriting UE\'s latest UECM data into UDR with UECM data from old AMF/SMSF.
If UE\'s serving AMF changes while UDR Restoration procedures are going on, it
is possible that UE\'s new serving AMF performs Nudm_UECM_Registration
procedure with the UDM/UDR **before** the old AMF is able to re-synchronize
its data with UDR. Since UDR might have lost old AMF\'s callback address
during restart, it is possible that UDM is unable to send deregistration
notification to old AMF when the new AMF performs Nudm_UECM_Registration
procedure. Thus, when old AMF re-synchronizes its data into UDR, unaware of
the fact that it no longer serve the corresponding UE, it ends up overwriting
UE\'s latest UECM data in UDR.
The same issue can happen also with regards to SMSF. The issue is described by
replacing AMF in the previous paragraph with SMSF.
### 6.10.2 Procedures
Following solutions can be explored for this scenario:
**\- Option A:** When an AMF or an SMSF performs Nudm_UECM_Registration
procedure, it includes a timestamp of last radio contact with the UE. With
this information, when UDM stores the AMF details or the SMSF details in UDR,
UDR allows to overwrite the information only if the timestamp of UE\'s last
radio contact is **same or** newer than the one already stored. Else, it
rejects the update.
\- Option A2: When an AMF or an SMSF performs Nudm_UECM_Registration
procedure, it includes a registrationTime. (registrationTime is currently
informed by UDR to UDM. It is proposed that this registrationTime is further
conveyed to AMF/SMF/SMSF.) With this information, when UDM stores the AMF
details or the SMSF details in UDR, UDR allows to overwrite the information
only if the registrationTime is not older than the one already stored. Else,
it rejects the update.
**\- Option B:** When an AMF or an SMSF performs Nudm_UECM_Registration
procedure due to UDR/UDM Restart notification, includes a flag (e.g.
UdrRestartInd) to indicate to UDM that the procedure is being performed due to
a re-start notification and UDM subsequently stores the same in UDR. If UDR
has already been updated with UECM data \"without\" the re-start indication,
it rejects the update.
### 6.10.3 Impacts on services, entities and interfaces
The following Services are impacted:
\- Nudm_UECM service: Add timestamp of last radio-contact, registrationTime,
or a restart indication during Nudm_UECM_Registration.
\- Nudr_DataRepository service: Add timestamp of last radio-contact, or a
restart indication as received during Nudm_UECM_Registration
\- Internal logic of UDR
## 6.11 Solution#11: Handling Nudm_UECM without Authentication Status
### 6.11.1 Description
This solution addresses KI #5.
During Restart, UDR might have also lost UE\'s authentication status in the
serving network, apart from UECM data. Without this information, when AMFs
perform Nudm_UECM_Registration due to UDR Restart notification, UDM cannot
verify if UE is authenticated in the serving network, and hence cannot link
the Authentication confirmation to Nudm_UECM_Registration from AMF, as
specified in 3GPP TS 33.501 Clause 6.1.4. Therefore, UDM will reject the
Nudm_UECM_Registration request from the AMF.
The solution proposes options to allow successful Nudm_UECM_Registration
procedure post UDR Restart notification.
### 6.11.2 Procedures
This solution works as below:
\- AMF, while performing Nudm_UECM_Registration due to UDR/UDM Restart
notification, includes a flag (e.g. UdrRestartInd) to indicate to UDM that the
procedure is being performed due to a re-start notification. UDM can verify if
UDR corresponding to the SUPI really restarted.
\- When UDM finds that it cannot get UE\'s Authentication Status in the
serving-network from UDR, it accepts the Nudm_UECM_Registration request from
the AMF, but provides it with a new parameter indicating that UE needs to be
re-authenticated upon next radio-contact, or within a specified time.
\- If UE is not authenticated in the serving-network within specified time,
UDM may send a notification to AMF which forces it to de-register the UE (e.g.
cancel-location or subscription withdrawn).
**Alternatively, Nudm_UECM_Registration request from the AMF can be rejected
with cause \"REAUTHENTICATION_REQUIRED\". However, this will force the AMF to
page and re-authenticate the UE. This can potentially cause signalling storm,
as thousands of UEs will need to be paged and re-authenticated
simultaneously.**
**By directing AMFs to perform re-authentication, this solution enables
resumption of SoR/UPU procedures as well, as new AUSF Instance details will be
populated into UDR following new primary authentication.**
### 6.11.3 Impacts on services, entities and interfaces
The following Services are impacted:
\- Addition of new flags during Nudm_UECM_Registration request
\- Addition of auethentication indication in Nudm_Registration_Response
\- Internal logic of UDM
## 6.12 Solution#12: Recovery of AUSF Instance holding latest KAUSF
### 6.12.1 Description
This solution addresses key issue#1 and allows AUSF to re-synchronize its
details in UDM/UDR after UDR restart.
In this solution, it is expected that AUSF too subscribes to NRF to receive
UDR Restart Notification (directly or indirectly as specified in Solution #5 &
6), and performs re-synchronization of AUSF Instance details into UDR upon
receiving such a notification.
If multiple AUSFs are holding KAUSF, e.g. due to multiple primary
authentications in the past, it is possible that multiple AUSFs perform re-
synchronization of data. It is expected that UDR updates AUSF instance details
only if the authEvent data-structure contains \"newer\" timestamp.
Alternatively, Nausf_UEAuthentication_Deregister service operation can be made
mandatory to ensure only one AUSF instance will respond to the notification.
### 6.12.2 Procedures
This solution works as below:
\- Upon successful primary authentication for a given SUPI, AUSF subscribes to
NF Status change notifications for UDR serving the SUPI, if not already done.
\- Alternatively, AUSF subscribes to the NF Status change notification for the
UDM instance to which it sends authentication result confirmation (if Solution
6 is adopted).
\- Upon receiving NF status change notification from NRF about UDR restart
(and affecting the SUPI concerned), AUSF performs
Nudm_UEAuthentication_ResultConfirmation Service operation, containing
AuthEvent data structure, to re-populate the UE Authentication Status into
UDM/UDR. AuthEvent data structure contains AUSF Instance ID, and the timestamp
of the authentication.
\- AuthEvent data structure optionally contains an indication that this
operation is being performed due to restart notification.
\- UDR verifies if the timestamp of authentication is newer than the one
already stored in its database, if any. If yes, it allows update of latest
AuthEvent data structure.
\- Alternatively it is proposed that Nausf_UEAuthentication_Deregister service
operation is made mandatory, so that only one AUSF will respond to the
notification.
### 6.12.3 Impacts on services, entities and interfaces
The following Services are impacted:
\- AUSF subscribes to NF Status Change Notifications for UDR and performs
Nudm_UEAuthentication ResultConfirmation Service Operation upon UDR Restart
Notification
\- UDR internal logic (for ensuring that AuthEvent containing newer result is
allowed to be stored)
## 6.13 Solution#13: Unified solution with Implicit Subscription
### 6.13.1 Introduction
This solution:
\- resolves key issues #1, #2, and #3 in a unified manner, and
\- is based on Sol#7 and replaces the explicit subscription between
UDM/PCF/NEF and UDR with implicit subscription created on UDR.
### 6.13.2 Functional Description
This solution is based on Sol#7. The differences are as follows:
\- The UDR front ends, e.g. UDM/PCF/NEF, do not issue an UDR restart event
subscription. Upon the first communication between the UDR and its front end,
the UDR by default creates a corresponding subscription to UDR restart event
for that NF.
### 6.13.3 Procedures
Figure 6.13.3-1: Procedure for Unified solution with Implicit Subscription
0\. UDR has a resource under each of /subscription-data, /policy-data,
/exposure-data, and /application-data to store the restoration related
information. This resource is of format of scope, that is, consists of
impacted resource names, lastReplicationTime, and recoveryTime.
A front-end has in its NFProfile the restoration related information of format
of scope, that is, consisting of impacted resource names,
partialLastReplicationTime, and partialRecoveryTime. NF that consumes services
of front-ends sends NRF Nnrf_NFManagement_NFStatusSubscribe for NF profile
update notification for those front-ends.
1\. The front-ends issues the first communication with UDR. The front-ends may
include in the Nudr_DataRepository service request the URI for receiving
notifications.
2\. The UDR creates an implicit subscription to UDR restart event for the
front-end.
3\. When UDR fails and restarts after reloading data from its back-up, the UDR
needs to send corresponding notification its front-end. If the front-end did
not provide the URI for receiving notifications in step 1, the UDR queries NRF
to get the default URI for receiving notifications.
4\~7. The same as step 1\~4 as described in Figure 6.7.3-1.
### 6.13.4 Impacts on services, entities and interfaces
UDR: A new resource needs to be created under each of /subscription-data,
/policy-data, /exposure-data, and /application-data. This resource consists of
impacted resource names, lastReplicationTime, and recoveryTime. UDR needs to
create implicit subscription on those resources upon the first communication
with the front-ends.
UDM, PCF, NEF: NFProfile needs to have new information consisting of impacted
resource names, partialLastReplicationTime, and partialRecoveryTime.
AMF/SMF/SMSF/(internal) AF/NEF/IP-SM-GW: Internal logic is impacted.
Editor\'s note: Impact on IP-SM-GW needs to be checked according to outcome of
Rel-17 SMS_SBI.
## 6.14 Solution#14: Deferred Nudm_UECM due to lack of authentication status
### 6.14.1 Description
This solution addresses KI #5.
### 6.14.2 Procedures
This solution works as below:
When AMF performs Nudm_UECM_Registration due to UDR/UDM restoration
notification and if the AMF is rejected with cause
\"REAUTHENTICATION_REQUIRED\", the AMF waits for a certain configured period
without invoking UE paging and UE authentication. The AMF re-attempts
Nudm_UECM_Registration. After a certain configured number of re-attempts and
rejection of all those reattempts, the AMF waits for UE radio contact. When
the UE comes in radio contact, the AMF invokes UE authentication and then
performs Nudm_UECM_Registration.
### 6.14.3 Impacts on services, entities and interfaces
Internal logic of AMF.
## 6.15 Solution#15: Notification via existing NRF services
### 6.15.1 Introduction
This solution addresses key issue 6:
### 6.15.2 Functional Description
When the UDR detects potential corruption or loss of temporary data, it
updates its registration information (profile) in the NRF with a new
restoration event using the existing Nnrf_NFManagementService. NF consumers
(e.g. AMF) of the UDR consumer (e.g. UDM) that have subscribed at the NRF to
notifications then get notified by the NRF.
### 6.15.3 Procedures
Figure 6.15.3-1: Notification Path via existing NRF service
0\. The consumer of the UDR consumer (e.g. AMF) subscribes to notifications at
the NRF to get notified when the UDR\'s profile is updated.
1\. When UDR fails and restarts after reloading data from its back-up, the UDR
updates its profile a the NRF with new restoration event information.
3\. The NRF notifies all NFs that have previously subscribed to receive
notifications on the UDR\'s profile update.
## 6.16 Solution#16: Notification via UDR consumer and existing NRF services
### 6.16.1 Introduction
This solution addresses key issue 6:
### 6.16.2 Functional Description
When the UDR detects potential corruption or loss of temporary data, it sends
notifications to its consumers (e.g. UDM) that are implicitly subscribed to
receive such notifications. The UDR consumer (e.g. UDM) then updates its
registration information (profile) in the NRF with a new restoration event
using the existing Nnrf_NFManagementService. NF consumers (e.g. AMF) of the
UDR consumer (e.g. UDM) that have subscribed at the NRF to notifications then
get notified by the NRF.
### 6.16.3 Procedures
Figure 6.16.3-1: Notification Path via UDR consumer and NRF
0\. The consumer of the UDR consumer (e.g. AMF) subscribes to notifications at
the NRF to get notified when the UDR consumer\'s (e.g. UDM\'s) profile is
updated.
1\. When UDR fails and restarts after reloading data from its back-up, the UDR
sends a notification to its consumers (e.g. UDM).
2\. The UDR consumer updates its profile a the NRF with new restoration event
information.
3\. The NRF notifies all NFs that have previously subscribed to receive
notifications on the UDR consumer\'s profile update.
## 6.17 Solution#17: Notification via a new NRF service
### 6.17.1 Introduction
This solution addresses key issue 6:
### 6.17.2 Functional Description
When the UDR detects potential corruption or loss of temporary data, it sends
a request to a new NRF service (Nnrf_Restoration service) to create a new
restoration event resource. NF consumers (e.g. AMF) of the UDR consumer (e.g.
UDM) that have subscribed at the NRF to notifications then get notified by the
NRF.
### 6.17.3 Procedures
Figure 6.17.3-1: Notification Path via new NRF service
0\. The consumer of the UDR consumer (e.g. AMF) subscribes to notifications at
the NRF to get notified when a restoration event has been created.
1\. When UDR fails and restarts after reloading data from its back-up, the UDR
sends a request to the NRF to create a restoration event.
2\. The NRF notifies all NFs that have previously subscribed to receive
notifications on restoration event creation.
## 6.18 Solution#18: Notification via a new DataRestoration Network Function
(DRNF)
### 6.18.1 Introduction
This solution addresses key issue 6. It is similar to solution#17, however,
instead of defining a new NRF service, a new NF (DRNF) is proposed to store
data restoration events.
### 6.18.2 Functional Description
When the UDR detects potential corruption or loss of temporary data, it sends
a request to a new DataRestoration Network Function (DRNF) to create a new
restoration event resource. NF consumers (e.g. AMF) of the UDR consumer (e.g.
UDM) that have subscribed at the DRNF to notifications then get notified by
the DRNF.
### 6.18.3 Procedures
Figure 6.18.3-1: Notification Path via new DRNF
0\. The consumer of the UDR consumer (e.g. AMF) subscribes to notifications at
the DRNF to get notified when a restoration event has been created.
1\. When UDR fails and restarts after reloading data from its back-up, the UDR
sends a request to the DRNF to create a restoration event.
2\. The DRNF notifies all NFs that have previously subscribed to receive
notifications on restoration event creation.
## 6.19 Solution#19: Notification via UDM to Default Notification URIs
### 6.19.1 Introduction
This solution is to address Key Issues #1, #2 and #3.
This solution defines a mechanism where UDR provides information about its
potential data inconsistency directly to its consumers (i.e., UDM, PCF and
NEF), by means of default subscriptions. Then, the required restoration
actions are triggered and controlled as required in each case by the impacted
UDR consumer.
### 6.19.2 Functional Description
Following prerequisites are required:
\- The consumers of UDR (i.e., UDM, PCF and NEF) define a default notification
endpoint in the NF instance profile, for a new default notification type (i.e.
PotentialUDRDataInconsistency).
\- The consumers of UDM (i.e., AMF, SMF. SMSF and NEF) as well define a
default notification endpoint in the NF instance profile, for a new default
notification type (i.e., PotentialUDRDataInconsistency).
When the UDR detects that the corruption, loss or inconsistency of data may
happen because of some scenarios (e.g. the UDR fails and restarts, or
migration of the data from old UDR to new UDR etc), the UDR sends a new
notification request to the callback URI (for the default notification type:
PotentialUDRDataInconsistency) defined in the UDM/PCF/NEF profile.
This notification includes the UDR restoration information, that consists of
the following:
\- Identification of the time period where there may be data inconsistencies,
as follows:
\- Incident timestamp: time when the situation that causes the potential data
inconsistency occurs. The data that is not changed after this timestamp is
consistent.
\- Recovery timestamp: time when the abnormal situation is recovered. The data
that is changed after this timestamp is consistent.
> This pair of timestamps identify the time when the data obtained by an NF
> from UDR (either directly, e.g., by UDM, or indirectly, e.g., by AMF) may
> not be consistent (that is, data in the NF instance may not be the one that
> is stored in UDR).
\- Impacted user identifiers (e.g., SUPI ranges and/or GPSI ranges, or Reset-
Id, or UDR Group Id). This is an optional information, if not included, all
users may have inconsistent information.
Then the required restoration actions are triggered and controlled as required
in each case by the impacted UDR consumer (UDM/PCF/NEF) as described in the
following sections.
### 6.19.3 Procedures
#### 6.19.3.1 Restoration of Subscription Data in AMF, SMF and SMSF
Figure 6.19.3.1-1: Procedure for PotentialUDRDataInconsistency notifications
-- AMF,SMF,SMSF
0\. UDM as well as AMF/SMF/SMSF, registers in its profile a new default
notification endpoint for a new default notification type (i.e.,
PotentialUDRDataInconsistency.
1\. The UDR detects that the corruption, loss or inconsistency of data may
happen because of some scenarios (e.g., the UDR fails and restarts, or
migration of the data from old UDR to new UDR etc).
2-3. The UDR discovers the PotentialUDRDataInconsistency endpoint(s) in UDM
profiles. The UDR needs to discover from NRF the UDM profile with this new
default notification type. E.g., it may discover all the profiles for a
certain NF type and then search for profiles including
PotentialUDRDataInconsistency default notification type, or as an alternative,
using notification-type as a discovery query parameter, only the profiles
including PotentialUDRDataInconsistency default notification type may be
discovered.
4-5. The UDR sends PotentialUDRDataInconsistency notification to the
discovered PotentialUDRDataInconsistency endpoint(s).
6-7. The UDM discovers the PotentialUDRDataInconsistency endpoint(s) in AMF,
SMF and/or SMSF instances (as UDM consumers), similar to step 2-3.
8\. The UDM sends a new notification request(s) to the callback URI (for the
default notification type: PotentialUDRDataInconsistency) defined in the
profile of the UDM consumers, with the same contents for the notification
received from UDR.
NOTE: If UDRGroupId was received from UDR, the UDM may need to map that into
corresponding UDMGroupId(s) if applicable; how this is done is implementation
specific.
9\. AMF, SMF and/or SMSF, as UDM consumers, receive the
PotentialUDRDataInconsistency notification request. They mark potentially
impacted subscribers.
10\. The AMF/SMF/SMSF perform any required restoration action for the marked
subscribers. E.g., AMF should send Nudm_UECM_Reg request to UDM for identified
UE/SUPIs. UDM consumers should trigger the required synchronization actions
towards UDM based on subsequent UE activity in order to avoid massive
signalling.
#### 6.19.3.2 Restoration of Policy Subscription Data and Application Data in
PCF
Figure 6.19.3.2-1: Procedure for PotentialUDRDataInconsistency notifications -
PCF
0\. PCF registers in its profile the new PotentialUDRDataInconsistency default
notification endpoint.
1\. The UDR detects that the corruption, loss or inconsistency of data may
happen because of some scenarios (e.g., the UDR fails and restarts, or
migration of the data from old UDR to new UDR etc).
2-3. The UDR discovers the PotentialUDRDataInconsistency endpoint(s) in PCF
instance profiles.
4-5. The UDR sends PotentialUDRDataInconsistency notification to the
discovered PotentialUDRDataInconsistency endpoint(s).
6\. When the PotentialUDRDataInconsistency notification is received by PCF, it
needs to perform required restoration actions for impacted subscribers. In
this case, it is understood that the PCF does not need to send any
notification to its consumers (SMF, AMF), while any restoration action must be
taken in the PCF and are implementation specific.
Editor\'s note: proposed PCF behavior should be assessed by CT3.
#### 6.19.3.3 Restoration of Application and Exposure Data in NEF
##### 6.19.3.3.1 Introduction
The NEF has the particularity that stores some data in UDR directly (i.e.,
configuration data), while other data is accessed via UDM. The procedures are
covered in following clauses.
##### 6.19.3.3.2 Direct access to UDR
Figure 6.19.3.3.2-1: Procedure for PotentialUDRDataInconsistency notifications
-- NEF direct to UDR
This flow is similar to the one described for PCF in Figure 6.19.3.2-1. The
NEF does not send this notification to AF(s), while any restoration action
(step 6) must be taken in the NEF and is implementation specific.
Editor\'s note: proposed NEF behavior should be assessed by CT3.
##### 6.19.3.3.3 Access via UDM
Figure 6.19.3.3-1: Procedure for PotentialUDRDataInconsistency notifications
-- NEF via UDM
0-10. Similar to steps 0-11 in Figure 6.19.3.1-1.
11\. In this case, the NEF does not receive a direct indication of UE
activity, if so, the NEF will need to start any require synchronization
procedure towards UDR immediately since it does not have information of when
the data may be used. Then, it will need to implement an implementation
specific mechanism to pace the requests towards UDM. This solution proposes a
solution to avoid the need of such mechanism.
12\. This step assumes there is UE activity for a marked subscriber in AMF.
Then, AMF sends a Registration to UDM with the inclusion of a new flag to
indicate that the reason to send this Registration is due to a
PotentialUDRDataInconsistency.
13\. Update of subscription data in UDR as a result of the registration.
14\. The UDM checks if the Registration includes the
PotentialUDRDataInconsistency flag.
15-16. Since the flag is present, then the UDM notifies the NEF indicating
that for the corresponding user a new Registration is performed, so this would
solve the data inconsistency, and it is an indication to the NEF of a user
activity.
17\. The notification received is interpreted as user activity by NEF, then it
performs any required restoration actions (e.g., send corresponding
subscription request to UDM).
Editor\'s note: proposed NEF behavior should be assessed by CT3.
#### 6.19.3.4 Discovery of default notification endpoints
In roaming cases, not described in the above diagrams for simplicity, the UDM
may perform the NRF Discovery of the default notification
PotentialUDRDataInconsistency endpoints of its consumers (AMF, SMF, SMSF) via
the local NRF. The UDM receives in the registration information, the PLMNId
and NF instance id of its consumers (receivers of the notification) to be able
to perform this NRF Discovery.
The UDM can build and maintain locally a persistent list of \"service
consumers to be restored\", in an implementation-dependent manner; such list
can contain mainly service consumers registered in the own PLMN of the UDM,
but also, following operator\'s preferences, service consumer registered from
other VPLMNs. Such list can be shared/replicated across UDM instances (e.g.,
when the instances belong to a same UDM Set or UDM group).
### 6.19.4 Impacts on services, entities and interfaces
UDM:
\- Define and register new PotentialUDRDataInconsistency notification endpoint
in NF profile.
\- Receive PotentialUDRDataInconsistency notification triggering required
actions for data synchronization.
\- Discover PotentialUDRDataInconsistency notification endpoint and send
PotentialUDRDataInconsistency notification request.
\- Check if PotentialUDRDataInconsistency flag is included in Registration,
and if so, send new notification (Registration for Potential UDR Data
Inconsistency) to the NEF.
UDR:
\- Identify affected subscribers and affected time period of a potential data
inconsistency.
\- Discover PotentialUDRDataInconsistency notification endpoint and send
PotentialUDRDataInconsistency notification request.
PCF:
\- Define and register new PotentialUDRDataInconsistency notification endpoint
in NF profile.
\- Receive PotentialUDRDataInconsistency notification triggering required
actions for data synchronization.
\- Perform (implementation specific) restoration actions.
AMF/SMF/SMSF/NEF:
\- Define and register new PotentialUDRDataInconsistency notification endpoint
in NF profile.
\- Receive PotentialUDRDataInconsistency notification triggering required
actions for data synchronization.
\- Mark identified subscribers.
AMF:
\- Include PotentialUDRDataInconsistency flag in Registration when it is
required for that reason.
NEF:
\- Perform (implementation specific) restoration actions when notification
(Registration for Potential UDR Data Inconsistency) from UDM is received for
marked users.
## 6.20 Solution#20: Notification via Reset Control Function (RCF)
### 6.20.1 Introduction
This solution addresses key issue #6 (Notification Path). It combines elements
from solutions #17, #18 and #19 and allows a variation of deployment options.
### 6.20.2 Functional Description
When the UDR detects potential corruption or loss of temporary data, it sends
a message to a new Reset Control Function (RCF). The message from UDR to RCF
is regarded the first step of the notification path. Depending on deployment
decisions, the RCF may be
\- combined/co-located/integrated with the NRF (similar to solution #17), or
\- stand alone (similar to solution #18), or
\- combined/co-located/integrated with the UDR\'s consumers (UDM, NEF, PCF)
(similar to solution #19.
The message conveyed from UDR to RCF shall have Request/Response operation
semantics.
A dedicated service (Nrcf_ResetControl) is offered by the RCF to its consumer
(UDR), allowing the consumer to report loss of data / data corruption
occurrences to the RCF by means of the Nrcf_ResetControl_Create service
operation.
A second step of the notification path goes from the RCF to the end-consumer
NFs (i.e. NFs that may be interested in receiving reset messages, e.g. AMF,
SMF, SMSF, NEF, NWDAF).
The message conveyed from RCF to the end-consumer NF shall have
Subscribe/Notify operation semantics.
As a deployment option the RCF may allow end-consumer NFs (e.g. AMF) to
explicitly and directly subscribe or explicitly and indirectly (e.g. AMF
delegates the subscription to the UDM) subscribe to notifications of data
corruption/loss occurrences reported to the RCF by the UDR. By this option the
RCF offers explicit subscription to notifications by means of a
Nrcf_ResetControl_Subscribe service operation. In addition or as an
alternative to this option the RCF may maintain a local list of implicitly
subscribed NFs that are targets of the notification path\'s second step.
When the RCF receives an Nrcf_ResetControl_Create service operation request
from the UDR (1^st^ step of the notification path), it sends
Nrcf_ResetControl_Notify requests to all end-consumer NFs that are implicitly
subscribed, explicitly directly subscribed, or explicitly indirectly subsribed
(2^nd^ step of the notification path).
### 6.20.3 Procedures
Figure 6.20.3-1: Notification Path via RCF
0\. Preparation step: The end-consumer NF (e.g. AMF) communicates with the UDR
consumer (e.g. UDM) resulting in temporary data being stored at the UDR. The
UDR returns a reset ID to its consumer (e.g. UDM) which is forwarded to the
end-consumer NF.
0a. Optionally, the end-consumer NF explicitly and directly subscribes to
notifications at the RCF to get notified when a reset control event has been
created.
0b. In addition or as an alternative (depending on deployment options) the RCF
maintains a local list of implicitly subscribed notification targets.
0c. In addition or as an alternative (depending on deployment options) the
end-consumer explicitly and indirectly subscribes to notifications at the RCF
to get notified when a reset event has been created. The request for indirect
subscription is conveyed in step 0 from end-consumer NF to UDR consumer and
triggers the UDR consumer (e.g. UDM) to send the subscribe request on behalf
of the end-consumer NF (e.g. AMF) to the RCF, i.e. the end consumer NF
delegates sending of the subscribe request to the UDR consumer.
1\. When UDR fails and restarts after reloading data from its back-up, the UDR
sends a request to the RCF to create a reset control event.
2\. The RCF notifies all NFs that are subscribed (implicitly or explicitly) to
receive notifications on reset control event creation.
### 6.20.4 Impacts on services, entities and interfaces
RCF:
\- Offer a new service operation (Nrcf_ResetControl_Create) to the UDR.
\- Optionally offer a new service operation (Nrcf_ResetControl_Subscribe).
(Note)
\- Optionally maintain a list of implicitly subscribed end-consumer NFs. This
may include consumption of Nnrf services to discover registered notification
endpoints of end-consumer NFs. (Note)
\- Send Nrcf_ResetControl_Notify requests to implicitly or explicitly (direct
or indirect) subscribed end-consumer NFs.
Note: At least one of the two options shall be supported
UDR:
\- Consume the Nrcf_ResetControl_Create service operation offered by the RCF.
End-Consumer NF:
\- Optionally subscribe to the RCF explicitly by consuming the
Nrcf_ResetControl_Subscribe service operation.
\- Register new Notification endpoint in NF profile at the NRF.
\- Indicate indirect subscription to notifications in relevant messages sent
to the UDR consumer.
\- Receive Nrcf_ResetControl_Notify requests triggering required actions for
data synchronization.
NRF:
\- Allow end-service consumers to register notification endpoints, and allow
RCF to discover notification endpoints identifying Nrcf_ResetControl_Notify
targets.
UDR consumer:
\- Send subscribe messages to the RCF on behalf of the end-consumer.
## 6.21 Solution#21: Notification via Reset Control Function (RCF) without
explicit subscription from end-consumer NF
### 6.21.1 Introduction
This solution addresses key issue #6 (Notification Path). It combines elements
from solutions #17, #18 and #19 and allows a variation of deployment options,
and is similar to solution #20 with the difference that no explicit
subscription from end-consumer NF is used.
### 6.21.2 Functional Description
When the UDR detects potential corruption or loss of temporary data, it sends
a message to a new Reset Control Function (RCF). The message from UDR to RCF
is regarded the first step of the notification path. Depending on deployment
decisions, the RCF may be
\- combined/co-located/integrated with the NRF (similar to solution #17), or
\- stand alone (similar to solution #18), or
\- combined/co-located/integrated with the UDR\'s consumers (UDM, NEF, PCF)
(similar to solution #19).
The message conveyed from UDR to RCF shall have Request/Response operation
semantics.
A dedicated service (Nrcf_ResetControl) is offered by the RCF to its consumer
(UDR), allowing the consumer to report loss of data / data corruption
occurrences to the RCF by means of the Nrcf_ResetControl_Create service
operation.
A second step of the notification path goes from the RCF to the end-consumer
NFs (i.e. NFs that may be interested in receiving reset messages, e.g. AMF,
SMF, SMSF, NEF, NWDAF).
The message conveyed from RCF to the end-consumer NF shall have
Subscribe/Notify operation semantics.
As a deployment option the RCF may allow end-consumer NFs (e.g. AMF) to
indirectly (e.g. AMF delegates the subscription to the UDM) subscribe to
notifications of data corruption/loss occurrences reported to the RCF by the
UDR. By this option the RCF offers explicit subscription to notifications by
means of a Nrcf_ResetControl_Subscribe service operation. In addition or as an
alternative to this option the RCF may maintain a local list of implicitly
subscribed NFs that are targets of the notification path\'s second step.
When the RCF receives an Nrcf_ResetControl_Create service operation request
from the UDR (1^st^ step of the notification path), it sends
Nrcf_ResetControl_Notify requests to all end-consumer NFs that are implicitly
subscribed, or explicitly indirectly subsribed (2^nd^ step of the notification
path).
### 6.21.3 Procedures
Figure 6.21.3-1: Notification Path via RCF
0\. Preparation step: The end-consumer NF (e.g. AMF) communicates with the UDR
consumer (e.g. UDM) resulting in temporary data being stored at the UDR. The
UDR returns a reset ID to its consumer (e.g. UDM) which is forwarded to the
end-consumer NF.
0a. Optionally, (depending on deployment options) UDR consumer (e.g. UDM)
delegates on behalf of the end-consumer (i.e. the end-consumer indirectly)
subscribes to notifications at the RCF to get notified when a reset event has
been created. The request for indirect subscription is conveyed in step 0 from
end-consumer NF to UDR consumer and triggers the UDR consumer (e.g. UDM) to
send the subscribe request on behalf of the end-consumer NF (e.g. AMF) to the
RCF, i.e. the end consumer NF delegates sending of the subscribe request to
the UDR consumer.
0b. In addition or as an alternative (depending on deployment options) the RCF
maintains a local list of implicitly subscribed notification targets.
1\. When UDR fails and restarts after reloading data from its back-up, the UDR
sends a request to the RCF to create a reset control event.
2\. The RCF notifies all NFs that are subscribed (implicitly or explicitly) to
receive notifications on reset control event creation.
### 6.21.4 Impacts on services, entities and interfaces
RCF:
\- Offer a new service operation (Nrcf_ResetControl_Create) to the UDR.
\- Optionally offer a new service operation (Nrcf_ResetControl_Subscribe).
(Note)
\- Optionally maintain a list of implicitly subscribed end-consumer NFs. This
may include consumption of Nnrf services to discover registered notification
endpoints of end-consumer NFs. (Note)
\- Send Nrcf_ResetControl_Notify requests to implicitly or explicitly (direct
or indirect) subscribed end-consumer NFs.
Note: At least one of the two options shall be supported
UDR:
\- Consume the Nrcf_ResetControl_Create service operation offered by the RCF.
NRF:
\- Allow end-service consumers to register notification endpoints, and allow
RCF to discover notification endpoints identifying Nrcf_ResetControl_Notify
targets.
UDR consumer:
\- Send subscribe messages to the RCF on behalf of the end-consumer.
## 6.22 Solution#22: DNN/S-NSSAI as new granularity
### 6.22.1 Introduction
This solution is to address Key Issues #4 (Granularity of Data) and defines a
mechanism that the DNN and/or S-NSSAI can be adopted as new granularity.
DNN/S-NSSAI is currently defined as data keys or data subkeys for some of the
context data in UDR, and can be used to identify the parts of UDR\'s temporary
data which subjects to loss/corruption without impacts to other parts, which
may rely on the fact that operator may provide different level of backup
reliability for user data under different DNN/S-NSSAI, e.g. hot standby for
IMS related context data.
Under this circumstance, when the UDR detects loss or corruption of its
partial temporary data, it can notify the corresponding NFs with DNN/S-NSSAI
as identification of the impacted temporary data via NRF, and the reset-ID can
also be a combined identification together with DNN/S-NSSAI in some cases.
When the NF (AMF/SMF/SMSF/NEF/PCF/UDM) receives a notification from the NRF
that parts of the UDR\'s temporary data is suffering from loss or corruption,
it can take actions to restore these parts of data as needed.
In additional, the notification via NRF is used as an example in this
solution, the notification path method as defined in solution#17, solution
#18, solution #19, solution #20 and etc. are also supported.
### 6.22.2 Functional Description
#### 6.22.2.1 Preparation
This solution assumes that the UDR can provide different level of reliability
with DNN/S-NSSAI granularity, so as to limit the impacted temporary data under
specific DNN/S-NSSAI, e.g. policy context for IMS voice can be restored from
the backup profile, while policy context for internet service needs to be
restored by triggering the restoration procedure towards corresponding
AMF/SMF. The Reset-ID may also be adopted as combined granularity if available
in this case.
In order to get notified of the loss or corruption event of UDR\'s temporary
data, NFs need to subscribe the UDR status in NRF.
#### 6.22.2.2 Detection
When the UDR detects that loss or corruption of temporary data with one or
several DNN/S-NSSAI, it updates its NF profile towards NRF with the set of
impacted DNN/S-NSSAI. The NRF further notifies the NFs that has subscribed to
this notification.
As an alternative, the provided DNN/S-NSSAI can be used to identify the
temporary data not impacted, and the re-synchronization procedure needs to be
adapted accordingly.
#### 6.22.2.3 Re-synchronization
When the NFs (PCF/UDM/NEF) gets notified from the NRF, it needs to notify the
corresponding AMF/SMF/SMSF directly or indirectly via NRF. The re-
synchronizations may then be performed for the impacted temporary data based
on timely manner or based on NF implementation. Signalling overload should be
avoided in this process.
### 6.22.3 Impacts on services, entities and interfaces
The following Services are impacted:
Nnrf_NFManagement_Create/Update service operation: Allow UDRs to update the
NRF with DNN/S-NSSAI as identification of impacted or non-impacted temporary
data,
Nnrf_NFManagement_Notify service operation: the NRF is required to notify the
NFs which subscribes to notifications of corresponding NF status, in which the
DNN/S-NSSAI is utilized as identification of impacted or non-impacted
temporary data.
NFs (e.g. PCF, UDM, NEF) that receives the notification of UDR temporary data
loss or corruption event need to trigger the corresponding NFs (e.g. AMF, SMF,
SMSF) to perform re-synchronization procedure.
NFs (e.g. AMF, SMF, SMSF) that receives the notification of impacted or non-
impacted temporary data need to perform the corresponding re-synchronization
procedure.
# 7 Evaluations
## 7.1 Evaluation of Solutions for Key Issues#1, 2, 3, 4, 5, 6
### 7.1.1 Overview of the evaluation
Evaluation is performed per categorized procedure step as is shown below from
a to f, which is not necessarily linked to categorization of key issues.
a) Preparation of profile in NF
b) Notification path from UDR to NF
c) Notification content
d) Synchronization trigger
e) Synchronization procedure
f) Other
Evaluation starts with an overview table summarizing characteristics of each
solution and if it is compliant with architectural requirements, and then goes
into detailed investigation of each categories.
Table 7.1-1: Solution characteristics and compliance to architectural
requirements
+---------+---------+---------+---------+---------+---------+---------+ | **S |** a)**|** b)**|** c)**|** d)**|** e)**|** f)**| | olution |** Prepa | **Notif |** Notif | **S |** S | ** | | No**| ration\ | ication | ication | ynchron | ynchron | Other** | | | in | path | co | ization | ization | | | | profile | from | ntent**| tr | proc | | | | in NF** | UDR to | | igger**| edure** | | | | | NF**| | | | | +---------+---------+---------+---------+---------+---------+---------+ |** 1\ | Stores | Via NRF | UDR Id, | e.g. UE | - | - | | Option | UDR Id, | to NF | r | p | | | | A**| regis | (NOTE | ecovery | eriodic | | | | | tration | 4) | time | regist | | | | | time | | (NOTE | ration. | | | | | (NOTE | | 4) | | | | | | 4) | | | | | | +---------+---------+---------+---------+---------+---------+---------+ |** 1\ | Stores | Direct | SUPI | The | - | - | | Option | regis | to UDM, | range, | same | | | | B**| tration | then | partial | above | | | | | time | via NRF | r | | | | | | | to NF. | ecovery | | | | | | | | time | | | | | | | | (NOTE | | | | | | | | 5) | | | | +---------+---------+---------+---------+---------+---------+---------+ |** 2**| ( | ( | ( | ( | - | - | | | Sol#1) | Sol#1) | Sol#1) | Sol#1) | | | | | | | | + AMF | | | | | | | | event | | | | | | | | e | | | | | | | | xposure | | | | | | | | (NOTE | | | | | | | | 3) | | | +---------+---------+---------+---------+---------+---------+---------+ |** 3**| ( | ( | ( | ( | - | - | | | Sol#1) | Sol#1) | Sol#1) | Sol#1) | | | | | | | | + AMF | | | | | | | | event | | | | | | | | e | | | | | | | | xposure | | | | | | | | (NOTE | | | | | | | | 3) | | | +---------+---------+---------+---------+---------+---------+---------+ |** 4**| ( | ( | ( | ( | - | - | | | Sol#1) | Sol#1) | Sol#1) | Sol#1) | | | | | | | | + | | | | | | | | message | | | | | | | | from | | | | | | | | AMF to | | | | | | | | SMSF | | | | | | | | (NOTE | | | | | | | | 3) | | | +---------+---------+---------+---------+---------+---------+---------+ |** 5**| - | Via NRF | Partial | Local | - | NRF | | | | to UDM. | update | policy | | does | | | | Then NF | ind | | | not | | | | fetches | icator, | | | store | | | | from | SUPI | | | partial | | | | UDM. | ran | | | update | | | | (NOTE | ge/GPSI | | | in | | | | 2) | range, | | | dicator | | | | | r | | | in | | | | | ecovery | | | UDR/UDM | | | | | time | | | NF | | | | | (NOTE | | | p | | | | | 5) | | | rofile. | +---------+---------+---------+---------+---------+---------+---------+ |** 6**| ( | Via NRF | ( | ( | - | ( | | | Sol#5) | to UDM, | Sol#5) | Sol#5) | | Sol#5) | | | | then | | | | | | | | via NRF | | | | | | | | to NF. | | | | | +---------+---------+---------+---------+---------+---------+---------+ |** 7**| Stores | Direct | i | Local | Starts | - | | | last | to UDM, | mpacted | policy | with | | | | s | then | r | | the | | | | ynchron | via NRF | esource | | Update | | | | ization | to NF | names, | | method | | | | time | | partia | | not to | | | | | | lLastRe | | create | | | | | | plicati | | dup | | | | | | onTime, | | licated | | | | | | and | | re | | | | | | parti | | sources | | | | | | alRecov | | in UDR | | | | | | eryTime | | | | +---------+---------+---------+---------+---------+---------+---------+ |** 8**| Stores | Via NRF | R | Local | - | - | | | R | to NF | eset-ID | policy | | | | | eset-ID | (NOTE | | | | | | | | 4) | | | | | +---------+---------+---------+---------+---------+---------+---------+ |** 9**| Stores | Direct | R | Local | - | - | | | (Res | to UDM, | eset-ID | policy | | | | | et-ID), | then | or SUPI | | | | | | last | via NRF | range, | | | | | | s | to NF | partia | | | | | | ynchron | | lLastRe | | | | | | ization | | plicati | | | | | | time | | onTime, | | | | | | | | and | | | | | | | | parti | | | | | | | | alRecov | | | | | | | | eryTime | | | | +---------+---------+---------+---------+---------+---------+---------+ |** 10**| ti | - | - | - | I | - | | | mestamp | | | | ncludes | | | | of last | | | | ti | | | | radio | | | | mestamp | | | | c | | | | of last | | | | ontact, | | | | radio | | | | regis | | | | c | | | | tration | | | | ontact, | | | | time | | | | regis | | | | | | | | tration | | | | | | | | time, | | | | | | | | or flag | | | | | | | | ( | | | | | | | | UdrRest | | | | | | | | artInd) | | | | | | | | to | | | | | | | | avoid | | | | | | | | ov | | | | | | | | erwrite | | | | | | | | by an | | | | | | | | old NF. | | +---------+---------+---------+---------+---------+---------+---------+ |** 11**| - | - | - | - | I | - | | | | | | | ncludes | | | | | | | | flag | | | | | | | | ( | | | | | | | | UdrRest | | | | | | | | artInd) | | | | | | | | to deal | | | | | | | | with | | | | | | | | A | | | | | | | | MF-AUSF | | | | | | | | race | | | | | | | | co | | | | | | | | ndition | | +---------+---------+---------+---------+---------+---------+---------+ |** 12**| ti | - | - | - | I | - | | | mestamp | | | | ncludes | | | | of | | | | ti | | | | authent | | | | mestamp | | | | ication | | | | of | | | | | | | | authent | | | | | | | | ication | | | | | | | | for | | | | | | | | AUSF | | | | | | | | r | | | | | | | | ecovery | | +---------+---------+---------+---------+---------+---------+---------+ |** 13**| ( | Direct | ( | ( | ( | - | | | Sol#7) | to UDM | Sol#7) | Sol#7) | Sol#7) | | | | | (based | | | | | | | | on | | | | | | | | i | | | | | | | | mplicit | | | | | | | | subscri | | | | | | | | ption), | | | | | | | | then | | | | | | | | via NRF | | | | | | | | to NF | | | | | +---------+---------+---------+---------+---------+---------+---------+ |** 14**| - | - | - | Local | Defers | | | | | | | policy, | AMF | | | | | | | in the | regis | | | | | | | end, UE | tration | | | | | | | p | to deal | | | | | | | eriodic | with | | | | | | | regis | A | | | | | | | tration | MF-AUSF | | | | | | | | race | | | | | | | | co | | | | | | | | ndition | | +---------+---------+---------+---------+---------+---------+---------+ |** 15**| - | Via NRF | - | - | - | - | | | | to NF | | | | | | | | | | | | | | | | (NOTE | | | | | | | | 4) | | | | | +---------+---------+---------+---------+---------+---------+---------+ |** 16**| - | Direct | - | - | - | - | | | | to UDM, | | | | | | | | then | | | | | | | | via NRF | | | | | | | | to NF | | | | | +---------+---------+---------+---------+---------+---------+---------+ |** 17**| - | Via a | - | - | - | - | | | | new NRF | | | | | | | | service | | | | | | | | to NF | | | | | +---------+---------+---------+---------+---------+---------+---------+ |** 18**| - | Via a | - | - | - | - | | | | new NF | | | | | | | | (i.e. | | | | | | | | DRNF) | | | | | | | | to NF | | | | | +---------+---------+---------+---------+---------+---------+---------+ |** 19 __| - | Via UDM | Identif | UE | - | - | | | | | ication | a | | | | | | | of the | ctivity | | | | | | | time | | | | | | | | period | | | | | | | | where | | | | | | | | there | | | | | | | | may be | | | | | | | | data | | | | | | | | in | | | | | | | | consist | | | | | | | | encies, | | | | | | | | (op | | | | | | | | tional) | | | | | | | | a | | | | | | | | ffected | | | | | | | | sub | | | | | | | | scriber | | | | | | | | ids | | | | +---------+---------+---------+---------+---------+---------+---------+ | NOTE 1: | | | | | | | | Hatched | | | | | | | | cells | | | | | | | | are not | | | | | | | | co | | | | | | | | mpliant | | | | | | | | with | | | | | | | | one of | | | | | | | | archit | | | | | | | | ectural | | | | | | | | requir | | | | | | | | ements. | | | | | | | | | | | | | | | | NOTE 2: | | | | | | | | A | | | | | | | | notif | | | | | | | | ication | | | | | | | | me | | | | | | | | chanism | | | | | | | | that | | | | | | | | relies | | | | | | | | on NF | | | | | | | | ini | | | | | | | | tiating | | | | | | | | to | | | | | | | | fetch | | | | | | | | (e.g. | | | | | | | | Sol#5) | | | | | | | | does | | | | | | | | not | | | | | | | | satisfy | | | | | | | | a | | | | | | | | requ | | | | | | | | irement | | | | | | | | \"_ The | | | | | | | | impact | | | | | | | | to user | | | | | | | | exp | | | | | | | | erience | | | | | | | | due to | | | | | | | | cor | | | | | | | | ruption | | | | | | | | of | | | | | | | | p | | | | | | | | rofiles | | | | | | | | stored | | | | | | | | at UDR | | | | | | | | shall | | | | | | | | be | | | | | | | | avoi | | | | | | | | ded_\", | | | | | | | | when NF | | | | | | | | is e.g. | | | | | | | | SMF or | | | | | | | | SMSF. | | | | | | | | S | | | | | | | | MF/SMSF | | | | | | | | does | | | | | | | | not get | | | | | | | | a | | | | | | | | trigger | | | | | | | | for | | | | | | | | s | | | | | | | | ynchron | | | | | | | | ization | | | | | | | | for | | | | | | | | long. | | | | | | | | | | | | | | | | NOTE 3: | | | | | | | | S | | | | | | | | ynchron | | | | | | | | ization | | | | | | | | trigger | | | | | | | | based | | | | | | | | on AMF | | | | | | | | (e.g. | | | | | | | | Sol#2, | | | | | | | | 3, 4) | | | | | | | | does | | | | | | | | not | | | | | | | | satisfy | | | | | | | | a | | | | | | | | requ | | | | | | | | irement | | | | | | | | \ | | | | | | | | "_Burst | | | | | | | | si | | | | | | | | gnaling | | | | | | | | due to | | | | | | | | rest | | | | | | | | oration | | | | | | | | of | | | | | | | | p | | | | | | | | rofiles | | | | | | | | shall | | | | | | | | be | | | | | | | | min | | | | | | | | imal_ \" | | | | | | | | with | | | | | | | | regards | | | | | | | | to AMF. | | | | | | | | | | | | | | | | NOTE 4: | | | | | | | | Vis | | | | | | | | ibility | | | | | | | | of UDR | | | | | | | | to e.g. | | | | | | | | AMF | | | | | | | | (e.g. | | | | | | | | S | | | | | | | | ol#1A, | | | | | | | | 8) does | | | | | | | | not | | | | | | | | satisfy | | | | | | | | a | | | | | | | | requ | | | | | | | | irement | | | | | | | | \"_All | | | | | | | | commun | | | | | | | | ication | | | | | | | | between | | | | | | | | UDR and | | | | | | | | serving | | | | | | | | NFs, | | | | | | | | e.g. | | | | | | | | AMF, | | | | | | | | SMF and | | | | | | | | SMSF, | | | | | | | | are | | | | | | | | always | | | | | | | | via | | | | | | | | UDM._ \" | | | | | | | | | | | | | | | | NOTE 5: | | | | | | | | Using | | | | | | | | only | | | | | | | | SUPI | | | | | | | | ran | | | | | | | | ge/GPSI | | | | | | | | range | | | | | | | | to | | | | | | | | i | | | | | | | | dentify | | | | | | | | i | | | | | | | | mpacted | | | | | | | | parts | | | | | | | | does | | | | | | | | not | | | | | | | | allow | | | | | | | | t | | | | | | | | reating | | | | | | | | e.g. | | | | | | | | subsc | | | | | | | | ription | | | | | | | | to | | | | | | | | notifi | | | | | | | | cations | | | | | | | | from | | | | | | | | UDM to | | | | | | | | AMF/S | | | | | | | | MF/SMSF | | | | | | | | w.r.t. | | | | | | | | shared | | | | | | | | data | | | | | | | | change. | | | | | | | +---------+---------+---------+---------+---------+---------+---------+
### 7.1.2 Preparation of profile in NF
Following is the evaluation for \"a) Preparation of profile in NF\":
\- Sol#1\~4, 7, and 9 propose to use either [registration time]{.underline} or
last synchronization time to limit number of profiles that require
synchronization, by using it together with (partial) recovery time and
partialLastReplicationTime, which are explained in step c below. Description
of Sol#7 and 9 suggests registration time can be used instead of last
synchronization time, if only UDM is considered as a frontend and AMF/SMF/SMSF
is a concerned NF. Registration time is already specified between UDM and UDR,
although not to AMF/SMF/SMSF.
\- Sol#10 proposes to store timestamp of last radio contact or [registration
time]{.underline} for later use to avoid overwrite of synchronization message
by an old NF (i.e. AMF, SMSF).
\- Sol#12 proposes to store [timestamp of authentication]{.underline} for
later use to avoid overwrite of synchronization message by an old NF (i.e.
AUSF). Timestamp of authentication is already specified.
\- Sol#8 and 9 propose to use [Reset ID]{.underline} to identify profiles that
require synchronization. The concept of Reset ID is well known from legacy
protocols. However the granularity of restoration is pre-set. Even if the
impacted profiles turn out to be limited, synchronization signalling burden
cannot be reduced beyond granularity of Reset-ID.
\- Sol#19 does not require the usage of the NF profile. The usage of the NF
profile to include information about potential UDR data inconsistency,
including information about impacted subscribers and inconsistency time
period, does over complicate the NF profile definition and usage, including
information of a different nature than the one included today. As well, the
need to use NRF Discovery service to get this Restoration information is
outside the purpose of this service.
\- Sol#22 proposes to use [DNN/S-NSSAI]{.underline} as new granularity to
identify profiles that requires synchronization, it can be utilized to limit
the scope of the synchronization to limit combinations of DNN/S-NSSAI(s), and
can be further utilized together with Reset ID proposed in Sol#9.
### 7.1.3 Notification path from UDR to NF (Evaluation of Solutions for Key
Issue#6)
Following is the evaluation for \"b) Notification path from UDR to NF\":
\- Sol#1A and 8 propose a path from UDR [via NRF to NF]{.underline}. This path
does not satisfy a requirement \"_All communication between UDR and serving
NFs, e.g. AMF, SMF and SMSF, are always via UDM._ \" However some companies
observe this option is to be allowed.
\- Sol#1B, 7, 9, and 13 propose a path from UDR direct to UDM, then [via NRF
to NF]{.underline}. Sol#13 enables the path from UDR direct to UDM using an
implicit subscription.
\- Sol#6 proposes a path from UDR via NRF to UDM, then [via NRF to
NF]{.underline}.
\- A disadvantage of solution#15 is that it requires consumers of UDR
consumers (e.g. AMF) to subscribe at the NRF on changes of an UDR specific
resource. With this solution the AMF is not agnostic of UDR existence.
\- A disadvantage of solution #16 is that UDR consumers (e.g. UDM) are
involved in the notification path.
\- An advantage of solution #17 is that a single resource at the NRF is used
to create restoration events from any UDR in the network. This single resource
can be subscribed by consumers of UDR consumers (e.g. AMF) without the need to
keep track of registrations/de-registrations of UDRs/UDMs in the network.
\- Solution #18 has the same advantages as solution #17. In addition it
decouples the restoration from NRF functionality. The new DRNF can be co-
located with the NRF or with any other NF.
\- Sol#19 decouples the new restoration functionality from the NRF
functionality. This solution defines a direct path from the UDR to its
consumers (UDM, PCF, NEF), and similarly from UDM to its consumers (AMF, SMF,
SMSF, NEF). This direct communication is based on existing \"default
subscription to notification\" mechanism that is defined in NF notification
receiver profile. In addition, this mechanism is not affected by the UDR
potential data loss, since the \"default subscription to notification\"
endpoint is stored in the NF profile of the consumer, that is, it does not
rely in e.g., subscriptions stored in the UDR.\ Then, this solution minimizes
the number of elements in the network that are required to be impacted, that
is, only the NF consumers that need to receive the notification as well as the
notification senders. The fact that the NF consumers receive directly the
indication of \"Potential UDR Data Inconsistency\" has the advantage that
these elements are the ones that has the knowledge to react upon, without the
intervention of any other intermediate elements (e.g., NRF).
\- Sol#20 combines Sol#17, Sol#18, and Sol#19, and inherits advantages of
those, by introducing RCF which allows UDR consumer or its end consumer to
either explicitly or implicitly subscribe to notifications in case UDR fails.
\- Sol#21 is based on Sol#20 except with the difference that end consumer,
i.e. consumer of UDR consumer such as AMF, is not entitled for explicit
subscription to notifications. With this option there are less impacts to end
consumers regarding discovery of RCF (whether the support exists or not,
including roaming scenario), and on number of signaling from end consumer.
\- For both solutions #20 and #21, following concerns were raised, and as a
result it was seen that these solutions were not seen as optimal way forward:
\- Introducing a new NF only for a very rare UDR failure, which might even be
rare with the cloud-based technology, was not seen as useful.
\- Use of new NF is complex, and solution with complex mechanism should be
avoided.
\- Introducing new NF for the sake of providing stateless UDM was not seen
effective, as it is only cascading the state to another entity.
\- In order to avoid introducing new NF, possibility of new Service without
binding to specific NF was discussed, however current stage2 specification
does not allow such deployment and concluded such approach should not be taken
to introduce the Service proposed in the two solutions.
\- Solution #21 could have several implementation options to realize RCF, but
it was seen such optionality is not helpful for operators deciding how to
deploy the feature.
### 7.1.4 Notification content
Following is the evaluation for \"c) Notification content\":
\- Sol#1\~7 and 9 propose [(partial) recovery time]{.underline} to limit
number of profiles that require synchronization, by using it with registration
time. Recovery time is already specified in the definition of NF profile.
\- Sol#7 and 9 propose [partialLastReplicationTime]{.underline} to further
limit number of profiles that require synchronization, by using it with
registration time and (partial) recovery time.
\- Sol#1B, 5, 6, and 9 propose to use [SUPI range(/GPSI range)]{.underline} to
identify profiles that require synchronization. The concept of using those to
identify impacted profiles is well known from legacy protocols, where the IE
was named as User Id List (e.g. 3GPP TS 29.272 [4]) instead of SUPI
ranges(/GPSI ranges). However using only SUPI range(/GPSI range) to identify
impacted profiles does not allow treating e.g. subscription to notifications
from UDM to AMF/SMF/SMSF w.r.t. shared data change.
\- Sol#8 and 9 propose to use [Reset ID]{.underline} to identify profiles that
require synchronization.
\- Sol#7 proposes to use impacted resource names to identify profiles that
require synchronization. It is dubious whether UDR can keep all the
information to construct the impacted resource names when the UDR fails and
restarts. In addition, mapping of resource names in UDR and resource names in
e.g. UDM is not easy. The message content of restoration notification could
become complicated.
\- Sol#19 is flexible with the inclusion of user identifiers, it allows to
include SUPI/GPSI ranges, or Reset ID (like Sol8 and Sol9) or as well UDR
Group ID (in case of a partitioned network where the UDR providing service to
a partition, identified by UDR Group ID, is potentially suffering a data
inconsistency).
\- Sol#22 proposes to use DNN/S-NSSAI to identify profiles that require
synchronization.
### 7.1.5 Synchronization trigger
Following is the evaluation for \"d) Synchronization trigger\":
\- Sol#1\~4 propose to use [UE radio contact]{.underline} e.g. UE periodic
registration for synchronization trigger.
\- Sol#5\~9 propose to use [local policy]{.underline} for synchronization
trigger.
\- Sol#14 proposes to use local policy and at latest UE radio contact e.g. UE
periodic registration for synchronization trigger for Nudm_UECM from AMF when
AMF-AUSF race condition exists.
\- Sol#19 proposes a mechanism to avoid massive signalling based on marking
affected users at reception of the notification request in the NF consumer,
and then if any synchronization towards UDR is possible, this will be
triggered based on UE activity. For NEF is specifically of importance the
notification of UE activity via the UDM, so to avoid extra complexity in the
NEF to avoid the need to pace the synchronization requests towards UDR.
### 7.1.6 Synchronization procedure
Following is the evaluation for \"e) Synchronization procedure\":
\- Sol#7 proposes to start with the Update method (not with the Create method)
not to create duplicated resources in UDR.
\- Sol#10 proposes to include timestamp of last radio contact, [registration
time]{.underline}, or flag (UdrRestartInd) to avoid overwrite of
synchronization message by an old NF (i.e. AMF, SMSF).
\- Sol#12 proposes to include [timestamp of authentication]{.underline} to
avoid overwrite of synchronization message by an old NF (i.e. AUSF).
\- Sol#11 proposes to include flag (UdrRestartInd) to deal with AMF-AUSF race
condition, where AUSF temporarily skips check with UE\'s authentication
status. There remains security concern.
\- Sol#14 proposes to defer Nudm_UECM from AMF when AMF-AUSF race condition
exists. Potentially synchronization timing is deferred.
### 7.1.7 Other
Following is the evaluation for \"f. Other\":
\- Sol#19 provide following advantages:
\- This solution is valid for a deployment with a monolithic UDM.
\- This solution warranties that only direct consumers of UDR (i.e., UDM, PCF
and NEF) are able to receive information about the \"Potential UDR Data
Inconsistency\". In other solutions, this principle is not respected, so an
e.g., AMF may receive information about UDR and is forced to interpret that,
when the AMF should not know anything about UDR since it does not consume any
UDR service.
\- A disadvantage of Sol#19 is that, to address roaming cases, this solution
requires the UDM to setup and maintain in local non-volatile memory a dynamic
list of \"service consumers to be restored\", e.g., AMFs/SMFs/SMSFs that have
registered and NFs that have subscribed to data change notifications or event
occurrence notifications. Sharing this list across UDM instances of a UDM
set/group may require the use of a UDSF or other implementation-dependent
replication technique.
\- A disadvantage of Sol#17 and Sol#18 is that they require signaling (in
particular, inter-PLMN signaling) as a constant preventive step that increase
complexity and load unnecessarily, to potentially cover an event that is
expected to be exceptionally rare (e.g. less than once a year). For example,
Sol#18 requires to register (as well as unregister when there are no more
subscribers in that serving node) all the serving nodes in both H-PLMN and
V-PLMN and keep this as persistent information in the DRNF (that needs to
survive failures).
\- A disadvantage of Sol#18 is that it requires that each serving node
discovers the DRNF that corresponds to each NF producer (it is unclear which
data should be used for such discovery; it could be the UE ID, the UE Routing
ID, the UDM Group ID, the UE Reset ID..., but in principle it might have a
similar complexity and variability as a UDM discovery, for a given UE). It is
unclear how the DRNF is deployed in the network, and whether this may be
partitioned. As well, the DRNF has to register in the NRF considering the NFs
and/or subscribers it serves, leading to a non-trivial configuration of their
NF Profiles.
\- A disadvantage of Sol#18 is that it requires a robustness solution for the
new DRNF, rather that basing the solution on existing NFs.
# 8 Conclusions
## 8.1 Conclusion of Solutions for Key Issues#1, 2, 3, 4, 5
Conclusion is considered per categorized procedure step as is also for
evaluation.
It is recommended to adopt the following conclusion as the basis for the
normative work:
a) Preparation of profile in NF
\- AMF/SMF/SMSF stores [registration time]{.underline} that UDM forwards from
UDR. AUSF stores timestamp of authentication as is already specified.
\- UDM may send [Reset-ID]{.underline}. AMF/SMF/SMSF/AUSF stores it.
b) Notification path from UDR to NF
\- Based on Solution#19, i.e. notification directly from UDR consumer to end
consumer.
NOTE: Solution#19 can be improved to address the disadvantage as described in
clause 7.1.7.
c) Notification content
\- Notification includes (partial) recovery time and optionally
partialLastReplicationTime.
\- Notification includes SUPI range(/GPSI range) and/or Reset ID.
\- Notification includes DNN/S-NSSAI identifying the profiles that require
synchronization.
d) Synchronization trigger
\- Local policy.
e) Synchronization procedure
\- AMF/SMSF includes [registration time]{.underline}, if any. AUSF includes
timestamp of authentication, if any, as is already specified.
\- AMF may defer Nudm_UECM.
f) Other
\- N/A
#
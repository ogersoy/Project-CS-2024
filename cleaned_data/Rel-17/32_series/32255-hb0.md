# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope.
The present document is part of a series of documents that specify charging
functionality and charging management in 3GPP networks. The 3GPP core network
charging architecture and principles are specified in TS 32.240 [1], which
provides an umbrella for other charging management TSs that specify:
\- the content of the CDRs per domain / subsystem / service (offline
charging);
\- the content of real-time charging messages per domain / subsystem / service
(online charging);
\- the functionality of online and offline charging for those domains /
subsystems / services;
\- the interfaces that are used in the charging framework to transfer the
charging information (i.e. CDRs or charging events).
The complete document structure for these TSs is defined in TS 32.240 [1].
The present document specifies the converged offline and online charging
description for the 5G Data Connectivity domain based on the functional stage
2 description in TS 23.501 [200], TS 23.502 [201] and TS 23.503 [202].
This charging description includes the converged offline and online charging
architecture and scenarios specific to the 5G Data Connectivity domain, as
well as the mapping of the common 3GPP charging architecture specified in TS
32.240 [1] onto the 5G Data Connectivity domain.
It further specifies the structure and content of the CDRs for offline
charging, and the charging events for converged online and offline charging.
The present document is related to other 3GPP charging TSs as follows:
\- The common 3GPP charging architecture is specified in TS 32.240 [1].
\- The parameters, abstract syntax and encoding rules for the CDRs are
specified in TS 32.298 [51].
\- A transaction based mechanism for the transfer of CDRs within the network
is specified in TS 32.295 [54].
\- The file based mechanism used to transfer the CDRs from the network to the
operator\'s billing domain (e.g. the billing system or a mediation device) is
specified in TS 32.297 [52].
\- The services, operations and procedures of charging, using Service Based
Interface are specified in TS 32.290 [57].
\- The charging service of 5G system is specified in TS 32.291 [58].
All references, abbreviations, definitions, descriptions, principles and
requirements, used in the present document, that are common across 3GPP TSs,
are defined in TR 21.905 [100]. Those that are common across charging
management in 3GPP networks/domains, services or subsystems are provided in
the umbrella TS 32.240 [1] and are copied into clause 3 of the present
document for ease of reading. Finally, those items that are specific to the
present document are defined exclusively in the present document.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TS 32.240: \"Telecommunication management; Charging management;
Charging architecture and principles\".
[2] - [50] Void.
[51] 3GPP TS 32.298: \"Telecommunication management; Charging management;
Charging Data Record (CDR) parameter description\".
[52] 3GPP TS 32.297: \"Telecommunication management; Charging management;
Charging Data Record (CDR) file format and transfer\".
[53] Void.
[54] 3GPP TS 32.295: \"Telecommunication management; Charging management;
Charging Data Record (CDR) transfer\".
[55-56] Void.
[57] 3GPP TS 32.290: \"Telecommunication management; Charging management; 5G
system; Services, operations and procedures of charging using Service Based
Interface (SBI)\".
[58] 3GPP TS 32.291: \" Telecommunication management; Charging management; 5G
system; Charging service, stage 3\".
[59] - [99] Void.
[100] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[101] 3GPP TS 22.115: \"Service aspects; Charging and billing\".
[102] 3GPP TS 22.261: \"Service requirements for next generation new services
and markets\".
[103] - [199] Void
[200] 3GPP TS 23.501:\"System Architecture for the 5G System\".
[201] 3GPP TS 23.502:\"Procedures for the 5G System\".
[202] 3GPP TS 23.503:\"Policy and Charging Control Framework for the 5G
System; Stage 2\".
[203] 3GPP TS 23.316: \"Wireless and wireline convergence access support for
the 5G System (5GS)\".
[204] - [299] Void
[300] - [399] Void.
[400] - [499] Void.
[500] - [599] Void.
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [100] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
3GPP TR 21.905 [100].
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
Bd Reference point for the CDR file transfer from the 5G Data connectivity CGF
to the BD.
Ga Reference point for CDR transfer between a CDF and the CGF.
Nchf Service based interface exhibited by CHF.
N40 Reference point between SMF and the CHF.
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [100] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [100].
5GC 5G Core Network
5GS 5G System
ABMF Account Balance Management Function
AF Application Function
AMF Access and Mobility Management Function
ATSSS Access Traffic Steering, Switching, Splitting
AUSF Authentication Server Function
BD Billing Domain
CCS Converged Charging System
CDF Charging Data Function
CGF Charging Gateway Function
CHF Charging Function
CIoT Cellular Internet of Things
CP Control Plane
CTF Charging Trigger Function
DNN Data Network Name
FBC Flow Based Charging
IoT Internet of Things
GPSI Generic Public Subscription Identifier
GUAMI Globally Unique AMF Identifier
MA Multi-Access
MPTCP Multi-Path TCP Protocol
MTC Machine-Type Communications
N3IWF Non-3GPP InterWorking Function
NE Network Element
NEF Network Exposure Function
NF Network Function
NRF Network Repository Function
NSSF Network Slice Selection Function
OCF Online Charging Function
OCS Online Charging System
PCC Policy and Charging Control
PCF Policy Control Function
PEI Permanent Equipment Identifier
QBC QoS flow Based Charging
QFI QoS Flow Identifier
SCP Service Communication Proxy
SDF Service Data Flow
SMF Session Management Function
SSC Session and Service Continuity
SUPI Subscription Permanent Identifier
TNAN Trusted Non-3GPP Access Network
TNAP Trusted Non-3GPP Access Point
UDM Unified Data Management
UDR Unified Data Repository
UPF User Plane Function
# 4 Architecture considerations
## 4.1 High-level 5G System architecture
### 4.1.1 Non-roaming reference architecture
Figure 4.1.1.1 shows the 5G System high level architecture as defined in TS
23.501 [200] for 5G data connectivity, in the service-based representation for
Control Plane (CP) Network Functions.
{width="4.432638888888889in" height="2.2180555555555554in"}
**Figure 4.1.1.1: 5G System architecture**
### 4.1.2 Roaming Home Routed reference architecture
Figure 4.1.2.1 shows the 5G System high level Roaming Home Routed architecture
as defined in TS 23.501 [200] for 5G data connectivity, in the service-based
representation for Control Plane (CP) Network Functions.
Figure 4.1.2.1: Roaming 5G System architecture - home routed scenario in
service-based interface representation
### 4.1.3 Interworking with EPC architecture
Figure 4.1.3.1 shows the non-roaming architecture for interworking between 5GS
and EPC/E-UTRAN as defined in TS 23.501 [200] for 5G data connectivity.
Figure 4.1.3.1: Non-roaming architecture for interworking between 5GS and
EPC/E-UTRAN
NOTE: N26 interface is an inter-CN interface between the MME and 5GS AMF in
order to enable interworking between EPC and the NG core. Support of N26
interface in the network is optional for interworking.
### 4.1.4 Architecture reference for Non-3GPP Accesses
Figure 4.1.4.1 shows the non-roaming architecture for Non-3GPP Accesses as
defined in TS 23.501 [200] for 5G data connectivity.
Figure 4.1.4.1: Non-roaming architecture for Untrusted Non-3GPP Accesses
This reference architecture supports service based interfaces for AMF, SMF and
other NFs not represented in the figure.
Figure 4.1.4.2 shows the _non-roaming architecture for 5G Core Network with
trusted non-3GPP access_ as defined in TS 23.501 [200] for 5G data
connectivity.
_Figure 4.1.4.2: Non-roaming architecture for 5G Core Network with trusted
non-3GPP access_
_The UE is connected to the 5G Core Network over non-3GPP access._ This
reference architecture supports service based interfaces for AMF, SMF and
other NFs not represented in the figure.
### 4.1.5 Architecture for deployments topologies with specific SMF Service
Areas
#### 4.1.5.1 Non-roaming architecture with an I-SMF insertion without ULCL/BP
Figure 4.1.5.1 shows the 5G System high level non-roaming architecture, as
defined in TS 23.501 [200], with an I-SMF insertion to the PDU Session without
UL-CL/BP, using reference point representation.
Figure 4.1.5.1: Non-roaming architecture with I-SMF insertion to the PDU
Session in reference point representation, with no UL-CL/BP
#### 4.1.5.2 Non-roaming architecture with an I-SMF insertion with ULCL/BP
Figure 4.1.5.2 shows the 5G System high level non-roaming architecture, as
defined in TS 23.501 [200], for an I-SMF insertion to the PDU Session with UL-
CL/BP, using reference point representation.
Figure 4.1.5.2: Non-roaming architecture with I-SMF insertion to the PDU
Session in reference point representation, with UL-CL/BP
### 4.1.6 Architecture reference for ATSSS support
The 5G System Architecture references for the support of ATSSS in 5G data
connectivity charging are specified in TS 23.501 [200]:
\- Non-roaming: Figure 4.2.10-1.
\- Roaming with Home-routed architecture - UE registered to the same VPLMN:
Figure 4.2.10-2.
\- Roaming with Home-routed architecture - UE registered to different PLMNs:
Figure 4.2.10-3.
The Hybrid Access architecture of 5G-RG for the support of ATSSS in 5G data
connectivity charging is defined in clause 4.1.7.
### 4.1.7 Architecture reference for Wireline Access network
Figure 4.1.7.1 shows the non- roaming architecture for 5G Core Network for
5G-RG with Wireline 5G Access network and NG RAN as defined in TS 23.501 [200]
for 5G data connectivity.
Figure 4.1.7.1: Non- roaming architecture for 5G Core Network for 5G-RG with
Wireline 5G Access network and NG RAN
The 5G-RG can be connected to 5GC via W-5GAN, NG RAN or via both accesses. The
reference architecture in Figure 4.1.7.1 shows service based interfaces for
AMF, SMF and other NFs are not represented in this figure.
Non- roaming architecture for 5G Core Network for FN-RG with Wireline 5G
Access network is specified in TS 23.501 [200].
### 4.1.8 Roaming Local Breakout reference architecture
Figure 4.1.8.1 shows the 5G System high level Roaming Local Breakout
architecture as defined in TS 23.501 [200] for 5G data connectivity, in the
service-based representation for Control Plane (CP) Network Functions.
Figure 4.1.8.1: Roaming 5G System architecture- local breakout scenario in
service-based interface representation
## 4.2 5G data connectivity domain converged charging architecture
The SMF embedding the CTF, generates _charging events towards the CHF_ for
data connectivity converged charging or offline only charging.
_As described in TS 32.240 [1], the CTF generates charging events towards to
the CHF for converged online and offline charging processing. The CDRs
generation is performed by the CHF acting as a CDF, which transfers them to
the CGF.\ Finally, the CGF creates CDR files and forwards them to the BD._
If the CGF is external, the CHF acting as a CDF, forwards the CDRs to the CGF
across the Ga interface.\ If the CGF is integrated, there is only one internal
interface between the CHF and the CGF. In this case, the relationship between
CHF and CGF is 1:1. An integrated CGF may support the Ga interface from other
CDFs.
When an external CGF is used, this CGF may also be used by other, i.e.
non-5GCS, network elements, according to network design and operator decision.
It should be noted that the CGF may also be an integrated component of the BD
-- in this case, the Bd interface does not exist and is replaced by a
proprietary solution internal to the BD.
Figure 4.2.1 depicts the architectural options for converged charging in
service-based representation for CHF.
**Figure 4.2.1: 5G data connectivity converged charging architecture**
Architectural options of figure 4.2.1 apply to any 5G data connectivity
converged charging architectures in this clause.
Ga is described in clause 5.2.4 and Bd in clause 5.2.5. of the present
document and Nchf is described in TS 32.290 [57]..
Figure 4.2.2 depicts the 5G data connectivity converged charging architecture
in reference point representation for non-roaming:
Figure 4.2.2: 5G data connectivity converged charging architecture non-roaming
reference point representation
Figure 4.2.3 depicts the 5G data connectivity converged charging architecture
service-based representation for roaming Home Routed:
Figure 4.2.3: 5G data connectivity converged charging architecture roaming
Home Routed service based representation
Figure 4.2.4 depicts the 5G data connectivity converged charging architecture
for roaming Home Routed in reference point representation:
Figure 4.2.4: 5G data connectivity converged charging architecture in roaming
Home routed reference point representation
The N40 reference point is defined for the interactions between H-SMF and
H-CHF and between V-SMF and V-CHF in the reference point representation.
Figure 4.2.X depicts the 5G data connectivity converged charging architecture
service-based representation for roaming Local Breakout:
Figure 4.2.5: 5G data connectivity converged charging architecture roaming
Local Breakout scenario service based representation
Figure 4.2.5 depicts the 5G data connectivity converged charging architecture
for roaming Local breakout in reference point representation:
Figure 4.2.5: 5G data connectivity converged charging architecture in Local
breakout scenario reference point representation
The N40 reference point is defined for the interactions between V-SMF and
V-CHF, the N47 reference point is defined for the interactions between V-SMF
and H-CHF and in the reference point representation.
For scenarios with MVNO (owning a CHF referred to as A-CHF) non-roaming, the
N40 reference point is defined for the interactions between SMF and CHF owned
by MNO, the N47 reference point is used for the interactions between SMF owned
by the MNO and A-CHF owned by the MVNO in the reference point representationn.
N47 used by A-CHF owned by an additional actor (i.e. MVNO) to perform retail
charging for its own subscribers is operator specific.
# 5 5G data connectivity charging principles and scenarios
## 5.1 5G data connectivity charging principles
### 5.1.1 General
The charging functions specified for the 5G data connectivity charging:
\- PDU session in SMF, refer to TS 23.501 [200];
\- service data flows, within PDU session, refer to TS 23.503 [202].
\- QoS flows within PDU session refer to TS 23.501 [200] and TS 23.503 [202].
### 5.1.2 Requirements
The following are high-level charging requirements specific to the packet
domain, derived from the requirements in TS 22.115 [101], TS 22.261 [102], TS
23.501 [200], TS 23.502 [201] and TS 23.503 [202].
\- The SMF shall support converged online and offline charging.
\- The SMF may support offline only charging.
\- The SMF shall support PDU session charging using service based interface.
\- The SMF shall support network slice instance charging.
\- The SMF shall collect charging information per PDU session for UEs served
under 3GPP access and non-3GPP access (untrusted non-3GPP access, trusted
non-3GPP access and wireline).
\- Every PDU session shall be assigned a unique identity number for billing
purposes per PLMN. (i.e. the Charging Id).
\- Data volumes on both the uplink and downlink directions shall be counted
separately. The data volumes shall reflect the data as delivered to and
forwarded from the user.
\- The charging mechanisms shall provide the date and time information when
the PDU session starts.
\- The SMF shall be capable of handling the Charging Characteristics. Charging
Characteristics can be specific to a subscription or subscribed DNN.
\- The SMF may be capable of identifying data volumes, elapsed time or events
for individual service data flows (flow based charging). One PCC rule
identifies one service data flow.
\- SMF shall allow reporting of the service or the detected application usage
per rating group or per combination of the rating group and service id. This
reporting level can be activated per PCC rule.
\- The quota management shall be per rating group per PDU session.
\- If there are multiple UPFs for one PDU session, the quota management may be
one for all UPFs or separate per UPF and the usage and charging information
reporting per UPF.
\- The SMF shall support charging for PDU Session types of IP, Ethernet and
Unstructured.
\- In Home Routed scenario, the SMF shall collect charging information per PDU
session and, based on Home Operator policy and agreement between Home and
Visit Operators, shall be able to collect charging information per Qos Flow
for in-bound and out-bound roamers in Home Routed scenario.
\- In Local breakout scenarios, the SMF in VPLMN shall collect charging
information per QoS flow and, based on Visited Operator policy and agreement
between Home and Visit Operator, may be able to collect charging information
per service data flow for roamers in the LBO scenario.
\- For interworking between 5GS and EPC, the dedicated PGW-C + SMF shall
collect charging information using the same mechanisms as the SMF.
\- The SMF shall support PDU session charging when the PDU session is served
by both I-SMF and SMF.
\- The SMF shall support charging for MA PDU Connectivity Service over 3GPP
access and non-3GPP access.
\- The SMF in VPLMN and in HPLMN shall support charging for MA PDU
Connectivity Service in roaming Home Routed scenario with UE registered to the
same VPLMN for 3GPP access and non-3GPP access.
\- The SMF in HPLMN shall support charging for MA PDU Connectivity Service in
roaming Home Routed scenario with UE registered in different PLMNs.
\- The SMF shall support the charging of redundant transmission for high
reliability communication.
\- The SMF shall support the charging of 5G LAN VN group communication.
\- The SMF shall support the charging of 5GS CIoT.
### 5.1.3 Charging information
Charging information in the 5GC domain network is collected for each UE by the
SMFs. PDU session charging allows the SMF to collect and categorize per UE per
UPF per PDU session, charging information related to data volumes.
The SMF shall collect the following charging information for converged online
and offline charging:
\- usage of the access and core network resources: the charging information
shall describe the amount of data delivered to and forwarded from the UE;
\- usage duration: duration of PDU session is counted as the time interval
from PDU session establishment to PDU session release;
\- user: the charging information shall provide the actual UE addresses used
by the user for the PDU session;
\- data network: the charging information shall describe the data network
addresses with a level of accuracy as determined by the DNN;
\- usage of the external data networks: the charging information shall
describe the amount of data sent and received to and from the external data
network. External networks can be identified by the DNN;
\- start time: identifying the time when the PDU session was started;
\- user location: HPLMN, VPLMN, inside/outside presence reporting area, plus
optional higher-accuracy location information.
The service data flows categorization is achieved by rating group or
combination of the rating group and service id: i.e. based on the level of
reporting defined per PCC rule, counting per rating group or combination of
the rating group and service id. According to TS 23.503 [202], flow based
charging shall support different charging models per PCC rule. These charging
models may be based on volume, time and/or on number of events matching a
specific service data flow template in PCC rule.
For service data flows defined for FBC, the SMF shall collect the following
charging information:
\- the information described above for PDU session;
\- the amount of data transmitted in uplink and downlink directions
categorized by rating group or combination of the rating group and service id
when volume based charging applies;
\- the duration of service data flows is counted and categorized by rating
group or combination of the rating group and service id when time based
charging applies;
\- the number of events and corresponding time stamps categorized by rating
group or combination of the rating group and service id when event based
charging applies.
Within the PDU session the SMF shall collect the charging information for
service data flows per UPF, categorized by rating group or combination of the
rating group and service id.
Within the PDU session for local traffic offload scenarios with I-SMF
insertion, the SMF shall collect the charging information for service data
flows per I-SMF and categorized by rating group or combination of the rating
group and service id.
Editor\'s note: To have I-UPF as well as PSA2 UPF for the I-SMF controlled UPF
is FFS.
The user can be identified by a Generic Public Subscription Identifier (GPSI)
and/or a 5G Subscription Permanent Identifier (SUPI). For wireline access,
SUPI may be used to identify subscriber via wireline network as specified in
clause 5.9.2 of TS 23.501 [200].
### 5.1.4 Charging Identifier
Charging identifier is created to allow correlation of charging information.
For the SMF the charging identifier is assigned per PDU session including the
case of I-SMF insertion. At each PDU session establishment, i.e. , assignment
of a new PDU session id, a new PDU session specific Charging Identifier is
generated at the first SMF that processes the PDU session initiating request.
The Charging Identifier shall be unique within the SMF (that means that the
charging identifier is unique within the SMF set if SMF set is used) which
assigned it and is then used in all subsequent messages for that PDU session.
The Charging Identifier shall be used throughout the PDU session's lifetime
once assigned. In case of inter-system changes or handovers of PDU session,
the Charging Identifier is preserved while the PDU session Identifier is
preserved.
For EPS handover 5GS in Home routed scenario, the Charging Identifier for the
EPS PDN connection will be generated by PGW-C+SMF in HPLMN and transferred to
the SMF in VPLMN, if the V-SMF has already generated the Charging Identifier,
the value shall be replaced by a home provided Charging Identifier generated
by H-SMF.
For 5GS interworking with EPS, an EPS bearer Charging Identifier is assigned
by the PGW-C+SMF to each dedicated EPS bearer The EPS default bearer Charging
Identifier is the Charging Identifier assigned to the default bearer of PDU
connection.
For mobility from HPLMN with I-SMF to VPLMN in Home routed scenario, the
charging identifier for the PDU session will be generated by SMF in HPLMN and
transferred to the SMF in VPLMN, if the V-SMF has already generated a Charging
Identifier, the value shall be replaced by a home provided Charging Identifier
generated by H-SMF.
### 5.1.5 PCC rules and charging
#### 5.1.5.1 PCC rules and chargeable events
PCC rules can be activated, deactivated and modified at any time during the
PDU session lifetime. The following attribute can be modified by the PCF in a
dynamic PCC rule active in the SMF: Charging key, Service identifier, Sponsor
Identifier, Application Service Provider Identifier, Measurement method and
reporting level. The QoS Flow binding mechanism employed by the SMF upon
operations on PCC rules, may result in QoS Flows establishment, modification,
or release. This is specified in TS 23.503 [202].
Activities on PCC rules are not chargeable events. However, change of charging
rule in PCC rules will lead to chargeable events \"start of service data
flow\" and when this is the last service data flow for the original PCC rule,
\"termination of service data flow\".
The charging key (i.e. Rating group) is a piece of information used to request
online charging quotas as defined in TS 23.503 [202].
#### 5.1.5.2 Specific PCC rules scenarios
The capability of SMF to support Application Based Charging is achieved with
appropriate PCC rules activation in the SMF. Such PCC Rule shall be defined
with service data flow template including an Application Identifier for the
application which needs to be detected, enforced and charged. Application
detection mechanism in SMF is defined in TS 23.503 [202].
#### 5.1.5.3 PCC rules - MA PDU session
As specified with PCC Rule definition in clause 6.3.1 TS 23.503 [202], during
MA PDU session handling by the SMF, PCC Rules can be activated with a MA PDU
session control information attribute including an optional rating group for
Non-3GPP access, in addition to the rating group included in the PCC rule
description.
When the MA PDU session control information in a PCC Rule includes a separate
rating group for Non-3GPP access, it shall be used by the SMF for the SDF
traffic carried via non-3GPP access. The PCC Rule rating group shall be used
for the SDF traffic carried via 3GPP access, and all other charging related
attributes in the PCC rule shall be the used for both accesses.
When the MA PDU session control information in a PCC Rule does not include any
rating group for Non-3GPP access, the PCC Rule rating group shall be used by
the SMF for the SDF traffic carried via both accesses (i.e. 3GPP access and
non-3GPP access).
### 5.1.6 Session and Service Continuity modes
For any scenario of SSC modes specified in TS 23.501 [200], one Charging
Identifier shall correspond to a single PDU session ID.
As a result, from such SSC mode, a new Charging Identifier is generated by the
SMF for the new PDU session Id, and the charging session associated to the old
PDU session Id is released.
This behaviour applies to the following scenario:
\- PDU session anchor UPF relocation, in SSC mode 2;
\- PDU session anchor UPF relocation in SSC mode 3 with multiple PDU Sessions.
### 5.1.7 UE Presence in Presence Reporting Area (PRA)
During charging session lifetime, the CHF may provide the Presence Reporting
Area identifier to be activated for Core Network pre-configured Presence
Reporting Area(s) and additionally all of PRA Identifier(s) and list(s) of its
elements for UE-dedicated Presence Reporting Area(s) and provision the
\"Change of UE presence in Presence Reporting Area(s)\" trigger to the SMF to
request the reporting of Change of UE presence in Presence Reporting Area.
After such trigger is enabled, SMF shall close the current count, open a new
count with the initial status of UE presence in the PRA(s). In case of quota
management is required, a Charging Data Response [Update] including the
initial status is sent. UE presence status in the PRA(s) describes whether the
UE is entering or leaving Presence Reporting Area (s) and if the corresponding
Presence Reporting Area(s) is set to inactive by the serving node.
The CHF may modify the list of PRA Identifier(s) by providing the new Presence
Reporting Area(s) or by removing existing Presence Reporting Area(s) or modify
the list(s) of Presence Reporting Area elements by providing the updated
Presence Reporting Area.
The CHF may remove the trigger of change of UE presence in Presence Reporting
Area as defined in subclause 5.2.1.2, if previously activated.
### 5.1.8 CHF selection
The CHF selection by the SMF is done at the PDU session establishment, this
selection shall be based on the following and with this priority order
(highest to lowest):
\- CHF address(es) with possible associated CHF instance ID(s) and/or CHF set
ID(s) provided by the PCF for the PDU session.
\- UDM provided charging characteristics.
\- NRF based discovery.
\- SMF locally provisioned charging characteristics.
This means that if there are PCF provided CHF address(es) with possible
associated CHF instance ID(s) and/or CHF set ID(s) these shall be used,
otherwise if the UDM provides charging characteristics these shall be used. If
neither of these results in CHF address(es) the NRF can be used to discover
CHF instance(s) possibly within a CHF set, and as a last resource the SMF
locally provisioned charging characteristics shall be used.
When NRF is used for the CHF selection, and the PDU session charging method
indicates \"offline only\" for the PDU session, CHF instance(s) supporting CHF
\"offline only\" service instances may be selected.
### 5.1.9 Roaming
#### 5.1.9.1 General
In home routed scenario, based on roaming agreements between the V-PLMN and
the H-PLMN, for each UE roaming in VPLMN:
\- The SMF in VPLMN (V-SMF) shall be able to collect charging information per
QoS Flow within a PDU session when UE is determined as an in-bound roamer, for
CDR generation in VPLMN.
\- The SMF in HPLMN (H-SMF) shall be able to collect charging information per
QoS Flow within a PDU session when UE is determined as an out-bound roamer,
for CDR generation in HPLMN.
In home routed scenario, this charging information collection mechanism is
achieved under Roaming QoS flow Based Charging (QBC) performed by each PLMN,
based on a set of charging parameters exchanged between the V-SMF and the
H-SMF on a per PDU session basis.
In home routed scenario, the main parameters exchanged at PDU session
establishment are:
\- The Charging Identifier assigned by the V-SMF and transferred to the H-SMF
in the HPLMN.
\- Optionally, the \"Roaming Charging Profile\" negotiated between the VPLMN
and the HPLMN.
In home routed scenario, the parameters exchanged during the PDU session
handover from EPS to 5GS:
\- The home provided Charging Identifier which includes the Charging
Identifier assigned by the H-SMF to the original PDU session over EPS and
transferred by the H-SMF to the V-SMF. This home provided Charging Identifier
shall be used by the V-SMF to replace the existing Charging Identifier
previously generated by V-SMF.
\- Optionally, the \"Roaming Charging Profile\" negotiated between the VPLMN
and the HPLMN on 5GS side.
In roaming home routed PDU session, upon V-SMF change:
\- intra-PLMN V-SMF change: Charging Identifier, \"Roaming Charging Profile\"
and optionally CHF address are transferred from the old V-SMF to the new
V-SMF.
NOTE: how the new V-SMF selects the V-CHF is operator specific.
\- inter-PLMN V-SMF change: Charging Identifier is transferred from the old
V-SMF to the new V-SMF.
\- The \"Roaming Charging Profile\" is optionally exchanged between the new
V-SMF and the H-SMF as for a PDU session establishment.
In local breakout scenario, based on roaming agreements between the V-PLMN and
the H-PLMN, for each UE roaming in VPLMN:
\- The SMF in VPLMN (V-SMF) shall be able to collect charging information
within a PDU session when UE is determined as a roamer:
\- per QoS flow for CDR generation by V-CHF in VPLMN and CDR generation by
H-CHF in HPLMN;
\- per service data flow for converged charging, based on PCC rules from V-PCF
which uses locally configured policies according to the roaming agreement with
the HPLMN operator, when applicable:
\- with or without quota management to H-CHF in HPLMN;
\- without quota management to V-CHF in VPLMN.
> \- The SMF in VPLMN (V-SMF) shall be able to determine applicable
> combinations based on operator policy.
In local breakout scenario, the main parameters exchanged at PDU session
establishment are:
\- The Charging Identifier assigned by the V-SMF and reported to the V-CHF and
H-CHF.
\- Optionally, for QBC, the \"Roaming Charging Profile\" is used for the set
of triggers, associated category, and trigger thresholds and negotiated
between the VPLMN and the HPLMN
In roaming Home routed PDU session, when a UE moves from HPLMN with I-SMF
insertion to a VPLMN:
\- The home provided Charging Identifier assigned by the H-SMF to the original
PDU session and transferred by the H-SMF to the V-SMF. This home provided
Charging Identifier shall be used by the V-SMF to replace the existing
Charging Identifier previously generated by V-SMF.
\- Optionally, the \"Roaming Charging Profile\" negotiated between the VPLMN
and the HPLMN.
#### 5.1.9.2 CHF selection
In home routed scenario, at PDU session establishment, the CHF selection
mechanism specified in clause 5.1.8 applies to:
\- The V-SMF for CHF selection in VPLMN, with the following differences:
\- CHF address(es) selection mechanisms based on PCF and UDM are not
applicable.
\- When charging characteristics is used it will be based on local
configuration .
\- When NRF is used, the V-CHF can be selected based on UE identified as in-
bound roamer and the PLMN Id of the H-PLMN.
\- The H-SMF for CHF selection in HPLMN can be done as for non-roaming case.
In roaming home routed, PDU session upon V-SMF change:
\- Intra-PLMN V-SMF change: CHF address supplied by the old V-SMF shall be
used.
> \- Inter-PLMN V-SMF change: CHF selection mechanism as per V-SMF CHF
> selection in VPLMN at PDU session establishment.
In local breakout scenario, at PDU session establishment, the CHF selection
mechanism specified in clause 5.1.8 applies to:
\- The V-SMF for CHF selection in VPLMN, is the same as in the home routed
scenario.
\- The V-SMF for CHF selection in HPLMN, with the following differences.
\- CHF address(es) selection mechanisms based on PCF, UDM, and local
configuration are not applicable.
> \- NRF based discovery, the H-CHF can be selected based on the H-PLMN of the
> UE.
### 5.1.10 Data Volume Reporting for Secondary RAT usage
Volume reporting for Secondary RAT usage is an optional capability in the SMF
that provides usage reporting functionality when a Secondary RAT is used by
NG-RAN. Use of Secondary RAT refers to options supported by NG-RAN with dual
radio accesses, per NG-RAN definition in TS 23.501 [200]. This is valid for
both HPLMN and VPLMN.
The following principles are used:
\- The reporting of Secondary RAT Data Volume is controlled by the NG-RAN.
\- The uplink and downlink data volumes for the Secondary RAT are reported
(from NG-RAN to 5G Core) on a per QoS Flow basis and per time interval
(controlled by NG-RAN). The report contains Secondary RAT (e.g. E-UTRA)
resources used for transport of user data and indicated separately for uplink
and downlink per QoS Flow and per time interval. The time interval used for
the measurements reported (from NG-RAN) may be partitioned to indicate usage
that occurred before respectively after an absolute time (that occurs while
measurement for secondary RAT usage report is ongoing).
\- The reporting (performed by NG-RAN) in association with UE-related control
signaling and via standalone reporting is internally triggered by NG-RAN.
NOTE: Volumes for the secondary RAT are reported to the CHF in addition to,
and uncorrelated from volumes of reported usage, which are undifferentiated
between primary and secondary RAT. Considering both volumes would imply the
same traffic to be counted twice.
### 5.1.11 Charging method and Charging service selection
A PDU session charging method indicating \"offline only\", can be assigned to
a PDU session, to indicate a charging method applicable at PDU session level.
When there is no PDU session charging method indicating \"offline only\"
associated to a PDU session, for each PCC Rule:
\- if indicated for this PCC Rule, the required charging method applies;
\- otherwise (i.e. no required charging method is indicated for this PCC
Rule), the default charging method applies.
In this case, the converged charging service will be invoked by the SMF at the
PDU session establishment.
When a PDU session charging method indicates \"offline only\" for a PDU
session, offline charging method applies to all the PCC Rules activated during
the PDU session. In this case, at the PDU session establishment, the SMF can
select between the converged charging service or the offline only charging
service based on Operator policy.
This PDU session charging method can be received from PCF by the SMF or
configured in the SMF charging characteristics.
### 5.1.12 Emergency PDU session handling
Volume reporting for Emergency PDU Sessions is a capability in the SMF that
provides usage reporting functionality when a session is setup to provide
emergency services.
The following principles are used:
\- The reporting of Emergency PDU sessions is controlled by the SMF.
\- The uplink and downlink data volumes for Emergency PDU Session are
reported.
\- It includes either or both of an unauthenticated SUPI and a PEI (especially
applicable in the case where there is a UE without a UICC).
### 5.1.13 Support of deployments topologies with specific SMF Service Areas
Depending on scenario, a PDU Session in non-roaming case is either served by a
single SMF or served by an SMF and an I-SMF, specified in the clause 5.34 of
TS 23.501 [200].When a PDU Session is served by both an SMF and an I-SMF, the
SMF is the NF Consumer that has the interfaces towards CHF for I-SMF for the
case of an I-SMF insertion, relocation or removal.
For the following case with the I-SMF involved, the SMF shall collect the
charging information and report to CHF:
\- PDU session establishment, modification and release;
\- PDU Session message flows for N2 based handover procedure, with I-SMF
insertion/change/removal;
\- PDU Session message flows for Xn based handover procedure, with I-SMF
insertion/change/removal;
\- PDU Session message flows for Service Request, with I-SMF
insertion/change/removal
\- branching point or UL CL controlled by I-SMF.
### 5.1.14 Ultra Reliable Low Latency Communication
#### 5.1.14.1 General
The enhancement of the 5GS to support Ultra Reliable Low Latency Communication
(URLLC) is specified in the clause 5.33 of TS 23.501 [200]. For the redundant
transmission for high reliability communication, the SMF shall collect the
charging information for redundant transmission and report to CHF for the
following cases.
\- Dual Connectivity based end to end Redundant User Plane Paths;
\- Redundant transmission on N3/N9 interfaces;
\- Redundant transmission at transport layer.
#### 5.1.14.2 Support redundant transmission for high reliability
communication
The SMF reports the redundant transmission type to the CHF to indicate which
redundant transmission type is used for the PDU session or service data flow.
For dual connectivity based end to end Redundant User Plane Paths, the
charging information is collected independently per each redundant PDU
session. The quota is granted for each redundant PDU session independently.
The SMF reports the usage per redundant PDU session.
#### 5.1.14.3 QoS Monitoring to Assist URLLC Service
For the QoS Monitoring to Assist URLLC Service, the SMF may report the packet
delay measurement per QoS Flow per UE to CHF.
#### 5.1.14.4 Void
### 5.1.15 5G LAN-type Service Communication
#### 5.1.15.1 General
The SMF may support PDU Sessions for a 5G VN group which offers a virtual data
network capable of supporting 5G LAN-type service over the 5G system, which
specified in the TS 23.501[200].
The SMF embedding the CTF generates 5G VN group communication charging
information towards the CHF based on the user plane architecture with the
additional following options decribed in the clause 4.4.6 of TS 23.501[200] to
support 5G LAN-type service.
\- Figure 4.4.6.1-1 depicts the non-roaming user plane architecture to support
5G LAN-type service using local switch.
\- Figure 4.4.6.1-2 depicts the non-roaming user plane architecture to support
5G LAN-type service using N19 tunnel.
\- Figure 4.1.1 depicts the non-roaming user plane architecture to support 5G
LAN-type service using N6 tunnel.
#### 5.1.15.2 Support 5G VN group communication
In order to support the 5G VN group communication, the following principles
are used:
\- In includes the internal group identifier of 5G VN group, which is used to
indicate the 5G VN group and associate charging information for 5G VN group
communication.
\- The uplink and downlink data volumes of 5G VN group communiucation traffic
usage are reported separately.
\- The 5G VN group communication using N19 tunnel is measured based on the PDU
session charging.
\- SMF may report the traffic forwarding way information corresponding to the
5G VN group communication.
### 5.1.16 Support of Cellular IoT
The 5GS support for Cellular IoT (CIoT) is specified in TS 23.501 [200], this
includes EPC interworking and home-routed roaming. In legacy networks Cellular
IoT may be referred to as Machine Type Communications (MTC).
During the PDU session establishment (initial charging request) the SMF may
provide the following charging information related to 5GS CIoT:
> \- The indication of Control Plane 5GS CIoT optimization.
>
> \- Small data rate control indication.
>
> \- The RAT types (NB-IoT or LTE-M).
\- The control plane only indication.
### 5.1.17 Application based charging
If reporting on applications (e.g., edge application) is required it's
recommended to assign each application with its own service id.
## 5.2 5G data connectivity converged online and offline charging scenarios
### 5.2.1 Basic principles
#### 5.2.1.1 General
Converged charging may be performed by the SMF interacting with CHF using Nchf
specified in TS 32.290 [57] and TS 32.291 [58]. In order to provide the data
required for the management activities outlined in TS 32.240 [1] (Credit-
Control, accounting, billing, statistics etc.), the SMF shall be able to
perform converged charging for each of the following:
\- Charging data related to PDU session;
\- Charging data related to service data flows within the PDU session.
Converged charging includes quota management and usage reporting.
The SMF shall be able to report charging events to CDF for CDR generation.
The SMF shall be able to perform convergent charging by interacting with CHF,
for charging data related to PDU sessions. The Charging Data Request and
Charging Data Response are exchanged between the SMF and the CHF, based on
SCUR scenarios specified in TS 32.290 [57]. The Charging Data Request is
issued by the SMF towards the CHF when certain conditions (chargeable events)
are met.
The quota management is always per rating group, reporting level can be either
per rating group or per combination of the rating group and service id, which
is defined per PCC rule.
Converged charging uses centralized or decentralized unit determination and
centralized rating scenarios for session based convergent charging specified
in TS 32.290 [57].
The charging information collected per PDU session includes the network slice
instance the PDU session belongs to.
The contents and purpose of each charging event that triggers interaction with
CHF, as well as the chargeable events that trigger them, are described in the
following sub-clauses.
The SMF initiates a charging session with Charging Data Request/Response
[Initial], updates the charging session with Charging Data Request/Response
[Update], and terminates the charging session with Charging Data
Request/Response [Termination].
A detailed formal description of the converged charging parameters defined in
the present document is to be found in TS 32.291 [58].
A detailed formal description of the CDR parameters defined in the present
document is to be found in TS 32.298 [51].
In order to avoid a charging session remaining inactive for a long period of
time, upon expiry of the Unit Count Inactivity Timer, the charging session may
be terminated by the SMF sending Charging Data Request [Termination],
indicating the PDU session shall continue and the CHF can expect a later
Charging Data Request [Initial] request for the same PDU session with the
original Charging Identifier and new session identifier. The SMF may send its
locally configured value of the Unit Count Inactivity Timer to the CHF. The
CHF may respond with a new Unit Count Inactivity Timer for use in the SMF.
Whether the CHF may respond with a value of the Unit Count Inactivity Timer,
independent of if the CHF has received one previously from the SMF, is vendor
specific
#### 5.2.1.2 Applicable Triggers in the SMF
##### 5.2.1.2.1 General
When a charging event is issued towards the CHF, it includes details such as
Subscriber identifier (e.g. SUPI), Charging-id, etc. and also containers
identifying the volume count (separated for uplink and downlink traffic), with
charging condition change information.
Each trigger condition (i.e. chargeable event) defined for the 5G data
connectivity converged charging functionality with the associated behaviours
when metis specified in this document and the basic trigger mechanism is
specified in the TS 32.290[57].
Two categories of chargeable events are identified:
\- immediate report: chargeable events for which, when occurring, the current
counts are closed and sent together with the charging data generated by the
SMF towards the CHF in a Charging Data Request. New counts are started by the
SMF.
\- deferred report: chargeable events for which, when occurring, the current
counts are closed and stored together with the charging data generated by the
SMF. The stored counts will be sent to the CHF in next a Charging Data
Request. New counts are started by the SMF.
When more than one trigger condition to be met at same time (i.e. time stamp
of triggers is the same) for the same count in the SMF, the SMF reports the
used unit container with these triggers.
When a PDU session starts, and the converged charging is activated, the SMF
invokes a Charging Data Request [Initial] towards the CHF to get authorization
to start based on the default triggers. The SMF is optionally provided in a
Charging Data Response [Initial] to override the default triggers, with a set
of chargeable event triggers to be enabled, and the associated category (i.e.
immediate or deferred report).
The triggers remain active until they are updated or disabled by subsequent
Charging Data Response [Update] from the CHF or the PDU session is terminated.
A set of chargeable events are based on trigger thresholds and default ones
can be configured in Charging Characteristics which are described in Annex A.
The SMF is optionally provided in the Charging Data Response [Initial], with
trigger thresholds which override the default ones configured in the Charging
Characteristics selected by the SMF for the PDU session. They remain active
until they are updated by subsequent Charging Data Response [Update] from the
CHF or the PDU session is terminated.
When a trigger is enabled, the SMF needs to ensure that monitoring in UPF and
subscription from RAN are setup so that SMF can report the charging
information to the CHF if the chargeable event occurs.
##### 5.2.1.2.2 Flow Based Charging (FBC) triggers
The set of chargeable events and associated category, which shall be supported
by the SMF as the default, is specified in the sub-clause 5.2.1.4 for Flow
Based Charging.
Two level of triggers can be supplied by the CHF:
\- Triggers associated to the PDU session.
\- Triggers associated to a rating group within the PDU session.
The set of triggers along with their category (i.e. immediate or deferred
report) and level (i.e. per PDU session or per rating group), which can be
supplied by the CHF to the SMF for 5G data connectivity converged charging or
offline only charging are detailed in the sub-clause 5.2.1.4 for Flow Based
Charging.
##### 5.2.1.2.3 QoS flow Based Charging (QBC) triggers
The set of chargeable events and associated category, which shall be supported
by the SMF as the default for QoS flow Based Charging, when applicable, is
specified in the sub-clause 5.2.1.6.
Two level of triggers can be supplied by the CHF:
\- Triggers associated to the PDU session.
\- Triggers associated to a QoS Flow within the PDU session.
The set of triggers along with their category (i.e. immediate or deferred
report) and level (i.e. per PDU session or per QoS Flow), which can be
supplied by the CHF to the SMF for 5G data connectivity converged charging are
detailed in clause 5.2.1.6 for QBC.
In home routed scenario, when QBC is used in the context of roaming, the set
of triggers, their associated category, and trigger thresholds, compose the
\"Roaming Charging Profile\", which governs the SMF charging data generation,
synchronously between the V-SMF and the H-SMF when shared.
In local breakout scenario, the default \"Roaming charging profile\" for the
V-SMF is based on the "Charging characteristics", and may be set, changed,
applied, and transferred in the following order:
1\. Default set by V-SMF and transferred to V-CHF
2\. Changed by V-CHF and transferred to V-SMF
3\. Transferred from V-SMF to H-CHF
4\. Changed by H-CHF and transferred to V-SMF
5\. Applied in V-SMF and transferred to V-CHF
In local breakout scenario, support for \"Roaming changing profile\" exchange
is done by transferring it i.e., an NF may only change the \"Roaming charging
profile\" if it has received it. The \"Roaming charging profile\" resulting
from the exchange between the VPLMN and HPLMN shall remain valid until it is
replaced.
In local breakout scenario, the \"Roaming charging profile\" overrides any
triggers set or updated by the CHF for Roaming QBC.
#### 5.2.1.3 PDU session charging
Converged charging allows the SMF to collect charging information related to
data volumes sent to and received by the UE/MS per user per PDU session. The
user can be identified by SUPI.
If PDU session specific converged charging is supported, this is achieved by
FBC charging, with specific rating group/service identifier, see clause
5.2.1.4.
#### 5.2.1.4 Flow Based Charging (FBC)
For FBC charging, the SMF categorizes the service data flows within PDU
session data traffic by rating group and / or combination of the rating group
and service id. The level of the reporting and charging method is defined per
PCC rule. Details of this functionality are specified in TS 23.503 [202] and
TS 32.240 [1].
The SMF can include the QoS Information per rating group or per combination of
rating group/service id. If the QoS Information cannot be unambiguously
determined per rating group or per combination of rating group/service id, it
should be omitted.
NOTE: The SMF can only include one QoS Information occurrence per combination
of rating group/service id. This implies if an operator wishes to be able to
separate usage according to 5QI and ARP for the same charging method, they
will need to ensure that service data flows having different 5QI and ARP do
not have the same:
\- rating group in cases where rating reporting is used;
\- rating group/service id where rating group/service id reporting is used.
When a service data flow is governed by a PCC Rule indicated with \"Online\"
charging method, quota management is required for the service data flow. It
may also indicate if authorization for the service data flow is needed or not
before service delivery, i.e. blocking or non-blocking mode.
When a service data flow is governed by a PCC Rule indicated with \"Offline\"
charging method, quota management is not required for this service data flow.
Usage reporting is required for this service data flow without affecting the
delivery.
According to TS 23.503 [202], FBC shall support different charging models per
PCC rule. These charging models may be based on volume and/or time and on
number of events matching a specific service data flow template in PCC rule.
When a chargeable event occurs for which quota needs to be requested by the
SMF to the CHF, the type of requested quota may depend on measurement method
configured for the PCC rule.
In general, the charging of a service data flow shall be linked to the PDU
session under which the service data flow has been activated.
The amount of data counted shall be the user plane payload at the UPF
separated between UL and DL.
For PDU session specific charging, time metering shall start when PDU session
is activated.
Table 5.2.1.4.1 summarizes the set of default trigger conditions and their
category which shall be supported by the SMF. For \"immediate report\"
category, the table also provides the corresponding Charging Data Request
[Initial, Update, Termination] message sent from SMF towards the CHF.
Table 5.2.1.4.1: Default Trigger conditions in SMF
+---------+---------+---------+---------+---------+---------+---------+ | Trigger | Trigger | Co | Offline | CHF | CHF | Message | | Con | level | nverged | only | allowed | allowed | when | | ditions | | C | c | to | to | \"im | | | | harging | harging | change | enable | mediate | | | | default | default | c | and | repo | | | | c | c | ategory | disable | rting\" | | | | ategory | ategory | | | c | | | | | | | | ategory | +---------+---------+---------+---------+---------+---------+---------+ | Start | PDU | Im | Im | Not | Not | C | | of PDU | session | mediate | mediate | App | App | harging | | S | | | | licable | licable | Data | | ession. | | | | | | Request | | | | | | | | [In | | | | | | | | itial] | +---------+---------+---------+---------+---------+---------+---------+ | Start | RG | Im | Im | No | No | | | of the | | mediate | mediate | | | | | Service | | | | | | | | data | | | | | | | | flow | | | | | | | | and no | | | | | | | | c | | | | | | | | harging | | | | | | | | session | | | | | | | | exists. | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | * | C | | | | | | | _Change | harging | | | | | | | of | Data | | | | | | | C | Request | | | | | | | harging | [U | | | | | | | condi | pdate] | | | | | | | tions_ _| | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | QoS | PDU | D | D | Yes | Yes | | | change | s | eferred | eferred | | | | | | ession/ | | | | | | | | RG | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | GFBR | RG | D | D | Yes | Yes | | | gua | | eferred | eferred | | | | | ranteed | | | | | | | | status | | | | | | | | change | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | User | PDU | D | D | Yes | Yes | | | L | s | eferred | eferred | | | | | ocation | ession/ | | | | | | | change | RG | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Serving | PDU | D | D | Yes | Yes | | | Node | s | eferred | eferred | | | | | change | ession/ | | | | | | | | RG | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Change | PDU | D | D | Yes | Yes | | | of UE | s | eferred | eferred | | | | | p | ession/ | | | | | | | resence | RG | | | | | | | in | | | | | | | | P | | | | | | | | resence | | | | | | | | Re | | | | | | | | porting | | | | | | | | Area(s) | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Change | PDU | D | D | Yes | Yes | | | of 3GPP | s | eferred | eferred | | | | | PS Data | ession/ | | | | | | | off | RG | | | | | | | Status | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Tariff | PDU | D | D | No | No | | | time | s | eferred | eferred | | | | | change | ession/ | | | | | | | | RG | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | UE time | PDU | Im | D | Yes | Yes | | | zone | s | mediate | eferred | | | | | change | ession/ | | | | | | | | RG | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | PLMN | PDU | Im | D | Yes | Yes | | | change | s | mediate | eferred | | | | | | ession/ | | | | | | | | RG | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | RAT | PDU | Im | D | Yes | Yes | | | type | s | mediate | eferred | | | | | change | ession/ | | | | | | | | RG | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Sessi | PDU | Im | D | Yes | Yes | | | on-AMBR | session | mediate | eferred | | | | | change | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | A | PDU | Im | D | Yes | Yes | | | ddition | Ses | mediate | eferred | | | | | of UPF | sion/RG | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Removal | PDU | Im | D | Yes | Yes | | | of UPF | ses | mediate | eferred | | | | | | sion/RG | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | In | PDU | D | D | Yes | Yes | | | sertion | Session | eferred | eferred | | | | | of | | | | | | | | I-SMF | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Change | PDU | D | D | Yes | Yes | | | of | Session | eferred | eferred | | | | | I-SMF | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Removal | PDU | D | D | Yes | Yes | | | of | Session | eferred | eferred | | | | | I-SMF | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | H | PDU | Im | D | Yes | Yes | | | andover | session | mediate | eferred | | | | | cancel | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | H | PDU | Im | D | Yes | Yes | | | andover | session | mediate | eferred | | | | | start | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | H | PDU | Im | D | Yes | Yes | | | andover | session | mediate | eferred | | | | | c | | | | | | | | omplete | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | A | PDU | Im | D | Yes | Yes | | | ddition | s | mediate | eferred | | | | | of | ession/ | | | | | | | access | RG | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Removal | PDU | Im | D | Yes | Yes | | | of | s | mediate | eferred | | | | | access | ession/ | | | | | | | | RG | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Re | RG | Im | D | Yes | Yes | | | dundant | | mediate | eferred | | | | | trans | | | | | | | | mission | | | | | | | | change | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ |__Limit | | | | | | | | per PDU | | | | | | | | se | | | | | | | | ssion_ _| | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Expiry | PDU | Im | Im | No | Yes | | | of data | session | mediate | mediate | | | | | time | | | | | | | | limit | | | | | | | | per PDU | | | | | | | | session | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Expiry | PDU | Im | Im | No | Yes | | | of data | session | mediate | mediate | | | | | volume | | | | | | | | limit | | | | | | | | per PDU | | | | | | | | session | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Expiry | PDU | Im | Im | No | Yes | | | of data | session | mediate | mediate | | | | | event | | | | | | | | limit | | | | | | | | per PDU | | | | | | | | session | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Expiry | PDU | Im | Im | No | Yes | | | of | session | mediate | mediate | | | | | limit | | | | | | | | of | | | | | | | | number | | | | | | | | of | | | | | | | | c | | | | | | | | harging | | | | | | | | co | | | | | | | | ndition | | | | | | | | changes | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ |__Limit | | | | | | | | per | | | | | | | | Rating | | | | | | | | group_ _| | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Expiry | RG | D | D | Yes | Yes | | | of data | | eferred | eferred | | | | | time | | | | | | | | limit | | | | | | | | per | | | | | | | | rating | | | | | | | | group | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Expiry | RG | D | D | Yes | Yes | | | of data | | eferred | eferred | | | | | volume | | | | | | | | limit | | | | | | | | per | | | | | | | | rating | | | | | | | | group | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Expiry | RG | D | D | Yes | Yes | | | of data | | eferred | eferred | | | | | event | | | | | | | | limit | | | | | | | | per | | | | | | | | rating | | | | | | | | group | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ |__Quota | | | | | | | | manag | | | | | | | | ement_ _| | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Time | RG | Im | Not | No | Yes | | | th | | mediate | app | | | | | reshold | | | licable | | | | | reached | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Volume | RG | Im | Not | No | Yes | | | th | | mediate | app | | | | | reshold | | | licable | | | | | reached | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Unit | RG | Im | Not | No | Yes | | | th | | mediate | app | | | | | reshold | | | licable | | | | | reached | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Time | RG | Im | Not | No | Yes | | | quota | | mediate | app | | | | | ex | | | licable | | | | | hausted | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Volume | RG | Im | Not | No | Yes | | | quota | | mediate | app | | | | | ex | | | licable | | | | | hausted | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Unit | RG | Im | Not | No | Yes | | | quota | | mediate | app | | | | | ex | | | licable | | | | | hausted | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Expiry | RG | Im | Not | No | Yes | | | of | | mediate | app | | | | | quota | | | licable | | | | | v | | | | | | | | alidity | | | | | | | | time | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Expiry | RG | Im | Not | No | Yes | | | of | | mediate | app | | | | | quota | | | licable | | | | | holding | | | | | | | | time | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Re | RG | Im | Not | No | No | | | -author | | mediate | app | | | | | ization | | | licable | | | | | request | | | | | | | | by CHF | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Start | RG | Im | Not | No | No | | | of | | mediate | app | | | | | service | | | licable | | | | | data | | | | | | | | flow, | | | | | | | | in case | | | | | | | | no | | | | | | | | valid | | | | | | | | quota | | | | | | | | for | | | | | | | | this | | | | | | | | rating | | | | | | | | group | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Start | RG | Im | Not | No | No | | | of SDF | | mediate | app | | | | | add | | | licable | | | | | itional | | | | | | | | access, | | | | | | | | in case | | | | | | | | no | | | | | | | | valid | | | | | | | | quota | | | | | | | | for | | | | | | | | this | | | | | | | | access | | | | | | | | rating | | | | | | | | group | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ |__O | | | | | | | | thers_ * | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Term | RG | Im | Im | No | No | | | ination | | mediate | mediate | | | | | of | | | | | | | | service | | | | | | | | data | | | | | | | | flow - | | | | | | | | last | | | | | | | | service | | | | | | | | data | | | | | | | | flow | | | | | | | | under a | | | | | | | | given | | | | | | | | Rating | | | | | | | | Group. | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Man | PDU | Im | Im | No | No | | | agement | session | mediate | mediate | | | | | inter | | | | | | | | vention | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Expiry | PDU | Im | Not | No | No | C | | of Unit | session | mediate | app | | | harging | | Count | | | licable | | | Data | | Ina | | | | | | Request | | ctivity | | | | | | \ | | Timer | | | | | | [Termin | | | | | | | | ation] | +---------+---------+---------+---------+---------+---------+---------+ | End of | PDU | Im | Im | No | No | | | PDU | session | mediate | mediate | | | | | session | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | CHF | PDU | Im | Not | No | No | | | r | session | mediate | app | | | | | esponse | | | licable | | | | | with | | | | | | | | session | | | | | | | | term | | | | | | | | ination | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | Abort | PDU | Im | Im | No | No | | | request | session | mediate | mediate | | | | | is | | | | | | | | r | | | | | | | | eceived | | | | | | | | from | | | | | | | | the CHF | | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | > NOTE | | | | | | | | > 1: If | | | | | | | | > GFBR | | | | | | | | > gua | | | | | | | | ranteed | | | | | | | | > | | | | | | | | status | | | | | | | | > | | | | | | | | change | | | | | | | | > is | | | | | | | | > e | | | | | | | | nabled, | | | | | | | | > SMF | | | | | | | | > needs | | | | | | | | > to | | | | | | | | > | | | | | | | | ensure | | | | | | | | > the | | | | | | | | > | | | | | | | | request | | | | | | | | > for | | | | | | | | > the | | | | | | | | > notif | | | | | | | | ication | | | | | | | | > from | | | | | | | | > the | | | | | | | | > | | | | | | | | access | | | | | | | | > | | | | | | | | network | | | | | | | | > (i.e. | | | | | | | | > 3GPP | | | | | | | | > RAN) | | | | | | | | > when | | | | | | | | > the | | | | | | | | > GFBR | | | | | | | | > can | | | | | | | | > no | | | | | | | | > | | | | | | | | longer | | | | | | | | > (or | | | | | | | | > can | | | | | | | | > | | | | | | | | again) | | | | | | | | > be | | | | | | | | > gua | | | | | | | | ranteed | | | | | | | | > for a | | | | | | | | > QoS | | | | | | | | > Flow | | | | | | | | > | | | | | | | | during | | | | | | | | > the | | | | | | | | > l | | | | | | | | ifetime | | | | | | | | > of | | | | | | | | > the | | | | | | | | > QoS | | | | | | | | > Flow. | | | | | | | +---------+---------+---------+---------+---------+---------+---------+
The default \"Limit\" trigger conditions are trigger thresholds configured in
the Charging Characteristics applied to the PDU session. It shall be possible
for the CHF to override these default triggers when providing Charging Data
Response [Initial], either to disable the triggers, or to enable triggers new
thresholds value.
When the traffic is counted in more than one UPF, the CHF overrides these
default triggers of volume limit for the all UPFs.
For converged charging, the following details of chargeable events and
corresponding actions in the SMF are defined in Table 5.2.1.4.2:
Table 5.2.1.4.2: Chargeable events and their related actions in SMF
+----------------------+----------------------+----------------------+ | Chargeable event | Conditions | SMF action | +----------------------+----------------------+----------------------+ | Start of PDU session | | Charging Data | | | | Request [Initial] | | | | with a possible | | | | request quota for | | | | later use. | +----------------------+----------------------+----------------------+ | Start of service | If quota management | Charging Data | | data flow | is required, and | Request [Update] | | | valid quota for this | to request quota | | | rating group does | with a possible | | | not exist | amount of quota. | +----------------------+----------------------+----------------------+ | | If service | Start new counts | | | identifier level | with time stamps for | | | reporting is | the combination of | | | required by the PCC | the rating group and | | | rule | service id | +----------------------+----------------------+----------------------+ | | If rating group | Start new counts | | | level reporting is | with time stamps for | | | required by the PCC | the rating group | | | rule | | +----------------------+----------------------+----------------------+ | | If sponsored | Start new counts | | | connectivity level | with time stamps for | | | reporting is | the combination of | | | required by the PCC | the rating group, | | | rule | sponsor identity and | | | | application service | | | | provider identity | +----------------------+----------------------+----------------------+ | | If charging | Charging Data | | | resource, i.e. | Request [Initial] | | | charging session, | with a possible | | | for the PDU session | request quota | | | does not exist | | +----------------------+----------------------+----------------------+ | Start of SDF | If ATSSS is | Charging Data | | additional access | supported with | Request [Update] | | | access | to request quota | | | differentiated | with a possible | | | rating groups, quota | amount of quota. | | | management is | | | | required, and valid | | | | quota for this | | | | access rating group | | | | does not exist. | | +----------------------+----------------------+----------------------+ | | If ATSSS is | Start new counts | | | supported with | with time stamps for | | | access | the combination of | | | differentiated | the access rating | | | rating groups, | group and service id | | | service identifier | | | | level reporting is | | | | required by the PCC | | | | rule | | +----------------------+----------------------+----------------------+ | | If ATSSS is | Start new counts | | | supported with | with time stamps for | | | access | the access rating | | | differentiated | group | | | rating groups, | | | | rating group level | | | | reporting is | | | | required by the PCC | | | | rule | | +----------------------+----------------------+----------------------+ | | If ATSSS is | Start new counts | | | supported with | with time stamps for | | | access | the combination of | | | differentiated | the access rating | | | rating groups, | group, sponsor | | | sponsored | identity and | | | connectivity level | application service | | | reporting is | provider identity | | | required by the PCC | | | | rule | | +----------------------+----------------------+----------------------+ | Termination of | If service | Close the counts | | service data flow | identifier level | with time stamps | | | reporting is | | | | required by the PCC | | | | rule and this is the | | | | last service data | | | | flow for this | | | | combination of the | | | | rating group and | | | | service id | | +----------------------+----------------------+----------------------+ | | If rating group | Close the counts | | | level reporting is | with time stamps | | | required by the PCC | | | | rule and this is the | | | | last service data | | | | flow utilizing that | | | | specific rating | | | | group | | +----------------------+----------------------+----------------------+ | | If sponsored | Close the counts | | | connectivity level | with time stamps | | | reporting is | | | | required by the PCC | | | | rule and this was | | | | the last active | | | | service data flow | | | | for this combination | | | | of rating group, | | | | sponsor identity and | | | | application service | | | | provider identity | | +----------------------+----------------------+----------------------+ | Expiry of the Unit | If the corresponding | Charging Data | | Count Inactivity | trigger is enabled | Request | | Timer for the PDU | | [Termination], | | session | | indicating that | | | | charging session is | | | | terminated, and the | | | | PDU session is still | | | | active | | | | | | | | May include the | | | | configured Unit | | | | Count Inactivity | | | | Timer value | +----------------------+----------------------+----------------------+ | End of PDU session | | Charging Data | | in the SMF | | Request | | | | [Termination] | | | | | | | | Close the counts | | | | with time stamps | +----------------------+----------------------+----------------------+ | Quota specific | If the corresponding | Charging Data | | chargeable events | trigger is enabled | Request [Update] | | (e.g. threshold | | with a possible | | reached, QHT | | request quota | | expires, quota | | | | exhaustion, validity | | Close the counts and | | time reached, forced | | start new counts | | re-authorization, | | with time stamps | | expiry of quota | | | | holding time) | | | +----------------------+----------------------+----------------------+ | Change of charging | If the corresponding | Close the counts and | | condition in the SMF | trigger is enabled | start new counts | | (e.g. QoS change, | | with time stamps for | | Session-AMBR change, | | all active service | | user location | | data flows | | change, Radio access | | | | type change, PLMN | | | | change, Serving Node | | | | change, UE Time Zone | | | | change, change of UE | | | | presence in Presence | | | | Reporting Area(s), | | | | change of 3GPP PS | | | | Data Off status, | | | | handover cancel, | | | | GFBR guaranteed | | | | status change) | | | +----------------------+----------------------+----------------------+ | | If the corresponding | Charging Data | | | trigger is enabled | Request [Update] | | | and the category is | with a possible | | | set to \"immediate | request quota. | | | reporting\" | | +----------------------+----------------------+----------------------+ | Handover start | If the corresponding | Close the counts | | | trigger is enabled | with time stamps and | | | | start new counts | | | | with time stamps for | | | | active service data | | | | flows. | +----------------------+----------------------+----------------------+ | | If the corresponding | Charging Data | | | trigger is enabled | Request [Update] | | | and the category is | with a possible | | | set to \"immediate | request quota. | | | reporting\" | | +----------------------+----------------------+----------------------+ | Handover cancel | If the corresponding | Close the counts | | | trigger is enabled | with time stamps and | | | | start new counts | | | | with time stamps for | | | | active service data | | | | flows. | +----------------------+----------------------+----------------------+ | | If the corresponding | Charging Data | | | trigger is enabled | Request [Update] | | | and the category is | with a possible | | | set to \"immediate | request quota. | | | reporting\" | | +----------------------+----------------------+----------------------+ | Handover complete | If the corresponding | Close the counts | | | trigger is enabled | with time stamps and | | | | start new counts | | | | with time stamps for | | | | active service data | | | | flows. | +----------------------+----------------------+----------------------+ | | If the corresponding | Charging Data | | | trigger is enabled | Request [Update] | | | and the category is | | | | set to \"immediate | | | | reporting\" | | +----------------------+----------------------+----------------------+ | Addition of UPF | If the corresponding | Start new counts | | | trigger is enabled | with time stamps for | | | | the added UPF. | +----------------------+----------------------+----------------------+ | | If the corresponding | Charging Data | | | trigger is enabled | Request [Update] | | | and the category is | to request quota | | | set to \"immediate | with a possible | | | reporting\" with the | amount of quota. | | | quota management is | | | | being performed and | | | | quota is granted per | | | | each UPF | | +----------------------+----------------------+----------------------+ | Tariff time change | | Close the counts and | | | | start new counts | | | | with time stamps | +----------------------+----------------------+----------------------+ | CHF response with | | Charging Data | | session termination | | Request | | (e.g. Not | | [Termination] | | Applicable), abort | | | | request | | Close the counts | | | | with time stamps | +----------------------+----------------------+----------------------+ | Removal of a UPF | If the corresponding | Close the counts | | | trigger is enabled | with time stamps for | | | | the removed UPF | +----------------------+----------------------+----------------------+ | | If the corresponding | Charging Data | | | trigger is enabled | Request [Update]. | | | and the category is | | | | set to \"immediate | | | | reporting\" with | | | | quota management is | | | | being performed and | | | | quota is granted per | | | | each UPF | | +----------------------+----------------------+----------------------+ | Insertion of I-SMF | If the corresponding | Close the counts | | | trigger is enabled | with time stamps for | | | | all active service | | | | data flows in SMF, | | | | open new accounts | | | | for all active | | | | service data flows | | | | with I-SMF | | | | information. | +----------------------+----------------------+----------------------+ | | If the corresponding | Charging Data | | | trigger is enabled | Request [Update] | | | and the category is | to request quota | | | set to \"immediate | with a possible | | | reporting\" with | amount of quota. | | | quota management is | | | | being performed and | | | | quota is granted per | | | | each UPF | | +----------------------+----------------------+----------------------+ | Removal of I-SMF | If the corresponding | Close the counts | | | trigger is enabled | with time stamps for | | | | the removed I-SMF | +----------------------+----------------------+----------------------+ | | If the corresponding | Charging Data | | | trigger is enabled | Request [Update]. | | | and the category is | | | | set to \"immediate | | | | reporting\" with | | | | quota management | | | | being performed and | | | | quota is granted per | | | | each UPF | | +----------------------+----------------------+----------------------+ | Change of I-SMF | If the corresponding | Close the counts | | | trigger is enabled | with time stamps for | | | | the removed I-SMF, | | | | open active traffic | | | | flows' counts for | | | | the new I-SMF | +----------------------+----------------------+----------------------+ | | If the corresponding | Charging Data | | | trigger is enabled | Request [Update]. | | | and the category is | | | | set to \"immediate | | | | reporting\" with | | | | quota management | | | | being performed and | | | | quota is granted per | | | | each UPF | | +----------------------+----------------------+----------------------+ | Addition of access | If the corresponding | Close the counts | | | trigger is enabled | with time stamps for | | | | all active service | | | | data flows usage | | | | report in SMF, open | | | | new counts for all | | | | active service data | | | | flows. | +----------------------+----------------------+----------------------+ | | If the corresponding | Charging Data | | | trigger is enabled | Request [Update] | | | and the category is | with a possible | | | set to \"immediate | request quota. | | | reporting\" | | +----------------------+----------------------+----------------------+ | Removal of access | If the corresponding | Close the counts | | | trigger is enabled | with time stamps for | | | | all active service | | | | data flows usage | | | | report in SMF, open | | | | new counts for all | | | | active service data | | | | flows. | +----------------------+----------------------+----------------------+ | | If the corresponding | Charging Data | | | trigger is enabled | Request [Update]. | | | and the category is | | | | set to \"immediate | | | | reporting\" | | +----------------------+----------------------+----------------------+ | Redundant | If the corresponding | Charging Data | | transmission change | trigger is enabled | Request [Update]. | | | and the category is | | | | set to \"immediate | Close the counts and | | | reporting\" | start new counts | | | | with time stamps. | +----------------------+----------------------+----------------------+ | Expiry of time limit | If the corresponding | Close the counts | | per rating group | trigger is enabled | with time stamps | +----------------------+----------------------+----------------------+ | | If the category is | Charging Data | | | set to \"immediate | Request [Update] | | | reporting\" | | +----------------------+----------------------+----------------------+ | | If any matching | Start new counts | | | service data flow is | with time stamps | | | still active | | +----------------------+----------------------+----------------------+ | Expiry of data | If the corresponding | Close the counts | | volume limit per | trigger is enabled | with time stamps | | rating group | | | +----------------------+----------------------+----------------------+ | | If the category is | Charging Data | | | set to \"immediate | Request [Update] | | | reporting\" | | +----------------------+----------------------+----------------------+ | | If any matching | Open a new service | | | service data flow is | data container | | | still active | | +----------------------+----------------------+----------------------+ | Expiry of data event | If the corresponding | Close the counts | | limit per rating | trigger is enabled | with time stamps | | group | | | +----------------------+----------------------+----------------------+ | | If the category is | Charging Data | | | set to \"immediate | Request [Update] | | | reporting\" | | +----------------------+----------------------+----------------------+ | | If any matching | Open a new service | | | service data flow is | data container | | | still active | | +----------------------+----------------------+----------------------+ | Expiry of data event | If the corresponding | Charging Data | | limit per PDU | trigger is enabled | Request [Update] | | session | | | | | | Close the counts | | | | with time stamps | +----------------------+----------------------+----------------------+ | | If the PDU session | Start new counts | | | is still active | with time stamps | +----------------------+----------------------+----------------------+ | Expiry of time limit | If the corresponding | Charging Data | | per PDU session | trigger is enabled | Request [Update] | | | | | | | | Close the counts | | | | with time stamps | +----------------------+----------------------+----------------------+ | | If the PDU session | Start new counts | | | is still active | with time stamps | +----------------------+----------------------+----------------------+ | Expiry of data | | Charging Data | | volume limit per PDU | | Request [Update] | | session | | | | | | Close the counts | | | | with time stamps | +----------------------+----------------------+----------------------+ | | If the PDU session | Start new counts | | | is still active | with time stamps | +----------------------+----------------------+----------------------+ | Expiry of a limit of | | Charging Data | | number of charging | | Request [Update] | | condition changes | | | | per PDU session | | Close the counts | | | | with time stamps | +----------------------+----------------------+----------------------+ | | If the PDU session | Start new counts | | | is still active | with time stamps | +----------------------+----------------------+----------------------+ | Management | | Charging Data | | intervention | | Request [Update] | | | | | | | | Close the counts | | | | with time stamps | +----------------------+----------------------+----------------------+ | | If the PDU session | Start new counts | | | is still active | with time stamps | +----------------------+----------------------+----------------------+
When event based charging applies, the first occurrence of an event matching a
service data flow template in PCC rule shall be considered as the start of a
service.
How the termination of service data flows is detected, is specified in TS
23.503 [202]. Termination of the service data flow itself does not trigger
Charging Data Request [Update].
The CDR generation mechanism processed by the CHF upon receiving Charging Data
Request [Initial, Update, Termination] issued by the SMF for these chargeable
events, is specified in clause 5.2.3.
#### 5.2.1.5 SSC Mode and Triggers
There are two cases related to quota management when the granted quota is
volume for multiple UPFs and per Operator\'s policy, the traffic is counted in
more than one UPF:
\- Quota shared by UPFs means that SMF manages the shared quota consumption
per RG for multiple UPFs and reports the total quota consumed to CHF;
\- Quota granted for each UPF means that the CHF manages the quota granted for
each UPF and SMF manages and reports the quota consumption per UPF.
For configurations involving multiple UPFs and Operator\'s policy is to count
the traffic in a single UPF (e.g. BP), the quota is granted to the SMF for
this single UPF per RG for the whole traffic.
The following scenarios describe configurations in which the traffic is
counted in more than one UPF:
In case of SSC mode 3 PDU Session Anchor with IPv6 Multi-homed PDU Session,
\- The addition of UPF2 and BP (Change the part of traffic from UPF1 to UPF2):
\- if quota granted for each UPF, SMF triggers the chargeable event of Start
of SDF for UPF2 to request the quota;
\- if quota shared by UPFs, SMF requests UPF1 report usage of quota, caches
the usage from UPF1 and re-allocates the remaining quota to UPF2 and UPF1(if
needed). When the granted quota from CHF is used up, the SMF reports total
usage of quota to CHF.
\- The removal of UPF1and BP:
\- In case the quota management and quota granted for each UPF, UPF1 reports
final counts to SMF, SMF triggers the chargeable event of Remove the UPF to
report final counts from UPF1;
\- In case the quota management and quota shared by UPFs, UPF1 report final
counts to SMF, SMF caches the final count from UPF1. SMF sends counts from
UPF1 and UPF2 to the CHF together in next Charging Data Request.
\- In case without the quota management or offline only charging, UPF1 report
final count to SMF, SMF caches the final count from UPF1 and sends counts from
UPF1 and UPF2 to the CHF together in next a Charging Data Request. In case of
Addition of additional PDU Session Anchor and Branching Point or UL CL.
\- The addition of UPF2 and BP (Change the part of traffic from UPF1 to UPF2):
\- if quota granted for each UPF, SMF triggers the chargeable event of Start
of SDF for UPF2 to request the quota for Rating group;
\- if quota shared by UPFs, SMF indicates UPF1 report usage of quota, caches
the usage from UPF1 and re-allocates the remain quota to UPF2 and UPF1(if
needed). When the granted quota from CHF is used up, the SMF reports total
usage of quota to CHF.
In case of Removal of additional PDU Session Anchor and Branching Point or UL
CL:
\- The removal of UPF1 and BP (Change traffic from UPF1 to UPF2):
\- In case the quota management and quota granted for each UPF, UPF1 report
final counts to SMF, SMF triggers chargeable event of Remove the UPF to report
final counts from UPF1.
\- In case the quota management and quota shared by UPFs, UPF1 report final
counts to SMF, SMF caches the final count from UPF1 and re-allocates the
remain quota to UPF2. SMF sends counts from UPF1 and UPF2 to the CHF together
in next a Charging Data Request.
\- In case without the quota management or offline only charging, UPF1 report
final count to SMF, SMF caches the final count from UPF1 and sends counts from
UPF1 and UPF2 to the CHF together in next a Charging Data Request. In case of
Change of additional PDU Session Anchor for IPv6 multi-homing or UL CL and
Simultaneous change of Branching Point or UL CL and additional PSA for a PDU
Session.
\- The additional of UPF2 (Change the part of traffic from UPF1 to UPF2):
\- if quota granted for each UPF, SMF triggers the chargeable event of Start
of SDF for UPF2 to request the quota for Rating group;
\- if quota shared by UPFs, SMF indicates UPF1 report usage of quota, caches
the usage from UPF1 and re-allocates the remain quota to UPF2 and UPF1(if
needed). When the granted quota from CHF is used up, the SMF reports total
usage of quota to CHF.
\- The removal of UPF1:
\- In case the quota management and quota granted for each UPF, UPF1 report
final counts to SMF, SMF triggers chargeable event of Remove the UPF to report
final counts from UPF1.
\- In case the quota management and quota shared by UPFs, UPF1 report final
counts to SMF, SMF caches the final count from UPF1 and re-allocates the
remain quota to UPF2. SMF sends counts from UPF1 and UPF2 to the CHF together
in next Charging Data Request.
\- In case without the quota management or offline only charging, UPF1 report
final count to SMF, SMF caches the final count from UPF1 and sends counts from
UPF1 and UPF2 to the CHF together in next a Charging Data Request.
#### 5.2.1.6 QoS flow Based Charging (QBC)
QoS flow Based Charging allows the SMF to collect charging information related
to data volumes per PDU session, categorized per QoS Flow. QBC doesn\'t
support quota management.
The user can be identified by SUPI.
For a given PDU session, QBC shall be performed by the SMF within the same
charging session used for Flow Based Charging. For the case where QBC is
performed from SMF in VPLMN, Flow Based Charging is not applicable and there
is no possibility to have quota management for the PDU Session. For the case
where QBC is performed from SMF in HPLMN, FBC can be performed or not
performed at the same time according to operator\'s policy.
The SMF categorizes the volume within PDU session by QoS Flow identified by
QoS Flow Identifier (QFI).
The amount of data counted for the QoS Flow shall be the user plane payload at
the UPF.
Table 5.2.1.6.1 summarizes the set of default trigger conditions and their
category which shall be supported by the SMF in QBC. For \"immediate report\"
category, the table also provides the corresponding Charging Data Request
[Initial, Update, Termination] message sent from SMF towards the CHF.
Table 5.2.1.6.1: Default Chargeable events in SMF for QBC
+----------+----------+----------+----------+----------+----------+ | Ch | Trigger | Default | CHF | CHF | Message | | argeable | level | category | allowed | allowed | when | | event | | | to | to | \"i | | | | | change | enable | mmediate | | | | | category | and | rep | | | | | | disable | orting\" | | | | | | | category | +----------+----------+----------+----------+----------+----------+ | Start of | PDU | I | Not | Not | Charging | | PDU | session | mmediate | Ap | Ap | Data | | session | | | plicable | plicable | Request | | | | | | | [I | | | | | | | nitial] | +----------+----------+----------+----------+----------+----------+ | Start of | QoS Flow | Deferred | Not | Not | Charging | | a QoS | | | Ap | Ap | Data | | Flow | | | plicable | plicable | Request | | | | | | | [ | | | | | | | Update] | +----------+----------+----------+----------+----------+----------+ | **Change | | | | | | | of | | | | | | | Charging | | | | | | | cond | | | | | | | itions** | | | | | | +----------+----------+----------+----------+----------+----------+ | QoS | QoS Flow | Deferred | Yes | Yes | | | change | | | | | | +----------+----------+----------+----------+----------+----------+ | GFBR | QoS Flow | Deferred | Yes | Yes | | | gu | | | | | | | aranteed | | | | | | | status | | | | | | | change | | | | | | +----------+----------+----------+----------+----------+----------+ | User | PDU | Deferred | Yes | Yes | | | Location | session | | | | | | change | | | | | | +----------+----------+----------+----------+----------+----------+ | Serving | PDU | Deferred | Yes | Yes | | | Node | session | | | | | | change | | | | | | +----------+----------+----------+----------+----------+----------+ | Change | PDU | Deferred | Yes | Yes | | | of 3GPP | session | | | | | | PS Data | | | | | | | off | | | | | | | Status | | | | | | +----------+----------+----------+----------+----------+----------+ | Tariff | PDU | Deferred | No | No | | | time | session | | | | | | change | | | | | | +----------+----------+----------+----------+----------+----------+ | UE time | PDU | I | Yes | Yes | | | zone | session | mmediate | | | | | change | | | | | | +----------+----------+----------+----------+----------+----------+ | PLMN | PDU | I | Yes | Yes | | | change | session | mmediate | | | | +----------+----------+----------+----------+----------+----------+ | RAT type | PDU | I | Yes | Yes | | | change | session | mmediate | | | | +----------+----------+----------+----------+----------+----------+ | Sess | PDU | I | Yes | Yes | | | ion-AMBR | session | mmediate | | | | | change | | | | | | +----------+----------+----------+----------+----------+----------+ | Addition | PDU | I | Yes | Yes | | | of UPF | session | mmediate | | | | +----------+----------+----------+----------+----------+----------+ | Removal | PDU | I | Yes | Yes | | | of UPF | session | mmediate | | | | +----------+----------+----------+----------+----------+----------+ | Handover | PDU | I | Yes | Yes | | | cancel | session | mmediate | | | | +----------+----------+----------+----------+----------+----------+ | Handover | PDU | I | Yes | Yes | | | start | session | mmediate | | | | +----------+----------+----------+----------+----------+----------+ | Handover | PDU | I | Yes | Yes | | | complete | session | mmediate | | | | +----------+----------+----------+----------+----------+----------+ | R | QoS Flow | I | Yes | Yes | | | edundant | | mmediate | | | | | tran | | | | | | | smission | | | | | | | change | | | | | | +----------+----------+----------+----------+----------+----------+ | **Limit | | | | | | | per PDU | | | | | | | s | | | | | | | ession** | | | | | | +----------+----------+----------+----------+----------+----------+ | Expiry | PDU | I | No | Yes | | | of data | session | mmediate | | | | | time | | | | | | | limit | | | | | | | per PDU | | | | | | | session | | | | | | +----------+----------+----------+----------+----------+----------+ | Expiry | PDU | I | No | Yes | | | of data | session | mmediate | | | | | volume | | | | | | | limit | | | | | | | per PDU | | | | | | | session | | | | | | +----------+----------+----------+----------+----------+----------+ | Expiry | PDU | I | No | Yes | | | of data | session | mmediate | | | | | event | | | | | | | limit | | | | | | | per PDU | | | | | | | session | | | | | | +----------+----------+----------+----------+----------+----------+ | Expiry | PDU | I | No | Yes | | | of limit | session | mmediate | | | | | of | | | | | | | number | | | | | | | of | | | | | | | charging | | | | | | | c | | | | | | | ondition | | | | | | | changes | | | | | | +----------+----------+----------+----------+----------+----------+ | **Limit | | | | | | | per QoS | | | | | | | Flow** | | | | | | +----------+----------+----------+----------+----------+----------+ | Expiry | QoS Flow | Deferred | Yes | Yes | | | of data | | | | | | | time | | | | | | | limit | | | | | | | per QoS | | | | | | | Flow | | | | | | +----------+----------+----------+----------+----------+----------+ | Expiry | QoS Flow | Deferred | Yes | Yes | | | of data | | | | | | | volume | | | | | | | limit | | | | | | | per QoS | | | | | | | Flow | | | | | | +----------+----------+----------+----------+----------+----------+ | ** | | | | | | | Others** | | | | | | +----------+----------+----------+----------+----------+----------+ | End of | QoS Flow | Deferred | Yes | Yes | | | QoS Flow | | | | | | +----------+----------+----------+----------+----------+----------+ | Ma | PDU | I | No | No | | | nagement | session | mmediate | | | | | inte | | | | | | | rvention | | | | | | +----------+----------+----------+----------+----------+----------+ | End of | PDU | I | No | No | Charging | | PDU | session | mmediate | | | Data | | session | | | | | Request | | | | | | | [Termi | | | | | | | nation] | +----------+----------+----------+----------+----------+----------+ | Abort | PDU | I | No | No | | | request | session | mmediate | | | | | is | | | | | | | received | | | | | | | from the | | | | | | | CHF | | | | | | +----------+----------+----------+----------+----------+----------+ | NOTE 1: | | | | | | | If GFBR | | | | | | | gu | | | | | | | aranteed | | | | | | | status | | | | | | | change | | | | | | | is | | | | | | | enabled, | | | | | | | SMF | | | | | | | needs to | | | | | | | ensure | | | | | | | the | | | | | | | request | | | | | | | for the | | | | | | | noti | | | | | | | fication | | | | | | | from the | | | | | | | access | | | | | | | network | | | | | | | (i.e. | | | | | | | 3GPP | | | | | | | RAN) | | | | | | | when the | | | | | | | GFBR can | | | | | | | no | | | | | | | longer | | | | | | | (or can | | | | | | | again) | | | | | | | be | | | | | | | gu | | | | | | | aranteed | | | | | | | for a | | | | | | | QoS Flow | | | | | | | during | | | | | | | the | | | | | | | lifetime | | | | | | | of the | | | | | | | QoS | | | | | | | Flow. | | | | | | | | | | | | | | > NOTE | | | | | | | > 2: The | | | | | | | > | | | | | | | columns | | | | | | | > CHF | | | | | | | > | | | | | | | allowed | | | | | | | > to | | | | | | | > change | | | | | | | > c | | | | | | | ategory, | | | | | | | > and | | | | | | | > CHF | | | | | | | > | | | | | | | allowed | | | | | | | > enable | | | | | | | > and | | | | | | | > | | | | | | | disable | | | | | | | > are | | | | | | | > only | | | | | | | > ap | | | | | | | plicable | | | | | | | > for | | | | | | | > the | | | | | | | > PDU | | | | | | | > | | | | | | | session | | | | | | | > establ | | | | | | | ishment, | | | | | | | > for | | | | | | | > other | | | | | | | > cases | | | | | | | > they | | | | | | | > are | | | | | | | > not | | | | | | | > app | | | | | | | licable. | | | | | | +----------+----------+----------+----------+----------+----------+
The default \"Limit\" trigger conditions, are trigger thresholds configured in
the Charging Characteristics applied to the PDU session for QBC. It shall be
possible for the CHF to override these default triggers when providing
Charging Data Response [Initial], either to disable the triggers, or to enable
triggers new thresholds value.
For QBC the following details of chargeable events and corresponding actions
in the SMF are defined in Table 5.2.1.6.2:
Table 5.2.1.6.2: Chargeable events and their related actions in SMF for QBC
+----------------------+----------------------+----------------------+ | Chargeable event | Conditions | SMF action | +----------------------+----------------------+----------------------+ | Start of PDU session | | Charging Data | | | | Request [Initial]. | +----------------------+----------------------+----------------------+ | Start of a QoS Flow | Start of the QoS | Charging Data | | | Flow associated with | Request [Update]. | | | the default QoS rule | | +----------------------+----------------------+----------------------+ | | Start of a QoS Flow | Start new counts | | | | with time stamps. | +----------------------+----------------------+----------------------+ | End of a QoS Flow | | Close the counts | | | | with time stamps for | | | | the QoS flows | +----------------------+----------------------+----------------------+ | End of PDU session | | Charging Data | | | | Request | | | | [Termination] | | | | | | | | Close the counts | | | | with time stamps | +----------------------+----------------------+----------------------+ | Change of charging | If the corresponding | Close the counts and | | condition in the SMF | trigger is enabled | start new counts | | (e.g. QoS change, | | with time stamps for | | Session-AMBR change, | | all active QoS | | user location | | flows. | | change, Radio access | | | | type change, PLMN | | | | change, Serving Node | | | | change, UE Time Zone | | | | change, change of | | | | 3GPP PS Data Off | | | | status, GFBR | | | | guaranteed status | | | | change) | | | +----------------------+----------------------+----------------------+ | | If the corresponding | Charging Data | | | trigger is enabled | Request [Update] | | | and the category is | | | | set to \"immediate | | | | reporting\" | | +----------------------+----------------------+----------------------+ | Handover start | If the corresponding | Close the counts | | | trigger is enabled | with time stamps and | | | | start new counts | | | | with time stamps. | +----------------------+----------------------+----------------------+ | | If the corresponding | Charging Data | | | trigger is enabled | Request [Update]. | | | and the category is | | | | set to \"immediate | | | | reporting\" | | +----------------------+----------------------+----------------------+ | Handover cancel | If the corresponding | Close the counts | | | trigger is enabled | with time stamps and | | | | start new counts | | | | with time stamps for | | | | active QoS flows. | +----------------------+----------------------+----------------------+ | | If the corresponding | Charging Data | | | trigger is enabled | Request [Update]. | | | and the category is | | | | set to \"immediate | | | | reporting\" | | +----------------------+----------------------+----------------------+ | Handover complete | If the corresponding | Close the counts and | | | trigger is enabled | start new counts | | | | with time stamps for | | | | active QoS flows. | +----------------------+----------------------+----------------------+ | | If the corresponding | Charging Data | | | trigger is enabled | Request [Update] | | | and the category is | | | | set to \"immediate | | | | reporting\" | | +----------------------+----------------------+----------------------+ | Redundant | If the corresponding | Charging Data | | transmission change | trigger is enabled | Request [Update]. | | | and the category is | | | | set to \"immediate | Close the counts and | | | reporting\" | start new counts | | | | with time stamps. | +----------------------+----------------------+----------------------+ | Addition of UPF | If the corresponding | Start new counts | | | trigger is enabled | with time stamps for | | | | the added UPF. | +----------------------+----------------------+----------------------+ | | If the corresponding | Charging Data | | | trigger is enabled | Request [Update]. | | | and the category is | | | | set to \"immediate | | | | reporting\" | | +----------------------+----------------------+----------------------+ | Removal of UPF | If the corresponding | Close the counts | | | trigger is enabled | with time stamps for | | | | the removed UPF | +----------------------+----------------------+----------------------+ | | If the corresponding | Charging Data | | | trigger is enabled | Request [Update]. | | | and the category is | | | | set to \"immediate | | | | reporting\" | | +----------------------+----------------------+----------------------+ | Expiry of time limit | If the corresponding | Close the counts | | per QoS Flow | trigger is enabled | with time stamps. | +----------------------+----------------------+----------------------+ | | If the category is | Charging Data | | | set to \"immediate | Request [Update] | | | reporting\" | | +----------------------+----------------------+----------------------+ | | If the QoS Flow is | Start new counts | | | still active | with time stamps | +----------------------+----------------------+----------------------+ | Expiry of data | If the corresponding | Close the counts | | volume limit per QoS | trigger is enabled | with time stamps | | Flow | | | +----------------------+----------------------+----------------------+ | | If the category is | Charging Data | | | set to \"immediate | Request [Update] | | | reporting\" | | +----------------------+----------------------+----------------------+ | | If the QoS Flow is | Start new counts | | | still active | with time stamps | +----------------------+----------------------+----------------------+ | Expiry of time limit | If the corresponding | Close the counts | | per PDU session | trigger is enabled | with time stamps for | | | | all QoS flows. | +----------------------+----------------------+----------------------+ | | If the category is | Charging Data | | | set to \"immediate | Request [Update] | | | reporting\" | | +----------------------+----------------------+----------------------+ | | If the PDU session | Start new counts | | | is still active | with time stamps for | | | | all active QoS flows | +----------------------+----------------------+----------------------+ | Expiry of data | If the corresponding | Close the counts | | volume limit per PDU | trigger is enabled | with time stamps for | | session | | all QoS flows. | +----------------------+----------------------+----------------------+ | | If the category is | Charging Data | | | set to \"immediate | Request [Update] | | | reporting\" | | +----------------------+----------------------+----------------------+ | | If the PDU session | Start new counts | | | is still active | with time stamps for | | | | all active QoS flows | +----------------------+----------------------+----------------------+ | Expiry of a limit of | If the corresponding | Close the counts | | number of charging | trigger is enabled | with time stamps for | | condition changes | | all QoS flows. | | per PDU session | | | +----------------------+----------------------+----------------------+ | | If the category is | Charging Data | | | set to \"immediate | Request [Update] | | | reporting\" | | +----------------------+----------------------+----------------------+ | | If the PDU session | Start new counts | | | is still active | with time stamps for | | | | all active QoS flows | +----------------------+----------------------+----------------------+ | Management | | Charging Data | | intervention | | Request [Update] | | | | | | | | Close the counts | | | | with time stamps for | | | | all QoS Flows | +----------------------+----------------------+----------------------+ | | If the PDU session | Start new counts | | | is still active | with time stamps | +----------------------+----------------------+----------------------+ | Abort | | Charging Data | | | | Request | | | | [Termination] | | | | | | | | Close the counts | | | | with time stamps | +----------------------+----------------------+----------------------+
The CDR generation mechanism processed by the CHF upon receiving Charging Data
Request [Initial, Update, Termination] issued by the SMF for these chargeable
events in QBC, is specified in clause 5.2.3.
#### 5.2.1.7 Roaming QoS flow Based charging (QBC)
When QoS flow Based Charging specified in 5.2.1.6 is used in a context of
roaming, a \"Roaming Charging Profile\" is defined to allow, when shared, QBC
synchronized between both PLMNs and includes:
\- The set of chargeable events as per Table 5.2.1.6.1 and associated
category.
\- The set of thresholds for chargeable events based on trigger thresholds.
\- An indication on whether the \"Default partial record\" or the \"Individual
partial record\" mechanism per clause 5.2.3, is used by CHF.
A default \"Roaming Charging Profile\" is specified for the SMF and comprises:
\- The set of chargeable events and associated category specified as the
default per Table 5.2.1.6.1.
\- The default set of thresholds configured in the Charging Characteristics
for QBC.
\- The \"Default partial record\" mechanism indicated as the one used by CHF.
In the VPLMN, at PDU session establishment or PDU session transfer from a
different VPLMN, the default \"Roaming Charging Profile\" in the new V-SMF may
optionally be overridden by a new \"Roaming Charging Profile\" supplied by the
CHF in the Charging Data Response [Initial] with:
\- updated set of chargeable events and associated category.
\- updated thresholds for chargeable events based on trigger thresholds.
\- the selected partial record mechanism (\"Default partial record\" or
\"Individual partial record\").
This updated \"Roaming Charging Profile\" is transferred from the new V-SMF to
the H-SMF and may be acknowledged or replaced by the HPLMN selected \"Roaming
Charging Profile\" to be used by the new V-SMF.
In the HPLMN, at PDU session establishment or V-SMF change for a PDU session,
the \"Roaming Charging Profile\", when received by the H-SMF from the new
V-SMF, may be updated by the CHF in the HPLMN in the Charging Data Response
[Initial] to H-SMF. This HPLMN CHF selected \"Roaming Charging Profile\" is
used by the H-SMF and transferred towards the VPLMN.
The \"Roaming Charging Profile\" resulting from the exchange between the VPLMN
and HPLMN at PDU session establishment shall remain unchanged during the PDU
session lifetime, unless there is a V-SMF change.
At each V-SMF change in Home routed scenario, the \"Roaming Charging Profile\"
may be renegotiated between the VPLMN and HPLMN and shall remain unchanged
during the PDU session lifetime with the actual V-SMF.
The capability specified in clause 5.2.1.2.1 for the CHF to be able to update
the triggers after the PDU session is established for a given VPLMN shall not
be applicable for Roaming QBC.
#### 5.2.1.8 Termination action
The termination action applies only in case of online charging, i.e. quota
management is active. It indicates the action, which the UPF should perform
when no quota is granted. A packet for a specific rating group is subject to a
termination action in the following cases:
\- Zero units have been granted;
\- The final granted units have been used;
\- Quota limit reached;
\- End user service rejected;
\- End user service denied;
\- Rating failed.
The defined termination actions include:
\- Allowing the packets to pass through;
\- Dropping the packets;
\- The SMF Default Termination Action;
\- The re-direction of packets to an application server (e.g. defined in the
termination action).
NOTE Such a re-direction may trigger a new charging session to be initiated.
A Default Termination Action for all rating groups, for which no quota is
granted and there is no specific termination action, shall be pre-configured
in the SMF according to operator\'s policy. For instance, the default
behaviour may consist of allowing packets of any terminated service to pass
through the UPF.
When final units are granted for a given rating group, the CHF shall provide a
termination action using finalUnitAction for this rating group. For the rating
group, the CHF provided termination action shall be used instead of SMF pre-
configured termination action for "The final granted units have been used"
case.
#### 5.2.1.9 Sponsored data connectivity charging
The Sponsor Identifier and Application Service Provider Identifier are
provided for sponsored data connectivity to the PCF from the AF, according to
TS 23.503 [215].
The Sponsor Identifier and Application Service Provider Identity may be
included in PCC rules with \"offline\" charging method for non-roaming or home
routed roaming scenarios from the PCF to the SMF. In this case, charging
information collected by the SMF includes the Sponsor Identity and the
Application Service Provider Identity. Correlation of charging information
from multiple users per sponsor and/or application service provider can then
be based on Sponsor Identity and Application Service Provider Identity.
#### 5.2.1.10 Branching point or UL CL controlled by I-SMF
The interaction between I-SMF and SMF for the support of traffic offload by
UPF controlled by the I-SMF is specified in the clause 5.34.6 TS 23.501[200].
There are two cases related to quota management when the granted quota is
volume for multiple UPFs and per Operator\'s policy for the scenarios,
i.e.Addition, Removal and Change of PDU Session Anchor (PSA2), Branching Point
or UL CL controlled by I-SMF, the traffic is counted in more than one UPF:
\- Quota shared by UPFs (PSA)
\- Quota granted for each UPF (PSA)
In the scenario UL CL/BP controlled by I-SMF, the I-SMF forwards traffic usage
information of UPF (PSA2) to the SMF as specified clause 5.34.4 and clause
5.34.5 in TS 23.501 [200].
#### 5.2.1.11 CHF-Controlled Quota Management
Quota management process is initiated by NF consumer, e.g. SMF, for service
data flows handled with the online charging method for a given Rating Group.
For the provision of the service to the end user, NF consumer requests quota
from CHF via Charging Data Request messages [Initial / Update]. CHF-Controlled
Quota Management in this context allows CHF to suspend/resume the quota
management process for that Rating Group within a PDU session.
When an NF consumer issues a Charging Data Request [Initial / Update] CHF may
decide to authorize the service and suspend the quota management for that
Rating Group. This means that: the service is authorized without granted units
and that all quota management triggers for that Rating Group within a PDU
session are ignored by the NF consumer.\ Usage will continue to be reported
via the remaining default active triggers. It is the sole responsibility of
CHF to activate other applicable triggers if additional reporting is needed.
When an NF consumer issues a Charging Data Request [Update] in which a given
Rating Group has quota management previously suspended, CHF may decide to
resume quota management for that Rating Group. This means that all previously
set quota management triggers for that Rating Group are considered by the NF
consumer and granted units are reconfigured by the CHF.
CHF may want to resume quota management at any time, for this Re-authorization
mechanisms can be used to trigger NF consumer to subsequently issue a Charging
Data Request [Update].Procedures enabling CHF-Controlled Quota Management to
suspend/resume the quota management are described in TS 32.290 [57].
#### 5.2.1.12 URLLC Charging
The CHF can be aware of redundant transmission type (i.e.dual connectivity,
redundant transmission on N3/N9 and redundant transmission at transport layer)
and provide the quota allocation based on the redundant transmission type:
\- For dual connectivity based end to end redundant user plane paths, the
granted quotas is allocated for each PDU session.
\- For the redundant transmission on N3/N9 interfaces, the CHF grants the
quota regardless if packets were duplicated or not.
\- For the redundant transmission at transport layer, the CHF grants the quota
regardless if packets were duplicated or not.
For dual connectivity based end to end Redundant User Plane Paths, SMF shall
collect and report the usage for each redundant PDU session.
For redundant transmission at N3/N9 interface, the SMF shall collect and
report the usage not counting redundant packets.
During the PDU session life, the SMF may decide to active or deactive the
redundant transmission and reports the usage based on the redundant
transmission change trigger.
For redundant Transmission at transport layer, the SMF shall collect and
report the usage not counting redundant packets.
#### 5.2.1.13 NR REDCAP Charging
The SMF provides for NR RedCap UE using NR the RAT Type NR_REDCAP, according
to clause 5.41 of TS 23.501 [200].
#### 5.2.1.14 Additional actor (MVNO) Charging
##### 5.2.1.14.1 General
The SMF provides charging information collection and reporting per PDU session
for 5G non-roaming Mobile Virtual Network Operators (MVNOs) charging,
according to clause 5.5.3.10 of TS 32.240 [1].
The charging principle for local breakout roaming scenario is applied to MVNOs
(with an A-CHF) charging, with the following differences on the SMF
interactions with the CHF in the MNO and A-CHF in the MVNO:
\- V-SMF in V-PLMN is replaced by the SMF in MNO;
\- V-CHF in V-PLMN is replaced by the CHF in MNO;
\- H-CHF in H-PLMN is replaced by the A-CHF in MVNO.
NOTE: CHF selection as well as trigger handling and negotiation, are not
specified and may be deployment dependent.
### 5.2.2 Message flows
#### 5.2.2.1 General
The flows in the present document specify the interaction between the SMF and
the CHF for 5G data connectivity converged charging functionality, in
different scenarios, based on TS 23.501 [200] and TS 23.502 [201] procedures
and flows.
This interaction is based on Charging Data Request /Response specified in TS
32.290 [57], exchanged between the SMF embedding the CTF and the CHF.
As a general principle, the steps in the figures for the message flows below
correspond to the steps of figures in TS 23.502 [201], which is the reference.
This document specifies the charging specific extension part.
#### 5.2.2.2 PDU session charging from SMF
##### 5.2.2.2.1 General
The subclause below describes PDU session charging in non-roaming scenarios.
##### 5.2.2.2.2 PDU session establishment
The following figure 5.2.2.2.2-1 describes a PDU session establishment
charging, based on figure 4.3.2.2.1.1 TS 23.502 [202] description:
{width="6.288888888888889in" height="8.853472222222223in"}
Figure 5.2.2.2.2-1: PDU session establishment
8\. The SMF selects an SSC mode for the PDU Session and also selects one or
more UPFs.
9\. The SMF may perform a Session Management Policy Modification procedure to
report some event to the PCF that has previously subscribed.
9ch-a.The SMF creates a Charging Identifier for the PDU session, and sends
Charging Data Request[initial] to CHF for authorization for the subscriber to
start the PDU session which is triggered by start of PDU session charging
event (The SMF may include 5GS CIoT optimizations information, see TS 23.502
[201]).
9ch-b. The CHF opens CDR for this PDU session.
9ch-c. The CHF acknowledges by sending Charging Data Response[Initial] to the
SMF.
15\. AMF to SMF: SM Request (N2 SM information).
[16a-b]. N4 session Modification.
16ch-a. This step may occur in case \"start of service data flow\" needs quota
from CHF, for the SMF to request quota.
16ch-b. The CHF updates CDR for this PDU session.
16ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
SMF.
NOTE 1: The steps from 16ch-a to 16ch-c for quota request from CHF are not
applicable for offline only charging.
17\. SM Request with PDU session Update Response to AMF.
18\. SMF sends SM Context Status Notify to AMF.
19\. In case of PDU Type IPv6, IPv6 Address Configuration.
##### 5.2.2.2.3 PDU Session Modification
The following figure 5.2.2.2.3-1 describes the PDU session modification
charging, based on figure 4.3.3.2-1 TS 23.502 [202] description:
Figure 5.2.2.2.3-1: PDU Session Modification
2ch-a. The SMF sends Charging Data Request [Update] to the CHF for reporting
the charging information when the corresponding trigger is armed.
2ch-b. The CHF update the CDR for the PDU session.
2ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the
SMF.
##### 5.2.2.2.4 PDU Session Release
The following figure 5.2.2.2.4-1 describes the PDU session release charging,
based on figure 4.3.4.2-1 TS 23.502 [202] description:
Figure 5.2.2.2.4-1: PDU Session Release
2ch-a. The SMF sends Charging Data Request [Termination] to the CHF for
terminating the charging associated with PDU sessions, with the trigger \"End
of PDU session\".
2ch-b. The CHF closes the CDR for the PDU session.
2ch-c. The CHF acknowledges by sending Charging Data Response [Termination] to
the SMF.
#### 5.2.2.3 PDU session charging SSC Mode 1 from SMF
##### 5.2.2.3.1 General
The subclause below describes PDU session SSC mode 1 charging in non-roaming
scenarios.
##### 5.2.2.3.2 PDU session charging SSC Mode 1
The following figure 5.2.2.3.2.1 describes a PDU session SSC mode 1 charging,
based on clause 5.6.9.2.1 TS 23.501 [201] description:
Figure 5.2.2.3.2.1: (R)AN relocation for PDU session in SSC mode 1
Ongoing charging interaction associated with the established PDU session
(UPF).
1\. A (R)AN relocation is performed.
2\. The SMF determines that the serving UPF needs to be maintained and
interacts with the UPF for the path switch to the new (R)AN access.
3\. the SMF acknowledges the path switch to the new (R)AN.
3ch-a. The SMF sends Charging Data Request[Update] to the CHF for reporting
the charging information User location information/ Access Technology Type
Information.
3ch-b. The CHF updates the CDR.
3ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
SMF.
#### 5.2.2.4 PDU session Charging SSC Mode 2 from SMF
##### 5.2.2.4.1 General
The subclause below describes PDU session charging for change the PDU Session
Anchor serving a PDU Session of SSC mode 2
##### 5.2.2.4.2 PDU session Charging SSC Mode 2
The following figure 5.2.2.4.2.1 describes a PDU session anchor relocation in
SSC mode 2 charging, based on figure 4.3.5.1.1 TS 23.502 [201] description:
Figure 5.2.2.4.2.1: PDU session anchor relocation in SSC mode 2 with single
PDU session anchor
Ongoing charging session associated with the established PDU session (UPF1)
2\. PDU session release procedure (UPF1).
2ch-a. The SMF1 sends Charging Data Request[Termination] to the CHF for
terminating the charging associated with old PDU session in UPF1.
2ch-b. The CHF closes the CDR for old PDU session in UPF1.
2ch-c. The CHF acknowledges by sending Charging Data Response[Termination] to
the SMF1.
3\. PDU session establishment procedure (UPF2).
3ch-a. The SMF2 creates a Charging Identifier for new PDU session ID in UPF2
and sends Charging Data Request[initial] to CHF for authorization for the
subscriber to start the new PDU session which is triggered by start of PDU
session charging event.
3ch-b. The CHF opens CDR for new PDU session in UPF2.
3ch-c. The CHF acknowledges by sending Charging Data Response[initial] to the
SMF2.
NOTE: If the same SMF1 is re-selected is step 3, the same steps 3ch-a to b
apply to SMF1
#### 5.2.2.5 PDU session Charging SSC Mode 3 from SMF
##### 5.2.2.5.1 General
The subclause below describes PDU session charging for change the PDU Session
Anchor serving a PDU Session of SSC mode 3.
##### 5.2.2.5.2 PDU session Charging SSC Mode 3
The following figure 5.2.2.5.2.1 describes a PDU session anchor relocation in
SSC with mode 3 multiple PDU sessions and SMF reallocation, based on figure
4.3.5.2.1 TS 23.502 [201] description:
Figure 5.2.2.5.2.1: PDU session anchor relocation in SSC mode 3 with multiple
PDU sessions -- SMF reallocation
Ongoing charging interaction associated with the established PDU session (with
UPF1).
4\. UE initiates PDU session establishment procedure with UPF2.
4ch-a. The SMF2 creates a Charging Identifier for new PDU session ID with UPF2
and sends Charging Data Request[initial] to CHF for authorization for the
subscriber to start the new PDU session (with UPF2) which is triggered by
start of PDU session charging event.
4ch-b. The CHF opens CDR for new PDU session in UPF2.
4ch-c. The CHF acknowledges by sending Charging Data Response[initial] to the
SMF2.
6\. Old PDU session for UPF1 release.
6ch-a. The SMF1 sends Charging Data Request[Termination] to the CHF for
terminating the charging associated with old PDU session in UPF1.
6ch-b. The CHF closes the CDR for old PDU session in UPF1.
6ch-c. The CHF acknowledges by sending Charging Data Response[Termination] to
the SMF1.
#### 5.2.2.6 PDU session Charging SSC Mode 3 IPv6 Multi Homed from SMF
##### 5.2.2.6.1 General
The subclause below describes PDU session charging for service continuity with
SSC mode 3 using the multi-homed PDU Session.
##### 5.2.2.6.2 PDU session Charging SSC Mode 3 IPv6 Multi Homed
The following figure 5.2.2.6.2.1 describes a PDU session anchor relocation in
SSC mode 3 with IPv6 Multi homed PDU Session charging, based on figure
4.3.5.3.1 TS 23.502 [201] description:
Figure 5.2.2.6.2.1: PDU session anchor relocation in SSC mode 3 with IPv6
Multi homed PDU Session
Ongoing charging interaction associated with the established PDU session
(UPF1).
Traffic starts at UPF2.
11ch-a. The SMF sends Charging Data Request[Update] to the CHF for request
quota for UPF2 which is triggered by start of service data flow charging
event, if quota management per UPF.
11ch-b. The CHF updates CDR for this PDU session
11ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
SMF.
[12a-b to 13a-b] The SMF releases the UE\'s old IPv6 prefix (IP\@1), and
releases the path between BP UPF and UPF1.
13ch-a. The SMF sends Charging Data Request[Update] to the CHF for usage
reporting for UPF1 which is triggered by termination of service data flow
charging event, if quota management per UPF.
13ch-b. The CHF updates CDR for this PDU session.
13ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
SMF.
In this scenario, the PDU session Id is maintained during the whole procedure.
#### 5.2.2.7 Addition of additional PDU Session Anchor and Branching Point or
UL CL
The following figure 5.2.2.7.1 describes the charging procedure to add a PDU
Session Anchor and a Branching Point or UL CL for an established PDU Session,
based on figure 4.3.5.4.1 TS 23.502[201].
Figure 5.2.2.7.1: Addition of additional PDU Session Anchor and Branching
Point or UL CL
> Ongoing charging interaction associated with the established PDU session
> (UPF).
3\. The SMF establishes the Branching Point (in case of IPv6 multi-homing) or
a UL CL for the PDU Session.
3ch-a. The SMF sends Charging Data Request[Update] to the CHF for the
additional of UPF (PSA 2) if quota management is granted per UPF by trigger
\"Addition of UPF\".
3ch-b. The CHF updates the CDR for the charging information of UPF (PSA 2).
3ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
SMF.
#### 5.2.2.8 Removal of additional PDU Session Anchor and Branching Point or
UL CL
The following figure 5.2.2.8.1 describes charging procedure to remove a PDU
Session Anchor and (optionally) remove Branching Point or UL CL for an
established PDU Session, based on figure 4.3.5.5.1 TS 23.502[201].
Figure 5.2.2.8.1: Removal of additional PDU Session Anchor and Branching Point
or UL CL
> Ongoing charging interaction associated with the established PDU session
> (UPF).
5\. The SMF releases via N4 the PSA1.
5ch-a. The SMF sends Charging Data Request[Update] to the CHF for the removal
of UPF (PSA 1) if quota management is granted per UPF by trigger \"Removal of
UPF\".
5ch-b. The CHF updates the CDR for the charging information of UPF (PSA 1).
5ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
SMF.
6\. If steps 4 and 5 were executed, the SMF releases the Branching Point / UL
CL.
#### 5.2.2.9 Change of additional PDU Session Anchor for IPv6 multi-homing or
UL CL
The following figure 5.2.2.9.1 charging procedure to establish a new
additional PDU Session Anchor (i.e., PSA2) and conditionally releases the
existing additional PDU Session Anchor (i.e. PSA1), while modifying IPv6
multi-homing or UL CL rule in the same Branching Point or UL CL under
controlled by the same SMF abased on figure 4.3.5.6.1 TS 23.502[201].
Figure 5.2.2.9.1: Change of additional PSA for a PDU Session in IPv6 multi-
homing or UL CL case
Ongoing charging interaction associated with the established PDU session
(UPF).
3a-b. The SMF exchange the N4 message toBranching Point or UL CL .
3ch-a. The SMF sends Charging Data Request[Update] to the CHF for the
additional of UPF (PSA 2) if quota management is granted per UPF by trigger
\"Addition of UPF\".
3ch-b. The CHF updates the CDR for the charging information of UPF (PSA 2).
3ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
SMF.
6a-b. Step 6 occurs only if the Branching Point or UL CL does not have any
traffic filter on the PDU Session which forwards a traffic flow to PSA1.
6ch-a. The SMF sends Charging Data Request[Update] to the CHF for the removal
of UPF (PSA 1) if quota management is granted per UPF by trigger \"Removal of
UPF\".
6ch-b. The CHF updates the CDR for the charging information of UPF (PSA 1).
6ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
SMF.
#### 5.2.2.10 Simultaneous change of Branching Point or UL CL and additional
PSA for a PDU Session
The following figure 5.2.2.10.1 describe the charging procedure to change the
Branching Point or the UL CL and additional PSA serving a PDU Session for a UE
triggered by SMF ((just an example call flow triggered by Xn based handover)
based on figure 4.3.5.7.1 TS 23.502[201].
Figure 5.2.2.10.1: Simultaneous change of Branching Point or UL CL and
additional PSA for a PDU Session
> Ongoing charging interaction associated with the established PDU session
> (UPF).
3ch-a. The SMF sends Charging Data Request[Update] to the CHF for the
additional of Target UPF if quota management is granted per UPF by trigger
\"Addition of UPF\".
3ch-b. The CHF updates the CDR for the charging information of Target UPF.
3ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
SMF.
9\. The SMF releases PSA2.
9ch-a. The SMF sends Charging Data Request[Update] to the CHF for the removal
of Source UPF if quota management is granted per UPF by trigger \"Removal of
UPF\".
9ch-b. The CHF updates the CDR for the charging information of Source UPF.
9ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
SMF.
#### 5.2.2.11 PDU session charging for interworking with EPC
##### 5.2.2.11.1 General
In order to interwork with EPC, the N26 interface is introduced as an inter-CN
interface between the MME in EPC and 5GS AMF in order to enable provide
seamless session continuity for single registration mode UE for inter-system
change in the clause 5.17.2.2 TS 23.501[201].
PCF + PCRF, PGW-C + SMF and UPF + PGW-U are dedicated for interworking between
5GS and EPC, which are optional and are based on UE MM Core Network Capability
and UE subscription in the clause 4.3 TS 23.501 [201]. The procedures for
interworking with EPS based on N26 interface are specified in clause 4.11.1 TS
23.502 [201].
When 5GS and EPC interworking, interaction between the PGW-C + SMF and CHF is
using the same interface as for interaction between SMF and CHF.
When a UE establishes a PDN connection/PDU session with PGW-C+SMF in EPS or
5GS, a charging session is established for the PDU session and PDN connection
to support 5GS and EPS interworking as follows:
\- When a UE is served by EPC, a charging session is established between the
PGW-C+SMF and CHF via Nchf interface for EPC online charging and offline
charging if 5GS interworking indication from SGW indicates that the UE
supports 5G and the PDN connection is not restricted to interworking with 5GS
by user subscription.
\- When a UE is served by 5GS, a charging session is established between the
PGW-C+SMF and CHF via Nchf interface for 5GS converged online and offline
charging.
\- When a UE is served by EPC, the PGW-C+SMF acts as the PGW, and a charging
session is established via Gy interface for EPC online charging and Gz
interface for offline charging if 5GS interworking is not supported.
The chargeable events for 5GS and EPC interworking are handover cancel,
handover start and handover complete.
The triggers for 5GS and EPC interworking may be enabled or disabled, the
PGW-C+SMF will interact with charging system as the following:
\- If the trigger for interworking is enabled and the category is set to
\"immediate reporting\", the PGW-C+SMF will report usage in source network
and/or request quota for target network.
\- If the trigger for interworking is enabled and the category is set to
\"deferred reporting\", the PGW-C+SMF will close the count in source network
and start a new count in target network and continue to consume the quota in
target network. The source access specific triggers will no more be applicable
in the PGW-C+SMF, the target access specific triggers will apply instead.
\- If the trigger for interworking is disabled, the PGW-C+SMF will record
usage for both source and target network accesses into common count and
consumes the same quota in source and target network. The source access
specific triggers will no more be applicable in the PGW-C+SMF, the target
access specific triggers will apply instead.
For Charging Identifier handling see clause 5.1.4.
##### 5.2.2.11.2 5GS to EPS handover using N26 interface
The following figure 5.2.2.11.2.1 describes the handover from 5GS to EPS when
N26 is supported, based on figure 4.11.1.2.1.1 TS 23.502 [201] description:
Figure 5.2.2.11.2.1: 5GS to EPS handover using N26
0\. A PDU session is established in 5GS with multiple QoS Flows. A Charging
Identifier was assigned to the PDU session.
0ch. A charging session between the PGW-C+SMF and CHF exists for this PDU
session.
10c. PDU session update response to AMF.
10ch-a. This step occurs if steps 10a-c occurred. All counts are closed and a
Charging Data Request [Update] is sent to CHF, if required by \"Handover
start\" trigger. New counts and time stamps for all active service data flows
are started in the PGW-C+SMF.
10ch-b. The CHF updates CDR for this PDU session.
10ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the
PGW-C+SMF.
16\. User Plane path switch for the default bearer and the dedicated GBR
bearers between the UE and PGW-U+UPF via SGW. The Charging Identifier assigned
to the PDN connection is supplied as the Charging Identifier for the default
bearer. The EPS bearer Charging Identifier assigned to the dedicated EPS
bearer(s), is supplied as the Charging Identifier for that dedicated EPS
bearer.
16ch-a. All counts are closed and a Charging Data Request [Update] is sent to
CHF, if required by \"RAT type change\" trigger. New counts and time stamps
for all active service data flows are started in the PGW-C+SMF (The PGW-C+SMF
may include APN Rate Control Change, see TS 23.502 [201]).
16ch-b. The CHF updates CDR.
16ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the
PGW-C+SMF.
19\. Dedicated bearer activation procedure for non-GBR QoS flows initiated by
PGW-C+SMF.
19ch. Needed counts are started on start of service data flows of
corresponding non-GBR QoS Flows.
##### 5.2.2.11.3 EPS to 5GS handover using N26 interface
The following figures 5.2.2.11.3.1 and 5.2.2.11.3.2 describe the handover from
EPS to 5GS when N26 is supported, based on figures 4.11.1.2.2.2.1 and
4.11.1.2.2.3.1 TS 23.502 [201] description:
Figure 5.2.2.11.3.1: EPS to 5GS handover using N26 - preparation
0\. If the UE supports 5G and the PDN connection is not restricted to
interworking with 5GS by user subscription, the PGW-C+SMF is aware that 5GS
interworking is supported. A PDN connection is established in EPC with default
bearer and dedicated bearers. Association between the EPS bearer and the
corresponding 5G QoS Rules is stored by the PGW-C+SMF.
0ch. A charging session between the PGW-C+SMF and CHF exists for this PDN
connection with associated to the default bearer and dedicated bearers. The
default bearer is assigned with the Charging Identifier of the PDN connection.
The dedicated bearers are assigned with the EPS bearer Charging Identifier.
As described in clause 4.11.1.2.2 of TS 23.502 [201] the PGW-C+SMF may receive
APN Rate Control Status enabled during interworking with EPC for this PDN
connection, the PGW-C+SMF interacts with CHF as following:
13ch-a. All counts are closed and a Charging Data Request [Update] is sent to
CHF, if required by \"RAT type change\" trigger. The APN Rate Control Change
may be provided by PGW-C+SMF in charging information if received.
13ch-b. The CHF updates CDR for this PDN connection.
13ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the
PGW-C+SMF.
{width="6.66875in" height="3.91875in"}
Figure 5.2.2.11.3.2: EPS to 5GS handover using N26 - execution
10ch-a. All counts are closed and a Charging Data Request [Update] is sent to
CHF, if required by \"RAT type change\" trigger. New counts and time stamps
for all active service data flows are started in the PGW-C+SMF.
10ch-b. The CHF updates CDR for this PDU session.
10ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the
PGW-C+SMF.
##### 5.2.2.11.4 Handover Cancel
The following figures 5.2.2.11.4.1 describe the handover cancel, based on
clause 4.11.1.2.3 TS 23.502 [201] description:
Figure 5.2.2.11.4.1: Handover Cancel
4\. Based on the Relocation Cancel Indication, the target CN node (MME or AMF)
deletes the session resources established during handover preparation phase in
SGW (SGW-C and SGW-U)/ (SMF and UPF).
4ch-a. All counts are closed and a Charging Data Request [Update] is sent to
CHF which triggered by \"Handover cancel\", New counts and time stamps for all
active service data flows are started in the PGW-C+SMF.
4ch-b. The CHF updates CDR for this PDU session.
4ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the
PGW-C+SMF.
7\. If indirect forwarding tunnel is setup during handover preparation phase
then cancellation of handover triggers the source CN node to release the
temporary resources used for indirect forwarding.
8\. If indirect forwarding tunnel is setup during handover preparation phase
then cancellation of handover triggers the target CN node to release the
temporary resources used for indirect forwarding.
##### 5.2.2.11.5 EPS to 5GS mobility without N26 interface
The following figures 5.2.2.11.5.1 describe the handover from EPS to 5GS
without N26 support, based on clause 4.11.2.3 TS 23.502 [201] description:
Figure 5.2.2.11.5.1: EPS to 5GS mobility without N26
0\. The UE is attached in EPC.
1-8. UE initiate registration procedure to the 5GS and indicates that it is
moving from EPC.
9\. UE requested PDU Session Establishment.
9ch-a. a Charging Data Request [Update] is sent to CHF which is trigged by
Handover start charging event, New counts and time stamps for all active
service data flows are started in the PGW-C+SMF.
9ch-b. The CHF updates CDR for this PDU session.
9ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the
PGW-C+SMF.
10\. The PGW-C+SMF performs release of the resources in EPC for the PDN
connections(s) transferred to 5GS by performing the PDN GW initiated bearer
deactivation procedure.
10ch-a. All counts are closed and a Charging Data Request [Update] is sent to
CHF which is trigged by Handover complete charging event.
10ch-b. The CHF updates CDR.
10ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the
PGW-C+SMF.
##### 5.2.2.11.6 5GS to EPS mobility without N26 interface
The following figures 5.2.2.11.6.1 describe the handover from 5GS to EPS
without N26 support, based on clause 4.11.2.2 TS 23.502 [201] description:
Figure 5.2.2.11.6.1: 5GS to EPS mobility without N26
  1. UE is registered in 5GS.
> 1-6. TAU procedure is triggered to start for E-UTRAN initial attach.
>
> 7\. UE initiate E-UTRAN Initial Attach procedure to the EPS and indicates
> that it is moving from 5GS.
7ch-a. a Charging Data Request [Update] is sent to CHF which is triggered by
Handover start charging event. New counts and time stamps for all active
service data flows are started in the PGW-C+SMF.
7ch-b. The CHF updates CDR for this PDU session.
7ch-c.The CHF acknowledges by sending Charging Data Response [Update] to the
PGW-C+SMF.
> 10\. If the UE has remaining PDU Sessions in 5GS which it wants to transfer
> to EPS and maintain the same IP address/prefix, the UE performs the UE
> requested PDN Connectivity Procedure.
14\. The PGW-C+SMF initiates release of the PDU Session(s) in 5GS transferred
to EPS.
14ch-a. All counts are closed and a Charging Data Request [Update] is sent to
CHF which is triggered by Handover complete charging event.
14ch-b. The CHF updates CDR for this PDU session.
14ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the
PGW-C+SMF.
##### 5.2.2.11.7 EPS to 5GS handover for roaming in Home routed scenario
The following figure 5.2.2.11.7.1 describes the handover from EPS to 5GS for
roaming in home routed scenario, focusing on the Charging Identifier
generation mechanism.
Figure 5.2.2.11.7.1: EPS to 5GS mobility without N26 in Home-Routed Roaming
1\. The UE is attached in EPC and initiates a new PDU connection (IP-CAN
session).
1ch-a. A Charging Data Request [Initial] is sent to CHF via PGW-C+SMF in
HPLMN. The Charging Identifier included is generated by PGW-C +SMF in HPLMN.
1ch-b. The H-CHF opens a CDR 1ch-c. The H-CHF acknowledges by sending Charging
Data Response [Initial] to the PGW-C+SMF.
2\. UE initiates registration procedure to the 5GS and indicates that it is
moving from EPC. UE requests PDU Session Establishment.
2ch-a. SMF in VPLMN creates a Charging Identifier (visited created Charging
Identifier) for the PDU session and sends the Charging Data Request [Initial]
to CHF in VPLMN
2ch-b. The CHF in VPLMN opens a CDR.
2ch-c. The CHF in VPLMN acknowledges by sending Charging Data Response
[Initial] to the SMF and optionally supplies a "Roaming Charging Profile" to
the V-SMF which override the default one.
3\. UPF selection and V-SMF sends the PDU session establishment request to
H-SMF.
3ch-a. A Charging Data Request [Update] is sent to CHF in HPLMN, indicating
the \"Roaming Charging Profile\" received from the VPLMN. The same Charging
Identifier in step 1ch-a will be the only one Charging Identifier used for any
subsequent charging data request sent from H-SMF to CHF i.e. , the Charging
Identifier generated in PGW-C +SMF in HPLMN.
3ch-b. The CHF in HPLMN updates the CDR.
3ch-c. The CHF in HPLMN acknowledges by sending Charging Data Response
[Update] to the PGW-C+SMF and supplies the HPLMN selected \"Roaming Charging
Profile\" to the PGW-C+SMF.
4\. H-SMF sends the PDU session establishment response with Charging
Identifier(home provided Charging Identifier).
4ch-a. A Charging Data Request [Update] is sent to CHF in VPLMN, with the
\"Roaming Charging Profile\", Charging Identifier (visited created Charging
Identifier) , and home provided Charging Identifier.
4ch-b. The CHF updates the CDR.
4ch-c. The CHF acknowledges by sending Charging Data Response [Update].
In subsequent charging data request sent from V-SMF to V-CHF, the Charging
Identifier has the value of home provided Charging Identifier, and the home
provided Charging Identifier is not provided.
##### 5.2.2.11.8 Handover from EPC/ePDG to 5GS
The following figure 5.2.2.11.11.1 describes the handover from EPC/ePDG to 5GS
for non-roaming scenario based on clause 4.11.4.1 Handover from EPC/ePDG to
5GS of TS 23.502 [201].
Figure 5.2.2.11.11.1: Handover from EPC/ePDG to 5GS
0\. One or more PDN Connections have been established.
1\. UE register to 5GC via NG RAN.
2\. The UE initiates a UE requested PDU Session Establishment via 3GPP Access
and includes the \"Existing PDU Session\" indication or \"Existing Emergency
PDU Session\" and the PDU Session ID.
2ch-a. PGW-C+SMF sends Charging Data Request [Update] to CHF if required by
\"RAT type change\" trigger.
2ch-b. The CHF updates for this PDU session
2ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the
PGW-C+SMF.
3\. Step 10-14, in procedure of UE requested PDU Session Establishment.
4\. The combined PGW+SMF/UPF initiates a PDN GW initiated Resource Allocation
Deactivation to release the EPC and ePDG resources.
##### 5.2.2.11.9 Handover from 5GS to EPC/ePDG
The following figure 5.2.2.11.9.1 describes the handover from 5GS to EPC/ePDG
based on clause 4.11.4.2 Handover from 5GS to EPC/ePDG in TS 23.502 [201].
Figure 5.2.2.11.9.1: Handover from 5GS to EPC/ePDG
0) One or more PDU Sessions have been established between the UE and the
SMF/UPF via NG-RAN.
1) UE selects an ePDG.
2) Step A1 in procedure of the UE initiates a Handover Attach procedure.
2ch-a. PGW-C+SMF sends Charging Data Request [Update] to CHF if required by
\"RAT type change\" trigger.
2ch-b. The CHF updates for this PDU session.
2ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the
PGW-C+SMF.
3) Step C1, in procedure of the UE initiates a Handover Attach procedure to
the release of resources.
4) The combined PGW+SMF/UPF initiates a network requested PDU Session Release
via 3GPP access.
#### 5.2.2.12 PDU session charging for roaming in Home routed scenario
##### 5.2.2.12.1 General
The subclauses below describe PDU session charging for roaming in Home routed
scenario focusing on roaming QBC procedures between SMF and a CHF in
respective PLMNs.
In H-PLMN, PDU session charging for FBC between H-SMF and a H-CHF occurring
within the same charging session is not reflected.
##### 5.2.2.12.2 PDU session establishment
The following figure 5.2.2.12.2.1 describes a PDU session charging
establishment in roaming Home routed scenario based on figure 4.3.2.2.2.1 TS
23.502 [201] description:
Figure 5.2.2.12.2.1: PDU session charging: establishment roaming Home Routed
1-3a. UE initiates a new PDU session. V-SMF and H-SMF selection by the AMF.
3ch-a. The UE is identified as a roamer (PLMN ID of the received SUPI is
different from VPLMN PLMN ID), the CHF is selected accordingly (the V-SMF may
include 5GS CIoT related information).
3ch-b. A Charging Data Request [Initial] is sent to CHF, indicating \"in-bound
roamer\".
3ch-c. The CHF opens a CDR (indicating \"in-bound roamer\")
3ch-d. The CHF acknowledges by sending Charging Data Response[Initial] to the
SMF and optionally supplies a \"Roaming Charging Profile\" to the V-SMF which
overrides the default one.
10\. UPF selection.
11\. If dynamic PCC is deployed, SM policy association modification.
11ch-a. Based on UE is identified as roaming in a different PLMN, the CHF is
selected accordingly.
11ch-b. A Charging Data Request [Initial] is sent to CHF, indicating \"out-
bound roamer\", with the \"Roaming Charging Profile\" received from the VPLMN
(the H-SMF may include 5GS CIoT related information).
11ch-c. The CHF opens a CDR (indicating \"out-bound roamer\").
11ch-d. The CHF acknowledges by sending Charging Data Response[Initial] to the
H-SMF and supplies the HPLMN selected \"Roaming Charging Profile\" (either the
same as the one received from VPLMN, either its own selected) to the H-SMF.
[12a-b]. The SMF initiates an N4 Session Establishment procedure with the
selected UPF.
12ch. Counts per QFI are started.
13\. Nsmf_PDUSession_Create Response from H-SMF to V-SMF
13ch-a. Based on \"received PDU session conditions\" trigger, a Charging Data
Request [Update] is sent to CHF with charging information received from H-SMF,
which includes the HPLMN selected \"Roaming Charging Profile\" and counts per
QFI are started.
13ch-b. The CHF updates the CDR.
13ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
V-SMF.
19a-b. N4 session modification.
19ch-a. Counts per rejected QFI(s) are closed. A Charging Data Request
[Update] is sent to CHF to report if needed.
19ch-b. The CHF updates the CDR.
19ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
V-SMF.
23\. Nsmf_PDUSession_UpdateRequest from V-SMF to H-SMF. The rejected QFI(s)
are notified to H-SMF.
23ch-a. Counts per rejected QFI(s) are closed. A Charging Data Request
[Update] is sent to CHF to report if needed.
23ch-b. The CHF updates the CDR.
23ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
H-SMF.
##### 5.2.2.12.3 PDU session modification
The following figure 5.2.2.12.3.1 describes a PDU Session Modification
procedure, home-routed roaming scenario based on figure 4.3.3.3.1 TS 23.502
[201] description:
Figure 5.2.2.12.3.1: UE or network requested PDU Session Modification (for
home-routed roaming scenario)
9ch-a. A Charging Data Request [Update] is sent to V-CHF with charging
information received from V-SMF, if needed and new counts per QFI are started.
9ch-b. The CHF updates the CDR.
9ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
V-SMF.
16ch-a. A Charging Data Request [Update] is sent to H-CHF with charging
information received from H-SMF, if needed, and new counts per QFI are
started.
16ch-b. The CHF updates the CDR.
16ch-c. The CHF acknowledges by sending Charging Data Response[Update] to the
H-SMF.
##### 5.2.2.12.4 PDU session release
The following figure 5.2.2.8.4.1 describes a PDU session charging release in
roaming home routed scenario based on figure 4.3.4.3.1 TS 23.502 [201]
description:
Figure 5.2.2.12.4.1: PDU session charging: release roaming home Routed
2a-2b. (UE, (R)AN or serving network initiated) N4 session release between
H-SMF and H-UPF.
2ch_a. A Charging Data Request [Termination] is sent to CHF with the set of
QFI(s) counts.
2ch-b. The CHF closes the CDR
2ch-c. The CHF acknowledges by sending Charging Data Response[Termination] to
the H-SMF.
4a-4b. N4 session release between V-SMF and V-UPF.
4ch-a. A Charging Data Request [Termination] is sent to CHF with the set of
QFI(s) counts.
4ch-b. The CHF closes the CDR
4ch-c. The CHF acknowledges by sending Charging Data Response[Termination] to
the V-SMF.
15b-15c. (HPLMN initiated release) N4 session release between H-SMF and H-UPF.
15ch_a. A Charging Data Request [Termination] is sent to CHF with the set of
QFI(s) counts.
15ch-b. The CHF closes the CDR
15ch-c. The CHF acknowledges by sending Charging Data Response [Termination]
to the H-SMF.
NOTE: Either 2ch or 15ch is done depending on if the release is UE, (R)AN,
serving network, or HPLMN initiated.
##### 5.2.2.12.5 Inter-PLMN V-SMF insertion
The following figure 5.2.2.12.5.1 describes the Home Routed PDU Session case
in which the UE moves out of H-SMF service area in the HPLMN to a new PLMN
V-SMF service area for the service request procedure based on figure
4.23.4.3-1 of TS 23.502 [201], with I-SMF replaced by V-SMF in I-SMF insertion
scenario (the CHF interaction is similar for N2 and Xn based handover
procedures):
{width="5.540972222222222in" height="7.117361111111111in"}
Figure 5.2.2.12.5.1: Roaming Home routed PDU session inter-PLMN V-SMF change
0ch-a: Ongoing charging session for HPLMN for UE served by H-SMF, using
\"Charging Identifier 1\".
1-2. UE moves into a different PLMN, and the new AMF determines the V-SMF
based on service area.
3- 4b. SM Context retrieval by V-SMF from the H-SMF. The \"Charging Identifier
1\" is conveyed to the V-SMF.
4ch-a. The UE is identified as a roamer, the V-CHF is selected accordingly.
4ch-b. A Charging Data Request [Initial] is sent to the V-CHF, indicating
\"in-bound roamer\" and \"Charging Identifier 1\" received on step 4b.
4ch-c. The V-CHF opens a CDR (indicating \"in-bound roamer\").
4ch-d. The V-CHF acknowledges by sending Charging Data Response [Initial] to
the V-SMF and optionally supplies a \"Roaming charging profile\" to the V-SMF
which overrides the default one.
5-7c. Refer steps 5 to 7c in Figure 4.23.4.3-1 of TS 23.502 [201].
8a. Nsmf_PDUSession_Update Request from the V-SMF towards the H-SMF and
optionally \"Roaming Charging Profile\".
8ach-a. A Charging Data Request [Update] is sent to H-CHF in HPLMN (e.g. based
on PLMN change trigger), indicating the PLMN change and \"Roaming charging
profile\" if received from the VPLMN. This step occurs before SMF interacts
with the UPF.
8ach-b. The H-CHF in HPLMN updates the CDR.
8ach-c. The H-CHF in HPLMN acknowledges by sending Charging Data Response
[Update] to the H-SMF and optionally the HPLMN selected \"Roaming Charging
Profile\" for this VPLMN.
8c. Nsmf_PDUSession_Update Response from the H-SMF to the V-SMF with the
\"Roaming charging profile\".
8cch-a. A Charging Data Request [Update] is sent to the V-CHF with charging
information received from H-SMF, which includes the HPLMN selected \"Roaming
charging profile\", if received from HPLMN.
8cch-b. The V-CHF updates the CDR.
8cch-c. The V-CHF acknowledges by sending Charging Data Response [Update] to
the V-SMF.
9, 17-21. Refer steps 9 and 17 to 21 in Figure 4.23.4.3-1 of TS 23.502 [201].
##### 5.2.2.12.6 Inter-PLMN V-SMF change
The following figure 5.2.2.12.6.1 describes the Home Routed PDU Session case
in which the UE moves out of V-SMF service area in the serving PLMN to a new
PLMN V-SMF service area for the service request procedure based on figure
4.23.4.3-1 of TS 23.502 [201], with I-SMF replaced by V-SMF in I-SMF change
scenario (the CHF interaction is similar for N2 and Xn based handover
procedures):
{width="7.157638888888889in" height="7.985416666666667in"}
Figure 5.2.2.12.6.1: Roaming Home routed PDU session inter-PLMN V-SMF change
0ch-a: Ongoing charging session in the old VPLMN for UE served by the old
V-SMF, using "Charging Identifier 1".
0ch-b: Ongoing charging session for HPLMN for UE served by the old V-SMF,
using "Charging Identifier 1".
1-2. UE moves into a different PLMN, and the new AMF determines the new V-SMF
based on service area.
3- 4b. SM Context retrieval by the new V-SMF from the old V-SMF. The "Charging
Identifier 1" is conveyed to the new V-SMF.
4ch-a. The UE is identified as a roamer, the CHF is selected accordingly.
4ch-b. A Charging Data Request [Initial] is sent to the new V-CHF, indicating
"in-bound roamer" and "Charging Identifier 1" received on step 4b.
4ch-c. The new V-CHF opens a CDR (indicating "in-bound roamer").
4ch-d. The new V-CHF acknowledges by sending Charging Data Response [Initial]
to new V-SMF and optionally supplies a "Roaming charging profile" to new V-SMF
which overrides the default one.
5-7c. Refer steps 5 to 7c in Figure 4.23.4.3-1 of TS 23.502 [201].
7ch-a. A Charging Data Request [Termination] is sent to old V-CHF, with
"Charging Identifier 1".
7ch-c. The old V-CHF closes the CDR.
7ch-d. The old V-CHF acknowledges by sending Charging Data Response [Initial]
to old V-SMF.
8a. Nsmf_PDUSession_Update Request from new V-SMF towards the H-SMF with the
"Roaming Charging Profile".
8ach-a. A Charging Data Request [Update] is sent to H-CHF in HPLMN, indicating
the V-SMF change and "Roaming charging profile" if received from the VPLMN.
This step occurs before SMF interacts with the UPF.
8ach-b. The H-CHF in HPLMN updates the CDR.
8ach-c. The H-CHF in HPLMN acknowledges by sending Charging Data Response
[Update] to the H-SMF and optionally supplies the HPLMN selected "Roaming
Charging Profile" for this VPLMN.
8c. Nsmf_PDUSession_Update Response from H-SMF to new V-SMF with the "Roaming
charging profile".
8cch-a. A Charging Data Request [Update] is sent to V-CHF with charging
information received from H-SMF, which includes the HPLMN selected "Roaming
charging profile" if received.
8cch-b. The V-CHF updates the CDR.
8cch-c. The V-CHF acknowledges by sending Charging Data Response [Update] to
the V-SMF.
9, 17-21. Refer steps 9 and 17 to 21 in Figure 4.23.4.3-1 of TS 23.502 [201].
##### 5.2.2.12.7 Intra-PLMN V-SMF change
The following figure 5.2.2.12.7.1 describes the Home Routed PDU Session case
in which the UE moves out of V-SMF service area in the serving PLMN to a new
V-SMF service area in the serving PLMN, based on figure 4.23.4.3-1 of TS
23.502 [201], with I-SMF replaced by V-SMF in I-SMF change scenario:
Figure 5.2.2.12.7.1: Roaming Home routed PDU session intra-PLMN V-SMF change
0ch-a and 0ch-b: same as in Figure 5.2.2.12.6.1.
1-2. UE moves out of the old V-SMF service area, and the new AMF determines
the new V-SMF service area in the same VPLMN.
3- 4b. SM Context retrieval by new V-SMF from the old V-SMF. The \"Charging
Identifier 1\", the \"Home roaming charging profile\", and the V-CHF address,
are conveyed to the new V-SMF.
4ch-a. A Charging Data Request [Initial] is sent to V-CHF, indicating \"in-
bound roamer\" and \"Charging Identifier 1\" received on step 4b.
NOTE: Since the same V-CHF is used, the \"Home roaming charging profile\" to
be used is already known by the V-CHF
4ch-b. The V-CHF opens a CDR (indicating "in-bound roamer").
4ch-c. The V-CHF acknowledges by sending Charging Data Response [Initial] to
new V-SMF.
4ch-d. A Charging Data Request [Termination] is sent to V-CHF, with "Charging
Identifier 1".
4ch-e. The V-CHF closes the CDR.
4ch-f. The V-CHF acknowledges by sending Charging Data Response [Termination]
to old V-SMF.
5-21. Same steps as in Figure 5.2.2.12.6.1, except the \"Roaming charging
profile\" is not renegotiated, i.e., not contained in steps 8a, 8ach-a,
8ach-c, 8c and 8cch-a.
##### 5.2.2.12.8 Inter-PLMN V-SMF insertion - without Charging Identifier
string
The flow is the same as in clause 5.2.2.12.5, with the difference in steps:
3- 4b. SM Context retrieval by V-SMF from the H-SMF. The \"Charging Identifier
1\" is converted from a string to an integer and conveyed to the V-SMF. The
conversion needs to be done so that the new Charging Identifier is unique
within the V-SMF.
4ch-b. A Charging Data Request [Initial] is sent to the V-CHF, indicating
\"in-bound roamer\" and \"Charging Identifier 1\" as integer received on step
4b.
8ach-a. A Charging Data Request [Update] is sent to H-CHF in HPLMN (e.g. based
on PLMN change trigger), indicating the PLMN change, \"Charging Identifier 1\"
as integer or string, and \"Roaming charging profile\" if received from the
VPLMN.
##### 5.2.2.12.9 Inter-PLMN V-SMF removal
The following figure 5.2.2.12.9.1 describes the Home Routed PDU Session case
in which the UE moves out of V-SMF service area in the VPLMN back to the home
PLMN and H-SMF service area for the registration procedure based on clause
4.23.3 of TS 23.502 [201], with I-SMF replaced by V-SMF in I-SMF removal
scenario (the CHF interaction is similar for N2 (clause 4.23.7.3 of TS 23.502
[201]) and Xn based handover (clause 4.23.11.4 of TS 23.502 [201])
procedures):
{width="5.624305555555556in" height="5.279861111111111in"}
Figure 5.2.2.12.9.1: Roaming Home routed PDU session inter-PLMN V-SMF removal
0ch-a: Ongoing charging session for HPLMN for UE served by H-SMF, using
\"Charging Identifier 1\".
1\. UE moves back to the HPLMN, and the new AMF selects the H-SMF based
context information provided by the old-AMF. This corresponds to steps 1-16 as
specified in clause 4.23.3 of TS 23.502[201].
2\. Nsmf_PDUSession_CreatePDUSessionContext_Request is sent from the new-AMF
to the H-SMF as specified in Step 17 of clause 4.23.3 of TS 23.502[201].
3\. The H-SMF determines that the UE has returned to HPLMN and that the V-SMF
is no longer required
3ch-a. A Charging Data Request [Update, Roaming Charging Profile] is sent to
the H-CHF, with trigger indicating removal of I-SMF.
3ch-b. Based on the trigger, the H-CHF closes the QBC CDRs
3ch-c, The H-CHF acknowledges by sending Charging Data Response [Update] to
the H-SMF.
4\. Nsmf_PDUSession_CreatePDUSessionContext_Response is sent from the H-SMF to
the new AMF.
5\. Registration Procedure continues as captured in clause 4.23.3 of TS 23.502
[201].
6\. After timer expires in the Old AMF, the Old AMF deletes the context in the
V-SMF by sending a Nsmf_PDUSession_ReleasePDUSessionContext_Request message.
7\. Nsmf_PDUSession_ReleasePDUSessionContext_Response is sent from the V-SMF
to the old AMF7ch-a. A Charging Data Request [Terminate] is sent to the V-CHF,
with trigger indicating removal of I-SMF.
7ch-b. Based on the I-SMF removal trigger, the V-CHF closes the V-SMF CDRs
7ch-c. The V-CHF acknowledges by sending Charging Data Response [Terminate] to
the V-SMF.
#### 5.2.2.13 PDU session charging - non-3GPP access
##### 5.2.2.13.1 General
After UE registration to 5GC via an non-3GPP access network, a PDU session can
be established via this non-3GPP access. For following scenarios, the PDU
session establishment via untrusted non-3GPP access network is specified in
clause 4.12 of TS 23.502 [201] and the PDU session establishment via trusted
non-3GPP access network is specified in clause 4.12a of TS 23.502 [201]:
\- UE initiated PDU session establishment;
\- Handover of a PDU Session from 3GPP access to untrusted non-3GPP access;
\- Service Request procedures via Untrusted non-3GPP Access specified in
clause 4.12.4.5 of TS 23.502 [201];
\- Service Request procedures via Trusted non-3GPP Access specified in clause
4.12.4a.5 of TS 23.502 [201].
Handover procedure of a PDU Session between 3GPP access and non-3GPP access is
achieved by PDU Session Establishment over source access followed by PDU
Session Release over the target access for respective N2 Resources Release.
The PDU Session ID, IP address/prefix, and SSC mode are maintained during the
move.
PDU session over Untrusted non-3GPP Access release and Trusted non-3GPP Access
release are specified in clause 4.12.7 and clause 4.12a.7 of TS 23.502 [201].
##### 5.2.2.13.2 PDU session establishment
##### 5.2.2.13.2.1 PDU session establishment via an untrusted non-3GPP access
network {#pdu-session-establishment-via-an-untrusted-non-3gpp-access-network
.H6}
The following figure 5.2.2.13.2.1 describes a PDU session charging
establishment via an untrusted non-3GPP access network scenario based on
figure 4.12. 5.1 in TS 23.502 [201] description:
Figure 5.2.2.13.2.1: PDU Session establishment via untrusted non-3GPP access
[2ch-a to 2ch-c]. Two cases:
\- In case of \"Initial request\" the same steps as steps 7ch-a to 7ch-c in
figure 5.2.2.2.1 apply, for initial SMF interaction with CHF, with Charging
Data Request [Initial].
\- In case of \"Existing PDU Session\" the \"radio access type change\"
trigger may apply for SMF interaction with CHF, with Charging Data Request
[Update].
##### 5.2.2.13.2.2 PDU session establishment via Trusted Non-3GPP access
network {#pdu-session-establishment-via-trusted-non-3gpp-access-network .H6}
After the UE registers to 5GC via trusted non-3GPP access network, the UE may
request a PDU Session establishment by using the same procedure as the one
specified in clause 5.2.2.13.2.1 for untrusted non-3GPP access, with the
following modifications:
\- The N3IWF in Figure 5.2.2.13.2.1 should be substituted with a TNGF and the
Untrusted non-3GPP access should be substituted with a Trusted non-3GPP Access
Point (TNAP).
\- Charging Data Request [Initial/Update] contains RAT type and user location
specifics to trusted non-3GPP.
\- The TNGF may send a TNGF Identities parameter to AMF inside an N2 Uplink
NAS Transport message. The TNGF Identities parameter contains a list of
identifiers (i.e. FQDNs or IP addresses) of N3 terminations supported by the
TNGF. If received by the AMF, it shall forward it to the SMF, which may use it
as input to UPF selection.
##### 5.2.2.13.3 PDU session modification
##### 5.2.2.13.3.1 PDU session modification via an untrusted non-3GPP access
network {#pdu-session-modification-via-an-untrusted-non-3gpp-access-network
.H6}
The following figure 5.2.2.13.3.1 describes a PDU session charging
modification via an untrusted non-3GPP access network scenario based on figure
4.12.16.1 in TS 23.502 [201] description:
Figure 5.2.2.13.3.1: PDU Session modification via untrusted non-3GPP access
[2ch-a to 2ch-c]: Interaction between SMF and CHF triggered by the
modification applied to the PDU session (e.g. QoS handling).
##### 5.2.2.13.3.2 PDU session modification via Trusted Non-3GPP access
network {#pdu-session-modification-via-trusted-non-3gpp-access-network .H6}
The UE or network requested PDU Session Modification procedure via trusted
non-3GPP access network is the same procedure as the one specified in clause
5.2.2.13.3.1 for untrusted non-3GPP access, with the following modifications:
\- The N3IWF in Figure 5.2.2.13.3.1 should be substituted with a TNGF and the
Untrusted non-3GPP access should be substituted with a Trusted non-3GPP Access
Point (TNAP).
\- Interaction between SMF and CHF triggered by the modification contains RAT
type and user location specifics to trusted non-3GPP.
##### 5.2.2.13.4 PDU session release
##### 5.2.2.13.4.1 PDU session release via an untrusted non-3GPP access
network {#pdu-session-release-via-an-untrusted-non-3gpp-access-network .H6}
The following figure 5.2.2.13.4.1 describes a PDU session charging release via
an untrusted non-3GPP access network scenario based on figure 4.12.17.1 in TS
23.502 [201] description:
Figure 5.2.2.13.4.1: PDU Session release via untrusted non-3GPP access
[3cha-3chb]. Two cases:
\- In case the PDU session needs to be released, SMF interaction with CHF for
release, with Charging Data Request [Termination].
\- In case of handover from non-3GPP access to 3GPP access, SMF may interacts
with CHF, with Charging Data Request [Update].
NOTE 1: the \"radio access type change\" trigger, if enabled, applied during
the PDU session establishment over the 3GPP access which was performed prior
to this PDU session release over non-3GPP access.
##### 5.2.2.13.4.2 PDU session release via Trusted Non-3GPP access network
{#pdu-session-release-via-trusted-non-3gpp-access-network .H6}
The UE or the network can release a PDU Session via a trusted non-3GPP access
network as specified in clause 5.2.2.13.4.1 for the untrusted non-3GPP access
with the following modifications:
\- The untrusted non-3GPP access is substituted by a trusted non-3GPP access
point (TNAP).
\- The N3IWF is substituted by the TNGF.
#### 5.2.2.14 PDU session served by I-SMF and SMF
##### 5.2.2.14.1 General
When the I-SMF is inserted, re-allocated, or removed in a PDU Session as
specified in TS 23.501 [200], the SMF may report the charging information to
the CHF.
When the I-SMF with UL CL/BP is inserted based on information received from
SMF, the I-SMF forwards traffic usage information to the SMF as specified in
TS 23.501 [200].
##### 5.2.2.14.2 PDU session establishment with I-SMF insertion
The following figure 5.2.2.14.2.1 describes a PDU session establishment
charging, for the case where the service area of the selected SMF does not
include the location where the UE camps, based on TS 23.502 [201] figure
4.3.2.2.2, where the V-SMF and V-UPF are replaced by I-SMF and I-UPF, and
H-SMF and H-UPF are replaced by SMF and UPF (PSA) respectively:
Figure 5.2.2.14.2.1: UE-requested PDU Session Establishment with I-SMF
insertion
2\. The AMF selects SMF and I-SMF upon SMF serving area cannot cover UE
location.
5a. I-SMF selects one or more UPFs.
11\. The SMF may perform a Session Management Policy Modification procedure to
report some event to the PCF that has previously subscribed.
11ch-a. The SMF creates a Charging Identifier for the PDU session and sends
Charging Data Request [Initial] including I-SMF information to CHF for
authorization for the subscriber to start the PDU session which is triggered
by start of PDU session charging event.
11ch-b. The CHF opens CDR for this PDU session.
11ch-c. The CHF acknowledges by sending Charging Data Response [Initial] to
the SMF.
14\. AMF to SMF: SM Request (N2 SM information).
[19a-b]. N4 session Modification.
19c, I-SMF notify SMF on N4 information with Traffic usage reporting.
19ch-a. This step may occur in case \"start of service data flow\" needs quota
from CHF, for the SMF to request quota for both own and I-SMF usage.
19ch-b. The CHF updates CDR for this PDU session.
19ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the
SMF.
NOTE 1: The steps from 19ch-a to 19ch-c for quota request from CHF are not
applicable for offline only charging.
20\. SM Request with PDU session Update Response to AMF.
21\. SMF sends SM Context Status Notify to AMF.
22\. In case of PDU Type IPv6, IPv6 Address Configuration.
NOTE 2: I-SMF controlling both I-UPF and PSA2 UPF upon local traffic offload
scenarios, can enforce usage report and/or quota management for PSA2 UPF.
##### 5.2.2.14.3 PDU Session modification procedure with I-SMF involved
The following figure 5.2.2.14.3-1 describes a PDU Session modification
charging message flow, for the case where the service area of the selected SMF
does not include the location where the UE camps, with simplified I-SMF with
UE and Serving Network message flows , based on TS 23.502 [201] figure
4.3.3.3-1, where the V-SMF and V-UPF are replaced by I-SMF and I-UPF, and
H-SMF and H-UPF are replaced by SMF and UPF (PSA) respectively:
Figure 5.2.2.14.3-1: UE or network requested PDU Session Modification charging
with I-SMF involved
> PDU Session served by both I-SMF and SMF has been established, with the
> ongoing Charging session.
>
> 1a. UE or serving network AMF requested PDU Session Modification Request to
> I-SMF, I-SMF invokes a Nsmf_PDUSession_Update Request message to SMF,
> including User Location Information, QoS information and I-SMF information.
> SMF accept with Nsmf_PDUSession_Update_Response message to I-SMF.
1a.ch-a. All counts are closed in SMF and a Charging Data Request [Update]
message with PDU Session related triggers including I-SMF information is sent
to CHF, if required by immediate report category trigger. New counts and time
stamps for all active service data flows are started in the SMF.
1a.ch-b. The CHF updates CDR for this PDU session.
1a.ch-c. The CHF acknowledges by sending Charging Data Response [Update]
message to the SMF.
1b\~1d. With PCF initiated SM Policy Association Modification or UDM updated
the subscription data or SMF decided to modify PDU Session triggers, SMF
starts SMF requested PDU Session Modification procedures.
1e. (R)AN initiated PDU Session Modification Request to I-SMF, I-SMF invokes a
Nsmf_PDUSession_Update Request message to SMF, including User Location
Information, QoS information with indication of QoS flow released and I-SMF
information. SMF accept with Nsmf_PDUSession_Update_Response message to I-SMF.
1b\~1e.ch-a. All counts are closed in SMF and a Charging Data Request [Update]
message with PDU Session related triggers including I-SMF information is sent
to CHF, if required by immediate report category trigger. New counts and time
stamps for all active service data flows are started in the SMF.
1b\~1e.ch-b. The CHF updates CDR for this PDU session.
1b\~1e.ch-c. The CHF acknowledges by sending Charging Data Response [Update]
message to the SMF.
3\. With SMF initiated QoS flows modification procedure, SMF invokes a
Nsmf_PDUSession_Update Request message to I-SMF.
4\~14. I-SMF interacting with UE and Serving Network message flows, including
the QoS rule(s) and QoS Flow level QoS parameters operations.
15\. I-SMF invokes a Nsmf_PDUSession_Update Response message to SMF, including
User Location Information, QoS flow information and I-SMF information.
15.ch-a. All counts are closed in SMF and a Charging Data Request [Update]
message with PDU Session related triggers including I-SMF information is sent
to CHF, if required by immediate report category trigger. New counts and time
stamps for all active service data flows are started in the SMF.
15.ch-b. The CHF updates CDR for this PDU session.
15.ch-c. The CHF acknowledges by sending Charging Data Response [Update]
message to the SMF.
##### 5.2.2.14.4 PDU Session release procedure with I-SMF involved
The following figure 5.2.2.14.4-1 describes a PDU session release charging
message flow, for the case where the service area of the selected SMF does not
include the location where the UE camps, with simplified I-SMF with UE and
Serving Network message flows , based on TS 23.502 [201] figure 4.3.4.3-1,
where the V-SMF and V-UPF are replaced by I-SMF and I-UPF, and H-SMF and H-UPF
are replaced by SMF and UPF (PSA) respectively.
Figure 5.2.2.14.4-1: UE or network requested PDU Session release charging with
I-SMF involved
> PDU Session served by both I-SMF and SMF has been established, with the
> ongoing Charging session.
1a-14. UE initiates PDU session release procedure, finally with
Nsmf_PDUSession_Update Response message sent from SMF to the inserted I-SMF.
14.ch-a. All counts are closed in SMF and a Charging Data Request [Release]
message including I-SMF information is sent to CHF, with usage reporting.
14.ch-b. The CHF close CDR for this PDU session.
14.ch-c. The CHF acknowledges by sending Charging Data Response [Release]
message to the SMF.
##### 5.2.2.14.5 PDU Session procedures with I-SMF insertion/change/removal
PDU Session procedures with I-SMF insertion/change/removal, including below
three figures described procedures covering Service Request, N2 based handover
and Xn based handover.
The following figure 5.2.2.14.5-1 describes PDU session charging message
flows, for the Service Request cases where
\- the UE moves from SMF service area to new I-SMF service area, a new I-SMF
is inserted (i.e. I-SMF insertion); or
\- the UE moves from old I-SMF service area to new I-SMF service area, the
I-SMF is changed (i.e. I-SMF change); or
\- the UE moves from I-SMF service area back to SMF service area, the I-SMF is
removed (i.e. I-SMF removal).
with simplified UE with 5GS message flows, based on TS 23.502 [201] figure
4.23.4.3-1, for I-SMF insertion, change, removal respectively, and specifies
the corresponding charging message flow between SMF and CHF.
Figure 5.2.2.14.5-1: PDU Session charging message flows for UE Triggered
Service Request procedure with I-SMF insertion/change/removal
> PDU Session served by both I-SMF and SMF has been established, with the
> ongoing Charging session.
>
> PDU Session message flows for UE Triggered Service Request procedure, with
> I-SMF insertion/change/removal triggers charging message flows as below:
\- I-SMF insertion message flows, upon UE moves from SMF service area to I-SMF
service area, before the SMF updates the UPF and also before
Nsmf_PDUSession_Create Response message is sent from SMF to the inserted I-SMF
(Detail message flows refer to TS 23.502,4.23.4.3-1 step 3 to 8a), or before
the SMF updates the UPF and also before Nsmf_PDUSession_Update Response
message is sent from SMF to the inserted I-SMF (Detail message flows refer to
TS 23.502 [201],4.23.4.3-1 step 18 to 20a).
\- I-SMF change message flows, upon UE moves from old SMF service area to new
I-SMF service area, before the SMF updates the UPF and also before
Nsmf_PDUSession_Update Response message is sent from SMF to the inserted new
I-SMF (Detail message flows refer to TS 23.502 [201],4.23.4.3-1 step 3 to 8a,
or step 18 to 20a).
\- I-SMF removal message flows, upon UE moves from I-SMF service area back to
SMF service area, finally SMF send Nsmf_PDUSession_CreateSMContext Response
message to AMF (Detail message flows refer to TS 23.502,4.23.4.3-1 step 10 to
16), or SMF send Nsmf_PDUSession_UpdateSMContext Response message to AMF
(Detail message flows refer to TS 23.502 [201], 4.23.4.3-1 step 22 to 25)
> x.ch-a. All counts are closed in SMF, and a Charging Data Request [Update]
> message including I-SMF information and "insertion/change/removal of I-SMF"
> trigger is sent to CHF, if required by immediate report category trigger.
> New counts and time stamps for all active service data flows are started in
> the SMF.
>
> x.ch-b. The CHF updates CDR for this PDU session.
>
> x.ch-c. The CHF acknowledges by sending Charging Data Response [Update]
> message to the SMF.
NOTE 1: x in figure 5.2.2.14.5-1, refer to the last step number in the detail
message flows. For I-SMF insertion or I-SMF change, x refers to 8a or20a. For
I-SMF removal, x refers to 16 or 25.
The following figure 5.2.2.14.5-2 describes PDU session charging message
flows, for N2 based handover, with I-SMF insertion, change, removal.
Figure 5.2.2.14.5-2: PDU Session charging message flows for Inter NG-RAN node
N2 based handover, execution phase, with I-SMF insertion/change/removal
> PDU Session served by both I-SMF and SMF has been established, with the
> ongoing Charging session between SMF and CHF.
>
> PDU Session message flows for Inter NG-RAN node N2 based handover procedure,
> with I-SMF insertion/change/removal triggers charging message flows as
> below:
\- I-SMF insertion message flows, for N2 based handover, refer to TS 23.502
[201], 4.23.7.3.3-1 step 2 to 6.
\- I-SMF Change message flows, for N2 based handover, refer to TS 23.502
[201], 4.23.7.3.3-1 step 2 to 6,
\- I-SMF Removal message flows, for N2 based handover, refer to TS 23.502
[201], 4.23.7.3.3-1 step 10 to 14.
> x.ch-a. All counts are closed in SMF with the I-SMF, and a Charging Data
> Request [Update] message including I-SMF information and
> "insertion/change/removal of I-SMF" trigger is sent to CHF, if required by
> immediate report category trigger. New counts and time stamps for all active
> service data flows are started in the SMF.
>
> x.ch-b. The CHF updates CDR for this PDU session.
>
> x.ch-c. The CHF acknowledges by sending Charging Data Response [Update]
> message to the SMF.
NOTE 2: x in figure 5.2.2.14.5-2, refer to the last step number in the detail
message flows. For I-SMF insertion or I-SMF change, x refers to 6\. For I-SMF
removal, x refers to 14.
The following figure 5.2.2.14.5-3 describes PDU session charging message
flows, for Xn based handover, with I-SMF insertion, change, removal.
Figure 5.2.2.14.5-3: PDU Session charging message flows for Xn based handover,
execution phase, with I-SMFinsertion/change/removal
> PDU Session served by both I-SMF and SMF has been established, with the
> ongoing Charging session between SMF and CHF.
>
> PDU Session message flows for Xn based handover procedure, with I-SMF
> insertion/change/removal triggers charging message flows as below:
\- I-SMF insertion message flows, for Xn based handover, refer to TS 23.502
[201], 4.23.11.2-1 step 1 to 6.
\- I-SMF Change message flows, for Xn based handover, refer to TS 23.502
[201], 4.23.11.3-1 step 1 to 6,
\- I-SMF Removal message flows, for Xn based handover, refer to TS 23.502
[201], 4.23.11.4-1 step 1 to 8.
> x.ch-a. All counts are closed in SMF with the I-SMF, and a Charging Data
> Request [Update] message including I-SMF information and
> "insertion/change/removal of I-SMF" trigger is sent to CHF, if required by
> immediate report category trigger. New counts and time stamps for all active
> service data flows are started in the SMF.
>
> x.ch-b. The CHF updates CDR for this PDU session.
>
> x.ch-c. The CHF acknowledges by sending Charging Data Response [Update]
> message to the SMF.
NOTE 3: x in figure 5.2.2.13.5-3, refer to the last step number in the detail
message flows. For I-SMF insertion or I-SMF change, x refers to 6\. For I-SMF
removal, x refers to 8.
##### 5.2.2.14.6 5GS to EPS handover using N26 interface with I-SMF removal
When 5GS to EPS handover using N26 interface in idle mode, procedure in TS
23.502 [201] clause 4.23.12.2 is applicable.
When 5GS to EPS handover using N26 interface in active mode, procedure in TS
23.502 [201] clause 4.23.12.6 is applicable.
Upon UE moves from I-SMF service area to EPS service area, with both RAT Type
change and I-SMF removal triggered, PGW-C+SMF and CHF will conduct below
charging procedures:
x.ch-a. All counts are closed in PGW-C+SMF with a Charging Data Request
[Update] message including I-SMF information and both "RAT Type change" and
"removal of I-SMF" triggers are sent to CHF, if required by immediate report
category trigger. New counts and time stamps for all active service data flows
are started in the PGW-C+SMF.
x.ch-b. The CHF updates CDR for this PDU session.
x.ch-c. The CHF acknowledges by sending Charging Data Response [Update]
message to the PGW-C+SMF.
NOTE 1: x refers to the last message step number with I-SMF removal in the
detail message flows in TS 23.502 [201] clause 4.23.12.2 or clause 4.23.12.6.
##### 5.2.2.14.7 EPS to 5GS handover using N26 interface with I-SMF insertion
When EPS to 5GS handover using N26 interface in idle mode, procedure in TS
23.502 [201] clause 4.23.12.3 is applicable.
When EPS to 5GS handover using N26 interface in active mode, procedure in TS
23.502 [201] clause 4.23.12.7 is applicable.
Upon UE moves from EPS service area to I-SMF service area, with both RAT Type
change and I-SMF insertion triggered, PGW-C+SMF and CHF conduct below charging
procedures:
x.ch-a. All counts are closed in PGW-C+SMF with a Charging Data Request
[Update] message including I-SMF information and both "RAT Type change" and
"insertion of I-SMF" triggers are sent to CHF, if required by immediate report
category trigger. New counts and time stamps for all active service data flows
are started in the PGW-C+SMF.
x.ch-b. The CHF updates CDR for this PDU session.
x.ch-c. The CHF acknowledges by sending Charging Data Response [Update]
message to the PGW-C+SMF.
NOTE 1: x refers to the last message step number with I-SMF insertion in the
detail message flows in TS 23.502 [201] clause 4.23.12.3 or clause 4.23.12.7.
##### 5.2.2.14.8 Addition/removal/change of PSA and UL CL or BP controlled by
I-SMF
This clause is based on TS 23.502 clause 4.23.9.1, 4.23.9.2 and 4.23.9.3
procedures, describes simplified procedures of addition/removal/change of PSA
and UL CL or BP controlled by I-SMF, adding with charging message flow:
Figure 5.2.2.14.8-1: Addition/removal/change of PSA and UL CL or BP controlled
by I-SMF
PDU Session served by both I-SMF and SMF has been established, with the
ongoing Charging session.
PDU Session message flows with addition/removal/change of I-SMF controlled
addition/removal/change of PSA and UL CL/BP with charging message flows as
below:
\- Addition of PDU Session Anchor (PSA2) for UL CL/BP controlled by I-SMF
message flows, refer step 2 to step 4 described in figure 4.23.9.1-1 of TS
23.502[201].
\- Removal of PDU Session Anchor (PSA2) for UL CL/BP controlled by I-SMF
message flows, refer step 2 to step 9 described in figure 4.23.9.2-1 of TS
23.502[201].
\- Change of PDU Session Anchor (PSA0 to PSA2) for UL CL/BP controlled by
I-SMF message flows, refer step 2 to step 3 and step 4 to step 10 described in
figure 4.23.9.3-1 of TS 23.502[201].
x.ch-a. All counts are closed in SMF for I-SMF controlled local PSA traffic,
and a Charging Data Request [Update] message including I-SMF information and
"addition/removal of UPF" trigger is sent to CHF, if required by immediate
report category trigger. New counts and time stamps for all addition of PSA
active service data flows are started in the SMF.
x.ch-b The CHF updates the CDR for this PDU Session.
x.ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the
SMF.
NOTE 1: x in figure 5.2.2.14.8-1, refer to the last step number in the detail
message flows. For addition of PDU Session Anchor (PSA2), x refers to 4. For
removal of PDU Session Anchor (PSA2), x refers to 9. For addition of PDU
Session Anchor (PSA2) during change of PSA2, x refers to 3.
Removal of PDU Session Anchor (PSA0) for UL CL/BP controlled by I-SMF message
flows, refer step 4 to step 10 described in figure 4.23.9.3-1 of TS
23.502[201].
10.ch-a. All counts are closed in SMF for I-SMF controlled the PSA0 traffic,
and a Charging Data Request [Update] message including I-SMF information and
"removal of UPF" trigger is sent to CHF, if required by immediate report
category trigger.
10.ch-b The CHF updates the CDR for this PDU Session.
10.ch-c. The CHF acknowledges by sending Charging Data Response [Update] to
the SMF.
NOTE 2: steps 10.ch-a to 10.ch-c are only applied in Change of PDU Session
Anchor (PSA0 to PSA2) procedure.
##### 5.2.2.14.9 Void
##### 5.2.2.14.10 Void
#### 5.2.2.15 PDU session charging from SMF - ATSSS
##### 5.2.2.15.1 General
This clause specifies PDU session charging for a MA PDU session as defined in
TS 23.501 [200].
The flows are based on message flows specified in clause 4.22 TS 23.502 [201],
##### 5.2.2.15.2 UE requested MA PDU session establishment
The following figure 5.2.2.15.2.1 describes charging procedure for MA PDU
Session establishment requested by UE, based on figure 5.2.2.2.2.1 description
with the following differences identified in clause 4.22.2.1 TS 23.502 [202]:
Figure 5.2.2.15.2.1: UE Requested MA PDU session establishment
\- The UE is registered in both 3GPP access and non-3GPP access, and UE PDU
Session Establishment Request message is sent over the 3GPP access.
1\. PDU Session Establishment Request is indicated with \"MA PDU Request\" and
ATSSS Capability (e.g. an \"MPTCP Capability\" and/or an \"ATSSS-LL
Capability\").
2-3. The AMF informs the SMF that the request is for a MA PDU Session and
indicates the UE is registered over both accesses.
7a-b. PCC Rules supplied by PCF contain ATSSS policy control information,
optionally with a dedicated non-3GPP access rating group. From these PCC
Rules, the SMF derives ATSSS rules for uplink and N4 rules for downlink for
controlling the traffic steering, switching and splitting.
9ch-a. The SMF sends Charging Data Request [initial] indicating \"MA PDU
session requested by UE\" to CHF for authorization for the subscriber to start
the MA PDU session.
9ch-b. The CHF opens CDR for this MA PDU session.
9ch-c. The CHF acknowledges by sending Charging Data Response [Initial] to the
SMF.
10-13. Procedure based on ATSSS policy and SMF derived both N4 Rules and ATSSS
rules to UE.
16ch-a. This step may occur in case \"start of service data flow\" over 3GPP
needs quota from CHF for appropriate rating group, the SMF sends Charging Data
Request [Update] for requesting quota.
16ch-b. The CHF updates CDR for this MA PDU session.
16ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the
SMF.
After step 18 in figure 5.2.2.2.2.1, if the SMF was informed in step 2 that
the UE is registered over both accesses, the SMF initiates the establishment
of user-plane resources over non-3GPP access via AMF. After the user plane is
established with the non-3GPP access:
Xch-a. The SMF sends Charging Data Request [Update]. This step may occur in
case following chargeable events need quota from CHF for appropriate rating
group, or if required by \"immediate reporting\" category:
\- \"start of SDF additional access\" over non-3GPP.
\- \"start of service data flow\" over non-3GPP or 3GPP.
Xch-b. The CHF updates CDR for this MA PDU session.
Xch-c. The CHF acknowledges by sending Charging Data Response [Update] to the
SMF.
In the scenario where the PDU Session Establishment Request message for the MA
PDU session is sent over the non-3GPP access, and the user plane over the
non-3GPP access is established before the user plane over 3GPP:
16ch-a. This step may occur in case \"start of service data flow\" over
non-3GPP needs quota from CHF for appropriate rating group, or if required by
\"immediate reporting\" category
Xch-a. This step may occur in case following chargeable events need quota from
CHF for appropriate rating group, or if required by \"immediate reporting\"
category:
\- \"start of SDF additional access\" over 3GPP.
\- \"start of service data flow\" over non-3GPP or 3GPP.
##### 5.2.2.15.3 UE requested PDU session establishment with Network
Modification to MA PDU Session
The following flow describes the charging procedure for a single access PDU
session establishment by ATSSS-capable UE and the 5GC network decides to
convert to a Multi-Access PDU (MA PDU) Session, based on figure 5.2.2.2.2.1
description with the following differences identified in clause 4.22.3 TS
23.502 [202]:
\- The UE is registered in both 3GPP access and non-3GPP access and sends a
PDU Session Establishment Request message over the 3GPP access.
1\. PDU Session Establishment Request may include \"MA PDU Network-Upgrade
Allowed\" indication and its ATSSS Capability.7. The single-access PDU Session
requested by the UE is converted into a MA PDU Session by SMF based on \"MA
PDU Network-Upgrade Allowed\" indication, and PCC Rules are supplied by PCF
containing ATSSS policy control information optionally with a dedicated
non-3GPP access rating group.
9ch-a. The SMF sends Charging Data Request [initial] indicating \"MA PDU
session requested by Network modification\" to CHF.
9ch-b. The CHF opens CDR for this MA PDU session.
9ch-c. The CHF acknowledges by sending Charging Data Response [Initial] to the
SMF.
Steps after step 10 in clause 5.2.2.15.2 apply.
##### 5.2.2.15.4 UE Requested PDU Session Establishment with Network
Modification to MA PDU Session - roaming in Home routed scenario
The charging procedure for single access PDU session establishment requested
by ATSSS-capable UE and converted to a Multi-Access PDU (MA PDU) Session by
the 5GC network in roaming Home routed scenario, is based on figures in clause
5.2.2.15.X. and description in clause 4.22.3 TS 23.502 [202].
###### 5.2.2.15.4.1 UE registered to the same VPLMN over 3GPP access and
non-3GPP access
The charging procedure for UE registered to the same VPLMN over 3GPP access
and non-3GPP access is based on figure 5.2.2.15.X.1.1 with differences
identified in clause 4.22.3 TS 23.502 [202]:
\- The UE is registered to the same VPLMN over 3GPP access and non-3GPP
access, and UE PDU Session Establishment Request message is sent over the 3GPP
access.
1-3a. UE PDU Session Establishment Request may include \"MA PDU Network-
Upgrade Allowed\" indication and its ATSSS Capability. This indication may be
conveyed by AMF to V-SMF.
6\. The V-SMF provides the \"MA PDU Network-Upgrade Allowed\" indication to
H-SMF, if received from AMF together with an indication whether the UE is
registered over both accesses.
9a-b. The single-access PDU Session received by H-SMF with \"MA PDU Network-
Upgrade Allowed\" indication is converted into a MA PDU Session. PCC Rules are
supplied by PCF containing ATSSS policy control information optionally with a
non-3GPP access dedicated rating group.
11ch-a to c. Same steps as in figure 5.2.2.12.2.1 with Charging Data Request
[Initial] indicating \"MA PDU session requested by the Network\".
##### 5.2.2.15.5 UE requested MA PDU session establishment - roaming in Home
routed scenario
###### 5.2.2.15.5.1 General
The charging procedure for MA PDU Session establishment requested by UE in
roaming Home routed scenario is based on figure 5.2.2.12.2.1 and description
in clause 4.22.2.2 TS 23.502 [202].
###### 5.2.2.15.5.2 UE registered to the same VPLMN over 3GPP access and
non-3GPP access
The following figure 5.2.2.15.5.2.1 describes charging procedure for MA PDU
session charging establishment requested by UE in roaming Home routed scenario
for UE registered to the same VPLMN over 3GPP access and non-3GPP access:
Figure 5.2.2.15.5.2.1: UE requested MA PDU session - Roaming Home Routed \-
same VPLMN
\- The UE is registered to the same VPLMN over 3GPP access and non-3GPP
access, and UE PDU Session Establishment Request message is sent over the 3GPP
access.
1-3a. UE initiates a new PDU session indicated with \"MA PDU Request\" and
ATSSS Capability. Selection by the AMF of V-SMF which supports MA PDU
sessions. The AMF indicates to V-SMF that the UE is registered over both
accesses
3ch-a to 3ch-d. Same steps as in figure 5.2.2.12.2.1.
6\. The V-SMF informs the H-SMF that the request is for a MA PDU Session and
the UE is registered over both accesses.
9a-b. PCC rules are supplied by H-PCF containing MA PDU session control
information based on currently used list of Access Type(s) and RAT Type(s).
The H-SMF initiates the establishment of user-plane resources over non-3GPP
access and derives the ATSSS rules for the UE and the N4 rules for the H-UPF.
11ch-a to c. Same steps as in figure 5.2.2.12.2.1 with Charging Data Request
[Initial] indicating \"MA PDU session requested by UE\".
12ch. Counts per QFI are started for both 3GPP and non-3GPP accesses.
13\. Nsmf_PDUSession_Create Response from H-SMF to V-SMF with \"MA PDU session
Accepted\" indication.
13ch-a to c. Same steps as in figure 5.2.2.12.2.1. Counts per QFI are started
for both 3GPP and non-3GPP accesses.
14-19b. Procedure in the VPLMN for 3GPP access and based on H-SMF derived
ATSSS rules to UE for the MA PDU session.
Xch-a. The H-SMF sends Charging Data Request [Update]. This step may occur in
case \"start of service data flow\" chargeable event over 3GPP, when required
by \"immediate reporting\" category.
Xch-b. The H-CHF updates CDR for this MA PDU session.
Xch-c. The H-CHF acknowledges by sending Charging Data Response [Update] to
the V-SMF.
After the user plane resources are established over non-3GPP access in VPLMN,
and traffic goes through between VPLMN and HPLMN over non-3GPP access:
Ych-a. The H-SMF sends Charging Data Request [Update] to H-CHF. This step may
occur in case \"start of service data flow \" chargeable event over non-3GPP,
when required by \"immediate reporting\" category.
Ych-b. The H-CHF updates CDR for this MA PDU session.
Ych-c. The H-CHF acknowledges by sending Charging Data Response [Update] to
the V-SMF.
##### 5.2.2.15.6 EPS interworking
###### 5.2.2.15.6.1 5GS to EPS handover using N26 interface
The charging procedure for MA PDU Session 5GS to EPS handover using N26
interface scenario is based on figure 5.2.2.11.2.1 description with the
differences identified in clause 4.22.6.2.1 TS 23.502 [202]:
0ch. A charging session between the PGW-C+SMF and CHF exists for the MA PDU
Session with multiple QoS Flows over 3GPP access and non-3GPP access.
16ch-a. MA PDU session moved to EPS: All counts affected by the MA PDU session
move to EPS are closed and a Charging Data Request [Update] is sent to CHF, if
required by \"RAT type change\" trigger. New counts and time stamps for all
active service data flows are started in the PGW-C+SMF.
> MA PDU Session Release procedure over non-3GPP access triggered by
> PGW-C+SMF: All counts affected by the release of non-3GPP access are closed
> by \"Termination of service data flow\" trigger.
###### 5.2.2.15.6.2 5GS to EPS mobility without N26 interface
The charging procedure for MA PDU Session 5GS to EPS mobility without using
N26 interface scenario is based on figure 5.2.2.11.6.1 description with the
differences identified in clause 4.22.6.2.5 TS 23.502 [202]:
0\. UE is registered in 5GS and MA PDU Session is over both 3GPP and non-3GPP
accesses.
10\. E-UTRAN Initial attach procedure:
10ch-a. MA PDU Session is moved to EPS: All counts affected by the MA PDU
session move to EPS are closed and a Charging Data Request [Update] is sent to
CHF, if required by \"Handover start\" trigger. New counts and time stamps for
all active service data flows are started in the PGW-C+SMF
10ch-b. The CHF updates CDR for this PDU session.
10ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the
PGW-C+SMF.
> The PGW-C + SMF triggers the MA PDU Session Release procedure over non-3GPP
> access: All counts affected by the release of non-3GPP access are closed by
> \"Termination of service data flow\" trigger.
>
> 14\. The PGW-C+SMF initiates release of the 5GS MA PDU Session(s)
> transferred to EPS.
##### 5.2.2.15.7 Hybrid Access with Multi-Access PDU Session connectivity over
NG-RAN and W-5GAN
The following flow describes the charging procedure for MA PDU Session
establishment over NG-RAN and W-5GAN requested by 5G-RG, based on figure
5.2.2.15.2.1 description with the following differences identified in clause
4.12.2 TS 23.316 [203]:
\- The UE is replaced by 5G-RG.
\- Non-3GPP access(es) is specifically referred to wireline access.
When PDU Session Establishment Request message is sent over the 3GPP access
(i.e. NG-RAN), or sent over the non-3GPP access (i.e. W-5GAN):
9ch-a. The SMF sends Charging Data Request [initial] to CHF for authorization
for the 5G-RG to start the MA PDU session.
9ch-b. The CHF opens CDR for this MA PDU session.
9ch-c. The CHF acknowledges by sending Charging Data Response [Initial] to the
SMF.
##### 5.2.2.15.8 Hybrid Access with multi-access connectivity over E-UTRAN/EPC
and W-5GAN
The following flow describes the charging procedure for MA PDU Session
establishment over E-UTRAN/EPC and W-5GAN requested by 5G-RG using EPC
interworking procedures, based on clause 4.12.3 TS 23.316 [203]:
Figure 5.2.2.15.8.1: MA PDU session establishment requested by 5G-RG via EPC
\- The 5G-RG is registered in EPC.
1\. 5G-RG initiates PDN Connection establishment via E-UTRAN, indicating the
PDN Connection is requested to be associated with a MA PDU Session and its
\"ATSSS-LL Capability\".
2\. Create session request in EPC to the selected PGW-C+SMF with the
indication the PDN Connection is requested to be associated with a MA PDU
Session.
2ch-a. The PGW-C+ SMF sends Charging Data Request [initial] indicating \"MA
PDU session requested\" to CHF for authorization for the 5G-RG to use the PDN
connection for a MA PDU session.
2ch-b. The CHF opens CDR for this PDN connection.
2ch-c. The CHF acknowledges by sending Charging Data Response [Initial] to the
PGW-C+ SMF.
3\. Create session response indicating the request for using the PDN
Connection for MA-PDU Session is accepted.
4-5. User Plane resources establishment for E-UTRAN
5ch-a. This step may occur in case \"start of service data flow\" over 3GPP
needs quota from CHF for appropriate rating group, the PGW-C+ SMF sends
Charging Data Request [Update] for requesting quota.
5ch-b. The CHF updates CDR for this PDN connection.
5ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the
PGW-C+ SMF.
6\. PDN connection establishment continuation
7\. 5G-RG sends a PDU Session Establishment Request indicating \"MA PDU
Request\" to establish W-5GAN user-plane resources.
When the user plane is established with W-5GAN (X corresponds to step 16a-b of
figure 5.2.2.2.2.1 for the W-5GAN):
Xch-a. The PGW-C+ SMF sends Charging Data Request [Update]. This step may
occur if required by \"addition of access\" trigger.
Xch-b. The CHF updates CDR for this MA PDU session.
Xch-c. The CHF acknowledges by sending Charging Data Response [Update] to the
SMF.
After the user plane is established:
Ych-a. The PGW-C+ SMF sends Charging Data Request [Update]. This step may
occur in case \"start of service data flow\" chargeable event needs quota from
CHF for appropriate rating group, or if required by \"immediate reporting\"
category.
Ych-b. The CHF updates CDR for this MA PDU session.
Ych-c. The CHF acknowledges by sending Charging Data Response [Update] to the
PGW-C+ SMF.
In the scenario where the MA PDU Session is requested via 5GC/W-5GAN, the
5G-RG is registered to EPC and user-plane resources are added on 3GPP access
over EPC, the following applies:
MA PDU session establishment via 5GC/W-5GAN per figure 5.2.2.15.2.1 until step
18 with PDU Session Establishment Request message for the MA PDU session sent
over W-5GAN (i.e. non-3GPP access).
After step 18 of figure 5.2.2.2.2.1, the 5G-RG sends a PDN Connection
Establishment Request via E-UTRAN, indicating \"handover\" and \"MA PDU
Request\".
When the user plane is established with E-UTRAN over EPC:
Xch-a. The PGW-C+ SMF sends Charging Data Request [Update]. This step may
occur if required by \"addition of access\" trigger.
After the user plane is established with E-UTRAN over EPC:
Ych-a. This step may occur in case \"start of service data flow\" chargeable
event needs quota from CHF for appropriate rating group, or if required by
\"immediate reporting\" category.
#### 5.2.2.16 PDU session charging -- wireline access
##### 5.2.2.16.1 General
After registration management procedures to 5GC via wireline access network, a
PDU session can be established via this wireline access, as specified in TS
23.316 [203] for different scenarios:
\- 5G-RG connected via NR-RAN and W-5GAN;
\- FN-RG connected via W-5GAN.
##### 5.2.2.16.2 5G-RG Requested PDU Session Establishment via W-5GAN
The following figure 5.2.2.16.2.1 describes charging when 5G-RG requests a PDU
session establishment via W-AGF.
1) The 5G-RG connects to a W-5GAN and the W-AGF sends an EAP-Request/5G-Start
packet over the W-CP connection as described in clause 7.3.1.1 in TS 23.316
[203].
2) The steps are specified as step 2-7 in clause 4.3.2.1 of TS 23.502 [202].
3ch-a. The SMF creates a Charging Identifier for the PDU session and sends
Charging Data Request [Initial] to CHF for authorization for the subscriber
information via wireline network to start the PDU session which is triggered
by start of PDU session charging event.
3ch-b. The CHF opens CDR for this PDU session.
3ch-c. The CHF acknowledges by sending Charging Data Response [Initial] to the
SMF.
4) The steps of PDU session establishment are specified in clause 7.3.1.1 of
TS 23.316 [203].
##### 5.2.2.16.3 FN-RG related PDU Session Establishment via W-5GAN
The following figure 5.2.2.16.3.1 describes charging when FN-RG requests a PDU
session establishment via W-AGF. As described in clause 7.3.4 in TS 23.316
[203], after the registration procedure is completed, the W-AGF may establish
PDU session(s) on behalf of the FN-RG.
Figure 5.2.2.16.3.1: charging when FN-RG requests a PDU session establishment
via W-AGF
1) After the registration procedure is completed, the W-AGF may establish PDU
session(s) on behalf of the FN-RG as described in clause 7.3.4 in TS 23.316
[203].
2) The steps are specified as step 2-9 in clause 4.3.2.2.1 of TS 23.502 [202].
3ch-a. The SMF creates a Charging Identifier for the PDU session and sends
Charging Data Request [Initial] to CHF for authorization for the subscriber
identified under wireline network to start the PDU session which is triggered
by start of PDU session charging event.
3ch-b. The CHF opens CDR for this PDU session.
3ch-c. The CHF acknowledges by sending Charging Data Response [Initial] to the
SMF.
4) The steps of PDU session establishment are specified in clause 7.3.4 of TS
23.316 [203].
##### 5.2.2.16.4 Handover procedure
##### 5.2.2.16.4.1 5G RG handover of a PDU Session procedure from W-5GAN
access to 3GPP access
Following figure 5.2.2.16.4.1.1 describes charging when 5G-RG handover of a
PDU Session procedure from W-5GAN access to 3GPP access.
Figure 5.2.2.16.4.1.1: Handover of PDU session from W-5GAN access to 3GPP
access
As described in clause 7.6.2.1 in TS 23.316 [203], the handover of a PDU
session from W-5GAN access to 3GPP access is as following.
1-2) The steps are described in clause 7.6.2.1 in TS 23.316 [203], 5G-RG
peforms registeration via 3GPP access and PDU session establishmeng procedure.
> 2ch-a-c. SMF may interact with CHF with Charging Data Request [Update].This
> step occurs in case \"RAT type change\" triggers, if required by \"immediate
> reporting\" category. The RAT type change trigger, if enabled, applied
> during the PDU session establishment via the 3GPP access network before SMF
> executes the release of W-5GAN access resource. Which RAT type used is
> described in clause 5.3.2.3 of TS 23.501 [200].
NOTE: Void
> 3\. The step that the SMF executes the release of resources in W-5GAN access
> is same as step 3 as described in clause 7.6.3.1 of TS 23.316 [203].
##### 5.2.2.16.4.2 5G RG handover of a PDU Session procedure from 3GPP to
W-5GAN access
Following figure 5.2.2.16.4.2.1 describes charging when 5G-RG handover of a
PDU Session procedure from 3GPP to W-5GAN access.
Figure 5.2.2.16.4.2.1: Handover of a PDU Session procedure from 3GPP to W-5GAN
access
As described in clause 7.6.3.2 in TS 23.316 [203], the handover of a PDU
session from 3GPP access to W-5GAN access is as following.
1) The 5G-RG initiates Reigistration procedure via W-5GAN as defined in clause
7.2.1.1 of TS 23.316 [203].
2) The 5G-RG performs PDU Session Establishment procedure via W-5GAN access as
described in 7.6.3.2 of TS 23.316 [203].
> 2ch-a-c. SMF may interact with CHF with Charging Data Request [Update]. This
> step occurs in case \"RAT type change\" triggers, if required by \"immediate
> reporting\" category The RAT type change trigger, if enabled, applied during
> the PDU session establishment via the W-5GAN before SMF performs the release
> of 3GPP access resource. Which RAT type used is described in clause 5.3.2.3
> of TS 23.501 [200].
NOTE: Void
3) The step that the SMF executes the release of resource via 3GPP access is
same as step 3 as described in clause 7.6.3.2 of TS 23.316 [203].
#### 5.2.2.17 Ultra Reliable Low Latency Communication (URLLC)
##### 5.2.2.17.1 General
Support highly reliable URLLC services is specified in TS 23.501 [200] clause
5.33 procedures and TS 23.502 [201] message flows for different scenarios:
\- Dual Connectivity based end to end Redundant User Plane Paths.
\- Support of redundant transmission on N3/N9 interfaces.
\- Support for redundant transmission at transport layer.
##### 5.2.2.17.2 Void
##### 5.2.2.17.3 Redundant transmission for high reliability communication
###### 5.2.2.17.3.1 PDU Session establishment
\- Dual Connectivity based end to end Redundant User Plane Paths
> The charging message flow of PDU session establishment for supporting Dual
> Connectivity based end to end Redundant User Plane Paths, is based on Figure
> 5.2.2.2.2-1 description with the differences identified in clause
> 4.3.2.2.1.1 TS 23.502 [202].
>
> In the Step 9ch-a, if the PDU Session requires redundancy, SMF sends the
> Charging Data Request [Initial] with the redundant transmission information.
>
> If the PDU session establishment without redundancy handling based on local
> policy, SMF sends the Charging Data Request [Initial] as descriped in Figure
> 5.2.2.2.2-1. CHF considers the PDU session is used for the non-redundant
> transmission.
\- Redundant transmission on N3/N9 interfaces
> The charging message flow of PDU session establishment for supporting
> redundant transmission on N3/N9 interfaces, is based on Figure 5.2.2.2.2-1
> description with the differences identified in clause 4.3.2.2.1.1 TS 23.502
> [202].
>
> As described in clause 5.33.1.2 of TS 23.501 [201], SMF decides to perform
> redundant transmission for one or more QoS Flows at the step 10.
>
> In the Step 16ch-aï¼Œthe SMF sends the Charging Data Request [Update] with the
> redundant transmission information.
\- Redundant transmission at transport layer
> The charging message flow of PDU session establishment for supporting
> redundant transmission at transport layer, is based on Figure 5.2.2.2.2-1
> description with the differences identified in clause 4.3.2.2.1.1 TS 23.502
> [202].
>
> As per the clause 5.33.2.3 TS 23.501[201], the knowledge of supporting
> redundant transmission at transport layer can be configured in the SMF, or
> be configured in UPF and then obtained by the SMF via N4 capability
> negotiation during N4 Association setup procedure.
>
> In the Step 16ch-a, SMF sends the Charging Data Request [Update] with the
> redundant transmission information.
###### 5.2.2.17.3.2 PDU Session Modification
For redundant transmission on N3/N9 interfaces, the charging message flow of
PDU session modification is based on Figure 5.2.2.2.3-1 description with the
differences identified in clause 4.3.3.2 TS 23.502 [202].
2ch-a. If redundant transmission has not been activated to the PDU session and
the SMF performs redundant transmission for the QoS Flow in step 2a, the SMF
sends Charging Data Request [Update] to the CHF for the PDU session, with the
trigger \"Redundant transmission change\".
If redundant transmission has been activated on the PDU Session, and the SMF
stops redundant transmission in step 2a, the SMF sends Charging Data Request
[Update] to the CHF for the PDU session, with the trigger \"Redundant
transmission change\".
2ch-b. The CHF update the CDR for the URLLC.
2ch-c. The CHF acknowledges by sending Charging Data Response [Update] to the
SMF.
###### 5.2.2.17.3.3 PDU Session Release
For redundant transmission on N3/N9 interfaces, the charging message flow of
PDU session release is based on Figure 5.2.2.2.4-1 description with the
differences identified in clause 4.3.4.2 TS 23.502 [202].
2ch-a. The SMF sends Charging Data Request [Termination] to the CHF for
terminating the charging associated with PDU session in each UPF, with the
trigger \"End of PDU session\".
2ch-b. The CHF closes the CDR for the URLLC.
2ch-c. The CHF acknowledges by sending Charging Data Response [Termination] to
the SMF.
#### 5.2.2.18 PDU session charging for roaming in Local breakout scenario
##### 5.2.2.18.1 General
The clause below describes PDU session charging in roaming with local breakout
scenarios.
##### 5.2.2.18.2 PDU session establishment
The following figure 5.2.2.18.2-1 describes a PDU session establishment
charging, based on figure 4.3.2.2.1-1 UE-requested PDU Session Establishment
for non-roaming and roaming with local breakout TS 23.502 [202] description:
Figure 5.2.2.18.2-1: PDU session establishment
9ch-a. The UE is identified as a roamer (e.g., PLMN ID of the received SUPI is
different from VPLMN PLMN ID), the V-CHF and optionally H-CHF are selected
accordingly.
9ch-b1. The Charging Data Request [Initial] is sent to V-CHF, for the
subscriber triggered by start of PDU session charging event.
9ch-c1. The V-CHF opens a CDR.
9ch-d1. The V-CHF acknowledges by sending Charging Data Response [Initial] to
the V-SMF and optionally supplies a \"Roaming charging profile\" to the V-SMF
(which overrides the default one).
9ch-b2. If a H-CHF was selected a Charging Data Request [Initial] is sent to
H-CHF, with Charging Identifier, and with or without quota management and
optionally including the \"Roaming charging profile\".
9ch-c2. The H-CHF opens a CDR.
9ch-d2. The H-CHF acknowledges by sending Charging Data Response [Initial] to
the V-SMF and optionally supplies a \"Roaming charging profile\" to the V-SMF.
10ch-a1. The Charging Data Request [Update] is sent to V-CHF with QBC and/or
FBC information, when enabled triggers are met, optionally including the new
\"Roaming charging profile\".
10ch-b1. The V-CHF update the CDR.
10ch-c1. The V-CHF acknowledges by sending Charging Data Response [Update] to
the V-SMF.
10ch-a2. If a H-CHF was selected a Charging Data Request [Update] is sent to
H-CHF with QBC and/or FBC information, when enabled triggers are met, for FBC
it may include a request for quota.
10ch-b2. The H-CHF update the CDR.
10ch-c2. The H-CHF acknowledges by sending Charging Data Response [Update] to
the V-SMF.
##### 5.2.2.18.3 PDU Session Modification
The following figure 5.2.2.18.3-1 describes the PDU session modification
charging, based on figure 4.3.3.2-1 UE or network requested PDU Session
Modification (for non-roaming and roaming with local breakout) TS 23.502 [202]
description:
Figure 5.2.2.18.3-1: PDU Session Modification
2ch-a1. The Charging Data Request [Update] is sent to V-CHF for reporting the
QBC and/or FBC information when enabled triggers are met.
2ch-b1. The V-CHF update the CDR.
2ch-c1. The V-CHF acknowledges by sending Charging Data Response [Update] to
the V-SMF.
2ch-a2. If a H-CHF was selected a Charging Data Request [Update] is sent to
H-CHF with QBC and/or FBC information, when the enabled triggers are met, and
for FBC it may include a request for quota.
2ch-b2. The H-CHF update a CDR.
2ch-c2. The H-CHF acknowledges by sending Charging Data Response [Update] to
the V-SMF.
##### 5.2.2.18.4 PDU Session Release
The following figure 5.2.2.18.4-1 describes the PDU session release charging,
based on figure 4.3.4.2-1 UE or network requested PDU Session Release for non-
roaming and roaming with local breakout TS 23.502 [202] description:
Figure 5.2.2.18.4-1: PDU Session Release
2ch-a1. The Charging Data Request [Termination] is sent to V-CHF.
2ch-b1. The V-CHF close the CDR.
2ch-c1. The V-CHF acknowledges by sending Charging Data Response [Termination]
to the V-SMF.
2ch-a2. If a H-CHF was selected a Charging Data Request [Termination] is sent
to H-CHF.
2ch-b2. The H-CHF close the CDR.
2ch-c2. The H-CHF acknowledges by sending Charging Data Response [Termination]
to the V-SMF.
#### 5.2.2.19 PDU session charging for additional actor (MVNO)
##### 5.2.2.19.1 General
The clause below describes PDU session charging for additional actor (MVNO)
which is only applicable for non-roaming case.
##### 5.2.2.19.2 Additional actor (MVNO)
The clause contains the description for the scenario of MVNO as additional
actor with A-CHF.
For non-roaming scenarios, the message flows for the PDU session
establishment, PDU session Modification and PDU session Release for LBO
charging specified in clause 5.2.2.18 could be applicable depending on the
deployment scenarios for additional actor (MVNO), with the following
differences:
\- V-SMF in V-PLMN is replaced by the SMF in MNO;
\- V-CHF in V-PLMN is replaced by the CHF in MNO;
\- H-CHF in H-PLMN is replaced by the A-CHF in MVNO.
### 5.2.3 CDR generation
#### 5.2.3.1 Introduction
The CHF CDRs for PDU session charging and roaming QBC are generated by the CHF
to collect charging information that they subsequently transfer to the
Charging Gateway Function (CGF).
The following clauses describe in detail the conditions for opening, adding
information to, and closing the CHF CDR.
#### 5.2.3.2 Triggers for CHF CDR
##### 5.2.3.2.1 General
A PDU session charging CHF CDR is used to collect charging information related
to the PDU session data information for a UE in Flow Based Charging. Multiple
service data flow containers per PDU session can be added in the CHF CDR by
the CHF, upon receiving a Charging Data Request including new counts as
defined in subclause 5.2.1.1.
A CHF CDR shall be opened when the CHF receives Charging Data
Request[Initial].
As an alternative to the default CHF behaviour, the \"Individual Partial
record\" mechanism can be used based on Operator\'s policy configured in the
CHF. In this case a new CDR shall be opened for each Charging Data
Request[Initial, Update, Termination], charging information shall be added and
the CDR shall then be closed. The Sequence Number will be incremented for each
Charging Data Request[Initial, Update, Termination] received by the CHF.
##### 5.2.3.2.2 Triggers for CHF CDR charging information addition
When the CHF receives Charging Data Request[Update], with the change
conditions identified in Table 5.2.3.2.2.1 the charging information shall be
added in the PDU session charging CHF CDR, and the CDR shall remain open, as
the default supported mechanism.
Table 5.2.3.2.2.1: Triggers for CHF CDR charging information addition
* * *
Trigger Conditions Applicable for converged charging Applicable for offline
only charging Change of Charging conditions  
QoS change Yes Yes User Location change Yes Yes Serving Node change Yes Yes
Change of UE presence in Presence Reporting Area(s) Yes Yes Change of 3GPP PS
Data off Status Yes Yes Handover cancel Yes Yes Handover start Yes Yes Limit
per Rating Group  
Expiry of data time limit per RG Yes Yes Expiry of data volume limit per RG
Yes Yes Expiry of data event limit per RG Yes Yes Quota management triggers  
Time threshold reached Yes No Volume threshold reached Yes No Unit threshold
reached Yes No Time quota exhausted Yes No Volume quota exhausted Yes No Unit
quota exhausted Yes No Expiry of quota validity time Yes No Re-authorization
request by CHF Yes No
* * *
In case the \"Individual Partial record\" mechanism is enabled, the Table
5.2.3.2.2.1 is not applicable. The charging information consists of a set of
containers, which are added as \"List of Multiple Unit Usage\" parameter of
the CHF CDR. Each container identifies the configured counts (volume separated
for uplink and downlink, elapsed time or number of events) per rating group or
combination of the rating group and service id, associated with the changed
charging conditions.
##### 5.2.3.2.3 Triggers for CHF CDR partial record closure
When the CHF receives Charging Data Request [Update], with the change
conditions identified in Table 5.2.3.2.3.1, the charging information shall be
added in the PDU session charging CHF CDR, before the CDR is closed and a
subsequent CHF CDR shall be opened with an incremented Sequence Number, as the
default supported mechanism.
.
Table 5.2.3.2.3.1: Triggers for CHF CDR partial record closure
* * *
Trigger Conditions Change of Charging conditions UE time zone change PLMN
change RAT type change Session-AMBR change Removal of UPF Insertion_of_ISMF
Change_of_ISMF Removal_of_ISMF Handover complete Management intervention
Addition of access Removal of access Limit per PDU session Expiry of data time
limit per PDU session Expiry of data volume limit per PDU session Expiry of
data event limit per PDU session Expiry of limit of number of charging
condition changes
* * *
In case the \"Individual Partial record\" mechanism is enabled, the Table
5.2.3.2.3.1 is not applicable.
##### 5.2.3.2.4 Triggers for CHF CDR closure
When the CHF receives Charging Data Request[Termination], the charging
information shall be added in the PDU session charging CHF CDR and the CDR
shall be closed.
#### 5.2.3.3 Triggers for CHF CDR for roaming QBC
##### 5.2.3.3.1 General
A Roaming QBC CHF CDR is used to collect charging information related to
Roaming QBC in V-SMF, and the PDU session charging CHF CDR is used to collect
charging information related to Roaming QBC in H-SMF. QoS flow containers per
PDU session can be added in the CHF CDRs by the CHF, upon receiving a Charging
Data Request.
The charging information received from the CHF consists of a set of
containers, which are added as \"List Multiple QFI container\" parameter of
the CHF CDRs. Each container identifies the configured counts (volume
separated for uplink and downlink, elapsed time) per QoS Flow, associated with
the changed charging conditions.
A roaming CHF CDR shall be opened when the CHF receives Charging Data
Request[Initial] indicating \"in-bound roamer\".
##### 5.2.3.3.2 Triggers for CHF CDR charging information addition for roaming
QBC
When the CHF receives Charging Data Request[Update], with the change
conditions identified in Table 5.2.3.3.2.1 the charging information shall be
added in the CHFCDR, and the CDR shall remain open, as the default supported
mechanism.
Table 5.2.3.3.2.1: Triggers for CHF CDR charging information addition for
roaming QBC
* * *
Trigger Conditions Change of Charging conditions QoS change User Location
change Serving Node change Change of 3GPP PS Data off Status Limit per QoS
Flow Expiry of data time limit per QoS Flow Expiry of data volume limit per
QoS Flow Others End of QoS Flow
* * *
In case the \"Individual partial record\" mechanism is enabled, this sub-
clause is not applicable.
##### 5.2.3.3.3 Triggers for CHF CDR partial record closure for roaming QBC
When the CHF receives Charging Data Request [Update] with the change
conditions identified in Table 5.2.3.3.3.1, the charging information shall be
added in the CHF CDR, before the CDR is closed and a subsequent CHF CDR shall
be opened with an incremented Sequence Number, as the default supported
mechanism.
Table 5.2.3.3.3.1: Triggers for CHF CDR partial record closure for roaming QBC
* * *
Trigger Conditions Change of Charging conditions UE time zone change PLMN
change RAT type change Session-AMBR change Removal of UPF Management
intervention Limit per PDU session Expiry of data time limit per PDU session
Expiry of data volume limit per PDU session Expiry of data event limit per PDU
session Expiry of limit of number of charging condition changes
* * *
In case the \"Individual partial record\" mechanism is enabled, the Table
5.2.3.3.3.1 is not relevant: instead, the charging information shall be added
in the CHF CDR, before the CDR is closed and a subsequent CHF CDR shall be
opened with an incremented Sequence Number for each Charging Data Request
[Update] received by the CHF.
##### 5.2.3.3.4 Triggers for roaming QBC CHF CDR closure
When the CHF receives Charging Data Request[Termination], the charging
information shall be added in the roaming QBC CHF CDR and the CDR shall be
closed.
### 5.2.4 Ga record transfer flows
In 5G, both fully qualified partial CDRs (FQPC) and reduced partial CDRs
(RPC), as specified in TS 32.240 [1] may be supported on the Ga interface. In
line with TS 32.240 [13], the support of FQPCs is mandatory, the support of
RPCs is optional. For further details on the Ga protocol application refer to
TS 32.295 [54].
### 5.2.5 Bd CDR file transfer
In 5G, both fully qualified partial CDRs (FQPC) and reduced partial CDRs
(RPC), as specified in TS 32.240 [1] may be supported on the Bd interface. In
line with TS 32.240 [13], the support of FQPCs is mandatory, the support of
RPCs is optional. For further details on the Bd protocol application refer to
TS 32.297 [52].
# 6\. Definition of charging information
## 6.1 Data description for 5G data connectivity charging
### 6.1.1 Message contents
#### 6.1.1.1 General
The Charging Data Request and Charging Data Response are specified in TS
32.290 [57] and include charging information. The Charging Data Request can be
of type [Initial, Update, Termination].
Table 6.1.1.1.1 describes the use of these messages for converged charging.
Table 6.1.1.1.1: Converged charging messages reference table
* * *
**Message** **Source** **Destination** Charging Data Request SMF CHF Charging
Data Response CHF SMF
* * *
The following clauses describe the different fields used in the Charging Data
messages and the category in the tables is used according to the charging data
configuration defined in clause 5.4 of TS 32.240 [1].
#### 6.1.1.2 Charging Data Request message
Table 6.1.1.2.1 illustrates the basic structure of a Charging Data Request
message from the SMF as used for 5G data connectivity converged charging.
Table 6.1.1.2.1: Charging Data Request message contents
+----------------+----------------+----------------+----------------+ | **Information |** Category for | **Category for | * | | Element** | converged | offline only | _Description_ _| | | charging_ _| charging_ * | | +----------------+----------------+----------------+----------------+ | Session | O~C~ | O~C~ | Described in | | Identifier | | | TS 32.290 | | | | | [57] | +----------------+----------------+----------------+----------------+ | Subscriber | O~M~ | M | Described in | | Identifier | | | TS 32.290 | | | | | [57] | | | | | | | | | | In case SUPI | | | | | is not present | | | | | (for emergency | | | | | service), the | | | | | User Equipment | | | | | Info in table | | | | | 6.2.1.2.1. | | | | | shall be | | | | | present for | | | | | identifying | | | | | the user. | +----------------+----------------+----------------+----------------+ | NF Consumer | M | M | Described in | | Identification | | | TS 32.290 | | | | | [57] | +----------------+----------------+----------------+----------------+ | > NF | M | O~C~ | Described in | | > | | | TS 32.290 | | Functionality | | | [57] | +----------------+----------------+----------------+----------------+ | > NF Name | O~C~ | O~C~ | Described in | | | | | TS 32.290 | | | | | [57] | +----------------+----------------+----------------+----------------+ | > NF Address | O~C~ | O~C~ | Described in | | | | | TS 32.290 | | | | | [57] | +----------------+----------------+----------------+----------------+ | > NF PLMN ID | O~C~ | O~C~ | Described in | | | | | TS 32.290 | | | | | [57] | +----------------+----------------+----------------+----------------+ | Invocation | M | M | Described in | | Timestamp | | | TS 32.290 | | | | | [57] | +----------------+----------------+----------------+----------------+ | Invocation | M | M | Described in | | Sequence | | | TS 32.290 | | Number | | | [57] | +----------------+----------------+----------------+----------------+ | Retransmission | O~C~ | O~C~ | Described in | | Indicator | | | TS 32.290 | | | | | [57] | +----------------+----------------+----------------+----------------+ | Notify URI | O~C~ | O~C~ | Described in | | | | | TS 32.290 | | | | | [57] | +----------------+----------------+----------------+----------------+ | Service | O~C~ | O~C~ | Described in | | Specification | | | TS 32.290 | | Information | | | [57] | +----------------+----------------+----------------+----------------+ | Supported | O~C~ | - | This field | | Features | | | indicates the | | | | | features | | | | | supported by | | | | | the NF | | | | | consumer. | +----------------+----------------+----------------+----------------+ | Triggers | O~C~ | O~C~ | This field is | | | | | described in | | | | | TS 32.290 | | | | | [57] and | | | | | holds the 5G | | | | | data | | | | | connectivity | | | | | specific | | | | | triggers | | | | | described in | | | | | clause 5.2.1. | +----------------+----------------+----------------+----------------+ | Multiple Unit | O~C~ | O~C~ | Described in | | Usage | | | TS 32.290 | | | | | [57] | | | | | | | | | | This field is | | | | | not applicable | | | | | to QBC. | +----------------+----------------+----------------+----------------+ | > Rating Group | M | M | Described in | | | | | TS 32.290 | | | | | [57] | +----------------+----------------+----------------+----------------+ | > Requested | O~C~ | - | Described in | | > Unit | | | TS 32.290 | | | | | [57] | +----------------+----------------+----------------+----------------+ | > Used Unit | O~C~ | O~C~ | Described in | | > Container | | | TS 32.290 | | | | | [57] | +----------------+----------------+----------------+----------------+ | > Triggers | O~C~ | O~C~ | This field is | | | | | described in | | | | | TS 32.290 | | | | | [57] and | | | | | holds the 5G | | | | | data | | | | | connectivity | | | | | specific | | | | | triggers | | | | | described in | | | | | clause 5.2.1. | +----------------+----------------+----------------+----------------+ | > PDU | O~C~ | O~C~ | This field | | > Container | | | holds the 5G | | > Information | | | data | | | | | connectivity | | | | | PDU session | | | | | container | | | | | specific | | | | | information | | | | | described in | | | | | clause 6.2. | +----------------+----------------+----------------+----------------+ | > UPF ID | O~C~ | O~C~ | This field | | | | | holds the UPF | | | | | identifier | | | | | used to | | | | | identify the | | | | | UPF. | | | | | | | | | | These fields | | | | | shall only be | | | | | included when | | | | | either quota | | | | | is requested | | | | | per UPF, or | | | | | used units are | | | | | reported per | | | | | UPF | +----------------+----------------+----------------+----------------+ | > multi-homed | O~C~ | O~C~ | This field | | > PDU address | | | holds the IPv6 | | | | | prefix used by | | | | | UPF. It may | | | | | only be used | | | | | for IPv6 | | | | | multi-homed | | | | | PDU sessions | | | | | and then only | | | | | for reporting | | | | | used units. | +----------------+----------------+----------------+----------------+ | PDU Session | O~M~ | O~M~ | This field | | Charging | | | holds the 5G | | Information | | | data | | | | | connectivity | | | | | specific | | | | | information | | | | | described in | | | | | clause 6.2. | | | | | | | | | | This field is | | | | | applicable to | | | | | FBC and QBC. | +----------------+----------------+----------------+----------------+ | Roaming QBC | O~M~ | O~M~ | This field | | information | | | holds the | | | | | roaming QBC | | | | | specific | | | | | information | | | | | defined in | | | | | clause 6.2.1.4 | | | | | | | | | | This field is | | | | | only | | | | | applicable to | | | | | QBC. | +----------------+----------------+----------------+----------------+
#### 6.1.1.3 Charging data response message
Table 6.1.1.3.1 illustrates the basic structure of a Charging Data Response
message from the CHF as used for 5G data connectivity converged charging.
Table 6.1.1.3.1: Charging Data Response message contents
+----------------+----------------+----------------+----------------+ | **Information |** Category for | **Category for | * | | Element** | converged | offline only | _Description_ _| | | charging_ _| charging_ * | | +----------------+----------------+----------------+----------------+ | Session | O~C~ | O~C~ | Described in | | Identifier | | | TS 32.290 | | | | | [57] | +----------------+----------------+----------------+----------------+ | Invocation | M | M | Described in | | Timestamp | | | TS 32.290 | | | | | [57] | +----------------+----------------+----------------+----------------+ | Invocation | O~C~ | M | Described in | | Result | | | TS 32.290 | | | | | [57] | +----------------+----------------+----------------+----------------+ | > Invoation | O~C~ | M | Described in | | > Result Code | | | TS 32.290 | | | | | [57] | +----------------+----------------+----------------+----------------+ | > Failed | O~C~ | O~C~ | Described in | | > Parameter | | | TS 32.290 | | | | | [57] | +----------------+----------------+----------------+----------------+ | > Failure | O~C~ | O~C~ | Described in | | > Handling | | | TS 32.290 | | | | | [57] | +----------------+----------------+----------------+----------------+ | Invocation | M | M | Described in | | Sequence | | | TS 32.290 | | Number | | | [57] | +----------------+----------------+----------------+----------------+ | Session | O~C~ | O~C~ | Described in | | Failover | | | TS 32.290 | | | | | [57] | +----------------+----------------+----------------+----------------+ | Supported | O~C~ | - | This field | | Features | | | indicates the | | | | | features | | | | | supported by | | | | | the NF | | | | | consumer. | +----------------+----------------+----------------+----------------+ | Multiple Unit | O~C~ | O~C~ | Described in | | Information | | | TS 32.290 | | | | | [57] | | | | | | | | | | This field is | | | | | not applicable | | | | | to QBC. | +----------------+----------------+----------------+----------------+ | Result Code | O~C~ | O~C~ | Described in | | | | | TS 32.290 | | | | | [57] | +----------------+----------------+----------------+----------------+ | Rating Group | M | M | Described in | | | | | TS 32.290 | | | | | [57] | +----------------+----------------+----------------+----------------+ | UPF ID | O~C~ | O~C~ | This field | | | | | holds the UPF | | | | | identifier | | | | | used for quota | | | | | granted per | | | | | UPF by CHF | +----------------+----------------+----------------+----------------+ | Granted Unit | O~C~ | - | Described in | | | | | TS 32.290 | | | | | [57] | +----------------+----------------+----------------+----------------+ | Validity Time | O~C~ | - | Described in | | | | | TS 32.290 | | | | | [57] | +----------------+----------------+----------------+----------------+ | Final Unit | O~C~ | - | Described in | | Indication | | | TS 32.290 | | | | | [57] | +----------------+----------------+----------------+----------------+ | Time Quota | OC | - | Described in | | Threshold | | | TS 32.290 | | | | | [57] | +----------------+----------------+----------------+----------------+ | Volume Quota | OC | - | Described in | | Threshold | | | TS 32.290 | | | | | [57] | +----------------+----------------+----------------+----------------+ | Unit Quota | OC | - | Described in | | Threshold | | | TS 32.290 | | | | | [57] | +----------------+----------------+----------------+----------------+ | Quota Holding | O~C~ | - | Described in | | Time | | | TS 32.290 | | | | | [57] | +----------------+----------------+----------------+----------------+ | Triggers | O~C~ | O~C~ | This field is | | | | | described in | | | | | TS 32.290 | | | | | [57] and | | | | | holds the 5G | | | | | data | | | | | connectivity | | | | | specific | | | | | triggers | | | | | described in | | | | | clause 5.2.1. | +----------------+----------------+----------------+----------------+ | Triggers | O~C~ | O~C~ | This field is | | | | | described in | | | | | TS 32.290 | | | | | [57] and | | | | | holds the 5G | | | | | data | | | | | connectivity | | | | | specific | | | | | triggers | | | | | described in | | | | | clause 5.2.1. | +----------------+----------------+----------------+----------------+ | PDU Session | O~M~ | O~M~ | This field | | Charging | | | holds the 5G | | Information | | | data | | | | | connectivity | | | | | specific | | | | | information | | | | | described in | | | | | clause 6.2. | +----------------+----------------+----------------+----------------+ | Roaming QBC | O~M~ | O~M~ | This field | | Information | | | holds the | | | | | roaming QBC | | | | | specific | | | | | information | | | | | defined in | | | | | clause 6.2.1.4 | | | | | | | | | | This field is | | | | | not applicable | | | | | to FBC. | +----------------+----------------+----------------+----------------+
### 6.1.2 Ga message contents
### 6.1.3 CDR description on the B~d~ interface
#### 6.1.3.1 General
This clause describes the CDR content and format generated for 5G data
connectivity - PDU session charging.
The following tables provide a brief description of each CDR parameter. The
category in the tables is used according to the charging data configuration
defined in clause 5.4 of TS 32.240 [1]. Full definitions of the CDR
parameters, sorted by the name in alphabetical order, are provided in TS
32.298 [51].
#### 6.1.3.2 PDU session charging CHF CDR data
If enabled, CHF CDRs for PDU session charging shall be produced for each PDU
session. In roaming Home routed scenario, the PDU session charging CHF CDR
shall cover both Flow based Charging and Qos flow Based Charging (QBC) from
H-SMF.
The fields of PDU session charging CHF CDR are specified in table 6.1.3.2.1.
Table 6.1.3.2.1: PDU session charging CHF record data
+----------------------------+----------+----------------------------+ | Field | Category | Description | +----------------------------+----------+----------------------------+ | Record Type | M | CHF record. | +----------------------------+----------+----------------------------+ | Recording Network Function | O~M~ | This field holds the name | | ID | | of the recording entity, | | | | i.e. the CHF id. | +----------------------------+----------+----------------------------+ | Subscriber Identifier | O~M~ | This field holds the | | | | Subscription Permanent | | | | Identifier (SUPI) of the | | | | served party. This fields | | | | should be present except | | | | for emergency session. The | | | | detail of SUPI is | | | | specified in clause 5.9.2 | | | | of TS 23.501 [200] | +----------------------------+----------+----------------------------+ | NF Consumer Information | M | This field holds the | | | | information of the SMF | | | | that used the charging | | | | service. | +----------------------------+----------+----------------------------+ | > NF Functionality | M | This field contains the | | | | function of the node (i.e. | | | | SMF) | +----------------------------+----------+----------------------------+ | > NF Name | O~C~ | This field holds the name | | | | of the SMF used. | +----------------------------+----------+----------------------------+ | > NF Address | O~C~ | This fields holds the IP | | | | Address of the SMF used. | +----------------------------+----------+----------------------------+ | > NF PLMN ID | O~C~ | This field holds the PLMN | | | | identifier (MCC MNC) of | | | | the SMF. | +----------------------------+----------+----------------------------+ | List of Multiple Unit | O~M~ | This field holds a list of | | Usage | | changes in charging | | | | conditions for all service | | | | data flows within this PDU | | | | session.This list is | | | | categorized per rating | | | | group or per combination | | | | of rating group and | | | | service id or per | | | | combination of rating | | | | group, sponsor identity | | | | and application service | | | | provider identity. In | | | | addition, usage is | | | | differentiated between | | | | with and without quota | | | | management. Each change is | | | | time stamped. Charging | | | | conditions are used to | | | | categorize traffic | | | | volumes, elapsed time and | | | | number of events, such as | | | | per tariff period. | +----------------------------+----------+----------------------------+ | > Rating Group | O~M~ | This filed holds the | | | | rating group. | +----------------------------+----------+----------------------------+ | > Used Unit Container | O~C~ | This field holds the used | | | | units and information | | | | connected to the reported | | | | units. | +----------------------------+----------+----------------------------+ | > Service Identifier | O~C~ | This field holds the | | | | Service Identifier. | +----------------------------+----------+----------------------------+ | > Quota management | O~M~ | This field holds an | | > Indicator | | indicator on whether the | | | | used units are with or | | | | without quota management. | +----------------------------+----------+----------------------------+ | > Triggers | O~C~ | This field holds the | | | | reason for closing the | | | | used unit container. | +----------------------------+----------+----------------------------+ | > Trigger Timestamp | O~C~ | This field holds the | | | | timestamp of the trigger. | +----------------------------+----------+----------------------------+ | > Time | O~C~ | This field holds the | | | | amount of used time. | +----------------------------+----------+----------------------------+ | > Total Volume | O~C~ | This field holds the | | | | amount of used volume in | | | | both uplink and downlink | | | | directions. | +----------------------------+----------+----------------------------+ | > Uplink Volume | O~C~ | This field holds the | | | | amount of used volume in | | | | uplink direction. | +----------------------------+----------+----------------------------+ | > Downlink Volume | O~C~ | This field holds the | | | | amount of used volume in | | | | downlink direction. | +----------------------------+----------+----------------------------+ | > Service Specific Unit | O~C~ | This field holds the | | | | amount of used service | | | | specific units. | +----------------------------+----------+----------------------------+ | > Event Time Stamps | O~C~ | This field holds the | | | | timestamps of the event | | | | reported in the Service | | | | Specific Units, if the | | | | reported units are event | | | | based. | +----------------------------+----------+----------------------------+ | > Rating Indicator | O~C~ | This field indicates if | | | | the units have been rated | | | | or not. | +----------------------------+----------+----------------------------+ | > Local Sequence Number | M | This field holds the | | | | container sequence number. | +----------------------------+----------+----------------------------+ | > PDU Container | O~C~ | This field holds the 5G | | > Information | | data connectivity specific | | | | information defined in | | | | clause 6.2.1.3. | +----------------------------+----------+----------------------------+ | > UPF ID | OC | This field holds the UPF | | | | identifier used to | | | | identify the UPF when | | | | reporting the usage for | | | | the UPF. | +----------------------------+----------+----------------------------+ | > Multi-homed PDU address | Oc | This field holds the | | | | Multi-homed IPv6 prefix | | | | used by UPF, identified by | | | | the UPF ID. It may only be | | | | used for reporting used | | | | units. | +----------------------------+----------+----------------------------+ | Record Opening Time | M | Time stamp when the PDU | | | | session is activated in | | | | the SMF or record opening | | | | time on subsequent partial | | | | records. | +----------------------------+----------+----------------------------+ | Duration | M | This field holds the | | | | duration of this record. | +----------------------------+----------+----------------------------+ | Record Sequence Number | C | Partial record sequence | | | | number, only present in | | | | case of partial records. | +----------------------------+----------+----------------------------+ | Cause for Record Closing | M | The reason for the release | | | | of the record. | +----------------------------+----------+----------------------------+ | Diagnostics | OM | This field holds a more | | | | detailed reason for the | | | | release of the PDU | | | | session, when a single | | | | cause is applicable. | +----------------------------+----------+----------------------------+ | Local Record Sequence | OM | Consecutive record number | | Number | | created by the CDF. The | | | | number is allocated | | | | sequentially including all | | | | CDR types. | +----------------------------+----------+----------------------------+ | Record Extensions | OC | A set of network | | | | operator/manufacturer | | | | specific extensions to the | | | | record. Conditioned upon | | | | the existence of an | | | | extension. | +----------------------------+----------+----------------------------+ | PDU Session Charging | O~M~ | This field holds the 5G | | Information | | data connectivity specific | | | | information defined in | | | | clause 6.2.1.2. | +----------------------------+----------+----------------------------+ | Roaming QBC information | OC | This field holds the | | | | roaming QBC specific | | | | information defined in | | | | clause 6.2.1.4, when | | | | applicable. | +----------------------------+----------+----------------------------+
#### 6.1.3.3 Roaming QBC CHF CDR data
If enabled, CHF CDRs for Roaming QBC shall be produced in VPLMN for each PDU
session established for an in-bound roamer. The fields of Roaming QBC CHF CDR
are specified in table 6.1.3.3.1.
Table 6.1.3.3.1: Roaming QBC CHF record data
+----------------------------+----------+----------------------------+ | Field | Category | Description | +----------------------------+----------+----------------------------+ | Record Type | M | CHF record. | +----------------------------+----------+----------------------------+ | Recording Network Function | O~M~ | This field holds the name | | ID | | of the recording entity, | | | | i.e. the CHF id. | +----------------------------+----------+----------------------------+ | Subscriber Identifier | M | This field holds the 5G | | | | Subscription Permanent | | | | Identifier (SUPI) of the | | | | served party, if | | | | available. | +----------------------------+----------+----------------------------+ | NF Information | O~C~ | This field holds the | | | | information of the V-SMF | | | | that used the charging | | | | service. | +----------------------------+----------+----------------------------+ | > NF Functionality | M | This field contains the | | | | function of the node. | +----------------------------+----------+----------------------------+ | > NF Name | O~C~ | This field holds the name | | | | of the V-SMF used. | +----------------------------+----------+----------------------------+ | > NF Address | O~C~ | This fields holds the IP | | | | Address of the V-SMF used. | +----------------------------+----------+----------------------------+ | > NF PLMN ID | Oc | This field holds the PLMN | | | | identifier (MCC MNC) of | | | | the V-SMF. | +----------------------------+----------+----------------------------+ | Record Opening Time | M | Time stamp when the PDU | | | | session is activated in | | | | the SMF or record opening | | | | time on subsequent partial | | | | records. | +----------------------------+----------+----------------------------+ | Duration | M | This field holds the | | | | duration of this record. | +----------------------------+----------+----------------------------+ | Record Sequence Number | C | Partial record sequence | | | | number, only present in | | | | case of partial records. | +----------------------------+----------+----------------------------+ | Cause for Record Closing | M | The reason for the release | | | | of the record. | +----------------------------+----------+----------------------------+ | Diagnostics | O~M~ | This field holds a more | | | | detailed reason for the | | | | release of the PDU | | | | session, when a single | | | | cause is applicable. | +----------------------------+----------+----------------------------+ | Local Record Sequence | O~M~ | Consecutive record number | | Number | | created by the CHF. The | | | | number is allocated | | | | sequentially including all | | | | CDR types. | +----------------------------+----------+----------------------------+ | Record Extensions | O~C~ | A set of network | | | | operator/manufacturer | | | | specific extensions to the | | | | record. Conditioned upon | | | | the existence of an | | | | extension. | +----------------------------+----------+----------------------------+ | PDU Session Charging | O~M~ | This field holds the 5G | | Information | | data connectivity specific | | | | information defined in | | | | clause 6.2.1.2. | +----------------------------+----------+----------------------------+ | Roaming QBC Information | O~M~ | This field holds the 5G | | | | data connectivity Roaming | | | | QBC specific information | | | | defined in clause 6.2.1.4 | +----------------------------+----------+----------------------------+
## 6.2 5G data connectivity charging specific parameters
### 6.2.1 Definition of 5G data connectivity charging information
#### 6.2.1.1 General
The Charging Information parameter used for 5G data connectivity charging is
provided in the following sub-clauses.
#### 6.2.1.2 Definition of PDU session charging information
PDU session specific charging information used for 5G data connectivity
charging is provided within the PDU session charging Information.
The detailed structure of the PDU Session Charging Information can be found in
table 6.2.1.2.1.
Table 6.2.1.2.1: Structure of PDU Session Charging Information
+----------------------------+----------+----------------------------+ | Information Element | Category | Description | +----------------------------+----------+----------------------------+ | Charging Id | O~M~ | This field holds the | | | | Charging Identifier for | | | | PDU session. The value of | | | | Charging Id is the same as | | | | that of Home Provided | | | | Charging Id in V-SMF only | | | | in the home routed roaming | | | | scenario for EPS to 5GS | | | | interworking and | | | | inter-PLMN mobility from | | | | HPLMN with I-SMF to VPLMN. | +----------------------------+----------+----------------------------+ | Home Provided Charging Id | O~C~ | This field holds the | | | | Charging Identifier | | | | generated by H-SMF. This | | | | field is only applicable | | | | in V-SMF in the home | | | | routed roaming scenario | | | | for EPS to 5GS | | | | interworking and | | | | inter-PLMN mobility from | | | | HPLMN with I-SMF to VPLMN. | +----------------------------+----------+----------------------------+ | SMF Charging Id | O~M~ | This field holds a string | | | | that, be provided from the | | | | SMF instead of Charging | | | | Id, if supported. | +----------------------------+----------+----------------------------+ | SMF Home Provided Charging | O~C~ | This field holds a string | | Id | | that, be provided from the | | | | H-SMF instead of Home | | | | Provided Charging Id, if | | | | supported. | +----------------------------+----------+----------------------------+ | User Information | O~M~ | Group of user information. | +----------------------------+----------+----------------------------+ | User Identifier | O~C~ | This field contains the | | | | identification of the user | | | | (i.e. GPSI). | +----------------------------+----------+----------------------------+ | User Equipment Info | O~C~ | This field holds the | | | | identification of the | | | | terminal (i.e. PEI, MAC | | | | Address) | | | | | | | | It is used for identifying | | | | the user in case SUPI is | | | | not present during | | | | emergency service. The | | | | detail identification of | | | | the wireline access is | | | | specified in clause 4.7.7 | | | | of TS 23.316 [203]. | +----------------------------+----------+----------------------------+ | unauthenticated Flag | O~C~ | This field indicates the | | | | served SUPI is not | | | | authenticated. | +----------------------------+----------+----------------------------+ | > Roamer In Out | O~C~ | This field holds an | | | | indication if the roamer | | | | is in-bound or out-bound. | | | | This field is present only | | | | if UE is identified as a | | | | roamer. | +----------------------------+----------+----------------------------+ | User Location Info | O~C~ | This field indicates | | | | details of where the UE is | | | | currently located | | | | (access-specific user | | | | location information). | | | | | | | | For MA PDU session, this | | | | field holds the user | | | | location associated to the | | | | 3GPP access | +----------------------------+----------+----------------------------+ | MA PDU Non 3GPP User | O~C~ | This field holds the user | | Location info | | location associated to the | | | | non 3GPP access for MA PDU | | | | session. | +----------------------------+----------+----------------------------+ | User Location Time | O~C~ | This field holds the UTC | | | | time at which the UE was | | | | last known to be in the | | | | location. | | | | | | | | For MA PDU session, this | | | | field holds the user | | | | location time associated | | | | to the 3GPP access. | +----------------------------+----------+----------------------------+ | MA PDU Non 3GPP User | O~C~ | This field holds the user | | Location Time | | location time associated | | | | to the non 3GPP access for | | | | MA PDU session. | +----------------------------+----------+----------------------------+ | UE Time Zone | O~C~ | This field holds the Time | | | | Zone of where the UE is | | | | located, if available | | | | where the UE currently | | | | resides. | +----------------------------+----------+----------------------------+ | Presence Reporting Area | O~C~ | This field contains part | | Information | | of the Presence Reporting | | | | Area Information of UE as | | | | defined in TS | | | | 23.501[200], comprising | | | | the Presence Reporting | | | | Area identifier(s) and an | | | | indication on whether the | | | | UE is inside or outside | | | | the Presence Reporting | | | | Area, if available. | +----------------------------+----------+----------------------------+ | PDU Session Information | O~C~ | Group of PDU session | | | | information. | +----------------------------+----------+----------------------------+ | > PDU Session ID | M | This field holds | | | | identifier of PDU session. | +----------------------------+----------+----------------------------+ | > Network Slice Instance | O~M~ | This field holds network | | > Identifier | | slice information the PDU | | | | session belongs to. | +----------------------------+----------+----------------------------+ | PDU Type | O~M~ | This field holds the type | | | | of PDU session. | +----------------------------+----------+----------------------------+ | PDU Address | O~C~ | Group of UE IP address. | +----------------------------+----------+----------------------------+ | > PDU Ipv4 Address | O~C~ | This field holds the IP | | | | Address of the served SUPI | | | | allocated for PDU session, | | | | i.e. IPv4 address. | +----------------------------+----------+----------------------------+ | > PDU IPv6 Address with | O~C~ | This field holds the IP | | > Prefix | | Address of the served SUPI | | | | allocated for PDU session, | | | | i.e. IPv6 prefix. | +----------------------------+----------+----------------------------+ | > PDU Address prefix | O~C~ | PDP/PDN Address prefix | | > length | | length of an IPv6 typed | | | | Served PDU Address. The | | | | field needs not available | | | | for prefix length of 64 | | | | bits. | +----------------------------+----------+----------------------------+ | > IPv4 Dynamic Address | O~C~ | This field indicates | | > Flag | | whether served PDP/PDN | | | | address for IPv4 is | | | | dynamically allocated. | | | | This field is missing if | | | | address is static. | +----------------------------+----------+----------------------------+ | > IPv6 Dynamic Address | O~C~ | This field indicates | | > Flag | | whether served PDP/PDN | | | | address for IPv6 is | | | | dynamically allocated. | | | | This field is missing if | | | | address is static. | +----------------------------+----------+----------------------------+ | > Additional PDU IPv6 | O~C~ | This field holds a list of | | > prefixes | | additional IPv6 prefix | | | | allocated for the PDU | | | | session, when applicable. | +----------------------------+----------+----------------------------+ | > SSC Mode | O~C~ | This field holds SSC mode | | | | of PDU session. | +----------------------------+----------+----------------------------+ | > MA PDU session | O~C~ | This field holds | | > information | | information associated to | | | | the MA PDU session. | +----------------------------+----------+----------------------------+ | > MA PDU session indicator | O~C~ | This field indicates the | | | | PDU session is a MA PDU | | | | session requested by the | | | | UE or requested by Network | | | | modification based ATSSS | | | | capabilities provided by | | | | the UE and the Network. | +----------------------------+----------+----------------------------+ | > ATSSS capability | O~C~ | This field holds the ATSSS | | | | capability supported by | | | | the MA PDU session | +----------------------------+----------+----------------------------+ | > SUPI PLMN ID | O~C~ | This field holds PLMN ID | | | | of the SUPI. | +----------------------------+----------+----------------------------+ | > CP CIoT Optimisation | O~C~ | This field holds the | | > indicator | | indicator whether control | | | | plane optimization CIoT | | | | for 5GS is used during the | | | | PDU session, if this | | | | feature is enabled. | +----------------------------+----------+----------------------------+ | > 5GS Control Plane Only | O~C~ | This field holds the | | > indicator | | indicator whether the | | | | control plane only is | | | | used, i.e., the PDU data | | | | only transfers to control | | | | plane in case of control | | | | plane CIoT optimization. | +----------------------------+----------+----------------------------+ | > Small data rate control | O~C~ | This field holds the | | > indicator | | indicator whether the | | | | small data rate control | | | | for 5GS CIoT is used | | | | during the PDU session. | +----------------------------+----------+----------------------------+ | > Serving Network Function | O~C~ | This field holds the | | > ID | | identity of the serving | | | | network function. | +----------------------------+----------+----------------------------+ | > Serving Network Function | M | This field holds the | | > Information | | Information of the serving | | | | network function: | | | | | | | | > \- AMF for the PDU | | | | > sessions being served by | | | | > SMF in non-roaming | | | | > | | | | > \- SMF for the home | | | | > routed roaming | | | | > | | | | > \- I-SMF for the PDU | | | | > session being served by | | | | > SMF + I-SMF | | | | > | | | | > \- ePDG for handover | | | | > between EPC/ePDG and 5GS | | | | | | | | - SGW for EPC/E-UTRAN | | | | interworking. | +----------------------------+----------+----------------------------+ | > AMF Identifier | O~C~ | This field holds the AMF | | | | identifier. | +----------------------------+----------+----------------------------+ | Serving CN PLMN ID | O~C~ | This field holds the | | | | serving Core Network | | | | Operator PLMN ID selected | | | | by the UE if different | | | | from SMF PLMN ID. | +----------------------------+----------+----------------------------+ | RAT Type | O~C~ | This field holds the Radio | | | | Access Technology (RAT) | | | | currently serving the UE. | | | | | | | | For MA PDU session, this | | | | field holds the Radio | | | | Access Technology (RAT) | | | | associated to the 3GPP | | | | access | +----------------------------+----------+----------------------------+ | > MA PDU Non 3GPP RAT Type | O~C~ | This field holds the Radio | | | | Access Technology (RAT) | | | | serving the UE in non 3GPP | | | | access for MA PDU session. | +----------------------------+----------+----------------------------+ | > Data Network Name | M | This field contains the | | > Identifier | | identifier of the DNN the | | | | user is connected to. | +----------------------------+----------+----------------------------+ | > DNN Selection Mode | O~C~ | This field indicates | | | | whether the requested DNN | | | | corresponds to an | | | | explicitly subscribed DNN | | | | or to the usage of a | | | | wildcard subscription. | +----------------------------+----------+----------------------------+ | > Authorized QoS | O~C~ | This field holds the | | > Information | | authorized QoS applied to | | | | PDU session. | +----------------------------+----------+----------------------------+ | > Subscribed QoS | O~C~ | This field holds the | | > Information | | subscribed default QoS for | | | | the PDU session. | +----------------------------+----------+----------------------------+ | Authorized Session-AMBR | O~C~ | This field holds the | | | | authorized Session-AMBR | | | | for the PDU session. | +----------------------------+----------+----------------------------+ | Subscribed Session-AMBR | O~C~ | This field holds the | | | | subscribed Session-AMBR | | | | for the PDU session. | +----------------------------+----------+----------------------------+ | PDU session start Time | O~C~ | This field holds the | | | | timestamp when PDU session | | | | starts. | +----------------------------+----------+----------------------------+ | PDU session stop Time | O~C~ | This field holds the | | | | timestamp when PDU session | | | | terminates. | +----------------------------+----------+----------------------------+ | Diagnostics | O~C~ | This field holds a | | | | detailed reason for the | | | | release of the PDU session | | | | and complements the | | | | \"Change Condition\" | | | | information. | +----------------------------+----------+----------------------------+ | Enhanced Diagnostics | O~C~ | This field holds a more | | | | detailed reason for the | | | | release of the PDU | | | | session, when a set of | | | | causes are applicable. | +----------------------------+----------+----------------------------+ | Charging Characteristics | O~C~ | This field holds the | | | | Charging Characteristics | | | | for this PDU session. | +----------------------------+----------+----------------------------+ | Charging Characteristics | O~C~ | This field holds | | | | information about how the | | Selection Mode | | \"Charging | | | | Characteristics\" was | | | | selected. | +----------------------------+----------+----------------------------+ | 3GPP PS Data Off Status | O~C~ | This field holds the 3GPP | | | | Data off Status when UE\'s | | | | 3GPP Data Off status is | | | | Activated or Deactivated. | +----------------------------+----------+----------------------------+ | Session Stop Indicator | O~C~ | This field indicates to | | | | the CHF that the PDU | | | | session has been | | | | terminated. | +----------------------------+----------+----------------------------+ | Redundant Transmission | O~C~ | This field holds the | | | | redundant transmission | | Type | | Type. | +----------------------------+----------+----------------------------+ | PDU Session Pair ID | O~C~ | This field holds an | | | | identifier that identify | | | | PDU Session that is | | | | redundant with this PDU | | | | session. | | | | | | | | This field is only | | | | applicable for dual | | | | connectivity based end to | | | | end redundant user plane | | | | paths case. | +----------------------------+----------+----------------------------+ | 5G LAN Type Service | O~C~ | This field holds the 5G | | | | LAN Type service | | | | information, if present, | | | | the PDU session is for 5G | | | | LAN group. | +----------------------------+----------+----------------------------+ | > Internal Group | M | This field holds the | | > Identifier | | internal group identifier | | | | of the 5G LAN VN group. | +----------------------------+----------+----------------------------+ | Unit Count Inactivity | O~C~ | This field holds the | | Timer | | threshold for the time | | | | period when no units has | | | | been counted by the SMF. | | | | It holds either the value | | | | configured in SMF, if it | | | | is supported, or the value | | | | to be used as received | | | | from the CHF. A value of | | | | zero indicates that this | | | | mechanism shall not be | | | | used. | | | | | | | | This field is not | | | | applicable to QBC. | +----------------------------+----------+----------------------------+ | RAN Secondary RAT Usage | O~C~ | This field holds the | | Report | | secondary RAT usage | | | | reported from NG-RAN. | +----------------------------+----------+----------------------------+ | > NG RAN Secondary RAT | O~M~ | This field holds the value | | > Type | | of Secondary RAT Type, as | | | | provided by the NG-RAN. | +----------------------------+----------+----------------------------+ | Qos Flows Usage Reports | O~M~ | This field holds a list of | | | | containers per QFI with | | | | volumes reported, each | | | | container is time stamped. | +----------------------------+----------+----------------------------+ | QoS Flow Id | O~M~ | This field holds the QoS | | | | flow Identifier (QFI) | +----------------------------+----------+----------------------------+ | Start Timestamp | O~C~ | This field holds the start | | | | timestamp of the collected | | | | usage. | +----------------------------+----------+----------------------------+ | End Timestamp | O~C~ | This field holds the end | | | | timestamp of the collected | | | | usage. | +----------------------------+----------+----------------------------+ | Downlink Volume | O~C~ | This field holds the | | | | amount of used volume in | | | | downlink direction. | +----------------------------+----------+----------------------------+ | Uplink Volume | O~C~ | This field holds the | | | | amount of used volume in | | | | uplink direction. | +----------------------------+----------+----------------------------+
#### 6.2.1.3 Definition of PDU Container information
Used Unit Container, described in table 6.1.1.2.1, specific charging
information used for 5G data connectivity charging is provided within the PDU
Container Information described in table 6.2.1.3.1.
Table 6.2.1.3.1: Structure of PDU Container Information
+----------------------------+----------+----------------------------+ | Information Element | Category | Description | +----------------------------+----------+----------------------------+ | Time of First Usage | O~C~ | This field holds the | | | | Timestamp when the first | | | | transmitted IP packet of | | | | the service data flow | | | | matching the current used | | | | unit container | +----------------------------+----------+----------------------------+ | Time of Last Usage | O~C~ | This field holds the | | | | Timestamp when the last | | | | transmitted IP packet of | | | | the service data flow | | | | matching the current used | | | | unit container | +----------------------------+----------+----------------------------+ | QoS Information | O~C~ | This field holds the QoS | | | | applied **during the | | | | service data container | | | | interval** | +----------------------------+----------+----------------------------+ | QoS Characteristics | O~C~ | This field holds the QoS | | | | characteristics applied | | | | **for QoS information. It | | | | is** only be used when the | | | | non-standardized 5QI is | | | | present in QoS | | | | information. | +----------------------------+----------+----------------------------+ | AF Charging Identifier | O~C~ | A Charging Identifier, | | | | provided from the AF, may | | | | be used to correlate the | | | | measurement for the | | | | Charging key/Service | | | | identifier values in this | | | | PCC rule with application | | | | level reports. | +----------------------------+----------+----------------------------+ | AF Charging Id String | O~C~ | A string that, may be | | | | provided from the AF | | | | instead of AF Charging | | | | Identifier, depending on | | | | support. | +----------------------------+----------+----------------------------+ | User Location Information | O~C~ | This field holds the user | | | | **location during the** | | | | used unit **container | | | | interval** | +----------------------------+----------+----------------------------+ | UE Time Zone | O~C~ | This field holds the Time | | | | Zone of where the UE is | | | | located, **during the** | | | | used unit **container | | | | interval**. | +----------------------------+----------+----------------------------+ | Presence Reporting Area | O~C~ | This field holds the | | Information | | Presence Reporting Area | | | | Information of UE **during | | | | the** used unit | | | | **container interval**. | +----------------------------+----------+----------------------------+ | Serving Network Function | O~C~ | Serving Network Function | | ID | | identifier. | +----------------------------+----------+----------------------------+ | RAT Type | O~C~ | This field holds the RAT | | | | type **during the** used | | | | unit **container | | | | interval.** | | | | | | | | **For MA PDU session, | | | | t** his field holds the RAT | | | | type associated to the | | | | access which activated the | | | | rating group. | +----------------------------+----------+----------------------------+ | Sponsor Identity | O~C~ | This field holds the | | | | identifier of the sponsor | | | | when sponsored data | | | | connectivity is used | +----------------------------+----------+----------------------------+ | Application Service | O~C~ | This field holds the | | Provider Identity | | identifier of the | | | | application service | | | | provider that is | | | | delivering a service to | | | | the end user. | +----------------------------+----------+----------------------------+ | Charging Rule Base Name | O~C~ | This field holds the | | | | reference to group of PCC | | | | rules predefined at the | | | | SMF | +----------------------------+----------+----------------------------+ | 3GPP PS Data Off Status | O~C~ | This field holds the 3GPP | | | | Data off Status **during | | | | the** used unit | | | | **container interval** | +----------------------------+----------+----------------------------+ | MA PDU Steering | O~C~ | This field holds the | | functionality | | Steering functionality | | | | used **during the** used | | | | unit **container interval | | | | when MA PDU session** | +----------------------------+----------+----------------------------+ | MA PDU Steering mode | O~C~ | This field holds the | | | | Steering mode used | | | | **during the** used unit | | | | **container interval when | | | | MA PDU session.** | +----------------------------+----------+----------------------------+ | Traffic Forwarding Way | O~C~ | This field holds the | | | | traffic forwarding way for | | | | the 5G VN group | | | | communication if present. | | | | | | | | If the SMF can distinguish | | | | the traffic forwarding | | | | way, the SMF reports the | | | | volume per traffic | | | | forwarding way. If the SMF | | | | cannot distinguish, the | | | | SMF reports the traffic | | | | and the corresponding | | | | traffic forwarding way | | | | (may be multiple). | +----------------------------+----------+----------------------------+ | QoS Monitoring Report | O~C~ | This field holds the QoS | | | | monitoring result (i.e., | | | | average packet delay per | | | | QoS flow per UE) for the | | | | service data flow. | +----------------------------+----------+----------------------------+
#### 6.2.1.4 Definition of roaming QBC information
Roaming QBC specific charging information used for 5G data connectivity
charging is provided within the Roaming QBC Information.
The detailed structure of the Roaming QBC Information can be found in table
6.2.1.4.1.
Table 6.2.1.4.1: Structure of Roaming QBC Information
+----------------------------+----------+----------------------------+ | Information Element | Category | Description | +----------------------------+----------+----------------------------+ | Multiple QFI container | O~C~ | This field holds a list of | | | | QFI containers. It may | | | | have multiple occurrences | +----------------------------+----------+----------------------------+ | > Triggers | O~C~ | This field holds the | | | | reason for closing the QFI | | | | unit container. | +----------------------------+----------+----------------------------+ | > Trigger Timestamp | O~C~ | This field holds the | | | | timestamp of the trigger. | +----------------------------+----------+----------------------------+ | > Time | O~C~ | This field holds the | | | | amount of used time. | +----------------------------+----------+----------------------------+ | > Total Volume | O~C~ | This field holds the | | | | amount of used volume in | | | | both uplink and downlink | | | | directions. | +----------------------------+----------+----------------------------+ | > Uplink Volume | O~C~ | This field holds the | | | | amount of used volume in | | | | uplink direction. | +----------------------------+----------+----------------------------+ | > Downlink Volume | O~C~ | This field holds the | | | | amount of used volume in | | | | downlink direction. | +----------------------------+----------+----------------------------+ | > Local Sequence Number | M | This field holds a QFI | | | | data container sequence | | | | number | +----------------------------+----------+----------------------------+ | QFI Container information | O~C~ | This field holds the QFI | | | | data container information | | | | defined in clause 6.2.1.5 | +----------------------------+----------+----------------------------+ | UPF ID | O~C~ | This field holds the UPF | | | | identifier and is included | | | | for backwards | | | | compatibility. It can be | | | | included when reporting | | | | the usage for the UPF, | | | | depending on operator | | | | requirement. | +----------------------------+----------+----------------------------+ | Roaming Charging Profile | O~C~ | This field holds the | | | | Roaming Charging Profile | | | | associated to the PDU | | | | session for roaming QBC. | +----------------------------+----------+----------------------------+ | > Trigger | O~C~ | This field holds the | | | | trigger applicable to | | | | QBC.\ | | | | This field has multiple | | | | occurrences | +----------------------------+----------+----------------------------+ | > Trigger type | O~C~ | This field holds the | | | | chargeable events defined | | | | in table 5.2.1.6.1. | +----------------------------+----------+----------------------------+ | > Trigger category | O~C~ | This field holds the | | | | trigger category (i.e. | | | | immediate or deferred | | | | reporting) | +----------------------------+----------+----------------------------+ | > Time Limit | O~C~ | This field holds the limit | | | | value in seconds when the | | | | trigger type is \"Expiry | | | | of data time limit\" | +----------------------------+----------+----------------------------+ | > Volume Limit | O~C~ | This field holds the limit | | | | value in octets when the | | | | trigger type is \"Expiry | | | | of data volume limit\" | +----------------------------+----------+----------------------------+ | > Max Number of charging | O~C~ | This field holds the limit | | > condition changes | | value when the trigger | | | | type is \"Expiry of limit | | | | of number of charging | | | | condition changes\" | +----------------------------+----------+----------------------------+ | > Partial record method | O~C~ | This field holds the | | | | method uses by the CHF for | | | | partial record closure: | | | | default or Individual. | +----------------------------+----------+----------------------------+
#### 6.2.1.5 Definition of QFI Container information
QFI Container information, defined in table 6.2.1.4.1, specific charging
information used for 5G data connectivity QBC charging is provided within the
QFI Container Information described in table 6.2.1.5.1.
Table 6.2.1.5.1: Structure of QFI Container Information
* * *
Information Element Category Description QoS Flow Id M This field holds the
QoS flow Identifier (QFI) Time of First Usage O~C~ This field holds the
Timestamp when the first transmitted IP packet of the service data flow
matching the current QFI data container Time of Last Usage O~C~ This field
holds the Timestamp when the last transmitted IP packet of the service data
flow matching the current QFI data container QoS Information O~C~ This field
holds the QoS applied **during the** QFI **data container interval** QoS
Characteristics O~C~ This field holds the QoS characteristics applied **for
QoS information. It is** only be used when the non-standardized 5QI is present
in QoS information. User Location Information O~C~ This field holds the user
**location during the** QFI **data container interval** UE Time Zone O~C~ This
field holds the Time Zone of where the UE is located, **during the** QFI
**data container interval** RAT Type O~C~ This field holds the RAT type
**during the** QFI **data container interval** Report Time M This field holds
the Timestamp when the QFI data container was closed Serving Network Function
ID O~C~ Group of serving Network Function identifier. 3GPP PS Data Off Status
O~C~ This field holds the 3GPP Data off Status **during the** QFI **data
container interval**
* * *
### 6.2.2 Detailed message format for converged charging
The following clause specifies per Operation Type the charging data that are
sent by SMF for 5G data connectivity converged charging or offline only
charging.
The Operation Types are listed in the following order: I (Initial)/U
(Update)/T (Termination)/E (Event). Therefore, when all Operation Types are
possible it is marked as IUTE. If only some Operation Types are allowed for a
node, only the appropriate letters are used (i.e. IUT or E) as indicated in
the table heading. The omission of an Operation Type for a particular field is
marked with \"-\" (i.e. IU-E). Also, when an entire field is not allowed in a
node the entire cell is marked as \"-\".
Table 6.2.2.1 defines the basic structure of the supported fields in the
_Charging Data_ Request message for 5G data connectivity converged charging or
offline only charging.
Table 6.2.2.1: Supported fields in _Charging Data Request message_
+----------+----------+----------+----------+----------+----------+ | Inf | Funct | FBC | QBC | FBC | QBC | | ormation | ionality | | | | | | Element | of SMF | | | | | +----------+----------+----------+----------+----------+----------+ | | Charging | C | C | Offline | Offline | | | Service | onverged | onverged | Only | Only | | | | Charging | Charging | Charging | Charging | +----------+----------+----------+----------+----------+----------+ | | S | I/U/T/E | I/U/T/E | I/U/T/E | I/U/T/E | | | upported | | | | | | | O | | | | | | | peration | | | | | | | Types | | | | | +----------+----------+----------+----------+----------+----------+ | Session | -UT- | -UT- | -UT- | -UT- | | | Id | | | | | | | entifier | | | | | | +----------+----------+----------+----------+----------+----------+ | Su | IUT- | IUT- | IUT- | IUT- | | | bscriber | | | | | | | Id | | | | | | | entifier | | | | | | +----------+----------+----------+----------+----------+----------+ | NF | IUT- | IUT- | IUT- | IUT- | | | Consumer | | | | | | | Identi | | | | | | | fication | | | | | | +----------+----------+----------+----------+----------+----------+ | In | IUT- | IUT- | IUT- | IUT- | | | vocation | | | | | | | T | | | | | | | imestamp | | | | | | +----------+----------+----------+----------+----------+----------+ | In | IUT- | IUT- | IUT- | IUT- | | | vocation | | | | | | | Sequence | | | | | | | Number | | | | | | +----------+----------+----------+----------+----------+----------+ | Retran | IUT- | IUT- | IUT- | IUT- | | | smission | | | | | | | I | | | | | | | ndicator | | | | | | +----------+----------+----------+----------+----------+----------+ | Notify | IU- | IU- | IU- | IU- | | | URI | | | | | | +----------+----------+----------+----------+----------+----------+ | S | IU- | IU- | - | - | | | upported | | | | | | | Features | | | | | | +----------+----------+----------+----------+----------+----------+ | Service | IUT- | IUT- | IUT- | IUT- | | | Speci | | | | | | | fication | | | | | | | Inf | | | | | | | ormation | | | | | | +----------+----------+----------+----------+----------+----------+ | Triggers | -UT- | -UT- | -UT- | -UT- | | +----------+----------+----------+----------+----------+----------+ | Multiple | IUT- | - | IUT- | - | | | Unit | | | | | | | Usage | | | | | | +----------+----------+----------+----------+----------+----------+ | > Rating | IUT- | - | IUT- | - | | | > Group | | | | | | +----------+----------+----------+----------+----------+----------+ | > R | IU-- | - | - | - | | | equested | | | | | | | > Unit | | | | | | +----------+----------+----------+----------+----------+----------+ | > Used | -UT- | - | -UT- | - | | | > Unit | | | | | | | > C | | | | | | | ontainer | | | | | | +----------+----------+----------+----------+----------+----------+ | > | -UT- | - | -UT- | - | | | Triggers | | | | | | +----------+----------+----------+----------+----------+----------+ | > PDU | -UT- | - | -UT- | - | | | > C | | | | | | | ontainer | | | | | | | > Inf | | | | | | | ormation | | | | | | +----------+----------+----------+----------+----------+----------+ | > UPF ID | IUT- | - | IUT- | - | | +----------+----------+----------+----------+----------+----------+ | PDU | IUT- | IUT- | IUT- | IUT- | | | Session | | | | | | | Charging | | | | | | | Inf | | | | | | | ormation | | | | | | +----------+----------+----------+----------+----------+----------+ | Charging | IUT- | IUT- | IUT- | IUT- | | | Id | | | | | | +----------+----------+----------+----------+----------+----------+ | SMF | IUT- | IUT- | IUT- | IUT- | | | Charging | | | | | | | Id | | | | | | +----------+----------+----------+----------+----------+----------+ | Home | -UT- | -UT- | -UT- | -UT- | | | Provided | | | | | | | Charging | | | | | | | Id | | | | | | +----------+----------+----------+----------+----------+----------+ | SMF Home | -UT- | -UT- | -UT- | -UT- | | | Provided | | | | | | | Charging | | | | | | | Id | | | | | | +----------+----------+----------+----------+----------+----------+ | User | IUT- | IUT- | IUT- | IUT- | | | Inf | | | | | | | ormation | | | | | | +----------+----------+----------+----------+----------+----------+ | User | IUT- | IUT- | IUT- | IUT- | | | Location | | | | | | | Info | | | | | | +----------+----------+----------+----------+----------+----------+ | MA PDU | IUT- | IUT- | IUT- | IUT- | | | Non 3GPP | | | | | | | User | | | | | | | Location | | | | | | | Info | | | | | | +----------+----------+----------+----------+----------+----------+ | User | IUT- | IUT- | IUT- | IUT- | | | Location | | | | | | | Time | | | | | | +----------+----------+----------+----------+----------+----------+ | MA PDU | IUT- | IUT- | IUT- | IUT- | | | Non 3GPP | | | | | | | User | | | | | | | Location | | | | | | | Time | | | | | | +----------+----------+----------+----------+----------+----------+ | UE Time | IUT- | IUT- | IUT- | IUT- | | | Zone | | | | | | +----------+----------+----------+----------+----------+----------+ | Presence | -UT- | -UT- | -UT- | -UT- | | | R | | | | | | | eporting | | | | | | | Area | | | | | | | Inf | | | | | | | ormation | | | | | | +----------+----------+----------+----------+----------+----------+ | PDU | IUT- | IUT- | IUT- | IUT- | | | Session | | | | | | | Inf | | | | | | | ormation | | | | | | +----------+----------+----------+----------+----------+----------+ | > PDU | IUT- | IUT- | IUT- | IUT- | | | > | | | | | | | Session | | | | | | | > ID | | | | | | +----------+----------+----------+----------+----------+----------+ | > | IUT- | IUT- | IUT- | IUT- | | | Network | | | | | | | > Slice | | | | | | | > | | | | | | | Instance | | | | | | | > Id | | | | | | | entifier | | | | | | +----------+----------+----------+----------+----------+----------+ | > PDU | IUT- | IUT- | IUT- | IUT- | | | > Type | | | | | | +----------+----------+----------+----------+----------+----------+ | > PDU | IUT- | IUT- | IUT- | IUT- | | | > | | | | | | | Address | | | | | | +----------+----------+----------+----------+----------+----------+ | > SSC | IUT- | IUT- | IUT- | IUT- | | | > Mode | | | | | | +----------+----------+----------+----------+----------+----------+ | > MA PDU | IUT- | IUT- | IUT- | IUT- | | | > | | | | | | | session | | | | | | | > inf | | | | | | | ormation | | | | | | +----------+----------+----------+----------+----------+----------+ | > SUPI | IUT- | IUT- | IUT- | IUT- | | | > PLMN | | | | | | | > ID | | | | | | +----------+----------+----------+----------+----------+----------+ | > | IUT- | IUT- | IUT- | IUT- | | | Serving | | | | | | | > | | | | | | | Network | | | | | | | > | | | | | | | Function | | | | | | | > ID | | | | | | +----------+----------+----------+----------+----------+----------+ | > | IUT- | IUT- | IUT- | IUT- | | | Serving | | | | | | | > CN | | | | | | | > PLMN | | | | | | | > ID | | | | | | +----------+----------+----------+----------+----------+----------+ | > RAT | IUT- | IUT- | IUT- | IUT- | | | > Type | | | | | | +----------+----------+----------+----------+----------+----------+ | > MA PDU | IUT- | IUT- | IUT- | IUT- | | | > Non | | | | | | | > 3GPP | | | | | | | > RAT | | | | | | | > Type | | | | | | +----------+----------+----------+----------+----------+----------+ | > Data | IUT- | IUT- | IUT- | IUT- | | | > | | | | | | | Network | | | | | | | > Name | | | | | | | > Id | | | | | | | entifier | | | | | | +----------+----------+----------+----------+----------+----------+ | > DNN | IUT- | IUT- | IUT- | IUT- | | | > S | | | | | | | election | | | | | | | > Mode | | | | | | +----------+----------+----------+----------+----------+----------+ | > Au | IUT- | IUT- | IUT- | IUT- | | | thorized | | | | | | | > QoS | | | | | | | > Inf | | | | | | | ormation | | | | | | +----------+----------+----------+----------+----------+----------+ | > Su | IUT- | IUT- | IUT- | IUT- | | | bscribed | | | | | | | > QoS | | | | | | | > Inf | | | | | | | ormation | | | | | | +----------+----------+----------+----------+----------+----------+ | > Au | IUT- | IUT- | IUT- | IUT- | | | thorized | | | | | | | > Sess | | | | | | | ion-AMBR | | | | | | +----------+----------+----------+----------+----------+----------+ | > Su | IUT- | IUT- | IUT- | IUT- | | | bscribed | | | | | | | > Sess | | | | | | | ion-AMBR | | | | | | +----------+----------+----------+----------+----------+----------+ | > PDU | I--- | I--- | I--- | I--- | | | > | | | | | | | session | | | | | | | > start | | | | | | | > Time | | | | | | +----------+----------+----------+----------+----------+----------+ | > PDU | --T- | --T- | --T- | --T- | | | > | | | | | | | session | | | | | | | > stop | | | | | | | > Time | | | | | | +----------+----------+----------+----------+----------+----------+ | > Dia | --T- | --T- | --T- | --T- | | | gnostics | | | | | | +----------+----------+----------+----------+----------+----------+ | > | --T- | --T- | --T- | --T- | | | Enhanced | | | | | | | > Dia | | | | | | | gnostics | | | | | | +----------+----------+----------+----------+----------+----------+ | > | IUT- | IUT- | IUT- | IUT- | | | Charging | | | | | | | > | | | | | | | Charact | | | | | | | eristics | | | | | | +----------+----------+----------+----------+----------+----------+ | > | IUT- | IUT- | IUT- | IUT- | | | Charging | | | | | | | > | | | | | | | Charact | | | | | | | eristics | | | | | | | > S | | | | | | | election | | | | | | | > Mode | | | | | | +----------+----------+----------+----------+----------+----------+ | > 3GPP | IUT- | IUT- | IUT- | IUT- | | | > PS | | | | | | | > Data | | | | | | | > Off | | | | | | | > Status | | | | | | +----------+----------+----------+----------+----------+----------+ | > | --T- | --T- | --T- | --T- | | | Session | | | | | | | > Stop | | | | | | | > I | | | | | | | ndicator | | | | | | +----------+----------+----------+----------+----------+----------+ | > R | IUT- | IUT- | IUT- | IUT- | | | edundant | | | | | | | > Tran | | | | | | | smission | | | | | | | > Type | | | | | | +----------+----------+----------+----------+----------+----------+ | > PDU | IUT- | IUT- | IUT- | IUT- | | | > | | | | | | | Session | | | | | | | > Pair | | | | | | | > ID | | | | | | +----------+----------+----------+----------+----------+----------+ | > 5G LAN | IUT- | IUT- | IUT- | IUT- | | | > Type | | | | | | | > | | | | | | | Service | | | | | | +----------+----------+----------+----------+----------+----------+ | Unit | IU-- | - | IU-- | - | | | Count | | | | | | | In | | | | | | | activity | | | | | | | Timer | | | | | | +----------+----------+----------+----------+----------+----------+ | RAN | -UT- | -UT- | -UT- | -UT- | | | S | | | | | | | econdary | | | | | | | RAT | | | | | | | Usage | | | | | | | Report | | | | | | +----------+----------+----------+----------+----------+----------+ | Roaming | - | IUT- | - | IUT- | | | QBC | | | | | | | inf | | | | | | | ormation | | | | | | +----------+----------+----------+----------+----------+----------+ | Multiple | - | IUT- | - | IUT- | | | QFI | | | | | | | c | | | | | | | ontainer | | | | | | +----------+----------+----------+----------+----------+----------+ | UPF ID | - | IUT- | - | IUT- | | +----------+----------+----------+----------+----------+----------+ | Roaming | - | IU-- | - | IU-- | | | Charging | | | | | | | Profile | | | | | | +----------+----------+----------+----------+----------+----------+
Table 6.2.2.2 defines the basic structure of the supported fields in the
_Charging Data_ Response message for 5G data connectivity converged charging
or offline only charging.
Table 6.2.2.2: Supported fields in _Charging Data Response message_
+----------+----------+----------+----------+----------+----------+ | Inf | Funct | FBC | QBC | FBC | QBC | | ormation | ionality | | | | | | Element | of SMF | | | | | +----------+----------+----------+----------+----------+----------+ | | Charging | C | C | Offline | Offline | | | Service | onverged | onverged | Only | Only | | | | Charging | Charging | Charging | Charging | +----------+----------+----------+----------+----------+----------+ | | S | I/U/T/E | I/U/T/E | I/U/T/E | I/U/T/E | | | upported | | | | | | | O | | | | | | | peration | | | | | | | Types | | | | | +----------+----------+----------+----------+----------+----------+ | Session | I--- | I--- | I--- | I--- | | | Id | | | | | | | entifier | | | | | | +----------+----------+----------+----------+----------+----------+ | In | IUT- | IUT- | IUT- | IUT- | | | vocation | | | | | | | T | | | | | | | imestamp | | | | | | +----------+----------+----------+----------+----------+----------+ | In | IUT- | IUT- | IUT- | IUT- | | | vocation | | | | | | | Result | | | | | | +----------+----------+----------+----------+----------+----------+ | In | IUT- | IUT- | IUT- | IUT- | | | vocation | | | | | | | Sequence | | | | | | | Number | | | | | | +----------+----------+----------+----------+----------+----------+ | Session | IU-- | IUT- | IU-- | IUT- | | | Failover | | | | | | +----------+----------+----------+----------+----------+----------+ | S | IU-- | IU-- | - | - | | | upported | | | | | | | Features | | | | | | +----------+----------+----------+----------+----------+----------+ | Triggers | IU-- | IU-- | IU-- | IU-- | | +----------+----------+----------+----------+----------+----------+ | Multiple | IU-- | - | IU-- | - | | | Unit | | | | | | | inf | | | | | | | ormation | | | | | | +----------+----------+----------+----------+----------+----------+ | > Result | IU-- | - | IU-- | - | | | > Code | | | | | | +----------+----------+----------+----------+----------+----------+ | > Rating | IU-- | - | IU-- | - | | | > Group | | | | | | +----------+----------+----------+----------+----------+----------+ | > UPF ID | IU-- | - | IU-- | - | | +----------+----------+----------+----------+----------+----------+ | > | IU-- | - | - | - | | | Granted | | | | | | | > Unit | | | | | | +----------+----------+----------+----------+----------+----------+ | > | IU-- | - | - | - | | | Validity | | | | | | | > Time | | | | | | +----------+----------+----------+----------+----------+----------+ | > Final | IU-- | - | - | - | | | > Unit | | | | | | | > In | | | | | | | dication | | | | | | +----------+----------+----------+----------+----------+----------+ | > Time | IU-- | - | - | - | | | > Quota | | | | | | | > T | | | | | | | hreshold | | | | | | +----------+----------+----------+----------+----------+----------+ | > Volume | IU-- | - | - | - | | | > Quota | | | | | | | > T | | | | | | | hreshold | | | | | | +----------+----------+----------+----------+----------+----------+ | > Unit | IU-- | - | - | - | | | > Quota | | | | | | | > T | | | | | | | hreshold | | | | | | +----------+----------+----------+----------+----------+----------+ | > Quota | IU-- | - | - | - | | | > | | | | | | | Holding | | | | | | | > Time | | | | | | +----------+----------+----------+----------+----------+----------+ | > | IU-- | - | IU-- | - | | | Triggers | | | | | | +----------+----------+----------+----------+----------+----------+ | PDU | IU-- | IU-- | IU-- | IU-- | | | Session | | | | | | | Charging | | | | | | | Inf | | | | | | | ormation | | | | | | +----------+----------+----------+----------+----------+----------+ | Charging | - | - | - | - | | | Id | | | | | | +----------+----------+----------+----------+----------+----------+ | SMF | - | - | - | - | | | Charging | | | | | | | Id | | | | | | +----------+----------+----------+----------+----------+----------+ | Home | - | - | - | - | | | Provided | | | | | | | Charging | | | | | | | Id | | | | | | +----------+----------+----------+----------+----------+----------+ | SMF Home | - | - | - | - | | | Provided | | | | | | | Charging | | | | | | | Id | | | | | | +----------+----------+----------+----------+----------+----------+ | User | - | - | - | - | | | Inf | | | | | | | ormation | | | | | | +----------+----------+----------+----------+----------+----------+ | User | - | - | - | - | | | Location | | | | | | | Info | | | | | | +----------+----------+----------+----------+----------+----------+ | MA PDU | - | - | - | - | | | Non 3GPP | | | | | | | User | | | | | | | Location | | | | | | | info | | | | | | +----------+----------+----------+----------+----------+----------+ | User | - | - | - | - | | | Location | | | | | | | Time | | | | | | +----------+----------+----------+----------+----------+----------+ | MA PDU | - | - | - | - | | | Non 3GPP | | | | | | | User | | | | | | | Location | | | | | | | Time | | | | | | +----------+----------+----------+----------+----------+----------+ | UE Time | - | - | - | - | | | Zone | | | | | | +----------+----------+----------+----------+----------+----------+ | Presence | IU-- | IU-- | IU-- | IU-- | | | R | | | | | | | eporting | | | | | | | Area | | | | | | | Inf | | | | | | | ormation | | | | | | +----------+----------+----------+----------+----------+----------+ | PDU | - | - | - | - | | | Session | | | | | | | Inf | | | | | | | ormation | | | | | | +----------+----------+----------+----------+----------+----------+ | > PDU | - | - | - | - | | | > | | | | | | | Session | | | | | | | > ID | | | | | | +----------+----------+----------+----------+----------+----------+ | > | - | - | - | - | | | Network | | | | | | | > Slice | | | | | | | > | | | | | | | Instance | | | | | | | > Id | | | | | | | entifier | | | | | | +----------+----------+----------+----------+----------+----------+ | > PDU | - | - | - | - | | | > Type | | | | | | +----------+----------+----------+----------+----------+----------+ | > PDU | - | - | - | - | | | > | | | | | | | Address | | | | | | +----------+----------+----------+----------+----------+----------+ | > SSC | - | - | - | - | | | > Mode | | | | | | +----------+----------+----------+----------+----------+----------+ | > MA PDU | - | - | - | - | | | > | | | | | | | session | | | | | | | > inf | | | | | | | ormation | | | | | | +----------+----------+----------+----------+----------+----------+ | > SUPI | - | - | - | - | | | > PLMN | | | | | | | > ID | | | | | | +----------+----------+----------+----------+----------+----------+ | > | - | - | - | - | | | Serving | | | | | | | > | | | | | | | Network | | | | | | | > | | | | | | | Function | | | | | | | > ID | | | | | | +----------+----------+----------+----------+----------+----------+ | > | - | - | - | - | | | Serving | | | | | | | > CN | | | | | | | > PLMN | | | | | | | > ID | | | | | | +----------+----------+----------+----------+----------+----------+ | > RAT | - | - | - | - | | | > Type | | | | | | +----------+----------+----------+----------+----------+----------+ | > MA PDU | - | - | - | - | | | > Non | | | | | | | > 3GPP | | | | | | | > RAT | | | | | | | > Type | | | | | | +----------+----------+----------+----------+----------+----------+ | > Data | - | - | - | - | | | > | | | | | | | Network | | | | | | | > Name | | | | | | | > Id | | | | | | | entifier | | | | | | +----------+----------+----------+----------+----------+----------+ | > DNN | - | - | - | - | | | > S | | | | | | | election | | | | | | | > Mode | | | | | | +----------+----------+----------+----------+----------+----------+ | > Au | - | - | - | - | | | thorized | | | | | | | > QoS | | | | | | | > Inf | | | | | | | ormation | | | | | | +----------+----------+----------+----------+----------+----------+ | > Su | - | - | - | - | | | bscribed | | | | | | | > QoS | | | | | | | > Inf | | | | | | | ormation | | | | | | +----------+----------+----------+----------+----------+----------+ | > Au | - | - | - | - | | | thorized | | | | | | | > Sess | | | | | | | ion-AMBR | | | | | | +----------+----------+----------+----------+----------+----------+ | > Su | - | - | - | - | | | bscribed | | | | | | | > Sess | | | | | | | ion-AMBR | | | | | | +----------+----------+----------+----------+----------+----------+ | > PDU | - | - | - | - | | | > | | | | | | | session | | | | | | | > start | | | | | | | > Time | | | | | | +----------+----------+----------+----------+----------+----------+ | > PDU | - | - | - | - | | | > | | | | | | | session | | | | | | | > stop | | | | | | | > Time | | | | | | +----------+----------+----------+----------+----------+----------+ | > Dia | - | - | - | - | | | gnostics | | | | | | +----------+----------+----------+----------+----------+----------+ | > | - | - | - | - | | | Enhanced | | | | | | | > Dia | | | | | | | gnostics | | | | | | +----------+----------+----------+----------+----------+----------+ | > | - | - | - | - | | | Charging | | | | | | | > | | | | | | | Charact | | | | | | | eristics | | | | | | +----------+----------+----------+----------+----------+----------+ | > | - | - | - | - | | | Charging | | | | | | | > | | | | | | | Charact | | | | | | | eristics | | | | | | | > S | | | | | | | election | | | | | | | > Mode | | | | | | +----------+----------+----------+----------+----------+----------+ | > 3GPP | - | - | - | - | | | > PS | | | | | | | > Data | | | | | | | > Off | | | | | | | > Status | | | | | | +----------+----------+----------+----------+----------+----------+ | > | - | - | - | - | | | Session | | | | | | | > Stop | | | | | | | > I | | | | | | | ndicator | | | | | | +----------+----------+----------+----------+----------+----------+ | > R | - | - | - | - | | | edundant | | | | | | | > Tran | | | | | | | smission | | | | | | | > Type | | | | | | +----------+----------+----------+----------+----------+----------+ | > PDU | - | - | - | - | | | > | | | | | | | Session | | | | | | | > Pair | | | | | | | > ID | | | | | | +----------+----------+----------+----------+----------+----------+ | > 5G LAN | - | - | - | - | | | > Type | | | | | | | > | | | | | | | Service | | | | | | +----------+----------+----------+----------+----------+----------+ | Unit | IU-- | - | - | - | | | Count | | | | | | | In | | | | | | | activity | | | | | | | Timer | | | | | | +----------+----------+----------+----------+----------+----------+ | RAN | - | - | - | - | | | S | | | | | | | econdary | | | | | | | RAT | | | | | | | Usage | | | | | | | Report | | | | | | +----------+----------+----------+----------+----------+----------+ | Roaming | - | IU-- | - | IU-- | | | QBC | | | | | | | inf | | | | | | | ormation | | | | | | +----------+----------+----------+----------+----------+----------+ | Multiple | - | - | - | - | | | QFI | | | | | | | c | | | | | | | ontainer | | | | | | +----------+----------+----------+----------+----------+----------+ | UPF ID | - | - | - | - | | +----------+----------+----------+----------+----------+----------+ | Roaming | - | IU-- | - | IU-- | | | Charging | | | | | | | Profile | | | | | | +----------+----------+----------+----------+----------+----------+
### 6.2.3 Formal 5G data connectivity charging parameter description
#### 6.2.3.1 5G data connectivity CHF CDR parameters
The detailed definitions, abstract syntax and encoding of the PDU session
charging and Roaming QBC CHF CDRs parameters are specified in TS 32.298 [51].
#### 6.2.3.2 5G data connectivity resources attributes
The detailed definitions of resources attributes used for 5G data connectivity
charging are specified in TS 32.291 [58].
###### ## Annex A (normative): Charging Characteristics
# A.1 General
A subscriber may have Charging Characteristics assigned to his subscription
and/or his subscribed DNNs. Default Charging Characteristics may also be pre-
provisioned on the SMF.
During UE PDU session establishment, when the SMF retrieves subscription data
from the UDM, if a subscribed Charging Characteristics for the requested DNN
is identified, it may override the SMF pre-provisioned Charging
Characteristics.
The Charging Characteristics parameter consists of a string of 16 bits
designated as Behaviours (B), freely defined by Operators, as shown in TS
32.298 [51]. Each bit corresponds to a specific charging behaviour which is
configured on a per operator basis, and pointed when bit is set to \"1\"
value.
A charging behaviour is defined as an association to a specific usage design:
One usage may consist of a set of trigger profiles associated to the PDU
session in converged charging as described in the Table A.1 example:
Table A.1: Example of Charging Characteristics behaviours for SMF
|  |  | **PDU session charging** |  |  |  |  |  |  |   
---|---|---|---|---|---|---|---|---|---|---  
Behaviour index | Default charging method | PDU session charging method | Charging service | Primary and Secondary CHF addresses | Active | Time Limit Per PDU session | Vol Limit Per PDU session | Change Cond. Per PDU session | Tariff times | â€¦  
0 | Online | - | Converged charging | URI 1 URI 2 | Yes | 10 min | 1Mb | 2 | 0-7, 7-12 | ...  
1 | Offline | - | Converged charging | URI 1 URI 2 | Yes | 15 min | 5Mb | 3 | 0-24 | â€¦  
2 | Online | - | Converged charging | URI 1 URI 2 | Yes | 30 min | 2Mb | 2 | 0-7, 7-12 | ...  
3 |  | Offline only | Offline only charging | URI 1 URI 2 | Yes | 15 min | 1MB | -1 | -0-24 | ...  
4 | - | Offline only | Converged charging | URI 1 URI 2 | No | 15 min | 1MB | 1 | 0-24 | â€¦  
â€¦ | â€¦ |  |  | â€¦ | â€¦ | â€¦ | â€¦ | â€¦ | â€¦ | â€¦  
Associated to the behaviour, the following may also be configured:
\- the CHF addresses to be used by the SMF, optionaly with associated CHF
instance ID(s) and/or CHF set ID(s);
\- the \"Default charging method\" (online or offline) to be used as the
default one for every PCC rules of the PDU Session;
\- the PDU session charging method indicating whether the charging method for
the PDU session is \"offline only\".
\- charging service.
The \"Default charging method\",PDU session charging method and CHF addresses
with possible associated CHF instance ID(s) and/or CHF set ID(s) configured in
the applicable Charging Characteristics behaviour, are superseded by \"Default
charging method\", PDU session charging method and CHF addresses with possible
associated CHF instance ID(s) and/or CHF set ID(s) supplied by the PCF if any,
during SMF interaction with the PCF at PDU session establishment, as described
in TS 23.503 [202].
###### ## Annex B (normative): Interworking
# B.1 General
This clause specifies the EPS and 5GS interworking.
## B.2 Definition of charging information for interworking
## B.2.1 Data description for interworking with EPC
### B.2.1.1 Message contents
The Charging message as described in clause 6.1.1 shall apply to the PGW-C+SMF
for interworking with EPC scenario.
When UE is connected to PGW-C+SMF via EPC and interworking with 5GS is
supported, the information and mechanism included in clause 6.1.1 and TS
32.290[57] is supported.
### B.2.1.2 Ga message contents
### B.2.1.3 CDR description on the Bd interface
The CDR description defined in clause 6.1.3.2 with Roaming QBC information per
clause B.2.2.1.1 is used for interworking with EPC scenario.
## B.2.2 Interworking charging specific parameters
### B.2.2.1 Definition of Interworking charging information
#### B.2.2.1.1 Message content
The charging information defined in clause 6.2.1 is used for interworking with
EPC scenario.
The specific information used for PS charging when UE is connected to P-GW+SMF
via EPC is provided within the Charging Data Request message, as defined in
clause 6.1.1.2, with the following difference:
Table B.2.2.1.1-1: Charging Data Request message contents
+-------------------------+----------+----------------------------+ | Information Element | Category | Description | +-------------------------+----------+----------------------------+ | Roaming QBC information | O~C~ | This field holds the QBC | | | | information specific to | | | | 5GC interworking with EPC | | | | as defined in clause | | | | B.2.2.1.2. | | | | | | | | This field is applicable | | | | in both non-roaming and | | | | roaming Home Routed | | | | scenario. | +-------------------------+----------+----------------------------+
#### B.2.2.1.2 Roaming QBC information
Roaming QBC information specific to 5GC interworking with EPC when UE is
connected to P-GW+SMF via EPC is defined in table B.2.2.1.2-1:
Table B.2.2.1.2-1: Roaming QBC information
+---------------------------+----------+----------------------------+ | Information Element | Category | Description | +---------------------------+----------+----------------------------+ | MultipleQFIcontainer | O~C~ | This field holds the | | | | containers associated to a | | | | charging condition change | | | | on an IP-CAN bearer. This | | | | is included when triggers | | | | conditions are met (Qos | | | | change, tariff time change | | | | ...). | | | | | | | | It may have multiple | | | | occurences. | | | | | | | | This field is applicable | | | | for both non-roaming and | | | | roaming Home Routed | | | | scenario | +---------------------------+----------+----------------------------+ | Triggers | O~C~ | Described in table | | | | 6.2.1.4.1 | +---------------------------+----------+----------------------------+ | Trigger Timestamp | O~C~ | Described in table | | | | 6.2.1.4.1 | +---------------------------+----------+----------------------------+ | Uplink Volume | O~C~ | Described in table | | | | 6.2.1.4.1 | +---------------------------+----------+----------------------------+ | Downlink Volume | O~C~ | Described in table | | | | 6.2.1.4.1 | +---------------------------+----------+----------------------------+ | Local Sequence Number | O~C~ | Described in table | | | | 6.2.1.4.1 | +---------------------------+----------+----------------------------+ | QFI Container information | O~C~ | This field holds the data | | | | container information | | | | defined in clause | | | | B.2.2.1.3 | +---------------------------+----------+----------------------------+
#### B.2.2.1.3 QFI Container Information
QFI Container Information specific to 5GC interworking with EPC when UE is
connected to P-GW+SMF via EPC is defined in table B.2.2.1.3-1:
Table B.2.2.1.3-1: QFI Container Information
* * *
Information Element Category Description QoS Information O~C~ Described in
table 6.2.1.5.1 QoS Characteristics O~C~ Described in table 6.2.1.5.1 User
Location Information O~C~ Described in table 6.2.1.5.1 Presence Reporting Area
Information O~C~ Described in table 6.2.1.5.1 RAT Type O~C~ Described in table
6.2.1.5.1 Report Time M Described in table 6.2.1.5.1 3GPP PS Data Off Status
O~C~ Described in table 6.2.1.5.1 EPS bearer Charging Id O~M~ This field holds
the Charging Identifier associated to the bearer the QoS flow is mapped to.
Diagnostics O~M~ This field holds a more detailed reason for the release of
the IP-CAN bearer, when a single cause is applicable. Enhanced Diagnostics
O~C~ This field holds a more detailed reason for the release of the IP-CAN
bearer, when a set of causes is applicable.
* * *
### B.2.2.2 Detailed message format for Interworking charging
The message format defined in clause 6.2.2 is used for interworking with EPC
scenario.
The supported fields in table 6.2.2.1 for the converged charging message shall
apply to the P-GW+SMF for the applicable fields, with the difference that SMF
is replaced by P-GW+SMF.
The table B.2.2.2-1 describes the mapping between the Multiple QFI Container
Information Elements defined for interworking and Traffic data volumes CDR
parameters defined in 32.298 [51] for EPC.
Table B.2.2.2-1: MultipleQFI Container for Interworking mapping to EPC Traffic
data volumes
+----------------------+----------------------+----------------------+ | Information Element | Information Element | Corresponding to | | for 5G Data | for Interworking | 32.298 [51] | | connectivity | | | +----------------------+----------------------+----------------------+ | Multiple QFI | Yes | Traffic data volumes | | Container | | | +----------------------+----------------------+----------------------+ | > Triggers | Yes | > Change condition | +----------------------+----------------------+----------------------+ | > Trigger Timestamp | Yes | > Change Time | +----------------------+----------------------+----------------------+ | > Time | No | > \- | +----------------------+----------------------+----------------------+ | > Total Volume | No | > \- | +----------------------+----------------------+----------------------+ | > Uplink Volume | Yes | > Data Volume Uplink | +----------------------+----------------------+----------------------+ | > Downlink Volume | Yes | > Data Volume | | | | > Downlink | +----------------------+----------------------+----------------------+ | > Local Sequence | yes | > \- | | > Number | | | +----------------------+----------------------+----------------------+ | > QFI Container | Yes | > \- | | > Information | | | +----------------------+----------------------+----------------------+ | > QFI | No | > \- | +----------------------+----------------------+----------------------+ | > Time of First | No | > \- | | > Usage | | | +----------------------+----------------------+----------------------+ | > Time of Last Usage | No | > \- | +----------------------+----------------------+----------------------+ | > QoS Information | Yes | > EPC QoS | | | | > Information | +----------------------+----------------------+----------------------+ | > User Location | Yes | > User Location | | > Information | | > Information | +----------------------+----------------------+----------------------+ | > UE Time Zone | No | > \- | +----------------------+----------------------+----------------------+ | > Presence Reporting | Yes | > Presence Reporting | | > Area Information | | > Area Status | +----------------------+----------------------+----------------------+ | > RAT Type | Yes | > RAT Type | +----------------------+----------------------+----------------------+ | > Serving Network | No | > \- | | > Function ID | | | +----------------------+----------------------+----------------------+ | > 3GPP PS Data Off | yes | > 3GPP PS Data Off | | > Status | | > Status | +----------------------+----------------------+----------------------+ | - | > 3GPP Charging Id | > Charging Id | +----------------------+----------------------+----------------------+ | - | > Enhanced | > Enhanced | | | > Diagnostics | > Diagnostics | +----------------------+----------------------+----------------------+ | - | > Diagnostics | > Diagnostics | +----------------------+----------------------+----------------------+ | - | No | > UWAN User Location | | | | > Information | +----------------------+----------------------+----------------------+ | - | No | > User CSG | | | | > information | +----------------------+----------------------+----------------------+ | - | No | > Access | | | | > Availability | | | | > Change Reason | +----------------------+----------------------+----------------------+ | - | No | > Related Change of | | | | > Charging Condition | +----------------------+----------------------+----------------------+ | - | No | > CP CIoT EPS | | | | > optimisation | | | | > indicator | +----------------------+----------------------+----------------------+ | - | No | > Serving PLMN Rate | | | | > Control | +----------------------+----------------------+----------------------+
### B.2.2.3 Formal Interworking charging parameter description
The CHF CDR parameters and resources attributes defined in clause 6.2.3 is
used for interworking with EPC scenario.
###### ## Annex C (normative): Support of GERAN/UTRAN access
# C.1 General
This Annex specifies Nchf from SMF+PGW-C enhanced to support UE accessing the
network via GERAN/UTRAN.
# C.2 5G data connectivity charging principles and scenarios
## C.2.1 5G data connectivity charging principles
The 5G data connectivity charging principles as described in clause 5.1 shall
apply with the differences that SMF is replaced by SMF+PGW-C supporting
GERAN/UTRAN access, and only following clauses are applicable:
\- Clauses 5.1.1 to 5.1.9 except 5.1.6 and 5.1.5.3;
\- Clauses 5.1.11 to 5.1.12.
For GERAN/UTRAN access, the Charging Identifier of the PDU session will be
generated by SMF+PGW-C for the PDP Context.
## C.2.2 5G data connectivity converged online and offline charging scenarios
The 5G data connectivity converged online and offline charging scenarios as
described in clause 5.2 shall apply with the differences that SMF is replaced
by SMF+PGW-C supporting GERAN/UTRAN access, and only following clauses are
applicable:
\- Clauses 5.2.1.1 to 5.2.1.9 except 5.2.1.5;
\- Clauses 5.2.2.1 to 5.2.2.2.
In Table 5.2.1.4.1 and Table 5.2.1.6.1, only trigger conditions related to
GERAN/UTRAN access scenarios are applicable.
## C.2.3 CDR generation and transfer
Clause 5.2.3 shall apply, with the difference in trigger tables where only
triggers related to GERAN/UTRAN access scenarios are applicable.
Clauses 5.2.4 and 5.2.5 are applicable.
# C.3 Data description for 5G data connectivity charging
## C.3.1 Data description for support of GERAN/UTRAN access
### C.3.1.1 Message contents
The charging message as described in clause 6.1.1 shall apply to the SMF+PGW-C
to support GERAN/UTRAN access. The differences of charging message in clause
6.1.1 used for the SMF+PGW-C to support GERAN/UTRAN access are described as
following.
\- UPF ID is not applicable;
\- Multi-homed PDU address is not applicable;
\- PDU Session Charging Information is described in C.3.2.
### C.3.1.2 Ga message contents
The Ga message transfer as described in clause 5.2.4 shall apply to the
SMF+PGW-C to support GERAN/UTRAN access.
### C.3.1.3 CDR description on the B~d~ interface
The CDR description defined in clause 6.1.3 shall apply with the differences
that SMF is replaced by SMF+PGW-C supporting GERAN/UTRAN access, and the
following fields in table 6.1.3.2.1 are not applicable:
\- UPF ID;
\- Multi-homed PDU address.
## C.3.2 5G data connectivity charging specific parameters
### C.3.2.1 Definition of 5G data connectivity charging information
The charging information defined in clause 6.2.1 is used for the SMF+PGW-C to
support GERAN/UTRAN access.
The specific PDU session charging information when UE is connected to
SMF+P-GW-C via GERAN/UTRAN is provided as defined in table 6.2.1.2.1, with the
differences that PDU session is replaced by PDP context in fields description
and other differences described under following table C.3.2.1-1:
Table C.3.2.1-1: Structure of PDU Session Charging Information
+----------------------------+----------+----------------------------+ | Information Element | Category | Description | +----------------------------+----------+----------------------------+ | Charging Id | O~M~ | Described in table | | | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | Home Provided Charging Id | - | This field is not | | | | applicable. | +----------------------------+----------+----------------------------+ | User Information | O~M~ | Described in table | | | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | User Identifier | O~C~ | Described in table | | | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | User Equipment Info | O~C~ | Described in table | | | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | unauthenticatedFlag | O~C~ | Described in table | | | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | > Roamer In Out | O~C~ | Described in table | | | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | User Location Info | O~C~ | Described in table | | | | 6.2.1.2. | | | | | | | | The \"User Location | | | | Information\" (ULI) IE | | | | indicating CGI/SAI/RAI | | | | shall apply as described | | | | in clause 7.7.51 of TS | | | | 29.060 [x]. | +----------------------------+----------+----------------------------+ | MA PDU Non 3GPP User | - | This field is not | | Location info | | applicable. | +----------------------------+----------+----------------------------+ | User Location Time | O~C~ | Described in table | | | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | MA PDU Non 3GPP User | - | This field is not | | Location Time | | applicable. | +----------------------------+----------+----------------------------+ | UE Time Zone | O~C~ | Described in table | | | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | Presence Reporting Area | O~C~ | This field is not | | Information | | applicable.. | +----------------------------+----------+----------------------------+ | PDU Session Information | O~C~ | Described in table | | | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | > PDU Session ID | M | Described in table | | | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | > Network Slice Instance | - | This field is not | | > Identifier | | applicable. | +----------------------------+----------+----------------------------+ | PDU Type | O~M~ | Described in table | | | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | PDU Address | O~C~ | Described in table | | | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | > PDU Ipv4 Address | O~C~ | Described in table | | | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | > PDU IPv6 Address with | O~C~ | Described in table | | > Prefix | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | > PDU Address prefix | O~C~ | Described in table | | > length | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | > IPv4 Dynamic Address | O~C~ | Described in table | | > Flag | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | > IPv6 Dynamic Address | O~C~ | Described in table | | > Flag | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | > SSC Mode | - | This field is not | | | | applicable. | +----------------------------+----------+----------------------------+ | > MA PDU session | - | This field is not | | > information | | applicable. | +----------------------------+----------+----------------------------+ | > MA PDU session indicator | - | This field is not | | | | applicable. | +----------------------------+----------+----------------------------+ | > ATSSS capability | - | This field is not | | | | applicable. | +----------------------------+----------+----------------------------+ | > SUPI PLMN ID | O~C~- | Described in table | | | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | > Serving Network Function | O~C~ | Described in table | | > ID | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | > Serving Network Function | M | Described in table | | > Functionality | | 6.2.1.2. | | | | | | | | This field holds "SGSN" | | | | when SMF+PGW-C serves | | | | GERAN/UTRAN access. | +----------------------------+----------+----------------------------+ | > Serving Network Function | - | Described in table | | > Name | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | > Serving Network Function | O~C~ | Described in table | | > Addresses | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | > Serving Network Function | O~C~ | Described in table | | > FQDN | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | > Serving Network Function | O~C~ | Described in table | | > PLMN ID | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | > AMF Identifier | - | This field is not | | | | applicable. | +----------------------------+----------+----------------------------+ | Serving CN PLMN ID | O~C~ | Described in table | | | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | RAT Type | O~C~ | Described in table | | | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | > MA PDU Non 3GPP RAT Type | - | This field is not | | | | applicable. | +----------------------------+----------+----------------------------+ | > Data Network Name | M | Described in table | | > Identifier | | 6.2.1.2, with DNN replaced | | | | by APN. | +----------------------------+----------+----------------------------+ | > DNN Selection Mode | - | This field is not | | | | applicable. | +----------------------------+----------+----------------------------+ | > Authorized QoS | O~C~ | Described in table 6.2.1.2 | | > Information | | | | | | QoS information mapped | | | | according interaction with | | | | PCC as specified in clause | | | | 4.11.0a.2 of TS 23.502 | | | | [201] | +----------------------------+----------+----------------------------+ | > Subscribed QoS | O~C~ | Described in table 6.2.1.2 | | > Information | | | | | | QoS information mapped | | | | according interaction with | | | | PCC as specified in clause | | | | 4.11.0a.2 of TS 23.502 | | | | [201]. | +----------------------------+----------+----------------------------+ | Authorized Session-AMBR | O~C~ | Described in table | | | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | Subscribed Session-AMBR | O~C~ | Described in table | | | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | PDU session start Time | O~C~ | Described in table | | | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | PDU session stop Time | O~C~ | Described in table | | | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | Diagnostics | O~C~ | Described in table | | | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | Enhanced Diagnostics | O~C~ | Described in table | | | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | Charging Characteristics | O~C~ | Described in table | | | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | Charging Characteristics | O~C~ | Described in table | | | | 6.2.1.2. | | Selection Mode | | | +----------------------------+----------+----------------------------+ | 3GPP PS Data Off Status | O~C~ | Described in table | | | | 6.2.1.2. | +----------------------------+----------+----------------------------+ | Session Stop Indicator | - | This field is not | | | | applicable. | +----------------------------+----------+----------------------------+ | Redundant Transmission | - | This field is not | | | | applicable. | | Type | | | +----------------------------+----------+----------------------------+ | PDU Session pair ID | - | This field is not | | | | applicable. | +----------------------------+----------+----------------------------+ | Unit Count Inactivity | - | This field is not | | Timer | | applicable. | +----------------------------+----------+----------------------------+ | RAN Secondary RAT Usage | - | This field is not | | Report | | applicable. | +----------------------------+----------+----------------------------+
The specific PDU Container Information when UE is connected to SMF+P-GW-C via
GERAN/UTRAN is provided as defined in table 6.2.1.3.1, with the differences
described under following table C.3.2.1-2:
Table C.3.2.1-2: Structure of PDU Container Information
* * *
Information Element Category Description Time of First Usage O~C~ Described in
table 6.2.1.3.1. Time of Last Usage O~C~ Described in table 6.2.1.3.1. QoS
Information O~C~ Described in table 6.2.1.3.1. QoS Characteristics O~C~
Described in table 6.2.1.3.1. AF Charging Identifier O~C~ Described in table
6.2.1.3.1. AF Charging Id String O~C~ Described in table 6.2.1.3.1. User
Location Information O~C~ Described in table 6.2.1.3.1. UE Time Zone O~C~
Described in table 6.2.1.3.1. Presence Reporting Area Information O~C~
Described in table 6.2.1.3.1. Serving Network Function ID O~C~ Described in
table 6.2.1.3.1. RAT Type O~C~ Described in table 6.2.1.3.1. Sponsor Identity
O~C~ Described in table 6.2.1.3.1. Application Service Provider Identity O~C~
Described in table 6.2.1.3.1. Charging Rule Base Name O~C~ Described in table
6.2.1.3.1. 3GPP PS Data Off Status O~C~ Described in table 6.2.1.3.1. MA PDU
Steering functionality - This field is not applicable. MA PDU Steering mode -
This field is not applicable.
* * *
The specific Roaming QBC information is described in table B.2.2.1.2-1 and QFI
Container Information is described in table B.2.2.1.3-1 for when UE is
connected to SMF+P-GW via GERAN/UTRAN, with the differences that PDU session
is replaced by PDP context in fields description.
### C.3.2.2 Detailed message format for converged charging
The basic structure of supported fields in _Charging Data_ Request/Response
message defined in clause 6.2.2 shall apply for fields applicable when
SMF+PGW-C supports GERAN/UTRAN access.
### C.3.2.3 Formal 5G data connectivity charging parameter description
TheCHF CDR parameters and resources attributes defined in clause 6.2.3 shall
apply for fields applicable when SMF+PGW-C supports GERAN/UTRAN access.
###### ## Annex D (informative): Network slice charging based on 5G data
connectivity
# D.1 General
This clause describes how to realise Network Slice usage charging, when the
Network Slice is identified by an S-NSSAI (Single Network Slice Selection
Assistance Information), and the Network Slice usage is considered under 5G
data connectivity by individual UEs.
The existing Nchf capabilities exposed by CHF to SMF for individual UE 5G data
connectivity charging can be used for this purpose when the Mobile Network
Operator (MNO) serving the UE is also actingas the Network Slice (NS)
Tenant(s).
A given S-NSSAI can be Teneant specific or shared between multiple Tenants.
The MNO Converged Charging system encompasses both individual UEs and NS
Tenants(s).
Roaming scenarios are out of scope of this Annex, therefore unless otherwise
stated, references to clauses in this document refer to description applicable
for non-roaming scenarios only.
# D.2 Architecture
The 5G data connectivity domain converged charging architectures in clause 4.2
of this document apply, with the CHF hosted by Converged Charging system (CCS)
extended for Network Slice (NS) Tenant.
The single CCS or multiple CCSs may be used to support converged charging for
tenant and UEs belonging to the tenant at same time, which is implementation
specific, the interaction of CCS(s) are out of scope of this Annex.
# D.3 Network slice charging based on 5G data connectivity principles
## D.3.1 General
The MNO as the Netwok Slice (NS) Tenant, is assigned with one or more
S-NSSAI(s), each S-NSSAI identifying a Network Slice.
The 5G charging supports converged charging per PDU session based on assigned
group of S-NSSAI(s).
Converged Charging systems are deployed and configured by the MNO in order to
achieve Network slice charging per S-NSSAI. A given Converged charging system
can be configured to handle one or more S-NSSAI(s).
Individual UE, when subscribed to the MNO\'s particular S-NSSAI, is served by
the Converged Charging system allocated to this S-NSSAI, when this UE
establishes a PDU session under this S-NSSAI.
5G data connectivity charging performed for individual UE over Nchf exposed by
the CHF is used to perform Network Slice charging for the NS Tenant for a
particular S-NSSAI.
# D.4 Network slice charging based on 5G data connectivity scenarios
## D.4.1 Basic principles
### D.4.1.1 CHF selection
The CHF selection mechanism at PDU session establishment defined in clause
5.1.8 of this specification, allows the SMF to reach the CHF hosted by the
Converged Charging system serving the UE belongs to the particular S-NSSAI and
Tenant.
## D.4.2 Message flows
The message flows in clause 5.2.2 apply. The following figure provides a
simplified decription focusing on Network slice usage charging for a S-NSSAI.
Figure D.4.2-1: Network slice charging based on 5G data connectivity
1\. The SMF collects the charging information for PDU session.
2\. The SMF reports the PDU session information with S-NSSAI.
3\. CHF includes S-NSSAI in the CDR for the PDU session.
4\. CHF sends the charging data response.
# D.5 Definition of charging information
The definition of charging information in clause 6 is applicable for the
purpose of Network Slice charging based on 5G data connectivity.
The \"Network Slice Instance Identifier\" Information Element in subclause
6.2.1.2 Table 6.2.1.2.1: Structure of PDU Session Charging Information is the
key identifier S-NSSAI conveyed over Nchf and in CDRs on the Bd interface.
#
# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope {#scope-1}
The present document studies on charging aspects of Proximity-based Services
in 5GS based on TS 23.304 [11].
The charging aspects related to the Proximity-based Services in 5GS are
covered within the scope:
\- Charging architecture, for supporting charging of ProSe Direct Discovery
and Direct Communication related to Public Safety and commercial proximity
service.
\- Charging principles, scenarios and potential requirements related to the
ProSe service in 5GS.
\- Potential charging solutions for the Proximity-based Services in 5GS.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.287: \"Architecture enhancements for 5G System (5GS) to support
Vehicle-to-Everything (V2X) services\".
[3] 3GPP TR 23.752: "Study on system enhancement for Proximity based Services
(ProSe) in the 5G System (5GS)".
[4] 3GPP TS 32.277: \"Proximity-based Services (ProSe) charging\".
[5] 3GPP TS 32.240: \"Telecommunication management; Charging management;
Charging architecture and principles \".
[6] 3GPP TS 32.290: \"Telecommunication management; Charging management; 5G
system; Services, operations and procedures of charging using Service Based
Interface (SBI)\"
[7] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[8] 3GPP TS 23.303: \"Proximity-based services (ProSe); Stage 2\".
[9] 3GPP TS 22.115: \"Service aspects; Charging and billing\".
[10] 3GPP TS 28.201: \"Charging management; Network slice performance and
analytics charging in the 5G System (5GS); Stage 2\".
[11] 3GPP TS 23.304: \"Proximity based Services (ProSe) in the 5G System
(5GS)\".
# 3 Definitions of terms, symbols and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in 3GPP TR 21.905
[1] and the following apply. A term defined in the present document takes
precedence over the definition of the same term, if any, in 3GPP TR 21.905
[1].
**5G ProSe Direct Discovery:** A procedure employed by a ProSe-enabled UE to
discover other ProSe-enabled UEs in its vicinity by using only the
capabilities of the two UEs with NR technology. See 3GPP TS 23.304 [11].
**5G ProSe Direct Communication:** A communication between two or more UEs in
proximity that are ProSe-enabled, by means of user plane transmission using NR
technology via a path not traversing any network node. See 3GPP TR TS 23.304
[11].
**5G ProSe UE-to-Network Relay:** A UE that provides functionality to support
connectivity to the network for Remote UE(s). See 3GPP TS 23.304 [11].
**Remote UE:** A 5G ProSe-enabled UE that communicates with a DN via a 5G
ProSe UE-to-Network Relay. See 3GPP TS 23.304 [11].
## 3.2 Symbols
Void.
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
5GS 5G System
CDR Charging Data Record
CHF Charging Function
CTF (AMC) Charging Trigger Function (Accounting Metrics Collection)
CTF (ADF) Charging Trigger Function (Accounting Data Forwarding)
DDNMF Direct Discovery Name Management Function
ProSe Proximity-based Services
PFI PC5 QoS Flow Identifier
PQI PC5 5QI
# 4 Concepts and overview
Proximity-based Services (ProSe) are services that can be provided by the 3GPP
system based on UEs being in proximity to each other. Proximity-based Services
has been developed in EPS to support both commercial and public safety
services. Proximity Services (specifically the direct communication) has been
enhanced to support V2X services over LTE.
In 5GS, the 3GPP system enablers for ProSe include the following functions:
\- Direct Discovery;
\- Direct Communication;
\- UE-to-Network Relay;
The present document aims to describe the converged charging for the
Proximity-based Services (ProSe) in 5GS, based on the stage 2 description of
ProSe in TS 23.303 [8].
As indicated in TS 32.277 [4], the offline and online charging description for
the Proximity-based Services was specified based on EPS system, including the
support of charging support of ProSe Direct Discovery, one-to-many Direct
Communication, and one-to-one Direct Communication including UE-to-Network
Relay (for public safety use), and EPC based discovery.
When mapped to 5GS, the study will focus on how to accommodate charging ProSe
Direct Discovery and Direct Communication over NR based PC5 for commercial
services and public safety based on the 5G service-based architecture.
# 5 Architecture considerations
## 5.1 High level ProSe architecture
The scope of the present document is Proximity-based Service charging in 5GS,
related to architecture reference as follows:
\- Architecture reference model defined in TS 23.501 [7] are used as basis
architecture for supporting ProSe in 5GS.
\- Architecture reference models defined in TS 23.304 [11] are used as
reference architecture for supporting ProSe in 5GS.
## 5.2 Potential converged charging architectures for ProSe
### 5.2.1 General
The converged charging architectures for ProSe in 5GS should support charging
for the following services:
\- ProSe Direct Discovery, including ProSe open Direct Discovery and
restricted Direct Discovery, and
\- ProSe UE-to-Network Relay Discovery, and
\- ProSe Direct communication, including Broadcast and Groupcast Direct
Communication and Unicast Direct Communication, and
\- ProSe Direct Communication via ProSe UE-to-Network Relay.
Details on the interfaces and functions can be found in TS 32.240 [5] for the
general architecture components Nchf is described in TS 32.290 [6].
### 5.2.2 ProSe Direct Discovery converged charging architecture
Figure 6.1.4.1.2-1 and Figure 6.1.4.1.2-2 illustrates the options architecture
for converged charging architecture for the ProSe Direct Discovery, including
ProSe UE-to-Network Relay Discovery.
### 5.2.3 ProSe Direct Communication converged charging architecture
Figure 6.2.4.1.2-1 and Figure 6.2.4.1.2-2 illustrates the options architecture
for converged charging architecture for the ProSe Direct Communication,
including ProSe Direct Communication via ProSe UE-to-Network Relay.
# 6 Charging scenarios and key issues
## 6.1 Scenario 1: 5GS charging for ProSe Direct Discovery
### 6.1.1 General description and assumptions
5G ProSe Direct Discovery is defined as a procedure employed by a ProSe-
enabled UE to discover other ProSe-enabled UEs in its vicinity by using only
the capabilities of the two UEs with NR technology.
There are two types of 5G ProSe Direct Discovery: open and restricted. Open is
the case where there is no explicit permission that is needed from the UE
being discovered, whereas restricted discovery only takes place with explicit
permission from the UE that is being discovered.
There are two models for 5G ProSe Direct Discovery: Model A and Model B. For
discovery procedure over NR based PC5 for commercial services and public
safety in 5GS, the definition for Model A and Model B is re-used as defined in
clause 5.3.1.2 of TS 23.303 [8].
For dynamic ProSe Direct Discovery, 5G DDNMF in the 5GS is used for ProSe
Discovery Code management (including allocation, and resolution). The
architecture defined in TS 23.304 [11] will be adopted as the reference
architecture, and reuse the PC3 procedures defined in TS 23.303 [8] clause 5.3
for UE and 5G DDNMF interactions. When 5G DDNMF successfully response to
different Discovery Request and Discovery Report message, the Charging Data
Request [Event] may be generated and forward them to CHF.
For ProSe Direct Discovery over PC5, PC5 communication channel is used to
carry the discovery message over PC5 and discovery message over PC5 is
differentiated with other PC5 messages by AS layer. When the UE decides that
reporting criteria are met, according to the pre-configuration, the UE creates
the corresponding usage information report and forward to 5G Network.
### 6.1.2 Potential charging requirements
The following are potential high-level charging requirements for ProSe
services in 5GS, derived from the requirements in TS 22.115 [9], and TS 23.303
[8].
**REQ-CH_PROSE_5GS_DD-01:** The 5GS should support converged charging and
charging information reporting for ProSe Discovery including:
\- ProSe open Direct Discovery Model A;
\- ProSe restricted Direct Discovery Model A and Model B;
\- ProSe open and restricted Direct Discovery for Announce;
\- ProSe open and restricted Direct Discovery for Monitor;
\- ProSe open and restricted Direct Discovery for Match;
\- ProSe Direct Discovery over NR PC5, including UE-to-Network Relay.
**REQ-CH_ PROSE _5GS_DD -02** : The 5GS should support identifying chargeable
events and collecting charging information from UE.
**REQ-CH_ PROSE _5GS_DD -03** : The 5GS should support identifying chargeable
events and collecting charging information via 5G ProSe service.
### 6.1.3 Key issues
#### 6.1.3.1 Key issue #1.1: Converged charging for ProSe Direct Discovery
This key issue is for investigating how to support converged charging for
ProSe Direct Discovery considering REQ-CH_PROSE_5GS_DD -01, **REQ-
CH_PROSE_5GS_DD-02 and REQ-CH_PROSE_5GS_DD-03**.
This investigation covers the following:
\- determination of which entity/entities in the 5G system are suitable to
provide the charging information for ProSe Direct Discovery;
\- identification of the triggers for charging events for Prose Direct
Discovery with or without network control.
\- determination of the behaviour with respect to the chargeable events, the
matching charging events, and the charging information elements forwarded
towards the CHF.
### 6.1.4 Possible solutions
#### 6.1.4.1 Solution #1.1: ProSe Direct Discovery charging with 5G DDNMF
##### 6.1.4.1.1 Consideration for ProSe Direct Discovery charging with 5G
DDNMF
ProSe Direct Discovery is defined as the process that detects and identifies
another UE in proximity using NR radio signals. There are two types of ProSe
Direct Discovery supported over PC3a reference point: open and restricted, as
defined in TS 23.303 [8]. ProSe Direct Discovery can be a standalone service
or can be used for subsequent actions e.g. to initiate ProSe Direct
Communication.
5G DDNMF is defined to manage the dynamic ProSe Direct Discovery.
Functionalities of the 5G DDNMF and the interactions with the UEs are defined
in TS 23.304 [11].
The ProSe Direct Discovery with 5G DDNMF procedures could be divided into
Discovery Request procedure and Discovery Reporting procedure, both could
support Model A, and Model B. The exact signalling procedures are defined in
TS 23.303 [8] clause 5.3.3.
The Charging Enablement Function (CEF) is defined in TS 28.201 [10], for ProSe
converged charging the CEF could be a consumer of NF service provider for
ProSe (e.g.,5G DDNMF) and charging (Nchf) service provider.
The charging information on the use of ProSe Direct Discovery is collected by
the 5G DDNMF in HPLMN, VPLMN, and local PLMNs.
The 5GS may collect the following minimum charging information:
Table 6.1.4.1.1-1: Structure of the ProSe Discovery Information
Information Element Description
* * *
UE identity The identity of the ProSe UE Serving PLMN ID PLMN identity of the
serving PLMN which signalled the carrier frequency Announcing PLMN ID This
field holds PLMN identity of PLMN for UE to be monitored in monitor/match
report procedure Monitored PLMN ID This field holds PLMN identity of PLMN for
UE requested to be monitored in monitor/match report procedure ProSe
Application ID The identities used for ProSe Direct Discovery, identifying
application related information for the ProSe-enabled UE Application ID A
globally unique identifier identifying a specific 3rd party application Direct
Discovery Model Model of the Direct Discovery used by the UE, e.g. Model A, or
Model B. ProSe Event Type This IE holds the event which triggers the charging
message delivery, e.g. Announce, Monitor, Match Report ProSe Request Timestamp
The time when ProSe Request is received from UE. PC5 Radio Technology The PC5
radio technology used by UE for ProSe Direct Discovery
##### 6.1.4.1.2 Architecture Description
A set of trigger conditions are defined for the 5G DDNMF (CTF) or CEF to
invoke a Charging Data Request [Event] towards the CHF.
The converged charging architecture is proposed for the event based charging
for 5GS ProSe under the alternativesï¼š
\- Charging Trigger Function (CTF) based, as depicted in figure 6.1.4.1.2-1.
\- Charging Enablement Function (CEF) based, depicted in figure 6.1.4.1.2-2.
Figure 6.1.4.1.2-1: The Converged Charging System (CTF)
Figure 6.1.4.1.2-2: The Converged Charging System (CEF)
##### 6.1.4.1.3 Flow Description
###### 6.1.4.1.3.1-a Message flows for ProSe Direct Discovery Request - CTF
Figure 6.1.4.1.3.1-a-1: Message flow for ProSe Direct Discovery Request \- CTF
(non-roaming)
The detailed description for the message flow as defined in TS 23.304[11]
clause 6.3.1.4 and TS 23.303 [8] clause 5.3.4.
> 1-2. These steps are the same as the ProSe Direct Discovery will be defined
> in TS 23. 304 [11]. The Direct Discovery Request could be with command
> (Announce request, Monitor request, Discoverer request, Discoveree Request).
>
> 3\. The 5G DDNMF responds with a Discovery Response with:
\- (ProSe Application Code, validity timer, PC5_tech) for open discovery.
\- (ProSe Application Code, ProSe Restricted Code/ ProSe Restricted Code
Prefix[ProSe Restricted Code Suffix pool], validity timer, Discovery Entry ID,
PC5_tech) for restricted discovery.
3a. The 5G DDNMF triggers Charging Data Request[Event] to CHF in HPLMN where
event represents Announce. The PF-DD-CDR is generated by CHF for Announcing
UE.
3b. The CHF creates a CDR for this Announcing UE.
> 3c. The CHF returns Charging Data Response corresponding to the received
> Charging Data Request[Event].
NOTE: Roaming/inter-PLMN procedures are similar to that procedures as defined
in TS 32.277 [4] clause 5.2.2.1.
###### 6.1.4.1.3.1-b Message flows for ProSe Direct Discovery Reporting -- CTF
The Direct Discovery Reporting procedure can be used by the \"monitoring UE\"
(in Model A) and Discoverer UE (in Model B) to request the 5G DDNMF to resolve
a matched ProSe Discovery Code(s), for both open discovery and restricted
discovery.
The message flows for ProSe Direct Discovery Reporting could re-use the
procedures as defined in TS 32.277 [4] clause 5.2.2.1, with the following
modification:
\- the 5G DDNMF takes the role of \"ProSe Function\" in the procedure;
\- the HSS is replaced by PCF/UDM;
\- corresponding 5GS identifiers replace the EPS identifiers, e.g. use SUPI
instead of IMSI, and use GPSI instead of MSISDN;
\- PC5_tech parameter is omitted and the intended PC5 radio technology is NR.
###### 6.1.4.1.3.2-a Message flows for ProSe Direct Discovery Request - CEF
{width="6.69375in" height="5.307638888888889in"}
Figure 6.1.4.1.3.2-a-1: CEF-Message flow for ProSe Direct Discovery Request
(non-roaming)
> 1\. Determination by CEF to subscribe to ProSe Direct Discovery Service.
2\. Subscribe Request: the CEF subscribes to 5G DDNMF.
> 3-5. These steps are the same as the ProSe Direct Discovery will be defined
> in TS 23.304[11]. The Direct Discovery Request could be with command
> (Announce request, Monitor request, Discoverer request, Discoveree Request).
>
> 6\. Notification: DDNMF notifies the CEF that ProSe Direct Discovery message
> has been processed.
>
> 7\. Notification Acknowledge sent by the CEF.
>
> 8-a. The CEF sends Charging Data Request [Event] to CHF associated to the
> event represents Discovery Request.
>
> 8-b. The CHF creates a CDR.
>
> 8-c. The CHF acknowledges by sending Charging Data Response to the CEF.
###### 6.1.4.1.3.2-b Message flows for ProSe Direct Discovery Reporting -- CEF
The message flows could re-use the CEF subscription/notification procedure and
Charging Data Request procedure as described in 6.1.4.1.3.2-a.
#### 6.1.4.2 Solution #1.2: Charging for ProSe Direct Discovery over PC5
reference point
##### 6.1.4.2.1 Consideration for ProSe Direct Discovery charging over PC5
reference point
A PC5 communication channel is used to carry the discovery message over PC5
and the discovery message over PC5 is differentiated from other PC5 messages
by AS layer.
Both Model A and Model B discovery as defined in TS 23.303 [8] are supported:
\- Model A uses a single discovery protocol message (Announcement).
\- Model B uses two discovery protocol messages (Solicitation and Response).
5G DDNMF is defined to manage the dynamic ProSe Direct Discovery.
Functionalities of the 5G DDNMF and the interactions with the UEs are defined
in TS 23.304 [11].
The Charging Enablement Function (CEF) is defined in TS 28.201 [10], for ProSe
converged charging the CEF could be a consumer of NF service provider for
ProSe (e.g., 5G DDNMF Service) and charging (Nchf) service provider.
The charging information should be collected by UEs when ProSe Direct
Discovery over PC5 reference point, both Group Member Discovery and UE-to-
Network Relay Discovery are applicable to public safety use and commercial
services as defined in TS23.304 [11] clause 6.3.2.
When the UE decides that reporting criteria are met, according to the pre-
configuration, the UE creates the corresponding usage information report to
NF(CTF) over PC3ch or to ProSe UE-to-Network Relay UE. If the UE is out of
coverage of NR and has no connection to the 5G network, the usage information
is stored in a secure environment in the UE, it will trigger the reporting
when UE comes back to NR coverage, as described in TS 32.277 [4].
Besides the information list in Table 6.1.4.1.1-1, the 5GS may collect the
following charging information:
Table 6.1.4.2.1-1: Structure of the ProSe Discovery Information
Information Element Description
* * *
User Location Information The location of the UE UE identity The identity of
the ProSe UE Serving PLMN ID PLMN identity of the PLMN which signalled the
carrier frequency ProSe Relay UE ID A link layer identifier that uniquely
represents the ProSe UE-to-Network Relay UE ProSe Target Layer-2 ID The
identifier of target UE, uniquely represents a specific one-to-one or one-to-
many discovery/communication ProSe Group IP multicast address The IP multicast
address to be used for performing ProSe direct discovery/communication.
Coverage Info This IE provides information on the coverage status (i.e.,
whether the UE is served by NG-RAN or not) and the time when the coverage
status changed to its current state. Radio Resources indicator This IE
identifies whether the operator-provided radio resources or the configured
radio resources were used for ProSe direct discovery/communication. Usage Data
Container This field holds the container associated to a trigger conditions
(e.g. go out of coverage, come back to coverage, etc.) on a specific ProSe
communication.
##### 6.1.4.2.2 Architecture Description
Regarding the PC5 usage reporting from the UE, the CTF is divided into two
functional blocks as described in Annex D of TS 32.240 [5]. The Accounting
Metrics Collection (AMC) function block is in the UE. The AMC sends usage
information collected to the Accounting Data Forwarding (ADF) function block.
Upon reception of the event, CTF(ADF) or CEF could generate Charging Data
Request [Event] and forward them to CHF.
The converged charging architecture is proposed for the event based charging
for 5GS ProSe under the alternatives:
\- Charging Trigger Function (CTF) based, as depicted in figure 6.1.4.2.2-1.
\- Charging Enablement Function (CEF) based, depicted in figure 6.1.4.2.2-2.
Figure 6.1.4.2.2-1: The Converged Charging System (CTF)
Figure 6.1.4.2.2-2: The Converged Charging System (CEF)
##### 6.1.4.2.3 Flow Description
###### 6.1.4.2.3.1 Message flows for ProSe Direct Discovery over PC5 charging
CTF
Figure 6.1.4.2.3.1-1: Message flow for ProSe Direct Discovery over PC5
charging - CTF (non-roaming)
1\. UE-1 sends announcement message with model A or solicitation message with
model B. In the latter case, UE 2 sends a response message.
NOTE 1: In procedure for UE-to-Network Relay Discovery, the Remote UE and UE-
to-Network Relay UE will perform UE-to-Network Relay UE discovery and
selection (see TS 23.304 [11] clause 6.2.3.2).
2\. When the UE-1 decides that reporting criteria are met, according to the
pre-configuration, the UE creates the corresponding usage information report.
3\. UE-1 triggers the usage reporting procedure by sending the usage
information report to the CTF located in ProSe NF (e.g., 5G-DDNFM).
NOTE 2: Both UE-1, UE2 or other UEs can decide that reporting criteria are met
and trigger the usage reporting procedure.
4ch-a. The 5G NF (CTF) triggers Charging Data Request[Event] to CHF in HPLMN.
4ch-b. The CHF creates a CDR for this UE.
> 4ch-c. The CHF returns Charging Data Response.
###### 6.1.4.2.3.2 Message flows with CEF
The message flows with CEF could re-use the CEF subscription/notification
procedure and Charging Data Request procedure as described in 6.1.4.1.3.2.
### 6.1.5 Evaluation
This clause evaluates the solutions for KI#1.1 as following.
For 5G ProSe Direct Discovery charging with 5G DDNMF:
\- Solution #1.1 proposed to use 5G DDNMF to collect the charging information.
Both 5G DDNMF or CEF could be consumer of Nchf charging services provide by
CHF.
\- The ProSe Direct Discovery with 5G DDNMF procedures could be divided into
Discovery Request procedure and Discovery Reporting procedure, both could
support Model A and Model B. The trigger conditions could be Direct Discovery
Request with command (Announce request, Monitor request, Discoverer request,
Discoveree Request), and Direct Discovery Reporting with Match Report.
\- The charging information in ProSe Direct Discovery with 5G DDNMF are
captured in this solution when a UE performs ProSe Direct Discovery, including
Announcing Request, Monitoring Request, and Match Report.
For 5G ProSe Direct Discovery over PC5 reference point:
\- Solution #1.2 proposed to utilize the distributed CTF for 5G ProSe Direct
Discovery over PC5 reference point. CTF is split into UE (AMC) and 5G DDNMF
(ADF), the 5G ProSe enabled UE sends usage information to 5G DDNMF via PC3ch,
then 5G DDNMF(ADF) sends the events directly to the CHF.
\- The charging information in ProSe Direct Discovery PC5 reference point are
captured in this solution for both Model A and Model B, including Group Member
Discovery and UE-to-Network Relay Discovery.
NOTE 1: In procedure for UE-to-Network Relay Discovery, the Remote UE and UE-
to-Network Relay UE will perform UE-to-Network Relay UE discovery and
selection.
For ProSe converged charging, the CEF could be a consumer of 5GDDNMF and CHF
which provide charging (Nchf) service.
### 6.1.6 Conclusion
Based on the evaluation in clause 6.1.5,
\- **Solution #1.1** is the feasible and solution for 5G ProSe Direct
Discovery charging with 5G DDNMF.
\- **Solution #1.2** is the feasible and solution for 5G ProSe Direct
Discovery over PC5 reference point, including ProSe UE-to-Network Relay
Discovery.
## 6.2 Scenario 2: 5GS charging for ProSe Direct Communication
### 6.2.1 General description and assumptions
5G ProSe Direct Communication is defined as a communication between two or
more UEs in proximity that are ProSe-enabled, by means of user plane
transmission using NR technology via a path not traversing any network node.
5G ProSe Direct Communication over NR based PC5 reference point supports
broadcast mode, groupcast mode, and unicast mode. Each communication mode is
supported when the UE is served by NR and when the UE is outside of NR
coverage.
5G ProSe Direct Communication supports both the case of public safety and
commercial service.
5G ProSe Direct Communication supports both event based and session based
charging;
To perform ProSe direct communication over PC5 reference point, the UE is
configured with the related information as described in TS 23.304 [11] clause
5.1.3. The procedures for service authorization and provisioning to UE may be
initiated by the PCF, by the UE, or by the AF, as defined in TS 23.304 [11]
clause 6.2, the parameters could be provided/updated by ProSe Application
Server or PCF, provisioned in the ME or configured in the UICC.
The 5GS could re-use the Service authorization and provisioning mechanism, and
the UE could be configured with information to be included in the usage
information report.
### 6.2.2 Potential charging requirements
The following are potential high-level charging requirements for ProSe
services in 5GS, derived from the requirements in TS 22.115 [9], and TS 23.303
[8].
**REQ-CH_ PROSE _5GS_DC -01:** The 5GS should support converged charging and
charging information reporting for ProSe Communication including:
\- ProSe Broadcast modeDirect Communication;
\- ProSe Groupcast mode Direct Communication;
\- ProSe Unicast Direct Communication, including UE-to-Network Relay.
**REQ-CH_ PROSE _5GS_DC - 02** : The 5GS should support identifying chargeable
events and collecting charging information from UE.
**REQ-CH_ PROSE _5GS_DC - 03** : The 5GS should support identifying chargeable
events and collecting charging information via 5G ProSe service.
**REQ-CH_ PROSE _5GS_DC - 04** : The 5GS should support charging for PDU
Session types of IP, Ethernet and Unstructured.
**REQ-CH_ PROSE _5GS_DC - 05** : In 5G ProSe UE-to-Network Relay scenario, the
5GS should support charging for both Layer-2 and Layer-3 UE-to-Network Relay.
### 6.2.3 Key issues
#### 6.2.3.1 Key issue #2.1: Converged charging for ProSe Direct Communication
This key issue is for investigating how to support converged charging for
ProSe Direct Communication considering **REQ-CH_PROSE_5GS_DC-01**.
This investigation covers the following:
\- determination of which entity/entities in the 5G system are suitable to
provide the charging information for ProSe Direct Communication;
\- identification of the triggers for charging events or event based charging
and session based charging.
\- determination of the behaviour with respect to the chargeable events, the
matching charging events, and the charging information elements.
### 6.2.4 Possible solutions
#### 6.2.4.1 Solution #2.1: ProSe unicast mode of Direct Communication event-
based charging for Key issues #2.1
##### 6.2.4.1.1 Consideration for ProSe unicast mode of Direct Communication
charging
This reporting is achieved by sending Charging Data Request to the CHF from
the ProSe related CTF or CEF.
When the CTF (AMC) in the UE decides that reporting criteria are met and the
UE have network connection, the CTF (AMC) sends the collected usage
information to the CTF (ADF).
When the CTF (ADF) receives usage information from the CTF (AMC) it triggers a
charging data request for the unicast (one-to-one) mode communication over
PC3ch.
The CTF(ADF) goes through the reported usage information, and if it contains
valid ProSe Direct Communication usage data for the unicast mode
communication, then sends the events directly to the CHF or through a CEF.
The CHF may then, triggers the generation of the CDR for the unicast mode
communication.
The 5GS may collect the charging information for ProSe Direct communication
from following table:
Table 6.2.4.1.1-1: Structure of the ProSe direct communication charging
Information
Information Element Description
* * *
User Location Information The location of the UE UE identity The identity of
the ProSe UE Serving PLMN ID PLMN identity of the PLMN which signalled the
carrier frequency ProSe Target Layer-2 ID The identifier of target UE,
uniquely represents a specific one-to-one one-to-many, or relay
discovery/communication Coverage Info This IE provides information on the
coverage status (i.e., whether the UE is served by NG-RAN or not) and the time
when the coverage status changed to its current state. Radio Resources
indicator This IE identifies whether the operator-provided radio resources or
the configured radio resources were used for ProSe direct
discovery/communication Usage Data Container This field holds the container
associated to a trigger conditions (e.g. go out of coverage, come back to
coverage, etc.) on a specific ProSe communication
##### 6.2.4.1.2 Architecture Description
Trigger conditions are defined for the CTF or CEF to invoke a Charging Data
Request [Event] towards the CHF.
The converged charging architecture is proposed for the event based charging
for 5GS ProSe under the alternativesï¼š
\- Charging Trigger Function (CTF) based, as depicted in figure 6.2.4.1.2-1.
\- Charging Enablement Function (CEF) based, depicted in figure 6.2.4.1.2-2.
Figure 6.2.4.1.2-1: ProSe converged charging architecture (CTF)
Figure 6.2.4.1.2-2: ProSe converged charging architecture (CEF)
##### 6.2.4.1.3 Flow Description
###### 6.2.4.1.3.1 Message flows with CTF -- PEC
Figure 6.2.4.1.3.1-1: Message flow for ProSe Direct Communication (event
based)
> 1\. UE-1 sends a Direct Communication Request message to UE-2 in order to
> trigger mutual authentication.
2-3. UE-2 initiates the procedure for mutual authentication. The successful
completion of the authentication procedure completes the establishment of the
secure layer-2 link over PC5 and then UE performs unicast mode Direct
Communication.
4\. UE-1 sends a Disconnect Request message to UE-2 in order to release the
layer-2 link and deletes all context data associated with.
5\. Upon reception of the Disconnect Request message UE-2 responds with a
Disconnect Response message and deletes all context data associated with the
layer-2 link.
6\. When the UE-1 decides that reporting criteria are met, according to the
pre-configuration, the UE creates the corresponding usage information report.
NOTE 1: Both UE-1 and UE-2 can decide that reporting criteria are met and
trigger the usage reporting procedure.
7\. Upon reception of the Disconnect Response from UE-2, the UE-1 triggers the
usage reporting procedure. UE-1 sends the usage information report to the
CTF(ADF).
8ch-a. Upon reception of Direct Communication usage information report, the
CTF(ADF) triggers the Charging Data Request[Event].The CTF(ADF) sends Charging
Data Request [Event] to CHF.
8ch-b. The ProSe unicast mode Direct Communication CDR is generated by CHF for
the UE-1 and UE-2.
8ch-c. The CHF acknowledges by sending Charging Data Response [Event] to the
CTF(ADF).
NOTE 2: The procedure applies to UE1 to UE2 independently, i.e. each of the UE
sends the respective usage information reports to the network using either the
under coverage procedure or out of coverage procedure.
###### 6.2.4.1.3.2 Message flows with CEF -- PEC
Figure 6.2.4.1.3.2-1: CEF-Message flow for ProSe Direct Communication (event
based)
> 1\. Determination by CEF to subscribe to ProSe Service provider which is
> able to handle usage information report from the UE.
2\. Subscribe Request: the CEF subscribes to ProSe Service provider.
3\. Subscribe Request: the ProSe Service Producer sends successful
subscription response.
> 4-10. These steps are the same as procedure described in Figure
> 6.2.4.1.3.1-1.
>
> 11\. Notification: ProSe Service provider notifies the CEF that usage
> information report has been processed.
>
> 12\. Notification Acknowledge sent by the CEF.
>
> 13ch-a. The CEF sends Charging Data Request [Event] to CHF.
>
> 13ch-b. The CHF creates a CDR.
>
> 13ch-c The CHF acknowledges by sending Charging Data Response to the CEF.
#### 6.2.4.2 Solution #2.2: ProSe unicast mode of Direct Communication
session-based charging for Key issues #2.1
##### 6.2.4.2.1 Consideration for ProSe unicast mode of Direct Communication
session-based charging
The 5G ProSe charging service may be configured to use session based charging
in order to reduce the number of CDRs generated.
The CTF (ADF) or CEF generates charging data related to the service delivered
that is based on a trigger for usage reporting is met.
The Charging Data Request[Initial] is sent when the ProSe CTF (ADF) receives a
Received Direct Communication Usage Report event, and there is no open
charging session for the group communication and unicast communication
including the UE-Network-relay
The Charging Data Request[Update] is sent when the ProSe CTF (ADF) receives a
Received Direct Communication Usage Report event, and there is an open
charging session for the group communication and unicast communication
including the UE-Network-relay.
The Charging Data Request [Termination] is sent when the ProSe service
provider decides one of the following conditions is met:
\- operator configured maximum number of reports; or
\- operator configured maximum time limit.
##### 6.2.4.2.2 Architecture Description
See clause 6.2.4.1.2.
##### 6.2.4.2.3 Flow Description
###### 6.2.4.2.3.1 Message flows with CTF -- SCUR
Figure 6.2.4.2.3.1-1: Message flow for ProSe Direct Communication (session
based)
1-3. These steps are the same as described in figure 6.2.4.1.3.1-1.
4\. When the UE decides that reporting criteria are met, according to the pre-
configuration, the UE creates the corresponding usage information report. UE
triggers the usage reporting procedure.
5\. UE sends the usage information report to the CTF located in ProSe NF
(e.g., 5G-DDNFM)..
6ch-a. The NF (CTF) determines the number of units depending on the service
requested by the UE, and sends the Charging Data Request[Initial] to the CHF
when there is no open charging session.
6ch-b. Based on policies, the CHF opens a CDR related to the service.
> 6ch-c. The CHF grants authorization to NF (CTF) for the service to start,
> and returns Charging Data Response.
7\. UE triggers the usage reporting procedure when the reporting criteria are
met.
NOTE 1: Both UE-1 and UE-2 can decide that reporting criteria are met and
trigger the usage reporting procedure.
8\. UE sends the usage information report to the ProSe NF (CTF).
9ch-a. If there is a charging session for the session of unicast mode direct
communication, upon reception of direct communication usage information report
for the session, the NF (CTF) triggers the Charging Data Request[Update]. The
NF (CTF) sends the Charging Data Request[Update] to the corresponding CHF.
9ch-b. The CDR for the ProSe unicast Direct Communication is updated by CHF
for the UE.
9ch-c. The CHF returns Charging Data Response corresponding to the received
Charging Data Request.
NOTE 2: The Step 9ch-a to 9ch-c may occur multiple times for update.
10\. Upon reception of the Disconnect Request message UE2 responds with a
Disconnect Response message and deletes all context data associated with the
layer-2 link.
11\. Upon reception of the Disconnect Response from UE-2, the UE-1 triggers
the usage reporting procedure.UE1 sends the usage information report to the NF
(CTF),
12\. UE sends the usage information report to the NF (CTF).
NOTE 3: The Step 16 may occur before step 14 and step 15.
13ch-a. The NF (CTF) decides that the charging session should be closed, and
triggers the Charging Data Request[Termination]. The NF (CTF) sends the
Charging Data Request[Termination] to the corresponding CHF.
13ch-b. The CDR for the ProSe unicast Direct Communication is closed by CHF
for the UE.
13ch-c. The CHF returns Charging Data Response corresponding to the received
Charging Data Request.
NOTE 4: The procedure applies to UE1 to UE2 independently, i.e. each of the UE
sends the respective usage information reports to the network using either the
under coverage procedure or out of coverage procedure.
###### 6.2.4.2.3.2 Message flows with CEF
TBD
#### 6.2.4.3 Solution #2.3: ProSe Broadcast mode of Direct Communication
charging for Key issues #2.1
##### 6.2.4.3.1 Consideration for Broadcast mode of Direct Communication
charging
For broadcast mode of ProSe direct communication over PC5 reference point, the
UE is configured with the Destination Layer-2 ID(s) to be used for ProSe
applications. The Destination Layer-2 ID for a ProSe direct communication is
selected based on the configuration.
The transmitting UE in broadcast communication determines the destination
Layer-2 ID for broadcast and assigns itself a source Layer-2 ID. The receiving
UE determines the destination Layer-2 ID for broadcast reception. The
transmitting UE sends the service data using the source Layer-2 ID and the
destination Layer-2 ID.
The 5GS may collect the following charging information in addition to the
charging information described in Table 6.2.4.1.1-1:
> \- ProSe Source Layer-2 ID
>
> \- ProSe Destination Layer-2 ID
\- Indication whether the UE should use IPv4 or IPv6 for broadcast
\- Application specific data, e.g. application specific session floor control
information
For Broadcast mode ProSe Direct Communication charging, the chargeable events
could be:
\- Received Direct Communication Usage Report (for broadcast).
If event based charging is used, upon this event, a Charging Data
Request[Event] for broadcast is generated.
If session based charging is used, either a Charging Data Request[Initial],
Charging Data Request[Update], or Charging Data Request[Termination] is
generated.
##### 6.2.4.3.2 Architecture Description
The possible solutions for ProSe broadcast mode Direct Communication charging
are based on the potential converged charging architectures defined in clause
6.2.4.1.2.
##### 6.2.4.3.3 Flow Description
###### 6.2.4.3.3.1 ProSe broadcast mode of Direct Communication event-based
charging - PEC
Figure 6.2.4.3.3.1-1: ProSe broadcast mode of Direct Communication event-based
charging -- PEC
> 1\. The receiving UE(s) determine the destination Layer-2 ID for broadcast
> reception. The destination Layer-2 ID is passed down to the AS layer of
> receiving UE(s) for the reception.
2\. The transmitting UE ProSe application layer provides data unit and may
provide ProSe Application Requirements to ProSe layer.
3\. The transmitting UE determines the destination Layer-2 ID for broadcast,
and self-assigns the source Layer-2 ID.
4\. The transmitting UE sends the ProSe data using the source Layer-2 ID and
the destination Layer-2 ID as defined in TS 23.304 [11].
5\. When the UE decides that reporting criteria are met, according to the
configuration, and the connection to the network is available, the UE creates
the corresponding usage information report.
NOTE 1: Both transmitting UE and receiving UE(s) can decide that reporting
criteria are met and trigger the usage reporting procedure.
NOTE 2: When the UE is out of NR coverage and has no connection to the 5G
network, the usage information is stored in a secure environment in the UE, it
will trigger the reporting when UE comes back to NR coverage, as described in
TS 32.277 [4].
6\. UE triggers the usage reporting procedure. UE (CTF-AMC) sends the usage
information report to the ProSe NFï¼ˆCTF-ADF), according to the configuration.
7ch-a. Upon reception of Direct Communication usage information report, the
NF(CTF) triggers the Charging Data Request [Event]. The NF(CTF) sends Charging
Data Request [Event] to CHF.
7ch-b. The ProSe broadcast mode Direct Communication CDR is generated by CHF.
7ch-c. The CHF acknowledges by sending Charging Data Response [Event] to the
NF(CTF).
###### 6.2.4.3.3.2 ProSe broadcast mode of Direct Communication session-based
charging -- SCUR
Figure 6.2.4.3.3.2-1: ProSe broadcast mode of Direct Communication session-
based charging -- SCUR
> 1-4 These steps are the same as described in Figure 6.2.4.3.3.1-1.
5\. When the UE decides that reporting criteria are met, according to the
configuration, and the connection to the network is available, the UE creates
the corresponding usage information report.
NOTE 1: Both transmitting UE and receiving UE(s) can decide that reporting
criteria are met and trigger the usage reporting procedure.
NOTE 2: When the UE is out of NR coverage and has no connection to the 5G
network, the usage information is stored in a secure environment in the UE, it
will trigger the reporting when UE comes back to NR coverage, as described in
TS 32.277 [4].
6\. UE (CTF-AMC) sends the usage information report to the NF (CTF-ADF).
7ch-a. If the CTF located with ProSe Service is configured to use session
based charging, upon reception of direct communication usage information
report for a broadcast, the NF (CTF) triggers the Charging Data Request[Init]
when there is no open charging session. The NF (CTF) sends the Charging Data
Request[Interim] to the corresponding CDF, and starts a charging session.
7ch-b. Based on policies, the CHF opens a CDR related to the service.
7ch-c. The CHF grants authorization to NF (CTF) for the service to start, and
returns Charging Data Response.
8\. UE triggers the usage reporting procedure when the reporting criteria are
met.
9ch-a. If there is a charging session, upon reception of direct communication
usage information report, the NF (CTF) triggers the Charging Data
Request[Update]. The NF (CTF) sends the Charging Data Request[Update] to the
corresponding CHF.
9ch-b. The CDR is updated by CHF for the UE.
9ch-c. The CHF returns Charging Data Response corresponding to the received
Charging Data Request.
NOTE 3: The Step 9ch-a to 9ch-c may occur multiple times for update.
10\. UE triggers the usage reporting procedure when the reporting criteria are
met.
11ch-a. The NF (CTF) decides that the charging session should be closed, and
triggers the Charging Data Request[Termination]. The NF (CTF) sends the
Charging Data Request[Termination] to the corresponding CHF.
11ch-b. The CDR is closed by CHF for the UE.
11ch-c. The CHF returns Charging Data Response corresponding to the received
Charging Data Request.
#### 6.2.4.4 Solution #2.4: ProSe Groupcast mode of Direct Communication
charging for Key issues #2.1
##### 6.2.4.4.1 Consideration for Groupcast mode of Direct Communication
charging
For Groupcast mode of ProSe direct communication over PC5 reference point, the
UE is configured with the Destination Layer-2 ID(s) to be used for ProSe
applications. The Destination Layer-2 ID for a ProSe direct communication is
selected based on the configuration.
The transmitting UE in groupcast communication determines a source Layer-2 ID
and a destination Layer-2 ID and the receiving UE determines destination
Layer-2 ID. The transmitting UE determines the PC5 QoS parameters for this
groupcast. The transmitting UE sends the service data using the source Layer-2
ID and the destination Layer-2 ID.
For Groupcast mode ProSe Direct Communication charging, the chargeable events
could be:
\- Received Direct Communication Usage Report (for Groupcast).
The 5GS could re-use the Service authorization and provisioning mechanism
defined in TS 23.304 [11] clause 5.1.3, the UE could be configured with
information to be included in the usage information report as per following:
\- Whether the Group Parameters need to be reported;
\- Whether timestamps of the first transmission/reception need to be reported;
\- Whether the amount of data transmitted by UE needs to be reported, and
whether with location information;
\- Whether the amount of data received by UE needs to be reported, and whether
with location information;
\- Whether the list of locations of the UE when in NR coverage needs to be
reported;
\- Whether the list of timestamps of when UE goes in/out of NR coverage need
to be recorded.
\- Whether the indicator of radio resources used and radio frequency are to be
reported with the amount of data transmitted and received.
The 5GS may collect the following charging information in addition to the
charging information described in Table 6.2.4.1.1-1:
> \- Application Layer Group ID: Identifies an application layer group that
> the UE belongs to.
>
> \- ProSe Layer-2 Group ID
>
> \- ProSe Group IP multicast address
\- Indication whether the UE should use IPv4 or IPv6 for that group
\- Application specific data, e.g. application specific session floor control
information, Application layer User ID of group members in the communication.
If event based charging is used, upon this event, a Charging Data
Request[Event] for Groupcast is generated.
If session based charging is used, either a Charging Data Request[Initial],
Charging Data Request[Update], or Charging Data Request[Termination] is
generated.
##### 6.2.4.4.2 Architecture Description
The possible solutions for ProSe Group mode Direct Communication charging are
based on the potential converged charging architectures defined in clause
6.2.4.1.2.
##### 6.2.4.4.3 Flow Description
###### 6.2.4.4.3.1 ProSe groupcast mode of Direct Communication event-based
charging - PEC
The flow is the same as TS 32.277 [4] clauses 5.2.2.3.2 and 5.2.2.3.3 with the
following differences:
\- ProSe Function is replaced by ProSe Service which provides PC3ch interface
toward UE;
\- CDF is replaced by CHF;
###### 6.2.4.4.3.2 ProSe groupcast mode of Direct Communication session-based
charging -- SCUR
The flow is the same as TS 32.277 [4] clauses 5.2.2.3.4 and 5.2.2.3.5 with the
following differences:
\- ProSe Function is replaced by ProSe Service which provides PC3ch interface
toward UE;
\- CDF is replaced by CHF.
#### 6.2.4.5 Solution #2.5: ProSe charging for ProSe Direct Communication via
UE-to-Network Relay for Key issues #2.2
##### 6.2.4.5.1 Consideration for ProSe Direct Communication via UE-to-Network
Relay charging
The 5G ProSe Layer-3 UE-to-Network Relay could provide generic function that
can relay any IP, Ethernet or Unstructured traffic, while the 5G ProSe Layer-2
UE-to-Network Relay provides forwarding functionality that can relay any type
of traffic over the PC5 link.
Both Layer-2 and Layer-3 UE-to-Network Relay entity provides the relaying
functionality to support connectivity to the network for Remote UEs. It can be
used for both public safety services and commercial services (e.g. interactive
service).
For ProSe Direct Communication via UE-to-Network Relay charging, the
chargeable events could be:
\- Received Direct Communication Usage Report which is triggered by CTF(ADF)
receiving a usage information report from the ProSe UE-to-Network relay UE.
The 5GS may collect the following charging information in addition to the
charging information described in Table 6.2.4.1.1-1:
\- Identities of the transmitters in the direct communication via 5G ProSe UE-
to-Network relay, e.g. Source L2 ID and IP address, ProSe UE-to-Network Relay
UE L2 ID and IP address.
\- List of non-zero amount of data relayed by UE, e.g. List of amount of data
relayed by a ProSe UE-to-Network Relay at each location, with NCGI and the
corresponding timestamps, and indicator of radio resources used and the radio
frequency used;
\- Application specific data, e.g. application specific session floor control
information, Application layer User ID.
##### 6.2.4.5.2 Architecture Description
See clause 6.2.4.1.2.
##### 6.2.4.5.3 Flow Description
###### 6.2.4.5.3.1 Message flow for ProSe Direct Communication via Layer-3 UE-
to-Network Relay
Figure 6.2.4.5.3.1-1: Message flow for ProSe Direct Communication via Layer-3
UE-to-Network Relay
1-7. These steps are the same as message flow for ProSe UE-to-Network Direct
Communication via Layer-3 procedures described in TS 23.304 [11] clause
6.5.1.1.
8\. When the UE decides that reporting criteria are met, according to the pre-
configuration, the UE creates the corresponding usage information report. UE
triggers the usage reporting procedure.
9\. The Remote UE sends the usage reporting to ProSe UE-to-Network Relay UE.
Then Relay UE sends the usage information report to the CTF located in ProSe
NF (e.g., 5G-DDNFM).
9ch-a. Upon reception of Direct Communication usage information report, the
CTF(ADF) triggers the Charging Data Request [Event]. The CTF(ADF) sends
Charging Data Request [Event] to CHF.
9ch-b. The 5G ProSe Direct communication via UE-to-Network Relay CDR is
generated by CHF for the Remote UE.
9ch-c. The CHF acknowledges by sending Charging Data Response [Event] to the
CTF(ADF).
10\. 5G ProSe UE-to-Network Relay UE triggers the usage reporting procedure
and creates the corresponding usage information report when the reporting
criteria are met.
11\. 5G ProSe UE-to-Network Relay UE sends the usage information report to the
ProSe NF (CTF).
NOTE 1: Step 10 and Step 11 can occur before Step 8 and Step 9.
11ch-a. Upon reception of Direct Communication usage information report, the
CTF(ADF) triggers the Charging Data Request [Event]. The CTF(ADF) sends
Charging Data Request [Event] to CHF.
11ch-b. The 5G ProSe Direct communication via UE-to-Network Relay CDR is
generated by CHF for the Relay UE.
11ch-c. The CHF acknowledges by sending Charging Data Response [Event] to the
CTF(ADF).
NOTE 2: The procedure applies to Remote UE to UE-to-Network Relay UE
independently, i.e. each of the UE sends the respective usage information
reports according to different reporting criteria.
###### 6.2.4.5.3.2 Message flow for ProSe Direct Communication via Layer-2 UE-
to-Network Relay
Figure 6.2.4.5.3.2-1: Message flow for ProSe Direct Communication via Layer-2
UE-to-Network Relay
1-8. These steps are the same as message flow for ProSe UE-to-Network Direct
Communication via Layer-2 procedures described in TS 23.304 [11] clause
6.5.2.2.
9-11. These steps are the same as message flow for Layer-3 UE-to-Network Relay
in figure 6.2.4.5.3.1-1.
### 6.2.5 Evaluation
This clause evaluates the solutions for KI#2.1 as following.
\- Solution #2.1 and Solution #2.2 provide event-based charging and session-
based charging solutions for ProSe Unicast mode, while Solution #2.3 focuses
on ProSe Broadcast mode charging and Solution #2.4 focuses on ProSe Groupcast
mode charging, and Solution #2.5 proposes ProSe charging solutions for ProSe
Direct Communication via UE-to-Network Relay, for both Layer-2 and Layer-3 UE-
to-Network Relay.
NOTE 1: For 5G ProSe Direct Communication via Unicast mode, Broadcast mode,
Groupcast mode, and Direct Communication via ProSe UE-to-Network Relay, either
event based charging or session based charging can be used, depending on
configuration of the ProSe Function and CHF.
\- When it comes to 5G ProSe Direct Communication over NR based PC5 reference
point, distributed CTF architecture is proposed to be utilized. CTF is split
into UE (AMC) and 5G DDNMF (ADF), the 5G ProSe enabled UEs send usage
information to ProSe NF (e.g., 5G-DDNFM) via PC3ch, then ADF sends the events
directly to the CHF or through a CEF.
\- The triggers for charging events are identified. When UE(AMC) decides that
reporting criteria are met, the CTF (ADF) receives usage information from the
CTF (AMC). The Charging reporting is achieved by sending Charging Data Request
to the CHF from the ProSe related CTF (e.g., 5G-DDNFM) or CEF.
NOTE 2: For 5G ProSe Direct Communication, the known NF(s) that may support an
ADF is 5G DDNMF.
\- The charging information in 5G ProSe Direct Communication are captured in
these solutions, including UE identity, identities of the transmitters in
session (e.g. Source L2 ID and IP address, Target Layer-2 ID), Application
specific data, etc.
### 6.2.6 Conclusion
Based on the evaluation in clause 6.2.5,
\- **Solution #2.1** and **Solution #2.2** is the feasible solution for ProSe
Unicast mode of Direct Communication charging.
\- **Solution #2.3** is the feasible solution for ProSe Broadcast mode of
Direct Communication charging.
\- **Solution #2.4** is the feasible solution for ProSe Groupcast mode of
Direct Communication charging.
\- **Solution #2.5** is the feasible solution for ProSe Direct Communication
via UE-to-Network Relay charging.
## 6.3 Scenario 3: 5GS charging for ProSe Direct Communication based on QoS
flow
### 6.3.1 General description and assumptions
For NR based PC5, a QoS model similar to that defined in TS 23.501 [7] for Uu
reference point is used, i.e. based on 5QIs, a PC5 QoS Flow is associated with
a PC5 QoS Rule and the PC5 QoS parameters as defined in TS 23.287 [2] clauses
5.4.2, 5.4.3 and 5.4.4.
The UE may be configured with a set of default PC5 QoS parameters, as defined
in TS 23.287 [2] clause 5.1.2.1. For NR based unicast, groupcast and broadcast
mode communication over PC5, Per-flow QoS model for PC5 QoS management could
be applied. This may need to be charged differently based on the monitored QoS
for them respectively.
For Direct communication via ProSe UE-to-Network Relay, PC5 QoS handling to
support end-to-end QoS is defined in TS 23.304 [11].
The end-to-end QoS for a relay service handling is supported as shown in
figure below.
Figure 6.3.1-1: End-to-End QoS translation for Layer 3 UE-to-Network Relay
In case the QoS Flows setup are initiated by network, PCF or SMF decides the
Uu part QoS parameters.
In case that the Remote UE requested dedicated PC5 QoS Flows when establishing
the L2 Link over PC5, the Remote UE gets the QoS mapping on the Relay UE via
PC5 and decides the PC5 part QoS parameters (i.e. PQI).
### 6.3.2 Potential charging requirements
**REQ-CH_PROSE_5GS_QBC-01:** The 5GS should support collect charging
information per PC5 Qos Flow.
### 6.3.3 Key issues
#### 6.3.3.1 Key issue #3.1: QoS flow Based Charging for ProSe Direct
Communication
This key issue is for investigating how to support QoS flow Based Charging for
ProSe Direct Communication considering **REQ-CH_PROSE_5GS_QBC-01**.
This investigation covers the following:
\- determination of which entity/entities in the 5G system are suitable to
provide the charging information for QoS flow Based Charging;
\- identification of the triggers for flow Based Charging for ProSe Direct
Communication, and Direct Communication via UE-to-Network Relay.
### 6.3.4 Possible solutions
#### 6.3.4.1 Solution #3.1: QoS flow Based Charging for ProSe Direct
Communication for Key issues #3.1
##### 6.3.4.1.1 Consideration for ProSe QoS flow Based Charging
The 5GS provides QoS handling mechanism defined in TS 23.304 [11] to support
ProSe Direct Communication, the one-to-one mapping of standardized PQI values
that are additionally defined to PC5 QoS characteristics. 5G ProSe UE could
collect charging information related to data volumes categorized per PC5 QoS
Flow identified by PQI.
The possible solutions to support the potential requirements **REQ-
CH_PROSE_5GS_QBC-01 and** Key Issue #3.1 could be the enhancements or
extensions to the ProSe Direct Communication and/or ProSe Direct Communication
via UE-to-Network relay defined in clause 6.2.
The 5GS could re-use the Service authorization and provisioning mechanism
defined in TS 23.304 [11] clause 5.1.3, the UE could be configured with
information to be included in the usage information report as per following:
\- Whether the QoS flow information need to be reported;
If QoS flow information need to be reported in usage information report, the
UE may start to collect QoS information by some trigger conditions, e.g.
Start/End of a QoS flow, Start/End of PC5 layer-2 link, PC5 QoS parameters
change of charging condition in the ProSe UE. When the UE decides that
reporting criteria are met, according to the pre-configuration, the UE creates
the corresponding usage information report with QoS information to NF(CTF)
over PC3ch or to ProSe UE-to-Network Relay UE.
For ProSe QoS flow Based Charging, the chargeable events could be:
\- Received Direct Communication Usage Report (for Broadcast, Groupcast,
Unicast, including UE-to-Network Relay) with QoS information.
The 5GS may collect the QoS flow information in addition to the charging
information described for ProSe Unicast/Groupcast/Broadcast mode of Direct
Communication, including Direct Communication via UE-to-Network Relay:
\- PC5 QoS Flow Id;
\- Report Time;
\- QoS information;
\- QOS Characteristics;
##### 6.3.4.1.2 Architecture Description
The solutions could reuse the possible architecture defined for ProSe
Communication solutions.
##### 6.3.4.1.3 Flow Description
The flow is the same as defined for ProSe Communication solutions with the
following differences:
\- QoS flow related information may be reported in Usage information reporting
message;
> \- QoS flow related information may be included in Charging Data Request
> message toward CHF for CDR generation;
### 6.3.5 Evaluation
This clause evaluates the solutions for KI#3.1 as following.
> \- **Solution #3.1** focuses on QoS flow Based Charging for ProSe Direct
> Communication. The 5GS provides QoS handling mechanism is defined in TS
> 23.304 [11] to support ProSe Direct Communication, the solution gives
> proposals based on the monitored QoS via PC5.
>
> \- Service authorization and provisioning mechanism could be re-used to
> configure 5G ProSe-enabled UE, whether the QoS flow information need to be
> reported can be configured in the usage information report.
>
> \- The report procedure and trigger could be same as direct communication
> charging, but with additional Qos information over PC5 when reporting usage
> information. UE may start to collect QoS information by some trigger
> conditions, e.g. Start/End of a QoS flow, Start/End of PC5 layer-2 link, PC5
> QoS parameters change. When the UE decides that reporting criteria are met
> according to the pre-configuration, the UE(AMC) creates the corresponding
> usage information report with QoS information to CTF-ADF over PC3ch directly
> or via ProSe UE-to-Network Relay UE.
### 6.3.6 Conclusion
Based on the evaluation in clause 6.3.5, **Solution #3.1** is the feasible
solution for QoS flow Based Charging for ProSe Direct Communication.
# 7 Conclusions and recommendations
The conclusion for identified key issues are:
\- 5GS charging for ProSe Direct Discovery: solutions as per clause 6.1.6
conclusion.
\- 5GS charging for ProSe Direct Communication: solutions as per clause 6.2.6
conclusion.
\- 5GS charging for ProSe Direct Communication based on QoS flow: solutions as
per clause 6.3.6 conclusions.
To support converged charging for 5GS ProSe in normative work, it is
recommended to specify the requirements, architectures and solutions for the
aspects mentioned above.
#
# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document is part of a series of documents that specify charging
functionality and charging management in GSM/UMTS/LTE networks. The
GSM/UMTS/LTE core network charging architecture and principles are specified
in TS 32.240 [1], which provides an umbrella for other charging management TSs
that specify:
\- the content of the CDRs per domain / subsystem / service (offline
charging);
\- the content of real-time charging messages per domain / subsystem / service
(online charging);
\- the functionality of online and offline charging for those domains /
subsystems / services;
\- the interfaces that are used in the charging framework to transfer the
charging information (i.e. CDRs or charging events).
The complete document structure for these TSs is defined in TS 32.240 [1].
The present document specifies the offline and online charging description for
Control Plane (CP) data transfer domain, based on the functional stage 2
description in TS 23.682 [243] for Non-IP Data Delivery (NIDD) using SCEF
procedures. This charging description includes the offline and online charging
architecture and scenarios specific to Control Plane (CP) data transfer
domain, as well as the mapping of the common 3GPP charging architecture
specified in TS 32.240 [1] onto the Control Plane (CP) data transfer domain.
It further specifies the structure and content of the CDRs for offline
charging. The present document is related to other 3GPP charging TSs as
follows:
\- The common 3GPP charging architecture is specified in TS 32.240 [1].
\- The parameters, abstract syntax and encoding rules for the CDRs are
specified in TS 32.298 [51].
\- A transaction based mechanism for the transfer of CDRs within the network
is specified in TS 32.295 [54].
\- The file based mechanism used to transfer the CDRs from the network to the
operator\'s billing domain (e.g. the billing system or a mediation device) is
specified in TS 32.297 [52].
\- The 3GPP Diameter application that is used for Control Plane (CP) data
transfer domain offline and online charging is specified in TS 32.299 [50].
Control Plane (CP) data transfer is also provided by Short Message Service
(SMS), for which charging functionalities are not specified in the present
document. SMS charging functionality is defined for Circuit Switched domain in
TS 32.250 [10], for Packet Switched domain in TS 32.251 [11] and for SMS Nodes
in TS 32.274 [34].
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TS 32.240: \"Telecommunication management; Charging management;
Charging architecture and principles\".
[2] - [9] Void.
[10] 3GPP TS 32.250: \"Telecommunication management; Charging management;
Circuit Switched (CS) domain charging\".
[11] 3GPP TS 32.251: \"Telecommunication management; Charging management;
Packet Switched (PS) domain charging\".
[12] - [19] Void.
[20] 3GPP TS 32.260: \"Telecommunication management; Charging management; IP
Multimedia Subsystem (IMS) charging\".
[20] - [33] Void.
[34] 3GPP TS 32.274: \"Telecommunication management; Charging management;
Short Message Service (SMS) charging\".
[35] - [49] Void.
[50] 3GPP TS 32.299: \"Telecommunication management; Charging management;
Diameter charging application\".
[51] 3GPP TS 32.298: \"Telecommunication management; Charging management;
Charging Data Record (CDR) parameter description\".
[52] 3GPP TS 32.297: \"Telecommunication management; Charging management;
Charging Data Record (CDR) file format and transfer\".
[53] Void.
[54] 3GPP TS 32.295: \"Telecommunication management; Charging management;
Charging Data Record (CDR) transfer\".
[55] - [99] Void.
[100] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[101] - [199] Void
[200] - [206] Void
[207] 3GPP TS 29.061: \"Interworking between the Public Land Mobile Network
(PLMN) supporting packet based services and Packet Data Networks (PDN)\".
[208] - [242] Void
[243] 3GPP TS 23.682: \"Architecture enhancements to facilitate communications
with packet data networks and applications\".
[244] - [299] Void
[300] - [399] Void.
[400] - [499] Void.
[500] - [599] Void.
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [100] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
either 3GPP TR 21.905 [100].
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
Bcp Reference point for the CDR file transfer from CP data transfer CGF to the
BD.
Ga Reference point for CDR transfer between a CDF and the CGF.
Rf Offline charging reference point between a MME/SCEF/IWK-SCEF and the CDF.
S6t Reference point between the SCEF and the HSS.
T6a Reference point between the SCEF and the serving MME.
T6ai Reference point between the IWK-SCEF and the serving MME.
T7 Reference point between the IWK-SCEF and the serving SCEF.
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [100] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [100].
BD Billing Domain
CDF Charging Data Function
CGF Charging Gateway Function
CIoT Cellular Internet of Things
CP Control Plane
CPCN Control Plane data transfer Charging Node (MME, SCEF, IWK-SCEF)
CPDT Control Plane Data Transfer
CTF Charging Trigger Function
IE Information Element
IWK-SCEF Interworking SCEF
NE Network Element
NIDD Non-IP Data Delivery
SCEF Service Capability Exposure Function
# 4 Architecture considerations
## 4.1 High-level CP data transfer architecture
The overall architecture for Service Capability Exposure which enables the
3GPP network to securely expose its services and capabilities provided by 3GPP
network interfaces to external 3rd party service provider applications is
defined in 3GPP TS 23.682 [243], and figure 4.1.1 is an excerpt highlighting
relevant 3GPP Nodes involved for Non-IP Data Delivery (NIDD) between the UE
and the SCS/AS.
Figure 4.1.1: 3GPP Architecture Service Capability Exposure for Non-IP Data
Delivery
For roaming case, the Interworking SCEF (IWK-SCEF) is optionally deployed and
located in the VPLMN, as described in figure 4.1.2.
Figure 4.1.2: 3GPP roaming Architecture Service Capability Exposure for Non-IP
Data Delivery
## 4.2 CP data transfer domain offline charging architecture
_As described in TS 32.240 [1], the CTF (an integrated component in each
charging relevant NE) generates charging events and forwards them to the CDF.
The CDF, in turn, generates CDRs which are then transferred to the CGF.\
Finally, the CGF creates CDR files and forwards them to the BD._
For offline charging the following Control Plane data transfer Charging Nodes
(CPCN), functioning as the CTF, may generate accounting metrics sets for
Control Plane data transfer CDRs:
\- the SCEF, to record Control Plane data transfer;
\- the IWK-SCEF, to record Control Plane data transfer;
\- the MME, to record Control Plane data transfer (optional).
If the CPCN generating the charging information has an integrated CDF, then
the CPCN can produce CDRs. The CGF may also be integrated in the CPCN, or it
may exist as a physically separate entity.\ If the CGF is external to the
CPCN/CDF, then the CPCN/CDF forwards the CDRs to the CGF across the Ga
interface. In this case, the relationship between CPCN/CDF and CGF is m:1.\ If
the CGF is integrated in the CPCN/CDF, then there is only an internal
interface between the CDF and the CGF. In this case, the relationship between
CPCN/CDF and CGF is 1:1. An integrated CGF may support the Ga interface from
other CPCN/CDFs.
If the CDF is external to the CPCN, the charging events are transferred from
the CPCN to the CDF via the Rf interface specified in TS 32.299 [50]. In this
case, the relationship between CPCN and CDF is m:1.
When an external CGF is used, this CGF may also be used by other, i.e. non-
Control Plane data transfer, network elements, according to network design and
operator decision. It should be noted that the CGF may also be an integrated
component of the BD -- in this case, the Bcp interface does not exist and is
replaced by a proprietary solution internal to the BD.
Figure 4.2.1 depicts the architectural options described above.
Figure 4.2.1: Control Plane data transfer offline charging architecture
It is mandatory to support at least one of the Rf, Ga or Bcp interfaces from
the CPCN as described in the present document.
NOTE: Support of Control Plane data transfer charging is optional for the MME.
## 4.3 CP data transfer domain online charging architecture
Not specified in the present document.
# 5 CP data transfer domain charging principles and scenarios
## 5.1 CP data transfer domain charging principles
The following are high level charging requirements for Control Plane data
transfer, derived from requirements in TS 23.682 [243]:
> \- Every PDN connection shall be assigned a unique identity number for
> billing purposes. (i.e. the Charging Id);
>
> \- CPCN shall be capable of identifying NIDD submission request events in
> mobile originated (MO) and mobile terminated (MT) direction;
>
> \- CPCN shall be capable of identifying data volume per NIDD submission
> request;
>
> \- CPCN shall be capable of handling the Charging Characteristics;
>
> \- CPCN shall be able, based on operator configuration, to collect charging
> information for the PDN connection in the same PLMN using offline charging;
>
> \- PDN connection in a different PLMN using offline charging.
>
> For the PDN connection, the CPCN shall collect the following information:
>
> \- usage of the radio interface: the charging information shall describe the
> amount of data transmitted in MO and MT directions using Control Plane CIoT
> EPS Optimisation per each NIDD submission per RAT type and authorized
> Serving PLMN/APN Rate controls;
>
> \- usage duration: duration of PDN connection is counted as the time
> interval from PDN connection activation to PDN connection deactivation;
>
> \- destination and source: the charging information shall provide the user
> identity (IMSI) and subscriber equipment number (IMEISV) used by the
> subscriber for the PDN connection and the destination as determined by the
> Access Point Name (APN) and SCEF address;
>
> \- usage of the external data networks: the charging information shall
> describe the amount of data sent and received to and from the external data
> network with the corresponding time stamp per each NIDD submission;
>
> \- location of MS/UE: HPLMN, VPLMN, plus optional higher-accuracy location
> information.
## 5.2 CP data transfer domain offline charging scenarios
### 5.2.1 Basic principles
If charging is supported by an CPCN (SCEF, IWK-SCEF, or optionally MME), it
shall be able to collect charging information per user per PDN connection, and
per Non-IP Data Delivery submission in both originating and terminating
directions with associated volume counts.
The user is identified by the IMSI, while the PDN connection to the SCEF can
be determined by a unique identifier generated by the SCEF when creating a PDN
connection. This identifier is forwarded to the MME so as to allow correlation
of MME PDN connection CDRs if any, with the matching SCEF CDRs in the BD. In
roaming case, this identifier is forwarded to the IWK-SCEF so as to allow
correlation between IWK-SCEF PDN connection CDRs in VPLMN and SCEF PDN
connection CDRs in the HPLMN.
The following chargeable events are defined for Control Plane data transfer
charging for all CPCNs:
> \- Start of PDN connection. Upon encountering this event, a CDR for this PDN
> connection is created;
>
> \- End of PDN connection. Upon encountering this event, the CDR is closed;
>
> \- NIDD submission request. Upon encountering this event, the NIDD
> submission with associated volume count is added to the CDR;
>
> \- Mobility to a new MME. Upon encountering this event, the CDR is closed.
> In SCEF and IWK-SCEF, a new one is opened if the PDN connection is still
> active. In the new MME the CDR is created;
>
> \- Serving PLMN Rate Control change. This event closes the CDR, and a new
> one is opened if the PDN connection is still active.
>
> \- APN PLMN Rate Control change in SCEF. This event is applicable for the
> SCEF only. This event closes the CDR, and a new one is opened if the PDN
> connection is still active.
>
> \- PLMN change. This event closes the CDR. In the SCEF, a new one is opened
> if the PDN connection is still active;
>
> \- Intersystem change (e.g. change of RAT type). This event closes the CDR,
> and a new one is opened if the PDN connection is still active.
NOTE: Inter-RAT mobility between NB-IoT and other RAT is not supported in this
release.
> \- Expiry of an operator configured time limit per PDN connection. This
> event closes the CDR, and a new one is opened if the PDN connection is still
> active;
>
> \- Expiry of an operator configured data volume limit per PDN connection.
> This event closes the CDR, and a new one is opened if the PDN connection is
> still active;
>
> \- Expiry of an operator configured NIDD submissions limit per PDN
> connection. This event closes the CDR, and a new one is opened if the PDN
> connection is still active.
Management intervention may also force trigger a chargeable event.
### 5.2.2 Rf message flows
#### 5.2.2.1 Triggers for charging events from CPCN
When a charging event is reported to the CDF, it includes details such as user
identity, Charging Id, APN, SCEF address, MME address, and in roaming
scenario, IWK-SCEF address. NIDD submissions charging information, including
associated volume count are reported with corresponding charging events to the
CDF.
The Charging Characteristics are also used to set the coherent chargeable
event conditions (e.g. time/volume limits that trigger CDR generation or
information addition). The Charging Characteristics is provided by the HSS to
the CPCNs as part of the subscription information. Further details about
Charging Characteristics are defined in Annex A.
When offline charging is activated for CP data transfer in CPCN, it shall be
possible to define separate trigger conditions values per Charging
Characteristics profile for the following triggers:
\- data volume limit;
\- time (duration limit);
\- maximum number of NIDD submissions.
If, according to the Charging Characteristics profile, offline charging is
activated for CP data transfer in CPCN, Charging Data Request [Start] is sent
at PDN connection creation.
Charging Data Request [Stop] is sent at PDN connection release.
Charging Data Request [Interim] is sent during the lifetime of the PDN
connection, upon occurrence of the trigger conditions specified in Table
5.2.2.1.1.
Table 5.2.2.1.1: Triggers for Charging Data Request from CPCN
+----------------------------------+----------------------------------+ | **Message** | **Trigger Conditions** | +----------------------------------+----------------------------------+ | Charging Data Request [Start] | PDN connection creation | +----------------------------------+----------------------------------+ | Charging Data Request | NIDD submit response receipt to | | [Interim] | NIDD submit request | | | | | | Serving PLMN Rate Control change | | | | | | RAT type change | | | | | | Expiry of time limit | +----------------------------------+----------------------------------+ | Charging Data Request [Stop] | PDN connection release | +----------------------------------+----------------------------------+
When applicable per Charging Characteristics, \"data volume limit\" and
\"maximum number of NIDD submissions\" are trigger conditions met upon one
particular \"NIDD submit response to NIDD submit request\". They shall be
reported along with the Charging Data Request [Interim] triggered by this
\"NIDD submit response to NIDD submit request\" within Change Condition under
PS information of Service Information.
NOTE: Inter-RAT mobility between NB-IoT and other RAT is not supported in this
release.
#### 5.2.2.2 SCEF specific triggers for charging events
The subclause 5.2.2.1 is applicable for CP data transfer collection of
charging information and triggers for SCEF CPCN.
Table 5.2.2.2.1 identifies the additional trigger conditions applicable to
SCEF.
Table 5.2.2.2.1: SCEF specific triggers for Charging Data Request
+-----------------------------------+----------------------------------+ | **Message** | **Trigger Conditions** | +-----------------------------------+----------------------------------+ | Charging Data Request [Interim] | NIDD submission response sending | | | | | | MME Change | | | | | | APN Rate Control change | | | | | | PLMN Change | +-----------------------------------+----------------------------------+
#### 5.2.2.3 IWF-SCEF specific triggers for charging events
The subclause 5.2.2.1 is applicable for CP data transfer collection of
charging information and triggers for IWK-SCEF CPCN.
Table 5.2.2.3.1 identifies the additional trigger conditions applicable to
IWK-SCEF.
Table 5.2.2.3.1: IWF-SCEF specific triggers for Charging Data Request
+-----------------------------------+-----------------------------------------+ | **Message** | **Trigger Conditions** | +-----------------------------------+-----------------------------------------+ | Charging Data Request [Interim] | NIDD submission response sending | | | | | | Change Serving PLMN Rate Control change | +-----------------------------------+-----------------------------------------+ | Charging Data Request [Stop] | PLMN Change | +-----------------------------------+-----------------------------------------+
#### 5.2.2.4 MME specific triggers for charging events
When optional CP data transfer offline charging is supported by the MME, the
subclause 5.2.2.1 is applicable for CP data transfer collection of charging
information and triggers for MME CPCN.
Table 5.2.2.4.1 identifies the additional trigger conditions applicable to
MME.
Table 5.2.2.4.1: MME specific triggers for Charging Data Request
+-----------------------------------+---------------------------------+ | **Message** | **Trigger Conditions** | +-----------------------------------+---------------------------------+ | Charging Data Request [Start] | MME Change from old MME | +-----------------------------------+---------------------------------+ | Charging Data Request [Interim] | NIDD delivery to the UE | | | | | | NIDD delivery from the UE error | +-----------------------------------+---------------------------------+ | Charging Data Request [Stop] | MME Change to new MME | | | | | | PLMN Change | +-----------------------------------+---------------------------------+
### 5.2.3 CDR generation
#### 5.2.3.1 Introduction
For each of the CPCNs (SCEF, IWK-SCEF and MME), a CP data transfer CDR is
generated for subsequent transfer to the Charging Gateway Function (CGF).
The following clauses describe the trigger conditions for these CP data
transfer CDRs creation, update and closure.
#### 5.2.3.2 Triggers for CPDT-SCE-CDR creation and closure
##### 5.2.3.2.1 General
A CPDT-SCE-CDR is used to collect charging information related to Control
Plane data transfer offline charging from a SCEF.
A CPDT-SCE-CDR shall be opened at PDN connection start, and shall be closed as
described in subclause 5.2.3.2.3.
Charging information shall be added to a CPDT-SCE-CDR as described in
subclause 5.2.3.2.2.
##### 5.2.3.2.2 Triggers for CPDT-SCE-CDR charging information addition
The \"List of NIDD submissions\" attributes of the CPDT-SCE-CDR consists of a
set of containers. Each container identifies a NIDD submission and shall be
added to the \"List of NIDD submissions\" per table 5.2.3.2.2.1 trigger
conditions. Details of the container are defined in clause 6.1.3.4.
Table 5.2.3.2.2.1 identifies which conditions are supported to trigger CPDT-
SCE-CDR charging information addition.
Table 5.2.3.2.2.1: Triggers for CPDT-SCE-CDR charging information addition
+----------------------------------+----------------------------------+ | **Trigger Conditions** | **Description/Behaviour** | +----------------------------------+----------------------------------+ | NIDD submission response receipt | On receipt of NIDD submit | | | response to NIDD submit request, | | | the NIDD submission container | | | shall be added to the | | | CPDT-SCE-CDR. | +----------------------------------+----------------------------------+ | NIDD submission | On sending of NIDD submit | | | response to received NIDD submit | | response sending | request, the NIDD submission | | | container shall be added to the | | | CPDT-SCE-CDR. | +----------------------------------+----------------------------------+ | NIDD submission timeout | On timer expiry due to no NIDD | | | submit response to a NIDD submit | | | request, the NIDD submission | | | container shall be added to the | | | CPDT-SCE-CDR. | +----------------------------------+----------------------------------+
##### 5.2.3.2.3 Triggers for CPDT-SCE-CDR closure
The CPDT-SCE-CDR shall be closed on encountering any of the following trigger
conditions identified in Table 5.2.3.2.3.1:
Table 5.2.3.2.3.1: Triggers for CPDT-SCE-CDR closure
+-------------------------+-------------------------------------------+ | **Closure Conditions** | **Description/Behaviour** | +-------------------------+-------------------------------------------+ | PDN connection release. | PDN connection release shall result in | | | the CDR being closed. | | | | | | The trigger condition covers: | | | | | | > \- termination of PDN connection; | | | > | | | > \- any abnormal release. | +-------------------------+-------------------------------------------+ | Partial Record Reason | Partial Record Reason, shall result in | | | the CDR being closed. | | | | | | The trigger condition covers: | | | | | | > \- data volume limit; | | | > | | | > \- time (duration limit); | | | > | | | > \- maximum number of NIDD submissions; | | | > | | | > \- MME change; | | | > | | | > \- Serving PLMN Rate Control change; | | | > | | | > \- APN Rate Control change; | | | > | | | > \- PLMN change; | | | > | | | > \- radio access technology change (RAT | | | > Type); | | | > | | | > \- Management intervention. | +-------------------------+-------------------------------------------+
The Partial Record generation trigger thresholds are those associated with the
Charging Characteristics.\ The Partial Record generation trigger thresholds
are SCEF configuration parameters defined per Charging Characteristics profile
by the operator through OAM&P means, as specified in Annex A.
In the event that the CPDT-SCE-CDR is closed and the PDN connection remains
active, a further CPDT-SCE-CDR is opened with an incremented Sequence Number.
NOTE: Inter-RAT mobility between NB-IoT and other RAT is not supported in this
release.
#### 5.2.3.3 Triggers for CPDT-SNN-CDR creation and closure - IWK-SCEF
##### 5.2.3.3.1 General
A CPDT-SNN-CDR is used to collect charging information related to Control
Plane data transfer offline charging from a IWK-SCEF.
A CPDT-SNN-CDR shall be opened at PDN connection start for this IWK-SCEF, i.e.
upon PDN connection creation and mobility towards the new IWK-SCEF (upon PLMN
change).
A CPDT-SNN-CDR shall be closed as described in subclause 5.2.3.3.3.
Charging information shall be added to a CPDT-SNN-CDR as described in
subclause 5.2.3.3.2.
##### 5.2.3.3.2 Triggers for CPDT-SNN-CDR charging information addition - IWK-
SCEF
The \"List of NIDD submissions\" attributes of the CPDT-SNN-CDR consists of a
set of containers. Each container identifies a NIDD submission and shall be
added to the \"List of NIDD submissions\" per table 5.2.3.3.2.1 trigger
conditions. Details of the container are defined in clause 6.1.3.4.
Table 5.2.3.3.2.1 identifies which conditions are supported to trigger CPDT-
SNN-CDR charging information addition.
Table 5.2.3.3.2.1: Triggers for CPDT-SNN-CDR charging information addition -
IWK-SCEF
+----------------------------------+----------------------------------+ | **Trigger Conditions** | **Description/Behaviour** | +----------------------------------+----------------------------------+ | NIDD submission response receipt | On receipt of NIDD submit | | | response to NIDD submit request, | | | the NIDD submission container | | | shall be added to the | | | CPDT-SNN-CDR. | +----------------------------------+----------------------------------+ | NIDD submission | On sending of NIDD submit | | | response to received NIDD submit | | response sending | request, the NIDD submission | | | container shall be added to the | | | CPDT-SCE-CDR. | +----------------------------------+----------------------------------+
##### 5.2.3.3.3 Triggers for CPDT-SNN-CDR closure - IWK-SCEF
The CPDT-SNN-CDR shall be closed on encountering any of the following trigger
conditions identified in Table 5.2.3.3.3.1:
Table 5.2.3.3.3.1: Triggers for CPDT-SNN-CDR closure- IWK-SCEF
+-------------------------+-------------------------------------------+ | **Closure Conditions** | **Description/Behaviour** | +-------------------------+-------------------------------------------+ | PDN connection release. | PDN connection release shall result in | | | the CDR being closed. | | | | | | The trigger condition covers: | | | | | | > \- termination of PDN connection; | | | > | | | > \- PLMN Change; | | | > | | | > \- any abnormal release. | +-------------------------+-------------------------------------------+ | Partial Record Reason | Partial Record Reason, shall result in | | | the CDR being closed. | | | | | | The trigger condition covers: | | | | | | > \- data volume limit; | | | > | | | > \- time (duration limit); | | | > | | | > \- maximum number of NIDD submissions; | | | > | | | > \- MME change; | | | > | | | > \- Serving PLMN Rate Control change; | | | > | | | > \- radio access technology change (RAT | | | > Type); | | | > | | | > \- Management intervention. | +-------------------------+-------------------------------------------+
The Partial Record generation trigger thresholds are those associated with the
Charging Characteristics.\ The Partial Record generation trigger thresholds
are IWK-SCEF configuration parameters defined per Charging Characteristics
profile by the operator through OAM&P means, as specified in Annex A.
In the event that the CPDT-SNN-CDR is closed and the PDN connection remains
active, a further CPDT-SNN-CDR is opened with an incremented Sequence Number.
NOTE: Inter-RAT mobility between NB-IoT and other RAT is not supported in this
release.
#### 5.2.3.4 Triggers for CPDT-SNN-CDR creation and closure - MME
##### 5.2.3.4.1 General
When supported, a CPDT-SNN-CDR is used to collect charging information related
to Control Plane data transfer offline charging from a MME.
A CPDT-SNN-CDR shall be opened at PDN connection start for this MME, i.e. upon
PDN connection creation and Mobility to this new MME.
A CPDT-SNN-CDR shall be closed as described in subclause 5.2.3.4.3.
Charging information shall be added to a CPDT-SNN-CDR as described in
subclause 5.2.3.4.2.
##### 5.2.3.4.2 Triggers for CPDT-SNN-CDR charging information addition - MME
The \"List of NIDD submissions\" attributes of the CPDT-SNN-CDR consists of a
set of containers. Each container identifies a NIDD submission and shall be
added to the \"List of NIDD submissions\" per table 5.2.3.4.2.1 trigger
conditions. Details of the container are defined in clause 6.1.3.4.
Table 5.2.3.4.2.1 identifies which conditions are supported to trigger CPDT-
SNN-CDR charging information addition.
Table 5.2.3.4.2.1: Triggers for CPDT-SNN-CDR charging information addition -
MME
* * *
**Trigger Conditions** **Description/Behaviour** NIDD submission response
receipt On receipt of NIDD submit response to NIDD submit request, the NIDD
submission container shall be added to the CPDT-SNN-CDR. NIDD delivery to the
UE On NIDD delivery to the UE, the NIDD submission container shall be added to
the CPDT-SNN-CDR. NIDD submission timeout On timer expiry due to no NIDD
submit response to a NIDD submit request, the NIDD submission container shall
be added to the CPDT-SCE-CDR. NIDD delivery from the UE error Error cases on
receipt of NIDD delivery from the UE.
* * *
##### 5.2.3.4.3 Triggers for CPDT-SNN-CDR closure - MME
The CPDT-SNN-CDR shall be closed on encountering any of the following trigger
conditions identified in Table 5.2.3.4.3.1:
Table 5.2.3.4.3.1: Triggers for CPDT-SNN-CDR closure -- MME
+-------------------------+-------------------------------------------+ | **Closure Conditions** | **Description/Behaviour** | +-------------------------+-------------------------------------------+ | PDN connection release. | PDN connection release shall result in | | | the CDR being closed. | | | | | | The trigger condition covers: | | | | | | > \- termination of PDN connection; | | | > | | | > \- MME Change; | | | > | | | > \- any abnormal release. | +-------------------------+-------------------------------------------+ | Partial Record Reason | Partial Record Reason, shall result in | | | the CDR being closed. | | | | | | The trigger condition covers: | | | | | | > \- data volume limit; | | | > | | | > \- time (duration limit); | | | > | | | > \- maximum number of NIDD submissions; | | | > | | | > \- Serving PLMN Rate Control change; | | | > | | | > \- radio access technology change (RAT | | | > Type); | | | > | | | > \- Management intervention. | +-------------------------+-------------------------------------------+
The Partial Record generation trigger thresholds are those associated with the
Charging Characteristics.\ The Partial Record generation trigger thresholds
are MME configuration parameters defined per Charging Characteristics profile
by the operator through OAM&P means, as specified in Annex A.
In the event that the CPDT-SNN-CDR is closed and the PDN connection remains
active, a further CPDT-SNN-CDR is opened with an incremented Sequence Number.
NOTE: Inter-RAT mobility between NB-IoT and other RAT is not supported in this
release.
### 5.2.4 Ga record transfer flows
Details of the Ga protocol application are specified in TS 32.295 [54].
### 5.2.5 Bx CDR file transfer
Details of the Bx protocol application are specified in TS 32.297 [52].
## 5.3 CP data transfer domain online charging scenarios
### 5.3.1 Basic principles
Not specified in the present document.
### 5.3.2 Ro message flows
Not specified in the present document.
# 6\. Definition of charging information
## 6.1 Data description for CP data transfer offline charging
### 6.1.1 Rf message contents
#### 6.1.1.1 General
The CP data transfer offline charging uses the Charging Data Transfer messages
Charging Data Request and Charging Data Response defined in TS 32.299 [50].
The Charging Data Request can be of type [Start, Interim and Stop], and
includes all charging information. The Charging Data Response is an
acknowledgement of the Charging Data Request.
Table 6.1.1.1.1 describes the use of these messages for offline charging.
Table 6.1.1.1.1: Offline charging messages reference table
* * *
**Message** **Source** **Destination** Charging Data Request CPCN CDF Charging
Data Response CDF CPCN
* * *
The following clauses describe the different fields used in the Charging Data
messages and the category in the tables is used according to the charging data
configuration defined in clause 5.4 of TS 32.240 [1].
#### 6.1.1.2 Charging data request message
Table 6.1.1.2.1 illustrates the basic structure of a Charging Data Request
message from the CPCN as used for Control Plane data transfer offline
charging.
Table 6.1.1.2.1: Charging Data Request message contents
* * *
**Information Element** **Category** **Description** Session Identifier M
Described in TS 32.299 [50] Originator Host M Described in TS 32.299 [50]
Originator Domain M Described in TS 32.299 [50] Destination Domain M Described
in TS 32.299 [50] Operation Type M Described in TS 32.299 [50] Operation
Number M Described in TS 32.299 [50] Operation Identifier O~C~ Described in TS
32.299 [50] User Name O~C~ Described in TS 32.299 [50] Destination Host O~C~
Described in TS 32.299 [50] Operation Interval O~C~ Described in TS 32.299
[50] Origination State O~C~ Described in TS 32.299 [50] Origination Timestamp
O~C~ Described in TS 32.299 [50] Proxy Information O~C~ Described in TS 32.299
[50] Route Information O~C~ Described in TS 32.299 [50] Operation Token O~M~
This field identifies the CP data transfer domain service. Service Information
O~M~ This field holds the Control Plane data transfer specific information
described in clause 6.3.
* * *
NOTE: Detailed descriptions of the information elements are provided in TS
32.299 [50].
#### 6.1.1.3 Charging data response message
Table 6.1.1.3.1 illustrates the basic structure of a Charging Data Response
message as used for Control Plane data transfer offline charging.
Table 6.1.1.3.1: Charging Data Response message contents
* * *
**Information Element** **Category** **Description** Session Identifier M
Described in TS 32.299 [50] Operation Result M Described in TS 32.299 [50]
Originator Host M Described in TS 32.299 [50] Originator Domain M Described in
TS 32.299 [50] Operation Type M Described in TS 32.299 [50] Operation Number
O~C~ Described in TS 32.299 [50] Operation Identifier O~C~ Described in TS
32.299 [50] Operation Interval O~C~ Described in TS 32.299 [50] Error
Reporting Host O~C~ Described in TS 32.299 [50] Origination State O~C~
Described in TS 32.299 [50] Origination Timestamp O~C~ Described in TS 32.299
[50] Proxy Information O~C~ Described in TS 32.299 [50]
* * *
NOTE: Detailed descriptions of the information elements are provided in TS
32.299 [50].
### 6.1.2 Ga message contents
Refer to clause 5.2.4 for further information.
### 6.1.3 CDR description on the B~cp~ interface
#### 6.1.3.1 General
The following standard CDRs content and format are considered:
\- CPDT-SCE-CDR generated for Control Plane data transfer from the SCEF;
\- CPDT-SNN-CDR generated for Control Plane data transfer from the IWK-
SCEF/MME.
For each of the CDR types, a parameter table, which gives a short description
of the parameters, is provided. The category in the tables is used according
to the charging data configuration defined in clause 5.4 of TS 32.240 [1].
Full definitions of the CDR parameters, sorted by the name in alphabetical
order, are provided in TS 32.298 [51]
#### 6.1.3.2 SCEF Control Plane data transfer charging data (CPDT-SCE-CDR)
Control Plane data transfer record shall be produced for each PDN connection
to the SCEF. The fields in the record are specified in table 6.1.3.2.1.
Table 6.1.3.2.1: SCEF Control Plane data transfer charging data (CPDT-SCE-CDR)
+--------------------------+--------------+--------------------------+ | **Field** | **Category** | **Description** | +--------------------------+--------------+--------------------------+ | Record Type | M | SCEF Control Plane data | | | | transfer record. | +--------------------------+--------------+--------------------------+ | Retransmission | Oc | This parameter, when | | | | present, indicates that | | | | information from | | | | retransmitted Accounting | | | | Requests has been used | | | | in this CDR. | +--------------------------+--------------+--------------------------+ | Served IMSI | C | IMSI of the served | | | | party, if available. | +--------------------------+--------------+--------------------------+ | Served MSISDN | OC | The primary MSISDN of | | | | the subscriber, if | | | | available. | +--------------------------+--------------+--------------------------+ | Served IMEI | OC | The IMEI or IMEISV of | | | | the ME, if available. | +--------------------------+--------------+--------------------------+ | Charging ID | M | Charging identifier used | | | | to identify this PDN | | | | connection in different | | | | records created by | | | | CPCNs. | +--------------------------+--------------+--------------------------+ | Service Context Id | OM | This parameter indicates | | | | the CDR is applicable to | | | | Control Plane data | | | | transfer service. | +--------------------------+--------------+--------------------------+ | Node Id | OM | Name of the recording | | | | entity. | +--------------------------+--------------+--------------------------+ | Record Opening Time | M | Time stamp when the CDF | | | | opened the record: at | | | | PDN connection start or | | | | on subsequent partial | | | | records. | +--------------------------+--------------+--------------------------+ | Duration | M | Duration of this record | | | | in the SCEF | +--------------------------+--------------+--------------------------+ | Access Point Name | OM | The logical name of the | | Network Identifier | | connected access point | | | | to the external packet | | | | data network (network | | | | identifier part of APN). | +--------------------------+--------------+--------------------------+ | SCEF ID | M | This parameter holds the | | | | identity of the SCEF | | | | used for this PDN | | | | connection. | +--------------------------+--------------+--------------------------+ | Charging Characteristics | M | The Charging | | | | Characteristics applied | | | | to the PDN connection. | +--------------------------+--------------+--------------------------+ | Charging Characteristics | OM | Holds information about | | Selection Mode | | how Charging | | | | Characteristics were | | | | selected. | +--------------------------+--------------+--------------------------+ | RAT Type | OC | This field indicates the | | | | Radio Access Technology | | | | (RAT) type currently | | | | used by the Mobile | | | | Station as defined in TS | | | | 29.061 [207], when | | | | available. | +--------------------------+--------------+--------------------------+ | Serving Node Identity | M | MME Identity used during | | | | this record. | +--------------------------+--------------+--------------------------+ | Serving Node PLMN | OM | This fields holds the | | Identifier | | PLMN Identifier (MCC and | | | | MNC) serving the UE | | | | during this record. | +--------------------------+--------------+--------------------------+ | Serving PLMN Rate | OC | This field holds the | | Control | | Serving PLMN Rate | | | | Control used by the MME | | | | during this record | +--------------------------+--------------+--------------------------+ | List of NIDD submissions | OC | This field holds the | | | | list of NIDD submission | | | | containers. | | | | | | | | Each NIDD submission is | | | | time stamped, and | | | | contains the volume | | | | submitted, result of the | | | | submission and other | | | | information associated | | | | to this submission. See | | | | table 6.1.3.4.1 for a | | | | description of List of | | | | NIDD submissions. | +--------------------------+--------------+--------------------------+ | External Identifier | OC | This field holds the | | | | external Identifier | | | | identifying the served | | | | party associated to the | | | | IMSI, if available. | +--------------------------+--------------+--------------------------+ | APN Rate Control | OC | This field holds the | | | | list of APN Rate | | | | Controls enforced in the | | | | SCEF during this record. | +--------------------------+--------------+--------------------------+ | Cause for Record Closing | M | The reason for the | | | | release of record from | | | | this SCEF. | +--------------------------+--------------+--------------------------+ | Diagnostics | OM | A more detailed reason | | | | for the release of the | | | | PDN connection, when a | | | | single cause is | | | | applicable. | +--------------------------+--------------+--------------------------+ | Local Record Sequence | OM | Consecutive record | | Number | | number created by this | | | | node. The number is | | | | allocated sequentially | | | | including all CDR types. | +--------------------------+--------------+--------------------------+ | Record Sequence Number | C | Partial record sequence | | | | number, only present in | | | | case of partial records. | +--------------------------+--------------+--------------------------+ | Record Extensions | OC | A set of network | | | | operator/manufacturer | | | | specific extensions to | | | | the record. Conditioned | | | | upon the existence of an | | | | extension. | +--------------------------+--------------+--------------------------+
#### 6.1.3.3 Serving Network Control Plane data transfer charging data for
IWK-SCEF/MME (CPDT-SNN-CDR)
If enabled, a Control Plane data transfer record shall be produced for each
PDN connection to the IWK-SCEF/MME. The fields in the record are specified in
table 6.1.3.3.1.
Table 6.1.3.3.1: Serving Network Control Plane data transfer charging data
(CPDT-SNN-CDR)
+--------------------------+--------------+--------------------------+ | **Field** | **Category** | **Description** | +--------------------------+--------------+--------------------------+ | Record Type | M | IWK-Serving Network | | | | Control Plane data | | | | transfer record. | +--------------------------+--------------+--------------------------+ | Retransmission | Oc | This parameter, when | | | | present, indicates that | | | | information from | | | | retransmitted Accounting | | | | Requests has been used | | | | in this CDR. | +--------------------------+--------------+--------------------------+ | Served IMSI | C | IMSI of the served | | | | party, if available. | +--------------------------+--------------+--------------------------+ | Served MSISDN | OC | The primary MSISDN of | | | | the subscriber, if | | | | available. | +--------------------------+--------------+--------------------------+ | Served IMEI | OC | The IMEI or IMEISV of | | | | the ME, if available. | +--------------------------+--------------+--------------------------+ | Charging ID | M | Charging identifier used | | | | to identify this PDN | | | | connection in different | | | | records created by | | | | CPCNs. | +--------------------------+--------------+--------------------------+ | Service Context Id | OM | This parameter indicates | | | | the CDR is applicable to | | | | Control Plane data | | | | transfer service. | +--------------------------+--------------+--------------------------+ | Node Id | OM | Name of the recording | | | | entity. | +--------------------------+--------------+--------------------------+ | Record Opening Time | M | Time stamp when the CDF | | | | opened the record: at | | | | PDN connection start or | | | | on subsequent partial | | | | records. | +--------------------------+--------------+--------------------------+ | Duration | M | Duration of this record | | | | in the Serving Network | | | | Node. | +--------------------------+--------------+--------------------------+ | Access Point Name | OM | The logical name of the | | Network Identifier | | connected access point | | | | to the external packet | | | | data network (network | | | | identifier part of APN). | +--------------------------+--------------+--------------------------+ | SCEF ID | M | This parameter holds the | | | | identity of the SCEF | | | | used for this PDN | | | | connection. | +--------------------------+--------------+--------------------------+ | Charging Characteristics | M | The Charging | | | | Characteristics applied | | | | to the PDN connection. | +--------------------------+--------------+--------------------------+ | Charging Characteristics | OM | Holds information about | | Selection Mode | | how Charging | | | | Characteristics were | | | | selected. | +--------------------------+--------------+--------------------------+ | RAT Type | OC | This field indicates the | | | | Radio Access Technology | | | | (RAT) type currently | | | | used by the Mobile | | | | Station as defined in TS | | | | 29.061 [207], when | | | | available. | +--------------------------+--------------+--------------------------+ | Serving Node Identity | M | MME Identity used during | | | | this record. | +--------------------------+--------------+--------------------------+ | Serving Node PLMN | OC | This fields holds the | | Identifier | | PLMN Identifier (MCC and | | | | MNC) serving the UE | | | | during this record. | +--------------------------+--------------+--------------------------+ | Serving PLMN Rate | OC | This field holds the | | Control | | Serving PLMN Rate | | | | Control used by the MME | | | | during this record. | +--------------------------+--------------+--------------------------+ | List of NIDD submissions | OC | This field holds the | | | | list of NIDD submission | | | | containers. | | | | | | | | Each NIDD submission is | | | | time stamped, and | | | | contains the volume | | | | submitted, result of the | | | | submission and other | | | | information associated | | | | to this submission. See | | | | table 6.1.3.4.1 for a | | | | description of List of | | | | NIDD submissions. | +--------------------------+--------------+--------------------------+ | Cause for Record Closing | M | The reason for the | | | | release of record from | | | | this Serving Network | | | | Node. | +--------------------------+--------------+--------------------------+ | Diagnostics | OM | A more detailed reason | | | | for the release of the | | | | PDN connection, when a | | | | single cause is | | | | applicable. | +--------------------------+--------------+--------------------------+ | Local Record Sequence | OM | Consecutive record | | Number | | number created by this | | | | node. The number is | | | | allocated sequentially | | | | including all CDR types. | +--------------------------+--------------+--------------------------+ | Record Sequence Number | C | Partial record sequence | | | | number, only present in | | | | case of partial records. | +--------------------------+--------------+--------------------------+ | Record Extensions | OC | A set of network | | | | operator/manufacturer | | | | specific extensions to | | | | the record. Conditioned | | | | upon the existence of an | | | | extension. | +--------------------------+--------------+--------------------------+
#### 6.1.3.4 NIDD submission
Table 6.1.3.4.1 contains the description fields in the List of NIDD
submissions.
Table 6.1.3.4.1: NIDD submission within List of NIDD submissions
* * *
**Field** **Category** **Description** Submission Timestamp OC This field
holds the time stamp when the data transfer request NIDD submission was
submitted to the CPCN node. Event Timestamp OC This field holds the time stamp
when the event triggered the generation of charging information from the CPCN
node, for the NIDD submission. Data Volume Downlink OC This field includes the
number of octets transmitted during the NIDD submission in downlink direction.
Data Volume Uplink OC This field includes the number of octets transmitted
during the NIDD submission in uplink direction. Service Change Condition OC
This field holds the specific reason for the NIDD submission container, e.g.
NIDD submission response receipt, NIDD submission response sending, NIDD
delivery to the UE, NIDD submission timeout, NIDD delivery from the UE error.
Submission Result Code OC This field includes the result of NIDD submission.
* * *
## 6.2 Data description for CP data transfer online charging
### 6.2.1 Ro message contents
Not specified in the present document.
## 6.3 CP data transfer charging specific parameters
### 6.3.1 Definition of CP data transfer charging information
#### 6.3.1.1 CP data transfer charging information assignment for Service
Information
The components in the Service Information that are used for CP data transfer
charging can be found in table 6.3.1.1.1.
Table 6.3.1.1.1: Service Information used for CP data transfer charging
+----------------------------+----------+----------------------------+ | Information Element | Category | Description | +----------------------------+----------+----------------------------+ | Service Information | O~M~ | This is a structured field | | | | and holds the 3GPP | | | | specific parameter as | | | | defined in TS 32.299 | | | | [50]. | +----------------------------+----------+----------------------------+ | > Subscriber Identifier | O~M~ | This field contains the | | | | identification of the user | | | | (i.e. IMSI, and MSISDN if | | | | any). | +----------------------------+----------+----------------------------+ | > IMS Information | O~M~ | This is a structured field | | | | and holds IMS specific | | | | parameters.\ | | | | The complete structure is | | | | defined in TS 32.260 | | | | [20]. | +----------------------------+----------+----------------------------+ | > Node Functionality | O~M~ | This field contains the | | | | function of the CPCN node | | | | (i.e. SCEF, IWK-SCEF, MME) | +----------------------------+----------+----------------------------+ | > PS Information | O~M~ | This is a structured IE | | | | and hold PS specification | | | | parameters.\ | | | | The complete structure is | | | | defined in TS | | | | 32.251 [11]. | +----------------------------+----------+----------------------------+ | > PDN Connection Charging | O~M~ | This parameter holds the | | > Identifier | | Charging Id for this PDN | | | | connection (this together | | | | with the SCEF ID | | | | constitutes a unique | | | | identifier for the PDN | | | | connection). | +----------------------------+----------+----------------------------+ | > Node Id | Oc | This IE holds the name of | | | | the Node. | +----------------------------+----------+----------------------------+ | > Called Station Id | OC | This parameter contains | | | | the identifier of the | | | | access point (APN) the | | | | user is connected to. | +----------------------------+----------+----------------------------+ | > Charging Characteristics | OC | The Charging | | | | Characteristics applied to | | | | this PDN connection in the | | | | CPCN. | +----------------------------+----------+----------------------------+ | > Charging Characteristics | OC | Holds information about | | > Selection Mode | | how Charging | | | | Characteristics were | | | | selected. | +----------------------------+----------+----------------------------+ | > User Equipment Info | OC | This field holds the | | | | identification of the | | | | terminal (IMEI or IMEISV). | +----------------------------+----------+----------------------------+ | > RAT Type | OC | This field indicates which | | | | Radio Access Technology | | | | (RAT) is currently serving | | | | the UE as defined in TS | | | | 29.061 [207]. | +----------------------------+----------+----------------------------+ | > Serving Node MCC MNC | OC | This field holds the MCC | | | | and MNC serving the UE. | +----------------------------+----------+----------------------------+ | > Serving PLMN Rate | OC | This parameter holds the | | > Control | | Serving PLMN Rate Control | | | | used by MME during this | | | | record | +----------------------------+----------+----------------------------+ | > APN Rate Control | OC | This parameter holds the | | | | APN Rate Control enforced | | | | in the SCEF during this | | | | record. | +----------------------------+----------+----------------------------+ | > Change Condition | Oc | This field holds the | | | | reason for sending | | | | Charging Data Request from | | | | the CPCN. | +----------------------------+----------+----------------------------+ | > Diagnostics | OC | This parameter holds a | | | | more detailed reason for | | | | the release of the PDN | | | | connection, when a single | | | | cause is applicable, and | | | | complements the \"Change | | | | Condition\" information. | +----------------------------+----------+----------------------------+ | > CPDT Information | O~M~ | This is a structured field | | | | and holds the CP data | | | | transfer specific | | | | parameters.\ | | | | The details are defined in | | | | clause 6.3.1.2. | +----------------------------+----------+----------------------------+
#### 6.3.1.2 Definition of the CP data transfer Information
CP data transfer specific charging information is provided within the CPDT
Information. The fields of the CPDT Information are indicated with the CPCN
node (SCEF, IWK-SCEF, MME) from which the information is sent.
The detailed structure of the CPDT Information can be found in table
6.3.1.2.1.
Table 6.3.1.2.1: Structure of the CPDT Information
+------------------------+----------+----------------------------+ | Information Element | Category | Description | +------------------------+----------+----------------------------+ | External Identifier | OC | This parameter holds the | | | | external Identifier | | | | identifying the served | | | | party associated to the | | | | IMSI, if available | +------------------------+----------+----------------------------+ | SCEF ID | OC | This parameter holds the | | | | identity of the SCEF used | | | | for this PDN connection. | +------------------------+----------+----------------------------+ | Serving Node Identity | OC | This parameter holds the | | | | MME Identity of the MME | | | | serving the UE. | +------------------------+----------+----------------------------+ | Serving Node Change | O~C~ | This parameter is present | | | | if this is first Charging | | | | Data Request after a | | | | change from another MME. | +------------------------+----------+----------------------------+ | NIDD submission | OC | This parameter holds the | | | | NIDD submission container | | | | associated to trigger | | | | conditions met. | +------------------------+----------+----------------------------+ | > Submission Timestamp | OC | This parameter holds the | | | | time stamp when the data | | | | transfer request NIDD | | | | submission was submitted | | | | to the CPCN Node. | +------------------------+----------+----------------------------+ | > Event Timestamp | OC | This parameter holds the | | | | time stamp when the event | | | | triggered the generation | | | | of charging information | | | | from the CPCN Node, for | | | | the NIDD submission. | +------------------------+----------+----------------------------+ | > Data Volume Uplink | OC | This parameter holds the | | | | data volume transmitted in | | | | uplink direction | +------------------------+----------+----------------------------+ | > Data Volume Downlink | OC | This parameter holds the | | | | data volume transmitted in | | | | downlink direction | +------------------------+----------+----------------------------+ | > Change Condition | Oc | This parameter holds the | | | | specific reason for the | | | | NIDD submission container | | | | to be added, e.g. NIDD | | | | submission response | | | | receipt, NIDD submission | | | | response sending, NIDD | | | | delivery to the UE, NIDD | | | | submission timeout, NIDD | | | | delivery from the UE | | | | error. | +------------------------+----------+----------------------------+ | > Result Code | OC | This parameter holds the | | | | result of NIDD submission | +------------------------+----------+----------------------------+
### 6.3.2 Detailed message format for offline charging
The following clause specifies per Operation Type the charging data that are
sent by CPCN for CP data transfer offline charging.
The Operation Types are listed in the following order: S (Start)/I (Interim)/S
(Stop)/E (Event). Therefore, when all Operation Types are possible it is
marked as SISE. If only some Operation Types are allowed for a node, only the
appropriate letters are used (i.e. SIS or E) as indicated in the table
heading. The omission of an Operation Type for a particular field is marked
with \"-\" (i.e. SI-E). Also, when an entire field is not allowed in a node
the entire cell is marked as \"-\".
Table 6.3.2.1 illustrates the basic structure of the supported fields in the
_Charging Data_ Request message for CP data transfer offline charging.
Table 6.3.2.1: Supported fields in _Charging Data Request message_
* * *
**Information Element** **Node Type** **MME** **IWK-SCEF** **SCEF**
**Supported Operation Types** **S/I/S/E** **S/I/S/E** **S/I/S/E** Session
Identifier SIS- SIS- SIS-  
Originator Host SIS- SIS- SIS-  
Originator Domain SIS- SIS- SIS-  
Destination Domain SIS- SIS- SIS-  
Operation Type SIS- SIS- SIS-  
Operation Number SIS- SIS- SIS-  
Operation Identifier SIS- SIS- SIS-  
User Name SIS- SIS- SIS-  
Destination Host SIS- SIS- SIS-  
Operation Interval SIS- SIS- SIS-  
Origination State SIS- SIS- SIS-  
Origination Timestamp SIS- SIS- SIS-  
Proxy Information SIS- SIS- SIS-  
Route Information SIS- SIS- SIS-  
Operation Token SIS- SIS- SIS-  
Subscriber Identifier SIS- SIS- SIS-  
Node Functionality SIS- SIS- SIS-  
PDN Connection Charging Id SIS- SIS- SIS-  
Node Id SIS- SIS- SIS-  
Called Station Id SIS- SIS- SIS-  
Charging Characteristics SIS- SIS- SIS-  
Charging Characteristics Selection Mode SIS- SIS- SIS-  
User Equipment Info SIS- SIS- SIS-  
RAT Type SIS- SIS- SIS-  
Serving Node MCC MNC SIS- SIS- SIS-  
Serving PLMN Rate Control SIS- SIS- SIS-  
APN Rate Control - - SIS-  
Change Condition SIS- SIS- SIS-  
Diagnostics SIS- SIS- SIS-  
External Identifier SIS- SIS- SIS-  
SCEF ID SIS- SIS- SIS-  
Serving Node Identity SIS- SIS- SIS-  
Serving Node Change S--- - -  
NIDD submission SIS- SIS- SIS-
* * *
### 6.3.3 Detailed message format for online charging
Not specified in the present document.
## 6.4 Bindings for CP data transfer offline charging
This clause aims to describe the mapping between the Diameter Accounting AVP,
IEs and CDR parameters for CP data transfer offline charging.
Table 6.4.1 describes the mapping of the Diameter Accounting AVP, IEs and CDR
to the CDR parameters of CPCN-SNN-CDR (MME, IWK-SCEF) and CPCN-SCE-CDR.
Table 6.4.1: Bindings of CDR Parameters, Information Elements and AVPs
+----------------------+----------------------+----------------------+ | **CDR Parameter** | **Information |** AVP**| | | Element** | | +----------------------+----------------------+----------------------+ | Record Opening Time | **-** | **-** | +----------------------+----------------------+----------------------+ | Local Record | **-** | **-** | | Sequence Number | | | +----------------------+----------------------+----------------------+ | Duration | **-** | **-** | +----------------------+----------------------+----------------------+ | Service Context Id | Service Context Id | Service-Context-Id | +----------------------+----------------------+----------------------+ | | **Service |** S | | | Information**| ervice-Information** | +----------------------+----------------------+----------------------+ | Served IMSI | Subscriber | Subscription-Id | | | Identifier | | +----------------------+----------------------+----------------------+ | Served MSISDN | Subscriber | Subscription-Id | | | Identifier | | +----------------------+----------------------+----------------------+ | | **IMS Information** | **IMS-Information** | +----------------------+----------------------+----------------------+ | Record Type | Node Functionality | Node-Functionality | +----------------------+----------------------+----------------------+ | | **PS Information** | **PS-Information** | +----------------------+----------------------+----------------------+ | Charging ID | Charging Id | 3GPP-Charging-Id | +----------------------+----------------------+----------------------+ | Node Id | Node Id | Node-ID | +----------------------+----------------------+----------------------+ | Access Point Name | Called Station Id | Called-Station-Id | | Network Identifier | | | +----------------------+----------------------+----------------------+ | Charging | Charging | 3GPP-Char | | Characteristics | Characteristics | ging-Characteristics | +----------------------+----------------------+----------------------+ | Charging | Charging | Charging-Characteri | | Characteristics | Characteristics | stics-Selection-Mode | | Selection Mode | Selection Mode | | +----------------------+----------------------+----------------------+ | _Served IMEI_ | User Equipment Info | User-Equipment-Info | +----------------------+----------------------+----------------------+ | RAT Type | RAT Type | _3_ GPP-RAT-Type | +----------------------+----------------------+----------------------+ | Serving node PLMN | Serving Node MCC MNC | 3GPP-SGSN-MCC-MNC | | Identifier | | | +----------------------+----------------------+----------------------+ | Serving PLMN Rate | Serving PLMN Rate | Servi | | Control | Control | ng-PLMN-Rate-Control | +----------------------+----------------------+----------------------+ | APN Rate Control | APN Rate Control | APN-Rate-Control | +----------------------+----------------------+----------------------+ | Cause for Record | Change Condition | Change-Condition | | Closing | | | +----------------------+----------------------+----------------------+ | Diagnostics | Diagnostics | Diagnostics | +----------------------+----------------------+----------------------+ | | **CPDT Information** | **CPDT-Information** | +----------------------+----------------------+----------------------+ | External Identifier | External Identifier | External-Identifier | +----------------------+----------------------+----------------------+ | SCEF ID | SCEF ID | SCEF-ID | +----------------------+----------------------+----------------------+ | Serving Node | Serving Node | S | | Identity | Identity | erving-Node-Identity | +----------------------+----------------------+----------------------+ | Serving Node Change | Serving Node Change | SGW-Change | +----------------------+----------------------+----------------------+ | List of NIDD | NIDD submission | NIDD-submission | | submissions | | | +----------------------+----------------------+----------------------+ | > Submission | > Submission | > | | > Timestamp | > Timestamp | Submission-Timestamp | +----------------------+----------------------+----------------------+ | > Event Timestamp | > Event Timestamp | > Event-Timestamp | +----------------------+----------------------+----------------------+ | > Data Volume Uplink | > Data Volume Uplink | > Acco | | | | unting-Output-Octets | +----------------------+----------------------+----------------------+ | > Data Volume | > Data Volume | > Acc | | > Downlink | > Downlink | ounting-Input-Octets | +----------------------+----------------------+----------------------+ | > Service Change | > Change Condition | > Change-Condition | | > Condition | | | +----------------------+----------------------+----------------------+ | > Submission Result | > Result Code | > Result-Code | | > Code | | | +----------------------+----------------------+----------------------+
###### ## Annex A (normative): Charging characteristics
# A.1 General
Charging Characteristics can be supplied by the HSS to the MME as part of the
subscription information. Upon PDN connection to the SCEF (decided by the MME
for a non-IP PDN connection to an APN associated with an \"Invoke SCEF
Selection\" indicator), the MME forwards the Charging Characteristics
parameter to the SCEF, if deployed for roaming to the IWK-SCEF. A subscriber
may have Charging Characteristics assigned to his subscription and/or his
subscribed APNs. Default charging characteristics may also be pre-provisioned
on the CPCN.
Each CPCN may either apply the Charging Characteristics provided by the HSS or
ignore it to apply a default configuration. Consequently, the network may
apply:
\- The Charging Characteristics provided by the HSS
\- The Home default behaviour (the MME belongs to the Home PLMN)
\- The Roaming default behaviour (the MME belongs to the Visited PLMN)
The Charging Characteristics parameter format is specified TS 32.298 [51].
Each bit of the string of 16 bits corresponds to a specific charging behaviour
which is defined on a per operator basis, configured within the CPCN and
pointed when bit is set to \"1\" value.
For example, one way to define a charging behaviour could be to associate it
to a specific usage, which may consist of a set of trigger profiles associated
to CDR types e.g.:
**\- CPDT-SCE-CDR:** activate/deactivate CDRs, time limit, data volume limit,
maximum number of NIDD submissions;
**\- CPDT-SNN-CDR:** same as CPDT-SCE-CDR**.**
In addition to these trigger sets, a CDF/CGF address may also be included.
#
# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# Introduction
The present document is part 2 of a multi-part TS:
> 3GPP TS 37.571-1: User Equipment (UE) conformance specification for UE
> positioning; Part 1: Conformance test specification.
>
> **3GPP TS 37.571-2: User Equipment (UE) conformance specification for UE
> positioning; Part 2: Protocol conformance.**
>
> **3GPP TS 37.** 571**-3:** User Equipment (UE) conformance specification for
> UE positioning; **Part 3: Implementation Conformance Statement (ICS).**
>
> **3GPP TS 37.** 571**-4:** User Equipment (UE) conformance specification for
> UE positioning; **Part 4: Test suites.**
>
> **3GPP TS 37.** 571**-5:** User Equipment (UE) conformance specification for
> UE positioning; **Part 5: Test scenarios and assistance data.**
# 1 Scope
The present document specifies the protocol conformance testing for UTRAN,
E-UTRAN and NR User Equipment (UE) supporting UE positioning.
This is the second part of a multi-part test specification. The following
information can be found in this part:
\- the overall protocol conformance test structure;
\- the protocol conformance test configurations;
\- the conformance requirement and reference to the core specifications;
\- the test purposes; and
\- a brief description of the test procedure, the specific test requirements
and short message exchange table.
The Implementation Conformance Statement (ICS) pro-forma could be found in the
3^rd^ part of the present document.
The present document is valid for UE supporting UE positioning implemented
according to 3GPP releases starting from Release 99 up to the Release
indicated on the cover page of the present document.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document in the same
Release as the present document unless the context in which the reference is
made suggests a different Release is relevant (information on the applicable
release in a particular context can be found in e.g. test case title,
description or applicability, message description or content).
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.271: \"Functional stage 2 description of Location Services
(LCS) \".
[3] 3GPP TS 36.305: \"Stage 2 functional specification of User Equipment (UE)
positioning in E-UTRAN\".
[4] 3GPP TS 36.355: \"LTE Positioning Protocol (LPP)\".
[5] 3GPP TS 24.171: \"Control Plane Location Services (LCS) procedures in the
Evolved Packet System (EPS)\".
[6] 3GPP TS 24.030: \"Location Services (LCS); Supplementary service
operations; Stage 3\".
[7] 3GPP TS 24.080: \"Mobile radio interface layer 3 supplementary services
specification; Formats and coding\".
[8] 3GPP TS 36.508: \"Common test environments for User Equipment (UE)\".
[9] 3GPP TS 37.571-1: \"User Equipment (UE) conformance specification for UE
positioning;\ Part 1: Conformance test specification\".
[10] 3GPP TS 37.571-3: \"User Equipment (UE) conformance specification for UE
positioning; **\ Part 3: Implementation Conformance Statement (ICS)** \".
[11] 3GPP TS 37.571-4: \"User Equipment (UE) conformance specification for UE
positioning; **\ Part 4: Test suites** \".
[12] 3GPP TS 37.571-5: \"User Equipment (UE) conformance specification for UE
positioning; **\ Part 5: Test scenarios and assistance data** \".
[13] 3GPP TS 36.509: \"Special conformance testing functions for User
Equipment (UE)\".
[14] 3GPP TS 34.123-1: \"User Equipment (UE) conformance specification; Part
1: Protocol conformance specification\".
[15] 3GPP TS 24.301: \"Non-Access-Stratum (NAS) protocol for Evolved Packet
System (EPS);\ Stage 3\".
[16] 3GPP TS 34.108: \"Common Test Environments for User Equipment (UE)
Conformance Testing\".
[17] 3GPP TS 25.331: \"RRC Protocol Specification\".
[18] 3GPP TS 34.109: \"Terminal logical test interface; Special conformance
testing functions\".
[19] 3GPP TS 24.008: \"Mobile radio interface Layer 3 specification; Core
network protocols;\ Stage 3\".
[20] 3GPP TS 33.102: \"3G security; Security architecture\".
[21] ICD-GPS-200: \"Navstar GPS Space Segment/Navigation User Interface\".
[22] 3GPP TS 23.171: \"Location Services (LCS); Functional description; Stage
2 (UMTS)\".
[23] GSM TS 03.71: \"Location Services (LCS); Functional description; Stage
2\".
[24] 3GPP TS 36.331: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Radio Resource Control (RRC); Protocol specification\".
[25] 3GPP TS 23.272: \"Circuit Switched (CS) fallback in Evolved Packet System
(EPS); Stage 2\".
[26] 3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for
Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".
[27] 3GPP TS 22.101: \"Service aspects; Service principles\".
[28] OMA-TS-LPPe-V2_0: \"LPP Extensions Specification\", Open Mobile Alliance.
[29] ATIS-0500027: \"Recommendations for Establishing Wide Scale Indoor
Location Performance\", May 2015.
[30] 3GPP TS 38.508-1: \"User Equipment (UE) conformance specification; Part
1: Common test environment\".
[31] 3GPP TS 38.305: \"NG Radio Access Network (NG-RAN); Stage 2 functional
specification of User Equipment (UE) positioning in NG-RAN\".
[32] 3GPP TS 37.355: \"LTE Positioning Protocol (LPP)\".
[33] 3GPP TS 38.331: \"NR Radio Resource Control (RRC) protocol
specification\".
[34] 3GPP TS 38.509: \"Special conformance testing functions for User
Equipment (UE)\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1], TS 23.271 [2],
TS 36.305 [3], TS 36.355 [4] , TS 38.305 [31] , TS 37.355 [32] apply.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
BDS BeiDou Navigation Satellite System
DL Downlink
DL-AoD Downlink Angle-of-Departure
DL-PRS Downlink Positioning Reference Signal
DL-TDOA Downlink Time Difference Of Arrival
LCS Location Services
LPP LTE Positioning Protocol
MBS Metropolitan Beacon System
MO-LR Mobile Originated Location Request
Multi-RTT Multi-Round Trip Time
MT-LR Mobile Terminated Location Request
NAS Non-Access-Stratum
NI-LR Network Induced Location Request
NR New Radio
NR E-CID NR Enhanced Cell ID (positioning method)
OTA Over The Air
RSRP Reference Signal Received Power
RSRPP Reference Signal Received Path Power
TBS Terrestrial Beacon System
TEG Timing Error Group
UL Uplink
WLAN Wireless Local Area Network
UL-SRS Uplink Sounding Reference Signal
# 4 Default Conditions for UTRAN
## 4.1 Default system information
Default system information, as specified in 3GPP TS 34.108 [16] subclause 6.1,
is broadcasted for the A-GPS test cases in subclause 6.1. For the A-GNSS test
cases in subclause 6.2, the default system information, as specified in 3GPP\
TS 36.508 [8], is broadcasted. SIB15/SIB15.x are not broadcasted unless
otherwise stated in the specific test cases.
## 4.2 Simulated A-GPS and A-GNSS environment
During A-GPS and A-GNSS tests, where required the SS shall generate satellite
signals that are of a sufficient number and strength not to prevent the UE
from responding to a positioning request with a valid measurement response.
Any assistance data provided during these tests shall be consistent with the
satellite signals generated during these tests. Note that some tests require
assistance data to be provided even though satellite signals are not required.
It is considered that six satellite signals with the level of the simulated
satellites all at -125 dBm ± 6 dB should be suitable, however this does not
imply any conformance requirements on the UE.
Suitable GPS and GNSS scenarios together with associated assistance data are
defined in TS 37.571-5 [12] subclause 5.1 and 6.1, respectively.
The accuracy of the GPS time-of-week and/or GANSS time-of-day in the provided
assistance data shall be within ± 2 seconds relative to the GPS and/or GANSS
time in the system simulator. In the case that assistance data is required but
satellite signals are not required then this clause does not apply.
During A-GNSS signalling tests where satellite signals are required, the SS
shall generate all the UE supported GNSS satellite signals.
### 4.2.1 A-GNSS sub-test cases
The A-GNSS signalling test cases in subclause 6.2 may include several sub-test
cases dependent on the GNSS supported by the UE. Each sub-test case is
identified by a Sub-Test Case Number as defined in the Table below. The
detailed assistance data depend on the particular sub-test case as defined in
subclause 4.4.
Table 4.2.1-1: Sub-Test Case Number Definition for UTRA
* * *
Sub-Test Case Number Supported GNSS 1 UE supporting A-GLONASS only 2 UE
supporting A-Galileo only 3 UE supporting A-GPS and Modernized GPS only 4 UE
supporting A-GPS^(1)^ and A-GLONASS only 8 UE supporting A-GPS^(1)^ and
A-Galileo only 9 UE supporting A-BDS only 10 UE supporting A-GPS^(1)^ and
A-BDS only NOTE 1: \"A-GPS\" includes Modernized GPS if supported by the UE.
* * *
## 4.3 A-GPS assistance data sets
This subclause defines the assistance data sets supplied by the SS in A-GPS
test cases specified in subclause 6.1.
Throughout this subclause, \"adequate assistance data\" means the assistance
data used in test cases where it is expected that a UE supporting A-GPS will
be able to perform the requested positioning operation using the supplied
assistance data, and \"inadequate assistance data\" is the assistance data
used in test cases that expect that the UE will be unable to perform the
requested operation. The values of all the fields in all cases are defined in
TS 37.571-5 [12] subclause 5.1.3.
### 4.3.1 Adequate assistance data for UE-based A-GPS
For UE-based test cases requiring adequate assistance data, the IE \"UE
positioning GPS assistance data\" is spread across two separate MEASUREMENT
CONTROL messages, and set as follows:
##### First MEASUREMENT CONTROL MESSAGE: {#first-measurement-control-message
.H6}
* * *
\- UE positioning GPS assistance data
\- UE positioning GPS reference time
\- GPS week Set according to 4.2
\- GPS Week Cycle Number Set according to 4.2 Rel-10 UE or later
\- GPS TOW msec Set according to 4.2
\- UTRAN GPS reference time Not present
\- UE Positioning GPS Reference Time\ Set according to 4.2 Rel-7 UE or later
Uncertainty
\- SFN-TOW uncertainty Not present
\- T~UTRAN-GPS~ drift rate Not present
\- GPS TOW assist Not present
\- UE positioning GPS reference UE position Set according to 4.2
\- UE positioning GPS DGPS corrections Not present
\- UE positioning GPS navigation model
\- Satellite information For satellites 1-3
\- SatID Set according to 4.2
\- Satellite status NS NN
\- GPS ephemeris and clock corr. param. Set according to 4.2
\- UE positioning GPS ionospheric model Set according to 4.2
\- UE positioning GPS UTC model Not present
\- UE positioning GPS almanac Not present
\- UE positioning GPS acquisition assistance Not present
\- UE positioning GPS real-time integrity Not present
* * *
##### Second MEASUREMENT CONTROL message: {#second-measurement-control-message
.H6}
* * *
\- UE positioning GPS assistance data  
\- UE positioning GPS reference time Not present \- UE positioning GPS
reference UE position Not present \- UE positioning GPS DGPS corrections Not
present \- UE positioning GPS navigation model  
\- Satellite information For satellites 4-6 \- SatID Set according to 4.2 \-
Satellite status NS NN \- GPS ephemeris and clock corr. param. Set according
to 4.2 \- UE positioning GPS ionospheric model Not present \- UE positioning
GPS UTC model Not present \- UE positioning GPS almanac Not present \- UE
positioning GPS acquisition assistance Not present \- UE positioning GPS real-
time integrity Not present
* * *
### 4.3.2 Inadequate assistance data for UE-based A-GPS
For UE-based test cases requiring inadequate assistance data, the IE \"UE
positioning GPS assistance data\" is set to \"Not present\" in the MEASUREMENT
CONTROL message.
### 4.3.3 Adequate assistance data for UE-assisted A-GPS
For UE-assisted test cases requiring adequate assistance data, the IE \"UE
positioning GPS assistance data\" is set as follows for the first MEASUREMENT
CONTROL message:
* * *
\- UE positioning GPS assistance data
\- UE positioning GPS reference time
\- GPS week Set according to 4.2
\- GPS Week Cycle Number Set according to 4.2 Rel-10 UE or later
\- GPS TOW msec Set according to 4.2
\- UTRAN GPS reference time Not present
\- UE Positioning GPS Reference Time\ Set according to 4.2 Rel-7 UE or later
Uncertainty
\- SFN-TOW uncertainty Not present
\- T~UTRAN-GPS~ drift rate Not present
\- GPS TOW assist Not present
\- UE positioning GPS reference UE position Not present
\- UE positioning GPS DGPS corrections Not present
\- UE positioning GPS navigation model Not present
\- UE positioning GPS ionospheric model Not present
\- UE positioning GPS UTC model Not present
\- UE positioning GPS almanac Not present
\- UE positioning GPS acquisition assistance
\- GPS TOW msec Set according to 4.2
\- UTRAN GPS reference time Not present
\- UE Positioning GPS Reference Time\ Set according to 4.2 Rel-7 UE or later
Uncertainty
\- Satellite information Set according to 4.2
\- Extra Doppler Set according to 4.2
\- Azimuth and Elevation Set according to 4.2
\- Azimuth and Elevation LSB Set according to 4.2 Rel-10 UE or later
\- UE positioning GPS real-time integrity Not present
* * *
If the UE requests further assistance data, the SS sends subsequent
MEASUREMENT CONTROL messages containing the assistance data fields requested
by the UE that are available in the SS as specified in TS 37.571-5 [12]
subclause 5.1.3 and in subclause 4.3.5.
### 4.3.4 Inadequate assistance data for UE-assisted A-GPS
For UE-assisted test cases requiring inadequate assistance data, the IE \"UE
positioning GPS assistance data\" is set to \"Not present\" in the MEASUREMENT
CONTROL message.
### 4.3.5 Response to assistance data requests from UE
If the SS needs to send assistance data in response to a request for
additional assistance data from the UE, or in response to an MO-LR request for
assistance data, the IE \"UE positioning GPS assistance data\" is set as
follows:
* * *
\- UE positioning GPS assistance data
\- UE positioning GPS reference time Set according to 4.2 if requested by the
UE
\- GPS week Set according to 4.2
\- GPS Week Cycle Number Set according to 4.2 Rel-10 UE or later
\- GPS TOW msec Set according to 4.2
\- UTRAN GPS reference time Not present
\- UE Positioning GPS Reference Time\ Set according to 4.2 Rel-7 UE or later
Uncertainty
\- SFN-TOW uncertainty Not present
\- T~UTRAN-GPS~ drift rate Not present
\- GPS TOW assist Not present
\- UE positioning GPS reference UE position Set according to 4.2 if requested
by the UE
\- UE positioning GPS DGPS corrections Not sent
\- UE positioning GPS navigation model Set according to 4.2 if requested by
the UE
\- Satellite information For satellites 1-6
\- SatID Set according to 4.2
\- Satellite status NS NN
\- GPS ephemeris and clock corr. param. Set according to 4.2
\- UE positioning GPS ionospheric model Set according to 4.2 if requested by
the UE
\- UE positioning GPS UTC model Not sent
\- UE positioning GPS almanac Set according to 4.2 if requested by the UE
\- WNa Set according to 4.2
\- Complete Almanac Provided True Rel-10 UE or later
\- Satellite information Set according to 4.2
\- SV Global Health Not present
\- UE positioning GPS acquisition assistance Set according to 4.2 if requested
by the UE
\- GPS TOW msec Set according to 4.2
\- UTRAN GPS reference time Not present
\- UE Positioning GPS Reference Time\ Set according to 4.2 Rel-7 UE or later
Uncertainty
\- Satellite information Set according to 4.2
\- Extra Doppler Set according to 4.2
\- Azimuth and Elevation Set according to 4.2
\- Azimuth and Elevation LSB Set according to 4.2 Rel-10 UE or later
\- UE positioning GPS real-time integrity Not sent
* * *
If the UE requests the GPS navigation model then the SS provides navigation
model satellite information for at most three satellites in any one
MEASUREMENT CONTROL or ASSISTANCE DATA DELIVERY message; additional satellites
are sent in subsequent MEASUREMENT CONTROL or ASSISTANCE DATA DELIVERY
messages.
If the UE requests the GPS almanac then the SS provides almanac information
spread across at least two MEASUREMENT CONTROL or ASSISTANCE DATA DELIVERY
messages.
If the UE requests both GPS navigation model and almanac then the SS provides
them in different MEASUREMENT CONTROL or ASSISTANCE DATA DELIVERY messages.
## 4.4 A-GNSS assistance data sets
This subclause defines the assistance data sets supplied by the SS in A-GNSS
test cases specified in subclause 6.2. For A-GNSS sub-test cases which include
the GPS L1 C/A signal, the A-GPS assistance data as defined in clause 4.3
apply.
Throughout this subclause, \"adequate assistance data\" means the assistance
data used in test cases where it is expected that a UE supporting A-GNSS will
be able to perform the requested positioning operation using the supplied
assistance data, and \"inadequate assistance data\" is the assistance data
used in test cases that expect that the UE will be unable to perform the
requested operation. The values of all the fields in all cases are defined in
3GPP TS 37.571-5 [12] subclause 6.1.3.
### 4.4.1 Adequate assistance data for UE-based A-GNSS
For UE-based GNSS test cases requiring adequate assistance data, the IE \"UE
positioning GANSS assistance data\" is spread across one or more (dependent on
the sub-test) separate MEASUREMENT CONTROL messages, and set as follows:
#### 4.4.1.1 Sub-Test 1
##### First MEASUREMENT CONTROL MESSAGE: {#first-measurement-control-message-1
.H6}
* * *
Information Element Value/Remark
UE positioning GPS assistance data Not present
UE positioning GANSS assistance data
\- UE positioning GANSS reference time
\- GANSS Day Set according to 4.2
\- GANSS Day Cycle Number Set according to 4.2 Rel-10 UE or later
\- GANSS TOD Set according to 4.2
\- GANSS TOD Uncertainty Set according to 4.2
\- GANSS Time ID 2 (GLONASS)
\- UTRAN GANSS reference time Not present
\- T~UTRAN-GANSS~ drift rate Not present
\- UE positioning GANSS reference UE position Set according to 4.2
\- UE positioning GANSS ionospheric model Not present
\- UE positioning GANSS additional ionospheric Model Not present
\- UE positioning GANSS Earth orientation Parameters Not present
\- GANSS Generic Assistance Data
\- GANSS ID 3 (GLONASS)
\- UE positioning GANSS SBAS ID Not present
\- GANSS Time Models Not present
\- UE positioning DGANSS corrections Not present
\- UE positioning GANSS navigation model Not present
\- UE positioning GANSS additional navigation models Set according to 4.2
\- Non-Broadcast Indication Not present
\- Satellite information For satellites 1-6
\- GANSS additional clock models Model-4
\- GANSS additional orbit models Model-4
\- UE positioning GANSS real-time integrity Not present
\- UE positioning GANSS data bit assistance Not present
\- UE positioning GANSS reference measurement\ Not present  
information
\- UE positioning GANSS almanac Not present
\- UE positioning GANSS UTC model Not present
\- UE positioning GANSS additional UTC models Not present
\- UE positioning GANSS auxiliary information Set according to 4.2
\- GANSS-ID-3
\- Aux Info List For satellites 1-6
* * *
#### 4.4.1.2 Sub-Test 2
##### First MEASUREMENT CONTROL MESSAGE: {#first-measurement-control-message-2
.H6}
* * *
Information Element Value/Remark
UE positioning GPS assistance data Not present
UE positioning GANSS assistance data
\- UE positioning GANSS reference time
\- GANSS Day Set according to 4.2
\- GANSS Day Cycle Number Set according to 4.2 Rel-10 UE or later
\- GANSS TOD Set according to 4.2
\- GANSS TOD Uncertainty Set according to 4.2
\- GANSS Time ID Not present
\- UTRAN GANSS reference time Not present
\- T~UTRAN-GANSS~ drift rate Not present
\- UE positioning GANSS reference UE position Set according to 4.2
\- UE positioning GANSS ionospheric model Set according to 4.2
\- UE positioning GANSS additional ionospheric Model Not present
\- UE positioning GANSS Earth orientation Parameters Not present
\- GANSS Generic Assistance Data
\- GANSS ID Not present
\- UE positioning GANSS SBAS ID Not present
\- GANSS Time Models Not present
\- UE positioning DGANSS corrections Not present
\- UE positioning GANSS navigation model Set according to 4.2
\- Non-Broadcast Indication Not present
\- Satellite information For satellites 1-N
\- GANSS clock model Model-1
\- GANSS orbit model Model-1
\- UE positioning GANSS additional navigation\ Not present  
models
\- UE positioning GANSS real-time integrity Not present
\- UE positioning GANSS data bit assistance Not present
\- UE positioning GANSS reference measurement\ Not present  
information
\- UE positioning GANSS almanac Not present
\- UE positioning GANSS UTC model Not present
\- UE positioning GANSS additional UTC models Not present
\- UE positioning GANSS auxiliary information Not present
* * *
##### Second MEASUREMENT CONTROL MESSAGE: {#second-measurement-control-
message-1 .H6}
* * *
Information Element Value/Remark UE positioning GPS assistance data Not
present UE positioning GANSS assistance data  
\- UE positioning GANSS reference time Not present \- UE positioning GANSS
reference UE position Not present \- UE positioning GANSS ionospheric model
Not present \- UE positioning GANSS additional ionospheric Model Not present
\- UE positioning GANSS Earth orientation Parameters Not present \- GANSS
Generic Assistance Data  
\- GANSS ID Not present \- UE positioning GANSS SBAS ID Not present \- GANSS
Time Models Not present \- UE positioning DGANSS corrections Not present \- UE
positioning GANSS navigation model Set according to 4.2 \- Non-Broadcast
Indication Not present \- Satellite information For satellites (N+1)-6 \-
GANSS clock model Model-1 \- GANSS orbit model Model-1 \- UE positioning GANSS
additional navigation models Not present \- UE positioning GANSS real-time
integrity Not present \- UE positioning GANSS data bit assistance Not present
\- UE positioning GANSS reference measurement information Not present \- UE
positioning GANSS almanac Not present \- UE positioning GANSS UTC model Not
present \- UE positioning GANSS additional UTC models Not present \- UE
positioning GANSS auxiliary information Not present
* * *
#### 4.4.1.3 Sub-Test 3
##### First MEASUREMENT CONTROL MESSAGE: {#first-measurement-control-message-3
.H6}
* * *
Information Element Value/Remark UE positioning GPS assistance data As defined
in 4.3.1, First Measurement Control Message UE positioning GANSS assistance
data  
\- UE positioning GANSS reference time Not present \- UE positioning GANSS
reference UE position Not present \- UE positioning GANSS ionospheric model
Not present \- UE positioning GANSS additional ionospheric Model Not present
\- UE positioning GANSS Earth orientation Parameters Not present \- GANSS
Generic Assistance Data  
\- GANSS ID 1 (Modernized GPS) \- UE positioning GANSS SBAS ID Not present \-
GANSS Time Models Not present \- UE positioning DGANSS corrections Not present
\- UE positioning GANSS navigation model Not present \- UE positioning GANSS
additional navigation models Not present \- UE positioning GANSS real-time
integrity Not present \- UE positioning GANSS data bit assistance Not present
\- UE positioning GANSS reference measurement information Not present \- UE
positioning GANSS almanac Not present \- UE positioning GANSS UTC model Not
present \- UE positioning GANSS additional UTC models Not present \- UE
positioning GANSS auxiliary information  
\- GANSS-ID-1  
\- Aux Info List For satellites 1-3
* * *
##### Second MEASUREMENT CONTROL MESSAGE: {#second-measurement-control-
message-2 .H6}
* * *
Information Element Value/Remark UE positioning GPS assistance data As defined
in 4.3.1, Second Measurement Control Message UE positioning GANSS assistance
data  
\- UE positioning GANSS reference time Not present \- UE positioning GANSS
reference UE position Not present \- UE positioning GANSS ionospheric model
Not present \- UE positioning GANSS additional ionospheric Model Not present
\- UE positioning GANSS Earth orientation Parameters Not present \- GANSS
Generic Assistance Data  
\- GANSS ID 1 (Modernized GPS) \- UE positioning GANSS SBAS ID Not present \-
GANSS Time Models Not present \- UE positioning DGANSS corrections Not present
\- UE positioning GANSS navigation model Not present \- UE positioning GANSS
additional navigation models Not present \- UE positioning GANSS real-time
integrity Not present \- UE positioning GANSS data bit assistance Not present
\- UE positioning GANSS reference measurement information Not present \- UE
positioning GANSS almanac Not present \- UE positioning GANSS UTC model Not
present \- UE positioning GANSS additional UTC models Not present \- UE
positioning GANSS auxiliary information  
\- GANSS-ID-1  
\- Aux Info List For satellites 4-6
* * *
#### 4.4.1.4 Sub-Test 4
##### First MEASUREMENT CONTROL MESSAGE: {#first-measurement-control-message-4
.H6}
* * *
Information Element Value/Remark UE positioning GPS assistance data As defined
in 4.3.1, First Measurement Control Message UE positioning GANSS assistance
data If for GPS only L1 C/A supported, not present. If multiple GPS signals
supported, as defined in 4.4.1.3, First Measurement Control Message, UE
positioning GANSS assistance data.
* * *
##### Second MEASUREMENT CONTROL MESSAGE: {#second-measurement-control-
message-3 .H6}
* * *
Information Element Value/Remark UE positioning GPS assistance data As defined
in 4.3.1, Second Measurement Control Message \- UE positioning GPS UTC model
Set according to 4.2. UE positioning GANSS assistance data If for GPS only L1
C/A supported, not present. If multiple GPS signals supported, as defined in
4.4.1.3, Second Measurement Control Message, UE positioning GANSS assistance
data.
* * *
##### Third MEASUREMENT CONTROL MESSAGE: {#third-measurement-control-message
.H6}
* * *
Information Element Value/Remark
UE positioning GPS assistance data Not present
UE positioning GANSS assistance data
\- UE positioning GANSS reference time Not present
\- UE positioning GANSS reference UE position Not present
\- UE positioning GANSS ionospheric model Not present
\- UE positioning GANSS additional ionospheric Model Not present
\- UE positioning GANSS Earth orientation Parameters Not present
\- GANSS Generic Assistance Data
\- GANSS ID 3 (GLONASS)
\- UE positioning GANSS SBAS ID Not present
\- GANSS Time Models Set according to 4.2
\- GANSS Time Model
\- GANSS Time Model Reference Time Set according to 4.2
\- T~A0~ Set according to 4.2
\- T~A1~ Not present
\- T~A2~ Not present
\- GNSS_TO_ID 0 (GPS)
\- Week Number Not present
\- Delta_T Set according to 4.2 Rel-10 UE or later
\- UE positioning DGANSS corrections Not present
\- UE positioning GANSS navigation model Not present
\- UE positioning GANSS additional navigation\ Set according to 4.2  
models
\- Non-Broadcast Indication Not present
\- Satellite information For satellites 1-6
\- GANSS additional clock models Model-4
\- GANSS additional orbit models Model-4
\- UE positioning GANSS real-time integrity Not present
\- UE positioning GANSS data bit assistance Not present
\- UE positioning GANSS reference measurement\ Not present  
information
\- UE positioning GANSS almanac Not present
\- UE positioning GANSS UTC model Not present
\- UE positioning GANSS additional UTC models Not present
\- UE positioning GANSS auxiliary information Set according to 4.2
\- GANSS-ID-3
\- Aux Info List For satellites 1-6
* * *
#### 4.4.1.4A Sub-Test 8
##### First MEASUREMENT CONTROL MESSAGE: {#first-measurement-control-message-5
.H6}
* * *
Information Element Value/Remark UE positioning GPS assistance data As defined
in 4.3.1, First Measurement Control Message UE positioning GANSS assistance
data If for GPS only L1 C/A supported, not present. If multiple GPS signals
supported, as defined in 4.4.1.3, First Measurement Control Message, UE
positioning GANSS assistance data.
* * *
##### Second MEASUREMENT CONTROL MESSAGE: {#second-measurement-control-
message-4 .H6}
* * *
Information Element Value/Remark UE positioning GPS assistance data As defined
in 4.3.1, Second Measurement Control Message \- UE positioning GPS UTC model
Set according to 4.2. UE positioning GANSS assistance data If for GPS only L1
C/A supported, not present. If multiple GPS signals supported, as defined in
4.4.1.3, Second Measurement Control Message, UE positioning GANSS assistance
data.
* * *
##### Third MEASUREMENT CONTROL MESSAGE: {#third-measurement-control-message-1
.H6}
Information Element Value/Remark
* * *
UE positioning GPS assistance data Not present  
UE positioning GANSS assistance data  
\- UE positioning GANSS reference time Not present  
\- UE positioning GANSS reference UE position Not present  
\- UE positioning GANSS ionospheric model Not present  
\- UE positioning GANSS additional ionospheric Model Not present  
\- UE positioning GANSS Earth orientation Parameters Not present  
\- GANSS Generic Assistance Data  
\- GANSS ID Not present (Galileo) \- UE positioning GANSS SBAS ID Not present  
\- GANSS Time Models Set according to 4.2  
\- GANSS Time Model  
\- GANSS Time Model Reference Time Set according to 4.2  
\- T~A0~ Set according to 4.2  
\- T~A1~ Not present  
\- T~A2~ Not present  
\- GNSS_TO_ID 0 (GPS)  
\- Week Number Not present  
\- Delta_T Set according to 4.2  
\- UE positioning DGANSS corrections Not present  
\- UE positioning GANSS navigation model Not present  
\- UE positioning GANSS additional navigation models Not present  
\- Non-Broadcast Indication Not present  
\- Satellite information For satellites 1-6  
\- GANSS additional clock models Model 1  
\- GANSS additional orbit models Model 1  
\- UE positioning GANSS real-time integrity Not present  
\- UE positioning GANSS data bit assistance Not present  
\- UE positioning GANSS reference measurement information Not present  
\- UE positioning GANSS almanac Not present  
\- UE positioning GANSS UTC model Not present  
\- UE positioning GANSS additional UTC models Not present  
\- UE positioning GANSS auxiliary information Not present
#### 4.4.1.5 Sub-Test 9
##### First MEASUREMENT CONTROL MESSAGE: {#first-measurement-control-message-6
.H6}
* * *
Information Element Value/Remark
UE positioning GPS assistance data Not present
UE positioning GANSS assistance data
\- UE positioning GANSS reference time
\- GANSS Day Set according to 4.2
\- GANSS Day Cycle Number Set according to 4.2
\- GANSS TOD Set according to 4.2
\- GANSS TOD Uncertainty Set according to 4.2
\- GANSS Time ID 3 (BDS)
\- UTRAN GANSS reference time Not present
\- T~UTRAN-GANSS~ drift rate Not present
\- UE positioning GANSS reference UE position Set according to 4.2
\- UE positioning GANSS ionospheric model Not present
\- UE positioning GANSS additional ionospheric Model Not present
\- UE positioning GANSS Earth orientation Parameters Not present
\- GANSS Generic Assistance Data
\- GANSS ID 4 (BDS)
\- UE positioning GANSS SBAS ID Not present
\- GANSS Time Models Not present
\- UE positioning DGANSS corrections Not present
\- UE positioning GANSS navigation model Not present
\- UE positioning GANSS additional navigation models Set according to 4.2
\- Non-Broadcast Indication Not present
\- Satellite information For satellites 1-6
\- GANSS additional clock models Model 6
\- GANSS additional orbit models Model 6
\- UE positioning GANSS real-time integrity Not present
\- UE positioning GANSS data bit assistance Not present
\- UE positioning GANSS reference measurement\ Not present  
information
\- UE positioning GANSS almanac Not present
\- UE positioning GANSS UTC model Not present
\- UE positioning GANSS additional UTC models Not present
\- UE positioning GANSS auxiliary information Not present
* * *
#### 4.4.1.6 Sub-Test 10
##### First MEASUREMENT CONTROL MESSAGE: {#first-measurement-control-message-7
.H6}
* * *
Information Element Value/Remark UE positioning GPS assistance data As defined
in 4.3.1, First Measurement Control Message UE positioning GANSS assistance
data If for GPS only L1 C/A supported, not present. If multiple GPS signals
supported, as defined in 4.4.1.3, First Measurement Control Message, UE
positioning GANSS assistance data.
* * *
##### Second MEASUREMENT CONTROL MESSAGE: {#second-measurement-control-
message-5 .H6}
* * *
Information Element Value/Remark UE positioning GPS assistance data As defined
in 4.3.1, Second Measurement Control Message \- UE positioning GPS UTC model
Set according to 4.2. UE positioning GANSS assistance data If for GPS only L1
C/A supported, not present. If multiple GPS signals supported, as defined in
4.4.1.3, Second Measurement Control Message, UE positioning GANSS assistance
data.
* * *
##### Third MEASUREMENT CONTROL MESSAGE: {#third-measurement-control-message-2
.H6}
* * *
Information Element Value/Remark  
UE positioning GPS assistance data Not present  
UE positioning GANSS assistance data  
\- UE positioning GANSS reference time Not present  
\- UE positioning GANSS reference UE position Not present  
\- UE positioning GANSS ionospheric model Not present  
\- UE positioning GANSS additional ionospheric Model Not present  
\- UE positioning GANSS Earth orientation Parameters Not present  
\- GANSS Generic Assistance Data  
\- GANSS ID 4 (BDS)  
\- UE positioning GANSS SBAS ID Not present  
\- GANSS Time Models Set according to 4.2  
\- GANSS Time Model  
\- GANSS Time Model Reference Time Set according to 4.2  
\- T~A0~ Set according to 4.2  
\- T~A1~ Not present  
\- T~A2~ Not present  
\- GNSS_TO_ID 0 (GPS)  
\- Week Number Not present  
\- Delta_T Set according to 4.2  
\- UE positioning DGANSS corrections Not present  
\- UE positioning GANSS navigation model Not present  
\- UE positioning GANSS additional navigation models Set according to 4.2  
\- Non-Broadcast Indication Not present  
\- Satellite information For satellites 1-6  
\- GANSS additional clock models Model 6  
\- GANSS additional orbit models Model 6  
\- UE positioning GANSS real-time integrity Not present  
\- UE positioning GANSS data bit assistance Not present  
\- UE positioning GANSS reference measurement information Not present  
\- UE positioning GANSS almanac Not present  
\- UE positioning GANSS UTC model Not present  
\- UE positioning GANSS additional UTC models Not present  
\- UE positioning GANSS auxiliary information Not present
* * *
### 4.4.2 Inadequate assistance data for UE-based A-GNSS
For UE-based test cases requiring inadequate assistance data, the IE \"UE
positioning GPS assistance data\" and \"UE positioning GANSS assistance data\"
is set to \"Not present\" in the MEASUREMENT CONTROL message.
### 4.4.3 Adequate assistance data for UE-assisted A-GNSS
For UE-assisted test cases requiring adequate assistance data, the IEs \"UE
positioning GPS assistance data\" and \"UE positioning GANSS assistance data\"
are set as follows:
#### 4.4.3.1 Sub-Test 1
##### MEASUREMENT CONTROL MESSAGE: {#measurement-control-message .H6}
* * *
Information Element Value/Remark
UE positioning GPS assistance data Not present
UE positioning GANSS assistance data
\- UE positioning GANSS reference time
\- GANSS Day Set according to 4.2
\- GANSS Day Cycle Number Set according to 4.2 Rel-10 UE or later
\- GANSS TOD Set according to 4.2
\- GANSS TOD Uncertainty Set according to 4.2
\- GANSS Time ID 2 (GLONASS)
\- UTRAN GANSS reference time Not present
\- T~UTRAN-GANSS~ drift rate Not present
\- UE positioning GANSS reference UE position Not present
\- UE positioning GANSS ionospheric model Not present
\- UE positioning GANSS additional ionospheric Model Not present
\- UE positioning GANSS Earth orientation Parameters Not present
\- GANSS Generic Assistance Data
\- GANSS ID 3 (GLONASS)
\- UE positioning GANSS SBAS ID Not present
\- GANSS Time Models Not present
\- UE positioning DGANSS corrections Not present
\- UE positioning GANSS navigation model Not present
\- UE positioning GANSS additional navigation\ Not present  
models
\- UE positioning GANSS real-time integrity Not present
\- UE positioning GANSS data bit assistance Not present
\- UE positioning GANSS reference measurement\ Set according to 4.2  
information
\- GANSS Signal ID Not present
\- Satellite Information For satellites 1-6
\- Extra Doppler Set according to 4.2
\- Azimuth and Elevation Set according to 4.2
\- Azimuth and Elevation LSB Set according to 4.2 Rel-10 UE or later
\- UE positioning GANSS almanac Not present
\- UE positioning GANSS UTC model Not present
\- UE positioning GANSS additional UTC models Not present
\- UE positioning GANSS auxiliary information Set according to 4.2
\- GANSS-ID-3
\- Aux Info List For satellites 1-6
* * *
#### 4.4.3.2 Sub-Test 2
##### MEASUREMENT CONTROL MESSAGE: {#measurement-control-message-1 .H6}
* * *
Information Element Value/Remark
UE positioning GPS assistance data Not present
UE positioning GANSS assistance data
\- UE positioning GANSS reference time
\- GANSS Day Set according to 4.2
\- GANSS Day Cycle Number Set according to 4.2 Rel-10 UE or later
\- GANSS TOD Set according to 4.2
\- GANSS TOD Uncertainty Set according to 4.2
\- GANSS Time ID Not present
\- UTRAN GANSS reference time Not present
\- T~UTRAN-GANSS~ drift rate Not present
\- UE positioning GANSS reference UE position Not present
\- UE positioning GANSS ionospheric model Not present
\- UE positioning GANSS additional ionospheric Model Not present
\- UE positioning GANSS Earth orientation Parameters Not present
\- GANSS Generic Assistance Data
\- GANSS ID Not present
\- UE positioning GANSS SBAS ID Not present
\- GANSS Time Models Not present
\- UE positioning DGANSS corrections Not present
\- UE positioning GANSS navigation model Not present
\- UE positioning GANSS additional navigation models Not present
\- UE positioning GANSS real-time integrity Not present
\- UE positioning GANSS data bit assistance Not present
\- UE positioning GANSS reference measurement\ Set according to 4.2  
information
\- GANSS Signal ID Not present
\- Satellite Information For satellites 1-6
\- Extra Doppler Set according to 4.2
\- Azimuth and Elevation Set according to 4.2
\- Azimuth and Elevation LSB Set according to 4.2 Rel-10 UE or later
\- UE positioning GANSS almanac Not present
\- UE positioning GANSS UTC model Not present
\- UE positioning GANSS additional UTC models Not present
\- UE positioning GANSS auxiliary information Not present
* * *
#### 4.4.3.3 Sub-Test 3
##### MEASUREMENT CONTROL MESSAGE: {#measurement-control-message-2 .H6}
* * *
Information Element Value/Remark UE positioning GPS assistance data As defined
in 4.3.3 UE positioning GANSS assistance data  
\- UE positioning GANSS reference time Not present \- UE positioning GANSS
reference UE position Not present \- UE positioning GANSS ionospheric model
Not present \- UE positioning GANSS additional ionospheric Model Not present
\- UE positioning GANSS Earth orientation Parameters Not present \- GANSS
Generic Assistance Data  
\- GANSS ID 1 (Modernized GPS) \- UE positioning GANSS SBAS ID Not present \-
GANSS Time Models Not present \- UE positioning DGANSS corrections Not present
\- UE positioning GANSS navigation model Not present \- UE positioning GANSS
additional navigation models Not present \- UE positioning GANSS real-time
integrity Not present \- UE positioning GANSS data bit assistance Not present
\- UE positioning GANSS reference measurement information Not present \- UE
positioning GANSS almanac Not present \- UE positioning GANSS UTC model Not
present \- UE positioning GANSS additional UTC models Not present \- UE
positioning GANSS auxiliary information Set according to 4.2 \- GANSS-ID-1  
\- Aux Info List For satellites 1-6
* * *
#### 4.4.3.4 Sub-Test 4
##### MEASUREMENT CONTROL MESSAGE: {#measurement-control-message-3 .H6}
* * *
Information Element Value/Remark Comment
UE positioning GPS assistance data As defined in 4.3.3
\- UE positioning GPS UTC model Set according to 4.2
UE positioning GANSS assistance data (1) If for GPS only L1 C/A supported, not
present. If multiple GPS signals supported, as defined in 4.4.3.3, Measurement
Control Message, UE positioning GANSS assistance data.
UE positioning GANSS assistance data (2) If UE positioning GANSS assistance
data (1) is present, then UE positioning GANSS assistance data (2) is sent in
a second MEASUREMENT CONTROL MESSAGE
\- UE positioning GANSS reference time Not present
\- UE positioning GANSS reference UE position Not present
\- UE positioning GANSS ionospheric model Not present
\- UE positioning GANSS additional ionospheric Model Not present
\- UE positioning GANSS Earth orientation Parameters Not present
\- GANSS Generic Assistance Data
\- GANSS ID 3 (GLONASS)
\- UE positioning GANSS SBAS ID Not present
\- GANSS Time Models Not present
\- UE positioning DGANSS corrections Not present
\- UE positioning GANSS navigation model Not present
\- UE positioning GANSS additional navigation models Not present
\- UE positioning GANSS real-time integrity Not present
\- UE positioning GANSS data bit assistance Not present
\- UE positioning GANSS reference measurement\  
information
\- GANSS Signal ID Not present
\- Satellite Information For satellites 1-6
\- Extra Doppler Set according to 4.2
\- Azimuth and Elevation Set according to 4.2
\- Azimuth and Elevation LSB Set according to 4.2 Rel-10 UE or later
\- UE positioning GANSS auxiliary information Set according to 4.2
\- GANSS-ID-3
\- Aux Info List For satellites 1-6
* * *
#### 4.4.3.4A Sub-Test 8
##### MEASUREMENT CONTROL MESSAGE: {#measurement-control-message-4 .H6}
Information Element Value/Remark Comment
* * *
UE positioning GPS assistance data As defined in 4.3.3  
\- UE positioning GPS UTC model Set according to 4.2  
UE positioning GANSS assistance data (1) If for GPS only L1 C/A supported, not
present. If multiple GPS signals supported, as defined in 4.4.3.3, Measurement
Control Message, UE positioning GANSS assistance data.  
UE positioning GANSS assistance data (2) If UE positioning GANSS assistance
data (1) is present, then UE positioning GANSS assistance data (2) is sent in
a second MEASUREMENT CONTROL MESSAGE \- UE positioning GANSS reference time
Not present  
\- UE positioning GANSS reference UE position Not present  
\- UE positioning GANSS ionospheric model Not present  
\- UE positioning GANSS additional ionospheric Model Not present  
\- UE positioning GANSS Earth orientation Parameters Not present  
\- GANSS Generic Assistance Data  
\- GANSS ID Not present (Galileo) \- UE positioning GANSS SBAS ID Not present  
\- GANSS Time Models Not present  
\- UE positioning DGANSS corrections Not present  
\- UE positioning GANSS navigation model Not present  
\- UE positioning GANSS additional navigation models Not present  
\- UE positioning GANSS real-time integrity Not present  
\- UE positioning GANSS data bit assistance Not present  
\- UE positioning GANSS reference measurement information  
\- GANSS Signal ID Not present  
\- Satellite Information For satellites 1-6  
\- Extra Doppler Set according to 4.2  
\- Azimuth and Elevation Set according to 4.2  
\- Azimuth and Elevation LSB Set according to 4.2  
\- UE positioning GANSS auxiliary information Not present
#### 4.4.3.5 Sub-Test 9
##### MEASUREMENT CONTROL MESSAGE: {#measurement-control-message-5 .H6}
* * *
Information Element Value/Remark
UE positioning GPS assistance data Not present
UE positioning GANSS assistance data
\- UE positioning GANSS reference time
\- GANSS Day Set according to 4.2
\- GANSS Day Cycle Number Set according to 4.2
\- GANSS TOD Set according to 4.2
\- GANSS TOD Uncertainty Set according to 4.2
\- GANSS Time ID 3 (BDS)
\- UTRAN GANSS reference time Not present
\- T~UTRAN-GANSS~ drift rate Not present
\- UE positioning GANSS reference UE position Not present
\- UE positioning GANSS ionospheric model Not present
\- UE positioning GANSS additional ionospheric Model Not present
\- UE positioning GANSS Earth orientation Parameters Not present
\- GANSS Generic Assistance Data
\- GANSS ID 4 (BDS)
\- UE positioning GANSS SBAS ID Not present
\- GANSS Time Models Not present
\- UE positioning DGANSS corrections Not present
\- UE positioning GANSS navigation model Not present
\- UE positioning GANSS additional navigation\ Not present  
models
\- UE positioning GANSS real-time integrity Not present
\- UE positioning GANSS data bit assistance Not present
\- UE positioning GANSS reference measurement\ Set according to 4.2  
information
\- GANSS Signal ID Not present
\- Satellite Information For satellites 1-6
\- Extra Doppler Set according to 4.2
\- Azimuth and Elevation Set according to 4.2
\- Azimuth and Elevation LSB Set according to 4.2
\- UE positioning GANSS almanac Not present
\- UE positioning GANSS UTC model Not present
\- UE positioning GANSS additional UTC models Not present
\- UE positioning GANSS auxiliary information Not present
* * *
#### 4.4.3.6 Sub-Test 10
##### MEASUREMENT CONTROL MESSAGE: {#measurement-control-message-6 .H6}
* * *
Information Element Value/Remark Comment
UE positioning GPS assistance data As defined in 4.3.3
\- UE positioning GPS UTC model Set according to 4.2
UE positioning GANSS assistance data (1) If for GPS only L1 C/A supported, not
present. If multiple GPS signals supported, as defined in 4.4.3.3, Measurement
Control Message, UE positioning GANSS assistance data.
UE positioning GANSS assistance data (2) If UE positioning GANSS assistance
data (1) is present, then UE positioning GANSS assistance data (2) is sent in
a second MEASUREMENT CONTROL MESSAGE
\- UE positioning GANSS reference time Not present
\- UE positioning GANSS reference UE position Not present
\- UE positioning GANSS ionospheric model Not present
\- UE positioning GANSS additional ionospheric Model Not present
\- UE positioning GANSS Earth orientation Parameters Not present
\- GANSS Generic Assistance Data
\- GANSS ID 4 (BDS)
\- UE positioning GANSS SBAS ID Not present
\- GANSS Time Models Not present
\- UE positioning DGANSS corrections Not present
\- UE positioning GANSS navigation model Not present
\- UE positioning GANSS additional navigation models Not present
\- UE positioning GANSS real-time integrity Not present
\- UE positioning GANSS data bit assistance Not present
\- UE positioning GANSS reference measurement\  
information
\- GANSS Signal ID Not present
\- Satellite Information For satellites 1-6
\- Extra Doppler Set according to 4.2
\- Azimuth and Elevation Set according to 4.2
\- Azimuth and Elevation LSB Set according to 4.2
\- UE positioning GANSS auxiliary information Not present
* * *
If the UE requests further assistance data, the SS sends subsequent
MEASUREMENT CONTROL messages containing the assistance data fields requested
by the UE that are available in the SS as specified in TS 37.571-5 [12]
subclause 6.1.3 and in clause 4.4.5.
### 4.4.4 Inadequate assistance data for UE-assisted A-GNSS
For UE-assisted test cases requiring inadequate assistance data, the IEs \"UE
positioning GPS assistance data\" and \"UE positioning GANSS assistance data\"
are set to \"Not present\" in the MEASUREMENT CONTROL message.
### 4.4.5 Response to assistance data requests from UE
If the SS needs to send assistance data in response to a request for
additional assistance data from the UE, or in response to an MO-LR request for
assistance data, the IEs \"UE positioning GPS assistance data\" and \"UE
positioning GANSS assistance data\" are set as follows:
* * *
Information Element Value/Remark  
UE positioning GPS assistance data Set according to 4.3.5  
\- UE positioning GPS UTC model Set according to 4.2  
UE positioning GANSS assistance data  
\- UE positioning GANSS reference time Set according to 4.2  
\- GANSS Day Set according to 4.2  
\- GANSS Day Cycle Number Set according to 4.2 Rel-10 UE or later \- GANSS TOD
Set according to 4.2  
\- GANSS TOD Uncertainty Set according to 4.2  
\- GANSS Time ID Set according to 4.2  
\- UTRAN GANSS reference time Not present  
\- T~UTRAN-GANSS~ drift rate Not present  
\- UE positioning GANSS reference UE position Set according to 4.2  
\- UE positioning GANSS ionospheric model Set according to 4.2  
\- UE positioning GANSS additional ionospheric Model Set according to 4.2  
\- UE positioning GANSS Earth orientation Parameters Not present  
\- GANSS Generic Assistance Data  
\- GANSS ID Set according to 4.2  
\- UE positioning GANSS SBAS ID Not present  
\- GANSS Time Models Set according to 4.2  
\- GANSS Time Model Set according to 4.2  
\- GANSS Time Model Reference Time Set according to 4.2  
\- T~A0~ Set according to 4.2  
\- T~A1~ Not present  
\- T~A2~ Not present  
\- GNSS_TO_ID Set according to 4.2  
\- Week Number Not present  
\- Delta_T Set according to 4.2 Rel-10 UE or later \- UE positioning DGANSS
corrections Not present  
\- UE positioning GANSS navigation model Set according to 4.2  
\- UE positioning GANSS additional navigation models Set according to 4.2  
\- UE positioning GANSS real-time integrity Not present  
\- UE positioning GANSS data bit assistance Not present  
\- UE positioning GANSS reference measurement information Set according to 4.2  
\- GANSS Signal ID Set according to 4.2  
\- Satellite Information Set according to 4.2  
\- Extra Doppler Set according to 4.2  
\- Azimuth and Elevation Set according to 4.2  
\- Azimuth and Elevation LSB Set according to 4.2 Rel-10 UE or later \- UE
positioning GANSS almanac Set according to 4.2  
\- Complete Almanac Provided True Rel-10 UE or later \- UE positioning GANSS
UTC model Set according to 4.2  
\- UE positioning GANSS additional UTC models Set according to 4.2  
\- UE positioning GANSS auxiliary information Set according to 4.2
* * *
If the UE requests the GPS navigation model or the GANSS navigation model
Model-1, Model-2, Model-3 or Model 6 then the SS provides navigation model
satellite information for at most three satellites in any one MEASUREMENT
CONTROL or ASSISTANCE DATA DELIVERY message; additional satellites are sent in
subsequent MEASUREMENT CONTROL or ASSISTANCE DATA DELIVERY messages.
If the UE requests the GPS or GANSS almanac then the SS provides almanac
information spread across at least two MEASUREMENT CONTROL or ASSISTANCE DATA
DELIVERY messages.
If the UE requests both navigation model and almanac then the SS provides them
in different MEASUREMENT CONTROL or ASSISTANCE DATA DELIVERY messages.
# 5 Default Conditions for E-UTRAN
## 5.1 LCS Sub-Test Cases
Some test cases defined in clause 7 may include several sub-test cases
dependent on the positioning method(s) supported by the UE. Each sub-test case
is identified by a sub-test case number as defined in Table 5.1-1. The
applicable sub-tests for each test case are specified in the test procedure
sequence clause of each test case. If no sub-tests are defined for a specific
test case it means that this particular test case is not dependent on a
specific positioning method.
Table 5.1-1: Sub-Test Case Numbers for E-UTRA
+----------------------------------+----------------------------------+ | Sub-Test Case Number | Supported Positioning Methods | +----------------------------------+----------------------------------+ | 1 | Void | +----------------------------------+----------------------------------+ | 2 | Void | +----------------------------------+----------------------------------+ | 3 | Void | +----------------------------------+----------------------------------+ | 4 | Void | +----------------------------------+----------------------------------+ | 5 | UE supporting OTDOA | +----------------------------------+----------------------------------+ | 6 FDD | UE supporting ECID (FDD) | +----------------------------------+----------------------------------+ | 6 TDD | UE supporting ECID (TDD) | +----------------------------------+----------------------------------+ | 7 | UE supporting GNSS^(1)^ and | | | OTDOA | +----------------------------------+----------------------------------+ | 8 | Void | +----------------------------------+----------------------------------+ | 9 | Void | +----------------------------------+----------------------------------+ | 10 | Void | +----------------------------------+----------------------------------+ | 11 | UE supporting WLAN (Rel-13 only) | +----------------------------------+----------------------------------+ | 12 | UE supporting MBS^(2)^ (Rel-13 | | | only) | +----------------------------------+----------------------------------+ | 13 | UE supporting Bluetooth | +----------------------------------+----------------------------------+ | 14 | UE supporting Sensor (Rel-13 | | | only) | +----------------------------------+----------------------------------+ | 15 | UE supporting GNSS^(1)^ | +----------------------------------+----------------------------------+ | 16 | UE supporting MBS^(2)^ (Rel-14 | | | onwards) | +----------------------------------+----------------------------------+ | 17 | UE supporting WLAN (Rel-14 | | | onwards) | +----------------------------------+----------------------------------+ | 18 | UE supporting Sensor (Rel-14 | | | onwards) | +----------------------------------+----------------------------------+ | 23 | UE supporting MBS^(2)^ (Rel-15 | | | onwards) | +----------------------------------+----------------------------------+ | 24 | UE supporting Sensor (Rel-15 | | | onwards) | +----------------------------------+----------------------------------+ | 25 | UE supporting GNSS^(1)^ (Rel-15 | | | onwards) | +----------------------------------+----------------------------------+ | 26 | UE supporting Multi-RTT (Rel-17 | | | onwards) | +----------------------------------+----------------------------------+ | 27 | UE supporting DL-AoD (Rel-17 | | | onwards) | +----------------------------------+----------------------------------+ | 28 | UE supporting DL-TDOA (Rel-17 | | | onwards) | +----------------------------------+----------------------------------+ | 29 | UE supporting UL-TDOA (Rel-17 | | | onwards) | +----------------------------------+----------------------------------+ | NOTE 1: The GNSS combination of | | | GPS, GLONASS, Galileo, BDS | | | supported by the UE | | | | | | NOTE 2: Metropolitan Beacon | | | System (MBS) is a specific type | | | of Terrestrial Beacon System | | | (TBS) [29] | | +----------------------------------+----------------------------------+
## 5.2 Default signal conditions
### 5.2.1 Simulated GNSS environment
During A-GNSS signalling tests, where required the SS shall generate all UE
supported satellite signals. Where required the SS shall provide assistance
data dependent on UE capabilities defined in subclause 5.4.1.1 and consistent
with the satellite signals generated during these tests if satellite signals
are also required.
The levels of the simulated satellites shall be at -125 dBm ± 6 dBm.
GNSS scenarios together with associated assistance data are defined in TS
37.571-5 [12].
The accuracy of the GNSS time in the provided assistance data shall be within
± 2 seconds relative to the GNSS time in the system simulator. In the case
that assistance data is required but satellite signals are not required then
this clause does not apply.
### 5.2.2 Simulated OTDOA environment
For OTDOA signalling test cases a multi cell environment with Cell 1 and Cell
2 (where required) is used, as defined in 3GPP TS 36.508 [8].
All cells transmit PRS according to the PRS configuration provided in the
OTDOA assistance data defined in subclause 5.4.1.2. The positioning subframes
are low-interference subframes, i.e. contain no PDSCH transmissions.
Normal propagation condition is used for all cells. Cell 1 is the serving cell
and Cell 2 (where required) is a neighbour cell.
Where two cells are required, the two Cells 1 and 2 shall be synchronized, and
the timing offset (the RSTD) between the cells, referenced to the UE's antenna
input, shall be set equal to the _expectedRSTD_ value provided in the OTDOA
assistance data, as defined in subclause 5.4.1.2.
The E-UTRA frequency to be tested and other default conditions are as
specified for signalling test cases in 3GPP TS 36.508 [8].
### 5.2.3 Simulated ECID environment
For ECID signalling test cases a multi cell environment with Cell 1 and Cell 2
is used, as defined in 3GPP TS 36.508 [8].
Normal propagation condition is used for all cells. Cell 1 is the serving cell
and Cell 2 is a neighbour cell.
The E-UTRA frequency to be tested and other default conditions are as
specified for signalling test cases in 3GPP TS 36.508 [8].
Note: If the only ECID measurement supported by the UE is the UE Rx-Tx Time
Difference Measurement, Cell 2 does not need to be simulated (see also table
5.4-6).
### 5.2.4 Simulated MBS environment
During MBS signalling tests, where required, the SS shall generate the UE
supported MBS signals as defined in the MBS scenarios defined in TS 37.571-5
[12].
### 5.2.5 Simulated WLAN environment
During WLAN signalling tests, where required, the SS shall generate the UE
supported WLAN signals as defined in the WLAN scenarios defined in TS 37.571-5
[12].
### 5.2.6 Simulated Bluetooth environment
During Bluetooth signalling tests, where required, the SS shall generate the
UE supported Bluetooth signals as defined in the Bluetooth scenarios defined
in TS 37.571-5 [12].
### 5.2.7 Simulated Sensor environment
During Sensor signalling tests there is no simulated sensor environment.
## 5.3 Default RRC and NAS message and information elements contents
The default values of common RRC and NAS messages and information elements are
used as defined in 3GPP\ TS 36.508 [8] with the following exceptions.
### \- ATTACH ACCEPT
Table 5.3-1: ATTACH ACCEPT
* * *
Derivation Path: 36.508 Table 4.7.2-1  
Information Element Value/remark Comment Condition EPS network feature support
Set according to Table 5.3-2
* * *
Table 5.3-2: EPS network feature support
+-------------------+--------------+-------------------+-----------+ | Derivation Path: | | | | | 24.301 clause | | | | | 9.9.3.12A | | | | +-------------------+--------------+-------------------+-----------+ | Information | Value/remark | Comment | Condition | | Element | | | | +-------------------+--------------+-------------------+-----------+ | IMS voice over PS | 1 | IMS voice over PS | | | session indicator | | session in S1 | | | (IMS VoPS) (octet | | mode supported | | | 3, bit 1) | | | | +-------------------+--------------+-------------------+-----------+ | Emergency bearer | 1 | emergency bearer | | | services | | services in S1 | | | indicator (EMC | | mode supported | | | BS) | | | | | | | | | | (octet 3, bit 2) | | | | +-------------------+--------------+-------------------+-----------+ | Location services | 1 | location services | | | indicator in EPC | | via EPC supported | | | (EPC-LCS) | | | | | | | | | | (octet 3, bit 3) | | | | +-------------------+--------------+-------------------+-----------+ | Location services | 01 | location services | | | indicator in CS | | via CS domain not | | | (CS-LCS) | | supported | | | | | | | | (octet 3, bit 4 | | | | | to 5) | | | | +-------------------+--------------+-------------------+-----------+ | octet 3, bit 6 to | 000 | spare | | | 8 | | | | +-------------------+--------------+-------------------+-----------+
## 5.4 Default LPP message and information elements contents
This clause contains the default values of LPP messages and information
elements used, unless indicated otherwise in specific clauses of this
specification.
\- LPP REQUEST CAPABILITIES
_Table 5.4-1:_ RequestCapabilities
+-----------------+----------------+-----------------+-----------+ | Derivation | | | | | Path: 36.355 | | | | | clause 6.2 | | | | +-----------------+----------------+-----------------+-----------+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+----------------+-----------------+-----------+ | LPP-Message ::= | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | transactionID | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | Initiator | locationServer | | | +-----------------+----------------+-----------------+-----------+ | tr | (0..255) | | | | ansactionNumber | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | endTransaction | FALSE | | | +-----------------+----------------+-----------------+-----------+ | sequenceNumber | Not present | | | +-----------------+----------------+-----------------+-----------+ | acknowledgement | Not present | | | +-----------------+----------------+-----------------+-----------+ | lpp-MessageBody | | | | | CHOICE { | | | | +-----------------+----------------+-----------------+-----------+ | c1 CHOICE { | | | | +-----------------+----------------+-----------------+-----------+ | requ | | | | | estCapabilities | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | cri | | | | | ticalExtensions | | | | | CHOICE { | | | | +-----------------+----------------+-----------------+-----------+ | c1 CHOICE { | | | | +-----------------+----------------+-----------------+-----------+ | request | | | | | Capabilities-r9 | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | commonIEsRequ | Present | Rel-14 onwards | | | estCapabilities | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | lp | 00 | Server is not | | | p-message-segme | | able to send | | | ntation-req-r14 | | segmented LPP | | | | | messages. | | | | | Server is not | | | | | able to receive | | | | | segmented LPP | | | | | messages. | | | | | | | | | | Rel-14 onwards | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | a-gnss-Requ | | | | | estCapabilities | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | gnss | TRUE | | | | -SupportListReq | | | | +-----------------+----------------+-----------------+-----------+ | assistanceDat | TRUE | | | | aSupportListReq | | | | +-----------------+----------------+-----------------+-----------+ | locationV | TRUE | | | | elocityTypesReq | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | otdoa-Requ | Present | | | | estCapabilities | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | ecid-Requ | Present | | | | estCapabilities | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | epdu-Requ | Not present | | | | estCapabilities | | | | +-----------------+----------------+-----------------+-----------+ | sensor-RequestC | Present | Rel-13 onwards | | | apabilities-r13 | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | tbs-RequestC | Present | Rel-13 onwards | | | apabilities-r13 | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | wlan-RequestC | Present | Rel-13 onwards | | | apabilities-r13 | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | bt-RequestC | Present | Rel-13 onwards | | | apabilities-r13 | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+
#### \- LPP PROVIDE ASSISTANCE DATA
_Table 5.4-2:_ ProvideAssistanceData
+----------------+----------------+----------------+----------------+ | Derivation | | | | | Path: 36.355 | | | | | clause 6.2 | | | | +----------------+----------------+----------------+----------------+ | Information | Value/remark | Comment | Condition | | Element | | | | +----------------+----------------+----------------+----------------+ | LPP-Message | | | | | ::= SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | transactionID | Dependent on | | | | SEQUENCE { | test case. | | | +----------------+----------------+----------------+----------------+ | initiator | | | | +----------------+----------------+----------------+----------------+ | tra | | | | | nsactionNumber | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | endTransaction | TRUE | | | +----------------+----------------+----------------+----------------+ | sequenceNumber | Not present | | | +----------------+----------------+----------------+----------------+ | a | Not present | | | | cknowledgement | | | | +----------------+----------------+----------------+----------------+ | l | | | | | pp-MessageBody | | | | | CHOICE { | | | | +----------------+----------------+----------------+----------------+ | c1 CHOICE { | | | | +----------------+----------------+----------------+----------------+ | provide | | | | | AssistanceData | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | crit | | | | | icalExtensions | | | | | CHOICE { | | | | +----------------+----------------+----------------+----------------+ | c1 CHOICE { | | | | +----------------+----------------+----------------+----------------+ | provideAss | | | | | istanceData-r9 | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | co | Not present | | | | mmonIEsProvide | | | | | AssistanceData | | | | +----------------+----------------+----------------+----------------+ | a-gnss-Provide | | | Sub-tests 7 | | AssistanceData | | | and 15 only; | | SEQUENCE { | | | and as defined | | | | | in Table | | | | | 5.4.1.1-1. | +----------------+----------------+----------------+----------------+ | gnss-Co | | | | | mmonAssistData | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | gnss | As defined in | | | | -ReferenceTime | 37.571-5 | | | | | [12] | | | +----------------+----------------+----------------+----------------+ | gnss-Ref | As defined in | | | | erenceLocation | 37.571-5 | | | | | [12] | | | +----------------+----------------+----------------+----------------+ | gnss-Io | As defined in | | | | nosphericModel | 37.571-5 | | | | | [12] | | | +----------------+----------------+----------------+----------------+ | gns | Not present | | | | s-EarthOrienta | | | | | tionParameters | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | gnss-Gene | SIZE is | | | | ricAssistData( | dependent on | | | | SIZE(1..4))OF{ | the number of | | | | | GNSSs | | | | | supported by | | | | | the UE. | | | | | | | | | | If one GNSS | | | | | supported by | | | | | the UE, SIZE = | | | | | 1 | | | | | | | | | | If two GNSSs | | | | | supported by | | | | | the UE, SIZE = | | | | | 2 | | | | | | | | | | If three GNSSs | | | | | supported by | | | | | the UE, SIZE = | | | | | 3 | | | | | | | | | | If four GNSSs | | | | | supported by | | | | | the UE, SIZE = | | | | | 4 | | | +----------------+----------------+----------------+----------------+ | gnss-ID | For each GNSS | | | | | supported by | | | | | the UE. | | | +----------------+----------------+----------------+----------------+ | sbas-ID | Not present | | | +----------------+----------------+----------------+----------------+ | g | As defined in | | | | nss-TimeModels | 37.571-5 | | | | | [12] | | | +----------------+----------------+----------------+----------------+ | gnss-Different | Not present | | | | ialCorrections | | | | +----------------+----------------+----------------+----------------+ | gnss-N | As defined in | | | | avigationModel | 37.571-5 | | | | | [12] | | | +----------------+----------------+----------------+----------------+ | gnss-Rea | Not present | | | | lTimeIntegrity | | | | +----------------+----------------+----------------+----------------+ | gnss-Dat | Not present | | | | aBitAssistance | | | | +----------------+----------------+----------------+----------------+ | gnss-Acquisi | As defined in | | | | tionAssistance | 37.571-5 | | | | | [12] | | | +----------------+----------------+----------------+----------------+ | gnss-Almanac | As defined in | | | | | 37.571-5 | | | | | [12] | | | +----------------+----------------+----------------+----------------+ | gnss-UTC-Model | As defined in | | | | | 37.571-5 | | | | | [12] | | | +----------------+----------------+----------------+----------------+ | gnss-Auxili | As defined in | | | | aryInformation | 37.571-5 | | | | | [12] | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | gnss-Error | Not present | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | otdoa-Provide | | | Sub-test 5 and | | AssistanceData | | | 7 only | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | otdoa-Ref | As defined in | | | | erenceCellInfo | Table | | | | | 5.4.1.2-1 | | | +----------------+----------------+----------------+----------------+ | otdoa-Nei | As defined in | | | | ghbourCellInfo | Table | | | | | 5.4.1.2-2 | | | +----------------+----------------+----------------+----------------+ | otdoa-Error | Not present | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | epdu-Provide- | Not present | | | | AssistanceData | | | | +----------------+----------------+----------------+----------------+ | sens | | Rel-14 onwards | Sub-test 18 | | or-ProvideAssi | | | only as | | stanceData-r14 | | | defined in | | SEQUENCE { | | | clause 5.4.1.5 | +----------------+----------------+----------------+----------------+ | s | As defined in | | | | ensor-Assistan | Table | | | | ceDataList-r14 | 5.4.1.5-2 | | | +----------------+----------------+----------------+----------------+ | se | Not present | | | | nsor-Error-r14 | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | t | | Rel-14 onwards | Sub-test 16 | | bs-ProvideAssi | | | only as | | stanceData-r14 | | | defined in | | SEQUENCE { | | | clause 5.4.1.3 | +----------------+----------------+----------------+----------------+ | tbs-Assistan | | | | | ceDataList-r14 | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | mbs-Assistan | | | | | ceDataList-r14 | | | | | SEQUENCE | | | | | | | | | | (SIZE(1..n)) | | | | | OF SEQUENCE{ | | | | +----------------+----------------+----------------+----------------+ | mbs-Almanac | As defined in | | | | Assistance-r14 | Table | | | | | 5.4.1.3-2 | | | +----------------+----------------+----------------+----------------+ | mbs-Acquisiton | As defined in | | | | Assistance-r14 | Table | | | | | 5.4.1.3-2 | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | tbs-Error-r14 | Not present | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | wl | | Rel-14 onwards | Sub-test 17 | | an-ProvideAssi | | | only as | | stanceData-r14 | | | defined in | | SEQUENCE { | | | clause 5.4.1.4 | +----------------+----------------+----------------+----------------+ | wl | As defined in | | | | an-DataSet-r14 | Table | | | | | 5.4.1.4-2 | | | +----------------+----------------+----------------+----------------+ | wlan-Error-r14 | Not present | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+
#### \- LPP REQUEST LOCATION INFORMATION
_Table 5.4-3:_ RequestLocationInformation
+----------------+----------------+----------------+----------------+ | Derivation | | | | | Path: 36.355 | | | | | clause 6.2 | | | | +----------------+----------------+----------------+----------------+ | Information | Value/remark | Comment | Condition | | Element | | | | +----------------+----------------+----------------+----------------+ | LPP-Message | | | | | ::= SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | transactionID | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | initiator | locationServer | | | +----------------+----------------+----------------+----------------+ | tra | (0..255) | | | | nsactionNumber | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | endTransaction | FALSE | | | +----------------+----------------+----------------+----------------+ | sequenceNumber | Not present | | | +----------------+----------------+----------------+----------------+ | a | Not present | | | | cknowledgement | | | | +----------------+----------------+----------------+----------------+ | l | | | | | pp-MessageBody | | | | | CHOICE { | | | | +----------------+----------------+----------------+----------------+ | c1 CHOICE { | | | | +----------------+----------------+----------------+----------------+ | requestLocat | | | | | ionInformation | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | crit | | | | | icalExtensions | | | | | CHOICE { | | | | +----------------+----------------+----------------+----------------+ | c1 CHOICE { | | | | +----------------+----------------+----------------+----------------+ | r | | | | | equestLocation | | | | | Information-r9 | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | commonI | | | | | EsRequestLocat | | | | | ionInformation | | | | | | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | locationI | Dependent on | | | | nformationType | test case | | | +----------------+----------------+----------------+----------------+ | trig | Not present | | | | geredReporting | | | | +----------------+----------------+----------------+----------------+ | perio | Not present | | | | dicalReporting | | | | +----------------+----------------+----------------+----------------+ | additio | on | | | | nalInformation | lyReturnInform | | | | | ationRequested | | | +----------------+----------------+----------------+----------------+ | qos SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | hori | Not present | | | | zontalAccuracy | | | | +----------------+----------------+----------------+----------------+ | verticalCoo | FALSE | | | | rdinateRequest | | | | +----------------+----------------+----------------+----------------+ | ve | Not present | | | | rticalAccuracy | | | | +----------------+----------------+----------------+----------------+ | responseTime | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | time | 32 | | | +----------------+----------------+----------------+----------------+ | responseTi | Not present | Rel-12 onwards | | | meEarlyFix-r12 | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | v | FALSE | | | | elocityRequest | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | environment | Not present | | | +----------------+----------------+----------------+----------------+ | locationC | Not present | | | | oordinateTypes | | | | +----------------+----------------+----------------+----------------+ | velocityTypes | Not present | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | a-gns | As defined in | | Sub-tests 7 | | s-RequestLocat | Table 5.4-4 | | and 15 | | ionInformation | | | | +----------------+----------------+----------------+----------------+ | otdo | As defined in | | Sub-test 5 and | | a-RequestLocat | Table 5.4-5 | | 7 | | ionInformation | | | | +----------------+----------------+----------------+----------------+ | eci | As defined in | | Sub-test 6 | | d-RequestLocat | Table 5.4-6 | | | | ionInformation | | | | +----------------+----------------+----------------+----------------+ | epd | Not Present | | | | u-RequestLocat | | | | | ionInformation | | | | +----------------+----------------+----------------+----------------+ | sensor-Re | As defined in | Rel-13 onwards | Sub-test 14, | | questLocationI | Table 5.4-10 | | 18 | | nformation-r13 | | | | +----------------+----------------+----------------+----------------+ | tbs-Re | As defined in | Rel-13 onwards | Sub-tests 12, | | questLocationI | Table 5.4-7 | | 16 | | nformation-r13 | | | | +----------------+----------------+----------------+----------------+ | wlan-Re | As defined in | Rel-13 onwards | Sub-test 11, | | questLocationI | Table 5.4-8 | | 17 | | nformation-r13 | | | | +----------------+----------------+----------------+----------------+ | bt-Re | As defined in | Rel-13 onwards | Sub-test 13 | | questLocationI | Table 5.4-9 | | | | nformation-r13 | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+
#### \- A-GNSS REQUEST LOCATION INFORMATION
_Table 5.4-4:_ A-GNSS-RequestLocationInformation
+-----------------+-----------------+----------------+-----------+ | Derivation | | | | | Path: 36.355 | | | | | clause 6.5.2.7 | | | | +-----------------+-----------------+----------------+-----------+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+----------------+-----------+ | A-G | | | | | NSS-RequestLoca | | | | | tionInformation | | | | | ::= SEQUENCE { | | | | +-----------------+-----------------+----------------+-----------+ | gnss-Position | | | | | ingInstructions | | | | | SEQUENCE { | | | | +-----------------+-----------------+----------------+-----------+ | gnss-Methods | Dependent on | GNSS-ID-Bitmap | | | | the GNSS(s) | | | | | supported by | | | | | the UE. | | | | | | | | | | If GPS | | | | | supported bit 0 | | | | | = 1 | | | | | | | | | | If Galileo | | | | | supported bit 3 | | | | | = 1 | | | | | | | | | | If GLONASS | | | | | supported bit 4 | | | | | = 1 | | | | | | | | | | If BDS | | | | | supported bit 5 | | | | | = 1 | | | +-----------------+-----------------+----------------+-----------+ | fineTimeAs | FALSE | | | | sistanceMeasReq | | | | +-----------------+-----------------+----------------+-----------+ | adrMeasReq | FALSE | | | +-----------------+-----------------+----------------+-----------+ | m | FALSE | | | | ultiFreqMeasReq | | | | +-----------------+-----------------+----------------+-----------+ | assista | FALSE | | | | nceAvailability | | | | +-----------------+-----------------+----------------+-----------+ | } | | | | +-----------------+-----------------+----------------+-----------+ | } | | | | +-----------------+-----------------+----------------+-----------+
#### \- OTDOA REQUEST LOCATION INFORMATION
_Table 5.4-5:_ OTDOA-RequestLocationInformation
* * *
Derivation Path: 36.355 clause 6.5.1.6  
Information Element Value/remark Comment Condition OTDOA-
RequestLocationInformation ::= SEQUENCE {  
assistanceAvailability FALSE  
multipathRSTD-r14 Not present Rel-14 onwards maxNoOfRSTDmeas-r14 Not present
Rel-14 onwards }
* * *
#### \- ECID REQUEST LOCATION INFORMATION
_Table 5.4-6:_ ECID-RequestLocationInformation
* * *
Derivation Path: 36.355 clause 6.5.3.3  
Information Element Value/remark Comment Condition ECID-
RequestLocationInformation ::= SEQUENCE {  
requestedMeasurements All measurements supported by the UE  
}
* * *
#### \- TBS REQUEST LOCATION INFORMATION
_Table 5.4-7:_ TBS-RequestLocationInformation
* * *
Derivation Path: 36.355 clause 6.5.4.3  
Information Element Value/remark Comment Condition TBS-
RequestLocationInformation-r13 ::= SEQUENCE {  
mbsSgnMeasListReq-r13 TRUE (UE-Assisted MBS) Rel-13 onwards  
mbsAssistanceAvailability-r14 FALSE Rel-14 onwards  
mbsRequestedMeasurements-r14 Not present Rel-14 onwards  
}
* * *
#### \- WLAN REQUEST LOCATION INFORMATION
_Table 5.4-8:_ WLAN-RequestLocationInformation
+-----------------+-----------------+----------------+-----------+ | Derivation | | | | | Path: 36.355 | | | | | clause 6.5.6.3 | | | | +-----------------+-----------------+----------------+-----------+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+----------------+-----------+ | WLAN- | | | | | RequestLocation | | | | | Information-r13 | | | | | ::= SEQUENCE { | | | | +-----------------+-----------------+----------------+-----------+ | requestedM | bit 0 = 1 | Rel-13 onwards | | | easurements-r13 | (rssi) | | | | | (UE-Assisted | | | | | WLAN) | | | | | | | | | | bit 1 = 1 (rtt) | | | | | (UE-Assisted | | | | | WLAN) | | | +-----------------+-----------------+----------------+-----------+ | assistanceA | FALSE | Rel-14 onwards | | | vailability-r14 | | | | +-----------------+-----------------+----------------+-----------+ | } | | | | +-----------------+-----------------+----------------+-----------+
#### \- BT REQUEST LOCATION INFORMATION
_Table 5.4-9:_ BT-RequestLocationInformation
* * *
Derivation Path: 36.355 clause 6.5.7.3  
Information Element Value/remark Comment Condition BT-
RequestLocationInformation-r13 ::= SEQUENCE {  
requestedMeasurements-r13 bit 0 = 1 (rssi) (UE-Assisted BT) Rel-13 onwards  
}
* * *
#### \- SENSOR REQUEST LOCATION INFORMATION
_Table 5.4-10:_ Sensor-RequestLocationInformation
* * *
Derivation Path: 36.355 clause 6.5.5.3  
Information Element Value/remark Comment Condition Sensor-
RequestLocationInformation-r13 ::= SEQUENCE {  
uncompensatedBarometricPressureReq-r13 TRUE (UE-Assisted Sensor) Rel-13
onwards  
assistanceAvailability-r14 FALSE Rel-14 onwards  
}
* * *
### 5.4.1 Default assistance data information elements
#### 5.4.1.1 GNSS Assistance Data Elements
Table 5.4.1.1-1 defines the GNSS assistance data elements which shall be
provided to the UE in the tests in LPP Provide Assistance Data messages in the
absence of a corresponding LPP Request Assistance Data message. The GNSS
assistance data provided depends on the mode being used in the test case, the
assistance data supported by the UE and the GNSSs supported by the UE. GNSS
assistance data IEs not supported by the UE shall not be sent. GNSS assistance
data IEs supported by the UE but not listed in Table 5.4.1.1-1 shall not be
sent. The content of the assistance data elements is defined in 37.571-5 [12]
clause 7.
Table 5.4.1.1-1: GNSS assistance data to be provided to the UE
+----------------+----------------+----------------+----------------+ | GNSS | Mode used in | | | | Assistance | test case | | | | Data IE | | | | | supported by | | | | | UE | | | | +================+================+================+================+ | | UE-based | UE-assisted, | UE-assisted, | | | | | | | | | GNSS-Acquisi | GNSS-Acquisi | | | | tionAssistance | tionAssistance | | | | supported by | not supported | | | | UE | by UE | +----------------+----------------+----------------+----------------+ | GNSS-Reference | Yes | Yes | Yes | | Time | | | | +----------------+----------------+----------------+----------------+ | GNSS-Ref | Yes | No | Yes | | erenceLocation | | | | +----------------+----------------+----------------+----------------+ | GNSS-Io | Yes | No | No | | nosphericModel | | | | +----------------+----------------+----------------+----------------+ | GNSS | Yes^(1)^ | No | Yes^(1)^ | | -TimeModelList | | | | +----------------+----------------+----------------+----------------+ | GNSS-N | Yes | No | Yes | | avigationModel | | | | +----------------+----------------+----------------+----------------+ | GNSS-Acquisi | No | Yes | No | | tionAssistance | | | | +----------------+----------------+----------------+----------------+ | GNSS-Almanac | No | No | Yes | +----------------+----------------+----------------+----------------+ | GNSS-UTC-Model | Yes^(3)^ | Yes^(3)^ | Yes^(3)^ | +----------------+----------------+----------------+----------------+ | GNSS-Auxili | Yes^(2)^ | Yes^(2)^ | Yes^(2)^ | | aryInformation | | | | +----------------+----------------+----------------+----------------+ | NOTE 1: Only | | | | | if more than | | | | | one GNSS | | | | | supported by | | | | | the UE. | | | | | | | | | | NOTE 2: Only | | | | | if GLONASS | | | | | supported by | | | | | the UE, and/or | | | | | if the UE | | | | | supports | | | | | multiple | | | | | signals per | | | | | GNSS, and/or | | | | | if BDS B1C/B2a | | | | | signal type | | | | | supported by | | | | | the UE. | | | | | | | | | | NOTE 3: Only | | | | | if GLONASS and | | | | | at least one | | | | | other GNSS | | | | | supported by | | | | | the UE. | | | | +----------------+----------------+----------------+----------------+
#### 5.4.1.2 OTDOA Assistance Data Elements
This subclause defines the OTDOA assistance data elements which shall be
provided to the UE in the tests in LPP Provide Assistance Data messages.
#### \- OTDOA REFERENCE CELL INFO
_Table 5.4.1.2-1:_ OTDOA-ReferenceCellInfo
+----------------+----------------+----------------+----------------+ | Derivation | | | | | Path: 36.355 | | | | | clause 6.5.1.2 | | | | +----------------+----------------+----------------+----------------+ | Information | Value/remark | Comment | Condition | | Element | | | | +----------------+----------------+----------------+----------------+ | OTDOA-Ref | | Cell 1 | | | erenceCellInfo | | | | | ::= SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | physCellId | 0 | | | +----------------+----------------+----------------+----------------+ | cellGlobalId | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | mcc | As defined for | | | | | Cell 1 in | | | | | 36.508 [8] | | | +----------------+----------------+----------------+----------------+ | mnc | As defined for | | | | | Cell 1 in | | | | | 36.508 [8] | | | +----------------+----------------+----------------+----------------+ | cellidentity | As defined for | | | | | E-UTRAN Cell | | | | | Identifier for | | | | | Cell 1 in | | | | | 36.508 [8] | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | earfcnRef | Not present | Same as the | | | | | serving cell | | +----------------+----------------+----------------+----------------+ | ant | Not present | Same as the | | | ennaPortConfig | | serving cell | | +----------------+----------------+----------------+----------------+ | cpLength | Normal | | | +----------------+----------------+----------------+----------------+ | prsInfo | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | prs-Bandwidth | PRS are | | | | | transmitted | | | | | over the used | | | | | system | | | | | bandwidth (see | | | | | subclause | | | | | 5.2.2) | | | +----------------+----------------+----------------+----------------+ | prs-Conf | FDD: 2 | | | | igurationIndex | | | | | | TDD: 4 | | | +----------------+----------------+----------------+----------------+ | numDL-Frames | sf-1 | | | +----------------+----------------+----------------+----------------+ | prs | Not present | PRS muting is | | | -MutingInfo-r9 | | not used. | | +----------------+----------------+----------------+----------------+ | prsID-r14 | Not present | PRS-ID not | Rel-14 onwards | | | | used | | +----------------+----------------+----------------+----------------+ | add-nu | Not present | Not required | Rel-14 onwards | | mDL-Frames-r14 | | | | +----------------+----------------+----------------+----------------+ | prsO | Not present | No PRS | Rel-14 onwards | | ccGroupLen-r14 | | occasion group | | | | | configured | | +----------------+----------------+----------------+----------------+ | prsH | Not present | PRS frequency | Rel-14 onwards | | oppingInfo-r14 | | hopping not | | | | | used | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | earfcnRef-v9a0 | Not present | Same as the | | | | | serving cell | | +----------------+----------------+----------------+----------------+ | tpId-r14 | Not present | Transmission | Rel-14 onwards | | | | Points not | | | | | used | | +----------------+----------------+----------------+----------------+ | c | Normal | | Rel-14 onwards | | pLengthCRS-r14 | | | | +----------------+----------------+----------------+----------------+ | sameMBSF | TRUE | Same as the | Rel-14 onwards | | NconfigRef-r14 | | serving cell | | +----------------+----------------+----------------+----------------+ | d | Not present | Same as the | Rel-14 onwards | | lBandwidth-r14 | | serving cell | | | | | and PRS | | | | | frequency | | | | | hopping not | | | | | used | | +----------------+----------------+----------------+----------------+ | addPR | Not present | **_No | Rel-14 onwards | | SconfigRef-r14 | | additional PRS | | | | | confi | | | | | guration(s)_** | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+
#### \- OTDOA NEIGHBOUR CELL INFO LIST
_Table 5.4.1.2-2:_ OTDOA-NeighbourCellInfoList
* * *
Derivation Path: 36.355 clause 6.5.1.2  
Information Element Value/remark Comment Condition OTDOA-NeighbourCellInfoList
::= SEQUENCE (SIZE(1)) OF SEQUENCE {  
SEQUENCE (SIZE(2)) OF SEQUENCE { Cell 2  
physCellId 2  
cellGlobalId SEQUENCE {  
mcc As defined for Cell 2 in 36.508 [8]  
mnc As defined for Cell 2 in 36.508 [8]  
cellidentity As defined for E-UTRAN Cell Identifier for Cell 2 in 36.508 [8]  
}  
earfcn Not present Same as for the reference cell  
cpLength Not present Same as for the reference cell  
prsInfo Not present Same as for the reference cell  
antennaPortConfig Not present Same as for the reference cell  
slotNumberOffset Not present Slot timing is the same as for reference cell  
prs-SubframeOffset Not present  
expectedRSTD 8192 Value 0  
expectedRSTD-Uncertainty 10 About 1 μs  
earfcn-v9a0 Not present Same as for the reference cell  
tpId-r14 Not present Transmission Points not used Rel-14 onwards prs-only-
tp-r14 Not present Not required Rel-14 onwards cpLengthCRS-r14 Not present Not
required Rel-14 onwards sameMBSFNconfigNeighbour-r14 TRUE Same as for the
reference cell Rel-14 onwards dlBandwidth-r14 Not present Same as for the
reference cell and PRS frequency hopping not used Rel-14 onwards
addPRSconfigNeighbour-r14 Not present **_No additional PRS configuration(s)_**
Rel-14 onwards }  
SEQUENCE { Cell 4  
physCellId 4  
cellGlobalId SEQUENCE {  
mcc As defined for Cell 4 in 36.508 [8]  
mnc As defined for Cell 4 in 36.508 [8]  
cellidentity As defined for E-UTRAN Cell Identifier for Cell 4 in 36.508 [8]  
}  
earfcn Not present Same as for the reference cell  
cpLength Not present Same as for the reference cell  
prsInfo Not present Same as for the reference cell  
antennaPortConfig Not present Same as for the reference cell  
slotNumberOffset Not present Slot timing is the same as for reference cell  
prs-SubframeOffset Not present  
expectedRSTD 8192 Value 0  
expectedRSTD-Uncertainty 10 About 1 μs  
earfcn-v9a0 Not present Same as for the reference cell  
tpId-r14 Not present Transmission Points not used Rel-14 onwards prs-only-
tp-r14 Not present Not required Rel-14 onwards cpLengthCRS-r14 Not present Not
required Rel-14 onwards sameMBSFNconfigNeighbour-r14 TRUE Same as for the
reference cell Rel-14 onwards dlBandwidth-r14 Not present Same as for the
reference cell and PRS frequency hopping not used Rel-14 onwards
addPRSconfigNeighbour-r14 Not present **_No additional PRS configuration(s)_**
Rel-14 onwards }  
}
* * *
#### 5.4.1.3 MBS Assistance Data Elements
Tables 5.4.1.3-1 and 5.4.1.3-2 define the MBS assistance data elements which
shall be provided to the UE in sub-test 16 via LPP Provide Assistance Data
messages in the absence of a corresponding LPP Request Assistance Data
message.
Table 5.4.1.3-1 defines the MBS assistance data IEs that conditionally depend
on the mode being used in the test case and on the assistance data supported
by the UE.
Table 5.4.1.3-2 defines the content of the TBS-AssistantDataList.
Table 5.4.1.3-1: MBS assistance data IEs to be conditionally provided to the
UE
+----------------------+----------------------+----------------------+ | MBS Assistance Data | Mode used in test | | | IE supported by UE | case | | +======================+======================+======================+ | | UE-based, MBS | UE-assisted, | | | (Release 14 onwards) | | | | | MBS (Release 14 | | | | onwards) | +----------------------+----------------------+----------------------+ | mbs-A | Yes | No | | lmanacAssistance-r14 | | | +----------------------+----------------------+----------------------+ | mbs-Acqui | Yes | Yes | | sitionAssistance-r14 | | | +----------------------+----------------------+----------------------+
**Table 5.4.1.3-2: Content of TBS-AssistanceDataList**
+-------------------+-------------------+--------------+-----------+ | Derivation Path: | | | | | TS 36.355 [4] | | | | | clause 6.5.4 | | | | +-------------------+-------------------+--------------+-----------+ | Information | Value/remark | Comment | Condition | | Element | | | | +-------------------+-------------------+--------------+-----------+ | tbs-Assis | | | | | tanceDataList-r14 | | | | | SEQUENCE { | | | | +-------------------+-------------------+--------------+-----------+ | mbs-Assis | | | | | tanceDataList-r14 | | | | | SEQUENCE { | | | | +-------------------+-------------------+--------------+-----------+ | mbs-Assistan | | Beacon 1 tb1 | | | ceDataElement-r14 | | | | | | | | | | SEQUENCE { | | | | +-------------------+-------------------+--------------+-----------+ | mbs-Alma | According to | | | | nacAssistance-r14 | Table 5.4.1.3-1 | | | | | and as defined in | | | | | TS 37.571-5 | | | | | [12], clause 8 | | | +-------------------+-------------------+--------------+-----------+ | mbs-Acquisit | According to | | | | ionAssistance-r14 | Table 5.4.1.3-1 | | | | | and as defined in | | | | | TS 37.571-5 | | | | | [12], clause 8 | | | +-------------------+-------------------+--------------+-----------+ | } | | | | +-------------------+-------------------+--------------+-----------+ | mbs-Assistan | | Beacon 2 tb1 | | | ceDataElement-r14 | | | | | | | | | | SEQUENCE { | | | | +-------------------+-------------------+--------------+-----------+ | mbs-Alma | According to | | | | nacAssistance-r14 | Table 5.4.1.3-1 | | | | | and as defined in | | | | | TS 37.571-5 | | | | | [12], clause 8 | | | +-------------------+-------------------+--------------+-----------+ | mbs-Acquisit | According to | | | | ionAssistance-r14 | Table 5.4.1.3-1 | | | | | and as defined in | | | | | TS 37.571-5 | | | | | [12], clause 8 | | | +-------------------+-------------------+--------------+-----------+ | } | | | | +-------------------+-------------------+--------------+-----------+ | mbs-Assistan | | Beacon 3 tb1 | | | ceDataElement-r14 | | | | | | | | | | SEQUENCE { | | | | +-------------------+-------------------+--------------+-----------+ | mbs-Alma | According to | | | | nacAssistance-r14 | Table 5.4.1.3-1 | | | | | and as defined in | | | | | TS 37.571-5 | | | | | [12], clause 8 | | | +-------------------+-------------------+--------------+-----------+ | mbs-Acquisit | According to | | | | ionAssistance-r14 | Table 5.4.1.3-1 | | | | | and as defined in | | | | | TS 37.571-5 | | | | | [12], clause 8 | | | +-------------------+-------------------+--------------+-----------+ | } | | | | +-------------------+-------------------+--------------+-----------+ | mbs-Assistan | | Beacon 4 tb1 | | | ceDataElement-r14 | | | | | | | | | | SEQUENCE { | | | | +-------------------+-------------------+--------------+-----------+ | mbs-Alma | According to | | | | nacAssistance-r14 | Table 5.4.1.3-1 | | | | | and as defined in | | | | | TS 37.571-5 | | | | | [12], clause 8 | | | +-------------------+-------------------+--------------+-----------+ | mbs-Acquisit | According to | | | | ionAssistance-r14 | Table 5.4.1.3-1 | | | | | and as defined in | | | | | TS 37.571-5 | | | | | [12], clause 8 | | | +-------------------+-------------------+--------------+-----------+ | } | | | | +-------------------+-------------------+--------------+-----------+ | mbs-Assistan | | Beacon 1 tb2 | | | ceDataElement-r14 | | | | | | | | | | SEQUENCE { | | | | +-------------------+-------------------+--------------+-----------+ | mbs-Alma | According to | | | | nacAssistance-r14 | Table 5.4.1.3-1 | | | | | and as defined in | | | | | TS 37.571-5 | | | | | [12], clause 8 | | | +-------------------+-------------------+--------------+-----------+ | mbs-Acquisit | According to | | | | ionAssistance-r14 | Table 5.4.1.3-1 | | | | | and as defined in | | | | | TS 37.571-5 | | | | | [12], clause 8 | | | +-------------------+-------------------+--------------+-----------+ | } | | | | +-------------------+-------------------+--------------+-----------+ | mbs-Assistan | | Beacon 2 tb2 | | | ceDataElement-r14 | | | | | | | | | | SEQUENCE { | | | | +-------------------+-------------------+--------------+-----------+ | mbs-Alma | According to | | | | nacAssistance-r14 | Table 5.4.1.3-1 | | | | | and as defined in | | | | | TS 37.571-5 | | | | | [12], clause 8 | | | +-------------------+-------------------+--------------+-----------+ | mbs-Acquisit | According to | | | | ionAssistance-r14 | Table 5.4.1.3-1 | | | | | and as defined in | | | | | TS 37.571-5 | | | | | [12], clause 8 | | | +-------------------+-------------------+--------------+-----------+ | } | | | | +-------------------+-------------------+--------------+-----------+ | mbs-Assistan | | Beacon 3 tb2 | | | ceDataElement-r14 | | | | | | | | | | SEQUENCE { | | | | +-------------------+-------------------+--------------+-----------+ | mbs-Alma | According to | | | | nacAssistance-r14 | Table 5.4.1.3-1 | | | | | and as defined in | | | | | TS 37.571-5 | | | | | [12], clause 8 | | | +-------------------+-------------------+--------------+-----------+ | mbs-Acquisit | According to | | | | ionAssistance-r14 | Table 5.4.1.3-1 | | | | | and as defined in | | | | | TS 37.571-5 | | | | | [12], clause 8 | | | +-------------------+-------------------+--------------+-----------+ | } | | | | +-------------------+-------------------+--------------+-----------+ | mbs-Assistan | | Beacon 4 tb2 | | | ceDataElement-r14 | | | | | | | | | | SEQUENCE { | | | | +-------------------+-------------------+--------------+-----------+ | mbs-Alma | According to | | | | nacAssistance-r14 | Table 5.4.1.3-1 | | | | | and as defined in | | | | | TS 37.571-5 | | | | | [12], clause 8 | | | +-------------------+-------------------+--------------+-----------+ | mbs-Acquisit | According to | | | | ionAssistance-r14 | Table 5.4.1.3-1 | | | | | and as defined in | | | | | TS 37.571-5 | | | | | [12], clause 8 | | | +-------------------+-------------------+--------------+-----------+ | } | | | | +-------------------+-------------------+--------------+-----------+ | } | | | | +-------------------+-------------------+--------------+-----------+ | } | | | | +-------------------+-------------------+--------------+-----------+
#### 5.4.1.4 WLAN Assistance Data Elements
Tables 5.4.1.4-1 and 5.4.1.4-2 define the WLAN assistance data elements which
shall be provided to the UE in sub-test 17 via LPP Provide Assistance Data
messages in the absence of a corresponding LPP Request Assistance Data
message.
Table 5.4.1.4-1 defines the WLAN assistance data IE that conditionally depends
on the mode being used in the test case and on the assistance data supported
by the UE.
Table 5.4.1.4-2 defines the content of the WLAN-DataSet.
Table 5.4.1.4-1: WLAN assistance data IE to be conditionally provided to the
UE
+----------------------+----------------------+----------------------+ | WLAN assistance data | Mode used in test | | | IE supported by UE | case | | +======================+======================+======================+ | | UE-based, WLAN | UE-assisted, | | | (Release 14 onwards) | | | | | WLAN (Release 14 | | | | onwards) | +----------------------+----------------------+----------------------+ | wlan-AP-Location-r14 | Yes | No | | (WLAN AP location | | | | information) | | | +----------------------+----------------------+----------------------+
**Table 5.4.1.4-2: Content of WLAN-DataSet**
* * *
Derivation Path: TS 36.355 [4] clause 6.5.6.8  
Information Element Value/remark Comment Condition wlan-DataSet-r14::=
SEQUENCE (SIZE (1)) OF SEQUENCE { Rel-14 onwards SEQUENCE (SIZE (4)) OF
SEQUENCE.{  
WLAN-AP-Data-r14 SEQUENCE { WLAN AP 1  
wlan-AP-Identifier-r14 As defined in TS 37.571-5 [12], clause 9  
wlan-AP-Location-r14 According to Table 5.4.1.4-1 and as defined in TS
37.571-5 [12], clause 9  
}  
WLAN-AP-Data-r14 SEQUENCE { WLAN AP 2  
wlan-AP-Identifier-r14 As defined in TS 37.571-5 [12], clause 9  
wlan-AP-Location-r14 According to Table 5.4.1.4-1 and as defined in TS
37.571-5 [12], clause 9  
}  
WLAN-AP-Data-r14 SEQUENCE { WLAN AP 3  
wlan-AP-Identifier-r14 As defined in TS 37.571-5 [12], clause 9  
wlan-AP-Location-r14 According to Table 5.4.1.4-1 and as defined in TS
37.571-5 [12], clause 9  
}  
WLAN-AP-Data-r14 SEQUENCE { WLAN AP 4  
wlan-AP-Identifier-r14 As defined in TS 37.571-5 [12], clause 9  
wlan-AP-Location-r14 According to Table 5.4.1.4-1 and as defined in TS
37.571-5 [12], clause 9  
}  
supportedChannels-11a-r14 As defined in TS 37.571-5 [12], clause 9  
supportedChannels-11bg-r14 As defined in TS 37.571-5 [12], clause 9  
}  
}
* * *
#### 5.4.1.5 Sensor Assistance Data Elements
Tables 5.4.1.5-1 and 5.4.1.5-2 define the Sensor assistance data elements
which shall be provided to the UE in sub-test 18 via LPP Provide Assistance
Data messages in the absence of a corresponding LPP Request Assistance Data
message.
Table 5.4.1.5-1 defines the Sensor assistance data IE that conditionally
depends on the mode being used in the test case.
Table 5.4.1.5-2 defines the content of the Sensor-AssistanceDataList.
Table 5.4.1.5-1: Sensor assistance data IE to be conditionally provided to the
UE
+----------------------+----------------------+----------------------+ | Sensor assistance | Mode used in test | | | data to be provided | case | | | to the UE | | | +======================+======================+======================+ | | UE-based, Sensor | UE-assisted, | | | (Release 14 onwards) | | | | | Sensor (Release 14 | | | | onwards) | +----------------------+----------------------+----------------------+ | sensor-As | Yes | No | | sistanceDataList-r14 | | | +----------------------+----------------------+----------------------+
**Table 5.4.1.5-2: Content of Sensor-AssistanceDataList**
* * *
Derivation Path: TS 36.355 [4] clause 6.5.5.8  
Information Element Value/remark Comment Condition Sensor-
AssistanceDataList-r14::= SEQUENCE { According to Table 5.4.1.5-1 Rel-14
onwards refPressure-r14 0 101325 Pa  
refPosition-r14 As defined in TS 37.571-5 [12], clause 6.1.3.4, GNSS-
ReferenceLocation As used in GNSS sub-tests  
refTemperature-r14 20 293K  
period-v1520 Not present  
area-v1520 Not present  
}
* * *
# 6 Protocol Conformance Test Cases for UTRAN
## 6.1 Assisted-GPS Test Cases
### 6.1.1 Assisted GPS Network Induced Tests
#### 6.1.1.1 LCS Network Induced location request/ UE-Based GPS/ Emergency
Call / with USIM
##### 6.1.1.1.1 Definition {#definition .H6}
This test case applies to all UEs supporting UE-Based GPS Location Service
capabilities.
##### 6.1.1.1.2 Conformance requirements {#conformance-requirements .H6}
1) A MM connection for an emergency call may be established in all states of
the mobility management sublayer which allow MM connection establishment for a
normal originating call.
When a user requests an emergency call establishment the UE will send a CM
SERVICE REQUEST message to the network with a CM service type information
element indicating emergency call establishment.
2) Having entered the \"MM connection pending\" state, upon MM connection
establishment, the call control entity of the UE sends a setup message to its
peer entity. This setup message is
\- a SETUP message, if the call to be established is a basic call; and
\- an EMERGENCY SETUP message, if the call to be established is an emergency
call.
3) If the IE \"UE positioning GPS reference time\" is included, the UE shall:
1> store the IE \"GPS Week\" in \"UE positioning GPS reference time\" in
variable UE_POSITIONING_GPS_DATA and use it as the current GPS week;
1> store the IE \"GPS TOW msec\" in the IE \"UE positioning GPS reference
time\" in variable UE_POSITIONING_GPS_DATA and use it as an estimate of the
GPS Time-of-Week at the time of reception of the complete message containing
the IE \"GPS TOW msec\";
NOTE: The UE does not need to apply any compensation on the GPS Time-of-Week.
4) If the IE \"UE positioning GPS reference UE position\" is included, the UE
shall:
1> store this IE in the IE \"UE positioning GPS reference UE position\" in
variable UE_POSITIONING_GPS_DATA; and
1> use it as a priori knowledge of the approximate location of the UE.
5) The UE shall when a measurement report is triggered:
2> if the UE has been able to calculate a position after performing
measurements on the cells included in the variable
UE_POSITIONING_OTDOA_DATA_UE_BASED in case of OTDOA or on the list of
satellites included in the variable UE_POSITIONING_GPS_DATA in case of GPS
positioning:
3> include IE \"UE positioning Position Estimate Info\" in the MEASUREMENT
REPORT and set the contents of the IE as follows:
4> if the UE does not support the capability to perform the UE GPS timing of
cell frames measurement; or
4> if the IE \"GPS timing of Cell wanted\" is set to FALSE:
5> include the IE \"GPS TOW msec\".
4> if IE \"Vertical Accuracy\" has been included in IE \"UE positioning
reporting quantity\":
5> if the IE \"Vertical Accuracy\" has been assigned to a value unequal to
\"0\":
> 6> if the UE has been able to calculate a 3-dimensional position:
>
> 7> include IE \"Ellipsoid point with altitude and uncertainty ellipsoid\" as
> the position estimate.
>
> 6> if the UE has not been able to calculate a 3-dimensional position:
>
> 7> act as if IE \"Vertical Accuracy\" has not been included in IE \"UE
> positioning reporting quantity\".
4> if IE \"Vertical Accuracy\" has not been included in IE \"UE positioning
reporting quantity\":
5> if IE \"Horizontal Accuracy\" in IE \"UE positioning reporting quantity\"
has been assigned to a value unequal to 0:
> 6> include either IE \"Ellipsoid point with uncertainty circle\" or IE
> \"Ellipsoid point with uncertainty ellipse\" or IE \"Ellipsoid point with
> altitude and uncertainty ellipsoid\" as the position estimate.
##### Reference(s): {#references-1 .H6}
\- Conformance requirement 1: TS 24.008 clause 4.5.1.5.
\- Conformance requirement 2: TS 24.008, clause 5.2.1.
\- Conformance requirement 3: TS 25.331, clause 8.6.7.19.3.7.
\- Conformance requirement 4: TS 25.331, clause 8.6.7.19.3.8.
\- Conformance requirement 5: TS 25.331, clause 8.6.7.19.1b.
##### 6.1.1.1.3 Test Purpose {#test-purpose .H6}
To verify when an emergency call is initiated by a UE with a USIM, and the
network performs a location request using the RRC measurement control
procedure by sending Measurement Control message , then the UE respond with a
Measurement Report containing UE location.
##### 6.1.1.1.4 Method of Test {#method-of-test .H6}
##### Initial Conditions {#initial-conditions .H6}
\- System Simulator:
\- 1 cell, default parameters.
\- Satellite signals: As specified in 4.2.
\- User Equipment:
\- the UE is in state \"MM idle\" with valid TMSI and CKSN.
##### Related PICS/PIXIT Statements {#related-picspixit-statements .H6}
\- Emergency speech call yes/no
\- UE Based Network Assisted GPS
##### Test procedure {#test-procedure .H6}
The UE is made to initiate an emergency call.
After the call has been through-connected in both directions, the SS orders an
A-GPS positioning measurement using two MEASUREMENT CONTROL messages. The last
MEASUREMENT CONTROL message orders periodical reporting by sending a
MEASUREMENT CONTROL message requesting periodical measurement reporting (1
report, interval 64s).
The UE then performs positioning measurements, calculates \"UE Positioning
Position Estimate Info\" and responds with this in the RRC message MEASUREMENT
REPORT.
Finally the SS clears the call.
##### Expected Sequence {#expected-sequence .H6}
+------+-----------+----------------------+----------------------+---+ | Step | Direction | Message | Comments | | +------+-----------+----------------------+----------------------+---+ | | UE | SS | | | +------+-----------+----------------------+----------------------+---+ | 1 | UE | | The \"emergency | | | | | | number\" is entered. | | | | | | Number shall be one | | | | | | programmed in test | | | | | | USIM EF~ECC~ | | | | | | (Emergency Call | | | | | | Codes), ref. 34.108 | | | | | | clause 8.3.2.21. | | +------+-----------+----------------------+----------------------+---+ | 2 | --> | | UE establishes RRC | | | | | | procedure for | | | | | | emergency call. | | | | | | | | | | | | Establishment cause: | | | | | | Emergency Call\ | | | | | | SS checks that the | | | | | | UE capability | | | | | | includes A-GPS UE | | | | | | based positioning | | | | | | measurement | | +------+-----------+----------------------+----------------------+---+ | 3 | --> | CM SERVICE REQUEST | The CM service type | | | | | | IE indicates | | | | | | \"emergency call | | | | | | establishment\". | | +------+-----------+----------------------+----------------------+---+ | 4 | \ | AUTHENTICATION | SRES specifies | | | | | RESPONSE | correct value. | | +------+-----------+----------------------+----------------------+---+ | 6 | | | SS starts security | | | | | | procedure. | | +------+-----------+----------------------+----------------------+---+ | 7 | --> | EMERGENCY SETUP | If the Bearer | | | | | | capability IE is not | | | | | | included the default | | | | | | UMTS AMR speech | | | | | | version shall be | | | | | | assumed. | | +------+-----------+----------------------+----------------------+---+ | 8 | \ | CONNECT ACKNOWLEDGE | | | +------+-----------+----------------------+----------------------+---+ | 13 | UE | | The DTCH is through | | | | | | connected in both | | | | | | directions. | | +------+-----------+----------------------+----------------------+---+ | 14 | \ | MEASUREMENT REPORT | | | +------+-----------+----------------------+----------------------+---+ | 17 | \ When a user requests an emergency call establishment the UE will send a CM
> SERVICE REQUEST message to the network with a CM service type information
> element indicating emergency call establishment.
>
> Normally, the UE will be identified by an IMSI or a TMSI. However, if none
> of these identifiers is available in the UE, then the UE shall use the IMEI
> for identification purposes.
>
> 2) As a serving network option, emergency calls may be established without
> the network having to apply the security mode procedure as defined in TS
> 24.008.
>
> The following are the only cases where the \"security procedure not
> applied\" option may be used:
>
> a) Authentication is impossible because the USIM is absent.
>
> 3) Having entered the \"MM connection pending\" state, upon MM connection
> establishment, the call control entity of the UE sends a setup message to
> its peer entity. This setup message is
>
> \- a SETUP message, if the call to be established is a basic call; and
>
> \- an EMERGENCY SETUP message, if the call to be established is an emergency
> call.
>
> 4) If the IE \"UE positioning GPS reference time\" is included, the UE
> shall:
>
> 1> store the IE \"GPS Week\" in \"UE positioning GPS reference time\" in
> variable UE_POSITIONING_GPS_DATA and use it as the current GPS week;
>
> 1> store the IE \"GPS TOW msec\" in the IE \"UE positioning GPS reference
> time\" in variable UE_POSITIONING_GPS_DATA and use it as an estimate of the
> GPS Time-of-Week at the time of reception of the complete message containing
> the IE \"GPS TOW msec\";
NOTE: The UE does not need to apply any compensation on the GPS Time-of-Week.
> 5) If the IE \"UE positioning GPS reference UE position\" is included, the
> UE shall:
>
> 1> store this IE in the IE \"UE positioning GPS reference UE position\" in
> variable UE_POSITIONING_GPS_DATA; and
>
> 1> use it as a priori knowledge of the approximate location of the UE.
>
> 6) The UE shall when a measurement report is triggered:
>
> 2> if the UE has been able to calculate a position after performing
> measurements on the cells included in the variable
> UE_POSITIONING_OTDOA_DATA_UE_BASED in case of OTDOA or on the list of
> satellites included in the variable UE_POSITIONING_GPS_DATA in case of GPS
> positioning:
>
> 3> include IE \"UE positioning Position Estimate Info\" in the MEASUREMENT
> REPORT and set the contents of the IE as follows:
>
> 4> if the UE does not support the capability to perform the UE GPS timing of
> cell frames measurement; or
>
> 4> if the IE \"GPS timing of Cell wanted\" is set to FALSE:
>
> 5> include the IE \"GPS TOW msec\".
>
> 4> if IE \"Vertical Accuracy\" has been included in IE \"UE positioning
> reporting quantity\":
>
> 5> if the IE \"Vertical Accuracy\" has been assigned to a value unequal to
> \"0\":
>
> 6> if the UE has been able to calculate a 3-dimensional position:
>
> 7> include IE \"Ellipsoid point with altitude and uncertainty ellipsoid\" as
> the position estimate.
>
> 6> if the UE has not been able to calculate a 3-dimensional position:
>
> 7> act as if IE \"Vertical Accuracy\" has not been included in IE \"UE
> positioning reporting quantity\".
>
> 4> if IE \"Vertical Accuracy\" has not been included in IE \"UE positioning
> reporting quantity\":
>
> 5> if IE \"Horizontal Accuracy\" in IE \"UE positioning reporting quantity\"
> has been assigned to a value unequal to 0:
>
> 6> include either IE \"Ellipsoid point with uncertainty circle\" or IE
> \"Ellipsoid point with uncertainty ellipse\" or IE \"Ellipsoid point with
> altitude and uncertainty ellipsoid\" as the position estimate.
##### Reference(s): {#references-2 .H6}
\- Conformance requirement 1: TS 24.008 clause 4.5.1.5, TS 22.101 clause 8.
\- Conformance requirement 2: TS 33.102, clause 6.4.9.2.
\- Conformance requirement 3: TS 24.008, clause 5.2.1.
\- Conformance requirement 4: TS 25.331, clause 8.6.7.19.3.7.
\- Conformance requirement 5: TS 25.331, clause 8.6.7.19.3.8.
\- Conformance requirement 6: TS 25.331, clause 8.6.7.19.1b.
##### 6.1.1.2.3 Test Purpose {#test-purpose-1 .H6}
To verify when an emergency call is initiated by a UE in the \"MM idle, no
IMSI\" state (no USIM inserted) and the network performs a location request
using the RRC measurement control procedure by sending Measurement Control
message , then the UE respond with a Measurement Report containing UE
location.
##### 6.1.1.2.4 Method of Test {#method-of-test-1 .H6}
##### Initial Conditions {#initial-conditions-1 .H6}
\- System Simulator:
\- 1 cell, default parameters.
\- Satellite signals: As specified in 4.2
\- User Equipment:
\- the UE is in MM-state \"MM idle, no IMSI\", no USIM inserted.
##### Related PICS/PIXIT Statements {#related-picspixit-statements-1 .H6}
\- Emergency speech call yes/no
\- UE Based Network Assisted GPS
##### Test procedure {#test-procedure-1 .H6}
The UE is made to initiate an emergency call.
After the call has been through-connected in both directions, the SS orders an
A-GPS positioning measurement using two MEASUREMENT CONTROL messages. The last
MEASUREMENT CONTROL message orders periodical reporting by sending a
MEASUREMENT CONTROL message requesting periodical measurement reporting (1
report, interval 64s).
The UE then performs positioning measurements, calculates \"UE Positioning
Position Estimate Info\" and responds with this in the RRC message MEASUREMENT
REPORT.
Finally the SS clears the call.
##### Expected Sequence {#expected-sequence-1 .H6}
+------+-----------+---------------------+----------------------+---+ | Step | Direction | Message | Comments | | +------+-----------+---------------------+----------------------+---+ | | UE | SS | | | +------+-----------+---------------------+----------------------+---+ | 1 | UE | | The \"emergency | | | | | | number\" is entered. | | | | | | One of the following | | | | | | emergency numbers | | | | | | shall be used: 000, | | | | | | 08, 112, 110, 118, | | | | | | 119, 911 or 999. | | +------+-----------+---------------------+----------------------+---+ | 2 | --> | | UE establishes RRC | | | | | | procedure for | | | | | | emergency call. | | | | | | | | | | | | Establishment cause: | | | | | | Emergency Call\ | | | | | | SS checks that the | | | | | | UE capability | | | | | | includes A-GPS UE | | | | | | based positioning | | | | | | measurement | | +------+-----------+---------------------+----------------------+---+ | 3 | --> | CM SERVICE REQUEST | The CM service type | | | | | | IE indicates | | | | | | \"emergency call | | | | | | establishment\". | | +------+-----------+---------------------+----------------------+---+ | 4 | \ | EMERGENCY SETUP | If the Bearer | | | | | | capability IE is not | | | | | | included the default | | | | | | UMTS AMR speech | | | | | | version shall be | | | | | | assumed. | | +------+-----------+---------------------+----------------------+---+ | 6 | \ | CONNECT ACKNOWLEDGE | | | +------+-----------+---------------------+----------------------+---+ | 11 | UE | | The DTCH is through | | | | | | connected in both | | | | | | directions. | | +------+-----------+---------------------+----------------------+---+ | 12 | \ | MEASUREMENT REPORT | | | +------+-----------+---------------------+----------------------+---+ | 15 | \ store this measurement in the variable MEASUREMENT_IDENTITY according to
the IE \"measurement identity\", first releasing any previously stored
measurement with that identity if that exists;
...
2> for any other measurement type:
3> if the measurement is valid in the current RRC state of the UE:
4> begin measurements according to the stored control information for this
measurement identity.
4) The UE shall:
1> when a measurement report is triggered:
2> if the UE was able to perform measurements on at least one neighbour cell
included in the variable UE_POSITIONING_OTDOA_DATA_UE_ASSISTED in case of
OTDOA or one satellite included in the variable UE_POSITIONING_GPS_DATA in
case of GPS positioning or one cell from the active set in case of CELL ID:
3> if the IE \"Vertical Accuracy\" is included:
4> interpret the presence of this IE to indicate that the UTRAN desires to
compute a 3-dimensional position estimate.
3> if the IE \"Positioning Methods\" is set to \"GPS\":
4> include the IE \"UE positioning GPS measured results\" in the measurement
report and set the contents of the IE as follows:
5> if the UE supports the capability to provide the GPS timing of the cell
frames measurement:
> 6> if the IE \"GPS timing of Cell wanted\" is set to TRUE:
>
> 7> perform the UE GPS timing of cell frames measurement on the serving cell
> or on one cell of the active set.
>
> 7> include the IE \"Primary CPICH Info\" for FDD or the IE \"cell parameters
> id\" for TDD; and
>
> 7> include the IE \"Reference SFN\" and the IE \"UE GPS timing of cell
> frames\".
>
> 6> if the IE \"GPS timing of Cell wanted\" is set to FALSE:
>
> 7> include the IE \"GPS TOW msec\".
5> if the UE does not support the capability to provide the GPS timing of the
cell:
> 6> include the IE \"GPS TOW msec\".
##### References {#references-3 .H6}
\- Conformance requirement 1: TS 24.008 clause 4.5.1.5.
\- Conformance requirement 2: TS 24.008, clause 5.2.1.
\- Conformance requirement 3: TS 25.331, clause 8.4.1.3.
\- Conformance requirement 4: TS 25.331, clause 8.6.7.19.1a.
##### 6.1.1.3.3 Test Purpose {#test-purpose-2 .H6}
To verify when an emergency call is initiated by a UE with a USIM, and the
network performs a location request using the RRC measurement control
procedure by sending Measurement Control message , then the UE respond with a
Measurement Report containing \"UE positioning GPS measured results\".
##### 6.1.1.3.4 Method of Test {#method-of-test-2 .H6}
Initial Conditions
System Simulator (SS):
1 cell, default parameters
_Satellite signals:_ As specified in 4.2
##### UE: {#ue .H6}
\- the UE is in state \"MM idle\" with valid TMSI and CKSN.
##### Related PICS/PIXIT Statements {#related-picspixit-statements-2 .H6}
\- Emergency speech call yes/no
\- UE Assisted Network Assisted GPS
##### Test Procedure {#test-procedure-2 .H6}
The UE is made to initiate an emergency call.
After the call has been through-connected in both directions, the SS orders an
A-GPS positioning measurement using a MEASUREMENT CONTROL message, including
assistance data as specified in subclause 4.3.3. The UE may request additional
assistance data by sending a MEASUREMENT REPORT message containing a
positioning error indication with the IE \"Error reason\" set to \"Assistance
Data Missing\". If the UE requests additional assistance data, the SS provides
the requested assistance data in one or more MEASUREMENT CONTROL messages.
The UE then performs positioning measurements and responds with the RRC
message MEASUREMENT REPORT.
Finally the SS clears the call.
##### Expected Sequence {#expected-sequence-2 .H6}
+------+-----------+----------------------+----------------------+---+ | Step | Direction | Message | Comments | | +------+-----------+----------------------+----------------------+---+ | | UE | SS | | | +------+-----------+----------------------+----------------------+---+ | 1 | UE | | The \"emergency | | | | | | number\" is entered. | | | | | | Number shall be one | | | | | | programmed in test | | | | | | USIM EF~ECC~ | | | | | | (Emergency Call | | | | | | Codes), ref. 34.108 | | | | | | clause 8.3.2.21. | | +------+-----------+----------------------+----------------------+---+ | 2 | --> | | UE establishes RRC | | | | | | procedure for | | | | | | emergency call. | | | | | | | | | | | | Establishment cause: | | | | | | Emergency Call\ | | | | | | SS checks that the | | | | | | UE capability | | | | | | includes A-GPS UE | | | | | | assisted positioning | | | | | | measurement | | +------+-----------+----------------------+----------------------+---+ | 3 | --> | CM SERVICE REQUEST | The CM service type | | | | | | IE indicates | | | | | | \"emergency call | | | | | | establishment\". | | +------+-----------+----------------------+----------------------+---+ | 4 | \ | AUTHENTICATION | SRES specifies | | | | | RESPONSE | correct value. | | +------+-----------+----------------------+----------------------+---+ | 6 | SS | | SS starts security | | | | | | procedure. | | +------+-----------+----------------------+----------------------+---+ | 7 | --> | EMERGENCY SETUP | If the Bearer | | | | | | capability IE is not | | | | | | included the default | | | | | | UMTS AMR speech | | | | | | version shall be | | | | | | assumed. | | +------+-----------+----------------------+----------------------+---+ | 8 | \ | CONNECT ACKNOWLEDGE | | | +------+-----------+----------------------+----------------------+---+ | 13 | UE | | The DTCH is through | | | | | | connected in both | | | | | | directions. | | +------+-----------+----------------------+----------------------+---+ | 14 | \ | MEASUREMENT REPORT | UE reports | | | | | | positioning | | | | | | measurement results | | | | | | (Option 1) or | | | | | | requests additional | | | | | | assistance data | | | | | | (Option 2). | | +------+-----------+----------------------+----------------------+---+ | 15a | \ | MEASUREMENT REPORT | If UE requested | | | | | | additional | | | | | | assistance data in | | | | | | step 15, this | | | | | | message contains the | | | | | | IE \"UE positioning | | | | | | GPS measured | | | | | | results\". | | +------+-----------+----------------------+----------------------+---+ | 16 | \ 1) A MM connection for an emergency call may be established in all states of
> the mobility management sublayer which allow MM connection establishment for
> a normal originating call.
>
> When a user requests an emergency call establishment the UE will send a CM
> SERVICE REQUEST message to the network with a CM service type information
> element indicating emergency call establishment.
>
> Normally, the UE will be identified by an IMSI or a TMSI. However, if none
> of these identifiers is available in the UE, then the UE shall use the IMEI
> for identification purposes.
>
> 2) As a serving network option, emergency calls may be established without
> the network having to apply the security mode procedure as defined in TS
> 24.008.
>
> The following are the only cases where the \"security procedure not
> applied\" option may be used:
>
> a) Authentication is impossible because the USIM is absent.
>
> 3) Having entered the \"MM connection pending\" state, upon MM connection
> establishment, the call control entity of the UE sends a setup message to
> its peer entity. This setup message is
>
> \- a SETUP message, if the call to be established is a basic call; and
>
> \- an EMERGENCY SETUP message, if the call to be established is an emergency
> call.
>
> 4) if the IE \"Measurement command\" has the value \"setup\":
>
> 2> store this measurement in the variable MEASUREMENT_IDENTITY according to
> the IE \"measurement identity\", first releasing any previously stored
> measurement with that identity if that exists;
...
> 2> for any other measurement type:
>
> 3> if the measurement is valid in the current RRC state of the UE:
>
> 4> begin measurements according to the stored control information for this
> measurement identity.
5) The UE shall:
> 1> when a measurement report is triggered:
>
> 2> if the UE was able to perform measurements on at least one neighbour cell
> included in the variable UE_POSITIONING_OTDOA_DATA_UE_ASSISTED in case of
> OTDOA or one satellite included in the variable UE_POSITIONING_GPS_DATA in
> case of GPS positioning or one cell from the active set in case of CELL ID:
>
> 3> if the IE \"Vertical Accuracy\" is included:
>
> 4> interpret the presence of this IE to indicate that the UTRAN desires to
> compute a 3-dimensional position estimate.
>
> 3> if the IE \"Positioning Methods\" is set to \"GPS\":
>
> 4> include the IE \"UE positioning GPS measured results\" in the measurement
> report and set the contents of the IE as follows:
>
> 5> if the UE supports the capability to provide the GPS timing of the cell
> frames measurement:
>
> 6> if the IE \"GPS timing of Cell wanted\" is set to TRUE:
>
> 7> perform the UE GPS timing of cell frames measurement on the serving cell
> or on one cell of the active set.
>
> 7> include the IE \"Primary CPICH Info\" for FDD or the IE \"cell parameters
> id\" for TDD; and
>
> 7> include the IE \"Reference SFN\" and the IE \"UE GPS timing of cell
> frames\".
>
> 6> if the IE \"GPS timing of Cell wanted\" is set to FALSE:
>
> 7> include the IE \"GPS TOW msec\".
>
> 5> if the UE does not support the capability to provide the GPS timing of
> the cell:
>
> 6> include the IE \"GPS TOW msec\".
##### References {#references-4 .H6}
> \- Conformance requirement 1: TS 24.008 clause 4.5.1.5, TS 22.101 clause 8.
>
> \- Conformance requirement 2: TS 33.102, clause 6.4.9.2.
>
> \- Conformance requirement 3: TS 24.008, clause 5.2.1.
>
> \- Conformance requirement 4: TS 25.331, clause 8.4.1.3.
>
> \- Conformance requirement 5: TS 25.331, clause 8.6.7.19.1a.
##### 6.1.1.4.3 Test Purpose {#test-purpose-3 .H6}
To verify that when an emergency call is initiated by a UE with no USIM, and
the network performs a network-induced location request using UE-assisted
A-GPS, the UE responds with a Measurement Report containing the IE \"UE
positioning GPS measured results\".
##### 6.1.1.4.4 Method of Test {#method-of-test-3 .H6}
Initial Conditions
> \- System Simulator:
>
> \- 1 cell, default parameters.
>
> \- Satellite signals: As specified in 4.2
>
> \- User Equipment:
>
> \- the UE is in state \"MM idle\" with no IMSI and no USIM inserted.
##### Related PICS/PIXIT Statements {#related-picspixit-statements-3 .H6}
> \- Emergency speech call yes/no
>
> \- UE Assisted Network Assisted GPS
##### Test procedure {#test-procedure-3 .H6}
The UE is made to initiate an emergency call. The call is established without
authentication and security.
After the call has been through-connected in both directions, the SS orders an
A-GPS positioning measurement using a MEASUREMENT CONTROL message, including
assistance data as specified in subclause 4.3.3. The UE may request additional
assistance data by sending a MEASUREMENT REPORT message containing a
positioning error indication with the IE \"Error reason\" set to \"Assistance
Data Missing\". If the UE requests additional assistance data, the SS provides
the requested assistance data in one or more MEASUREMENT CONTROL messages.
The UE sends a MEASUREMENT REPORT message including the IE \"UE positioning
GPS measured results\".
Finally the SS clears the call.
##### Expected Sequence {#expected-sequence-3 .H6}
+------+-----------+---------------------+----------------------+---+ | Step | Direction | Message | Comments | | +------+-----------+---------------------+----------------------+---+ | | UE | SS | | | +------+-----------+---------------------+----------------------+---+ | 1 | UE | | The \"emergency | | | | | | number\" is entered. | | | | | | One of the following | | | | | | emergency numbers | | | | | | shall be used: 000, | | | | | | 08, 112, 110, 118, | | | | | | 119, 911 or 999. | | +------+-----------+---------------------+----------------------+---+ | 2 | --> | | UE establishes RRC | | | | | | procedure for | | | | | | emergency call. | | | | | | Establishment cause: | | | | | | Emergency Call | | | | | | | | | | | | SS checks that the | | | | | | UE capability | | | | | | includes A-GPS | | | | | | UE-assisted | | | | | | positioning | | | | | | measurement. | | +------+-----------+---------------------+----------------------+---+ | 3 | --> | CM SERVICE REQUEST | The CM service type | | | | | | IE indicates | | | | | | \"emergency call | | | | | | establishment\". The | | | | | | mobile identity IE | | | | | | specifies the IMEI | | | | | | of the UE. The | | | | | | cipher key sequence | | | | | | number IE indicates | | | | | | \"no key is | | | | | | available\". | | +------+-----------+---------------------+----------------------+---+ | 4 | \ | EMERGENCY SETUP | If the Bearer | | | | | | capability IE is not | | | | | | included the default | | | | | | UMTS AMR speech | | | | | | version shall be | | | | | | assumed. | | +------+-----------+---------------------+----------------------+---+ | 6 | \ | CONNECT ACKNOWLEDGE | | | +------+-----------+---------------------+----------------------+---+ | 11 | UE | | The DTCH is through | | | | | | connected in both | | | | | | directions. | | +------+-----------+---------------------+----------------------+---+ | 12 | \ | MEASUREMENT REPORT | UE reports the IE | | | | | | \"UE positioning GPS | | | | | | measured results\" | | | | | | (Option 1) or | | | | | | requests additional | | | | | | assistance data | | | | | | (Option 2). | | +------+-----------+---------------------+----------------------+---+ | 13a | \ | MEASUREMENT REPORT | If UE requested | | | | | | additional | | | | | | assistance data in | | | | | | step 13, this | | | | | | message contains the | | | | | | IE \"UE positioning | | | | | | GPS measured | | | | | | results\". | | +------+-----------+---------------------+----------------------+---+ | 14 | \ 1) The MS invokes a MO-LR by sending a REGISTER message to the network
> containing a LCS-MOLR invoke component.
>
> 2) if the IE \"Measurement command\" has the value \"modify\":
>
> 2> for all IEs present in the MEASUREMENT CONTROL message:
>
> 3> if a measurement was stored in the variable MEASUREMENT_IDENTITY
> associated to the identity by the IE \"measurement identity\":
>
> 4> if measurement type is set to \"UE positioning measurement\" and the IE
> \"UE positioning GPS assistance data\" is present, for any of the optional
> IEs \"UE positioning GPS reference time\", \"UE positioning GPS reference UE
> position\", \"UE positioning GPS DGPS corrections\", \"UE positioning GPS
> ionospheric model\", \"UE positioning GPS UTC model\", \"UE positioning GPS
> acquisition assistance\", \"UE positioning GPS real-time integrity\" that
> are present in the MEASUREMENT CONTROL message:
>
> 5> replace all instances of the IEs listed above (and all their children)
> stored in variable MEASUREMENT_IDENTITY associated to the identity indicated
> by the IE \"measurement identity\" with the IEs received in the MEASUREMENT
> CONTROL message;
>
> 5> leave all other stored information elements unchanged in the variable
> MEASUREMENT_IDENTITY.
>
> 3) If the IE \"UE positioning GPS Navigation Model\" is included, for each
> satellite, the UE shall:
>
> 1> use IE \"Satellite Status\" to determine if an update of IE \"UE
> positioning GPS Ephemeris and Clock Correction parameters\" has been
> provided for the satellite indicated by the IE \"SatID\";
>
> 1> if an update has been provided for this satellite:
>
> 2> act as specified in subclause 8.6.7.19.3.4.
>
> If the IE \"UE positioning GPS Ephemeris and Clock Correction parameters\"
> is included, for each satellite, the UE shall:
>
> 1> update the variable UE_POSITIONING_GPS_DATA as follows:
>
> 2> store this IE at the position indicated by the IE \"Sat ID\" in the IE
> \"UE positioning GPS Navigation Model\" in the variable
> UE_POSITIONING_GPS_DATA, possibly overwriting any existing information in
> this position.
>
> 1> act on these GPS ephemeris and clock correction parameters in a manner
> similar to that specified in [12].
>
> 4) The UE shall when a measurement report is triggered:
>
> 2> if the UE has been able to calculate a position after performing
> measurements on the cells included in the variable
> UE_POSITIONING_OTDOA_DATA_UE_BASED in case of OTDOA or on the list of
> satellites included in the variable UE_POSITIONING_GPS_DATA in case of GPS
> positioning:
>
> 3> include IE \"UE positioning Position Estimate Info\" in the MEASUREMENT
> REPORT and set the contents of the IE as follows:
>
> 4> if the UE does not support the capability to perform the UE GPS timing of
> cell frames measurement; or
>
> 4> if the IE \"GPS timing of Cell wanted\" is set to FALSE:
>
> 5> include the IE \"GPS TOW msec\".
>
> 4> if IE \"Vertical Accuracy\" has been included in IE \"UE positioning
> reporting quantity\":
>
> 5> if the IE \"Vertical Accuracy\" has been assigned to a value unequal to
> \"0\":
>
> 6> if the UE has been able to calculate a 3-dimensional position:
>
> 7> include IE \"Ellipsoid point with altitude and uncertainty ellipsoid\" as
> the position estimate.
>
> 6> if the UE has not been able to calculate a 3-dimensional position:
>
> 7> act as if IE \"Vertical Accuracy\" has not been included in IE \"UE
> positioning reporting quantity\".
>
> 4> if IE \"Vertical Accuracy\" has not been included in IE \"UE positioning
> reporting quantity\":
>
> 5> if IE \"Horizontal Accuracy\" in IE \"UE positioning reporting quantity\"
> has been assigned to value \"0\":
>
> 6> may include IE \"Ellipsoid point\".
>
> 5> if IE \"Horizontal Accuracy\" in IE \"UE positioning reporting quantity\"
> has been assigned to a value unequal to 0:
>
> 6> include either IE \"Ellipsoid point with uncertainty circle\" or IE
> \"Ellipsoid point with uncertainty ellipse\" or IE \"Ellipsoid point with
> altitude and uncertainty ellipsoid\" as the position estimate.
>
> 5) The network shall pass the result of the location procedure to the MS by
> sending a FACILITY message to the MS containing a LCS-MOLR return result
> component.
>
> 6) After the last location request operation the MS shall terminate the
> dialogue by sending a RELEASE COMPLETE message.
##### Reference(s): {#references-5 .H6}
> \- Conformance requirements 1, 5 and 6: TS 24.030, subclause 5.1.1
>
> \- Conformance requirement 2: TS 25.331, subclause 8.4.1.3.
>
> \- Conformance requirement 3: TS 25.331, subclauses 8.6.7.19.3.3a,
> 8.6.7.19.3.4.
>
> \- Conformance requirement 4: TS 25.331, subclause 8.6.7.19.1b
>
> \- Reference [12] in these conformance requirements denotes document ICD-
> GPS-200: \"Navstar GPS Space Segment/Navigation User Interface\".
##### 6.1.2.1.3 Test Purpose {#test-purpose-4 .H6}
To verify the UE behaviour at a mobile originated location request procedure
using network-assisted UE-based GPS.
##### 6.1.2.1.4 Method of Test {#method-of-test-4 .H6}
##### Initial Conditions {#initial-conditions-2 .H6}
\- System Simulator:
\- 1 cell, default parameters.
\- Satellite signals: As specified in 4.2
\- User Equipment:
\- The UE is in state \"MM idle\" with valid TMSI and CKSN.
\- The UE is in state \"PMM idle\" with valid P-TMSI
##### Related PICS/PIXIT Statements {#related-picspixit-statements-4 .H6}
\- UE Based Network Assisted GPS
\- Method of triggering an MO-LR request for a position estimate.
##### Test Procedure {#test-procedure-4 .H6}
The UE invokes call independent supplementary service through a CM SERVICE
REQUEST. The SS initiates authentication and ciphering.
Then the UE invokes an MO-LR request of type \"locationEstimate\". The SS
orders an A-GPS positioning measurement using two MEASUREMENT CONTROL
messages, including assistance data. The UE then initiates periodic
measurement reporting. After the first received MEASUREMENT REPORT message,
the SS responds with a FACILITY message containing an MO-LR result. When UE
receives the FACILITY message, it clears the transaction by sending a RELEASE
COMPLETE message.
##### Expected Sequence {#expected-sequence-4 .H6}
* * *
Step Direction Message Comments  
UE SS  
1 -> The UE establishes an RRC connection for location service. The SS
verifies that the IE \"Establishment cause\" in the received RRC CONNECTION
REQUEST message is set to \"Originated High Priority Signalling\".  
2 -> CM SERVICE REQUEST The CM service type IE indicates \"call independent
supplementary service\"  
3 \ AUTHENTICATION RESPONSE  
5 SS The SS starts ciphering and integrity protection.  
6 -> REGISTER Call Independent SS containing Facility IE with an LCS MO-LR
request of type \"locationEstimate\".  
7 \ MEASUREMENT REPORT  
10 \ RELEASE COMPLETE The UE terminates the dialogue  
12 SS The SS releases the RRC connection and the test case ends.
* * *
##### Specific Message Contents {#specific-message-contents-4 .H6}
##### REGISTER (Step 6) {#register-step-6 .H6}
+------------------------+------------------------------------+ | Information element | Value/remark | +------------------------+------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +------------------------+------------------------------------+ | Transaction identifier | | +------------------------+------------------------------------+ | Message type | REGISTER (xx11 1011) | +------------------------+------------------------------------+ | Facility | Invoke = LCS-MOLR | | | | | SS version indicator | LCS-MOLRArg | | | | | | molr-Type ->locationEstimate | | | | | | Value 1 or above | +------------------------+------------------------------------+
##### MEASUREMENT CONTROL (Step 7): {#measurement-control-step-7 .H6}
* * *
Information element Value/remark **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Setup Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE based \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request FALSE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_  
\- No reporting  
\- UE pos OTDOA assistance data for UE-assisted Not present \- UE pos OTDOA
assistance data for UE-based Not present \- UE positioning GPS assistance data
Set as specified for the first MEASUREMENT CONTROL message for \"Adequate
assistance data for UE-based A-GPS\" in 4.3.1 **Physical Channel Information
Elements**  
DPCH compressed mode status info Not present
* * *
##### MEASUREMENT CONTROL (Step 8): {#measurement-control-step-8 .H6}
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Modify Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE based \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy Set according to 4.2 (unequal to 0) \- Vertical accuracy
Set according to 4.2 (unequal to 0) \- GPS timing of cell wanted FALSE \-
Multiple sets FALSE \- Additional assistance data request FALSE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_ Periodical reporting
criteria \- Amount of reporting 1 \- Reporting interval 64000 \- UE pos OTDOA
assistance data for UE-assisted Not present \- UE pos OTDOA assistance data
for UE-based Not present \- UE positioning GPS assistance data Set as
specified for the second MEASUREMENT CONTROL message for \"Adequate assistance
data for UE-based A-GPS\" in 4.3.1 **Physical Channel Information Elements**  
DPCH compressed mode status info Not present
* * *
##### MEASUREMENT REPORT (Step 9) {#measurement-report-step-9 .H6}
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_  
\- UE positioning measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info  
\- CHOICE _Reference time_  
\- GPS reference time only  
\- GPS TOW msec Not checked \- CHOICE _Position estimate_ One of 'Ellipsoid
point with uncertainty Circle' or 'Ellipsoid point with uncertainty Ellipse'
or 'Ellipsoid point with altitude and uncertainty Ellipsoid' \- UE positioning
GPS measured results Not present \- UE positioning error Not present Measured
Results on RACH Not present Additional Measured Results Not present Event
Results Not present
* * *
##### FACILITY (Step 10) {#facility-step-10 .H6}
+-------------------------+------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+------------------------------------+ | Transaction identifier | | +-------------------------+------------------------------------+ | Message type | FACILITY (0011 1010) | +-------------------------+------------------------------------+ | Facility | Return result = LCS-MOLR | | | | | | LCS-MOLRRes -> locationEstimate | +-------------------------+------------------------------------+
##### RELEASE COMPLETE (Step 11) {#release-complete-step-11 .H6}
* * *
**Information element** **Value/remark** Protocol Discriminator Call
Independent SS message (1011) Transaction identifier  
Message type RELEASE COMPLETE (xx10 1010)
* * *
##### 6.1.2.1.5 Test requirements {#test-requirements-4 .H6}
After step 5 the UE shall transmit a REGISTER message with an LCS MO-LR
request with the IE \"MOLR-Type\" set to \"locationEstimate\".
After step 8, the UE shall respond with a MEASUREMENT REPORT message.
After step 10, the UE shall send a RELEASE COMPLETE message.
#### 6.1.2.2 LCS Mobile originated location request/ UE-Based or UE-Assisted
GPS/ Assistance data request/ Success
##### 6.1.2.2.1 Definition {#definition-4 .H6}
This test case applies to all UEs supporting UE-Based or UE-Assisted GPS
Location Service capabilities and providing a method to trigger an MO-LR
request for assistance data.
##### 6.1.2.2.2 Conformance requirements {#conformance-requirements-5 .H6}
> 1) The MS invokes a MO-LR by sending a REGISTER message to the network
> containing a LCS-MOLR invoke component.
>
> 2) The network shall pass the result of the location procedure to the MS by
> sending a FACILITY message to the MS containing a LCS-MOLR return result
> component.
>
> 3) After the last location request operation the MS shall terminate the
> dialogue by sending a RELEASE COMPLETE message.
##### Reference(s): {#references-6 .H6}
> \- Conformance requirements 1, 2 and 3: TS 24.030, subclause 5.1.1
##### 6.1.2.2.3 Test Purpose {#test-purpose-5 .H6}
To verify the UE behaviour at a mobile originated location request procedure
using network-assisted network assisted GPS.
##### 6.1.2.2.4 Method of Test {#method-of-test-5 .H6}
##### Initial Conditions {#initial-conditions-3 .H6}
> \- System Simulator:
>
> \- 1 cell, default parameters.
>
> \- Satellite signals: As specified in 4.2
>
> \- User Equipment:
>
> \- The UE shall begin the test with no GPS assistance data stored.
>
> \- The UE is in state \"MM idle\" with valid TMSI and CKSN.
>
> \- The UE is in state \"PMM idle\" with valid P-TMSI
##### Related PICS/PIXIT Statements {#related-picspixit-statements-5 .H6}
\- UE Based Network Assisted GPS
\- UE Assisted Network Assisted GPS
\- Method of clearing stored GPS assistance data
\- Method of triggering an MO-LR request for assistance data.
##### Test Procedure {#test-procedure-5 .H6}
The stored GPS assistance data in the UE shall be cleared.
The UE invokes call independent supplementary service through a CM SERVICE
REQUEST. The SS initiates authentication and ciphering.
Then the UE invokes an MO-LR request of type \"assistanceData\".
The SS transmits an ASSISTANCE DATA delivery message with assistance data.
When the assistance data delivery was successful, the SS sends a FACILITY
message to the UE.
The UE clears the transaction by sending a RELEASE COMPLETE message.
##### Expected Sequence {#expected-sequence-5 .H6}
* * *
**Step** **Direction** **Message** **Comments**  
**UE** **SS**  
1 Void  
2 -> The UE establishes an RRC connection for location service. The SS
verifies that the IE \"Establishment cause\" in the received RRC CONNECTION
REQUEST message is set to \"Originated High Priority Signalling\".  
3 -> CM SERVICE REQUEST The CM service type IE indicates \"call independent
supplementary service\"  
4 \ AUTHENTICATION RESPONSE  
6 SS The SS starts ciphering and integrity protection.  
7 -> REGISTER Call Independent SS containing Facility IE with an LCS MO-LR
request of type \"assistanceData\".  
8 \ RELEASE COMPLETE The UE terminates the dialogue  
11 SS The SS releases the RRC connection and the test case ends
* * *
##### Specific Message Contents {#specific-message-contents-5 .H6}
##### REGISTER (Step 7) {#register-step-7 .H6}
+-------------------------+-------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+-------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+-------------------------------------------+ | Transaction identifier | | +-------------------------+-------------------------------------------+ | Message type | REGISTER (xx11 1011) | +-------------------------+-------------------------------------------+ | Facility | Invoke = LCS-MOLR | | | | | SS version indicator | LCS-MOLRArg | | | | | | molr-Type ->assistanceData | | | | | | locationMethod -> assistedGPS | | | | | | gpsAssistanceData -> OCTET STRING\ | | | Octets 1 to 38 are coded in the\ | | | same way as octets 3 to 7+2n of\ | | | Requested GPS Data IE in 3GPP\ | | | TS 49.031 (Contents are not verified, SS | | | will use octet 1 to identify the GPS | | | assistance data requested by the MS) | | | | | | Value 1 or above | +-------------------------+-------------------------------------------+
##### ASSISTANCE DATA DELIVERY (Step 8): {#assistance-data-delivery-step-8
.H6}
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
UE positioning OTDOA assistance data for UE-based Not present UE positioning
GPS assistance data Set as specified in 4.3.5.
* * *
##### FACILITY (Step 9) {#facility-step-9 .H6}
+-------------------------+------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+------------------------------------+ | Transaction identifier | | +-------------------------+------------------------------------+ | Message type | FACILITY (0011 1010) | +-------------------------+------------------------------------+ | Facility | Return result = LCS-MOLR | | | | | | LCS-MOLRRes -> EMPTY | +-------------------------+------------------------------------+
##### RELEASE COMPLETE (Step 10) {#release-complete-step-10 .H6}
* * *
**Information element** **Value/remark** Protocol Discriminator Call
Independent SS message (1011) Transaction identifier  
Message type RELEASE COMPLETE (0x10 1010)
* * *
##### 6.1.2.2.5 Test requirements {#test-requirements-5 .H6}
After step 5 the UE shall transmit a REGISTER message with an LCS MO-LR
request with the IE \"MOLR-Type\" set to \"assistanceData\".
After step 8, the UE shall send a RELEASE COMPLETE message.
#### 6.1.2.3 LCS Mobile originated location request/ UE-Assisted GPS/ Position
Estimate/ Success
##### 6.1.2.3.1 Definition {#definition-5 .H6}
This test case applies to all UEs supporting UE-Assisted GPS Location Service
capabilities and providing a method to trigger an MO-LR request for a position
estimate.
##### 6.1.2.3.2 Conformance requirements {#conformance-requirements-6 .H6}
> 1) The MS invokes a MO-LR by sending a REGISTER message to the network
> containing a LCS-MOLR invoke component.
>
> 2) if the IE \"Measurement command\" has the value \"setup\":
>
> 2> store this measurement in the variable MEASUREMENT_IDENTITY according to
> the IE \"measurement identity\", first releasing any previously stored
> measurement with that identity if that exists;
...
> 2> for any other measurement type:
>
> 3> if the measurement is valid in the current RRC state of the UE:
>
> 4> begin measurements according to the stored control information for this
> measurement identity.
>
> 3) The UE shall:
>
> 1> when a measurement report is triggered:
>
> 2> if the UE was able to perform measurements on at least one neighbour cell
> included in the variable UE_POSITIONING_OTDOA_DATA_UE_ASSISTED in case of
> OTDOA or one satellite included in the variable UE_POSITIONING_GPS_DATA in
> case of GPS positioning or one cell from the active set in case of CELL ID:
>
> 3> if the IE \"Vertical Accuracy\" is included:
>
> 4> interpret the presence of this IE to indicate that the UTRAN desires to
> compute a 3-dimensional position estimate.
>
> 3> if the IE \"Positioning Methods\" is set to \"GPS\":
>
> 4> include the IE \"UE positioning GPS measured results\" in the measurement
> report and set the contents of the IE as follows:
>
> 5> if the UE supports the capability to provide the GPS timing of the cell
> frames measurement:
>
> 6> if the IE \"GPS timing of Cell wanted\" is set to TRUE:
>
> 7> perform the UE GPS timing of cell frames measurement on the serving cell
> or on one cell of the active set.
>
> 7> include the IE \"Primary CPICH Info\" for FDD or the IE \"cell parameters
> id\" for TDD; and
>
> 7> include the IE \"Reference SFN\" and the IE \"UE GPS timing of cell
> frames\".
>
> 6> if the IE \"GPS timing of Cell wanted\" is set to FALSE:
>
> 7> include the IE \"GPS TOW msec\".
>
> 5> if the UE does not support the capability to provide the GPS timing of
> the cell:
>
> 6> include the IE \"GPS TOW msec\".
>
> 4) The network shall pass the result of the location procedure to the MS by
> sending a FACILITY message to the MS containing a LCS-MOLR return result
> component.
>
> 5) After the last location request operation the MS shall terminate the
> dialogue by sending a RELEASE COMPLETE message.
>
> References:
>
> \- Conformance requirements 1, 4 and 5: TS 24.030, subclause 5.1.1
>
> \- Conformance requirement 2: TS 25.331, subclause 8.4.1.3
>
> \- Conformance requirement 3: TS 25.331, subclause 8.6.7.19b
##### 6.1.2.3.3 Test Purpose {#test-purpose-6 .H6}
To verify the UE behaviour in the mobile-originated location request procedure
using network-assisted UE-assisted GPS to request a position estimate from the
network.
##### 6.1.2.3.4 Method of Test {#method-of-test-6 .H6}
##### Initial Conditions {#initial-conditions-4 .H6}
> \- System Simulator:
>
> \- 1 cell, default parameters.
>
> \- Satellite signals: As specified in 4.2
>
> \- User Equipment:
>
> \- The UE is in state \"MM idle\" with valid TMSI and CKSN.
>
> \- The UE is in state \"PMM idle\" with valid P-TMSI
##### Related PICS/PIXIT Statements {#related-picspixit-statements-6 .H6}
> \- UE Assisted Network Assisted GPS
>
> \- Method of triggering an MO-LR request for a position estimate.
##### Test Procedure {#test-procedure-6 .H6}
The UE invokes call independent supplementary service through a CM SERVICE
REQUEST. The SS initiates authentication and ciphering.
The UE invokes an MO-LR request through the Facility IE in a REGISTER message.
The MO-LR request is of type \"locationEstimate\".
The SS orders an A-GPS positioning measurement using a MEASUREMENT CONTROL
message, including assistance data as specified in subclause 4.3.3. The UE may
request additional assistance data by sending a MEASUREMENT REPORT message
containing a positioning error indication with the IE \"Error reason\" set to
\"Assistance Data Missing\". If the UE requests additional assistance data,
the SS provides the requested assistance data in one or more MEASUREMENT
CONTROL messages.
The UE then initiates periodic measurement reporting. After receiving the
MEASUREMENT REPORT message, the SS responds with a FACILITY message containing
an MO-LR result. When UE receives the FACILITY message, it clears the
transaction by sending a RELEASE COMPLETE message.
##### Expected Sequence {#expected-sequence-6 .H6}
* * *
**Step** **Direction** **Message** **Comments**  
**UE** **SS**  
1 -> The UE establishes an RRC connection for location service. The SS
verifies that the IE \"Establishment cause\" in the received RRC CONNECTION
REQUEST message is set to \"Originated High Priority Signalling\".  
2 -> CM SERVICE REQUEST The CM service type IE indicates \"call independent
supplementary service\"  
3 \ AUTHENTICATION RESPONSE  
5 SS The SS starts ciphering and integrity protection.  
6 -> REGISTER Call Independent SS containing Facility IE with an LCS MO-LR
request. The IE \"MOLR-Type\" is set to \"locationEstimate\".  
7 \ MEASUREMENT REPORT UE reports the IE \"UE positioning GPS measured
results\" (Option 1) or requests additional assistance data (Option 2).  
8a \ MEASUREMENT REPORT If UE requested additional assistance data in step 8,
this message contains the IE \"UE positioning GPS measured results\".  
9 \ RELEASE COMPLETE The UE terminates the dialogue  
11 SS The SS releases the RRC connection and the test case ends
* * *
##### Specific Message Contents {#specific-message-contents-6 .H6}
##### REGISTER (Step 6) {#register-step-6-1 .H6}
+-------------------------+------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+------------------------------------+ | Transaction identifier | | +-------------------------+------------------------------------+ | Message type | REGISTER (xx11 1011) | +-------------------------+------------------------------------+ | Facility | Invoke = LCS-MOLR | | | | | | LCS-MOLRArg | | | | | | molr-Type -> locationEstimate | | | | | | Value 1 or above | +-------------------------+------------------------------------+
##### MEASUREMENT CONTROL (Step 7): {#measurement-control-step-7-1 .H6}
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Setup Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE assisted \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request TRUE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_ Periodical reporting
criteria \- Amount of reporting 1 \- Reporting interval 64000 \- UE pos OTDOA
assistance data for UE-assisted Not present \- UE pos OTDOA assistance data
for UE-based Not present \- UE positioning GPS assistance data Set as
specified for \"Adequate assistance data for UE-assisted A-GPS\" in 4.3.3
**Physical Channel Information Elements**  
DPCH compressed mode status info Not present
* * *
##### MEASUREMENT REPORT (Step 8 (Option 1) or 8b (Option 2)) {#measurement-
report-step-8-option-1-or-8b-option-2 .H6}
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_  
\- UE positioning measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info Not present \- UE positioning GPS measured results
Present \- UE positioning error Not present Measured Results on RACH Not
present Additional Measured Results Not present Event Results Not present
* * *
##### MEASUREMENT REPORT (Step 8 (Option 2)): {#measurement-report-
step-8-option-2 .H6}
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_  
\- UE positioning measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info Not present \- UE positioning GPS measured results Not
present \- UE positioning error  
\- Error reason Assistance Data Missing \- GPS additional assistance data
request  
\- Almanac Not checked \- UTC model Not checked \- Ionospheric model Not
checked \- Navigation model Not checked \- DGPS corrections Not checked \-
Reference location Not checked \- Reference time Not checked \- Acquisition
assistance Not checked \- Real-time integrity Not checked \- Navigation model
additional data Not checked Measured Results on RACH Not present Additional
Measured Results Not present Event Results Not present
* * *
##### MEASUREMENT CONTROL (Step 8a (Option 2)): {#measurement-control-
step-8a-option-2 .H6}
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Modify Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE assisted \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy Set according to 4.2 (unequal to 0) \- Vertical accuracy
Set according to 4.2 (unequal to 0) \- GPS timing of cell wanted FALSE \-
Multiple sets FALSE \- Additional assistance data request FALSE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_ Periodical reporting
criteria \- Amount of reporting 1 \- Reporting interval 64000 \- UE pos OTDOA
assistance data for UE-assisted Not present \- UE pos OTDOA assistance data
for UE-based Not present \- UE positioning GPS assistance data Set as
specified in 4.3.5 **Physical Channel Information Elements**  
DPCH compressed mode status info Not present
* * *
##### FACILITY (Step 9) {#facility-step-9-1 .H6}
+-------------------------+-------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+-------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+-------------------------------------------+ | Transaction identifier | | +-------------------------+-------------------------------------------+ | Message type | FACILITY (0011 1010) | +-------------------------+-------------------------------------------+ | Facility | Return result = LCS-MOLR | | | | | | LCS-MOLRRes -> locationEstimate | | | | | | locationEstimate ->any values may be | | | used. The SS shall not be required to | | | calculate the value from the returned | | | gps-MeasureInfo values | +-------------------------+-------------------------------------------+
##### RELEASE COMPLETE (Step 10) {#release-complete-step-10-1 .H6}
* * *
**Information element** **Value/remark** Protocol Discriminator Call
Independent SS message (1011) Transaction identifier  
Message type RELEASE COMPLETE (xx10 1010)
* * *
##### 6.1.2.3.5 Test requirements {#test-requirements-6 .H6}
After step 5 the UE shall transmit a REGISTER message with an LCS MO-LR
request with the IE \"MOLR-Type\" set to \"locationEstimate\".
After step 7, the UE shall respond with a MEASUREMENT REPORT message
containing the IE \"UE positioning GPS measured results\".
After step 9, the UE shall send a RELEASE COMPLETE message.
#### 6.1.2.4 LCS Mobile originated location request/ UE-Based GPS/ Transfer to
third party/ Success
##### 6.1.2.4.1 Definition {#definition-6 .H6}
This test case applies to all UEs supporting UE-Based GPS Location Service
capabilities and providing a method to trigger an MO-LR request for transfer
to 3^rd^ party.
##### 6.1.2.4.2 Conformance requirements {#conformance-requirements-7 .H6}
> 1) The MS invokes a MO-LR by sending a REGISTER message to the network
> containing a LCS-MOLR invoke component.
>
> 2) If the UE is requesting that its location be sent to an external LCS
> client, the message shall include the identity of the LCS client and may
> include the address of the GMLC through which the LCS client should be
> accessed.
>
> 3) if the IE \"Measurement command\" has the value \"setup\":
>
> 2> store this measurement in the variable MEASUREMENT_IDENTITY according to
> the IE \"measurement identity\", first releasing any previously stored
> measurement with that identity if that exists;
...
> 2> for any other measurement type:
>
> 3> if the measurement is valid in the current RRC state of the UE:
>
> 4> begin measurements according to the stored control information for this
> measurement identity.
>
> 4) if the IE \"Measurement command\" has the value \"modify\":
>
> 2> for all IEs present in the MEASUREMENT CONTROL message:
>
> 3> if a measurement was stored in the variable MEASUREMENT_IDENTITY
> associated to the identity by the IE \"measurement identity\":
>
> 4> if measurement type is set to \"UE positioning measurement\" and the IE
> \"UE positioning GPS assistance data\" is present, for any of the optional
> IEs \"UE positioning GPS reference time\", \"UE positioning GPS reference UE
> position\", \"UE positioning GPS DGPS corrections\", \"UE positioning GPS
> ionospheric model\", \"UE positioning GPS UTC model\", \"UE positioning GPS
> acquisition assistance\", \"UE positioning GPS real-time integrity\" that
> are present in the MEASUREMENT CONTROL message:
>
> 5> replace all instances of the IEs listed above (and all their children)
> stored in variable MEASUREMENT_IDENTITY associated to the identity indicated
> by the IE \"measurement identity\" with the IEs received in the MEASUREMENT
> CONTROL message;
>
> 5> leave all other stored information elements unchanged in the variable
> MEASUREMENT_IDENTITY.
>
> 5) If the IE \"UE positioning GPS Navigation Model\" is included, for each
> satellite, the UE shall:
>
> 1> use IE \"Satellite Status\" to determine if an update of IE \"UE
> positioning GPS Ephemeris and Clock Correction parameters\" has been
> provided for the satellite indicated by the IE \"SatID\";
>
> 1> if an update has been provided for this satellite:
>
> 2> act as specified in subclause 8.6.7.19.3.4.
>
> If the IE \"UE positioning GPS Ephemeris and Clock Correction parameters\"
> is included, for each satellite, the UE shall:
>
> 1> update the variable UE_POSITIONING_GPS_DATA as follows:
>
> 2> store this IE at the position indicated by the IE \"Sat ID\" in the IE
> \"UE positioning GPS Navigation Model\" in the variable
> UE_POSITIONING_GPS_DATA, possibly overwriting any existing information in
> this position.
>
> 1> act on these GPS ephemeris and clock correction parameters in a manner
> similar to that specified in [12].
>
> 6) The UE shall when a measurement report is triggered:
>
> 2> if the UE has been able to calculate a position after performing
> measurements on the cells included in the variable
> UE_POSITIONING_OTDOA_DATA_UE_BASED in case of OTDOA or on the list of
> satellites included in the variable UE_POSITIONING_GPS_DATA in case of GPS
> positioning:
>
> 3> include IE \"UE positioning Position Estimate Info\" in the MEASUREMENT
> REPORT and set the contents of the IE as follows:
>
> 4> if the UE does not support the capability to perform the UE GPS timing of
> cell frames measurement; or
>
> 4> if the IE \"GPS timing of Cell wanted\" is set to FALSE:
>
> 5> include the IE \"GPS TOW msec\".
>
> 4> if IE \"Vertical Accuracy\" has been included in IE \"UE positioning
> reporting quantity\":
>
> 5> if the IE \"Vertical Accuracy\" has been assigned to a value unequal to
> \"0\":
>
> 6> if the UE has been able to calculate a 3-dimensional position:
>
> 7> include IE \"Ellipsoid point with altitude and uncertainty ellipsoid\" as
> the position estimate.
>
> 6> if the UE has not been able to calculate a 3-dimensional position:
>
> 7> act as if IE \"Vertical Accuracy\" has not been included in IE \"UE
> positioning reporting quantity\".
>
> 4> if IE \"Vertical Accuracy\" has not been included in IE \"UE positioning
> reporting quantity\":
>
> 5> if IE \"Horizontal Accuracy\" in IE \"UE positioning reporting quantity\"
> has been assigned to value \"0\":
>
> 6> may include IE \"Ellipsoid point\".
>
> 5> if IE \"Horizontal Accuracy\" in IE \"UE positioning reporting quantity\"
> has been assigned to a value unequal to 0:
>
> 6> include either IE \"Ellipsoid point with uncertainty circle\" or IE
> \"Ellipsoid point with uncertainty ellipse\" or IE \"Ellipsoid point with
> altitude and uncertainty ellipsoid\" as the position estimate.
>
> 7) The network shall pass the result of the location procedure to the MS by
> sending a FACILITY message to the MS containing a LCS-MOLR return result
> component.
>
> 8) After the last location request operation the MS shall terminate the
> dialogue by sending a RELEASE COMPLETE message.
>
> Reference(s):
>
> \- Conformance requirements 1, 7 and 8: TS 24.030, subclause 5.1.1
>
> \- Conformance requirement 3: TS 25.331, subclause 8.4.1.3
>
> \- Conformance requirement 2: TS 23.171, subclause 8.8.1
>
> \- Conformance requirement 4: TS 25.331, subclause 8.4.1.3
>
> \- Conformance requirement 5: TS 25.331, subclauses 8.6.7.19.3.3a,
> 8.6.7.19.3.4
>
> \- Conformance requirement 6: TS 25.331, subclause 8.6.7.19.1b
>
> \- Reference [12] in these conformance requirements denotes document ICD-
> GPS-200: \"Navstar GPS Space Segment/Navigation User Interface\".
##### 6.1.2.4.3 Test Purpose {#test-purpose-7 .H6}
To verify the UE behaviour in the mobile-originated location request procedure
using network-assisted UE-based GPS to request a position estimate from the
network for transfer to a third-party LCS client.
##### 6.1.2.4.4 Method of Test {#method-of-test-7 .H6}
Initial Conditions
> \- System Simulator:
>
> \- 1 cell, default parameters.
>
> \- Satellite signals: As specified in 4.2
>
> \- User Equipment:
>
> \- The UE is in state \"MM idle\" with valid TMSI and CKSN.
>
> \- The UE is in state \"PMM idle\" with valid P-TMSI
##### Related PICS/PIXIT Statements {#related-picspixit-statements-7 .H6}
> \- UE Based Network Assisted GPS
>
> \- Method of triggering an MO-LR request for transfer to 3^rd^ party
##### Test Procedure {#test-procedure-7 .H6}
The UE invokes call independent supplementary service through a CM SERVICE
REQUEST. The SS initiates authentication and ciphering.
The UE invokes a MO-LR request through the Facility IE in a REGISTER message.
The MO-LR request is of type \"locationEstimate\". The IE
\"LCSClientExternalID\" is set to the ID of a valid external LCS client.
The SS orders an A-GPS positioning measurement using MEASUREMENT CONTROL
messages, including assistance data.
The UE sends a MEASUREMENT REPORT message containing a location estimate.
The SS sends a FACILITY message confirming that the transfer to the external
client succeeded. When UE receives the FACILITY message, it clears the
transaction by sending a RELEASE COMPLETE message.
##### Expected Sequence {#expected-sequence-7 .H6}
**Step** **Direction** **Message** **Comments**
* * *
             **UE**          **SS**
1 -> The UE establishes an RRC connection for location service. The SS
verifies that the IE \"Establishment cause\" in the received RRC CONNECTION
REQUEST message is set to \"Originated High Priority Signalling\".  
2 -> CM SERVICE REQUEST The CM service type IE indicates \"call independent
supplementary service\"  
3 \ AUTHENTICATION RESPONSE  
5 SS The SS starts ciphering and integrity protection.  
6 -> REGISTER Call Independent SS containing Facility IE with an LCS MO-LR
request. The IE \"MOLR-Type\" is set to \"locationEstimate\". The IE
\"LCSClientExternalID\" is set to a valid ID for an external LCS client.  
7 \ MEASUREMENT REPORT  
10 \ RELEASE COMPLETE The UE terminates the dialogue
12 SS The SS releases the RRC connection and the test case ends
##### Specific Message Contents {#specific-message-contents-7 .H6}
##### REGISTER (Step 6) {#register-step-6-2 .H6}
+-------------------------+-----------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+-----------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+-----------------------------------------+ | Transaction identifier | | +-------------------------+-----------------------------------------+ | Message type | REGISTER (xx11 1011) | +-------------------------+-----------------------------------------+ | Facility | Invoke = LCS-MOLR | | | | | SS version indicator | LCS-MOLRArg | | | | | | molr-Type ->locationEstimate | | | | | | lcsClientExternalID -> externalAddress | | | | | | Value 1 or above | +-------------------------+-----------------------------------------+
##### MEASUREMENT CONTROL (Step 7): {#measurement-control-step-7-2 .H6}
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Setup Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE based \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request FALSE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_  
\- No reporting  
\- UE pos OTDOA assistance data for UE-assisted Not present \- UE pos OTDOA
assistance data for UE-based Not present \- UE positioning GPS assistance data
Set as specified for the first MEASUREMENT CONTROL message for \"Adequate
assistance data for UE-based A-GPS\" in 4.3.1 **Physical Channel Information
Elements**  
DPCH compressed mode status info Not present
* * *
##### MEASUREMENT CONTROL (Step 8): {#measurement-control-step-8-1 .H6}
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Modify Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE based \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request FALSE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_ Periodical reporting
criteria \- Amount of reporting 1 \- Reporting interval 64000 \- UE pos OTDOA
assistance data for UE-assisted Not present \- UE pos OTDOA assistance data
for UE-based Not present \- UE positioning GPS assistance data Set as
specified for the second MEASUREMENT CONTROL message for \"Adequate assistance
data for UE-based A-GPS\" in 4.3.1 **Physical Channel Information Elements**  
DPCH compressed mode status info Not present
* * *
##### MEASUREMENT REPORT (Step 9) {#measurement-report-step-9-1 .H6}
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_  
\- UE positioning measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info  
\- CHOICE _Reference time_  
\- GPS reference time only  
\- GPS TOW msec Not checked \- CHOICE _Position estimate_ One of 'Ellipsoid
point with uncertainty Circle' or 'Ellipsoid point with uncertainty Ellipse'
or 'Ellipsoid point with altitude and uncertainty Ellipsoid' \- UE positioning
GPS measured results Not present \- UE positioning error Not present Measured
Results on RACH Not present Additional Measured Results Not present Event
Results Not present
* * *
##### FACILITY (Step 10) {#facility-step-10-1 .H6}
+-------------------------+------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+------------------------------------+ | Transaction identifier | | +-------------------------+------------------------------------+ | Message type | FACILITY (0011 1010) | +-------------------------+------------------------------------+ | Facility | Return result = LCS-MOLR | | | | | | LCS-MOLRRes -> locationEstimate | +-------------------------+------------------------------------+
##### RELEASE COMPLETE (Step 11) {#release-complete-step-11-1 .H6}
* * *
**Information element** **Value/remark** Protocol Discriminator Call
Independent SS message (1011) Transaction identifier  
Message type RELEASE COMPLETE (xx10 1010)
* * *
##### 6.1.2.4.5 Test requirements {#test-requirements-7 .H6}
After step 5 the UE shall transmit a REGISTER message with an LCS MO-LR
request with the IE \"MOLR-Type\" set to \"locationEstimate\" and the IE
\"LCSClientExternalID\" set to the ID of a valid external LCS client.
After step 8, the UE shall respond with a MEASUREMENT REPORT message
containing the IE \"Position Estimate\".
After step 11, the UE shall send a RELEASE COMPLETE message.
#### 6.1.2.5 LCS Mobile originated location request/ UE-Assisted GPS/ Transfer
to third party/ Success
##### 6.1.2.5.1 Definition {#definition-7 .H6}
This test case applies to all UEs supporting UE-Assisted GPS Location Service
capabilities and providing a method to trigger an MO-LR request for transfer
to 3^rd^ party.
##### 6.1.2.5.2 Conformance requirements {#conformance-requirements-8 .H6}
> 1) The MS invokes a MO-LR by sending a REGISTER message to the network
> containing a LCS-MOLR invoke component.
>
> 2) If the UE is requesting that its location be sent to an external LCS
> client, the message shall include the identity of the LCS client and may
> include the address of the GMLC through which the LCS client should be
> accessed.
>
> 3) if the IE \"Measurement command\" has the value \"setup\":
>
> 2> store this measurement in the variable MEASUREMENT_IDENTITY according to
> the IE \"measurement identity\", first releasing any previously stored
> measurement with that identity if that exists;
...
> 2> for any other measurement type:
>
> 3> if the measurement is valid in the current RRC state of the UE:
>
> 4> begin measurements according to the stored control information for this
> measurement identity.
>
> 4) The UE shall:
>
> 1> when a measurement report is triggered:
>
> 2> if the UE was able to perform measurements on at least one neighbour cell
> included in the variable UE_POSITIONING_OTDOA_DATA_UE_ASSISTED in case of
> OTDOA or one satellite included in the variable UE_POSITIONING_GPS_DATA in
> case of GPS positioning or one cell from the active set in case of CELL ID:
>
> 3> if the IE \"Vertical Accuracy\" is included:
>
> 4> interpret the presence of this IE to indicate that the UTRAN desires to
> compute a 3-dimensional position estimate.
>
> 3> if the IE \"Positioning Methods\" is set to \"GPS\":
>
> 4> include the IE \"UE positioning GPS measured results\" in the measurement
> report and set the contents of the IE as follows:
>
> 5> if the UE supports the capability to provide the GPS timing of the cell
> frames measurement:
>
> 6> if the IE \"GPS timing of Cell wanted\" is set to TRUE:
>
> 7> perform the UE GPS timing of cell frames measurement on the serving cell
> or on one cell of the active set.
>
> 7> include the IE \"Primary CPICH Info\" for FDD or the IE \"cell parameters
> id\" for TDD; and
>
> 7> include the IE \"Reference SFN\" and the IE \"UE GPS timing of cell
> frames\".
>
> 6> if the IE \"GPS timing of Cell wanted\" is set to FALSE:
>
> 7> include the IE \"GPS TOW msec\".
>
> 5> if the UE does not support the capability to provide the GPS timing of
> the cell:
>
> 6> include the IE \"GPS TOW msec\".
>
> 5) The network shall pass the result of the location procedure to the MS by
> sending a FACILITY message to the MS containing a LCS-MOLR return result
> component.
>
> 6) After the last location request operation the MS shall terminate the
> dialogue by sending a RELEASE COMPLETE message.
##### Reference(s): {#references-7 .H6}
> \- Conformance requirements 1, 5 and 6: TS 24.030, subclause 5.1.1
>
> \- Conformance requirement 2: TS 23.171, subclause 8.8.1
>
> \- Conformance requirement 3: TS 25.331, subclause 8.4.1.3
>
> \- Conformance requirement 4: TS 25.331, subclauses 8.6.7.19.3.3b
##### 6.1.2.5.3 Test Purpose {#test-purpose-8 .H6}
To verify the UE behaviour in the mobile-originated location request procedure
using network-assisted UE-assisted GPS to request a position estimate from the
network for transfer to a third-party LCS client.
##### 6.1.2.5.4 Method of Test {#method-of-test-8 .H6}
##### Initial Conditions {#initial-conditions-5 .H6}
> \- System Simulator:
>
> \- 1 cell, default parameters.
>
> \- Satellite signals: As specified in 4.2.
>
> \- User Equipment:
>
> \- The UE is in state \"MM idle\" with valid TMSI and CKSN.
>
> \- The UE is in state \"PMM idle\" with valid P-TMSI.
##### Related PICS/PIXIT Statements {#related-picspixit-statements-8 .H6}
> \- UE Assisted Network Assisted GPS
>
> \- Method of triggering an MO-LR request for transfer to 3^rd^ party
##### Test Procedure {#test-procedure-8 .H6}
The UE invokes call independent supplementary service through a CM SERVICE
REQUEST. The SS initiates authentication and ciphering.
The UE invokes a MO-LR request through the Facility IE in a REGISTER message.
The MO-LR request is of type \"locationEstimate\". The IE
\"LCSClientExternalID\" is set to the ID of a valid external LCS client.
The SS orders an A-GPS positioning measurement using a MEASUREMENT CONTROL
message, including assistance data as specified in subclause 4.3.3. The UE may
request additional assistance data by sending a MEASUREMENT REPORT message
containing a positioning error indication with the IE \"Error reason\" set to
\"Assistance Data Missing\". If the UE requests additional assistance data,
the SS provides the requested assistance data in one or more MEASUREMENT
CONTROL messages.
The UE sends a MEASUREMENT REPORT message containing IE \"UE positioning GPS
measured results\".
The SS sends a FACILITY message confirming that the transfer to the external
client succeeded. When UE receives the FACILITY message, it clears the
transaction by sending a RELEASE COMPLETE message.
##### Expected Sequence {#expected-sequence-8 .H6}
**Step** **Direction** **Message** **Comments**
* * *
             **UE**          **SS**
1 -> The UE establishes an RRC connection for location service. The SS
verifies that the IE \"Establishment cause\" in the received RRC CONNECTION
REQUEST message is set to \"Originated High Priority Signalling\".  
2 -> CM SERVICE REQUEST The CM service type IE indicates \"call independent
supplementary service\"  
3 \ AUTHENTICATION RESPONSE  
5 SS The SS starts ciphering and integrity protection.  
6 -> REGISTER Call Independent SS containing Facility IE with an LCS MO-LR
request. The IE \"MOLR-Type\" is set to \"locationEstimate\". The IE
\"LCSClientExternalID\" is set to a valid ID for an external LCS client.  
7 \ MEASUREMENT REPORT UE reports positioning measurement results (Option 1)
or requests additional assistance data (Option 2).  
8a \ MEASUREMENT REPORT If UE requested additional assistance data in step 8,
this message contains the IE \"UE positioning GPS measured results\".  
9 \ RELEASE COMPLETE The UE terminates the dialogue  
11 SS The SS releases the RRC connection and the test case ends
##### Specific Message Contents {#specific-message-contents-8 .H6}
REGISTER (Step 6)
+-------------------------+-----------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+-----------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+-----------------------------------------+ | Transaction identifier | | +-------------------------+-----------------------------------------+ | Message type | REGISTER (xx11 1011) | +-------------------------+-----------------------------------------+ | Facility | Invoke = LCS-MOLR | | | | | SS version indicator | LCS-MOLRArg | | | | | | molr-Type ->locationEstimate | | | | | | lcsClientExternalID -> externalAddress | | | | | | Value 1 or above | +-------------------------+-----------------------------------------+
MEASUREMENT CONTROL (Step 7):
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Setup Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE assisted \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request TRUE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_ Periodical reporting
criteria \- Amount of reporting 1 \- Reporting interval 64000 \- UE pos OTDOA
assistance data for UE-assisted Not present \- UE pos OTDOA assistance data
for UE-based Not present \- UE positioning GPS assistance data Set as
specified for \"Adequate assistance data for UE-assisted A-GPS\" in 4.3.3
**Physical Channel Information Elements**  
DPCH compressed mode status info Not present
* * *
MEASUREMENT REPORT (Steps 8 (Option 1) or 8b (Option 2))
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_  
\- UE positioning measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info Not present \- UE positioning GPS measured results
Present \- UE positioning error Not present Measured Results on RACH Not
present Additional Measured Results Not present Event Results Not present
* * *
MEASUREMENT REPORT (Step 8 (Option 2)):
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_  
\- UE positioning measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info Not present \- UE positioning GPS measured results Not
present \- UE positioning error  
\- Error reason Assistance Data Missing \- GPS additional assistance data
request  
\- Almanac Not checked \- UTC model Not checked \- Ionospheric model Not
checked \- Navigation model Not checked \- DGPS corrections Not checked \-
Reference location Not checked \- Reference time Not checked \- Acquisition
assistance Not checked \- Real-time integrity Not checked \- Navigation model
additional data Not checked Measured Results on RACH Not present Additional
Measured Results Not present Event Results Not present
* * *
MEASUREMENT CONTROL (Step 8a (Option 2)):
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Modify Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE assisted \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request FALSE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_ Periodical reporting
criteria \- Amount of reporting 1 \- Reporting interval 64000 \- UE pos OTDOA
assistance data for UE-assisted Not present \- UE pos OTDOA assistance data
for UE-based Not present \- UE positioning GPS assistance data Set as
specified in 4.3.5 **Physical Channel Information Elements**  
DPCH compressed mode status info Not present
* * *
FACILITY (Step 9)
+-------------------------+-------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+-------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+-------------------------------------------+ | Transaction identifier | | +-------------------------+-------------------------------------------+ | Message type | FACILITY (0011 1010) | +-------------------------+-------------------------------------------+ | Facility | Return result = LCS-MOLR | | | | | | LCS-MOLRRes -> locationEstimate | | | | | | locationEstimate ->any values may be | | | used. The SS shall not be required to | | | calculate the value from the returned | | | gps-MeasureInfo values | +-------------------------+-------------------------------------------+
RELEASE COMPLETE (Step 10)
* * *
**Information element** **Value/remark** Protocol Discriminator Call
Independent SS message (1011) Transaction identifier  
Message type RELEASE COMPLETE (xx10 1010)
* * *
6.1.2.5.5 Test requirements
After step 5 the UE shall transmit a REGISTER message with an LCS MO-LR
request with the IE \"MOLR-Type\" set to \"locationEstimate\" and the IE
\"LCSClientExternalID\" set to the ID of a valid external LCS client.
After step 7, the UE shall respond with a MEASUREMENT REPORT message
containing the IE \"UE positioning GPS measured results\".
After step 9, the UE shall send a RELEASE COMPLETE message.
#### 6.1.2.6 LCS Mobile originated location request/ UE-Based or UE-Assisted
GPS/ Assistance data request/ Failure
6.1.2.6.1 Definition
This test case applies to all UEs supporting UE-based or UE-assisted GPS
Location Service capabilities and providing a method to trigger an MO-LR
request for assistance data.
6.1.2.6.2 Conformance requirements
> 1) The MS invokes a MO-LR by sending a REGISTER message to the network
> containing a LCS-MOLR invoke component.
>
> 2) If the network is unable to successfully fulfil the request received from
> the MS (e.g. to provide a location estimate or location assistance
> information), it shall clear the transaction by sending a RELEASE COMPLETE
> message containing a return error component. Error values are specified in
> 3GPP TS 24.080.
>
> 3) PositionMethodFailure: This error is returned by the network when the
> network is unable to obtain any of the location information requested or
> none of the information obtained satisfies the requested LCS QoS or if
> requested LCS assistance data could not be transferred or requested
> deciphering keys for broadcast assistance data could not be returned.
Reference(s):
> \- Conformance requirements 1 and 2: TS 24.030, subclause 5.1.1
>
> \- Conformance requirement 3: TS 24.080, subclause 4.3.2.29
6.1.2.6.3 Test Purpose
To verify the UE behaviour at a mobile originated location request for GPS
assistance data where the network is unable to provide the requested GPS
assistance data.
6.1.2.6.4 Method of Test
Initial Conditions
> \- System Simulator:
>
> \- 1 cell, default parameters.
>
> \- Satellite signals switched off or not present
>
> \- User Equipment:
>
> The UE shall begin the test with no GPS assistance data stored.
>
> \- The UE is in state \"MM idle\" with valid TMSI and CKSN.
>
> \- The UE is in state \"PMM idle\" with valid P-TMSI
##### Related PICS/PIXIT Statements {#related-picspixit-statements-9 .H6}
> \- UE Based Network Assisted GPS, or UE Assisted Network Assisted GPS
>
> \- Method of triggering an MO-LR request for assistance data.
>
> \- Method of clearing stored GPS assistance data.
##### Test Procedure {#test-procedure-9 .H6}
The stored GPS assistance data in the UE shall be cleared.
The UE invokes call independent supplementary service through a CM SERVICE
REQUEST. The SS initiates authentication and ciphering.
The UE invokes an MO-LR request of type \"assistanceData\".
The SS is unable to provide the requested assistance data.
The SS sends a RELEASE COMPLETE message containing a return error component.
##### Expected Sequence {#expected-sequence-9 .H6}
* * *
**Step** **Direction** **Message** **Comments**  
**UE** **SS**  
1 Void  
2 -> The UE establishes an RRC connection for location service. The SS
verifies that the IE \"Establishment cause\" in the received RRC CONNECTION
REQUEST message is set to \"Originated High Priority Signalling\".  
3 -> CM SERVICE REQUEST The CM service type IE indicates \"call independent
supplementary service\"  
4 \ AUTHENTICATION RESPONSE  
6 SS The SS starts ciphering and integrity protection.  
7 -> REGISTER Call Independent SS containing Facility IE with an LCS MO-LR
request of type \"assistanceData\".  
8 SS SS is unable to provide the requested assistance data  
9 \assistanceData | | | | | | locationMethod -> assistedGPS | | | | | | gpsAssistanceData -> OCTET STRING\ | | | Octets 1 to 38 are coded in the\ | | | same way as octets 3 to 7+2n of\ | | | Requested GPS Data IE in 3GPP\ | | | TS 49.031 (Content is not verified) | | | | | | Value 1 or above | +-------------------------+-------------------------------------+
##### RELEASE COMPLETE (Step 9) {#release-complete-step-9 .H6}
+-------------------------+------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+------------------------------------+ | Transaction identifier | | +-------------------------+------------------------------------+ | Message type | RELEASE COMPLETE (0010 1010) | | | | | Facility | Return error = LCS-MOLR | | | | | | Error -> positionMethodFailure | +-------------------------+------------------------------------+
##### 6.1.2.6.5 Test requirements {#test-requirements-8 .H6}
After step 6 the UE shall transmit a REGISTER message with an LCS MO-LR
request with the IE \"MOLR-Type\" set to \"assistanceData\".
During step 10 the UE shall not send any RELEASE COMPLETE message.
#### 6.1.2.7 LCS Mobile originated location request/ UE-Based GPS/ Position
estimate request/ Failure
##### 6.1.2.7.1 Definition {#definition-8 .H6}
This test case applies to all UEs supporting UE-Based GPS Location Service
capabilities and providing a method to trigger an MO-LR request for a position
estimate.
##### 6.1.2.7.2 Conformance requirements {#conformance-requirements-9 .H6}
> 1) The MS invokes a MO-LR by sending a REGISTER message to the network
> containing a LCS-MOLR invoke component. SS Version Indicator value 1 or
> above shall be used.
>
> 2) if the IE \"Measurement command\" has the value \"modify\":
>
> 2> for all IEs present in the MEASUREMENT CONTROL message:
>
> 3> if a measurement was stored in the variable MEASUREMENT_IDENTITY
> associated to the identity by the IE \"measurement identity\":
>
> 4> if measurement type is set to \"UE positioning measurement\" and the IE
> \"UE positioning GPS assistance data\" is present, for any of the optional
> IEs \"UE positioning GPS reference time\", \"UE positioning GPS reference UE
> position\", \"UE positioning GPS DGPS corrections\", \"UE positioning GPS
> ionospheric model\", \"UE positioning GPS UTC model\", \"UE positioning GPS
> acquisition assistance\", \"UE positioning GPS real-time integrity\" that
> are present in the MEASUREMENT CONTROL message:
>
> 5> replace all instances of the IEs listed above (and all their children)
> stored in variable MEASUREMENT_IDENTITY associated to the identity indicated
> by the IE \"measurement identity\" with the IEs received in the MEASUREMENT
> CONTROL message;
>
> 5> leave all other stored information elements unchanged in the variable
> MEASUREMENT_IDENTITY.
>
> 3) If the IE \"UE positioning GPS Navigation Model\" is included, for each
> satellite, the UE shall:
>
> 1> use IE \"Satellite Status\" to determine if an update of IE \"UE
> positioning GPS Ephemeris and Clock Correction parameters\" has been
> provided for the satellite indicated by the IE \"SatID\";
>
> 1> if an update has been provided for this satellite:
>
> 2> act as specified in subclause 8.6.7.19.3.4.
>
> If the IE \"UE positioning GPS Ephemeris and Clock Correction parameters\"
> is included, for each satellite, the UE shall:
>
> 1> update the variable UE_POSITIONING_GPS_DATA as follows:
>
> 2> store this IE at the position indicated by the IE \"Sat ID\" in the IE
> \"UE positioning GPS Navigation Model\" in the variable
> UE_POSITIONING_GPS_DATA, possibly overwriting any existing information in
> this position.
>
> 1> act on these GPS ephemeris and clock correction parameters in a manner
> similar to that specified in [12].
>
> 4) The UE shall when a measurement report is triggered:
>
> 2> if the UE has been able to calculate a position after performing
> measurements on the cells included in the variable
> UE_POSITIONING_OTDOA_DATA_UE_BASED in case of OTDOA or on the list of
> satellites included in the variable UE_POSITIONING_GPS_DATA in case of GPS
> positioning:
>
> 3> include IE \"UE positioning Position Estimate Info\" in the MEASUREMENT
> REPORT and set the contents of the IE as follows:
>
> 4> if the UE does not support the capability to perform the UE GPS timing of
> cell frames measurement; or
>
> 4> if the IE \"GPS timing of Cell wanted\" is set to FALSE:
>
> 5> include the IE \"GPS TOW msec\".
>
> 4> if IE \"Vertical Accuracy\" has been included in IE \"UE positioning
> reporting quantity\":
>
> 5> if the IE \"Vertical Accuracy\" has been assigned to a value unequal to
> \"0\":
>
> 6> if the UE has been able to calculate a 3-dimensional position:
>
> 7> include IE \"Ellipsoid point with altitude and uncertainty ellipsoid\" as
> the position estimate.
>
> 6> if the UE has not been able to calculate a 3-dimensional position:
>
> 7> act as if IE \"Vertical Accuracy\" has not been included in IE \"UE
> positioning reporting quantity\".
>
> 4> if IE \"Vertical Accuracy\" has not been included in IE \"UE positioning
> reporting quantity\":
>
> 5> if IE \"Horizontal Accuracy\" in IE \"UE positioning reporting quantity\"
> has been assigned to value \"0\":
>
> 6> may include IE \"Ellipsoid point\".
>
> 5> if IE \"Horizontal Accuracy\" in IE \"UE positioning reporting quantity\"
> has been assigned to a value unequal to 0:
>
> 6> include either IE \"Ellipsoid point with uncertainty circle\" or IE
> \"Ellipsoid point with uncertainty ellipse\" or IE \"Ellipsoid point with
> altitude and uncertainty ellipsoid\" as the position estimate.
5) The UE shall set the contents of the IE \"UE positioning Error\" as
follows:
...
> 1> if the IE \"Positioning Methods\" in IE \"UE positioning reporting
> quantity\" has been assigned to value \"GPS\":
>
> 2> if there were not enough GPS satellites to be received:
>
> 3> set IE \"Error reason\" to \"Not Enough GPS Satellites\".
>
> 2> if some GPS assistance data was missing:
>
> 3> set IE \"Error reason\" to \"Assistance Data Missing\"; and
>
> 3> if the IE \"\"Additional Assistance Data Request\" included in the IE
> \"UE positioning reporting quantity\" stored in the variable
> MEASUREMENT_IDENTITY is set to TRUE:
>
> 4> include the IE \"GPS Additional Assistance Data Request\".
>
> 6) If the network is unable to successfully fulfil the request received from
> the MS (e.g. to provide a location estimate or location assistance
> information), it shall clear the transaction by sending a RELEASE COMPLETE
> message containing a return error component. Error values are specified in
> 3GPP TS 24.080.
>
> 7) PositionMethodFailure: This error is returned by the network when the
> network is unable to obtain any of the location information requested or
> none of the information obtained satisfies the requested LCS QoS or if
> requested LCS assistance data could not be transferred or requested
> deciphering keys for broadcast assistance data could not be returned.
##### Reference(s): {#references-8 .H6}
> \- Conformance requirements 1 and 6: TS 24.030, subclause 5.1.1
>
> \- Conformance requirement 2: TS 25.331, subclause 8.4.1.3.
>
> \- Conformance requirement 3: TS 25.331, subclauses 8.6.7.19.3.3a,
> 8.6.7.19.3.4.
>
> \- Conformance requirement 4: TS 25.331, subclause 8.6.7.19.1b
>
> \- Conformance requirement 5: TS 25.331, subclause 8.6.7.19.5
>
> \- Conformance requirement 7: TS 24.080, subclause 4.3.2.29
>
> \- Reference [12] in these conformance requirements denotes document ICD-
> GPS-200: \"Navstar GPS Space Segment/Navigation User Interface\".
##### 6.1.2.7.3 Test Purpose {#test-purpose-9 .H6}
To verify the UE behaviour at a mobile originated location request procedure
using network-assisted UE-based GPS when the MO-LR procedure fails due to
failure of positioning method.
##### 6.1.2.7.4 Method of Test {#method-of-test-9 .H6}
##### Initial Conditions {#initial-conditions-6 .H6}
> \- System Simulator:
>
> \- 1 cell, default parameters.
>
> \- Satellite signal switched off or not present
>
> \- User Equipment:
>
> \- The UE is in state \"MM idle\" with valid TMSI and CKSN.
>
> \- The UE is in state \"PMM idle\" with valid P-TMSI
>
> \- The UE shall begin the test with no GPS assistance data stored.
##### Related PICS/PIXIT Statements {#related-picspixit-statements-10 .H6}
> \- UE Based Network Assisted GPS
>
> \- Method of triggering an MO-LR request for a position estimate.
>
> \- Method of clearing stored GPS assistance data
##### Test Procedure {#test-procedure-10 .H6}
The stored GPS assistance data in the UE shall be cleared.
The UE invokes call independent supplementary service through a CM SERVICE
REQUEST. The SS initiates authentication and ciphering.
Then the UE invokes an MO-LR request of type \"locationEstimate\". The SS
orders an A-GPS positioning measurement using two MEASUREMENT CONTROL
messages, including assistance data.
The UE sends a MEASUREMENT REPORT message reporting a positioning error for
not enough satellite signals received.
The SS sends a RELEASE COMPLETE message containing a return error component.
##### Expected Sequence {#expected-sequence-10 .H6}
Step Direction Message Comments
* * *
         UE          SS
1 -> The UE establishes an RRC connection for location service. The SS
verifies that the IE \"Establishment cause\" in the received RRC CONNECTION
REQUEST message is set to \"Originated High Priority Signalling\".  
2 -> CM SERVICE REQUEST The CM service type IE indicates \"call independent
supplementary service\"  
3 \ AUTHENTICATION RESPONSE  
5 SS The SS starts ciphering and integrity protection.  
6 -> REGISTER Call Independent SS containing Facility IE with a LCS MO-LR
request of type \"locationEstimate\".  
7 \ MEASUREMENT REPORT Positioning error report \"not enough GPS satellites\"  
10 SS SS is unable to fulfil the MO-LR request  
11 \locationEstimate | | | | | | Value 1 or above | +-------------------------+------------------------------------+
##### MEASUREMENT CONTROL (Step 7): {#measurement-control-step-7-3 .H6}
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Setup Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE based \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request FALSE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_  
\- No reporting  
\- UE pos OTDOA assistance data for UE-assisted Not present \- UE pos OTDOA
assistance data for UE-based Not present \- UE positioning GPS assistance data
Set as specified for the first MEASUREMENT CONTROL message for \"Adequate
assistance data for UE-based A-GPS\" in 4.3.1 **Physical Channel Information
Elements**  
DPCH compressed mode status info Not present
* * *
##### MEASUREMENT CONTROL (Step 8): {#measurement-control-step-8-2 .H6}
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Modify Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE based \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request FALSE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_ Periodical reporting
criteria \- Amount of reporting 1 \- Reporting interval 64000 \- UE pos OTDOA
assistance data for UE-assisted Not present \- UE pos OTDOA assistance data
for UE-based Not present \- UE positioning GPS assistance data Set as
specified for the second MEASUREMENT CONTROL message for \"Adequate assistance
data for UE-based A-GPS\" in 4.3.1 **Physical Channel Information Elements**  
DPCH compressed mode status info Not present
* * *
##### MEASUREMENT REPORT (Step 9): {#measurement-report-step-9-2 .H6}
+---------------------------------------------+-----------------------------+ | > **Information element** | > **Value/remark** | +---------------------------------------------+-----------------------------+ | > **Measurement Information Elements** | | +---------------------------------------------+-----------------------------+ | > Measurement Identity | > 10 | +---------------------------------------------+-----------------------------+ | > Measured Results | | +---------------------------------------------+-----------------------------+ | > \- CHOICE _Measurement_ | | +---------------------------------------------+-----------------------------+ | > \- UE positioning measured results | | +---------------------------------------------+-----------------------------+ | > \- UE positioning OTDOA measured results | > Not present | +---------------------------------------------+-----------------------------+ | > \- UE positioning position estimate info | > Not present | +---------------------------------------------+-----------------------------+ | > \- UE positioning GPS measured results | > Not present | +---------------------------------------------+-----------------------------+ | > \- UE positioning error | | +---------------------------------------------+-----------------------------+ | > \- Error reason | > Not Enough GPS Satellites | +---------------------------------------------+-----------------------------+ | > \- GPS additional assistance data request | | +---------------------------------------------+-----------------------------+ | > \- Almanac | > Not checked | +---------------------------------------------+-----------------------------+ | > \- UTC model | > Not checked | +---------------------------------------------+-----------------------------+ | > \- Ionospheric model | > Not checked | +---------------------------------------------+-----------------------------+ | > \- Navigation model | > Not checked | +---------------------------------------------+-----------------------------+ | > \- DGPS corrections | > Not checked | +---------------------------------------------+-----------------------------+ | > \- Reference location | > Not checked | +---------------------------------------------+-----------------------------+ | > \- Reference time | > Not checked | +---------------------------------------------+-----------------------------+ | > \- Acquisition assistance | > Not checked | +---------------------------------------------+-----------------------------+ | > \- Real-time integrity | > Not checked | +---------------------------------------------+-----------------------------+ | > \- Navigation model additional data | > Not checked | +---------------------------------------------+-----------------------------+ | > Measured Results on RACH | > Not present | +---------------------------------------------+-----------------------------+ | > Additional Measured Results | > Not present | +---------------------------------------------+-----------------------------+ | > Event Results | > Not present | +---------------------------------------------+-----------------------------+
##### RELEASE COMPLETE (Step 11) {#release-complete-step-11-2 .H6}
+-------------------------+------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+------------------------------------+ | Transaction identifier | | +-------------------------+------------------------------------+ | Message type | RELEASE COMPLETE (0010 1010) | | | | | Facility | Return error = LCS-MOLR | | | | | | Error -> positionMethodFailure | +-------------------------+------------------------------------+
##### 6.1.2.7.5 Test requirements {#test-requirements-9 .H6}
After step 5 the UE shall transmit a REGISTER message with a LCS MO-LR request
with the IE \"MOLR-Type\" set to \"locationEstimate\".
After step 8, the UE shall respond with a MEASUREMENT REPORT message
containing the IE \"UE positioning error\", with \"Error reason\" set to \"Not
Enough GPS Satellites\".
### 6.1.3 Assisted GPS Mobile Terminated Tests
#### 6.1.3.1 LCS Mobile terminated location request/ UE-Based GPS
##### 6.1.3.1.1 Definition {#definition-9 .H6}
This test case applies to all UEs supporting UE-Based GPS Location Service
capabilities.
##### 6.1.3.1.2 Conformance requirements {#conformance-requirements-10 .H6}
> 1) The network invokes a location notification procedure by sending a
> REGISTER message containing a LCS-LocationNotification invoke component to
> the UE. This may be sent either to request verification for MT-LR or to
> notify about already authorized MT-LR.
>
> In the case of location notification no response is required from the UE,
> the UE shall terminate the dialogue by sending a RELEASE COMPLETE message
> containing a LocationNotification return result.
>
> 2) if the IE \"Measurement command\" has the value \"modify\":
>
> 2> for all IEs present in the MEASUREMENT CONTROL message:
>
> 3> if a measurement was stored in the variable MEASUREMENT_IDENTITY
> associated to the identity by the IE \"measurement identity\":
>
> 4> if measurement type is set to \"UE positioning measurement\" and the IE
> \"UE positioning GPS assistance data\" is present, for any of the optional
> IEs \"UE positioning GPS reference time\", \"UE positioning GPS reference UE
> position\", \"UE positioning GPS DGPS corrections\", \"UE positioning GPS
> ionospheric model\", \"UE positioning GPS UTC model\", \"UE positioning GPS
> acquisition assistance\", \"UE positioning GPS real-time integrity\" that
> are present in the MEASUREMENT CONTROL message:
>
> 5> replace all instances of the IEs listed above (and all their children)
> stored in variable MEASUREMENT_IDENTITY associated to the identity indicated
> by the IE \"measurement identity\" with the IEs received in the MEASUREMENT
> CONTROL message;
>
> 5> leave all other stored information elements unchanged in the variable
> MEASUREMENT_IDENTITY.
>
> 3) If the IE \"UE positioning GPS Navigation Model\" is included, for each
> satellite, the UE shall:
>
> 1> use IE \"Satellite Status\" to determine if an update of IE \"UE
> positioning GPS Ephemeris and Clock Correction parameters\" has been
> provided for the satellite indicated by the IE \"SatID\";
>
> 1> if an update has been provided for this satellite:
>
> 2> act as specified in subclause 8.6.7.19.3.4 of TS 25.331.
>
> 4) If the IE \"UE positioning GPS Ephemeris and Clock Correction
> parameters\" is included, for each satellite, the UE shall:
>
> 1> update the variable UE_POSITIONING_GPS_DATA as follows:
>
> 2> store this IE at the position indicated by the IE \"Sat ID\" in the IE
> \"UE positioning GPS Navigation Model\" in the variable
> UE_POSITIONING_GPS_DATA, possibly overwriting any existing information in
> this position.
>
> 1> act on these GPS ephemeris and clock correction parameters in a manner
> similar to that specified in ICD-GPS-200.
>
> 5) If the IE \"UE positioning GPS reference time\" is included, the UE
> shall:
>
> 1> store the IE \"GPS Week\" in \"UE positioning GPS reference time\" in
> variable UE_POSITIONING_GPS_DATA and use it as the current GPS week;
>
> 1> store the IE \"GPS TOW msec\" in the IE \"UE positioning GPS reference
> time\" in variable UE_POSITIONING_GPS_DATA and use it as an estimate of the
> GPS Time-of-Week at the time of reception of the complete message containing
> the IE \"GPS TOW msec\";
>
> NOTE: The UE does not need to apply any compensation on the GPS Time-of-
> Week.
>
> 6) If the IE \"UE positioning GPS reference UE position\" is included, the
> UE shall:
>
> 1> store this IE in the IE \"UE positioning GPS reference UE position\" in
> variable UE_POSITIONING_GPS_DATA; and
>
> 1> use it as a priori knowledge of the approximate location of the UE.
>
> 7) The UE shall when a measurement report is triggered:
>
> 2> if the UE has been able to calculate a position after performing
> measurements on the cells included in the variable
> UE_POSITIONING_OTDOA_DATA_UE_BASED in case of OTDOA or on the list of
> satellites included in the variable UE_POSITIONING_GPS_DATA in case of GPS
> positioning:
>
> 3> include IE \"UE positioning Position Estimate Info\" in the MEASUREMENT
> REPORT and set the contents of the IE as follows:
>
> 4> if the UE does not support the capability to perform the UE GPS timing of
> cell frames measurement; or
>
> 4> if the IE \"GPS timing of Cell wanted\" is set to FALSE:
>
> 5> include the IE \"GPS TOW msec\".
>
> 4> if IE \"Vertical Accuracy\" has been included in IE \"UE positioning
> reporting quantity\":
>
> 5> if the IE \"Vertical Accuracy\" has been assigned to a value unequal to
> \"0\":
>
> 6> if the UE has been able to calculate a 3-dimensional position:
>
> 7> include IE \"Ellipsoid point with altitude and uncertainty ellipsoid\" as
> the position estimate.
>
> 6> if the UE has not been able to calculate a 3-dimensional position:
>
> 7> act as if IE \"Vertical Accuracy\" has not been included in IE \"UE
> positioning reporting quantity\".
>
> 4> if IE \"Vertical Accuracy\" has not been included in IE \"UE positioning
> reporting quantity\":
>
> 5> if IE \"Horizontal Accuracy\" in IE \"UE positioning reporting quantity\"
> has been assigned to value \"0\":
>
> 6> may include IE \"Ellipsoid point\".
>
> 5> if IE \"Horizontal Accuracy\" in IE \"UE positioning reporting quantity\"
> has been assigned to a value unequal to 0:
>
> 6> include either IE \"Ellipsoid point with uncertainty circle\" or IE
> \"Ellipsoid point with uncertainty ellipse\" or IE \"Ellipsoid point with
> altitude and uncertainty ellipsoid\" as the position estimate.
##### References {#references-9 .H6}
> \- Conformance requirement 1: TS 24.030, clause 4.1.1.
>
> \- Conformance requirement 2: TS 25.331, clause 8.4.1.3.
>
> \- Conformance requirement 3: TS 25.331, clause 8.6.7.19.3.3a.
>
> \- Conformance requirement 4: TS 25.331, clause 8.6.7.19.3.4.
>
> \- Conformance requirement 5: TS 25.331, clause 8.6.7.19.3.7.
>
> \- Conformance requirement 6: TS 25.331, clause 8.6.7.19.3.8.
>
> \- Conformance requirement 7: TS 25.331, clause 8.6.7.19.1b.
##### 6.1.3.1.3 Test Purpose {#test-purpose-10 .H6}
To verify that when the UE receives a REGISTER message during an established
CS call, containing a LCS Location Notification Invoke component set to
NotifyLocationAllowed, the UE displays information about the LCS client
correctly and sends a RELEASE COMPLETE message containing a
LocationNotification return result with verificationResponse set to
permissionGranted.
To verify that the UE responds with a Measurement Report message containing UE
location when the assistance data is divided between several Measurement
Control messages using Measurement Command \"Modify\".
##### 6.1.3.1.4 Method of Test {#method-of-test-10 .H6}
Initial Conditions
System Simulator (SS):
> \- 1 cell, default parameters
>
> _\- Satellite signals:_ As specified in 4.2
##### UE: {#ue-1 .H6}
\- State \"CS-CELL DCH Initial (State 6-1)\" as specified in clause 7.4.1 of
TS 34.108.
##### Related PICS/PIXIT Statements {#related-picspixit-statements-11 .H6}
> \- UE supporting CS domain services
>
> \- UE Based Network Assisted GPS
>
> \- UE supporting Mobile Terminated Location Request
##### Test Procedure {#test-procedure-11 .H6}
The SS initiates authentication and ciphering and sends an SS REGISTER message
containing a Facility IE containing a DTAP LCS Location Notification Invoke
message set to notifyLocationAllowed. The LCS Client Name contained in the
USSD text string of the lcs-LocationNotification shall be displayed. The UE
then responds with a RELEASE COMPLETE message containing a
LocationNotification return to terminate the dialogue.
The SS orders an A-GPS positioning measurement using two MEASUREMENT CONTROL
messages. The last MEASUREMENT CONTROL message orders periodical reporting.
The UE then initiates periodic measurement reporting and sends a MEASUREMENT
REPORT message including a location estimate.
##### Expected Sequence {#expected-sequence-11 .H6}
+----------+---------------+-----------------+-----------------+---+ | **Step** | **Direction** | **Message** | **Comments** | | +----------+---------------+-----------------+-----------------+---+ | | **UE** | **SS** | | | +----------+---------------+-----------------+-----------------+---+ | 1 | \ | AUTHENTICATION | | | | | | RESPONSE | | | +----------+---------------+-----------------+-----------------+---+ | 3 | SS | | SS starts | | | | | | security | | | | | | procedure | | +----------+---------------+-----------------+-----------------+---+ | 4 | \ | RELEASE | The UE | | | | | COMPLETE | terminates the | | | | | | dialogue | | +----------+---------------+-----------------+-----------------+---+ | 7 | \ | MEASUREMENT | | | | | | REPORT | | | +----------+---------------+-----------------+-----------------+---+ | 10 | SS | | SS releases the | | | | | | RRC connection | | | | | | and the test | | | | | | case ends | | +----------+---------------+-----------------+-----------------+---+
##### Specific Message Contents {#specific-message-contents-11 .H6}
##### REGISTER (Step 4) {#register-step-4 .H6}
+-------------------------+---------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+---------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+---------------------------------------------+ | Transaction identifier | | +-------------------------+---------------------------------------------+ | Message type | REGISTER (0011 1011) | +-------------------------+---------------------------------------------+ | Facility | Invoke = lcs-LocationNotification | | | | | | LocationNotificationArg | | | | | | notificationType -> notifyLocationAllowed, | | | | | | locationType -> current Location , | | | | | | lcsClientExternalID -> externalAddress | | | | | | lcsClientName ->dataCodingScheme | | | | | | nameString | +-------------------------+---------------------------------------------+
##### RELEASE COMPLETE (Step 6) {#release-complete-step-6 .H6}
+-------------------------+--------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+--------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+--------------------------------------------+ | Transaction identifier | | +-------------------------+--------------------------------------------+ | Message type | RELEASE COMPLETE (xx10 1010) | +-------------------------+--------------------------------------------+ | Facility | Return result = lcs-LocationNotification | | | | | | LocationNotificationRes | | | | | | verificationResponse -> permissionGranted | +-------------------------+--------------------------------------------+
##### MEASUREMENT CONTROL (Step 7): {#measurement-control-step-7-4 .H6}
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Setup Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE based \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request FALSE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_  
\- No reporting  
\- UE pos OTDOA assistance data for UE-assisted Not present \- UE pos OTDOA
assistance data for UE-based Not present \- UE positioning GPS assistance data
Set as specified for the first MEASUREMENT CONTROL message for \"Adequate
assistance data for UE-based A-GPS\" in 4.3.1 **Physical Channel Information
Elements**  
DPCH compressed mode status info Not present
* * *
##### MEASUREMENT CONTROL (Step 8): {#measurement-control-step-8-3 .H6}
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Modify Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE based \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request FALSE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_ Periodical reporting
criteria \- Amount of reporting 1 \- Reporting interval 64000 \- UE pos OTDOA
assistance data for UE-assisted Not present \- UE pos OTDOA assistance data
for UE-based Not present \- UE positioning GPS assistance data Set as
specified for the second MEASUREMENT CONTROL message for \"Adequate assistance
data for UE-based A-GPS\" in 4.3.1 **Physical Channel Information Elements**  
DPCH compressed mode status info Not present
* * *
##### MEASUREMENT REPORT (Step 9) {#measurement-report-step-9-3 .H6}
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_  
\- UE positioning measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info  
\- CHOICE _Reference time_  
\- GPS reference time only  
\- GPS TOW msec Not checked \- CHOICE _Position estimate_ One of 'Ellipsoid
point with uncertainty Circle' or 'Ellipsoid point with uncertainty Ellipse'
or 'Ellipsoid point with altitude and uncertainty Ellipsoid' \- UE positioning
GPS measured results Not present \- UE positioning error Not present Measured
Results on RACH Not present Additional Measured Results Not present Event
Results Not present
* * *
##### 6.1.3.1.5 Test requirements {#test-requirements-10 .H6}
After step 5 the UE shall send a RELEASE COMPLETE message.
After step 8 the UE shall respond with a MEASUREMENT REPORT message.
#### 6.1.3.2 LCS Mobile-terminated location request/UE-Based GPS/ Request for
additional assistance data/ Success
##### 6.1.3.2.1 Definition {#definition-10 .H6}
This test case applies to all UEs supporting UE-Based GPS Location Service
capabilities.
##### 6.1.3.2.2 Conformance requirements {#conformance-requirements-11 .H6}
1) if the IE \"Measurement command\" has the value \"modify\":
2> for all IEs present in the MEASUREMENT CONTROL message:
\- if a measurement was stored in the variable MEASUREMENT_IDENTITY associated
to the identity by the IE \"measurement identity\":
\- if measurement type is set to \"UE positioning measurement\" and the IE
\"UE positioning GPS assistance data\" is present, for any of the optional IEs
\"UE positioning GPS reference time\", \"UE positioning GPS reference UE
position\", \"UE positioning GPS DGPS corrections\", \"UE positioning GPS
ionospheric model\", \"UE positioning GPS UTC model\", \"UE positioning GPS
acquisition assistance\", \"UE positioning GPS real-time integrity\" that are
present in the MEASUREMENT CONTROL message:
5> replace all instances of the IEs listed above (and all their children)
stored in variable MEASUREMENT_IDENTITY associated to the identity indicated
by the IE \"measurement identity\" with the IEs received in the MEASUREMENT
CONTROL message;
5> leave all other stored information elements unchanged in the variable
MEASUREMENT_IDENTITY.
2) If the IE \"UE positioning GPS Navigation Model\" is included, for each
satellite, the UE shall:
1> use IE \"Satellite Status\" to determine if an update of IE \"UE
positioning GPS Ephemeris and Clock Correction parameters\" has been provided
for the satellite indicated by the IE \"SatID\";
1> if an update has been provided for this satellite:
2> act as specified in subclause 8.6.7.19.3.4.
3) If the IE \"UE positioning GPS Ephemeris and Clock Correction parameters\"
is included, for each satellite, the UE shall:
1> update the variable UE_POSITIONING_GPS_DATA as follows:
2> store this IE at the position indicated by the IE \"Sat ID\" in the IE \"UE
positioning GPS Navigation Model\" in the variable UE_POSITIONING_GPS_DATA,
possibly overwriting any existing information in this position.
1> act on these GPS ephemeris and clock correction parameters in a manner
similar to that specified in [12].
4) If the IE \"UE positioning GPS reference time\" is included, the UE shall:
1> store the IE \"GPS Week\" in \"UE positioning GPS reference time\" in
variable UE_POSITIONING_GPS_DATA and use it as the current GPS week;
\- store the IE \"GPS TOW msec\" in the IE \"UE positioning GPS reference
time\" in variable UE_POSITIONING_GPS_DATA and use it as an estimate of the
GPS Time-of-Week at the time of reception of the complete message containing
the IE \"GPS TOW msec\";
NOTE: The UE does not need to apply any compensation on the GPS Time-of-Week.
\- if the IE \"SFN\" and IE \"UTRAN GPS timing of cell frames\" are included:
if the UE is able to utilise the IEs:
\- store these IEs in the IE \"UE positioning GPS reference time\" in variable
UE_POSITIONING_GPS_DATA;
\- if the IE \"Primary CPICH Info\" for FDD or IE \"cell parameters id\" for
TDD is not included:
\- if the UE is not in CELL_DCH state:
> \- use IEs \"SFN\" and \"UTRAN GPS timing of cell frames\" to estimate the
> relationship between GPS time and air-interface timing of the NODE B
> transmission in the serving cell.
\- if the UE is in CELL_DCH state:
> \- ignore IEs \"SFN\" and \"UTRAN GPS timing of cell frames\".
\- if the IE \"Primary CPICH Info\" for FDD or IE \"cell parameters id\" for
TDD is also included:
\- store this IE in the IE \"UE positioning GPS reference time\" in variable
UE_POSITIONING_GPS_DATA;
\- use IEs \"SFN\" and \"UTRAN GPS timing of cell frames\" to estimate the
relationship between GPS time and air-interface timing of the NODE B
transmission in the cell indicated by \"Primary CPICH info\" or \"cell
parameters id\".
\- if the IE \"SFN-TOW Uncertainty\" is included:
\- store this IE in the IE \"UE positioning GPS reference time\" in variable
UE_POSITIONING_GPS_DATA and use it to determine if the relationship between
GPS time and air-interface timing of the NODE B transmission is known to
within at least 10ms.
\- if the IE \"T~UTRAN-GPS~ drift rate\" is included:
\- store this IE in the IE \"UE positioning GPS reference time\" in variable
UE_POSITIONING_GPS_DATA; and
\- may use it as an estimate of the drift rate of the NODE B clock relative to
GPS time.
\- if the IE \"GPS TOW Assist\" is included:
\- for each satellite:
3> delete all information currently stored in the IE \"GPS TOW Assist\" in the
IE \"UE positioning GPS reference time\" in the variable
UE_POSITIONING_GPS_DATA;
3> store the received GPS TOW Assist information in the IE \"UE positioning
GPS reference time\" in the variable UE_POSITIONING_GPS_DATA.
5) If the IE \"UE positioning GPS reference UE position\" is included, the UE
shall:
1> store this IE in the IE \"UE positioning GPS reference UE position\" in
variable UE_POSITIONING_GPS_DATA; and
1> use it as a priori knowledge of the approximate location of the UE.
6) If IE \"UE positioning GPS ionospheric model\" is included, the UE shall:
1> store this IE in the IE \"UE positioning GPS ionospheric model\" in
variable UE_POSITIONING_GPS_DATA;
1> act on these GPS ionospheric model parameters in a manner similar to that
specified in [12].
7) The UE shall when a measurement report is triggered:
2> if the UE has been able to calculate a position after performing
measurements on the cells included in the variable
UE_POSITIONING_OTDOA_DATA_UE_BASED in case of OTDOA or on the list of
satellites included in the variable UE_POSITIONING_GPS_DATA in case of GPS
positioning:
\- include IE \"UE positioning Position Estimate Info\" in the MEASUREMENT
REPORT and set the contents of the IE as follows:
\- if the UE does not support the capability to perform the UE GPS timing of
cell frames measurement; or
\- if the IE \"GPS timing of Cell wanted\" is set to FALSE:
\- include the IE \"GPS TOW msec\".
\- if IE \"Vertical Accuracy\" has been included in IE \"UE positioning
reporting quantity\":
\- if the IE \"Vertical Accuracy\" has been assigned to a value unequal to
\"0\":
> \- if the UE has been able to calculate a 3-dimensional position:
>
> \- include IE \"Ellipsoid point with altitude and uncertainty ellipsoid\" as
> the position estimate.
>
> \- if the UE has not been able to calculate a 3-dimensional position:
>
> \- act as if IE \"Vertical Accuracy\" has not been included in IE \"UE
> positioning reporting quantity\".
\- if IE \"Vertical Accuracy\" has not been included in IE \"UE positioning
reporting quantity\":
\- if IE \"Horizontal Accuracy\" in IE \"UE positioning reporting quantity\"
has been assigned to a value unequal to 0:
6> include either IE \"Ellipsoid point with uncertainty circle\" or IE
\"Ellipsoid point with uncertainty ellipse\" or IE \"Ellipsoid point with
altitude and uncertainty ellipsoid\" as the position estimate.
8) The UE shall set the contents of the IE \"UE positioning Error\" as
follows:
...
1> if the IE \"Positioning Methods\" in IE \"UE positioning reporting
quantity\" has been assigned to value \"GPS\":
2> if there were not enough GPS satellites to be received:
3> set IE \"Error reason\" to \"Not Enough GPS Satellites\".
2> if some GPS assistance data was missing:
3> set IE \"Error reason\" to \"Assistance Data Missing\"; and
3> if the IE \"\"Additional Assistance Data Request\" included in the IE \"UE
positioning reporting quantity\" stored in the variable MEASUREMENT_IDENTITY
is set to TRUE:
4> include the IE \"GPS Additional Assistance Data Request\".
##### Reference(s): {#references-10 .H6}
\- Conformance requirement 1: TS 25.331, subclause 8.4.1.3.
\- Conformance requirement 2: TS 25.331, subclauses 8.6.7.19.3.3a,
8.6.7.19.3.4.
\- Conformance requirement 3: TS 25.331, clause 8.6.7.19.1b.
\- Conformance requirement 4: TS 25.331, clause 8.6.7.19.3.7.
\- Conformance requirement 5: TS 25.331, clause 8.6.7.19.3.8.
\- Conformance requirement 6: TS 25.331, clause 8.6.7.19.3.5.
\- Conformance requirement 7: TS 25.331, clause 8.6.7.19.1b.
\- Conformance requirement 8: TS 25.331, clause 8.6.7.19.5.
\- Reference [12] in these conformance requirements denotes document ICD-
GPS-200: \"Navstar GPS Space Segment/Navigation User Interface\".
##### 6.1.3.2.3 Test Purpose {#test-purpose-11 .H6}
To verify the UE's behaviour in a mobile-terminated location request procedure
using UE-based A-GPS with assistance data from the network.
To verify that the UE in CELL_DCH state accepts assistance data received in
multiple MEASUREMENT CONTROL messages.
To verify that the UE includes the IE \"GPS Additional Assistance Data
Request\" to request assistance data when it does not have enough assistance
data to compute a position.
##### 6.1.3.2.4 Method of Test {#method-of-test-11 .H6}
##### Initial Conditions {#initial-conditions-7 .H6}
> \- System Simulator:
>
> \- 1 cell, default parameters.
>
> \- Satellite signals: As specified in 4.2
>
> \- User Equipment:
>
> \- The UE shall begin the test with no GPS assistance data stored.
>
> \- State \"CS-CELL DCH Initial (State 6-1)\" as specified in clause 7.4.1 of
> TS 34.108.
##### Related PICS/PIXIT Statements {#related-picspixit-statements-12 .H6}
> \- UE Based Network Assisted GPS
>
> \- Method of clearing stored GPS assistance data
>
> \- UE supporting Mobile Terminated Location Request
##### Test Procedure {#test-procedure-12 .H6}
The stored GPS assistance data in the UE shall be cleared.
The SS initiates authentication and ciphering and sends an SS REGISTER message
containing a Facility IE containing a DTAP LCS Location Notification Invoke
message set to notifyLocationAllowed. The LCS Client Name contained in the
USSD text string of the lcs-LocationNotification shall be displayed. The UE
then responds with a RELEASE COMPLETE message containing a
LocationNotification return to terminate the dialogue.
The SS orders an A-GPS positioning measurement using MEASUREMENT CONTROL
including no assistance data.
The UE sends a MEASUREMENT REPORT message to report a positioning error,
requesting further assistance data. The SS response with one or more
MEASUREMENT CONTROL messages that include the requested assistance data and
instructs the UE not to repeat the request for assistance data. The final
MEASUREMENT CONTROL message orders periodic reporting.
The UE performs positioning measurements and responds with a MEASUREMENT
REPORT message containing a valid position estimate in the IE \"UE Positioning
Position Estimate Info\".
##### Expected Sequence {#expected-sequence-12 .H6}
+----------+---------------+-----------------+-----------------+---+ | **Step** | **Direction** | **Message** | **Comments** | | +----------+---------------+-----------------+-----------------+---+ | | **UE** | **SS** | | | +----------+---------------+-----------------+-----------------+---+ | 1 | \ | AUTHENTICATION | | | | | | RESPONSE | | | +----------+---------------+-----------------+-----------------+---+ | 3 | SS | | SS starts | | | | | | security | | | | | | procedure | | +----------+---------------+-----------------+-----------------+---+ | 4 | \ | RELEASE | The UE | | | | | COMPLETE | terminates the | | | | | | dialogue | | +----------+---------------+-----------------+-----------------+---+ | 7 | \ | MEASUREMENT | Positioning | | | | | REPORT | error report | | | | | | with request | | | | | | for further | | | | | | assistance | | | | | | data. | | +----------+---------------+-----------------+-----------------+---+ | 9 | \ | MEASUREMENT | Measurement | | | | | REPORT | report message | | | | | | containing UE | | | | | | position | | | | | | estimate. | | +----------+---------------+-----------------+-----------------+---+ | 11 | SS | | SS releases the | | | | | | RRC connection | | | | | | and the test | | | | | | case ends | | +----------+---------------+-----------------+-----------------+---+
##### Specific Message Contents {#specific-message-contents-12 .H6}
##### REGISTER (Step 4) {#register-step-4-1 .H6}
+-------------------------+---------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+---------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+---------------------------------------------+ | Transaction identifier | | +-------------------------+---------------------------------------------+ | Message type | REGISTER (0011 1011) | +-------------------------+---------------------------------------------+ | Facility | Invoke = lcs-LocationNotification | | | | | | LocationNotificationArg | | | | | | notificationType -> notifyLocationAllowed, | | | | | | locationType -> current Location , | | | | | | lcsClientExternalID -> externalAddress | | | | | | lcsClientName ->dataCodingScheme | | | | | | nameString | +-------------------------+---------------------------------------------+
##### RELEASE COMPLETE (Step 6) {#release-complete-step-6-1 .H6}
+-------------------------+--------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+--------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+--------------------------------------------+ | Transaction identifier | | +-------------------------+--------------------------------------------+ | Message type | RELEASE COMPLETE (xx10 1010) | +-------------------------+--------------------------------------------+ | Facility | Return result = lcs-LocationNotification | | | | | | LocationNotificationRes | | | | | | verificationResponse -> permissionGranted | +-------------------------+--------------------------------------------+
##### MEASUREMENT CONTROL (Step 7): {#measurement-control-step-7-5 .H6}
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Setup Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Measurement
Reporting Mode Not present Additional Measurements List Not present CHOICE
_Measurement type_ UE positioning measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE based \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request TRUE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_ Periodical reporting
criteria \- Amount of reporting 1 \- Reporting interval 64000 \- UE pos OTDOA
assistance data for UE-assisted Not present \- UE pos OTDOA assistance data
for UE-based Not present \- UE positioning GPS assistance data Set as
specified for \"Inadequate assistance data for UE-based A-GPS\" in 4.3.2
**Physical Channel Information Elements**  
DPCH compressed mode status info Not present
* * *
##### MEASUREMENT REPORT (Step 8): {#measurement-report-step-8 .H6}
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_  
\- UE positioning measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info Not present \- UE positioning GPS measured results Not
present \- UE positioning error  
\- Error reason Assistance Data Missing \- GPS additional assistance data
request  
\- Almanac Not checked \- UTC model Not checked \- Ionospheric model Not
checked \- Navigation model Not checked \- DGPS corrections Not checked \-
Reference location Not checked \- Reference time Not checked \- Acquisition
assistance Not checked \- Real-time integrity Not checked \- Navigation model
additional data Not checked Measured Results on RACH Not present Additional
Measured Results Not present Event Results Not present
* * *
##### MEASUREMENT CONTROL (Step 9): {#measurement-control-step-9 .H6}
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Modify Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE based \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request FALSE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_ Set as required
according to position in sequence of messages \- Amount of reporting Set as
required according to position in sequence of messages \- Reporting interval
Set as required according to position in sequence of messages \- UE pos OTDOA
assistance data for UE-assisted Not present \- UE pos OTDOA assistance data
for UE-based Not present \- UE positioning GPS assistance data Set as
specified in 4.3.5 **Physical Channel Information Elements**  
DPCH compressed mode status info Not present
* * *
##### MEASUREMENT REPORT (Step 10): {#measurement-report-step-10 .H6}
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_  
\- UE positioning measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info  
\- CHOICE _Reference time_  
\- GPS reference time only  
\- GPS TOW msec Not checked \- CHOICE _Position estimate_ One of 'Ellipsoid
point with uncertainty Circle' or 'Ellipsoid point with uncertainty Ellipse'
or 'Ellipsoid point with altitude and uncertainty Ellipsoid' \- UE positioning
GPS measured results Not present \- UE positioning error Not present Measured
Results on RACH Not present Additional Measured Results Not present Event
Results Not present
* * *
##### 6.1.3.2.5 Test Requirements {#test-requirements-11 .H6}
At step 7 the UE shall send a MEASUREMENT REPORT message containing the IE
\"UE positioning error\", with \"Error reason\" set to \"Assistance Data
Missing\".
At step 9 the UE shall send a MEASUREMENT REPORT message containing a valid UE
position estimate.
#### 6.1.3.3 LCS Mobile-terminated location request/UE-Based GPS/ Failure --
Not Enough Satellites
##### 6.1.3.3.1 Definition {#definition-11 .H6}
This test case applies to all UEs supporting UE-Based GPS Location Service
capabilities.
##### 6.1.3.3.2 Conformance requirements {#conformance-requirements-12 .H6}
> 1) if the IE \"Measurement command\" has the value \"modify\":
>
> 2> for all IEs present in the MEASUREMENT CONTROL message:
>
> \- if a measurement was stored in the variable MEASUREMENT_IDENTITY
> associated to the identity by the IE \"measurement identity\":
>
> \- if measurement type is set to \"UE positioning measurement\" and the IE
> \"UE positioning GPS assistance data\" is present, for any of the optional
> IEs \"UE positioning GPS reference time\", \"UE positioning GPS reference UE
> position\", \"UE positioning GPS DGPS corrections\", \"UE positioning GPS
> ionospheric model\", \"UE positioning GPS UTC model\", \"UE positioning GPS
> acquisition assistance\", \"UE positioning GPS real-time integrity\" that
> are present in the MEASUREMENT CONTROL message:
>
> 5> replace all instances of the IEs listed above (and all their children)
> stored in variable MEASUREMENT_IDENTITY associated to the identity indicated
> by the IE \"measurement identity\" with the IEs received in the MEASUREMENT
> CONTROL message;
>
> 5> leave all other stored information elements unchanged in the variable
> MEASUREMENT_IDENTITY.
>
> 2) If the IE \"UE positioning GPS Navigation Model\" is included, for each
> satellite, the UE shall:
>
> 1> use IE \"Satellite Status\" to determine if an update of IE \"UE
> positioning GPS Ephemeris and Clock Correction parameters\" has been
> provided for the satellite indicated by the IE \"SatID\";
>
> 1> if an update has been provided for this satellite:
>
> 2> act as specified in subclause 8.6.7.19.3.4.
>
> 3) If the IE \"UE positioning GPS Ephemeris and Clock Correction
> parameters\" is included, for each satellite, the UE shall:
>
> 1> update the variable UE_POSITIONING_GPS_DATA as follows:
>
> 2> store this IE at the position indicated by the IE \"Sat ID\" in the IE
> \"UE positioning GPS Navigation Model\" in the variable
> UE_POSITIONING_GPS_DATA, possibly overwriting any existing information in
> this position.
>
> 1> act on these GPS ephemeris and clock correction parameters in a manner
> similar to that specified in [12].
>
> 4) If the IE \"UE positioning GPS reference time\" is included, the UE
> shall:
>
> 1> store the IE \"GPS Week\" in \"UE positioning GPS reference time\" in
> variable UE_POSITIONING_GPS_DATA and use it as the current GPS week;
>
> \- store the IE \"GPS TOW msec\" in the IE \"UE positioning GPS reference
> time\" in variable UE_POSITIONING_GPS_DATA and use it as an estimate of the
> GPS Time-of-Week at the time of reception of the complete message containing
> the IE \"GPS TOW msec\";
>
> NOTE: The UE does not need to apply any compensation on the GPS Time-of-
> Week.
>
> \- if the IE \"SFN\" and IE \"UTRAN GPS timing of cell frames\" are
> included:
>
> \- if the UE is able to utilise the IEs:
>
> \- store these IEs in the IE \"UE positioning GPS reference time\" in
> variable UE_POSITIONING_GPS_DATA;
>
> \- if the IE \"Primary CPICH Info\" for FDD or IE \"cell parameters id\" for
> TDD is not included:
>
> \- if the UE is not in CELL_DCH state:
>
> \- use IEs \"SFN\" and \"UTRAN GPS timing of cell frames\" to estimate the
> relationship between GPS time and air-interface timing of the NODE B
> transmission in the serving cell.
>
> \- if the UE is in CELL_DCH state:
>
> \- ignore IEs \"SFN\" and \"UTRAN GPS timing of cell frames\".
>
> \- if the IE \"Primary CPICH Info\" for FDD or IE \"cell parameters id\" for
> TDD is also included:
>
> \- store this IE in the IE \"UE positioning GPS reference time\" in variable
> UE_POSITIONING_GPS_DATA;
>
> \- use IEs \"SFN\" and \"UTRAN GPS timing of cell frames\" to estimate the
> relationship between GPS time and air-interface timing of the NODE B
> transmission in the cell indicated by \"Primary CPICH info\" or \"cell
> parameters id\".
>
> \- if the IE \"SFN-TOW Uncertainty\" is included:
>
> \- store this IE in the IE \"UE positioning GPS reference time\" in variable
> UE_POSITIONING_GPS_DATA and use it to determine if the relationship between
> GPS time and air-interface timing of the NODE B transmission is known to
> within at least 10ms.
>
> \- if the IE \"T~UTRAN-GPS~ drift rate\" is included:
>
> \- store this IE in the IE \"UE positioning GPS reference time\" in variable
> UE_POSITIONING_GPS_DATA; and
>
> \- may use it as an estimate of the drift rate of the NODE B clock relative
> to GPS time.
>
> \- if the IE \"GPS TOW Assist\" is included:
>
> \- for each satellite:
>
> 3> delete all information currently stored in the IE \"GPS TOW Assist\" in
> the IE \"UE positioning GPS reference time\" in the variable
> UE_POSITIONING_GPS_DATA;
>
> 3> store the received GPS TOW Assist information in the IE \"UE positioning
> GPS reference time\" in the variable UE_POSITIONING_GPS_DATA.
>
> 5) If the IE \"UE positioning GPS reference UE position\" is included, the
> UE shall:
>
> 1> store this IE in the IE \"UE positioning GPS reference UE position\" in
> variable UE_POSITIONING_GPS_DATA; and
>
> 1> use it as a priori knowledge of the approximate location of the UE.
>
> 6) If IE \"UE positioning GPS ionospheric model\" is included, the UE shall:
>
> 1> store this IE in the IE \"UE positioning GPS ionospheric model\" in
> variable UE_POSITIONING_GPS_DATA;
>
> 1> act on these GPS ionospheric model parameters in a manner similar to that
> specified in [12].
>
> 7) The UE shall when a measurement report is triggered:
>
> 2> if the UE has been able to calculate a position after performing
> measurements on the cells included in the variable
> UE_POSITIONING_OTDOA_DATA_UE_BASED in case of OTDOA or on the list of
> satellites included in the variable UE_POSITIONING_GPS_DATA in case of GPS
> positioning:
>
> \- include IE \"UE positioning Position Estimate Info\" in the MEASUREMENT
> REPORT and set the contents of the IE as follows:
>
> \- if the UE does not support the capability to perform the UE GPS timing of
> cell frames measurement; or
>
> \- if the IE \"GPS timing of Cell wanted\" is set to FALSE:
>
> \- include the IE \"GPS TOW msec\".
>
> \- if IE \"Vertical Accuracy\" has been included in IE \"UE positioning
> reporting quantity\":
>
> \- if the IE \"Vertical Accuracy\" has been assigned to a value unequal to
> \"0\":
>
> \- if the UE has been able to calculate a 3-dimensional position:
>
> \- include IE \"Ellipsoid point with altitude and uncertainty ellipsoid\" as
> the position estimate.
>
> \- if the UE has not been able to calculate a 3-dimensional position:
>
> \- act as if IE \"Vertical Accuracy\" has not been included in IE \"UE
> positioning reporting quantity\".
>
> \- if IE \"Vertical Accuracy\" has not been included in IE \"UE positioning
> reporting quantity\":
>
> \- if IE \"Horizontal Accuracy\" in IE \"UE positioning reporting quantity\"
> has been assigned to a value unequal to 0:
>
> 6> include either IE \"Ellipsoid point with uncertainty circle\" or IE
> \"Ellipsoid point with uncertainty ellipse\" or IE \"Ellipsoid point with
> altitude and uncertainty ellipsoid\" as the position estimate.
8) The UE shall set the contents of the IE \"UE positioning Error\" as
follows:
...
> 1> if the IE \"Positioning Methods\" in IE \"UE positioning reporting
> quantity\" has been assigned to value \"GPS\":
>
> 2> if there were not enough GPS satellites to be received:
>
> 3> set IE \"Error reason\" to \"Not Enough GPS Satellites\".
>
> 2> if some GPS assistance data was missing:
>
> 3> set IE \"Error reason\" to \"Assistance Data Missing\"; and
>
> 3> if the IE \"\"Additional Assistance Data Request\" included in the IE
> \"UE positioning reporting quantity\" stored in the variable
> MEASUREMENT_IDENTITY is set to TRUE:
>
> 4> include the IE \"GPS Additional Assistance Data Request\".
##### Reference(s): {#references-11 .H6}
> \- Conformance requirement 1: TS 25.331, subclause 8.4.1.3.
>
> \- Conformance requirement 2: TS 25.331, subclauses 8.6.7.19.3.3a,
> 8.6.7.19.3.4.
>
> \- Conformance requirement 3: TS 25.331, clause 8.6.7.19.1b.
>
> \- Conformance requirement 4: TS 25.331, clause 8.6.7.19.3.7.
>
> \- Conformance requirement 5: TS 25.331, clause 8.6.7.19.3.8.
>
> \- Conformance requirement 6: TS 25.331, clause 8.6.7.19.3.5.
>
> \- Conformance requirement 7: TS 25.331, clause 8.6.7.19.1b.
>
> \- Conformance requirement 8: TS 25.331, clause 8.6.7.19.5.
>
> \- Reference [12] in these conformance requirements denotes document ICD-
> GPS-200: \"Navstar GPS Space Segment/Navigation User Interface\".
##### 6.1.3.3.3 Test Purpose {#test-purpose-12 .H6}
To verify the UE's behaviour in a mobile-terminated location request procedure
using UE-based A-GPS with assistance data from the network.
To verify that the UE in CELL_DCH state accepts assistance data received in
multiple MEASUREMENT CONTROL messages.
To verify that the UE sets the IE Error Reason in 'UE Positioning Error' to
'Not Enough GPS Satellites' when it does not receive enough satellite signals
to compute a position.
##### 6.1.3.3.4 Method of Test {#method-of-test-12 .H6}
Initial Conditions
> \- System Simulator:
>
> \- 1 cell, default parameters.
>
> \- Satellite signals switched off or not present.
>
> \- User Equipment:
>
> \- State \"CS-CELL DCH Initial (State 6-1)\" as specified in clause 7.4.1 of
> TS 34.108.
>
> \- The UE shall begin the test with no GPS assistance data stored.
##### Related PICS/PIXIT Statements {#related-picspixit-statements-13 .H6}
> \- UE Based Network Assisted GPS
>
> \- Method of clearing stored GPS assistance data
>
> \- UE supporting Mobile Terminated Location Request
##### Test Procedure {#test-procedure-13 .H6}
The stored GPS assistance data in the UE shall be cleared.
The SS initiates authentication and ciphering and sends an SS REGISTER message
containing a Facility IE containing a DTAP LCS Location Notification Invoke
message set to notifyLocationAllowed. The LCS Client Name contained in the
USSD text string of the lcs-LocationNotification shall be displayed. The UE
then responds with a RELEASE COMPLETE message containing a
LocationNotification return to terminate the dialogue.
The SS orders an A-GPS positioning measurement using two MEASUREMENT CONTROL
messages. The last MEASUREMENT CONTROL message orders periodical reporting.
The UE sends a MEASUREMENT REPORT message reporting a positioning error for
not enough satellite signal.
##### Expected Sequence {#expected-sequence-13 .H6}
+----------+---------------+-----------------+-----------------+---+ | **Step** | **Direction** | **Message** | **Comments** | | +----------+---------------+-----------------+-----------------+---+ | | **UE** | **SS** | | | +----------+---------------+-----------------+-----------------+---+ | 1 | \ | AUTHENTICATION | | | | | | RESPONSE | | | +----------+---------------+-----------------+-----------------+---+ | 3 | SS | | SS starts | | | | | | security | | | | | | procedure | | +----------+---------------+-----------------+-----------------+---+ | 4 | \ | RELEASE | The UE | | | | | COMPLETE | terminates the | | | | | | dialogue | | +----------+---------------+-----------------+-----------------+---+ | 7 | \ | MEASUREMENT | Positioning | | | | | REPORT | error report | | | | | | 'not enough GPS | | | | | | satellites' | | +----------+---------------+-----------------+-----------------+---+ | 10 | SS | | SS releases the | | | | | | RRC connection | | | | | | and the test | | | | | | case ends | | +----------+---------------+-----------------+-----------------+---+
##### Specific Message Contents {#specific-message-contents-13 .H6}
##### REGISTER (Step 4) {#register-step-4-2 .H6}
+-------------------------+---------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+---------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+---------------------------------------------+ | Transaction identifier | | +-------------------------+---------------------------------------------+ | Message type | REGISTER (0011 1011) | +-------------------------+---------------------------------------------+ | Facility | Invoke = lcs-LocationNotification | | | | | | LocationNotificationArg | | | | | | notificationType -> notifyLocationAllowed, | | | | | | locationType -> current Location , | | | | | | lcsClientExternalID -> externalAddress | | | | | | lcsClientName ->dataCodingScheme | | | | | | nameString | +-------------------------+---------------------------------------------+
##### RELEASE COMPLETE (Step 6) {#release-complete-step-6-2 .H6}
+-------------------------+--------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+--------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+--------------------------------------------+ | Transaction identifier | | +-------------------------+--------------------------------------------+ | Message type | RELEASE COMPLETE (xx10 1010) | +-------------------------+--------------------------------------------+ | Facility | Return result = lcs-LocationNotification | | | | | | LocationNotificationRes | | | | | | verificationResponse -> permissionGranted | +-------------------------+--------------------------------------------+
##### MEASUREMENT CONTROL (Step 7): {#measurement-control-step-7-6 .H6}
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Setup Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE based \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request FALSE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_  
\- No reporting  
\- UE pos OTDOA assistance data for UE-assisted Not present \- UE pos OTDOA
assistance data for UE-based Not present \- UE positioning GPS assistance data
Set as specified for the first MEASUREMENT CONTROL message for \"Adequate
assistance data for UE-based A-GPS\" in 4.3.1 **Physical Channel Information
Elements**  
DPCH compressed mode status info Not present
* * *
##### MEASUREMENT CONTROL (Step 8): {#measurement-control-step-8-4 .H6}
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Modify Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE based \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request FALSE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_ Periodical reporting
criteria \- Amount of reporting 1 \- Reporting interval 64000 \- UE pos OTDOA
assistance data for UE-assisted Not present \- UE pos OTDOA assistance data
for UE-based Not present \- UE positioning GPS assistance data Set as
specified for the second MEASUREMENT CONTROL message for \"Adequate assistance
data for UE-based A-GPS\" in 4.3.1 **Physical Channel Information Elements**  
DPCH compressed mode status info Not present
* * *
##### MEASUREMENT REPORT (Step 9): {#measurement-report-step-9-4 .H6}
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_  
\- UE positioning measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info Not present \- UE positioning GPS measured results Not
present \- UE positioning error  
\- Error reason Not Enough GPS Satellites \- GPS additional assistance data
request  
\- Almanac Not checked \- UTC model Not checked \- Ionospheric model Not
checked \- Navigation model Not checked \- DGPS corrections Not checked \-
Reference location Not checked \- Reference time Not checked \- Acquisition
assistance Not checked \- Real-time integrity Not checked \- Navigation model
additional data Not checked Measured Results on RACH Not present Additional
Measured Results Not present Event Results Not present
* * *
##### 6.1.3.3.5 Test Requirements {#test-requirements-12 .H6}
At step 8 the UE shall send a MEASUREMENT REPORT message containing the IE
\"UE positioning error\", with \"Error reason\" set to \"Not Enough GPS
Satellites\".
#### 6.1.3.4 LCS Mobile terminated location request/ UE-Assisted GPS/ Success
##### 6.1.3.4.1 Definition {#definition-12 .H6}
This test case applies to all UEs supporting UE-Assisted GPS Location Service
capabilities.
##### 6.1.3.4.2 Conformance requirements {#conformance-requirements-13 .H6}
> 1) The network invokes a location notification procedure by sending a
> REGISTER message containing a LCS-LocationNotification invoke component to
> the UE. This may be sent either to request verification for MT-LR or to
> notify about already authorized MT-LR.
>
> In the case of location notification no response is required from the UE,
> the UE shall terminate the dialogue by sending a RELEASE COMPLETE message
> containing a LocationNotification return result.
>
> 2) if the IE \"Measurement command\" has the value \"setup\":
>
> 2> store this measurement in the variable MEASUREMENT_IDENTITY according to
> the IE \"measurement identity\", first releasing any previously stored
> measurement with that identity if that exists;
>
> ...
>
> 2> for any other measurement type:
>
> 3> if the measurement is valid in the current RRC state of the UE:
>
> 4> begin measurements according to the stored control information for this
> measurement identity.
>
> 3) The UE shall:
>
> 1> when a measurement report is triggered:
>
> 2> if the UE was able to perform measurements on at least one neighbour cell
> included in the variable UE_POSITIONING_OTDOA_DATA_UE_ASSISTED in case of
> OTDOA or one satellite included in the variable UE_POSITIONING_GPS_DATA in
> case of GPS positioning or one cell from the active set in case of CELL ID:
>
> 3> if the IE \"Vertical Accuracy\" is included:
>
> 4> interpret the presence of this IE to indicate that the UTRAN desires to
> compute a 3-dimensional position estimate.
>
> 3> if the IE \"Positioning Methods\" is set to \"GPS\":
>
> 4> include the IE \"UE positioning GPS measured results\" in the measurement
> report and set the contents of the IE as follows:
>
> 5> if the UE supports the capability to provide the GPS timing of the cell
> frames measurement:
>
> 6> if the IE \"GPS timing of Cell wanted\" is set to TRUE:
>
> 7> perform the UE GPS timing of cell frames measurement on the serving cell
> or on one cell of the active set.
>
> 7> include the IE \"Primary CPICH Info\" for FDD or the IE \"cell parameters
> id\" for TDD; and
>
> 7> include the IE \"Reference SFN\" and the IE \"UE GPS timing of cell
> frames\".
>
> 6> if the IE \"GPS timing of Cell wanted\" is set to FALSE:
>
> 7> include the IE \"GPS TOW msec\".
>
> 5> if the UE does not support the capability to provide the GPS timing of
> the cell:
>
> 6> include the IE \"GPS TOW msec\".
References
> \- Conformance requirement 1: TS 24.030, subclause 5.1.1
>
> \- Conformance requirement 2: TS 25.331, clause 8.4.1.3.
>
> \- Conformance requirement 3: TS 25.331, clause 8.6.7.19.1a.
6.1.3.4.3 Test Purpose
To verify the UE behaviour in the mobile-terminated location request procedure
using network-assisted UE-assisted GPS to deliver UE positioning measurements
to the network.
6.1.3.4.4 Method of Test
Initial Conditions
System Simulator (SS):
> \- 1 cell, default parameters
>
> _\- Satellite signals:_ As specified in 4.2
##### UE: {#ue-2 .H6}
> \- State \"CS-CELL DCH Initial (State 6-1)\" as specified in clause 7.4.1 of
> TS 34.108.
##### Related PICS/PIXIT Statements {#related-picspixit-statements-14 .H6}
> \- UE supporting CS domain services
>
> \- UE Assisted Network Assisted GPS
>
> \- UE supporting Mobile Terminated Location Request
##### Test Procedure {#test-procedure-14 .H6}
The SS initiates authentication and ciphering and sends an SS REGISTER message
containing a Facility IE containing a DTAP LCS Location Notification Invoke
message set to notifyLocationAllowed. The LCS Client Name contained in the
USSD text string of the lcs-LocationNotification shall be displayed. The UE
then responds with a RELEASE COMPLETE message containing a
LocationNotification return to terminate the dialogue.
The SS orders an A-GPS positioning measurement using a MEASUREMENT CONTROL
message. The assistance data is as described in subclause 4.3.3 (Adequate
assistance data for UE-assisted A-GPS). The MEASUREMENT CONTROL message orders
periodical reporting.
The UE may request additional assistance data by sending a MEASUREMENT REPORT
message containing a positioning error indication with the IE \"Error reason\"
set to \"Assistance Data Missing\". If the UE requests additional assistance
data, the SS provides the requested assistance data in one or more MEASUREMENT
CONTROL messages.
The UE then initiates periodic measurement reporting and sends a MEASUREMENT
REPORT message including the IE \"UE positioning GPS measured results\".
##### Expected Sequence {#expected-sequence-14 .H6}
+----------+---------------+-----------------+-----------------+---+ | **Step** | **Direction** | **Message** | **Comments** | | +----------+---------------+-----------------+-----------------+---+ | | **UE** | **SS** | | | +----------+---------------+-----------------+-----------------+---+ | 1 | \ | AUTHENTICATION | | | | | | RESPONSE | | | +----------+---------------+-----------------+-----------------+---+ | 3 | SS | | SS starts | | | | | | security | | | | | | procedure | | +----------+---------------+-----------------+-----------------+---+ | 4 | \ | RELEASE | The UE | | | | | COMPLETE | terminates the | | | | | | dialogue | | +----------+---------------+-----------------+-----------------+---+ | 7 | \ | MEASUREMENT | UE reports | | | | | REPORT | positioning | | | | | | measurement | | | | | | results (Option | | | | | | 1) or requests | | | | | | additional | | | | | | assistance data | | | | | | (Option 2). | | +----------+---------------+-----------------+-----------------+---+ | 8a | \ | MEASUREMENT | If UE requested | | | | | REPORT | additional | | | | | | assistance data | | | | | | in step 8, this | | | | | | message | | | | | | contains the IE | | | | | | \"UE | | | | | | positioning GPS | | | | | | measured | | | | | | results\". | | +----------+---------------+-----------------+-----------------+---+ | 9 | SS | | SS releases the | | | | | | RRC connection | | | | | | and the test | | | | | | case ends | | +----------+---------------+-----------------+-----------------+---+
##### Specific Message Contents {#specific-message-contents-14 .H6}
REGISTER (Step 4)
+-------------------------+---------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+---------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+---------------------------------------------+ | Transaction identifier | | +-------------------------+---------------------------------------------+ | Message type | REGISTER (0011 1011) | +-------------------------+---------------------------------------------+ | Facility | Invoke = lcs-LocationNotification | | | | | | LocationNotificationArg | | | | | | notificationType -> notifyLocationAllowed, | | | | | | locationType -> current Location , | | | | | | lcsClientExternalID -> externalAddress | | | | | | lcsClientName ->dataCodingScheme | | | | | | nameString | +-------------------------+---------------------------------------------+
RELEASE COMPLETE (Step 6)
+-------------------------+--------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+--------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+--------------------------------------------+ | Transaction identifier | | +-------------------------+--------------------------------------------+ | Message type | RELEASE COMPLETE (xx10 1010) | +-------------------------+--------------------------------------------+ | Facility | Return result = lcs-LocationNotification | | | | | | LocationNotificationRes | | | | | | verificationResponse -> permissionGranted | +-------------------------+--------------------------------------------+
MEASUREMENT CONTROL (Step 7):
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Setup Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE assisted \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request TRUE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_ Periodical reporting
criteria \- Amount of reporting 1 \- Reporting interval 64000 \- UE pos OTDOA
assistance data for UE-assisted Not present \- UE pos OTDOA assistance data
for UE-based Not present \- UE positioning GPS assistance data Set as
specified for \"Adequate assistance data for UE-assisted A-GPS\" in 4.3.3
**Physical Channel Information Elements**  
DPCH compressed mode status info Not present
* * *
MEASUREMENT REPORT (Step 8 (Option 1) or 8b (Option 2))
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_  
\- UE positioning measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info Not present \- UE positioning GPS measured results
Present \- UE positioning error Not present Measured Results on RACH Not
present Additional Measured Results Not present Event Results Not present
* * *
MEASUREMENT REPORT (Step 8 (Option 2)):
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_  
\- UE positioning measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info Not present \- UE positioning GPS measured results Not
present \- UE positioning error  
\- Error reason Assistance Data Missing \- GPS additional assistance data
request  
\- Almanac Not checked \- UTC model Not checked \- Ionospheric model Not
checked \- Navigation model Not checked \- DGPS corrections Not checked \-
Reference location Not checked \- Reference time Not checked \- Acquisition
assistance Not checked \- Real-time integrity Not checked \- Navigation model
additional data Not checked Measured Results on RACH Not present Additional
Measured Results Not present Event Results Not present
* * *
MEASUREMENT CONTROL (Step 8a (Option 2)):
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Modify Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE assisted \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy Set according to 4.2 (unequal to 0) \- Vertical accuracy
Set according to 4.2 (unequal to 0) \- GPS timing of cell wanted FALSE \-
Multiple sets FALSE \- Additional assistance data request FALSE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_ Periodical reporting
criteria \- Amount of reporting 1 \- Reporting interval 64000 \- UE pos OTDOA
assistance data for UE-assisted Not present \- UE pos OTDOA assistance data
for UE-based Not present \- UE positioning GPS assistance data Set as
specified in 4.3.5 **Physical Channel Information Elements**  
DPCH compressed mode status info Not present
* * *
6.1.3.4.5 Test requirements
After step 5 the UE shall send a RELEASE COMPLETE message.
After step 7 the UE shall respond with a MEASUREMENT REPORT message containing
the IE \"UE positioning GPS measured results\".
#### 6.1.3.5 LCS Mobile terminated location request/ UE-Assisted GPS/ Request
for additional assistance data/ Success
6.1.3.5.1 Definition
This test case applies to all UEs supporting UE-Assisted GPS Location Service
capabilities.
6.1.3.5.2 Conformance requirements
> 1) The network invokes a location notification procedure by sending a
> REGISTER message containing a LCS-LocationNotification invoke component to
> the UE. This may be sent either to request verification for MT-LR or to
> notify about already authorized MT-LR.
>
> In the case of location notification no response is required from the UE,
> the UE shall terminate the dialogue by sending a RELEASE COMPLETE message
> containing a LocationNotification return result.
>
> 2) if the IE \"Measurement command\" has the value \"modify\":
>
> 2> for all IEs present in the MEASUREMENT CONTROL message:
>
> 3> if a measurement was stored in the variable MEASUREMENT_IDENTITY
> associated to the identity by the IE \"measurement identity\":
>
> 4> if measurement type is set to \"UE positioning measurement\" and the IE
> \"UE positioning GPS assistance data\" is present, for any of the optional
> IEs \"UE positioning GPS reference time\", \"UE positioning GPS reference UE
> position\", \"UE positioning GPS DGPS corrections\", \"UE positioning GPS
> ionospheric model\", \"UE positioning GPS UTC model\", \"UE positioning GPS
> acquisition assistance\", \"UE positioning GPS real-time integrity\" that
> are present in the MEASUREMENT CONTROL message:
>
> 5> replace all instances of the IEs listed above (and all their children)
> stored in variable MEASUREMENT_IDENTITY associated to the identity indicated
> by the IE \"measurement identity\" with the IEs received in the MEASUREMENT
> CONTROL message;
>
> 5> leave all other stored information elements unchanged in the variable
> MEASUREMENT_IDENTITY.
>
> 3) The UE shall:
>
> 1> when a measurement report is triggered:
>
> 2> if the UE was able to perform measurements on at least one neighbour cell
> included in the variable UE_POSITIONING_OTDOA_DATA_UE_ASSISTED in case of
> OTDOA or one satellite included in the variable UE_POSITIONING_GPS_DATA in
> case of GPS positioning or one cell from the active set in case of CELL ID:
>
> 3> if the IE \"Vertical Accuracy\" is included:
>
> 4> interpret the presence of this IE to indicate that the UTRAN desires to
> compute a 3-dimensional position estimate.
>
> 3> if the IE \"Positioning Methods\" is set to \"GPS\":
>
> 4> include the IE \"UE positioning GPS measured results\" in the measurement
> report and set the contents of the IE as follows:
>
> 5> if the UE supports the capability to provide the GPS timing of the cell
> frames measurement:
>
> 6> if the IE \"GPS timing of Cell wanted\" is set to TRUE:
>
> 7> perform the UE GPS timing of cell frames measurement on the serving cell
> or on one cell of the active set.
>
> 7> include the IE \"Primary CPICH Info\" for FDD or the IE \"cell parameters
> id\" for TDD; and
>
> 7> include the IE \"Reference SFN\" and the IE \"UE GPS timing of cell
> frames\".
>
> 6> if the IE \"GPS timing of Cell wanted\" is set to FALSE:
>
> 7> include the IE \"GPS TOW msec\".
>
> 5> if the UE does not support the capability to provide the GPS timing of
> the cell:
>
> 6> include the IE \"GPS TOW msec\".
>
> 4) 1> if the UE is not able to report the requested measurement results:
>
> 2> include IE \"UE positioning error\" in the MEASUREMENT REPORT and set the
> contents of this IE as specified in subclause 8.6.7.19.5.
>
> 5) if the IE \"Positioning Methods\" in IE \"UE positioning reporting
> quantity\" has been assigned to value \"GPS\":
>
> 2> if there were not enough GPS satellites to be received:
>
> 3> set IE \"Error reason\" to \"Not Enough GPS Satellites\".
>
> 2> if some GPS assistance data was missing:
>
> 3> set IE \"Error reason\" to \"Assistance Data Missing\"; and
>
> 3> if the IE \"Additional Assistance Data Request\" included in the IE \"UE
> positioning reporting quantity\" stored in the variable MEASUREMENT_IDENTITY
> is set to FALSE:
>
> 4> not include the IE \"GPS Additional Assistance Data Request\", and use
> the assistance data available for doing a positioning estimate.
References
> \- Conformance requirement 1: TS 24.030, subclause 5.1.1
>
> \- Conformance requirement 2: TS 25.331, clause 8.4.1.3.
>
> \- Conformance requirements 3 and 4: TS 25.331, clause 8.6.7.19.1a.
>
> \- Conformance requirement 5: TS 25.331, clause 8.6.7.19.5.
6.1.3.5.3 Test Purpose
To verify the UE behaviour in the mobile-terminated location request procedure
using network-assisted UE-assisted GPS to deliver UE positioning measurements
to the network.
To verify that the UE includes the IE \"GPS Additional Assistance Data
Request\" to request additional assistance data when it does not have enough
assistance data to perform the requested measurements.
6.1.3.5.4 Method of Test
Initial Conditions
System Simulator (SS):
> \- 1 cell, default parameters
>
> _\- Satellite signals:_ As specified in 4.2
##### UE: {#ue-3 .H6}
> \- The UE shall begin the test with no GPS assistance data stored.
>
> \- State \"CS-CELL DCH Initial (State 6-1)\" as specified in clause 7.4.1 of
> TS 34.108.
##### Related PICS/PIXIT Statements {#related-picspixit-statements-15 .H6}
> \- UE supporting CS domain services
>
> \- UE Assisted Network Assisted GPS
>
> \- Method of clearing stored GPS assistance data
>
> \- UE supporting Mobile Terminated Location Request
##### Test Procedure {#test-procedure-15 .H6}
The stored GPS assistance data in the UE shall be cleared.
The SS initiates authentication and ciphering and sends an SS REGISTER message
containing a Facility IE containing a DTAP LCS Location Notification Invoke
message set to notifyLocationAllowed. The LCS Client Name contained in the
USSD text string of the lcs-LocationNotification shall be displayed. The UE
then responds with a RELEASE COMPLETE message containing a
LocationNotification return to terminate the dialogue.
The SS orders an A-GPS positioning measurement using a MEASUREMENT CONTROL
message. The assistance data is as described in subclause 4.3.2 (Inadequate
assistance data for UE-assisted A-GPS). The MEASUREMENT CONTROL message orders
periodical reporting.
The UE then initiates periodic measurement reporting and sends a MEASUREMENT
REPORT message including a request for additional assistance data. The SS
responds with one or more MEASUREMENT CONTROL messages containing assistance
data as specified in subclause 4.3.5 (Response to additional assistance data
requests from UE). The UE sends a MEASUREMENT REPORT message including the IE
\"UE positioning GPS measured results\".
##### Expected Sequence {#expected-sequence-15 .H6}
+----------+---------------+-----------------+-----------------+---+ | **Step** | **Direction** | **Message** | **Comments** | | +----------+---------------+-----------------+-----------------+---+ | | **UE** | **SS** | | | +----------+---------------+-----------------+-----------------+---+ | 1 | \ | AUTHENTICATION | | | | | | RESPONSE | | | +----------+---------------+-----------------+-----------------+---+ | 3 | SS | | SS starts | | | | | | security | | | | | | procedure | | +----------+---------------+-----------------+-----------------+---+ | 4 | \ | RELEASE | The UE | | | | | COMPLETE | terminates the | | | | | | dialogue | | +----------+---------------+-----------------+-----------------+---+ | 7 | \ | MEASUREMENT | UE requests | | | | | REPORT | additional | | | | | | assistance | | | | | | data. | | +----------+---------------+-----------------+-----------------+---+ | 9 | \ | MEASUREMENT | UE sends the IE | | | | | REPORT | \"UE | | | | | | positioning GPS | | | | | | measured | | | | | | results\". | | +----------+---------------+-----------------+-----------------+---+ | 11 | SS | | SS releases the | | | | | | RRC connection | | | | | | and the test | | | | | | case ends | | +----------+---------------+-----------------+-----------------+---+
##### Specific Message Contents {#specific-message-contents-15 .H6}
REGISTER (Step 4)
+-------------------------+---------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+---------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+---------------------------------------------+ | Transaction identifier | | +-------------------------+---------------------------------------------+ | Message type | REGISTER (0011 1011) | +-------------------------+---------------------------------------------+ | Facility | Invoke = lcs-LocationNotification | | | | | | LocationNotificationArg | | | | | | notificationType -> notifyLocationAllowed, | | | | | | locationType -> current Location , | | | | | | lcsClientExternalID -> externalAddress | | | | | | lcsClientName ->dataCodingScheme | | | | | | nameString | +-------------------------+---------------------------------------------+
RELEASE COMPLETE (Step 6)
+-------------------------+--------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+--------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+--------------------------------------------+ | Transaction identifier | | +-------------------------+--------------------------------------------+ | Message type | RELEASE COMPLETE (xx10 1010) | +-------------------------+--------------------------------------------+ | Facility | Return result = lcs-LocationNotification | | | | | | LocationNotificationRes | | | | | | verificationResponse -> permissionGranted | +-------------------------+--------------------------------------------+
MEASUREMENT CONTROL (Step 7):
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Setup Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE assisted \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request TRUE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_ Periodical reporting
criteria \- Amount of reporting 1 \- Reporting interval 64000 \- UE pos OTDOA
assistance data for UE-assisted Not present \- UE pos OTDOA assistance data
for UE-based Not present \- UE positioning GPS assistance data Set as
specified for \"Inadequate assistance data for UE-assisted A-GPS\" in 4.3.2
**Physical Channel Information Elements**  
DPCH compressed mode status info Not present
* * *
MEASUREMENT REPORT (Step 8):
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_  
\- UE positioning measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info Not present \- UE positioning GPS measured results Not
present \- UE positioning error  
\- Error reason Assistance Data Missing \- GPS additional assistance data
request  
\- Almanac Present, if requested by UE \- UTC model Present, if requested by
UE \- Ionospheric model Present, if requested by UE \- Navigation model
Present, if requested by UE \- DGPS corrections Present, if requested by UE \-
Reference location Present, if requested by UE \- Reference time Present, if
requested by UE \- Acquisition assistance Present, if requested by UE \- Real-
time integrity Present, if requested by UE \- Navigation model additional data
Present, if requested by UE Measured Results on RACH Not present Additional
Measured Results Not present Event Results Not present
* * *
MEASUREMENT CONTROL (Step 9):
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Modify Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE assisted \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request FALSE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_ Periodical reporting
criteria \- Amount of reporting 1 \- Reporting interval 64000 \- UE pos OTDOA
assistance data for UE-assisted Not present \- UE pos OTDOA assistance data
for UE-based Not present \- UE positioning GPS assistance data Set as
specified in 4.3.5 **Physical Channel Information Elements**  
DPCH compressed mode status info Not present
* * *
MEASUREMENT REPORT (Step 10)
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_  
\- UE positioning measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info Not present \- UE positioning GPS measured results
Present \- UE positioning error Not present Measured Results on RACH Not
present Additional Measured Results Not present Event Results Not present
* * *
6.1.3.5.5 Test requirements
After step 5 the UE shall send a RELEASE COMPLETE message.
After step 7 the UE shall respond with a MEASUREMENT REPORT message containing
the IE \"UE positioning error\", with \"Error reason\" set to \"Assistance
data missing\".
After step 9 the UE shall send a MEASUREMENT REPORT message containing the IE
\"UE positioning GPS measured results\".
#### 6.1.3.6 LCS Mobile terminated location request/ UE-Based GPS/ Privacy
Verification/ Location Allowed if No Response
6.1.3.6.1 Definition
This test case applies to all UEs supporting UE-Based GPS Location Service
capabilities.
6.1.3.6.2 Conformance requirements
> 1) The network invokes a location notification procedure by sending a
> REGISTER message containing a LCS-LocationNotification invoke component to
> the UE. This may be sent either to request verification for MT-LR or to
> notify about already authorized MT-LR.
>
> 2) In case of privacy verification the MS shall respond to the request by
> sending a RELEASE COMPLETE message containing the mobile subscriber\'s
> response in a return result component.
>
> 3) If the timer expires in the network before any response from the MS (e.g.
> due to no response from the user), the network shall interpret this by
> applying the default treatment defined in GSM 03.71 for GSM and TS 23.171
> for UMTS (i.e. disallow location if barred by subscription and allow
> location if allowed by subscription).
>
> 4) if the IE \"Measurement command\" has the value \"setup\":
>
> 2> store this measurement in the variable MEASUREMENT_IDENTITY according to
> the IE \"measurement identity\", first releasing any previously stored
> measurement with that identity if that exists;
...
> 2> for any other measurement type:
>
> 3> if the measurement is valid in the current RRC state of the UE:
>
> 4> begin measurements according to the stored control information for this
> measurement identity.
>
> 5) if the IE \"Measurement command\" has the value \"modify\":
>
> 2> for all IEs present in the MEASUREMENT CONTROL message:
>
> 3> if a measurement was stored in the variable MEASUREMENT_IDENTITY
> associated to the identity by the IE \"measurement identity\":
>
> 4> if measurement type is set to \"UE positioning measurement\" and the IE
> \"UE positioning GPS assistance data\" is present, for any of the optional
> IEs \"UE positioning GPS reference time\", \"UE positioning GPS reference UE
> position\", \"UE positioning GPS DGPS corrections\", \"UE positioning GPS
> ionospheric model\", \"UE positioning GPS UTC model\", \"UE positioning GPS
> acquisition assistance\", \"UE positioning GPS real-time integrity\" that
> are present in the MEASUREMENT CONTROL message:
>
> 5> replace all instances of the IEs listed above (and all their children)
> stored in variable MEASUREMENT_IDENTITY associated to the identity indicated
> by the IE \"measurement identity\" with the IEs received in the MEASUREMENT
> CONTROL message;
>
> 5> leave all other stored information elements unchanged in the variable
> MEASUREMENT_IDENTITY.
>
> 6) If the IE \"UE positioning GPS Navigation Model\" is included, for each
> satellite, the UE shall:
>
> 1> use IE \"Satellite Status\" to determine if an update of IE \"UE
> positioning GPS Ephemeris and Clock Correction parameters\" has been
> provided for the satellite indicated by the IE \"SatID\";
>
> 1> if an update has been provided for this satellite:
>
> 2> act as specified in subclause 8.6.7.19.3.4 of TS 25.331.
>
> 7) If the IE \"UE positioning GPS Ephemeris and Clock Correction
> parameters\" is included, for each satellite, the UE shall:
>
> 1> update the variable UE_POSITIONING_GPS_DATA as follows:
>
> 2> store this IE at the position indicated by the IE \"Sat ID\" in the IE
> \"UE positioning GPS Navigation Model\" in the variable
> UE_POSITIONING_GPS_DATA, possibly overwriting any existing information in
> this position.
>
> 1> act on these GPS ephemeris and clock correction parameters in a manner
> similar to that specified in ICD-GPS-200.
>
> 8) If the IE \"UE positioning GPS reference time\" is included, the UE
> shall:
>
> 1> store the IE \"GPS Week\" in \"UE positioning GPS reference time\" in
> variable UE_POSITIONING_GPS_DATA and use it as the current GPS week;
>
> 1> store the IE \"GPS TOW msec\" in the IE \"UE positioning GPS reference
> time\" in variable UE_POSITIONING_GPS_DATA and use it as an estimate of the
> GPS Time-of-Week at the time of reception of the complete message containing
> the IE \"GPS TOW msec\";
>
> NOTE: The UE does not need to apply any compensation on the GPS Time-of-
> Week.
>
> 9) If the IE \"UE positioning GPS reference UE position\" is included, the
> UE shall:
>
> 1> store this IE in the IE \"UE positioning GPS reference UE position\" in
> variable UE_POSITIONING_GPS_DATA; and
>
> 1> use it as a priori knowledge of the approximate location of the UE.
>
> 10) The UE shall when a measurement report is triggered:
>
> 2> if the UE has been able to calculate a position after performing
> measurements on the cells included in the variable
> UE_POSITIONING_OTDOA_DATA_UE_BASED in case of OTDOA or on the list of
> satellites included in the variable UE_POSITIONING_GPS_DATA in case of GPS
> positioning:
>
> 3> include IE \"UE positioning Position Estimate Info\" in the MEASUREMENT
> REPORT and set the contents of the IE as follows:
>
> 4> if the UE does not support the capability to perform the UE GPS timing of
> cell frames measurement; or
>
> 4> if the IE \"GPS timing of Cell wanted\" is set to FALSE:
>
> 5> include the IE \"GPS TOW msec\".
>
> 4> if IE \"Vertical Accuracy\" has been included in IE \"UE positioning
> reporting quantity\":
>
> 5> if the IE \"Vertical Accuracy\" has been assigned to a value unequal to
> \"0\":
>
> 6> if the UE has been able to calculate a 3-dimensional position:
>
> 7> include IE \"Ellipsoid point with altitude and uncertainty ellipsoid\" as
> the position estimate.
>
> 6> if the UE has not been able to calculate a 3-dimensional position:
>
> 7> act as if IE \"Vertical Accuracy\" has not been included in IE \"UE
> positioning reporting quantity\".
>
> 4> if IE \"Vertical Accuracy\" has not been included in IE \"UE positioning
> reporting quantity\":
>
> 5> if IE \"Horizontal Accuracy\" in IE \"UE positioning reporting quantity\"
> has been assigned to value \"0\":
>
> 6> may include IE \"Ellipsoid point\".
>
> 5> if IE \"Horizontal Accuracy\" in IE \"UE positioning reporting quantity\"
> has been assigned to a value unequal to 0:
>
> 6> include either IE \"Ellipsoid point with uncertainty circle\" or IE
> \"Ellipsoid point with uncertainty ellipse\" or IE \"Ellipsoid point with
> altitude and uncertainty ellipsoid\" as the position estimate.
##### References {#references-12 .H6}
> \- Conformance requirement 1, 2 and 3: TS 24.030, clause 4.1.1.
>
> \- Conformance requirements 4 and 5: TS 25.331, subclause 8.4.1.3
>
> \- Conformance requirement 6: TS 25.331, clause 8.6.7.19.3.3a.
>
> \- Conformance requirement 7: TS 25.331, clause 8.6.7.19.3.4.
>
> \- Conformance requirement 8: TS 25.331, clause 8.6.7.19.3.7.
>
> \- Conformance requirement 9: TS 25.331, clause 8.6.7.19.3.8.
>
> \- Conformance requirement 10: TS 25.331, clause 8.6.7.19.1b.
6.1.3.6.3 Test Purpose
To verify that when the UE receives a REGISTER message, containing a LCS
Location Notification Invoke component set to notifyAndVerify-
LocationAllowedIfNoResponse, the UE notifies the user of the request and
indicates that the default response is location allowed if no response and
providing the opportunity to accept or deny the request and sends a RELEASE
COMPLETE message containing a LocationNotification return result with
verificationResponse set to permissionDenied or permissionGranted as
appropriate.
6.1.3.6.4 Method of Test
Initial Conditions
System Simulator (SS):
> \- 1 cell, default parameters
>
> _\- Satellite signals:_ As specified in 4.2
##### UE: {#ue-4 .H6}
> \- State \"CS-CELL DCH Initial (State 6-1)\" as specified in clause 7.4.1 of
> TS 34.108.
##### Related PICS/PIXIT Statements {#related-picspixit-statements-16 .H6}
> \- UE Based Network Assisted GPS
>
> \- px_UeLcsNotification: value for UE LCS Notification timeout timer
>
> \- UE supporting Mobile Terminated Location Request
##### Test Procedure {#test-procedure-16 .H6}
The SS initiates authentication and ciphering and sends a REGISTER message
containing a Facility IE containing a LCS Location Notification Invoke message
set to notifyAndVerify-LocationAllowedIfNoResponse.
The LCS Client Name contained in the USSD text string of the lcs-
LocationNotification should be displayed with the option to accept or deny the
request and an indication that location will be allowed if no user response is
received.
The user accepts the location request. The UE responds with a RELEASE COMPLETE
message containing a LocationNotification return result with
verificationResponse set to permissionGranted.
The SS orders an A-GPS positioning measurement using MEASUREMENT CONTROL
messages.
The UE sends a MEASUREMENT REPORT message including a location estimate.
The SS sends a REGISTER message containing a Facility IE containing a LCS
Location Notification Invoke message set to notifyAndVerify-
LocationAllowedIfNoResponse.
The user denies the location request. The UE responds with a RELEASE COMPLETE
message containing a LocationNotification return result with
verificationResponse set to permissionDenied.
The SS sends a REGISTER message containing a Facility IE containing a LCS
Location Notification Invoke message set to notifyAndVerify-
LocationAllowedIfNoResponse.
The user ignores the location request by taking no action.
The SS orders an A-GPS positioning measurement using MEASUREMENT CONTROL
messages.
The UE then sends a MEASUREMENT REPORT message including a location estimate.
##### Expected Sequence {#expected-sequence-16 .H6}
+----------+---------------+-----------------+-----------------+---+ | **Step** | **Direction** | **Message** | **Comments** | | +----------+---------------+-----------------+-----------------+---+ | | **UE** | **SS** | | | +----------+---------------+-----------------+-----------------+---+ | 1 | \ | AUTHENTICATION | | | | | | RESPONSE | | | +----------+---------------+-----------------+-----------------+---+ | 3 | SS | | SS starts | | | | | | security | | | | | | procedure | | +----------+---------------+-----------------+-----------------+---+ | 4 | \ | RELEASE | Containing a | | | | | COMPLETE | Locat | | | | | | ionNotification | | | | | | return result | | | | | | with | | | | | | verif | | | | | | icationResponse | | | | | | set to | | | | | | pe | | | | | | rmissionGranted | | +----------+---------------+-----------------+-----------------+---+ | 9 | \ | MEASUREMENT | | | | | | REPORT | | | +----------+---------------+-----------------+-----------------+---+ | 12 | \ | RELEASE | Containing a | | | | | COMPLETE | Locat | | | | | | ionNotification | | | | | | return result | | | | | | with | | | | | | verif | | | | | | icationResponse | | | | | | set to | | | | | | p | | | | | | ermissionDenied | | +----------+---------------+-----------------+-----------------+---+ | 17 | \ | MEASUREMENT | | | | | | REPORT | | | +----------+---------------+-----------------+-----------------+---+ | 26 | SS | | SS releases the | | | | | | connection and | | | | | | the test case | | | | | | ends | | +----------+---------------+-----------------+-----------------+---+
##### Specific Message Contents {#specific-message-contents-16 .H6}
REGISTER (Step 4)
+-------------------------+-------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+-------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+-------------------------------------------+ | Transaction identifier | | +-------------------------+-------------------------------------------+ | Message type | REGISTER (0011 1011) | +-------------------------+-------------------------------------------+ | Facility | Invoke = LCS-LocationNotification | | | | | | LocationNotificationArg | | | | | | notificationType -> | | | no | | | tifyAndVerify-LocationAllowedIfNoResponse | | | | | | locationType -> current Location | | | | | | lcsClientExternalID -> externalAddress | | | | | | lcsClientName ->dataCodingScheme\ | | | nameString | +-------------------------+-------------------------------------------+
RELEASE COMPLETE (Step 8)
+-------------------------+--------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+--------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+--------------------------------------------+ | Transaction identifier | | +-------------------------+--------------------------------------------+ | Message type | RELEASE COMPLETE (xx10 1010) | +-------------------------+--------------------------------------------+ | Facility | Return result = LCS-LocationNotification | | | | | | LocationNotificationRes | | | | | | verificationResponse -> permissionGranted | +-------------------------+--------------------------------------------+
MEASUREMENT CONTROL (Step 9):
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Setup Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE based \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request FALSE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_  
\- No reporting  
\- UE pos OTDOA assistance data for UE-assisted Not present \- UE pos OTDOA
assistance data for UE-based Not present \- UE positioning GPS assistance data
Set as specified for the first MEASUREMENT CONTROL message for \"Adequate
assistance data for UE-based A-GPS\" in 4.3.1 **Physical Channel Information
Elements**  
DPCH compressed mode status info Not present
* * *
MEASUREMENT CONTROL (Step 10):
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Modify Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE based \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request FALSE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_ Periodical reporting
criteria \- Amount of reporting 1 \- Reporting interval 64000 \- UE pos OTDOA
assistance data for UE-assisted Not present \- UE pos OTDOA assistance data
for UE-based Not present \- UE positioning GPS assistance data Set as
specified for the second MEASUREMENT CONTROL message for \"Adequate assistance
data for UE-based A-GPS\" in 4.3.1 **Physical Channel Information Elements**  
DPCH compressed mode status info Not present
* * *
MEASUREMENT REPORT (Step 11)
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_  
\- UE positioning measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info  
\- CHOICE _Reference time_  
\- GPS reference time only  
\- GPS TOW msec Not checked \- CHOICE _Position estimate_ One of 'Ellipsoid
point with uncertainty Circle' or 'Ellipsoid point with uncertainty Ellipse'
or 'Ellipsoid point with altitude and uncertainty Ellipsoid' \- UE positioning
GPS measured results Not present \- UE positioning error Not present Measured
Results on RACH Not present Additional Measured Results Not present Event
Results Not present
* * *
REGISTER (Step 12)
+-------------------------+-------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+-------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+-------------------------------------------+ | Transaction identifier | | +-------------------------+-------------------------------------------+ | Message type | REGISTER (0011 1011) | +-------------------------+-------------------------------------------+ | Facility | Invoke = LCS-LocationNotification | | | | | | LocationNotificationArg | | | | | | notificationType -> | | | no | | | tifyAndVerify-LocationAllowedIfNoResponse | | | | | | locationType -> current Location | | | | | | lcsClientExternalID -> externalAddress | | | | | | lcsClientName ->dataCodingScheme\ | | | nameString | +-------------------------+-------------------------------------------+
RELEASE COMPLETE (Step 16)
+-------------------------+-------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+-------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+-------------------------------------------+ | Transaction identifier | | +-------------------------+-------------------------------------------+ | Message type | RELEASE COMPLETE (xx10 1010) | +-------------------------+-------------------------------------------+ | Facility | Return result = LCS-LocationNotification | | | | | | LocationNotificationRes | | | | | | verificationResponse -> permissionDenied | +-------------------------+-------------------------------------------+
REGISTER (Step 17)
+-------------------------+-------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+-------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+-------------------------------------------+ | Transaction identifier | | +-------------------------+-------------------------------------------+ | Message type | REGISTER (0011 1011) | +-------------------------+-------------------------------------------+ | Facility | Invoke = LCS-LocationNotification | | | | | | LocationNotificationArg | | | | | | notificationType -> | | | no | | | tifyAndVerify-LocationAllowedIfNoResponse | | | | | | locationType -> current Location | | | | | | lcsClientExternalID -> externalAddress | | | | | | lcsClientName ->dataCodingScheme\ | | | nameString | +-------------------------+-------------------------------------------+
RELEASE COMPLETE (Step 22)
* * *
**Information element** **Value/remark** Protocol Discriminator Call
Independent SS message (1011) Transaction identifier  
Message type RELEASE COMPLETE (0010 1010)
* * *
MEASUREMENT CONTROL (Step 23):
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Setup Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE based \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request FALSE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_  
\- No reporting  
\- UE pos OTDOA assistance data for UE-assisted Not present \- UE pos OTDOA
assistance data for UE-based Not present \- UE positioning GPS assistance data
Set as specified for the first MEASUREMENT CONTROL message for \"Adequate
assistance data for UE-based A-GPS\" in 4.3.1 **Physical Channel Information
Elements**  
DPCH compressed mode status info Not present
* * *
MEASUREMENT CONTROL (Step 24):
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Modify Measurement Reporting Mode
Not present Additional Measurements List Not present CHOICE _Measurement type_  
\- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE based \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy Set according to 4.2 (unequal to 0) \- Vertical accuracy
Set according to 4.2 (unequal to 0) \- GPS timing of cell wanted FALSE \-
Multiple sets FALSE \- Additional assistance data request FALSE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_ Periodical reporting
criteria \- Amount of reporting 1 \- Reporting interval 64000 \- UE pos OTDOA
assistance data for UE-assisted Not present \- UE pos OTDOA assistance data
for UE-based Not present \- UE positioning GPS assistance data Set as
specified for the second MEASUREMENT CONTROL message for \"Adequate assistance
data for UE-based A-GPS\" in 4.3.1 **Physical Channel Information Elements**  
DPCH compressed mode status info Not present
* * *
MEASUREMENT REPORT (Step 25)
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_  
\- UE positioning measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info  
\- CHOICE _Reference time_  
\- GPS reference time only  
\- GPS TOW msec Not checked \- CHOICE _Position estimate_ One of 'Ellipsoid
point with uncertainty Circle' or 'Ellipsoid point with uncertainty Ellipse'
or 'Ellipsoid point with altitude and uncertainty Ellipsoid' \- UE positioning
GPS measured results Not present \- UE positioning error Not present Measured
Results on RACH Not present Additional Measured Results Not present Event
Results Not present
* * *
6.1.3.6.5 Test requirements
After step 7 the UE shall send a RELEASE COMPLETE message with
verificationResponse set to permissionGranted.
After step 10 the UE shall respond with a MEASUREMENT REPORT message
containing a UE position estimate.
After step 15 the UE shall send a RELEASE COMPLETE message with
verificationResponse set to permissionDenied.
After step 24 the UE shall respond with a MEASUREMENT REPORT message
containing a UE position estimate.
#### 6.1.3.7 LCS Mobile terminated location request/ UE-Based GPS/ Privacy
Verification/ Location Not Allowed if No Response
6.1.3.7.1 Definition
This test case applies to all UEs supporting UE-Based GPS Location Service
capabilities.
6.1.3.7.2 Conformance requirements
> 1) The network invokes a location notification procedure by sending a
> REGISTER message containing a LCS-LocationNotification invoke component to
> the UE. This may be sent either to request verification for MT-LR or to
> notify about already authorized MT-LR.
>
> 2) In case of privacy verification the MS shall respond to the request by
> sending a RELEASE COMPLETE message containing the mobile subscriber\'s
> response in a return result component.
>
> 3) If the timer expires in the network before any response from the MS (e.g.
> due to no response from the user), the network shall interpret this by
> applying the default treatment defined in GSM 03.71 for GSM and TS 23.171
> for UMTS (i.e. disallow location if barred by subscription and allow
> location if allowed by subscription).
>
> 4) if the IE \"Measurement command\" has the value \"setup\":
>
> 2> store this measurement in the variable MEASUREMENT_IDENTITY according to
> the IE \"measurement identity\", first releasing any previously stored
> measurement with that identity if that exists;
...
> 2> for any other measurement type:
>
> 3> if the measurement is valid in the current RRC state of the UE:
>
> 4> begin measurements according to the stored control information for this
> measurement identity.
>
> 5) if the IE \"Measurement command\" has the value \"modify\":
>
> 2> for all IEs present in the MEASUREMENT CONTROL message:
>
> 3> if a measurement was stored in the variable MEASUREMENT_IDENTITY
> associated to the identity by the IE \"measurement identity\":
>
> 4> if measurement type is set to \"UE positioning measurement\" and the IE
> \"UE positioning GPS assistance data\" is present, for any of the optional
> IEs \"UE positioning GPS reference time\", \"UE positioning GPS reference UE
> position\", \"UE positioning GPS DGPS corrections\", \"UE positioning GPS
> ionospheric model\", \"UE positioning GPS UTC model\", \"UE positioning GPS
> acquisition assistance\", \"UE positioning GPS real-time integrity\" that
> are present in the MEASUREMENT CONTROL message:
>
> 5> replace all instances of the IEs listed above (and all their children)
> stored in variable MEASUREMENT_IDENTITY associated to the identity indicated
> by the IE \"measurement identity\" with the IEs received in the MEASUREMENT
> CONTROL message;
>
> 5> leave all other stored information elements unchanged in the variable
> MEASUREMENT_IDENTITY.
>
> 6) If the IE \"UE positioning GPS Navigation Model\" is included, for each
> satellite, the UE shall:
>
> 1> use IE \"Satellite Status\" to determine if an update of IE \"UE
> positioning GPS Ephemeris and Clock Correction parameters\" has been
> provided for the satellite indicated by the IE \"SatID\";
>
> 1> if an update has been provided for this satellite:
>
> 2> act as specified in subclause 8.6.7.19.3.4 of TS 25.331.
>
> 7) If the IE \"UE positioning GPS Ephemeris and Clock Correction
> parameters\" is included, for each satellite, the UE shall:
>
> 1> update the variable UE_POSITIONING_GPS_DATA as follows:
>
> 2> store this IE at the position indicated by the IE \"Sat ID\" in the IE
> \"UE positioning GPS Navigation Model\" in the variable
> UE_POSITIONING_GPS_DATA, possibly overwriting any existing information in
> this position.
>
> 1> act on these GPS ephemeris and clock correction parameters in a manner
> similar to that specified in ICD-GPS-200.
>
> 8) If the IE \"UE positioning GPS reference time\" is included, the UE
> shall:
>
> 1> store the IE \"GPS Week\" in \"UE positioning GPS reference time\" in
> variable UE_POSITIONING_GPS_DATA and use it as the current GPS week;
>
> 1> store the IE \"GPS TOW msec\" in the IE \"UE positioning GPS reference
> time\" in variable UE_POSITIONING_GPS_DATA and use it as an estimate of the
> GPS Time-of-Week at the time of reception of the complete message containing
> the IE \"GPS TOW msec\";
>
> NOTE: The UE does not need to apply any compensation on the GPS Time-of-
> Week.
>
> 9) If the IE \"UE positioning GPS reference UE position\" is included, the
> UE shall:
>
> 1> store this IE in the IE \"UE positioning GPS reference UE position\" in
> variable UE_POSITIONING_GPS_DATA; and
>
> 1> use it as a priori knowledge of the approximate location of the UE.
>
> 10) The UE shall when a measurement report is triggered:
>
> 2> if the UE has been able to calculate a position after performing
> measurements on the cells included in the variable
> UE_POSITIONING_OTDOA_DATA_UE_BASED in case of OTDOA or on the list of
> satellites included in the variable UE_POSITIONING_GPS_DATA in case of GPS
> positioning:
>
> 3> include IE \"UE positioning Position Estimate Info\" in the MEASUREMENT
> REPORT and set the contents of the IE as follows:
>
> 4> if the UE does not support the capability to perform the UE GPS timing of
> cell frames measurement; or
>
> 4> if the IE \"GPS timing of Cell wanted\" is set to FALSE:
>
> 5> include the IE \"GPS TOW msec\".
>
> 4> if IE \"Vertical Accuracy\" has been included in IE \"UE positioning
> reporting quantity\":
>
> 5> if the IE \"Vertical Accuracy\" has been assigned to a value unequal to
> \"0\":
>
> 6> if the UE has been able to calculate a 3-dimensional position:
>
> 7> include IE \"Ellipsoid point with altitude and uncertainty ellipsoid\" as
> the position estimate.
>
> 6> if the UE has not been able to calculate a 3-dimensional position:
>
> 7> act as if IE \"Vertical Accuracy\" has not been included in IE \"UE
> positioning reporting quantity\".
>
> 4> if IE \"Vertical Accuracy\" has not been included in IE \"UE positioning
> reporting quantity\":
>
> 5> if IE \"Horizontal Accuracy\" in IE \"UE positioning reporting quantity\"
> has been assigned to value \"0\":
>
> 6> may include IE \"Ellipsoid point\".
>
> 5> if IE \"Horizontal Accuracy\" in IE \"UE positioning reporting quantity\"
> has been assigned to a value unequal to 0:
>
> 6> include either IE \"Ellipsoid point with uncertainty circle\" or IE
> \"Ellipsoid point with uncertainty ellipse\" or IE \"Ellipsoid point with
> altitude and uncertainty ellipsoid\" as the position estimate.
##### References {#references-13 .H6}
> \- Conformance requirement 1, 2 and 3: TS 24.030, clause 4.1.1.
>
> \- Conformance requirements 4 and 5: TS 25.331, clause 8.4.1.3.
>
> \- Conformance requirement 6: TS 25.331, clause 8.6.7.19.3.3a.
>
> \- Conformance requirement 7: TS 25.331, clause 8.6.7.19.3.4.
>
> \- Conformance requirement 8: TS 25.331, clause 8.6.7.19.3.7.
>
> \- Conformance requirement 9: TS 25.331, clause 8.6.7.19.3.8.
>
> \- Conformance requirement 10: TS 25.331, clause 8.6.7.19.1b.
6.1.3.7.3 Test Purpose
To verify that when the UE receives a REGISTER message, containing a LCS
Location Notification Invoke component set to notifyAndVerify-
LocationNotAllowedIfNoResponse, the UE notifies the user of the request and
indicates that the default response is location not allowed if no response and
providing the opportunity to accept or deny the request and sends a RELEASE
COMPLETE message containing a LocationNotification return result with
verificationResponse set to permissionDenied or permissionGranted as
appropriate.
6.1.3.7.4 Method of Test
Initial Conditions
System Simulator (SS):
> \- 1 cell, default parameters
>
> _\- Satellite signals:_ As specified in 4.2
##### UE: {#ue-5 .H6}
> \- State \"CS-CELL DCH Initial (State 6-1)\" as specified in clause 7.4.1 of
> TS 34.108.
##### Related PICS/PIXIT Statements {#related-picspixit-statements-17 .H6}
> \- UE Based Network Assisted GPS
>
> \- px_UeLcsNotification: value for UE LCS Notification timeout timer
>
> \- UE supporting Mobile Terminated Location Request
##### Test Procedure {#test-procedure-17 .H6}
The SS initiates authentication and ciphering and sends a REGISTER message
containing a Facility IE containing a LCS Location Notification Invoke message
set to notifyAndVerify-LocationNotAllowedIfNoResponse.
The LCS Client Name contained in the USSD text string of the lcs-
LocationNotification should be displayed with the option to accept or deny the
request and an indication that location will be not allowed if no user
response is received.
The user accepts the location request. The UE responds with a RELEASE COMPLETE
message containing a LocationNotification return result with
verificationResponse set to permissionGranted.
The SS orders an A-GPS positioning measurement using MEASUREMENT CONTROL
messages.
The UE sends a MEASUREMENT REPORT message including a location estimate.
The SS sends a REGISTER message containing a Facility IE containing a LCS
Location Notification Invoke message set to notifyAndVerify-
LocationNotAllowedIfNoResponse.
The user denies the location request. The UE responds with a RELEASE COMPLETE
message containing a LocationNotification return result with
verificationResponse set to permissionDenied.
The SS sends a REGISTER message containing a Facility IE containing a LCS
Location Notification Invoke message set to notifyAndVerify-
LocationNotAllowedIfNoResponse.
The user ignores the location request by taking no action. If the timer
expires in the SS before any response from the UE is received, the SS
interprets this by applying the default treatment LocationNotAllowed.
##### Expected Sequence {#expected-sequence-17 .H6}
+----------+---------------+-----------------+-----------------+---+ | **Step** | **Direction** | **Message** | **Comments** | | +----------+---------------+-----------------+-----------------+---+ | | **UE** | **SS** | | | +----------+---------------+-----------------+-----------------+---+ | 1 | \ | AUTHENTICATION | | | | | | RESPONSE | | | +----------+---------------+-----------------+-----------------+---+ | 3 | SS | | SS starts | | | | | | security | | | | | | procedure | | +----------+---------------+-----------------+-----------------+---+ | 4 | \ | RELEASE | Containing a | | | | | COMPLETE | Locat | | | | | | ionNotification | | | | | | return result | | | | | | with | | | | | | verif | | | | | | icationResponse | | | | | | set to | | | | | | pe | | | | | | rmissionGranted | | +----------+---------------+-----------------+-----------------+---+ | 9 | \ | MEASUREMENT | | | | | | REPORT | | | +----------+---------------+-----------------+-----------------+---+ | 12 | \ | RELEASE | Containing a | | | | | COMPLETE | Locat | | | | | | ionNotification | | | | | | return result | | | | | | with | | | | | | verif | | | | | | icationResponse | | | | | | set to | | | | | | p | | | | | | ermissionDenied | | +----------+---------------+-----------------+-----------------+---+ | 17 | \ | | | notif | | | yAndVerify-LocationNotAllowedIfNoResponse | | | | | | locationType -> current Location | | | | | | lcsClientExternalID -> externalAddress | | | | | | lcsClientName ->dataCodingScheme\ | | | nameString | +-------------------------+-------------------------------------------+
RELEASE COMPLETE (Step 8)
+-------------------------+--------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+--------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+--------------------------------------------+ | Transaction identifier | | +-------------------------+--------------------------------------------+ | Message type | RELEASE COMPLETE (xx10 1010) | +-------------------------+--------------------------------------------+ | Facility | Return result = LCS-LocationNotification | | | | | | LocationNotificationRes | | | | | | verificationResponse -> permissionGranted | +-------------------------+--------------------------------------------+
MEASUREMENT CONTROL (Step 9):
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Setup Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE based \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request FALSE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_  
\- No reporting  
\- UE pos OTDOA assistance data for UE-assisted Not present \- UE pos OTDOA
assistance data for UE-based Not present \- UE positioning GPS assistance data
Set as specified for the first MEASUREMENT CONTROL message for \"Adequate
assistance data for UE-based A-GPS\" in 4.3.1 **Physical Channel Information
Elements**  
DPCH compressed mode status info Not present
* * *
MEASUREMENT CONTROL (Step 10):
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Modify Measurement Reporting Mode
Not present Additional Measurements List Not present CHOICE _Measurement type_  
\- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE based \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request FALSE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_ Periodical reporting
criteria \- Amount of reporting 1 \- Reporting interval 64000 \- UE pos OTDOA
assistance data for UE-assisted Not present \- UE pos OTDOA assistance data
for UE-based Not present \- UE positioning GPS assistance data Set as
specified for the second MEASUREMENT CONTROL message for \"Adequate assistance
data for UE-based A-GPS\" in 4.3.1 **Physical Channel Information Elements**  
DPCH compressed mode status info Not present
* * *
MEASUREMENT REPORT (Step 11)
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_  
\- UE positioning measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info  
\- CHOICE _Reference time_  
\- GPS reference time only  
\- GPS TOW msec Not checked \- CHOICE _Position estimate_ One of 'Ellipsoid
point with uncertainty Circle' or 'Ellipsoid point with uncertainty Ellipse'
or 'Ellipsoid point with altitude and uncertainty Ellipsoid' \- UE positioning
GPS measured results Not present \- UE positioning error Not present Measured
Results on RACH Not present Additional Measured Results Not present Event
Results Not present
* * *
REGISTER (Step 12)
+-------------------------+-------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+-------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+-------------------------------------------+ | Transaction identifier | | +-------------------------+-------------------------------------------+ | Message type | REGISTER (0011 1011) | +-------------------------+-------------------------------------------+ | Facility | Invoke = LCS-LocationNotification | | | | | | LocationNotificationArg | | | | | | notificationType -> | | | notif | | | yAndVerify-LocationNotAllowedIfNoResponse | | | | | | locationType -> current Location | | | | | | lcsClientExternalID -> externalAddress | | | | | | lcsClientName ->dataCodingScheme\ | | | nameString | +-------------------------+-------------------------------------------+
RELEASE COMPLETE (Step 16)
+-------------------------+-------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+-------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+-------------------------------------------+ | Transaction identifier | | +-------------------------+-------------------------------------------+ | Message type | RELEASE COMPLETE (xx10 1010) | +-------------------------+-------------------------------------------+ | Facility | Return result = LCS-LocationNotification | | | | | | LocationNotificationRes | | | | | | verificationResponse -> permissionDenied | +-------------------------+-------------------------------------------+
REGISTER (Step 17)
+-------------------------+-------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+-------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+-------------------------------------------+ | Transaction identifier | | +-------------------------+-------------------------------------------+ | Message type | REGISTER (0011 1011) | +-------------------------+-------------------------------------------+ | Facility | Invoke = LCS-LocationNotification | | | | | | LocationNotificationArg | | | | | | notificationType -> | | | notif | | | yAndVerify-LocationNotAllowedIfNoResponse | | | | | | locationType -> current Location | | | | | | lcsClientExternalID -> externalAddress | | | | | | lcsClientName ->dataCodingScheme\ | | | nameString | +-------------------------+-------------------------------------------+
RELEASE COMPLETE (Step 22)
* * *
**Information element** **Value/remark** Protocol Discriminator Call
Independent SS message (1011) Transaction identifier  
Message type RELEASE COMPLETE (0010 1010)
* * *
6.1.3.7.5 Test requirements
After step 7 the UE shall send a RELEASE COMPLETE message with
verificationResponse set to permissionGranted.
After step 10 the UE shall respond with a MEASUREMENT REPORT message
containing a UE position estimate.
After step 15 the UE shall send a RELEASE COMPLETE message with
verificationResponse set to permissionDenied.
During step 21 the UE shall not send any RELEASE COMPLETE message.
#### 6.1.3.8 LCS Mobile terminated location request/ UE-Assisted GPS/ Privacy
Verification/ Location Allowed if No Response
6.1.3.8.1 Definition
This test case applies to all UEs supporting UE-Assisted GPS Location Service
capabilities.
6.1.3.8.2 Conformance requirements
> 1) The network invokes a location notification procedure by sending a
> REGISTER message containing a LCS-LocationNotification invoke component to
> the UE. This may be sent either to request verification for MT-LR or to
> notify about already authorized MT-LR.
>
> 2) In case of privacy verification the MS shall respond to the request by
> sending a RELEASE COMPLETE message containing the mobile subscriber\'s
> response in a return result component.
>
> 3) If the timer expires in the network before any response from the MS (e.g.
> due to no response from the user), the network shall interpret this by
> applying the default treatment defined in GSM 03.71 for GSM and TS 23.171
> for UMTS (i.e. disallow location if barred by subscription and allow
> location if allowed by subscription).
>
> 4) if the IE \"Measurement command\" has the value \"setup\":
>
> 2> store this measurement in the variable MEASUREMENT_IDENTITY according to
> the IE \"measurement identity\", first releasing any previously stored
> measurement with that identity if that exists;
...
> 2> for any other measurement type:
>
> 3> if the measurement is valid in the current RRC state of the UE:
>
> 4> begin measurements according to the stored control information for this
> measurement identity.
>
> 5) The UE shall:
>
> 1> when a measurement report is triggered:
>
> 2> if the UE was able to perform measurements on at least one neighbour cell
> included in the variable UE_POSITIONING_OTDOA_DATA_UE_ASSISTED in case of
> OTDOA or one satellite included in the variable UE_POSITIONING_GPS_DATA in
> case of GPS positioning or one cell from the active set in case of CELL ID:
>
> 3> if the IE \"Vertical Accuracy\" is included:
>
> 4> interpret the presence of this IE to indicate that the UTRAN desires to
> compute a 3-dimensional position estimate.
>
> 3> if the IE \"Positioning Methods\" is set to \"GPS\":
>
> 4> include the IE \"UE positioning GPS measured results\" in the measurement
> report and set the contents of the IE as follows:
>
> 5> if the UE supports the capability to provide the GPS timing of the cell
> frames measurement:
>
> 6> if the IE \"GPS timing of Cell wanted\" is set to TRUE:
>
> 7> perform the UE GPS timing of cell frames measurement on the serving cell
> or on one cell of the active set.
>
> 7> include the IE \"Primary CPICH Info\" for FDD or the IE \"cell parameters
> id\" for TDD; and
>
> 7> include the IE \"Reference SFN\" and the IE \"UE GPS timing of cell
> frames\".
>
> 6> if the IE \"GPS timing of Cell wanted\" is set to FALSE:
>
> 7> include the IE \"GPS TOW msec\".
>
> 5> if the UE does not support the capability to provide the GPS timing of
> the cell:
>
> 6> include the IE \"GPS TOW msec\".
References
> \- Conformance requirement 1, 2 and 3: TS 24.030, clause 4.1.1.
>
> \- Conformance requirement 4: TS 25.331, clause 8.4.1.3.
>
> \- Conformance requirement 5: TS 25.331, clause 8.6.7.19.3.3b.
6.1.3.8.3 Test Purpose
To verify that when the UE receives a REGISTER message, containing a LCS
Location Notification Invoke component set to notifyAndVerify-
LocationAllowedIfNoResponse, the UE notifies the user of the request and
indicates that the default response is location allowed if no response and
providing the opportunity to accept or deny the request and sends a RELEASE
COMPLETE message containing a LocationNotification return result with
verificationResponse set to permissionDenied or permissionGranted as
appropriate.
6.1.3.8.4 Method of Test
Initial Conditions
System Simulator (SS):
> \- 1 cell, default parameters
>
> _\- Satellite signals:_ As specified in 4.2
##### UE: {#ue-6 .H6}
> \- State \"CS-CELL DCH Initial (State 6-1)\" as specified in clause 7.4.1 of
> TS 34.108.
##### Related PICS/PIXIT Statements {#related-picspixit-statements-18 .H6}
> \- UE Assisted Network Assisted GPS
>
> \- px_UeLcsNotification: value for UE LCS Notification timeout timer
>
> \- UE supporting Mobile Terminated Location Request
##### Test Procedure {#test-procedure-18 .H6}
The SS initiates authentication and ciphering and sends a REGISTER message
containing a Facility IE containing a LCS Location Notification Invoke message
set to notifyAndVerify-LocationAllowedIfNoResponse.
The LCS Client Name contained in the USSD text string of the lcs-
LocationNotification should be displayed with the option to accept or deny the
request and an indication that location will be allowed if no user response is
received.
The user accepts the location request. The UE responds with a RELEASE COMPLETE
message containing a LocationNotification return result with
verificationResponse set to permissionGranted.
The SS orders an A-GPS positioning measurement using a MEASUREMENT CONTROL
message, including assistance data as specified in subclause 4.3.3. The UE may
request additional assistance data by sending a MEASUREMENT REPORT message
containing a positioning error indication with the IE \"Error reason\" set to
\"Assistance Data Missing\". If the UE requests additional assistance data,
the SS provides the requested assistance data in one or more MEASUREMENT
CONTROL messages.
The UE sends a MEASUREMENT REPORT message including IE \"UE positioning GPS
measured results\".
The SS sends a REGISTER message containing a Facility IE containing a LCS
Location Notification Invoke message set to notifyAndVerify-
LocationAllowedIfNoResponse.
The SS sends a REGISTER message containing a Facility IE containing a LCS
Location Notification Invoke message set to notifyAndVerify-
LocationAllowedIfNoResponse.
The user denies the location request. The UE responds with a RELEASE COMPLETE
message containing a LocationNotification return result with
verificationResponse set to permissionDenied.
The SS sends a REGISTER message containing a Facility IE containing a LCS
Location Notification Invoke message set to notifyAndVerify-
LocationAllowedIfNoResponse.
The user ignores the location request by taking no action. If the timer
expires in the SS before any response from the UE is received, the SS
interprets this by applying the default treatment LocationAllowed.
The SS orders an A-GPS positioning measurement using a MEASUREMENT CONTROL
message, including assistance data as specified in subclause 4.3.3. The UE may
request additional assistance data by sending a MEASUREMENT REPORT message
containing a positioning error indication with the IE \"Error reason\" set to
\"Assistance Data Missing\". If the UE requests additional assistance data,
the SS provides the requested assistance data in one or more MEASUREMENT
CONTROL messages.
The UE then sends a MEASUREMENT REPORT message including IE \"UE positioning
GPS measured results\".
##### Expected Sequence {#expected-sequence-18 .H6}
+----------+---------------+-----------------+-----------------+---+ | **Step** | **Direction** | **Message** | **Comments** | | +----------+---------------+-----------------+-----------------+---+ | | **UE** | **SS** | | | +----------+---------------+-----------------+-----------------+---+ | 1 | \ | AUTHENTICATION | | | | | | RESPONSE | | | +----------+---------------+-----------------+-----------------+---+ | 3 | SS | | SS starts | | | | | | security | | | | | | procedure | | +----------+---------------+-----------------+-----------------+---+ | 4 | \ | RELEASE | Containing a | | | | | COMPLETE | Locat | | | | | | ionNotification | | | | | | return result | | | | | | with | | | | | | verif | | | | | | icationResponse | | | | | | set to | | | | | | pe | | | | | | rmissionGranted | | +----------+---------------+-----------------+-----------------+---+ | 9 | \ | MEASUREMENT | UE reports | | | | | REPORT | positioning | | | | | | measurement | | | | | | results (Option | | | | | | 1) or requests | | | | | | additional | | | | | | assistance data | | | | | | (Option 2). | | +----------+---------------+-----------------+-----------------+---+ | 10a | \ | MEASUREMENT | If UE requested | | | | | REPORT | additional | | | | | | assistance data | | | | | | in step 10, | | | | | | this message | | | | | | contains the IE | | | | | | \"UE | | | | | | positioning GPS | | | | | | measured | | | | | | results\". | | +----------+---------------+-----------------+-----------------+---+ | 11 | \ | RELEASE | Containing a | | | | | COMPLETE | Locat | | | | | | ionNotification | | | | | | return result | | | | | | with | | | | | | verif | | | | | | icationResponse | | | | | | set to | | | | | | p | | | | | | ermissionDenied | | +----------+---------------+-----------------+-----------------+---+ | 16 | \ | MEASUREMENT | UE reports | | | | | REPORT | positioning | | | | | | measurement | | | | | | results (Option | | | | | | 1) or requests | | | | | | additional | | | | | | assistance data | | | | | | (Option 2). | | +----------+---------------+-----------------+-----------------+---+ | 23a | \ | MEASUREMENT | If UE requested | | | | | REPORT | additional | | | | | | assistance data | | | | | | in step 23, | | | | | | this message | | | | | | contains the IE | | | | | | \"UE | | | | | | positioning GPS | | | | | | measured | | | | | | results\". | | +----------+---------------+-----------------+-----------------+---+ | 24 | SS | | SS releases the | | | | | | connection and | | | | | | the test case | | | | | | ends | | +----------+---------------+-----------------+-----------------+---+
##### Specific Message Contents {#specific-message-contents-18 .H6}
REGISTER (Step 4)
+-------------------------+-------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+-------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+-------------------------------------------+ | Transaction identifier | | +-------------------------+-------------------------------------------+ | Message type | REGISTER (0011 1011) | +-------------------------+-------------------------------------------+ | Facility | Invoke = LCS-LocationNotification | | | | | | LocationNotificationArg | | | | | | notificationType -> | | | no | | | tifyAndVerify-LocationAllowedIfNoResponse | | | | | | locationType -> current Location | | | | | | lcsClientExternalID -> externalAddress | | | | | | lcsClientName ->dataCodingScheme\ | | | nameString | +-------------------------+-------------------------------------------+
RELEASE COMPLETE (Step 8)
+-------------------------+--------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+--------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+--------------------------------------------+ | Transaction identifier | | +-------------------------+--------------------------------------------+ | Message type | RELEASE COMPLETE (xx10 1010) | +-------------------------+--------------------------------------------+ | Facility | Return result = LCS-LocationNotification | | | | | | LocationNotificationRes | | | | | | verificationResponse -> permissionGranted | +-------------------------+--------------------------------------------+
MEASUREMENT CONTROL (Step 9):
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Setup Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE assisted \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request TRUE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_ Periodical reporting
criteria \- Amount of reporting 1 \- Reporting interval 64000 \- UE pos OTDOA
assistance data for UE-assisted Not present \- UE pos OTDOA assistance data
for UE-based Not present \- UE positioning GPS assistance data Set as
specified for \"Adequate assistance data for UE-assisted A-GPS\" in 4.3.3
**Physical Channel Information Elements**  
DPCH compressed mode status info Not present
* * *
MEASUREMENT REPORT (Steps 10 (Option 1) or 10b (Option 2))
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_  
\- UE positioning measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info Not present \- UE positioning GPS measured results
Present \- UE positioning error Not present Measured Results on RACH Not
present Additional Measured Results Not present Event Results Not present
* * *
MEASUREMENT REPORT (Step 10 (Option 2)):
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_  
\- UE positioning measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info Not present \- UE positioning GPS measured results Not
present \- UE positioning error  
\- Error reason Assistance Data Missing \- GPS additional assistance data
request  
\- Almanac Not checked \- UTC model Not checked \- Ionospheric model Not
checked \- Navigation model Not checked \- DGPS corrections Not checked \-
Reference location Not checked \- Reference time Not checked \- Acquisition
assistance Not checked \- Real-time integrity Not checked \- Navigation model
additional data Not checked Measured Results on RACH Not present Additional
Measured Results Not present Event Results Not present
* * *
MEASUREMENT CONTROL (Step 10a (Option 2)):
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Modify Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE assisted \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request FALSE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_ Periodical reporting
criteria \- Amount of reporting 1 \- Reporting interval 64000 \- UE pos OTDOA
assistance data for UE-assisted Not present \- UE pos OTDOA assistance data
for UE-based Not present \- UE positioning GPS assistance data Set as
specified in 4.3.5 **Physical Channel Information Elements**  
DPCH compressed mode status info Not present
* * *
REGISTER (Step 11)
+-------------------------+-------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+-------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+-------------------------------------------+ | Transaction identifier | | +-------------------------+-------------------------------------------+ | Message type | REGISTER (0011 1011) | +-------------------------+-------------------------------------------+ | Facility | Invoke = LCS-LocationNotification | | | | | | LocationNotificationArg | | | | | | notificationType -> | | | no | | | tifyAndVerify-LocationAllowedIfNoResponse | | | | | | locationType -> current Location | | | | | | lcsClientExternalID -> externalAddress | | | | | | lcsClientName ->dataCodingScheme\ | | | nameString | +-------------------------+-------------------------------------------+
RELEASE COMPLETE (Step 15)
+-------------------------+-------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+-------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+-------------------------------------------+ | Transaction identifier | | +-------------------------+-------------------------------------------+ | Message type | RELEASE COMPLETE (xx10 1010) | +-------------------------+-------------------------------------------+ | Facility | Return result = LCS-LocationNotification | | | | | | LocationNotificationRes | | | | | | verificationResponse -> permissionDenied | +-------------------------+-------------------------------------------+
REGISTER (Step 16)
+-------------------------+-------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+-------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+-------------------------------------------+ | Transaction identifier | | +-------------------------+-------------------------------------------+ | Message type | REGISTER (0011 1011) | +-------------------------+-------------------------------------------+ | Facility | Invoke = LCS-LocationNotification | | | | | | LocationNotificationArg | | | | | | notificationType -> | | | no | | | tifyAndVerify-LocationAllowedIfNoResponse | | | | | | locationType -> current Location | | | | | | lcsClientExternalID -> externalAddress | | | | | | lcsClientName ->dataCodingScheme\ | | | nameString | +-------------------------+-------------------------------------------+
RELEASE COMPLETE (Step 21)
* * *
**Information element** **Value/remark** Protocol Discriminator Call
Independent SS message (1011) Transaction identifier  
Message type RELEASE COMPLETE (0010 1010)
* * *
MEASUREMENT CONTROL (Step 22):
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Setup Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE assisted \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request TRUE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_ Periodical reporting
criteria \- Amount of reporting 1 \- Reporting interval 64000 \- UE pos OTDOA
assistance data for UE-assisted Not present \- UE pos OTDOA assistance data
for UE-based Not present \- UE positioning GPS assistance data Set as
specified for \"Adequate assistance data for UE-assisted A-GPS\" in 4.3.3
**Physical Channel Information Elements**  
DPCH compressed mode status info Not present
* * *
MEASUREMENT REPORT (Steps 23 (Option 1) or 23b (Option 2))
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_  
\- UE positioning measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info Not present \- UE positioning GPS measured results
Present \- UE positioning error Not present Measured Results on RACH Not
present Additional Measured Results Not present Event Results Not present
* * *
MEASUREMENT REPORT (Step 23 (Option 2)):
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_  
\- UE positioning measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info Not present \- UE positioning GPS measured results Not
present \- UE positioning error  
\- Error reason Assistance Data Missing \- GPS additional assistance data
request  
\- Almanac Not checked \- UTC model Not checked \- Ionospheric model Not
checked \- Navigation model Not checked \- DGPS corrections Not checked \-
Reference location Not checked \- Reference time Not checked \- Acquisition
assistance Not checked \- Real-time integrity Not checked \- Navigation model
additional data Not checked Measured Results on RACH Not present Additional
Measured Results Not present Event Results Not present
* * *
MEASUREMENT CONTROL (Step 23a (Option 2)):
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Modify Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE assisted \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request FALSE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_ Periodical reporting
criteria \- Amount of reporting 1 \- Reporting interval 64000 \- UE pos OTDOA
assistance data for UE-assisted Not present \- UE pos OTDOA assistance data
for UE-based Not present \- UE positioning GPS assistance data Set as
specified in 4.3.5 **Physical Channel Information Elements**  
DPCH compressed mode status info Not present
* * *
6.1.3.8.5 Test requirements
After step 7 the UE shall send a RELEASE COMPLETE message with
verificationResponse set to permissionGranted.
After step 9 the UE shall respond with a MEASUREMENT REPORT message containing
the IE \"UE positioning GPS measured results\".
After step 14 the UE shall send a RELEASE COMPLETE message with
verificationResponse set to permissionDenied.
After step 22 the UE shall respond with a MEASUREMENT REPORT message
containing the IE \"UE positioning GPS measured results\".
#### 6.1.3.9 LCS Mobile terminated location request/ UE-Assisted GPS/ Privacy
Verification/ Location Not Allowed if No Response
6.1.3.9.1 Definition
This test case applies to all UEs supporting UE-Assisted GPS Location Service
capabilities.
6.1.3.9.2 Conformance requirements
> 1) The network invokes a location notification procedure by sending a
> REGISTER message containing a LCS-LocationNotification invoke component to
> the UE. This may be sent either to request verification for MT-LR or to
> notify about already authorized MT-LR.
>
> 2) In case of privacy verification the MS shall respond to the request by
> sending a RELEASE COMPLETE message containing the mobile subscriber\'s
> response in a return result component.
>
> 3) If the timer expires in the network before any response from the MS (e.g.
> due to no response from the user), the network shall interpret this by
> applying the default treatment defined in GSM 03.71 for GSM and TS 23.171
> for UMTS (i.e. disallow location if barred by subscription and allow
> location if allowed by subscription).
>
> 4) if the IE \"Measurement command\" has the value \"setup\":
>
> 2> store this measurement in the variable MEASUREMENT_IDENTITY according to
> the IE \"measurement identity\", first releasing any previously stored
> measurement with that identity if that exists;
...
> 2> for any other measurement type:
>
> 3> if the measurement is valid in the current RRC state of the UE:
>
> 4> begin measurements according to the stored control information for this
> measurement identity.
>
> 5) The UE shall:
>
> 1> when a measurement report is triggered:
>
> 2> if the UE was able to perform measurements on at least one neighbour cell
> included in the variable UE_POSITIONING_OTDOA_DATA_UE_ASSISTED in case of
> OTDOA or one satellite included in the variable UE_POSITIONING_GPS_DATA in
> case of GPS positioning or one cell from the active set in case of CELL ID:
>
> 3> if the IE \"Vertical Accuracy\" is included:
>
> 4> interpret the presence of this IE to indicate that the UTRAN desires to
> compute a 3-dimensional position estimate.
>
> 3> if the IE \"Positioning Methods\" is set to \"GPS\":
>
> 4> include the IE \"UE positioning GPS measured results\" in the measurement
> report and set the contents of the IE as follows:
>
> 5> if the UE supports the capability to provide the GPS timing of the cell
> frames measurement:
>
> 6> if the IE \"GPS timing of Cell wanted\" is set to TRUE:
>
> 7> perform the UE GPS timing of cell frames measurement on the serving cell
> or on one cell of the active set.
>
> 7> include the IE \"Primary CPICH Info\" for FDD or the IE \"cell parameters
> id\" for TDD; and
>
> 7> include the IE \"Reference SFN\" and the IE \"UE GPS timing of cell
> frames\".
>
> 6> if the IE \"GPS timing of Cell wanted\" is set to FALSE:
>
> 7> include the IE \"GPS TOW msec\".
>
> 5> if the UE does not support the capability to provide the GPS timing of
> the cell:
>
> 6> include the IE \"GPS TOW msec\".
References
> \- Conformance requirement 1, 2 and 3: TS 24.030, clause 4.1.1.
>
> \- Conformance requirement 4: TS 25.331, clause 8.4.1.3.
>
> \- Conformance requirement 5: TS 25.331, clause 8.6.7.19.3.3b.
6.1.3.9.3 Test Purpose
To verify that when the UE receives a REGISTER message, containing a LCS
Location Notification Invoke component set to notifyAndVerify-
LocationNotAllowedIfNoResponse, the UE notifies the user of the request and
indicates that the default response is location not allowed if no response and
providing the opportunity to accept or deny the request and sends a RELEASE
COMPLETE message containing a LocationNotification return result with
verificationResponse set to permissionDenied or permissionGranted as
appropriate.
6.1.3.9.4 Method of Test
Initial Conditions
System Simulator (SS):
> \- 1 cell, default parameters
>
> _\- Satellite signals:_ As specified in 4.2
##### UE: {#ue-7 .H6}
> \- State \"CS-CELL DCH Initial (State 6-1)\" as specified in clause 7.4.1 of
> TS 34.108.
##### Related PICS/PIXIT Statements {#related-picspixit-statements-19 .H6}
> \- UE Assisted Network Assisted GPS
>
> \- px_UeLcsNotification: value for UE LCS Notification timeout timer
>
> \- UE supporting Mobile Terminated Location Request
##### Test Procedure {#test-procedure-19 .H6}
The SS initiates authentication and ciphering and sends a REGISTER message
containing a Facility IE containing a LCS Location Notification Invoke message
set to notifyAndVerify-LocationNotAllowedIfNoResponse.
The LCS Client Name contained in the USSD text string of the lcs-
LocationNotification should be displayed with the option to accept or deny the
request and an indication that location will be allowed if no user response is
received.
The user accepts the location request. The UE responds with a RELEASE COMPLETE
message containing a LocationNotification return result with
verificationResponse set to permissionGranted.
The SS orders an A-GPS positioning measurement using a MEASUREMENT CONTROL
message, including assistance data as specified in subclause 4.3.3. The UE may
request additional assistance data by sending a MEASUREMENT REPORT message
containing a positioning error indication with the IE \"Error reason\" set to
\"Assistance Data Missing\". If the UE requests additional assistance data,
the SS provides the requested assistance data in one or more MEASUREMENT
CONTROL messages.
The UE sends a MEASUREMENT REPORT message including IE \"UE positioning GPS
measured results\".
The SS sends a REGISTER message containing a Facility IE containing a LCS
Location Notification Invoke message set to notifyAndVerify-
LocationNotAllowedIfNoResponse.
The user denies the location request. The UE responds with a RELEASE COMPLETE
message containing a LocationNotification return result with
verificationResponse set to permissionDenied.
The SS sends a REGISTER message containing a Facility IE containing a LCS
Location Notification Invoke message set to notifyAndVerify-
LocationNotAllowedIfNoResponse.
The user ignores the location request by taking no action. If the timer
expires in the SS before any response from the UE is received, the SS
interprets this by applying the default treatment LocationNotAllowed.
##### Expected Sequence {#expected-sequence-19 .H6}
+----------+---------------+-----------------+-----------------+---+ | **Step** | **Direction** | **Message** | **Comments** | | +----------+---------------+-----------------+-----------------+---+ | | **UE** | **SS** | | | +----------+---------------+-----------------+-----------------+---+ | 1 | \ | AUTHENTICATION | | | | | | RESPONSE | | | +----------+---------------+-----------------+-----------------+---+ | 3 | SS | | SS starts | | | | | | security | | | | | | procedure | | +----------+---------------+-----------------+-----------------+---+ | 4 | \ | RELEASE | Containing a | | | | | COMPLETE | Locat | | | | | | ionNotification | | | | | | return result | | | | | | with | | | | | | verif | | | | | | icationResponse | | | | | | set to | | | | | | pe | | | | | | rmissionGranted | | +----------+---------------+-----------------+-----------------+---+ | 9 | \ | MEASUREMENT | UE reports | | | | | REPORT | positioning | | | | | | measurement | | | | | | results (Option | | | | | | 1) or requests | | | | | | additional | | | | | | assistance data | | | | | | (Option 2). | | +----------+---------------+-----------------+-----------------+---+ | 10a | \ | MEASUREMENT | If UE requested | | | | | REPORT | additional | | | | | | assistance data | | | | | | in step 10, | | | | | | this message | | | | | | contains the IE | | | | | | \"UE | | | | | | positioning GPS | | | | | | measured | | | | | | results\". | | +----------+---------------+-----------------+-----------------+---+ | 11 | \ | RELEASE | Containing a | | | | | COMPLETE | Locat | | | | | | ionNotification | | | | | | return result | | | | | | with | | | | | | verif | | | | | | icationResponse | | | | | | set to | | | | | | p | | | | | | ermissionDenied | | +----------+---------------+-----------------+-----------------+---+ | 16 | \ | | | notif | | | yAndVerify-LocationNotAllowedIfNoResponse | | | | | | locationType -> current Location | | | | | | lcsClientExternalID -> externalAddress | | | | | | lcsClientName ->dataCodingScheme\ | | | nameString | +-------------------------+-------------------------------------------+
RELEASE COMPLETE (Step 8)
+-------------------------+--------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+--------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+--------------------------------------------+ | Transaction identifier | | +-------------------------+--------------------------------------------+ | Message type | RELEASE COMPLETE (xx10 1010) | +-------------------------+--------------------------------------------+ | Facility | Return result = LCS-LocationNotification | | | | | | LocationNotificationRes | | | | | | verificationResponse -> permissionGranted | +-------------------------+--------------------------------------------+
MEASUREMENT CONTROL (Step 9):
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Setup Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE assisted \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request TRUE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_ Periodical reporting
criteria \- Amount of reporting 1 \- Reporting interval 64000 \- UE pos OTDOA
assistance data for UE-assisted Not present \- UE pos OTDOA assistance data
for UE-based Not present \- UE positioning GPS assistance data Set as
specified for \"Adequate assistance data for UE-assisted A-GPS\" in 4.3.3
**Physical Channel Information Elements**  
DPCH compressed mode status info Not present
* * *
MEASUREMENT REPORT (Steps 10 (Option 1) or 10b (Option 2))
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_  
\- UE positioning measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info Not present \- UE positioning GPS measured results
Present \- UE positioning error Not present Measured Results on RACH Not
present Additional Measured Results Not present Event Results Not present
* * *
MEASUREMENT REPORT (Step 10 (Option 2)):
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_  
\- UE positioning measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info Not present \- UE positioning GPS measured results Not
present \- UE positioning error  
\- Error reason Assistance Data Missing \- GPS additional assistance data
request  
\- Almanac Not checked \- UTC model Not checked \- Ionospheric model Not
checked \- Navigation model Not checked \- DGPS corrections Not checked \-
Reference location Not checked \- Reference time Not checked \- Acquisition
assistance Not checked \- Real-time integrity Not checked \- Navigation model
additional data Not checked Measured Results on RACH Not present Additional
Measured Results Not present Event Results Not present
* * *
MEASUREMENT CONTROL (Step 10a (Option 2)):
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Modify Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE assisted \- Positioning methods GPS \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request FALSE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_ Periodical reporting
criteria \- Amount of reporting 1 \- Reporting interval 64000 \- UE pos OTDOA
assistance data for UE-assisted Not present \- UE pos OTDOA assistance data
for UE-based Not present \- UE positioning GPS assistance data Set as
specified in 4.3.5 **Physical Channel Information Elements**  
DPCH compressed mode status info Not present
* * *
REGISTER (Step 11)
+-------------------------+-------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+-------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+-------------------------------------------+ | Transaction identifier | | +-------------------------+-------------------------------------------+ | Message type | REGISTER (0011 1011) | +-------------------------+-------------------------------------------+ | Facility | Invoke = LCS-LocationNotification | | | | | | LocationNotificationArg | | | | | | notificationType -> | | | notif | | | yAndVerify-LocationNotAllowedIfNoResponse | | | | | | locationType -> current Location | | | | | | lcsClientExternalID -> externalAddress | | | | | | lcsClientName ->dataCodingScheme\ | | | nameString | +-------------------------+-------------------------------------------+
RELEASE COMPLETE (Step 15)
+-------------------------+-------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+-------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+-------------------------------------------+ | Transaction identifier | | +-------------------------+-------------------------------------------+ | Message type | RELEASE COMPLETE (xx10 1010) | +-------------------------+-------------------------------------------+ | Facility | Return result = LCS-LocationNotification | | | | | | LocationNotificationRes | | | | | | verificationResponse -> permissionDenied | +-------------------------+-------------------------------------------+
REGISTER (Step 16)
+-------------------------+-------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+-------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+-------------------------------------------+ | Transaction identifier | | +-------------------------+-------------------------------------------+ | Message type | RELEASE COMPLETE (0010 1010) | +-------------------------+-------------------------------------------+ | Facility | Invoke = LCS-LocationNotification | | | | | | LocationNotificationArg | | | | | | notificationType -> | | | notif | | | yAndVerify-LocationNotAllowedIfNoResponse | | | | | | locationType -> current Location | | | | | | lcsClientExternalID -> externalAddress | | | | | | lcsClientName ->dataCodingScheme\ | | | nameString | +-------------------------+-------------------------------------------+
RELEASE COMPLETE (Step 21)
* * *
**Information element** **Value/remark** Protocol Discriminator Call
Independent SS message (1011) Transaction identifier  
Message type RELEASE COMPLETE (0x10 1010)
* * *
6.1.3.9.5 Test requirements
After step 7 the UE shall send a RELEASE COMPLETE message with
verificationResponse set to permissionGranted.
After step 9 the UE shall respond with a MEASUREMENT REPORT message containing
the IE \"UE positioning GPS measured results\".
After step 14 the UE shall send a RELEASE COMPLETE message with
verificationResponse set to permissionDenied.
During step 20 the UE shall not send any RELEASE COMPLETE message.
#### 6.1.3.10 LCS Mobile terminated location request/ UE-Based or UE-Assisted
GPS/ Configuration Incomplete
6.1.3.10.1 Definition
This test case applies to all UEs supporting UE-based or UE-assisted network
assisted GPS, but not UE-based OTDOA.
6.1.3.10.2 Conformance requirements
> 1) The network invokes a location notification procedure by sending a
> REGISTER message containing a LCS-LocationNotification invoke component to
> the UE. This may be sent either to request verification for MT-LR or to
> notify about already authorized MT-LR.
>
> 2) In the case of location notification no response is required from the MS,
> the MS shall terminate the dialogue by sending a RELEASE COMPLETE message
> containing a LocationNotification return result.
>
> 3) The UE shall perform the following consistency check:
>
> 1> if UE, according to its capabilities, does not support UE-based OTDOA and
> if IE \"Positioning Methods\" is set to \"OTDOA\" and if IE \"Method Type\"
> is set to \"UE-based\":
>
> 2> set the variable CONFIGURATION_INCOMPLETE to TRUE.
>
> 1> if UE, according to its capabilities, does not support UE-based GPS and
> if IE \"Positioning Methods\" is set to \"GPS\" and if IE \"Method Type\" is
> set to \"UE-based\":
>
> 2> set the variable CONFIGURATION_INCOMPLETE to TRUE.
>
> 1> if UE, according to its capabilities, does not support UE-assisted GPS
> and if IE \"Positioning Methods\" is set to \"GPS\" and if IE \"Method
> Type\" is set to \"UE-assisted\":
>
> 2> set the variable CONFIGURATION_INCOMPLETE to TRUE.
>
> 1> if UE, according to its capabilities, does not support UE-based
> positioning and if IE \"Positioning Methods\" is set to \"OTDOAorGPS\" and
> if IE \"Method Type\" is set to \"UE-based\":
>
> 2> set the variable CONFIGURATION_INCOMPLETE to TRUE.
>
> 1> if UE, according to its capabilities, does not support Rx-Tx time
> difference type 2 measurement and if IE \"Positioning Methods\" is set to
> \"Cell ID\":
>
> 2> set the variable CONFIGURATION_INCOMPLETE to TRUE.
>
> 1> if UE, according to its capabilities, does not support UE GPS timing of
> cell frames measurement and if IE \"GPS timing of Cell wanted\" is set to
> TRUE:
>
> 2> set the variable CONFIGURATION_INCOMPLETE to TRUE.
>
> 4) If the variable CONFIGURATION_INCOMPLETE is set to TRUE, the UE shall:
>
> 1> retain the measurement configuration that was valid before the
> MEASUREMENT CONTROL message was received;
>
> 1> set the IE \"RRC transaction identifier\" in the MEASUREMENT CONTROL
> FAILURE message to the value of \"RRC transaction identifier\" in the entry
> for the MEASUREMENT CONTROL message in the table \"Accepted transactions\"
> in the variable TRANSACTIONS and clear that entry;
>
> 1> clear the variable CONFIGURATION_INCOMPLETE;
>
> 1> set the cause value in IE \"failure cause\" to \"Configuration
> incomplete\";
>
> 1> submit the MEASUREMENT CONTROL FAILURE message to lower layers for
> transmission on the DCCH using AM RLC;
>
> 1> continue with any ongoing processes and procedures as if the invalid
> MEASUREMENT CONTROL message has not been received;
>
> 1> and the procedure ends.
>
> 5) The UE should set the variable UNSUPPORTED_CONFIGURATION to TRUE if the
> received message is not according to the UE capabilities.
References
> \- Conformance requirement 1, 2: TS 24.030, clause 4.1.1.
>
> \- Conformance requirement 3: TS 25.331, clause 8.6.7.19.1
>
> \- Conformance requirement 4: TS 25.331, clause 8.4.1.4a
>
> \- Conformance requirement 5: TS 25.331 clause 8.5.20
6.1.3.10.3 Test Purpose
To verify that the UE sends a MEASUREMENT CONTROL FAILURE message, after
receiving a MEASUREMENT CONTROL message with IE \"Method Type\" set a value
which is inconsistent with the UE positioning capabilities.
To verify that the UE set the \"failure cause\" IE to value \"configuration
incomplete\" in the uplink MEASUREMENT CONTROL FAILURE message.
6.1.3.10.4 Method of Test
Initial Conditions
System Simulator (SS):
> \- 1 cell, default parameters
>
> \- Satellite signals switched off or not present
##### UE: {#ue-8 .H6}
> \- State \"CS-CELL DCH Initial (State 6-1)\" as specified in clause 7.4.1 of
> TS 34.108.
##### Related PICS/PIXIT Statements {#related-picspixit-statements-20 .H6}
> \- UE Based Network Assisted GPS
>
> \- UE Assisted Network Assisted GPS
>
> \- UE supporting Mobile Terminated Location Request
##### Test Procedure {#test-procedure-20 .H6}
The SS initiates authentication and ciphering and sends a REGISTER message
containing a Facility IE containing a LCS Location Notification Invoke
component set to notifyLocationAllowed.
The UE responds with a RELEASE COMPLETE message containing a
LocationNotification return result.
The SS sends a MEASUREMENT CONTROL message with \"Method type\" set to a value
not supported by the UE as indicated in the \"UE positioning capability\"
contained in the \"UE radio access capability\" (method not to be supported is
UE-based OTDOA).
The UE sends a MEASUREMENT CONTROL FAILURE message with Failure Cause
\"Configuration Incomplete\" or \"unsupported configuration.
##### Expected Sequence {#expected-sequence-20 .H6}
+----------+---------------+-----------------+-----------------+---+ | **Step** | **Direction** | **Message** | **Comments** | | +----------+---------------+-----------------+-----------------+---+ | | **UE** | **SS** | | | +----------+---------------+-----------------+-----------------+---+ | 1 | \ | AUTHENTICATION | | | | | | RESPONSE | | | +----------+---------------+-----------------+-----------------+---+ | 3 | SS | | SS starts | | | | | | security | | | | | | procedure | | +----------+---------------+-----------------+-----------------+---+ | 4 | \ | RELEASE | The UE | | | | | COMPLETE | terminates the | | | | | | dialogue | | +----------+---------------+-----------------+-----------------+---+ | 7 | SS | | SS verifies | | | | | | that UE does | | | | | | not support | | | | | | UE-based OTDOA | | +----------+---------------+-----------------+-----------------+---+ | 8 | \ | MEASUREMENT | Failure cause | | | | | CONTROL FAILURE | \"Configuration | | | | | | Incomplete\" or | | | | | | \"Unsupported | | | | | | Configuration\" | | +----------+---------------+-----------------+-----------------+---+ | 10 | SS | | SS releases the | | | | | | connection and | | | | | | the test case | | | | | | ends | | +----------+---------------+-----------------+-----------------+---+
##### Specific Message Contents {#specific-message-contents-20 .H6}
REGISTER (Step 4)
+-------------------------+--------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+--------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+--------------------------------------------+ | Transaction identifier | | +-------------------------+--------------------------------------------+ | Message type | REGISTER (0011 1011) | +-------------------------+--------------------------------------------+ | Facility | Invoke = LCS-LocationNotification | | | | | | LocationNotificationArg | | | | | | notificationType -> notifyLocationAllowed | | | | | | locationType -> current Location | | | | | | lcsClientExternalID -> externalAddress | | | | | | lcsClientName ->dataCodingScheme\ | | | nameString | +-------------------------+--------------------------------------------+
RELEASE COMPLETE (Step 6)
+-------------------------+--------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+--------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+--------------------------------------------+ | Transaction identifier | | +-------------------------+--------------------------------------------+ | Message type | RELEASE COMPLETE (xx10 1010) | +-------------------------+--------------------------------------------+ | Facility | Return result = LCS-LocationNotification | | | | | | LocationNotificationRes | | | | | | verificationResponse -> permissionGranted | +-------------------------+--------------------------------------------+
MEASUREMENT CONTROL (Step 8):
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measurement Command Setup Measurement Reporting Mode  
\- Measurement report transfer mode Acknowledged mode RLC \- Periodical
reporting / Event trigger reporting mode Periodical reporting Additional
Measurements List Not present CHOICE _Measurement type_ UE positioning
measurement \- UE positioning measurement  
\- UE positioning reporting quantity  
\- Method type UE-based \- Positioning methods OTDOA \- Response time 128 \-
Horizontal accuracy 127 \- Vertical accuracy 127 \- GPS timing of cell wanted
FALSE \- Multiple sets FALSE \- Additional assistance data request FALSE \-
Environmental characterization Not present \- Measurement validity  
\- UE state All states \- CHOICE _Reporting criteria_ Periodical reporting
criteria \- Amount of reporting 1 \- Reporting interval 64000 \- UE pos OTDOA
assistance data for UE-assisted Not present \- UE pos OTDOA assistance data
for UE-based Not present \- UE positioning GPS assistance data Not present
**Physical Channel Information Elements**  
DPCH compressed mode status info Not present
* * *
MEASUREMENT CONTROL FAILURE (Step 9)
* * *
**Information Element** **Value/remark** RRC transaction identifier Set to the
same value of the same IE in the MEASUREMENT CONTROL message sent in Step 5
Failure cause Failure cause \"Configuration Incomplete\" or \"Unsupported
Configuration\"
* * *
6.1.3.10.5 Test requirements
After step 5 the UE shall send a RELEASE COMPLETE message.
After step 8, the UE shall transmit MEASUREMENT CONTROL FAILURE message,
stating the IE \"failure cause\" as \"configuration incomplete\". The UE shall
not transmit any MEASUREMENT REPORT messages during the execution of this test
case.
6.2 Assisted-GNSS Test Cases
### 6.2.1 Assisted GNSS Network Induced Tests
#### 6.2.1.1 NI-LR Emergency Call: UE-Based A-GNSS
6.2.1.1.1 Definition
This test case applies to all UEs supporting UE-Based GANSS or GNSS Location
Service capabilities.
6.2.1.1.2 Conformance requirements
> 1) A MM connection for an emergency call may be established in all states of
> the mobility management sublayer which allow MM connection establishment for
> a normal originating call.
>
> When a user requests an emergency call establishment the UE will send a CM
> SERVICE REQUEST message to the network with a CM service type information
> element indicating emergency call establishment.
>
> 2) Having entered the \"MM connection pending\" state, upon MM connection
> establishment, the call control entity of the UE sends a setup message to
> its peer entity. This setup message is
>
> \- a SETUP message, if the call to be established is a basic call; and
>
> \- an EMERGENCY SETUP message, if the call to be established is an emergency
> call.
>
> 3) If the IE \"UE positioning GANSS reference time\" is included, the UE
> shall:
>
> 1> if the IE \"GANSS Day\" is included:
>
> 2> store this IE in \"UE positioning GANSS reference time\" in variable
> UE_POSITIONING_GANSS_DATA and use it as the current GANSS day.
>
> 1> store the IE \"GANSS TOD\" in the IE \"UE positioning GANSS reference
> time\" in variable UE_POSITIONING_GANSS_DATA and use it as an estimate of
> the GANSS Time-of-Day at the time of reception of the complete message
> containing the IE \"GANSS TOD\";
>
> NOTE: The UE does not need to apply any compensation on the GANSS Time-of-
> Day.
>
> 1> if the IE \"GANSS Time ID\" is not included:
>
> 2> use Galileo system time as a reference for GANSS-Time-of-Day.
>
> 1> if the IE \"GANSS Time ID\" is included:
>
> 2> use the system time indicated by this IE as a reference for GANSS-Time-
> of-Day.
>
> 4) If the IE \"UE positioning GANSS reference UE position\" is included, the
> UE shall:
>
> 1> store this IE in the IE \"UE positioning GANSS reference UE position\" in
> variable UE_POSITIONING_GANSS_DATA; and
>
> 1> use it as a priori knowledge of the approximate location of the UE.
>
> 5) If the IE \"UE positioning GANSS time model\" is included, the UE shall
> for each GANSS:
>
> 1> store the information in \"UE positioning GANSS time model\" in variable
> UE_POSITIONING_GANSS_DATA;
>
> 1> use the stored parameters to relate GANSS time for the GANSS indicated by
> \"GANSS ID\" to time reference indicated by IE \"GNSS_TO_ID\".
>
> 6) The UE shall when a measurement report is triggered:
>
> 1> if the UE has been able to calculate a position after performing
> measurements on the cells included in the variable
> UE_POSITIONING_OTDOA_DATA_UE_BASED in case of OTDOA or the UE has been able
> to calculate a position in case of GPS or GANSS positioning or the UE has
> been able to calculate a position using a standalone positioning method:
>
> 2> include IE \"UE positioning Position Estimate Info\" in the MEASUREMENT
> REPORT and set the contents of the IE as follows:
>
> 3> if the UE supports the capability to provide the GANSS timing of the cell
> frames measurement;
>
> 3> if the IE \"GANSS timing of Cell wanted\" is not included, or included
> with each bit set to value zero:
>
> 4> include the IE \"GANSS TOD msec\" and set it to the GANSS TOD when the
> position estimate was valid.
>
> 3> if the UE does not support the capability to provide the GANSS timing of
> the cell:
>
> 4> include the IE \"GANSS TOD msec\" and set it to the GANSS TOD when the
> position estimate was valid;
>
> 4> include the IE \"GANSS Time ID\" to identify the GNSS system time.
>
> 3> if IE \"Vertical Accuracy\" has been included in IE \"UE positioning
> reporting quantity\":
>
> 4> if the IE \"Vertical Accuracy\" has been assigned to a value unequal to
> \"0\":
>
> 5> if the UE has been able to calculate a 3-dimensional position:
>
> 6> include IE \"Ellipsoid point with altitude and uncertainty ellipsoid\" as
> the position estimate.
>
> 5> if the UE has not been able to calculate a 3-dimensional position:
>
> 6> act as if IE \"Vertical Accuracy\" has not been included in IE \"UE
> positioning reporting quantity\".
>
> 3> if IE \"Vertical Accuracy\" has not been included in IE \"UE positioning
> reporting quantity\":
>
> 4> if IE \"Horizontal Accuracy\" in IE \"UE positioning reporting quantity\"
> has been assigned to a value unequal to 0:
>
> 5> include either IE \"Ellipsoid point with uncertainty circle\" or IE
> \"Ellipsoid point with uncertainty ellipse\" or IE \"Ellipsoid point with
> altitude and uncertainty ellipsoid\" as the position estimate.
>
> 3> if any of the IEs \"Ellipsoid point with uncertainty ellipse\" or
> \"Ellipsoid point with altitude and uncertainty ellipsoid\" is reported:
>
> 4> should calculate a value of the IE \"Confidence\", different from \"0\",
> as the probability that the UE is located within the uncertainty region of
> the one of the IEs \"Ellipsoid point with uncertainty ellipse\" or
> \"Ellipsoid point with altitude and uncertainty ellipsoid\" that is
> reported.
>
> NOTE: The value \"0\" of the IE \"Confidence\" is interpreted as \"no
> information\" by the UTRAN].
Reference(s):
> \- Conformance requirement 1: TS 24.008 clause 4.5.1.5.
>
> \- Conformance requirement 2: TS 24.008, clause 5.2.1.
>
> \- Conformance requirement 3: TS 25.331, clause 8.6.7.19.7.7.
>
> \- Conformance requirement 4: TS 25.331, clause 8.6.7.19.7.8.
>
> \- Conformance requirement 5: TS 25.331, clause 8.6.7.19.7.9.
>
> \- Conformance requirement 6: TS 25.331, clause 8.6.7.19.1b.
6.2.1.1.3 Test Purpose
To verify when an emergency call is initiated by a UE, and the network
performs a GANSS location request using the RRC measurement control procedure,
then the UE responds with a Measurement Report containing UE location
estimate.
6.2.1.1.4 Method of Test
Initial Conditions
> \- System Simulator (SS):
>
> \- 1 cell, default parameters.
>
> \- Satellite signals: As specified in 4.2
>
> \- User Equipment (UE):
>
> \- the UE is in state \"MM idle\" with valid TMSI and CKSN.
##### Related PICS/PIXIT Statements {#related-picspixit-statements-21 .H6}
> \- Emergency speech call
>
> \- UE Based Network Assisted GANSS
>
> \- UE Based Network Assisted GPS (Sub-tests 3, 4, 8 and 10)
##### Test procedure {#test-procedure-21 .H6}
This test case includes sub-test cases dependent on the GNSS supported by the
UE. Each sub-test case is identified by a Sub-Test Case Number as defined
below:
* * *
**Sub-Test Case Number** **Supported GNSS** 1 UE supporting A-GLONASS only 2
UE supporting A-Galileo only 3 UE supporting A-GPS and Modernized GPS only 4
UE supporting A-GPS^(1)^ and A-GLONASS only 8 UE supporting A-GPS^(1)^ and
A-Galileo only 9 UE supporting A-BDS only 10 UE supporting A-GPS^(1)^ and
A-BDS only NOTE 1: \"A-GPS\" includes Modernized GPS if supported by the UE.
* * *
The UE is made to initiate an emergency call.
After the call has been through-connected in both directions, the SS orders an
A-GNSS positioning measurement using one or more (dependent on the Sub-Test)
MEASUREMENT CONTROL messages. The last MEASUREMENT CONTROL message orders
periodical reporting by sending a MEASUREMENT CONTROL message requesting
periodical measurement reporting (1 report, interval 64s).
The UE then performs positioning measurements, calculates \"UE Positioning
Position Estimate Info\" and responds with this in the RRC message MEASUREMENT
REPORT.
Finally the SS clears the call.
##### Expected Sequence {#expected-sequence-21 .H6}
+----------+---------------+-----------------+-----------------+---+ | **Step** | **Direction** | **Message** | **Comments** | | +----------+---------------+-----------------+-----------------+---+ | | **UE** | **SS** | | | +----------+---------------+-----------------+-----------------+---+ | 1 | UE | | The \"emergency | | | | | | number\" is | | | | | | entered. Number | | | | | | shall be one | | | | | | programmed in | | | | | | test USIM | | | | | | EF~ECC~ | | | | | | (Emergency Call | | | | | | Codes), ref. | | | | | | 34.108 clause | | | | | | 8.3.2.21. | | +----------+---------------+-----------------+-----------------+---+ | 2 | --> | | UE establishes | | | | | | RRC procedure | | | | | | for emergency | | | | | | call. | | | | | | | | | | | | Establishment | | | | | | cause: | | | | | | Emergency Call\ | | | | | | SS checks that | | | | | | the UE | | | | | | capability | | | | | | includes | | | | | | \"Network | | | | | | Assisted GANSS | | | | | | Support List\" | | | | | | with \"GANSS | | | | | | mode\" set to | | | | | | \"UE-based\", | | | | | | and that the UE | | | | | | includes | | | | | | \"Network | | | | | | Assisted GPS | | | | | | Support\" for | | | | | | UE-based | | | | | | (Sub-Tests 3, | | | | | | 4, 8 and 10 | | | | | | only). | | +----------+---------------+-----------------+-----------------+---+ | 3 | --> | CM SERVICE | The CM service | | | | | REQUEST | type IE | | | | | | indicates | | | | | | \"emergency | | | | | | call | | | | | | e | | | | | | stablishment\". | | +----------+---------------+-----------------+-----------------+---+ | 4 | \ | AUTHENTICATION | SRES specifies | | | | | RESPONSE | correct value. | | +----------+---------------+-----------------+-----------------+---+ | 6 | | | SS starts | | | | | | security | | | | | | procedure. | | +----------+---------------+-----------------+-----------------+---+ | 7 | --> | EMERGENCY SETUP | If the Bearer | | | | | | capability IE | | | | | | is not included | | | | | | the default | | | | | | UMTS AMR speech | | | | | | version shall | | | | | | be assumed. | | +----------+---------------+-----------------+-----------------+---+ | 8 | \ | CONNECT | | | | | | ACKNOWLEDGE | | | +----------+---------------+-----------------+-----------------+---+ | 13 | UE | | The DTCH is | | | | | | through | | | | | | connected in | | | | | | both | | | | | | directions. | | +----------+---------------+-----------------+-----------------+---+ | 14 | \ | MEASUREMENT | | | | | | REPORT | | | +----------+---------------+-----------------+-----------------+---+ | 16 | \ if the UE was UE shall when able to perform measurements on at least one
neighbour cell included in the variable UE_POSITIONING_OTDOA_DATA_UE_ASSISTED
in case of OTDOA or one satellite included in the variable
UE_POSITIONING_GPS_DATA in case of GPS positioning or one satellite included
in the variable UE_POSITIONING_GANSS_DATA in case of GANSS positioning or one
cell from the active set in case of CELL ID:
2> if the IE \"Vertical Accuracy\" is included:
3> interpret the presence of this IE to indicate that the UTRAN desires to
compute a 3-dimensional position estimate.
2> if the IE \"Positioning Methods\" is set to \"GPS\" and if the IE \"GANSS
Positioning Methods\" is not present or if the IE \"GANSS Positioning
Methods\" is present indicating GPS allowed:
3> include the IE \"UE positioning GPS measured results\" in the measurement
report and set the contents of the IE as follows:
4> if the UE supports the capability to provide the GPS timing of the cell
frames measurement:
> 5> if the IE \"GPS timing of Cell wanted\" is set to FALSE:
>
> 7> include the IE \"GPS TOW msec\" and set it to the GPS TOW when the
> measurements included in the MEASUREMENT REPORT were valid;
>
> 7> include the IE \"UE Positioning GPS Reference Time Uncertainty\" and set
> it to the uncertainty of the GPS TOW when the measurements included in the
> MEASUREMENT REPORT were valid.
4> if the UE does not support the capability to provide the GPS timing of the
cell:
> 5> include the IE \"GPS TOW msec\" and set it to the GPS TOW when the
> measurements included in the MEASUREMENT REPORT were valid;
>
> 5> include the IE \"UE Positioning GPS Reference Time Uncertainty\" and set
> it to the uncertainty of the GPS TOW when the measurements included in the
> MEASUREMENT REPORT were valid.
2> if the IE \"Positioning Methods\" is set to \"GPS\" and the IE \"GANSS
Positioning Methods\" is present indicating other GNSS than GPS allowed and if
any of these other GNSSs is measured:
3> include the IE \"UE positioning GANSS measured results\" in the measurement
report and set the contents of the IE as follows:
4> if the UE supports the capability to provide the GANSS timing of the cell
frames measurement:
> 5> if the IE \"GANSS timing of Cell wanted\" is not included, or included
> with each bit set to value zero and if IE \"UE positioning GPS measured
> results\" is not present:
>
> 6> include the IE \"GANSS TOD msec\" and set it to the GANSS TOD when the
> measurements included in the MEASUREMENT REPORT were valid.
4> if the UE does not support the capability to provide the GANSS timing of
the cell and if IE \"UE positioning GPS measured results\" is not present:
> 5> include the IE \"GANSS TOD msec\" and set it to the GANSS TOD when the
> measurements included in the MEASUREMENT REPORT were valid.
4> if the UE supports the capability to perform GANSS measurements on multiple
GANSS frequencies:
> 5> if the IE \"GANSS Multi-frequency Measurement Requested\" is included
> with one bit set to value one for a supported GANSS, and if any of these
> GANSS signals are measured:
>
> 6> include the IE \"GANSS Signal Measurement Information\" for each measured
> GANSS signal.
References
> \- Conformance requirement 1: TS 24.008 clause 4.5.1.5.
>
> \- Conformance requirement 2: TS 24.008, clause 5.2.1.
>
> \- Conformance requirement 3: TS 25.331, clause 8.6.7.19.1a.
6.2.1.2.3 Test Purpose
To verify when an emergency call is initiated by a UE, and the network
performs a GANSS location request using the RRC measurement control procedure,
then the UE responds with a Measurement Report containing \"UE positioning
GANSS measured results\" and \"UE positioning GPS measured results\" (Sub-
tests 3, 4, 8 and 10).
6.2.1.2.4 Method of Test
Initial Conditions
> \- System Simulator (SS):
>
> \- 1 cell, default parameters.
>
> _\- Satellite signals:_ As specified in 4.2.
>
> \- User Equipment (UE):
>
> \- the UE is in state \"MM idle\" with valid TMSI and CKSN.
##### Related PICS/PIXIT Statements {#related-picspixit-statements-22 .H6}
> \- Emergency speech call
>
> \- UE Assisted Network Assisted GANSS
>
> \- UE Assisted Network Assisted GPS (Sub-tests 3, 4, 8 and 10)
##### Test Procedure {#test-procedure-22 .H6}
This test case includes sub-test cases dependent on the GNSS supported by the
UE. Each sub-test case is identified by a Sub-Test Case Number as defined
below:
* * *
**Sub-Test Case Number** **Supported GNSS** 1 UE supporting A-GLONASS only 2
UE supporting A-Galileo only 3 UE supporting A-GPS and Modernized GPS only 4
UE supporting A-GPS^(1)^ and A-GLONASS only 8 UE supporting A-GPS^(1)^ and
A-Galileo only 9 UE supporting A-BDS only 10 UE supporting A-GPS^(1)^ and
A-BDS only NOTE 1: \"A-GPS\" includes Modernized GPS if supported by the UE.
* * *
The UE is made to initiate an emergency call.
After the call has been through-connected in both directions, the SS orders an
A-GNSS positioning measurement using a MEASUREMENT CONTROL message, including
assistance data as specified in subclause 4.4.3. The UE may request additional
assistance data by sending a MEASUREMENT REPORT message containing a
positioning error indication with the IE \"Error reason\" set to \"Assistance
Data Missing\". If the UE requests additional assistance data, the SS provides
the requested assistance data in one or more MEASUREMENT CONTROL messages.
The UE then performs positioning measurements and responds with the RRC
message MEASUREMENT REPORT.
Finally the SS clears the call.
##### Expected Sequence {#expected-sequence-22 .H6}
+----------+---------------+-----------------+-----------------+---+ | **Step** | **Direction** | **Message** | **Comments** | | +----------+---------------+-----------------+-----------------+---+ | | **UE** | **SS** | | | +----------+---------------+-----------------+-----------------+---+ | 1 | UE | | The \"emergency | | | | | | number\" is | | | | | | entered. Number | | | | | | shall be one | | | | | | programmed in | | | | | | test USIM | | | | | | EF~ECC~ | | | | | | (Emergency Call | | | | | | Codes), ref. | | | | | | 34.108 clause | | | | | | 8.3.2.21. | | +----------+---------------+-----------------+-----------------+---+ | 2 | --> | | UE establishes | | | | | | RRC procedure | | | | | | for emergency | | | | | | call. | | | | | | | | | | | | Establishment | | | | | | cause: | | | | | | Emergency Call\ | | | | | | SS checks that | | | | | | the UE | | | | | | capability | | | | | | includes | | | | | | \"Network | | | | | | Assisted GANSS | | | | | | Support List\" | | | | | | with \"GANSS | | | | | | mode\" set to | | | | | | \ | | | | | | "UE-assisted\", | | | | | | and that the UE | | | | | | includes | | | | | | \"Network | | | | | | Assisted GPS | | | | | | Support\" for | | | | | | UE-assisted | | | | | | (Sub-Tests 3, | | | | | | 4, 8 and 10 | | | | | | only). | | +----------+---------------+-----------------+-----------------+---+ | 3 | --> | CM SERVICE | The CM service | | | | | REQUEST | type IE | | | | | | indicates | | | | | | \"emergency | | | | | | call | | | | | | e | | | | | | stablishment\". | | +----------+---------------+-----------------+-----------------+---+ | 4 | \ | AUTHENTICATION | SRES specifies | | | | | RESPONSE | correct value. | | +----------+---------------+-----------------+-----------------+---+ | 6 | SS | | SS starts | | | | | | security | | | | | | procedure. | | +----------+---------------+-----------------+-----------------+---+ | 7 | --> | EMERGENCY SETUP | If the Bearer | | | | | | capability IE | | | | | | is not included | | | | | | the default | | | | | | UMTS AMR speech | | | | | | version shall | | | | | | be assumed. | | +----------+---------------+-----------------+-----------------+---+ | 8 | \ | CONNECT | | | | | | ACKNOWLEDGE | | | +----------+---------------+-----------------+-----------------+---+ | 13 | UE | | The DTCH is | | | | | | through | | | | | | connected in | | | | | | both | | | | | | directions. | | +----------+---------------+-----------------+-----------------+---+ | 14 | \ | MEASUREMENT | UE reports | | | | | REPORT | positioning | | | | | | measurement | | | | | | results (Option | | | | | | 1) or requests | | | | | | additional | | | | | | assistance data | | | | | | (Option 2). | | +----------+---------------+-----------------+-----------------+---+ | 15a | \ | MEASUREMENT | If UE requested | | | | | REPORT | additional | | | | | | assistance data | | | | | | in step 15, | | | | | | this message | | | | | | contains the IE | | | | | | \"UE | | | | | | positioning | | | | | | GANSS measured | | | | | | results\" and | | | | | | \"UE | | | | | | positioning GPS | | | | | | measured | | | | | | results\" | | | | | | (Sub-tests 3, | | | | | | 4, 8 and 10). | | +----------+---------------+-----------------+-----------------+---+ | 16 | \ 1) The MS invokes a MO-LR by sending a REGISTER message to the network
> containing a LCS-MOLR invoke component. SS Version Indicator value 1 or
> above shall be used.
>
> 2) The network shall pass the result of the location procedure to the MS by
> sending a FACILITY message to the MS containing a LCS-MOLR return result
> component.
>
> 3) After the last location request operation the MS shall terminate the
> dialogue by sending a RELEASE COMPLETE message.
Reference(s):
> \- Conformance requirements 1, 2 and 3: TS 24.030, subclause 5.1.1
6.2.2.1.3 Test Purpose
To verify the UE behaviour at a mobile originated location request procedure
using network-assisted UE-based GNSS.
6.2.2.1.4 Method of Test
Initial Conditions
> \- System Simulator (SS):
>
> \- 1 cell, default parameters.
>
> \- Satellite signals: As specified in 4.2
>
> \- User Equipment (UE):
>
> \- The UE is in state "MM idle" with valid TMSI and CKSN.
>
> \- The UE is in state "PMM idle" with valid P-TMSI.
##### Related PICS/PIXIT Statements {#related-picspixit-statements-23 .H6}
> \- UE Based Network Assisted GANSS.
>
> \- UE Based Network Assisted GPS (Sub-tests 3, 4, 8 and 10).
>
> \- Method of triggering an MO-LR request for a position estimate.
##### Test Procedure {#test-procedure-23 .H6}
This test case includes sub-test cases dependent on the GNSS supported by the
UE. Each sub-test case is identified by a Sub-Test Case Number as defined
below:
* * *
**Sub-Test Case Number** **Supported GNSS** 1 UE supporting A-GLONASS only 2
UE supporting A-Galileo only 3 UE supporting A-GPS and Modernized GPS only 4
UE supporting A-GPS^(1)^ and A-GLONASS only 8 UE supporting A-GPS^(1)^ and
A-Galileo only 9 UE supporting A-BDS only 10 UE supporting A-GPS^(1)^ and
A-BDS only NOTE 1: "A-GPS" includes Modernized GPS if supported by the UE.
* * *
The UE invokes call independent supplementary service through a CM SERVICE
REQUEST. The SS initiates authentication and ciphering.
The UE invokes an MO-LR request of type \"locationEstimate\".
The SS orders an A-GNSS positioning measurement using one or more (dependent
on the Sub-Test) MEASUREMENT CONTROL messages.
The SS responds with a FACILITY message containing an MO-LR result.
When UE receives the FACILITY message, it clears the transaction by sending a
RELEASE COMPLETE message.
##### Expected Sequence {#expected-sequence-23 .H6}
* * *
**Step** **Direction** **Message** **Comments**  
**UE** **SS**  
1 -> The UE establishes an RRC connection for location service. The SS
verifies that the IE \"Establishment cause\" in the received RRC CONNECTION
REQUEST message is set to \"Originated High Priority Signalling\".  
2 -> CM SERVICE REQUEST The CM service type IE indicates \"call independent
supplementary service\"  
3 \ AUTHENTICATION RESPONSE  
5 SS The SS starts ciphering and integrity protection.  
6 -> REGISTER Call Independent SS containing Facility IE with an LCS MO-LR
request of type \"locationEstimate\".  
7 \ MEASUREMENT REPORT  
9 \ RELEASE COMPLETE The UE terminates the dialogue  
11 SS The SS releases the RRC connection and the test case ends.
* * *
##### Specific Message Contents {#specific-message-contents-23 .H6}
REGISTER (Step 6)
+----------------------------------+----------------------------------+ | **Information element** | **Value/remark** | +----------------------------------+----------------------------------+ | Supplementary service protocol | 1011 (supplementary services | | discriminator | (call independent)) | +----------------------------------+----------------------------------+ | Transaction identifier | | +----------------------------------+----------------------------------+ | Register message type | xx11 1011 (REGISTER) | +----------------------------------+----------------------------------+ | Facility | Invoke=LCS-MOLR | | | | | | molr-Type ->locationEstimate | +----------------------------------+----------------------------------+ | SS version | Version 1 or above | +----------------------------------+----------------------------------+
MEASUREMENT CONTROL (Step 7):
+----------------------------------+----------------------------------+ | **Information element** | **Value/remark** | +----------------------------------+----------------------------------+ | **Measurement Information | | | Elements** | | +----------------------------------+----------------------------------+ | Measurement Identity | 10 | +----------------------------------+----------------------------------+ | Measurement Command | Setup | +----------------------------------+----------------------------------+ | Measurement Reporting Mode | | +----------------------------------+----------------------------------+ | - Measurement report transfer | Acknowledged mode RLC | | mode | | +----------------------------------+----------------------------------+ | - Periodical reporting / Event | Periodical reporting | | trigger reporting mode | | +----------------------------------+----------------------------------+ | Additional Measurements List | Not present | +----------------------------------+----------------------------------+ | CHOICE _Measurement type_ | UE positioning measurement | +----------------------------------+----------------------------------+ | - UE positioning measurement | | +----------------------------------+----------------------------------+ | - UE positioning reporting | | | quantity | | +----------------------------------+----------------------------------+ | - Method type | UE based | +----------------------------------+----------------------------------+ | - Positioning methods | GPS | +----------------------------------+----------------------------------+ | - Response time | 128 | +----------------------------------+----------------------------------+ | - Horizontal accuracy | 127 | +----------------------------------+----------------------------------+ | - Vertical accuracy | 127 | +----------------------------------+----------------------------------+ | - GPS timing of cell wanted | FALSE | +----------------------------------+----------------------------------+ | - Multiple sets | FALSE | +----------------------------------+----------------------------------+ | - Additional assistance data | FALSE | | request | | +----------------------------------+----------------------------------+ | - Environmental | Not present | | characterization | | +----------------------------------+----------------------------------+ | - Velocity Requested | Not present | +----------------------------------+----------------------------------+ | - GANSS Positioning Method | Sub-Test 1: bit 5 = 1 | +----------------------------------+----------------------------------+ | | Sub-Test 2: bit 1 = 1 | +----------------------------------+----------------------------------+ | | Sub-Test 3: bit 0 and 3 = 1 | +----------------------------------+----------------------------------+ | | Sub-Test 4: bit 0 and 3 and 5 = | | | 1 | | | | | | Sub-Test 8: bit 0 and 1 and 3 = | | | 1 | | | | | | Sub-Test 9: bit 6 = 1 | | | | | | Sub-Test 10: bit 0 and 3 and 6 = | | | 1 | +----------------------------------+----------------------------------+ | - GANSS timing of cell wanted | Not present | +----------------------------------+----------------------------------+ | - GANSS Carrier-Phase | Not present | | Measurement Requested | | +----------------------------------+----------------------------------+ | - GANSS Multi-frequency | Not present | | Measurement Requested | | +----------------------------------+----------------------------------+ | - Measurement validity | | +----------------------------------+----------------------------------+ | - UE state | All states | +----------------------------------+----------------------------------+ | - CHOICE _Reporting criteria_ | | +----------------------------------+----------------------------------+ | - Periodical reporting criteria | For Sub-Tests 1, 9 only | +----------------------------------+----------------------------------+ | - Amount of reporting | 1 | +----------------------------------+----------------------------------+ | - Reporting interval | 64000 | +----------------------------------+----------------------------------+ | - No reporting | For Sub-Tests 2, 3, 4, 8, 10 | | | only | +----------------------------------+----------------------------------+ | - UE pos OTDOA assistance data | Not present | | for UE-assisted | | +----------------------------------+----------------------------------+ | - UE pos OTDOA assistance data | Not present | | for UE-based | | +----------------------------------+----------------------------------+ | - UE positioning GPS assistance | Set as specified for the first | | data | MEASUREMENT CONTROL message for | | | \"Adequate assistance data for | | | UE-based A-GNSS\" in 4.4.1 | +----------------------------------+----------------------------------+ | - UE positioning GANSS | Set as specified for the first | | assistance data | MEASUREMENT CONTROL message for | | | \"Adequate assistance data for | | | UE-based A-GNSS\" in 4.4.1 | +----------------------------------+----------------------------------+ | **Physical Channel Information | | | Elements** | | +----------------------------------+----------------------------------+ | DPCH compressed mode status info | Not present | +----------------------------------+----------------------------------+
MEASUREMENT CONTROL (Step 7a):
+----------------------------------+----------------------------------+ | **Information element** | **Value/remark** | +----------------------------------+----------------------------------+ | **Measurement Information | | | Elements** | | +----------------------------------+----------------------------------+ | Measurement Identity | 10 | +----------------------------------+----------------------------------+ | Measurement Command | Modify | +----------------------------------+----------------------------------+ | Measurement Reporting Mode | | +----------------------------------+----------------------------------+ | - Measurement report transfer | Acknowledged mode RLC | | mode | | +----------------------------------+----------------------------------+ | - Periodical reporting / Event | Periodical reporting | | trigger reporting mode | | +----------------------------------+----------------------------------+ | Additional Measurements List | Not present | +----------------------------------+----------------------------------+ | CHOICE _Measurement type_ | UE positioning measurement | +----------------------------------+----------------------------------+ | - UE positioning measurement | | +----------------------------------+----------------------------------+ | - UE positioning reporting | | | quantity | | +----------------------------------+----------------------------------+ | - Method type | UE based | +----------------------------------+----------------------------------+ | - Positioning methods | GPS | +----------------------------------+----------------------------------+ | - Response time | 128 | +----------------------------------+----------------------------------+ | - Horizontal accuracy | 127 | +----------------------------------+----------------------------------+ | - Vertical accuracy | 127 | +----------------------------------+----------------------------------+ | - GPS timing of cell wanted | FALSE | +----------------------------------+----------------------------------+ | - Multiple sets | FALSE | +----------------------------------+----------------------------------+ | - Additional assistance data | FALSE | | request | | +----------------------------------+----------------------------------+ | - Environmental | Not present | | characterization | | +----------------------------------+----------------------------------+ | - Velocity Requested | Not present | +----------------------------------+----------------------------------+ | - GANSS Positioning Method | Sub-Test 2: bit 1 = 1 | +----------------------------------+----------------------------------+ | | Sub-Test 3: bit 0 and 3 = 1 | +----------------------------------+----------------------------------+ | | Sub-Test 4: bit 0 and 3 and 5 = | | | 1 | | | | | | Sub-Test 8: bit 0 and 1 and 3 = | | | 1 | | | | | | Sub-Test 9: bit 6 = 1 | | | | | | Sub-Test 10: bit 0 and 3 and 6 = | | | 1 | +----------------------------------+----------------------------------+ | - GANSS timing of cell wanted | Not present | +----------------------------------+----------------------------------+ | - GANSS Carrier-Phase | Not present | | Measurement Requested | | +----------------------------------+----------------------------------+ | - GANSS Multi-frequency | Not present | | Measurement Requested | | +----------------------------------+----------------------------------+ | - Measurement validity | | +----------------------------------+----------------------------------+ | - UE state | All states | +----------------------------------+----------------------------------+ | - CHOICE _Reporting criteria_ | | +----------------------------------+----------------------------------+ | - Periodical reporting criteria | For Sub-Tests 2, 3 only | +----------------------------------+----------------------------------+ | - Amount of reporting | 1 | +----------------------------------+----------------------------------+ | - Reporting interval | 64000 | +----------------------------------+----------------------------------+ | - No reporting | For Sub-Tests 4, 8, 10 only | +----------------------------------+----------------------------------+ | - UE pos OTDOA assistance data | Not present | | for UE-assisted | | +----------------------------------+----------------------------------+ | - UE pos OTDOA assistance data | Not present | | for UE-based | | +----------------------------------+----------------------------------+ | - UE positioning GPS assistance | Set as specified for the second | | data | MEASUREMENT CONTROL message for | | | \"Adequate assistance data for | | | UE-based A-GNSS\" in 4.4.1 | +----------------------------------+----------------------------------+ | - UE positioning GANSS | Set as specified for the second | | assistance data | MEASUREMENT CONTROL message for | | | \"Adequate assistance data for | | | UE-based A-GNSS\" in 4.4.1 | +----------------------------------+----------------------------------+ | **Physical Channel Information | | | Elements** | | +----------------------------------+----------------------------------+ | DPCH compressed mode status info | Not present | +----------------------------------+----------------------------------+
MEASUREMENT CONTROL (Step 7b):
+----------------------------------+----------------------------------+ | **Information element** | **Value/remark** | +----------------------------------+----------------------------------+ | **Measurement Information | | | Elements** | | +----------------------------------+----------------------------------+ | Measurement Identity | 10 | +----------------------------------+----------------------------------+ | Measurement Command | Modify | +----------------------------------+----------------------------------+ | Measurement Reporting Mode | | +----------------------------------+----------------------------------+ | - Measurement report transfer | Acknowledged mode RLC | | mode | | +----------------------------------+----------------------------------+ | - Periodical reporting / Event | Periodical reporting | | trigger reporting mode | | +----------------------------------+----------------------------------+ | Additional Measurements List | Not present | +----------------------------------+----------------------------------+ | CHOICE _Measurement type_ | UE positioning measurement | +----------------------------------+----------------------------------+ | - UE positioning measurement | | +----------------------------------+----------------------------------+ | - UE positioning reporting | | | quantity | | +----------------------------------+----------------------------------+ | - Method type | UE based | +----------------------------------+----------------------------------+ | - Positioning methods | GPS | +----------------------------------+----------------------------------+ | - Response time | 128 | +----------------------------------+----------------------------------+ | - Horizontal accuracy | 127 | +----------------------------------+----------------------------------+ | - Vertical accuracy | 127 | +----------------------------------+----------------------------------+ | - GPS timing of cell wanted | FALSE | +----------------------------------+----------------------------------+ | - Multiple sets | FALSE | +----------------------------------+----------------------------------+ | - Additional assistance data | FALSE | | request | | +----------------------------------+----------------------------------+ | - Environmental | Not present | | characterization | | +----------------------------------+----------------------------------+ | - Velocity Requested | Not present | +----------------------------------+----------------------------------+ | - GANSS Positioning Method | Sub-Test 4: bit 0 and 3 and 5 = | | | 1 | | | | | | Sub-Test 8: bit 0 and 1 and 3 = | | | 1 | | | | | | Sub-Test 10: bit 0 and 3 and 6 = | | | 1 | +----------------------------------+----------------------------------+ | - GANSS timing of cell wanted | Not present | +----------------------------------+----------------------------------+ | - GANSS Carrier-Phase | Not present | | Measurement Requested | | +----------------------------------+----------------------------------+ | - GANSS Multi-frequency | Not present | | Measurement Requested | | +----------------------------------+----------------------------------+ | - Measurement validity | | +----------------------------------+----------------------------------+ | - UE state | All states | +----------------------------------+----------------------------------+ | - CHOICE _Reporting criteria_ | | +----------------------------------+----------------------------------+ | - Periodical reporting criteria | | +----------------------------------+----------------------------------+ | - Amount of reporting | 1 | +----------------------------------+----------------------------------+ | - Reporting interval | 64000 | +----------------------------------+----------------------------------+ | - UE pos OTDOA assistance data | Not present | | for UE-assisted | | +----------------------------------+----------------------------------+ | - UE pos OTDOA assistance data | Not present | | for UE-based | | +----------------------------------+----------------------------------+ | - UE positioning GPS assistance | Set as specified for the third | | data | MEASUREMENT CONTROL message for | | | \"Adequate assistance data for | | | UE-based A-GNSS\" in 4.4.1 | +----------------------------------+----------------------------------+ | - UE positioning GANSS | Set as specified for the third | | assistance data | MEASUREMENT CONTROL message for | | | \"Adequate assistance data for | | | UE-based A-GNSS\" in 4.4.1 | +----------------------------------+----------------------------------+ | **Physical Channel Information | | | Elements** | | +----------------------------------+----------------------------------+ | DPCH compressed mode status info | Not present | +----------------------------------+----------------------------------+
MEASUREMENT REPORT (Step 8)
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_ UE positioning measured results \- UE positioning
measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info  
\- CHOICE _Reference time_ GPS or GANSS reference time only \- GPS TOW msec
Not checked \- GANSS TOD msec Not checked \- CHOICE _Position estimate_ One of
'Ellipsoid point with uncertainty Circle' or 'Ellipsoid point with uncertainty
Ellipse' or 'Ellipsoid point with altitude and uncertainty Ellipsoid' \-
Position Data Not checked \- CHOICE _Velocity estimate_ Not present \- UE
positioning GPS measured results Not present \- UE positioning error Not
present \- UE positioning GANSS measured results Not present Measured Results
on secondary UL frequency Not present Measured Results on RACH Not present
Additional Measured Results Not present Additional Measured results on
secondary UL frequency Not present Event Results Not present Event results on
secondary UL frequency Not present Inter-RAT cell info indication Not present
E-UTRA Measured Results Not present E-UTRA Event Results Not present CSG
Proximity Indication Not present
* * *
FACILITY (Step 9)
+----------------------------------+----------------------------------+ | **Information element** | **Value/remark** | +----------------------------------+----------------------------------+ | Supplementary service protocol | 1011 (supplementary services | | discriminator | (call independent)) | +----------------------------------+----------------------------------+ | Transaction identifier | | +----------------------------------+----------------------------------+ | Facility message type | xx11 1010 (FACILITY) | +----------------------------------+----------------------------------+ | Facility | Return Result=LCS‑MOLRRes | | | | | | locationEstimate | +----------------------------------+----------------------------------+
RELEASE COMPLETE (Step 10)
* * *
**Information element** **Value/remark** Supplementary service protocol
discriminator 1011 (supplementary services (call independent)) Transaction
identifier  
Release Complete message type xx10 1010 (RELEASE COMPLETE)
* * *
6.2.2.1.5 Test requirements
After step 5 the UE shall transmit a REGISTER message with an LCS MO-LR
request with the IE \"MOLR-Type\" set to \"locationEstimate\".
After step 7, the UE shall respond with a MEASUREMENT REPORT message.
After step 9, the UE shall send a RELEASE COMPLETE message.
#### 6.2.2.2 MO-LR Position Estimate: UE-Assisted A-GNSS
##### 6.2.2.2.1 Definition {#definition-13 .H6}
This test case applies to all UEs supporting UE-Assisted GANSS or GNSS
Location Service capabilities and providing a method to trigger an MO-LR
request for a position estimate.
##### 6.2.2.2.2 Conformance requirements {#conformance-requirements-14 .H6}
1) The MS invokes a MO-LR by sending a REGISTER message to the network
containing a LCS-MOLR invoke component. SS Version Indicator value 1 or above
shall be used.
2) The network shall pass the result of the location procedure to the MS by
sending a FACILITY message to the MS containing a LCS-MOLR return result
component.
3) After the last location request operation the MS shall terminate the
dialogue by sending a RELEASE COMPLETE message.
##### Reference(s): {#references-14 .H6}
> \- Conformance requirements 1, 2 and 3: TS 24.030, subclause 5.1.1
##### 6.2.2.2.3 Test Purpose {#test-purpose-13 .H6}
To verify the UE behaviour at a mobile originated location request procedure
using network-assisted UE-assisted GNSS.
##### 6.2.2.2.4 Method of Test {#method-of-test-13 .H6}
##### Initial Conditions {#initial-conditions-8 .H6}
> \- System Simulator (SS):
>
> \- 1 cell, default parameters.
>
> \- Satellite signals: As specified in 4.2
>
> \- User Equipment (UE):
>
> \- The UE is in state \"MM idle\" with valid TMSI and CKSN.
>
> \- The UE is in state \"PMM idle\" with valid P-TMSI.
##### Related PICS/PIXIT Statements {#related-picspixit-statements-24 .H6}
\- UE Assisted Network Assisted GANSS.
\- UE Assisted Network Assisted GPS (Sub-tests 3, 4, 8 and 10).
\- Method of triggering an MO-LR request for a position estimate.
##### Test Procedure {#test-procedure-24 .H6}
This test case includes sub-test cases dependent on the GNSS supported by the
UE. Each sub-test case is identified by a Sub-Test Case Number as defined
below:
* * *
**Sub-Test Case Number** **Supported GNSS** 1 UE supporting A-GLONASS only 2
UE supporting A-Galileo only 3 UE supporting A-GPS and Modernized GPS only 4
UE supporting A-GPS^(1)^ and A-GLONASS only 8 UE supporting A-GPS^(1)^ and
A-Galileo only 9 UE supporting A-BDS only 10 UE supporting A-GPS^(1)^ and
A-BDS only NOTE 1: \"A-GPS\" includes Modernized GPS if supported by the UE.
* * *
The UE invokes call independent supplementary service through a CM SERVICE
REQUEST. The SS initiates authentication and ciphering.
The UE invokes an MO-LR request of type \"locationEstimate\".
The SS orders an A-GNSS positioning measurement using a MEASUREMENT CONTROL
message, including assistance data as specified in subclause 4.4.3. The UE may
request additional assistance data by sending a MEASUREMENT REPORT message
containing a positioning error indication with the IE \"Error reason\" set to
\"Assistance Data Missing\". If the UE requests additional assistance data,
the SS provides the requested assistance data in one or more MEASUREMENT
CONTROL messages.
The SS responds with a FACILITY message containing an MO-LR result.
When UE receives the FACILITY message, it clears the transaction by sending a
RELEASE COMPLETE message.
##### Expected Sequence {#expected-sequence-24 .H6}
* * *
**Step** **Direction** **Message** **Comments**  
**UE** **SS**  
1 -> The UE establishes an RRC connection for location service. The SS
verifies that the IE \"Establishment cause\" in the received RRC CONNECTION
REQUEST message is set to \"Originated High Priority Signalling\".  
2 -> CM SERVICE REQUEST The CM service type IE indicates \"call independent
supplementary service\"  
3 \ AUTHENTICATION RESPONSE  
5 SS The SS starts ciphering and integrity protection.  
6 -> REGISTER Call Independent SS containing Facility IE with an LCS MO-LR
request of type \"locationEstimate\".  
7 \ MEASUREMENT REPORT UE reports positioning measurement results (Option 1)
or requests additional assistance data (Option 2).  
8a \ MEASUREMENT REPORT If UE requested additional assistance data in step 8,
this message contains the IE \"UE positioning GANSS measured results\" and
\"UE positioning GPS measured results\" (Sub-tests 3, 4, 8 and 10).  
9 \ RELEASE COMPLETE The UE terminates the dialogue  
11 SS The SS releases the RRC connection and the test case ends
* * *
##### Specific Message Contents {#specific-message-contents-24 .H6}
##### REGISTER (Step 6): {#register-step-6-4 .H6}
+----------------------------------+----------------------------------+ | **Information element** | **Value/remark** | +----------------------------------+----------------------------------+ | Supplementary service protocol | 1011 (supplementary services | | discriminator | (call independent)) | +----------------------------------+----------------------------------+ | Transaction identifier | | +----------------------------------+----------------------------------+ | Register message type | xx11 1011 (REGISTER) | +----------------------------------+----------------------------------+ | Facility | Invoke=LCS-MOLR | | | | | | molr-Type ->locationEstimate | +----------------------------------+----------------------------------+ | SS version | Version 1 or above | +----------------------------------+----------------------------------+
##### MEASUREMENT CONTROL (Step 7): {#measurement-control-step-7-7 .H6}
+----------------------------------+----------------------------------+ | **Information element** | **Value/remark** | +----------------------------------+----------------------------------+ | **Measurement Information | | | Elements** | | +----------------------------------+----------------------------------+ | Measurement Identity | 10 | +----------------------------------+----------------------------------+ | Measurement Command | Setup | +----------------------------------+----------------------------------+ | Measurement Reporting Mode | | +----------------------------------+----------------------------------+ | - Measurement report transfer | Acknowledged mode RLC | | mode | | +----------------------------------+----------------------------------+ | - Periodical reporting / Event | Periodical reporting | | trigger reporting mode | | +----------------------------------+----------------------------------+ | Additional Measurements List | Not present | +----------------------------------+----------------------------------+ | CHOICE _Measurement type_ | UE positioning measurement | +----------------------------------+----------------------------------+ | - UE positioning measurement | | +----------------------------------+----------------------------------+ | - UE positioning reporting | | | quantity | | +----------------------------------+----------------------------------+ | - Method type | UE assisted | +----------------------------------+----------------------------------+ | - Positioning methods | GPS | +----------------------------------+----------------------------------+ | - Response time | 128 | +----------------------------------+----------------------------------+ | - Horizontal accuracy | 127 | +----------------------------------+----------------------------------+ | - Vertical accuracy | 127 | +----------------------------------+----------------------------------+ | - GPS timing of cell wanted | FALSE | +----------------------------------+----------------------------------+ | - Multiple sets | FALSE | +----------------------------------+----------------------------------+ | - Additional assistance data | TRUE | | request | | +----------------------------------+----------------------------------+ | - Environmental | Not present | | characterization | | +----------------------------------+----------------------------------+ | - Velocity Requested | Not present | +----------------------------------+----------------------------------+ | - GANSS Positioning Method | Sub-Test 1: bit 5 = 1 | +----------------------------------+----------------------------------+ | | Sub-Test 2: bit 1 = 1 | +----------------------------------+----------------------------------+ | | Sub-Test 3: bit 0 and 3 = 1 | +----------------------------------+----------------------------------+ | | Sub-Test 4: bit 0 and 3 and 5 = | | | 1 | | | | | | Sub-Test 8: bit 0 and 1 and 3 = | | | 1 | | | | | | Sub-Test 9: bit 6 = 1 | | | | | | Sub-Test 10: bit 0 and 3 and 6 = | | | 1 | +----------------------------------+----------------------------------+ | - GANSS timing of cell wanted | Not present | +----------------------------------+----------------------------------+ | - GANSS Carrier-Phase | Not present | | Measurement Requested | | +----------------------------------+----------------------------------+ | - GANSS Multi-frequency | Set according to UE capabilities | | Measurement Requested | | +----------------------------------+----------------------------------+ | - Measurement validity | | +----------------------------------+----------------------------------+ | - UE state | All states | +----------------------------------+----------------------------------+ | - CHOICE _Reporting criteria_ | | +----------------------------------+----------------------------------+ | - Periodical reporting criteria | | +----------------------------------+----------------------------------+ | - Amount of reporting | 1 | +----------------------------------+----------------------------------+ | - Reporting interval | 64000 | +----------------------------------+----------------------------------+ | - UE pos OTDOA assistance data | Not present | | for UE-assisted | | +----------------------------------+----------------------------------+ | - UE pos OTDOA assistance data | Not present | | for UE-based | | +----------------------------------+----------------------------------+ | - UE positioning GPS assistance | Set as specified for \"Adequate | | data | assistance data for UE-assisted | | | A-GNSS\" in 4.4.3 | +----------------------------------+----------------------------------+ | - UE positioning GANSS | Set as specified for \"Adequate | | assistance data | assistance data for UE-assisted | | | A-GNSS\" in 4.4.3 | +----------------------------------+----------------------------------+ | **Physical Channel Information | | | Elements** | | +----------------------------------+----------------------------------+ | DPCH compressed mode status info | Not present | +----------------------------------+----------------------------------+
##### MEASUREMENT REPORT (Step 8 (Option 1) or 8b (Option 2)): {#measurement-
report-step-8-option-1-or-8b-option-2-1 .H6}
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_ UE positioning measured results \- UE positioning
measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info Not present \- UE positioning GPS measured results
Present for Sub-Tests 3, 4, 8 and 10 \- UE positioning error Not present \- UE
positioning GANSS measured results Present Measured Results on secondary UL
frequency Not present Measured Results on RACH Not present Additional Measured
Results Not present Additional Measured results on secondary UL frequency Not
present Event Results Not present Event results on secondary UL frequency Not
present Inter-RAT cell info indication Not present E-UTRA Measured Results Not
present E-UTRA Event Results Not present CSG Proximity Indication Not present
* * *
##### MEASUREMENT REPORT (Step 8 (Option 2)): {#measurement-report-
step-8-option-2-1 .H6}
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_ UE positioning measured results \- UE positioning
measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info Not present \- UE positioning GPS measured results Not
present \- UE positioning error  
\- Error reason Assistance Data Missing \- GPS Additional Assistance Data
Request Not checked \- GANSS Additional Assistance Data Request Not checked \-
UE positioning GANSS measured results Not present Measured Results on
secondary UL frequency Not present Measured Results on RACH Not present
Additional Measured Results Not present Additional Measured results on
secondary UL frequency Not present Event Results Not present Event results on
secondary UL frequency Not present Inter-RAT cell info indication Not present
E-UTRA Measured Results Not present E-UTRA Event Results Not present CSG
Proximity Indication Not present
* * *
##### MEASUREMENT CONTROL (Step 8a (Option 2)): {#measurement-control-
step-8a-option-2-1 .H6}
+----------------------------------+----------------------------------+ | **Information element** | **Value/remark** | +----------------------------------+----------------------------------+ | **Measurement Information | | | Elements** | | +----------------------------------+----------------------------------+ | Measurement Identity | 10 | +----------------------------------+----------------------------------+ | Measurement Command | Modify | +----------------------------------+----------------------------------+ | Measurement Reporting Mode | | +----------------------------------+----------------------------------+ | - Measurement report transfer | Acknowledged mode RLC | | mode | | +----------------------------------+----------------------------------+ | - Periodical reporting / Event | Periodical reporting | | trigger reporting mode | | +----------------------------------+----------------------------------+ | Additional Measurements List | Not present | +----------------------------------+----------------------------------+ | CHOICE _Measurement type_ | UE positioning measurement | +----------------------------------+----------------------------------+ | - UE positioning measurement | | +----------------------------------+----------------------------------+ | - UE positioning reporting | | | quantity | | +----------------------------------+----------------------------------+ | - Method type | UE assisted | +----------------------------------+----------------------------------+ | - Positioning methods | GPS | +----------------------------------+----------------------------------+ | - Response time | 128 | +----------------------------------+----------------------------------+ | - Horizontal accuracy | 127 | +----------------------------------+----------------------------------+ | - Vertical accuracy | 127 | +----------------------------------+----------------------------------+ | - GPS timing of cell wanted | FALSE | +----------------------------------+----------------------------------+ | - Multiple sets | FALSE | +----------------------------------+----------------------------------+ | - Additional assistance data | FALSE | | request | | +----------------------------------+----------------------------------+ | - Environmental | Not present | | characterization | | +----------------------------------+----------------------------------+ | - Velocity Requested | Not present | +----------------------------------+----------------------------------+ | - GANSS Positioning Method | Sub-Test 1: bit 5 = 1 | +----------------------------------+----------------------------------+ | | Sub-Test 2: bit 1 = 1 | +----------------------------------+----------------------------------+ | | Sub-Test 3: bit 0 and 3 = 1 | +----------------------------------+----------------------------------+ | | Sub-Test 4: bit 0 and 3 and 5 = | | | 1 | | | | | | Sub-Test 8: bit 0 and 1 and 3 = | | | 1 | | | | | | Sub-Test 9: bit 6 = 1 | | | | | | Sub-Test 10: bit 0 and 3 and 6 = | | | 1 | +----------------------------------+----------------------------------+ | - GANSS timing of cell wanted | Not present | +----------------------------------+----------------------------------+ | - GANSS Carrier-Phase | Not present | | Measurement Requested | | +----------------------------------+----------------------------------+ | - GANSS Multi-frequency | Set according to UE capabilities | | Measurement Requested | | +----------------------------------+----------------------------------+ | - Measurement validity | | +----------------------------------+----------------------------------+ | - UE state | All states | +----------------------------------+----------------------------------+ | - CHOICE _Reporting criteria_ | | +----------------------------------+----------------------------------+ | - Periodical reporting criteria | | +----------------------------------+----------------------------------+ | - Amount of reporting | 1 | +----------------------------------+----------------------------------+ | - Reporting interval | 64000 | +----------------------------------+----------------------------------+ | - UE pos OTDOA assistance data | Not present | | for UE-assisted | | +----------------------------------+----------------------------------+ | - UE pos OTDOA assistance data | Not present | | for UE-based | | +----------------------------------+----------------------------------+ | - UE positioning GPS assistance | Set as specified in 4.4.5 | | data | | +----------------------------------+----------------------------------+ | - UE positioning GANSS | Set as specified in 4.4.5 | | assistance data | | +----------------------------------+----------------------------------+ | **Physical Channel Information | | | Elements** | | +----------------------------------+----------------------------------+ | DPCH compressed mode status info | Not present | +----------------------------------+----------------------------------+
##### FACILITY (Step 9): {#facility-step-9-2 .H6}
+----------------------------------+----------------------------------+ | **Information element** | **Value/remark** | +----------------------------------+----------------------------------+ | Supplementary service protocol | 1011 (supplementary services | | discriminator | (call independent)) | +----------------------------------+----------------------------------+ | Transaction identifier | | +----------------------------------+----------------------------------+ | Facility message type | xx11 1010 (FACILITY) | +----------------------------------+----------------------------------+ | Facility | Return Result=LCS‑MOLRRes | | | | | | locationEstimate | | | | | | Any values may be used. The SS | | | shall not be required to | | | calculate the value from the | | | returned measurements. | +----------------------------------+----------------------------------+
##### RELEASE COMPLETE (Step 10): {#release-complete-step-10-2 .H6}
* * *
**Information element** **Value/remark** Supplementary service protocol
discriminator 1011 (supplementary services (call independent)) Transaction
identifier  
Release Complete message type xx10 1010 (RELEASE COMPLETE)
* * *
##### 6.2.2.2.5 Test requirements {#test-requirements-13 .H6}
After step 5 the UE shall transmit a REGISTER message with an LCS MO-LR
request with the IE \"MOLR-Type\" set to \"locationEstimate\".
After step 7, the UE shall send a MEASUREMENT REPORT message containing the IE
\"UE positioning GPS measured results\" and/or \"UE positioning GANSS measured
results\".
After step 9, the UE shall send a RELEASE COMPLETE message.
#### 6.2.2.3 MO-LR Position Estimate: UE-Based A-GNSS -- Failure Not Enough
Satellites
##### 6.2.2.3.1 Definition {#definition-14 .H6}
This test case applies to all UEs supporting UE-Based GANSS or GNSS Location
Service capabilities and providing a method to trigger an MO-LR request for a
position estimate.
##### 6.2.2.3.2 Conformance requirements {#conformance-requirements-15 .H6}
> 1) The MS invokes a MO-LR by sending a REGISTER message to the network
> containing a LCS-MOLR invoke component. SS Version Indicator value 1 or
> above shall be used.
>
> 2) if the IE \"Measurement command\" has the value \"modify\":
>
> 2> for all IEs present in the MEASUREMENT CONTROL message:
>
> 3> if a measurement was stored in the variable MEASUREMENT_IDENTITY
> associated to the identity by the IE \"measurement identity\":
>
> 4> if measurement type is set to \"UE positioning measurement\" and the IE
> \"UE positioning GPS assistance data\" is present, for any of the optional
> IEs \"UE positioning GPS reference time\", \"UE positioning GPS reference UE
> position\", \"UE positioning GPS DGPS corrections\", \"UE positioning GPS
> ionospheric model\", \"UE positioning GPS UTC model\", \"UE positioning GPS
> acquisition assistance\", \"UE positioning GPS real-time integrity\" that
> are present in the MEASUREMENT CONTROL message:
>
> 4> if measurement type is set to \"UE positioning measurement\" and the IE
> \"UE positioning GANSS assistance data\" is present, for any of the optional
> IEs \"UE positioning GANSS reference time\", \"UE positioning GANSS
> reference UE position\", \"UE positioning DGANSS corrections\", \"UE
> positioning GANSS ionospheric model\", \"UE positioning GANSS additional
> ionospheric model\", \"UE positioning GANSS UTC model\", \"UE positioning
> GANSS additional UTC models\", \"UE positioning GANSS reference measurement
> information\", \"UE positioning GANSS data bit assistance\", \"UE
> positioning GANSS Time model\", \"UE positioning GANSS real-time
> integrity\", \"UE positioning GANSS Earth orientation parameters\", \"UE
> positioning GANSS auxiliary information\" that are present in the
> MEASUREMENT CONTROL message:
>
> 5> replace all instances of the IEs listed above (and all their children)
> stored in variable MEASUREMENT_IDENTITY associated to the identity indicated
> by the IE \"measurement identity\" with the IEs received in the MEASUREMENT
> CONTROL message;
>
> 5> leave all other stored information elements unchanged in the variable
> MEASUREMENT_IDENTITY.
>
> 3) If the IE \"UE positioning GPS Navigation Model\" is included, for each
> satellite, the UE shall:
>
> 1> use IE \"Satellite Status\" to determine if an update of IE \"UE
> positioning GPS Ephemeris and Clock Correction parameters\" has been
> provided for the satellite indicated by the IE \"SatID\";
>
> 1> if an update has been provided for this satellite:
>
> 2> act as specified in subclause 8.6.7.19.3.4.
If the IE \"UE positioning GPS Ephemeris and Clock Correction parameters\" is
included, for each satellite, the UE shall:
> 1> update the variable UE_POSITIONING_GPS_DATA as follows:
>
> 2> store this IE at the position indicated by the IE \"Sat ID\" in the IE
> \"UE positioning GPS Navigation Model\" in the variable
> UE_POSITIONING_GPS_DATA, possibly overwriting any existing information in
> this position.
>
> 1> act on these GPS ephemeris and clock correction parameters in a manner
> similar to that specified in [12].
>
> 4) If the IE \"UE positioning GANSS Navigation Model\" is included, the UE
> shall:
>
> 1> for each GANSS:
>
> 2> for each satellite, the UE shall:
>
> 3> for IE \"UE positioning GANSS clock model\":
>
> 4> act as specified in subclause 8.6.7.19.7.4a.
>
> 3> for IE \"UE positioning GANSS orbit model\":
>
> 4> act as specified in subclause 8.6.7.19.7.4b.
>
> 5) If the IE \"UE positioning GANSS clock model\" is included, the UE shall:
>
> 1> for each GANSS:
>
> 2> update the variable UE_POSITIONING_GANSS_DATA as follows:
>
> 3> store this IE at the position indicated by the IE \"Sat ID\" in the IE
> \"UE positioning GANSS Navigation Model\" in the variable
> UE_POSITIONING_GANSS_DATA, possibly overwriting any existing information in
> this position.
>
> 2> act on these GANSS clock models in a manner similar to that specified in
> a relevant ICD.
>
> 6) If the IE \"UE positioning GANSS orbit model\" is included, for each
> satellite of each supported GNSS, the UE shall:
>
> 1> update the variable UE_POSITIONING_GANSS_DATA as follows:
>
> 2> store this IE at the position indicated by the IE \"Sat ID\" in the IE
> \"UE positioning GANSS Navigation Model\" in the variable
> UE_POSITIONING_GANSS_DATA, possibly overwriting any existing information in
> this position..
>
> 1> act on these GANSS orbit models in a manner similar to that specified in
> a relevant ICD.
>
> 7) The UE shall when a measurement report is triggered:
>
> 2> if the UE has been able to calculate a position after performing
> measurements on the cells included in the variable
> UE_POSITIONING_OTDOA_DATA_UE_BASED in case of OTDOA or the UE has been able
> to calculate a position in case of GPS or GANSS positioning or the UE has
> been able to calculate a position using a standalone positioning method:
>
> 3> include IE \"UE positioning Position Estimate Info\" in the MEASUREMENT
> REPORT and set the contents of the IE as follows:
>
> 4> if the UE supports the capability to perform the UE GPS timing of cell
> frames measurement:
>
> 5> if the IE \"GPS timing of Cell wanted\" is set to TRUE:
>
> 6> perform the UE GPS timing of cell frames measurement on the serving cell
> or on one cell of the active set.
>
> 6> include the IE \"Primary CPICH Info\" for FDD or the IE \"cell parameters
> id\" for TDD;
>
> 6> include the SFN when the position was determined;
>
> 6> include the IE \"UE GPS timing of cell frames\";
>
> 6> include the IE \"UE Positioning GPS Reference Time Uncertainty\".
>
> 5> if the IE \"GPS timing of Cell wanted\" is set to FALSE:
>
> 6> include the IE \"GPS TOW msec\" and set it to the GPS TOW when the
> position estimate was valid.
>
> 4> if the position was calculated with GPS; and
>
> 4> the UE does not support the capability to provide the GPS timing of the
> cell:
>
> 5> include the IE \"GPS TOW msec\" and set it to the GPS TOW when the
> position estimate was valid.
>
> 4> if the UE supports the capability to provide the GANSS timing of the cell
> frames measurement:
>
> 5> if the IE \"GANSS timing of Cell wanted\" is included with one bit set to
> value one for a supported GANSS:
>
> 6> perform the UE GANSS timing of cell frames measurement on the serving
> cell or on one cell of the active set;
>
> 6> include the IE \"GANSS Time ID\" to identify the GNSS system time;
>
> 6> include the IE \"Primary CPICH Info\" for FDD or the IE \"cell parameters
> id\" for TDD; and
>
> 6> include the IE \"Reference SFN\" and the IE \"UE GANSS timing of cell
> frames\".
>
> 5> if the IE \"GANSS timing of Cell wanted\" is not included, or included
> with each bit set to value zero:
>
> 6> include the IE \"GANSS TOD msec\" and set it to the GANSS TOD when the
> position estimate was valid.
>
> 4> if the UE does not support the capability to provide the GANSS timing of
> the cell:
>
> 5> include the IE \"GANSS TOD msec\" and set it to the GANSS TOD when the
> position estimate was valid;
>
> 5> include the IE \"GANSS Time ID\" to identify the GNSS system time.
>
> 4> if IE \"Vertical Accuracy\" has been included in IE \"UE positioning
> reporting quantity\":
>
> 5> if the IE \"Vertical Accuracy\" has been assigned to value \"0\":
>
> 6> if the IE \"Horizontal Accuracy\" has been assigned a value \"0\":
>
> 7> may include IE \"Ellipsoid point with altitude\".
>
> 6> if the IE \"Horizontal Accuracy\" has been assigned a value unequal to
> \"0\"; and
>
> 6> if the UE has been able to calculate a 3-dimensional position
>
> 7> include IE \"Ellipsoid point with altitude\" or IE \"Ellipsoid point with
> altitude and uncertainty ellipsoid\" as the position estimate.
>
> 6> if the UE has not been able to calculate a 3-dimensional position:
>
> 7> may act as if IE \"Vertical Accuracy\" was not included in IE \"UE
> positioning reporting quantity\".
>
> 5> if the IE \"Vertical Accuracy\" has been assigned to a value unequal to
> \"0\":
>
> 6> if the UE has been able to calculate a 3-dimensional position:
>
> 7> include IE \"Ellipsoid point with altitude and uncertainty ellipsoid\" as
> the position estimate.
>
> 6> if the UE has not been able to calculate a 3-dimensional position:
>
> 7> act as if IE \"Vertical Accuracy\" has not been included in IE \"UE
> positioning reporting quantity\".
>
> 4> if IE \"Vertical Accuracy\" has not been included in IE \"UE positioning
> reporting quantity\":
>
> 5> if IE \"Horizontal Accuracy\" in IE \"UE positioning reporting quantity\"
> has been assigned to value \"0\":
>
> 6> may include IE \"Ellipsoid point\".
>
> 5> if IE \"Horizontal Accuracy\" in IE \"UE positioning reporting quantity\"
> has been assigned to a value unequal to 0:
>
> 6> include either IE \"Ellipsoid point with uncertainty circle\" or IE
> \"Ellipsoid point with uncertainty ellipse\" or IE \"Ellipsoid point with
> altitude and uncertainty ellipsoid\" as the position estimate.
>
> 4> if any of the IEs \"Ellipsoid point with uncertainty ellipse\" or
> \"Ellipsoid point with altitude and uncertainty ellipsoid\" is reported:
>
> 5> should calculate a value of the IE \"Confidence\", different from \"0\",
> as the probability that the UE is located within the uncertainty region of
> the one of the IEs \"Ellipsoid point with uncertainty ellipse\" or
> \"Ellipsoid point with altitude and uncertainty ellipsoid\" that is
> reported.
>
> NOTE: The value \"0\" of the IE \"Confidence\" is interpreted as \"no
> information\" by the UTRAN [57].
>
> 4> if IE \"Velocity Requested\" has been included in IE \"UE positioning
> reporting quantity\":
>
> 5> include IE \"Velocity estimate\" if supported and available.
>
> 2> if the UE was not able to calculate a position:
>
> 3> include IE \"UE positioning error\" in the MEASUREMENT REPORT and set the
> contents of this IE as specified in subclause 8.6.7.19.5.
>
> 8) The UE shall set the contents of the IE \"UE positioning Error\" as
> follows:
...
> 1> if the IE \"Positioning Methods\" in IE \"UE positioning reporting
> quantity\" has been assigned to value \"GPS\" and the IE \"GANSS Positioning
> Methods\" is present:
>
> 2> if there were not enough GANSS satellites to be received:
>
> 3> set IE \"Error reason\" to \"Not Enough GANSS Satellites\".
>
> 2> if some GANSS assistance data was missing:
>
> 3> set IE \"Error reason\" to \"Assistance Data Missing\"; and
>
> 3> if the IE \"Additional Assistance Data Request\" included in the IE \"UE
> positioning reporting quantity\" stored in the variable MEASUREMENT_IDENTITY
> is set to TRUE:
>
> 4> include the IE \"GANSS Additional Assistance Data Request\".
>
> 3> if the IE \"Additional Assistance Data Request\" included in the IE \"UE
> positioning reporting quantity\" stored in the variable MEASUREMENT_IDENTITY
> is set to FALSE:
>
> 4> not include the IE \"GANSS Additional Assistance Data Request\", and use
> the assistance data available for doing a positioning estimate.
>
> 9) If the network is unable to successfully fulfil the request received from
> the MS (e.g. to provide a location estimate or location assistance
> information), it shall clear the transaction by sending a RELEASE COMPLETE
> message containing a return error component. Error values are specified in
> 3GPP TS 24.080.
>
> 10) PositionMethodFailure: This error is returned by the network when the
> network is unable to obtain any of the location information requested or
> none of the information obtained satisfies the requested LCS QoS or if
> requested LCS assistance data could not be transferred or requested
> deciphering keys for broadcast assistance data could not be returned.
##### Reference(s): {#references-15 .H6}
\- Conformance requirements 1 and 9: TS 24.030, subclause 5.1.1
\- Conformance requirement 2: TS 25.331, subclause 8.4.1.3.
\- Conformance requirement 3: TS 25.331, subclauses 8.6.7.19.3.3a,
8.6.7.19.3.4.
\- Conformance requirement 4: TS 25.331, subclause 8.6.7.19.7.4
\- Conformance requirement 5: TS 25.331, subclause 8.6..7.19.4a
\- Conformance requirement 6: TS 25.331, subclause 8.6.7.19.4b
\- Conformance requirement 7: TS 25.331, subclause 8.6.7.19.1b
\- Conformance requirement 8: TS 25.331, subclause 8.6.7.19.1b
\- Conformance requirement 9: TS 25.331, subclause 8.6.7.19.5
\- Conformance requirement 10: TS 24.080, subclause 4.3.2.29
##### 6.2.2.3.3 Test Purpose {#test-purpose-14 .H6}
To verify the UE behaviour at a mobile originated location request procedure
using network-assisted UE-based GNSS when the MO-LR procedure fails due to
failure of positioning method.
##### 6.2.2.3.4 Method of Test {#method-of-test-14 .H6}
##### Initial Conditions {#initial-conditions-9 .H6}
\- System Simulator (SS):
\- 1 cell, default parameters.
\- Satellite signals switched off or not present.
\- User Equipment (UE):
\- The UE is in state "MM idle" with valid TMSI and CKSN.
\- The UE is in state "PMM idle" with valid P-TMSI
##### Related PICS/PIXIT Statements {#related-picspixit-statements-25 .H6}
\- UE Based Network Assisted GANSS.
\- UE Based Network Assisted GPS (Sub-tests 3, 4, 8 and 10).
\- Method of triggering an MO-LR request for a position estimate.
##### Test Procedure {#test-procedure-25 .H6}
This test case includes sub-test cases dependent on the GNSS supported by the
UE. Each sub-test case is identified by a Sub-Test Case Number as defined
below:
* * *
**Sub-Test Case Number** **Supported GNSS** 1 UE supporting A-GLONASS only 2
UE supporting A-Galileo only 3 UE supporting A-GPS and Modernized GPS only 4
UE supporting A-GPS^(1)^ and A-GLONASS only 8 UE supporting A-GPS^(1)^ and
A-Galileo only 9 UE supporting A-BDS only 10 UE supporting A-GPS^(1)^ and
A-BDS only NOTE 1: "A-GPS" includes Modernized GPS if supported by the UE.
* * *
The UE invokes call independent supplementary service through a CM SERVICE
REQUEST. The SS initiates authentication and ciphering.
The UE invokes an MO-LR request of type \"locationEstimate\".
The SS orders an A-GNSS positioning measurement using one or more (dependent
on the Sub-Test) MEASUREMENT CONTROL messages.
The UE sends a MEASUREMENT REPORT message with a positioning error indication.
The SS sends a RELEASE COMPLETE message containing a return error component.
##### Expected Sequence {#expected-sequence-25 .H6}
* * *
**Step** **Direction** **Message** **Comments**  
**UE** **SS**  
1 -> The UE establishes an RRC connection for location service. The SS
verifies that the IE \"Establishment cause\" in the received RRC CONNECTION
REQUEST message is set to \"Originated High Priority Signalling\".  
2 -> CM SERVICE REQUEST The CM service type IE indicates \"call independent
supplementary service\"  
3 \ AUTHENTICATION RESPONSE  
5 SS The SS starts ciphering and integrity protection.  
6 -> REGISTER Call Independent SS containing Facility IE with an LCS MO-LR
request of type \"locationEstimate\".  
7 \ MEASUREMENT REPORT Positioning error report \"not enough GANSS
satellites\" or \"not enough GPS satellites\" (sub-tests 3, 4, 8 and 10 only)  
9 SS SS is unable to fulfil the MO-LR request  
10 \locationEstimate | +----------------------------------+----------------------------------+ | SS version | Version 1 or above | +----------------------------------+----------------------------------+
MEASUREMENT CONTROL (Step 7):
+----------------------------------+----------------------------------+ | **Information element** | **Value/remark** | +----------------------------------+----------------------------------+ | **Measurement Information | | | Elements** | | +----------------------------------+----------------------------------+ | Measurement Identity | 10 | +----------------------------------+----------------------------------+ | Measurement Command | Setup | +----------------------------------+----------------------------------+ | Measurement Reporting Mode | | +----------------------------------+----------------------------------+ | - Measurement report transfer | Acknowledged mode RLC | | mode | | +----------------------------------+----------------------------------+ | - Periodical reporting / Event | Periodical reporting | | trigger reporting mode | | +----------------------------------+----------------------------------+ | Additional Measurements List | Not present | +----------------------------------+----------------------------------+ | CHOICE _Measurement type_ | UE positioning measurement | +----------------------------------+----------------------------------+ | - UE positioning measurement | | +----------------------------------+----------------------------------+ | - UE positioning reporting | | | quantity | | +----------------------------------+----------------------------------+ | - Method type | UE based | +----------------------------------+----------------------------------+ | - Positioning methods | GPS | +----------------------------------+----------------------------------+ | - Response time | 128 | +----------------------------------+----------------------------------+ | - Horizontal accuracy | 127 | +----------------------------------+----------------------------------+ | - Vertical accuracy | 127 | +----------------------------------+----------------------------------+ | - GPS timing of cell wanted | FALSE | +----------------------------------+----------------------------------+ | - Multiple sets | FALSE | +----------------------------------+----------------------------------+ | - Additional assistance data | FALSE | | request | | +----------------------------------+----------------------------------+ | - Environmental | Not present | | characterization | | +----------------------------------+----------------------------------+ | - Velocity Requested | Not present | +----------------------------------+----------------------------------+ | - GANSS Positioning Method | Sub-Test 1: bit 5 = 1 | +----------------------------------+----------------------------------+ | | Sub-Test 2: bit 1 = 1 | +----------------------------------+----------------------------------+ | | Sub-Test 3: bit 0 and 3 = 1 | +----------------------------------+----------------------------------+ | | Sub-Test 4: bit 0 and 3 and 5 = | | | 1 | | | | | | Sub-Test 8: bit 0 and 1 and 3 = | | | 1 | | | | | | Sub-Test 9: bit 6 = 1 | | | | | | Sub-Test 10: bit 0 and 3 and 6 = | | | 1 | +----------------------------------+----------------------------------+ | - GANSS timing of cell wanted | Not present | +----------------------------------+----------------------------------+ | - GANSS Carrier-Phase | Not present | | Measurement Requested | | +----------------------------------+----------------------------------+ | - GANSS Multi-frequency | Not present | | Measurement Requested | | +----------------------------------+----------------------------------+ | - Measurement validity | | +----------------------------------+----------------------------------+ | - UE state | All states | +----------------------------------+----------------------------------+ | - CHOICE _Reporting criteria_ | | +----------------------------------+----------------------------------+ | - Periodical reporting criteria | For Sub-Tests 1, 9 only | +----------------------------------+----------------------------------+ | - Amount of reporting | 1 | +----------------------------------+----------------------------------+ | - Reporting interval | 64000 | +----------------------------------+----------------------------------+ | - No reporting | For Sub-Tests 2, 3, 4, 8, 10 | | | only | +----------------------------------+----------------------------------+ | - UE pos OTDOA assistance data | Not present | | for UE-assisted | | +----------------------------------+----------------------------------+ | - UE pos OTDOA assistance data | Not present | | for UE-based | | +----------------------------------+----------------------------------+ | - UE positioning GPS assistance | Set as specified for the first | | data | MEASUREMENT CONTROL message for | | | \"Adequate assistance data for | | | UE-based A-GNSS\" in 4.4.1 | +----------------------------------+----------------------------------+ | - UE positioning GANSS | Set as specified for the first | | assistance data | MEASUREMENT CONTROL message for | | | \"Adequate assistance data for | | | UE-based A-GNSS\" in 4.4.1 | +----------------------------------+----------------------------------+ | **Physical Channel Information | | | Elements** | | +----------------------------------+----------------------------------+ | DPCH compressed mode status info | Not present | +----------------------------------+----------------------------------+
MEASUREMENT CONTROL (Step 7a):
+----------------------------------+----------------------------------+ | **Information element** | **Value/remark** | +----------------------------------+----------------------------------+ | **Measurement Information | | | Elements** | | +----------------------------------+----------------------------------+ | Measurement Identity | 10 | +----------------------------------+----------------------------------+ | Measurement Command | Modify | +----------------------------------+----------------------------------+ | Measurement Reporting Mode | | +----------------------------------+----------------------------------+ | - Measurement report transfer | Acknowledged mode RLC | | mode | | +----------------------------------+----------------------------------+ | - Periodical reporting / Event | Periodical reporting | | trigger reporting mode | | +----------------------------------+----------------------------------+ | Additional Measurements List | Not present | +----------------------------------+----------------------------------+ | CHOICE _Measurement type_ | UE positioning measurement | +----------------------------------+----------------------------------+ | - UE positioning measurement | | +----------------------------------+----------------------------------+ | - UE positioning reporting | | | quantity | | +----------------------------------+----------------------------------+ | - Method type | UE based | +----------------------------------+----------------------------------+ | - Positioning methods | GPS | +----------------------------------+----------------------------------+ | - Response time | 128 | +----------------------------------+----------------------------------+ | - Horizontal accuracy | 127 | +----------------------------------+----------------------------------+ | - Vertical accuracy | 127 | +----------------------------------+----------------------------------+ | - GPS timing of cell wanted | FALSE | +----------------------------------+----------------------------------+ | - Multiple sets | FALSE | +----------------------------------+----------------------------------+ | - Additional assistance data | FALSE | | request | | +----------------------------------+----------------------------------+ | - Environmental | Not present | | characterization | | +----------------------------------+----------------------------------+ | - Velocity Requested | Not present | +----------------------------------+----------------------------------+ | - GANSS Positioning Method | Sub-Test 2: bit 1 = 1 | +----------------------------------+----------------------------------+ | | Sub-Test 3: bit 0 and 3 = 1 | +----------------------------------+----------------------------------+ | | Sub-Test 4: bit 0 and 3 and 5 = | | | 1 | | | | | | Sub-Test 8: bit 0 and 1 and 3 = | | | 1 | | | | | | Sub-Test 9: bit 6 = 1 | | | | | | Sub-Test 10: bit 0 and 3 and 6 = | | | 1 | +----------------------------------+----------------------------------+ | - GANSS timing of cell wanted | Not present | +----------------------------------+----------------------------------+ | - GANSS Carrier-Phase | Not present | | Measurement Requested | | +----------------------------------+----------------------------------+ | - GANSS Multi-frequency | Not present | | Measurement Requested | | +----------------------------------+----------------------------------+ | - Measurement validity | | +----------------------------------+----------------------------------+ | - UE state | All states | +----------------------------------+----------------------------------+ | - CHOICE _Reporting criteria_ | | +----------------------------------+----------------------------------+ | - Periodical reporting criteria | For Sub-Tests 2, 3 only | +----------------------------------+----------------------------------+ | - Amount of reporting | 1 | +----------------------------------+----------------------------------+ | - Reporting interval | 64000 | +----------------------------------+----------------------------------+ | - No reporting | For Sub-Tests 4, 8, 10 only | +----------------------------------+----------------------------------+ | - UE pos OTDOA assistance data | Not present | | for UE-assisted | | +----------------------------------+----------------------------------+ | - UE pos OTDOA assistance data | Not present | | for UE-based | | +----------------------------------+----------------------------------+ | - UE positioning GPS assistance | Set as specified for the second | | data | MEASUREMENT CONTROL message for | | | \"Adequate assistance data for | | | UE-based A-GNSS\" in 4.4.1 | +----------------------------------+----------------------------------+ | - UE positioning GANSS | Set as specified for the second | | assistance data | MEASUREMENT CONTROL message for | | | \"Adequate assistance data for | | | UE-based A-GNSS\" in 4.4.1 | +----------------------------------+----------------------------------+ | **Physical Channel Information | | | Elements** | | +----------------------------------+----------------------------------+ | DPCH compressed mode status info | Not present | +----------------------------------+----------------------------------+
MEASUREMENT CONTROL (Step 7b):
+----------------------------------+----------------------------------+ | **Information element** | **Value/remark** | +----------------------------------+----------------------------------+ | **Measurement Information | | | Elements** | | +----------------------------------+----------------------------------+ | Measurement Identity | 10 | +----------------------------------+----------------------------------+ | Measurement Command | Modify | +----------------------------------+----------------------------------+ | Measurement Reporting Mode | | +----------------------------------+----------------------------------+ | - Measurement report transfer | Acknowledged mode RLC | | mode | | +----------------------------------+----------------------------------+ | - Periodical reporting / Event | Periodical reporting | | trigger reporting mode | | +----------------------------------+----------------------------------+ | Additional Measurements List | Not present | +----------------------------------+----------------------------------+ | CHOICE _Measurement type_ | UE positioning measurement | +----------------------------------+----------------------------------+ | - UE positioning measurement | | +----------------------------------+----------------------------------+ | - UE positioning reporting | | | quantity | | +----------------------------------+----------------------------------+ | - Method type | UE based | +----------------------------------+----------------------------------+ | - Positioning methods | GPS | +----------------------------------+----------------------------------+ | - Response time | 128 | +----------------------------------+----------------------------------+ | - Horizontal accuracy | 127 | +----------------------------------+----------------------------------+ | - Vertical accuracy | 127 | +----------------------------------+----------------------------------+ | - GPS timing of cell wanted | FALSE | +----------------------------------+----------------------------------+ | - Multiple sets | FALSE | +----------------------------------+----------------------------------+ | - Additional assistance data | FALSE | | request | | +----------------------------------+----------------------------------+ | - Environmental | Not present | | characterization | | +----------------------------------+----------------------------------+ | - Velocity Requested | Not present | +----------------------------------+----------------------------------+ | - GANSS Positioning Method | Sub-Test 4: bit 0 and 3 and 5 = | | | 1 | | | | | | Sub-Test 8: bit 0 and 1 and 3 = | | | 1 | | | | | | Sub-Test 10: bit 0 and 3 and 6 = | | | 1 | +----------------------------------+----------------------------------+ | - GANSS timing of cell wanted | Not present | +----------------------------------+----------------------------------+ | - GANSS Carrier-Phase | Not present | | Measurement Requested | | +----------------------------------+----------------------------------+ | - GANSS Multi-frequency | Not present | | Measurement Requested | | +----------------------------------+----------------------------------+ | - Measurement validity | | +----------------------------------+----------------------------------+ | - UE state | All states | +----------------------------------+----------------------------------+ | - CHOICE _Reporting criteria_ | | +----------------------------------+----------------------------------+ | - Periodical reporting criteria | | +----------------------------------+----------------------------------+ | - Amount of reporting | 1 | +----------------------------------+----------------------------------+ | - Reporting interval | 64000 | +----------------------------------+----------------------------------+ | - UE pos OTDOA assistance data | Not present | | for UE-assisted | | +----------------------------------+----------------------------------+ | - UE pos OTDOA assistance data | Not present | | for UE-based | | +----------------------------------+----------------------------------+ | - UE positioning GPS assistance | Set as specified for the third | | data | MEASUREMENT CONTROL message for | | | \"Adequate assistance data for | | | UE-based A-GNSS\" in 4.4.1 | +----------------------------------+----------------------------------+ | - UE positioning GANSS | Set as specified for the third | | assistance data | MEASUREMENT CONTROL message for | | | \"Adequate assistance data for | | | UE-based A-GNSS\" in 4.4.1 | +----------------------------------+----------------------------------+ | **Physical Channel Information | | | Elements** | | +----------------------------------+----------------------------------+ | DPCH compressed mode status info | Not present | +----------------------------------+----------------------------------+
MEASUREMENT REPORT (Step 8)
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_ UE positioning measured results \- UE positioning
measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info Not present \- UE positioning GPS measured results Not
present \- UE positioning error  
\- Error reason notEnoughGANSS-Satellites or notEnoughGPS-Satellites (sub-
tests 3, 4, 8 and 10 only) \- UE positioning GANSS measured results Not
present Measured Results on secondary UL frequency Not present Measured
Results on RACH Not present Additional Measured Results Not present Additional
Measured results on secondary UL frequency Not present Event Results Not
present Event results on secondary UL frequency Not present Inter-RAT cell
info indication Not present E-UTRA Measured Results Not present E-UTRA Event
Results Not present CSG Proximity Indication Not present
* * *
RELEASE COMPLETE (Step 10)
+-------------------------+------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+------------------------------------+ | Transaction identifier | | +-------------------------+------------------------------------+ | Message type | RELEASE COMPLETE (0010 1010) | | | | | Facility | Return error = LCS-MOLR | | | | | | Error -> positionMethodFailure | +-------------------------+------------------------------------+
##### 6.2.2.3.5 Test requirements {#test-requirements-14 .H6}
After step 5 the UE shall transmit a REGISTER message with an LCS MO-LR
request with the IE \"MOLR-Type\" set to \"locationEstimate\".
After step 7b, the UE shall respond with a MEASUREMENT REPORT message.
#### 6.2.2.4 MO-LR Assistance Data: UE-Based or UE-Assisted A-GNSS - Success
##### 6.2.2.4.1 Definition {#definition-15 .H6}
This test case applies to all UEs supporting UE-Based or UE-Assisted GANSS or
GNSS Location Service capabilities and providing a method to trigger an MO-LR
request for a assistance data.
##### 6.2.2.4.2 Conformance requirements {#conformance-requirements-16 .H6}
> 1) The UE invokes a MO-LR by sending a REGISTER message to the network
> containing a LCS-MOLR invoke component. SS Version Indicator value 1 or
> above shall be used.
>
> 2) The network shall send a FACILITY message to the UE containing a LCS-MOLR
> return result component.
>
> 3) After the last location request operation the UE shall terminate the
> dialogue by sending a RELEASE COMPLETE message.
Reference(s):
> \- Conformance requirements 1, 2 and 3: TS 24.030, subclause 5.1.1
##### 6.2.2.4.3 Test Purpose {#test-purpose-15 .H6}
To verify the UE behaviour at a mobile originated location request procedure
using network-assisted UE-based or UE-assisted GNSS.
##### 6.2.2.4.4 Method of Test {#method-of-test-15 .H6}
Initial Conditions
\- System Simulator (SS):
\- 1 cell, default parameters.
\- Satellite signal s: As specified in 4.2
\- User Equipment (UE):
\- The UE is in state "MM idle" with valid TMSI and CKSN.
\- The UE is in state "PMM idle" with valid P-TMSI.
##### Related PICS/PIXIT Statements {#related-picspixit-statements-26 .H6}
\- UE Based Network Assisted GANSS.
\- UE Based Network Assisted GPS (Sub-tests 3, 4, 8 and 10).
\- UE Assisted Network Assisted GANSS.
\- UE Assisted Network Assisted GPS (Sub-tests 3, 4, 8 and 10).
\- Method of triggering an MO-LR request for assistance data.
##### Test Procedure {#test-procedure-26 .H6}
This test case includes sub-test cases dependent on the GNSS supported by the
UE. Each sub-test case is identified by a Sub-Test Case Number as defined
below:
* * *
**Sub-Test Case Number** **Supported GNSS** 1 UE supporting A-GLONASS only 2
UE supporting A-Galileo only 3 UE supporting A-GPS and Modernized GPS only 4
UE supporting A-GPS^(1)^ and A-GLONASS only 8 UE supporting A-GPS^(1)^ and
A-Galileo only 9 UE supporting A-BDS only 10 UE supporting A-GPS^(1)^ and
A-BDS only NOTE 1: "A-GPS" includes Modernized GPS if supported by the UE.
* * *
The UE invokes call independent supplementary service through a CM SERVICE
REQUEST. The SS initiates authentication and ciphering.
The UE invokes an MO-LR request of type \"AssistanceData\".
The SS transmits an ASSISTANCE DATA delivery message with assistance data.
When the assistance data delivery was successful, the SS sends a FACILITY
message to the UE.
The SS responds with a FACILITY message containing an MO-LR result.
When the UE receives the FACILITY message, it clears the transaction by
sending a RELEASE COMPLETE message.
##### Expected Sequence {#expected-sequence-26 .H6}
* * *
**Step** **Direction** **Message** **Comments**  
**UE** **SS**  
1 -> The UE establishes an RRC connection for location service. The SS
verifies that the IE \"Establishment cause\" in the received RRC CONNECTION
REQUEST message is set to \"Originated High Priority Signalling\".  
2 -> CM SERVICE REQUEST The CM service type IE indicates \"call independent
supplementary service\"  
3 \ AUTHENTICATION RESPONSE  
5 SS The SS starts ciphering and integrity protection.  
6 -> REGISTER Call Independent SS containing Facility IE with an LCS MO-LR
request of type \"AssistanceData\".  
7 \ RELEASE COMPLETE The UE terminates the dialogue  
10 SS The SS releases the RRC connection and the test case ends.
* * *
+-------------------------+-------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+-------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+-------------------------------------------+ | Transaction identifier | | +-------------------------+-------------------------------------------+ | Message type | REGISTER (xx11 1011) | +-------------------------+-------------------------------------------+ | Facility | For sub-tests 1, 2, 9: | | | | | | Invoke = LCS-MOLR | | | | | | LCS-MOLRArg | | | | | | molr-Type ->assistanceData | | | | | | locationMethod -> assistedGANSS | | | | | | ganssAssistanceData -> OCTET STRING\ | | | Octets 1 to 40 are coded in the same way\ | | | as the octets 3 to 9+2n of Requested\ | | | GANSS Data IE in 3GPP TS 49.031 | | | | | | For sub-tests 3, 4, 8 and 10: | | | | | | Invoke = LCS-MOLR | | | | | | LCS-MOLRArg | | | | | | molr-Type ->assistanceData | | | | | | locationMethod ->assistedGPSandGANSS | | | | | | gpsAssistanceData -> OCTET STRING\ | | | Octets 1 to 38 are coded in the same way\ | | | as octets 3 to 7+2n of Requested GPS\ | | | Data IE in 3GPP TS 49.031 | | | | | | ganssAssistanceData -> OCTET STRING\ | | | Octets 1 to 40 are coded in the same way\ | | | as the octets 3 to 9+2n of requested\ | | | GANSS Data IE in 3GPP TS 49.031 | +-------------------------+-------------------------------------------+ | SS Version | Value 1 or above | +-------------------------+-------------------------------------------+
ASSISTANCE DATA DELIVERY (Step 7):
* * *
**Information element** **Value/remark**
**Measurement Information Elements**
UE positioning OTDOA assistance data for UE-based Not present
UE positioning GPS assistance data Not present for sub-tests 1, 2 and 9.\ For
sub-tests 3, 4, 8 and 10 set as specified in 4.4.5
UE positioning GANSS assistance data Set as specified in 4.4.5
* * *
FACILITY (Step 8)
+----------------------------------+----------------------------------+ | **Information element** | **Value/remark** | +----------------------------------+----------------------------------+ | Supplementary service protocol | 1011 (supplementary services | | discriminator | (call independent)) | +----------------------------------+----------------------------------+ | Transaction identifier | | +----------------------------------+----------------------------------+ | Facility message type | xx11 1010 (FACILITY) | +----------------------------------+----------------------------------+ | Facility | Return Result=LCS‑MOLRRes | | | | | | EMPTY | +----------------------------------+----------------------------------+
RELEASE COMPLETE (Step 9)
* * *
**Information element** **Value/remark** Supplementary service protocol
discriminator 1011 (supplementary services (call independent)) Transaction
identifier  
Release Complete message type xx10 1010 (RELEASE COMPLETE)
* * *
##### 6.2.2.4.5 Test requirements {#test-requirements-15 .H6}
After step 5 the UE shall transmit a REGISTER message with an LCS MO-LR
request with the IE \"MOLR-Type\" set to \"assistanceData\".
After step 8, the UE shall send a RELEASE COMPLETE message.
#### 6.2.2.5 MO-LR Assistance Data: UE-Based or UE-Assisted A-GNSS - Failure
##### 6.2.2.5.1 Definition {#definition-16 .H6}
This test case applies to all UEs supporting UE-Based or UE-Assisted GANSS or
GNSS Location Service capabilities and providing a method to trigger an MO-LR
request for assistance data.
##### 6.2.2.5.2 Conformance requirements {#conformance-requirements-17 .H6}
1) The UE invokes a MO-LR by sending a REGISTER message to the network
containing a LCS-MOLR invoke component.
2) If the network is unable to successfully fulfil the request received from
the UE (e.g. to provide a location estimate or location assistance
information), it shall clear the transaction by sending a RELEASE COMPLETE
message containing a return error component. Error values are specified in
3GPP TS 24.080.
3) PositionMethodFailure: This error is returned by the network when the
network is unable to obtain any of the location information requested or none
of the information obtained satisfies the requested LCS QoS or if requested
LCS assistance data could not be transferred or requested deciphering keys for
broadcast assistance data could not be returned.
Reference(s):
\- Conformance requirements 1 and 2: TS 24.030, subclause 5.1.1
\- Conformance requirement 3: TS 24.080, subclause 4.3.2.29
##### 6.2.2.5.3 Test Purpose {#test-purpose-16 .H6}
To verify the UE behaviour at a mobile originated location request for
assistance data where the network is unable to provide the requested
assistance data.
##### 6.2.2.5.4 Method of Test {#method-of-test-16 .H6}
##### Initial Conditions {#initial-conditions-10 .H6}
\- System Simulator (SS):
\- 1 cell, default parameters.
\- Satellite signals: As specified in 4.2
\- User Equipment (UE):
The UE shall begin the test with neither GPS nor GANSS assistance data stored.
\- The UE is in state "MM idle" with valid TMSI and CKSN.
\- The UE is in state "PMM idle" with valid P-TMSI
##### Related PICS/PIXIT Statements {#related-picspixit-statements-27 .H6}
\- UE Based Network Assisted GANSS.
\- UE Based Network Assisted GPS (Sub-tests 3, 4, 8 and 10).
\- UE Assisted Network Assisted GANSS.
\- UE Assisted Network Assisted GPS (Sub-tests 3, 4, 8 and 10).
\- Method of triggering an MO-LR request for assistance data.
##### Test Procedure {#test-procedure-27 .H6}
This test case includes sub-test cases dependent on the GNSS supported by the
UE. Each sub-test case is identified by a Sub-Test Case Number as defined
below:
* * *
**Sub-Test Case Number** **Supported GNSS** 1 UE supporting A-GLONASS only 2
UE supporting A-Galileo only 3 UE supporting A-GPS and Modernized GPS only 4
UE supporting A-GPS^(1)^ and A-GLONASS only 8 UE supporting A-GPS^(1)^ and
A-Galileo only 9 UE supporting A-BDS only 10 UE supporting A-GPS^(1)^ and
A-BDS only NOTE 1: \"A-GPS\" includes Modernized GPS if supported by the UE.
* * *
The UE invokes call independent supplementary service through a CM SERVICE
REQUEST. The SS initiates authentication and ciphering.
The UE invokes an MO-LR request of type \"assistanceData\".
The SS is unable to provide the requested assistance data.
The SS sends a RELEASE COMPLETE message containing a return error component.
##### Expected Sequence {#expected-sequence-27 .H6}
* * *
**Step** **Direction** **Message** **Comments**  
**UE** **SS**  
1 -> The UE establishes an RRC connection for location service. The SS
verifies that the IE \"Establishment cause\" in the received RRC CONNECTION
REQUEST message is set to \"Originated High Priority Signalling\".  
2 -> CM SERVICE REQUEST The CM service type IE indicates \"call independent
supplementary service\"  
3 \ AUTHENTICATION RESPONSE  
5 SS The SS starts ciphering and integrity protection.  
6 -> REGISTER Call Independent SS containing Facility IE with an LCS MO-LR
request of type \"AssistanceData\".  
7 SS SS is unable to provide the requested assistance data  
8 \assistanceData | | | | | | locationMethod -> assistedGANSS | | | | | | ganssAssistanceData -> OCTET STRING | | | | | | Octets 1 to 40 are coded in the\ | | | same way as octets 3 to 9+2n of\ | | | Requested GANSS Data IE in 3GPP\ | | | TS 49.031 | | | | | | Sub-tests 3, 4, 8 and 10: | | | | | | Invoke = LCS-MOLR | | | | | | LCS-MOLRArg | | | | | | molr-Type ->assistanceData | | | | | | LocationMethod ->assistedGPSandGANSS | | | | | | gpsAssistanceData -> OCTET STRING\ | | | Octets 1 to 38 are coded in the same way\ | | | as octets 3 to 7+2n of Requested GPS\ | | | Data IE in 3GPP TS 49.031 | | | | | | ganssAssistanceData -> OCTET STRING\ | | | Octets 1 to 40 are coded in the same way\ | | | as the octets 3 to 9+2n of requested\ | | | GANSS Data IE in 3GPP TS 49.031 | | | | | | Value 1 or above | +-------------------------+-------------------------------------------+
RELEASE COMPLETE (Step 8)
+-------------------------+------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+------------------------------------+ | Transaction identifier | | +-------------------------+------------------------------------+ | Message type | RELEASE COMPLETE (0010 1010) | | | | | Facility | Return error = LCS-MOLR | | | | | | Error -> positionMethodFailure | +-------------------------+------------------------------------+
##### 6.2.2.5.5 Test requirements {#test-requirements-16 .H6}
After step 5 the UE shall transmit a REGISTER message with an LCS MO-LR
request with the IE \"MOLR-Type\" set to \"assistanceData\".
During step 9 the UE shall not send any RELEASE COMPLETE message.
### 6.2.3 Assisted GNSS Mobile Terminated Tests
#### 6.2.3.1 MT-LR: UE-based or UE-Assisted A-GNSS -- Request for additional
assistance data/ Success
##### 6.2.3.1.1 Definition {#definition-17 .H6}
This test case applies to all UEs supporting UE-Based or UE-Assisted GANSS or
GNSS Location Service capabilities.
##### 6.2.3.1.2 Conformance requirements {#conformance-requirements-18 .H6}
> 1) if the IE \"Measurement command\" has the value \"modify\":
>
> 2> for all IEs present in the MEASUREMENT CONTROL message:
>
> 3> if a measurement was stored in the variable MEASUREMENT_IDENTITY
> associated to the identity by the IE \"measurement identity\":
>
> 4> if measurement type is set to \"UE positioning measurement\" and the IE
> \"UE positioning GPS assistance data\" is present, for any of the optional
> IEs \"UE positioning GPS reference time\", \"UE positioning GPS reference UE
> position\", \"UE positioning GPS DGPS corrections\", \"UE positioning GPS
> ionospheric model\", \"UE positioning GPS UTC model\", \"UE positioning GPS
> acquisition assistance\", \"UE positioning GPS real-time integrity\" that
> are present in the MEASUREMENT CONTROL message:
>
> 4> if measurement type is set to \"UE positioning measurement\" and the IE
> \"UE positioning GANSS assistance data\" is present, for any of the optional
> IEs \"UE positioning GANSS reference time\", \"UE positioning GANSS
> reference UE position\", \"UE positioning DGANSS corrections\", \"UE
> positioning GANSS ionospheric model\", \"UE positioning GANSS additional
> ionospheric model\", \"UE positioning GANSS UTC model\", \"UE positioning
> GANSS additional UTC models\", \"UE positioning GANSS reference measurement
> information\", \"UE positioning GANSS data bit assistance\", \"UE
> positioning GANSS Time model\", \"UE positioning GANSS real-time
> integrity\", \"UE positioning GANSS Earth orientation parameters\", \"UE
> positioning GANSS auxiliary information\" that are present in the
> MEASUREMENT CONTROL message:
>
> 5> replace all instances of the IEs listed above (and all their children)
> stored in variable MEASUREMENT_IDENTITY associated to the identity indicated
> by the IE \"measurement identity\" with the IEs received in the MEASUREMENT
> CONTROL message;
>
> 5> leave all other stored information elements unchanged in the variable
> MEASUREMENT_IDENTITY.
>
> 2) If the IE \"UE positioning GPS Navigation Model\" is included, for each
> satellite, the UE shall:
>
> 1> use IE \"Satellite Status\" to determine if an update of IE \"UE
> positioning GPS Ephemeris and Clock Correction parameters\" has been
> provided for the satellite indicated by the IE \"SatID\";
>
> 1> if an update has been provided for this satellite:
>
> 2> act as specified in subclause 8.6.7.19.3.4.
>
> If the IE \"UE positioning GPS Ephemeris and Clock Correction parameters\"
> is included, for each satellite, the UE shall:
>
> 1> update the variable UE_POSITIONING_GPS_DATA as follows:
>
> 2> store this IE at the position indicated by the IE \"Sat ID\" in the IE
> \"UE positioning GPS Navigation Model\" in the variable
> UE_POSITIONING_GPS_DATA, possibly overwriting any existing information in
> this position.
>
> 1> act on these GPS ephemeris and clock correction parameters in a manner
> similar to that specified in [12].
>
> 3) If the IE \"UE positioning GANSS Navigation Model\" is included, the UE
> shall:
>
> 1> for each GANSS:
>
> 2> for each satellite, the UE shall:
>
> 3> for IE \"UE positioning GANSS clock model\":
>
> 4> act as specified in subclause 8.6.7.19.7.4a.
>
> 3> for IE \"UE positioning GANSS orbit model\":
>
> 4> act as specified in subclause 8.6.7.19.7.4b.
>
> 4) If the IE \"UE positioning GANSS clock model\" is included, the UE shall:
>
> 1> for each GANSS:
>
> 2> update the variable UE_POSITIONING_GANSS_DATA as follows:
>
> 3> store this IE at the position indicated by the IE \"Sat ID\" in the IE
> \"UE positioning GANSS Navigation Model\" in the variable
> UE_POSITIONING_GANSS_DATA, possibly overwriting any existing information in
> this position.
>
> 2> act on these GANSS clock models in a manner similar to that specified in
> a relevant ICD.
>
> 5) If the IE \"UE positioning GANSS orbit model\" is included, for each
> satellite of each supported GNSS, the UE shall:
>
> 1> update the variable UE_POSITIONING_GANSS_DATA as follows:
>
> 2> store this IE at the position indicated by the IE \"Sat ID\" in the IE
> \"UE positioning GANSS Navigation Model\" in the variable
> UE_POSITIONING_GANSS_DATA, possibly overwriting any existing information in
> this position..
>
> 1> act on these GANSS orbit models in a manner similar to that specified in
> a relevant ICD.
>
> 6) The UE shall when a measurement report is triggered:
>
> 2> if the UE has been able to calculate a position after performing
> measurements on the cells included in the variable
> UE_POSITIONING_OTDOA_DATA_UE_BASED in case of OTDOA or the UE has been able
> to calculate a position in case of GPS or GANSS positioning or the UE has
> been able to calculate a position using a standalone positioning method:
>
> 3> include IE \"UE positioning Position Estimate Info\" in the MEASUREMENT
> REPORT and set the contents of the IE as follows:
>
> 4> if the UE supports the capability to perform the UE GPS timing of cell
> frames measurement:
>
> 5> if the IE \"GPS timing of Cell wanted\" is set to TRUE:
>
> 6> perform the UE GPS timing of cell frames measurement on the serving cell
> or on one cell of the active set.
>
> 6> include the IE \"Primary CPICH Info\" for FDD or the IE \"cell parameters
> id\" for TDD;
>
> 6> include the SFN when the position was determined;
>
> 6> include the IE \"UE GPS timing of cell frames\";
>
> 6> include the IE \"UE Positioning GPS Reference Time Uncertainty\".
>
> 5> if the IE \"GPS timing of Cell wanted\" is set to FALSE:
>
> 6> include the IE \"GPS TOW msec\" and set it to the GPS TOW when the
> position estimate was valid.
>
> 4> if the position was calculated with GPS; and
>
> 4> the UE does not support the capability to provide the GPS timing of the
> cell:
>
> 5> include the IE \"GPS TOW msec\" and set it to the GPS TOW when the
> position estimate was valid.
>
> 4> if the UE supports the capability to provide the GANSS timing of the cell
> frames measurement:
>
> 5> if the IE \"GANSS timing of Cell wanted\" is included with one bit set to
> value one for a supported GANSS:
>
> 6> perform the UE GANSS timing of cell frames measurement on the serving
> cell or on one cell of the active set;
>
> 6> include the IE \"GANSS Time ID\" to identify the GNSS system time;
>
> 6> include the IE \"Primary CPICH Info\" for FDD or the IE \"cell parameters
> id\" for TDD; and
>
> 6> include the IE \"Reference SFN\" and the IE \"UE GANSS timing of cell
> frames\".
>
> 5> if the IE \"GANSS timing of Cell wanted\" is not included, or included
> with each bit set to value zero:
>
> 6> include the IE \"GANSS TOD msec\" and set it to the GANSS TOD when the
> position estimate was valid.
>
> 4> if the UE does not support the capability to provide the GANSS timing of
> the cell:
>
> 5> include the IE \"GANSS TOD msec\" and set it to the GANSS TOD when the
> position estimate was valid;
>
> 5> include the IE \"GANSS Time ID\" to identify the GNSS system time.
>
> 4> if IE \"Vertical Accuracy\" has been included in IE \"UE positioning
> reporting quantity\":
>
> 5> if the IE \"Vertical Accuracy\" has been assigned to value \"0\":
>
> 6> if the IE \"Horizontal Accuracy\" has been assigned a value \"0\":
>
> 7> may include IE \"Ellipsoid point with altitude\".
>
> 6> if the IE \"Horizontal Accuracy\" has been assigned a value unequal to
> \"0\"; and
>
> 6> if the UE has been able to calculate a 3-dimensional position
>
> 7> include IE \"Ellipsoid point with altitude\" or IE \"Ellipsoid point with
> altitude and uncertainty ellipsoid\" as the position estimate.
>
> 6> if the UE has not been able to calculate a 3-dimensional position:
>
> 7> may act as if IE \"Vertical Accuracy\" was not included in IE \"UE
> positioning reporting quantity\".
>
> 5> if the IE \"Vertical Accuracy\" has been assigned to a value unequal to
> \"0\":
>
> 6> if the UE has been able to calculate a 3-dimensional position:
>
> 7> include IE \"Ellipsoid point with altitude and uncertainty ellipsoid\" as
> the position estimate.
>
> 6> if the UE has not been able to calculate a 3-dimensional position:
>
> 7> act as if IE \"Vertical Accuracy\" has not been included in IE \"UE
> positioning reporting quantity\".
>
> 4> if IE \"Vertical Accuracy\" has not been included in IE \"UE positioning
> reporting quantity\":
>
> 5> if IE \"Horizontal Accuracy\" in IE \"UE positioning reporting quantity\"
> has been assigned to value \"0\":
>
> 6> may include IE \"Ellipsoid point\".
>
> 5> if IE \"Horizontal Accuracy\" in IE \"UE positioning reporting quantity\"
> has been assigned to a value unequal to 0:
>
> 6> include either IE \"Ellipsoid point with uncertainty circle\" or IE
> \"Ellipsoid point with uncertainty ellipse\" or IE \"Ellipsoid point with
> altitude and uncertainty ellipsoid\" as the position estimate.
>
> 4> if any of the IEs \"Ellipsoid point with uncertainty ellipse\" or
> \"Ellipsoid point with altitude and uncertainty ellipsoid\" is reported:
>
> 5> should calculate a value of the IE \"Confidence\", different from \"0\",
> as the probability that the UE is located within the uncertainty region of
> the one of the IEs \"Ellipsoid point with uncertainty ellipse\" or
> \"Ellipsoid point with altitude and uncertainty ellipsoid\" that is
> reported.
>
> NOTE: The value \"0\" of the IE \"Confidence\" is interpreted as \"no
> information\" by the UTRAN [57].
>
> 4> if IE \"Velocity Requested\" has been included in IE \"UE positioning
> reporting quantity\":
>
> 5> include IE \"Velocity estimate\" if supported and available.
>
> 2> if the UE was not able to calculate a position:
>
> 3> include IE \"UE positioning error\" in the MEASUREMENT REPORT and set the
> contents of this IE as specified in subclause 8.6.7.19.5.
7) The UE shall:
> 1> when a measurement report is triggered:
>
> 2> if the UE was able to perform measurements on at least one neighbour cell
> included in the variable UE_POSITIONING_OTDOA_DATA_UE_ASSISTED in case of
> OTDOA or one satellite included in the variable UE_POSITIONING_GPS_DATA in
> case of GPS positioning or one cell from the active set in case of CELL ID:
>
> 3> if the IE \"Vertical Accuracy\" is included:
>
> 4> interpret the presence of this IE to indicate that the UTRAN desires to
> compute a 3-dimensional position estimate.
>
> if the IE \"Positioning Methods\" is set to \"GPS\" and the IE \"GANSS
> Positioning Methods\" is present indicating other GNSS than GPS allowed and
> if any of these other GNSSs is measured:
>
> 4> include the IE \"UE positioning GANSS measured results\" in the
> measurement report and set the contents of the IE as follows:
>
> 5> if the UE supports the capability to provide the GANSS timing of the cell
> frames measurement:
>
> 6> if the IE \"GANSS timing of Cell wanted\" is included with one bit set to
> value one for a supported GANSS and if IE \"UE GPS timing of cell frames\"
> is not present:
>
> 7> perform the UE GANSS timing of cell frames measurement on the serving
> cell or on one cell of the active set;
>
> 7> include the IE \"Primary CPICH Info\" for FDD or the IE \"cell parameters
> id\" for TDD; and
>
> 7> include the IE \"Reference SFN\" and the IE \"UE GANSS timing of cell
> frames\".
>
> 6> if the IE \"GANSS timing of Cell wanted\" is not included, or included
> with each bit set to value zero and if IE \"UE positioning GPS measured
> results\" is not present:
>
> 7> include the IE \"GANSS TOD msec\" and set it to the GANSS TOD when the
> measurements included in the MEASUREMENT REPORT were valid.
>
> 5> if the UE does not support the capability to provide the GANSS timing of
> the cell and if IE \"UE positioning GPS measured results\" is not present:
>
> 6> include the IE \"GANSS TOD msec\" and set it to the GANSS TOD when the
> measurements included in the MEASUREMENT REPORT were valid.
>
> 5> if the UE supports the capability to provide the GANSS carrier-phase
> measurements:
>
> 6> if the IE \"GANSS Carrier-Phase Measurement Requested\" is included with
> one bit set to value one for a supported GANSS:
>
> 7> include the IE \"Carrier Quality Indication\" and include the IE \"ADR\".
>
> 5> if the UE supports the capability to perform GANSS measurements on
> multiple GANSS frequencies:
>
> 6> if the IE \"GANSS Multi-frequency Measurement Requested\" is included
> with one bit set to value one for a supported GANSS, and if any of these
> GANSS signals are measured:
>
> 7> include the IE \"GANSS Signal Measurement Information\" for each measured
> GANSS signal.
8) 1> if the UE is unable to report the requested measurement results due to
missing GPS assistance data:
> 2> the UE may at anytime send a measurement report containing the IE \"UE
> positioning error\" and set the contents of this IE as specified in
> subclause 8.6.7.19.5.
>
> 2> after sending the measurement report, the UE shall not send another
> measurement report to request the same GPS assistance data for at least 20s.
> This requirement does not apply after release of the current RRC connection.
>
> 1> if the UE is unable to report the requested measurement results due to
> missing GANSS assistance data:
>
> 2> the UE may at anytime send a measurement report containing the IE \"UE
> positioning error\" and set the contents of this IE as specified in
> subclause 8.6.7.19.5;
>
> 2> after sending the measurement report, the UE shall not send another
> measurement report to request the same GANSS assistance data for at least
> 20s. This requirement does not apply after release of the current RRC
> connection.
>
> 9) The UE shall set the contents of the IE \"UE positioning Error\" as
> follows:
...
> 1> if the IE \"Positioning Methods\" in IE \"UE positioning reporting
> quantity\" has been assigned to value \"GPS\" and the IE \"GANSS Positioning
> Methods\" is present:
>
> 2> if there were not enough GANSS satellites to be received:
>
> 3> set IE \"Error reason\" to \"Not Enough GANSS Satellites\".
>
> 2> if some GANSS assistance data was missing:
>
> 3> set IE \"Error reason\" to \"Assistance Data Missing\"; and
>
> 3> if the IE \"Additional Assistance Data Request\" included in the IE \"UE
> positioning reporting quantity\" stored in the variable MEASUREMENT_IDENTITY
> is set to TRUE:
>
> 4> include the IE \"GANSS Additional Assistance Data Request\".
>
> 3> if the IE \"Additional Assistance Data Request\" included in the IE \"UE
> positioning reporting quantity\" stored in the variable MEASUREMENT_IDENTITY
> is set to FALSE:
>
> 4> not include the IE \"GANSS Additional Assistance Data Request\", and use
> the assistance data available for doing a positioning estimate.
Reference(s):
\- Conformance requirement 1: TS 25.331, subclause 8.4.1.3.
\- Conformance requirement 2: TS 25.331, subclauses 8.6.7.19.3.3a,
8.6.7.19.3.4.
\- Conformance requirement 3: TS 25.331, subclause 8.6.7.19.7.4
\- Conformance requirement 4: TS 25.331, subclause 8.6.7.19.7.4a
\- Conformance requirement 5: TS 25.331, subclause 8.6.7.19.7.4b
\- Conformance requirement 6: TS 25.331, subclause 8.6.7.19.1b
\- Conformance requirement 7: TS 25.331, subclause 8.6.7.19.1a
\- Conformance requirement 8: TS 25.331, subclause 8.6.7.19.1a, 8.6.7.19.1b
\- Conformance requirement 9: TS 25.331, subclause 8.6.7.19.5
##### 6.2.3.1.3 Test Purpose {#test-purpose-17 .H6}
To verify the UE's behaviour in a mobile-terminated location request procedure
using UE-based or UE-assisted A-GNSS with assistance data from the network.
To verify that the UE in CELL_DCH state accepts assistance data received in
multiple MEASUREMENT CONTROL messages.
To verify that the UE includes the IE \"GPS Additional Assistance Data
Request\" or \"GANSS Additional Assistance Data Request\" to request
assistance data when it does not have enough assistance data.
##### 6.2.3.1.4 Method of Test {#method-of-test-17 .H6}
Initial Conditions
> \- System Simulator (SS):
>
> \- 1 cell, default parameters.
>
> \- Satellite signals: As specified in 4.2.
>
> \- User Equipment (UE):
>
> \- The UE is in state \"MM idle\" with valid TMSI and CKSN.
>
> \- The UE is in state \"PMM idle\" with valid P-TMSI.
>
> \- The UE shall begin the test with no GPS and GANSS assistance data stored.
##### Related PICS/PIXIT Statements {#related-picspixit-statements-28 .H6}
> \- UE Based Network Assisted GANSS.
>
> \- UE Assisted Network Assisted GANSS
>
> \- UE Based Network Assisted GPS (Sub-tests 3. 4, 8 and 10).
>
> \- UE Assisted Network Assisted GPS (Sub-tests 3, 4, 8 and 10).
>
> \- Method of clearing stored GPS/GANSS assistance data.
##### Test Procedure {#test-procedure-28 .H6}
This test case includes sub-test cases dependent on the GNSS supported by the
UE. Each sub-test case is identified by a Sub-Test Case Number as defined
below:
* * *
**Sub-Test Case Number** **Supported GNSS** 1 UE supporting A-GLONASS only 2
UE supporting A-Galileo only 3 UE supporting A-GPS and Modernized GPS only 4
UE supporting A-GPS^(1)^ and A-GLONASS only 8 UE supporting A-GPS^(1)^ and
A-Galileo only 9 UE supporting A-BDS only 10 UE supporting A-GPS^(1)^ and
A-BDS only NOTE 1: "A-GPS" includes Modernized GPS if supported by the UE.
* * *
The stored GPS/GANSS assistance data in the UE shall be cleared.
The SS initiates authentication and ciphering and orders a positioning
measurement using a MEASUREMENT CONTROL message including no assistance data.
The UE sends a MEASUREMENT REPORT message to report a positioning error,
requesting further assistance data. The SS response with one or more
MEASUREMENT CONTROL messages that include the requested assistance data and
instructs the UE not to repeat the request for assistance data. The final
MEASUREMENT CONTROL message orders periodic reporting.
The UE performs positioning measurements and responds with a MEASUREMENT
REPORT message including the IE \"UE Positioning Position Estimate Info\" in
case of UE-based, or including the IE \"UE positioning GANSS measured
results\" and/or \"UE positioning GPS measured results\" in case of UE-
assisted.
##### Expected Sequence {#expected-sequence-28 .H6}
+----------+---------------+-----------------+-----------------+---+ | **Step** | **Direction** | **Message** | **Comments** | | +----------+---------------+-----------------+-----------------+---+ | | **UE** | **SS** | | | +----------+---------------+-----------------+-----------------+---+ | 1 | \ | AUTHENTICATION | | | | | | RESPONSE | | | +----------+---------------+-----------------+-----------------+---+ | 3 | SS | | The SS starts | | | | | | ciphering and | | | | | | integrity | | | | | | protection. | | +----------+---------------+-----------------+-----------------+---+ | 4 | | Void | | | +----------+---------------+-----------------+-----------------+---+ | 5 | | Void | | | +----------+---------------+-----------------+-----------------+---+ | 6 | | Void | | | +----------+---------------+-----------------+-----------------+---+ | 7 | \ | MEASUREMENT | Positioning | | | | | REPORT | error report | | | | | | 'Assistance | | | | | | Data Missing' | | +----------+---------------+-----------------+-----------------+---+ | 9 | \ | MEASUREMENT | Measurement | | | | | REPORT | report message | | | | | | containing UE | | | | | | position | | | | | | estimate | | | | | | (UE-based), or | | | | | | IE \"UE | | | | | | positioning | | | | | | GANSS measured | | | | | | results\" | | | | | | and/or \"UE | | | | | | positioning GPS | | | | | | measured | | | | | | results'' | | | | | | (UE-assisted). | | +----------+---------------+-----------------+-----------------+---+ | 11 | SS | | The SS releases | | | | | | the RRC | | | | | | connection and | | | | | | the test case | | | | | | ends. | | +----------+---------------+-----------------+-----------------+---+
##### Specific Message Contents {#specific-message-contents-27 .H6}
MEASUREMENT CONTROL (Step 7):
+----------------------------------+----------------------------------+ | **Information element** | **Value/remark** | +----------------------------------+----------------------------------+ | Measurement Information Elements | | +----------------------------------+----------------------------------+ | Measurement Identity | 10 | +----------------------------------+----------------------------------+ | Measurement Command | Setup | +----------------------------------+----------------------------------+ | Measurement Reporting Mode | | +----------------------------------+----------------------------------+ | - Measurement report transfer | Acknowledged mode RLC | | mode | | +----------------------------------+----------------------------------+ | - Periodical reporting / Event | Periodical reporting | | trigger reporting mode | | +----------------------------------+----------------------------------+ | Additional Measurements List | Not present | +----------------------------------+----------------------------------+ | CHOICE _Measurement type_ | UE positioning measurement | +----------------------------------+----------------------------------+ | - UE positioning measurement | | +----------------------------------+----------------------------------+ | - UE positioning reporting | | | quantity | | +----------------------------------+----------------------------------+ | - Method type | UE based or UE assisted | +----------------------------------+----------------------------------+ | - Positioning methods | GPS | +----------------------------------+----------------------------------+ | - Response time | 128 | +----------------------------------+----------------------------------+ | - Horizontal accuracy | 127 | +----------------------------------+----------------------------------+ | - Vertical accuracy | 127 | +----------------------------------+----------------------------------+ | - GPS timing of cell wanted | FALSE | +----------------------------------+----------------------------------+ | - Multiple sets | FALSE | +----------------------------------+----------------------------------+ | - Additional assistance data | TRUE | | request | | +----------------------------------+----------------------------------+ | - Environmental | Not present | | characterization | | +----------------------------------+----------------------------------+ | - Velocity Requested | Not present | +----------------------------------+----------------------------------+ | - GANSS Positioning Method | Sub-Test 1: bit 5 = 1 | +----------------------------------+----------------------------------+ | | Sub-Test 2: bit 1 = 1 | +----------------------------------+----------------------------------+ | | Sub-Test 3: bit 0 and 3 = 1 | +----------------------------------+----------------------------------+ | | Sub-Test 4: bit 0 and 3 and 5 = | | | 1 | | | | | | Sub-Test 8: bit 0 and 1 and 3 = | | | 1 | | | | | | Sub-Test 9: bit 6 = 1 | | | | | | Sub-Test 10: bit 0 and 3 and 6 = | | | 1 | +----------------------------------+----------------------------------+ | - GANSS timing of cell wanted | Not present | +----------------------------------+----------------------------------+ | - GANSS Carrier-Phase | Not present | | Measurement Requested | | +----------------------------------+----------------------------------+ | - GANSS Multi-frequency | UE assisted: Set according to UE | | Measurement Requested | capabilities | | | | | | UE based: Not present | +----------------------------------+----------------------------------+ | - Measurement validity | | +----------------------------------+----------------------------------+ | - UE state | All states | +----------------------------------+----------------------------------+ | - CHOICE _Reporting criteria_ | | +----------------------------------+----------------------------------+ | - Periodical reporting criteria | | +----------------------------------+----------------------------------+ | - Amount of reporting | 1 | +----------------------------------+----------------------------------+ | - Reporting interval | 64000 | +----------------------------------+----------------------------------+ | - No reporting | | +----------------------------------+----------------------------------+ | - UE pos OTDOA assistance data | Not present | | for UE-assisted | | +----------------------------------+----------------------------------+ | - UE pos OTDOA assistance data | Not present | | for UE-based | | +----------------------------------+----------------------------------+ | - UE positioning GPS assistance | Set as specified for | | data | \"Inadequate assistance data for | | | UE-based A-GNSS\" in 4.4.2 | | | | | | or | | | | | | \"Inadequate assistance data for | | | UE-assisted A-GNSS\" in 4.4.4 | +----------------------------------+----------------------------------+ | - UE positioning GANSS | Set as specified for | | assistance data | \"Inadequate assistance data for | | | UE-based A-GNSS\" in 4.4.2 | | | | | | or | | | | | | \"Inadequate assistance data for | | | UE-assisted A-GNSS\" in 4.4.4 | +----------------------------------+----------------------------------+ | Physical Channel Information | | | Elements | | +----------------------------------+----------------------------------+ | DPCH compressed mode status info | Not present | +----------------------------------+----------------------------------+
MEASUREMENT REPORT (Step 8)
* * *
**Information element** **Value/remark**
Measurement Information Elements
Measurement Identity 10
Measured Results
\- CHOICE _Measurement_ UE positioning measured results
\- UE positioning measured results
\- UE positioning OTDOA measured results Not present
\- UE positioning position estimate info Not present
\- UE positioning GPS measured results Not present
\- UE positioning error Not present
\- Error reason Assistance Data Missing
-GPS additional assistance data requested Sub-tests 3, 4, 8 and 10
-Almanac Present, if requested by UE
-UTC model Present, if requested by UE
-Ionospheric model Present, if requested by UE
-Navigation model Present, if requested by UE
-DGPS corrections Present, if requested by UE
-Reference location Present, if requested by UE
-Reference time Present, if requested by UE
-Acquisition assistance Present, if requested by UE
-Real-time integrity Present, if requested by UE
-Navigation model additional data Present, if requested by UE
-GANSS additional assistance data requested Sub-tests 1, 2, 4, 9
-GANSS Reference time Present, if requested by UE
-Reference location Present, if requested by UE
-GANSS Ionospheric model Present, if requested by UE
-GANSS Additional Ionospheric Model for\ Present, if requested by UE Data ID = '00' 
-GANSS Additional Ionospheric Model for\ Present, if requested by UE Data ID = '11' 
-GANSS Earth orientation parameters Present, if requested by UE
-GANSS Real-time integrity Present, if requested by UE
-GANSS Almanac Present, if requested by UE
-GANSS Time Model Present, if requested by UE
-GANSS Ephemeris Extension Check Present, if requested by UE
\- UE positioning GANSS measured results Not present
Measured Results on secondary UL frequency Not present
Measured Results on RACH Not present
Additional Measured Results Not present
Additional Measured results on secondary UL frequency Not present
Event Results Not present
Event results on secondary UL frequency Not present
Inter-RAT cell info indication Not present
E-UTRA Measured Results Not present
E-UTRA Event Results Not present
CSG Proximity Indication Not present
* * *
MEASUREMENT CONTROL (Step 9)
+----------------------------------+----------------------------------+ | **Information element** | **Value/remark** | +----------------------------------+----------------------------------+ | Measurement Information Elements | | +----------------------------------+----------------------------------+ | Measurement Identity | 10 | +----------------------------------+----------------------------------+ | Measurement Command | Modify | +----------------------------------+----------------------------------+ | Measurement Reporting Mode | | +----------------------------------+----------------------------------+ | - Measurement report transfer | Acknowledged mode RLC | | mode | | +----------------------------------+----------------------------------+ | - Periodical reporting / Event | Periodical reporting | | trigger reporting mode | | +----------------------------------+----------------------------------+ | Additional Measurements List | Not present | +----------------------------------+----------------------------------+ | CHOICE _Measurement type_ | UE positioning measurement | +----------------------------------+----------------------------------+ | - UE positioning measurement | | +----------------------------------+----------------------------------+ | - UE positioning reporting | | | quantity | | +----------------------------------+----------------------------------+ | - Method type | UE based or UE assisted | +----------------------------------+----------------------------------+ | - Positioning methods | GPS | +----------------------------------+----------------------------------+ | - Response time | 128 | +----------------------------------+----------------------------------+ | - Horizontal accuracy | 127 | +----------------------------------+----------------------------------+ | - Vertical accuracy | 127 | +----------------------------------+----------------------------------+ | - GPS timing of cell wanted | FALSE | +----------------------------------+----------------------------------+ | - Multiple sets | FALSE | +----------------------------------+----------------------------------+ | - Additional assistance data | FALSE | | request | | +----------------------------------+----------------------------------+ | - Environmental | Not present | | characterization | | +----------------------------------+----------------------------------+ | - Velocity Requested | Not present | +----------------------------------+----------------------------------+ | - GANSS Positioning Method | Sub-test 1: bit 5 = 1 | | | | | | Sub-test 2: bit 1 = 1 | | | | | | Sub-test 3: bit 0 and 3 = 1 | | | | | | Sub-Test 4: bit 0 and 3 and 5 = | | | 1 | | | | | | Sub-Test 8: bit 0 and 1 and 3 = | | | 1 | | | | | | Sub-Test 9: bit 6 = 1 | | | | | | Sub-Test 10: bit 0 and 3 and 6 = | | | 1 | +----------------------------------+----------------------------------+ | - GANSS timing of cell wanted | Not present | +----------------------------------+----------------------------------+ | - GANSS Carrier-Phase | Not present | | Measurement Requested | | +----------------------------------+----------------------------------+ | - GANSS Multi-frequency | UE assisted: Set according to UE | | Measurement Requested | capabilities | | | | | | UE based: Not present | +----------------------------------+----------------------------------+ | - Measurement validity | | +----------------------------------+----------------------------------+ | - UE state | All states | +----------------------------------+----------------------------------+ | - CHOICE _Reporting criteria_ | Set as required according to | | | position in sequence of messages | +----------------------------------+----------------------------------+ | - Periodical reporting criteria | Set as required according to | | | position in sequence of messages | +----------------------------------+----------------------------------+ | - Amount of reporting | Set as required according to | | | position in sequence of messages | +----------------------------------+----------------------------------+ | - Reporting interval | Set as required according to | | | position in sequence of messages | +----------------------------------+----------------------------------+ | - UE pos OTDOA assistance data | Not present | | for UE-assisted | | +----------------------------------+----------------------------------+ | - UE pos OTDOA assistance data | Not present | | for UE-based | | +----------------------------------+----------------------------------+ | - UE positioning GPS assistance | Set as specified in 4.4.5 | | data | | +----------------------------------+----------------------------------+ | - UE positioning GANSS | Set as specified in 4.4.5 | | assistance data | | +----------------------------------+----------------------------------+ | Physical Channel Information | | | Elements | | +----------------------------------+----------------------------------+ | DPCH compressed mode status info | Not present | +----------------------------------+----------------------------------+
MEASUREMENT REPORT (Step 10)
* * *
**Information element** **Value/remark** Measurement Information Elements  
Measurement Identity 10 Measured Results  
\- CHOICE _Measurement_ UE positioning measured results \- UE positioning
measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info  
-CHOICE Position estimate One of 'Ellipsoid point with uncertainty Circle' or 'Ellipsoid point with uncertainty Ellipse' or 'Ellipsoid point with altitude and uncertainty Ellipsoid' (UE-based) \- UE positioning GPS measured results Present for UE-assisted (Sub-Tests 3, 4, 8 and 10) \- UE positioning error Not present \- UE positioning GANSS measured results Present for UE-assisted. Measured Results on secondary UL frequency Not present Measured Results on RACH Not present Additional Measured Results Not present Additional Measured results on secondary UL frequency Not present Event Results Not present Event results on secondary UL frequency Not present Inter-RAT cell info indication Not present E-UTRA Measured Results Not present E-UTRA Event Results Not present CSG Proximity Indication Not present
* * *
##### 6.2.3.1.5 Test requirements {#test-requirements-17 .H6}
After step 7 the UE shall send a MEASUREMENT REPORT message containing the IE
\"UE positioning error\", with \"Error reason\" set to \"Assistance Data
Missing\".
After step 9 the UE shall send a MEASUREMENT REPORT message containing a valid
UE position estimate (UE-based) or GANSS and/or GPS measurements (UE-
assisted).
#### 6.2.3.2 MT-LR Position Estimate: UE-Based A-GNSS -- Failure Not Enough
Satellites
##### 6.2.3.2.1 Definition {#definition-18 .H6}
This test case applies to all UEs supporting UE-Based GANSS or GNSS Location
Service capabilities.
##### 6.2.3.2.2 Conformance requirements {#conformance-requirements-19 .H6}
> 1) if the IE \"Measurement command\" has the value \"modify\":
>
> 2> for all IEs present in the MEASUREMENT CONTROL message:
>
> 3> if a measurement was stored in the variable MEASUREMENT_IDENTITY
> associated to the identity by the IE \"measurement identity\":
>
> 4> if measurement type is set to \"UE positioning measurement\" and the IE
> \"UE positioning GPS assistance data\" is present, for any of the optional
> IEs \"UE positioning GPS reference time\", \"UE positioning GPS reference UE
> position\", \"UE positioning GPS DGPS corrections\", \"UE positioning GPS
> ionospheric model\", \"UE positioning GPS UTC model\", \"UE positioning GPS
> acquisition assistance\", \"UE positioning GPS real-time integrity\" that
> are present in the MEASUREMENT CONTROL message:
>
> 4> if measurement type is set to \"UE positioning measurement\" and the IE
> \"UE positioning GANSS assistance data\" is present, for any of the optional
> IEs \"UE positioning GANSS reference time\", \"UE positioning GANSS
> reference UE position\", \"UE positioning DGANSS corrections\", \"UE
> positioning GANSS ionospheric model\", \"UE positioning GANSS additional
> ionospheric model\", \"UE positioning GANSS UTC model\", \"UE positioning
> GANSS additional UTC models\", \"UE positioning GANSS reference measurement
> information\", \"UE positioning GANSS data bit assistance\", \"UE
> positioning GANSS Time model\", \"UE positioning GANSS real-time
> integrity\", \"UE positioning GANSS Earth orientation parameters\", \"UE
> positioning GANSS auxiliary information\" that are present in the
> MEASUREMENT CONTROL message:
>
> 5> replace all instances of the IEs listed above (and all their children)
> stored in variable MEASUREMENT_IDENTITY associated to the identity indicated
> by the IE \"measurement identity\" with the IEs received in the MEASUREMENT
> CONTROL message;
>
> 5> leave all other stored information elements unchanged in the variable
> MEASUREMENT_IDENTITY.
>
> 2) If the IE \"UE positioning GPS Navigation Model\" is included, for each
> satellite, the UE shall:
>
> 1> use IE \"Satellite Status\" to determine if an update of IE \"UE
> positioning GPS Ephemeris and Clock Correction parameters\" has been
> provided for the satellite indicated by the IE \"SatID\";
>
> 1> if an update has been provided for this satellite:
>
> 2> act as specified in subclause 8.6.7.19.3.4.
>
> If the IE \"UE positioning GPS Ephemeris and Clock Correction parameters\"
> is included, for each satellite, the UE shall:
>
> 1> update the variable UE_POSITIONING_GPS_DATA as follows:
>
> 2> store this IE at the position indicated by the IE \"Sat ID\" in the IE
> \"UE positioning GPS Navigation Model\" in the variable
> UE_POSITIONING_GPS_DATA, possibly overwriting any existing information in
> this position.
>
> 1> act on these GPS ephemeris and clock correction parameters in a manner
> similar to that specified in [12].
>
> 3) If the IE \"UE positioning GANSS Navigation Model\" is included, the UE
> shall:
>
> 1> for each GANSS:
>
> 2> for each satellite, the UE shall:
>
> 3> for IE \"UE positioning GANSS clock model\":
>
> 4> act as specified in subclause 8.6.7.19.7.4a.
>
> 3> for IE \"UE positioning GANSS orbit model\":
>
> 4> act as specified in subclause 8.6.7.19.7.4b.
>
> 4) If the IE \"UE positioning GANSS clock model\" is included, the UE shall:
>
> 1> for each GANSS:
>
> 2> update the variable UE_POSITIONING_GANSS_DATA as follows:
>
> 3> store this IE at the position indicated by the IE \"Sat ID\" in the IE
> \"UE positioning GANSS Navigation Model\" in the variable
> UE_POSITIONING_GANSS_DATA, possibly overwriting any existing information in
> this position.
>
> 2> act on these GANSS clock models in a manner similar to that specified in
> a relevant ICD.
>
> 5) If the IE \"UE positioning GANSS orbit model\" is included, for each
> satellite of each supported GNSS, the UE shall:
>
> 1> update the variable UE_POSITIONING_GANSS_DATA as follows:
>
> 2> store this IE at the position indicated by the IE \"Sat ID\" in the IE
> \"UE positioning GANSS Navigation Model\" in the variable
> UE_POSITIONING_GANSS_DATA, possibly overwriting any existing information in
> this position..
>
> 1> act on these GANSS orbit models in a manner similar to that specified in
> a relevant ICD.
>
> 6) The UE shall when a measurement report is triggered:
>
> 2> if the UE has been able to calculate a position after performing
> measurements on the cells included in the variable
> UE_POSITIONING_OTDOA_DATA_UE_BASED in case of OTDOA or the UE has been able
> to calculate a position in case of GPS or GANSS positioning or the UE has
> been able to calculate a position using a standalone positioning method:
>
> 3> include IE \"UE positioning Position Estimate Info\" in the MEASUREMENT
> REPORT and set the contents of the IE as follows:
>
> 4> if the UE supports the capability to perform the UE GPS timing of cell
> frames measurement:
>
> 5> if the IE \"GPS timing of Cell wanted\" is set to TRUE:
>
> 6> perform the UE GPS timing of cell frames measurement on the serving cell
> or on one cell of the active set.
>
> 6> include the IE \"Primary CPICH Info\" for FDD or the IE \"cell parameters
> id\" for TDD;
>
> 6> include the SFN when the position was determined;
>
> 6> include the IE \"UE GPS timing of cell frames\";
>
> 6> include the IE \"UE Positioning GPS Reference Time Uncertainty\".
>
> 5> if the IE \"GPS timing of Cell wanted\" is set to FALSE:
>
> 6> include the IE \"GPS TOW msec\" and set it to the GPS TOW when the
> position estimate was valid.
>
> 4> if the position was calculated with GPS; and
>
> 4> the UE does not support the capability to provide the GPS timing of the
> cell:
>
> 5> include the IE \"GPS TOW msec\" and set it to the GPS TOW when the
> position estimate was valid.
>
> 4> if the UE supports the capability to provide the GANSS timing of the cell
> frames measurement:
>
> 5> if the IE \"GANSS timing of Cell wanted\" is included with one bit set to
> value one for a supported GANSS:
>
> 6> perform the UE GANSS timing of cell frames measurement on the serving
> cell or on one cell of the active set;
>
> 6> include the IE \"GANSS Time ID\" to identify the GNSS system time;
>
> 6> include the IE \"Primary CPICH Info\" for FDD or the IE \"cell parameters
> id\" for TDD; and
>
> 6> include the IE \"Reference SFN\" and the IE \"UE GANSS timing of cell
> frames\".
>
> 5> if the IE \"GANSS timing of Cell wanted\" is not included, or included
> with each bit set to value zero:
>
> 6> include the IE \"GANSS TOD msec\" and set it to the GANSS TOD when the
> position estimate was valid.
>
> 4> if the UE does not support the capability to provide the GANSS timing of
> the cell:
>
> 5> include the IE \"GANSS TOD msec\" and set it to the GANSS TOD when the
> position estimate was valid;
>
> 5> include the IE \"GANSS Time ID\" to identify the GNSS system time.
>
> 4> if IE \"Vertical Accuracy\" has been included in IE \"UE positioning
> reporting quantity\":
>
> 5> if the IE \"Vertical Accuracy\" has been assigned to value \"0\":
>
> 6> if the IE \"Horizontal Accuracy\" has been assigned a value \"0\":
>
> 7> may include IE \"Ellipsoid point with altitude\".
>
> 6> if the IE \"Horizontal Accuracy\" has been assigned a value unequal to
> \"0\"; and
>
> 6> if the UE has been able to calculate a 3-dimensional position
>
> 7> include IE \"Ellipsoid point with altitude\" or IE \"Ellipsoid point with
> altitude and uncertainty ellipsoid\" as the position estimate.
>
> 6> if the UE has not been able to calculate a 3-dimensional position:
>
> 7> may act as if IE \"Vertical Accuracy\" was not included in IE \"UE
> positioning reporting quantity\".
>
> 5> if the IE \"Vertical Accuracy\" has been assigned to a value unequal to
> \"0\":
>
> 6> if the UE has been able to calculate a 3-dimensional position:
>
> 7> include IE \"Ellipsoid point with altitude and uncertainty ellipsoid\" as
> the position estimate.
>
> 6> if the UE has not been able to calculate a 3-dimensional position:
>
> 7> act as if IE \"Vertical Accuracy\" has not been included in IE \"UE
> positioning reporting quantity\".
>
> 4> if IE \"Vertical Accuracy\" has not been included in IE \"UE positioning
> reporting quantity\":
>
> 5> if IE \"Horizontal Accuracy\" in IE \"UE positioning reporting quantity\"
> has been assigned to value \"0\":
>
> 6> may include IE \"Ellipsoid point\".
>
> 5> if IE \"Horizontal Accuracy\" in IE \"UE positioning reporting quantity\"
> has been assigned to a value unequal to 0:
>
> 6> include either IE \"Ellipsoid point with uncertainty circle\" or IE
> \"Ellipsoid point with uncertainty ellipse\" or IE \"Ellipsoid point with
> altitude and uncertainty ellipsoid\" as the position estimate.
>
> 4> if any of the IEs \"Ellipsoid point with uncertainty ellipse\" or
> \"Ellipsoid point with altitude and uncertainty ellipsoid\" is reported:
>
> 5> should calculate a value of the IE \"Confidence\", different from \"0\",
> as the probability that the UE is located within the uncertainty region of
> the one of the IEs \"Ellipsoid point with uncertainty ellipse\" or
> \"Ellipsoid point with altitude and uncertainty ellipsoid\" that is
> reported.
>
> NOTE: The value \"0\" of the IE \"Confidence\" is interpreted as \"no
> information\" by the UTRAN [57].
>
> 4> if IE \"Velocity Requested\" has been included in IE \"UE positioning
> reporting quantity\":
>
> 5> include IE \"Velocity estimate\" if supported and available.
>
> 2> if the UE was not able to calculate a position:
>
> 3> include IE \"UE positioning error\" in the MEASUREMENT REPORT and set the
> contents of this IE as specified in subclause 8.6.7.19.5.
>
> 7) The UE shall set the contents of the IE \"UE positioning Error\" as
> follows:
...
> 1> if the IE \"Positioning Methods\" in IE \"UE positioning reporting
> quantity\" has been assigned to value \"GPS\" and the IE \"GANSS Positioning
> Methods\" is present:
>
> 2> if there were not enough GANSS satellites to be received:
>
> 3> set IE \"Error reason\" to \"Not Enough GANSS Satellites\".
>
> 2> if some GANSS assistance data was missing:
>
> 3> set IE \"Error reason\" to \"Assistance Data Missing\"; and
>
> 3> if the IE \"Additional Assistance Data Request\" included in the IE \"UE
> positioning reporting quantity\" stored in the variable MEASUREMENT_IDENTITY
> is set to TRUE:
>
> 4> include the IE \"GANSS Additional Assistance Data Request\".
>
> 3> if the IE \"Additional Assistance Data Request\" included in the IE \"UE
> positioning reporting quantity\" stored in the variable MEASUREMENT_IDENTITY
> is set to FALSE:
>
> 4> not include the IE \"GANSS Additional Assistance Data Request\", and use
> the assistance data available for doing a positioning estimate.
Reference(s):
> \- Conformance requirement 1: TS 25.331, subclause 8.4.1.3.
>
> \- Conformance requirement 2: TS 25.331, subclauses 8.6.7.19.3.3a,
> 8.6.7.19.3.4.
>
> \- Conformance requirement 3: TS 25.331, subclause 8.6.7.19.7.4
>
> \- Conformance requirement 4: TS 25.331, subclause 8.6..7.19.4a
>
> \- Conformance requirement 5: TS 25.331, subclause 8.6.7.19.4b
>
> \- Conformance requirement 6: TS 25.331, subclause 8.6.7.19.1b
>
> \- Conformance requirement 7: TS 25.331, subclause 8.6.7.19.5
##### 6.2.3.2.3 Test Purpose {#test-purpose-18 .H6}
To verify the UE behaviour at a mobile terminated location request procedure
using network-assisted UE-based GNSS when the MT-LR procedure fails due to
failure of positioning method.
To verify that the UE in CELL_DCH state accepts assistance data received in
multiple MEASUREMENT CONTROL messages.
To verify that the UE sets the IE Error Reason in 'UE Positioning Error' to
'Not Enough GANSS Satellites' when it does not receive enough satellite
signals to compute a position.
##### 6.2.3.2.4 Method of Test {#method-of-test-18 .H6}
Initial Conditions
> \- System Simulator (SS):
>
> \- 1 cell, default parameters.
>
> \- Satellite signals switched off or not present.
>
> \- User Equipment (UE):
>
> \- State "CS-CELL DCH Initial (State 6-1) " as specified in clause 7.4.1 of
> TS 34.108.
##### Related PICS/PIXIT Statements {#related-picspixit-statements-29 .H6}
> \- UE Based Network Assisted GANSS.
>
> \- UE Based Network Assisted GPS (Sub-tests 3, 4, 8 and 10).
##### Test Procedure {#test-procedure-29 .H6}
This test case includes sub-test cases dependent on the GNSS supported by the
UE. Each sub-test case is identified by a Sub-Test Case Number as defined
below:
* * *
**Sub-Test Case Number** **Supported GNSS** 1 UE supporting A-GLONASS only 2
UE supporting A-Galileo only 3 UE supporting A-GPS and Modernized GPS only 4
UE supporting A-GPS^(1)^ and A-GLONASS only 8 UE supporting A-GPS^(1)^ and
A-Galileo only 9 UE supporting A-BDS only 10 UE supporting A-GPS^(1)^ and
A-BDS only NOTE 1: "A-GPS" includes Modernized GPS if supported by the UE.
* * *
The SS initiates authentication and ciphering and orders an A-GNSS positioning
measurement using one or more (dependent on the sub-test) MEASUREMENT CONTROL
messages.
The UE sends a MEASUREMENT REPORT message reporting a positioning error for
not enough satellite signal.
##### Expected Sequence {#expected-sequence-29 .H6}
* * *
**Step** **Direction** **Message** **Comments**  
**UE** **SS**  
1 \ AUTHENTICATION RESPONSE  
3 SS SS starts security procedure  
4 Void  
5 Void  
6 Void  
7 \ MEASUREMENT REPORT Positioning error report 'not enough satellites'  
9 SS The SS releases the RRC connection and the test case ends.
* * *
##### Specific Message Contents {#specific-message-contents-28 .H6}
MEASUREMENT CONTROL (Step 7):
+----------------------------------+----------------------------------+ | **Information element** | **Value/remark** | +----------------------------------+----------------------------------+ | **Measurement Information | | | Elements** | | +----------------------------------+----------------------------------+ | Measurement Identity | 10 | +----------------------------------+----------------------------------+ | Measurement Command | Setup | +----------------------------------+----------------------------------+ | Measurement Reporting Mode | | +----------------------------------+----------------------------------+ | - Measurement report transfer | Acknowledged mode RLC | | mode | | +----------------------------------+----------------------------------+ | - Periodical reporting / Event | Periodical reporting | | trigger reporting mode | | +----------------------------------+----------------------------------+ | Additional Measurements List | Not present | +----------------------------------+----------------------------------+ | CHOICE Measurement type | UE positioning measurement | +----------------------------------+----------------------------------+ | - UE positioning measurement | | +----------------------------------+----------------------------------+ | - UE positioning reporting | | | quantity | | +----------------------------------+----------------------------------+ | - Method type | UE based | +----------------------------------+----------------------------------+ | - Positioning methods | GPS | +----------------------------------+----------------------------------+ | - Response time | 128 | +----------------------------------+----------------------------------+ | - Horizontal accuracy | 127 | +----------------------------------+----------------------------------+ | - Vertical accuracy | 127 | +----------------------------------+----------------------------------+ | - GPS timing of cell wanted | FALSE | +----------------------------------+----------------------------------+ | - Multiple sets | FALSE | +----------------------------------+----------------------------------+ | - Additional assistance data | FALSE | | request | | +----------------------------------+----------------------------------+ | - Environmental | Not present | | characterization | | +----------------------------------+----------------------------------+ | - Velocity Requested | Not present | +----------------------------------+----------------------------------+ | - GANSS Positioning Method | Sub-Test 1: bit 5 = 1 | +----------------------------------+----------------------------------+ | | Sub-Test 2: bit 1 = 1 | +----------------------------------+----------------------------------+ | | Sub-Test 3: bit 0 and 3 = 1 | +----------------------------------+----------------------------------+ | | Sub-Test 4: bit 0 and 3 and 5 = | | | 1 | | | | | | Sub-Test 8: bit 0 and 1 and 3 = | | | 1 | | | | | | Sub-Test 9: bit 6 = 1 | | | | | | Sub-Test 10: bit 0 and 3 and 6 = | | | 1 | +----------------------------------+----------------------------------+ | - GANSS timing of cell wanted | Not present | +----------------------------------+----------------------------------+ | - GANSS Carrier-Phase | Not present | | Measurement Requested | | +----------------------------------+----------------------------------+ | - GANSS Multi-frequency | Not present | | Measurement Requested | | +----------------------------------+----------------------------------+ | - Measurement validity | | +----------------------------------+----------------------------------+ | - UE state | All states | +----------------------------------+----------------------------------+ | - CHOICE Reporting criteria | | +----------------------------------+----------------------------------+ | - Periodical reporting criteria | For Sub-Tests 1, 9 only | +----------------------------------+----------------------------------+ | - Amount of reporting | 1 | +----------------------------------+----------------------------------+ | - Reporting interval | 64000 | +----------------------------------+----------------------------------+ | - No reporting | For Sub-Tests 2, 3, 4, 8, 10 | | | only | +----------------------------------+----------------------------------+ | - UE pos OTDOA assistance data | Not present | | for UE-assisted | | +----------------------------------+----------------------------------+ | - UE pos OTDOA assistance data | Not present | | for UE-based | | +----------------------------------+----------------------------------+ | - UE positioning GPS assistance | Set as specified for the first | | data | MEASUREMENT CONTROL message for | | | \"Adequate assistance data for | | | UE-based A-GNSS\" in 4.4.1 | +----------------------------------+----------------------------------+ | - UE positioning GANSS | Set as specified for the first | | assistance data | MEASUREMENT CONTROL message for | | | \"Adequate assistance data for | | | UE-based A-GNSS\" in 4.4.1 | +----------------------------------+----------------------------------+ | **Physical Channel Information | | | Elements** | | +----------------------------------+----------------------------------+ | DPCH compressed mode status info | Not present | +----------------------------------+----------------------------------+
MEASUREMENT CONTROL (Step 7a):
+----------------------------------+----------------------------------+ | **Information element** | **Value/remark** | +----------------------------------+----------------------------------+ | **Measurement Information | | | Elements** | | +----------------------------------+----------------------------------+ | Measurement Identity | 10 | +----------------------------------+----------------------------------+ | Measurement Command | Modify | +----------------------------------+----------------------------------+ | Measurement Reporting Mode | | +----------------------------------+----------------------------------+ | - Measurement report transfer | Acknowledged mode RLC | | mode | | +----------------------------------+----------------------------------+ | - Periodical reporting / Event | Periodical reporting | | trigger reporting mode | | +----------------------------------+----------------------------------+ | Additional Measurements List | Not present | +----------------------------------+----------------------------------+ | CHOICE Measurement type | UE positioning measurement | +----------------------------------+----------------------------------+ | - UE positioning measurement | | +----------------------------------+----------------------------------+ | - UE positioning reporting | | | quantity | | +----------------------------------+----------------------------------+ | - Method type | UE based | +----------------------------------+----------------------------------+ | - Positioning methods | GPS | +----------------------------------+----------------------------------+ | - Response time | 128 | +----------------------------------+----------------------------------+ | - Horizontal accuracy | 127 | +----------------------------------+----------------------------------+ | - Vertical accuracy | 127 | +----------------------------------+----------------------------------+ | - GPS timing of cell wanted | FALSE | +----------------------------------+----------------------------------+ | - Multiple sets | FALSE | +----------------------------------+----------------------------------+ | - Additional assistance data | FALSE | | request | | +----------------------------------+----------------------------------+ | - Environmental | Not present | | characterization | | +----------------------------------+----------------------------------+ | - Velocity Requested | Not present | +----------------------------------+----------------------------------+ | - GANSS Positioning Method | Sub-Test 2: bit 1 = 1 | +----------------------------------+----------------------------------+ | | Sub-Test 3: bit 0 and 3 = 1 | +----------------------------------+----------------------------------+ | | Sub-Test 4: bit 0 and 3 and 5 = | | | 1 | | | | | | Sub-Test 8: bit 0 and 1 and 3 = | | | 1 | | | | | | Sub-Test 9: bit 6 = 1 | | | | | | Sub-Test 10: bit 0 and 3 and 6 = | | | 1 | +----------------------------------+----------------------------------+ | - GANSS timing of cell wanted | Not present | +----------------------------------+----------------------------------+ | - GANSS Carrier-Phase | Not present | | Measurement Requested | | +----------------------------------+----------------------------------+ | - GANSS Multi-frequency | Not present | | Measurement Requested | | +----------------------------------+----------------------------------+ | - Measurement validity | | +----------------------------------+----------------------------------+ | - UE state | All states | +----------------------------------+----------------------------------+ | - CHOICE Reporting criteria | | +----------------------------------+----------------------------------+ | - Periodical reporting criteria | For Sub-Tests 2, 3 only | +----------------------------------+----------------------------------+ | - Amount of reporting | 1 | +----------------------------------+----------------------------------+ | - Reporting interval | 64000 | +----------------------------------+----------------------------------+ | - No reporting | For Sub-Tests 4, 8, 10 only | +----------------------------------+----------------------------------+ | - UE pos OTDOA assistance data | Not present | | for UE-assisted | | +----------------------------------+----------------------------------+ | - UE pos OTDOA assistance data | Not present | | for UE-based | | +----------------------------------+----------------------------------+ | - UE positioning GPS assistance | Set as specified for the second | | data | MEASUREMENT CONTROL message for | | | \"Adequate assistance data for | | | UE-based A-GNSS\" in 4.4.1 | +----------------------------------+----------------------------------+ | - UE positioning GANSS | Set as specified for the second | | assistance data | MEASUREMENT CONTROL message for | | | \"Adequate assistance data for | | | UE-based A-GNSS\" in 4.4.1 | +----------------------------------+----------------------------------+ | **Physical Channel Information | | | Elements** | | +----------------------------------+----------------------------------+ | DPCH compressed mode status info | Not present | +----------------------------------+----------------------------------+
MEASUREMENT CONTROL (Step 7b):
+----------------------------------+----------------------------------+ | **Information element** | **Value/remark** | +----------------------------------+----------------------------------+ | **Measurement Information | | | Elements** | | +----------------------------------+----------------------------------+ | Measurement Identity | 10 | +----------------------------------+----------------------------------+ | Measurement Command | Modify | +----------------------------------+----------------------------------+ | Measurement Reporting Mode | | +----------------------------------+----------------------------------+ | - Measurement report transfer | Acknowledged mode RLC | | mode | | +----------------------------------+----------------------------------+ | - Periodical reporting / Event | Periodical reporting | | trigger reporting mode | | +----------------------------------+----------------------------------+ | Additional Measurements List | Not present | +----------------------------------+----------------------------------+ | CHOICE Measurement type | UE positioning measurement | +----------------------------------+----------------------------------+ | - UE positioning measurement | | +----------------------------------+----------------------------------+ | - UE positioning reporting | | | quantity | | +----------------------------------+----------------------------------+ | - Method type | UE based | +----------------------------------+----------------------------------+ | - Positioning methods | GPS | +----------------------------------+----------------------------------+ | - Response time | 128 | +----------------------------------+----------------------------------+ | - Horizontal accuracy | 127 | +----------------------------------+----------------------------------+ | - Vertical accuracy | 127 | +----------------------------------+----------------------------------+ | - GPS timing of cell wanted | FALSE | +----------------------------------+----------------------------------+ | - Multiple sets | FALSE | +----------------------------------+----------------------------------+ | - Additional assistance data | FALSE | | request | | +----------------------------------+----------------------------------+ | - Environmental | Not present | | characterization | | +----------------------------------+----------------------------------+ | - Velocity Requested | Not present | +----------------------------------+----------------------------------+ | - GANSS Positioning Method | Sub-Test 4: bit 0 and 3 and 5 = | | | 1 | | | | | | Sub-Test 8: bit 0 and 1 and 3 = | | | 1 | | | | | | Sub-Test 10: bit 0 and 3 and 6 = | | | 1 | +----------------------------------+----------------------------------+ | - GANSS timing of cell wanted | Not present | +----------------------------------+----------------------------------+ | - GANSS Carrier-Phase | Not present | | Measurement Requested | | +----------------------------------+----------------------------------+ | - GANSS Multi-frequency | Not present | | Measurement Requested | | +----------------------------------+----------------------------------+ | - Measurement validity | | +----------------------------------+----------------------------------+ | - UE state | All states | +----------------------------------+----------------------------------+ | - CHOICE Reporting criteria | | +----------------------------------+----------------------------------+ | - Periodical reporting criteria | | +----------------------------------+----------------------------------+ | - Amount of reporting | 1 | +----------------------------------+----------------------------------+ | - Reporting interval | 64000 | +----------------------------------+----------------------------------+ | - UE pos OTDOA assistance data | Not present | | for UE-assisted | | +----------------------------------+----------------------------------+ | - UE pos OTDOA assistance data | Not present | | for UE-based | | +----------------------------------+----------------------------------+ | - UE positioning GPS assistance | Set as specified for the third | | data | MEASUREMENT CONTROL message for | | | \"Adequate assistance data for | | | UE-based A-GNSS\" in 4.4.1 | +----------------------------------+----------------------------------+ | - UE positioning GANSS | Set as specified for the third | | assistance data | MEASUREMENT CONTROL message for | | | \"Adequate assistance data for | | | UE-based A-GNSS\" in 4.4.1 | +----------------------------------+----------------------------------+ | **Physical Channel Information | | | Elements** | | +----------------------------------+----------------------------------+ | DPCH compressed mode status info | Not present | +----------------------------------+----------------------------------+
MEASUREMENT REPORT (Step 8)
* * *
**Information element** **Value/remark** **Measurement Information Elements**  
Measurement Identity 10 Measured Results  
\- CHOICE Measurement UE positioning measured results \- UE positioning
measured results  
\- UE positioning OTDOA measured results Not present \- UE positioning
position estimate info Not present \- UE positioning GPS measured results Not
present \- UE positioning error Not present \- Error reason notEnoughGANSS-
Satellites or notEnoughGPS-Satellites (sub-tests 3, 4, 8 and 10 only) \- UE
positioning GANSS measured results Not present Measured Results on secondary
UL frequency Not present Measured Results on RACH Not present Additional
Measured Results Not present Additional Measured results on secondary UL
frequency Not present Event Results Not present Event results on secondary UL
frequency Not present Inter-RAT cell info indication Not present E-UTRA
Measured Results Not present E-UTRA Event Results Not present CSG Proximity
Indication Not present
* * *
##### 6.2.3.2.5 Test requirements {#test-requirements-18 .H6}
After step 7 the UE shall send a MEASUREMENT REPORT message containing the IE
\"UE positioning error\", with \"Error reason\" set to \"Not Enough
Satellites\".
#### 6.2.3.3 Location Notification
##### 6.2.3.3.1 Definition {#definition-19 .H6}
This test case applies to all UEs supporting UE-Based or UE-Assisted GANSS or
GNSS Location Service capabilities and LCS value added location request
notification capability.
##### 6.2.3.3.2 Conformance requirements {#conformance-requirements-20 .H6}
1) The network invokes a location notification procedure by sending a REGISTER
message containing a LCS-LocationNotification invoke component to the UE. This
may be sent either to request verification for MT-LR or to notify about
already authorized MT-LR.
In the case of location notification no response is required from the UE, the
UE shall terminate the dialogue by sending a RELEASE COMPLETE message
containing a LocationNotification return result.
References
> \- Conformance requirement 1: TS 24.030, clause 4.1.1
##### 6.2.3.3.3 Test Purpose {#test-purpose-19 .H6}
To verify that when the UE receives a REGISTER message during an established
CS call, containing a LCS Location Notification Invoke component set to
NotifyLocationAllowed, the UE notifies the UE user of the location request and
sends a RELEASE COMPLETE message containing a LocationNotification return
result with verificationResponse set to permissionGranted.
##### 6.2.3.3.4 Method of Test {#method-of-test-19 .H6}
Initial Conditions
System Simulator (SS):
> \- 1 cell, default parameters
>
> \- Satellite signals switched off or not present
##### UE: {#ue-9 .H6}
\- State \"CS-CELL DCH Initial (State 6-1)\" as specified in clause 7.4.1 of
TS 34.108.
##### Related PICS/PIXIT Statements {#related-picspixit-statements-30 .H6}
\- UE Based Network Assisted GANSS.
\- UE Assisted Network Assisted GANSS.
\- UE supporting LCS value added location request notification capability.
##### Test Procedure {#test-procedure-30 .H6}
The SS initiates authentication and ciphering and sends an SS REGISTER message
containing a Facility IE containing a LCS Location Notification Invoke message
set to notifyLocationAllowed. The UE notifies the UE user of the location
request. The UE then responds with a RELEASE COMPLETE message containing a
LocationNotification return result to terminate the dialogue.
##### Expected Sequence {#expected-sequence-30 .H6}
+----------+---------------+-----------------+-----------------+---+ | **Step** | **Direction** | **Message** | **Comments** | | +----------+---------------+-----------------+-----------------+---+ | | **UE** | **SS** | | | +----------+---------------+-----------------+-----------------+---+ | 1 | \ | AUTHENTICATION | | | | | | RESPONSE | | | +----------+---------------+-----------------+-----------------+---+ | 3 | SS | | SS starts | | | | | | security | | | | | | procedure | | +----------+---------------+-----------------+-----------------+---+ | 4 | \ | RELEASE | The UE | | | | | COMPLETE | terminates the | | | | | | dialogue | | +----------+---------------+-----------------+-----------------+---+ | 7 | SS | | SS releases the | | | | | | RRC connection | | | | | | and the test | | | | | | case ends | | +----------+---------------+-----------------+-----------------+---+
##### Specific Message Contents {#specific-message-contents-29 .H6}
REGISTER (Step 4)
+-------------------------+---------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+---------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+---------------------------------------------+ | Transaction identifier | | +-------------------------+---------------------------------------------+ | Message type | REGISTER (0011 1011) | +-------------------------+---------------------------------------------+ | Facility | Invoke = lcs-LocationNotification | | | | | | LocationNotificationArg | | | | | | notificationType -> notifyLocationAllowed, | | | | | | locationType -> current Location , | | | | | | lcsClientExternalID -> externalAddress | | | | | | lcsClientName ->dataCodingScheme | | | | | | nameString | +-------------------------+---------------------------------------------+
RELEASE COMPLETE (Step 6)
+-------------------------+--------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+--------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+--------------------------------------------+ | Transaction identifier | | +-------------------------+--------------------------------------------+ | Message type | RELEASE COMPLETE (xx10 1010) | +-------------------------+--------------------------------------------+ | Facility | Return result = lcs-LocationNotification | | | | | | LocationNotificationRes | | | | | | verificationResponse -> permissionGranted | +-------------------------+--------------------------------------------+
##### 6.2.3.3.5 Test requirements {#test-requirements-19 .H6}
After step 4 the UE shall notify the UE user of the location request.
After step 5 the UE shall send a RELEASE COMPLETE message.
#### 6.2.3.4 Privacy Verification - Location Allowed if No Response
##### 6.2.3.4.1 Definition {#definition-20 .H6}
This test case applies to all UEs supporting UE-Based or UE-Assisted GANSS or
GNSS Location Service capabilities and LCS value added location request
notification capability.
##### 6.2.3.4.2 Conformance requirements {#conformance-requirements-21 .H6}
> 1) The network invokes a location notification procedure by sending a
> REGISTER message containing a LCS-LocationNotification invoke component to
> the UE. This may be sent either to request verification for MT-LR or to
> notify about already authorized MT-LR.
>
> 2) In case of privacy verification the MS shall respond to the request by
> sending a RELEASE COMPLETE message containing the mobile subscriber\'s
> response in a return result component.
>
> 3) If the timer expires in the network before any response from the MS (e.g.
> due to no response from the user), the network shall interpret this by
> applying the default treatment defined in GSM 03.71 for GSM and TS 23.171
> for UMTS (i.e. disallow location if barred by subscription and allow
> location if allowed by subscription).
References
> \- Conformance requirement 1, 2 and 3: TS 24.030, clause 4.1.1
##### 6.2.3.4.3 Test Purpose {#test-purpose-20 .H6}
To verify that when the UE receives a REGISTER message, containing a LCS
Location Notification Invoke component set to notifyAndVerify-
LocationAllowedIfNoResponse, the UE notifies the UE user of the location
request and indicates that the default response is location allowed if no
response and providing the opportunity to accept or deny the request and sends
a RELEASE COMPLETE message containing a LocationNotification return result
with verificationResponse set to permissionDenied or permissionGranted as
appropriate.
##### 6.2.3.4.4 Method of Test {#method-of-test-20 .H6}
Initial Conditions
System Simulator (SS):
> \- 1 cell, default parameters
>
> \- Satellite signals switched off or not present
##### UE: {#ue-10 .H6}
> \- State \"CS-CELL DCH Initial (State 6-1)\" as specified in clause 7.4.1 of
> TS 34.108.
##### Related PICS/PIXIT Statements {#related-picspixit-statements-31 .H6}
> \- UE Based Network Assisted GANSS.
>
> \- UE Assisted Network Assisted GANSS.
>
> \- UE supporting LCS value added location request notification capability.
>
> \- px_UeLcsNotification: value for UE LCS Notification timeout timer.
##### Test Procedure {#test-procedure-31 .H6}
The SS initiates authentication and ciphering and sends a REGISTER message
containing a Facility IE containing a LCS Location Notification Invoke message
set to notifyAndVerify-LocationAllowedIfNoResponse.
The UE notifies the UE user of the location request with the option to accept
or deny the request and an indication that location will be allowed if no user
response is received.
The user accepts the location request. The UE responds with a RELEASE COMPLETE
message containing a LocationNotification return result with
verificationResponse set to permissionGranted.
The SS sends a REGISTER message containing a Facility IE containing a LCS
Location Notification Invoke message set to notifyAndVerify-
LocationAllowedIfNoResponse.
The UE notifies the UE user of the location request with the option to accept
or deny the request and an indication that location will be allowed if no user
response is received.
The user denies the location request. The UE responds with a RELEASE COMPLETE
message containing a LocationNotification return result with
verificationResponse set to permissionDenied.
The SS sends a REGISTER message containing a Facility IE containing a LCS
Location Notification Invoke message set to notifyAndVerify-
LocationAllowedIfNoResponse.
The UE notifies the UE user of the location request with the option to accept
or deny the request and an indication that location will be allowed if no user
response is received.
The user ignores the location request by taking no action, allowing the
verification process to time-out.
The SS send a RELEASE COMPLETE.
##### Expected Sequence {#expected-sequence-31 .H6}
+----------+---------------+-----------------+-----------------+---+ | **Step** | **Direction** | **Message** | **Comments** | | +----------+---------------+-----------------+-----------------+---+ | | **UE** | **SS** | | | +----------+---------------+-----------------+-----------------+---+ | 1 | \ | AUTHENTICATION | | | | | | RESPONSE | | | +----------+---------------+-----------------+-----------------+---+ | 3 | SS | | SS starts | | | | | | security | | | | | | procedure | | +----------+---------------+-----------------+-----------------+---+ | 4 | \ | RELEASE | Containing a | | | | | COMPLETE | Locat | | | | | | ionNotification | | | | | | return result | | | | | | with | | | | | | verif | | | | | | icationResponse | | | | | | set to | | | | | | pe | | | | | | rmissionGranted | | +----------+---------------+-----------------+-----------------+---+ | 9 | \ | RELEASE | Containing a | | | | | COMPLETE | Locat | | | | | | ionNotification | | | | | | return result | | | | | | with | | | | | | verif | | | | | | icationResponse | | | | | | set to | | | | | | p | | | | | | ermissionDenied | | +----------+---------------+-----------------+-----------------+---+ | 14 | \ | | | no | | | tifyAndVerify-LocationAllowedIfNoResponse | | | | | | locationType -> current Location | | | | | | lcsClientExternalID -> externalAddress | | | | | | lcsClientName ->dataCodingScheme\ | | | nameString | +-------------------------+-------------------------------------------+
##### RELEASE COMPLETE (Step 8) {#release-complete-step-8 .H6}
+-------------------------+--------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+--------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+--------------------------------------------+ | Transaction identifier | | +-------------------------+--------------------------------------------+ | Message type | RELEASE COMPLETE (xx10 1010) | +-------------------------+--------------------------------------------+ | Facility | Return result = LCS-LocationNotification | | | | | | LocationNotificationRes | | | | | | verificationResponse -> permissionGranted | +-------------------------+--------------------------------------------+
##### RELEASE COMPLETE (Step 13) {#release-complete-step-13 .H6}
+-------------------------+-------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+-------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+-------------------------------------------+ | Transaction identifier | | +-------------------------+-------------------------------------------+ | Message type | RELEASE COMPLETE (xx10 1010) | +-------------------------+-------------------------------------------+ | Facility | Return result = LCS-LocationNotification | | | | | | LocationNotificationRes | | | | | | verificationResponse -> permissionDenied | +-------------------------+-------------------------------------------+
##### RELEASE COMPLETE (Step 19) {#release-complete-step-19 .H6}
* * *
**Information element** **Value/remark** Protocol Discriminator Call
Independent SS message (1011) Transaction identifier  
Message type RELEASE COMPLETE (0010 1010)
* * *
##### 6.2.3.4.5 Test requirements {#test-requirements-20 .H6}
After steps 4, 9 and 14 the UE shall notify the UE user of the location
request and indicate to the user that location will be allowed in the absence
of a response.
After step 7 the UE shall send a RELEASE COMPLETE message with
verificationResponse set to permissionGranted.
After step 12 the UE shall send a RELEASE COMPLETE message with
verificationResponse set to permissionDenied.
During step 18 the UE shall not send any RELEASE COMPLETE message.
#### 6.2.3.5 Privacy Verification - Location Not Allowed if No Response
##### 6.2.3.5.1 Definition {#definition-21 .H6}
This test case applies to all UEs supporting UE-Based or UE-Assisted GANSS or
GNSS Location Service capabilities and LCS value added location request
notification capability.
##### 6.2.3.5.2 Conformance requirements {#conformance-requirements-22 .H6}
> 1) The network invokes a location notification procedure by sending a
> REGISTER message containing a LCS-LocationNotification invoke component to
> the UE. This may be sent either to request verification for MT-LR or to
> notify about already authorized MT-LR.
>
> 2) In case of privacy verification the MS shall respond to the request by
> sending a RELEASE COMPLETE message containing the mobile subscriber\'s
> response in a return result component.
>
> 3) If the timer expires in the network before any response from the MS (e.g.
> due to no response from the user), the network shall interpret this by
> applying the default treatment defined in GSM 03.71 for GSM and TS 23.171
> for UMTS (i.e. disallow location if barred by subscription and allow
> location if allowed by subscription).
References
> \- Conformance requirement 1, 2 and 3: TS 24.030, clause 4.1.1
##### 6.2.3.5.3 Test Purpose {#test-purpose-21 .H6}
To verify that when the UE receives a REGISTER message, containing a LCS
Location Notification Invoke component set to notifyAndVerify-
LocationNotAllowedIfNoResponse, the UE notifies the UE user of the location
request and indicates that the default response is location not allowed if no
response and providing the opportunity to accept or deny the request and sends
a RELEASE COMPLETE message containing a LocationNotification return result
with verificationResponse set to permissionDenied or permissionGranted as
appropriate.
##### 6.2.3.5.4 Method of Test {#method-of-test-21 .H6}
Initial Conditions
System Simulator (SS):
> \- 1 cell, default parameters
>
> \- Satellite signals switched off or not present
##### UE: {#ue-11 .H6}
> \- State \"CS-CELL DCH Initial (State 6-1)\" as specified in clause 7.4.1 of
> TS 34.108.
##### Related PICS/PIXIT Statements {#related-picspixit-statements-32 .H6}
> \- UE Based Network Assisted GANSS.
>
> \- UE Assisted Network Assisted GANSS.
>
> \- UE supporting LCS value added location request notification capability.
>
> \- px_UeLcsNotification: value for UE LCS Notification timeout timer.
##### Test Procedure {#test-procedure-32 .H6}
The SS initiates authentication and ciphering and sends a REGISTER message
containing a Facility IE containing a LCS Location Notification Invoke message
set to notifyAndVerify-LocationNotAllowedIfNoResponse.
The UE notifies the UE user of the location request with the option to accept
or deny the request and an indication that location will be not allowed if no
user response is received.
The user accepts the location request. The UE responds with a RELEASE COMPLETE
message containing a LocationNotification return result with
verificationResponse set to permissionGranted.
The SS sends a REGISTER message containing a Facility IE containing a LCS
Location Notification Invoke message set to notifyAndVerify-
LocationNotAllowedIfNoResponse.
The UE notifies the UE user of the location request with the option to accept
or deny the request and an indication that location will be not allowed if no
user response is received.
The user denies the location request. The UE responds with a RELEASE COMPLETE
message containing a LocationNotification return result with
verificationResponse set to permissionDenied.
The SS sends a REGISTER message containing a Facility IE containing a LCS
Location Notification Invoke message set to notifyAndVerify-
LocationNotAllowedIfNoResponse.
The UE notifies the UE user of the location request with the option to accept
or deny the request and an indication that location will be not allowed if no
user response is received.
The user ignores the location request by taking no action, allowing the
verification process to time-out.
The SS send a RELEASE COMPLETE.
Expected Sequence
+----------+---------------+-----------------+-----------------+---+ | **Step** | **Direction** | **Message** | **Comments** | | +----------+---------------+-----------------+-----------------+---+ | | **UE** | **SS** | | | +----------+---------------+-----------------+-----------------+---+ | 1 | \ | AUTHENTICATION | | | | | | RESPONSE | | | +----------+---------------+-----------------+-----------------+---+ | 3 | SS | | SS starts | | | | | | security | | | | | | procedure | | +----------+---------------+-----------------+-----------------+---+ | 4 | \ | RELEASE | Containing a | | | | | COMPLETE | Locat | | | | | | ionNotification | | | | | | return result | | | | | | with | | | | | | verif | | | | | | icationResponse | | | | | | set to | | | | | | pe | | | | | | rmissionGranted | | +----------+---------------+-----------------+-----------------+---+ | 9 | \ | RELEASE | Containing a | | | | | COMPLETE | Locat | | | | | | ionNotification | | | | | | return result | | | | | | with | | | | | | verif | | | | | | icationResponse | | | | | | set to | | | | | | p | | | | | | ermissionDenied | | +----------+---------------+-----------------+-----------------+---+ | 14 | \ | | | notif | | | yAndVerify-LocationNotAllowedIfNoResponse | | | | | | locationType -> current Location | | | | | | lcsClientExternalID -> externalAddress | | | | | | lcsClientName ->dataCodingScheme\ | | | nameString | +-------------------------+-------------------------------------------+
##### RELEASE COMPLETE (Step 8) {#release-complete-step-8-1 .H6}
+-------------------------+--------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+--------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+--------------------------------------------+ | Transaction identifier | | +-------------------------+--------------------------------------------+ | Message type | RELEASE COMPLETE (xx10 1010) | +-------------------------+--------------------------------------------+ | Facility | Return result = LCS-LocationNotification | | | | | | LocationNotificationRes | | | | | | verificationResponse -> permissionGranted | +-------------------------+--------------------------------------------+
##### RELEASE COMPLETE (Step 13) {#release-complete-step-13-1 .H6}
+-------------------------+-------------------------------------------+ | **Information element** | **Value/remark** | +-------------------------+-------------------------------------------+ | Protocol Discriminator | Call Independent SS message (1011) | +-------------------------+-------------------------------------------+ | Transaction identifier | | +-------------------------+-------------------------------------------+ | Message type | RELEASE COMPLETE (xx10 1010) | +-------------------------+-------------------------------------------+ | Facility | Return result = LCS-LocationNotification | | | | | | LocationNotificationRes | | | | | | verificationResponse -> permissionDenied | +-------------------------+-------------------------------------------+
##### RELEASE COMPLETE (Step 19) {#release-complete-step-19-1 .H6}
* * *
**Information element** **Value/remark** Protocol Discriminator Call
Independent SS message (1011) Transaction identifier  
Message type RELEASE COMPLETE (0010 1010)
* * *
##### 6.2.3.5.5 Test requirements {#test-requirements-21 .H6}
After steps 4, 9 and 14 the UE shall notify the UE user of the location
request and indicate to the user that location will be not allowed in the
absence of a response.
After step 7 the UE shall send a RELEASE COMPLETE message with
verificationResponse set to permissionGranted.
After step 12 the UE shall send a RELEASE COMPLETE message with
verificationResponse set to permissionDenied.
During step 18 the UE shall not send any RELEASE COMPLETE message.
# 7 Protocol Conformance Test Cases for E-UTRAN
## 7.1 NAS Protocol Procedures
### 7.1.1 UE Network Capability
##### 7.1.1.1 Test Purpose (TP) {#test-purpose-tp .H6}
(1)
**with** { the UE having received an RRCConnectionSetup message. }
**ensure that** {\ **when** { the UE transmits ATTACH REQUEST }
**then** { the UE correctly sets UE Network Capability IE values for LCS and
LPP }
}
##### 7.1.1.2 Conformance requirements {#conformance-requirements-23 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.171 clause 4.2.1 and TS 24.301 clause 9.9.3.3.
[TS 24.171, clause 4.2.1]
The UE announces to the network its ability to support LCS notification
mechanism and/or LPP messages using the UE Network Capability IE defined in
3GPP TS 24.301.
[TS 24.301, clause 9.9.3.3]
The purpose of the UE network capability information element is to provide the
network with information concerning aspects of the UE related to EPS or
interworking with GPRS. The contents might affect the manner in which the
network handles the operation of the UE. The UE network capability information
indicates general UE characteristics and it shall therefore, except for fields
explicitly indicated, be independent of the frequency band of the channel it
is sent on.
...
##### 7.1.1.3 Test description {#test-description .H6}
##### 7.1.1.3.1 Pre-test conditions {#pre-test-conditions .H6}
System Simulator:
> \- Cell 1.
>
> \- Satellite signals switched off or not present
##### UE: {#ue-12 .H6}
> -
Preamble:
> \- the UE is in state Switched OFF (state 1) according to 3GPP 36.508 [8].
Related PICS/PIXIT Statements:
> -
##### 7.1.1.3.2 Test procedure sequence {#test-procedure-sequence .H6}
Table 7.1.1.3.2-1: Main behaviour
+---------+-----------+-----------+-----------+-----------+----+ | **St** | **Pr |** Message | **TP** | ** | | | | ocedure**| S | | Verdict** | | | | | equence**| | | | +=========+===========+===========+===========+===========+====+ | | |** U - S**| ** | | | | | | | Message** | | | +---------+-----------+-----------+-----------+-----------+----+ | 1 | | \ | RRC: | - | - | | | transmits | | _RRC | | | | | an | | Connectio | | | | |_ RRC | | nRequest _| | | | | Connectio | | | | | | | nRequest_ | | | | | | | message. | | | | | +---------+-----------+-----------+-----------+-----------+----+ | 3 | SS | \ | RRC: | 1 | P | | | transmits | | * | | | | | an | | RRCConnec | | | | | * | | tionSetup | | | | | RRCConnec | | Complete _| | | | | tionSetup | | | | | | | Complete_ | | NAS: | | | | | message | | ATTACH | | | | | to | | REQUEST | | | | | confirm | | | | | | | the | | NAS: PDN | | | | | s | | CON | | | | | uccessful | | NECTIVITY | | | | | c | | REQUEST | | | | | ompletion | | | | | | | of the | | | | | | | c | | | | | | | onnection | | | | | | | esta | | | | | | | blishment | | | | | | | and to | | | | | | | initiate | | | | | | | the | | | | | | | Attach | | | | | | | procedure | | | | | | | by | | | | | | | including | | | | | | | the | | | | | | | ATTACH | | | | | | | REQUEST | | | | | | | message. | | | | | | | The PDN | | | | | | | CON | | | | | | | NECTIVITY | | | | | | | REQUEST | | | | | | | message | | | | | | | is | | | | | | | pi | | | | | | | ggybacked | | | | | | | in ATTACH | | | | | | | REQUEST | | | | | +---------+-----------+-----------+-----------+-----------+----+ | 5 to 17 | Steps 5 | | | | | | | to 17 of | | | | | | | the | | | | | | | reg | | | | | | | istration | | | | | | | procedure | | | | | | | described | | | | | | | in TS | | | | | | | 36.508 | | | | | | | subclause | | | | | | | 4.5.2.3 | | | | | | | are | | | | | | | p | | | | | | | erformed. | | | | | | | | | | | | | | NOTE: The | | | | | | | UE | | | | | | | performs | | | | | | | reg | | | | | | | istration | | | | | | | and the | | | | | | | RRC | | | | | | | c | | | | | | | onnection | | | | | | | is | | | | | | | released. | | | | | +---------+-----------+-----------+-----------+-----------+----+
##### 7.1.1.3.3 Specific message contents {#specific-message-contents-32 .H6}
Table 7.1.1.3.3-1: ATTACH REQUEST (step 4, Table 7.1.1.3.2-1)
* * *
Derivation Path: 24.301 clause 8.2.4  
Information Element Value/remark Comment Condition Protocol discriminator EMM  
Security header type \'0000\'B Plain NAS message, not security protected  
Attach request message identity \'0100 0001\'B Attach request  
EPS attach type \'0001\'B EPS attach EPS_only \'0010\'B combined EPS/IMSI
attach combined_EPS_IMSI NAS key set identifier Any allowed value  
Old GUTI or IMSI Any allowed value  
UE network capability Set according to Table 7.1.1.3.3-2  
ESM message container PDN CONNECTIVITY REQUEST message to request PDN
connectivity to the default PDN  
Old P-TMSI signature Not present or any allowed value  
Additional GUTI Not present or any allowed value  
Last visited registered TAI Not present or any allowed value  
DRX parameter Not present or any allowed value  
MS network capability Not present or any allowed value  
Old location area identification Not present or any allowed value  
TMSI status Not present or any allowed value  
Mobile station classmark 2 Not present or any allowed value  
Mobile station classmark 3 Not present or any allowed value  
Supported Codecs Not present or any allowed value  
Additional update type Not present EPS_only Additional update type Not present
or any allowed value combined_EPS_IMSI
* * *
* * *
Condition Explanation EPS_only See the definition below table 4.7.2-1 in TS
36.508. combined_EPS_IMSI See the definition below table 4.7.2-1 in TS 36.508.
* * *
NOTE: This message is sent integrity protected when a valid security context
exists and without integrity protection otherwise.
Table 7.1.1.3.3-2: UE network capability (step 4, Table 7.1.1.3.2-1)
* * *
Derivation Path: 24.301 clause 9.9.3.34  
**Information Element Contents** **Value/remark** **Comment** **Condition**
Octet 7, bit 3 Set according to pc_MT_LR_loc_notif Location services (LCS)
notification mechanisms capability  
Octet 7, bit 4 1 (LPP supported) LTE Positioning Protocol (LPP) capability  
All other octets/bits Any allowed value
* * *
## 7.2 LCS Procedures
### 7.2.1 Location Notification and Privacy Verification
#### 7.2.1.1 Location Notification
##### 7.2.1.1.1 Test Purpose (TP) {#test-purpose-tp-1 .H6}
##### (1) {#section .H6}
**with** { a NAS signalling connection existing }
**ensure that** {\ **when** { UE receives a REGISTER message containing the
LCS-LocationNotification Invoke component set to NotifyLocationAllowed }
**then** { UE notifies the user of the location procedure and terminates the
dialogue by sending a\ RELEASE COMPLETE message }
}
##### 7.2.1.1.2 Conformance requirements {#conformance-requirements-24 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.171, clause 5.2.1.1.1.
[TS 24.171, clause 5.2.1.1.1]
The network invokes a location notification procedure by sending a REGISTER
message containing a LCS-LocationNotification invoke component to the UE. This
may be sent either to request verification for MT-LR or to notify about
already authorized MT-LR.
...
In the case of location notification no response is required from the UE, the
UE shall terminate the dialogue by sending a RELEASE COMPLETE message
containing a LocationNotification return result.
...
##### 7.2.1.1.3 Test description {#test-description-1 .H6}
##### 7.2.1.1.3.1 Pre-test conditions {#pre-test-conditions-1 .H6}
##### System Simulator: {#system-simulator .H6}
\- Cell 1.
##### UE: {#ue-13 .H6}
-
##### Preamble: {#preamble .H6}
> \- The UE is in state Generic RB Established (state 3) according to 3GPP
> 36.508 [8].
##### Related PICS/PIXIT Statements: {#related-picspixit-statements-33 .H6}
> \- UE supporting LCS value added location request notification capability.
##### 7.2.1.1.3.2 Test procedure sequence {#test-procedure-sequence-1 .H6}
Table 7.2.1.1.3.2-1: Main behaviour
+--------+------------+------------+------------+------------+----+ | **St** | **P |** Message | **TP** | * | | | | rocedure**| Sequence** | | _Verdict_ _| | +========+============+============+============+============+====+ | | |__U - S_ _| * | | | | | | |_ Message __| | | +--------+------------+------------+------------+------------+----+ | 1 | The SS | \  | _UL | 1 | P | | | terminates | | Informatio | | | | | the | | nTransfer_ | | | | | dialogue | | | | | | | by sending | | (RELEASE | | | | | a RELEASE | | COMPLETE) | | | | | COMPLETE | | | | | | | message. | | | | | +--------+------------+------------+------------+------------+----+
##### 7.2.1.1.3.3 Specific message contents {#specific-message-contents-33
.H6}
_Table_ 7.2.1.1.3.3-1 _:_ _DLInformationTransfer_ (step 1, Table
7.2.1.1.3.2-1)
* * *
Derivation Path: 36.331 clause 6.2.2  
**Information Element** **Value/remark** **Comment** **Condition**
DLInformationTransfer ::= SEQUENCE {  
rrc-TransactionIdentifier  
criticalExtensions CHOICE {  
c1 CHOICE {  
dlInformationTransfer-r8 SEQUENCE {  
dedicatedInfoType CHOICE {  
dedicatedInfoNAS OCTET STRING Set according to Table 7.2.1.1.3.3-2 DOWNLINK
GENERIC NAS TRANSPORT  
}  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}  
}
* * *
Table 7.2.1.1.3.3-2: DOWNLINK GENERIC NAS TRANSPORT (step 1, Table
7.2.1.1.3.2-1)
* * *
Derivation Path: 24.301 Table 8.2.31.1  
**Information Element** **Value/remark** **Comment** **Condition** Protocol
discriminator 0111 EPS mobility management messages  
Security header type 0000 Plain NAS message  
Downlink generic NAS transport message identity 01101000 Downlink generic NAS
transport  
Generic message container type 00000010 Location services message container  
Generic message container Set according to Table 7.2.1.1.3.3-3 REGISTER  
Additional information Not present.
* * *
Table 7.2.1.1.3.3-3: REGISTER (step 1, Table 7.2.1.1.3.2-1)
* * *
Derivation Path: 24.080 Table 2.3  
**Information Element** **Value/remark** **Comment** **Condition**
Supplementary service protocol discriminator 1011 supplementary services (call
independent)  
Transaction identifier  
Register message type 0011 1011 REGISTER  
Facility Invoke = lcs-LocationNotification Set according to Table
7.2.1.1.3.3‑4
* * *
Table 7.2.1.1.3.3-4: LCS-LocationNotification (step 1, Table 7.2.1.1.3.2-1)
* * *
Derivation Path: 24.080 clause 4.4.2  
**Information Element** **Value/remark** **Comment** **Condition**
LocationNotificationArg ::= SEQUENCE {  
notificationType notifyLocationAllowed  
locationType currentLocation  
lcsClientExternalID SEQUENCE {  
externalAddress ISDN-AddressString  
}  
lcsClientName SEQUENCE {  
dataCodingScheme USSD‑DataCodingScheme  
nameString NameString  
}  
}
* * *
Table 7.2.1.1.3.3-5: _ULInformationTransfer_ (step 3, Table 7.2.1.1.3.2-1)
* * *
Derivation Path: 36.331 clause 6.2.2  
**Information Element** **Value/remark** **Comment** **Condition**
ULInformationTransfer ::= SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
ulInformationTransfer-r8 SEQUENCE {  
dedicatedInfoType CHOICE {  
dedicatedInfoNAS OCTET STRING Set according to Table 7.2.1.1.3.3-6 UPLINK
GENERIC NAS TRANSPORT  
}  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}  
}
* * *
Table 7.2.1.1.3.3-6: UPLINK GENERIC NAS TRANSPORT (step 3, Table
7.2.1.1.3.2-1)
* * *
Derivation Path: 24.301 Table 8.2.32.1  
**Information Element** **Value/remark** **Comment** **Condition** Protocol
discriminator 0111 EPS mobility management messages  
Security header type 0000 Plain NAS message  
Uplink generic NAS transport message identity 01101001 Uplink generic NAS
transport  
Generic message container type 00000010 Location services message container  
Generic message container Set according to Table 7.2.1.1.3.3-7 RELEASE
COMPLETE  
Additional information Not present
* * *
Table 7.2.1.1.3.3-7: RELEASE COMPLETE (step 3, Table 7.2.1.1.3.2-1)
* * *
Derivation Path: 24.080 Table 2.5  
**Information Element** **Value/remark** **Comment** **Condition**
Supplementary service protocol discriminator 1011 supplementary services (call
independent)  
Transaction identifier  
Release Complete message type xx10 1010 RELEASE COMPLETE  
Facility Return result = LocationNotificationRes Set according to Table
7.2.1.1.3.3‑8
* * *
Table 7.2.1.1.3.3-8: LocationNotificationRes (step 3, Table 7.2.1.1.3.2-1)
* * *
Derivation Path: 24.080 clause 4.4.2  
**Information Element** **Value/remark** **Comment** **Condition**
LocationNotificationRes ::= SEQUENCE {  
verificationResponse permissionGranted  
}
* * *
#### 7.2.1.2 Privacy Verification -- Location Allowed if no Response
##### 7.2.1.2.1 Test Purpose (TP) {#test-purpose-tp-2 .H6}
##### (1) {#section-1 .H6}
**with** { a NAS signalling connection existing }
**ensure that** {\ **when** { UE receives a REGISTER message containing the
LCS-LocationNotification Invoke component\ set to NotifyAndVerify-
LocationAllowedIfNoResponse }
**then** { UE notifies the user of the location procedure and indicates that
the default response\ is location allowed, allows the user to accept or deny
the request and terminates the\ dialogue by sending a RELEASE COMPLETE message
with verificationResponse set as\ appropriate }
}
##### (2) {#section-2 .H6}
**with** { a NAS signalling connection existing }
**ensure that** {\ **when** { UE receives a REGISTER message containing the
LCS-LocationNotification Invoke component\ set to NotifyAndVerify-
LocationAllowedIfNoResponse }
**then** { UE notifies the user of the location procedure and indicates that
the default response\ is location allowed, allows the user to accept or deny
the request and waits for the\ user to respond }
}
##### 7.2.1.2.2 Conformance requirements {#conformance-requirements-25 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.171, clause 5.2.1.1.1.
[TS 24.171, clause 5.2.1.1.1]
The network invokes a location notification procedure by sending a REGISTER
message containing a LCS-LocationNotification invoke component to the UE. This
may be sent either to request verification for MT-LR or to notify about
already authorized MT-LR.
In case of privacy verification the UE shall respond to the request by sending
a RELEASE COMPLETE message containing the mobile subscriber\'s response in a
return result component.
If the timer T(LCSN) expires in the network before any response from the UE
(e.g. due to no response from the user), the network shall interpret this by
applying the default treatment defined in 3GPP TS 23.271 (i.e. disallow
location if barred by subscription and allow location if allowed by
subscription).
...
##### 7.2.1.2.3 Test description {#test-description-2 .H6}
##### 7.2.1.2.3.1 Pre-test conditions {#pre-test-conditions-2 .H6}
System Simulator:
> \- Cell 1.
##### UE: {#ue-14 .H6}
> -
##### Preamble: {#preamble-1 .H6}
\- The UE is in state Generic RB Established (state 3) according to 3GPP
36.508 [8].
##### Related PICS/PIXIT Statements: {#related-picspixit-statements-34 .H6}
\- UE supporting LCS value added location request notification capability.
\- px_UeLcsNotification: value for UE LCS Notification timeout timer.
##### 7.2.1.2.3.2 Test procedure sequence {#test-procedure-sequence-2 .H6}
Table 7.2.1.2.3.2-1: Main behaviour
+--------+------------+------------+------------+------------+----+ | **St** | **P |** Message | **TP** | * | | | | rocedure**| Sequence** | | _Verdict_ _| | +========+============+============+============+============+====+ | | |__U - S_ _| * | | | | | | |_ Message __| | | +--------+------------+------------+------------+------------+----+ | 1 | The SS | \  | _UL | 1 | P | | | terminates | | Informatio | | | | | the | | nTransfer_ | | | | | dialogue | | | | | | | by sending | | (RELEASE | | | | | a RELEASE | | COMPLETE) | | | | | COMPLETE | | | | | | | message. | | | | | +--------+------------+------------+------------+------------+----+ | 6 | The SS | \ | _UL | 1 | P | | | terminates | | Informatio | | | | | the | | nTransfer_ | | | | | dialogue | | | | | | | by sending | | (RELEASE | | | | | a RELEASE | | COMPLETE) | | | | | COMPLETE | | | | | | | message. | | | | | +--------+------------+------------+------------+------------+----+ | 11 | The SS | \ \- Cell 1.
##### UE: {#ue-15 .H6}
> -
##### Preamble: {#preamble-2 .H6}
\- The UE is in state Generic RB Established (state 3) according to 3GPP
36.508 [8].
##### Related PICS/PIXIT Statements: {#related-picspixit-statements-35 .H6}
\- UE supporting LCS value added location request notification capability.
\- px_UeLcsNotification: value for UE LCS Notification timeout timer.
##### 7.2.1.3.3.2 Test procedure sequence {#test-procedure-sequence-3 .H6}
Table 7.2.1.3.3.2-1: Main behaviour
+--------+------------+------------+------------+------------+----+ | **St** | **P |** Message | **TP** | * | | | | rocedure**| Sequence** | | _Verdict_ _| | +========+============+============+============+============+====+ | | |__U - S_ _| * | | | | | | |_ Message __| | | +--------+------------+------------+------------+------------+----+ | 1 | The SS | \  | _UL | 1 | P | | | terminates | | Informatio | | | | | the | | nTransfer_ | | | | | dialogue | | | | | | | by sending | | (RELEASE | | | | | a RELEASE | | COMPLETE) | | | | | COMPLETE | | | | | | | message. | | | | | +--------+------------+------------+------------+------------+----+ | 6 | The SS | \ | _UL | 1 | P | | | terminates | | Informatio | | | | | the | | nTransfer_ | | | | | dialogue | | | | | | | by sending | | (RELEASE | | | | | a RELEASE | | COMPLETE) | | | | | COMPLETE | | | | | | | message. | | | | | +--------+------------+------------+------------+------------+----+ | 11 | The SS | \ -
##### Preamble: {#preamble-3 .H6}
> \- The UE is in state Generic RB Established (state 3) according to 3GPP
> 36.508 [8].
##### Related PICS/PIXIT Statements: {#related-picspixit-statements-36 .H6}
\- Method of triggering an EPC-MO-LR request for assistance data.
##### 7.2.2.1.3.2 Test procedure sequence {#test-procedure-sequence-4 .H6}
This test case includes sub-test cases dependent on the positioning method(s)
supported by the UE. Each sub-test case is identified by a Sub-Test Case
Number as defined in Table 7.2.2.1.3.2-0 below:
Table 7.2.2.1.3.2-0: Sub-test case numbers
* * *
Sub-Test Case Number Supported Positioning Methods 1 Void 2 Void 3 Void 4 Void
8 Void 9 Void 10 Void 15 UE supporting GNSS^(1)^ 16 UE supporting MBS (Rel-14
onwards) 17 UE supporting WLAN (Rel-14 onwards) 18 UE supporting Sensor
(Rel-14 onwards) NOTE 1: The GNSS combination of GPS, GLONASS, Galileo, BDS
supported by the UE
* * *
Table 7.2.2.1.3.2-1: Main behaviour
+----+--------------+--------------+--------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +====+==============+==============+==============+=========+====+ | | | U - S | Message | | | +----+--------------+--------------+--------------+---------+----+ | 0 | The SS sends | \ | _ULInformat | 1 | P | | | a NAS PDU | | ionTransfer_ | | | | | containing | | | | | | | an MO-LR | | (REGISTER) | | | | | Request of | | | | | | | type | | | | | | | \"assi | | | | | | | stanceData\" | | | | | | | inside an | | | | | | | RRC UL | | | | | | | Information | | | | | | | Transfer | | | | | | | message. The | | | | | | | embedded LPP | | | | | | | message | | | | | | | specifies | | | | | | | the type of | | | | | | | assistance | | | | | | | data. | | | | | +----+--------------+--------------+--------------+---------+----+ | 2 | The SS | \ | _ULInformat | 2 | P | | | terminates | | ionTransfer_ | | | | | the dialogue | | | | | | | by sending a | | (RELEASE | | | | | RELEASE | | COMPLETE) | | | | | COMPLETE | | | | | | | message. | | | | | +----+--------------+--------------+--------------+---------+----+
##### 7.2.2.1.3.3 Specific message contents {#specific-message-contents-36
.H6}
Table 7.2.2.1.3.3-0: RESET UE POSITIONING STORED INFORMATION (step 0, Table
7.2.2.1.3.2-1)
+----------------+----------------+----------------+---------------+ | Derivation | | | | | Path: 36.509 | | | | | clause 6.9 | | | | +----------------+----------------+----------------+---------------+ | **Information | ** |** Comment**|** Condition**| | Element** | Value/remark** | | | +----------------+----------------+----------------+---------------+ | UE Positioning | Sub-test 15: 0 | Sub-test 15: | | | Technology | 0 0 0 0 0 0 0 | AGNSS | | | | | | | | | Sub-test 16: 0 | Sub-test 16: | | | | 0 0 0 0 0 1 0 | MBS | | | | | | | | | Sub-test 17: 0 | Sub-test 17: | | | | 0 0 0 0 0 1 1 | WLAN | | | | | | | | | Sub-test 18: 0 | Sub-test 18: | | | | 0 0 0 0 1 0 1 | Sensor | | +----------------+----------------+----------------+---------------+
Table 7.2.2.1.3.3-1: _ULInformationTransfer_ (steps 1 and 4, Table
7.2.2.1.3.2-1)
* * *
Derivation Path: 36.331 clause 6.2.2  
**Information Element** **Value/remark** **Comment** **Condition**
ULInformationTransfer ::= SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
ulInformationTransfer-r8 SEQUENCE {  
dedicatedInfoType CHOICE {  
dedicatedInfoNAS OCTET STRING Set according to Table 7.2.2.1.3.3-2 UPLINK
GENERIC NAS TRANSPORT  
}  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}  
}
* * *
Table 7.2.2.1.3.3-2: UPLINK GENERIC NAS TRANSPORT (steps 1 and 4, Table
7.2.2.1.3.2-1)
+----------------+----------------+----------------+---------------+ | Derivation | | | | | Path: 24.301 | | | | | Table 8.2.32.1 | | | | +----------------+----------------+----------------+---------------+ | **Information | ** |** Comment**|** Condition**| | Element** | Value/remark**| | | +----------------+----------------+----------------+---------------+ | Protocol | 0111 | EPS mobility | | | discriminator | | management | | | | | messages | | +----------------+----------------+----------------+---------------+ | Security | 0000 | Plain NAS | | | header type | | message | | +----------------+----------------+----------------+---------------+ | Uplink generic | 01101001 | Uplink generic | | | NAS transport | | NAS transport | | | message | | | | | identity | | | | +----------------+----------------+----------------+---------------+ | Generic | 00000010 | Location | | | message | | services | | | container type | | message | | | | | container | | +----------------+----------------+----------------+---------------+ | Generic |** Step 1:**| REGISTER | | | message | | | | | container | Set according | | | | | to Table | | | | | 7.2.2.1.3.3-3 | | | +----------------+----------------+----------------+---------------+ | |** Step 4:** | RELEASE | | | | | COMPLETE | | | | Set according | | | | | to Table | | | | | 7.2.2.1.3.3-11 | | | +----------------+----------------+----------------+---------------+ | Additional | Not present | | | | information | | | | +----------------+----------------+----------------+---------------+
Table 7.2.2.1.3.3-3: REGISTER (step 1, Table 7.2.2.1.3.2-1)
* * *
Derivation Path: 24.080 Table 2.4  
**Information Element** **Value/remark** **Comment** **Condition**
Supplementary service protocol discriminator 1011 supplementary services (call
independent)  
Transaction identifier  
Register message type xx11 1011 REGISTER  
Facility Invoke=LCS-MOLR Set according to Table 7.2.2.1.3.3‑4  
SS version Version 1 or above
* * *
Table 7.2.2.1.3.3-4: LCS-MOLRArg (step 1, Table 7.2.2.1.3.2-1)
* * *
Derivation Path: 24.080 clause 4.4.2
**Information Element** **Value/remark** **Comment** **Condition**
LCS-MOLRArg ::= SEQUENCE {
molr-Type assistanceData
multiplePositioningProtocolPDUs SEQUENCE\ At least one LPP message of type
Request Assistance Data (UE may include additional LPP messages) Set according
to Table 7.2.2.1.3.3‑5  
(SIZE (1..3)) OF OCTET STRING
}
* * *
Table 7.2.2.1.3.3-5: LPP Request Assistance Data (step 1, Table 7.2.2.1.3.2-1)
* * *
Derivation Path: 36.355 clause 6.2  
**Information Element** **Value/remark** **Comment** **Condition** LPP-Message
::= SEQUENCE {  
transactionID SEQUENCE {  
initiator targetDevice  
transactionNumber (0..255)  
}  
endTransaction FALSE  
sequenceNumber (0..255)  
acknowledgement Not present  
lpp-MessageBody CHOICE {  
c1 CHOICE {  
requestAssistanceData SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
requestAssistanceData-r9 SEQUENCE {  
commonIEsRequestAssistanceData Present or not present  
a-gnss-RequestAssistanceData Present for sub-test 15. May be present for other
sub-tests  
otdoa-RequestAssistanceData Not present  
epdu-RequestAssistanceData Not present  
sensor-RequestAssistanceData-r14 Present for sub-test 18. May be present for
other sub-tests Rel-14 onwards  
tbs-RequestAssistanceData-r14 Present for sub-test 16. May be present for
other sub-tests Rel-14 onwards  
wlan-RequestAssistanceData-r14 Present for sub-test 17. May be present for
other sub-tests Rel-14 onwards  
}  
}  
}  
}  
}  
}
* * *
_Table_ 7.2.2.1.3.3-6 _:_ _DLInformationTransfer_ (steps 2 and 3, Table
7.2.2.1.3.2-1)
* * *
Derivation Path: 36.331 clause 6.2.2  
**Information Element** **Value/remark** **Comment** **Condition**
DLInformationTransfer ::= SEQUENCE {  
rrc-TransactionIdentifier  
criticalExtensions CHOICE {  
c1 CHOICE {  
dlInformationTransfer-r8 SEQUENCE {  
dedicatedInfoType CHOICE {  
dedicatedInfoNAS OCTET STRING Set according to Table 7.2.2.1.3.3-7 DOWNLINK
GENERIC NAS TRANSPORT  
}  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}  
}
* * *
Table 7.2.2.1.3.3-7: DOWNLINK GENERIC NAS TRANSPORT (steps 2 and 3, Table
7.2.2.1.3.2-1)
+----------------+----------------+----------------+---------------+ | Derivation | | | | | Path: 24.301 | | | | | Table 8.2.31.1 | | | | +----------------+----------------+----------------+---------------+ | **Information | ** |** Comment**|** Condition**| | Element** | Value/remark**| | | +----------------+----------------+----------------+---------------+ | Protocol | 0111 | EPS mobility | | | discriminator | | management | | | | | messages | | +----------------+----------------+----------------+---------------+ | Security | 0000 | Plain NAS | | | header type | | message | | +----------------+----------------+----------------+---------------+ | Downlink | 01101000 | Downlink | | | generic NAS | | generic NAS | | | transport | | transport | | | message | | | | | identity | | | | +----------------+----------------+----------------+---------------+ | Generic |** Step 2:**| LTE | | | message | | Positioning | | | container type | 00000001 | Protocol (LPP) | | | | | message | | | | | container | | +----------------+----------------+----------------+---------------+ | |** Step 3:**| Location | | | | | services | | | | 00000010 | message | | | | | container | | +----------------+----------------+----------------+---------------+ | Generic |** Step 2:**| LPP Provide | | | message | | Assistance | | | container | Set according | Data | | | | to Table | | | | | 7.2.2.1.3.3-8 | | | +----------------+----------------+----------------+---------------+ | |** Step 3:**| FACILITY | | | | | | | | | Set according | | | | | to Table | | | | | 7.2.2.1.3.3-9 | | | +----------------+----------------+----------------+---------------+ | Additional |** Step 2:**| Routing | | | information | | Identifier/ | | | | Present | | | | | | Correlation ID | | +----------------+----------------+----------------+---------------+ | |** Step 3:** | | | | | | | | | | Not present. | | | +----------------+----------------+----------------+---------------+
Table 7.2.2.1.3.3-8: LPP Provide Assistance Data (step 2, Table 7.2.2.1.3.2-1)
* * *
Derivation Path: Table 5.4-2  
**Information Element** **Value/remark** **Comment** **Condition** LPP-Message
::= SEQUENCE {  
transactionID SEQUENCE {  
initiator targetDevice  
transactionNumber (0..255) Contains the same value as the corresponding field
in the LPP Request Assistance Data message in step 1 Table 7.2.2.1.3.2-1.  
}  
endTransaction TRUE  
sequenceNumber Not present  
acknowledgement Not present  
lpp-MessageBody CHOICE {  
c1 CHOICE {  
provideAssistanceData SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
provideAssistanceData-r9 SEQUENCE {  
a-gnss-ProvideAssistanceData The SS provides the assistance data requested by
the UE at step 1, Table 7.2.2.1.3.2‑1 which are available according to TS
37.571-5 [12].  
sensor-ProvideAssistanceData-r14 The SS provides the assistance data requested
by the UE at step 1, Table 7.2.2.1.3.2-1 which are available according to
subclause 5.4.1.5. Rel-14 onwards  
tbs-ProvideAssistanceData-r14 The SS provides the assistance data requested by
the UE at step 1, Table 7.2.2.1.3.2-1 which are available according to
subclause 5.4.1.3. Rel-14 onwards  
wlan-ProvideAssistanceData-r14 The SS provides the assistance data requested
by the UE at step 1, Table 7.2.2.1.3.2-1 which are available according to
subclause 5.4.1.4. Rel-14 onwards  
}  
}  
}  
}  
}  
}
* * *
Table 7.2.2.1.3.3-9: FACILITY (step 3, Table 7.2.2.1.3.2-1)
* * *
Derivation Path: 24.080 Table 2.3  
**Information Element** **Value/remark** **Comment** **Condition**
Supplementary service protocol discriminator 1011 supplementary services (call
independent)  
Transaction identifier  
Facility message type 0011 1010 FACILITY  
Facility Return Result=LCS‑MOLRRes Set according to Table 7.2.2.1.3.3‑10
* * *
Table 7.2.2.1.3.3-10: LCS-MOLRRes (step 3, Table 7.2.2.1.3.2-1)
* * *
Derivation Path: 24.080 clause 4.4.2  
**Information Element** **Value/remark** **Comment** **Condition** LCS-
MOLRRes::= SEQUENCE { empty  
}
* * *
Table 7.2.2.1.3.3-11: RELEASE COMPLETE (step 4, Table 7.2.2.1.3.2-1)
* * *
Derivation Path: 24.080 Table 2.5  
**Information Element** **Value/remark** **Comment** **Condition**
Supplementary service protocol discriminator 1011 supplementary services (call
independent)  
Transaction identifier  
Release Complete message type xx10 1010 RELEASE COMPLETE
* * *
#### 7.2.2.2 Basic Self Location: UE-assisted
##### 7.2.2.2.1 Test Purpose (TP) {#test-purpose-tp-5 .H6}
##### (1) {#section-7 .H6}
**with** { a NAS signalling connection existing }
**ensure that** {\ **when** { an EPC-MO-LR location session is initiated at
the UE of type \"locationEstimate\" }
**then** { UE sends a REGISTER message containing a LCS-MOLR invoke component
}
}
##### (2) {#section-8 .H6}
**with** { UE having performed the last location request operation }
**ensure that** {\ **when** { UE has received a FACILITY message containing
the LCS-MOLR return result component }
**then** { UE terminates the dialogue by sending a RELEASE COMPLETE message }
}
##### 7.2.2.2.2 Conformance requirements {#conformance-requirements-28 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 24.171, clause 5.2.2.1.
[TS 24.171, clause 5.2.2.1.1]
The UE invokes a MO-LR by sending a REGISTER message to the network containing
a LCS-MOLR invoke component. SS Version Indicator value 1 or above shall be
used.
...
The network shall pass the result of the location procedure to the UE by
sending a FACILITY message to the UE containing a LCS-MOLR return result
component.
...
After the last location request operation the UE shall terminate the dialogue
by sending a RELEASE COMPLETE message.
...
##### 7.2.2.2.3 Test description {#test-description-5 .H6}
##### 7.2.2.2.3.1 Pre-test conditions {#pre-test-conditions-5 .H6}
##### System Simulator: {#system-simulator-1 .H6}
\- Sub-tests 11, 12, 13, 14, 15, 16, 17, 18: Cell 1.
\- Sub-test 5: Cell 1, Cell 2 as specified in 5.2.2.
\- Sub-tests 6 FDD, 6 TDD: Cell 1, Cell 2 as specified in 5.2.3.
\- Satellite signals (Sub-test 15): As specified in 5.2.1.
\- WLAN signals (Sub-test 11, 17): as specified in 5.2.5.
\- MBS signals (Sub-tests 12, 16): as specified in 5.2.4.
\- Bluetooth signals (Sub-test 13): as specified in 5.2.6.
##### UE: {#ue-17 .H6}
-
##### Preamble: {#preamble-4 .H6}
\- The UE is in state Generic RB Established (state 3) according to 3GPP TS
36.508 [8].
##### Related PICS/PIXIT Statements: {#related-picspixit-statements-37 .H6}
\- Method of triggering an EPC-MO-LR request for a location estimate.
##### 7.2.2.2.3.2 Test procedure sequence {#test-procedure-sequence-5 .H6}
This test case includes sub-test cases dependent on the positioning method(s)
supported by the UE. Each sub-test case is identified by a Sub-Test Case
Number as defined in Table 7.2.2.2.3.2-0 below:
Table 7.2.2.2.3.2-0: Sub-test case numbers
* * *
**Sub-Test Case Number** **Supported Positioning Methods** 1 Void 2 Void 3
Void 4 Void 5 UE supporting OTDOA 6 FDD UE supporting ECID (FDD) 6 TDD UE
supporting ECID (TDD) 8 Void 9 Void 10 Void 11 UE supporting WLAN (Rel-13
only) 12 UE supporting MBS (Rel-13 only) 13 UE supporting Bluetooth 14 UE
supporting Sensor (Rel-13 only) 15 UE supporting GNSS^(1)^ 16 UE supporting
MBS (Rel-14 onwards) 17 UE supporting WLAN (Rel-14 onwards) 18 UE supporting
Sensor (Rel-14 onwards) NOTE 1: The GNSS combination of GPS, GLONASS, Galileo,
BDS supported by the UE
* * *
Table 7.2.2.2.3.2-1: Main behaviour
+----+--------------+--------------+--------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +====+==============+==============+==============+=========+====+ | | | U - S | Message | | | +----+--------------+--------------+--------------+---------+----+ | 0 | IF NOT | \ | _ULInformat | 1 | P | | | a NAS PDU | | ionTransfer_ | | | | | containing | | | | | | | an MO-LR | | (REGISTER) | | | | | Request of | | | | | | | type | | | | | | | \"locati | | | | | | | onEstimate\" | | | | | | | inside an | | | | | | | RRC UL | | | | | | | Information | | | | | | | Transfer | | | | | | | message. The | | | | | | | MO-LR | | | | | | | message may | | | | | | | optionally | | | | | | | include up | | | | | | | to three LPP | | | | | | | positioning | | | | | | | messages. | | | | | +----+--------------+--------------+--------------+---------+----+ | 2a | IF | \ | _ULInformat | - | - | | | | | ionTransfer_ | | | | | the SS | | | | | | | performed | | (LPP PROVIDE | | | | | step 2a | | C | | | | | | | APABILITIES) | | | | | THEN | | | | | | | | | | | | | | the UE sends | | | | | | | a LPP | | | | | | | message of | | | | | | | type Provide | | | | | | | Capabilities | | | | | | | including | | | | | | | the UE | | | | | | | positioning | | | | | | | c | | | | | | | apabilities. | | | | | +----+--------------+--------------+--------------+---------+----+ | 2c | IF | \ | _ULInformat | - | - | | | a LPP | | ionTransfer_ | | | | | message of | | | | | | | type Provide | | (LPP PROVIDE | | | | | Location | | LOCATION | | | | | Information | | INFORMATION) | | | | | including | | | | | | | measurements | | | | | | | as requested | | | | | | | at step 4. | | | | | +----+--------------+--------------+--------------+---------+----+ | 5a | IF | \ | _ULInformat | 2 | P | | | terminates | | ionTransfer_ | | | | | the dialogue | | | | | | | by sending a | | (RELEASE | | | | | RELEASE | | COMPLETE) | | | | | COMPLETE | | | | | | | message. | | | | | +----+--------------+--------------+--------------+---------+----+
##### 7.2.2.2.3.3 Specific message contents {#specific-message-contents-37
.H6}
Table 7.2.2.2.3.3-0: RESET UE POSITIONING STORED INFORMATION (step 0, Table
7.2.2.2.3.2-1)
+----------------+----------------+----------------+---------------+ | Derivation | | | | | Path: 36.509 | | | | | clause 6.9 | | | | +----------------+----------------+----------------+---------------+ | **Information | ** |** Comment**|** Condition**| | Element** | Value/remark** | | | +----------------+----------------+----------------+---------------+ | UE Positioning | Sub-test 15: 0 | Sub-test 15: | | | Technology | 0 0 0 0 0 0 0 | AGNSS | | | | | | | | | Sub-test 5: 0 | Sub-test 5: | | | | 0 0 0 0 0 0 1 | OTDOA | | | | | | | | | Sub-test 11, | Sub-test 11, | | | | 17: 0 0 0 0 0 | 17: WLAN | | | | 0 1 1 | | | | | | Sub-tests 12, | | | | Sub-tests 12, | 16: MBS | | | | 16: 0 0 0 0 0 | | | | | 0 1 0 | Sub-test 13: | | | | | Bluetooth | | | | Sub-test 13: 0 | | | | | 0 0 0 0 1 0 0 | Sub-test 14, | | | | | 18: Sensor | | | | Sub-test 14, | | | | | 18: 0 0 0 0 0 | | | | | 1 0 1 | | | +----------------+----------------+----------------+---------------+
Table 7.2.2.2.3.3-1: _ULInformationTransfer_ (steps 1, 2b, 5 and 7, Table
7.2.2.2.3.2-1)
* * *
Derivation Path: 36.331 clause 6.2.2  
Information Element Value/remark Comment Condition ULInformationTransfer ::=
SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
ulInformationTransfer-r8 SEQUENCE {  
dedicatedInfoType CHOICE {  
dedicatedInfoNAS OCTET STRING Set according to Table 7.2.2.2.3.3-2 UPLINK
GENERIC NAS TRANSPORT  
}  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}  
}
* * *
Table 7.2.2.2.3.3-2: UPLINK GENERIC NAS TRANSPORT (steps 1, 2b, 5 and 7, Table
7.2.2.2.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 24.301 | | | | | Table 8.2.32.1 | | | | +-----------------+-----------------+-----------------+-----------+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Protocol | 0111 | EPS mobility | | | discriminator | | management | | | | | messages | | +-----------------+-----------------+-----------------+-----------+ | Security header | 0000 | Plain NAS | | | type | | message | | +-----------------+-----------------+-----------------+-----------+ | Uplink generic | 01101001 | Uplink generic | | | NAS transport | | NAS transport | | | message | | | | | identity | | | | +-----------------+-----------------+-----------------+-----------+ | Generic message | **Steps 1 and | Location | | | container type | 7:** | services | | | | | message | | | | 00000010 | container | | +-----------------+-----------------+-----------------+-----------+ | | **Step 2b, and | LTE Positioning | | | | 5:** | Protocol (LPP) | | | | | message | | | | 00000001 | container | | +-----------------+-----------------+-----------------+-----------+ | Generic message | **Step 1:** | REGISTER | | | container | | | | | | Set according | | | | | to Table | | | | | 7.2.2.2.3.3-3 | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 2b:** | LPP Provide | | | | | Capabilities | | | | Set according | | | | | to Table | | | | | | | | | | 7.2.2.2.3.3-8 | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 5:** | LPP Provide | | | | | Location | | | | Set according | Information | | | | to Table | | | | | | | | | | 7.2.2.2.3.3-13 | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 7:** | RELEASE | | | | | COMPLETE | | | | Set according | | | | | to Table | | | | | 7.2.2.2.3.3-16 | | | +-----------------+-----------------+-----------------+-----------+ | Additional | **Steps 1 and | | | | information | 7:** | | | | | | | | | | Not present | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 2b:** | The UE includes | | | | | the Routing | | | | Present | Identifier | | | | | received in the | | | | | Additional | | | | | Information IE | | | | | of the DOWNLINK | | | | | GENERIC NAS | | | | | TRANSPORT | | | | | message (step | | | | | 2a Table | | | | | 7.2.2.2.3.2‑1) | | +-----------------+-----------------+-----------------+-----------+ | | **Step 5:** | The UE includes | | | | | the Routing | | | | | Identifier | | | | | received in the | | | | | Additional | | | | | Information IE | | | | | of the DOWNLINK | | | | | GENERIC NAS | | | | | TRANSPORT | | | | | message (step 4 | | | | | Table | | | | | 7.2.2.2.3.2‑1) | | +-----------------+-----------------+-----------------+-----------+
Table 7.2.2.2.3.3-3: REGISTER (step 1, Table 7.2.2.2.3.2-1)
* * *
Derivation Path: 24.080 Table 2.4  
Information Element Value/remark Comment Condition Supplementary service
protocol discriminator 1011 supplementary services (call independent)  
Transaction identifier  
Register message type xx11 1011 REGISTER  
Facility Invoke=LCS-MOLR Set according to Table 7.2.2.2.3.3‑4  
SS version Version 1 or above
* * *
Table 7.2.2.2.3.3-4: LCS-MOLRArg (step 1, Table 7.2.2.2.3.2-1)
* * *
Derivation Path: 24.080 clause 4.4.2
Information Element Value/remark Comment Condition
LCS-MOLRArg ::= SEQUENCE {
molr-Type locationEstimate
multiplePositioningProtocolPDUs SEQUENCE\ May include up to three LPP messages  
(SIZE (1..3)) OF OCTET STRING
}
* * *
_Table_ 7.2.2.2.3.3-5 _:_ _DLInformationTransfer_ (steps 2a, 2c, 2d, 3, 4, 5a
and 6, Table 7.2.2.2.3.2-1)
* * *
Derivation Path: 36.331 clause 6.2.2  
Information Element Value/remark Comment Condition DLInformationTransfer ::=
SEQUENCE {  
rrc-TransactionIdentifier  
criticalExtensions CHOICE {  
c1 CHOICE {  
dlInformationTransfer-r8 SEQUENCE {  
dedicatedInfoType CHOICE {  
dedicatedInfoNAS OCTET STRING Set according to Table 7.2.2.2.3.3-6 DOWNLINK
GENERIC NAS TRANSPORT  
}  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}  
}
* * *
Table 7.2.2.2.3.3-6: DOWNLINK GENERIC NAS TRANSPORT\ (steps 2a, 2c, 2d, 3, 4,
5a and 6, Table 7.2.2.2.3.2‑1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 24.301 | | | | | Table 8.2.31.1 | | | | +-----------------+-----------------+-----------------+-----------+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Protocol | 0111 | EPS mobility | | | discriminator | | management | | | | | messages | | +-----------------+-----------------+-----------------+-----------+ | Security header | 0000 | Plain NAS | | | type | | message | | +-----------------+-----------------+-----------------+-----------+ | Downlink | 01101000 | Downlink | | | generic NAS | | generic NAS | | | transport | | transport | | | message | | | | | identity | | | | +-----------------+-----------------+-----------------+-----------+ | Generic message | **Step 2a, 2c, | LTE Positioning | | | container type | 2d, 3, 4, 5a:** | Protocol (LPP) | | | | | message | | | | 00000001 | container | | +-----------------+-----------------+-----------------+-----------+ | | **Step 6:** | Location | | | | | services | | | | 00000010 | message | | | | | container | | +-----------------+-----------------+-----------------+-----------+ | Generic message | **Step 2a:** | LPP Request | | | container | | Capabilities | | | | Set according | | | | | to Table | | | | | 7.2.2.2.3.3-7 | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 2c, | LPP | | | | 5a:** | Acknowledgement | | | | | | | | | Set according | | | | | to Table | | | | | 7.2.2.2.3.3-9 | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 2d:** | LPP Provide | | | | | Assistance Data | | | | Set according | | | | | to Table | | | | | 7.2.2.2.3.3-10 | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 3:** | LPP Provide | | | | | Assistance Data | | | | Set according | | | | | to Table | | | | | 7.2.2.2.3.3-11 | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 4:** | LPP Request | | | | | Location | | | | Set according | Information | | | | to Table | | | | | 7.2.2.2.3.3-12 | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 6:** | FACILITY | | | | | | | | | Set according | | | | | to Table | | | | | 7.2.2.2.3.3-14 | | | +-----------------+-----------------+-----------------+-----------+ | Additional | **Steps 2a, 2c, | Routing | | | information | 2d, 3, 4, 5a:** | Identifier/ | | | | | | | | | Present | Correlation ID | | +-----------------+-----------------+-----------------+-----------+ | | **Step 6:** | | | | | | | | | | Not present. | | | +-----------------+-----------------+-----------------+-----------+
Table 7.2.2.2.3.3-7: LPP Request Capabilities (step 2a, Table 7.2.2.2.3.2-1)
* * *
Derivation Path: Table 5.4-1  
Information Element Value/remark Comment Condition As defined in Table 5.4-1
* * *
Table 7.2.2.2.3.3-8: LPP Provide Capabilities (step 2b, Table 7.2.2.2.3.2-1)
* * *
Derivation Path: 36.355 clause 6.2  
Information Element Value/remark Comment Condition LPP-Message ::= SEQUENCE {  
transactionID SEQUENCE {  
initiator locationServer  
transactionNumber (0..255) Contains the same value as the corresponding field
in the LPP Request Capabilities message in step 2a Table 7.2.2.2.3.2-1.  
}  
endTransaction TRUE  
sequenceNumber (0..255) Contains a different value compared to any other UL
message already sent by the UE.  
acknowledgement SEQUENCE { Present, or not present.  
ackRequested TRUE  
ackIndicator Not present  
}  
lpp-MessageBody CHOICE {  
c1 CHOICE {  
provideCapabilities SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
provideCapabilities-r9 SEQUENCE {  
commonIEsProvideCapabilities Dependent on UE capabilities Rel-14 onwards  
a-gnss-ProvideCapabilities Dependent on UE capabilities  
otdoa-ProvideCapabilities Dependent on UE capabilities  
ecid-ProvideCapabilities SEQUENCE{ Dependent on UE capabilities  
ueRxTxSupTDD-r13 Present (TRUE) for sub-test 6 TDD Rel-13 onwards  
}  
epdu-ProvideCapabilities Not present  
sensor-ProvideCapabilities-r13 Dependent on UE capabilities Rel-13 onwards  
tbs-ProvideCapabilities-r13 Dependent on UE capabilities Rel-13 onwards  
wlan-ProvideCapabilities-r13 Dependent on UE capabilities Rel-13 onwards  
bt-ProvideCapabilities-r13 Dependent on UE capabilities Rel-13 onwards  
}  
}  
}  
}  
}  
}
* * *
Table 7.2.2.2.3.3-9: LPP Acknowledgement (steps 2c and 5a, Table
7.2.2.2.3.2-1)
+-------------------+--------------+-------------------+-----------+ | Derivation Path: | | | | | 36.355 clause 6.2 | | | | +-------------------+--------------+-------------------+-----------+ | Information | Value/remark | Comment | Condition | | Element | | | | +-------------------+--------------+-------------------+-----------+ | LPP-Message ::= | | | | | SEQUENCE { | | | | +-------------------+--------------+-------------------+-----------+ | transactionID | Not present | | | +-------------------+--------------+-------------------+-----------+ | endTransaction | TRUE | | | +-------------------+--------------+-------------------+-----------+ | sequenceNumber | Not present | | | +-------------------+--------------+-------------------+-----------+ | acknowledgement | | | | | SEQUENCE { | | | | +-------------------+--------------+-------------------+-----------+ | ackRequested | FALSE | | | +-------------------+--------------+-------------------+-----------+ | ackIndicator | **Step 2c:** | Contains the same | | | | | value of the | | | | (0..255) | sequenceNumber | | | | | field as received | | | | | by the SS in the | | | | | LPP Provide | | | | | Capabilities | | | | | message in step | | | | | 2b, Table | | | | | 7.2.2.2.3.2‑1. | | +-------------------+--------------+-------------------+-----------+ | | **Step 5a:** | Contains the same | | | | | value of the | | | | (0..255) | sequenceNumber | | | | | field as received | | | | | by the SS in the | | | | | LPP Provide | | | | | Location | | | | | Information | | | | | message in step | | | | | 5, Table | | | | | 7.2.2.2.3.2‑1. | | +-------------------+--------------+-------------------+-----------+ | } | | | | +-------------------+--------------+-------------------+-----------+ | lpp-MessageBody | Not present. | | | +-------------------+--------------+-------------------+-----------+ | } | | | | +-------------------+--------------+-------------------+-----------+
Table 7.2.2.2.3.3-10: LPP Provide Assistance Data (step 2d, Table
7.2.2.2.3.2-1)
* * *
Derivation Path: Table 5.4-2  
Information Element Value/remark Comment Condition LPP-Message ::= SEQUENCE {  
transactionID SEQUENCE { Contains the same value as any potential LPP Request
Assistance Data message included by the UE at step 1, Table 7.2.2.2.3.2‑1.  
Initiator targetDevice  
transactionNumber (0..255)  
}  
endTransaction TRUE  
sequenceNumber Not present  
acknowledgement Not present.  
lpp-MessageBody CHOICE {  
c1 CHOICE {  
provideAssistanceData SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
provideAssistanceData-r9 SEQUENCE {  
commonIEsProvideAssistanceData Not present  
a-gnss-ProvideAssistanceData SEQUENCE { Present, if UE requested GNSS
assistance data at step 1, Table 7.2.2.2.3.2‑1.  
gnss-CommonAssistData Not present  
gnss-GenericAssistData Not present  
gnss-Error CHOICE {  
locationServerErrorCauses SEQUENCE {  
cause undefined  
}  
}  
}  
otdoa-ProvideAssistanceData SEQUENCE { Present, if UE requested OTDOA
assistance data at step 1, Table 7.2.2.2.3.2-1.  
otdoa-ReferenceCellInfo Not present  
otdoa-NeighbourCellInfo Not present  
otdoa-Error CHOICE {  
locationServerErrorCauses SEQUENCE {  
cause undefined  
}  
}  
}  
epdu-Provide-AssistanceData Not present  
sensor-ProvideAssistanceData-r14 SEQUENCE { Present, if UE requested Sensor
assistance data at step 1, Table 7.2.2.2.3.2-1. Rel-14 onwards  
sensor-AssistanceDataList-r14 Not present  
sensor-Error-r14 CHOICE{  
locationServerErrorCauses-r13 SEQUENCE {  
cause-r13 undefined  
}  
}  
}  
tbs-ProvideAssistanceData-r14 SEQUENCE { Present, if UE requested MBS
assistance data at step 1, Table 7.2.2.2.3.2-1. Rel-14 onwards  
tbs-AssistanceDataList-r14 Not present  
tbs-Error-r14 CHOICE{  
locationServerErrorCauses-r13 SEQUENCE {  
cause-r13 undefined  
}  
}  
}  
wlan-ProvideAssistanceData-r14 SEQUENCE { Present, if UE requested WLAN
assistance data at step 1, Table 7.2.2.2.3.2-1. Rel-14 onwards  
wlan-AssistanceDataList-r14 Not present  
wlan-Error-r14 CHOICE{  
locationServerErrorCauses-r13 SEQUENCE {  
cause-r13 undefined  
}  
}  
}  
}  
}  
}  
}  
}  
}
* * *
Table 7.2.2.2.3.3-11: LPP Provide Assistance Data (step 3, Table
7.2.2.2.3.2-1)
* * *
Derivation Path: Table 5.4-2  
Information Element Value/remark Comment Condition As defined in Table 5.4-2
with the following exceptions:  
transactionID SEQUENCE {  
initiator locationServer  
transactionNumber (0..255)  
}
* * *
Table 7.2.2.2.3.3-12: LPP Request Location Information (step 4, Table
7.2.2.2.3.2-1)
* * *
Derivation Path: Table 5.4-3  
Information Element Value/remark Comment Condition As defined in Table 5.4-3
with the following exceptions:  
locationInformationType locationMeasurementsRequired
* * *
Table 7.2.2.2.3.3-13: LPP ProvideLocation Information (step 5, Table
7.2.2.2.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 36.355 | | | | | clause 6.2 | | | | +-----------------+-----------------+-----------------+-----------+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | LPP-Message ::= | | | | | SEQUENCE { | | | | +-----------------+-----------------+-----------------+-----------+ | transactionID | | | | | SEQUENCE { | | | | +-----------------+-----------------+-----------------+-----------+ | initiator | locationServer | | | +-----------------+-----------------+-----------------+-----------+ | tr | (0..255) | Contains the | | | ansactionNumber | | same value as | | | | | the | | | | | corresponding | | | | | field in the | | | | | LPP Request | | | | | Location | | | | | Information | | | | | message in step | | | | | 4 Table | | | | | 7.2.2.2.3.2‑1. | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+ | endTransaction | TRUE | | | +-----------------+-----------------+-----------------+-----------+ | sequenceNumber | (0..255) | Contains a | | | | | different value | | | | | compared to any | | | | | other UL | | | | | message already | | | | | sent by the UE. | | +-----------------+-----------------+-----------------+-----------+ | acknowledgement | Present, or not | | | | SEQUENCE { | present. | | | +-----------------+-----------------+-----------------+-----------+ | ackRequested | TRUE | | | +-----------------+-----------------+-----------------+-----------+ | ackIndicator | Not present | | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+ | lpp-MessageBody | | | | | CHOICE { | | | | +-----------------+-----------------+-----------------+-----------+ | c1 CHOICE { | | | | +-----------------+-----------------+-----------------+-----------+ | provideLoca | | | | | tionInformation | | | | | SEQUENCE { | | | | +-----------------+-----------------+-----------------+-----------+ | cri | | | | | ticalExtensions | | | | | CHOICE { | | | | +-----------------+-----------------+-----------------+-----------+ | c1 CHOICE { | | | | +-----------------+-----------------+-----------------+-----------+ | provideLocatio | | | | | nInformation-r9 | | | | | SEQUENCE { | | | | +-----------------+-----------------+-----------------+-----------+ | commo | May be present | | | | nIEsProvideLoca | | | | | tionInformation | | | | | SEQUENCE { | | | | +-----------------+-----------------+-----------------+-----------+ | l | Not present | | | | ocationEstimate | | | | +-----------------+-----------------+-----------------+-----------+ | v | Not present | | | | elocityEstimate | | | | +-----------------+-----------------+-----------------+-----------+ | locationError | Not present | | | +-----------------+-----------------+-----------------+-----------+ | ear | Not present | Rel-12 onwards | | | lyFixReport-r12 | | | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+ | a-g | Present for | | | | nss-ProvideLoca | sub-test 15. | | | | tionInformation | | | | | | Any value | | | | | acceptable | | | +-----------------+-----------------+-----------------+-----------+ | ot | Present for | | | | doa-ProvideLoca | sub-test 5. | | | | tionInformation | | | | | | Any value | | | | | acceptable | | | +-----------------+-----------------+-----------------+-----------+ | e | Present for | | | | cid-ProvideLoca | sub-tests 6 | | | | tionInformation | FDD, 6 TDD. | | | | | | | | | | Any value | | | | | acceptable | | | +-----------------+-----------------+-----------------+-----------+ | e | Not present | | | | pdu-ProvideLoca | | | | | tionInformation | | | | +-----------------+-----------------+-----------------+-----------+ | sensor- | Present for | Rel-13 onwards | | | ProvideLocation | sub-test 14, 18 | | | | Information-r13 | | | | | | Any value | | | | | acceptable | | | +-----------------+-----------------+-----------------+-----------+ | tbs- | Present for | Rel-13 onwards | | | ProvideLocation | sub-tests 12, | | | | Information-r13 | 16 | | | | | | | | | | Any value | | | | | acceptable | | | +-----------------+-----------------+-----------------+-----------+ | wlan- | Present for | Rel-13 onwards | | | ProvideLocation | sub-test 11, 17 | | | | Information-r13 | | | | | | Any value | | | | | acceptable | | | +-----------------+-----------------+-----------------+-----------+ | bt- | Present for | Rel-13 onwards | | | ProvideLocation | sub-test 13 | | | | Information-r13 | | | | | | Any value | | | | | acceptable | | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+
Table 7.2.2.2.3.3-14: FACILITY (step 6, Table 7.2.2.2.3.2-1)
* * *
Derivation Path: 24.080 Table 2.3  
Information Element Value/remark Comment Condition Supplementary service
protocol discriminator 1011 supplementary services (call independent)  
Transaction identifier  
Facility message type 0011 1010 FACILITY  
Facility Return Result=LCS‑MOLRRes Set according to Table 7.2.2.2.3.3‑15
* * *
Table 7.2.2.2.3.3-15: LCS-MOLRRes (step 6, Table 7.2.2.2.3.2-1)
* * *
Derivation Path: 24.080 clause 4.4.2  
Information Element Value/remark Comment Condition LCS-MOLRRes::= SEQUENCE {  
locationEstimate Any value. The SS shall not be required to calculate the
value from the returned measurements.  
}
* * *
Table 7.2.2.2.3.3-16: RELEASE COMPLETE (step 7, Table 7.2.2.2.3.2-1)
* * *
Derivation Path: 24.080 Table 2.5  
Information Element Value/remark Comment Condition Supplementary service
protocol discriminator 1011 supplementary services (call independent)  
Transaction identifier  
Release Complete message type xx10 1010 RELEASE COMPLETE
* * *
## 7.3 LPP Procedures
### 7.3.1 LPP Common Procedures
#### 7.3.1.1 Position Capability Transfer
##### 7.3.1.1.1 Test Purpose (TP) {#test-purpose-tp-6 .H6}
##### (1) {#section-9 .H6}
**with** { a NAS signalling connection for EPC-NI-LR session existing }
**ensure that** {\ **when** { UE receives a LPP message of type REQUEST
CAPABILITIES }
**then** { UE sends a LPP message of type PROVIDE CAPABILITIES with the
correct supported capabilities }
}
##### 7.3.1.1.2 Conformance requirements {#conformance-requirements-29 .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 36.355, clause 5.1.
[TS 36.355, clause 5.1.3]
Upon receiving a _RequestCapabilities_ message, the target device shall
generate a _ProvideCapabilities_ message as a response.
The target device shall:
1> for each positioning method for which a request for capabilities is
included in the message:
2> if the target device supports this positioning method:
3> include the capabilities of the device for that supported positioning
method in the response message;
1> set the IE _LPP-TransactionID_ in the response message to the same value as
the IE _LPP-TransactionID_ in the received message;
...
[TS 36.355, clause 5.1.4]
When triggered to transmit a _ProvideCapabilities_ message, the target device
shall:
1> for each positioning method whose capabilities are to be indicated:
2> set the corresponding IE to include the device's capabilities;
2> if OTDOA capabilities are to be indicated:
3> include the IE _supportedBandListEUTRA_ ;
...
##### 7.3.1.1.3 Test description {#test-description-6 .H6}
##### 7.3.1.1.3.1 Pre-test conditions {#pre-test-conditions-6 .H6}
##### System Simulator: {#system-simulator-2 .H6}
> \- Cell 1.
##### UE: {#ue-18 .H6}
-
##### Preamble: {#preamble-5 .H6}
\- The UE is in state Generic RB Established (state 3) according to 3GPP TS
36.508 [8].
##### Related PICS/PIXIT Statements: {#related-picspixit-statements-38 .H6}
-
##### 7.3.1.1.3.2 Test procedure sequence {#test-procedure-sequence-6 .H6}
Table 7.3.1.1.3.2-1: Main behaviour
+----+--------------+--------------+--------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +====+==============+==============+==============+=========+====+ | | | U - S | Message | | | +----+--------------+--------------+--------------+---------+----+ | 1 | The SS sends | \ | _ULInformat | 1 | P | | | a LPP | | ionTransfer_ | | | | | message of | | | | | | | type Provide | | (LPP PROVIDE | | | | | Capabilities | | C | | | | | including | | APABILITIES) | | | | | the UE | | | | | | | positioning | | | | | | | c | | | | | | | apabilities. | | | | | +----+--------------+--------------+--------------+---------+----+ | 2a | IF | \ | _ULInformat | - | - | | | a LPP | | ionTransfer_ | | | | | message of | | | | | | | type Provide | | (LPP PROVIDE | | | | | Capabilities | | C | | | | | including | | APABILITIES) | | | | | the UE | | | | | | | positioning | | | | | | | c | | | | | | | apabilities. | | | | | +----+--------------+--------------+--------------+---------+----+ | 3a | IF | \ | _ULIn | 1 | P | | | | | formation | | | | Option 1 | The UE | | Transfer_ | | | | | sends an | | | | | | | acknow | | (LPP | | | | | ledgement | | PROVIDE | | | | | along | | CAPA | | | | | with an | | BILITIES, | | | | | LPP | | incl. | | | | | message | | acknow | | | | | of type | | ledgement | | | | | Provide | | response) | | | | | Capa | | | | | | | bilities. | | | | | +----------+-----------+-----------+-----------+---------+----+ | 2 | Option 2: | --> | _ULIn | 1 | P | | | | | formation | | | | Option 2 | The UE | -- > | Transfer_ | | | | | sends a | | | | | | | LPP | | (LPP | | | | | Acknow | | ACKNOWL | | | | | ledgement | | EDGEMENT) | | | | | response, | | | | | | | followed | | _ULIn | | | | | by a LPP | | formation | | | | | message | | Transfer_ | | | | | of type | | | | | | | Provide | | (LPP | | | | | Capa | | PROVIDE | | | | | bilities. | | CAPA | | | | | | | BILITIES) | | | +----------+-----------+-----------+-----------+---------+----+ | 3 | IF | \ | _ULInformat | - | - | | | a LPP | | ionTransfer_ | | | | | message of | | | | | | | type Provide | | (LPP PROVIDE | | | | | Capabilities | | C | | | | | including a | | APABILITIES) | | | | | request for | | | | | | | ack | | | | | | | nowledgement | | | | | | | along with a | | | | | | | sequence | | | | | | | number. | | | | | +----+--------------+--------------+--------------+---------+----+ | 3 | SS does not | | | - | - | | | send an | | | | | | | ack | | | | | | | nowledgement | | | | | +----+--------------+--------------+--------------+---------+----+ | 4 | After an | --> | _ULInformat | 1 | P | | | im | | ionTransfer_ | | | | | plementation | | | | | | | specific | | (LPP PROVIDE | | | | | timeout | | C | | | | | period, the | | APABILITIES) | | | | | UE | | | | | | | retransmits | | | | | | | the LPP | | | | | | | message from | | | | | | | step 2 and | | | | | | | includes the | | | | | | | same | | | | | | | sequence | | | | | | | number as in | | | | | | | step 2. | | | | | +----+--------------+--------------+--------------+---------+----+ | 5 | SS does not | | | - | - | | | send an | | | | | | | ack | | | | | | | nowledgement | | | | | +----+--------------+--------------+--------------+---------+----+ | 6 | The UE | --> | _ULInformat | - | - | | | either | | ionTransfer_ | | | | | proceeds | | | | | | | directly to | | (LPP PROVIDE | | | | | step 10 or | | C | | | | | after an | | APABILITIES) | | | | | im | | | | | | | plementation | | | | | | | specific | | | | | | | timeout | | | | | | | period, the | | | | | | | UE | | | | | | | retransmits | | | | | | | the LPP | | | | | | | message from | | | | | | | step 2 and | | | | | | | includes the | | | | | | | same | | | | | | | sequence | | | | | | | number as in | | | | | | | step 2. | | | | | +----+--------------+--------------+--------------+---------+----+ | 7 | SS does not | | | - | - | | | send an | | | | | | | ack | | | | | | | nowledgement | | | | | +----+--------------+--------------+--------------+---------+----+ | 8 | The UE | --> | _ULInformat | - | - | | | either | | ionTransfer_ | | | | | proceeds | | | | | | | directly to | | (LPP PROVIDE | | | | | step 10 or | | C | | | | | after an | | APABILITIES) | | | | | im | | | | | | | plementation | | | | | | | specific | | | | | | | timeout | | | | | | | period, the | | | | | | | UE | | | | | | | retransmits | | | | | | | the LPP | | | | | | | message from | | | | | | | step 2 and | | | | | | | includes the | | | | | | | same | | | | | | | sequence | | | | | | | number as in | | | | | | | step 2. | | | | | +----+--------------+--------------+--------------+---------+----+ | 9 | SS does not | | | | | | | send an | | | | | | | ack | | | | | | | nowledgement | | | | | +----+--------------+--------------+--------------+---------+----+ | 10 | UE aborts | | | 1 | P | | | all | | | | | | | procedures | | | | | | | and activity | | | | | | | associated | | | | | | | with LPP | | | | | | | support for | | | | | | | the location | | | | | | | session. | | | | | | | | | | | | | | SS waits for | | | | | | | 10 seconds | | | | | | | to ensure | | | | | | | the UE does | | | | | | | not send | | | | | | | another LPP | | | | | | | message. | | | | | +----+--------------+--------------+--------------+---------+----+
##### 7.3.2.3.3.3 Specific message contents {#specific-message-contents-41
.H6}
_Table_ 7.3.2.3.3.3-1 _:_ _DLInformationTransfer_ (step 1, Table
7.3.2.3.3.2-1)
* * *
Derivation Path: 36.331 clause 6.2.2  
Information Element Value/remark Comment Condition DLInformationTransfer ::=
SEQUENCE {  
rrc-TransactionIdentifier  
criticalExtensions CHOICE {  
c1 CHOICE {  
dlInformationTransfer-r8 SEQUENCE {  
dedicatedInfoType CHOICE {  
dedicatedInfoNAS OCTET STRING Set according to Table 7.3.2.3.3.3-2 DOWNLINK
GENERIC NAS TRANSPORT  
}  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}  
}
* * *
Table 7.3.2.3.3.3-2: DOWNLINK GENERIC NAS TRANSPORT (step 1, Table
7.3.2.3.3.2‑1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 24.301 | | | | | Table 8.2.31.1 | | | | +-----------------+-----------------+-----------------+-----------+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Protocol | 0111 | EPS mobility | | | discriminator | | management | | | | | messages | | +-----------------+-----------------+-----------------+-----------+ | Security header | 0000 | Plain NAS | | | type | | message | | +-----------------+-----------------+-----------------+-----------+ | Downlink | 01101000 | Downlink | | | generic NAS | | generic NAS | | | transport | | transport | | | message | | | | | identity | | | | +-----------------+-----------------+-----------------+-----------+ | Generic message | 00000001 | LTE Positioning | | | container type | | Protocol (LPP) | | | | | message | | | | | container | | +-----------------+-----------------+-----------------+-----------+ | Generic message | Set according | LPP Request | | | container | to Table | Capabilities | | | | 7.3.2.3.3.3-3 | | | +-----------------+-----------------+-----------------+-----------+ | Additional | Present | Routing | | | information | | Identifier/ | | | | | | | | | | Correlation ID | | +-----------------+-----------------+-----------------+-----------+
Table 7.3.2.3.3.3-3: LPP Request Capabilities (step 1, Table 7.3.2.3.3.2-1)
* * *
Derivation Path: Table 5.4-1  
Information Element Value/remark Comment Condition As defined in Table 5.4-1.
* * *
Table 7.3.2.3.3.3-4: _ULInformationTransfer_ (steps 2, 4, 6, and 8, Table
7.3.2.3.3.2-1)
* * *
Derivation Path: 36.331 clause 6.2.2  
Information Element Value/remark Comment Condition ULInformationTransfer ::=
SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
ulInformationTransfer-r8 SEQUENCE {  
dedicatedInfoType CHOICE {  
dedicatedInfoNAS OCTET STRING Set according to Table 7.3.2.3.3.3-5 UPLINK
GENERIC NAS TRANSPORT  
}  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}  
}
* * *
Table 7.3.2.3.3.3-5: UPLINK GENERIC NAS TRANSPORT (steps 2, 4, 6, and 8, Table
7.3.2.3.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 24.301 | | | | | Table 8.2.32.1 | | | | +-----------------+-----------------+-----------------+-----------+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Protocol | 0111 | EPS mobility | | | discriminator | | management | | | | | messages | | +-----------------+-----------------+-----------------+-----------+ | Security header | 0000 | Plain NAS | | | type | | message | | +-----------------+-----------------+-----------------+-----------+ | Uplink generic | 01101001 | Uplink generic | | | NAS transport | | NAS transport | | | message | | | | | identity | | | | +-----------------+-----------------+-----------------+-----------+ | Generic message | 00000001 | LTE Positioning | | | container type | | Protocol (LPP) | | | | | message | | | | | container | | +-----------------+-----------------+-----------------+-----------+ | Generic message | Set according | LPP Provide | | | container | to Table | Capabilities | | | | | | | | | 7.3.2.3.3.3-6 | | | +-----------------+-----------------+-----------------+-----------+ | Additional | Present | The UE includes | | | information | | the Routing | | | | | Identifier | | | | | received in the | | | | | Additional | | | | | Information IE | | | | | of the DOWNLINK | | | | | GENERIC NAS | | | | | TRANSPORT | | | | | message | | +-----------------+-----------------+-----------------+-----------+
Table 7.3.2.3.3.3-6: LPP Provide Capabilities (steps 2, 4, 6, and 8, Table
7.3.2.3.3.2-1)
* * *
Derivation Path: 36.355 clause 6.2  
Information Element Value/remark Comment Condition LPP-Message ::= SEQUENCE {  
transactionID SEQUENCE {  
initiator locationServer  
transactionNumber (0..255) Contains the same value as the corresponding field
in the LPP Request Capabilities message in step 1 Table 7.3.2.3.3.2-1.  
}  
endTransaction TRUE  
sequenceNumber (0..255)  
acknowledgement SEQUENCE {  
ackRequested TRUE  
ackIndicator Not present  
}  
lpp-MessageBody CHOICE {  
c1 CHOICE {  
provideCapabilities SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
provideCapabilities-r9 SEQUENCE {  
commonIEsProvideCapabilities Dependent on UE capabilities Rel-14 onwards  
a-gnss-ProvideCapabilities Dependent on UE capabilities  
otdoa-ProvideCapabilities Dependent on UE capabilities  
ecid-ProvideCapabilities Dependent on UE capabilities  
epdu-ProvideCapabilities Not present  
sensor-ProvideCapabilities-r13 Dependent on UE capabilities Rel-13 onwards  
tbs-ProvideCapabilities-r13 Dependent on UE capabilities Rel-13 onwards  
wlan-ProvideCapabilities-r13 Dependent on UE capabilities Rel-13 onwards  
bt-ProvideCapabilities-r13 Dependent on UE capabilities Rel-13 onwards  
}  
}  
}  
}  
}  
}
* * *
### 7.3.3 LPP Error Handling
#### 7.3.3.1 Void
#### 7.3.3.1A Void
#### 7.3.3.1B LPP Requested Method not Supported -- UE-Assisted
##### 7.3.3.1B.1 Test Purpose (TP) {#b.1-test-purpose-tp .H6}
##### (1) {#section-13 .H6}
**with** { a UE supporting at least one of UE-assisted GNSS, UE-assisted
OTDOA, UE-assisted ECID, UE-assisted WLAN, UE-assisted Bluetooth, UE-assisted
Sensor or UE-assisted MBS but not all of them }
**and with** { a NAS signalling connection for EPC-NI-LR session existing }
**ensure that** {\ **when** { UE receives a LPP message requesting at least
one location method not supported }
**then** { the UE provides location information for the supported methods}
}
##### 7.3.3.1B.2 Conformance requirements {#b.2-conformance-requirements .H6}
References: The conformance requirements covered in the present TC are
specified in: TS 36.355, clauses 5.3.3 and 5.4.3.
[TS 36.355, clause 5.3.3]
Upon receiving a _RequestLocationInformation_ message, the target device
shall:
1> if the requested information is compatible with the target device
capabilities and configuration:
[...]
1> otherwise:
2> if one or more positioning methods are included that the target device does
not support:
3> continue to process the message as if it contained only information for the
supported positioning methods;
3> handle the signalling content of the unsupported positioning methods by LPP
error detection as in 5.4.3.
[TS 36.355, clause 5.4.3]
Upon receiving any LPP message, the receiving entity shall attempt to decode
the message and verify the presence of any errors and:
1> if the message type is an LPP _RequestAssistanceData_ or
_RequestLocationInformation_ and some or all of the requested information is
not supported:
2> return any information that can be provided in a normal response, which
includes indications on other information that is not supported.
##### 7.3.3.1B.3 Test description {#b.3-test-description .H6}
##### 7.3.3.1B.3.1 Pre-test conditions {#b.3.1-pre-test-conditions .H6}
##### System Simulator: {#system-simulator-6 .H6}
\- If OTDOA is supported by the UE: Cells 1 and 2, as specified in 5.2.2.
\- If ECID is supported by the UE: Cells 1 and 2, as specified in 5.2.3. If
OTDOA is also supported then Cells 1 and 2 are as specified in 5.2.2.
\- If GNSS is supported by the UE: Cell 1 and satellite signals, as specified
in 5.2.1. If OTDOA is also supported then Cell 1 is as specified in 5.2.2.
\- If WLAN is supported by the UE: Cell 1 and WLAN signals, as specified in
5.2.5.
\- If MBS is supported by the UE: Cell 1 and MBS signals, as specified in
5.2.4.
\- If Bluetooth is supported by the UE: Cell 1 and Bluetooth signals, as
specified in 5.2.6.
\- If Sensor is supported by the UE: Cell 1.
##### UE: {#ue-22 .H6}
\- -
##### Preamble: {#preamble-9 .H6}
\- The UE is in state Generic RB Established (state 3) according to 3GPP TS
36.508 [8].
##### Related PICS/PIXIT Statements: {#related-picspixit-statements-42 .H6}
\- -
##### 7.3.3.1B.3.2 Test procedure sequence {#b.3.2-test-procedure-sequence
.H6}
Table 7.3.3.1B.3.2-1: Main behaviour
+----+--------------+--------------+--------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +====+==============+==============+==============+=========+====+ | | | U - S | Message | | | +----+--------------+--------------+--------------+---------+----+ | 0 | The SS sends | \ | _ULInformat | - | - | | | a LPP | | ionTransfer_ | | | | | message of | | | | | | | type Provide | | (LPP PROVIDE | | | | | Capabilities | | C | | | | | including | | APABILITIES) | | | | | the UE | | | | | | | positioning | | | | | | | c | | | | | | | apabilities. | | | | | +----+--------------+--------------+--------------+---------+----+ | 0b | IF | \ | _ULInformat | 1 | P | | | a LPP | | ionTransfer_ | | | | | message of | | | | | | | type Provide | | (LPP PROVIDE | | | | | Location | | LOCATION | | | | | Information | | INFORMATION) | | | | | including | | | | | | | information | | | | | | | for the | | | | | | | supported | | | | | | | method(s). | | | | | +----+--------------+--------------+--------------+---------+----+ | 3a | IF | \ for each positioning method contained in the message:
2> deliver the related assistance data to upper layers.
[TS 36.355, clause 5.3.3]
Upon receiving a _RequestLocationInformation_ message, the target device
shall:
1> if the requested information is compatible with the target device
capabilities and configuration:
2> include the requested information in a _ProvideLocationInformation_
message;
2> set the IE _LPP-TransactionID_ in the response to the same value as the IE
_LPP-TransactionID_ in the received message;
2> deliver the _ProvideLocationInformation_ message to lower layers for
transmission.
1> otherwise:
[...]
[TS 36.355, clause 5.3.4]
When triggered to transmit _ProvideLocationInformation_ message, the target
device shall:
1> for each positioning method contained in the message:
2> set the corresponding IE to include the available location information;
1> deliver the response to lower layers for transmission.
7.3.4.1.3 Test description
7.3.4.1.3.1 Pre-test conditions
System Simulator:
\- Cell 1.
\- Satellite signals (sub-test case 15): As specified in 5.2.1.
\- MBS signals (Sub-test 16): As specified in 5.2.4 .
\- WLAN signals (Sub-test 17): as specified in 5.2.5.
##### UE: {#ue-23 .H6}
> \- The UE shall begin the test with no assistance data stored.
Preamble:
> \- The UE is in state Generic RB Established (state 3) according to 3GPP
> 36.508 [8].
Related PICS/PIXIT Statements:
> -
7.3.4.1.3.2 Test procedure sequence
This test case includes sub-test cases dependent on the the positioning
method(s) supported by the UE. Each sub-test case is identified by a Sub-Test
Case Number as defined in Table 7.3.4.1.3.2-0 below:
Table 7.3.4.1.3.2-0: Sub-test case numbers
* * *
**Sub-Test Case Number** **Supported Positioning Methods** 1 Void 2 Void 3
Void 4 Void 8 Void 9 Void 10 Void 15 UE supporting GNSS^(1)^ 16 UE supporting
MBS (Rel-14 onwards) 17 UE supporting WLAN (Rel-14 onwards) 18 UE supporting
Sensor (Rel-14 onwards) NOTE 1: The GNSS combination of GPS, GLONASS, Galileo,
BDS supported by the UE
* * *
Table 7.3.4.1.3.2-1: Main behaviour
+--------+------------+------------+------------+------------+----+ | **St** | **P |** Message | **TP** | * | | | | rocedure**| Sequence** | | _Verdict_ _| | +========+============+============+============+============+====+ | | |__U - S_ _| * | | | | | | |_ Message __| | | +--------+------------+------------+------------+------------+----+ | 1 | The stored | \  | _UL | - | - | | | sends a | | Informatio | | | | | LPP | | nTransfer_ | | | | | message of | | | | | | | type | | (LPP | | | | | Provide | | PROVIDE | | | | | Ca | | CAP | | | | | pabilities | | ABILITIES) | | | | | including | | | | | | | the UE | | | | | | | p | | | | | | | ositioning | | | | | | | cap | | | | | | | abilities. | | | | | +--------+------------+------------+------------+------------+----+ | 1c | IF | \ | _UL | 1 | P | | | sends a | | Informatio | | | | | LPP | | nTransfer_ | | | | | message of | | | | | | | type | | (LPP | | | | | Provide | | PROVIDE | | | | | Location | | LOCATION | | | | | I | | IN | | | | | nformation | | FORMATION) | | | | | including | | | | | | | a location | | | | | | | estimate. | | | | | +--------+------------+------------+------------+------------+----+ | 4a | IF | \ for each positioning method contained in the message:
2> deliver the related assistance data to upper layers.
[TS 36.355, clause 5.3.3]
Upon receiving a _RequestLocationInformation_ message, the target device
shall:
1> if the requested information is compatible with the target device
capabilities and configuration:
2> include the requested information in a _ProvideLocationInformation_
message;
2> set the IE _LPP-TransactionID_ in the response to the same value as the IE
_LPP-TransactionID_ in the received message;
2> deliver the _ProvideLocationInformation_ message to lower layers for
transmission.
1> otherwise:
> [...]
[TS 36.355, clause 5.3.4]
When triggered to transmit _ProvideLocationInformation_ message, the target
device shall:
1> for each positioning method contained in the message:
2> set the corresponding IE to include the available location information;
1> deliver the response to lower layers for transmission.
##### 7.3.4.2.3 Test description {#test-description-10 .H6}
##### 7.3.4.2.3.1 Pre-test conditions {#pre-test-conditions-10 .H6}
##### System Simulator: {#system-simulator-7 .H6}
\- Sub-tests 11, 12, 13, 14, 15, 16, 17, 18: Cell 1.
\- Sub-test 5 and 7: Cells 1 and 2, as specified in 5.2.2.
\- Sub-tests 6 FDD, 6 TDD: Cells 1 and 2, as specified in 5.2.3.
\- Satellite signals (Sub-test 15): As specified in 5.2.1.
\- WLAN signals (Sub-test 11, 17): as specified in 5.2.5.
\- MBS signals (Sub-tests 12, 16): as specified in 5.2.4
\- Bluetooth signals (Sub-test 13): as specified in 5.2.6.
##### UE: {#ue-24 .H6}
\- The UE shall begin the test with no assistance data stored.
##### Preamble: {#preamble-10 .H6}
> \- The UE is in state Generic RB Established (state 3) according to 3GPP
> 36.508 [8].
##### Related PICS/PIXIT Statements: {#related-picspixit-statements-43 .H6}
-
##### 7.3.4.2.3.2 Test procedure sequence {#test-procedure-sequence-10 .H6}
This test case includes sub-test cases dependent on the positioning method(s)
supported by the UE. Each sub-test case is identified by a Sub-Test Case
Number as defined in Table 7.3.4.2.3.2-0 below:
Table 7.3.4.2.3.2-0: Sub-test case numbers
* * *
Sub-Test Case Number Supported Positioning Methods 1 Void 2 Void 3 Void 4 Void
5 UE supporting OTDOA 6 FDD UE supporting ECID (FDD) 6 TDD UE supporting ECID
(TDD) 7 UE supporting GNSS^(1)^ and OTDOA 8 Void 9 Void 10 Void 11 UE
supporting WLAN (Rel-13 only) 12 UE supporting MBS (Rel-13 only) 13 UE
supporting Bluetooth 14 UE supporting Sensor (Rel-13 only) 15 UE supporting
GNSS^(1)^ 16 UE supporting MBS (Rel-14 onwards) 17 UE supporting WLAN (Rel-14
onwards) 18 UE supporting Sensor (Rel-14 onwards) NOTE 1: The GNSS combination
of GPS, GLONASS, Galileo, BDS supported by the UE
* * *
Table 7.3.4.2.3.2-1: Main behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | IF | \ | _ULIn | - | - | | | sends a | | formation | | | | | LPP | | Transfer_ | | | | | message | | | | | | | of type | | (LPP | | | | | Provide | | PROVIDE | | | | | Cap | | CAPA | | | | | abilities | | BILITIES) | | | | | including | | | | | | | the UE | | | | | | | po | | | | | | | sitioning | | | | | | | capa | | | | | | | bilities. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 1d | IF | \ | _ULIn | 1 | P | | 1) | s | | formation | | | | | ub-tests: | | Transfer_ | | | | | | | | | | | | The UE | | (LPP | | | | | sends a | | PROVIDE | | | | | LPP | | LOCATION | | | | | message | | INF | | | | | of type | | ORMATION) | | | | | Provide | | | | | | | Location | | | | | | | In | | | | | | | formation | | | | | | | including | | | | | | | location | | | | | | | meas | | | | | | | urements. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4a2 | IF | \ | _ULIn | - | - | | 2) | sub-test | | formation | | | | | 7 | | Transfer_ | | | | | | | | | | | | THEN | | (LPP | | | | | | | PROVIDE | | | | | The UE | | LOCATION | | | | | sends a | | INF | | | | | LPP | | ORMATION) | | | | | message | | | | | | | of type | | | | | | | Provide | | | | | | | Location | | | | | | | In | | | | | | | formation | | | | | | | including | | | | | | | \"early | | | | | | | fix\" | | | | | | | location | | | | | | | meas | | | | | | | urements. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4b2 | IF | \ | _ULIn | 1 | P | | | sends a | | formation | | | | | LPP | | Transfer_ | | | | | message | | | | | | | of type | | (LPP | | | | | Provide | | PROVIDE | | | | | Location | | LOCATION | | | | | In | | INF | | | | | formation | | ORMATION) | | | | | including | | | | | | | location | | | | | | | meas | | | | | | | urements. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4b4 | IF | \ set the IEs for the positioning-method-specific request for assistance data
to request the data indicated by upper layers.
[TS 36.355, clause 5.2.4]
Upon receiving a _ProvideAssistanceData_ message, the target device shall:
1> for each positioning method contained in the message:
2> deliver the related assistance data to upper layers.
[TS 36.355, clause 5.3.3]
Upon receiving a _RequestLocationInformation_ message, the target device
shall:
1> if the requested information is compatible with the target device
capabilities and configuration:
2> include the requested information in a _ProvideLocationInformation_
message;
2> set the IE _LPP-TransactionID_ in the response to the same value as the IE
_LPP-TransactionID_ in the received message;
2> deliver the _ProvideLocationInformation_ message to lower layers for
transmission.
1> otherwise:
> [...]
[TS 36.355, clause 5.3.4]
When triggered to transmit _ProvideLocationInformation_ message, the target
device shall:
1> for each positioning method contained in the message:
2> set the corresponding IE to include the available location information;
1> deliver the response to lower layers for transmission.
##### 7.3.4.3.3 Test description {#test-description-11 .H6}
##### 7.3.4.3.3.1 Pre-test conditions {#pre-test-conditions-11 .H6}
##### System Simulator: {#system-simulator-8 .H6}
\- Cell 1.
\- Satellite signals (sub-test 15): As specified in 5.2.1.
\- MBS signals (sub-test 16): As specified in 5.2.4.
\- WLAN signals (Sub-test 17): as specified in 5.2.5.
##### UE: {#ue-25 .H6}
\- The UE shall begin the test with no assistance data stored.
##### Preamble: {#preamble-11 .H6}
\- The UE is in state Generic RB Established (state 3) according to 3GPP
36.508 [8].
##### Related PICS/PIXIT Statements: {#related-picspixit-statements-44 .H6}
\- Method of triggering an LPP Request Assistance Data message.
7.3.4.3.3.2 Test procedure sequence
This test case includes sub-test cases dependent on the the positioning
method(s) supported by the UE. Each sub-test case is identified by a Sub-Test
Case Number as defined in Table 7.3.4.3.3.2-0 below:
Table 7.3.4.3.3.2-0: Sub-test case numbers
* * *
Sub-Test Case Number Supported Positioning Methods 1 Void 2 Void 3 Void 4 Void
8 Void 9 Void 10 Void 15 UE supporting GNSS^(1)^ 16 UE supporting MBS (Rel-14
onwards) 17 UE supporting WLAN (Rel-14 onwards) 18 UE supporting Sensor
(Rel-14 onwards) NOTE 1: The GNSS combination of GPS, GLONASS, Galileo, BDS
supported by the UE
* * *
Table 7.3.4.3.3.2-1: Main behaviour
+----+--------------+--------------+--------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +====+==============+==============+==============+=========+====+ | | | U - S | Message | | | +----+--------------+--------------+--------------+---------+----+ | 1 | The stored | \ | _ULInformat | - | - | | | a LPP | | ionTransfer_ | | | | | message of | | | | | | | type Provide | | (LPP PROVIDE | | | | | Capabilities | | C | | | | | including | | APABILITIES) | | | | | the UE | | | | | | | positioning | | | | | | | c | | | | | | | apabilities. | | | | | +----+--------------+--------------+--------------+---------+----+ | 1c | IF | \ | _ULInformat | 1 | P | | | a LPP | | ionTransfer_ | | | | | message of | | | | | | | type Request | | (LPP REQUEST | | | | | Assistance | | ASSISTANCE | | | | | Data | | DATA) | | | | | including a | | | | | | | request for | | | | | | | assistance | | | | | | | data.\ | | | | | | | NOTE: This | | | | | | | requires a | | | | | | | method of | | | | | | | triggering | | | | | | | an Request | | | | | | | Assistance | | | | | | | Data | | | | | | | message. | | | | | +----+--------------+--------------+--------------+---------+----+ | 4 | The SS sends | \ | _ULInformat | 1 | P | | | a LPP | | ionTransfer_ | | | | | message of | | | | | | | type Provide | | (LPP PROVIDE | | | | | Location | | LOCATION | | | | | Information | | INFORMATION) | | | | | including a | | | | | | | location | | | | | | | estimate. | | | | | +----+--------------+--------------+--------------+---------+----+ | 5a | IF | \ set the IEs for the positioning-method-specific request for assistance data
to request the data indicated by upper layers.
[TS 36.355, clause 5.2.4]
Upon receiving a _ProvideAssistanceData_ message, the target device shall:
1> for each positioning method contained in the message:
2> deliver the related assistance data to upper layers.
[TS 36.355, clause 5.3.3]
Upon receiving a _RequestLocationInformation_ message, the target device
shall:
1> if the requested information is compatible with the target device
capabilities and configuration:
2> include the requested information in a _ProvideLocationInformation_
message;
2> set the IE _LPP-TransactionID_ in the response to the same value as the IE
_LPP-TransactionID_ in the received message;
2> deliver the _ProvideLocationInformation_ message to lower layers for
transmission.
1> otherwise:
> [...]
[TS 36.355, clause 5.3.4]
When triggered to transmit _ProvideLocationInformation_ message, the target
device shall:
1> for each positioning method contained in the message:
2> set the corresponding IE to include the available location information;
1> deliver the response to lower layers for transmission.
##### 7.3.4.4.3 Test description {#test-description-12 .H6}
##### 7.3.4.4.3.1 Pre-test conditions {#pre-test-conditions-12 .H6}
##### System Simulator: {#system-simulator-9 .H6}
\- Sub-tests 15, 16, 17, 18: Cell 1.
\- Sub-test 5 and 7: Cells 1 and 2, as specified in 5.2.2.
\- Satellite signals (Sub-test 15): As specified in 5.2.1.
\- MBS signals (Sub-test 16): As specified in 5.2.4 .
\- WLAN signals (Sub-test 17): As specified in 5.2.5 .
##### UE: {#ue-26 .H6}
\- The UE shall begin the test with no assistance data stored.
##### Preamble: {#preamble-12 .H6}
\- The UE is in state Generic RB Established (state 3) according to 3GPP
36.508 [8].
##### Related PICS/PIXIT Statements: {#related-picspixit-statements-45 .H6}
\- Method of triggering an LPP Request Assistance Data message.
##### 7.3.4.4.3.2 Test procedure sequence {#test-procedure-sequence-11 .H6}
This test case includes sub-test cases dependent on the positioning method(s)
supported by the UE. Each sub-test case is identified by a Sub-Test Case
Number as defined in Table 7.3.4.4.3.2-0 below:
Table 7.3.4.4.3.2-0: Sub-test case numbers
* * *
Sub-Test Case Number Supported Positioning Methods 1 Void 2 Void 3 Void 4 Void
5 UE supporting OTDOA 7 UE supporting GNSS^(1)^ and OTDOA 8 Void 9 Void 10
Void 15 UE supporting GNSS^(1)^ 16 UE supporting MBS (Rel-14 onwards) 17 UE
supporting WLAN (Rel-14 onwards) 18 UE supporting Sensor (Rel-14 onwards) NOTE
1: The GNSS combination of GPS, GLONASS, Galileo, BDS supported by the UE
* * *
Table 7.3.4.4.3.2-1: Main behaviour
+-----------+-----------+-----------+-----------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +===========+===========+===========+===========+=========+====+ | | | U - S | Message | | | +-----------+-----------+-----------+-----------+---------+----+ | 1 | IF | \ | _ULIn | - | - | | | sends a | | formation | | | | | LPP | | Transfer_ | | | | | message | | | | | | | of type | | (LPP | | | | | Provide | | PROVIDE | | | | | Cap | | CAPA | | | | | abilities | | BILITIES) | | | | | including | | | | | | | the UE | | | | | | | po | | | | | | | sitioning | | | | | | | capa | | | | | | | bilities. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 1d | IF | \ | _ULIn | 1 | P | | | sends a | | formation | | | | | LPP | | Transfer_ | | | | | message | | | | | | | of type | | (LPP | | | | | Request | | REQUEST | | | | | Assista | | A | | | | | nce.NOTE: | | SSISTANCE | | | | | This | | DATA) | | | | | requires | | | | | | | a method | | | | | | | of | | | | | | | t | | | | | | | riggering | | | | | | | a Request | | | | | | | A | | | | | | | ssistance | | | | | | | Data | | | | | | | message. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4 | The SS | \ | _ULIn | 1 | P | | | sub-test | | formation | | | | | 7 THEN | | Transfer_ | | | | | the UE | | | | | | | may send | | (LPP | | | | | a second | | REQUEST | | | | | LPP | | A | | | | | message | | SSISTANCE | | | | | of type | | DATA) | | | | | Request | | | | | | | A | | | | | | | ssistance | | | | | | | Data | | | | | | | including | | | | | | | a request | | | | | | | for GNSS | | | | | | | a | | | | | | | ssistance | | | | | | | data or | | | | | | | OTDOA | | | | | | | a | | | | | | | ssistance | | | | | | | data. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 4b | IF in | \ | _ULIn | 1 | P | | 1) | s | | formation | | | | | ub-tests: | | Transfer_ | | | | | | | | | | | | The UE | | (LPP | | | | | sends a | | PROVIDE | | | | | LPP | | LOCATION | | | | | message | | INF | | | | | of type | | ORMATION) | | | | | Provide | | | | | | | Location | | | | | | | In | | | | | | | formation | | | | | | | including | | | | | | | location | | | | | | | meas | | | | | | | urements. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5a2 | IF | \ | _ULIn | - | - | | 2) | sub-test | | formation | | | | | 7 | | Transfer_ | | | | | | | | | | | | THEN | | (LPP | | | | | | | PROVIDE | | | | | The UE | | LOCATION | | | | | sends a | | INF | | | | | LPP | | ORMATION) | | | | | message | | | | | | | of type | | | | | | | Provide | | | | | | | Location | | | | | | | In | | | | | | | formation | | | | | | | including | | | | | | | \"early | | | | | | | fix\" | | | | | | | location | | | | | | | meas | | | | | | | urements. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5b2 | IF | \ | _ULIn | 1 | P | | | sends a | | formation | | | | | LPP | | Transfer_ | | | | | message | | | | | | | of type | | (LPP | | | | | Provide | | PROVIDE | | | | | Location | | LOCATION | | | | | In | | INF | | | | | formation | | ORMATION) | | | | | including | | | | | | | location | | | | | | | meas | | | | | | | urements. | | | | | +-----------+-----------+-----------+-----------+---------+----+ | 5b4 | IF | \ abort any ongoing procedure associated with the transaction ID indicated in
the message.
##### 7.3.5.1.3 Test description {#test-description-13 .H6}
##### 7.3.5.1.3.1 Pre-test conditions {#pre-test-conditions-13 .H6}
##### System Simulator: {#system-simulator-10 .H6}
\- Sub-tests 11, 12, 13, 15, 16, 17: Cell 1.
\- Sub-test 5: Cell 1 as specified in 5.2.2.
##### UE: {#ue-27 .H6}
\- The UE shall begin the tests with no assistance data stored.
##### Preamble: {#preamble-13 .H6}
\- The UE is in state Generic RB Established (state 3) according to 3GPP TS
36.508 [8].
##### Related PICS/PIXIT Statements: {#related-picspixit-statements-46 .H6}
-
##### 7.3.5.1.3.2 Test procedure sequence {#test-procedure-sequence-12 .H6}
This test case includes sub-test cases dependent on the positioning method(s)
supported by the UE. Each sub-test case is identified by a Sub-Test Case
Number as defined in Table 7.3.5.1.3.2-0 below:
Table 7.3.5.1.3.2-0: Sub-test case numbers
* * *
**Sub-Test Case Number** **Supported Positioning Methods** 1 Void 2 Void 3
Void 4 Void 5 UE supporting OTDOA 8 Void 9 Void 10 Void 11 UE supporting WLAN
(Rel-13 only) 12 UE supporting MBS (Rel-13 only) 13 UE supporting Bluetooth 15
UE supporting GNSS^(1)^ 16 UE supporting MBS (Rel-14 onwards) 17 UE supporting
WLAN (Rel-14 onwards) NOTE 1: The GNSS combination of GPS, GLONASS, Galileo,
BDS supported by the UE
* * *
Note that this test case does not include a sub-test for the case where ECID
or Sensor is supported by the UE as the behaviour required cannot be
guaranteed in these cases.
Table 7.3.5.1.3.2-1: Main behaviour
+----+--------------+--------------+--------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +====+==============+==============+==============+=========+====+ | | | U - S | Message | | | +----+--------------+--------------+--------------+---------+----+ | 00 | The SS sends | \ | _ULInformat | - | - | | | a LPP | | ionTransfer_ | | | | | message of | | | | | | | type Provide | | (LPP PROVIDE | | | | | Capabilities | | C | | | | | including | | APABILITIES) | | | | | the UE | | | | | | | positioning | | | | | | | c | | | | | | | apabilities. | | | | | +----+--------------+--------------+--------------+---------+----+ | 0b | IF | \ | _RRCConnect | - | - | | | transmits | | ionRequest_ | | | | | an | | | | | | | _RRCConnect | | | | | | | ionRequest_ | | | | | | | message on | | | | | | | Cell 1. | | | | | +------+-------------+-------------+-------------+---------+----+ | 3 | The SS | \ | _RRCCo | 1 | P | | | transmits | | nnectionSet | | | | | an | | upComplete_ | | | | | _RRCCo | | | | | | | nnectionSet | | | | | | | upComplete_ | | | | | | | message on | | | | | | | Cell 1. | | | | | | | | | | | | | | This | | | | | | | message | | | | | | | includes an | | | | | | | EXTENDED | | | | | | | SERVICE | | | | | | | REQUEST | | | | | | | message. | | | | | +------+-------------+-------------+-------------+---------+----+ | 5 | The SS | \ | _RRCConnect | - | - | | | transmits | | ionRequest_ | | | | | an | | | | | | | _RRCConnect | | | | | | | ionRequest_ | | | | | | | message on | | | | | | | Cell 1. | | | | | +------+-------------+-------------+-------------+---------+----+ | 3 | The SS | \ | _RRCCo | 1 | P | | | transmits | | nnectionSet | | | | | an | | upComplete_ | | | | | _RRCCo | | | | | | | nnectionSet | | | | | | | upComplete_ | | | | | | | message on | | | | | | | Cell 1. | | | | | | | | | | | | | | This | | | | | | | message | | | | | | | includes an | | | | | | | EXTENDED | | | | | | | SERVICE | | | | | | | REQUEST | | | | | | | message. | | | | | +------+-------------+-------------+-------------+---------+----+ | 5 | The SS | \ if and only if upper layers indicate to start performing inter-frequency
RSTD measurements; and the UE requires measurement gaps for these measurements
while measurement gaps are either not configured or not sufficient:
2> initiate the procedure to indicate start;
NOTE 1: The UE verifies the measurement gap situation only upon receiving the
indication from upper layers. If at this point in time sufficient gaps are
available, the UE does not initiate the procedure. Unless it receives a new
indication from upper layers, the UE is only allowed to further repeat the
procedure in the same PCell once per frequency if the provided measurement
gaps are insufficient.
1> if and only if upper layers indicate to stop performing inter-frequency
RSTD measurements:
2> initiate the procedure to indicate stop;
NOTE 2: The UE may initiate the procedure to indicate stop even if it did not
previously initiate the procedure to indicate start.
[TS 36.331, clause 5.5.7.3]
The UE shall set the contents of _InterFreqRSTDMeasurementIndication_ message
as follows:
1> set _the rstd-InterFreqIndication_ as follows:
2> if the procedure is initiated to indicate start of inter-frequency RSTD
measurements:
3> set the _rstd-InterFreqInfoList_ according to the information received from
upper layers;
2> else if the procedure is initiated to indicate stop of inter-frequency RSTD
measurements:
3> set the rstd-InterFreqIndication to the value stop;
1> submit the _InterFreqRSTDMeasurementIndication_ message to lower layers for
transmission, upon which the procedure ends;
##### 7.5.1.3 Test description {#test-description-16 .H6}
##### 7.5.1.3.1 Pre-test conditions {#pre-test-conditions-16 .H6}
##### System Simulator: {#system-simulator-13 .H6}
\- Cell 1 as specified in 5.2.2.
##### UE: {#ue-30 .H6}
-
##### Preamble: {#preamble-16 .H6}
\- The UE is in state Generic RB Established (state 3) according to 3GPP
36.508 [8] (no measurement gaps are configured).
##### Related PICS/PIXIT Statements: {#related-picspixit-statements-48 .H6}
\- Support for inter-frequency RSTD measurements that require measurement gaps
for these measurements.
##### 7.5.1.3.2 Test procedure sequence {#test-procedure-sequence-15 .H6}
Table 7.5.1.3.2-1: Main behaviour
+------+-------------+-------------+-------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +======+=============+=============+=============+=========+====+ | | | U - S | Message | | | +------+-------------+-------------+-------------+---------+----+ | 1 | The stored | \ | * | - | - | | | sends a LPP | | ULInformati | | | | | message of | | onTransfer_ | | | | | type | | | | | | | Provide | | (LPP | | | | | C | | PROVIDE | | | | | apabilities | | CA | | | | | including | | PABILITIES) | | | | | the UE | | | | | | | positioning | | | | | | | ca | | | | | | | pabilities. | | | | | +------+-------------+-------------+-------------+---------+----+ | 1c | IF | \ | * | - | - | | | sends a LPP | | ULInformati | | | | | message of | | onTransfer_ | | | | | type | | | | | | | Provide | | (LPP | | | | | Location | | PROVIDE | | | | | I | | LOCATION | | | | | nformation. | | I | | | | | | | NFORMATION) | | | +------+-------------+-------------+-------------+---------+----+ | 7a | IF | \ _InterFreqRSTDMeasurementIndication_ 1 P 2 The SS
transmits an _RRCConnectionReconfiguration_ message to set up the measurement
gap configuration \ _RRCConnectionReconfigurationComplete_ \- -
Table 7.5.1.3.2-3: Parallel behaviour
**St** **Procedure** **Message Sequence** **TP** **Verdict**
* * *
                                                                                                                                            **U - S**              **Message**
1 The UE transmits an RRC _InterFreqRSTDMeasurementIndication_ message to
indicate "stop" --> _InterFreqRSTDMeasurementIndication_ 2 P 2 The SS
transmits an _RRCConnectionReconfiguration_ message to release the measurement
gap configuration \ _RRCConnectionReconfigurationComplete_
\- -
##### 7.5.1.3.3 Specific message contents {#specific-message-contents-49 .H6}
For the default message content as specified in subclause 5.4, the values for
sub-test 5 are used.
Table 7.5.1.3.3-1: RESET UE POSITIONING STORED INFORMATION (step 1, Table
7.5.1.3.2-1)
* * *
Derivation Path: 36.509 clause 6.9  
Information Element Value/remark Comment Condition UE Positioning Technology 0
0 0 0 0 0 0 1 OTDOA
* * *
_Table_ 7.5.1.3.3-2 _:_ _DLInformationTransfer_ (steps 1a, 1c, 2, 6 and 7a,
Table 7.5.1.3.2-1)
* * *
Derivation Path: 36.331 clause 6.2.2  
Information Element Value/remark Comment Condition DLInformationTransfer ::=
SEQUENCE {  
rrc-TransactionIdentifier  
criticalExtensions CHOICE {  
c1 CHOICE {  
dlInformationTransfer-r8 SEQUENCE {  
dedicatedInfoType CHOICE {  
dedicatedInfoNAS OCTET STRING Set according to Table 7.5.1.3.3-3 DOWNLINK
GENERIC NAS TRANSPORT  
}  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}  
}
* * *
Table 7.5.1.3.3-3: DOWNLINK GENERIC NAS TRANSPORT (steps 1a, 1c, 2, 6 and 7a,
Table 7.5.1.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 24.301 | | | | | Table 8.2.31.1 | | | | +-----------------+-----------------+-----------------+-----------+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Protocol | 0111 | EPS mobility | | | discriminator | | management | | | | | messages | | +-----------------+-----------------+-----------------+-----------+ | Security header | 0000 | Plain NAS | | | type | | message | | +-----------------+-----------------+-----------------+-----------+ | Downlink | 01101000 | Downlink | | | generic NAS | | generic NAS | | | transport | | transport | | | message | | | | | identity | | | | +-----------------+-----------------+-----------------+-----------+ | Generic message | 00000001 | LTE Positioning | | | container type | | Protocol (LPP) | | | | | message | | | | | container | | +-----------------+-----------------+-----------------+-----------+ | Generic message | **Step 1a:** | LPP Request | | | container | | Capabilities. | | | | Set according | | | | | to Table | | | | | 7.5.1.3.3-3a | | | +-----------------+-----------------+-----------------+-----------+ | | Step 2: | LPP Provide | | | | | Assistance Data | | | | Set according | | | | | to Table | | | | | 7.5.1.3.3-4 | | | +-----------------+-----------------+-----------------+-----------+ | | Step 6: | LPP Request | | | | | Location | | | | Set according | Information | | | | to Table | | | | | 7.5.1.3.3-8 | | | +-----------------+-----------------+-----------------+-----------+ | | Step**s 1c | LPP | | | | and** 7a: | Acknowledgement | | | | | | | | | Set according | | | | | to Table | | | | | 7.5.1.3.3-12 | | | +-----------------+-----------------+-----------------+-----------+ | Additional | Present | Routing | | | information | | Identifier/ | | | | | | | | | | Correlation ID | | +-----------------+-----------------+-----------------+-----------+
Table 7.5.1.3.3-3a: LPP Request Capabilities (step 1a, Table 7.5.1.3.2-1)
* * *
Derivation Path: Table 5.4-1  
Information Element Value/remark Comment Condition As defined in Table 5.4-1
* * *
Table 7.5.1.3.3-4: LPP Provide Assistance data (step 2, Table 7.5.1.3.2-1)
* * *
Derivation Path: Table 5.4-2  
Information Element Value/remark Comment Condition As defined in Table 5.4-2
with the following exceptions:  
transactionID SEQUENCE {  
initiator locationServer  
transactionNumber (0..255)  
}  
otdoa-ProvideAssistanceData SEQUENCE {  
otdoa-NeighbourCellInfo Set according to Table 7.5.1.3.3-5.  
}
* * *
Table 7.5.1.3.3-5: OTDOA-NeighbourCellInfoList (step 2, Table 7.5.1.3.2-1)
+----------------+----------------+----------------+----------------+ | Derivation | | | | | Path: 36.355 | | | | | clause 6.5.1.2 | | | | +----------------+----------------+----------------+----------------+ | Information | Value/remark | Comment | Condition | | Element | | | | +----------------+----------------+----------------+----------------+ | OTDOA-Neighbo | | | | | urCellInfoList | | | | | ::= SEQUENCE | | | | | (SIZE(2)) OF | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | SEQUENCE | | Cell 3 | | | (SIZE(1)) OF | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | physCellId | 3 | | | +----------------+----------------+----------------+----------------+ | cellGlobalId | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | mcc | As defined for | | | | | Cell 3 in | | | | | 36.508 [8] | | | +----------------+----------------+----------------+----------------+ | mnc | As defined for | | | | | Cell 3 in | | | | | 36.508 [8] | | | +----------------+----------------+----------------+----------------+ | cellidentity | As defined for | | | | | Cell 3 in | | | | | 36.508 [8] | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | earfcn | For E-UTRA | | | | | band \ 64: | | | | | | | | | | not present | | | +----------------+----------------+----------------+----------------+ | cpLength | Not present | Same as for | | | | | the reference | | | | | cell | | +----------------+----------------+----------------+----------------+ | prsInfo | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | prs-Bandwidth | PRS are | | | | | transmitted | | | | | over the used | | | | | system | | | | | bandwidth (see | | | | | subclause | | | | | 5.2.2) | | | +----------------+----------------+----------------+----------------+ | prs-Conf | 12 | | | | igurationIndex | | | | +----------------+----------------+----------------+----------------+ | numDL-Frames | sf-1 | | | +----------------+----------------+----------------+----------------+ | prs | Not present | PRS muting is | | | -MutingInfo-r9 | | not used. | | +----------------+----------------+----------------+----------------+ | prsID-r14 | Not present | PRS-ID not | Rel-14 onwards | | | | used | | +----------------+----------------+----------------+----------------+ | add-nu | Not present | Not required | Rel-14 onwards | | mDL-Frames-r14 | | | | +----------------+----------------+----------------+----------------+ | prsO | Not present | No PRS | Rel-14 onwards | | ccGroupLen-r14 | | occasion group | | | | | configured | | +----------------+----------------+----------------+----------------+ | prsH | Not present | PRS frequency | Rel-14 onwards | | oppingInfo-r14 | | hopping not | | | | | used | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | ant | Not present | Same as for | | | ennaPortConfig | | the reference | | | | | cell | | +----------------+----------------+----------------+----------------+ | sl | Not present | Slot timing is | | | otNumberOffset | | the same as | | | | | for reference | | | | | cell | | +----------------+----------------+----------------+----------------+ | prs- | 10 | | | | SubframeOffset | | | | +----------------+----------------+----------------+----------------+ | expectedRSTD | 8192 | Value 0 | | +----------------+----------------+----------------+----------------+ | expectedRS | 10 | About 1 μs | | | TD-Uncertainty | | | | +----------------+----------------+----------------+----------------+ | earfcn-v9a0 | For E-UTRA | | | | | band \ 64: | | | | | | | | | | as defined for | | | | | Cell 3 in | | | | | 36.508 [8] | | | +----------------+----------------+----------------+----------------+ | tpId-r14 | Not present | Transmission | Rel-14 onwards | | | | Points not | | | | | used | | +----------------+----------------+----------------+----------------+ | p | Not present | Not required | Rel-14 onwards | | rs-only-tp-r14 | | | | +----------------+----------------+----------------+----------------+ | c | Normal | | Rel-14 onwards | | pLengthCRS-r14 | | | | +----------------+----------------+----------------+----------------+ | sameMBSFNconfi | TRUE | Same as for | Rel-14 onwards | | gNeighbour-r14 | | the reference | | | | | cell | | +----------------+----------------+----------------+----------------+ | d | Not present | Same as for | Rel-14 onwards | | lBandwidth-r14 | | the reference | | | | | cell and PRS | | | | | frequency | | | | | hopping not | | | | | used | | +----------------+----------------+----------------+----------------+ | addPRSconfi | Not present | No additional | Rel-14 onwards | | gNeighbour-r14 | | PRS | | | | | co | | | | | nfiguration(s) | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | SEQUENCE | | Cell 6 | Assumes that | | (SIZE(1)) OF | | | earfcn for | | SEQUENCE { | | | Cell 6 is | | | | | different from | | | | | earfcn for | | | | | Cell 3. | +----------------+----------------+----------------+----------------+ | physCellId | 6 | | | +----------------+----------------+----------------+----------------+ | cellGlobalId | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | mcc | As defined for | | | | | Cell 6 in | | | | | 36.508 [8] | | | +----------------+----------------+----------------+----------------+ | mnc | As defined for | | | | | Cell 6 in | | | | | 36.508 [8] | | | +----------------+----------------+----------------+----------------+ | cellidentity | As defined for | | | | | Cell 6 in | | | | | 36.508 [8] | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | earfcn | For E-UTRA | | | | | band \ 64: | | | | | | | | | | not present | | | +----------------+----------------+----------------+----------------+ | cpLength | Not present | Same as for | | | | | the reference | | | | | cell | | +----------------+----------------+----------------+----------------+ | prsInfo | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | prs-Bandwidth | PRS are | | | | | transmitted | | | | | over the used | | | | | system | | | | | bandwidth (see | | | | | subclause | | | | | 5.2.2) | | | +----------------+----------------+----------------+----------------+ | prs-Conf | 12 | | | | igurationIndex | | | | +----------------+----------------+----------------+----------------+ | numDL-Frames | sf-1 | | | +----------------+----------------+----------------+----------------+ | prs | Not present | PRS muting is | | | -MutingInfo-r9 | | not used. | | +----------------+----------------+----------------+----------------+ | prsID-r14 | Not present | PRS-ID not | Rel-14 onwards | | | | used | | +----------------+----------------+----------------+----------------+ | add-nu | Not present | Not required | Rel-14 onwards | | mDL-Frames-r14 | | | | +----------------+----------------+----------------+----------------+ | prsO | Not present | No PRS | Rel-14 onwards | | ccGroupLen-r14 | | occasion group | | | | | configured | | +----------------+----------------+----------------+----------------+ | prsH | Not present | PRS frequency | Rel-14 onwards | | oppingInfo-r14 | | hopping not | | | | | used | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | ant | Not present | Same as for | | | ennaPortConfig | | the reference | | | | | cell | | +----------------+----------------+----------------+----------------+ | sl | Not present | Slot timing is | | | otNumberOffset | | the same as | | | | | for reference | | | | | cell | | +----------------+----------------+----------------+----------------+ | prs- | 10 | | | | SubframeOffset | | | | +----------------+----------------+----------------+----------------+ | expectedRSTD | 8192 | Value 0 | | +----------------+----------------+----------------+----------------+ | expectedRS | 10 | About 1 μs | | | TD-Uncertainty | | | | +----------------+----------------+----------------+----------------+ | earfcn-v9a0 | For E-UTRA | | | | | band \ 64: | | | | | | | | | | as defined for | | | | | Cell 6 in | | | | | 36.508 [8] | | | +----------------+----------------+----------------+----------------+ | tpId-r14 | Not present | Transmission | Rel-14 onwards | | | | Points not | | | | | used | | +----------------+----------------+----------------+----------------+ | p | Not present | Not required | Rel-14 onwards | | rs-only-tp-r14 | | | | +----------------+----------------+----------------+----------------+ | c | Normal | | Rel-14 onwards | | pLengthCRS-r14 | | | | +----------------+----------------+----------------+----------------+ | sameMBSFNconfi | TRUE | Same as for | Rel-14 onwards | | gNeighbour-r14 | | the reference | | | | | cell | | +----------------+----------------+----------------+----------------+ | d | Not present | Same as for | Rel-14 onwards | | lBandwidth-r14 | | the reference | | | | | cell and PRS | | | | | frequency | | | | | hopping not | | | | | used | | +----------------+----------------+----------------+----------------+ | addPRSconfi | Not present | No additional | Rel-14 onwards | | gNeighbour-r14 | | PRS | | | | | co | | | | | nfiguration(s) | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+
Table 7.5.1.3.3-6: RRC InterFreqRSTDMeasurementIndication (step 1, Table
7.5.1.3.2-2)
+----------------------+----------------------+---------+-----------+ | Derivation Path: | | | | | 36.331, clause 6.2.2 | | | | +----------------------+----------------------+---------+-----------+ | Information Element | Value/remark | Comment | Condition | +----------------------+----------------------+---------+-----------+ | InterFreqRSTDMeasu | | | | | rementIndication-r10 | | | | | ::= SEQUENCE{ | | | | +----------------------+----------------------+---------+-----------+ | criticalExtensions | | | | | CHOICE { | | | | +----------------------+----------------------+---------+-----------+ | c1 CHOICE { | | | | +----------------------+----------------------+---------+-----------+ | interFreqRSTDMeasu | | | | | rementIndication-r10 | | | | | | | | | | SEQUENCE { | | | | +----------------------+----------------------+---------+-----------+ | rstd-Int | | | | | erFreqIndication-r10 | | | | | CHOICE { | | | | +----------------------+----------------------+---------+-----------+ | start SEQUENCE { | | | | +----------------------+----------------------+---------+-----------+ | rstd-I | 2 entries | | | | nterFreqInfoList-r10 | | | | | SEQUENCE { | | | | +----------------------+----------------------+---------+-----------+ | carrierFreq-r10[1] | For E-UTRA band \ | | | | | 64: 65535 | | | +----------------------+----------------------+---------+-----------+ | mea | (0..39) | | | | sPRS-Offset-r10[1] | | | | +----------------------+----------------------+---------+-----------+ | ca | For E-UTRA band \ | | | | | 64: as defined for | | | | | Cell 3 in 36.508 | | | | | [8] | | | +----------------------+----------------------+---------+-----------+ | carrierFreq-r10[2] | For E-UTRA band \ | | | | | 64: 65535 | | | +----------------------+----------------------+---------+-----------+ | mea | (0..39) | | | | sPRS-Offset-r10[2] | | | | +----------------------+----------------------+---------+-----------+ | ca | For E-UTRA band \ | | | | | 64: as defined for | | | | | Cell 6 in 36.508 | | | | | [8] | | | +----------------------+----------------------+---------+-----------+ | } | | | | +----------------------+----------------------+---------+-----------+ | } | | | | +----------------------+----------------------+---------+-----------+ | } | | | | +----------------------+----------------------+---------+-----------+ | late | Not present | | | | NonCriticalExtension | | | | | OCTET STRING | | | | +----------------------+----------------------+---------+-----------+ | nonCriticalExtension | Not present | | | | SEQUENCE {} | | | | +----------------------+----------------------+---------+-----------+ | } | | | | +----------------------+----------------------+---------+-----------+ | crit | Not present | | | | icalExtensionsFuture | | | | | SEQUENCE {} | | | | +----------------------+----------------------+---------+-----------+ | } | | | | +----------------------+----------------------+---------+-----------+ | } | | | | +----------------------+----------------------+---------+-----------+ | } | | | | +----------------------+----------------------+---------+-----------+
Table 7.5.1.3.3-7: RRCConnectionReconfiguration (step 2, Table 7.5.1.3.2-2)
* * *
Derivation Path: 36.508, Table 4.6.1-8  
Information Element Value/remark Comment Condition As defined in 36.508, Table
4.6.1-8 with the following exceptions:  
measConfig ::= SEQUENCE {  
measGapConfig CHOICE {  
setup SEQUENCE {  
gapOffset CHOICE {  
gp0 Value of measPRS-Offset-r10 as provided by the UE in Table 7.5.1.3.3-6.  
}  
}  
}  
}
* * *
Table 7.5.1.3.3-8: LPP Request Location Information (step 6, Table
7.5.1.3.2-1)
* * *
Derivation Path: Table 5.4-3  
Information Element Value/remark Comment Condition As defined in Table 5.4-3
with the following exceptions:  
locationInformationType locationMeasurementsRequired  
time 10
* * *
Table 7.5.1.3.3-9: ULInformationTransfer (steps 1b and 7, Table 7.5.1.3.2-1)
* * *
Derivation Path: 36.331 clause 6.2.2  
Information Element Value/remark Comment Condition ULInformationTransfer ::=
SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
ulInformationTransfer-r8 SEQUENCE {  
dedicatedInfoType CHOICE {  
dedicatedInfoNAS OCTET STRING Set according to Table 7.5.1.3.3-10 UPLINK
GENERIC NAS TRANSPORT  
}  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}  
}
* * *
Table 7.5.1.3.3-10: UPLINK GENERIC NAS TRANSPORT (steps 1b and 7, Table
7.5.1.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 24.301 | | | | | Table 8.2.32.1 | | | | +-----------------+-----------------+-----------------+-----------+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Protocol | 0111 | EPS mobility | | | discriminator | | management | | | | | messages | | +-----------------+-----------------+-----------------+-----------+ | Security header | 0000 | Plain NAS | | | type | | message | | +-----------------+-----------------+-----------------+-----------+ | Uplink generic | 01101001 | Uplink generic | | | NAS transport | | NAS transport | | | message | | | | | identity | | | | +-----------------+-----------------+-----------------+-----------+ | Generic message | 00000001 | LTE Positioning | | | container type | | Protocol (LPP) | | | | | message | | | | | container | | +-----------------+-----------------+-----------------+-----------+ | Generic message | **Step 1b:** | LPP Provide | | | container | | Capabilities | | | | Set according | | | | | to Table | | | | | | | | | | 7.5.1.3.3-10a | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 7:** | LPP Provide | | | | | Location | | | | Set according | Information | | | | to Table | | | | | | | | | | 7.5.1.3.3-11 | | | +-----------------+-----------------+-----------------+-----------+ | Additional | present | The UE includes | | | information | | the Routing | | | | | Identifier | | | | | received in the | | | | | Additional | | | | | Information IE | | | | | of the DOWNLINK | | | | | GENERIC NAS | | | | | TRANSPORT | | | | | message (step | | | | | 1a or 6 Table | | | | | 7.5.1.3.2-1) | | +-----------------+-----------------+-----------------+-----------+
Table 7.5.1.3.3-10a: LPP Provide Capabilities. (step 1b, Table 7.5.1.3.2-1)
* * *
Derivation Path: 36.355 clause 6.2  
Information Element Value/remark Comment Condition LPP-Message ::= SEQUENCE {  
transactionID SEQUENCE {  
initiator locationServer  
transactionNumber (0..255) Contains the same value as the corresponding field
in the LPP Request Capabilities message in step 1a, Table 7.5.1.3.2-1  
}  
endTransaction TRUE  
sequenceNumber (0..255)  
acknowledgement SEQUENCE { Present, or not present  
ackRequested TRUE  
ackIndicator Not present  
}  
lpp-MessageBody CHOICE {  
c1 CHOICE {  
provideCapabilities SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
provideCapabilities-r9 SEQUENCE {  
commonIEsProvideCapabilities Dependent on UE capabilities Rel-14 onwards  
a-gnss-ProvideCapabilities Dependent on UE capabilities  
otdoa-ProvideCapabilities Dependent on UE capabilities  
ecid-ProvideCapabilities Dependent on UE capabilities  
epdu-ProvideCapabilities Not present  
sensor-ProvideCapabilities-r13 Dependent on UE capabilities Rel-13 onwards  
tbs-ProvideCapabilities-r13 Dependent on UE capabilities Rel-13 onwards  
wlan-ProvideCapabilities-r13 Dependent on UE capabilities Rel-13 onwards  
bt-ProvideCapabilities-r13 Dependent on UE capabilities Rel-13 onwards  
}  
}  
}  
}  
}  
}
* * *
Table 7.5.1.3.3-11: LPP Provide Location Information (step 7, Table
7.5.1.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 36.355 | | | | | clause 6.2 | | | | +-----------------+-----------------+-----------------+-----------+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | LPP-Message ::= | | | | | SEQUENCE { | | | | +-----------------+-----------------+-----------------+-----------+ | transactionID | | | | | SEQUENCE { | | | | +-----------------+-----------------+-----------------+-----------+ | initiator | locationServer | | | +-----------------+-----------------+-----------------+-----------+ | tr | (0..255) | Contains the | | | ansactionNumber | | same value as | | | | | the | | | | | corresponding | | | | | field in LPP | | | | | Request | | | | | Location | | | | | Information | | | | | message in step | | | | | 6, Table | | | | | 7.5.1.3.2-1 | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+ | endTransaction | TRUE | | | +-----------------+-----------------+-----------------+-----------+ | sequenceNumber | (0..255) | | | +-----------------+-----------------+-----------------+-----------+ | acknowledgement | present, or not | | | | SEQUENCE { | present | | | +-----------------+-----------------+-----------------+-----------+ | ackRequested | TRUE | | | +-----------------+-----------------+-----------------+-----------+ | ackIndicator | Not present | | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+ | lpp-MessageBody | | | | | CHOICE { | | | | +-----------------+-----------------+-----------------+-----------+ | c1 CHOICE { | | | | +-----------------+-----------------+-----------------+-----------+ | provideLoca | | | | | tionInformation | | | | | SEQUENCE { | | | | +-----------------+-----------------+-----------------+-----------+ | cri | | | | | ticalExtensions | | | | | CHOICE { | | | | +-----------------+-----------------+-----------------+-----------+ | c1 CHOICE { | | | | +-----------------+-----------------+-----------------+-----------+ | provideLocatio | | | | | nInformation-r9 | | | | | | | | | | SEQUENCE { | | | | +-----------------+-----------------+-----------------+-----------+ | commo | May be present. | | | | nIEsProvideLoca | Any value | | | | tionInformation | acceptable | | | +-----------------+-----------------+-----------------+-----------+ | a-g | Not present | | | | nss-ProvideLoca | | | | | tionInformation | | | | +-----------------+-----------------+-----------------+-----------+ | ot | May be present. | | | | doa-ProvideLoca | Any value | | | | tionInformation | acceptable | | | +-----------------+-----------------+-----------------+-----------+ | e | Not present | | | | cid-ProvideLoca | | | | | tionInformation | | | | +-----------------+-----------------+-----------------+-----------+ | e | Not present | | | | pdu-ProvideLoca | | | | | tionInformation | | | | +-----------------+-----------------+-----------------+-----------+ | sensor- | Not present | Rel-13 onwards | | | ProvideLocation | | | | | Information-r13 | | | | +-----------------+-----------------+-----------------+-----------+ | tbs- | Not present | Rel-13 onwards | | | ProvideLocation | | | | | Information-r13 | | | | +-----------------+-----------------+-----------------+-----------+ | wlan- | Not present | Rel-13 onwards | | | ProvideLocation | | | | | Information-r13 | | | | +-----------------+-----------------+-----------------+-----------+ | bt- | Not present | Rel-13 onwards | | | ProvideLocation | | | | | Information-r13 | | | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+
Table 7.5.1.3.3-12: LPP Acknowledgement (steps 1c and 7a, Table 7.5.1.3.2-1)
* * *
Derivation Path: 36.355 clause 6.2  
Information Element Value/remark Comment Condition LPP-Message ::= SEQUENCE {  
transactionID Not present  
endTransaction TRUE  
sequenceNumber Not present  
acknowledgement SEQUENCE {  
ackRequested FALSE  
ackIndicator (0..255) Contains the same value of the sequenceNumber field in
step 1b or 7, Table 7.5.1.3.2-1  
}  
lpp-MessageBody Not present.  
}
* * *
Table 7.5.1.3.3-13: RRC InterFreqRSTDMeasurementIndication (step 1, Table
7.5.1.3.2-3)
+------------------------------+--------------+---------+-----------+ | Derivation Path: 36.331, | | | | | clause 6.2.2 | | | | +------------------------------+--------------+---------+-----------+ | Information Element | Value/remark | Comment | Condition | +------------------------------+--------------+---------+-----------+ | InterFreqR | | | | | STDMeasurementIndication-r10 | | | | | ::= SEQUENCE{ | | | | +------------------------------+--------------+---------+-----------+ | criticalExtensions CHOICE { | | | | +------------------------------+--------------+---------+-----------+ | c1 CHOICE { | | | | +------------------------------+--------------+---------+-----------+ | interFreqR | | | | | STDMeasurementIndication-r10 | | | | | | | | | | SEQUENCE { | | | | +------------------------------+--------------+---------+-----------+ | rstd-InterFreqIndication-r10 | | | | | CHOICE { | | | | +------------------------------+--------------+---------+-----------+ | stop | NULL | | | +------------------------------+--------------+---------+-----------+ | } | | | | +------------------------------+--------------+---------+-----------+ | lateNonCriticalExtension | Not present | | | | OCTET STRING | | | | +------------------------------+--------------+---------+-----------+ | nonCriticalExtension | Not present | | | | SEQUENCE {} | | | | +------------------------------+--------------+---------+-----------+ | } | | | | +------------------------------+--------------+---------+-----------+ | criticalExtensionsFuture | Not present | | | | SEQUENCE {} | | | | +------------------------------+--------------+---------+-----------+ | } | | | | +------------------------------+--------------+---------+-----------+ | } | | | | +------------------------------+--------------+---------+-----------+ | } | | | | +------------------------------+--------------+---------+-----------+
Table 7.5.1.3.3-14: RRCConnectionReconfiguration (step 2, Table 7.5.1.3.2-3)
* * *
Derivation Path: 36.508, Table 4.6.1-8  
Information Element Value/remark Comment Condition As defined in 36.508, Table
4.6.1-8 with the following exceptions:  
measConfig ::= SEQUENCE {  
measGapConfig CHOICE {  
release NULL  
}  
}
* * *
### 7.5.2 Void
# 8 Default Conditions for NR
## 8.1 LCS Sub-Test Cases
Some test cases defined in clause 9 may include several sub-test cases
dependent on the positioning method(s) supported by the UE. Each sub-test case
is identified by a sub-test case number as defined in Table 8.1-1. The
applicable sub-tests for each test case are specified in the test procedure
sequence clause of each test case. If no sub-tests are defined for a specific
test case it means that this particular test case is not dependent on a
specific positioning method and is applicable in all cases, independently of
the positioning method(s) supported by the UE.
Table 8.1-1: Sub-Test Case Numbers for NR
+----------------------------------+----------------------------------+ | Sub-Test Case Number | Supported Positioning Methods | +----------------------------------+----------------------------------+ | 1 | Void | +----------------------------------+----------------------------------+ | 2 | Void | +----------------------------------+----------------------------------+ | 3 | Void | +----------------------------------+----------------------------------+ | 4 | Void | +----------------------------------+----------------------------------+ | 5 | UE supporting OTDOA (LTE) | +----------------------------------+----------------------------------+ | 6 | UE supporting ECID (LTE) | +----------------------------------+----------------------------------+ | 7 | UE supporting GNSS^(1)^ and | | | OTDOA (LTE) | +----------------------------------+----------------------------------+ | 8 | Void | +----------------------------------+----------------------------------+ | 9 | Void | +----------------------------------+----------------------------------+ | 10 | Void | +----------------------------------+----------------------------------+ | 11 | UE supporting WLAN (Rel-13 only) | +----------------------------------+----------------------------------+ | 12 | UE supporting MBS^(2)^ (Rel-13 | | | only) | +----------------------------------+----------------------------------+ | 13 | UE supporting Bluetooth | +----------------------------------+----------------------------------+ | 14 | UE supporting Sensor (Rel-13 | | | only) | +----------------------------------+----------------------------------+ | 15 | UE supporting GNSS^(1)^ | +----------------------------------+----------------------------------+ | 16 | UE supporting MBS^(2)^ (Rel-14 | | | onwards) | +----------------------------------+----------------------------------+ | 17 | UE supporting WLAN (Rel-14 | | | onwards) | +----------------------------------+----------------------------------+ | 18 | UE supporting Sensor (Rel-14 | | | onwards) | +----------------------------------+----------------------------------+ | 19 | UE supporting Multi-RTT (Rel-16 | | | onwards) | +----------------------------------+----------------------------------+ | 20 | UE supporting DL-AoD (Rel-16 | | | onwards) | +----------------------------------+----------------------------------+ | 21 | UE supporting DL-TDOA (Rel-16 | | | onwards) | +----------------------------------+----------------------------------+ | 22 | UE supporting NR E-CID (Rel-16 | | | onwards) | +----------------------------------+----------------------------------+ | 23 | UE supporting MBS^(2)^ (Rel-16 | | | onwards) | +----------------------------------+----------------------------------+ | 24 | UE supporting Sensor (Rel-16 | | | onwards) | +----------------------------------+----------------------------------+ | 25 | UE supporting GNSS^(1)^ (Rel-15 | | | onwards) | +----------------------------------+----------------------------------+ | NOTE 1: The GNSS combination of | | | BDS, Galileo, GLONASS, GPS | | | supported by the UE | | | | | | NOTE 2: Metropolitan Beacon | | | System (MBS) is a specific type | | | of Terrestrial Beacon System | | | (TBS) [29] | | +----------------------------------+----------------------------------+
## 8.1A Test Configurations
For ease of use of this document a number of Test Configurations corresponding
to Network Deployment Types are defined in Table 8.1A-1.
Table 8.1A-1: Test Configuration
* * *
**Test Configuration** **Network Deployment Type** A EN-DC B NG-RAN NR C NE-DC
D NG-RAN E-UTRA E NGEN-DC
* * *
## 8.2 Default signal conditions
### 8.2.1 Simulated GNSS environment
Same as defined in clause 5.2.1.
For Test Configuration B (Table 8.1A-1) the NR Cell 1 frequency to be used for
testing and other default conditions are as specified for signalling test
cases in 3GPP TS 38.508-1 [30].
For Test Configuration D (Table 8.1A-1) the LTE Cell 1 frequency to be tested
and other default conditions are as specified for signalling test cases in
3GPP TS 36.508 [8].
### 8.2.2 Simulated OTDOA (LTE) environment
For Test Configuration B (Table 8.1A-1) the NR Cell 1 frequency to be used for
testing and other default conditions are as specified for signalling test
cases in 3GPP TS 38.508-1 [30].
For Test Configuration B (Table 8.1A-1) an additional independent multi cell
LTE environment is used with LTE Cell 1 and LTE Cell 2 (where required) . The
E-UTRA frequency to be tested and other default conditions are as specified
for signalling test cases in 3GPP TS 36.508 [8].
For Test Configuration D (Table 8.1A-1), the LTE Cell 1 and LTE Cell 2 (where
required) E-UTRA frequency to be tested and other default conditions are as
specified for signalling test cases in 3GPP TS 36.508 [8].
All LTE cells transmit PRS according to the PRS configuration provided in the
OTDOA (LTE) assistance data defined in subclause 8.4.1.2. The positioning
subframes are low-interference subframes, i.e. contain no PDSCH transmissions.
LTE Cell 1 is the OTDOA reference cell, LTE Cell 2 (where required) is an
OTDOA neighbour cell.
Where two LTE cells are required, the two LTE Cells 1 and 2 shall be
synchronized, and the timing offset (the RSTD) between the cells, referenced
to the UE's antenna input, shall be set equal to the _expectedRSTD_ value
provided in the OTDOA (LTE) assistance data, as defined in subclause 8.4.1.2.
Normal propagation condition is used for all cells.
### 8.2.3 Simulated ECID (LTE) environment
Same as defined in clause 5.2.3.
For Test Configuration B (Table 8.1A-1) up to and including LPP Rel-15, UE Rx-
Tx measurement is not possible and therefore there is little value in testing
ECID (LTE) for positioning purposes and ECID (LTE) shall not be tested.
For Test Configuration D (Table 8.1A-1), the LTE Cell 1 and LTE Cell 2 E-UTRA
frequency to be tested and other default conditions are as specified for
signalling test cases in 3GPP TS 36.508 [8].
### 8.2.4 Simulated MBS environment
Same as defined in clause 5.2.4.
For Test Configuration B (Table 8.1A-1) the NR Cell 1 frequency to be used for
testing and other default conditions are as specified for signalling test
cases in 3GPP TS 38.508-1 [30].
For Test Configuration D (Table 8.1A-1) the LTE Cell 1 frequency to be tested
and other default conditions are as specified for signalling test cases in
3GPP TS 36.508 [8].
### 8.2.5 Simulated WLAN environment
Same as defined in clause 5.2.5.
For Test Configuration B (Table 8.1A-1) the NR Cell 1 frequency to be used for
testing and other default conditions are as specified for signalling test
cases in 3GPP TS 38.508-1 [30].
For Test Configuration D (Table 8.1A-1) the LTE Cell 1 frequency to be tested
and other default conditions are as specified for signalling test cases in
3GPP TS 36.508 [8].
### 8.2.6 Simulated Bluetooth environment
Same as defined in clause 5.2.6.
For Test Configuration B (Table 8.1A-1) the NR Cell 1 frequency to be used for
testing and other default conditions are as specified for signalling test
cases in 3GPP TS 38.508-1 [30].
For Test Configuration D (Table 8.1A-1) the LTE Cell 1 frequency to be tested
and other default conditions are as specified for signalling test cases in
3GPP TS 36.508 [8].
### 8.2.7 Simulated Sensor environment
Same as defined in clause 5.2.7.
For Test Configuration B (Table 8.1A-1) the NR Cell 1 frequency to be used for
testing and other default conditions are as specified for signalling test
cases in 3GPP TS 38.508-1 [30].
For Test Configuration D (Table 8.1A-1) the LTE Cell 1 frequency to be tested
and other default conditions are as specified for signalling test cases in
3GPP TS 36.508 [8].
### 8.2.8 Simulated general NR environment
For NR FR2, the connection between the SS and the DUT shall be OTA. The SS
shall ensure that the NR cell is suitable throughout the test. The OTA link
shall be sufficient to provide stable LPP message transmissions between the SS
and the DUT.
For NR FR1 and the other technologies used for the test cases in Chapter 9
(e.g. LTE, GNSS, WLAN...) the connection shall be conducted, following the
settings described in this section.
### 8.2.9 Simulated Multi-RTT environment
For Multi-RTT signalling test cases NR Cell 1 is used, as defined in 3GPP TS
38.508-1 [30].
NR cell transmits DL-PRS according to the DL-PRS configuration provided in the
Multi-RTT assistance data defined in subclause 8.4.1.6. The UE transmits UL-
SRS according to the UL-SRS configuration provided in the RRC message as
defined in subclause 8.3.2.
Normal propagation condition is used for all cells.
The simulated general NR environment as specified in 8.2.8 also applies.
Multi-RTT tests are only applicable for Test Configuration B (Table 8.1A-1).
The NR Cell 1 frequency to be used for testing and other default conditions is
as specified for signalling test cases in 3GPP TS 38.508-1 [30].
### 8.2.10 Simulated DL-AoD environment
For DL-AoD signalling test cases NR Cell 1 and NR Cell 2 (if required) are
used, as defined in 3GPP TS 38.508-1 [30].
All NR cells transmit DL-PRS according to the DL-PRS configuration provided in
the DL-AoD assistance data defined in subclause 8.4.1.7.
Normal propagation condition is used for all cells.
The simulated general NR environment as specified in 8.2.8 also applies.
DL-AoD tests are only applicable for Test Configuration B (Table 8.1A-1). The
NR Cell 1 and NR Cell 2 frequencies to be used for testing and other default
conditions are as specified for signalling test cases in 3GPP TS 38.508-1
[30].
### 8.2.11 Simulated DL-TDOA environment
For DL-TDOA signalling test cases a multi cell environment with NR Cell 1, NR
Cell 2 and NR Cell 3 (if required) are used, as defined in 3GPP TS 38.508-1
[30].
All NR cells transmit DL-PRS according to the DL-PRS configuration provided in
the DL-TDOA assistance data defined in subclause 8.4.1.8.
Normal propagation condition is used for all cells.
NR Cell 1 is the DL-TDOA reference cell. NR Cell 2 and NR Cell 3 are DL-TDOA
neighbour cells.
The simulated general NR environment as specified in 8.2.8 also applies.
DL-TDOA tests are only applicable for Test Configuration B (Table 8.1A-1). The
NR Cell 1, NR Cell 2 and NR Cell 3 frequencies to be used for testing and
other default conditions are as specified for signalling test cases in 3GPP TS
38.508-1 [30].
### 8.2.12 Simulated NR E-CID environment
For NR E-CID signalling test cases NR Cell 1 is used, as defined in 3GPP TS
38.508-1 [30].
### 8.2.13 Simulated UL-TDOA environment
For UL-TDOA signalling test cases NR Cell 1 is used, as defined in 3GPP TS
38.508-1 [30].
The simulated general NR environment as specified in 8.2.8 also applies.
UL-TDOA test is only applicable for Test Configuration B (Table 8.1A-1). The
NR Cell 1 frequency to be used for testing and other default conditions is as
specified for signalling test cases in 3GPP TS 38.508-1 [30].
The simulated general NR environment as specified in 8.2.8 also applies.
NR E-CID tests are only applicable for Test Configuration B (Table 8.1A-1).
The NR Cell 1 frequency to be used for testing and other default conditions is
as specified for signalling test cases in 3GPP TS 38.508-1 [30].
## 8.3 Default RRC and NAS message and information elements contents
The default values of common RRC and NAS messages and information elements are
used as defined in 3GPP\ TS 38.508-1 [30] with the following exceptions:
Table 8.3-1: Void
Table 8.3-2: Void
\- REGISTRATION ACCEPT
Table 8.3-3: REGISTRATION ACCEPT
* * *
Derivation Path: 38.508-1 Table 4.7.1-7  
**Information Element** **Value/remark** **Comment** **Condition** 5GS network
feature support Set according to Table 8.3-4
* * *
Table 8.3-4: 5GS network feature support
* * *
Derivation Path: 24.501 clause 9.11.3.5  
**Information Element** **Value/remark** **Comment** **Condition** As defined
in 38.508-1 Table 4.7.1-7 with the following exceptions:  
Emergency service support indicator for 3GPP access (EMC) (octet 3, bit 3 and
bit 4) 01 Emergency services supported in NR connected to 5GCN only
* * *
### 8.3.1 RRC message contents for measurement gaps
Table 8.3.1-1: _RRCReconfiguration for meas gaps_
* * *
Derivation Path: TS 38.331 [6], clause 6.2.2  
Information Element Value/remark Comment Condition RRCReconfiguration ::=
SEQUENCE {  
rrc-TransactionIdentifier RRC-TransactionIdentifier  
criticalExtensions CHOICE {  
rrcReconfiguration SEQUENCE {  
radioBearerConfig Not present  
Not present  
measConfig MeasConfig Table 8.3.1-2  
lateNonCriticalExtension Not present  
nonCriticalExtension Not present  
}  
}  
}
* * *
Table 8.3.1-2: _MeasConfig_
* * *
Derivation Path: TS 38.331 [6], clause 6.3.2  
Information Element Value/remark Comment Condition MeasConfig ::= SEQUENCE {  
measObjectToRemoveList Not present  
measObjectToAddModList MeasObjectToAddModList Table 8.3.1-4  
reportConfigToRemoveList Not present  
reportConfigToAddModList Not present  
measIdToRemoveList Not present  
measIdToAddModList Not present  
s-MeasureConfig Not present  
quantityConfig Not present  
measGapConfig MeasGapConfig Table 8.3.1-3  
measGapSharingConfig Not present  
}
* * *
Table 8.3.1-3: _MeasGapConfig_
* * *
Derivation Path: TS 38.331 [6], clause 6.3.2  
Information Element Value/remark Comment Condition MeasGapConfig ::= SEQUENCE
{  
gapFR2 Not present  
gapFR1 Not present  
gapUE CHOICE {  
setup SEQUENCE {  
gapOffset 10  
mgl ms3  
mgrp ms160  
mgta ms0  
}  
}  
}
* * *
Table 8.3.1-4: MeasObjectToAddModList
* * *
Derivation Path: TS 38.331 [6], clause 6.3.2  
Information Element Value/remark Comment Condition MeasObjectToAddModList
::=SEQUENCE (SIZE (1..maxNrofObjectId)) OF MeasObjectToAddMod { 1 entry  
MeasObjectToAddMod[1] SEQUENCE { entry 1  
measObjectId 1  
measObject CHOICE {  
measObjectNR MeasObjectNR Table 8.3.1-5  
}  
}  
}
* * *
Table 8.3.1-5: MeasObjectNR
* * *
Derivation Path: TS 38.331 [6], clause 6.3.2  
Information Element Value/remark Comment Condition MeasObjectNR ::=SEQUENCE {  
ssbFrequency ARFCN-ValueNR for NR Cell 1  
ssbSubcarrierSpacing Subcarrier spacing of SSB for NR Cell 1  
smtc1 Not present  
smtc2 Not present  
refFreqCSI-RS Not present  
referenceSignalConfig SEQUENCE {  
ssb-ConfigMobility Not present  
csi-rs-ResourceConfigMobility Not present  
}  
absThreshSS-BlocksConsolidation Not present  
absThreshCSI-RS-Consolidation Not present  
nrofSS-BlocksToAverage Not present  
nrofCSI-RS-ResourcesToAverage Not present  
quantityConfigIndex 1  
offsetMO SEQUENCE {  
rsrpOffsetSSB dB0  
rsrqOffsetSSB dB0  
sinrOffsetSSB dB0  
rsrpOffsetCSI-RS dB0  
rsrqOffsetCSI-RS dB0  
sinrOffsetCSI-RS dB0  
}  
cellsToRemoveList Not present  
cellsToAddModList Not present  
excludedCellsToRemoveList Not present  
excludedCellsToAddModList Not present  
allowedCellsToRemoveList Not present  
allowedCellsToAddModList Not present  
freqBandIndicatorNR Not present  
measCycleSCell Not present  
smtc3list-r16 Not present  
rmtc-Config-r16 Not present  
t312-r16 Not present  
associatedMeasGapSSB-r17 Not present  
associatedMeasGapCSIRS-r17 Not present  
smtc4list-r17 Not present  
measCyclePSCell-r17 Not present  
cellsToAddModListExt-v1710 Not present  
associatedMeasGapSSB2-v1720 Not present  
associatedMeasGapCSIRS2-v1720 Not present  
}
* * *
### 8.3.2 RRC message contents for UL-SRS Configuration
Table 8.3.2-1: RRCReconfiguration
* * *
Derivation Path: TS 38.508-1, table 4.6.1-3  
Information Element Value/remark Comment Condition RRCReconfiguration ::=
SEQUENCE {  
criticalExtensions CHOICE {  
rrcReconfiguration SEQUENCE {  
radioBearerConfig  
nonCriticalExtension SEQUENCE {  
masterCellGroup CellGroupConfig  
}  
}  
}
* * *
Table 8.3.2-2: _CellGroupConfig_
* * *
Derivation Path: 38.508-1 [30], Table 4.6.3-19  
Information Element Value/remark Comment Condition CellGroupConfig ::=
SEQUENCE {  
spCellConfig SEQUENCE {  
spCellConfigDedicated SEQUENCE {  
uplinkConfig SEQUENCE {  
initialUplinkBWP SEQUENCE {  
srs-Config CHOICE {  
setup srs-Config  
}  
}  
}  
}  
}  
}
* * *
Table 8.3.2-3: SRS-Config
* * *
Derivation Path: TS 38.331, clause 6.3.2  
Information Element Value/remark Comment Condition SRS-Config ::= SEQUENCE {  
srs-PosResourceSetToReleaseList-r16 Not present  
srs-PosResourceSetToAddModList-r16 SEQUENCE (SIZE(1..maxNrofSRS-
PosResourceSets-r16)) OF SRS-PosResourceSet-r16 { 1 entry  
SRS-PosResourceSet-r16[1] SEQUENCE { entry 1  
srs-PosResourceSetId-r16 0  
srs-PosResourceIdList-r16 SEQUENCE (SIZE(1..maxNrofSRS-ResourcesPerSet)) OF
SRS-PosResourceId-r16 { 1 entry  
SRS-PosResourceId-r16[1] 0 entry 1  
}  
resourceType-r16 CHOICE {  
periodic-r16 SEQUENCE {  
}  
alpha-r16 Not present  
p0-r16 -100  
pathlossReferenceRS-Pos-r16 CHOICE {  
ssb-IndexServing-r16 1 Set according to Table 4.4.2-2 in TS 38.508-1.  
}  
}  
srs-PosResourceToReleaseList-r16 Not present  
srs-PosResourceToAddModList-r16 SEQUENCE (SIZE(1..maxNrofSRS-
PosResources-r16)) OF SRS-PosResource-r16 { 1 entry  
SRS-PosResource-r16[1] SRS-PosResource-r16 entry 1  
}  
}
* * *
Table 8.3.2-4: SRS-PosResource-r16
* * *
Derivation Path: TS 38.331, clause 6.3.2  
Information Element Value/remark Comment Condition SRS-
PosResource-r16::=SEQUENCE {  
srs-PosResourceId-r16 0  
transmissionComb-r16 CHOICE {  
n4-r16 SEQUENCE {  
combOffset-n4-r16 0  
cyclicShift-n4-r16 0  
}  
}  
resourceMapping-r16 SEQUENCE {  
startPosition-r16 1  
nrofSymbols-r16 n2  
}  
freqDomainShift-r16 0  
freqHopping-r16 SEQUENCE {  
c-SRS-r16 0  
}  
groupOrSequenceHopping-r16 neither  
resourceType-r16 CHOICE {  
periodic-r16 SEQUENCE {  
periodicityAndOffset-p-r16 CHOICE {  
sl160 20 FR1 23 FR1 AND (HD_FDD OR TDD) AND SCS15Khz 27 FR1 AND TDD AND
SCS30Khz sl1280 163 FR2 }  
}  
}  
sequenceId-r16 0  
spatialRelationInfoPos-r16 CHOICE {  
servingRS-r16 SEQUENCE {  
servingCellId 0  
referenceSignal-r16 CHOICE {  
ssb-IndexServing-r16 1 Set according to Table 4.4.2-2 in TS 38.508-1.  
}  
}  
}  
}
* * *
* * *
**Condition** **Explanation** HD_FDD pc_halfDuplexFDD_TypeA_RedCap_r17 (i.e
HD_FDD UE are performing test on FDD band)
* * *
## 8.4 Default LPP message and information elements contents
The default values of LPP messages and information elements used, unless
indicated otherwise in specific clauses of this specification are as defined
in clause 5.4 with the following exceptions:
#### \- LPP PROVIDE ASSISTANCE DATA
_Table 8.4-1:_ ProvideAssistanceData
+----------------+----------------+----------------+----------------+ | Derivation | | | | | Path: 37.355 | | | | | clause 6.2 | | | | +----------------+----------------+----------------+----------------+ | Information | Value/remark | Comment | Condition | | Element | | | | +----------------+----------------+----------------+----------------+ | LPP-Message | | | | | ::= SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | transactionID | Dependent on | | | | SEQUENCE { | test case. | | | +----------------+----------------+----------------+----------------+ | initiator | | | | +----------------+----------------+----------------+----------------+ | tra | | | | | nsactionNumber | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | endTransaction | TRUE | | | +----------------+----------------+----------------+----------------+ | sequenceNumber | Not present | | | +----------------+----------------+----------------+----------------+ | a | Not present | | | | cknowledgement | | | | +----------------+----------------+----------------+----------------+ | l | | | | | pp-MessageBody | | | | | CHOICE { | | | | +----------------+----------------+----------------+----------------+ | c1 CHOICE { | | | | +----------------+----------------+----------------+----------------+ | provide | | | | | AssistanceData | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | crit | | | | | icalExtensions | | | | | CHOICE { | | | | +----------------+----------------+----------------+----------------+ | c1 CHOICE { | | | | +----------------+----------------+----------------+----------------+ | provideAss | | | | | istanceData-r9 | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | co | Not present | | | | mmonIEsProvide | | | | | AssistanceData | | | | +----------------+----------------+----------------+----------------+ | a-gnss-Provide | | | Sub-tests 7 | | AssistanceData | | | and 15 only; | | SEQUENCE { | | | and as defined | | | | | in Table | | | | | 5.4.1.1-1. | +----------------+----------------+----------------+----------------+ | gnss-Co | | | | | mmonAssistData | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | gnss | As defined in | | | | -ReferenceTime | 37.571-5 | | | | | [12] | | | +----------------+----------------+----------------+----------------+ | gnss-Ref | As defined in | | | | erenceLocation | 37.571-5 | | | | | [12] | | | +----------------+----------------+----------------+----------------+ | gnss-Io | As defined in | | | | nosphericModel | 37.571-5 | | | | | [12] | | | +----------------+----------------+----------------+----------------+ | gns | Not present | | | | s-EarthOrienta | | | | | tionParameters | | | | +----------------+----------------+----------------+----------------+ | gnss- | Not present | Rel-15 onwards | | | RTK-ReferenceS | | | | | tationInfo-r15 | | | | +----------------+----------------+----------------+----------------+ | gnss-R | Not present | Rel-15 onwards | | | TK-CommonObser | | | | | vationInfo-r15 | | | | +----------------+----------------+----------------+----------------+ | gnss- | Not present | Rel-15 onwards | | | RTK-AuxiliaryS | | | | | tationData-r15 | | | | +----------------+----------------+----------------+----------------+ | g | Not present | Rel-16 onwards | | | nss-SSR-Correc | | | | | tionPoints-r16 | | | | +----------------+----------------+----------------+----------------+ | gnss-Int | Not present | Rel-17 onwards | | | egrity-Service | | | | | Parameters-r17 | | | | +----------------+----------------+----------------+----------------+ | gns | Not present | Rel-17 onwards | | | s-Integrity-Se | | | | | rviceAlert-r17 | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | gnss-Gene | SIZE is | | | | ricAssistData( | dependent on | | | | SIZE(1..4))OF{ | the number of | | | | | GNSSs | | | | | supported by | | | | | the UE. | | | | | | | | | | If one GNSS | | | | | supported by | | | | | the UE, SIZE = | | | | | 1 | | | | | | | | | | If two GNSSs | | | | | supported by | | | | | the UE, SIZE = | | | | | 2 | | | | | | | | | | If three GNSSs | | | | | supported by | | | | | the UE, SIZE = | | | | | 3 | | | | | | | | | | If four GNSSs | | | | | supported by | | | | | the UE, SIZE = | | | | | 4 | | | +----------------+----------------+----------------+----------------+ | gnss-ID | For each GNSS | | | | | supported by | | | | | the UE. | | | +----------------+----------------+----------------+----------------+ | sbas-ID | Not present | | | +----------------+----------------+----------------+----------------+ | g | As defined in | | | | nss-TimeModels | 37.571-5 | | | | | [12] | | | +----------------+----------------+----------------+----------------+ | gnss-Different | Not present | | | | ialCorrections | | | | +----------------+----------------+----------------+----------------+ | gnss-N | As defined in | | | | avigationModel | 37.571-5 | | | | | [12] | | | +----------------+----------------+----------------+----------------+ | gnss-Rea | Not present | | | | lTimeIntegrity | | | | +----------------+----------------+----------------+----------------+ | gnss-Dat | Not present | | | | aBitAssistance | | | | +----------------+----------------+----------------+----------------+ | gnss-Acquisi | As defined in | | | | tionAssistance | 37.571-5 | | | | | [12] | | | +----------------+----------------+----------------+----------------+ | gnss-Almanac | As defined in | | | | | 37.571-5 | | | | | [12] | | | +----------------+----------------+----------------+----------------+ | gnss-UTC-Model | As defined in | | | | | 37.571-5 | | | | | [12] | | | +----------------+----------------+----------------+----------------+ | gnss-Auxili | As defined in | | | | aryInformation | 37.571-5 | | | | | [12] | | | +----------------+----------------+----------------+----------------+ | bds | Not present | Rel-12 onwards | | | -DifferentialC | | | | | orrections-r12 | | | | +----------------+----------------+----------------+----------------+ | bds | Not present | Rel-12 onwards | | | -GridModel-r12 | | | | +----------------+----------------+----------------+----------------+ | gnss-RTK-Ob | Not present | Rel-15 onwards | | | servations-r15 | | | | +----------------+----------------+----------------+----------------+ | glo-RTK-BiasI | Not present | Rel-15 onwards | | | nformation-r15 | | | | +----------------+----------------+----------------+----------------+ | gnss-RTK-M | Not present | Rel-15 onwards | | | AC-CorrectionD | | | | | ifferences-r15 | | | | +----------------+----------------+----------------+----------------+ | gnss-RTK | Not present | Rel-15 onwards | | | -Residuals-r15 | | | | +----------------+----------------+----------------+----------------+ | gnss-RTK-FKP | Not present | Rel-15 onwards | | | -Gradients-r15 | | | | +----------------+----------------+----------------+----------------+ | g | Not present | Rel-15 onwards | | | nss-SSR-OrbitC | | | | | orrections-r15 | | | | +----------------+----------------+----------------+----------------+ | g | Not present | Rel-15 onwards | | | nss-SSR-ClockC | | | | | orrections-r15 | | | | +----------------+----------------+----------------+----------------+ | gnss-SS | Not present | Rel-15 onwards | | | R-CodeBias-r15 | | | | +----------------+----------------+----------------+----------------+ | gn | Not present | Rel-16 onwards | | | ss-SSR-URA-r16 | | | | +----------------+----------------+----------------+----------------+ | gnss-SSR | Not present | Rel-16 onwards | | | -PhaseBias-r16 | | | | +----------------+----------------+----------------+----------------+ | gnss-SSR-STEC- | Not present | Rel-16 onwards | | | Correction-r16 | | | | +----------------+----------------+----------------+----------------+ | gn | Not present | Rel-16 onwards | | | ss-SSR-Gridded | | | | | Correction-r16 | | | | +----------------+----------------+----------------+----------------+ | navic | Not present | Rel-16 onwards | | | -DifferentialC | | | | | orrections-r16 | | | | +----------------+----------------+----------------+----------------+ | navic | Not present | Rel-16 onwards | | | -GridModel-r16 | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | gnss-Error | Not present | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | otdoa-Provide | | | Sub-tests 5 | | AssistanceData | | | and 7 only | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | otdoa-Ref | As defined in | | | | erenceCellInfo | Table | | | | | 8.4.1.2-1 | | | +----------------+----------------+----------------+----------------+ | otdoa-Nei | As defined in | | | | ghbourCellInfo | Table | | | | | 8.4.1.2-2 | | | +----------------+----------------+----------------+----------------+ | otdoa-Error | Not present | | | +----------------+----------------+----------------+----------------+ | o | Not present | Rel-14 onwards | | | tdoa-Reference | | | | | CellInfoNB-r14 | | | | +----------------+----------------+----------------+----------------+ | o | Not present | Rel-14 onwards | | | tdoa-Neighbour | | | | | CellInfoNB-r14 | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | epdu-Provide- | Not present | | | | AssistanceData | | | | +----------------+----------------+----------------+----------------+ | sens | | Rel-14 onwards | Sub-test 18 | | or-ProvideAssi | | | only as | | stanceData-r14 | | | defined in | | SEQUENCE { | | | clause 5.4.1.5 | +----------------+----------------+----------------+----------------+ | s | As defined in | | | | ensor-Assistan | Table | | | | ceDataList-r14 | 5.4.1.5-2 | | | +----------------+----------------+----------------+----------------+ | se | Not present | | | | nsor-Error-r14 | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | t | | Rel-14 onwards | Sub-test 16 | | bs-ProvideAssi | | | only as | | stanceData-r14 | | | defined in | | SEQUENCE { | | | clause5.4.1.3 | +----------------+----------------+----------------+----------------+ | tbs-Assistan | | | | | ceDataList-r14 | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | mbs-Assistan | | | | | ceDataList-r14 | | | | | SEQUENCE | | | | | | | | | | (SIZE(1..n)) | | | | | OF SEQUENCE{ | | | | +----------------+----------------+----------------+----------------+ | mbs-Almanac | As defined in | | | | Assistance-r14 | Table | | | | | 5.4.1.3-2 | | | +----------------+----------------+----------------+----------------+ | mbs-Acquisiton | As defined in | | | | Assistance-r14 | Table | | | | | 5.4.1.3-2 | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | tbs-Error-r14 | Not present | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | wl | | Rel-14 onwards | Sub-test 17 | | an-ProvideAssi | | | only as | | stanceData-r14 | | | defined in | | SEQUENCE { | | | clause 5.4.1.4 | +----------------+----------------+----------------+----------------+ | wl | As defined in | | | | an-DataSet-r14 | Table | | | | | 5.4.1.4-2 | | | +----------------+----------------+----------------+----------------+ | wlan-Error-r14 | Not present | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | nr-Multi-R | | Rel-16 onwards | Sub-test 19 | | TT-ProvideAssi | | | and Sub-test | | stanceData-r16 | | | 26 | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | nr-DL-PRS-Assi | As defined in | | | | stanceData-r16 | Table | | | | | _8.4.1.6-1_ | | | +----------------+----------------+----------------+----------------+ | nr- | As defined in | | | | SelectedDL-PRS | Table | | | | -IndexList-r16 | _8.4.1.6-2_ | | | +----------------+----------------+----------------+----------------+ | nr-Multi | Not present | | | | -RTT-Error-r16 | | | | +----------------+----------------+----------------+----------------+ | nr-On-Dema | Not present | Rel-17 onwards | | | nd-DL-PRS-Conf | | | | | igurations-r17 | | | | +----------------+----------------+----------------+----------------+ | n | Not present | Rel-17 onwards | | | r-On-Demand-DL | | | | | -PRS-Configura | | | | | tions-Selected | | | | | -IndexList-r17 | | | | +----------------+----------------+----------------+----------------+ | as | Not present | Rel-17 onwards | | | sistanceDataVa | | | | | lidityArea-r17 | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | nr-DL-A | | Rel-16 onwards | Sub-test 20 | | oD-ProvideAssi | | | and Sub-test | | stanceData-r16 | | | 27 | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | nr-DL-PRS-Assi | As defined in | | | | stanceData-r16 | Table | | | | | _8.4.1.6-1_ | | | +----------------+----------------+----------------+----------------+ | nr- | As defined in | | | | SelectedDL-PRS | Table | | | | -IndexList-r16 | _8.4.1.6-2_ | | | +----------------+----------------+----------------+----------------+ | nr-Posit | Present or not | | | | ionCalculation | present | | | | Assistance-r16 | dependent on | | | | | pc\ | | | | | _UEB_DL_AoD. | | | | | As defined in | | | | | Table | | | | | _8.4.1.7-1_ | | | +----------------+----------------+----------------+----------------+ | nr-DL | Not present | | | | -AoD-Error-r16 | | | | +----------------+----------------+----------------+----------------+ | nr-DL-PR | Not present | Rel-17 onwards | | | S-BeamInfo-r17 | | | | +----------------+----------------+----------------+----------------+ | nr-On-Dema | Not present | Rel-17 onwards | | | nd-DL-PRS-Conf | | | | | igurations-r17 | | | | +----------------+----------------+----------------+----------------+ | n | Not present | Rel-17 onwards | | | r-On-Demand-DL | | | | | -PRS-Configura | | | | | tions-Selected | | | | | -IndexList-r17 | | | | +----------------+----------------+----------------+----------------+ | as | Not present | Rel-17 onwards | | | sistanceDataVa | | | | | lidityArea-r17 | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | nr-DL-TD | | Rel-16 onwards | Sub-test 21 | | OA-ProvideAssi | | | and Sub-test | | stanceData-r16 | | | 28 | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | nr-DL-PRS-Assi | As defined in | | | | stanceData-r16 | Table | | | | | _8.4.1.6-1_ | | | +----------------+----------------+----------------+----------------+ | nr- | As defined in | | | | SelectedDL-PRS | Table | | | | -IndexList-r16 | _8.4.1.6-2_ | | | +----------------+----------------+----------------+----------------+ | nr-Posit | Present or not | | | | ionCalculation | present | | | | Assistance-r16 | dependent on | | | | | pc_ | | | | | UEB_DL_TDOA. | | | | | As defined in | | | | | Table | | | | | _8.4.1.7-1_ | | | +----------------+----------------+----------------+----------------+ | nr-DL- | Not present | | | | TDOA-Error-r16 | | | | +----------------+----------------+----------------+----------------+ | nr-On-Dema | Not present | Rel-17 onwards | | | nd-DL-PRS-Conf | | | | | igurations-r17 | | | | +----------------+----------------+----------------+----------------+ | n | Not present | Rel-17 onwards | | | r-On-Demand-DL | | | | | -PRS-Configura | | | | | tions-Selected | | | | | -IndexList-r17 | | | | +----------------+----------------+----------------+----------------+ | as | Not present | Rel-17 onwards | | | sistanceDataVa | | | | | lidityArea-r17 | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+
#### \- LPP REQUEST CAPABILITIES
Table 8.4-2: RequestCapabilities
+-----------------+----------------+-----------------+-----------+ | Derivation | | | | | Path: 37.355 | | | | | clause 6.2 | | | | +-----------------+----------------+-----------------+-----------+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+----------------+-----------------+-----------+ | LPP-Message ::= | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | transactionID | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | Initiator | locationServer | | | +-----------------+----------------+-----------------+-----------+ | tr | (0..255) | | | | ansactionNumber | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | endTransaction | FALSE | | | +-----------------+----------------+-----------------+-----------+ | sequenceNumber | Not present | | | +-----------------+----------------+-----------------+-----------+ | acknowledgement | Not present | | | +-----------------+----------------+-----------------+-----------+ | lpp-MessageBody | | | | | CHOICE { | | | | +-----------------+----------------+-----------------+-----------+ | c1 CHOICE { | | | | +-----------------+----------------+-----------------+-----------+ | requ | | | | | estCapabilities | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | cri | | | | | ticalExtensions | | | | | CHOICE { | | | | +-----------------+----------------+-----------------+-----------+ | c1 CHOICE { | | | | +-----------------+----------------+-----------------+-----------+ | request | | | | | Capabilities-r9 | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | commonIEsRequ | Present | Rel-14 onwards | | | estCapabilities | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | lp | 00 | Server is not | | | p-message-segme | | able to send | | | ntation-req-r14 | | segmented LPP | | | | | messages. | | | | | Server is not | | | | | able to receive | | | | | segmented LPP | | | | | messages. | | | | | | | | | | Rel-14 onwards | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | a-gnss-Requ | | | | | estCapabilities | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | gnss | TRUE | | | | -SupportListReq | | | | +-----------------+----------------+-----------------+-----------+ | assistanceDat | TRUE | | | | aSupportListReq | | | | +-----------------+----------------+-----------------+-----------+ | locationV | TRUE | | | | elocityTypesReq | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | otdoa-Requ | Present | | | | estCapabilities | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | ecid-Requ | Present | | | | estCapabilities | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | epdu-Requ | Not present | | | | estCapabilities | | | | +-----------------+----------------+-----------------+-----------+ | sensor-RequestC | Present | Rel-13 onwards | | | apabilities-r13 | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | tbs-RequestC | Present | Rel-13 onwards | | | apabilities-r13 | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | wlan-RequestC | Present | Rel-13 onwards | | | apabilities-r13 | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | bt-RequestC | Present | Rel-13 onwards | | | apabilities-r13 | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | n | Present | Rel-16 onwards | | | r-ECID-RequestC | | | | | apabilities-r16 | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | nr-Mul | Present | Rel-16 onwards | | | ti-RTT-RequestC | | | | | apabilities-r16 | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | nr- | Present | Rel-16 onwards | | | DL-AoD-RequestC | | | | | apabilities-r16 | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | nr-D | Present | Rel-16 onwards | | | L-TDOA-RequestC | | | | | apabilities-r16 | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | nr-UL-RequestC | Present | Rel-16 onwards | | | apabilities-r16 | | | | | SEQUENCE { | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+ | } | | | | +-----------------+----------------+-----------------+-----------+
#### \- LPP REQUEST LOCATION INFORMATION
_Tab_ le 8.4-3: RequestLocationInformation
+----------------+----------------+----------------+----------------+ | Derivation | | | | | Path: 37.355 | | | | | clause 6.2 | | | | +----------------+----------------+----------------+----------------+ | Information | Value/remark | Comment | Condition | | Element | | | | +----------------+----------------+----------------+----------------+ | LPP-Message | | | | | ::= SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | transactionID | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | initiator | locationServer | | | +----------------+----------------+----------------+----------------+ | tra | (0..255) | | | | nsactionNumber | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | endTransaction | FALSE | | | +----------------+----------------+----------------+----------------+ | sequenceNumber | Not present | | | +----------------+----------------+----------------+----------------+ | a | Not present | | | | cknowledgement | | | | +----------------+----------------+----------------+----------------+ | l | | | | | pp-MessageBody | | | | | CHOICE { | | | | +----------------+----------------+----------------+----------------+ | c1 CHOICE { | | | | +----------------+----------------+----------------+----------------+ | requestLocat | | | | | ionInformation | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | crit | | | | | icalExtensions | | | | | CHOICE { | | | | +----------------+----------------+----------------+----------------+ | c1 CHOICE { | | | | +----------------+----------------+----------------+----------------+ | r | | | | | equestLocation | | | | | Information-r9 | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | commonI | | | | | EsRequestLocat | | | | | ionInformation | | | | | | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | locationI | Dependent on | | | | nformationType | test case | | | +----------------+----------------+----------------+----------------+ | trig | Not present | | | | geredReporting | | | | +----------------+----------------+----------------+----------------+ | perio | Not present | | | | dicalReporting | | | | +----------------+----------------+----------------+----------------+ | additio | on | | | | nalInformation | lyReturnInform | | | | | ationRequested | | | +----------------+----------------+----------------+----------------+ | qos SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | hori | Not present | | | | zontalAccuracy | | | | +----------------+----------------+----------------+----------------+ | verticalCoo | FALSE | | | | rdinateRequest | | | | +----------------+----------------+----------------+----------------+ | ve | Not present | | | | rticalAccuracy | | | | +----------------+----------------+----------------+----------------+ | responseTime | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | time | 32 | | | +----------------+----------------+----------------+----------------+ | responseTi | Not present | Rel-12 onwards | | | meEarlyFix-r12 | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | v | FALSE | | | | elocityRequest | | | | +----------------+----------------+----------------+----------------+ | messageS | Not present | Rel-14 onwards | | | izeLimitNB-r14 | | | | +----------------+----------------+----------------+----------------+ | segmen | Not present | Rel-14 onwards | | | tationInfo-r14 | | | | +----------------+----------------+----------------+----------------+ | scheduledLo | Not present | Rel-17 onwards | | | cationTime-r17 | | | | +----------------+----------------+----------------+----------------+ | targetInt | Not present | Rel-17 onwards | | | egrityRisk-r17 | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | environment | Not present | | | +----------------+----------------+----------------+----------------+ | locationC | Not present | | | | oordinateTypes | | | | +----------------+----------------+----------------+----------------+ | velocityTypes | Not present | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | a-gns | As defined in | | Sub-tests 7 | | s-RequestLocat | Table 5.4-4 | | and 15 | | ionInformation | | | | +----------------+----------------+----------------+----------------+ | otdo | As defined in | | Sub-test 5 and | | a-RequestLocat | Table 5.4-5 | | 7 | | ionInformation | | | | +----------------+----------------+----------------+----------------+ | eci | As defined in | | Sub-test 6 | | d-RequestLocat | Table 5.4-6 | | | | ionInformation | | | | +----------------+----------------+----------------+----------------+ | epd | Not Present | | | | u-RequestLocat | | | | | ionInformation | | | | +----------------+----------------+----------------+----------------+ | sensor-Re | As defined in | Rel-13 onwards | Sub-test 14, | | questLocationI | Table 5.4-10 | | 18 | | nformation-r13 | | | | +----------------+----------------+----------------+----------------+ | tbs-Re | As defined in | Rel-13 onwards | Sub-tests 12, | | questLocationI | Table 5.4-7 | | 16 | | nformation-r13 | | | | +----------------+----------------+----------------+----------------+ | wlan-Re | As defined in | Rel-13 onwards | Sub-test 11, | | questLocationI | Table 5.4-8 | | 17 | | nformation-r13 | | | | +----------------+----------------+----------------+----------------+ | bt-Re | As defined in | Rel-13 onwards | Sub-test 13 | | questLocationI | Table 5.4-9 | | | | nformation-r13 | | | | +----------------+----------------+----------------+----------------+ | nr-ECID-Re | As defined in | Rel-16 onwards | Sub-test 22 | | questLocationI | Table 8.4-4 | | | | nformation-r16 | | | | +----------------+----------------+----------------+----------------+ | n | As defined in | Rel-16 onwards | Sub-test 19 | | r-Multi-RTT-Re | Table 8.4-5 | | and Sub-test | | questLocationI | | | 26 | | nformation-r16 | | | | +----------------+----------------+----------------+----------------+ | nr-DL-AoD-Re | As defined in | Rel-16 onwards | Sub-test 20 | | questLocationI | Table 8.4-6 | | and Sub-test | | nformation-r16 | | | 27 | +----------------+----------------+----------------+----------------+ | nr-DL-TDOA-Re | As defined in | Rel-16 onwards | Sub-test 21 | | questLocationI | Table 8.4-7 | | and Sub-test | | nformation-r16 | | | 28 | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+
#### \- NR E-CID REQUEST LOCATION INFORMATION
_Table 8.4-4:_ NR-ECID-RequestLocationInformation
* * *
Derivation Path: 37.355 clause 6.5.9.3  
Information Element Value/remark Comment Condition NR-ECID-
RequestLocationInformation-r16 ::= SEQUENCE {  
requestedMeasurements-r16 All measurements supported by the UE  
}
* * *
#### \- NR Multi-RTT REQUEST LOCATION INFORMATION
_Table 8.4-5:_ NR-Multi-RTT-RequestLocationInformation
* * *
Derivation Path: 37.355 clause 6.5.12.5  
Information Element Value/remark Comment Condition NR-Multi-RTT-
RequestLocationInformation-r16 ::= SEQUENCE {  
nr-UE-RxTxTimeDiffMeasurementInfoRequest-r16 Not present  
nr-RequestedMeasurements-r16 bit 0 = 1 (prsrsrpReq)  
nr-AssistanceAvailability-r16 FALSE  
nr-Multi-RTT-ReportConfig-r16 SEQUENCE {  
maxDL-PRS-RxTxTimeDiffMeasPerTRP-r16 Not present  
timingReportingGranularityFactor-r16 Not present  
}  
additionalPaths-r16 Not present  
nr-UE-RxTxTEG-Request-r17 Not present Rel-17 onwards  
measureSameDL-PRS-ResourceWithDifferentRxTxTEGs-r17 Not present Rel-17 onwards  
measureSameDL-PRS-ResourceWithDifferentRxTEGs-r17 Not present Rel-17 onwards  
reducedDL-PRS-ProcessingSamples-r17 Not present Rel-17 onwards  
nr-los-nlos-IndicatorRequest-r17 Not present Rel-17 onwards  
additionalPathsExt-r17 Not present Rel-17 onwards  
additionalPathsDL-PRS-RSRP-Request-r17 Not present Rel-17 onwards  
multiMeasInSameReport-r17 Not present Rel-17 onwards  
lowerRxBeamSweepingFactor-FR2-r17 Not present Rel-17 onwards  
}
* * *
#### \- NR DL-AoD REQUEST LOCATION INFORMATION
_Table 8.4-6:_ NR-DL-AoD-RequestLocationInformation
* * *
Derivation Path: 37.355 clause 6.5.11.5  
Information Element Value/remark Comment Condition NR-DL-AoD-
RequestLocationInformation-r16 ::= SEQUENCE {  
nr-AssistanceAvailability-r16 FALSE  
nr-DL-AoD-ReportConfig-r16 SEQUENCE {  
maxDL-PRS-RSRP-MeasurementsPerTRP-r16 Not present  
maxDL-PRS-RSRP-MeasurementsPerTRP-r17 Not present Rel-17 onwards  
maxDL-PRS-RSRPP-MeasurementsPerTRP-r17 Not present Rel-17 onwards  
nr-los-nlos-IndicatorRequest-r17 Not present Rel-17 onwards  
reducedDL-PRS-ProcessingSamples-r17 Not present Rel-17 onwards  
lowerRxBeamSweepingFactor-FR2-r17 Not present Rel-17 onwards  
}  
multiMeasInSameReport-r17 Not present Rel-17 onwards  
}
* * *
#### \- NR DL-TDOA REQUEST LOCATION INFORMATION
Table 8.4-7: NR-DL-TDOA-RequestLocationInformation
* * *
Derivation Path: 37.355 clause 6.5.10.5  
Information Element Value/remark Comment Condition NR-DL-TDOA-
RequestLocationInformation-r16 ::= SEQUENCE {  
nr-DL-PRS-RstdMeasurementInfoRequest-r16 Not present  
nr-RequestedMeasurements-r16 bit 0 = 1 (prsrsrpReq)  
nr-AssistanceAvailability-r16 FALSE  
nr-DL-TDOA-ReportConfig-r16 SEQUENCE {  
maxDL-PRS-RSTD-MeasurementsPerTRPPair-r16 Not present  
timingReportingGranularityFactor-r16 Not present  
measureSameDL-PRS-ResourceWithDifferentRxTEGs-r17 Not present Rel-17 onwards  
reducedDL-PRS-ProcessingSamples-r17 Not present Rel-17 onwards  
lowerRxBeamSweepingFactor-FR2-r17 Not present Rel-17 onwards  
}  
additionalPaths-r16 Not present  
nr-UE-RxTEG-Request-r17 Not present Rel-17 onwards  
nr-los-nlos-IndicatorRequest-r17 Not present Rel-17 onwards  
additionalPathsExt-r17 Not present Rel-17 onwards  
additionalPathsDL-PRS-RSRP-Request-r17 Not present Rel-17 onwards  
multiMeasInSameReport-r17 Not present Rel-17 onwards  
}
* * *
### 8.4.1 Default assistance data information elements
#### 8.4.1.1 GNSS Assistance Data Elements
The GNSS assistance data elements which shall be provided to the UE in the
tests in LPP Provide Assistance Data messages in the absence of a
corresponding LPP Request Assistance Data message are as defined in clause
5.4.1.1.
#### 8.4.1.2 OTDOA (LTE) Assistance Data Elements
This clause defines the OTDOA (LTE) assistance data elements which shall be
provided to the UE in the tests in LPP Provide Assistance Data messages.
#### \- OTDOA (LTE) REFERENCE CELL INFO
_Table 8.4.1.2-1:_ OTDOA-ReferenceCellInfo
+----------------+----------------+----------------+----------------+ | Derivation | | | | | Path: 37.355 | | | | | clause 6.5.1.2 | | | | +----------------+----------------+----------------+----------------+ | Information | Value/remark | Comment | Condition | | Element | | | | +----------------+----------------+----------------+----------------+ | OTDOA-Ref | | LTE Cell 1 | | | erenceCellInfo | | | | | ::= SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | physCellId | 0 | | | +----------------+----------------+----------------+----------------+ | cellGlobalId | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | mcc | As defined for | | | | | Cell 1 in | | | | | 36.508 [8] | | | +----------------+----------------+----------------+----------------+ | mnc | As defined for | | | | | Cell 1 in | | | | | 36.508 [8] | | | +----------------+----------------+----------------+----------------+ | cellidentity | As defined for | | | | | E-UTRAN Cell | | | | | Identifier for | | | | | Cell 1 in | | | | | 36.508 [8] | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | earfcnRef | As defined for | | | | | Cell 1 in | | | | | 36.508 [8] | | | +----------------+----------------+----------------+----------------+ | ant | As defined for | | | | ennaPortConfig | Cell 1 in | | | | | 36.508 [8] | | | +----------------+----------------+----------------+----------------+ | cpLength | Normal | | | +----------------+----------------+----------------+----------------+ | prsInfo | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | prs-Bandwidth | PRS are | | | | | transmitted | | | | | over the used | | | | | system | | | | | bandwidth (see | | | | | clause 5.2.2) | | | +----------------+----------------+----------------+----------------+ | prs-Conf | FDD: 2 | | | | igurationIndex | | | | | | TDD: 4 | | | +----------------+----------------+----------------+----------------+ | numDL-Frames | sf-1 | | | +----------------+----------------+----------------+----------------+ | prs | Not present | PRS muting is | | | -MutingInfo-r9 | | not used. | | +----------------+----------------+----------------+----------------+ | prsID-r14 | Not present | PRS-ID not | Rel-14 onwards | | | | used | | +----------------+----------------+----------------+----------------+ | add-nu | Not present | Not required | Rel-14 onwards | | mDL-Frames-r14 | | | | +----------------+----------------+----------------+----------------+ | prsO | Not present | No PRS | Rel-14 onwards | | ccGroupLen-r14 | | occasion group | | | | | configured | | +----------------+----------------+----------------+----------------+ | prsH | Not present | PRS frequency | Rel-14 onwards | | oppingInfo-r14 | | hopping not | | | | | used | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | earfcnRef-v9a0 | As defined for | | | | | Cell 1 in | | | | | 36.508 [8] | | | +----------------+----------------+----------------+----------------+ | tpId-r14 | Not present | Transmission | Rel-14 onwards | | | | Points not | | | | | used | | +----------------+----------------+----------------+----------------+ | c | Normal | | Rel-14 onwards | | pLengthCRS-r14 | | | | +----------------+----------------+----------------+----------------+ | sameMBSF | FALSE | Not the same | Rel-14 onwards | | NconfigRef-r14 | | as the serving | | | | | cell | | +----------------+----------------+----------------+----------------+ | d | Not present | PRS frequency | Rel-14 onwards | | lBandwidth-r14 | | hopping not | | | | | used | | +----------------+----------------+----------------+----------------+ | addPR | Not present | **_No | Rel-14 onwards | | SconfigRef-r14 | | additional PRS | | | | | confi | | | | | guration(s)_** | | +----------------+----------------+----------------+----------------+ | nr-LTE- | Not present | | Rel-15 onwards | | SFN-Offset-r15 | | | | +----------------+----------------+----------------+----------------+ | td | Not present | | Rel-15 onwards | | d-config-v1520 | | | | +----------------+----------------+----------------+----------------+ | nr-LTE-fineTim | Not present | | Rel-15 onwards | | ing-Offset-r15 | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+
#### \- OTDOA (LTE) NEIGHBOUR CELL INFO LIST
_Table 8.4.1.2-2:_ OTDOA-NeighbourCellInfoList
* * *
Derivation Path: 37.355 clause 6.5.1.2  
Information Element Value/remark Comment Condition OTDOA-NeighbourCellInfoList
::= SEQUENCE (SIZE(1)) OF SEQUENCE {  
SEQUENCE (SIZE(2)) OF SEQUENCE { Cell 2  
physCellId 2  
cellGlobalId SEQUENCE {  
mcc As defined for Cell 2 in 36.508 [8]  
mnc As defined for Cell 2 in 36.508 [8]  
cellidentity As defined for E-UTRAN Cell Identifier for Cell 2 in 36.508 [8]  
}  
earfcn Not present Same as for the reference cell  
cpLength Not present Same as for the reference cell  
prsInfo Not present Same as for the reference cell  
antennaPortConfig Not present Same as for the reference cell  
slotNumberOffset Not present Slot timing is the same as for reference cell  
prs-SubframeOffset Not present  
expectedRSTD 8192 Value 0  
expectedRSTD-Uncertainty 10 About 1 μs  
earfcn-v9a0 Not present Same as for the reference cell  
tpId-r14 Not present Transmission Points not used Rel-14 onwards prs-only-
tp-r14 Not present Not required Rel-14 onwards cpLengthCRS-r14 Not present Not
required Rel-14 onwards sameMBSFNconfigNeighbour-r14 TRUE Same as for the
reference cell Rel-14 onwards dlBandwidth-r14 Not present Same as for the
reference cell and PRS frequency hopping not used Rel-14 onwards
addPRSconfigNeighbour-r14 Not present **_No additional PRS configuration(s)_**
Rel-14 onwards tdd-config-v1520 Not present Rel-15 onwards }  
SEQUENCE { Cell 4  
physCellId 4  
cellGlobalId SEQUENCE {  
mcc As defined for Cell 4 in 36.508 [8]  
mnc As defined for Cell 4 in 36.508 [8]  
cellidentity As defined for E-UTRAN Cell Identifier for Cell 4 in 36.508 [8]  
}  
earfcn Not present Same as for the reference cell  
cpLength Not present Same as for the reference cell  
prsInfo Not present Same as for the reference cell  
antennaPortConfig Not present Same as for the reference cell  
slotNumberOffset Not present Slot timing is the same as for reference cell  
prs-SubframeOffset Not present  
expectedRSTD 8192 Value 0  
expectedRSTD-Uncertainty 10 About 1 μs  
earfcn-v9a0 Not present Same as for the reference cell  
tpId-r14 Not present Transmission Points not used Rel-14 onwards prs-only-
tp-r14 Not present Not required Rel-14 onwards cpLengthCRS-r14 Not present Not
required Rel-14 onwards sameMBSFNconfigNeighbour-r14 TRUE Same as for the
reference cell Rel-14 onwards dlBandwidth-r14 Not present Same as for the
reference cell and PRS frequency hopping not used Rel-14 onwards
addPRSconfigNeighbour-r14 Not present **_No additional PRS configuration(s)_**
Rel-14 onwards tdd-config-v1520 Not present Rel-15 onwards }  
}
* * *
#### 8.4.1.3 MBS Assistance Data Elements
The MBS assistance data elements which shall be provided to the UE in sub-test
16 via LPP Provide Assistance Data messages in the absence of a corresponding
LPP Request Assistance Data message are as defined in clause 5.4.1.3.
#### 8.4.1.4 WLAN Assistance Data Elements
The WLAN assistance data elements which shall be provided to the UE in sub-
test 17 via LPP Provide Assistance Data messages in the absence of a
corresponding LPP Request Assistance Data message are as defined in clause
5.4.1.4.
#### 8.4.1.5 Sensor Assistance Data Elements
The Sensor assistance data elements which shall be provided to the UE in sub-
test 18 via LPP Provide Assistance Data messages in the absence of a
corresponding LPP Request Assistance Data message are as defined in clause
5.4.1.5.
#### 8.4.1.6 Multi-RTT Assistance Data Elements
This clause defines the **_Multi-RTT_** assistance data elements which shall
be provided to the UE in the tests in LPP Provide Assistance Data messages.
#### \- NR DL-PRS ASSISTANCE DATA
_Table 8.4.1.6-1:_ NR-DL-PRS-AssistanceData
* * *
Derivation Path: 37.355 clause 6.4.3  
Information Element Value/remark Comment Condition NR-DL-PRS-
AssistanceData-r16 ::= SEQUENCE {  
nr-DL-PRS-ReferenceInfo-r16 SEQUENCE {  
dl-PRS-ID-r16 0  
nr-DL-PRS-ResourceID-List-r16 Not present  
nr-DL-PRS-ResourceSetID-r16 Not present  
}  
nr-DL-PRS-AssistanceDataList-r16 SEQUENCE (SIZE (1..nrMaxFreqLayers-r16)) OF
NR-DL-PRS-AssistanceDataPerFreq-r16 { 2 entries  
NR-DL-PRS-AssistanceDataPerFreq-r16[1] SEQUENCE { entry 1  
nr-DL-PRS-PositioningFrequencyLayer-r16 SEQUENCE {  
dl-PRS-SubcarrierSpacing-r16 SubcarrierSpacing 38.508-1 [30] Table 4.6.3-188  
dl-PRS-ResourceBandwidth-r16 1 24 PRBs  
dl-PRS-StartPRB-r16 same value as 'offsetToCarrier' as defined for the DL
frequency of NR Cell 1  
dl-PRS-PointA-r16 absoluteFrequencyPointA as defined for the DL frequency of
the NR Cell 1  
dl-PRS-CombSizeN-r16 n2  
dl-PRS-CyclicPrefix-r16 normal  
}  
nr-DL-PRS-AssistanceDataPerFreq-r16 SEQUENCE (SIZE (1..nrMaxTRPsPerFreq-r16))
OF NR-DL-PRS-AssistanceDataPerTRP-r16{ 2 entries  
NR-DL-PRS-AssistanceDataPerTRP-r16[1] SEQUENCE { entry 1  
dl-PRS-ID-r16 0  
nr-PhysCellID-r16 0  
nr-CellGlobalID-r16 SEQUENCE {  
mcc-r15 As defined TS 38.508-1 table 4.4.2-3 for NR Cell 1  
mnc-r15 As defined TS 38.508-1 table 4.4.2-3 for NR Cell 1  
nr-cellidentity-r15 Set to NR Cell 1 Identifier defined in TS 38.508-1 Table
4.4.2-2  
}  
nr-ARFCN-r16 ARFCN-ValueNR for NR Cell 1 frequency  
nr-DL-PRS-SFN0-Offset-r16 SEQUENCE {  
sfn-Offset-r16 0  
integerSubframeOffset-r16 0  
}  
nr-DL-PRS-ExpectedRSTD-r16 0  
nr-DL-PRS-ExpectedRSTD-Uncertainty-r16 4 About 1 μs  
nr-DL-PRS-Info-r16 NR-DL-PRS-Info-r16 as specified in Table 8.4.1.6-3  
nr-DL-PRS-ExpectedAoD-or-AoA-r17 Not present Rel-17 onwards  
prs-OnlyTP-r16 Not present  
}  
NR-DL-PRS-AssistanceDataPerTRP-r16[2] SEQUENCE { entry 2 In case of sub-test
20/27 UE-based DL-AoD or sub-test 21/28 DL-TDOA method supported by the UE as
defined in clause 8.2.10 and clause 8.2.11. dl-PRS-ID-r16 1  
nr-PhysCellID-r16 2  
nr-CellGlobalID-r16 SEQUENCE {  
mcc-r15 As defined TS 38.508-1 table 4.4.2-3 for NR Cell 2  
mnc-r15 As defined TS 38.508-1 table 4.4.2-3 for NR Cell 2  
nr-cellidentity-r15 Set to NR Cell 2 Identifier defined in TS 38.508-1 Table
4.4.2-2  
}  
nr-ARFCN-r16 ARFCN-ValueNR for NR Cell 2  
nr-DL-PRS-SFN0-Offset-r16 SEQUENCE {  
sfn-Offset-r16 0  
integerSubframeOffset-r16 0  
}  
nr-DL-PRS-ExpectedRSTD-r16 0  
nr-DL-PRS-ExpectedRSTD-Uncertainty-r16 4 About 1 μs  
nr-DL-PRS-Info-r16 NR-DL-PRS-Info-r16 as specified in Table 8.4.1.6-3  
prs-OnlyTP-r16 Not present  
nr-DL-PRS-ExpectedAoD-or-AoA-r17 Not present Rel-17 onwards  
}  
}  
}  
NR-DL-PRS-AssistanceDataPerFreq-r16[2] SEQUENCE { entry 2 In case of sub-test
21 UE-based DL-TDOA method supported by the UE as defined in clause 8.2.11 nr-
DL-PRS-PositioningFrequencyLayer-r16 SEQUENCE {  
dl-PRS-SubcarrierSpacing-r16 SubcarrierSpacing 38.508-1 [30] Table 4.6.3-188  
dl-PRS-ResourceBandwidth-r16 1 24 PRBs  
dl-PRS-StartPRB-r16 same value as 'offsetToCarrier' as defined for the DL
frequency of NR Cell 3  
dl-PRS-PointA-r16 absoluteFrequencyPointA as defined for the DL frequency of
the NR Cell 3  
dl-PRS-CombSizeN-r16 n2  
dl-PRS-CyclicPrefix-r16 normal  
}  
nr-DL-PRS-AssistanceDataPerFreq-r16 SEQUENCE (SIZE (1..nrMaxTRPsPerFreq-r16))
OF NR-DL-PRS-AssistanceDataPerTRP-r16{ 1 entry  
NR-DL-PRS-AssistanceDataPerTRP-r16[1] SEQUENCE { entry 1  
dl-PRS-ID-r16 2  
nr-PhysCellID-r16 3  
nr-CellGlobalID-r16 SEQUENCE {  
mcc-r15 As defined in TS 38.508-1 [30] Table 4.4.2-3 for NR Cell 3  
mnc-r15 As defined in TS 38.508-1 [30] Table 4.4.2-3 for NR Cell 3  
nr-cellidentity-r15 Set to NR Cell 3 Identifier defined in TS 38.508-1 [30]
Table 4.4.2-2  
}  
nr-ARFCN-r16 ARFCN-ValueNR for NR Cell 3 frequency  
nr-DL-PRS-SFN0-Offset-r16 SEQUENCE {  
sfn-Offset-r16 0  
integerSubframeOffset-r16 0  
}  
nr-DL-PRS-ExpectedRSTD-r16 0  
nr-DL-PRS-ExpectedRSTD-Uncertainty-r16 4 About 1 μs  
nr-DL-PRS-Info-r16 NR-DL-PRS-Info-r16 as specified in Table 8.4.1.6-3  
prs-OnlyTP-r16 Not present  
nr-DL-PRS-ExpectedAoD-or-AoA-r17 Not present Rel-17 onwards  
}  
}  
}  
}  
nr-SSB-Config-r16 SEQUENCE (SIZE (1..nrMaxTRPs-r16)) OF NR-SSB-Config-r16 { 1
entry In case of sub-test 21 UE-based DL-TDOA method supported by the UE as
defined in clause 8.2.11 NR-SSB-Config-r16[1] SEQUENCE { entry 1  
nr-PhysCellID-r16 3  
nr-ARFCN-r16 ARFCN-ValueNR for NR Cell 3 frequency As defined in 38.508 -1
[30] subclause 6.2.3.  
ss-PBCH-BlockPower-r16 0  
halfFrameIndex-r16 0  
ssb-periodicity-r16 ms20  
ssb-PositionsInBurst-r16 Not present  
ssb-SubcarrierSpacing-r16 Subcarrier spacing of SSB for NR Cell 3  
sfn-SSB-Offset-r16 0  
}  
}  
}
* * *
#### \- NR-SelectedDL-PRS-IndexList
_Table 8.4.1.6-2:_ NR-SelectedDL-PRS-IndexList
* * *
Derivation Path: 37.355 clause 6.4.3  
Information Element Value/remark Comment Condition NR-SelectedDL-PRS-
IndexList-r16 ::= SEQUENCE (SIZE (1..nrMaxFreqLayers-r16)) OF NR-SelectedDL-
PRS-PerFreq-r16 { 2 entries  
NR-SelectedDL-PRS-PerFreq-r16[1] SEQUENCE { entry 1  
nr-SelectedDL-PRS-FrequencyLayerIndex-r16 0  
nr-SelectedDL-PRS-IndexListPerFreq-r16 Not present  
}  
NR-SelectedDL-PRS-PerFreq-r16[2] SEQUENCE { entry 2 Sub-test 21 UE-Based only
as defined in clause 8.2.11 nr-SelectedDL-PRS-FrequencyLayerIndex-r16 1  
nr-SelectedDL-PRS-IndexListPerFreq-r16 Not present  
}  
}
* * *
#### \- NR-DL-PRS-Info
_Table 8.4.1.6-3:_ NR-DL-PRS-Info
+----------------+----------------+----------------+----------------+ | Derivation | | | | | Path: 37.355 | | | | | clause 6.4.3 | | | | +----------------+----------------+----------------+----------------+ | Information | Value/remark | Comment | Condition | | Element | | | | +----------------+----------------+----------------+----------------+ | NR-D | | | | | L-PRS-Info-r16 | | | | | ::= SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | n | 1 entry | | | | r-DL-PRS-Resou | | | | | rceSetList-r16 | | | | | SEQUENCE (SIZE | | | | | (1..nrMaxSe | | | | | tsPerTrp-r16)) | | | | | OF | | | | | NR-DL-PRS-R | | | | | esourceSet-r16 | | | | | { | | | | +----------------+----------------+----------------+----------------+ | NR | | entry 1 | | | -DL-PRS-Resour | | | | | ceSet-r16[1] | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | nr-DL-PRS-Res | 0 | | | | ourceSetID-r16 | | | | +----------------+----------------+----------------+----------------+ | dl-PRS | The | | | | -Periodicity-a | periodicity is | | | | nd-ResourceSet | 160ms and the | | | | SlotOffset-r16 | resource set | | | | | slot offset is | | | | | 11 ms for any | | | | | SCS | | | | | configuration | | | +----------------+----------------+----------------+----------------+ | dl-PRS- | Not present | | | | ResourceRepeti | | | | | tionFactor-r16 | | | | +----------------+----------------+----------------+----------------+ | dl-PRS-Resou | Not present | | | | rceTimeGap-r16 | | | | +----------------+----------------+----------------+----------------+ | dl-PRS- | n4 | | | | NumSymbols-r16 | | | | +----------------+----------------+----------------+----------------+ | dl-PRS-Mut | Not present | | | | ingOption1-r16 | | | | +----------------+----------------+----------------+----------------+ | dl-PRS-Mut | Not present | | | | ingOption2-r16 | | | | +----------------+----------------+----------------+----------------+ | dl-PRS-Res | 0 | | | | ourcePower-r16 | | | | +----------------+----------------+----------------+----------------+ | dl-PRS-Re | 1 entry | | | | sourceList-r16 | | | | | SEQUENCE (SIZE | | | | | (1 | | | | | ..nrMaxResourc | | | | | esPerSet-r16)) | | | | | OF | | | | | NR-DL-PR | | | | | S-Resource-r16 | | | | | { | | | | +----------------+----------------+----------------+----------------+ | NR-DL-PRS-Res | | entry 1 | | | ource-r16[1] | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | nr-DL-PRS- | 0 | | | | ResourceID-r16 | | | | +----------------+----------------+----------------+----------------+ | dl-PRS- | 0 | | NR-DL-PRS-As | | SequenceID-r16 | | | sistanceDataPe | | | | | rFreq-r16[1] | | | | | | | | | | NR-DL-PRS-A | | | | | ssistanceDataP | | | | | erTRP-r16[1] | | | | | Table | | | | | _8.4.1.6-1_ | +----------------+----------------+----------------+----------------+ | | 1 | | NR-DL-PRS-As | | | | | sistanceDataPe | | | | | rFreq-r16[1] | | | | | | | | | | NR-DL-PRS-As | | | | | sistanceDataPe | | | | | rTRP-r16[2], | | | | | Table | | | | | _8.4.1.6-1_ | +----------------+----------------+----------------+----------------+ | | 2 | | NR-DL-PRS-As | | | | | sistanceDataPe | | | | | rFreq-r16[2] | | | | | | | | | | NR-DL-PRS-A | | | | | ssistanceDataP | | | | | erTRP-r16[1] | | | | | Table | | | | | _8.4.1.6-1_ | +----------------+----------------+----------------+----------------+ | dl-P | | | | | RS-CombSizeN-A | | | | | ndReOffset-r16 | | | | | CHOICE { | | | | +----------------+----------------+----------------+----------------+ | n2-r16 | 0 | | NR-DL-PRS-As | | | | | sistanceDataPe | | | | | rFreq-r16[1] | | | | | | | | | | NR-DL-PRS-A | | | | | ssistanceDataP | | | | | erTRP-r16[1] | | | | | Table | | | | | 8.4.1.6-1 | +----------------+----------------+----------------+----------------+ | | 1 | | NR-DL-PRS-As | | | | | sistanceDataPe | | | | | rFreq-r16[1] | | | | | | | | | | NR-DL-PRS-A | | | | | ssistanceDataP | | | | | erTRP-r16[2] | | | | | Table | | | | | _8.4.1.6-1_ | +----------------+----------------+----------------+----------------+ | | 0 | | NR-DL-PRS-As | | | | | sistanceDataPe | | | | | rFreq-r16[2] | | | | | | | | | | NR-DL-PRS-A | | | | | ssistanceDataP | | | | | erTRP-r16[1] | | | | | Table | | | | | _8.4.1.6-1_ | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | d | 0 | | | | l-PRS-Resource | | | | | SlotOffset-r16 | | | | +----------------+----------------+----------------+----------------+ | dl- | 0 | | | | PRS-ResourceSy | | | | | mbolOffset-r16 | | | | +----------------+----------------+----------------+----------------+ | dl-PR | Not present | | | | S-QCL-Info-r16 | | | | +----------------+----------------+----------------+----------------+ | dl-PR | Not present | Rel-17 onwards | | | S-ResourcePrio | | | | | ritySubset-r17 | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+
#### 8.4.1.7 DL-AoD Assistance Data Elements
This clause defines the **_DL-AoD_** assistance data elements which shall be
provided to the UE in the tests in LPP Provide Assistance Data messages in
addition to those defined in _Table 8.4.1.6-1 and Table 8.4.1.6-2 and Table
8.4.1.6-3_.
#### \- N _R-PositionCalculationAssistance_
_Table 8.4.1.7-1:_ _NR-PositionCalculationAssistance_
* * *
Derivation Path: 37.355 clause 6.4.3  
Information Element Value/remark Comment Condition NR-
PositionCalculationAssistance-r16 ::= SEQUENCE {  
nr-TRP-LocationInfo-r16 SEQUENCE (SIZE (1..nrMaxFreqLayers-r16)) OF NR-TRP-
LocationInfoPerFreqLayer-r16 { 2 entries  
NR-TRP-LocationInfoPerFreqLayer-r16[1] SEQUENCE { entry1  
referencePoint-r16  
trp-LocationInfoList-r16 SEQUENCE (SIZE (1..nrMaxTRPsPerFreq-r16)) OF TRP-
LocationInfoElement-r16 { 2 entries  
TRP-LocationInfoElement-r16[1] SEQUENCE { entry 1  
dl-PRS-ID-r16 0  
nr-PhysCellID-r16 Not present  
nr-CellGlobalID-r16 Not present  
nr-ARFCN-r16 Not present  
associated-DL-PRS-ID-r16 Not present  
trp-Location-r16 Not present Same as the reference point location  
trp-DL-PRS-ResourceSets-r16 Not present  
}  
TRP-LocationInfoElement-r16[2] SEQUENCE { entry 2 In case of sub-test 20/27
UE-based DL-AoD or sub-test 21/28 DL-TDOA method supported by the UE as
defined in clause 8.2.10 and clause 8.2.11. dl-PRS-ID-r16 1  
nr-PhysCellID-r16 Not present  
nr-CellGlobalID-r16 Not present  
nr-ARFCN-r16 Not present  
associated-DL-PRS-ID-r16 Not present  
trp-Location-r16 trp-Location-r16 for NR cell 2 as defined in 37.571-5 [12]  
trp-DL-PRS-ResourceSets-r16 Not present  
}  
}  
}  
NR-TRP-LocationInfoPerFreqLayer-r16[2] SEQUENCE { entry 2  
referencePoint-r16 Not present Same as in the previous entry of the _NR-TRP-
LocationInfoPerFreqLayer_ list.  
trp-LocationInfoList-r16 SEQUENCE (SIZE (1..nrMaxTRPsPerFreq-r16)) OF TRP-
LocationInfoElement-r16 { 1 entry  
TRP-LocationInfoElement-r16[1] SEQUENCE { entry 1  
dl-PRS-ID-r16 2  
nr-PhysCellID-r16 Not present  
nr-CellGlobalID-r16 Not present  
nr-ARFCN-r16 Not present  
associated-DL-PRS-ID-r16 Not present  
trp-Location-r16 trp-Location-r16 for NR cell 3 as defined in TS 37.571-5 [12]  
trp-DL-PRS-ResourceSets-r16 Not present  
}  
}  
}  
}  
nr-DL-PRS-BeamInfo-r16 Not present  
nr-RTD-Info-r16 Not present  
nr-TRP-BeamAntennaInfo-r17 Not present Rel-17 onwards  
nr-DL-PRS-Expected-LOS-NLOS-Assistance-r17 Not present Rel-17 onwards  
nr-DL-PRS-TRP-TEG-Info-r17 Not present Rel-17 onwards  
}
* * *
#### 8.4.1.8 DL-TDOA Assistance Data Elements
The **_DL-TDOA_** assistance data elements which shall be provided to the UE
in the tests in LPP Provide Assistance Data messages are defined in _Table
8.4.1.6-1, Table 8.4.1.6-2, Table 8.4.1.6-3_ and _Table 8.4.1.7-1_.
# 9 Protocol Conformance Test Cases for NR
## 9.1 FFS
## 9.2 FFS
## 9.3 LPP Procedures
### 9.3.1 LPP Common Procedures
#### 9.3.1.1 Position Capability Transfer
Editor\'s note: Test configuration D is incomplete:
  * The corresponding attach procedure for NG-RAN E-UTRA has not yet been defined.
  * The message contents need to be revised for Test Configuration D.
##### 9.3.1.1.1 Test Purpose (TP) {#test-purpose-tp-17 .H6}
##### (1) {#section-22 .H6}
**with** { a NAS signalling connection existing }
**ensure that** {\ **when** { UE receives a LPP message of type REQUEST
CAPABILITIES }
**then** { UE sends a LPP message of type PROVIDE CAPABILITIES with the
correct supported capabilities }
}
##### 9.3.1.1.2 Conformance requirements {#conformance-requirements-40 .H6}
As defined in clause 7.3.1.1.2.
##### 9.3.1.1.3 Test description {#test-description-17 .H6}
##### 9.3.1.1.3.1 Pre-test conditions {#pre-test-conditions-17 .H6}
##### System Simulator: {#system-simulator-14 .H6}
> \- For Test Configuration B (Table 9.3.1.1.3.2-1): NR Cell 1.
>
> \- For Test Configuration D (Table 9.3.1.1.3.2-1): LTE Cell 1.
##### UE: {#ue-31 .H6}
-
##### Preamble: {#preamble-17 .H6}
\- For Test Configuration B (Table 9.3.1.1.3.2-1): The UE is in state 3N-A as
defined in TS 38.508-1 [30], subclause 4.4A on NR Cell 1.
\- For Test Configuration D (Table 9.3.1.1.3.2-1): FFS
##### Related PICS/PIXIT Statements: {#related-picspixit-statements-49 .H6}
-
##### 9.3.1.1.3.2 Test procedure sequence {#test-procedure-sequence-16 .H6}
Table 9.3.1.1.3.2-1: Test Configuration
* * *
**Test Configuration** **Network Deployment Type** **Test Implementation** A
EN-DC Functionality is tested by test case 7.3.1.1 B NG-RAN NR  
C NE-DC Functionality is tested by test configuration B D NG-RAN E-UTRA  
E NGEN-DC Functionality is tested by test configuration D
* * *
Main behaviour is as defined in Table 7.3.1.1.3.2-1.
##### 9.3.1.1.3.3 Specific message contents {#specific-message-contents-50
.H6}
As defined in clause 7.3.1.1.3.3, with the following exceptions:
Table 9.3.1.1.3.3-1 replaces Table 7.3.1.1.3.3-1, Table 9.3.1.1.3.3-2 replaces
Table 7.3.1.1.3.3-2, Table 9.3.1.1.3.3-3 replaces Table 7.3.1.1.3.3-4 and
Table 9.3.1.1.3.3-4 replaces Table 7.3.1.1.3.3-5.
_Table_ 9.3.1.1.3.3-1 _:_ _DLInformationTransfer_ (steps 1 and 2a, Table
7.3.1.1.3.2-1)
Derivation Path: 38.331 clause 6.2.2
* * *
Information Element Value/remark Comment Condition DLInformationTransfer ::=
SEQUENCE {  
rrc-TransactionIdentifier  
criticalExtensions CHOICE {  
dlInformationTransfer SEQUENCE {  
dedicatedNAS-Message OCTET STRING Set according to Table 9.3.1.1.3.3-2 DL NAS
TRANSPORT  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}
Table 9.3.1.1.3.3-2: DL NAS TRANSPORT (steps 1 and 2a, Table 7.3.1.1.3.2‑1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 24.501 | | | | | Table | | | | | 8.2.11.1.1 | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Extended | 01111110 | 5GS mobility | | | Protocol | | management | | | discriminator | | messages | | +-----------------+-----------------+-----------------+-----------+ | Security header | 0000 | Plain 5GS NAS | | | type | | message | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | Downlink | | | octet | | generic NAS | | | | | transport | | +-----------------+-----------------+-----------------+-----------+ | DL NAS | 01101000 | DL NAS | | | TRANSPORT | | transport | | | message | | | | | identity | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | 0011 | LTE Positioning | | | container type | | Protocol (LPP) | | | | | message | | | | | container | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | | | | octet | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | **Step 1:** | LPP Request | | | container | | Capabilities | | | | Set according | | | | | to Table 8.4-2 | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 2a:** | LPP | | | | | Acknowledgement | | | | Set according | | | | | to Table | | | | | 7.3.1.1.3.3-14 | | | +-----------------+-----------------+-----------------+-----------+ | Additional | Present | Routing | | | information | | Identif | | | | | ier/Correlation | | | | | ID | | +-----------------+-----------------+-----------------+-----------+
Table 9.3.1.1.3.3-2A: Void
Table 9.3.1.1.3.3-3: _ULInformationTransfer_ (step 2, Table 7.3.1.1.3.2-1)
Derivation Path: 38.331 clause 6.2.2
* * *
Information Element Value/remark Comment Condition ULInformationTransfer ::=
SEQUENCE {  
criticalExtensions CHOICE {  
ulInformationTransfer SEQUENCE {  
dedicatedNAS-Message OCTET STRING Set according to Table 9.3.1.1.3.3-4 UL NAS
TRANSPORT  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}
Table 9.3.1.1.3.3-4: UL NAS TRANSPORT (step 2, Table 7.3.1.1.3.2-1)
Derivation Path: 24.501 Table 8.2.10.1.1
* * *
Information Element Value/remark Comment Condition Extended Protocol
discriminator 01111110 5GS mobility management messages  
Security header type 0000 Plain 5GS NAS message  
Spare half octet 0000  
UL NAS TRANSPORT message identity 01100111 UL NAS TRANSPORT  
Payload container type 0011 LTE Positioning Protocol (LPP) message container  
Spare half octet 0000  
Payload container Set according to Table 9.3.1.1.3.3-5 LPP Provide
Capabilities  
Additional information Present The UE includes the Routing Identifier received
in the Additional Information IE of the DOWNLINK GENERIC NAS TRANSPORT message
(step 1 Table 7.3.1.1.3.2‑1)
Table 9.3.1.1.3.3-5: LPP PROVIDE CAPABILITIES (step 2, Table 7.3.1.1.3.2-1)
* * *
Derivation Path: Table 7.3.1.1.3.3-6  
Information Element Value/remark Comment Condition As defined in Table
7.3.1.1.3.3-6 with the following exception:  
LPP-Message ::= SEQUENCE {  
lpp-MessageBody CHOICE {  
c1 CHOICE {  
provideCapabilities SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
provideCapabilities-r9 SEQUENCE {  
otdoa-ProvideCapabilities Present or not present dependent on pc_OTDOA_onNR  
ecid-ProvideCapabilities Present or not present dependent on pc_ECID_onNR  
nr-ECID-ProvideCapabilities-r16 Present or not present dependent on
pc_NR_ECID. Set according to Table 9.3.1.1.3.3-6. Rel-16 onwards  
nr-Multi-RTT-ProvideCapabilities-r16 SEQUENCE { Present or not present
dependent on pc_Multi_RTT. Rel-16 onwards  
nr-Multi-RTT-PRS-Capability-r16 Set according to Table 9.3.1.1.3.3-7  
nr-Multi-RTT-MeasurementCapability-r16 Set according to Table 9.3.1.1.3.3-8  
nr-DL-PRS-QCL-ProcessingCapability-r16 Set according to Table 9.3.1.1.3.3-9  
nr-DL-PRS-ProcessingCapability-r16 Set according to Table 9.3.1.1.3.3-10  
nr-UL-SRS-Capability-r16 Set according to Table 9.3.1.1.3.3-11  
additionalPathsReport-r16 Dependent on UE capabilities  
periodicalReporting-r16 Dependent on UE capabilities  
ten-ms-unit-ResponseTime-r17 Not checked Rel-17 onwards  
nr-DL-PRS-ExpectedAoD-or-AoA-Sup-r17 Not checked Rel-17 onwards  
nr-Multi-RTT-On-Demand-DL-PRS-Support-r17 SEQUENCE {  
nr-on-demand-DL-PRS-InformationSup-r17 Not checked Rel-17 onwards  
nr-on-demand-DL-PRS-ConfigurationsSup-r17 Not checked Rel-17 onwards  
}  
nr-UE-RxTx-TEG-ID-ReportingSupport-r17 Not checked Rel-17 onwards  
nr-los-nlos-IndicatorSupport-r17 SEQUENCE {  
type-r17 Not checked Rel-17 onwards  
granularity-r17 Not checked Rel-17 onwards  
}  
additionalPathsExtSupport-r17 Not checked Rel-17 onwards  
scheduledLocationRequestSupported-r17 Not checked Rel-17 onwards  
nr-dl-prs-AssistanceDataValidity-r17 Not checked Rel-17 onwards  
multiMeasInSameMeasReport-r17 Not checked Rel-17 onwards  
mg-ActivationRequest-r17 Dependent on UE capabilities Rel-17 onwards
pc_mg_ActivationRequest_Multi_RTT posMeasGapSupport-r17 Dependent on UE
capabilities Rel-17 onwards pc_posMeasGapSupport_Multi_RTT }  
nr-DL-AoD-ProvideCapabilities-r16 SEQUENCE { Present or not present dependent
on (pc_UEA_DL_AoD OR pc_UEB_DL_AoD). Rel-16 onwards  
nr-DL-AoD-Mode-r16 Dependent on UE capabilities  
nr-DL-AoD-PRS-Capability-r16 Set according to Table 9.3.1.1.3.3-7.  
nr-DL-AoD-MeasurementCapability-r16 Set according to Table 9.3.1.1.3.3-12.  
nr-DL-PRS-QCL-ProcessingCapability-r16 Set according to Table 9.3.1.1.3.3-9.  
nr-DL-PRS-ProcessingCapability-r16 Set according to Table 9.3.1.1.3.3-10.  
periodicalReporting-r16 Dependent on UE capabilities  
ten-ms-unit-ResponseTime-r17 Not checked Rel-17 onwards  
nr-PosCalcAssistanceSupport-r17 Not checked Rel-17 onwards  
nr-los-nlos-AssistanceDataSupport-r17 SEQUENCE {  
type-r17 Not checked Rel-17 onwards  
granularity-r17 Not checked Rel-17 onwards  
}  
nr-DL-PRS-ExpectedAoD-or-AoA-Sup-r17 Not checked Rel-17 onwards  
dl-PRS-ResourcePrioritySubset-Sup-r17 Not checked Rel-17 onwards  
nr-DL-PRS-BeamInfoSup-r17 Not checked Rel-17 onwards  
nr-DL-AoD-On-Demand-DL-PRS-Support-r17 SEQUENCE {  
nr-on-demand-DL-PRS-InformationSup-r17 Not checked Rel-17 onwards  
nr-on-demand-DL-PRS-ConfigurationsSup-r17 Not checked Rel-17 onwards  
}  
nr-los-nlos-IndicatorSupport-r17 SEQUENCE {  
type-r17 Not checked Rel-17 onwards  
granularity-r17 Not checked Rel-17 onwards  
}  
scheduledLocationRequestSupported-r17 Not checked Rel-17 onwards  
nr-dl-prs-AssistanceDataValidity-r17 Not checked Rel-17 onwards  
multiMeasInSameMeasReport-r17 Not checked Rel-17 onwards  
mg-ActivationRequest-r17 Dependent on UE capabilities Rel-17 onwards
pc_mg_ActivationRequest_DL_AoD posMeasGapSupport-r17 Dependent on UE
capabilities Rel-17 onwards pc_posMeasGapSupport_DL_AoD }  
nr-DL-TDOA-ProvideCapabilities-r16 SEQUENCE { Present or not present dependent
on (pc_UEA_DL_TDOA OR pc_UEB_DL_TDOA) Rel-16 onwards  
nr-DL-TDOA-Mode-r16 Dependent on UE capabilities  
nr-DL-TDOA-PRS-Capability-r16 Set according to Table 9.3.1.1.3.3-7.  
nr-DL-TDOA-MeasurementCapability-r16 Set according to Table 9.3.1.1.3.3-13.  
nr-DL-PRS-QCL-ProcessingCapability-r16 Set according to Table 9.3.1.1.3.3-9.  
nr-DL-PRS-ProcessingCapability-r16 Set according to Table 9.3.1.1.3.3-10.  
additionalPathsReport-r16 Dependent on UE capabilities  
periodicalReporting-r16 Dependent on UE capabilities  
ten-ms-unit-ResponseTime-r17 Not checked Rel-17 onwards  
nr-PosCalcAssistanceSupport-r17 Not checked Rel-17 onwards  
nr-los-nlos-AssistanceDataSupport-r17 SEQUENCE {  
type-r17 Not checked Rel-17 onwards  
granularity-r17 Not checked Rel-17 onwards  
}  
nr-DL-PRS-ExpectedAoD-or-AoA-Sup-r17 Not checked Rel-17 onwards  
nr-DL-TDOA-On-Demand-DL-PRS-Support-r17 SEQUENCE {  
nr-on-demand-DL-PRS-InformationSup-r17 Not checked Rel-17 onwards  
nr-on-demand-DL-PRS-ConfigurationsSup-r17 Not checked Rel-17 onwards  
}  
nr-los-nlos-IndicatorSupport-r17 SEQUENCE {  
type-r17 Not checked Rel-17 onwards  
granularity-r17 Not checked Rel-17 onwards  
}  
additionalPathsExtSupport-r17 Not checked Rel-17 onwards  
scheduledLocationRequestSupported-r17 Not checked Rel-17 onwards  
nr-dl-prs-AssistanceDataValidity-r17 Not checked Rel-17 onwards  
multiMeasInSameMeasReport-r17 Not checked Rel-17 onwards  
mg-ActivationRequest-r17 Dependent on UE capabilities Rel-17 onwards
pc_mg_ActivationRequest_DL_TDOA posMeasGapSupport-r17 Dependent on UE
capabilities Rel-17 onwards pc_posMeasGapSupport_DL_TDOA }  
nr-UL-ProvideCapabilities-r16 SEQUENCE { Present or not present and value
dependent on UE capabilities. Rel-16 onwards  
nr-UL-SRS-Capability-r16 Set according to Table 9.3.1.1.3.3-11  
nr-UE-TEG-Capability-r17 Set according to Table 9.3.1.1.3.3-14 Rel-17 onwards  
}  
}  
}  
}  
}  
}  
}  
}
* * *
Table 9.3.1.1.3.3-6: NR-ECID-ProvideCapabilities (Table 9.3.1.1.3.3-5)
* * *
Derivation Path: 37.355 clause 6.5.9.4  
Information Element Value/remark Comment Condition NR-ECID-
ProvideCapabilities-r16 ::= SEQUENCE { Rel-16 onwards  
nr-ECID-MeasSupported-r16 Dependent on UE capabilities  
periodicalReporting-r16 Dependent on UE capabilities  
triggeredReporting-r16 Dependent on UE capabilities  
ten-ms-unit-ResponseTime-r17 Not checked Rel-17 onwards  
scheduledLocationRequestSupported-r17 Not checked Rel-17 onwards  
}
* * *
Table 9.3.1.1.3.3-7: NR-DL-PRS-ResourcesCapability-r16 (Table 9.3.1.1.3.3-5)
* * *
Derivation Path: 37.355 clause 6.4.3  
Information Element Value/remark Comment Condition NR-DL-PRS-
ResourcesCapability-r16 ::= SEQUENCE { Rel-16 onwards  
maxNrOfDL-PRS-ResourceSetPerTrpPerFrequencyLayer-r16 Dependent on UE
capabilities  
maxNrOfTRP-AcrossFreqs-r16 Dependent on UE capabilities  
maxNrOfPosLayer-r16 Dependent on UE capabilities  
dl-PRS-ResourcesCapabilityBandList-r16 SEQUENCE (SIZE (1..n)) OF SEQUENCE {
Size n of SEQUENCE is dependent on UE capabilities  
freqBandIndicatorNR-r16 Dependent on UE capabilities  
maxNrOfDL-PRS-ResourcesPerResourceSet-r16 Dependent on UE capabilities  
maxNrOfDL-PRS-ResourcesPerPositioningFrequencylayer-r16 Dependent on UE
capabilities  
}  
dl-PRS-ResourcesBandCombinationList-r16 SEQUENCE (SIZE (1..n)) OF SEQUENCE {
Size n of SEQUENCE is dependent on UE capabilities  
bandList-r16 Not checked  
maxNrOfDL-PRS-ResourcesAcrossAllFL-TRP-ResourceSet-r16 Dependent on UE
capabilities  
}  
}
* * *
Table 9.3.1.1.3.3-8: NR-Multi-RTT-MeasurementCapability-r16 (Table
9.3.1.1.3.3-5)
* * *
Derivation Path: 37.355 clause 6.5.12.6  
Information Element Value/remark Comment Condition NR-Multi-RTT-
MeasurementCapability-r16 ::= SEQUENCE { Rel-16 onwards  
maxNrOfRx-TX-MeasFR1-r16 Dependent on UE capabilities  
maxNrOfRx-TX-MeasFR2-r16 Dependent on UE capabilities  
supportOfRSRP-MeasFR1-r16 Dependent on UE capabilities  
supportOfRSRP-MeasFR2-r16 Dependent on UE capabilities  
srs-AssocPRS-MultiLayersFR1-r16 Dependent on UE capabilities  
srs-AssocPRS-MultiLayersFR2-r16 Dependent on UE capabilities  
nr-UE-TEG-Capability-r17 Set according to Table 9.3.1.1.3.3-14  
multi-RTT-MeasCapabilityBandList-r17 SEQUENCE (SIZE (1..nrMaxBands-r16)) OF {
Size n of SEQUENCE is dependent on UE capabilities  
freqBandIndicatorNR-r17 Not ckecked  
supportOfDL-PRS-FirstPathRSRP-r17 Not checked Rel-17 onwards  
dl-PRS-MeasRRC-Inactive-r17 Not checked Rel-17 onwards  
}  
}
* * *
Table 9.3.1.1.3.3-9: NR-DL-PRS-QCL-ProcessingCapability-r16 (Table
9.3.1.1.3.3-5)
* * *
Derivation Path: 37.355 clause 6.4.3  
Information Element Value/remark Comment Condition NR-DL-PRS-QCL-
ProcessingCapability-r16 ::= SEQUENCE { Rel-16 onwards  
dl-PRS-QCL-ProcessingCapabilityBandList-r16 SEQUENCE (SIZE (1..n)) OF SEQUENCE
{ Size n of SEQUENCE is dependent on UE capabilities  
freqBandIndicatorNR-r16 Dependent on UE capabilities  
ssb-FromNeighCellAsQCL-r16 Dependent on UE capabilities  
prs-FromServNeighCellAsQCL-r16 Dependent on UE capabilities  
}  
}
* * *
Table 9.3.1.1.3.3-10: NR-DL-PRS-ProcessingCapability-r16 (Table 9.3.1.1.3.3-5)
+----------------+----------------+----------------+----------------+ | Derivation | | | | | Path: 37.355 | | | | | clause 6.4.3 | | | | +----------------+----------------+----------------+----------------+ | Information | Value/remark | Comment | Condition | | Element | | | | +----------------+----------------+----------------+----------------+ | NR-DL- | | Rel-16 onwards | | | PRS-Processing | | | | | Capability-r16 | | | | | ::= SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | prs-Proc | Size n of | | | | essingCapabili | SEQUENCE is | | | | tyBandList-r16 | dependent on | | | | SEQUENCE (SIZE | UE | | | | (1..n)) OF | capabilities | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | freqBandI | Dependent on | | | | ndicatorNR-r16 | UE | | | | | capabilities | | | +----------------+----------------+----------------+----------------+ | supportedBa | Dependent on | | | | ndwidthPRS-r16 | UE | | | | | capabilities | | | +----------------+----------------+----------------+----------------+ | dl-PRS- | Dependent on | | | | BufferType-r16 | UE | | | | | capabilities | | | +----------------+----------------+----------------+----------------+ | durationOfPRS- | | | | | Processing-r16 | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | duratio | Dependent on | | | | nOfPRS-Process | UE | | | | ingSymbols-r16 | capabilities | | | +----------------+----------------+----------------+----------------+ | dur | Dependent on | | | | ationOfPRS-Pro | UE | | | | cessingSymbols | capabilities | | | | InEveryTms-r16 | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | maxNumOfDL | | | | | -PRS-ResProces | | | | | sedPerSlot-r16 | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | scs15-r16 | Dependent on | | | | | UE | | | | | capabilities | | | +----------------+----------------+----------------+----------------+ | scs30-r16 | Dependent on | | | | | UE | | | | | capabilities | | | +----------------+----------------+----------------+----------------+ | scs60-r16 | Dependent on | | | | | UE | | | | | capabilities | | | +----------------+----------------+----------------+----------------+ | scs120-r16 | Dependent on | | | | | UE | | | | | capabilities | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | supported | Dependent on | Rel-17 onwards | pc_supported | | DL-PRS-Process | UE | | DL_PRS_Proce | | ingSamples-RRC | capabilities | | ssingSamples_ | | -CONNECTED-r17 | | | RRC_CONNECTED | +----------------+----------------+----------------+----------------+ | pr | Dependent on | Rel-17 onwards | pc_prs_Proc | | s-ProcessingWi | UE | | | | ndowType1A-r17 | capabilities | | essingWindo | | | | | | | | | | wType1A | +----------------+----------------+----------------+----------------+ | pr | Dependent on | Rel-17 onwards | pc_prs_Proc | | s-ProcessingWi | UE | | | | ndowType1B-r17 | capabilities | | essingWindo | | | | | | | | | | wType1B | +----------------+----------------+----------------+----------------+ | p | Dependent on | Rel-17 onwards | pc_prs_Proc | | rs-ProcessingW | UE | | | | indowType2-r17 | capabilities | | essingWindo | | | | | | | | | | wType2 | +----------------+----------------+----------------+----------------+ | prs-Processing | Size n of | | | | CapabilityOuts | SEQUENCE is | | | | ideMGinPPW-r17 | dependent on | | | | SEQUENCE | UE | | | | (SIZE(1..3)) | capabilities | | | | OF { | | | | +----------------+----------------+----------------+----------------+ | prsProc | Dependent on | Rel-17 onwards | pc_prs | | essingType-r17 | UE | | ProcessingType | | | capabilities | | | +----------------+----------------+----------------+----------------+ | ppw-dl-PRS- | Dependent on | Rel-17 onwards | pc_ppw_dl_P | | BufferType-r17 | UE | | RS_BufferType | | | capabilities | | | +----------------+----------------+----------------+----------------+ | ppw-d | | | | | urationOfPRS-P | | | | | rocessing1-r17 | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | ppw-duration | Dependent on | Rel-17 onwards | pc_ppw_durat | | OfPRS-Processi | UE | | ionOfPRS_Proc | | ngSymbolsN-r17 | capabilities | | essingSymbolsN | +----------------+----------------+----------------+----------------+ | ppw-duration | Dependent on | Rel-17 onwards | pc_ppw_durat | | OfPRS-Processi | UE | | ionOfPRS_Proc | | ngSymbolsT-r17 | capabilities | | essingSymbolsT | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | ppw-d | | | | | urationOfPRS-P | | | | | rocessing2-r17 | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | ppw-durationO | Dependent on | Rel-17 onwards | p | | fPRS-Processin | UE | | c_ppw_durati | | gSymbolsN2-r17 | capabilities | | onOfPRS_Proce | | | | | ssingSymbolsN2 | +----------------+----------------+----------------+----------------+ | ppw-durationO | Dependent on | Rel-17 onwards | p | | fPRS-Processin | UE | | c_ppw_durati | | gSymbolsT2-r17 | capabilities | | onOfPRS_Proce | | | | | ssingSymbolsT2 | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | ppw-maxNumOfDL | | | | | -PRS-ResProces | | | | | sedPerSlot-r17 | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | scs15-r17 | Dependent on | Rel-17 onwards | pc_ppw_m | | | UE | | axNumOfDL_PRS | | | capabilities | | _ResProcessed | | | | | PerSlot_SCS15 | +----------------+----------------+----------------+----------------+ | scs30-r17 | Dependent on | Rel-17 onwards | pc_ppw_m | | | UE | | axNumOfDL_PRS | | | capabilities | | _ResProcessed | | | | | PerSlot_SCS30 | +----------------+----------------+----------------+----------------+ | scs60-r17 | Dependent on | Rel-17 onwards | pc_ppw_m | | | UE | | axNumOfDL_PRS | | | capabilities | | _ResProcessed | | | | | PerSlot_SCS60 | +----------------+----------------+----------------+----------------+ | scs120-r17 | Dependent on | Rel-17 onwards | pc_ppw_ma | | | UE | | xNumOfDL_PRS\ | | | capabilities | | _ResProcessedP | | | | | erSlot_SCS120 | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | ppw-maxNumOfDL | Dependent on | Rel-17 onwards | pc_ppw | | -Bandwidth-r17 | UE | | _maxNumOfDL_ | | | capabilities | | Bandwidth_FR1 | | | | | / | | | | | pc_ppw | | | | | _maxNumOfDL_ | | | | | Bandwidth_FR2 | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | dl-PRS | Not checked | Rel-17 onwards | | | -BufferType-RR | | | | | C-Inactive-r17 | | | | +----------------+----------------+----------------+----------------+ | durationOfPRS | | | | | -Processing-RR | | | | | C-Inactive-r17 | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | duratio | Not checked | Rel-17 onwards | | | nOfPRS-Process | | | | | ingSymbols-r17 | | | | +----------------+----------------+----------------+----------------+ | dur | Not checked | Rel-17 onwards | | | ationOfPRS-Pro | | | | | cessingSymbols | | | | | InEveryTms-r17 | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | maxNumOfD | | | | | L-PRS-ResProce | | | | | ssedPerSlot-RR | | | | | C-Inactive-r17 | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | scs15-r17 | Not checked | Rel-17 onwards | | +----------------+----------------+----------------+----------------+ | scs30-r17 | Not checked | Rel-17 onwards | | +----------------+----------------+----------------+----------------+ | scs60-r17 | Not checked | Rel-17 onwards | | +----------------+----------------+----------------+----------------+ | scs120-r17 | Not checked | Rel-17 onwards | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | supportedLower | Not checked | Rel-17 onwards | | | RxBeamSweeping | | | | | Factor-FR2-r17 | | | | +----------------+----------------+----------------+----------------+ | supporte | Not checked | Rel-17 onwards | | | dDL-PRS-Proces | | | | | singSamples-RR | | | | | C-Inactive-r17 | | | | +----------------+----------------+----------------+----------------+ | prs-Measuremen | Not checked | Rel-17 onwards | | | tWithoutMG-r17 | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | maxSupported | Dependent on | | | | FreqLayers-r16 | UE | | | | | capabilities | | | +----------------+----------------+----------------+----------------+ | simul | Dependent on | | | | LTE-NR-PRS-r16 | UE | | | | | capabilities | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+
Table 9.3.1.1.3.3-11: NR-UL-SRS-Capability-r16 (Table 9.3.1.1.3.3-5)
* * *
Derivation Path: 37.355 clause 6.4.3  
Information Element Value/remark Comment Condition NR-UL-SRS-Capability-r16
::= SEQUENCE { Rel-16 onwards  
srs-CapabilityBandList-r16 SEQUENCE (SIZE (1..n)) OF SEQUENCE { Size n of
SEQUENCE is dependent on UE capabilities  
freqBandIndicatorNR-r16 Dependent on UE capabilities  
olpc-SRS-Pos-r16 SEQUENCE {  
olpc-SRS-PosBasedOnPRS-Serving-r16 Dependent on UE capabilities  
olpc-SRS-PosBasedOnSSB-Neigh-r16 Dependent on UE capabilities  
olpc-SRS-PosBasedOnPRS-Neigh-r16 Dependent on UE capabilities  
maxNumberPathLossEstimatePerServing-r16 Dependent on UE capabilities  
}  
spatialRelationsSRS-Pos-r16 SEQUENCE {  
spatialRelation-SRS-PosBasedOnSSB-Serving-r16 Dependent on UE capabilities  
spatialRelation-SRS-PosBasedOnCSI-RS-Serving-r16 Dependent on UE capabilities  
spatialRelation-SRS-PosBasedOnPRS-Serving-r16 Dependent on UE capabilities  
spatialRelation-SRS-PosBasedOnSRS-r16 Dependent on UE capabilities  
spatialRelation-SRS-PosBasedOnSSB-Neigh-r16 Dependent on UE capabilities  
spatialRelation-SRS-PosBasedOnPRS-Neigh-r16 Dependent on UE capabilities  
}  
posSRS-RRC-Inactive-InInitialUL-BWP-r17 SEQUENCE {  
maxNumOfSRSposResourceSets-r17 Not checked Rel-17 onwards  
maxNumOfPeriodicAndSemiPersistentSRSposResources-r17 Not checked Rel-17
onwards  
maxNumOfPeriodicAndSemiPersistentSRSposResourcesPerSlot-r17 Not checked Rel-17
onwards  
maxNumOfPeriodicSRSposResources-r17 Not checked Rel-17 onwards  
maxNumOfPeriodicSRSposResourcesPerSlot-r17 Not checked Rel-17 onwards  
dummy1 Not checked Rel-17 onwards  
dummy2 Not checked Rel-17 onwards  
}  
posSRS-RRC-Inactive-OutsideInitialUL-BWP-r17 SEQUENCE {  
maxSRSposBandwidthForEachSCS-withinCC-FR1-r17 Not checked Rel-17 onwards  
maxSRSposBandwidthForEachSCS-withinCC-FR2-r17 Not checked Rel-17 onwards  
maxNumOfSRSposResourceSets-r17 Not checked Rel-17 onwards  
maxNumOfPeriodicSRSposResources-r17 Not checked Rel-17 onwards  
maxNumOfPeriodicSRSposResourcesPerSlot-r17 Not checked Rel-17 onwards  
differentNumerologyBetweenSRSposAndInitialBWP-r17 Not checked Rel-17 onwards  
srsPosWithoutRestrictionOnBWP-r17 Not checked Rel-17 onwards  
maxNumOfPeriodicAndSemiPersistentSRSposResources-r17 Not checked Rel-17
onwards  
maxNumOfPeriodicAndSemiPersistentSRSposResourcesPerSlot-r17 Not checked Rel-17
onwards  
differentCenterFreqBetweenSRSposAndInitialBWP-r17 Not checked Rel-17 onwards  
maxNumOfSemiPersistentSRSposResources-r17 Not checked Rel-17 onwards  
maxNumOfSemiPersistentSRSposResourcesPerSlot-r17 Not checked Rel-17 onwards  
switchingTimeSRS-TX-OtherTX-r17 Not checked Rel-17 onwards  
}  
olpc-SRS-PosRRC-Inactive-r17 SEQUENCE {  
olpc-SRS-PosBasedOnPRS-Serving-r16 Not checked Rel-17 onwards  
olpc-SRS-PosBasedOnSSB-Neigh-r16 Not checked Rel-17 onwards  
olpc-SRS-PosBasedOnPRS-Neigh-r16 Not checked Rel-17 onwards  
maxNumberPathLossEstimatePerServing-r16 Not checked Rel-17 onwards  
}  
spatialRelationsSRS-PosRRC-Inactive-r17 SEQUENCE {  
spatialRelation-SRS-PosBasedOnSSB-Serving-r16 Not checked Rel-17 onwards  
spatialRelation-SRS-PosBasedOnCSI-RS-Serving-r16 Not checked Rel-17 onwards  
spatialRelation-SRS-PosBasedOnPRS-Serving-r16 Not checked Rel-17 onwards  
spatialRelation-SRS-PosBasedOnSRS-r16 Not checked Rel-17 onwards  
spatialRelation-SRS-PosBasedOnSSB-Neigh-r16 Not checked Rel-17 onwards  
spatialRelation-SRS-PosBasedOnPRS-Neigh-r16 Not checked Rel-17 onwards  
}  
posSRS-SP-RRC-Inactive-InInitialUL-BWP-r17 SEQUENCE {  
maxNumOfSemiPersistentSRSposResources-r17 Not checked Rel-17 onwards  
maxNumOfSemiPersistentSRSposResourcesPerSlot-r17 Not checked Rel-17 onwards  
}  
}  
srs-PosResourceConfigCA-BandList-r16 SEQUENCE (SIZE (1..n)) OF SEQUENCE { Size
n of SEQUENCE is dependent on UE capabilities  
freqBandIndicatorNR-r16 Dependent on UE capabilities  
maxNumberSRS-PosResourceSetsPerBWP-r16 Dependent on UE capabilities  
maxNumberSRS-PosResourcesPerBWP-r16 Dependent on UE capabilities  
maxNumberPeriodicSRS-PosResourcesPerBWP-r16 Dependent on UE capabilities  
maxNumberAP-SRS-PosResourcesPerBWP-r16 Dependent on UE capabilities  
maxNumberSP-SRS-PosResourcesPerBWP-r16 Dependent on UE capabilities  
} Dependent on UE capabilities  
maxNumberSRS-PosPathLossEstimateAllServingCells-r16 Dependent on UE
capabilities  
maxNumberSRS-PosSpatialRelationsAllServingCells-r16 Dependent on UE
capabilities  
}
* * *
Table 9.3.1.1.3.3-12: NR-DL-AoD-MeasurementCapability-r16 (Table
9.3.1.1.3.3-5)
* * *
Derivation Path: 37.355 clause 6.5.11.6  
Information Element Value/remark Comment Condition NR-DL-AoD-
MeasurementCapability-r16 ::= SEQUENCE { Rel-16 onwards  
maxDL-PRS-RSRP-MeasurementFR1-r16 Dependent on UE capabilities  
maxDL-PRS-RSRP-MeasurementFR2-r16 Dependent on UE capabilities  
dl-AoD-MeasCapabilityBandList-r16 SEQUENCE (SIZE (1..n)) OF SEQUENCE { Size n
of SEQUENCE is dependent on UE capabilities  
freqBandIndicatorNR-r16 Dependent on UE capabilities  
simul-NR-DL-AoD-DL-TDOA-r16 Dependent on UE capabilities  
simul-NR-DL-AoD-Multi-RTT-r16 Dependent on UE capabilities  
maxDL-PRS-FirstPathRSRP-MeasPerTRP-r17 Not checked Rel-17 onwards  
dl-PRS-MeasRRC-Inactive-r17 Not checked Rel-17 onwards  
}  
maxDL-PRS-RSRP-MeasurementFR1-v1730 Not checked Rel-17 onwards  
maxDL-PRS-RSRP-MeasurementFR2-v1730 Not checked Rel-17 onwards  
}
* * *
Table 9.3.1.1.3.3-13: _NR-DL-TDOA-MeasurementCapability_ (Table 9.3.1.1.3.3-5)
* * *
Derivation Path: 37.355 clause 6.5.10.6  
Information Element Value/remark Comment Condition NR-DL-TDOA-
MeasurementCapability-r16 ::= SEQUENCE { Rel-16 onwards  
dl-RSTD-MeasurementPerPairOfTRP-FR1-r16 Dependent on UE capabilities  
dl-RSTD-MeasurementPerPairOfTRP-FR2-r16 Dependent on UE capabilities  
supportOfDL-PRS-RSRP-MeasFR1-r16 Dependent on UE capabilities  
supportOfDL-PRS-RSRP-MeasFR2-r16 Dependent on UE capabilities  
nr-UE-TEG-Capability-r17 Set according to Table 9.3.1.1.3.3-14  
dl-tdoa-MeasCapabilityBandList-r17 SEQUENCE (SIZE (1..nrMaxBands-r16)) OF {
Size n of SEQUENCE is dependent on UE capabilities  
freqBandIndicatorNR-r17 Not ckecked  
supportOfDL-PRS-FirstPathRSRP-r17 Not checked Rel-17 onwards  
dl-PRS-MeasRRC-Inactive-r17 Not checked Rel-17 onwards  
}  
}
* * *
Table 9.3.1.1.3.3-14: _NR-UE-TEG-Capability_ (Table 9.3.1.1.3.3-5)
* * *
Derivation Path: 37.355 clause 6.4.3  
Information Element Value/remark Comment Condition NR-UE-TEG-Capability-r17
::= SEQUENCE { Rel-17 onwards  
nr-UE-TEG-ID-CapabilityBandList-r17 SEQUENCE (SIZE (1..nrMaxBands-r16)) OF {
Size n of SEQUENCE is dependent on UE capabilities  
freqBandIndicatorNR-r17 Not checked  
nr-UE-RxTEG-ID-MaxSupport-r17 Dependent on UE capabilities
pc_nr_UE_RxTEG_ID_MaxSupport nr-UE-TxTEG-ID-MaxSupport-r17 Dependent on UE
capabilities pc_nr_UE_TxTEG_ID_MaxSupport nr-UE-RxTxTEG-ID-MaxSupport-r17
Dependent on UE capabilities pc_nr_UE_RxTxTEG_ID_MaxSupport measureSameDL-PRS-
ResourceWithDifferentRxTEGs-r17 Dependent on UE capabilities
pc_measureSameDL_PRS_ResourceWithDifferentRxTEGs measureSameDL-PRS-
ResourceWithDifferentRxTEGsSimul-r17 Dependent on UE capabilities
pc_measureSameDL_PRS_ResourceWithDifferentRxTEGsSimul }  
}
* * *
#### 9.3.1.2 LPP Abort
Editor\'s note: Test configuration D is incomplete:
\- The corresponding attach procedure for NG-RAN E-UTRA has not yet been
defined.
\- The message contents need to be revised for Test Configuration D.
##### 9.3.1.2.1 Test Purpose (TP) {#test-purpose-tp-18 .H6}
##### (1) {#section-23 .H6}
**with** { a NAS signalling connection existing }
**ensure that** {\ **when** { UE receives a LPP Abort message carrying the
transaction ID of an on-going procedure }
**then** { UE aborts the on-going procedure }
}
##### 9.3.1.2.2 Conformance requirements {#conformance-requirements-41 .H6}
As defined in clause 7.3.5.1.2.
##### 9.3.1.2.3 Test description {#test-description-18 .H6}
##### 9.3.1.2.3.1 Pre-test conditions {#pre-test-conditions-18 .H6}
##### System Simulator: {#system-simulator-15 .H6}
\- For Test Configuration B (Table 9.3.1.2.3.2-1):
\- Sub-tests 11, 12, 13, 15, 16, 17, 19: NR Cell 1.
\- Sub-test 5: NR Cell 1 and independent LTE Cell 1, as specified in 8.2.2.
\- Sub-test 20: NR Cell 1 and NR Cell 2 (only applicable to UE-Based DL-TDOA).
\- Sub-test 21: NR Cell 1, NR Cell 2 and NR Cell 3 (only applicable to UE-
Based DL-AoD).
\- For Test Configuration D (Table 9.3.1.2.3.2-1):
\- Sub-tests 11, 12, 13, 15, 16, 17: LTE Cell 1.
\- Sub-test 5: LTE Cell 1, as specified in 8.2.2.
##### UE: {#ue-32 .H6}
\- The UE shall begin the tests with no assistance data stored.
##### Preamble: {#preamble-18 .H6}
\- For Test Configuration B (Table 9.3.1.2.3.2-1): The UE is in state 3N-A as
defined in TS 38.508-1 [30], subclause 4.4A on NR Cell 1.
\- Sub-test 5: After the UE is in state 3N-A, the SS shall execute the steps
in Table 9.3.1.2.3.1-1 for the configuration of measurement gaps for OTDOA
(LTE).
\- Sub-test 19: After the UE is in state 3N-A, the SS shall execute the steps
in Table 9.3.1.2.3.1-1 for the configuration of measurement gaps for Multi-RTT
and then the SS shall execute the steps in Table 9.3.1.2.3.1-2 for the
configuration of UL-SRS for Multi-RTT.
\- Sub-test 20: After the UE is in state 3N-A, the SS shall execute the steps
in Table 9.3.1.2.3.1-1 for the configuration of measurement gaps for DL-AoD.
\- Sub-test 21: After the UE is in state 3N-A, the SS shall execute the steps
in Table 9.3.1.2.3.1-1 for the configuration of measurement gaps for DL-TDOA.
Table 9.3.1.2.3.1-1: Configuration of measurement gaps
St Procedure Message Sequence TP Verdict
* * *
                                                                         U - S              Message
1 The SS sends an RRCReconfiguration message as in Table 8.3.1-1. \ RRCReconfigurationComplete - -
Table 9.3.1.2.3.1-2: Configuration of UL-SRS for Multi-RTT
St Procedure Message Sequence TP Verdict
* * *
                                                                         U - S              Message
1 The SS sends an RRCReconfiguration message as in Table 8.3.2-1. \ RRCReconfigurationComplete - -
\- For Test Configuration D (Table 9.3.1.2.3.2-1): FFS.
##### Related PICS/PIXIT Statements: {#related-picspixit-statements-50 .H6}
-
##### 9.3.1.2.3.2 Test procedure sequence {#test-procedure-sequence-17 .H6}
This test case includes sub-test cases dependent on the positioning method(s)
supported by the UE. Each sub-test case is identified by a Sub-Test Case
Number as defined in Table 9.3.1.2.3.2-0 below:
Table 9.3.1.2.3.2-0: Sub-test case numbers
* * *
**Sub-Test Case Number** **Supported Positioning Methods** 5 UE supporting
OTDOA (LTE) (Rel-15 onwards) 11 UE supporting WLAN (Rel-13 only) 12 UE
supporting MBS (Rel-13 only) 13 UE supporting Bluetooth 15 UE supporting
GNSS^(1)^ 16 UE supporting MBS (Rel-14 onwards) 17 UE supporting WLAN (Rel-14
onwards) 19 UE supporting Multi-RTT (Rel-16 onwards) 20 UE supporting DL-AoD
(Rel-16 onwards) 21 UE supporting DL-TDOA (Rel-16 onwards) NOTE 1: The GNSS
combination of GPS, GLONASS, Galileo, BDS supported by the UE
* * *
Note that this test case does not include a sub-test for the case where ECID
(LTE), NR E-CID or Sensor is supported by the UE as the behaviour required
cannot be guaranteed in these cases.
Table 9.3.1.2.3.2-1: Test Configuration
* * *
Test Configuration Network Deployment Type Test Implementation A EN-DC
Functionality is tested by test case 7.3.5.1 B NG-RAN NR  
C NE-DC Functionality is tested by test configuration B D NG-RAN E-UTRA  
E NGEN-DC Functionality is tested by test configuration D
* * *
Main behaviour is as defined in Table 7.3.5.1.3.2-1.
##### 9.3.1.2.3.3 Specific message contents {#specific-message-contents-51
.H6}
As defined in clause 7.3.5.1.3.3, with the following exceptions:
Table 9.3.1.2.3.3-0 replaces Table 7.3.5.1.3.3-0, Table 9.3.1.2.3.3-1 replaces
Table 7.3.5.1.3.3-1, Table 9.3.1.2.3.3-2 replaces Table 7.3.5.1.3.3-2, Table
9.3.1.2.3.3-2a replaces Table 7.3.5.1.3.3-2c, Table 9.3.1.2.3.3-2b replaces
Table 7.3.5.1.3.3-2d, Table 9.3.1.2.3.3-3 replaces Table 7.3.5.1.3.3-5, Table
9.3.1.2.3.3-4 replaces Table 7.3.5.1.3.3-6, Table 9.3.1.2.3.3-5 replaces Table
7.3.5.1.3.3-3 and Table 9.3.1.2.3.3-6 replaces Table 7.3.5.1.3.3-7.
_Table_ 9.3.1.2.3.3-0 _:_ RESET UE POSITIONING STORED INFORMATION (step 00,
Table 7.3.5.1.3.2-1)
+----------------+----------------+----------------+---------------+ | Derivation | | | | | Path: 38.509 | | | | | clause 6.6 | | | | +================+================+================+===============+ | **Information | ** |** Comment**|** Condition**| | Element** | Value/remark** | | | +----------------+----------------+----------------+---------------+ | As defined in | | | | | Table | | | | | 7.3.5.1.3.3-0 | | | | | with the | | | | | following | | | | | exceptions: | | | | +----------------+----------------+----------------+---------------+ | UE Positioning | Sub-test 19: 0 | Sub-test 19: | | | Technology | 0 0 0 0 1 1 0 | Multi-RTT | | | | | | | | | Sub-test 20: 0 | Sub-test 20: | | | | 0 0 0 1 0 0 0 | DL-AoD | | | | | | | | | Sub-test 21: 0 | Sub-test 21: | | | | 0 0 0 0 1 1 1 | DL-TDOA | | +----------------+----------------+----------------+---------------+
_Table_ 9.3.1.2.3.3-1 _:_ _DLInformationTransfer_ (steps 0, 0b, 0c, 1 and 2,
Table 7.3.5.1.3.2-1)
Derivation Path: 38.331 clause 6.2.2
* * *
Information Element Value/remark Comment Condition DLInformationTransfer ::=
SEQUENCE {  
rrc-TransactionIdentifier  
criticalExtensions CHOICE {  
dlInformationTransfer SEQUENCE {  
dedicatedNAS-Message OCTET STRING Set according to Table 9.3.1.2.3.3-2 DL NAS
TRANSPORT  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}
Table 9.3.1.2.3.3-2: DL NAS TRANSPORT (steps 0, 0b, 0c, 1 and 2, Table
7.3.5.1.3.2‑1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 24.501 | | | | | Table | | | | | 8.2.11.1.1 | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Extended | 01111110 | 5GS mobility | | | Protocol | | management | | | discriminator | | messages | | +-----------------+-----------------+-----------------+-----------+ | Security header | 0000 | Plain 5GS NAS | | | type | | message | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | Downlink | | | octet | | generic NAS | | | | | transport | | +-----------------+-----------------+-----------------+-----------+ | DL NAS | 01101000 | DL NAS | | | TRANSPORT | | transport | | | message | | | | | identity | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | 0011 | LTE Positioning | | | container type | | Protocol (LPP) | | | | | message | | | | | container | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | | | | octet | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | **Step 0:** | LPP Request | | | container | | Capabilities. | | | | Set according | | | | | to Table | | | | | _8.4-2_ | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 0b:** | LPP | | | | | Acknowledgement | | | | Set according | | | | | to Table | | | | | 7.3.5.1.3.3-2b | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 0c:** | LPP Provide | | | | | Assistance Data | | | | Set according | | | | | to Table | | | | | 9.3.1.2.3.3-2a | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 1:** | LPP Request | | | | | Location | | | | Set according | Information | | | | to _Tab_ le | | | | | 9.3.1.2.3.3-5 | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 2:** | LPP Abort | | | | | | | | | Set according | | | | | to Table | | | | | 7.3.5.1.3.3-4 | | | +-----------------+-----------------+-----------------+-----------+ | Additional | Present | Routing | | | information | | Identif | | | | | ier/Correlation | | | | | ID | | +-----------------+-----------------+-----------------+-----------+
Table 9.3.1.2.3.3-2a: LPP Provide Assistance Data (step 0c, Table
7.3.5.1.3.2-1)
* * *
Derivation Path: Table 8.4-1  
Information Element Value/remark Comment Condition As defined in Table 8.4-1
with the following exceptions:  
transactionID SEQUENCE {  
initiator locationServer  
transactionNumber (0..255)  
}  
OTDOA-NeighbourCellInfoList ::= SEQUENCE (SIZE(1)) OF SEQUENCE { Sub-test 5
SEQUENCE (SIZE(18)) OF SEQUENCE { Sequence contains 18 instances of the
following data.  
physCellId Refer to Sequence data values in Table 9.3.1.2.3.3-2b  
cellGlobalId For values of cellidentity refer to Sequence data values in Table
9.3.1.2.3.3-2b  
earfcn Not present Same as for the reference cell  
cpLength Not present Same as for the reference cell  
prsInfo Not present Same as for the reference cell  
antennaPortConfig Not present Same as for the reference cell  
slotNumberOffset Not present Same as for the reference cell  
prs-SubframeOffset Not present Same as for the reference cell  
expectedRSTD Refer to Sequence data values in Table 9.3.1.2.3.3-2b  
expectedRSTD-Uncertainty Refer to Sequence data values in Table 9.3.1.2.3.3-2b  
earfcn-v9a0 Not present Same as for the reference cell  
tpId-r14 Not present Transmission Points not used Rel-14 onwards prs-only-
tp-r14 Not present Not required Rel-14 onwards cpLengthCRS-r14 Not present Not
required Rel-14 onwards sameMBSFNconfigNeighbour-r14 TRUE Same as for the
reference cell Rel-14 onwards dlBandwidth-r14 Not present Same as for the
reference cell and PRS frequency hopping not used Rel-14 onwards
addPRSconfigNeighbour-r14 Not present **_No additional PRS configuration(s)_**
Rel-14 onwards tdd-config-v1520 Not present Rel-15 onwards }  
}
* * *
Table 9.3.1.2.3.3-2b: Sequence data values for 18 instances of sequence for
Table 9.3.1.2.3.3-2a
Cell Value physCellId Value cellidentity (E-UTRAN Cell Identity) Value
expectedRSTD Value expectedRSTD-Uncertainty Comment
* * *
                                  Value eNB ID                                 Value Cell Identity
Cell 2 2 \'0000 0000 0000 0000 0001\'B \'0000 0010\'B 8192 10 As defined for
Cell 2 in 36.508 [8] Cell 4 4 \'0000 0000 0000 0000 0011\'B '0000 0100'B 8192
10 As defined for Cell 4 in 36.508 [8] Dummy cell 1 \'0000 0000 0000 0000
0001\'B \'0000 0001\'B 8253 51  
Dummy cell 3 \'0000 0000 0000 0000 0010\'B \'0000 0011\'B 8211 51  
Dummy cell 6 \'0000 0000 0000 0000 0100\'B \'0000 0110\'B 8221 51  
Dummy cell 7 \'0000 0000 0000 0000 0110\'B '0000 0111'B 8192 51  
Dummy cell 8 \'0000 0000 0000 0000 0010\'B \'0000 1000\'B 8233 51  
Dummy cell 9 \'0000 0000 0000 0000 0100\'B '0000 1001'B 8161 51  
Dummy cell 10 \'0000 0000 0000 0000 0101\'B \'0000 1010\'B 8226 51  
Dummy cell 11 \'0000 0000 0000 0000 0110\'B \'0000 1011\'B 8232 51  
Dummy cell 16 \'0000 0000 0000 0000 0010\'B \'0001 0000\'B 8223 51  
Dummy cell 111 \'0000 0000 0000 0000 1100\'B \'0110 1111\'B 8236 51  
Dummy cell 118 \'0000 0000 0000 0000 1111\'B '0111 0110'B 8223 51  
Dummy cell 119 \'0000 0000 0000 0000 1110\'B '0111 0111'B 8221 51  
Dummy cell 120 \'0000 0000 0000 0000 1111\'B '0111 1000'B 8223 51  
Dummy cell 122 \'0000 0000 0000 0000 1010\'B '0111 1010'B 8243 51  
Dummy cell 125 \'0000 0000 0000 0000 1011\'B '0111 1101'B 8253 51  
Dummy cell 126 \'0000 0000 0000 0000 1100\'B '0111 1110'B 8257 51
Table 9.3.1.2.3.3-3: _ULInformationTransfer_ (step 0a, Table 7.3.5.1.3.2-1)
Derivation Path: 38.331 clause 6.2.2
* * *
Information Element Value/remark Comment Condition ULInformationTransfer ::=
SEQUENCE {  
criticalExtensions CHOICE {  
ulInformationTransfer SEQUENCE {  
dedicatedNAS-Message OCTET STRING Set according to Table 9.3.1.2.3.3-4 UL NAS
TRANSPORT  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}
Table 9.3.1.2.3.3-4: UL NAS TRANSPORT (step 0a, Table 7.3.5.1.3.2-1)
Derivation Path: 24.501 Table 8.2.10.1.1
* * *
Information Element Value/remark Comment Condition Extended Protocol
discriminator 01111110 5GS mobility management messages  
Security header type 0000 Plain 5GS NAS message  
Spare half octet 0000  
UL NAS TRANSPORT message identity 01100111 UL NAS TRANSPORT  
Payload container type 0011 LTE Positioning Protocol (LPP) message container  
Spare half octet 0000  
Payload container Set according to Table 9.3.1.1.3.3-5 LPP Provide
Capabilities  
Additional information Present The UE includes the Routing Identifier received
in the Additional Information IE of the DOWNLINK GENERIC NAS TRANSPORT message
(step 1 Table 7.3.1.1.3.2‑1)
Table 9.3.1.2.3.3-5: LPP Request Location Information (step 1, Table
7.3.5.1.3.2-1)
* * *
Derivation Path: Table 8.4-3  
Information Element Value/remark Comment Condition As defined in Table 8.4-3
with the following exceptions:  
transactionID SEQUENCE {  
initiator locationServer  
transactionNumber 0  
}  
locationInformationType locationEstimateRequired In case of \"UE-based\"
Location method supported by the UE  
locationMeasurementsRequired In case of \"UE-assisted\" Location method
supported by the UE  
time 10
* * *
Table 9.3.1.2.3.3-6: LPP Provide Capabilities (step 0a, Table 7.3.5.1.3.2-1)
* * *
Derivation Path: Table 7.3.5.1.3.3-7  
Information Element Value/remark Comment Condition As defined in Table ith the
following exceptions:  
LPP-Message ::= SEQUENCE {  
lpp-MessageBody CHOICE {  
c1 CHOICE {  
provideCapabilities SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
provideCapabilities-r9 SEQUENCE {  
otdoa-ProvideCapabilities Present or not present dependent on pc_OTDOA_onNR  
ecid-ProvideCapabilities Present or not present dependent on pc_ECID_onNR  
nr-ECID-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
nr-Multi-RTT-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16
onwards  
nr-DL-AoD-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
nr-DL-TDOA-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
nr-UL-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
}  
}  
}  
}  
}  
}
* * *
### 9.3.2 LPP Transport
#### 9.3.2.1 LPP Duplicated Message
Editor\'s note: Test configuration D is incomplete:
  * The corresponding attach procedure for NG-RAN E-UTRA has not yet been defined.
  * The message contents need to be revised for Test Configuration D.
##### 9.3.2.1.1 Test Purpose (TP) {#test-purpose-tp-19 .H6}
##### (1) {#section-24 .H6}
**with** { a NAS signalling connection existing }
**ensure that** {\ **when** { UE receives a LPP message carrying the same
sequence number as that last received for the\ associated location session }
**then** { UE discards the LPP message }
}
##### 9.3.2.1.2 Conformance requirements {#conformance-requirements-42 .H6}
As defined in clause 7.3.2.1.2.
##### 9.3.2.1.3 Test description {#test-description-19 .H6}
##### 9.3.2.1.3.1 Pre-test conditions {#pre-test-conditions-19 .H6}
##### System Simulator: {#system-simulator-16 .H6}
\- For Test Configuration B (Table 9.3.2.1.3.2-1): NR Cell 1.
\- For Test Configuration D (Table 9.3.2.1.3.2-1): LTE Cell 1.
##### UE: {#ue-33 .H6}
-
##### Preamble: {#preamble-19 .H6}
\- For Test Configuration B (Table 9.3.2.1.3.2-1): The UE is in state 3N-A as
defined in TS 38.508-1 [30], subclause 4.4A on NR Cell 1.
\- For Test Configuration D (Table 9.3.2.1.3.2-1): FFS.
##### Related PICS/PIXIT Statements: {#related-picspixit-statements-51 .H6}
-
##### 9.3.2.1.3.2 Test procedure sequence {#test-procedure-sequence-18 .H6}
Table 9.3.2.1.3.2-1: Test Configuration
* * *
**Test Configuration** **Network Deployment Type** **Test Implementation** A
EN-DC Functionality is tested by test case 7.3.2.1 B NG-RAN NR  
C NE-DC Functionality is tested by test configuration B D NG-RAN E-UTRA  
E NGEN-DC Functionality is tested by test configuration D
* * *
Main behaviour is as defined in Table 7.3.2.1.3.2-1.
##### 9.3.2.1.3.3 Specific message contents {#specific-message-contents-52
.H6}
As defined in clause 7.3.2.1.3.3, with the following exceptions:
Table 9.3.2.1.3.3-1 replaces Table 7.3.2.1.3.3-1, Table 9.3.2.1.3.3-2 replaces
Table 7.3.2.1.3.3-2, Table 9.3.2.1.3.3-3 replaces Table 7.3.2.1.3.3-4, Table
9.3.2.1.3.3-4 replaces Table 7.3.2.1.3.3-5, Table 9.3.2.1.3.3-2a replaces
Table 7.3.2.1.3.3-3 and Table 9.3.2.1.3.3-5 replaces Table 7.3.2.1.3.3-6.
_Table_ 9.3.2.1.3.3-1 _:_ _DLInformationTransfer_ (steps 1, 2, and 3a, Table
7.3.2.1.3.2-1)
Derivation Path: 38.331 clause 6.2.2
* * *
Information Element Value/remark Comment Condition DLInformationTransfer ::=
SEQUENCE {  
rrc-TransactionIdentifier  
criticalExtensions CHOICE {  
dlInformationTransfer SEQUENCE {  
dedicatedNAS-Message OCTET STRING Set according to Table 9.3.2.1.3.3-2 DL NAS
TRANSPORT  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}
Table 9.3.2.1.3.3-2: DL NAS TRANSPORT (steps 1, 2 and 3a, Table 7.3.2.1.3.2‑1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 24.501 | | | | | Table | | | | | 8.2.11.1.1 | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Extended | 01111110 | 5GS mobility | | | Protocol | | management | | | discriminator | | messages | | +-----------------+-----------------+-----------------+-----------+ | Security header | 0000 | Plain 5GS NAS | | | type | | message | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | Downlink | | | octet | | generic NAS | | | | | transport | | +-----------------+-----------------+-----------------+-----------+ | DL NAS | 01101000 | DL NAS | | | TRANSPORT | | transport | | | message | | | | | identity | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | 0011 | LTE Positioning | | | container type | | Protocol (LPP) | | | | | message | | | | | container | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | | | | octet | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | **Step 1 and | LPP Request | | | container | 2:** | Capabilities | | | | | | | | | Set according | | | | | to Table | | | | | 9.3.2.1.3.3-2a | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 3a:** | LPP | | | | | Acknowledgement | | | | Set according | | | | | to Table | | | | | 7.3.2.1.3.3-7 | | | +-----------------+-----------------+-----------------+-----------+ | Additional | Present | Routing | | | information | | Identif | | | | | ier/Correlation | | | | | ID | | +-----------------+-----------------+-----------------+-----------+
Table 9.3.2.1.3.3-2a: LPP Request Capabilities (steps 1 and 2, Table
7.3.2.1.3.2-1)
* * *
Derivation Path: Table 8.4-1  
Information Element Value/remark Comment Condition As defined in Table 8.4-1
with the following exceptions:  
sequenceNumber 0
* * *
Table 9.3.2.1.3.3-3: _ULInformationTransfer_ (step 3, Table 7.3.2.1.3.2-1)
Derivation Path: 38.331 clause 6.2.2
* * *
Information Element Value/remark Comment Condition ULInformationTransfer ::=
SEQUENCE {  
criticalExtensions CHOICE {  
ulInformationTransfer SEQUENCE {  
dedicatedNAS-Message OCTET STRING Set according to Table 9.3.2.1.3.3-4 UL NAS
TRANSPORT  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}
Table 9.3.2.1.3.3-4: UL NAS TRANSPORT (step 3, Table 7.3.2.1.3.2-1)
Derivation Path: 24.501 Table 8.2.10.1.1
* * *
Information Element Value/remark Comment Condition Extended Protocol
discriminator 01111110 5GS mobility management messages  
Security header type 0000 Plain 5GS NAS message  
Spare half octet 0000  
UL NAS TRANSPORT message identity 01100111 UL NAS TRANSPORT  
Payload container type 0011 LTE Positioning Protocol (LPP) message container  
Spare half octet 0000  
Payload container Set according to Table 9.3.2.1.3.3-5 LPP Provide
Capabilities  
Additional information Present The UE includes the Routing Identifier received
in the Additional Information IE of the DOWNLINK GENERIC NAS TRANSPORT message
(step 1 Table 7.3.2.1.3.2‑1)
Table 9.3.2.1.3.3-5: LPP Provide Capabilities (step 3, Table 7.3.2.1.3.2-1)
* * *
Derivation Path: Table 7.3.2.2.3.3-6  
Information Element Value/remark Comment Condition As defined in Table
7.3.2.2.3.3-6 with the following exceptions:  
LPP-Message ::= SEQUENCE {  
lpp-MessageBody CHOICE {  
c1 CHOICE {  
provideCapabilities SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
provideCapabilities-r9 SEQUENCE {  
otdoa-ProvideCapabilities Present or not present dependent on pc_OTDOA_onNR  
ecid-ProvideCapabilities Present or not present dependent on pc_ECID_onNR  
nr-ECID-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
nr-Multi-RTT-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16
onwards  
nr-DL-AoD-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
nr-DL-TDOA-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
nr-UL-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
}  
}  
}  
}  
}  
}
* * *
#### 9.3.2.2 LPP Acknowledgment
Editor\'s note: Test configuration D is incomplete:
  * The corresponding attach procedure for NG-RAN E-UTRA has not yet been defined.
  * The message contents need to be revised for Test Configuration D.
##### 9.3.2.2.1 Test Purpose (TP) {#test-purpose-tp-20 .H6}
##### (1) {#section-25 .H6}
**with** { a NAS signalling connection existing }
**ensure that** {\ **when** { UE receives a LPP message carrying an
acknowledgement request indicator }
**then** { UE returns an acknowledgement response }
}
##### 9.3.2.2.2 Conformance requirements {#conformance-requirements-43 .H6}
As defined in clause 7.3.2.2.2.
##### 9.3.2.2.3 Test description {#test-description-20 .H6}
##### 9.3.2.2.3.1 Pre-test conditions {#pre-test-conditions-20 .H6}
##### System Simulator: {#system-simulator-17 .H6}
\- For Test Configuration B (Table 9.3.2.2.3.2-1): NR Cell 1.
\- For Test Configuration D (Table 9.3.2.2.3.2-1): LTE Cell 1.
##### UE: {#ue-34 .H6}
-
##### Preamble: {#preamble-20 .H6}
\- For Test Configuration B (Table 9.3.2.2.3.2-1): The UE is in state 3N-A as
defined in TS 38.508-1 [30], subclause 4.4A on NR Cell 1.
\- For Test Configuration D (Table 9.3.2.2.3.2-1): FFS.
##### Related PICS/PIXIT Statements: {#related-picspixit-statements-52 .H6}
-
##### 9.3.2.2.3.2 Test procedure sequence {#test-procedure-sequence-19 .H6}
Table 9.3.2.2.3.2-1: Test Configuration
* * *
**Test Configuration** **Network Deployment Type** **Test Implementation** A
EN-DC Functionality is tested by test case 7.3.2.2 B NG-RAN NR  
C NE-DC Functionality is tested by test configuration B D NG-RAN E-UTRA  
E NGEN-DC Functionality is tested by test configuration D
* * *
Main behaviour as defined in Table 7.3.2.2.3.2-1.
##### 9.3.2.2.3.3 Specific message contents {#specific-message-contents-53
.H6}
As defined in clause 7.3.2.2.3.3, with the following exceptions:
Table 9.3.2.2.3.3-1 replaces Table 7.3.2.2.3.3-1, Table 9.3.2.2.3.3-2 replaces
Table 7.3.2.2.3.3-2, Table 9.3.2.2.3.3-3 replaces Table 7.3.2.2.3.3-4, Table
9.3.2.2.3.3-4 replaces Table 7.3.2.2.3.3-5, Table 9.3.2.2.3.3-2a replaces
Table 7.3.2.2.3.3-3 and Table 9.3.2.2.3.3-5 replaces Table 7.3.2.2.3.3-6.
_Table_ 9.3.2.2.3.3-1 _:_ _DLInformationTransfer_ (steps 1, and 3, Table
7.3.2.2.3.2-1)
Derivation Path: 38.331 clause 6.2.2
* * *
Information Element Value/remark Comment Condition DLInformationTransfer ::=
SEQUENCE {  
rrc-TransactionIdentifier  
criticalExtensions CHOICE {  
dlInformationTransfer SEQUENCE {  
dedicatedNAS-Message OCTET STRING Set according to Table 9.3.2.2.3.3-2 DL NAS
TRANSPORT  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}
Table 9.3.2.2.3.3-2: DL NAS TRANSPORT (steps 1, and 3, Table 7.3.2.2.3.2‑1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 24.501 | | | | | Table | | | | | 8.2.11.1.1 | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Extended | 01111110 | 5GS mobility | | | Protocol | | management | | | discriminator | | messages | | +-----------------+-----------------+-----------------+-----------+ | Security header | 0000 | Plain 5GS NAS | | | type | | message | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | Downlink | | | octet | | generic NAS | | | | | transport | | +-----------------+-----------------+-----------------+-----------+ | DL NAS | 01101000 | DL NAS | | | TRANSPORT | | transport | | | message | | | | | identity | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | 0011 | LTE Positioning | | | container type | | Protocol (LPP) | | | | | message | | | | | container | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | | | | octet | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | **Step 1:** | LPP Request | | | container | | Capabilities | | | | Set according | | | | | to Table | | | | | 9.3.2.2.3.3-2a | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 3:** | LPP | | | | | Acknowledgement | | | | Set according | | | | | to Table | | | | | 7.3.2.2.3.3-8 | | | +-----------------+-----------------+-----------------+-----------+ | Additional | Present | Routing | | | information | | Identif | | | | | ier/Correlation | | | | | ID | | +-----------------+-----------------+-----------------+-----------+
Table 9.3.2.2.3.3-2a: LPP Request Capabilities (step 1, Table 7.3.2.2.3.2-1)
* * *
Derivation Path: Table 8.4-2  
Information Element Value/remark Comment Condition As defined in Table 8.4-2
with the following exceptions:  
sequenceNumber 0  
acknowledgement SEQUENCE {  
ackRequested TRUE  
ackIndicator Not present  
}
* * *
Table 9.3.2.2.3.3-3: _ULInformationTransfer_ (step 2, Table 7.3.2.2.3.2-1)
Derivation Path: 38.331 clause 6.2.2
* * *
Information Element Value/remark Comment Condition ULInformationTransfer ::=
SEQUENCE {  
criticalExtensions CHOICE {  
ulInformationTransfer SEQUENCE {  
dedicatedNAS-Message OCTET STRING Set according to Table 9.3.2.2.3.3-4 UL NAS
TRANSPORT  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}
Table 9.3.2.2.3.3-4: UL NAS TRANSPORT (step 2, Table 7.3.2.2.3.2-1)
Derivation Path: 24.501 Table 8.2.10.1.1
* * *
Information Element Value/remark Comment Condition Extended Protocol
discriminator 01111110 5GS mobility management messages  
Security header type 0000 Plain 5GS NAS message  
Spare half octet 0000  
UL NAS TRANSPORT message identity 01100111 UL NAS TRANSPORT  
Payload container type 0011 LTE Positioning Protocol (LPP) message container  
Spare half octet 0000  
Payload container Set according to Table 9.3.2.2.3.3-5 LPP Provide
Capabilities  
Additional information Present The UE includes the Routing Identifier received
in the Additional Information IE of the DOWNLINK GENERIC NAS TRANSPORT message
(step 1 Table 7.3.2.2.3.2‑1)
Table 9.3.2.2.3.3-5: LPP Provide Capabilities (step 2, Table 7.3.2.2.3.2-1)
* * *
Derivation Path: Table 7.3.2.2.3.3-6  
Information Element Value/remark Comment Condition As defined in Table
7.3.2.2.3.3-6 with the following exceptions:  
LPP-Message ::= SEQUENCE {  
lpp-MessageBody CHOICE {  
c1 CHOICE {  
provideCapabilities SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
provideCapabilities-r9 SEQUENCE {  
otdoa-ProvideCapabilities Present or not present dependent on pc_OTDOA_onNR  
ecid-ProvideCapabilities Present or not present dependent on pc_ECID_onNR  
nr-ECID-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
nr-Multi-RTT-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16
onwards  
nr-DL-AoD-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
nr-DL-TDOA-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
nr-UL-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
}  
}  
}  
}  
}  
}
* * *
#### 9.3.2.3 LPP Retransmission
Editor\'s note: Test configuration D is incomplete:
  * The corresponding attach procedure for NG-RAN E-UTRA has not yet been defined.
  * The message contents need to be revised for Test Configuration D.
##### 9.3.2.3.1 Test Purpose (TP) {#test-purpose-tp-21 .H6}
##### (1) {#section-26 .H6}
**with** { a NAS signalling connection for EPC-NI-LR session existing}
**ensure that** {
**when** { UE does not receive an LPP acknowledgement for an LPP message which
requires\ acknowledgement }
**then** { UE retransmits the LPP message up to three times. If still
unacknowledged after that, the\ UE aborts all LPP activity for the associated
session}
}
##### 9.3.2.3.2 Conformance requirements {#conformance-requirements-44 .H6}
As defined in clause 7.3.2.3.2.
##### 9.3.2.3.3 Test description {#test-description-21 .H6}
##### 9.3.2.3.3.1 Pre-test conditions {#pre-test-conditions-21 .H6}
##### System Simulator: {#system-simulator-18 .H6}
\- For Test Configuration B (Table 9.3.2.3.3.2-1): NR Cell 1.
\- For Test Configuration D (Table 9.3.2.3.3.2-1): LTE Cell 1.
##### UE: {#ue-35 .H6}
-
##### Preamble: {#preamble-21 .H6}
\- For Test Configuration B (Table 9.3.2.3.3.2-1): The UE is in state 3N-A as
defined in TS 38.508-1 [30], subclause 4.4A on NR Cell 1.
\- For Test Configuration D (Table 9.3.2.3.3.2-1): FFS.
##### Related PICS/PIXIT Statements: {#related-picspixit-statements-53 .H6}
-
##### 9.3.2.3.3.2 Test procedure sequence {#test-procedure-sequence-20 .H6}
Table 9.3.2.3.3.2-1: Test Configuration
* * *
**Test Configuration** **Network Deployment Type** **Test Implementation** A
EN-DC Functionality is tested by test case 7.3.2.3 B NG-RAN NR  
C NE-DC Functionality is tested by test configuration B D NG-RAN E-UTRA  
E NGEN-DC Functionality is tested by test configuration D
* * *
Main behaviour as defined in Table 7.3.2.3.3.2-1.
##### 9.3.2.3.3.3 Specific message contents {#specific-message-contents-54
.H6}
As defined in clause 7.3.2.3.3.3, with the following exceptions:
Table 9.3.2.3.3.3-1 replaces Table 7.3.2.3.3.3-1, Table 9.3.2.3.3.3-2 replaces
Table 7.3.2.3.3.3-2, Table 9.3.2.3.3.3-3 replaces Table 7.3.2.3.3.3-4, Table
9.3.2.3.3.3-4 replaces Table 7.3.2.3.3.3-5 and Table 9.3.2.3.3.3-5 replaces
Table 7.3.2.3.3.3-6.
_Table_ 9.3.2.3.3.3-1 _:_ _DLInformationTransfer_ (step 1, Table
7.3.2.3.3.2-1)
Derivation Path: 38.331 clause 6.2.2
* * *
Information Element Value/remark Comment Condition DLInformationTransfer ::=
SEQUENCE {  
rrc-TransactionIdentifier  
criticalExtensions CHOICE {  
dlInformationTransfer SEQUENCE {  
dedicatedNAS-Message OCTET STRING Set according to Table 9.3.2.3.3.3-2 DL NAS
TRANSPORT  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}
Table 9.3.2.3.3.3-2: DL NAS TRANSPORT (steps 1 and 2a, Table 7.3.2.3.3.2‑1)
Derivation Path: 24.501 Table 8.2.11.1.1
* * *
Information Element Value/remark Comment Condition Extended Protocol
discriminator 01111110 5GS mobility management messages  
Security header type 0000 Plain 5GS NAS message  
Spare half octet 0000 Downlink generic NAS transport  
DL NAS TRANSPORT message identity 01101000 DL NAS transport  
Payload container type 0011 LTE Positioning Protocol (LPP) message container  
Spare half octet 0000  
Payload container Set according to Table _8.4-2_ LPP Request Capabilities  
Additional information Present Routing Identifier/Correlation ID
Table 9.3.2.3.3.3-3: _ULInformationTransfer_ (steps 2, 4, 6, and 8, Table
7.3.2.3.3.2-1)
Derivation Path: 38.331 clause 6.2.2
* * *
Information Element Value/remark Comment Condition ULInformationTransfer ::=
SEQUENCE {  
criticalExtensions CHOICE {  
ulInformationTransfer SEQUENCE {  
dedicatedNAS-Message OCTET STRING Set according to Table 9.3.2.3.3.3-4 UL NAS
TRANSPORT  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}
Table 9.3.2.3.3.3-4: UL NAS TRANSPORT (steps 2, 4, 6, and 8, Table
7.3.2.3.3.2-1)
Derivation Path: 24.501 Table 8.2.10.1.1
* * *
Information Element Value/remark Comment Condition Extended Protocol
discriminator 01111110 5GS mobility management messages  
Security header type 0000 Plain 5GS NAS message  
Spare half octet 0000  
UL NAS TRANSPORT message identity 01100111 UL NAS TRANSPORT  
Payload container type 0011 LTE Positioning Protocol (LPP) message container  
Spare half octet 0000  
Payload container Set according to Table Table 9.3.2.3.3.3-5 LPP Provide
Capabilities  
Additional information Present The UE includes the Routing Identifier received
in the Additional Information IE of the DOWNLINK GENERIC NAS TRANSPORT message
(step 1 Table 7.3.2.3.3.2‑1)
Table 9.3.2.3.3.3-5: LPP Provide Capabilities (steps 2, 4, 6, and 8, Table
7.3.2.3.3.2-1)
* * *
Derivation Path: Table 7.3.2.3.3.3-6  
Information Element Value/remark Comment Condition As defined in Table
7.3.2.3.3.3-6 with the following exceptions:  
LPP-Message ::= SEQUENCE {  
lpp-MessageBody CHOICE {  
c1 CHOICE {  
provideCapabilities SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
provideCapabilities-r9 SEQUENCE {  
otdoa-ProvideCapabilities Present or not present dependent on pc_OTDOA_onNR  
ecid-ProvideCapabilities Present or not present dependent on pc_ECID_onNR  
nr-ECID-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
nr-Multi-RTT-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16
onwards  
nr-DL-AoD-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
nr-DL-TDOA-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
nr-UL-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
}  
}  
}  
}  
}  
}
* * *
### 9.3.3 LPP Error Handling
#### 9.3.3.1 Void
#### 9.3.3.1A Void
#### 9.3.3.1B LPP Requested Method not Supported -- UE-Assisted
Editor\'s note: Test configuration D is incomplete:
  * The corresponding attach procedure for NG-RAN E-UTRA has not yet been defined.
  * The message contents need to be revised for Test Configuration D.
##### 9.3.3.1B.1 Test Purpose (TP) {#b.1-test-purpose-tp-1 .H6}
##### (1) {#section-27 .H6}
**with** { a UE supporting at least one of UE-assisted GNSS, UE-assisted OTDOA
(LTE) (LPP Rel-15 onwards), UE-assisted ECID (LTE) (Test Configuration D
only), UE-assisted WLAN, UE-assisted Bluetooth, UE-assisted Sensor, UE-
assisted MBS, UE-assisted DL-TDOA, UE-assisted DL-AoD, UE-assisted Multi-RTT
or UE-assisted NR E-CID but not all of them }
**and with** { a NAS signalling connection existing }
**ensure that** {\ **when** { UE receives a LPP message requesting at least
one location method not supported }
**then** { the UE provides location information for the supported methods}
}
##### 9.3.3.1B.2 Conformance requirements {#b.2-conformance-requirements-1
.H6}
As defined in clause 7.3.3.1B.2.
##### 9.3.3.1B.3 Test description {#b.3-test-description-1 .H6}
##### 9.3.3.1B.3.1 Pre-test conditions {#b.3.1-pre-test-conditions-1 .H6}
System Simulator:
For Test Configuration B (Table 9.3.3.1B.3.2-1):
\- If GNSS is supported by the UE: NR Cell 1 and satellite signals, as
specified in 8.2.1.
\- If OTDOA (LTE) is supported by the UE: NR Cell 1 independent and LTE Cell 1
and LTE Cell 2 as specified in 8.2.2.
\- If WLAN is supported by the UE: NR Cell 1 and WLAN signals, as specified in
8.2.5.
\- If Bluetooth is supported by the UE: NR Cell 1 and Bluetooth signals, as
specified in 8.2.6.
\- If Sensor is supported by the UE: NR Cell 1.
\- If MBS is supported by the UE: NR Cell 1 and MBS signals, as specified in
8.2.4.
\- If DL-TDOA is supported by the UE: NR Cell 1 and NR Cell 2, as specified in
8.2.11.
\- If DL-AoD is supported by the UE: NR Cell 1, as specified in 8.2.10.
\- If Multi-RTT is supported by the UE: NR Cell 1, as specified in 8.2.9.
\- If NR E-CID is supported by the UE: NR Cell 1, as specified in 8.2.12.
For Test Configuration D (Table 9.3.3.1B.3.2-1):
\- If GNSS is supported by the UE: LTE Cell 1 and satellite signals, as
specified in 8.2.1.
\- If OTDOA (LTE) is supported by the UE: LTE Cell 1 and LTE Cell 2, as
specified in 8.2.2
\- If ECID (LTE) is supported by the UE: LTE Cell 1 and LTE Cell 2, as
specified in 8.2.3.
\- If WLAN is supported by the UE: LTE Cell 1 and WLAN signals, as specified
in 8.2.5.
\- If Bluetooth is supported by the UE: LTE Cell 1 and Bluetooth signals, as
specified in 8.2.6.
\- If Sensor is supported by the UE: LTE Cell 1.
\- If MBS is supported by the UE: LTE Cell 1 and MBS signals, as specified in
8.2.4.
##### UE: {#ue-36 .H6}
-
##### Preamble: {#preamble-22 .H6}
\- For Test Configuration B (Table 9.3.3.1B.3.2-1): The UE is in state 3N-A as
defined in TS 38.508-1 [30], subclause 4.4A on NR Cell 1.
> \- If OTDOA (LTE) is supported by the UE then after the UE is in state 3N-A,
> the SS shall execute the steps in Table 9.3.3.1B.3.1-1 for the configuration
> of measurement gaps for OTDOA (LTE).
>
> \- If DL-TDOA is supported by the UE then after the UE is in state 3N-A, the
> SS shall execute the steps in Table 9.3.3.1B.3.1-1 for the configuration of
> measurement gaps for DL-TDOA.
>
> \- If DL-AoD is supported by the UE then after the UE is in state 3N-A, the
> SS shall execute the steps in Table 9.3.3.1B.3.1-1 for the configuration of
> measurement gaps for DL-AoD.
>
> \- If Multi-RTT is supported by the UE then after the UE is in state 3N-A,
> the SS shall execute the steps in Table 9.3.3.1B.3.1-1 for the configuration
> of measurement gaps for Multi-RTT and then the SS shall execute the steps in
> Table 9.3.3.1B.3.1-2 for the configuration of UL-SRS for Multi-RTT.
Table 9.3.3.1B.3.1-1: Configuration of measurement gaps
St Procedure Message Sequence TP Verdict
* * *
                                                                         U - S              Message
1 The SS sends an RRCReconfiguration message as in Table 8.3.1-1. \ RRCReconfigurationComplete - -
Table 9.3.3.1B.3.1-2: Configuration of UL-SRS for Multi-RTT
St Procedure Message Sequence TP Verdict
* * *
                                                                         U - S              Message
1 The SS sends an RRCReconfiguration message as in Table 8.3.2-1. \ RRCReconfigurationComplete - -
\- For Test Configuration D (Table 9.3.3.1B.3.2-1): FFS.
##### Related PICS/PIXIT Statements: {#related-picspixit-statements-54 .H6}
-
##### 9.3.3.1B.3.2 Test procedure sequence {#b.3.2-test-procedure-sequence-1
.H6}
Table 9.3.3.1B.3.2-1: Test Configuration
* * *
**Test Configuration** **Network Deployment Type** **Test Implementation** A
EN-DC Functionality is tested by test case 7.3.3.1B B NG-RAN NR  
C NE-DC Functionality is tested by test configuration B D NG-RAN E-UTRA  
E NGEN-DC Functionality is tested by test configuration D
* * *
Main behaviour as defined in clause 7.3.3.1B.3.2.
##### 9.3.3.1B.3.3 Specific message contents {#b.3.3-specific-message-
contents-1 .H6}
As defined in clause 7.3.3.1B.3.3, with the following exceptions:
Table 9.3.3.1B.3.3-1 replaces Table 7.3.3.1B.3.3-1, Table 9.3.3.1B.3.3-2
replaces Table 7.3.3.1B.3.3-2, Table 9.3.3.1B.3.3-2a replaces Table
7.3.3.1B.3.3-3, Table 9.3.3.1B.3.3-3 replaces Table 7.3.3.1B.3.3-5, Table
9.3.3.1B.3.3-4 replaces Table 7.3.3.1B.3.3-6, Table 9.3.3.1B.3.3.5 replaces
Table 7.3.3.1B.3.3-4, Table 9.3.3.1B.3.3.6 replaces Table 7.3.3.1B.3.3-6a and
Table 9.3.3.1B.3.3-7 replaces Table 7.3.3.1B.3.3-7.
_Table_ 9.3.3.1B.3.3-1 _:_ _DLInformationTransfer_ (steps 0, 0b, 1, 2 and 3a,
Table 7.3.3.1B.3.2-1)
Derivation Path: 38.331 clause 6.2.2
* * *
Information Element Value/remark Comment Condition DLInformationTransfer ::=
SEQUENCE {  
rrc-TransactionIdentifier  
criticalExtensions CHOICE {  
dlInformationTransfer SEQUENCE {  
dedicatedNAS-Message OCTET STRING Set according to Table 9.3.3.1B.3.3-2 DL NAS
TRANSPORT  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}
Table 9.3.3.1B.3.3-2: DL NAS TRANSPORT (steps 0, 0b, 1, 2 and 3a, Table
7.3.3.1B.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 24.501 | | | | | Table | | | | | 8.2.11.1.1 | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Extended | 01111110 | 5GS mobility | | | Protocol | | management | | | discriminator | | messages | | +-----------------+-----------------+-----------------+-----------+ | Security header | 0000 | Plain 5GS NAS | | | type | | message | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | Downlink | | | octet | | generic NAS | | | | | transport | | +-----------------+-----------------+-----------------+-----------+ | DL NAS | 01101000 | DL NAS | | | TRANSPORT | | transport | | | message | | | | | identity | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | 0011 | LTE Positioning | | | container type | | Protocol (LPP) | | | | | message | | | | | container | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | | | | octet | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | **Step 0:** | LPP Request | | | container | | Capabilities. | | | | Set according | | | | | to Table | | | | | _8.4-2_ | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 1:** | LPP Provide | | | | | Assistance Data | | | | Set according | | | | | to Table | | | | | 9.3.3.1B.3.3-2a | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 2:** | LPP Request | | | | | Location | | | | Set according | Information | | | | to Table | | | | | 9.3.3.1B.3.3-5 | | | +-----------------+-----------------+-----------------+-----------+ | | **Steps 0b and | LPP | | | | 3a:** | Acknowledgement | | | | | | | | | Set according | | | | | to Table | | | | | 7.3.3.1B.3.3-8 | | | +-----------------+-----------------+-----------------+-----------+ | Additional | Present | Routing | | | information | | Identif | | | | | ier/Correlation | | | | | ID | | +-----------------+-----------------+-----------------+-----------+
Table 9.3.3.1B.3.3-2a: LPP Provide Assistance data (step 1, Table
7.3.3.1B.3.2-1)
* * *
Derivation Path: Table 8.4-1  
Information Element Value/remark Comment Condition As defined in Table 8.4-1
with the following exceptions:  
transactionID SEQUENCE {  
Initiator locationServer  
transactionNumber (0..255)  
}  
a-gnss-ProvideAssistanceData Present for all supported GNSSs if UE supports
UE-assisted A-GNSS. As defined in clause 8.4  
otdoa-ProvideAssistanceData Present if UE supports UE-assisted OTDOA (LTE). As
defined in clause 8.4  
sensor-ProvideAssistanceData-r14 Present if UE supports UE-assisted Sensor. As
defined in clause 8.4 Rel-14 onwards  
tbs-ProvideAssistanceData-r14 Present if UE supports UE-assisted MBS. As
defined in clause 8.4 Rel-14 onwards  
wlan-ProvideAssistanceData-r14 Present if UE supports UE-assisted WLAN. As
defined in clause 8.4 Rel-14 onwards  
nr-Multi-RTT-ProvideAssistanceData Present if UE supports UE-assisted Multi-
RTT. As defined in clause 8.4 Rel-16 onwards  
nr-DL-AoD-ProvideAssistanceData-r16 Present if UE supports UE-assisted DL-AoD.
As defined in clause 8.4 Rel-16 onwards  
nr-DL-TDOA-ProvideAssistanceData-r16 Present if UE supports UE-assisted DL-
TDOA. As defined in clause 8.4 Rel-16 onwards
* * *
Table 9.3.3.1B.3.3-3: _ULInformationTransfer_ (steps 0a and 3, Table
7.3.3.1B.3.2-1)
Derivation Path: 38.331 clause 6.2.2
* * *
Information Element Value/remark Comment Condition ULInformationTransfer ::=
SEQUENCE {  
criticalExtensions CHOICE {  
ulInformationTransfer SEQUENCE {  
dedicatedNAS-Message OCTET STRING Set according to Table 9.3.3.1B.3.3-4 UL NAS
TRANSPORT  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}
Table 9.3.3.1B.3.3-4: UL NAS TRANSPORT (steps 0a and 3, Table 7.3.3.1B.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 24.501 | | | | | Table | | | | | 8.2.10.1.1 | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Extended | 01111110 | 5GS mobility | | | Protocol | | management | | | discriminator | | messages | | +-----------------+-----------------+-----------------+-----------+ | Security header | 0000 | Plain 5GS NAS | | | type | | message | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | | | | octet | | | | +-----------------+-----------------+-----------------+-----------+ | UL NAS | 01100111 | UL NAS | | | TRANSPORT | | TRANSPORT | | | message | | | | | identity | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | 0011 | LTE Positioning | | | container type | | Protocol (LPP) | | | | | message | | | | | container | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | | | | octet | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | **Step 0a:** | LPP Provide | | | container | | Capabilities | | | | Set according | | | | | to Table | | | | | 9.3.3.1B.3.3-6 | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 3:** | LPP Provide | | | | | Location | | | | Set according | Information | | | | to Table | | | | | | | | | | 9.3.3.1B.3.3-7 | | | +-----------------+-----------------+-----------------+-----------+ | Additional | Present | The UE includes | | | information | | the Routing | | | | | Identifier | | | | | received in the | | | | | Additional | | | | | Information IE | | | | | of the DOWNLINK | | | | | GENERIC NAS | | | | | TRANSPORT | | | | | message (step 1 | | | | | Table | | | | | 7.3.3.1B.3.2‑1) | | +-----------------+-----------------+-----------------+-----------+
Table 9.3.3.1B.3.3-5: LPP Request Location Information (step 2, Table
7.3.3.1B.3.2-1)
* * *
Derivation Path: Table 5.4-3  
Information Element Value/remark Comment Condition As defined in Table 5.4-3
with the following exceptions:  
locationInformationType locationMeasurementsRequired  
a-gnss-RequestLocationInformation Present. As defined in Table 5.4-4  
gnss-Methods GNSS-ID-Bitmap: bits 0, 3, 4, 5 = 1  
otdoa-RequestLocationInformation Present. As defined in Table 5.4-5  
ecid-RequestLocationInformation Present. As defined in Table 5.4-6  
requestedMeasurements Test Configuration D: bits 0, 1, 2 = 1  
tbs-RequestLocationInformation-r13 Present. As defined in Table 5.4-7 Rel-13
onwards  
sensor-RequestLocationInformation-r13 Present. As defined in Table 5.4-10
Rel-13 onwards  
wlan-RequestLocationInformation-r13 Present. As defined in Table 5.4-8 Rel-13
onwards  
bt-RequestLocationInformation-r13 Present. As defined in Table 5.4-9 Rel-13
onwards  
nr-ECID-RequestLocationInformation-r16 Present. As defined in Table _8.4-4_
Rel-16 onwards  
nr-Multi-RTT-RequestLocationInformation-r16 Present. As defined in Table
_8.4-5_ Rel-16 onwards  
nr-DL-AoD-RequestLocationInformation-r16 Present. As defined in Table _8.4-6_
Rel-16 onwards  
nr-DL-TDOA-RequestLocationInformation-r16 Present. As defined in Table _8.4-7_
Rel-16 onwards
* * *
Table 9.3.3.1B.3.3-6: LPP Provide Capabilities (step 0a, Table 7.3.3.1B.3.2-1)
* * *
Derivation Path: Table 7.3.3.1B.3.3-6a  
Information Element Value/remark Comment Condition As defined in Table
7.3.3.1B.3.3-6a with the following exceptions:  
LPP-Message ::= SEQUENCE {  
lpp-MessageBody CHOICE {  
c1 CHOICE {  
provideCapabilities SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
provideCapabilities-r9 SEQUENCE {  
otdoa-ProvideCapabilities Present or not present dependent on pc_OTDOA_onNR  
ecid-ProvideCapabilities Present or not present dependent on pc_ECID_onNR  
nr-ECID-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
nr-Multi-RTT-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16
onwards  
nr-DL-AoD-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
nr-DL-TDOA-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
nr-UL-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
}  
}  
}  
}  
}  
}
* * *
Table 9.3.3.1B.3.3-7: LPP Provide Location Information (step 3, Table
7.3.3.1B.3.2-1)
+-----------------+-----------------+----------------+-----------+ | Derivation | | | | | Path: Table | | | | | 7.3.3.1B.3.3-7 | | | | +-----------------+-----------------+----------------+-----------+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+----------------+-----------+ | As defined in | | | | | Table | | | | | 7.3.3.1B.3.3-7 | | | | | with the | | | | | following | | | | | exceptions: | | | | +-----------------+-----------------+----------------+-----------+ | LPP-Message ::= | | | | | SEQUENCE { | | | | +-----------------+-----------------+----------------+-----------+ | lpp-MessageBody | | | | | CHOICE { | | | | +-----------------+-----------------+----------------+-----------+ | c1 CHOICE { | | | | +-----------------+-----------------+----------------+-----------+ | provideLoca | | | | | tionInformation | | | | | SEQUENCE { | | | | +-----------------+-----------------+----------------+-----------+ | cri | | | | | ticalExtensions | | | | | CHOICE { | | | | +-----------------+-----------------+----------------+-----------+ | c1 CHOICE { | | | | +-----------------+-----------------+----------------+-----------+ | provideLocatio | | | | | nInformation-r9 | | | | | | | | | | SEQUENCE { | | | | +-----------------+-----------------+----------------+-----------+ | nr-Multi-RTT- | Present if UE | Rel-16 onwards | | | ProvideLocation | supports | | | | Information-r16 | UE-assisted | | | | SEQUENCE { | Multi-RTT. | | | +-----------------+-----------------+----------------+-----------+ | nr-Multi-RTT-Si | Present. Any | | | | gnalMeasurement | value | | | | Information-r16 | acceptable | | | +-----------------+-----------------+----------------+-----------+ | nr-Mult | May be present | | | | i-RTT-Error-r16 | | | | +-----------------+-----------------+----------------+-----------+ | } | | | | +-----------------+-----------------+----------------+-----------+ | | Present if UE | Rel-16 onwards | | | nr-DL-AoD- | supports | | | | ProvideLocation | UE-assisted | | | | Information-r16 | DL-AoD. | | | | SEQUENCE { | | | | +-----------------+-----------------+----------------+-----------+ | nr-DL-AoD-Si | Present. Any | | | | gnalMeasurement | value | | | | Information-r16 | acceptable | | | +-----------------+-----------------+----------------+-----------+ | nr- | Not present | | | | dl-AoD-Location | | | | | Information-r16 | | | | +-----------------+-----------------+----------------+-----------+ | nr-D | May be present | | | | L-AoD-Error-r16 | | | | +-----------------+-----------------+----------------+-----------+ | } | | | | +-----------------+-----------------+----------------+-----------+ | nr-DL-TDOA- | Present if UE | Rel-16 onwards | | | ProvideLocation | supports | | | | Information-r16 | UE-assisted | | | | SEQUENCE { | DL-TDOA. | | | +-----------------+-----------------+----------------+-----------+ | nr-DL-TDOA-Si | Present. Any | | | | gnalMeasurement | value | | | | Information-r16 | acceptable | | | +-----------------+-----------------+----------------+-----------+ | nr-d | Not present | | | | l-tdoa-Location | | | | | Information-r16 | | | | +-----------------+-----------------+----------------+-----------+ | nr-DL | May be present | | | | -TDOA-Error-r16 | | | | +-----------------+-----------------+----------------+-----------+ | } | | | | +-----------------+-----------------+----------------+-----------+ | nr-ECID- | Present if UE | Rel-16 onwards | | | ProvideLocation | supports | | | | Information-r16 | UE-assisted NR | | | | SEQUENCE { | E-CID. | | | +-----------------+-----------------+----------------+-----------+ | nr-ECID-Si | Present. Any | | | | gnalMeasurement | value | | | | Information-r16 | acceptable | | | +-----------------+-----------------+----------------+-----------+ | nr | May be present | | | | -ECID-Error-r16 | | | | +-----------------+-----------------+----------------+-----------+ | } | | | | +-----------------+-----------------+----------------+-----------+ | } | | | | +-----------------+-----------------+----------------+-----------+ | } | | | | +-----------------+-----------------+----------------+-----------+ | } | | | | +-----------------+-----------------+----------------+-----------+ | } | | | | +-----------------+-----------------+----------------+-----------+ | } | | | | +-----------------+-----------------+----------------+-----------+ | } | | | | +-----------------+-----------------+----------------+-----------+
### 9.3.4 LPP Positioning Procedures
#### 9.3.4.1 E-SMLC Initiated Assistance Data Delivery followed by Location
Information Transfer: UE-Based
Editor\'s note: Test configuration D is incomplete:
  * The corresponding attach procedure for NG-RAN E-UTRA has not yet been defined.
  * The message contents need to be revised for Test Configuration D.
##### 9.3.4.1.1 Test Purpose (TP) {#test-purpose-tp-22 .H6}
(1)
**with** { a NAS signalling connection existing }
**ensure that** {
**when** { UE receives assistance data and a location request for UE-based }
**then** { UE sends a PROVIDE LOCATION INFORMATION message containing a
location estimate }
}
##### 9.3.4.1.2 Conformance requirements {#conformance-requirements-45 .H6}
As defined in clause 7.3.4.1.2.
##### 9.3.4.1.3 Test description {#test-description-22 .H6}
##### 9.3.4.1.3.1 Pre-test conditions {#pre-test-conditions-22 .H6}
System Simulator:
For Test Configuration B (Table 9.3.4.1.3.2-1):NR Cell 1.
\- Satellite signals (sub-test case 15): as specified in 8.2.1.
\- MBS signals (Sub-test 16): as specified in 8.2.4.
\- WLAN signals (Sub-test 17): as specified in 8.2.5.
\- Sub-test 20: NR Cell 1 and NR Cell 2, as specified in 8.2.10.
\- Sub-test 21: NR Cell 1, NR Cell 2 and NR Cell 3, as specified in 8.2.11.
For Test Configuration D (Table 9.3.4.1.3.2-1): LTE Cell 1.
\- Satellite signals (sub-test case 15): as specified in 8.2.1.
\- MBS signals (Sub-test 16): as specified in 8.2.4.
\- WLAN signals (Sub-test 17): as specified in 8.2.5.
##### UE: {#ue-37 .H6}
> The UE shall begin the test with no assistance data stored.
Preamble:
\- For Test Configuration B (Table 9.3.4.1.3.2-1): The UE is in state 3N-A as
defined in TS 38.508-1 [30], subclause 4.4A on NR Cell 1.
\- For Test Configuration D (Table 9.3.4.1.3.2-1): FFS.
Related PICS/PIXIT Statements:
> -
##### 9.3.4.1.3.2 Test procedure sequence {#test-procedure-sequence-21 .H6}
This test case includes sub-test cases dependent on the positioning method(s)
supported by the UE. Each sub-test case is identified by a Sub-Test Case
Number as defined in Table 9.3.4.1.3.2-0 below:
Table 9.3.4.1.3.2-0: Sub-test case numbers
* * *
**Sub-Test Case Number** **Supported Positioning Methods** 15 UE supporting
GNSS^(1)^ 16 UE supporting MBS (Rel-14 onwards) 17 UE supporting WLAN (Rel-14
onwards) 18 UE supporting Sensor (Rel-14 onwards) 20 UE supporting DL-AoD
(Rel-16 onwards) 21 UE supporting DL-TDOA (Rel-16 onwards) NOTE 1: The GNSS
combination of GPS, GLONASS, Galileo, BDS supported by the UE
* * *
Table 9.3.4.1.3.2-1: Test Configuration
* * *
**Test Configuration** **Network Deployment Type** **Test Implementation** A
EN-DC Functionality is tested by test case 7.3.4.1 B NG-RAN NR  
C NE-DC Functionality is tested by test configuration B D NG-RAN E-UTRA  
E NGEN-DC Functionality is tested by test configuration D
* * *
Main behaviour as defined in Table 7.3.4.1.3.2-1.
##### 9.3.4.1.3.3 Specific message contents {#specific-message-contents-55
.H6}
As defined in clause 7.3.4.1.3.3, with the following exceptions:
Table 9.3.4.1.3.3-0 replaces Table 7.3.4.1.3.3-1, Table 9.3.4.1.3.3-1 replaces
Table 7.3.4.1.3.3-2, Table 9.3.4.1.3.3-2 replaces Table 7.3.4.1.3.3-3, Table
9.3.4.1.3.3-2a replaces Table 7.3.4.1.3.3-4, Table 9.3.4.1.3.3-3 replaces
Table 7.3.4.1.3.3-6, Table 9.3.4.1.3.3-4 replaces Table 7.3.4.1.3.3-7, Table
9.3.4.1.3.3-2b replaces Table 7.3.4.1.3.3-5, Table 9.3.4.1.3.3-5 replaces
Table 7.3.4.1.3.3-7a and Table 9.3.4.1.3.3-6 replaces Table 7.3.4.1.3.3-8.
_Table_ 9.3.4.1.3.3-0 _:_ RESET UE POSITIONING STORED INFORMATION (step 1,
Table 7.3.4.1.3.2-1)
+----------------+----------------+----------------+---------------+ | Derivation | | | | | Path: 38.509 | | | | | clause 6.6 | | | | +================+================+================+===============+ | **Information | ** |** Comment**|** Condition**| | Element** | Value/remark** | | | +----------------+----------------+----------------+---------------+ | As defined in | | | | | Table | | | | | 7.3.4.1.3.3-1 | | | | | with the | | | | | following | | | | | exceptions: | | | | +----------------+----------------+----------------+---------------+ | UE Positioning | Sub-test 20: 0 | Sub-test 20: | | | Technology | 0 0 0 1 0 0 0 | DL-AoD | | | | | | | | | Sub-test 21: 0 | Sub-test 21: | | | | 0 0 0 0 1 1 1 | DL-TDOA | | +----------------+----------------+----------------+---------------+
_Table_ 9.3.4.1.3.3-1 _:_ _DLInformationTransfer_ (steps 1a, 1c, 2, 3 and 4a,
Table 7.3.4.1.3.2-1)
Derivation Path: 38.331 clause 6.2.2
* * *
Information Element Value/remark Comment Condition DLInformationTransfer ::=
SEQUENCE {  
rrc-TransactionIdentifier  
criticalExtensions CHOICE {  
dlInformationTransfer SEQUENCE {  
dedicatedNAS-Message OCTET STRING Set according to Table 9.3.4.1.3.3-2 DL NAS
TRANSPORT  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}
Table 9.3.4.1.3.3-2: DL NAS TRANSPORT (steps 1a, 1c, 2, 3 and 4a, Table
7.3.4.1.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 24.501 | | | | | Table | | | | | 8.2.11.1.1 | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Extended | 01111110 | 5GS mobility | | | Protocol | | management | | | discriminator | | messages | | +-----------------+-----------------+-----------------+-----------+ | Security header | 0000 | Plain 5GS NAS | | | type | | message | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | Downlink | | | octet | | generic NAS | | | | | transport | | +-----------------+-----------------+-----------------+-----------+ | DL NAS | 01101000 | DL NAS | | | TRANSPORT | | transport | | | message | | | | | identity | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | 0011 | LTE Positioning | | | container type | | Protocol (LPP) | | | | | message | | | | | container | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | | | | octet | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | **Step 1a:** | LPP Request | | | container | | Capabilities. | | | | Set according | | | | | to Table | | | | | _8.4-2_ | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 2:** | LPP Provide | | | | | Assistance Data | | | | Set according | | | | | to Table | | | | | 9.3.4.1.3.3-2a | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 3:** | LPP Request | | | | | Location | | | | Set according | Information | | | | to Table | | | | | 9.3.4.1.3.3-2b | | | +-----------------+-----------------+-----------------+-----------+ | | **Steps 1c and | LPP | | | | 4a:** | Acknowledgement | | | | | | | | | Set according | | | | | to Table | | | | | 7.3.4.1.3.3-9 | | | +-----------------+-----------------+-----------------+-----------+ | Additional | Present | Routing | | | information | | Identif | | | | | ier/Correlation | | | | | ID | | +-----------------+-----------------+-----------------+-----------+
Table 9.3.4.1.3.3-2a: LPP Provide Assistance data (step 2, Table
7.3.4.1.3.2-1)
* * *
Derivation Path: Table 8.4-1  
Information Element Value/remark Comment Condition As defined in Table 8.4-1
with the following exceptions:  
transactionID SEQUENCE {  
initiator locationServer  
transactionNumber (0..255)  
}
* * *
Table 9.3.4.1.3.3-2b: LPP Request Location Information (step 3, Table
7.3.4.1.3.2-1)
* * *
Derivation Path: Table 8.4-3  
Information Element Value/remark Comment Condition As defined in Table 8.4-3
with the following exceptions:  
locationInformationType locationEstimateRequired
* * *
Table 9.3.4.1.3.3-3: _ULInformationTransfer_ (steps 1b and 4, Table
7.3.4.1.3.2-1)
Derivation Path: 38.331 clause 6.2.2
* * *
Information Element Value/remark Comment Condition ULInformationTransfer ::=
SEQUENCE {  
criticalExtensions CHOICE {  
ulInformationTransfer SEQUENCE {  
dedicatedNAS-Message OCTET STRING Set according to Table 9.3.4.1.3.3-4 UL NAS
TRANSPORT  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}
Table 9.3.4.1.3.3-4: UL NAS TRANSPORT (steps 1b and 4, Table 7.3.4.1.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 24.501 | | | | | Table | | | | | 8.2.10.1.1 | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Extended | 01111110 | 5GS mobility | | | Protocol | | management | | | discriminator | | messages | | +-----------------+-----------------+-----------------+-----------+ | Security header | 0000 | Plain 5GS NAS | | | type | | message | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | | | | octet | | | | +-----------------+-----------------+-----------------+-----------+ | UL NAS | 01100111 | UL NAS | | | TRANSPORT | | TRANSPORT | | | message | | | | | identity | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | 0011 | LTE Positioning | | | container type | | Protocol (LPP) | | | | | message | | | | | container | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | | | | octet | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | **Step 1b:** | LPP Provide | | | container | | Capabilities | | | | Set according | | | | | to Table | | | | | | | | | | 9.3.4.1.3.3-5 | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 4:** | LPP Provide | | | | | Location | | | | Set according | Information | | | | to Table | | | | | | | | | | 9.3.4.1.3.3-6 | | | +-----------------+-----------------+-----------------+-----------+ | Additional | Present | The UE includes | | | information | | the Routing | | | | | Identifier | | | | | received in the | | | | | Additional | | | | | Information IE | | | | | of the DOWNLINK | | | | | GENERIC NAS | | | | | TRANSPORT | | | | | message (step 1 | | | | | Table | | | | | 7.3.4.1.3.2‑1) | | +-----------------+-----------------+-----------------+-----------+
Table 9.3.4.1.3.3-5: LPP Provide Capabilities. (step 1b, Table 7.3.4.1.3.2-1)
* * *
Derivation Path: Table 7.3.4.1.3.3-7a  
Information Element Value/remark Comment Condition As defined in Table
7.3.4.1.3.3-7a with the following exceptions:  
LPP-Message ::= SEQUENCE {  
lpp-MessageBody CHOICE {  
c1 CHOICE {  
provideCapabilities SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
provideCapabilities-r9 SEQUENCE {  
otdoa-ProvideCapabilities Present or not present dependent on pc_OTDOA_onNR  
ecid-ProvideCapabilities Present or not present dependent on pc_ECID_onNR  
nr-Multi-RTT-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16
onwards  
nr-DL-AoD-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
nr-DL-TDOA-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
nr-UL-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
}  
}  
}  
}  
}  
}
* * *
Table 9.3.4.1.3.3-6: LPP Provide Location Information (step 4, Table
7.3.4.1.3.2-1)
+-----------------+-----------------+----------------+-----------+ | Derivation | | | | | Path: Table | | | | | 7.3.4.1.3.3-8 | | | | +-----------------+-----------------+----------------+-----------+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+----------------+-----------+ | As defined in | | | | | Table | | | | | 7.3.4.1.3.3-8 | | | | | with the | | | | | following | | | | | exceptions: | | | | +-----------------+-----------------+----------------+-----------+ | LPP-Message ::= | | | | | SEQUENCE { | | | | +-----------------+-----------------+----------------+-----------+ | lpp-MessageBody | | | | | CHOICE { | | | | +-----------------+-----------------+----------------+-----------+ | c1 CHOICE { | | | | +-----------------+-----------------+----------------+-----------+ | provideLoca | | | | | tionInformation | | | | | SEQUENCE { | | | | +-----------------+-----------------+----------------+-----------+ | cri | | | | | ticalExtensions | | | | | CHOICE { | | | | +-----------------+-----------------+----------------+-----------+ | c1 CHOICE { | | | | +-----------------+-----------------+----------------+-----------+ | provideLocatio | | | | | nInformation-r9 | | | | | | | | | | SEQUENCE { | | | | +-----------------+-----------------+----------------+-----------+ | nr-DL-AoD- | Present for | Rel-16 onwards | | | ProvideLocation | sub-test 20 | | | | Information-r16 | | | | | SEQUENCE { | | | | +-----------------+-----------------+----------------+-----------+ | nr-DL-AoD-Si | Present. Any | | | | gnalMeasurement | value | | | | Information-r16 | acceptable | | | +-----------------+-----------------+----------------+-----------+ | nr- | Present. Any | | | | dl-AoD-Location | value | | | | Information-r16 | acceptable | | | +-----------------+-----------------+----------------+-----------+ | nr-D | Not present | | | | L-AoD-Error-r16 | | | | +-----------------+-----------------+----------------+-----------+ | } | | | | +-----------------+-----------------+----------------+-----------+ | nr-DL-TDOA- | Present for | Rel-16 onwards | | | ProvideLocation | sub-test 21 | | | | Information-r16 | | | | | SEQUENCE { | | | | +-----------------+-----------------+----------------+-----------+ | nr-DL-TDOA-Si | Present. Any | | | | gnalMeasurement | value | | | | Information-r16 | acceptable | | | +-----------------+-----------------+----------------+-----------+ | nr-d | Present. Any | | | | l-tdoa-Location | value | | | | Information-r16 | acceptable | | | +-----------------+-----------------+----------------+-----------+ | nr-DL | Not present | | | | -TDOA-Error-r16 | | | | +-----------------+-----------------+----------------+-----------+ | } | | | | +-----------------+-----------------+----------------+-----------+ | } | | | | +-----------------+-----------------+----------------+-----------+ | } | | | | +-----------------+-----------------+----------------+-----------+ | } | | | | +-----------------+-----------------+----------------+-----------+ | } | | | | +-----------------+-----------------+----------------+-----------+ | } | | | | +-----------------+-----------------+----------------+-----------+ | } | | | | +-----------------+-----------------+----------------+-----------+
#### 9.3.4.2 E-SMLC Initiated Assistance Data Delivery followed by Location
Information Transfer: UE‑Assisted
Editor\'s note: Test configuration D is incomplete:
  * The corresponding attach procedure for NG-RAN E-UTRA has not yet been defined.
  * The message contents need to be revised for Test Configuration D.
##### 9.3.4.2.1 Test Purpose (TP) {#test-purpose-tp-23 .H6}
##### (1) {#section-28 .H6}
**with** { a NAS signalling connection existing }
**ensure that** {\ **when** { UE receives assistance data and a location
request for UE-assisted }
**then** { UE sends a PROVIDE LOCATION INFORMATION message containing location
measurements }
}
##### 9.3.4.2.2 Conformance requirements {#conformance-requirements-46 .H6}
As defined in clause 7.3.4.2.2.
##### 9.3.4.2.3 Test description {#test-description-23 .H6}
##### 9.3.4.2.3.1 Pre-test conditions {#pre-test-conditions-23 .H6}
##### System Simulator: {#system-simulator-19 .H6}
For Test Configuration B (Table 9.3.4.2.3.2-1):
\- Sub-tests 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 22: NR Cell 1.
\- Sub-tests 5 and 7: NR Cell 1 and independent LTE Cell 1 and LTE Cell 2 as
specified in 8.2.2.
\- Sub-test 6: not applicable.
\- Satellite signals (Sub-test 15): as specified in 8.2.1.
\- WLAN signals (Sub-tests 11, 17): as specified in 8.2.5.
\- MBS signals (Sub-tests 12, 16): as specified in 8.2.4
\- Bluetooth signals (Sub-test 13): as specified in 8.2.6.
\- Sub-test 21: NR Cell 1 and NR Cell 2, as specified in 8.2.11.
For Test Configuration D (Table 9.3.4.2.3.2-1):
\- Sub-tests 11, 12, 13, 14, 15, 16, 17, 18: LTE Cell 1.
\- Sub-tests 5 and 7: LTE Cell 1 and LTE Cell 2, as specified in 8.2.2.
\- Sub-test 6: LTE Cell 1 and LTE Cell 2, as specified in 8.2.3.
\- Satellite signals (Sub-test 15): as specified in 8.2.1.
\- WLAN signals (Sub-tests 11, 17): as specified in 8.2.5.
\- MBS signals (Sub-tests 12, 16): as specified in 8.2.4
\- Bluetooth signals (Sub-test 13): as specified in 8.2.6.
##### UE: {#ue-38 .H6}
The UE shall begin the test with no assistance data stored.
##### Preamble: {#preamble-23 .H6}
\- For Test Configuration B (Table 9.3.4.2.3.2-1): The UE is in state 3N-A as
defined in TS 38.508-1 [30], subclause 4.4A on NR Cell 1.
\- Sub-test 5 and 7: After the UE is in state 3N-A, the SS shall execute the
steps in Table 9.3.4.2.3.1-1 for the configuration of measurement gaps for
OTDOA (LTE).
\- Sub-test 19: After the UE is in state 3N-A, the SS shall execute the steps
in Table 9.3.4.2.3.1-1 for the configuration of measurement gaps for Multi-RTT
and then the SS shall execute the steps in Table 9.3.4.2.3.1-2 for the
configuration of UL-SRS for Multi-RTT.
\- Sub-test 20: After the UE is in state 3N-A, the SS shall execute the steps
in Table 9.3.4.2.3.1-1 for the configuration of measurement gaps for DL-AoD.
\- Sub-test 21 After the UE is in state 3N-A, the SS shall execute the steps
in Table 9.3.4.2.3.1-1 for the configuration of measurement gaps for DL-TDOA.
Table 9.3.4.2.3.1-1: Configuration of measurement gaps
St Procedure Message Sequence TP Verdict
* * *
                                                                         U - S              Message
1 The SS sends an RRCReconfiguration message as in Table 8.3.1-1. \ RRCReconfigurationComplete - -
Table 9.3.4.2.3.1-2: Configuration of UL-SRS for Multi-RTT
St Procedure Message Sequence TP Verdict
* * *
                                                                         U - S              Message
1 The SS sends an RRCReconfiguration message as in Table 8.3.2-1. \ RRCReconfigurationComplete - -
\- For Test Configuration D (Table 9.3.4.2.3.2-1): FFS.
##### Related PICS/PIXIT Statements: {#related-picspixit-statements-55 .H6}
-
##### 9.3.4.2.3.2 Test procedure sequence {#test-procedure-sequence-22 .H6}
This test case includes sub-test cases dependent on the positioning method(s)
supported by the UE. Each sub-test case is identified by a Sub-Test Case
Number as defined in Table 9.3.4.2.3.2-0 below:
Table 9.3.4.2.3.2-0: Sub-test case numbers
* * *
Sub-Test Case Number Supported Positioning Methods 5 UE supporting OTDOA (LTE)
(Rel-15 onwards) 6 UE supporting ECID (LTE) (Test Configuration D only) 7 UE
supporting GNSS^(1)^ and OTDOA (LTE) (Rel-15 onwards) 11 UE supporting WLAN
(Rel-13 only) 12 UE supporting MBS (Rel-13 only) 13 UE supporting Bluetooth 14
UE supporting Sensor (Rel-13 only) 15 UE supporting GNSS^(1)^ 16 UE supporting
MBS (Rel-14 onwards) 17 UE supporting WLAN (Rel-14 onwards) 18 UE supporting
Sensor (Rel-14 onwards) 19 UE supporting Multi-RTT (Rel-16 onwards) 20 UE
supporting DL-AoD (Rel-16 onwards) 21 UE supporting DL-TDOA (Rel-16 onwards)
22 UE supporting NR E-CID (Rel-16 onwards) NOTE 1: The GNSS combination of
GPS, GLONASS, Galileo, BDS supported by the UE
* * *
Table 9.3.4.2.3.2-1: Test Configuration
* * *
**Test Configuration** **Network Deployment Type** **Test Implementation** A
EN-DC Functionality is tested by test case 7.3.4.2 B NG-RAN NR  
C NE-DC Functionality is tested by test configuration B D NG-RAN E-UTRA  
E NGEN-DC Functionality is tested by test configuration D
* * *
Main behaviour as defined in clause 7.3.4.2.3.2.
For sub-test 19 or sub-test 20 or sub-test 21, the SS sends the RESET UE
POSITIONING STORED INFORMATION message to the UE at step 1. Then the stored
assistance data in the UE are cleared.
For sub-test 22 NR E-CID, the SS does not send LPP message of type Provide
Assistance Data at step 2.
##### 9.3.4.2.3.3 Specific message contents {#specific-message-contents-56
.H6}
As defined in clause 7.3.4.2.3.3, with the following exceptions:
Table 9.3.4.2.3.3-0 replaces Table 7.3.4.2.3.3-1, Table 9.3.4.2.3.3-1 replaces
Table 7.3.4.2.3.3-3, Table 9.3.4.2.3.3-2 replaces Table 7.3.4.2.3.3-4, Table
9.3.4.2.3.3-2a replaces Table 7.3.4.2.3.3-5, Table 9.3.4.2.3.3-3 replaces
Table 7.3.4.2.3.3-7, Table 9.3.4.2.3.3-4 replaces Table 7.3.4.2.3.3-8, Table
9.3.4.2.3.3-5 replaces Table 7.3.4.2.3.3-6, Table 9.3.4.2.3.3-6 replaces Table
7.3.4.2.3.3-8a and Table 9.3.4.2.3.3-7 replaces Table 7.3.4.2.3.3-9.
_Table_ 9.3.4.2.3.3-0 _:_ RESET UE POSITIONING STORED INFORMATION (step 1,
Table 7.3.4.2.3.2-1)
+----------------+----------------+----------------+---------------+ | Derivation | | | | | Path: 38.509 | | | | | clause 6.6 | | | | +================+================+================+===============+ | **Information | ** |** Comment**|** Condition**| | Element** | Value/remark** | | | +----------------+----------------+----------------+---------------+ | As defined in | | | | | Table | | | | | 7.3.4.2.3.3-1 | | | | | with the | | | | | following | | | | | exceptions: | | | | +----------------+----------------+----------------+---------------+ | UE Positioning | Sub-test 19: 0 | Sub-test 19: | | | Technology | 0 0 0 0 1 1 0 | Multi-RTT | | | | | | | | | Sub-test 20: 0 | Sub-test 20: | | | | 0 0 0 1 0 0 0 | DL-AoD | | | | | | | | | Sub-test 21: 0 | Sub-test 21: | | | | 0 0 0 0 1 1 1 | DL-TDOA | | +----------------+----------------+----------------+---------------+
_Table_ 9.3.4.2.3.3-1 _:_ _DLInformationTransfer_ (steps 1b, 1d, 2, 3, 4a2,
4b2 and 4b4, Table 7.3.4.2.3.2-1)
Derivation Path: 38.331 clause 6.2.2
* * *
Information Element Value/remark Comment Condition DLInformationTransfer ::=
SEQUENCE {  
rrc-TransactionIdentifier  
criticalExtensions CHOICE {  
dlInformationTransfer SEQUENCE {  
dedicatedNAS-Message OCTET STRING Set according to Table 9.3.4.2.3.3-2 DL NAS
TRANSPORT  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}
Table 9.3.4.2.3.3-2: DL NAS TRANSPORT (steps 1b, 1d, 2, 3, 4a2, 4b2 and 4b4,
Table 7.3.4.2.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 24.501 | | | | | Table | | | | | 8.2.11.1.1 | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Extended | 01111110 | 5GS mobility | | | Protocol | | management | | | discriminator | | messages | | +-----------------+-----------------+-----------------+-----------+ | Security header | 0000 | Plain 5GS NAS | | | type | | message | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | Downlink | | | octet | | generic NAS | | | | | transport | | +-----------------+-----------------+-----------------+-----------+ | DL NAS | 01101000 | DL NAS | | | TRANSPORT | | transport | | | message | | | | | identity | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | 0011 | LTE Positioning | | | container type | | Protocol (LPP) | | | | | message | | | | | container | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | | | | octet | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | **Step 1b:** | LPP Request | | | container | | Capabilities. | | | | Set according | | | | | to Table | | | | | _8.4-2_ | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 2:** | LPP Provide | | | | | Assistance Data | | | | Set according | | | | | to Table | | | | | 9.3.4.2.3.3-2a | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 3:** | LPP Request | | | | | Location | | | | Set according | Information | | | | to | | | | | Tab | | | | | le9.3.4.2.3.3-5 | | | +-----------------+-----------------+-----------------+-----------+ | | **Steps 1d, | LPP | | | | 4a2, 4b2 and | Acknowledgement | | | | 4b4:** | | | | | | | | | | Set according | | | | | to Table | | | | | 7.3.4.2.3.3-10 | | | +-----------------+-----------------+-----------------+-----------+ | Additional | Present | Routing | | | information | | Identif | | | | | ier/Correlation | | | | | ID | | +-----------------+-----------------+-----------------+-----------+
Table 9.3.4.2.3.3-2a: LPP Provide Assistance data (step 2, Table
7.3.4.2.3.2-1)
* * *
Derivation Path: Table 8.4-1  
**Information Element** **Value/remark** **Comment** **Condition** As defined
in Table 8.4-1 with the following exceptions:  
transactionID SEQUENCE {  
initiator locationServer  
transactionNumber (0..255)  
}
* * *
Table 9.3.4.2.3.3-3: _ULInformationTransfer_ (steps 1c, 4 a1, 4b1 and 4b3,
Table 7.3.4.2.3.2-1)
Derivation Path: 38.331 clause 6.2.2
* * *
Information Element Value/remark Comment Condition ULInformationTransfer ::=
SEQUENCE {  
criticalExtensions CHOICE {  
ulInformationTransfer SEQUENCE {  
dedicatedNAS-Message OCTET STRING Set according to Table 9.3.4.2.3.3-4 UL NAS
TRANSPORT  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}
Table 9.3.4.2.3.3-4: UL NAS TRANSPORT (steps 1c, 4 a1, 4b1 and 4b3, Table
7.3.4.2.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 24.501 | | | | | Table | | | | | 8.2.10.1.1 | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Extended | 01111110 | 5GS mobility | | | Protocol | | management | | | discriminator | | messages | | +-----------------+-----------------+-----------------+-----------+ | Security header | 0000 | Plain 5GS NAS | | | type | | message | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | | | | octet | | | | +-----------------+-----------------+-----------------+-----------+ | UL NAS | 01100111 | UL NAS | | | TRANSPORT | | TRANSPORT | | | message | | | | | identity | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | 0011 | LTE Positioning | | | container type | | Protocol (LPP) | | | | | message | | | | | container | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | | | | octet | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | **Step 1c:** | LPP Provide | | | container | | Capabilities | | | | Set according | | | | | to Table | | | | | | | | | | 9.3.4.2.3.3-6 | | | +-----------------+-----------------+-----------------+-----------+ | | **Steps 4 a1, | LPP Provide | | | | 4b1 and 4b3:** | Location | | | | | Information | | | | Set according | | | | | to Table | | | | | | | | | | 9.3.4.2.3.3-7 | | | +-----------------+-----------------+-----------------+-----------+ | Additional | Present | The UE includes | | | information | | the Routing | | | | | Identifier | | | | | received in the | | | | | Additional | | | | | Information IE | | | | | of the DOWNLINK | | | | | GENERIC NAS | | | | | TRANSPORT | | | | | message (step 1 | | | | | Table | | | | | 7.3.4.2.3.2‑1) | | +-----------------+-----------------+-----------------+-----------+
Table 9.3.4.2.3.3-5: LPP Request Location Information (step 3, Table
7.3.4.2.3.2-1)
+----------------------+----------------------+---------+-----------+ | Derivation Path: | | | | | Table 8.4-3 | | | | +----------------------+----------------------+---------+-----------+ | Information Element | Value/remark | Comment | Condition | +----------------------+----------------------+---------+-----------+ | As defined in Table | | | | | 8.4-3 with the | | | | | following | | | | | exceptions: | | | | +----------------------+----------------------+---------+-----------+ | LPP-Message ::= | | | | | SEQUENCE { | | | | +----------------------+----------------------+---------+-----------+ | lpp-MessageBody | | | | | CHOICE { | | | | +----------------------+----------------------+---------+-----------+ | c1 CHOICE { | | | | +----------------------+----------------------+---------+-----------+ | reques | | | | | tLocationInformation | | | | | SEQUENCE { | | | | +----------------------+----------------------+---------+-----------+ | criticalExtensions | | | | | CHOICE { | | | | +----------------------+----------------------+---------+-----------+ | c1 CHOICE { | | | | +----------------------+----------------------+---------+-----------+ | requestLo | | | | | cationInformation-r9 | | | | | SEQUENCE { | | | | +----------------------+----------------------+---------+-----------+ | commonIEsReques | | | | | tLocationInformation | | | | | | | | | | SEQUENCE { | | | | +----------------------+----------------------+---------+-----------+ | loc | location | | | | ationInformationType | MeasurementsRequired | | | +----------------------+----------------------+---------+-----------+ | } | | | | +----------------------+----------------------+---------+-----------+ | ecid-Reques | | | | | tLocationInformation | | | | | SEQUENCE { | | | | +----------------------+----------------------+---------+-----------+ | r | Test Configuration | | | | equestedMeasurements | D: bits 0, 1, 2 = 1 | | | +----------------------+----------------------+---------+-----------+ | } | | | | +----------------------+----------------------+---------+-----------+ | } | | | | +----------------------+----------------------+---------+-----------+ | } | | | | +----------------------+----------------------+---------+-----------+ | } | | | | +----------------------+----------------------+---------+-----------+ | } | | | | +----------------------+----------------------+---------+-----------+ | } | | | | +----------------------+----------------------+---------+-----------+ | } | | | | +----------------------+----------------------+---------+-----------+ | } | | | | +----------------------+----------------------+---------+-----------+
Table 9.3.4.2.3.3-6: LPP Provide Capabilities. (step 1c, Table 7.3.4.2.3.2-1)
* * *
Derivation Path: Table 7.3.4.2.3.3-8a  
Information Element Value/remark Comment Condition As defined in Table
7.3.4.2.3.3-8a with the following exceptions:  
LPP-Message ::= SEQUENCE {  
lpp-MessageBody CHOICE {  
c1 CHOICE {  
provideCapabilities SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
provideCapabilities-r9 SEQUENCE {  
otdoa-ProvideCapabilities Present or not present dependent on pc_OTDOA_onNR  
ecid-ProvideCapabilities Present or not present dependent on pc_ECID_onNR  
nr-Multi-RTT-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16
onwards  
nr-DL-AoD-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
nr-DL-TDOA-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
nr-UL-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
}  
}  
}  
}  
}  
}
* * *
Table 9.3.4.2.3.3-7: LPP Provide Location Information (steps 4 a1, 4b1 and
4b3, Table 7.3.4.2.3.2-1)
* * *
Derivation Path: Table 7.3.4.2.3.3-9  
**Information Element** **Value/remark** **Comment** **Condition** As defined
in Table 7.3.4.2.3.3-9 with the following exceptions:  
LPP-Message ::= SEQUENCE {  
lpp-MessageBody CHOICE {  
c1 CHOICE {  
provideLocationInformation SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
provideLocationInformation-r9 SEQUENCE {  
nr-ECID-ProvideLocationInformation-r16 SEQUENCE { Present for sub-test 22
Rel-16 onwards  
nr-ECID-SignalMeasurementInformation-r16 Present. Any value acceptable  
nr-ECID-Error-r16 May be present  
}  
nr-Multi-RTT-ProvideLocationInformation-r16 SEQUENCE { Present for sub-test 19
Rel-16 onwards  
nr-Multi-RTT-SignalMeasurementInformation-r16 Present. Any value acceptable  
nr-Multi-RTT-Error-r16 May be present  
}  
nr-DL-AoD-ProvideLocationInformation-r16 SEQUENCE { Present for sub-test 20
Rel-16 onwards  
nr-DL-AoD-SignalMeasurementInformation-r16 Present. Any value acceptable  
nr-DL-AoD-Error-r16 May be present  
nr-dl-AoD-LocationInformation-r16 Not present  
}  
nr-DL-TDOA-ProvideLocationInformation-r16 SEQUENCE { Present for sub-test 21
Rel-16 onwards  
nr-DL-TDOA-SignalMeasurementInformation-r16 Present. Any value acceptable  
nr-dl-tdoa-LocationInformation-r16 Not present  
nr-DL-TDOA-Error-r16 May be present  
}  
}  
}  
}  
}  
}  
}  
}
* * *
#### 9.3.4.3 E-SMLC Initiated Position Measurement without assistance data:
UE‑Based
Editor\'s note: Test configuration D is incomplete:
  * The corresponding attach procedure for NG-RAN E-UTRA has not yet been defined.
  * The message contents need to be revised for Test Configuration D.
##### 9.3.4.3.1 Test Purpose (TP) {#test-purpose-tp-24 .H6}
##### (1) {#section-29 .H6}
**with** { a NAS signalling connection existing }
**ensure that** {
**when** { UE has no assistance data stored and receives a location request
for UE-based and the UE
requires assistance data in order to fulfil the location request }
**then** { UE sends a REQUEST ASSISTANCE DATA message followed by a PROVIDE
LOCATION INFORMATION
message containing a location estimate }
}
##### 9.3.4.3.2 Conformance requirements {#conformance-requirements-47 .H6}
As defined in clause 7.3.4.3.2.
##### 9.3.4.3.3 Test description {#test-description-24 .H6}
##### 9.3.4.3.3.1 Pre-test conditions {#pre-test-conditions-24 .H6}
##### System Simulator: {#system-simulator-20 .H6}
For Test Configuration B (Table 9.3.4.3.3.2-1): NR Cell 1.
\- Satellite signals (sub-test 15): as specified in 8.2.1.
\- MBS signals (sub-test 16): as specified in 8.2.4.
\- WLAN signals (sub-test 17): as specified in 8.2.5.
\- Sub-test 20: NR Cell 1 and NR Cell 2, as specified in 8.2.10.
\- Sub-test 21: NR Cell 1, NR Cell 2 and NR Cell 3, as specified in 8.2.11.
For Test Configuration D (Table 9.3.4.3.3.2-1): LTE Cell 1.
\- Satellite signals (sub-test 15): as specified in 8.2.1.
\- MBS signals (sub-test 16): as specified in 8.2.4.
\- WLAN signals (sub-test 17): as specified in 8.2.5.
##### UE: {#ue-39 .H6}
The UE shall begin the test with no assistance data stored.
##### Preamble: {#preamble-24 .H6}
\- For Test Configuration B (Table 9.3.4.3.3.2-1): The UE is in state 3N-A as
defined in TS 38.508-1 [30], subclause 4.4A on NR Cell 1.
\- For Test Configuration D (Table 9.3.4.3.3.2-1): FFS.
Related PICS/PIXIT Statements:
Method of triggering an LPP Request Assistance Data message.
##### 9.3.4.3.3.2 Test procedure sequence {#test-procedure-sequence-23 .H6}
This test case includes sub-test cases dependent on the positioning method(s)
supported by the UE. Each sub-test case is identified by a Sub-Test Case
Number as defined in Table 9.3.4.3.3.2-0 below:
Table 9.3.4.3.3.2-0: Sub-test case numbers
* * *
Sub-Test Case Number Supported Positioning Methods 15 UE supporting GNSS^(1)^
16 UE supporting MBS (Rel-14 onwards) 17 UE supporting WLAN (Rel-14 onwards)
18 UE supporting Sensor (Rel-14 onwards) 20 UE supporting DL-AoD (Rel-16
onwards) 21 UE supporting DL-TDOA (Rel-16 onwards) NOTE 1: The GNSS
combination of GPS, GLONASS, Galileo, BDS supported by the UE
* * *
Table 9.3.4.3.3.2-1: Test Configuration
* * *
**Test Configuration** **Network Deployment Type** **Test Implementation** A
EN-DC Functionality is tested by test case 7.3.4.3 B NG-RAN NR  
C NE-DC Functionality is tested by test configuration B D NG-RAN E-UTRA  
E NGEN-DC Functionality is tested by test configuration D
* * *
Main behaviour as defined in Table 7.3.4.3.3.2-1.
##### 9.3.4.3.3.3 Specific message contents {#specific-message-contents-57
.H6}
As defined in clause 7.3.4.3.3.3, with the following exceptions:
Table 9.3.4.3.3.3-0 replaces Table 7.3.4.3.3.3-1, Table 9.3.4.3.3.3-1 replaces
Table 7.3.4.3.3.3-2, Table 9.3.4.3.3.3-2 replaces Table 7.3.4.3.3.3-3, Table
9.3.4.3.3.3-2a replaces Table 7.3.4.3.3.3-9, Table 9.3.4.3.3.3-3 replaces
Table 7.3.4.3.3.3-6, Table 9.3.4.3.3.3-4 replaces Table 7.3.4.3.3.3-7, Table
9.3.4.3.3.3-5 replaces Table 7.3.4.3.3.3-7a, Table 9.3.4.3.3.3-6 replaces
Table 7.3.4.3.3.3-8 and Table 9.3.4.3.3.3-7 replaces Table 7.3.4.3.3.3-10.
_Table_ 9.3.4.3.3.3-0 _:_ RESET UE POSITIONING STORED INFORMATION (step 1,
Table 7.3.4.3.3.2-1)
+----------------+----------------+----------------+---------------+ | Derivation | | | | | Path: 38.509 | | | | | clause 6.6 | | | | +================+================+================+===============+ | **Information | ** |** Comment**|** Condition**| | Element** | Value/remark** | | | +----------------+----------------+----------------+---------------+ | As defined in | | | | | Table | | | | | 7.3.4.3.3.3-1 | | | | | with the | | | | | following | | | | | exceptions: | | | | +----------------+----------------+----------------+---------------+ | UE Positioning | Sub-test 20: 0 | Sub-test 20: | | | Technology | 0 0 0 1 0 0 0 | DL-AoD | | | | | | | | | Sub-test 21: 0 | Sub-test 21: | | | | 0 0 0 0 1 1 1 | DL-TDOA | | +----------------+----------------+----------------+---------------+
_Table_ 9.3.4.3.3.3-1 _:_ _DLInformationTransfer_ (steps 1a, 1c, 2, 4 and 5a,
Table 7.3.4.3.3.2-1)
Derivation Path: 38.331 clause 6.2.2
* * *
Information Element Value/remark Comment Condition DLInformationTransfer ::=
SEQUENCE {  
rrc-TransactionIdentifier  
criticalExtensions CHOICE {  
dlInformationTransfer SEQUENCE {  
dedicatedNAS-Message OCTET STRING Set according to Table 9.3.4.3.3.3-2 DL NAS
TRANSPORT  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}
Table 9.3.4.3.3.3-2: DL NAS TRANSPORT (steps 1a, 1c, 2, 4 and 5a, Table
7.3.4.3.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 24.501 | | | | | Table | | | | | 8.2.11.1.1 | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Extended | 01111110 | 5GS mobility | | | Protocol | | management | | | discriminator | | messages | | +-----------------+-----------------+-----------------+-----------+ | Security header | 0000 | Plain 5GS NAS | | | type | | message | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | Downlink | | | octet | | generic NAS | | | | | transport | | +-----------------+-----------------+-----------------+-----------+ | DL NAS | 01101000 | DL NAS | | | TRANSPORT | | transport | | | message | | | | | identity | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | 0011 | LTE Positioning | | | container type | | Protocol (LPP) | | | | | message | | | | | container | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | | | | octet | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | **Step 1a:** | LPP Request | | | container | | Capabilities. | | | | Set according | | | | | to Table | | | | | _8.4-2_ | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 2:** | LPP Request | | | | | Location | | | | Set according | Information | | | | to Table | | | | | 9.3.4.3.3.3-2b | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 4:** | LPP Provide | | | | | Assistance Data | | | | Set according | | | | | to Table | | | | | 9.3.4.3.3.3-2a | | | +-----------------+-----------------+-----------------+-----------+ | | **Steps 1c and | LPP | | | | 5a:** | Acknowledgement | | | | | | | | | Set according | | | | | to Table | | | | | 7.3.4.3.3.3-11 | | | +-----------------+-----------------+-----------------+-----------+ | Additional | Present | Routing | | | information | | Identif | | | | | ier/Correlation | | | | | ID | | +-----------------+-----------------+-----------------+-----------+
Table 9.3.4.3.3.3-2a: LPP Provide Assistance Data (step 4, Table
7.3.4.3.3.2-1)
* * *
Derivation Path: Table 8.4-1  
**Information Element** **Value/remark** **Comment** **Condition** LPP-Message
::= SEQUENCE {  
transactionID SEQUENCE {  
initiator targetDevice  
transactionNumber (0..255) Contains the same value as the corresponding field
in the LPP Request Assistance Data message in step 3 Table 7.3.4.3.3.2-1  
}  
endTransaction TRUE  
sequenceNumber Not present  
acknowledgement SEQUENCE { Present if acknowledgement field is included by the
UE at step 3, Table 7.3.4.3.3.2-1.  
ackRequested FALSE  
ackIndicator (0..255) Contains the same value as the sequenceNumber in step 3,
Table 7.3.4.3.3.2-1  
}  
lpp-MessageBody CHOICE {  
c1 CHOICE {  
provideAssistanceData SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
provideAssistanceData-r9 SEQUENCE {  
a-gnss-ProvideAssistanceData The SS provides the assistance data requested by
the UE at step 3, Table 7.3.4.3.3.2‑1 which are available according to TS
37.571-5 [12].  
sensor-ProvideAssistanceData-r14 The SS provides the assistance data requested
by the UE at step 3, Table 7.3.4.3.3.2-1 which are available according to
subclause 8.4.1.5. Rel-14 onwards  
tbs-ProvideAssistanceData-r14 The SS provides the assistance data requested by
the UE at step 3, Table 7.3.4.3.3.2-1 which are available according to
subclause 8.4.1.3. Rel-14 onwards  
wlan-ProvideAssistanceData-r14 The SS provides the assistance data requested
by the UE at step 3, Table 7.3.4.3.3.2-1 which are available according to
subclause 8.4.1.4. Rel-14 onwards  
nr-DL-AoD-ProvideAssistanceData-r16 The SS provides the assistance data
requested by the UE at step 3, Table 7.3.4.3.3.2-1 which are available
according to subclause 8.4.1.7. Rel-16 onwards  
nr-DL-TDOA-ProvideAssistanceData-r16 The SS provides the assistance data
requested by the UE at step 3, Table 7.3.4.3.3.2-1 which are available
according to subclause 8.4.1.8. Rel-16 onwards  
}  
}  
}  
}  
}  
}
* * *
Table 9.3.4.3.3.3-2b: LPP Request Location Information (step 2, Table
7.3.4.3.3.2-1)
* * *
Derivation Path: Table 5.4-3  
**Information Element** **Value/remark** **Comment** **Condition** As defined
in Table 5.4-3 with the following exceptions:  
locationInformationType locationEstimateRequired  
a-gnss-RequestLocationInformation Set according to Table 7.3.4.3.3.3-5 Sub-
test 15 sensor-RequestLocationInformation-r14 Set according to Table
7.3.4.3.3.3-5B Rel-14 onwards Sub-test 18 tbs-RequestLocationInformation-r13
Set according to Table 7.3.4.3.3.3-5A Rel-13 onwards Sub-test 16 wlan-
RequestLocationInformation-r14 Set according to Table 7.3.4.3.3.3-5C Rel-14
onwards Sub-test 17 nr-DL-AoD-RequestLocationInformation-r16 As defined in
Table 9.3.4.3.3.3-2c Rel-16 onwards Sub-test 20 nr-DL-TDOA-
RequestLocationInformation-r16 As defined in Table 9.3.4.3.3.3-2d Rel-16
onwards Sub-test 21
* * *
Table 9.3.4.3.3.3-2c _:_ NR DL-AoD Request Location Information (step 2, Table
7.3.4.3.3.2-1)
* * *
Derivation Path: Table 8.4-6  
Information Element Value/remark Comment Condition As defined in Table 8.4-6
with the following exceptions:  
nr-AssistanceAvailability-r16 TRUE
* * *
Table 9.3.4.3.3.3-2d: NR DL-TDOA Request Location Information (step 2, Table
7.3.4.3.3.2-1)
* * *
Derivation Path: Table 8.4-7  
Information Element Value/remark Comment Condition As defined in Table 8.4-7
with the following exceptions:  
nr-AssistanceAvailability-r16 TRUE
* * *
Table 9.3.4.3.3.3-3: _ULInformationTransfer_ (steps 1b, 3 and 5, Table
7.3.4.3.3.2-1)
Derivation Path: 38.331 clause 6.2.2
* * *
Information Element Value/remark Comment Condition ULInformationTransfer ::=
SEQUENCE {  
criticalExtensions CHOICE {  
ulInformationTransfer SEQUENCE {  
dedicatedNAS-Message OCTET STRING Set according to Table 9.3.4.3.3.3-4 UL NAS
TRANSPORT  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}
Table 9.3.4.3.3.3-4: UL NAS TRANSPORT (steps 1b, 3 and 5, Table 7.3.4.3.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 24.501 | | | | | Table | | | | | 8.2.10.1.1 | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Extended | 01111110 | 5GS mobility | | | Protocol | | management | | | discriminator | | messages | | +-----------------+-----------------+-----------------+-----------+ | Security header | 0000 | Plain 5GS NAS | | | type | | message | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | | | | octet | | | | +-----------------+-----------------+-----------------+-----------+ | UL NAS | 01100111 | UL NAS | | | TRANSPORT | | TRANSPORT | | | message | | | | | identity | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | 0011 | LTE Positioning | | | container type | | Protocol (LPP) | | | | | message | | | | | container | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | | | | octet | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | **Step 1b:** | LPP Provide | | | container | | Capabilities | | | | Set according | | | | | to Table | | | | | | | | | | 9.3.4.3.3.3-5 | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 3:** | LPP Request | | | | | Assistance Data | | | | Set according | | | | | to Table | | | | | | | | | | 9.3.4.3.3.3-6 | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 5:** | LPP Provide | | | | | Location | | | | Set according | Information | | | | to Table | | | | | | | | | | 9.3.4.3.3.3-7 | | | +-----------------+-----------------+-----------------+-----------+ | Additional | Present | The UE includes | | | information | | the Routing | | | | | Identifier | | | | | received in the | | | | | Additional | | | | | Information IE | | | | | of the DOWNLINK | | | | | GENERIC NAS | | | | | TRANSPORT | | | | | message (step 1 | | | | | Table | | | | | 7.3.4.3.3.2‑1) | | +-----------------+-----------------+-----------------+-----------+
Table 9.3.4.3.3.3-5: LPP Provide Capabilities. (step 1b, Table 7.3.4.3.3.2-1)
* * *
Derivation Path: Table 7.3.4.3.3.3-7a  
Information Element Value/remark Comment Condition As defined in Table
7.3.4.3.3.3-7a with the following exceptions:  
LPP-Message ::= SEQUENCE {  
transactionID SEQUENCE {  
initiator locationServer  
transactionNumber (0..255) Contains the same value as the corresponding field
in the LPP Request Capabilities message in step 1a, Table 7.3.4.3.3.2-1  
}  
lpp-MessageBody CHOICE {  
c1 CHOICE {  
provideCapabilities SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
provideCapabilities-r9 SEQUENCE {  
otdoa-ProvideCapabilities Present or not present dependent on pc_OTDOA_onNR  
ecid-ProvideCapabilities Present or not present dependent on pc_ECID_onNR  
nr-DL-AoD-RequestCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
nr-DL-TDOA-RequestCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
}  
}  
}  
}
* * *
Table 9.3.4.3.3.3-6: LPP Request Assistance Data (step 3, Table 7.3.4.3.3.2-1)
* * *
Derivation Path: Table 7.3.4.3.3.3-8  
**Information Element** **Value/remark** **Comment** **Condition** As defined
in Table 7.3.4.3.3.3-8 with the following exceptions:  
LPP-Message ::= SEQUENCE {  
lpp-MessageBody CHOICE {  
c1 CHOICE {  
requestAssistanceData SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
requestAssistanceData-r9 SEQUENCE {  
nr-DL-AoD-RequestAssistanceData-r16 Present for sub-test 20 Rel-16 onwards  
nr-DL-TDOA-RequestAssistanceData-r16 Present for sub-test 21 Rel-16 onwards  
}  
}  
}  
}  
}  
}
* * *
Table 9.3.4.3.3.3-7: LPP Provide Location Information (step 5, Table
7.3.4.3.3.2-1)
+----------------+----------------+----------------+---------------+ | Derivation | | | | | Path: Table | | | | | 7.3.4.3.3.3-10 | | | | +----------------+----------------+----------------+---------------+ | **Information | ** |** Comment**|** Condition**| | Element** | Value/remark** | | | +----------------+----------------+----------------+---------------+ | As defined in | | | | | Table | | | | | 7.3.4.3.3.3-10 | | | | | with the | | | | | following | | | | | exceptions: | | | | +----------------+----------------+----------------+---------------+ | LPP-Message | | | | | ::= SEQUENCE { | | | | +----------------+----------------+----------------+---------------+ | l | | | | | pp-MessageBody | | | | | CHOICE { | | | | +----------------+----------------+----------------+---------------+ | c1 CHOICE { | | | | +----------------+----------------+----------------+---------------+ | provideLocat | | | | | ionInformation | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+---------------+ | crit | | | | | icalExtensions | | | | | CHOICE { | | | | +----------------+----------------+----------------+---------------+ | c1 CHOICE { | | | | +----------------+----------------+----------------+---------------+ | p | | | | | rovideLocation | | | | | Information-r9 | | | | | | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+---------------+ | nr-DL-AoD-Pr | Present for | Rel-16 onwards | | | ovideLocationI | sub-test 20 | | | | nformation-r16 | | | | +----------------+----------------+----------------+---------------+ | nr-DL-TDOA-Pr | Present for | Rel-16 onwards | | | ovideLocationI | sub-test 21 | | | | nformation-r16 | | | | +----------------+----------------+----------------+---------------+ | } | | | | +----------------+----------------+----------------+---------------+ | } | | | | +----------------+----------------+----------------+---------------+ | } | | | | +----------------+----------------+----------------+---------------+ | } | | | | +----------------+----------------+----------------+---------------+ | } | | | | +----------------+----------------+----------------+---------------+ | } | | | | +----------------+----------------+----------------+---------------+
#### 9.3.4.4 E-SMLC Initiated Position Measurement without assistance data:
UE‑Assisted
Editor\'s note: Test configuration D is incomplete:
  * The corresponding attach procedure for NG-RAN E-UTRA has not yet been defined.
  * The message contents need to be revised for Test Configuration D.
##### 9.3.4.4.1 Test Purpose (TP) {#test-purpose-tp-25 .H6}
**with** { a NAS signalling connection existing }
**ensure that** {\ **when** { UE has no assistance data stored and receives a
location request for UE-assisted and the\ UE requires assistance data in order
to fulfil the location request }
**then** { UE sends a REQUEST ASSISTANCE DATA message followed by a PROVIDE
LOCATION INFORMATION\ message containing location measurements }
}
##### 9.3.4.4.2 Conformance requirements {#conformance-requirements-48 .H6}
As defined in clause 7.3.4.4.2.
##### 9.3.4.4.3 Test description {#test-description-25 .H6}
##### 9.3.4.4.3.1 Pre-test conditions {#pre-test-conditions-25 .H6}
##### System Simulator: {#system-simulator-21 .H6}
For Test Configuration B (Table 9.3.4.4.3.2-1):
\- Sub-tests 15, 16, 17, 18, 19, 20: NR Cell 1.
\- Sub-tests 5 and 7: NR Cell 1 and independent LTE Cell 1 and LTE Cell 2 as
specified in 8.2.2.
\- Satellite signals (sub-test 15): as specified in 8.2.1.
\- MBS signals (sub-test 16): as specified in 8.2.4.
\- WLAN signals (sub-test 17): as specified in 8.2.5.
\- Sub-test 21: NR Cell 1 and NR Cell 2, as specified in 8.2.11.
For Test Configuration D (Table 9.3.4.4.3.2-1):
\- Sub-tests 15, 16, 17, 18: LTE Cell 1.
\- Sub-tests 5 and 7: LTE Cell 1 and LTE Cell 2, as specified in 8.2.2.
\- Satellite signals (sub-test 15): as specified in 8.2.1.
\- MBS signals (sub-test 16): as specified in 8.2.4.
\- WLAN signals (sub-test 17): as specified in 8.2.5.
##### UE: {#ue-40 .H6}
The UE shall begin the test with no assistance data stored.
##### Preamble: {#preamble-25 .H6}
\- For Test Configuration B (Table 9.3.4.4.3.2-1): The UE is in state 3N-A as
defined in TS 38.508-1 [30], subclause 4.4A on NR Cell 1.
\- Sub-test 5 and 7: After the UE is in state 3N-A, the SS shall execute the
steps in Table 9.3.4.4.3.1-1 for the configuration of measurement gaps for
OTDOA (LTE).
\- Sub-test 19: After the UE is in state 3N-A, the SS shall execute the steps
in Table 9.3.4.4.3.1-1 for the configuration of measurement gaps for Muti-RTT
and then the SS shall execute the steps in Table 9.3.4.4.3.1-2 for the
configuration of UL-SRS for Muti-RTT.
\- Sub-test 20: After the UE is in state 3N-A, the SS shall execute the steps
in Table 9.3.4.4.3.1-1 for the configuration of measurement gaps for DL-AoD.
\- Sub-test 21: After the UE is in state 3N-A, the SS shall execute the steps
in Table 9.3.4.4.3.1-1 for the configuration of measurement gaps for DL-TDOA.
Table 9.3.4.4.3.1-1: Configuration of measurement gaps
St Procedure Message Sequence TP Verdict
* * *
                                                                         U - S              Message
1 The SS sends an RRCReconfiguration message as in Table 8.3.1-1. \ RRCReconfigurationComplete - -
Table 9.3.4.4.3.1-2: Configuration of UL-SRS for Multi-RTT
St Procedure Message Sequence TP Verdict
* * *
                                                                         U - S              Message
1 The SS sends an RRCReconfiguration message as in Table 8.3.2-1. \ RRCReconfigurationComplete - -
\- For Test Configuration D (Table 9.3.4.4.3.2-1): FFS.
##### Related PICS/PIXIT Statements: {#related-picspixit-statements-56 .H6}
Method of triggering an LPP Request Assistance Data message.
##### 9.3.4.4.3.2 Test procedure sequence {#test-procedure-sequence-24 .H6}
This test case includes sub-test cases dependent on the positioning method(s)
supported by the UE. Each sub-test case is identified by a Sub-Test Case
Number as defined in Table 9.3.4.4.3.2-0 below:
Table 9.3.4.4.3.2-0: Sub-test case numbers
* * *
Sub-Test Case Number Supported Positioning Methods 5 UE supporting OTDOA (LTE)
(Rel-15 onwards) 7 UE supporting GNSS^(1)^ and OTDOA (LTE) (Rel-15 onwards) 15
UE supporting GNSS^(1)^ 16 UE supporting MBS (Rel-14 onwards) 17 UE supporting
WLAN (Rel-14 onwards) 18 UE supporting Sensor (Rel-14 onwards) 19 UE
supporting Multi-RTT (Rel-16 onwards) 20 UE supporting DL-AoD (Rel-16 onwards)
21 UE supporting DL-TDOA (Rel-16 onwards) NOTE 1: The GNSS combination of GPS,
GLONASS, Galileo, BDS supported by the UE
* * *
Table 9.3.4.4.3.2-1: Test Configuration
* * *
**Test Configuration** **Network Deployment Type** **Test Implementation** A
EN-DC Functionality is tested by test case 7.3.4.4 B NG-RAN NR  
C NE-DC Functionality is tested by test configuration B D NG-RAN E-UTRA  
E NGEN-DC Functionality is tested by test configuration D
* * *
Main behaviour as defined in Table 7.3.4.4.3.2-1.
For sub-test 19 or sub-test 20 or sub-test 21, the SS sends the RESET UE
POSITIONING STORED INFORMATION message to the UE at step 1. Then the stored
assistance data in the UE are cleared.
##### 9.3.4.4.3.3 Specific message contents {#specific-message-contents-58
.H6}
As defined in clause 7.3.4.4.3.3, with the following exceptions:
Table 9.3.4.4.3.3-0 replaces Table 7.3.4.4.3.3-1, Table 9.3.4.4.3.3-1 replaces
Table 7.3.4.4.3.3-3, Table 9.3.4.4.3.3-2 replaces Table 7.3.4.4.3.3-4,Table
9.3.4.4.3.3-2a replaces Table 7.3.4.4.3.3-10, Table 9.3.4.4.3.3-3 replaces
Table 7.3.4.4.3.3-7, Table 9.3.4.4.3.3-4 replaces Table 7.3.4.4.3.3-8, Table
9.3.4.4.3.3-2b replaces Table 7.3.4.4.3.3-5, Table 9.3.4.4.3.3-5 replaces
Table 7.3.4.4.3.3-8a, Table 9.3.4.4.3.3-6 replaces Table 7.3.4.4.3.3-9 and
Table 9.3.4.4.3.3-7 replaces Table 7.3.4.4.3.3-11.
_Table_ 9.3.4.4.3.3-0 _:_ RESET UE POSITIONING STORED INFORMATION (step 1,
Table 7.3.4.4.3.2-1)
+----------------+----------------+----------------+---------------+ | Derivation | | | | | Path: 38.509 | | | | | clause 6.6 | | | | +================+================+================+===============+ | **Information | ** |** Comment**|** Condition**| | Element** | Value/remark** | | | +----------------+----------------+----------------+---------------+ | As defined in | | | | | Table | | | | | 7.3.4.4.3.3-1 | | | | | with the | | | | | following | | | | | exceptions: | | | | +----------------+----------------+----------------+---------------+ | UE Positioning | Sub-test 19: 0 | Sub-test 19: | | | Technology | 0 0 0 0 1 1 0 | Multi-RTT | | | | | | | | | Sub-test 20: 0 | Sub-test 20: | | | | 0 0 0 1 0 0 0 | DL-AoD | | | | | | | | | Sub-test 21: 0 | Sub-test 21: | | | | 0 0 0 0 1 1 1 | DL-TDOA | | +----------------+----------------+----------------+---------------+
_Table_ 9.3.4.4.3.3-1 _:_ _DLInformationTransfer_ (steps 1b, 1d, 2, 4, 4b,
5a2, 5b2 and 5b4, Table 7.3.4.4.3.2-1)
Derivation Path: 38.331 clause 6.2.2
* * *
Information Element Value/remark Comment Condition DLInformationTransfer ::=
SEQUENCE {  
rrc-TransactionIdentifier  
criticalExtensions CHOICE {  
dlInformationTransfer SEQUENCE {  
dedicatedNAS-Message OCTET STRING Set according to Table 9.3.4.4.3.3-2 DL NAS
TRANSPORT  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}
Table 9.3.4.4.3.3-2: DL NAS TRANSPORT (steps 1b, 1d, 2, 4, 4b, 5a2, 5b2 and
5b4, Table 7.3.4.4.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 24.501 | | | | | Table | | | | | 8.2.11.1.1 | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Extended | 01111110 | 5GS mobility | | | Protocol | | management | | | discriminator | | messages | | +-----------------+-----------------+-----------------+-----------+ | Security header | 0000 | Plain 5GS NAS | | | type | | message | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | Downlink | | | octet | | generic NAS | | | | | transport | | +-----------------+-----------------+-----------------+-----------+ | DL NAS | 01101000 | DL NAS | | | TRANSPORT | | transport | | | message | | | | | identity | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | 0011 | LTE Positioning | | | container type | | Protocol (LPP) | | | | | message | | | | | container | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | | | | octet | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | **Step 1b:** | LPP Request | | | container | | Capabilities | | | | Set according | | | | | to Table | | | | | _8.4-2_ | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 2:** | LPP Request | | | | | Location | | | | Set according | Information | | | | to Table | | | | | 9.3.4.4.3.3-2b | | | +-----------------+-----------------+-----------------+-----------+ | | **Steps 4 and | LPP Provide | | | | 4b:** | Assistance Data | | | | | | | | | Set according | | | | | to Table | | | | | 9.3.4.4.3.3-2a | | | +-----------------+-----------------+-----------------+-----------+ | | **Steps 1d, | LPP | | | | 5a2, 5b2 and | Acknowledgement | | | | 5b4:** | | | | | | | | | | Set according | | | | | to Table | | | | | 7.3.4.4.3.3-12 | | | +-----------------+-----------------+-----------------+-----------+ | Additional | Present | Routing | | | information | | Identif | | | | | ier/Correlation | | | | | ID | | +-----------------+-----------------+-----------------+-----------+
Table 9.3.4.4.3.3-2a: LPP Provide Assistance Data (steps 4 and 4b, Table
7.3.4.4.3.2-1)
* * *
Derivation Path: Table 8.4-1  
**Information Element** **Value/remark** **Comment** **Condition** LPP-Message
::= SEQUENCE {  
transactionID SEQUENCE {  
initiator targetDevice  
transactionNumber (0..255) Contains the same value as the corresponding field
in the LPP Request Assistance Data message in step 3 or 4a Table
7.3.4.4.3.2-1.  
}  
endTransaction TRUE  
sequenceNumber Not present  
acknowledgement SEQUENCE { Present if acknowledgement field is included by the
UE at step 3 or 4a, Table 7.3.4.4.3.2-1.  
ackRequested FALSE  
ackIndicator (0..255) Contains the same value as the sequenceNumber in step 3
or 4a, Table 7.3.4.4.3.2-1.  
}  
lpp-MessageBody CHOICE {  
c1 CHOICE {  
provideAssistanceData SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
provideAssistanceData-r9 SEQUENCE {  
a-gnss-ProvideAssistanceData The SS provides the assistance data requested by
the UE at step 3 or 4a, Table 7.3.4.4.3.2‑1 which are available according to
TS 37.571-5 [12]. For sub-test 7, in case the UE sends two separate LPP
Request Assistance Data messages in steps 3 and 4a then the SS sends two
seperate LPP Provide Assistance Data messages in steps 4 and 4b each
containing the relevant assistance data. Sub-tests 7, 15 otdoa-
ProvideAssistanceData The SS provides the assistance data requested by the UE
at step 3 or 4a, Table 7.3.4.4.3.2-1 according to subclause 8.4.1.2. For sub-
test 7, in case the UE sends two separate LPP Request Assistance Data messages
in steps 3 and 4a then the SS sends two seperate LPP Provide Assistance Data
messages in steps 4 and 4b each containing the relevant assistance data. Sub-
tests 5,7 sensor-ProvideAssistanceData-r14 The SS provides the assistance data
requested by the UE at step 3, Table 7.3.4.4.3.2-1 which are available
according to subclause 8.4.1.5. Release 14 onwards Sub-test 18 tbs-
ProvideAssistanceData-r14 The SS provides the assistance data requested by the
UE at step 3, Table 7.3.4.4.3.2-1 which are available according to subclause
8.4.1.3. Release 14 onwards Sub-test 16 wlan-ProvideAssistanceData-r14 The SS
provides the assistance data requested by the UE at step 3, Table
7.3.4.4.3.2-1 which are available according to subclause 8.4.1.4. Release 14
onwards Sub-test 17 nr-Multi-RTT-ProvideAssistanceData-r16 The SS provides the
assistance data requested by the UE at step 3, Table 7.3.4.4.3.2-1 which are
available according to subclause 8.4.1.6. Release 16 onwards Sub-test 19 nr-
DL-AoD-ProvideAssistanceData-r16 The SS provides the assistance data requested
by the UE at step 3, Table 7.3.4.4.3.2-1 which are available according to
subclause 8.4.1.7. Release 16 onwards Sub-test 20 nr-DL-TDOA-
ProvideAssistanceData-r16 The SS provides the assistance data requested by the
UE at step 3, Table 7.3.4.4.3.2-1 which are available according to subclause
8.4.1.8. Release 16 onwards Sub-test 21 }  
}  
}  
}  
}  
}
* * *
Table 9.3.4.4.3.3-2b: LPP Request Location Information (step 2, Table
7.3.4.4.3.2-1)
* * *
Derivation Path: Table 7.3.4.4.3.3-5  
**Information Element** **Value/remark** **Comment** **Condition** As defined
in Table 7.3.4.4.3.3-5 with the following exceptions:  
nr-Multi-RTT-RequestLocationInformation-r16 As defined in Table 9.3.4.4.3.3-2c
Rel-16 onwards Sub-test 19 nr-DL-AoD-RequestLocationInformation-r16 As defined
in Table 9.3.4.4.3.3-2d Rel-16 onwards Sub-test 20 nr-DL-TDOA-
RequestLocationInformation-r16 As defined in Table 9.3.4.4.3.3-2e Rel-16
onwards Sub-test 21
* * *
_Table_ 9.3.4.4.3.3-2c _:_ NR Multi-RTT Request Location Information (step 2,
Table 7.3.4.4.3.2-1)
* * *
Derivation Path: Table 8.4-5  
Information Element Value/remark Comment Condition As defined in Table 8.4-5
with the following exceptions:  
nr-AssistanceAvailability-r16 TRUE
* * *
_Table_ 9.3.4.4.3.3-2d _:_ NR DL-AoD Request Location Information (step 2,
Table 7.3.4.4.3.2-1)
* * *
Derivation Path: Table 8.4-6  
Information Element Value/remark Comment Condition As defined in Table 8.4-6
with the following exceptions:  
nr-AssistanceAvailability-r16 TRUE
* * *
Table 9.3.4.4.3.3-2e: NR DL-TDOA Request Location Information (step 2, Table
7.3.4.4.3.2-1)
* * *
Derivation Path: Table 8.4-7  
Information Element Value/remark Comment Condition As defined in Table 8.4-7
with the following exceptions:  
nr-AssistanceAvailability-r16 TRUE
* * *
Table 9.3.4.4.3.3-3: _ULInformationTransfer_ (steps 1c, 3, 4a, 5a1, 5b1 and
5b3, Table 7.3.4.4.3.2-1)
Derivation Path: 38.331 clause 6.2.2
* * *
Information Element Value/remark Comment Condition ULInformationTransfer ::=
SEQUENCE {  
criticalExtensions CHOICE {  
ulInformationTransfer SEQUENCE {  
dedicatedNAS-Message OCTET STRING Set according to Table 9.3.4.4.3.3-4 UL NAS
TRANSPORT  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}
Table 9.3.4.4.3.3-4: UL NAS TRANSPORT (steps 1c, 3, 4a, 5a1, 5b1 and 5b3,
Table 7.3.4.4.3.2-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 24.501 | | | | | Table | | | | | 8.2.10.1.1 | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Extended | 01111110 | 5GS mobility | | | Protocol | | management | | | discriminator | | messages | | +-----------------+-----------------+-----------------+-----------+ | Security header | 0000 | Plain 5GS NAS | | | type | | message | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | | | | octet | | | | +-----------------+-----------------+-----------------+-----------+ | UL NAS | 01100111 | UL NAS | | | TRANSPORT | | TRANSPORT | | | message | | | | | identity | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | 0011 | LTE Positioning | | | container type | | Protocol (LPP) | | | | | message | | | | | container | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | | | | octet | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | **Step 1c:** | LPP Provide | | | container | | Capabilities | | | | Set according | | | | | to Table | | | | | | | | | | 9.3.4.4.3.3-5 | | | +-----------------+-----------------+-----------------+-----------+ | | **Steps 3 and | LPP Request | | | | 4a:** | Assistance Data | | | | | | | | | Set according | | | | | to Table | | | | | | | | | | 9.3.4.4.3.3-6 | | | +-----------------+-----------------+-----------------+-----------+ | | **Steps 5a1, | LPP Provide | | | | 5b1 and 5b3:** | Location | | | | | Information | | | | Set according | | | | | to Table | | | | | | | | | | 9.3.4.4.3.3-7 | | | +-----------------+-----------------+-----------------+-----------+ | Additional | Present | The UE includes | | | information | | the Routing | | | | | Identifier | | | | | received in the | | | | | Additional | | | | | Information IE | | | | | of the DOWNLINK | | | | | GENERIC NAS | | | | | TRANSPORT | | | | | message (step 1 | | | | | Table | | | | | 7.3.4.4.3.2‑1) | | +-----------------+-----------------+-----------------+-----------+
Table 9.3.4.4.3.3-5: LPP Provide Capabilities. (step 1c, Table 7.3.4.4.3.2-1)
* * *
Derivation Path: Table 7.3.4.4.3.3-8a  
Information Element Value/remark Comment Condition As defined in Table
7.3.4.4.3.3-8a with the following exceptions:  
LPP-Message ::= SEQUENCE {  
lpp-MessageBody CHOICE {  
c1 CHOICE {  
provideCapabilities SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
provideCapabilities-r9 SEQUENCE {  
otdoa-ProvideCapabilities Present or not present dependent on pc_OTDOA_onNR  
ecid-ProvideCapabilities Present or not present dependent on pc_ECID_onNR  
nr-Multi-RTT-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16
onwards  
nr-DL-AoD-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
nr-DL-TDOA-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
nr-UL-ProvideCapabilities-r16 Dependent on UE capabilities Rel-16 onwards  
}  
}  
}  
}  
}  
}
* * *
Table 9.3.4.4.3.3-6: LPP Request Assistance Data (steps 3 and 4a, Table
7.3.4.4.3.2-1)
* * *
Derivation Path: Table 7.3.4.4.3.3-9  
**Information Element** **Value/remark** **Comment** **Condition** As defined
in Table 7.3.4.4.3.3-9 with the following exceptions:  
LPP-Message ::= SEQUENCE {  
lpp-MessageBody CHOICE {  
c1 CHOICE {  
requestAssistanceData SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
requestAssistanceData-r9 SEQUENCE {  
nr-Multi-RTT-RequestAssistanceData-r16 Present for sub-test 19 Rel-16 onwards  
nr-DL-AoD-RequestAssistanceData-r16 Present for sub-test 20 Rel-16 onwards  
nr-DL-TDOA-RequestAssistanceData-r16 Present for sub-test 21 Rel-16 onwards  
}  
}  
}  
}  
}  
}
* * *
Table 9.3.4.4.3.3-7: LPP Provide Location Information (steps 5a1, 5b1 and 5b3,
Table 7.3.4.4.3.2-1)
* * *
Derivation Path: Table 7.3.4.4.3.3-11  
**Information Element** **Value/remark** **Comment** **Condition** As defined
in Table 7.3.4.4.3.3-11 with the following exceptions:  
LPP-Message ::= SEQUENCE {  
lpp-MessageBody CHOICE {  
c1 CHOICE {  
provideLocationInformation SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
provideLocationInformation-r9 SEQUENCE {  
nr-Multi-RTT-ProvideLocationInformation-r16 Present for sub-test 19 Rel-16
onwards  
nr-DL-AoD-ProvideLocationInformation-r16 Present for sub-test 20 Rel-16
onwards  
nr-DL-TDOA-ProvideLocationInformation-r16 Present for sub-test 21 Rel-16
onwards  
}  
}  
}  
}  
}  
}  
}
* * *
## 9.4 RRC Protocol Procedures
### 9.4.1 PosSIB broadcasting followed by location information transfer
#### 9.4.1.1 Test Purpose (TP)
##### (1) {#section-30 .H6}
**with** { a NAS signalling connection existing }
**ensure that** {
**when** { UE has no assistance data stored and receives the positioning
assistance data via posSIBs and then UE receives a location request from LMF}
**then** { the UE sends a PROVIDE LOCATION INFORMATION message containing a
location estimate }
}
#### 9.4.1.2 Conformance requirements
References: The conformance requirements covered in the present TC are
specified in: TS 37.355 clauses 7.1, 7.2, and TS 38.331 clause 5.2.2.3.5.
Unless otherwise stated these are Rel-16 requirements.
[TS 37.355, clause 7.1]
Broadcast of positioning assistance data is supported via Positioning System
Information Blocks (posSIBs) as specified in TS 36.331 [12] or TS 38.331 [35].
The posSIBs are carried in RRC System Information (SI) messages (TS 36.331
[12] or TS 38.331 [35]).
For LTE RRC System Information (SI), a single _SystemInformationBlockPos_ IE
is defined in TS 36.331 [12] which is carried in IE
_PosSystemInformation-r15-IEs_ specified in TS 36.331 [12]. The mapping of
positioning SIB type (_posSibType_) to assistance data carried in
_SystemInformationBlockPos_ is specified in clause 7.2.
For NR RRC System Information (SI), a single _SIBpos_ IE is defined in TS
38.331 [35] which is carried in IE _PosSystemInformation-r16-IEs_ specified in
TS 38.331 [35]. The mapping of positioning SIB type (_posSibType_) to
assistance data carried in _SIBpos_ is specified in clause 7.2.
[TS 37.355, clause 7.2]
The supported _posSibType_ \'s are specified in Table 7.2-1. The GNSS Common
and Generic Assistance Data IEs are defined in clause 6.5.2.2. The OTDOA
Assistance Data IEs and NR DL-TDOA/DL-AoD Assistance Data IEs are defined in
clause 7.4.2. The Barometric Assistance Data IEs are defined in clause
6.5.5.8. The TBS (based on MBS signals) Assistance Data IEs are defined in
clause 6.5.4.8.
Table 7.2-1: Mapping of posSibType to assistanceDataElement
+------------------------+------------------+------------------------+ | | _posSibType_ | * | | | | assistanceDataElement _| +========================+==================+========================+ | GNSS Common Assistance |_ posSibType1-1 _|_ GNSS-ReferenceTime _| | Data (clause 6.5.2.2) | | | +------------------------+------------------+------------------------+ | |_ posSibType1-2 _|_ G | | | | NSS-ReferenceLocation _| +------------------------+------------------+------------------------+ | |_ posSibType1-3 _| * | | | | GNSS-IonosphericModel_ | +------------------------+------------------+------------------------+ | | _posSibType1-4_ | _GNSS-Earth | | | | OrientationParameters_ | +------------------------+------------------+------------------------+ | | _posSibType1-5_ | _GNSS-RTK | | | | -ReferenceStationInfo_ | +------------------------+------------------+------------------------+ | | _posSibType1-6_ | _GNSS-RTK- | | | | CommonObservationInfo_ | +------------------------+------------------+------------------------+ | | _posSibType1-7_ | _GNSS-RTK | | | | -AuxiliaryStationData_ | +------------------------+------------------+------------------------+ | | _posSibType1-8_ | _GNSS | | | | -SSR-CorrectionPoints_ | +------------------------+------------------+------------------------+ | GNSS Generic | _posSibType2-1_ | _GNSS-TimeModelList_ | | Assistance Data | | | | (clause 6.5.2.2) | | | +------------------------+------------------+------------------------+ | | _posSibType2-2_ | _GNSS-Di | | | | fferentialCorrections_ | +------------------------+------------------+------------------------+ | | _posSibType2-3_ | _GNSS-NavigationModel_ | +------------------------+------------------+------------------------+ | | _posSibType2-4_ | _G | | | | NSS-RealTimeIntegrity_ | +------------------------+------------------+------------------------+ | | _posSibType2-5_ | _G | | | | NSS-DataBitAssistance_ | +------------------------+------------------+------------------------+ | | _posSibType2-6_ | _GNSS- | | | | AcquisitionAssistance_ | +------------------------+------------------+------------------------+ | | _posSibType2-7_ | _GNSS-Almanac_ | +------------------------+------------------+------------------------+ | | _posSibType2-8_ | _GNSS-UTC-Model_ | +------------------------+------------------+------------------------+ | | _posSibType2-9_ | _GNSS | | | | -AuxiliaryInformation_ | +------------------------+------------------+------------------------+ | | _posSibType2-10_ | _BDS-Di | | | | fferentialCorrections_ | +------------------------+------------------+------------------------+ | | _posSibType2-11_ | _B | | | | DS-GridModelParameter_ | +------------------------+------------------+------------------------+ | | _posSibType2-12_ | * | | | | GNSS-RTK-Observations _| +------------------------+------------------+------------------------+ | |_ posSibType2-13 _|_ GL | | | | O-RTK-BiasInformation _| +------------------------+------------------+------------------------+ | |_ posSibType2-14 _|_ GNSS-RTK-MAC- | | | | CorrectionDifferences _| +------------------------+------------------+------------------------+ | |_ posSibType2-15 _|_ GNSS-RTK-Residuals _| +------------------------+------------------+------------------------+ | |_ posSibType2-16 _|_ G | | | | NSS-RTK-FKP-Gradients _| +------------------------+------------------+------------------------+ | |_ posSibType2-17 _|_ GNSS | | | | -SSR-OrbitCorrections _| +------------------------+------------------+------------------------+ | |_ posSibType2-18 _|_ GNSS | | | | -SSR-ClockCorrections _| +------------------------+------------------+------------------------+ | |_ posSibType2-19 _|_ GNSS-SSR-CodeBias _| +------------------------+------------------+------------------------+ | |_ posSibType2-20 _|_ GNSS-SSR-URA _| +------------------------+------------------+------------------------+ | |_ posSibType2-21 _|_ GNSS-SSR-PhaseBias _| +------------------------+------------------+------------------------+ | |_ posSibType2-22 _|_ GNS | | | | S-SSR-STEC-Correction _| +------------------------+------------------+------------------------+ | |_ posSibType2-23 _|_ GNSS- | | | | SSR-GriddedCorrection _| +------------------------+------------------+------------------------+ | |_ posSibType2-24 _|_ NavIC-Di | | | | fferentialCorrections _| +------------------------+------------------+------------------------+ | |_ posSibType2-25 _|_ Nav | | | | IC-GridModelParameter _| +------------------------+------------------+------------------------+ | OTDOA Assistance Data |_ posSibType3-1 _|_ OTDOA-UE-Assisted _| | (clause 7.4.2) | | | +------------------------+------------------+------------------------+ | Barometric Assistance |_ posSibType4-1 _|_ Sens | | Data | | or-AssistanceDataList _| | | | | | (clause 6.5.5.8) | | | +------------------------+------------------+------------------------+ | TBS Assistance Data |_ posSibType5-1 _|_ T | | | | BS-AssistanceDataList _| | (clause 6.5.4.8) | | | +------------------------+------------------+------------------------+ | NR DL-TDOA/DL-AoD |_ posSibType6-1 _|_ NR- | | Assistance Data | | DL-PRS-AssistanceData _| | (clauses 6.4.3, 7.4.2) | | | +------------------------+------------------+------------------------+ | |_ posSibType6-2 _|_ NR | | | | -UEB-TRP-LocationData _| +------------------------+------------------+------------------------+ | |_ posSibType6-3 _|_ NR-UEB-TRP-RTD-Info* | +------------------------+------------------+------------------------+
[TS 38.331, clause 5.2.2.3.5]
The UE shall:
1> if the UE is in RRC_CONNECTED with an active BWP not configured with common
search space with the field _searchSpaceOtherSystemInformation_ and the UE has
not stored a valid version of a SIB or posSIB, in accordance with sub-clause
5.2.2.2.1, of one or several required SIB(s) or posSIB(s) in accordance with
sub-clause 5.2.2.1:
2> for the SI message(s) that, according to the _si-SchedulingInfo_ or _posSI-
SchedulingInfo_ in the stored SIB1, contain at least one required SIB or
requested posSIB:
3> if _onDemandSIB-Request_ is configured and timer T350 is not running:
4> initiate transmission of the _DedicatedSIBRequest_ message in accordance
with 5.2.2.3.6;
4> start timer T350 with the timer value set to the _onDemandSIB-
RequestProhibitTimer_ ;
1> else if the UE is in RRC_CONNECTED with an active BWP configured with
common search space with the field _searchSpaceOtherSystemInformation_ and the
UE has not stored a valid version of a SIB or posSIB, in accordance with sub-
clause 5.2.2.2.1, of one or several required SIB(s) or posSIB(s) in accordance
with sub-clause 5.2.2.1:
2> for the SI message(s) that, according to the _si-SchedulingInfo_ in the
stored SIB1, contain at least one required SIB and for which _si-
BroadcastStatus_ is set to _broadcasting_ :
3> acquire the SI message(s) as defined in sub-clause 5.2.2.3.2;
2> for the SI message(s) that, according to the _si-SchedulingInfo_ in the
stored SIB1, contain at least one required SIB and for which _si-
BroadcastStatus_ is set to _notBroadcasting_ :
3> if _onDemandSIB-Request_ is configured and timer T350 is not running:
4> initiate transmission of the _DedicatedSIBRequest_ message in accordance
with 5.2.2.3.6;
4> start timer T350 with the timer value set to the _onDemandSIB-
RequestProhibitTimer_ ;
4> acquire the requested SI message(s) corresponding to the requested SIB(s)
as defined in sub-clause 5.2.2.3.2.
2> for the SI message(s) that, according to the _posSI-SchedulingInfo_ in the
stored SIB1, contain at least one requested posSIB and for which _posSI-
BroadcastStatus_ is set to _broadcasting_ :
3> acquire the SI message(s) as defined in sub-clause 5.2.2.3.2;
2> for the SI message(s) that, according to the _posSI-SchedulingInfo_ in the
stored SIB1, contain at least one requested posSIB and for which _posSI-
BroadcastStatus_ is set to _notBroadcasting_ :
3> if _onDemandSIB-Request_ is configured and timer T350 is not running:
4> initiate transmission of the _DedicatedSIBRequest_ message in accordance
with 5.2.2.3.6;
4> start timer T350 with the timer value set to the _onDemandSIB-
RequestProhibitTimer_ ;
4> acquire the requested SI message(s) corresponding to the requested
posSIB(s) as defined in sub-clause 5.2.2.3.2.
NOTE: UE may include on demand request for SIB and/or posSIB(s) in the same
_DedicatedSIBRequest_ message.
#### 9.4.1.3 Test description
##### 9.4.1.3.1 Pre-test conditions
System Simulator:
For Test Configuration B (Table 9.4.1.3.2-2): NR Cell 1 and system information
combination NR-1 as defined in TS 38.508-1 [30] clause 4.4.3.1.2.
\- Satellite signals (sub-test case 25): as specified in 8.2.1.
\- MBS signals (Sub-test 23): as specified in 8.2.4.
\- Sub-test 20: NR Cell 1 and NR Cell 2 as specified in 8.2.10 and system
information combination NR-2 as defined in TS 38.508-1 [30] clause 4.4.3.1.2.
\- Sub-test 21: NR Cell 1, NR Cell 2 and NR Cell 3 as specified in 8.2.11 and
system information combination NR-4 as defined in TS 38.508-1 [30] clause
4.4.3.1.2.
##### UE: {#ue-41 .H6}
> The UE shall begin the test with no assistance data stored.
##### Preamble: {#preamble-26 .H6}
\- For Test Configuration B (Table 9.4.1.3.2-2): The UE is in state 3N-A as
defined in TS 38.508-1 [30], subclause 4.4A on NR Cell 1.
\- Then the SS sends the RESET UE POSITIONING STORED INFORMATION message to
the UE to clear the stored assistance data in the UE.
\- The UE is switched-off.
##### Related PICS/PIXIT Statements: {#related-picspixit-statements-57 .H6}
> -
##### 9.4.1.3.2 Test procedure sequence
This test case includes sub-test cases dependent on the positioning method(s)
supported by the UE. Each sub-test case is identified by a Sub-Test Case
Number as defined in Table 9.4.1.3.2-1 below:
Table 9.4.1.3.2-1: Sub-test case numbers
**Sub-Test Case Number** **Supported Positioning Methods**
* * *
20 UE supporting DL-AoD (Rel-16 onwards) 21 UE supporting DL-TDOA (Rel-16
onwards) 23 UE supporting MBS^(2)^ (Rel-16 onwards) 24 UE supporting Sensor
(Rel-16 onwards) 25 UE supporting GNSS^(1)^ (Rel-15 onwards) NOTE 1: The GNSS
combination of GPS, GLONASS, Galileo, BDS supported by the UE
Table 9.4.1.3.2-2: Test Configuration
**Test Configuration** **Network Deployment Type** **Test Implementation**
* * *
B NG-RAN NR
Table 9.4.1.3.2-3: Main behaviour
+------+-------------+-------------+-------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +======+=============+=============+=============+=========+====+ | | | U - S | Message | | | +------+-------------+-------------+-------------+---------+----+ | 1 | The UE is | | | - | - | | | switched | | | | | | | on. | | | | | +------+-------------+-------------+-------------+---------+----+ | 2 | System | \ | RRCR | - | - | | | sends an | | econfigurat | | | | | RRCR | | ionComplete | | | | | econfigurat | | | | | | | ionComplete | | | | | | | message. | | | | | +------+-------------+-------------+-------------+---------+----+ | 12 | The SS | \ | * | - | - | | | sends a LPP | | ULInformati | | | | | message of | | onTransfer_ | | | | | type | | | | | | | Provide | | (LPP | | | | | C | | PROVIDE | | | | | apabilities | | CA | | | | | including | | PABILITIES) | | | | | the UE | | | | | | | positioning | | | | | | | ca | | | | | | | pabilities. | | | | | +------+-------------+-------------+-------------+---------+----+ | 14 | IF | \ | * | 1 | P | | | sends a LPP | | ULInformati | | | | | message of | | onTransfer _| | | | | type | | | | | | | Provide | | (LPP | | | | | Location | | PROVIDE | | | | | Information | | LOCATION | | | | | including | | I | | | | | location | | NFORMATION) | | | | | estimate. | | | | | +------+-------------+-------------+-------------+---------+----+ | 17 | IF | \  determine the start of the SI-window for the concerned SI message as
follows:
2> if the concerned SI message is configured in the _schedulingInfoList_ :
3> for the concerned SI message, determine the number _n_ which corresponds to
the order of entry in the list of SI messages configured by
_schedulingInfoList_ in _si-SchedulingInfo_ in _SIB1_ ;
3> determine the integer value _x = (n -- 1) × w_ , where _w_ is the _si-
WindowLength_ ;
3> the SI-window starts at the slot #_a_ , where _a_ = _x_ mod N, in the radio
frame for which SFN mod _T_ = FLOOR(_x_ /N), where _T_ is the _si-Periodicity_
of the concerned SI message and N is the number of slots in a radio frame as
specified in TS 38.213 [13];
2> else if the concerned SI message is configured in the
_posSchedulingInfoList_ and _offsetToSI-Used_ is not configured:
3> create a concatenated list of SI messages by appending the
_posSchedulingInfoList_ in _posSI-SchedulingInfo_ in _SIB1 to
schedulingInfoList_ in _si-SchedulingInfo_ in _SIB1;_
3> for the concerned SI message, determine the number _n_ which corresponds to
the order of entry in the concatenated list;
3> determine the integer value _x = (n -- 1) × w_ , where _w_ is the _si-
WindowLength_ ;
3> the SI-window starts at the slot #_a_ , where _a_ = _x_ mod N, in the radio
frame for which SFN mod _T_ = FLOOR(_x_ /N), where _T_ is the _posSI-
Periodicity_ of the concerned SI message and N is the number of slots in a
radio frame as specified in TS 38.213 [13];
2> else if the concerned SI message is configured by the
_posSchedulingInfoList_ and _offsetToSI-Used_ is configured:
3> determine the number _m_ which corresponds to the number of SI messages
with an associated _si-Periodicity_ of 8 radio frames (80 ms), configured by
_schedulingInfoList_ in _SIB1_ ;
3> for the concerned SI message, determine the number _n_ which corresponds to
the order of entry in the list of SI messages configured by
_posSchedulingInfoList_ in _SIB1_ ;
3> determine the integer value _x_ = _m_ _× w +_ (_n_ \-- 1 _)_ _× w_ , where
_w_ is the _si-WindowLength;_
3> the SI-window starts at the slot #_a_ , where _a_ = _x_ mod N, in the radio
frame for which SFN mod _T_ = FLOOR(_x_ /N) +8, where _T_ is the _posSI-
Periodicity_ of the concerned SI message and N is the number of slots in a
radio frame as specified in TS 38.213 [13];.
#### 9.4.2.3 Test description
##### 9.4.2.3.1 Pre-test conditions
Same as in clause 9.4.1.3.1.
##### 9.4.2.3.2 Test procedure sequence
Same as in clause 9.4.1.3.2.
##### 9.4.2.3.3 Specific message contents
Same as 9.4.1.3.3 except that Table 9.4.2.3.3 _-1_ replaces Table 9.4.1.3.3-3.
Table 9.4.2.3.3-1: PosSI-SchedulingInfo (SIB1, Table 9.4.1.3.3-2)
+----------------+----------------+----------------+----------------+ | Derivation | | | | | Path: TS | | | | | 38.508-1, | | | | | Table 4.6.2a-2 | | | | +================+================+================+================+ | Information | Value/remark | Comment | Condition | | Element | | | | +----------------+----------------+----------------+----------------+ | PosSI-Sche | | | | | dulingInfo-r16 | | | | | ::= SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | posScheduli | 2 entries | The size of | | | ngInfoList-r16 | | PosSche | | | SEQUENCE (SIZE | | dulingInfo-r16 | | | (1..m | | is 1 for | | | axSI-Message)) | | Sub-tests 20, | | | OF | | 21, 23 and 24. | | | PosSche | | | | | dulingInfo-r16 | | If Sub-test 25 | | | { | | and UE | | | | | supports X | | | | | GNSS systems, | | | | | the size of | | | | | PosSche | | | | | dulingInfo-r16 | | | | | is (X+1) and | | | | | the | | | | | PosSche | | | | | dulingInfo-r16 | | | | | needs to be | | | | | broadcasted X | | | | | times, once | | | | | for each | | | | | different | | | | | GNSS. | | +----------------+----------------+----------------+----------------+ | PosSchedulin | | entry 1 | | | gInfo-r16[1] | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | offse | true | | | | tToSI-Used-r16 | | | | +----------------+----------------+----------------+----------------+ | posSIB-M | 3 entries for | PosSibType-n = | Sub-test 25 | | appingInfo-r16 | Sub-test 25, 1 | | | | SEQUENCE (SIZE | entry for | posSibType1-1, | | | (1..maxSIB)) | Sub-tests 20, | posSibType1-2, | | | OF | 21, 23 and 24 | posSibType1-3 | | | P | | | | | osSIB-Type-r16 | | | | | { | | | | +----------------+----------------+----------------+----------------+ | | | PosSibType-n = | Sub-test 24 | | | | | | | | | posSibType4-1 | | +----------------+----------------+----------------+----------------+ | | | PosSibType-n = | Sub-test 23 | | | | | | | | | posSibType5-1 | | +----------------+----------------+----------------+----------------+ | | | PosSibType-n = | Sub-test 20 or | | | | | Sub-test 21 | | | | posSibType6-1 | | +----------------+----------------+----------------+----------------+ | PosSIB | | entry n | | | -Type-r16[n] | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | encrypted-r16 | Not present | | | +----------------+----------------+----------------+----------------+ | gnss-id-r16 | Not present | | | +----------------+----------------+----------------+----------------+ | sbas-id-r16 | Not present | | | +----------------+----------------+----------------+----------------+ | posSibType-r16 | PosSibType-n | The | | | | | posSibType-r16 | | | | | is depending | | | | | on the | | | | | sub--test | | | | | cases and | | | | | entry number n | | +----------------+----------------+----------------+----------------+ | areaScope-r16 | Not present | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | PosSchedulin | | entry 2 | Sub-test 25 | | gInfo-r16[2] | | | | | SEQUENCE { | | If the UE | | | | | supports X | | | | | GNSS systems, | | | | | the | | | | | PosSche | | | | | dulingInfo-r16 | | | | | needs to be | | | | | broadcasted X | | | | | times, once | | | | | for each | | | | | different | | | | | GNSS. | | +----------------+----------------+----------------+----------------+ | offse | true | | | | tToSI-Used-r16 | | | | +----------------+----------------+----------------+----------------+ | posSIB-M | 6 entries for | posSibType2-1, | | | appingInfo-r16 | Sub-test 25 | posSibType2-3, | | | SEQUENCE (SIZE | | posSibType2-6, | | | (1..maxSIB)) | | posSibType2-7, | | | OF | | posSibType2-8, | | | P | | posSibType2-9 | | | osSIB-Type-r16 | | | | | { | | | | +----------------+----------------+----------------+----------------+ | PosSIB | | entry m | | | -Type-r16[m] | | | | | SEQUENCE { | | | | +----------------+----------------+----------------+----------------+ | encrypted-r16 | Not present | | | +----------------+----------------+----------------+----------------+ | gnss-id-r16 | Set depending | | | | | on the GNSS | | | | | supported by | | | | | the UE | | | +----------------+----------------+----------------+----------------+ | sbas-id-r16 | Not present | | | +----------------+----------------+----------------+----------------+ | posSibType-r16 | PosSibType-m, | The | | | | | posSibType-r16 | | | | | is depending | | | | | on the entry | | | | | number m | | +----------------+----------------+----------------+----------------+ | areaScope-r16 | Not present | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+ | } | | | | +----------------+----------------+----------------+----------------+
### 9.4.3 On-demand PosSIB followed by location information transfer /
RRC_connected state
#### 9.4.3.1 Test Purpose (TP)
##### (1) {#section-32 .H6}
**with** { a NAS signalling connection existing }
**ensure that** {
**when** { UE has no assistance data stored and receives a REQUEST LOCATION
INFORMATION message }
**then** { the UE sends the DedicatedSIBRequest message indicating the
requested posSIB }
}
##### (2) {#section-33 .H6}
**with** { a NAS signalling connection existing }
**ensure that** {
**when** { UE receives the positioning assistance data via posSIBs after
sending the onDemandSIB-Request message }
then { the UE sends a PROVIDE LOCATION INFORMATION message containing a
location estimate }
}
#### 9.4.3.2 Conformance requirements
References: The conformance requirements covered in the present TC are
specified in: TS 38.331 clauses 5.2.2.1, 5.2.2.3.5, 5.2.2.3.6 and TS 37.355
clause7.2. Unless otherwise stated these are Rel-16 requirements.
[TS 38.331, clause 5.2.2.1]
The UE applies the SI acquisition procedure to acquire the AS, NAS- and
positioning assistance data information. The procedure applies to UEs in
RRC_IDLE, in RRC_INACTIVE and in RRC_CONNECTED.
[TS 38.331, clause 5.2.2.3.5]
The UE shall:
1> if the UE is in RRC_CONNECTED with an active BWP not configured with common
search space with the field _searchSpaceOtherSystemInformation_ and the UE has
not stored a valid version of a SIB or posSIB, in accordance with sub-clause
5.2.2.2.1, of one or several required SIB(s) or posSIB(s) in accordance with
sub-clause 5.2.2.1:
2> for the SI message(s) that, according to the _si-SchedulingInfo_ or _posSI-
SchedulingInfo_ in the stored SIB1, contain at least one required SIB or
requested posSIB:
3> if _onDemandSIB-Request_ is configured and timer T350 is not running:
4> initiate transmission of the _DedicatedSIBRequest_ message in accordance
with 5.2.2.3.6;
4> start timer T350 with the timer value set to the _onDemandSIB-
RequestProhibitTimer_ ;
1> else if the UE is in RRC_CONNECTED with an active BWP configured with
common search space with the field _searchSpaceOtherSystemInformation_ and the
UE has not stored a valid version of a SIB or posSIB, in accordance with sub-
clause 5.2.2.2.1, of one or several required SIB(s) or posSIB(s) in accordance
with sub-clause 5.2.2.1:
...
2> for the SI message(s) that, according to the _posSI-SchedulingInfo_ in the
stored SIB1, contain at least one requested posSIB and for which _posSI-
BroadcastStatus_ is set to _broadcasting_ :
3> acquire the SI message(s) as defined in sub-clause 5.2.2.3.2;
2> for the SI message(s) that, according to the _posSI-SchedulingInfo_ in the
stored SIB1, contain at least one requested posSIB and for which _posSI-
BroadcastStatus_ is set to _notBroadcasting_ :
3> if _onDemandSIB-Request_ is configured and timer T350 is not running:
4> initiate transmission of the _DedicatedSIBRequest_ message in accordance
with 5.2.2.3.6;
4> start timer T350 with the timer value set to the _onDemandSIB-
RequestProhibitTimer_ ;
4> acquire the requested SI message(s) corresponding to the requested
posSIB(s) as defined in sub-clause 5.2.2.3.2.
[TS 38.331, clause 5.2.2.3.6]
The UE shall set the contents of _DedicatedSIBRequest_ message as follows:
1> if the procedure is triggered to request the required SIB(s):
2> include _requestedSIB-List_ in the _onDemandSIB-RequestList_ to indicate
the requested SIB(s);
1> if the procedure is triggered to request the required posSIB(s):
2> include _requestedPosSIB-List_ in the _onDemandSIB-RequestList_ to indicate
the requested posSIB(s).
The UE shall submit the _DedicatedSIBRequest_ message to lower layers for
transmission.
[TS 37.355, clause 7.2]
The supported _posSibType_ \'s are specified in Table 7.2-1. The GNSS Common
and Generic Assistance Data IEs are defined in clause 6.5.2.2. The OTDOA
Assistance Data IEs and NR DL-TDOA/DL-AoD Assistance Data IEs are defined in
clause 7.4.2. The Barometric Assistance Data IEs are defined in clause
6.5.5.8. The TBS (based on MBS signals) Assistance Data IEs are defined in
clause 6.5.4.8.
Table 7.2-1: Mapping of posSibType to assistanceDataElement
+------------------------+------------------+------------------------+ | | _posSibType_ | * | | | | assistanceDataElement _| +========================+==================+========================+ | GNSS Common Assistance |_ posSibType1-1 _|_ GNSS-ReferenceTime _| | Data (clause 6.5.2.2) | | | +------------------------+------------------+------------------------+ | |_ posSibType1-2 _|_ G | | | | NSS-ReferenceLocation _| +------------------------+------------------+------------------------+ | |_ posSibType1-3 _| * | | | | GNSS-IonosphericModel_ | +------------------------+------------------+------------------------+ | | _posSibType1-4_ | _GNSS-Earth | | | | OrientationParameters_ | +------------------------+------------------+------------------------+ | | _posSibType1-5_ | _GNSS-RTK | | | | -ReferenceStationInfo_ | +------------------------+------------------+------------------------+ | | _posSibType1-6_ | _GNSS-RTK- | | | | CommonObservationInfo_ | +------------------------+------------------+------------------------+ | | _posSibType1-7_ | _GNSS-RTK | | | | -AuxiliaryStationData_ | +------------------------+------------------+------------------------+ | | _posSibType1-8_ | _GNSS | | | | -SSR-CorrectionPoints_ | +------------------------+------------------+------------------------+ | GNSS Generic | _posSibType2-1_ | _GNSS-TimeModelList_ | | Assistance Data | | | | (clause 6.5.2.2) | | | +------------------------+------------------+------------------------+ | | _posSibType2-2_ | _GNSS-Di | | | | fferentialCorrections_ | +------------------------+------------------+------------------------+ | | _posSibType2-3_ | _GNSS-NavigationModel_ | +------------------------+------------------+------------------------+ | | _posSibType2-4_ | _G | | | | NSS-RealTimeIntegrity_ | +------------------------+------------------+------------------------+ | | _posSibType2-5_ | _G | | | | NSS-DataBitAssistance_ | +------------------------+------------------+------------------------+ | | _posSibType2-6_ | _GNSS- | | | | AcquisitionAssistance_ | +------------------------+------------------+------------------------+ | | _posSibType2-7_ | _GNSS-Almanac_ | +------------------------+------------------+------------------------+ | | _posSibType2-8_ | _GNSS-UTC-Model_ | +------------------------+------------------+------------------------+ | | _posSibType2-9_ | _GNSS | | | | -AuxiliaryInformation_ | +------------------------+------------------+------------------------+ | | _posSibType2-10_ | _BDS-Di | | | | fferentialCorrections_ | +------------------------+------------------+------------------------+ | | _posSibType2-11_ | _B | | | | DS-GridModelParameter_ | +------------------------+------------------+------------------------+ | | _posSibType2-12_ | * | | | | GNSS-RTK-Observations _| +------------------------+------------------+------------------------+ | |_ posSibType2-13 _|_ GL | | | | O-RTK-BiasInformation _| +------------------------+------------------+------------------------+ | |_ posSibType2-14 _|_ GNSS-RTK-MAC- | | | | CorrectionDifferences _| +------------------------+------------------+------------------------+ | |_ posSibType2-15 _|_ GNSS-RTK-Residuals _| +------------------------+------------------+------------------------+ | |_ posSibType2-16 _|_ G | | | | NSS-RTK-FKP-Gradients _| +------------------------+------------------+------------------------+ | |_ posSibType2-17 _|_ GNSS | | | | -SSR-OrbitCorrections _| +------------------------+------------------+------------------------+ | |_ posSibType2-18 _|_ GNSS | | | | -SSR-ClockCorrections _| +------------------------+------------------+------------------------+ | |_ posSibType2-19 _|_ GNSS-SSR-CodeBias _| +------------------------+------------------+------------------------+ | |_ posSibType2-20 _|_ GNSS-SSR-URA _| +------------------------+------------------+------------------------+ | |_ posSibType2-21 _|_ GNSS-SSR-PhaseBias _| +------------------------+------------------+------------------------+ | |_ posSibType2-22 _|_ GNS | | | | S-SSR-STEC-Correction _| +------------------------+------------------+------------------------+ | |_ posSibType2-23 _|_ GNSS- | | | | SSR-GriddedCorrection _| +------------------------+------------------+------------------------+ | |_ posSibType2-24 _|_ NavIC-Di | | | | fferentialCorrections _| +------------------------+------------------+------------------------+ | |_ posSibType2-25 _|_ Nav | | | | IC-GridModelParameter _| +------------------------+------------------+------------------------+ | OTDOA Assistance Data |_ posSibType3-1 _|_ OTDOA-UE-Assisted _| | (clause 7.4.2) | | | +------------------------+------------------+------------------------+ | Barometric Assistance |_ posSibType4-1 _|_ Sens | | Data | | or-AssistanceDataList _| | | | | | (clause 6.5.5.8) | | | +------------------------+------------------+------------------------+ | TBS Assistance Data |_ posSibType5-1 _|_ T | | | | BS-AssistanceDataList _| | (clause 6.5.4.8) | | | +------------------------+------------------+------------------------+ | NR DL-TDOA/DL-AoD |_ posSibType6-1 _|_ NR- | | Assistance Data | | DL-PRS-AssistanceData _| | (clauses 6.4.3, 7.4.2) | | | +------------------------+------------------+------------------------+ | |_ posSibType6-2 _|_ NR | | | | -UEB-TRP-LocationData _| +------------------------+------------------+------------------------+ | |_ posSibType6-3 _|_ NR-UEB-TRP-RTD-Info* | +------------------------+------------------+------------------------+
#### 9.4.3.3 Test description
##### 9.4.3.3.1 Pre-test conditions
System Simulator:
\- Sub-test 23, sub-test 24 and sub-test 25: NR Cell 1 and system information
combination NR-1 as defined in TS 38.508-1 [30] clause 4.4.3.1.2.
\- Satellite signals (sub-test case 25): as specified in 8.2.1.
\- MBS signals (Sub-test 23): as specified in 8.2.4.
\- Sub-test 20: NR Cell 1 and NR Cell 2 as specified in 8.2.10 and system
information combination NR-2 as defined in TS 38.508-1 [30] clause 4.4.3.1.2.
\- Sub-test 21: NR Cell 1, NR Cell 2 and NR Cell 3 as specified in 8.2.11 and
system information combination NR-4 as defined in TS 38.508-1 [30] clause
4.4.3.1.2..
##### UE: {#ue-42 .H6}
> The UE shall begin the test with no assistance data stored.
##### Preamble: {#preamble-27 .H6}
\- The UE is in state 3N-A as defined in TS 38.508-1 [30], subclause 4.4A on
NR Cell 1.
\- Then the SS sends the RESET UE POSITIONING STORED INFORMATION message to
the UE to clear the stored assistance data in the UE.
##### Related PICS/PIXIT Statements: {#related-picspixit-statements-58 .H6}
> -
##### 9.4.3.3.2 Test procedure sequence
This test case includes sub-test cases dependent on the positioning method(s)
supported by the UE. Each sub-test case is identified by a Sub-Test Case
Number as defined in Table 9.4.3.3.2-1 below:
Table 9.4.3.3.2-1: Sub-test case numbers
**Sub-Test Case Number** **Supported Positioning Methods**
* * *
20 UE supporting DL-AoD (Rel-16 onwards) 21 UE supporting DL-TDOA (Rel-16
onwards) 23 UE supporting MBS^(2)^ (Rel-16 onwards) 24 UE supporting Sensor
(Rel-16 onwards) 25 UE supporting GNSS^(1)^ (Rel-15 onwards) NOTE 1: The GNSS
combination of GPS, GLONASS, Galileo, BDS supported by the UE
Table 9.4.3.3.2-2: Test Configuration
**Test Configuration** **Network Deployment Type** **Test Implementation**
* * *
B NG-RAN NR
Table 9.4.3.3.2-3: Main behaviour
+-----+--------------+--------------+--------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +=====+==============+==============+==============+=========+====+ | | | U - S | Message | | | +-----+--------------+--------------+--------------+---------+----+ | - | EXCEPTION: | | | | | | | Steps 1a1 to | | | | | | | 1a2 describe | | | | | | | behaviour | | | | | | | that depends | | | | | | | on the UE | | | | | | | capability; | | | | | | | the \"lower | | | | | | | case | | | | | | | letter\" | | | | | | | identifies a | | | | | | | step | | | | | | | sequence | | | | | | | that takes | | | | | | | place if a | | | | | | | capability | | | | | | | is | | | | | | | supported. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 1a1 | IF | \ | RR | - | - | | | an | | CReconfigura | | | | | RR | | tionComplete | | | | | CReconfigura | | | | | | | tionComplete | | | | | | | message. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 2 | The SS sends | \ | _ULInformat | - | - | | | a LPP | | ionTransfer_ | | | | | message of | | | | | | | type Provide | | (LPP PROVIDE | | | | | Capabilities | | C | | | | | including | | APABILITIES) | | | | | the UE | | | | | | | positioning | | | | | | | c | | | | | | | apabilities. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 4 | IF | \ | RRC: | 1 | P | | | the UE send | | Dedicat | | | | | the | | edSIBRequest | | | | | Dedicat | | | | | | | edSIBRequest | | | | | | | message | | | | | | | indicating | | | | | | | the | | | | | | | requested | | | | | | | posSIBs | | | | | | | within 5 S? | | | | | +-----+--------------+--------------+--------------+---------+----+ | - | EXCEPTION: | | | | | | | In parallel | | | | | | | to events | | | | | | | described in | | | | | | | step 6 steps | | | | | | | 7a and 7b | | | | | | | may take | | | | | | | place. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 7a | The UE sends | --> | _ULInformat | | | | | the LPP | | ionTransfer_ | | | | | message of | | | | | | | type REQUEST | | (LPP REQUEST | | | | | ASSISTANCE | | ASSISTANCE | | | | | DATA message | | DATA) | | | +-----+--------------+--------------+--------------+---------+----+ | 7b | The SS does | | | | | | | not respond | | | | | | | to the LPP | | | | | | | REQUEST | | | | | | | ASSISTANCE | | | | | | | DATA | | | | | | | message. | | | | | +-----+--------------+--------------+--------------+---------+----+ | 8 | The | \ | _ULInformat | 2 | P | | | the UE send | | ionTransfer_ | | | | | an LPP | | | | | | | message of | | (LPP PROVIDE | | | | | type Provide | | LOCATION | | | | | Location | | INFORMATION) | | | | | Information | | | | | | | including | | | | | | | location | | | | | | | estimate? | | | | | +-----+--------------+--------------+--------------+---------+----+ | 10 | IF | \ if and only if upper layers indicate to start performing location
measurements towards E-UTRA or NR or start subframe and slot timing detection
towards E-UTRA, and the UE requires measurement gaps for these operations
while measurement gaps are either not configured or not sufficient:
2> if preconfigured measurement gaps for positioning are configured and the UE
considers that at least one of the preconfigured measurement gaps for
positioning is sufficient for the location measurement when activated:
3> trigger the lower layers to initiate the measurement gap activation request
using UL MAC CE as specified in TS 38.321 [3];
2> else:
3> initiate the procedure to indicate start as specified in clause 5.5.6.3;
NOTE 1: The UE verifies the measurement gap situation only upon receiving the
indication from upper layers. If at this point in time sufficient gaps are
available, the UE does not initiate the procedure. Unless it receives a new
indication from upper layers, the UE is only allowed to further repeat the
procedure in the same PCell once per frequency of the target RAT if the
provided measurement gaps are insufficient.
NOTE 1a: When indication is received from upper layers for performing location
measurement and there is pre-configured measurement gap configured (not
preconfigured measurement gap for positioning), the UE considers this
preconfigured measurement gap to be not sufficient if the measurement gap is
not considered to be always activated according to clause 9.1.7.2 of TS 38.133
[14].
1> if and only if upper layers indicate to stop performing location
measurements towards E-UTRA or NR or stop subframe and slot timing detection
towards E-UTRA:
2> if there is no activated preconfigured measurement gap for positioning:
3> if there is previously triggered UL MAC CE transmission for the measurement
gap activation for positioning:
4> indicate to the lower layers to cancel the triggered UL MAC CE transmission
for the measurement gap activation as specified in TS 38.321 [3];
3> else:
4> initiate the procedure to indicate stop as specified in 5.5.6.3.
2> else if there is activated preconfigured measurement gap for positioning:
3> trigger the lower layers to deactivate all the activated measurement gap(s)
for positioning as specified in TS 38.321 [3].
NOTE 2: The UE may initiate the procedure to indicate stop even if it did not
previously initiate the procedure to indicate start.
[TS 38.321, clause 5.18.20]
If the UE is configured with pre-configured measurement gaps, the network may
send DL MAC CE for Positioning Measurement Gap Activation/Deactivation Command
to the UE as in clause 6.1.3.41. For the activated measurement gap, the UE
shall follow the specified UE behaviour in clause 5.14.
Upon the reception of the MAC CE for Positioning Measurement Gap
Activation/Deactivation Command, the MAC entity shall:
1> if the Measurement Gap Activation/Deactivation Command MAC CE indicates the
deactivation of a pre-configured positioning measurement gap:
2> deactivate the positioning measurement gap.
1> else if the Positioning Measurement Gap Activation/Deactivation Command MAC
CE indicates the activation of a pre-configured measurement gap:
2> activate the positioning measurement gap and perform the procedure
specified in clause 5.14.
[TS 38.321, clause 5.25]
If the UE is configured with pre-configured measurement gap, the UE may
request the network to activate or deactivate the Positioning measurement gap
with UL MAC CE for Positioning Measurement Gap Activation/Deactivation Request
in clause 6.1.3.40.
The MAC entity shall, when triggered by the upper layer to send Positioning
Measurement Gap Activation/Deactivation Request, cancel the triggered
Positioning Measurement Gap Activation/Deactivation Request, if any and
trigger another Positioning Measurement Gap Activation/Deactivation Request
according to the upper layer\'s request.
The MAC entity shall,
1>if Positioning Measurement Gap Activation/Deactivation Request MAC CE has
been triggered, and not cancelled:
2> if indication from upper layer has been received that the triggered
Positioning Measurement Gap Activation/Deactivation Request MAC CE should be
cancelled; or
2> if the pre-configured measurement gap indicated in the Positioning
Measurement Gap Activation/Deactivation Request MAC CE has already been
activated/deactivated according to clause 5.18.20:
3> cancel the triggered Positioning Measurement Gap Activation/Deactivation
Request MAC CE.
2> if UL-SCH resources are available for a new transmission and these UL-SCH
resources can accommodate the Positioning Measurement Gap
Activation/Deactivation Request MAC CE plus its subheader as a result of
logical channel prioritization:
3> instruct the Multiplexing and Assembly procedure to generate the
Positioning Measurement Gap Activation/Deactivation Request MAC CE according
to the upper layer\'s request;
3> cancel triggered Positioning Measurement Gap Activation/Deactivation
Request MAC CE.
2> else:
3> trigger a Scheduling Request for Positioning Measurement Gap
Activation/Deactivation Request MAC CE.
[TS 38.321, clause 6.1.3.40]
The Positioning Measurement Gap Activation/deactivation request MAC CE is
identified by MAC subheader with eLCID as specified in Table 6.2.1-2b.
It has a fixed 8-bit size defined as follows (Figure 6.1.3.40-1):
\- Positioning MG ID: This field indicates the identifier for the pre-
configured positioning measurement gap. The length of the field is 4 bits;
\- A/D: This field indicates the activation or deactivation of the Positioning
Measurement Gap. The field is set to 1 to indicate activation, otherwise it
indicates deactivation. The length of the field is 1 bit;
\- R: Reserved bit, set to 0.
Figure 6.1.3.40-1: Positioning Measurement Gap Activation/Deactivation Request
MAC CE
[TS 38.321, clause 6.1.3.41]
The Positioning Measurement Gap Activation/Deactivation Command MAC CE is
identified by MAC subheader with eLCID as specified in Table 6.2.1-1b.
It has a fixed 8-bit size defined as follows (Figure 6.1.3.41-1):
\- Positioning MG ID: This field indicates the identifier for the
preconfigured positioning measurement gap. The length of the field is 4 bits;
\- A/D: This field indicates the activation or deactivation of the Positioning
Measurement Gap. The field is set to 1 to indicate activation, otherwise it
indicates deactivation. The length of the field is 1 bit;
\- R: Reserved bit, set to 0.
Figure 6.1.3.41-1: Positioning Measurement Gap Activation/Deactivation Command
MAC CE
#### 9.4.4.3 Test description
##### 9.4.4.3.1 Pre-test conditions
System Simulator:
\- Sub-test 26: NR Cell 1 as specified in 8.2.9
\- Sub-test 27: NR Cell 1 and NR Cell 2 as specified in 8.2.10.
\- Sub-test 28: NR Cell 1, NR Cell 2 and NR Cell 3 as specified in 8.2.11.
##### UE: {#ue-43 .H6}
  * The UE shall begin the test with no assistance data stored.
##### Preamble: {#preamble-28 .H6}
\- The UE is in state 3N-A as defined in TS 38.508-1 [30], subclause 4.4A on
NR Cell 1.
\- Then the SS sends the RESET UE POSITIONING STORED INFORMATION message to
the UE to clear the stored assistance data in the UE.
##### Related PICS/PIXIT Statements: {#related-picspixit-statements-59 .H6}
-
##### 9.4.4.3.2 Test procedure sequence
This test case includes sub-test cases dependent on the positioning method(s)
supported by the UE. Each sub-test case is identified by a sub-test case
number as defined in Table 9.4.4.3.2-1 below:
Table 9.4.4.3.2-1: Sub-test case numbers
**Sub-Test Case Number** **Supported Positioning Methods**
* * *
26 UE supporting Multi-RTT (Rel-17 onwards) 27 UE supporting DL-AoD (Rel-17
onwards) 28 UE supporting DL-TDOA (Rel-17 onwards)
Table 9.4.4.3.2-2: Test Configuration
**Test Configuration** **Network Deployment Type** **Test Implementation**
* * *
B NG-RAN NR
Table 9.4.4.3.2-3: Main behaviour
+----+--------------+--------------+--------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +====+==============+==============+==============+=========+====+ | | | U - S | Message | | | +----+--------------+--------------+--------------+---------+----+ | 1 | The SS sends | \ | _ULInformat | - | - | | | an LPP | | ionTransfer_ | | | | | message of | | | | | | | type Provide | | (LPP PROVIDE | | | | | Capabilities | | C | | | | | including | | APABILITIES) | | | | | the UE | | | | | | | positioning | | | | | | | c | | | | | | | apabilities. | | | | | +----+--------------+--------------+--------------+---------+----+ | 3 | IF | \ | RR | 1 | P | | | the UE send | | CReconfigura | | | | | an | | tionComplete | | | | | RR | | | | | | | CReconfigura | | | | | | | tionComplete | | | | | | | message to | | | | | | | confirm the | | | | | | | reception of | | | | | | | pr | | | | | | | e-configured | | | | | | | measurement | | | | | | | gap | | | | | | | co | | | | | | | nfiguration? | | | | | +----+--------------+--------------+--------------+---------+----+ | 7 | The SS sends | \ | MAC CE | 2 | P | | | the UE send | | | | | | | a | | (Positioning | | | | | measurement | | Measurement | | | | | gap | | Gap | | | | | activation | | Activation | | | | | request | | Request) | | | | | using UL MAC | | | | | | | CE | | | | | | | containing | | | | | | | the | | | | | | | measurement | | | | | | | gap ID to | | | | | | | activate the | | | | | | | positioning | | | | | | | measurement | | | | | | | gap? | | | | | +----+--------------+--------------+--------------+---------+----+ | 9 | The SS sends | \ | _ULInformat | 3 | P | | | the UE send | | ionTransfer_ | | | | | an LPP | | | | | | | message of | | (LPP PROVIDE | | | | | type Provide | | LOCATION | | | | | Location | | INFORMATION) | | | | | Information | | | | | | | including | | | | | | | location | | | | | | | estimate or | | | | | | | location | | | | | | | m | | | | | | | easurements? | | | | | +----+--------------+--------------+--------------+---------+----+ | 11 | IF | \ | MAC CE | 4 | P | | | the UE send | | | | | | | a | | (Positioning | | | | | Measurement | | Measurement | | | | | Gap | | Gap | | | | | Deactivation | | Deactivation | | | | | Request to | | Request) | | | | | deactivate | | | | | | | the | | | | | | | activated | | | | | | | measurement | | | | | | | gap? | | | | | +----+--------------+--------------+--------------+---------+---+
##### 9.4.4.3.3 Specific message contents
_Table_ 9.4.4.3.3-1 _:_ RESET UE POSITIONING STORED INFORMATION (Preamble)
+----------------+----------------+----------------+---------------+ | Derivation | | | | | Path: 38.509 | | | | | clause 6.6 | | | | +================+================+================+===============+ | **Information | ** |** Comment**|** Condition**| | Element** | Value/remark** | | | +----------------+----------------+----------------+---------------+ | UE Positioning | Sub-test 26: 0 | Sub-test 26: | | | Technology | 0 0 0 0 1 1 0 | Multi-RTT | | | | | | | | | Sub-test 27: 0 | Sub-test 27: | | | | 0 0 0 1 0 0 0 | DL-AoD | | | | | | | | | Sub-test 28: 0 | Sub-test 28: | | | | 0 0 0 0 1 1 1 | DL-TDOA | | +----------------+----------------+----------------+---------------+
_Table_ 9.4.4.3.3-2: DLInformationTransfer (step 1, step 3, step 4, step 7 and
step 11, Table 9.4.4.3.2-3)
Derivation Path: 38.331 clause 6.2.2
* * *
Information Element Value/remark Comment Condition DLInformationTransfer ::=
SEQUENCE {  
rrc-TransactionIdentifier  
criticalExtensions CHOICE {  
dlInformationTransfer SEQUENCE {  
dedicatedNAS-Message OCTET STRING Set according to Table 9.4.4.3.3-3 DL NAS
TRANSPORT  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}
Table 9.4.4.3.3-3: DL NAS TRANSPORT (DLInformationTransfer, Table 9.4.4.3.3-2)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 24.501 | | | | | Table | | | | | 8.2.11.1.1 | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Extended | 01111110 | 5GS mobility | | | Protocol | | management | | | discriminator | | messages | | +-----------------+-----------------+-----------------+-----------+ | Security header | 0000 | Plain 5GS NAS | | | type | | message | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | Downlink | | | octet | | generic NAS | | | | | transport | | +-----------------+-----------------+-----------------+-----------+ | DL NAS | 01101000 | DL NAS | | | TRANSPORT | | transport | | | message | | | | | identity | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | 0011 | LTE Positioning | | | container type | | Protocol (LPP) | | | | | message | | | | | container | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | | | | octet | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | **Step 1:** | LPP Request | | | container | | Capabilities. | | | | Set according | | | | | to Table | | | | | _8.4-2_ | | | +-----------------+-----------------+-----------------+-----------+ | | **Steps 3 and | LPP | | | | 11:** | Acknowledgement | | | | | | | | | Set according | | | | | to Table | | | | | 9.4.4.3.3-4 | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 4:** | LPP Provide | | | | | Assistance Data | | | | Set according | | | | | to Table | | | | | 9.4.4.3.3-5 | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 7:** | LPP Request | | | | | Location | | | | Set according | Information | | | | to Table | | | | | 9.4.4.3.3-6 | | | +-----------------+-----------------+-----------------+-----------+ | Additional | Present | Routing | | | information | | Identif | | | | | ier/Correlation | | | | | ID | | +-----------------+-----------------+-----------------+-----------+
Table 9.4.4.3.3-4: LPP Acknowledgement (DL NAS TRANSPORT, Table 9.4.4.3.3-3)
Derivation Path: 37.355 clause 6.2
* * *
Information Element Value/remark Comment Condition LPP-Message ::= SEQUENCE {  
transactionID Not present  
endTransaction TRUE  
sequenceNumber Not present  
acknowledgement SEQUENCE {  
ackRequested FALSE  
ackIndicator (0..255) Contains the same value of the sequenceNumber field in
steps 2 or 10, Table 9.4.4.3.2-3  
}  
lpp-MessageBody Not present.  
}
Table 9.4.4.3.3-5: LPP Provide Assistance data (DL NAS TRANSPORT, Table
9.4.4.3.3-3)
* * *
Derivation Path: Table 8.4-1  
Information Element Value/remark Comment Condition As defined in Table 8.4-1
with the following exceptions:  
transactionID SEQUENCE {  
initiator locationServer  
transactionNumber (0..255)  
}
* * *
Table 9.4.4.3.3-6: LPP Request Location Information (DL NAS TRANSPORT, Table
9.4.4.3.3-3)
Derivation Path: Table 8.4-3
* * *
Information Element Value/remark Comment Condition As defined in Table 8.4-3
with the following exceptions:  
locationInformationType locationMeasurementsPreferred
Table 9.4.4.3.3-7: RRCReconfiguration (step 5, Table 9.4.4.3.2-3)
* * *
Derivation Path: TS 38.331 [6], clause 6.2.2  
Information Element Value/remark Comment Condition RRCReconfiguration ::=
SEQUENCE {  
rrc-TransactionIdentifier RRC-TransactionIdentifier  
criticalExtensions CHOICE {  
rrcReconfiguration SEQUENCE {  
radioBearerConfig Not present  
secondaryCellGroup Not present  
measConfig SEQUENCE {  
measObjectToRemoveList Not present  
measObjectToAddModList Not present  
reportConfigToRemoveList Not present  
reportConfigToAddModList Not present  
measIdToRemoveList Not present  
measIdToAddModList Not present  
s-MeasureConfig Not present  
quantityConfig Not present  
measGapConfig SEQUENCE {  
gapFR2 Not present  
gapFR1 Not present  
gapUE Not present  
gapToAddModList-r17 Not present  
gapToReleaseList-r17 Not present  
posMeasGapPreConfigToAddModList-r17 SEQUENCE (SIZE
(1..maxNrofPreConfigPosGapId-r17)) OF PosGapConfig-r17 { 2 entries  
PosGapConfig-r17[1] SEQUENCE { entry 1  
measPosPreConfigGapId-r17 1  
gapOffset-r17 0  
mgl-r17 ms6  
mgrp-r17 ms40  
mgta-r17 ms0  
gapType-r17 perFR1  
}  
PosGapConfig-r17[2] SEQUENCE { entry 2  
measPosPreConfigGapId-r17 2  
gapOffset-r17 0  
mgl-r17 ms5dot5  
mgrp-r17 ms40  
mgta-r17 ms0  
gapType-r17 perFR2  
}  
}  
posMeasGapPreConfigToReleaseList-r17 Not present  
}  
measGapSharingConfig Not present  
interFrequencyConfig-NoGap-r16 Not present  
}  
lateNonCriticalExtension Not present  
nonCriticalExtension Not present  
}  
}  
}
* * *
Table 9.4.4.3.3-8: ULInformationTransfer (step 2 and step 10, Table
9.4.4.3.2-3)
Derivation Path: 38.331 clause 6.2.2
* * *
Information Element Value/remark Comment Condition ULInformationTransfer ::=
SEQUENCE {  
criticalExtensions CHOICE {  
ulInformationTransfer SEQUENCE {  
dedicatedNAS-Message OCTET STRING Set according to Table 9.4.4.3.3-9 UL NAS
TRANSPORT  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}
Table 9.4.4.3.3-9: UL NAS TRANSPORT (ULInformationTransfer, Table 9.4.4.3.3-8)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 24.501 | | | | | Table | | | | | 8.2.10.1.1 | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Extended | 01111110 | 5GS mobility | | | Protocol | | management | | | discriminator | | messages | | +-----------------+-----------------+-----------------+-----------+ | Security header | 0000 | Plain 5GS NAS | | | type | | message | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | | | | octet | | | | +-----------------+-----------------+-----------------+-----------+ | UL NAS | 01100111 | UL NAS | | | TRANSPORT | | TRANSPORT | | | message | | | | | identity | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | 0011 | LTE Positioning | | | container type | | Protocol (LPP) | | | | | message | | | | | container | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | | | | octet | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | **Step 2:** | LPP Provide | | | container | | Capabilities | | | | Set according | | | | | to Table | | | | | | | | | | 9.4.4.3.3-10 | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 10:** | LPP Provide | | | | | Location | | | | Set according | Information | | | | to Table | | | | | | | | | | 9.4.4.3.3-11 | | | +-----------------+-----------------+-----------------+-----------+ | Additional | Present | The UE includes | | | information | | the Routing | | | | | Identifier | | | | | received in the | | | | | Additional | | | | | Information IE | | | | | of the DOWNLINK | | | | | GENERIC NAS | | | | | TRANSPORT | | | | | message (step 1 | | | | | Table | | | | | 9.4.4.3.2-3) | | +-----------------+-----------------+-----------------+-----------+
Table 9.4.4.3.3-10: LPP Provide Capabilities (UL NAS TRANSPORT, Table
9.4.4.3.3-9)
Derivation Path: 37.355 clause 6.2
* * *
Information Element Value/remark Comment Condition LPP-Message ::= SEQUENCE {  
transactionID SEQUENCE {  
initiator locationServer  
transactionNumber (0..255) Contains the same value as the corresponding field
in the LPP Request Capabilities message in step 1, Table 9.4.4.3.2-3  
}  
endTransaction TRUE  
sequenceNumber (0..255)  
acknowledgement SEQUENCE { Present, or not present  
ackRequested TRUE  
ackIndicator Not present  
}  
lpp-MessageBody CHOICE {  
c1 CHOICE {  
provideCapabilities SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
provideCapabilities-r9 SEQUENCE {  
commonIEsProvideCapabilities Dependent on UE capabilities  
nr-Multi-RTT-ProvideCapabilities-r16 Dependent on UE capabilities  
nr-DL-AoD-ProvideCapabilities-r16 Dependent on UE capabilities  
nr-DL-TDOA-ProvideCapabilities-r16 Dependent on UE capabilities  
nr-UL-ProvideCapabilities-r16 Dependent on UE capabilities  
}  
}  
}  
}  
}  
}  
}
Table 9.4.4.3.3-11: LPP Provide Location Information (UL NAS TRANSPORT, Table
9.4.4.3.3-8)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 37.355 | | | | | clause 6.2 | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | LPP-Message ::= | | | | | SEQUENCE { | | | | +-----------------+-----------------+-----------------+-----------+ | transactionID | | | | | SEQUENCE { | | | | +-----------------+-----------------+-----------------+-----------+ | initiator | locationServer | | | +-----------------+-----------------+-----------------+-----------+ | tr | (0..255) | Contains the | | | ansactionNumber | | same value as | | | | | the | | | | | corresponding | | | | | field in LPP | | | | | Request | | | | | Location | | | | | Information | | | | | message in step | | | | | 7, Table | | | | | 9.4.4.3.2-3 | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+ | endTransaction | TRUE | | | +-----------------+-----------------+-----------------+-----------+ | sequenceNumber | (0..255) | | | +-----------------+-----------------+-----------------+-----------+ | acknowledgement | present, or not | | | | SEQUENCE { | present | | | +-----------------+-----------------+-----------------+-----------+ | ackRequested | TRUE | | | +-----------------+-----------------+-----------------+-----------+ | ackIndicator | Not present | | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+ | lpp-MessageBody | | | | | CHOICE { | | | | +-----------------+-----------------+-----------------+-----------+ | c1 CHOICE { | | | | +-----------------+-----------------+-----------------+-----------+ | provideLoca | | | | | tionInformation | | | | | SEQUENCE { | | | | +-----------------+-----------------+-----------------+-----------+ | cri | | | | | ticalExtensions | | | | | CHOICE { | | | | +-----------------+-----------------+-----------------+-----------+ | c1 CHOICE { | | | | +-----------------+-----------------+-----------------+-----------+ | provideLocatio | | | | | nInformation-r9 | | | | | | | | | | SEQUENCE { | | | | +-----------------+-----------------+-----------------+-----------+ | commo | May be present. | | | | nIEsProvideLoca | Any value | | | | tionInformation | acceptable | | | +-----------------+-----------------+-----------------+-----------+ | nr-Multi-RTT- | Present for | Rel-17 onwards | | | ProvideLocation | sub-test 26 | | | | Information-r16 | | | | | SEQUENCE { | | | | +-----------------+-----------------+-----------------+-----------+ | nr-Multi-RTT-Si | Present. Any | | | | gnalMeasurement | value | | | | Information-r16 | acceptable | | | +-----------------+-----------------+-----------------+-----------+ | nr-Mult | Not present | | | | i-RTT-Error-r16 | | | | +-----------------+-----------------+-----------------+-----------+ | nr-Multi-RTT- | Not present | | | | SignalMeasureme | | | | | ntInstances-r17 | | | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+ | nr-DL-AoD- | Present for | Rel-17 onwards | | | ProvideLocation | sub-test 27 | | | | Information-r16 | | | | | SEQUENCE { | | | | +-----------------+-----------------+-----------------+-----------+ | nr-DL-AoD-Si | Present. Any | | | | gnalMeasurement | value | | | | Information-r16 | acceptable | | | +-----------------+-----------------+-----------------+-----------+ | nr- | Not checked | | | | dl-AoD-Location | | | | | Information-r16 | | | | +-----------------+-----------------+-----------------+-----------+ | nr-D | Not present | | | | L-AoD-Error-r16 | | | | +-----------------+-----------------+-----------------+-----------+ | nr-DL-AoD- | Not present | | | | SignalMeasureme | | | | | ntInstances-r17 | | | | +-----------------+-----------------+-----------------+-----------+ | nr-DL-AoD-Lo | Not present | | | | cationInformati | | | | | onInstances-r17 | | | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+ | nr-DL-TDOA- | Present for | Rel-17 onwards | | | ProvideLocation | sub-test 28 | | | | Information-r16 | | | | | SEQUENCE { | | | | +-----------------+-----------------+-----------------+-----------+ | nr-DL-TDOA-Si | Present. Any | | | | gnalMeasurement | value | | | | Information-r16 | acceptable | | | +-----------------+-----------------+-----------------+-----------+ | nr-d | Not checked | | | | l-tdoa-Location | | | | | Information-r16 | | | | +-----------------+-----------------+-----------------+-----------+ | nr-DL | Not present | | | | -TDOA-Error-r16 | | | | +-----------------+-----------------+-----------------+-----------+ | nr-DL-TDOA- | Not present | | | | SignalMeasureme | | | | | ntInstances-r17 | | | | +-----------------+-----------------+-----------------+-----------+ | nr-DL-TDOA-Lo | Not present | | | | cationInformati | | | | | onInstances-r17 | | | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+ | } | | | | +-----------------+-----------------+-----------------+-----------+
### 9.4.5 Pre-configured PRS processing window procedures
#### 9.4.5.1 Test Purpose (TP)
##### (1) {#section-38 .H6}
**with** { a NAS signalling connection existing }
**ensure that** {
**when** { UE has no assistance data stored and PRS processing window was
configured with associated ID via RRCReconfiguration message}
**then** { the UE sends a RRCReconfigurationComplete message to confirm the
reception of pre-configured PRS processing window configuration }
}
##### (2) {#section-39 .H6}
**with** { a NAS signalling connection existing }
**ensure that** {
**when** { UE was configured with PRS processing window and receives PPW
Activation Command and then UE receives a location request from LMF }
**then** { the UE sends a PROVIDE LOCATION INFORMATION message containing a
location estimate }
}
#### 9.4.5.2 Conformance requirements
References: The conformance requirements covered in the present TC are
specified in: TS 38.305 clause 7.8, TS 38.321 clauses 5.18.21, 5.24 and
6.1.3.42, TS 38.214 clause 5.1.6.5 and TS 38.133 clause 9.9.1.2. Unless
otherwise stated these are Rel-17 requirements.
[TS 38.305, clause 7.8]
The pre-configured PRS processing window procedure is used by the network to
provide PRS processing window for NR DL-PRS measurements to the UE without
measurement gap. The gNB may activate the pre-configurated PRS processing
window upon receiving the request from LMF.
...
Figure 7.8.2-1 shows the general positioning procedure for Pre-configured PRS
processing window.
Figure 7.8.2-1: Pre-configured PRS processing window configuration procedure
0\. LMF obtains the TRP information required for positioning services from the
gNBs.
1\. The LMF provides the PRS information of the neighbour TRPs to the serving
gNB and requests the serving gNBs to pre-configure PRS processing window
configuration(s) via NRPPa MEASUREMENT PRECONFIGURATION REQUIRED message.
2\. Based on the assistance information from the LMF and the UE capability,
the serving gNB provides pre-configured PRS processing window configuration(s)
with associated ID(s) to the UE by sending RRC Reconfiguration message
specified in TS 38.331 [14].
3\. The UE sends RRC Reconfiguration complete message to the gNB to confirm
the reception of pre-configured PRS processing window configuration(s).
4\. The gNB sends the confirmation message to the LMF to indicate the success
of the pre-configuration via NRPPa MEASUREMENT PRECONFIGURATION CONFIRM
message.
5\. The LMF sends the NRPPa MEASUREMENT ACTIVATION message to request the gNB
to (de)activate the preconfigured PRS processing window.
6\. Based on the request from the LMF in step 5, the gNB sends DL MAC CE PPW
Activation/Deactivation Command containing an ID to activate/deactivate the
associated PRS processing window.
[TS 38.321, clause 5.18.21]
If the UE is configured with pre-configured PPW, the network may send DL MAC
CE for PPW Activation/Deactivation Command to the UE as in clause 6.1.3.42.
For the activated PPW, the UE shall follow the specified UE behaviour in
clause 5.24.
Upon activation of DL BWP, the PPW(s) configured for that BWP are considered
deactivated. Upon reconfiguration of PPW(s) of the active DL BWP, all the
PPW(s) for that BWP are considered deactivated.
Upon the reception of the MAC CE for PPW Activation/Deactivation Command, the
MAC entity shall:
1> if the DL MAC CE for PPW Activation/Deactivation Command indicates the
deactivation of a pre-configured PPW:
2> deactivate the PPW.
1> else if the DL MAC CE for PPW Activation/Deactivation Command indicates the
activation of a pre-configured PPW:
2> activate the PPW according to the procedure specified in clause 5.24.
[TS 38.321, clause 6.1.3.42]
The PPW Activation/Deactivation Command MAC CE is identified by MAC subheader
with eLCID as specified in Table 6.2.1-1b.
It has variable size defined as follows (Figure 6.1.3.42-1):
\- numEntry: This field indicates the number of entries N-1 in the MAC CE. 00
indicates that N equals to 2; 01 indicates that N equals to 3 and so on. The
length of the field is 2 bits;
\- Serving Cell ID: This field indicates the identity of the Serving Cell for
which the MAC CE applies. The length of the field is 5 bits;
\- PPW ID: This field indicates the index of the PPW configured on active DL
BWP of the Serving Cell identified by the above Serving Cell ID. Index 0
corresponds to the first entry within the list of the PPW configuration by the
increasing order of _PPW-ID_ in TS 38.331 [5] in this BWP, index 1 corresponds
to the second entry in the list and so on. The length of the field is 2 bits;
\- A/D: This field indicates the activation or deactivation of the PPW. The
field is set to 1 to indicate activation, otherwise it indicates deactivation.
The length of the field is 1 bit;
\- R: Reserved bit, set to 0.
Figure 6.1.3.42-1: PPW Activation/Deactivation Command MAC CE
[TS 38.321, clause 5.24]
When PPW is activated and PRS has higher priority than DL channel and signals,
for the affected symbols within the PPW according to clause 5.1.6.5 in TS
38.214 [7], the MAC entity shall:
1> if the _ra-ResponseWindow_ or the _ra-ContentionResolutionTimer_ or the
_msgB-ResponseWindow_ is running:
2> monitor the PDCCH as specified in clauses 5.1.4 and 5.1.5.
1> else:
2> not receive DL-SCH;
2> not receive PDCCH.
[TS 38.214, clause 5.1.6.5]
The UE is expected to measure the DL PRS outside the measurement gap, subject
to UE capability, if the DL PRS is inside the active DL BWP and has the same
numerology as the active DL BWP and is within the DL PRS processing window
indicated by higher layer parameter _DL-PPW-PreConfig_. The UE is not expected
to measure the DL PRS outside the measurement gap if the expected received
timing difference between the DL PRS from the non-serving cell and that from
the serving cell, determined by the higher layer parameters _nr-DL-PRS-
ExpectedRSTD_ and _nr-DL-PRS-ExpectedRSTD-Uncertainty,_ is larger than maximum
Rx timing difference provided by UE capability _._ For receiving the DL PRS
outside the measurement gap and within the DL PRS processing window, the UE
determines the DL PRS priority as indicated by higher layer parameter
_priority_ subject to UE capability or as implied by UE capability:
\- with value _\'st1\'_ where the DL PRS is higher priority than all the DL
signal/channels except SSB, or
\- with value _\'st2\'_ where the DL PRS is lower priority than PDCCH and the
PDSCH scheduled by DCI formats 1_1 or 1_2 with the priority indicator field in
the corresponding DCI format set to 1, and is higher priority than other DL
signals/channels except SSB, or
\- with value _\'st3\'_ where the DL PRS is lower priority than all the DL
signals/channels except SSB.
Inside one _DL-PPW-PreConfig_ the UE is only expected to measure a single DL
PRS positioning frequency layer.
When the UE is expected to measure the DL PRS outside the measurement gap in a
configured PRS processing window with _type1A_ and if the DL PRS is determined
to be higher priority than the DL signals and channels inside the PRS
processing window, those DL signals and channels are not expected to be
measured by the UE. When the UE is expected to measure the DL PRS outside the
measurement gap in a configured PRS processing window with _type1B_ and if the
DL PRS is determined to be higher priority than the DL signals and channels
inside the PRS processing window, those DL signals and channels in the same
band as the DL PRS are not expected to be measured by the UE. When the UE is
expected to measure the DL PRS outside the measurement gap in a configured PRS
processing window with _type2_ if the DL PRS is determined to be higher
priority than the DL signals and channels inside the PRS processing window,
those DL signals and channels from the impacted serving cells are not expected
to be measured by the UE on the overlapped symbols with the DL PRS, where
impacted serving cells refer to the serving cell on which the _DL-PPW-
PreConfig_ is configured for a frequency range 1 band, and all the serving
cells in the same band as the DL PRS for a frequency range 2 band.
...
For a UE configured with PRS Processing Window(s), when the UE receives an
activation/deactivation command, as described in clause 6.1.3.42 of [10, TS
38.321], for a PRS processing window activation, and when the UE would
transmit a PUCCH with HARQ-ACK information in slot n corresponding to the
PDSCH carrying the command, the corresponding actions in [10, TS 38.321] and
the UE assumptions shall be applied starting from the first slot that is after
slot where _μ_ is the SCS configuration for the PUCCH. The UE is not expected
to be indicated with more than 4 activated PRS processing windows by higher
layer parameter _DL-PPW-PreConfig_ across all active DL BWPs and is not
expected to be indicated with the activated PRS processing windows _DL-PPW-
PreConfig_ that overlap in time.
[TS 38.133, clause 9.9.1.2]
The requirements for RSTD, PRS-RSRP, UE Rx-Tx time difference, and PRS-RSRPP
measurement without measurement gaps specified in clauses 9.9.2.7, 9.9.3.6,
9.9.4.6 and 9.9.6.6 shall apply provided that:
UE is configured with PPW,
No active BWP switching occurs during PPW,
PRS is within PPW and does not overlap with other signals/channels of higher
priority,
\- for PPW type 1A/1B, the PPW does not overlap with any symbol for SSB-based
RLM/BFD/CBD/L1-RSRP/L1-SINR measurement on any CC or for SSB based RRM
measurement on any MOs that are measured outside measurement gaps,
\- for PPW type 2, PRS does not overlap with any symbol for SSB-based
RLM/BFD/CBD/L1-RSRP/L1-SINR measurement on any CC or for SSB based RRM
measurement on any MOs that are measured outside measurement gaps,
max∣ΔT∣≤ THR, where
∆T is the time difference between the start of a slot containing PRS from the
neighbour cell/TRP and the start of the closest slot from the serving cell;
the range of ∆T is determined by the expected RSTD and expected RSTD
uncertainty in the assistance data;
THR is the threshold as reported in UE capability _prs-
MeasurementWithoutMG-r17_.
SCS of PRS within PPW and SCS of DL active BWP are the same.
#### 9.4.5.3 Test description
##### 9.4.5.3.1 Pre-test conditions
System Simulator:
\- Sub-test 26: NR Cell 1 as specified in 8.2.9
\- Sub-test 27: NR Cell 1 and NR Cell 2 as specified in 8.2.10.
\- Sub-test 28: NR Cell 1, NR Cell 2 and NR Cell 3 as specified in 8.2.11.
##### UE: {#ue-44 .H6}
  * The UE shall begin the test with no assistance data stored.
##### Preamble: {#preamble-29 .H6}
\- The UE is in state 3N-A as defined in TS 38.508-1 [30], subclause 4.4A on
NR Cell 1.
\- Then the SS sends the RESET UE POSITIONING STORED INFORMATION message to
the UE to clear the stored assistance data in the UE.
##### Related PICS/PIXIT Statements: {#related-picspixit-statements-60 .H6}
-
##### 9.4.5.3.2 Test procedure sequence
This test case includes sub-test cases dependent on the positioning method(s)
supported by the UE. Each sub-test case is identified by a sub-test case
number as defined in Table 9.4.5.3.2-1 below:
Table 9.4.5.3.2-1: Sub-test case numbers
**Sub-Test Case Number** **Supported Positioning Methods**
* * *
26 UE supporting Multi-RTT (Rel-17 onwards) 27 UE supporting DL-AoD (Rel-17
onwards) 28 UE supporting DL-TDOA (Rel-17 onwards)
Table 9.4.5.3.2-2: Test Configuration
**Test Configuration** **Network Deployment Type** **Test Implementation**
* * *
B NG-RAN NR
Table 9.4.5.3.2-3: Main behaviour
+----+--------------+--------------+--------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +====+==============+==============+==============+=========+====+ | | | U - S | Message | | | +----+--------------+--------------+--------------+---------+----+ | 1 | The SS sends | \ | _ULInformat | - | - | | | an LPP | | ionTransfer_ | | | | | message of | | | | | | | type Provide | | (LPP PROVIDE | | | | | Capabilities | | C | | | | | including | | APABILITIES) | | | | | the UE | | | | | | | positioning | | | | | | | c | | | | | | | apabilities. | | | | | +----+--------------+--------------+--------------+---------+----+ | 3 | IF | \ | RR | 1 | P | | | the UE send | | CReconfigura | | | | | an | | tionComplete | | | | | RR | | | | | | | CReconfigura | | | | | | | tionComplete | | | | | | | message to | | | | | | | confirm the | | | | | | | reception of | | | | | | | pr | | | | | | | e-configured | | | | | | | PRS | | | | | | | processing | | | | | | | window | | | | | | | co | | | | | | | nfiguration? | | | | | +----+--------------+--------------+--------------+---------+----+ | 7 | The SS sends | \ | _ULInformat | 2 | P | | | the UE send | | ionTransfer_ | | | | | an LPP | | | | | | | message of | | (LPP PROVIDE | | | | | type Provide | | LOCATION | | | | | Location | | INFORMATION) | | | | | Information | | | | | | | including | | | | | | | location | | | | | | | estimate or | | | | | | | location | | | | | | | m | | | | | | | easurements? | | | | | +----+--------------+--------------+--------------+---------+----+ | 10 | IF | \ **Precondition:** The serving gNB of a UE has received a NRPPa message from
> an LMF requesting the TxTEG of the UE for NR UL-TDOA positioning.
1\. The serving gNB may send a RRC Reconfiguration message to the UE,
requesting the UE to provide the association information of UL SRS resources
for positioning with Tx TEGs to the serving gNB if the UE supports UE Tx TEG
reporting. Based on the request from the LMF, the RRC Reconfiguration message
from the serving gNB to the UE indicates the UE should provide either a single
report or a periodic report of UE TxTEG association to the serving gNB.
2\. When the UE receives the request via RRC Reconfiguration message, the UE
sends a UE Positioning Assistance Info message to the serving gNB to report
the UE TxTEG information, including all the changes of the UE TxTEG during the
report period if the UE is required to report UE Tx TEG periodically. The UE
will report all the UE TxTEG at the time when the RRC Reconfiguration message
is received if the UE is only required to report the one-shot UE TxTEG
information.
[TS 38.331, clause 5.7.14]
Figure 5.7.14.1-1: UE Positioning Assistance Information procedure
The UE Positioning Assistance Information procedure is used by UE to report
the UE Positioning Assistance Information. The UE reports the association
between UL-SRS resources for positioning and the UE Tx TEG ID as defined in TS
38.305 [73].
[TS 38.331, clause 5.7.14.2]
A UE capable of providing the association between UL SRS Resource for
positioning and UE Tx TEG ID in RRC_CONNECTED may initiate the procedure upon
being configured to provide this association information.
Upon initiation of the procedure, the UE shall:
1> initiate transmission of the _UEPositioningAssistanceInfo_ message in
accordance with 5.7.14.3 to provide the association.
[TS 38.331, clause 5.7.14.3]
The UE shall set the contents of the _UEPositioningAssistanceInfo_ message as
follows:
1> if _ue-TxTEG-RequestUL-TDOA-Config_ in _RRCReconfiguration_ message is
configured with _periodicReporting_ :
> 2> for all the association changes store _ue-TxTEG-Association corresponding
> to each ue-TxTEG-ID with nr-TimeStamp_ ;
2> include the results in _ue-TxTEG-AssociationList_ in the
_UEPositioningAssistanceInfo_ message on expiry of each configured period;
2> optionally include one _ue-TxTEG-TimingErrorMarginValue_ for each
_UEPositioningAssistanceInfo_ message;
1> else if _ue-TxTEG-RequestUL-TDOA-Config_ in _RRCReconfiguration_ message is
configured with _oneShot_ :
2> identify the _ue-TxTEG-Association corresponding to each ue-TxTEG-ID with
nr-TimeStamp_ ;
2> include the results in _ue-TxTEG-AssociationList_ in the
_UEPositioningAssistanceInfo_ message only one time;
2> optionally include one _ue-TxTEG-TimingErrorMarginValue_ for each
_UEPositioningAssistanceInfo_ message.
The UE shall submit the _UEPositioningAssistanceInfo_ message to lower layers
for transmission.
#### 9.4.6.3 Test description
##### 9.4.6.3.1 Pre-test conditions
System Simulator:
\- Sub-test 29: NR Cell 1
##### UE: {#ue-45 .H6}
> -
##### Preamble: {#preamble-30 .H6}
\- The UE is in state 3N-A as defined in TS 38.508-1 [30], subclause 4.4A on
NR Cell 1.
##### Related PICS/PIXIT Statements: {#related-picspixit-statements-61 .H6}
-
##### 9.4.6.3.2 Test procedure sequence
Table 9.4.6.3.2-1: Test Configuration
**Test Configuration** **Network Deployment Type** **Test Implementation**
* * *
B NG-RAN NR
Table 9.4.6.3.2-2: Main behaviour
+----+--------------+--------------+--------------+---------+----+ | St | Procedure | Message | TP | Verdict | | | | | Sequence | | | | +====+==============+==============+==============+=========+====+ | | | U - S | Message | | | +----+--------------+--------------+--------------+---------+----+ | 1 | The SS sends | \ | _ULInformat | - | - | | | a LPP | | ionTransfer_ | | | | | message of | | | | | | | type Provide | | (LPP PROVIDE | | | | | Capabilities | | C | | | | | including | | APABILITIES) | | | | | the UE | | | | | | | positioning | | | | | | | c | | | | | | | apabilities. | | | | | +----+--------------+--------------+--------------+---------+----+ | 3 | IF | \ | UEP | 1 | P | | | the UE send | | ositioningAs | | | | | a | | sistanceInfo | | | | | UEP | | | | | | | ositioningAs | | | | | | | sistanceInfo | | | | | | | message | | | | | | | including | | | | | | | TxTEG | | | | | | | information? | | | | | +----+--------------+--------------+--------------+---------+----+
##### 9.4.6.3.3 Specific message contents
_Table_ 9.4.6.3.3-1 _:_ DLInformationTransfer (step 1 and step 3, Table
9.4.6.3.2-2)
Derivation Path: 38.331 clause 6.2.2
* * *
Information Element Value/remark Comment Condition DLInformationTransfer ::=
SEQUENCE {  
rrc-TransactionIdentifier  
criticalExtensions CHOICE {  
dlInformationTransfer SEQUENCE {  
dedicatedNAS-Message OCTET STRING Set according to Table 9.4.6.3.3-2 DL NAS
TRANSPORT  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}
Table 9.4.6.3.3-2: DL NAS TRANSPORT (DLInformationTransfer, Table 9.4.6.3.3-1)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 24.501 | | | | | Table | | | | | 8.2.11.1.1 | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Extended | 01111110 | 5GS mobility | | | Protocol | | management | | | discriminator | | messages | | +-----------------+-----------------+-----------------+-----------+ | Security header | 0000 | Plain 5GS NAS | | | type | | message | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | Downlink | | | octet | | generic NAS | | | | | transport | | +-----------------+-----------------+-----------------+-----------+ | DL NAS | 01101000 | DL NAS | | | TRANSPORT | | transport | | | message | | | | | identity | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | 0011 | LTE Positioning | | | container type | | Protocol (LPP) | | | | | message | | | | | container | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | | | | octet | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | **Step 1:** | LPP Request | | | container | | Capabilities. | | | | Set according | | | | | to Table | | | | | _8.4-2_ | | | +-----------------+-----------------+-----------------+-----------+ | | **Step 3** | LPP | | | | | Acknowledgement | | | | Set according | | | | | to Table | | | | | 9.4.6.3.3-3 | | | +-----------------+-----------------+-----------------+-----------+ | Additional | Present | Routing | | | information | | Identif | | | | | ier/Correlation | | | | | ID | | +-----------------+-----------------+-----------------+-----------+
Table 9.4.6.3.3-3: LPP Acknowledgement (DL NAS TRANSPORT, Table 9.4.6.3.3-2)
Derivation Path: 37.355 clause 6.2
* * *
Information Element Value/remark Comment Condition LPP-Message ::= SEQUENCE {  
transactionID Not present  
endTransaction TRUE  
sequenceNumber Not present  
acknowledgement SEQUENCE {  
ackRequested FALSE  
ackIndicator (0..255) Contains the same value of the sequenceNumber field in
step 1, Table 9.4.6.3.2-2  
}  
lpp-MessageBody Not present.  
}
Table 9.4.6.3.3-4: RRCReconfiguration (Step 4, Table 9.4.6.3.2-2)
* * *
Derivation Path: TS 38.508-1 [30], table 4.6.1-13  
Information Element Value/remark Comment Condition RRCReconfiguration ::=
SEQUENCE {  
rrc-TransactionIdentifier RRC-TransactionIdentifier  
criticalExtensions CHOICE {  
rrcReconfiguration SEQUENCE {  
nonCriticalExtension SEQUENCE {  
nonCriticalExtension SEQUENCE {  
nonCriticalExtension SEQUENCE {  
nonCriticalExtension SEQUENCE {  
nonCriticalExtension SEQUENCE {  
ue-TxTEG-RequestUL-TDOA-Config-r17 CHOICE SEQUENCE {  
setup SEQUENCE {  
UE-TxTEG-RequestUL-TDOA-Config-r17 CHOICE {  
oneShot-r17  
}  
}  
}  
}  
}  
}  
}  
}  
}  
}  
}
* * *
Table 9.4.6.3.3-5: ULInformationTransfer (step 2, Table 9.4.6.3.2-2)
Derivation Path: 38.331 clause 6.2.2
* * *
Information Element Value/remark Comment Condition ULInformationTransfer ::=
SEQUENCE {  
criticalExtensions CHOICE {  
ulInformationTransfer SEQUENCE {  
dedicatedNAS-Message OCTET STRING Set according to Table 9.4.6.3.3-6 UL NAS
TRANSPORT  
nonCriticalExtension SEQUENCE {} Not present  
}  
}  
}
Table 9.4.6.3.3-6: UL NAS TRANSPORT (ULInformationTransfer, Table 9.4.6.3.3-5)
+-----------------+-----------------+-----------------+-----------+ | Derivation | | | | | Path: 24.501 | | | | | Table | | | | | 8.2.10.1.1 | | | | +=================+=================+=================+===========+ | Information | Value/remark | Comment | Condition | | Element | | | | +-----------------+-----------------+-----------------+-----------+ | Extended | 01111110 | 5GS mobility | | | Protocol | | management | | | discriminator | | messages | | +-----------------+-----------------+-----------------+-----------+ | Security header | 0000 | Plain 5GS NAS | | | type | | message | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | | | | octet | | | | +-----------------+-----------------+-----------------+-----------+ | UL NAS | 01100111 | UL NAS | | | TRANSPORT | | TRANSPORT | | | message | | | | | identity | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | 0011 | LTE Positioning | | | container type | | Protocol (LPP) | | | | | message | | | | | container | | +-----------------+-----------------+-----------------+-----------+ | Spare half | 0000 | | | | octet | | | | +-----------------+-----------------+-----------------+-----------+ | Payload | **Step 2:** | LPP Provide | | | container | | Capabilities | | | | Set according | | | | | to Table | | | | | | | | | | 9.4.6.3.3-7 | | | +-----------------+-----------------+-----------------+-----------+ | Additional | Present | The UE includes | | | information | | the Routing | | | | | Identifier | | | | | received in the | | | | | Additional | | | | | Information IE | | | | | of the DOWNLINK | | | | | GENERIC NAS | | | | | TRANSPORT | | | | | message (step 1 | | | | | Table | | | | | 9.4.6.3.3-2) | | +-----------------+-----------------+-----------------+-----------+
Table 9.4.6.3.3-7: LPP Provide Capabilities (UL NAS TRANSPORT, Table
9.4.6.3.3-6)
Derivation Path: 37.355 clause 6.2
* * *
Information Element Value/remark Comment Condition LPP-Message ::= SEQUENCE {  
transactionID SEQUENCE {  
initiator locationServer  
transactionNumber (0..255) Contains the same value as the corresponding field
in the LPP Request Capabilities message in step 1, Table 9.4.6.3.2-2  
}  
endTransaction TRUE  
sequenceNumber (0..255)  
acknowledgement SEQUENCE { Present, or not present  
ackRequested TRUE  
ackIndicator Not present  
}  
lpp-MessageBody CHOICE {  
c1 CHOICE {  
provideCapabilities SEQUENCE {  
criticalExtensions CHOICE {  
c1 CHOICE {  
provideCapabilities-r9 SEQUENCE {  
nr-UL-ProvideCapabilities-r16 Dependent on UE capabilities  
}  
}  
}  
}  
}  
}  
}  
}  
}  
}  
}
Table 9.4.6.3.3-8: UEPositioningAssistanceInfo (step 5, Table 9.4.6.3.2-2)
Derivation Path: 38.331 clause 6.2.2
* * *
Information Element Value/remark Comment Condition
UEPositioningAssistanceInfo-r17 ::= SEQUENCE {  
criticalExtensions CHOICE {  
uePositioningAssistanceInfo-r17 SEQUENCE {  
ue-TxTEG-AssociationList-r17 SEQUENCE (SIZE (1..maxNrOfTxTEGReport-r17)) OF
UE-TxTEG-Association-r17 { n entries The size of UE-TxTEG-Association-r17 is
depending on UE capabilities.  
UE-TxTEG-Association-r17[n] SEQUENCE {  
ue-TxTEG-ID-r17 Present. Depending on UE capabilities.  
nr-TimeStamp-r17 SEQUENCE {  
nr-SFN-r17 (0..1023)  
nr-Slot-r17 Present. Any value acceptable  
}  
associatedSRS-PosResourceIdList-r17 Present. Any value acceptable  
servCellId-r17 Not checked  
}  
}  
lateNonCriticalExtension { } Not present  
nonCriticalExtension SEQUENCE {  
ue-TxTEG-TimingErrorMarginValue-r17 Not checked  
nonCriticalExtension Not checked  
}  
}  
}  
}
#
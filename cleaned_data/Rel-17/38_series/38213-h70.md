# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies and establishes the characteristics of the
physical layer procedures for control operations in 5G-NR.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\"
[2] 3GPP TS 38.201: \"NR; Physical Layer -- General Description\"
[3] 3GPP TS 38.202: \"NR; Services provided by the physical layer\"
[4] 3GPP TS 38.211: \"NR; Physical channels and modulation\"
[5] 3GPP TS 38.212: \"NR; Multiplexing and channel coding\"
[6] 3GPP TS 38.214: \"NR; Physical layer procedures for data\"
[7] 3GPP TS 38.215: \"NR; Physical layer measurements\"
[8-1] 3GPP TS 38.101-1: \"NR; User Equipment (UE) radio transmission and
reception; Part 1: Range 1 Standalone\"
[8-2] 3GPP TS 38.101-2: \"NR; User Equipment (UE) radio transmission and
reception; Part 2: Range 2 Standalone\"
[8-3] 3GPP TS 38.101-3: \"NR; User Equipment (UE) radio transmission and
reception; Part 3: Range 1 and Range 2 Interworking operation with other
radios\"
[8-4] 3GPP TS 38.101-4: \"NR; User Equipment (UE) radio transmission and
reception; Part 4: Performance requirements\"
[9] 3GPP TS 38.104: \"NR; Base Station (BS) radio transmission and reception\"
[10] 3GPP TS 38.133: \"NR; Requirements for support of radio resource
management\"
[11] 3GPP TS 38.321: \"NR; Medium Access Control (MAC) protocol
specification\"
[12] 3GPP TS 38.331: \"NR; Radio Resource Control (RRC); Protocol
specification\"
[13] 3GPP TS 36.213: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Physical layer procedures\"
[14] 3GPP TS 36.321: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Medium Access Control (MAC) protocol specification\"
[15] 3GPP TS 37.213: \"Physical layer procedures for shared spectrum channel
access\"
[16] 3GPP TS 38.473: \"F1 application protocol (F1AP)\"
[17] 3GPP TS 38.304: \"NR; User Equipment (UE) procedures in Idle mode and RRC
Inactive state\"
[18] 3GPP TS 38.306: \"NR; User Equipment (UE) radio access capabilities\"
[19] 3GPP TS 38.300: \"NR; NR and NG-RAN Overall Description\"
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
[1, TR 21.905] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in [1, TR
21.905]. A parameter referenced in _italics_ is provided by higher layers.
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in [1,
TR 21.905].
BPRE Bits per resource element
BWP Bandwidth part
CB Code block
CBG Code block group
CBR Channel busy ratio
CCE Control channel element
CORESET Control resource set
CP Cyclic prefix
CRC Cyclic redundancy check
C-RNTI Cell RNTI
CS-RNTI Configured scheduling RNTI
CSI Channel state information
CSS Common search space
DAI Downlink assignment index
DAPS Dual active protocol stack
DC Dual connectivity
DCI Downlink control information
DL Downlink
DL-SCH Downlink shared channel
EPRE Energy per resource element
EN-DC E-UTRA NR dual connectivity with MCG using E-UTRA and SCG using NR
FR1 Frequency range 1
FR2 Frequency range 2
G-CS-RNTI Group configured scheduling RNTI
G-RNTI Group RNTI
GSCN Global synchronization channel number
HARQ-ACK Hybrid automatic repeat request acknowledgement
MBS Multicast broadcast services
MCG Master cell group
MCS Modulation and coding scheme
NDI New Data Indicator
NE-DC E-UTRA NR dual connectivity with MCG using NR and SCG using E-UTRA
NR-DC NR NR dual connectivity
PBCH Physical broadcast channel
PCell Primary cell
PDCCH Physical downlink control channel
PDSCH Physical downlink shared channel
PO Paging occasion
PRACH Physical random access channel
PRB Physical resource block
PRG Physical resource block group
PSCell Primary secondary cell
PSBCH Physical sidelink broadcast channel
PSCCH Physical sidelink control channel
PSFCH Physical sidelink feedback channel
PSS Primary synchronization signal
PSSCH Physical sidelink shared channel
PUCCH Physical uplink control channel
PUCCH-SCell PUCCH SCell
PUCCH-sSCell PUCCH switching SCell
PUSCH Physical uplink shared channel
QCL Quasi co-location
RB Resource block
RE Resource element
RLM Radio link monitoring
RRM Radio resource management
RS Reference signal
RSRP Reference signal received power
SCG Secondary cell group
SCI Sidelink control information
SCS Subcarrier spacing
SFCI Sidelink feedback control information
SFN System frame number
SL Sidelink
SLIV Start and length indicator value
SPS Semi-persistent scheduling
SR Scheduling request
SRI SRS resource indicator
SRS Sounding reference signal
SSS Secondary synchronization signal
SSSG Search space set group
TA Timing advance
TAG Timing advance group
TB Transport block
TBG Transport block group
TCI Transmission Configuration Indicator
UCI Uplink control information
UE User equipment
UL Uplink
UL-SCH Uplink shared channel
USS UE-specific search space
# 4 Synchronization procedures
## 4.1 Cell search
Cell search is the procedure for a UE to acquire time and frequency
synchronization with a cell and to detect the physical layer Cell ID of the
cell.
A UE receives the following synchronization signals (SS) in order to perform
cell search: the primary synchronization signal (PSS) and secondary
synchronization signal (SSS) as defined in [4, TS 38.211].
A UE assumes that reception occasions of a physical broadcast channel (PBCH),
PSS, and SSS are in consecutive symbols, as defined in [4, TS 38.211], and
form a SS/PBCH block. The UE assumes that SSS, PBCH DM-RS, and PBCH data have
same EPRE. The UE may assume that the ratio of PSS EPRE to SSS EPRE in a
SS/PBCH block is either 0 dB or 3 dB. If the UE has not been provided
dedicated higher layer parameters, the UE may assume that the ratio of PDCCH
DMRS EPRE to SSS EPRE is within -8 dB and 8 dB when the UE monitors PDCCHs for
a DCI format 1_0 with CRC scrambled by SI-RNTI, P-RNTI, or RA-RNTI, or for a
DCI format 2_7, or for a DCI format 4_0.
For a half frame with SS/PBCH blocks, the first symbol indexes for candidate
SS/PBCH blocks are determined according to the SCS of SS/PBCH blocks as
follows, where index 0 corresponds to the first symbol of the first slot in a
half-frame.
\- Case A - 15 kHz SCS: the first symbols of the candidate SS/PBCH blocks have
indexes of $\left{ 2,8 \right} + 14 \cdot n$.
\- For operation without shared spectrum channel access:
\- For carrier frequencies smaller than or equal to 3 GHz, $n = 0,1$.
\- For carrier frequencies within FR1 larger than 3 GHz, $n = 0,1,2,3$.
\- For operation with shared spectrum channel access, as described in [15, TS
37.213], $n = 0,\ 1,\ 2,\ 3,\ 4$_._
\- Case B - 30 kHz SCS: the first symbols of the candidate SS/PBCH blocks have
indexes $\left{ 4,8,16,20 \right} + 28 \cdot n$. For carrier frequencies
smaller than or equal to 3 GHz, $n = 0$. For carrier frequencies within FR1
larger than 3 GHz, $n = 0,1$.
\- Case C - 30 kHz SCS: the first symbols of the candidate SS/PBCH blocks have
indexes $\left{ 2,8 \right} + 14 \cdot n$.
\- For operation without shared spectrum channel access
\- For paired spectrum operation
\- For carrier frequencies smaller than or equal to 3 GHz, $n = 0,1$. For
carrier frequencies within FR1 larger than 3 GHz, $n = 0,1,2,3$.
\- For unpaired spectrum operation
\- For carrier frequencies smaller than 1.88 GHz, $n = 0,1$. For carrier
frequencies within FR1 equal to or larger than 1.88 GHz, $n = 0,1,2,3$.
\- For operation with shared spectrum channel access, $n = 0,\ 1,\ 2,\ 3,\ 4,\
5,\ 6,\ 7,\ 8,\ 9$_._
\- Case D - 120 kHz SCS: the first symbols of the candidate SS/PBCH blocks
have indexes $\left{ 4,8,16,20 \right} + 28 \cdot n$. For carrier frequencies
within FR2, $n = 0,\ 1,\ 2,\ 3,\ 5,\ 6,\ 7,\ 8,\ 10,\ 11,\ 12,\ 13,\ 15,\ 16,\
17,\ 18$.
\- Case E - 240 kHz SCS: the first symbols of the candidate SS/PBCH blocks
have indexes $\left{ 8,12,16,20,32,36,40,44 \right} + 56 \cdot n$. For carrier
frequencies within FR2-1, $n = 0,\ 1,\ 2,\ 3,\ 5,\ 6,\ 7,\ 8$.
\- Case F -- 480 kHz SCS: the first symbols of the candidate SS/PBCH blocks
have indexes $\left{ 2,\ 9 \right} + 14 \cdot n$. For carrier frequencies
within FR2-2, $n = 0,\ 1,\ 2,\ 3,\ 4,\ 5,\ 6,\ 7,\ 8,\ 9,\ 10,\ 11,\ 12,\ 13,\
14,\ 15,\ 16,\ 17,\ 18,\ 19,\ 20,\ 21,\ 22,\ 23,\ 24,\ 25,\ 26,\ 27,\ 28,\
29,\ 30,\ 31.$
\- Case G -- 960 kHz SCS: the first symbols of the candidate SS/PBCH blocks
have indexes $\left{ 2,\ 9 \right} + 14 \cdot n$. For carrier frequencies
within FR2-2, $n = 0,\ 1,\ 2,\ 3,\ 4,\ 5,\ 6,\ 7,\ 8,\ 9,\ 10,\ 11,\ 12,\ 13,\
14,\ 15,\ 16,\ 17,\ 18,\ 19,\ 20,\ 21,\ 22,\ 23,\ 24,\ 25,\ 26,\ 27,\ 28,\
29,\ 30,\ 31.$
From the above cases, if the SCS of SS/PBCH blocks is not provided by
_ssbSubcarrierSpacing_ , the applicable cases for a cell depend on a
respective frequency band, as provided in [8-1, TS 38.101-1] and [8-2, TS
38.101-2]. A same case applies for all SS/PBCH blocks on the cell. If a 30 kHz
SS/PBCH block SCS is indicated by _ssbSubcarrierSpacing_ , Case B applies for
frequency bands with only 15 kHz SS/PBCH block SCS as specified in [8-1, TS
38.101-1], and the case specified for 30 kHz SS/PBCH block SCS in [8-1, TS
38.101-1] applies for frequency bands with 30 kHz SS/PBCH block SCS or both 15
kHz and 30 kHz SS/PBCH block SCS as specified in [8-1, TS 38.101-1]. For a UE
configured to operate with carrier aggregation over a set of cells in a
frequency band of FR2 or with frequency-contiguous carrier aggregation over a
set of cells in a frequency band of FR1, if the UE is provided SCS values by
_ssbSubcarrierSpacing_ for receptions of SS/PBCH blocks on any cells from the
set of cells, the UE expects the SCS values to be same.
The candidate SS/PBCH blocks in a half frame are indexed in an ascending order
in time from 0 to ${\overline{L}}_{\max} - 1$_, where_ ${\overline{L}}_{\max}$
is determined according to SS/PBCH block patterns for Cases A through G.
$L_{\max}$ is a maximum number of SS/PBCH block indexes in a cell, and the
maximum number of transmitted SS/PBCH blocks within a half frame is
$L_{\max}$.
_\- For_ operation without shared spectrum channel access in FR1 and FR2, and
for operation with shared spectrum channel access in FR2-2, $L_{\max} =
{\overline{L}}_{\max}$
\- For operation with shared spectrum channel access in FR1, $L_{\max} = 8$
for ${\overline{L}}_{\max} = 10$ and 15 kHz SCS of SS/PBCH blocks and for
${\overline{L}}_{\max} = 20$ and 30 kHz SCS of SS/PBCH blocks
For ${\overline{L}}_{\max} = 4$, a UE determines the 2 LSB bits of a candidate
SS/PBCH block index per half frame from a one-to-one mapping with an index of
the DM-RS sequence transmitted in the PBCH as described in [4, TS 38.211].
For ${\overline{L}}_{\max} > 4$, a UE determines the 3 LSB bits of a candidate
SS/PBCH block index per half frame from a one-to-one mapping with an index of
the DM-RS sequence transmitted in the PBCH as described in [4, TS 38.211]
\- for ${\overline{L}}_{\max} = 10$, the UE determines the 1 MSB bit of the
candidate SS/PBCH block index from PBCH payload bit ${\bar{a}}_{\bar{A} + 7}$
as described in [5, TS 38.212]
\- for ${\overline{L}}_{\max} = 20$, the UE determines the 2 MSB bits of the
candidate SS/PBCH block index from PBCH payload bits ${\bar{a}}_{\bar{A} +
6},{\bar{a}}_{\bar{A} + 7}$ as described in [5, TS 38.212]
\- for ${\overline{L}}_{\max} = 64$, the UE determines the 3 MSB bits of the
candidate SS/PBCH block index from PBCH payload bits ${\bar{a}}_{\bar{A} +
5},{\bar{a}}_{\bar{A} + 6},{\bar{a}}_{\bar{A} + 7}$ as described in [5, TS
38.212]
A UE can be provided per serving cell by _ssb-periodicityServingCell_ a
periodicity of the half frames for reception of the SS/PBCH blocks for the
serving cell. If the UE is not configured a periodicity of the half frames for
receptions of the SS/PBCH blocks, the UE assumes a periodicity of a half
frame. A UE assumes that the periodicity is same for all SS/PBCH blocks in the
serving cell.
For initial cell selection, a UE may assume that half frames with SS/PBCH
blocks occur with a periodicity of 2 frames.
For operation without shared spectrum channel access, an SS/PBCH block index
is same as a candidate SS/PBCH block index.
For operation with shared spectrum channel access, a UE assumes that
transmission of SS/PBCH blocks in a half frame is within a discovery burst
transmission window that starts from the first symbol of the first slot in a
half-frame. The UE can be provided per serving cell by
_discoveryBurstWindowLength_ a duration of the discovery burst transmission
window. If _discoveryBurstWindowLength_ is not provided, the UE assumes that
the duration of the discovery burst transmission window is a half frame. For a
serving cell, the UE assumes that a periodicity of the discovery burst
transmission window is same as a periodicity of half frames for receptions of
SS/PBCH blocks in the serving cell. The UE assumes that one or more SS/PBCH
blocks indicated by _ssb-PositionsInBurst_ may be transmitted within the
discovery burst transmission window and have candidate SS/PBCH blocks indexes
corresponding to SS/PBCH block indexes provided by _ssb-PositionsInBurst_. If
MSB $k$, $k \geq 1$, of _ssb-PositionsInBurst_ is set to 1, the UE assumes
that SS/PBCH block(s) within the discovery burst transmission window with
candidate SS/PBCH block index(es) corresponding to SS/PBCH block index equal
to $k - 1$ may be transmitted; if MSB $k$ is set to 0, the UE assumes that the
SS/PBCH block(s) are not transmitted. If MSB $k$, $k \geq 1$, of _inOneGroup_
is set to 1, and MSB $m$, $m \geq 1$, of _groupPresence_ is set to 1, the UE
assumes that SS/PBCH block(s) within the discovery burst transmission window
with candidate SS/PBCH block index(es) corresponding to SS/PBCH block index
determined by $k$ and $m$ may be transmitted; otherwise, the UE assumes that
the SS/PBCH block(s) are not transmitted.
For operation with shared spectrum channel access in FR1, a UE assumes that
SS/PBCH blocks in a serving cell that are within a same discovery burst
transmission window or across discovery burst transmission windows are quasi
co-located with respect to average gain, quasi co-location \'typeA\' and
\'typeD\' properties, when applicable [6, TS 38.214], if a value of $\left(
N_{\text{DM} - \text{RS}}^{\text{PBCH}}\text{mod}N_{\text{SSB}}^{\text{QCL}}
\right)$ is same among the SS/PBCH blocks. $N_{\text{DM} -
\text{RS}}^{\text{PBCH}}$ is an index of a DM-RS sequence transmitted in a
PBCH of a corresponding SS/PBCH block, and $N_{\text{SSB}}^{\text{QCL}}$ is
either provided by _ssb-PositionQCL_ or, if _ssb-PositionQCL_ is not provided,
obtained from a _MIB_ provided by a SS/PBCH block according to Table 4.1-1
with $k_{\text{SSB}}  23$ for FR1 or if $k_{\text{SSB}} > 11$ for
FR2; the CORESET for Type0-PDCCH CSS set may be provided by _PDCCH-
ConfigCommon_.
For a serving cell without transmission of SS/PBCH blocks, a UE acquires time
and frequency synchronization with the serving cell based on receptions of
SS/PBCH blocks on the PCell, or on the PSCell, or on an SCell if applicable as
described in [10, TS 38.133], of the cell group for the serving cell.
## 4.2 Transmission timing adjustments
A UE can be provided a value $N_{TA,offset}$ of a timing advance offset for a
serving cell by _n-TimingAdvanceOffset_ for the serving cell. If the UE is not
provided _n-TimingAdvanceOffset_ for a serving cell, the UE determines a
default value $N_{TA,offset}$ of the timing advance offset for the serving
cell as described in [10, TS 38.133].
If a UE is configured with two UL carriers for a serving cell, a same timing
advance offset value $N_{TA,offset}$ applies to both carriers.
Upon reception of a timing advance command for a TAG, the UE adjusts uplink
timing for PUSCH/SRS/PUCCH transmission on all the serving cells in the TAG
based on a value $N_{TA,offset}$ that the UE expects to be same for all the
serving cells in the TAG and based on the received timing advance command
where the uplink timing for PUSCH/SRS/PUCCH transmissions is the same for all
the serving cells in the TAG.
For a band with synchronous contiguous intra-band EN-DC in a band combination
with non-applicable maximum transmit timing difference requirements as
described in Note 1 of Table 7.5.3-1 of [10, TS 38.133], if the UE indicates
_ul-TimingAlignmentEUTRA-NR_ as \'required\' and uplink transmission timing
based on timing adjustment indication for a TAG from MCG and a TAG from SCG
are determined to be different by the UE, the UE adjusts the transmission
timing for PUSCH/SRS/PUCCH transmission on all serving cells part of the band
with the synchronous contiguous intra-band EN-DC based on timing adjustment
indication for a TAG from a serving cell in MCG in the band. The UE is not
expected to transmit a PUSCH/SRS/PUCCH in one CG when the PUSCH/SRS/PUCCH is
overlapping in time, even partially, with random access preamble transmitted
in another CG.
For a SCS of $2^{\mu} \bullet 15$ kHz, the timing advance command for a TAG
indicates the change of the uplink timing relative to the current uplink
timing for the TAG in multiples of $16 \bullet \frac{64 \bullet
T_{c}}{2^{\mu}}$. The start timing of the random access preamble is described
in [4, TS 38.211].
A timing advance command [11, TS 38.321] in case of random access response or
in an absolute timing advance command MAC CE, $T_{A}$, for a TAG indicates
$N_{\text{TA}}$ values by index values of $T_{A}$ = 0, 1, 2, ..., 3846, where
an amount of the time alignment for the TAG with SCS of $2^{\mu} \bullet 15$
kHz is $N_{\text{TA}} = T_{A} \bullet 16 \bullet \frac{64}{2^{\mu}}$.
$N_{\text{TA}}$ is defined in [4, TS 38.211] and is relative to the SCS of the
first uplink transmission from the UE after the reception of the random access
response or absolute timing advance command MAC CE.
In other cases, a timing advance command [11, TS 38.321], $T_{A}$, for a TAG
indicates adjustment of a current $N_{\text{TA}}$ value, $N_{TA_ old}$, to the
new $N_{\text{TA}}$ value, $N_{TA_ new}$, by index values of $T_{A}$ = 0, 1,
2,..., 63, where for a SCS of $2^{\mu} \bullet 15$ kHz, $N_{TA_ new} = N_{TA_
old} + \left( T_{A} - 31 \right) \bullet 16 \bullet \frac{64}{2^{\mu}}$.
If a UE has multiple active UL BWPs, as described in clause 12, in a same TAG,
including UL BWPs in two UL carriers of a serving cell, the timing advance
command value is relative to the largest SCS of the multiple active UL BWPs.
The applicable $N_{TA_ new}$ value for an UL BWP with lower SCS may be rounded
to align with the timing advance granularity for the UL BWP with the lower SCS
while satisfying the timing advance accuracy requirements in [10, TS 38.133].
Adjustment of an $N_{\text{TA}}$ value by a positive or a negative amount
indicates advancing or delaying the uplink transmission timing for the TAG by
a corresponding amount, respectively.
For a timing advance command received on uplink slot $n$ and for a
transmission other than a PUSCH scheduled by a RAR UL grant or a fallbackRAR
UL grant as described in clause 8.2A or 8.3, or a PUCCH with HARQ-ACK
information in response to a successRAR as described in clause 8.2A, the
corresponding adjustment of the uplink transmission timing applies from the
beginning of uplink slot $n + k + 1{+ 2}^{\mu} \bullet K_{\text{offset}}$
where $k = \left\lceil N_{\text{slot}}^{subframe,\ \ \mu} \bullet \frac{\left(
N_{T,1} + N_{T,2} + N_{TA,max} + 0.5 \right)}{T_{\text{sf}}} \right\rceil$,
$N_{T,1}$ is a time duration in msec of $N_{1}$ symbols corresponding to a
PDSCH processing time for UE processing capability 1 when additional PDSCH DM-
RS is configured, $N_{T,2}$ is a time duration in msec of $N_{2}$ symbols
corresponding to a PUSCH preparation time for UE processing capability 1 [6,
TS 38.214], $N_{TA,max}$ is the maximum timing advance value in msec that can
be provided by a TA command field of 12 bits, $N_{\text{slot}}^{subframe,\ \
\mu}$ is the number of slots per subframe, $T_{\text{sf}}$ is the subframe
duration of 1 msec, and $K_{\text{offset}} = K_{cell,offset} - K_{UE,offset}$,
where $K_{cell,offset}$ is provided by _cellSpecificKoffset and_
$K_{UE,offset}$ is provided by a Differential Koffset MAC CE command [11, TS
38.321]; otherwise, _if not respectively provided,_ $K_{cell,offset} = 0$ or
$K_{UE,offset} = 0$. $N_{1}$ and $N_{2}$ are determined with respect to the
minimum SCS among the SCSs of all configured UL BWPs for all uplink carriers
in the TAG and of all configured DL BWPs for the corresponding downlink
carriers. For $\mu = 0$, the UE assumes $N_{1,0} = 14$ [6, TS 38.214]. Slot
$n$ and $N_{\text{slot}}^{subframe,\ \ \mu}$ are determined with respect to
the minimum SCS among the SCSs of all configured UL BWPs for all uplink
carriers in the TAG. $N_{TA,max}$ is determined with respect to the minimum
SCS among the SCSs of all configured UL BWPs for all uplink carriers in the
TAG and for all configured initial UL BWPs provided by _initialUplinkBWP_. The
uplink slot $n$ is the last slot among uplink slot(s) overlapping with the
slot(s) of PDSCH reception assuming $T_{\text{TA}} = 0$, where the PDSCH
provides the timing advance command and $T_{\text{TA}}$ is defined in [4, TS
38.211].
If a UE changes an active UL BWP between a time of a timing advance command
reception and a time of applying a corresponding adjustment for the uplink
transmission timing, the UE determines the timing advance command value based
on the SCS of the new active UL BWP. If the UE changes an active UL BWP after
applying an adjustment for the uplink transmission timing, the UE assumes a
same absolute timing advance command value before and after the active UL BWP
change.
If the received downlink timing changes and is not compensated or is only
partly compensated by the uplink timing adjustment without timing advance
command as described in [10, TS 38.133], the UE changes $N_{\text{TA}}$
accordingly.
If two adjacent slots overlap due to a TA command, the latter slot is reduced
in duration relative to the former slot. The UE does not change
$N_{\text{TA}}$ during an actual transmission time window for a PUSCH or a
PUCCH transmission [6, TS 38.214].
Using higher-layer ephemeris parameters for a serving satellite, if provided,
a UE pre-compensates the two-way transmission delay on the service link based
on $N_{\text{TA,adj}}^{\text{UE}}$ that the UE determines using the serving
satellite position and its own position. To pre-compensate the two-way
transmission delay between the uplink time synchronization reference point and
the serving satellite, the UE determines $N_{\text{TA,adj}}^{\text{common}}\
$[4, TS 38.211] based on one-way propagation delay
$\text{Delay}_{\text{common}}\left( t \right)$ that the UE determines as:
$$\text{Delay}_{\text{common}}\left( t \right) = \
\frac{\text{TA}_{\text{Common}}}{2} + \
\frac{\text{TA}_{\text{CommonDrift}}}{2} \times \left( t - t_{\text{epoch}}
\right) + \frac{\text{TA}_{\text{CommonDriftVariant}}}{2} \times \left( t -
t_{\text{epoch}} \right)^{2}\ $$
where $\text{TA}_{\text{Common}}$, $\text{TA}_{\text{CommonDrift}}$, and
$\text{TA}_{\text{CommonDriftVariant}}$ are respectively provided by _ta-
Common_ , _ta-CommonDrift_ , and _ta-CommonDriftVariant_ and
$t_{\text{epoch}}$ is provided by _epochTime_ which is the epoch time of _ta-
Common_ , _ta-CommonDrift_ , and _ta-CommonDriftVariant_ [12, TS 38.331]_._
$\text{Delay}_{\text{common}}(t)$ provides a distance at time $t$ between the
serving satellite and the uplink time synchronization reference point divided
by the speed of light. The uplink time synchronization reference point is the
point where DL and UL are frame aligned with an offset given by
$N_{TA,offset}$.
## 4.3 Timing for secondary cell activation / deactivation
With reference to slots for PUCCH transmissions, when a UE receives in a PDSCH
an activation command [11, TS 38.321] for a secondary cell ending in slot _n_
, the UE applies the corresponding actions in [11, TS 38.321] no later than
the minimum requirement defined in [10, TS 38.133] and no earlier than slot ,
except for the following:
\- the actions related to CSI reporting on a serving cell that is active in
slot
\- the actions related to the _sCellDeactivationTimer_ associated with the
secondary cell [11, TS 38.321] that the UE applies in slot
\- the actions related to CSI reporting on a serving cell which is not active
in slot that the UE applies in the earliest slot after in which the serving
cell is active.
The value of is ${m + 3\ N}_{\text{slot}}^{\text{subframe},\mu} + 1$ where
slot _n_ +_m_ is a slot indicated for PUCCH transmission with HARQ-ACK
information for the PDSCH reception as described in clause 9.2.3 and is a
number of slots per subframe for the SCS configuration of the PUCCH
transmission as defined in [4, TS 38.211].
With reference to slots for PUCCH transmissions, if a UE receives a
deactivation command [11, TS 38.321] for a secondary cell ending in slot , the
UE applies the corresponding actions in [11, TS 38.321] no later than the
minimum requirement defined in [10, TS 38.133]_, except_ for the actions
related to CSI reporting on an activated serving cell which the UE applies in
slot _._
If _the sCellDeactivationTimer associated with the secondary cell expires_ in
slot , the UE applies the corresponding actions in [11, TS 38.321] no later
than the minimum requirement defined in [10, TS 38.133]_, except_ for the
actions related to CSI reporting on an activated serving cell which the UE
applies in the first slot that is after slot where is the SCS configuration
for PDSCH reception on the secondary cell.
# 5 Radio link monitoring
The downlink radio link quality of the primary cell is monitored by a UE for
the purpose of indicating out-of-sync/in-sync status to higher layers. The UE
is not required to monitor the downlink radio link quality in DL BWPs other
than the active DL BWP, as described in clause 12, on the primary cell. If the
active DL BWP is the initial DL BWP and for SS/PBCH block and CORESET
multiplexing pattern 2 or 3, as described in clause 13, the UE is expected to
perform RLM using the associated SS/PBCH block when the associated SS/PBCH
block index is provided by _RadioLinkMonitoringRS_.
If the UE is configured with a SCG, as described in [12, TS 38.331], and the
parameter _rlf-TimersAndConstants_ is provided by higher layers and is not set
to release, the downlink radio link quality of the PSCell of the SCG is
monitored by the UE for the purpose of indicating out-of-sync/in-sync status
to higher layers. The UE is not required to monitor the downlink radio link
quality in DL BWPs other than the active DL BWP on the PSCell.
A UE can be configured for each DL BWP of a SpCell [11, TS 38.321] with a set
of resource indexes, through a corresponding set of _RadioLinkMonitoringRS_ ,
for radio link monitoring by _failureDetectionResources_. The UE is provided
either a CSI-RS resource configuration index, by _csi-RS-Index_ , or a SS/PBCH
block index, by _ssb-Index_. The UE can be configured with up to
_RadioLinkMonitoringRS_ for link recovery procedures, as described in clause
6, and for radio link monitoring. From the _RadioLinkMonitoringRS_ , up to
_RadioLinkMonitoringRS_ can be used for radio link monitoring depending on
$L_{\max}\ $ as described in _Table 5-1, wherein_ $L_{\max}$ is as defined in
_clause 4.1_ , and up to two _RadioLinkMonitoringRS_ can be used for link
recovery procedures.
For operation with shared spectrum channel access, when a UE is provided a
SS/PBCH block index by _ssb-Index_ , the UE is expected to perform radio link
monitoring using SS/PBCH block(s) in the discovery burst transmission window
as described in clause 4.1, where the SS/PBCH block(s) have candidate SS/PBCH
block index(es) corresponding to SS/PBCH block index provided by _ssb-Index_.
If the UE is not provided _RadioLinkMonitoringRS and the UE is provided for
PDCCH receptions TCI states that include one or more of a CSI-RS_
\- the UE uses for radio link monitoring the RS provided for the active TCI
state for PDCCH _reception_ if the active TCI state for PDCCH reception
includes only one RS
\- if the active TCI state for PDCCH reception includes two RS, the UE expects
that one RS is configured with _qcl-Type_ set to \'typeD\' [6, TS 38.214] and
the UE uses the RS configured with _qcl-Type_ set to \'typeD\' for radio link
monitoring; the UE does not expect both RS to be configured with _qcl-Type_
set to \'typeD\'
\- the UE is not required to use for radio link monitoring an aperiodic or
semi-persistent RS
\- For , the UE selects the RS provided for active TCI states for PDCCH
receptions in CORESETs associated with the search space sets in an order from
the shortest monitoring periodicity. If more than one CORESETs are associated
with search space sets having same monitoring periodicity, the UE determines
the order of the CORESET from the highest CORESET index as described in clause
10.1.
A UE does not expect to use more than _RadioLinkMonitoringRS_ for radio link
monitoring when the UE is not provided _RadioLinkMonitoringRS_.
Values of and for different values of are given in Table 5-1.
Table 5-1: and as a function of _maximum number_ _of SS/PBCH blocks per half
frame_
* * *
4 2 2 8 6 4 64 8 8
For a CSI-RS resource configuration, _powerControlOffsetSS_ is not applicable
and a UE expects to be provided only \'noCDM\' from _cdm-Type,_ only \'one\'
and \'three\' from _density_ , and only \'1 port\' from _nrofPorts_ [6, TS
38.214].
If a UE is configured with multiple DL BWPs for a serving cell, the UE
performs RLM using the RS(s) corresponding to resource indexes provided by
_RadioLinkMonitoringRS_ for the active DL BWP or, if _RadioLinkMonitoringRS_
is not provided for the active DL BWP, using the RS(s) provided _for the
active TCI state for PDCCH receptions_ in CORESETs on the active DL BWP.
In non-DRX mode operation, the physical layer in the UE assesses once per
indication period the radio link quality, evaluated over the previous time
period defined in [10, TS 38.133] against thresholds (Q~out~ and Q~in~)
configured by _rlmInSyncOutOfSyncThreshold_. The UE determines the indication
period as the maximum between the shortest periodicity for radio link
monitoring resources _and 10 msec._
In DRX mode operation, the physical layer in the UE assesses once per
indication period the radio link quality, evaluated over the previous time
period defined in [10, TS 38.133], against thresholds (Q~out~ and Q~in~)
provided by _rlmInSyncOutOfSyncThreshold_. The UE determines the indication
period as the maximum between the shortest periodicity for radio link
monitoring resources _and the DRX period._
The physical layer in the UE indicates, in frames where the radio link quality
is assessed, out-of-sync to higher layers when the radio link quality is worse
than the threshold Q~out~ for all resources in the set of resources for radio
link monitoring. When the radio link quality is better than the threshold
Q~in~ for any resource in the set of resources for radio link monitoring, the
physical layer in the UE indicates, in frames where the radio link quality is
assessed, in-sync to higher layers.
# 6 Link recovery procedures
A UE can be provided, for each BWP of a serving cell, a set
${\overline{q}}_{0}$_of periodic CSI-RS resource configuration indexes by
failureDetectionResourcesToAddModList and_ a set ${\overline{q}}_{1}$ of
periodic CSI-RS resource configuration indexes and/or SS/PBCH block indexes by
_candidateBeamRSList_ or _candidateBeamRSListExt or_
_candidateBeamRSSCellList_ for radio link quality measurements on the BWP of
the serving cell. Instead of the sets ${\overline{q}}_{0}$ and
${\overline{q}}_{1}$, for each BWP of a serving cell, the UE can be provided
respective two sets ${\overline{q}}_{0,0}$ and ${\overline{q}}_{0,1}$ _of
periodic CSI-RS resource configuration indexes_ by _failureDetectionSet1_ and
_failureDetectionSet2 that can be activated by a MAC CE [11 TS 38.321] and
corresponding_ two sets ${\overline{q}}_{1,0}$_and_ ${\overline{q}}_{1,1}$ of
periodic CSI-RS resource configuration indexes and/or SS/PBCH block indexes by
_candidateBeamRS-List_ and _candidateBeamRS-List2, respectively,_ for radio
link quality measurements on the BWP of the serving cell. The set
${\overline{q}}_{0,0}$ is associated with the set ${\overline{q}}_{1,0}$ and
the set ${\overline{q}}_{0,1}$ is associated with the set
${\overline{q}}_{1,1}$.
If the UE is not provided ${\overline{q}}_{0}$_by_
_failureDetectionResourcesToAddModList_ for a BWP of the serving cell _, the
UE determines the set_ ${\overline{q}}_{0}$ _to include periodic CSI-RS
resource configuration indexes with same values as the RS indexes in the RS
sets indicated by_ _TCI-State_ for respective CORESETs that the UE uses for
monitoring PDCCH. If the UE is not provided ${\overline{q}}_{0,0}$ and $\
{\overline{q}}_{0,1}$ for a BWP of the serving cell _, the UE determines the
set_ ${\overline{q}}_{0,0}$ and $\ {\overline{q}}_{0,1}$ _to include periodic
CSI-RS resource configuration indexes with same values as the RS indexes in
the RS sets indicated by_ _TCI-State_ for first and second CORESETs that the
UE uses for monitoring PDCCH, respectively, where the UE is provided two
_coresetPoolIndex_ values 0 and 1 for the first and second CORESETs, or is not
provided _coresetPoolIndex_ value for the first CORESETs and is provided
_coresetPoolIndex_ value of 1 for the second CORESETs, respectively. If there
are two RS indexes in a TCI state, the set ${\overline{q}}_{0}$ or
${\overline{q}}_{0,0}$, or ${\overline{q}}_{0,1}$ includes RS indexes
configured with _qcl-Type_ set to \'typeD\' for the corresponding TCI states.
If a CORESET that the UE uses for monitoring PDCCH includes two TCI states and
the UE is provided _sfnSchemePdcch_ set to \'sfnSchemeA\' or \'sfnSchemeB\',
the set ${\overline{q}}_{0}$ includes RS indexes in the RS sets associated
with the two TCI states.
The UE expects the set ${\overline{q}}_{0}$ to include up to two RS indexes.
If the UE is provided ${\overline{q}}_{0,0}$ or ${\overline{q}}_{0,1}$, the UE
expects the set ${\overline{q}}_{0,0}$ or the set ${\overline{q}}_{0,1}$ to
include up to a number of $N_{\text{BFD}}$ RS indexes indicated by _maxBFD-RS-
resourcesPerSetPerBWP_. If the UE is not provided ${\overline{q}}_{0,0}$ or
${\overline{q}}_{0,1}$, and if a number of active TCI states for PDCCH
receptions in the first or second CORESETs is larger than $N_{\text{BFD}}$,
the UE determines the set ${\overline{q}}_{0,0}$ or ${\overline{q}}_{0,1}$ to
include periodic CSI-RS resource configuration indexes with same values as the
RS indexes in the RS sets associated with the active TCI states for PDCCH
receptions in the first or second CORESETs corresponding to search space sets
according to an ascending order for PDCCH monitoring periodicity. If more than
one first or second CORESETs correspond to search space sets with same
monitoring periodicity, the UE determines the order of the first or second
CORESETs according to a descending order of a CORESET index.
If a UE
\- is not provided _coresetPoolIndex_ or is provided _coresetPoolIndex_ with a
value of 0 for first CORESETs on an active DL BWP of a serving cell,
\- is provided _coresetPoolIndex_ with a value of 1 for second CORESETs on the
active DL BWP of the serving cells, and
\- is provided _SSB-MTCAdditionalPCI_
SS/PBCH block indexes associated with a physical cell identity other than the
one provided by _physCellId_ in _ServingCellConfigCommon_ can be provided in
either ${\overline{q}}_{1,0}$_or_ ${\overline{q}}_{1,1}$ set and the
corresponding ${\overline{q}}_{0,0}$ or ${\overline{q}}_{0,1}$ set is
associated with the physical cell identity.
The UE expects single port RS in the _set_ ${\overline{q}}_{0}$, or
${\overline{q}}_{0,0}$, or ${\overline{q}}_{0,1}$_._ The UE expects single-
port or two-port CSI-RS with frequency density equal to 1 or 3 REs per RB in
the set ${\overline{q}}_{1}$, or ${\overline{q}}_{1,0}$,_or_
${\overline{q}}_{1,1}$. The thresholds Q~out,LR~ and Q~in,LR~ correspond to
the default value of _rlmInSyncOutOfSyncThreshold_ , as described in [10, TS
38.133] for Q~out~, and to the value provided by _rsrp-ThresholdSSB or rsrp-
ThresholdBFR_ , respectively.
The physical layer in the UE assesses the radio link quality according to the
set ${\overline{q}}_{0}$_,_ ${\overline{q}}_{0,0}$, or ${\overline{q}}_{0,1}$,
of resource configurations against the threshold Q~out,LR~. For the set
${\overline{q}}_{0}$_, the UE_ assesses the radio link quality only according
to _SS/PBCH blocks on the PCell or the PSCell or_ periodic _CSI-RS resource
configurations that_ are quasi co-located, as described in [6, TS 38.214],
with the DM-RS of PDCCH receptions by the UE. The UE applies the Q~in,LR~
threshold to the L1-RSRP measurement obtained from a SS/PBCH block. The UE
applies the Q~in,LR~ threshold to the L1-RSRP measurement obtained for a CSI-
RS resource after scaling a respective CSI-RS reception power with a value
provided by _powerControlOffsetSS_.
In non-DRX mode operation, the physical layer in the UE provides an indication
to higher layers when the radio link quality for all corresponding resource
configurations in the set ${\overline{q}}_{0}$_, or in the set_
${\overline{q}}_{0,0}$ or ${\overline{q}}_{0,1}$,_that the UE uses to assess
the radio link quality_ is worse than the threshold Q~out,LR~. The physical
layer informs the higher layers when the _radio link quality_ is worse than
the threshold Q~out,LR~ with a periodicity determined by the maximum between
the shortest periodicity among the SS/PBCH blocks _on the PCell or the PSCell_
and/or the periodic CSI-RS configurations in the set ${\overline{q}}_{0}$_,_
${\overline{q}}_{0,0}$, or ${\overline{q}}_{0,1}$ _that the UE uses to assess
the radio link quality and 2 msec. In DRX mode operation, the physical layer_
provides an indication to higher layers _when the radio link quality is worse
than the threshold Q~out,LR~ with a periodicity determined as described in
[10, TS 38.133]._
For the PCell or the PSCell, upon request from higher layers, the UE provides
to higher layers the periodic CSI-RS configuration indexes and/or SS/PBCH
block indexes from the set ${\overline{q}}_{1}$_,_ or ${\overline{q}}_{1,0}$,
_or_ ${\overline{q}}_{1,1}$ _and the corresponding L1-RSRP measurements that
are larger than or equal to the_ Q~in,LR~ _threshold._
For the SCell, upon request from higher layers, the UE indicates to higher
layers whether there is at least one periodic CSI-RS configuration index or
SS/PBCH block index from the set ${\overline{q}}_{1}$_,_ or
${\overline{q}}_{1,0}$, _or_ ${\overline{q}}_{1,1}$ with corresponding L1-RSRP
measurements that is larger than or equal to the Q~in,LR~ threshold, and
_provides_ the periodic CSI-RS configuration indexes and/or SS/PBCH block
indexes from the set ${\overline{q}}_{1}$_,_ or ${\overline{q}}_{1,0}$,_or_
${\overline{q}}_{1,1}$ _and the corresponding L1-RSRP measurements that are
larger than or equal to the_ Q~in,LR~ _threshold, if any._
For the PCell or the PSCell, a UE can be provided a CORESET through a link to
a search space set provided by _recoverySearchSpaceId,_ as described in clause
10.1, for monitoring PDCCH in the CORESET. If the UE is provided
_recoverySearchSpaceId_ , the UE does not expect to be provided another search
space set for monitoring PDCCH in the CORESET associated with the search space
set provided by _recoverySearchSpaceId_.
For the PCell or the PSCell, the UE can be provided, by _PRACH-
ResourceDedicatedBFR_ , a configuration for PRACH transmission as described in
clause 8.1. For PRACH transmission in slot $n$ and according to antenna port
quasi co-location parameters associated with periodic CSI-RS resource
configuration or with SS/PBCH block associated with index $q_{\text{new}}$
_provided by higher layers_ [11, TS 38.321], the UE monitors PDCCH in a search
space set provided by _recoverySearchSpaceId_ for detection of a DCI format
with CRC scrambled by C-RNTI or MCS-C-RNTI starting from slot $n + 4 +
{2^{\mu} \bullet k}_{\text{mac}}$, where $\mu$ is the SCS configuration for
the PRACH transmission and $k_{\text{mac}}$ is a number of slots provided by
_kmac_ [12, TS 38.331] or $k_{\text{mac}} = 0$ if _kmac_ is not provided,
within a window configured by _BeamFailureRecoveryConfig. For PDCCH
monitoring_ in a search space set provided by _recoverySearchSpaceId_ _and for
corresponding PDSCH receptions, the UE assumes the same antenna port quasi-
collocation parameters as the ones associated with_ index $q_{\text{new}}$
_until the UE receives by higher layers an activation for a TCI state or any
of the parameters tci-StatesPDCCH-ToAddList and/or tci-StatesPDCCH-
ToReleaseList._ After the UE detects a DCI format with CRC scrambled by C-RNTI
or MCS-C-RNTI in the search space set provided by _recoverySearchSpaceId_ ,
the UE continues to monitor PDCCH candidates in the search space set provided
by _recoverySearchSpaceId_ until the UE receives a MAC CE activation command
for a TCI state or _tci-StatesPDCCH-ToAddList and/or tci-StatesPDCCH-
ToReleaseList._
_For the PCell or the PSCell, after 28 symbols from a last symbol of_ a first
PDCCH reception in a search space set provided by _recoverySearchSpaceId_ for
which the UE detects a DCI format with CRC scrambled by C-RNTI or MCS-C-RNTI
_and_ until the UE receives an activation command for _PUCCH-
SpatialRelationInfo_ [11, TS 38.321] or is provided _PUCCH-
SpatialRelationInfo_ for PUCCH resource(s), t _he UE transmits a PUCCH on a
same cell as the PRACH transmission using_
\- _a_ same spatial filter as for the last PRACH transmission
\- _a_ power determined as described in clause 7.2.1 with $q_{u} = 0$, ${q_{d}
= q}_{\text{new}}$, and $l = 0$
_For the PCell or the PSCell and for sets_ ${\overline{q}}_{0}$ and
${\overline{q}}_{1}$_, after 28 symbols from a last symbol of a first PDCCH
reception in a search space set provided by recoverySearchSpaceId where a UE
detects a DCI format with CRC scrambled by C-RNTI or MCS-C-RNTI, the UE
assumes same antenna port quasi-collocation parameters as the ones associated
with index_ $q_{\text{new}}$ _for PDCCH monitoring in a CORESET with index 0._
_If a UE is provided dl-OrJointTCI-StateList or_ _ul-TCI-StateList indicating
a unified TCI state for the PCell or the PSCell [6, TS 38.214], after 28
symbols from a last symbol of_ a first PDCCH reception in a search space set
provided by _recoverySearchSpaceId_ where the UE detects a DCI format with CRC
scrambled by C-RNTI or MCS-C-RNTI, the UE
\- if _SSB-MTC-AdditionalPCI_ is not provided, monitors PDCCH in all CORESETs,
and receives PDSCH and aperiodic CSI-RS resource in a CSI-RS resource set with
same indicated TCI state as for the PDCCH and PDSCH, using the _same antenna
port quasi co-location parameters as the ones associated with the
corresponding index_ $q_{\text{new}}$_, if any_
\- transmits PUSCH, PUCCH and SRS that uses a same spatial domain filter with
same indicated TCI state as for the PUSCH and the PUCCH, using a same spatial
domain filter as _for the last PRACH transmission using the following
parameters for determination of a corresponding power as described in clauses
7.1.1, 7.2.1, and 7.3.1_
\- the RS index ${q_{d} = q}_{\text{new}}$ for obtaining the downlink pathloss
estimate
\- the values of $P_{\text{O_UE_PUSCH},b,f,c}\left( j \right)$,
$\alpha_{b,f,c}\left( j \right)$, and the PUSCH power control adjustment state
$l$ provided by _p0AlphaSetforPUSCH_ associated with the smallest value of
_ul-powercontrolId_ for the PCell or the PSCell
\- the value of $P_{\text{O_UE_P}\text{U}\text{C}\text{CH}}\left( q_{u}
\right)$ and the PUCCH power control adjustment state $l$ provided by
_p0AlphaSetforPUCCH_ associated with the smallest value of _ul-powercontrolId_
for the PCell or the PSCell
\- the values of $P_{\text{O_UE_SRS},b,f,c}\left( q_{s} \right)$,
$\alpha_{\text{SRS},b,f,c}\left( q_{s} \right)$, and the SRS power control
adjustment state $l$ provided by _p0AlphaSetforSRS_ associated with the
smallest value of _ul-powercontrolId_ for the PCell or the PSCell
_For the remaining of this clause,_ if a PDCCH reception includes two PDCCH
candidates from two linked search space sets based on _searchSpaceLinkingId_ ,
as described in clause 10.1, the last symbol of the PDCCH reception is the
last symbol of the PDCCH candidate that ends later. The PDCCH reception
includes the two PDCCH candidates also when _the UE is not required to monitor
one of the two PDCCH candidates as described in clauses 10 (except clause
10.4), 11.1, 11.1.1 and 17.2._
For the PCell or the PSCell, if BFR MAC CE [11, TS 38.321] is _provided_ in
Msg3 or MsgA of contention based random access procedure, and if a PUCCH
resource is provided with _PUCCH-SpatialRelationInfo_ , after 28 symbols from
the last symbol of the PDCCH reception that determines the completion of the
contention based random access procedure as described _in clause 5.1.4a or_ in
clause 5.1.5 of [11, TS 38.321], the UE transmits the PUCCH on a same cell as
the PRACH transmission using
\- a same spatial filter as for the last PRACH transmission
\- _a_ power determined as described in clause 7.2.1 with $q_{u} = 0$, ${q_{d}
= q}_{\text{new}}$, and $l = 0$, where $q_{\text{new}}$ is the SS/PBCH block
index selected for the last PRACH transmission.
_If a UE is provided dl-OrJointTCI-StateList or_ _ul-TCI-StateList indicating
a unified TCI state for the PCell or the PSCell and the UE provides BFR MAC CE
in Msg3 or MsgA of contention based random access procedure, after 28 symbols
from the last symbol of the PDCCH reception that determines the completion of
the contention based random access procedure as described in [11, TS 38.321]_
, the UE
\- if _SSB-MTC-AdditionalPCI_ is not provided, monitors PDCCH in all CORESETs,
and receives PDSCH and aperiodic CSI-RS resource in a CSI-RS resource set with
same indicated TCI state as for the PDCCH and PDSCH using the _same antenna
port quasi co-location parameters as the ones associated with the
corresponding index_ $q_{\text{new}}$_, if any_
\- transmits PUSCH, PUCCH and SRS that uses a same spatial domain filter with
same indicated TCI state as for the PUSCH and PUCCH _,_ using a same spatial
domain filter _as for the last PRACH transmission using the following
parameters for determination of a corresponding power as described in clauses
7.1.1, 7.2.1, and 7.3.1_
\- the RS index ${q_{d} = q}_{\text{new}}$ for obtaining the downlink pathloss
estimate
\- the values of $P_{\text{O_UE_PUSCH},b,f,c}\left( j \right)$,
$\alpha_{b,f,c}\left( j \right)$, and the PUSCH power control adjustment state
$l$ provided by _p0AlphaSetforPUSCH_ associated with the smallest value of
_ul-powercontrolId_ for the PCell or the PSCell
\- the value of $P_{\text{O_UE_P}\text{U}\text{C}\text{CH}}\left( q_{u}
\right)$ and the PUCCH power control adjustment state $l$ provided by
_p0AlphaSetforPUCCH_ associated with the smallest value of _ul-powercontrolId_
for the PCell or the PSCell
\- the values of $P_{\text{O_UE_SRS},b,f,c}\left( q_{s} \right)$,
$\alpha_{\text{SRS},b,f,c}\left( q_{s} \right)$, and the SRS power control
adjustment state $l$ provided by _p0AlphaSetforSRS_ associated with the
smallest value of _ul-powercontrolId_ for the PCell or the PSCell
A UE can be provided, by _schedulingRequestID-BFR-SCell, a configuration for
PUCCH transmission with a link recovery request (LRR) as described in clause
9.2.4 for the UE to transmit PUCCH [11, TS 38.321]. If the PCell or the PSCell
is associated with_ sets ${\overline{q}}_{0,0}$ and ${\overline{q}}_{1,0}$,
and with sets ${\overline{q}}_{0,1}$ and ${\overline{q}}_{1,1}$, the UE can be
provided by _schedulingRequestID-BFR_ a first _configuration for PUCCH
transmission with a LRR and,_ if the UE provides _twoLRRcapability_ , the UE
can be provided by _schedulingRequestID-BFR2_ a second _configuration for
PUCCH transmission with a LRR. If the UE is provided only the first
configuration, the UE transmits a PUCCH with LRR_ for either set
${\overline{q}}_{0,0}$ or ${\overline{q}}_{0,1}$. _If the UE is provided both
the first and second configurations, the UE uses the first configuration to
transmt a PUCCH with LRR associated with_ set ${\overline{q}}_{0,0}$ and the
second configuration to transmit a PUCCH with LRR associated with set
${\overline{q}}_{0,1}$ [11, TS 38.321]_._
_The UE can provide in a first PUSCH MAC CE index(es) for at least
corresponding SCell(s) with_ _radio link quality_ worse than Q~out,LR~_,
indication(s) of presence of_ $q_{\text{new}}$ _for corresponding SCell(s),
and_ index(es) $q_{\text{new}}$ for a periodic CSI-RS configuration or for a
SS/PBCH block _provided by higher layers, as described in_ [11, TS 38.321]_,
if any, for corresponding SCell(s). After 28 symbols from a last symbol of a
PDCCH reception with a DCI format scheduling a PUSCH transmission with a same
HARQ process number as for the transmission of the first PUSCH and having a
toggled NDI field value, the UE_
\- monitors PDCCH in all CORESETs _on the SCell(s) indicated by the MAC CE_
using the _same antenna port quasi co-location parameters as the ones
associated with the corresponding index(es)_ $q_{\text{new}}$_, if any_
\- transmits PUCCH on a PUCCH-SCell using a same spatial domain filter as the
one corresponding to $q_{\text{new}}$_, if any,_ for periodic CSI-RS or
SS/PBCH block reception, as described in clause 9.2.2, and using a power
determined as described in clause 7.2.1 with $q_{\text{u}} = 0$,
${q_{\text{d}} = q}_{\text{new}}$, and $l = 0$_,_ _if_
\- _the UE is_ provided _PUCCH-SpatialRelationInfo_ for the PUCCH,
\- a PUCCH with the LRR was either not transmitted or was transmitted on the
PCell or the PSCell, and
\- the PUCCH-SCell is included in the SCell(s) indicated by the MAC-CE
where the SCS configuration for the 28 symbols is the smallest of the SCS
configurations of the active DL BWP for the PDCCH reception and of the active
DL BWP(s) of the at least one SCell.
_If a UE is provided dl-OrJointTCI-StateList or_ _ul-TCI-StateList indicating
a unified TCI state, after 28 symbols from a last symbol of a PDCCH reception
with a DCI format scheduling a PUSCH transmission with a same HARQ process
number as for the transmission of the first PUSCH and having a toggled NDI
field value_ , the UE
\- if SSB -MTC-AdditionalPCI is not provided, monitors PDCCH in all CORESETs,
on the SCell (s) indicated by the MAC CE, and receives PDSCH and aperiodic
CSI-RS resource in a CSI-RS resource set using the _same antenna port quasi
co-location parameters as the ones associated with the corresponding index_
$q_{\text{new}}$_, if any_
\- transmits PUSCH, PUCCH and SRS that uses a same spatial domain filter with
same indicated TCI state as for the PUSCH and PUCCH, using a same spatial
domain filter as the one corresponding to $q_{\text{new}}$_, if any, and using
the following parameters for determination of a corresponding power as
described in clauses 7.1.1, 7.2.1, and 7.3.1_
\- the RS index ${q_{d} = q}_{\text{new}}$ for obtaining the downlink pathloss
estimate
\- the values of $P_{\text{O_UE_PUSCH},b,f,c}\left( j \right)$,
$\alpha_{b,f,c}\left( j \right)$, and the PUSCH power control adjustment state
$l$ provided by _p0AlphaSetforPUSCH_ associated with the smallest value of
_ul-powercontrolId_ for the corresponding SCell
\- the value of $P_{\text{O_UE_P}\text{U}\text{C}\text{CH}}\left( q_{u}
\right)$ and the PUCCH power control adjustment state $l$ provided by
_p0AlphaSetforPUCCH_ associated with the smallest value of _ul-powercontrolId_
for the corresponding SCell
\- the values of $P_{\text{O_UE_SRS},b,f,c}\left( q_{s} \right)$,
$\alpha_{\text{SRS},b,f,c}\left( q_{s} \right)$, and the SRS power control
adjustment state $l$ provided by _p0AlphaSetforSRS_ associated with the
smallest value of _ul-powercontrolId_ for the corresponding SCell
_If there is at least one serving cell associated with_ sets
${\overline{q}}_{0,0}$ and ${\overline{q}}_{1,0}$, and with sets
${\overline{q}}_{0,1}$ and ${\overline{q}}_{1,1}$, the UE can provide in a
second PUSCH MAC CE _index(es) for cell(s) with_ ${\overline{q}}_{0}$ and/or
with at least one of ${\overline{q}}_{0,0}$ and ${\overline{q}}_{0,1}$ having
_radio link quality_ worse than Q~out,LR~_,_ the index(es) of those
${\overline{q}}_{0,0}$ and/or ${\overline{q}}_{0,1}$, and indication(s)_of
presence of_ $q_{\text{new}}$ _and of_ index(es) $q_{\text{new}}$_, if any,_
from ${\overline{q}}_{1}$ and/or corresponding sets ${\overline{q}}_{1,0}$
and/or ${\overline{q}}_{1,1}$ for the serving cells _._
_For serving cells associated with_ sets ${\overline{q}}_{0,0}$ and
${\overline{q}}_{1,0}$, and with sets ${\overline{q}}_{0,1}$ and
${\overline{q}}_{1,1}$, and having _radio link quality_ worse than Q~out,LR~,
a _fter 28 symbols from a last symbol of a first PDCCH reception with a DCI
format scheduling a PUSCH transmission with a same HARQ process number as for
transmission of the second PUSCH and having a toggled NDI field value, the UE
assumes antenna port quasi-collocation parameters_
\- corresponding to $q_{\text{new}}$ _from_ ${\overline{q}}_{1,0}$, if any,
for the first CORESETs,
\- corresponding to $q_{\text{new}}$ _from_ ${\overline{q}}_{1,1}$, if any,
for the second CORESETs
where the SCS configuration for the 28 symbols is the smallest of the SCS
configurations of the active DL BWP for the PDCCH reception and of the active
DL BWP(s) of the serving cells.
# 7 Uplink Power control
Uplink power control determines a power for PUSCH, PUCCH, SRS, and PRACH
transmissions.
_A UE does not expect to simultaneously maintain more than four pathloss
estimates per serving cell for all PUSCH/PUCCH/SRS transmissions as described
in clauses 7.1.1, 7.2.1, and 7.3.1,_ except for SRS transmissions configured
by _SRS-PosResourceSet_ as described in clause 7.3.1 _. If the UE is provided
a number of RS resources for pathloss estimation for PUSCH/PUCCH/SRS
transmissions that is larger than 4, the UE maintains for pathloss estimation
RS resources corresponding to_ RS resource indexes $q_{d}$ _as described in
clauses 7.1.1, 7.2.1, and 7.3.1._ _If an RS resource updated by MAC CE, as
described in clauses 7.1.1, 7.2.1 and 7.3.1, is one from the RS resources the
UE maintains for pathloss estimation for PUSCH/PUCCH/SRS transmissions_ , the
UE applies the pathloss estimation based on the RS resources starting from the
first slot that is after slot $k + 3 \bullet N_{\text{slot}}^{subframe,\ \
\mu} + {2^{\mu} \bullet k}_{\text{mac}}$ where $k$ is the slot where the UE
would transmit a PUCCH or PUSCH with HARQ-ACK information for the PDSCH
providing the MAC CE, $\mu\text{\ \ }$is the SCS configuration for the PUCCH
or PUSCH, respectively, that is determined in the slot when the MAC CE command
is applied and $k_{\text{mac}}$ is a number of slots for SCS configuration
$\mu = 0$ provided by _kmac_ or $k_{\text{mac}} = 0$ if _kmac_ is not provided
_._
_A PUSCH/PUCCH/SRS/PRACH transmission occasion_ $i$ _is defined by a_ slot
index $n_{s,f}^{\mu}$ within a frame with system frame number $\text{SFN}$, a
first symbol $S$ within the slot, and a number of consecutive symbols $L$. For
a PUSCH transmission with repetition Type B, a PUSCH transmission occasion is
a nominal repetition [6, TS 38.214].
In the remaining of this clause, if a UE is provided _TCI-State in_ _dl-
OrJointTCI-StateList or_ _TCI-UL-State_ and for an indicated _TCI-State or_
_TCI-UL-State_ as described in [6, TS 38.214]
\- in clauses 7.1.1, 7.2.1, and 7.3.1, the RS index $q_{d}$ _for obtaining the
downlink pathloss estimate for PUSCH, PUCCH, and SRS transmission is provided
by pathlossReferenceRS-Id-r17 associated with or included in the_ indicated
_TCI-State or_ _TCI-UL-State_ except for SRS transmission that is not provided
_followUnifiedTCI-StateSRS_
\- in clause 7.1.1, if _p0AlphaSetforPUSCH_ is provided, the values of
$P_{\text{O_UE_P}\text{USCH},b,f,c}\left( j \right)$, $\alpha_{b,f,c}\left( j
\right)$, and the PUSCH power control adjustment state $l$ are provided by
_p0AlphaSetforPUSCH_ associated with the indicated _TCI-State or_ _TCI-UL-
State_
\- in clause 7.2.1, if _p0AlphaSetforPUCCH_ is provided, the values of
$P_{\text{O_UE_P}\text{U}\text{C}\text{CH}}\left( q_{u} \right)$ and the PUCCH
power control adjustment state $l$ are provided by _p0AlphaSetforPUCCH_
associated with the indicated _TCI-State or_ _TCI-UL-State_
\- in clause 7.3.1, if _p0AlphaSetforSRS_ is provided,
\- if _followUnifiedTCI-StateSRS_ is provided for a SRS resource set, the
values of $P_{\text{O_UE_SRS},b,f,c}\left( q_{s} \right)$,
$\alpha_{\text{SRS},b,f,c}\left( q_{s} \right)$, and SRS power control
adjustment state $l$ are provided by _p0AlphaSetforSRS_ associated with the
indicated _TCI-State_ or _TCI-UL-State_
\- else, if _followUnifiedTCI-StateSRS_ is not provided for a SRS resource set
and for a SRS resource from the SRS resource set, the values of
$P_{\text{O_UE_SRS},b,f,c}\left( q_{s} \right)$,
$\alpha_{\text{SRS},b,f,c}\left( q_{s} \right)$, and SRS power control
adjustment state $l$ are provided by _p0AlphaSetforSRS_ associated with _TCI-
State_ or _TCI-UL-State_ of an SRS resource with lowest _SRS-ResourceId_ in
the SRS resource set and a RS index $q_{d}$ for obtaining a pathloss estimate
for the SRS transmission is provided by _pathlossReferenceRS-Id-r17_
associated with or included in the _TCI-State_ or _TCI-UL-State_ of an SRS
resource with lowest _SRS-ResourceId_ in the SRS resource set
> $P_{\text{O_SRS},b,f,c}\left( q_{s} \right)$ is the sum of the component
> $P_{\text{O_UE_SRS},b,f,c}\left( q_{s} \right)$ _and_ a component _p0_
> provided by _SRS-ResourceSet_ corresponding to the SRS resource set.
In the remaining of this clause, if a PDCCH reception by a UE includes two
PDCCH candidates from corresponding search space sets, as described in clause
10.1
\- a PDCCH monitoring occasion is the union of the PDCCH monitoring occasions
for the two PDCCH candidates
\- the end of the PDCCH reception is the end of the PDCCH candidate that ends
later
The PDCCH reception includes the two PDCCH candidates also when _the UE is not
required to monitor one of the two PDCCH candidates as described in clauses 10
(except clause 10.4), 11.1, 11.1.1 and 17.2._
## 7.1 Physical uplink shared channel
For a PUSCH transmission on active UL BWP $b$_, as described in clause 12, of_
carrier $f$ _of_ serving cell $c$_,_ a UE first calculates a linear value
${\widehat{P}}_{\text{PUSCH},b,f,c}(i,j,q_{d},l)$ _of the_ transmit power
$P_{\text{PUSCH},b,f,c}(i,j,q_{d},l)$_, with parameters as defined in clause
7.1.1. For a_ PUSCH transmission scheduled by a DCI format other than DCI
format 0_0, or configured by _ConfiguredGrantConfig_ or
_semiPersistentOnPUSCH_ , if _txConfig_ in _PUSCH-Config_ is set to
\'codebook\',
\- if _ul-FullPowerTransmission_ in _PUSCH-Config_ is provided, _the UE
scales_ ${\widehat{P}}_{\text{PUSCH},b,f,c}(i,j,q_{d},l)$ by $s$ _where:_
\- if _ul-FullPowerTransmission_ in _PUSCH-Config_ is set to _fullpowerMode1_
, and each SRS resource in the _SRS-ResourceSet_ with _usage_ set to
\'codebook\' has more than one SRS port, $s$ _is_ the ratio of a number of
antenna ports with non-zero PUSCH transmission power over the maximum number
of SRS ports supported by the UE in one SRS resource
\- if _ul-FullPowerTransmission_ in _PUSCH-Config_ is set to _fullpowerMode2_
,
> \- $s = 1$ for full power TPMIs _reported by the UE [18, TS 38.306], and_
> $s$ is the ratio of a number of antenna ports with non-zero PUSCH
> transmission power over a number of SRS ports _for remaining TPMIs_ , where
> the number of SRS ports is associated with an SRS resource indicated by an
> SRI field in a DCI format scheduling the PUSCH transmission if more than one
> SRS resource is configured in the _SRS-ResourceSet_ with _usage_ set to
> \'codebook\', or indicated by Type 1 configured grant, or the number of SRS
> ports is associated with the SRS resource if only one SRS resource is
> configured in the _SRS-ResourceSet_ with _usage_ set to \'codebook\',
>
> \- $s = 1$, if an SRS resource with a single port is indicated by an SRI
> field in a DCI format scheduling the PUSCH transmission when more than one
> SRS resource is provided in the _SRS-ResourceSet_ with _usage_ set to
> \'codebook\', or indicated by Type 1 configured grant, or if only one SRS
> resource with a single port is provided in the _SRS-ResourceSet_ with
> _usage_ set to \'codebook\', and
\- if _ul-FullPowerTransmission_ in _PUSCH-Config_ is set to _fullpower_ , $s
= 1$
\- else, if each SRS resource in the _SRS-ResourceSet_ with _usage_ set to
\'codebook\' has more than one SRS port _, the UE scales the linear value_ by
the ratio of the number of antenna ports with a non-zero PUSCH transmission
power to the maximum number of SRS ports supported by the UE in one SRS
resource.
The UE splits the power equally across the antenna ports on which the UE
transmits the PUSCH with non-zero power.
### 7.1.1 UE behaviour
If a UE transmits a PUSCH on active UL BWP $b$ _of_ carrier $f$ _of_ serving
cell $c$ _using_ parameter set configuration _with index_ $j$ _and_ PUSCH
power control adjustment state with index $l$, the UE determines the PUSCH
transmission power $P_{\text{PUSCH},b,f,c}(i,j,q_{d},l)$ in PUSCH transmission
occasion $i$ as
[dBm]
where,
\- $P_{\text{C}\text{MAX},f,c}(i)$is the UE configured maximum output power
defined in [8-1, TS 38.101-1], [8-2, TS 38.101-2] and [8-3, TS 38.101-3] for
carrier $f$ _of_ serving cell $c$ in PUSCH transmission occasion $i$.
\- $P_{\text{O_P}\text{USCH},b,f,c}(j)$ is a parameter composed of the sum of
a component $P_{\text{O_NOMINAL,P}\text{USCH},f,c}(j)$ and a component
$P_{\text{O_UE_P}\text{USCH},b,f,c}(j)$ where $j \in \left{ 0,1,\ldots,J - 1
\right}$.
\- If a UE established dedicated RRC connection using a Type-1 random access
procedure, as described in clause 8, and is not provided _P0-PUSCH-AlphaSet_
or for a PUSCH (re)transmission corresponding to a RAR UL grant as described
in clause 8.3,
$j = 0$, $P_{\text{O_UE_P}\text{USCH},b,f,c}\left( 0 \right) = 0$, and
$P_{\text{O_NOMINAL,P}\text{USCH},f,c}\left( 0 \right) = P_{\text{O_PRE}} +
\mathrm{\Delta}_{PREAMBLE,Msg3}$,
> where $P_{\text{O_PRE}}$ is provided by _preambleReceivedTargetPower_ [11,
> TS 38.321] and $\Delta_{PREAMBLE_ Msg3}$ is provided by _msg3-DeltaPreamble
> or deltaPreamble_ , or $\mathrm{\Delta}_{PREAMBLE,Msg3} = 0$ dB if
> _msg3-DeltaPreamble and deltaPreamble are not provided_ , for carrier $f$
> _of_ serving cell $c$
\- If a UE established dedicated RRC connection using a Type-2 random access
procedure, as described in clause 8, and is not provided _P0-PUSCH-AlphaSet_ ,
or for a PUSCH transmission for Type-2 random access procedure as described in
clause 8.1A,
$j = 0$, $P_{\text{O_UE_PUSCH,}b,f,c}(0) = 0$, and
$P_{\text{O_NOMINAL_PUSCH,}f,c}(0) = P_{\text{O_PRE}} +
\Delta_{\text{MsgA}_\text{PUSCH}}$,
> where $P_{\text{O_PRE}}$ is provided by _msgA-preambleReceivedTargetPower,
> or by_ _preambleReceivedTargetPower_ _if msgA-preambleReceivedTargetPower_
> is _not provided_ and $\Delta_{MsgA_ PUSCH}$ is provided by _msgA-
> DeltaPreamble or deltaPreamble_ , or $\Delta_{MsgA_ PUSCH} =
> \Delta_{PREAMBLE_ Msg3}$ dB if _msgA-DeltaPreamble and deltaPreamble are not
> provided_ , for carrier $f$ _of_ serving cell $c$
\- For a PUSCH (re)transmission configured by _ConfiguredGrantConfig_ , $j =
1$, $P_{\text{O_NOMINAL,P}\text{USCH},f,c}\left( 1 \right)$ is provided by
_p0-NominalWithoutGrant_ , or $P_{\text{O_NOMINAL,P}\text{USCH},f,c}\left( 1
\right) = P_{\text{O_NOMINAL,P}\text{USCH},f,c}\left( 0 \right)$ if
_p0-NominalWithoutGrant_ is not provided.
\- If the UE is provided _two SRS resource sets in srs-ResourceSetToAddModList
or srs-ResourceSetToAddModListDCI-0-2 with usage set to \'codebook\' or
\'nonCodebook\' and is provided p0-PUSCH-Alpha2_ , for a retransmission of a
configured grant Type 1 PUSCH, or for activation or retransmission of a
configured grant Type 2 PUSCH, scheduled by a DCI format that includes a SRS
resource set indicator field, and for active UL BWP $b$ of carrier $f$ _of_
serving cell
> \- If the SRS resource set indicator value is 00, first
> $P_{\text{O_UE_P}\text{USCH},b,f,c}\left( 1 \right)$ value is provided by
> the _value of_ _p0-PUSCH-Alpha_ in _ConfiguredGrantConfig_.
>
> \- If the SRS resource set indicator value is 01, second
> $P_{\text{O_UE_P}\text{USCH},b,f,c}\left( 1 \right)$ value is provided by
> _the value of_ _p0-PUSCH-Alpha2_ in _ConfiguredGrantConfig_.
>
> \- If the SRS resource set indicator value is 10 or 11, first and second
> $P_{\text{O_UE_P}\text{USCH},b,f,c}\left( 1 \right)$ values that are
> respectively associated with the first and second SRS resource set are
> respectively provided by _the values of_ _p0-PUSCH-Alpha and by p0-PUSCH-
> Alpha2_ in _ConfiguredGrantConfig_.
\- else if the UE is provided _two SRS resource sets in srs-
ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with usage set
to \'codebook\' or \'nonCodebook\' and is provided p0-PUSCH-Alpha2_ , for a
transmission of a configured grant Type 1 PUSCH and for active UL BWP $b$ of
carrier $f$ _of_ serving cell
> \- a first $P_{\text{O_UE_PUSCH},b,f,c}\left( 1 \right)$ value is provided
> by the _value of_ _p0-PUSCH-Alpha_ in _ConfiguredGrantConfig that is
> associated with the firs_ t _srs-ResourceIndicator_ in _rrc-
> ConfiguredUplinkGrant_
>
> \- a second $P_{\text{O_UE_PUSCH},b,f,c}\left( 1 \right)$ value is provided
> by _the value of_ _p0-PUSCH-Alpha2_ in _ConfiguredGrantConfig that is
> associated with the second_ _srs-ResourceIndicator_ in _rrc-
> ConfiguredUplinkGrant_
\- else if the UE is provided _two SRS resource sets in srs-
ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with usage set
to \'codebook\' or \'nonCodebook\' and is provided p0-PUSCH-Alpha2, for a
retransmission of a configured grant Type 1 PUSCH, or for activation or
retransmis_ sion of a configured grant Type 2 PUSCH, scheduled by a DCI format
0_0, and for active UL BWP $b$ of carrier $f$ _of_ serving cell
> \- a first $P_{\text{O_UE_PUSCH},b,f,c}\left( 1 \right)$ value is provided
> by the _value of_ _p0-PUSCH-Alpha_ in _ConfiguredGrantConfig_
\- else, $P_{\text{O_UE_PUSCH},b,f,c}\left( 1 \right)$ is provided by _p0_
obtained from _p0-PUSCH-Alpha_ in _ConfiguredGrantConfig_ that provides an
index _P0-PUSCH-AlphaSetId_ to a set of _P0-PUSCH-AlphaSet, or by sdt-P0-PUSCH
for a PUSCH (re)transmission as described in clause 19.1,_ for active UL BWP
$b$ of carrier $f$ _of_ serving cell $c$
\- For $j \in \left{ 2,\ldots,J - 1 \right} = S_{J}$, a
$P_{\text{O_NOMINAL,P}\text{USCH},f,c}\left( j \right)$ value, applicable for
all $j \in S_{J}$, is provided by _p0-NominalWithGrant,_ or
$P_{\text{O_NOMINAL,P}\text{USCH},f,c}\left( j \right) =
P_{\text{O_NOMINAL,P}\text{USCH},f,c}\left( 0 \right)$ if
_p0-NominalWithGrant_ is not provided, for each carrier $f$ _of_ serving cell
$c$ and a set of $P_{\text{O_UE_P}\text{USCH},b,f,c}\left( j \right)\ $values
are provided by a set of _p0_ in _P0-PUSCH-AlphaSet_ indicated by a respective
set of _p0-PUSCH-AlphaSetId_ for active UL BWP $b$ of carrier $f$ _of_ serving
cell $c$
\- If the UE is provided by _SRI-PUSCH-PowerControl_ more than one values of
_p0-PUSCH-AlphaSetId_ and if a DCI format scheduling the PUSCH transmission
includes an SRI field, the UE obtains a mapping from _sri-PUSCH-
PowerControlId_ in _SRI-PUSCH-PowerControl_ between a set of values for the
SRI field in the DCI format [5, TS 38.212] and a set of indexes provided by
_p0-PUSCH-AlphaSetId_ that map to a set of _P0-PUSCH-AlphaSet_ values and
determines the value of $P_{\text{O_UE_P}\text{USCH},b,f,c}\left( j \right)$
from the _p0-PUSCH-AlphaSetId_ value that is mapped to the SRI field value. If
the UE is provided by _SRI-PUSCH-PowerControl_ more than one values of
_p0-PUSCH-AlphaSetId_
> \- if the DCI format scheduling the PUSCH transmission includes two SRI
> fields and the UE is provided _two SRS resource sets in srs-
> ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with usage set
> to \'codebook\' and if_ , the UE obtains a mapping from _sri-PUSCH-
> PowerControlId_ in _SRI-PUSCH-PowerControl_ between a set of values for the
> two SRI fields and a set of indexes provided by _p0-PUSCH-AlphaSetId_ that
> map to a set of _P0-PUSCH-AlphaSet_ values, and determines first and second
> values of $P_{\text{O_UE_P}\text{USCH},b,f,c}\left( j \right)$ from the
> _p0-PUSCH-AlphaSetId_ values that are mapped to the values of the first and
> second SRI fields, respectively.
>
> \- if the DCI format scheduling the PUSCH transmission includes two SRI
> fields and the UE is provided _two SRS resource sets in srs-
> ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with usage
> set_ to \'nonCodebook\', the UE obtains a mapping from _sri-PUSCH-
> PowerControlId_ in _SRI-PUSCH-PowerControl_ between
\- a set of values for the first SRI field value and a set of indexes provided
by _p0-PUSCH-AlphaSetId_ that map to a set of _P0-PUSCH-AlphaSet_ values, and
determines the first value of $P_{\text{O_UE_P}\text{USCH},b,f,c}\left( j
\right)$ from the _p0-PUSCH-AlphaSetId_ value that is mapped to the first SRI
field value, and
\- a set of values associated with the second SRI field value for a same
number of layers as indicated by the first SRI field [5, TS 38.212], and a set
of indexes provided by _p0-PUSCH-AlphaSetId_ that map to a set of _P0-PUSCH-
AlphaSet_ values, and determines the second value of
$P_{\text{O_UE_P}\text{USCH},b,f,c}\left( j \right)$ from the _p0-PUSCH-
AlphaSetId_ value that is mapped to the second SRI field value corresponding
to Tables 7.3.1.1.2-28/29/30/31 of [5, TS 38.212].
> \- If the DCI format also includes an open-loop power control parameter set
> indication _field and a value of the_ open-loop power control parameter set
> indication _field is \'1\' and if the DCI format scheduling the PUSCH
> transmission includes an SRI field, the UE determines_ a value of
> $P_{\text{O_UE_P}\text{USCH},b,f,c}\left( j \right)$ from a first value in
> _P0-PUSCH-Set_ with a _p0-PUSCH-SetId_ value mapped to the SRI field value.
>
> \- If the UE is provided by _SRI-PUSCH-PowerControl_ more than one values of
> _p0-PUSCH-AlphaSetId_
\- if a DCI format scheduling the PUSCH transmission includes two SRI fields
_and an_ open-loop power control parameter set indication _field_ and the UE
is provided _two SRS resource sets in srs-ResourceSetToAddModList or srs-
ResourceSetToAddModListDCI-0-2 with usage set_ to \'codebook\'
\- if _a value of the_ open-loop power control parameter set indication _field
is \'0\', the UE_ determines two values of
$P_{\text{O_UE_P}\text{USCH},b,f,c}\left( j \right)$ from the _p0-PUSCH-
AlphaSetId_ values in _SRI-PUSCH-PowerControl_ that are mapped to the two SRI
values corresponding to each SRS resource set with _usage set to
\'codebook\'_.
\- if _a value of the_ open-loop power control parameter set indication _field
is \'1\', the UE determines_ two values of
$P_{\text{O_UE_P}\text{USCH},b,f,c}\left( j \right)$ from first values in
_P0-PUSCH-Set_ in _P0-PUSCH-SetList_ and _P0-PUSCH-Set_ in _P0-PUSCH-SetList2_
with _p0-PUSCH-SetId_ values mapped to the two SRI values corresponding to
each SRS resource set with _usage set to \'codebook\'_ , respectively.
\- if a DCI format scheduling the PUSCH transmission includes two SRI fields
_and an_ open-loop power control parameter set indication _field_ and the UE
is provided _two SRS resource sets in srs-ResourceSetToAddModList or srs-
ResourceSetToAddModListDCI-0-2 with usage set_ to \'nonCodebook\',
\- if _a value of the_ open-loop power control parameter set indication _field
is \'0\', the UE_ determines two values of
$P_{\text{O_UE_P}\text{USCH},b,f,c}\left( j \right)$ from the _p0-PUSCH-
AlphaSetId_ values in _SRI-PUSCH-PowerControl_ that are mapped to the first
SRI field value corresponding to the first SRS resource set with _usage set to
\'nonCodebook\'_ _and to a second value, that is associated with the second
SRI field value_ corresponding to Tables 7.3.1.1.2-28/29/30/31 of [5, TS
38.212] _for a same number of layers as indicated by the first SRI field
value, corresponding to the second SRS resource set_ with _usage set to
\'nonCodebook\'_.
\- if _a value of the_ open-loop power control parameter set indication _field
is \'1\', the UE determines_ two values of
$P_{\text{O_UE_P}\text{USCH},b,f,c}\left( j \right)$ from first values in
_P0-PUSCH-Set_ in _P0-PUSCH-SetList_ and _P0-PUSCH-Set_ in _P0-PUSCH-SetList2_
with _p0-PUSCH-SetId_ values mapped to the first SRI field value corresponding
to the first SRS resource set with _usage set to \'nonCodebook_ , _and a
second value, that is associated with the second SRS field value_
corresponding to Tables 7.3.1.1.2-28/29/30/31 of [5, TS 38.212] _for a same
number of layers as indicated by the first SRI field value, corresponding to
the second SRS resource set_ with _usage set to \'nonCodebook\',_
respectively.
\- if the UE is not provided _two SRS resource sets in srs-
ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with usage set
to \'codebook\' or \'nonCodebook\' and if_ the PUSCH transmission, except for
the PUSCH retransmission corresponding to a RAR UL grant, is scheduled by a
DCI format that does not include an SRI field, or if _SRI-PUSCH-PowerControl_
is not provided to the UE, $j = 2$,
\- if _P0-PUSCH-Set_ is provided to the UE and the DCI format includes an
open-loop power control parameter set indication _field, the UE determines_ a
value of $P_{\text{O_UE_P}\text{USCH},b,f,c}\left( j \right)$ from
\- a first _P0-PUSCH-AlphaSet_ in _p0-AlphaSets_ if _a value of the_ open-loop
power control parameter set indication _field is \'0\' or \'00\'_
\- a first value in _P0-PUSCH-Set_ with the lowest _p0-PUSCH-SetID_ value if
_a value of the_ open-loop power control parameter set indication _field is
\'1\' or \'01\'_
\- a second value in _P0-PUSCH-Set_ with the lowest _p0-PUSCH-SetID_ value if
_a value of the_ open-loop power control parameter set indication _field is
\'10\'_
\- else, the UE determines $P_{\text{O_UE_P}\text{USCH},b,f,c}\left( j
\right)$ from the value of the first _P0-PUSCH-AlphaSet_ in _p0-AlphaSets_
\- if the UE is provided _two SRS resource sets in srs-ResourceSetToAddModList
or srs-ResourceSetToAddModListDCI-0-2 with usage set to \'codebook\' or
\'nonCodebook\'_ and the PUSCH transmission is scheduled by a DCI format that
does not include an SRI field and includes an SRS resource set indicator field
with value 10 or 11
> \- if _P0-PUSCH-Set_ is provided to the UE and the DCI format includes an
> open-loop power control parameter set indication _field, the UE determines_
> first and second values of $P_{\text{O_UE_P}\text{USCH},b,f,c}\left( j
> \right)$ respectively associated with the first and second SRS resource set
> as
>
> \- first and second _P0-PUSCH-AlphaSet_ in _p0-AlphaSets_ if _the_ open-loop
> power control parameter set indication _value is \'0\' or \'00\'_
>
> \- first value in _P0-PUSCH-Set_ with the lowest _p0-PUSCH-SetID_ value in
> _p0-PUSCH-SetList_ and first value in _P0-PUSCH-Set_ with the lowest
> _p0-PUSCH-SetID_ value in _p0-PUSCH-SetList2_ , respectively, if _the_ open-
> loop power control parameter set indication _value is \'1\' or \'01\'_
>
> \- second value in _P0-PUSCH-Set_ with the lowest _p0-PUSCH-SetID_ value in
> _p0-PUSCH-SetList_ and second value in _P0-PUSCH-Set_ with the lowest
> _p0-PUSCH-SetID_ in _p0-PUSCH-SetList2_ , respectively, if _the_ open-loop
> power control parameter set indication _value is \'10\' or \'11\'_
\- else, the UE determines first and second values
$P_{\text{O_UE_PUSCH},b,f,c}\left( j \right)$ respectively associated with the
first and second SRS resource set from the values of the first and second
_P0-PUSCH-AlphaSet_ in _p0-AlphaSets, respectively_
\- if the UE is provided _two SRS resource sets in srs-ResourceSetToAddModList
or srs-ResourceSetToAddModListDCI-0-2 with usage set to \'codebook\' or
\'nonCodebook\',_ and the PUSCH transmission is scheduled by a DCI format that
does not include an SRI field and includes an SRS resource set indicator field
with value _\'_ 00 _\'_
> \- if the UE is provided _P0-PUSCH-Set_ and the DCI format includes an open-
> loop power control parameter set indication _field, the UE determines_ a
> value of $P_{\text{O_UE_PUSCH},b,f,c}\left( j \right)$ as
>
> \- first _P0-PUSCH-AlphaSet_ in _p0-AlphaSets_ if _the_ open-loop power
> control parameter set indication _value is \'0\' or \'00\'_
>
> \- first value in _P0-PUSCH-Set_ with the lowest _p0-PUSCH-SetID_ value in
> _p0-PUSCH-SetList_ , if _the_ open-loop power control parameter set
> indication _value is \'1\' or \'01\'_
>
> \- second value in _P0-PUSCH-Set_ with the lowest _p0-PUSCH-SetID_ value in
> _p0-PUSCH-SetList_ , if _the_ open-loop power control parameter set
> indication _value is \'10\' or \'11\'_
\- else, the UE determines a value of $P_{\text{O_UE_PUSCH},b,f,c}\left( j
\right)$ from the value of the first _P0-PUSCH-AlphaSet_ in _p0-AlphaSets_
\- if the UE is provided _two SRS resource sets in srs-ResourceSetToAddModList
or srs-ResourceSetToAddModListDCI-0-2 with usage set to \'codebook\' or
\'nonCodebook\',_ and the PUSCH transmission is scheduled by a DCI format that
does not include an SRI field and includes an SRS resource set indicator field
with value _\'01\'_
\- if _P0-PUSCH-Set_ is provided to the UE and the DCI format includes an
open-loop power control parameter set indication _field, the UE determines_ a
value of $P_{\text{O_UE_PUSCH},b,f,c}\left( j \right)$ as
> \- second _P0-PUSCH-AlphaSet_ in _p0-AlphaSets_ if _the_ open-loop power
> control parameter set indication _value is \'0\' or \'00\'_
>
> \- first value in _P0-PUSCH-Set_ with the lowest _p0-PUSCH-SetID_ value in
> _p0-PUSCH-SetList2_ , if _the_ open-loop power control parameter set
> indication _value is \'1\' or \'01\'_
>
> \- second value in _P0-PUSCH-Set_ with the lowest _p0-PUSCH-SetID_ in
> _p0-PUSCH-SetList2_ , if _the_ open-loop power control parameter set
> indication _value is \'10\' or \'11\'_
\- else, the UE determines a value of $P_{\text{O_UE_PUSCH},b,f,c}\left( j
\right)$ from the value of the second _P0-PUSCH-AlphaSet_ in _p0-AlphaSets_
\- For $\alpha_{b,f,c}\left( j \right)$
\- For $j = 0$,
\- if $P_{\text{O_NOMINAL_PUSCH,}f,c}(0) = P_{\text{O_PRE}} +
\Delta_{\text{MsgA}_\text{PUSCH}}$ and _msgA-Alpha is provided_ ,
$\alpha_{b,f,c}(0)$ is the value of _msgA-Alpha_
\- elseif $P_{\text{O_NOMINAL_PUSCH,}f,c}(0) = P_{\text{O_PRE}} +
\Delta_{\text{PREAMBLE}_\text{Msg}3}$ or _msgA-Alpha is not provided_ , and
_msg3-Alpha_ is provided, $\alpha_{b,f,c}(0)$ is the value of _msg3-Alpha_
\- else, $\alpha_{b,f,c}\left( 0 \right) = 1$
\- For $j = 1$,
\- if the UE is provided _two SRS resource sets in srs-ResourceSetToAddModList
or srs-ResourceSetToAddModListDCI-0-2 with usage set to \'codebook\' or
\'nonCodebook\' and is provided p0-PUSCH-Alpha2_ , for a retransmission of a
configured grant Type 1 PUSCH, or for activation or retransmission of a
configured grant Type 2 PUSCH, scheduled by a DCI format that includes an SRS
resource set indicator field, and for active UL BWP $b$ of carrier $f$ _of_
serving cell
> \- if the SRS resource set indicator value is \'00\', first
> $\alpha_{b,f,c}(1)$ value is provided by _p0-PUSCH-Alpha_ in
> _ConfiguredGrantConfig_
>
> \- if the SRS resource set indicator value is \'01\', first
> $\alpha_{b,f,c}(1)$ value is provided by _p0-PUSCH-Alpha2_ in
> _ConfiguredGrantConfig_
>
> \- if the SRS resource set indicator value is \'10\' or \'11\', first and
> second $\alpha_{b,f,c}(1)$ values associated with the first and second SRS
> resource set are respectively provided by _p0-PUSCH-Alpha and p0-PUSCH-
> Alpha2_ in _ConfiguredGrantConfig_
\- else if the UE is provided _two SRS resource sets in srs-
ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with usage set
to \'codebook\' or \'nonCodebook\' and is provided p0-PUSCH-Alpha2_ , for a
transmission of a configured grant Type 1 PUSCH and for active UL BWP $b$ of
carrier $f$ _of_ serving cell
\- a first $\alpha_{b,f,c}(1)$ value is provided by the _value of_ _p0-PUSCH-
Alpha_ in _ConfiguredGrantConfig that is associated with the firs_ t _srs-
ResourceIndicator_ in _rrc-ConfiguredUplinkGrant_.
\- a second $\alpha_{b,f,c}(1)$ value is provided by _the value of_ _p0-PUSCH-
Alpha2_ in _ConfiguredGrantConfig that is associated with the second_ _srs-
ResourceIndicator_ in _rrc-ConfiguredUplinkGrant_.
\- else if the UE is provided two SRS resource sets in _srs-
ResourceSetToAddModList_ or _srs-ResourceSetToAddModListDCI-0-2_ with _usage_
set to \'codebook\' or \'nonCodebook\' and is provided _p0-PUSCH-Alpha2_ , for
a retransmission of a configured grant Type 1 PUSCH, or for activation or
retransmission of a configured grant Type 2 PUSCH, scheduled by a DCI format
0_0 and for active UL BWP $b$ of carrier $f$ of serving cell
\- a first$P_{\text{O_UE_PUSCH},b,f,c}\left( 1 \right)$ $\alpha_{b,f,c}(1)$
value is provided by the _value of_ _p0-PUSCH-Alpha_ in
_ConfiguredGrantConfig._
\- else $\alpha_{b,f,c}(1)$ is provided by _alpha_ obtained from _p0-PUSCH-
Alpha_ in _ConfiguredGrantConfig_ providing an index _P0-PUSCH-AlphaSetId_ to
a set of _P0-PUSCH-AlphaSet, or by sdt-Alpha for a PUSCH (re)transmission as
described in clause 19.1,_ for active UL BWP $b$ of carrier $f$ _of_ serving
cell $c$
\- For $j \in S_{J}$, a set of $\alpha_{b,f,c}\left( j \right)$ values are
provided by a set of _alpha_ in _P0-PUSCH-AlphaSet_ indicated by a respective
set of _p0-PUSCH-AlphaSetId_ for active UL BWP $b$ of carrier $f$ _of_ serving
cell $c$
\- If the UE is provided _SRI-PUSCH-PowerControl_ and more than one values of
_p0-PUSCH-AlphaSetId in p0-AlphaSets_ ,
\- if a DCI format scheduling the PUSCH transmission includes two SRI fields
and the UE is provided _two SRS resource sets in srs-ResourceSetToAddModList
or srs-ResourceSetToAddModListDCI-0-2 with usage set to_ \'codebook\', the UE
obtains a mapping from _sri-PUSCH-PowerControlId in SRI-PUSCH-PowerControl
between a set of values for_
\- the two SRI fields and a set of indexes provided by _P0-PUSCH-AlphaSetId_
that map to _P0-PUSCH-AlphaSet_ values, and determines first and second values
of $\alpha_{b,f,c}\left( j \right)$ from the _P0-PUSCH-AlphaSetID_ values that
are mapped to the values of the first and second SRI field values,
respectively.
\- if a DCI format scheduling the PUSCH transmission includes two SRI fields
and the UE is provided _two SRS resource sets in srs-ResourceSetToAddModList
or srs-ResourceSetToAddModListDCI-0-2 with usage set to_ \'nonCodebook\', the
UE obtains a mapping from _sri-PUSCH-PowerControlId in SRI-PUSCH-PowerControl
between a set of values for_
\- the first SRI field and a set of indexes provided by _P0-PUSCH-AlphaSetId_
that map to _P0-PUSCH-AlphaSet_ values, and determines first value of
$\alpha_{b,f,c}\left( j \right)$ from the _P0-PUSCH-AlphaSetID_ value that is
mapped to the first SRI field value, and
\- the second value, associated with the second SRI field value corresponding
to Tables 7.3.1.1.2-28/29/30/31 of [5, TS 38.212] for a same number of layers
as indicated by the first SRI field value, and a set of indexes provided by
_p0-PUSCH-AlphaSetId_ that map to a set of _P0-PUSCH-AlphaSet_ values, and
determines the second value of $\alpha_{b,f,c}\left( j \right)$ from the
_p0-PUSCH-AlphaSetId_ value that is mapped to the second SRI field value
\- if a DCI format scheduling the PUSCH transmission includes one SRI field,
the UE obtains a mapping from _sri-PUSCH-PowerControlId_ in _SRI-PUSCH-
PowerControl_ between a set of values for the SRI field in the DCI format [5,
TS 38.212] and a set of indexes provided by _p0-PUSCH-AlphaSetId_ that map to
a set of _P0-PUSCH-AlphaSet_ values and determines the values of
$\alpha_{b,f,c}\left( j \right)$ from the _p0-PUSCH-AlphaSetId_ value that is
mapped to the SRI field value
\- If the UE is not provided _two SRS resource sets in srs-
ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with usage set
to \'codebook\' or \'nonCodebook\' and if_ the PUSCH transmission except for
the PUSCH retransmission corresponding to a RAR UL grant is scheduled by a DCI
format that does not include an SRI field, or if _SRI-PUSCH-PowerControl_ is
not provided to the UE, $j = 2$, and the UE determines $\alpha_{b,f,c}\left( j
\right)$ from the value of the first _P0-PUSCH-AlphaSet_ in _p0-AlphaSets_
\- If the UE is provided _two SRS resource sets in srs-ResourceSetToAddModList
or srs-ResourceSetToAddModListDCI-0-2 with usage set to \'codebook\' or
\'nonCodebook\'_ and the PUSCH transmission is scheduled by a DCI format that
does not include an SRI field and includes an SRS resource set indicator field
with value \'10\' or \'11\', the UE determines $\alpha_{b,f,c}\left( j
\right)$ respectively associated with the first and second SRS resource set
from first and second _P0-PUSCH-AlphaSet_ in _p0-AlphaSets_
\- If the UE is provided _two SRS resource sets in srs-ResourceSetToAddModList
or srs-ResourceSetToAddModListDCI-0-2 with usage set to \'codebook\' or
\'nonCodebook\',_ and the PUSCH transmission is scheduled by a DCI format that
does not include an SRI field and includes an SRS resource set indicator field
with value _\'_ 00 _\'_ or _\'_ 01 _\'_ , the UE determines
$\alpha_{b,f,c}\left( j \right)$ from first _P0-PUSCH-AlphaSet_ or second
_P0-PUSCH-AlphaSet_ in _p0-AlphaSets_ , respectively.
\- $M_{\text{RB},b,f,c}^{\text{PUSCH}}(i)$ is the bandwidth of the PUSCH
resource assignment expressed in number of resource blocks for PUSCH
transmission occasion $i$ on active UL BWP $b$ of carrier $f$ _of_ serving
cell $c$ and $\mu$ is a SCS configuration defined in [4, TS 38.211]
\- $\text{PL}_{b,f,c}(q_{d})$ is a downlink pathloss estimate in dB calculated
by the UE using reference signal (RS) index $q_{d}$ for the active DL BWP, as
described in clause 12, _of carrier_ $f$ _of_ serving cell $c$
\- If the UE is not provided _PUSCH-PathlossReferenceRS_ and
_enableDefaultBeamPL-ForSRS_ , or before the UE is provided dedicated higher
layer parameters _, the UE calculates_ $\text{PL}_{b,f,c}(q_{d})$ _using a RS
resource from an SS/PBCH block_ with same SS/PBCH block index as the one _the
UE uses to obtain MIB_
\- If the UE is configured with a number of RS resource indexes, up to the
value of _maxNrofPUSCH-PathlossReferenceRSs_ , and a respective set of RS
configurations for the number of RS resource indexes by _PUSCH-
PathlossReferenceRS_ , the set of RS resource indexes can include one or both
of a set of SS/PBCH block indexes, each provided by _ssb-Index_ when a value
of a corresponding _pusch-PathlossReferenceRS-Id_ maps to a SS/PBCH block
index, and a set of CSI-RS resource indexes, each provided by _csi-RS-Index_
when a value of a corresponding _pusch-PathlossReferenceRS-Id_ maps to a CSI-
RS resource index _._ The UE identifies a RS resource index $q_{d}$ in the set
of RS resource indexes to correspond either to a SS/PBCH block index or to a
CSI-RS resource index as provided by _pusch-PathlossReferenceRS-Id_ in _PUSCH-
PathlossReferenceRS_
\- If the PUSCH transmission is scheduled by a RAR UL grant as described in
clause 8.3 _, or for a PUSCH transmission for Type-2 random access procedure
as described in clause 8.1A, the UE uses the same RS resource index_ $q_{d}$
_as for a corresponding PRACH transmission_
\- If the UE is provided _SRI-PUSCH-PowerControl_ and more than one values of
_PUSCH-PathlossReferenceRS-Id_ , the UE obtains a mapping from _sri-PUSCH-
PowerControlId_ in _SRI-PUSCH-PowerControl_ between a set of values for the
SRI field, or for first and second SRI fields if the UE is provided _two SRS
resource sets in srs-ResourceSetToAddModList or srs-
ResourceSetToAddModListDCI-0-2 with usage set to_ \'codebook\', or values for
a first SRI field and values associated with a second SRI field value
corresponding to Tables 7.3.1.1.2-28/29/30/31 of [5, TS 38.212] for a same
_number of layers as indicated by the first SRI field value_ if the UE is
provided _two SRS resource sets in srs-ResourceSetToAddModList or srs-
ResourceSetToAddModListDCI-0-2 with usage set to_ \'nonCodebook\', in a DCI
format scheduling the PUSCH transmission and a set of _PUSCH-
PathlossReferenceRS-Id_ values and determines the RS resource index $q_{d}$,
or respective first and second RS resource indexes $q_{d}$, from the value of
_PUSCH-PathlossReferenceRS-Id_ that is mapped to the SRI field value, or from
the values of _PUSCH-PathlossReferenceRS-Id_ that are mapped to respective
first and second SRI field values if the UE is provided _two SRS resource sets
in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with
usage set to_ \'codebook\', or from the values of _PUSCH-PathlossReferenceRS-
Id_ that are mapped to respective first SRI field value and a value associated
with the second SRI field value corresponding to Tables 7.3.1.1.2-28/29/30/31
of [5, TS 38.212] for a same _number of layers as indicated by the first SRI
field value_ if the UE is provided _two SRS resource sets in srs-
ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with usage set
to_ \'nonCodebook\',
> where the RS resource is either on serving cell $c$ or, if provided, on a
> serving cell indicated by a value of _pathlossReferenceLinking_
\- If the PUSCH transmission is scheduled by DCI format 0_0, and
\- if two spatial settings from _PUCCH-SpatialRelationInfo_ are activated for
a PUCCH resource with a lowest index for active UL BWP $b$ of each carrier $f$
and serving cell $c$, the UE uses the same RS resource index $q_{d}$ as for a
PUCCH transmission with a spatial setting from the two spatial settings with
lowest index in the PUCCH resource with the lowest index for active UL BWP $b$
of each carrier $f$ and serving cell $c$
\- else, if the UE is provided a spatial setting by _PUCCH-
SpatialRelationInfo_ for a PUCCH resource with a lowest index for active UL
BWP $b$ of each carrier $f$ and serving cell $c$, as described in clause
9.2.2, the UE uses the same RS resource index $q_{d}$ as for a PUCCH
transmission in the PUCCH resource with the lowest index
\- If the PUSCH transmission is not scheduled by DCI format 0_0, and if the UE
is provided _enableDefaultBeamPL-ForSRS_ and is not provided _PUSCH-
PathlossReferenceRS_ and _PUSCH-PathlossReferenceRS-r16,_ the UE uses the same
RS resource index $q_{d}$ as for an SRS resource set with an SRS resource
associated with the PUSCH transmission
\- If
\- the UE is not provided _enableDefaultBeamPL-ForPUSCH0-0_ and the PUSCH
transmission is scheduled by DCI format 0_0 and the UE is not provided a
spatial setting for a PUCCH transmission, or
\- the PUSCH transmission is scheduled by DCI format 0_1 or DCI format 0_2
that does not include an SRI field, or
\- _SRI-PUSCH-PowerControl_ is not provided to the UE,
the UE determines a RS resource index $q_{d}$ with a respective _PUSCH-
PathlossReferenceRS-Id_ value being equal to zero where the RS resource is
either on serving cell $c$ or, if provided, on a serving cell indicated by a
value of _pathlossReferenceLinking_
\- If
\- the PUSCH transmission is scheduled by DCI format 0_0 on serving cell $c$,
\- the UE is not provided PUCCH resources for the active UL BWP of serving
cell $c$, and
\- the UE is provided _enableDefaultBeamPL-ForPUSCH0-0_
the UE determines a RS resource index $q_{d}$ providing a periodic RS resource
configured with _qcl-Type_ set to \'typeD\' in the TCI state or the QCL
assumption of a CORESET with the lowest index in the active DL BWP of the
serving cell $c$. If the CORESET has two activated TCI states, as described in
clause 10.1, the UE determines the RS resource index $q_{d}$ based on the
first TCI state.
\- If
\- the PUSCH transmission is scheduled by DCI format 0_0 on serving cell $c$,
\- the UE is not provided a spatial setting for PUCCH resources on the active
UL BWP of the primary cell [11, TS 38.321], and
\- the UE is provided _enableDefaultBeamPL-ForPUSCH0-0_
the UE determines a RS resource index $q_{d}$ providing a periodic RS resource
configured with _qcl-Type_ set to \'typeD\' in the TCI state or the QCL
assumption of a CORESET with the lowest index in the active DL BWP of the
serving cell $c$. If the CORESET has two activated TCI states, as described in
clause 10.1, the UE determines the RS resource index $q_{d}$ based on the
first TCI state.
\- For a PUSCH transmission configured by _ConfiguredGrantConfig,_ if _rrc-
ConfiguredUplinkGrant_ is included in _ConfiguredGrantConfig_ , a RS resource
index $q_{d}$ is provided by a value of _pathlossReferenceIndex_ included in
_rrc-ConfiguredUplinkGrant_ where the RS resource is either on serving cell
$c$ or, if provided, on a serving cell indicated by a value of
_pathlossReferenceLinking_. If the UE is provided _two SRS resource sets in
srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with usage
set to \'codebook\' or \'nonCodebook\'_ and for configured grant Type 1 PUSCH,
first and second RS resource indexes $q_{d}$ _that are respectively associated
with the firs_ t and second _srs-ResourceIndicator_ in _rrc-
ConfiguredUplinkGrant_ are provided by respective values of
_pathlossReferenceIndex_ and _pathlossReferenceIndex2_ in _rrc-
ConfiguredUplinkGrant_.
\- For a PUSCH transmission configured by _ConfiguredGrantConfig that does not
include_ _rrc-ConfiguredUplinkGrant_ , the UE determines a RS resource index
$q_{d}$ from a value of _PUSCH-PathlossReferenceRS-Id_ that is mapped to a SRI
field value in a DCI format activating the PUSCH transmission.
\- If the UE is provided _two SRS resource sets in srs-ResourceSetToAddModList
or srs-ResourceSetToAddModListDCI-0-2 with usage set to \'codebook\'_ and the
DCI format activating the PUSCH transmission includes two SRI fields, the UE
determines first and second RS resource indexes $q_{d}$ from respective first
and second values of _PUSCH-PathlossReferenceRS-Id_ that are mapped to the
first and second SRI values corresponding to each SRS resource set with _usage
set to \'codebook\', respectively_.
\- If the UE is provided _two SRS resource sets in srs-ResourceSetToAddModList
or srs-ResourceSetToAddModListDCI-0-2 with usage set to \'nonCodebook\'_ and
the DCI format activating the PUSCH transmission includes two SRI fields, the
UE determines first and second RS resource indexes $q_{d}$ from respective
first and second values of _PUSCH-PathlossReferenceRS-Id_ that are mapped to
the first SRI value corresponding to the first SRS resource set with _usage
set to \'nonCodebook\', and the value, associated with the second SRI field
value_ corresponding to Tables 7.3.1.1.2-28/29/30/31 of [5, TS 38.212] _for a
same number of layers as indicated by the first SRI field value, corresponding
to the second SRS resource set_ with _usage set to \'nonCodebook\'_.
\- If the UE is provided _two SRS resource sets in srs-ResourceSetToAddModList
or srs-ResourceSetToAddModListDCI-0-2 with usage set to \'codebook\' or
\'nonCodebook\'_ and the DCI format activating the PUSCH transmission does not
include an SRI field, the UE determines first and second RS resource indexes
$q_{d}$ _respectively_ associated with the first and second SRS resource set
with respective first and second _PUSCH-PathlossReferenceRS-Id_ value being
equal to zero and one.
\- If the DCI format activating the PUSCH transmission does not include an SRI
field, the UE determines a RS resource index $q_{d}$ with a respective _PUSCH-
PathlossReferenceRS-Id_ value being equal to zero
> where the RS resources are either on serving cell $c$ or, if provided, on a
> serving cell indicated by a value of _pathlossReferenceLinking_
**_\- If the UE is provided enablePL-RS-UpdateForPUSCH-SRS,_** a mapping
between _sri-PUSCH-PowerControlId_ and _PUSCH-PathlossReferenceRS-Id_ values
can be updated by a MAC CE as described in [11, TS 38.321]
\- For a PUSCH transmission scheduled by a DCI format that does not include an
SRI field, or for a PUSCH transmission configured by _ConfiguredGrantConfig
and activated, as described in clause 10.2,_ by a DCI format that does not
include an SRI field, the UE determines a RS resource index $q_{d}$ from the
_PUSCH-PathlossReferenceRS-Id_ mapped to _sri-PUSCH-PowerControlId_ = 0. If
the UE is provided _two SRS resource sets in srs-ResourceSetToAddModList or
srs-ResourceSetToAddModListDCI-0-2 with usage set to \'codebook\' or
\'nonCodebook\'_ , the UE determines first and second RS resource indexes
$q_{d}$ from respective _PUSCH-PathlossReferenceRS-Id_ mapped to _sri-PUSCH-
PowerControlId_ = 0 of _sri-PUSCH-MappingToAddModList_ and _sri-PUSCH-
PowerControlId_ = 0 of _sri-PUSCH-MappingToAddModList2, respectively_.
**_\- If the UE is not provided enablePL-RS-UpdateForPUSCH-SRS_**
\- For a PUSCH transmission scheduled by a DCI format that does not include an
SRI field, if the UE is provided two SRS resource sets _in srs-
ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with usage set
to \'codebook\' or \'nonCodebook\'_ , the UE determines first and second RS
resource indexes $q_{d}$ _respectively_ associated with the first and second
SRS resource set with respective first and second _PUSCH-PathlossReferenceRS-
Id_ values being equal to 0 and 1.
$\text{PL}_{b,f,c}(q_{d})$ = _referenceSignalPower_ \-- higher layer filtered
RSRP, where _referenceSignalPower_ is provided by higher layers and RSRP is
defined in [7, TS 38.215] for the reference serving cell and the higher layer
filter configuration provided by _QuantityConfig_ is defined in [12, TS
38.331] for the reference serving cell
If the UE is not configured periodic CSI-RS reception, _referenceSignalPower_
is provided by _ss-PBCH-BlockPower_. If the UE is configured periodic CSI-RS
reception, _referenceSignalPower_ is provided either by _ss-PBCH-BlockPower_
or by _powerControlOffsetSS_ providing an offset of the CSI-RS transmission
power relative to the SS/PBCH block transmission power [6, TS 38.214]. If
_powerControlOffsetSS_ is not provided to the UE, the UE assumes an offset of
0 dB.
\- $\mathrm{\Delta}_{\text{TF},b,f,c}\left( i \right) = 10\log_{10}\left(
\left( 2^{\text{BPRE} \cdot K_{s}} - 1 \right) \cdot
\beta_{\text{offset}}^{\text{PUSCH}} \right)$ for $K_{s} = 1.25$ and
$\mathrm{\Delta}_{\text{TF},b,f,c}\left( i \right) = 0$ for $K_{s} = 0$ where
$K_{s}$ is provided by _deltaMCS_ for each UL BWP $b$ of each carrier $f$
_and_ serving cell $c$. If the PUSCH transmission is over more than one layer
[6, TS 38.214], $\mathrm{\Delta}_{\text{TF},b,f,c}\left( i \right) = 0$.
$\text{BPRE}$ and $\beta_{\text{offset}}^{\text{PUSCH}}$, for active UL BWP
$b$ of each carrier $f$ _and_ each serving cell $c$, are computed as below
\- $BPRE = \sum_{r = 0}^{C - 1}\frac{K_{r}}{N_{\text{RE}}}$ for PUSCH with UL-
SCH data and $BPRE = \frac{Q_{m} \cdot
R}{\beta_{\text{offset}}^{\text{PUSCH}}}$ for CSI transmission in a PUSCH
without UL-SCH data, where
\- $C$ is a number of transmitted code blocks, $K_{r}$ is a size for code
block $r$, and $N_{\text{RE}}$ is a number of resource elements determined as
$N_{\text{RE}} = N \cdot M_{\text{RB},b,f,c}^{\text{PUSCH}}(i) \cdot \sum_{j =
0}^{N_{symb,b,f,c}^{\text{PUSCH}}\left( i \right) -
1}{N_{sc,data}^{\text{RB}}(i,j)}$, where $N \geq 1$ is provided by
_numberOfSlotsTBoMS_ as described in [6, TS 38.214] and $N = 1$ if
_numberOfSlotsTBoMS_ is not provided, $N_{symb,b,f,c}^{\text{PUSCH}}\left( i
\right)$ is a number of symbols for PUSCH transmission occasion $i$ on active
UL BWP $b$ of carrier $f$ _of_ serving cell $c$,
$N_{sc,data}^{\text{RB}}(i,j)$ is a number of subcarriers excluding DM-RS
subcarriers and phase-tracking RS samples [4, TS 38.211] in PUSCH symbol $j$
and assuming no segmentation for a nominal repetition in case the PUSCH
transmission is with repetition Type B, $0 \leq j  \- the UE determines $l = 0$ _for the PUSCH transmission corresponding to
> the first SRS resource set with_ usage _set to \'codebook\' or
> \'nonCodebook\', and_ $l = 1$ _for the PUSCH transmission corresponding to
> the second SRS resource set with_ usage _set to \'codebook\' or
> \'nonCodebook\'_
\- else
> \- the UE determines $l = 0$ _for the PUSCH transmission_
\- If the UE is provided _two SRS resource sets in srs-ResourceSetToAddModList
or srs-ResourceSetToAddModListDCI-0-2 with usage set to \'codebook\' or
\'nonCodebook\',_ and is provided _twoPUSCH-PC-AdjustmentStates_
\- If the DCI format includes two TPC command values and the PUSCH
transmissions are associated with $l = 0$ and $l = 1$, the UE applies the
first TPC command value for $l = 0$ and applies the second TPC command value
for $l = 1$
\- If the DCI format includes two TPC command values and the PUSCH
transmissions are associated with $l = 0$, the UE applies the first TPC
command value for $l = 0$ and ignores the second TPC command value
\- If the DCI format includes two TPC command values and the PUSCH
transmissions are associated with $l = 1$, the UE applies the second TPC
command value for $l = 1$ and ignores the first TPC command value
\- If the DCI format includes one TPC command value, the UE applies the TPC
command value for all $l$ associated with the PUSCH transmission
\- If the UE is provided _SRI-PUSCH-PowerControl_ , the UE obtains a mapping
between a set of values for the SRI field in a DCI format scheduling the PUSCH
transmission and the $l$ value(s) provided by _sri-PUSCH-ClosedLoopIndex_ and
determines the $l$ value that is mapped to the SRI field value
\- If the PUSCH transmission is scheduled by a DCI format that does not
include an SRI field, or if an _SRI-PUSCH-PowerControl_ is not provided to the
UE, $l = 0$
\- If the UE obtains one TPC command from a DCI format 2_2 with CRC scrambled
by a TPC-PUSCH-RNTI, the $l$ value is provided by the closed loop indicator
field in DCI format 2_2
\- $f_{b,f,c}\left( i,l \right) = f_{b,f,c}\left( i - i_{0},l \right) +
\sum_{m = 0}^{\text{C}\left( D_{i} \right) -
1}{\delta_{\text{PUSCH},b,f,c}(m,l)}$ is the PUSCH power control adjustment
state $l$ for active UL BWP $b$ of carrier $f$ _of_ serving cell $c$ and PUSCH
transmission occasion $i$ if the UE is not provided _tpc-Accumulation_ , where
\- The $\delta_{\text{PUSCH},b,f,c}$ values are given in Table 7.1.1-1
\- $\sum_{m = 0}^{\text{C}\left( D_{i} \right) -
1}{\delta_{\text{PUSCH},b,f,c}(m,l)}$ is a sum of TPC command values in a set
$D_{i}$ of TPC command values with cardinality $\text{C}\left( D_{i} \right)$
that the UE receives between $K_{\text{PUSCH}}\left( i - i_{0} \right) - 1$
symbols before PUSCH transmission occasion $i - i_{0}$ and
$K_{\text{PUSCH}}(i)$ symbols before PUSCH transmission occasion $i$ on active
UL BWP $b$ of carrier $f$ _of_ serving cell $c$ for PUSCH power control
adjustment state $l$, where $i_{0} > 0$ is the smallest integer for which
$K_{\text{PUSCH}}(i - i_{0})$ symbols before PUSCH transmission occasion $i -
i_{0}$ is earlier than $K_{\text{PUSCH}}(i)$ symbols before PUSCH transmission
occasion $i$
\- If a PUSCH transmission is scheduled by a DCI format, $K_{\text{PUSCH}}(i)$
is a number of symbols for active UL BWP $b$ of carrier $f$ _of_ serving cell
$c$ after a last symbol of a corresponding PDCCH reception and before a first
symbol of the PUSCH transmission
\- If a PUSCH transmission is configured by _ConfiguredGrantConfig_ ,
$K_{\text{PUSCH}}(i)$ is a number of $K_{PUSCH,min}$ symbols equal to the
product of a number of symbols per slot, $N_{\text{symb}}^{\text{slot}}$, and
the minimum of the values provided by _k2_ in _PUSCH-ConfigCommon_ for active
UL BWP $b$ of carrier $f$ _of_ serving cell $c$
\- If the first symbol of the PUSCH transmission occasion occurs within
$T_{proc,2}$ after a last symbol of a PDCCH reception where the UE detects the
DCI format providing the TPC command, the UE may postpone the application of
the TPC command until the above condition is not valid. $T_{proc,2}$ is the
PUSCH preparation time for the corresponding UE processing capability [6, TS
38.214] assuming $d_{2,1} = 0$_,_ and $\mu$ corresponds to the smallest SCS
configuration between the SCS configuration of the PDCCH carrying the DCI
format and the SCS configuration of the PUSCH.
\- If the UE has reached maximum power for active UL BWP $b$ of carrier $f$
_of_ serving cell $c$ at PUSCH transmission occasion $i - i_{0}$ and $\sum_{m
= 0}^{\text{C}\left( D_{i} \right) - 1}{\delta_{\text{PUSCH},b,f,c}(m,l) \geq
0}$, then $f_{b,f,c}\left( i,l \right) = f_{b,f,c}\left( i - i_{0},l \right)$
\- If UE has reached minimum power for active UL BWP $b$ of carrier $f$ _of_
serving cell $c$ at PUSCH transmission occasion $i - i_{0}$ and $\sum_{m =
0}^{\text{C}\left( D_{i} \right) - 1}{\delta_{\text{PUSCH},b,f,c}(m,l) \leq
0}$, then $f_{b,f,c}\left( i,l \right) = f_{b,f,c}\left( i - i_{0},l \right)$
\- A UE resets accumulation of a PUSCH power control adjustment state $l$ for
active UL BWP $b$ of carrier $f$ _of_ serving cell $c$ to $f_{b,f,c}\left( k,l
\right) = 0,\ \ k = 0,1,\ldots,i$
\- If a configuration for a corresponding $P_{O_ UE_ PUSCH,b,f,c}\left( j
\right)$ value is provided by higher layers
\- If a configuration for a corresponding $\alpha_{b,f,c}\left( j \right)$
value is provided by higher layers
where $l$ _is determined from_ the value of $j$ as
\- If $j > 1$ and the UE is provided higher _SRI-PUSCH-PowerControl_ , $l$ is
the _sri-PUSCH-ClosedLoopIndex_ value(s) configured in any _SRI-PUSCH-
PowerControl_ with the _sri-P0-PUSCH-AlphaSetId_ value corresponding to $j$
\- If $j > 1$ and the UE is not provided _SRI-PUSCH-PowerControl_ or $j = 0$,
$l = 1$ if $P_{O_ UE_ PUSCH,b,f,c}\left( j \right)$ and $\
\alpha_{b,f,c}\left( j \right)\ $ are provided by the second $P0 - PUSCH -
AlphaSet\text{\ in\ }p0 - AlphaSets$; otherwise, $l = 0$
\- If $j = 1$,
> \- $l$ is provided by the value of _powerControlLoopToUse_ if $P_{O_ UE_
> PUSCH,b,f,c}\left( 1 \right)$ and $\alpha_{b,f,c}\left( 1 \right)$ are
> provided by _p0-PUSCH-Alpha in ConfiguredGrantConfig_
>
> \- $l$ is provided by the value of _powerControlLoopToUse2_ if $P_{O_ UE_
> PUSCH,b,f,c}\left( 1 \right)$ and $\alpha_{b,f,c}\left( 1 \right)$ are
> provided by _p0-PUSCH-Alpha2 in ConfiguredGrantConfig_
\- $f_{b,f,c}\left( i,l \right) = \delta_{\text{PUSCH},b,f,c}\left( i,l
\right)$ is the PUSCH power control adjustment state for active UL BWP $b$ of
carrier $f$ _of_ serving cell $c$ and PUSCH transmission occasion if the UE is
provided _tpc-Accumulation_ , where
\- $\delta_{\text{PUSCH},b,f,c}$ absolute values are given in Table 7.1.1-1
> If the UE transmits a PUSCH associated with the first RS resource index
> $q_{d}$, the UE applies _the first_
> $P_{\text{O_UE_P}\text{USCH},b,f,c}\left( j \right)$ value, the first
> $\alpha_{b,f,c}\left( j \right)$ value, and $f_{b,f,c}\left( i,l \right)$
> for determining $P_{\text{PUSCH},b,f,c}(i,j,q_{d},l)$. If the UE transmits a
> PUSCH associated with the second RS resource index $q_{d}$, the UE applies
> _the second_ $P_{\text{O_UE_P}\text{USCH},b,f,c}\left( j \right)$ value, the
> second $\alpha_{b,f,c}\left( j \right)$ value, and $f_{b,f,c}\left( i,l
> \right)$ or $f_{b,f,c}\left( i,0 \right)$ if  _twoPUSCH-PC-AdjustmentStates_
> is provided or not provided, respectively, for determining
> $P_{\text{PUSCH},b,f,c}(i,j,q_{d},l)$.
\- If the UE receives a random access response message in response to a PRACH
transmission or a MsgA transmission on active UL BWP $b$ of carrier $f$ _of_
serving cell $c$ as described in clause 8
\- $f_{b,f,c}\left( 0,l \right) = {\mathrm{\Delta}P_{\text{rampup},b,f,c} +
\delta}_{msg2,b,f,c}$, where $l = 0$ and
\- $\delta_{msg2,b,f,c}$ is a TPC command value indicated in a random access
response grant of the random access response message corresponding to a PRACH
transmission according to Type-1 random access procedure, or in a random
access response grant of the random access response message corresponding to a
MsgA transmission according to Type-2 random access procedure with RAR
message(s) for fallbackRAR, on active UL BWP $b$ of carrier $f$ _of_ serving
cell $c$, and
\- and $\mathrm{\Delta}P_{rampup_ requested,b,f,c}$ is provided by higher
layers and corresponds to the total power ramp-up requested by higher layers
from the first to the last random access preamble for carrier $f$ in the
serving cell $c$, $M_{\text{RB},b,f,c}^{\text{PUSCH}}(0)$ is the bandwidth of
the PUSCH resource assignment expressed in number of resource blocks for the
first PUSCH transmission on active UL BWP$\ b$ of carrier $f$ _of_ serving
cell $c$, and $\mathrm{\Delta}_{\text{TF},b,f,c}\left( 0 \right)$ is the power
adjustment of first PUSCH transmission on active UL BWP $b$ of carrier $f$
_of_ serving cell $c$.
\- If the UE transmits the PUSCH in PUSCH transmission occasion $i$ on active
UL BWP $b$ of carrier $f$ _of_ serving cell $c$ as described in clause 8.1A,
$f_{b,f,c}(0,l) = \Delta P_{rampup,b,f,c}$, where
\- $l = 0$, and
\- and $\Delta P_{\text{rampup}_ requested,b,f,c}$ is provided by higher
layers and corresponds to the total power ramp-up requested by higher layers,
$M_{\text{RB,}b,f,c}^{\text{PUSCH}}(i)$ is the bandwidth of the PUSCH resource
assignment expressed in number of resource blocks, and
$\Delta_{\text{TF},b,f,c}(i)$ is the power adjustment of the PUSCH
transmission in PUSCH transmission occasion $i$.
Table 7.1.1-1: Mapping of TPC Command Field in a DCI format scheduling a PUSCH
transmission _, or in DCI format_ 2_2 with CRC scrambled by TPC-PUSCH-RNTI, or
in DCI format 2_3, to absolute and accumulated
$\mathbf{\delta}_{\mathbf{\text{PUSCH}}\mathbf{,b}\mathbf{,}\mathbf{f}\mathbf{,}\mathbf{c}}$
values or
$\mathbf{\delta}_{\mathbf{\text{SRS}}\mathbf{,b}\mathbf{,}\mathbf{f}\mathbf{,}\mathbf{c}}$
values
TPC Command Field Accumulated
$\mathbf{\delta}_{\mathbf{\text{PUSCH}}\mathbf{,b}\mathbf{,}\mathbf{f}\mathbf{,}\mathbf{c}}$
or
$\mathbf{\delta}_{\mathbf{\text{SRS}}\mathbf{,b}\mathbf{,}\mathbf{f}\mathbf{,}\mathbf{c}}$
[dB] Absolute
$\mathbf{\delta}_{\mathbf{\text{PUSCH}}\mathbf{,b}\mathbf{,}\mathbf{f}\mathbf{,}\mathbf{c}}$
or
$\mathbf{\delta}_{\mathbf{\text{SRS}}\mathbf{,b}\mathbf{,}\mathbf{f}\mathbf{,}\mathbf{c}}$
[dB]
* * *
0 -1 -4 1 0 -1 2 1 1 3 3 4
## 7.2 Physical uplink control channel
If the UE is configured with a SCG, the UE shall apply the procedures
described in this clause for both MCG and SCG.
\- When the procedures are applied for MCG, the term \'serving cell\' in this
clause refers to serving cell belonging to the MCG.
\- When the procedures are applied for SCG, the term \'serving cell\' in this
clause refers to serving cell belonging to the SCG. The term \'primary cell\'
in this clause refers to the PSCell of the SCG.
If the UE is configured with a PUCCH-SCell, the UE shall apply the procedures
described in this clause for both primary PUCCH group and secondary PUCCH
group.
\- When the procedures are applied for the primary PUCCH group, the term
\'serving cell\' in this clause refers to serving cell belonging to the
primary PUCCH group.
\- When the procedures are applied for the secondary PUCCH group, the term
\'serving cell\' in this clause refers to serving cell belonging to the
secondary PUCCH group. The term \'primary cell\' in this clause refers to the
PUCCH-SCell of the secondary PUCCH group. If _pdsch-HARQ-ACK-Codebook-
secondaryPUCCHgroup-r16_ is provided, _pdsch-HARQ-ACK-Codebook_ is replaced by
_pdsch-HARQ-ACK-Codebook-secondaryPUCCHgroup-r16_.
For unpaired spectrum operation, if the UE is provided a PUCCH-sSCell by
_pucch-sSCell_ as described in clause 9.A, the UE shall apply the procedures
described in this clause for both the primary cell and the PUCCH-sSCell.
### 7.2.1 UE behaviour
If a UE transmits a PUCCH on active UL BWP $b$ of carrier $f$ in the primary
cell $c$ _using_ PUCCH power control adjustment state with index $l$, the UE
determines the PUCCH transmission power
$P_{\text{PUCCH},b,f,c}(i,q_{u},q_{d},l)$ in PUCCH transmission occasion $i$
as
[dBm]
where
\- $P_{\text{C}\text{MAX},f,c}(i)$ is the UE configured maximum output power
defined in [8-1, TS 38.101-1], [8-2, TS 38.101-2] and [8-3, TS 38.101-3] for
carrier $f$ _of_ primary cell $c$ in PUCCH transmission occasion $i$
\- $P_{\text{O_P}\text{U}\text{C}\text{CH},b,f,c}(q_{u})$ is a parameter
composed of the sum of a component
$P_{\text{O_NOMINAL,P}\text{U}\text{C}\text{CH}}$, provided by _p0-nominal_ ,
or $P_{\text{O_NOMINAL,P}\text{U}\text{C}\text{CH}} = 0$ dBm if _p0-nominal_
is not provided, for carrier $f$ of primary cell $c$ and, if provided, a
component $P_{\text{O_UE_P}\text{U}\text{C}\text{CH}}(q_{u})$ provided by
_p0-PUCCH-Value_ in _P0-PUCCH_ for active UL BWP $b$ of carrier $f$ of primary
cell $c$, where $0 \leq q_{u}  1$
repetitions, as described in clause 9.2.6, and the UE is provided _twoPUCCH-
PC-AdjustmentStates_ by _pucch-PowerControl_
\- If the DCI format includes two TPC command values and the PUCCH resource of
the PUCCH transmission is associated with $l = 0$ and $l = 1$, the UE applies
the first TPC command value for $l = 0$ and applies the second TPC command
value for $l = 1$
\- If the DCI format includes two TPC command values and the PUCCH resource of
the PUCCH transmission is associated with $l = 0$, the UE applies the first
TPC command value for $l = 0$ and ignores the second TPC command value
\- If the DCI format includes two TPC command values and the PUCCH resource of
the PUCCH transmission is associated with $l = 1$, the UE applies the second
TPC command value for $l = 1$ and ignores the first TPC command value
\- If the DCI format includes one TPC command value, the UE applies the TPC
command value for all $l$ associated with the PUCCH resource of the PUCCH
transmission
\- $g_{b,f,c}\left( i,l \right) = g_{b,f,c}\left( i - i_{0},l \right) +
\sum_{m = 0}^{\text{C}\left( C_{i} \right) -
1}{\delta_{\text{PUCCH},b,f,c}(m,l)}$ is the current PUCCH power control
adjustment state $l$ for active UL BWP $b$ of carrier $f$ _of_ primary cell
$c$ and PUCCH transmission occasion $i$, where
\- The $\delta_{\text{PUCCH},b,f,c}$ values are given in Table 7.1.2-1
\- $\sum_{m = 0}^{\text{C}\left( C_{i} \right) -
1}{\delta_{\text{PUCCH},b,f,c}(m,l)}$ is a sum of TPC command values in a set
$C_{i}$ of TPC command values with cardinality $\text{C}\left( C_{i} \right)$
that the UE receives between $K_{\text{PUCCH}}\left( i - i_{0} \right) - 1$
symbols before PUCCH transmission occasion $i - i_{0}$ and
{width="0.6145833333333334in" height="0.19791666666666666in"} symbols before
PUCCH transmission occasion $i$ on active UL BWP $b$ of carrier $f$ _of_
primary cell $c$ for PUCCH power control adjustment state, where $i_{0} > 0$
is the smallest integer for which $K_{\text{PUCCH}}\left( i - i_{0} \right)$
symbols before PUCCH transmission occasion $i - i_{0}$ is earlier than
$K_{\text{PUCCH}}\left( i \right)$ symbols before PUCCH transmission occasion
$i$
\- If the PUCCH transmission is in response to a detection by the UE of a DCI
format, $K_{\text{PUCCH}}\left( i \right)$ is a number of symbols for active
UL BWP $b$ of carrier $f$ _of_ primary cell $c$ after a last symbol of a
corresponding PDCCH reception and before a first symbol of the PUCCH
transmission
\- If the PUCCH transmission is not in response to a detection by the UE of a
DCI format, $K_{\text{PUCCH}}\left( i \right)$ is a number of $K_{PUCCH,min}$
symbols equal to the product of a number of symbols per slot,
$N_{\text{symb}}^{\text{slot}}$, and the minimum of the values provided by
_k2_ in _PUSCH-ConfigCommon_ for active UL BWP $b$ of carrier $f$ _of_ primary
cell $c$
> \- If the first symbol of the PUCCH transmission occasion occurs within
> $T_{proc,2}$ after a last symbol of a PDCCH reception where the UE detects
> the DCI format providing the TPC command, the UE may postpone the
> application of the TPC command until the above condition is not valid.
> $T_{proc,2}$ is the PUSCH preparation time for the corresponding UE
> processing capability [6, TS 38.214] assuming $d_{2,1} = 0$_,_ and $\mu$
> corresponds to the smallest SCS configuration between the SCS configuration
> of the PDCCH carrying the DCI format and the SCS configuration of the PUCCH.
\- If the UE has reached maximum power for active UL BWP $b$ of carrier $f$
_of_ primary cell $c$ at PUCCH transmission occasion $i - i_{0}$ and $\sum_{m
= 0}^{\text{C}\left( C_{i} \right) - 1}{\delta_{\text{PUCCH},b,f,c}(m,l)} \geq
0$, then $g_{b,f,c}\left( i,l \right) = g_{b,f,c}\left( i - i_{0},l \right)$
\- If UE has reached minimum power for active UL BWP $b$ of carrier $f$ _of_
primary cell $c$ at PUCCH transmission occasion $i - i_{0}$ and $\sum_{m =
0}^{\text{C}\left( C_{i} \right) - 1}{\delta_{\text{PUCCH},b,f,c}(m,l)} \leq
0$, then $g_{b,f,c}\left( i,l \right) = g_{b,f,c}\left( i - i_{0},l \right)$
\- If a configuration of a
$P_{\text{O_P}\text{U}\text{C}\text{CH},b,f,c}\left( q_{u} \right)$ value for
a corresponding PUCCH power control adjustment state $l$ for active UL BWP $b$
of carrier $f$ _of_ primary cell $c$ is provided by higher layers,
\- $g_{b,f,c}\left( k,l \right) = 0,\ \ k = 0,1,\ldots,i$
\- if the UE is provided _PUCCH-SpatialRelationInfo_ , the UE determines the
value of $l$ from the value of $q_{u}$ based on a _pucch-
SpatialRelationInfoId_ value associated with the _p0-PUCCH-Id_ value
corresponding to $q_{u}$ and with the _closedLoopIndex_ value corresponding to
$l$;
\- else, if the UE is provided more than one sets of power control parameters
for operation in FR1, and if the UE receives an activation command for a PUCCH
resource that indicates one or two sets of the more than one sets of power
control parameters, the UE determines the value of $l$ based on the
_closedLoopIndex_ value in the one or two sets of power control parameters;
\- else, $l = 0$
\- Else,
\- $g_{b,f,c}\left( 0,l \right) = {\mathrm{\Delta}P_{\text{rampup},b,f,c} +
\delta}_{b,f,c}$, where $l = 0$, and $\delta_{b,f,c}$ is
\- the TPC command value indicated in a random access response grant
corresponding to a PRACH transmission according to Type-1 random access
procedure, or in a random access response grant corresponding to MsgA
transmissions according to Type-2 random access procedure with RAR message(s)
for fallbackRAR, or
\- the TPC command value indicated in a successRAR corresponding to MsgA
transmissions for Type-2 random access procedure, or
\- the TPC command value in a DCI format _with CRC scrambled by C-RNTI or MCS-
C-RNTI_ that the UE detects in a first PDCCH reception in a _search space set
provided by recoverySearchSpaceId if_ the PUCCH transmission is a first PUCCH
transmission after 28 symbols _from a last symbol of the first PDCCH
reception_ ,
> and, if the UE transmits PUCCH on active UL BWP $b$ of carrier $f$ _of_
> primary cell $c$,
$\mathrm{\Delta}P_{\text{rampup},b,f,c} = min\left\lbrack \max\left(
0,P_{\text{CMAX},f,c} - \left( P_{\text{O_P}\text{UCCH},b,f,c} +
\text{PL}_{b,f,c}(q_{d}) + \mathrm{\Delta}_{F_ PUCCH} +
\mathrm{\Delta}_{TF,b,f,c} + \delta_{b,f,c} \right)
\right),\mathrm{\Delta}P_{rampup_ requested,b,f,c} \right\rbrack$;
otherwise,
$\mathrm{\Delta}P_{\text{rampup},b,f,c} = min\left\lbrack \max\left(
0,P_{\text{CMAX},f,c} - \left( P_{\text{O_P}\text{UCCH},b,f,c} +
\text{PL}_{b,f,c}(q_{d}) \right) \right),\mathrm{\Delta}P_{rampup_
requested,b,f,c} \right\rbrack$ where $\mathrm{\Delta}P_{rampup_
requested,b,f,c}$ is provided by higher layers and corresponds to the total
power ramp-up requested by higher layers from the first to the last preamble
for active UL BWP $b$ of carrier $f$ of primary cell $c$, and
$\mathrm{\Delta}_{F_ PUCCH}$ corresponds to PUCCH format 0 or PUCCH format 1
Table 7.2.1-1: Mapping of TPC Command Field in a DCI format to accumulated
$\mathbf{\delta}_{\mathbf{\text{PUCCH}}\mathbf{,b}\mathbf{,}\mathbf{f}\mathbf{,}\mathbf{c}}$
values
TPC Command Field Accumulated
$\mathbf{\delta}_{\mathbf{\text{PUCCH}}\mathbf{,b}\mathbf{,}\mathbf{f}\mathbf{,}\mathbf{c}}$
[dB]
* * *
0 -1 1 0 2 1 3 3
## 7.3 Sounding reference signals
For SRS, a UE splits a linear value
${\widehat{P}}_{\text{SRS},b,f,c}(i,q_{s},l)$ of the transmit power
$P_{\text{SRS},b,f,c}(i,q_{s},l)$ on active UL BWP $b$ of carrier $f$ of
serving cell $c$ equally across the configured antenna ports for SRS.
### 7.3.1 UE behaviour
If a UE transmits SRS based on a configuration by _SRS-ResourceSet_ on active
UL BWP $b$ of carrier $f$ _of_ serving cell $c$ _using_ SRS power control
adjustment state with index $l$, the UE determines the SRS transmission power
$P_{\text{SRS},b,f,c}(i,q_{s},l)$ in SRS transmission occasion $i$ as
[dBm]
where,
\- $P_{\text{CMAX},f,c}(i)$ is the UE configured maximum output power defined
in [8, TS 38.101-1], [8-2, TS 38.101-2] and [TS 38.101-3] for carrier $f$ _of_
serving cell $c$ in SRS transmission occasion $i$
> \- $P_{\text{O_}\text{SRS},b,f,c}(q_{s})$ is provided by _p0_ for active UL
> BWP $b$ of carrier $f$ _of_ serving cell $c$ _and_ SRS resource set $q_{s}$
> provided by _SRS-ResourceSet_ and _SRS-ResourceSetId_
\- $M_{\text{SRS},b,f,c}(i)$ is a SRS bandwidth expressed in number of
resource blocks for SRS transmission occasion $i$ on active UL BWP $b$ of
carrier $f$ _of_ serving cell $c$ and $\mu$ is a SCS configuration defined in
[4, TS 38.211]
\- $\alpha_{\text{SRS},b,f,c}(q_{s})$ is provided by _alpha_ for active UL BWP
$b$ of carrier $f$ _of_ serving cell $c$ _and_ SRS resource set $q_{s}$
\- $\text{PL}_{b,f,c}(q_{d})$ is a downlink pathloss estimate in dB calculated
by the UE using RS resource index $q_{d}$ as described in clause 7.1.1 for the
active DL BWP _of_ serving cell $c$ and SRS resource set $q_{s}$ [6, TS
38.214]. The RS resource index $q_{d}$ is provided by _pathlossReferenceRS_
associated with the SRS resource set $q_{s}$ and is either an _ssb-Index_
providing a SS/PBCH block index or a _csi-RS-Index_ providing a CSI-RS
resource index. If the UE is provided **_enablePL-RS-UpdateForPUSCH-SRS_** , a
MAC CE [11, TS 38.321] can provide by _SRS-PathlossReferenceRS-Id_ a
corresponding RS resource index $q_{d}$ for aperiodic or semi-persistent SRS
resource set $q_{s}$
\- If the UE is not provided _pathlossReferenceRS_ or _SRS-
PathlossReferenceRS-Id_ , or before the UE is provided dedicated higher layer
parameters _, the UE calculates_ $\text{PL}_{b,f,c}(q_{d})$ using _a RS
resource obtained from an SS/PBCH block_ with same SS/PBCH block index as the
one _the UE uses to obtain MIB_
\- If the UE is provided _pathlossReferenceLinking_ , the RS resource is on a
serving cell indicated by a value of _pathlossReferenceLinking_
\- If the UE
\- is not provided _pathlossReferenceRS_ or _SRS-PathlossReferenceRS-Id_ ,
\- is not provided _spatialRelationInfo,_ and
\- is provided _enableDefaultBeamPL-ForSRS, and_
\- is not provided _coresetPoolIndex_ value of 1 for any CORESET, or is
provided _coresetPoolIndex_ value of 1 for all CORESETs, in
_ControlResourceSet_ and no codepoint of a TCI field, if any, in a DCI format
of any search space set maps to two TCI states [5, TS 38.212]
the UE determines a RS resource index $q_{d}$ providing a periodic RS resource
configured with _qcl-Type_ set to \'typeD\' in
\- the TCI state or the QCL assumption of a CORESET with the lowest index in
the active DL BWP, if CORESETs are provided in the active DL BWP of serving
cell $c$. If the CORESET has two activated TCI states, as described in clause
10.1, the UE determines the RS resource index $q_{d}$ based on the first TCI
state.
\- the active PDSCH TCI state with lowest ID [6, TS 38.214] in the active DL
BWP, if CORESETs are not provided in the active DL BWP of serving cell $c$
\- For the SRS power control adjustment state for active UL BWP $b$ of carrier
$f$ _of_ serving cell $c$ and SRS transmission occasion $i$
\- $h_{b,f,c}\left( i,l \right) = f_{b,f,c}\left( i,l \right)$, where
$f_{b,f,c}\left( i,l \right)$ is the current PUSCH power control adjustment
state as described in clause 7.1.1, if _srs-PowerControlAdjustmentStates_
indicates a same power control adjustment state for SRS transmissions and
PUSCH transmissions; or
\- {width="2.222916666666667in" height="0.3840277777777778in"} if the UE is
not configured for PUSCH transmissions on active UL BWP $b$ of carrier $f$
_of_ serving cell $c$_, or_ if _srs-PowerControlAdjustmentStates_ indicates
separate power control adjustment states between SRS transmissions and PUSCH
transmissions, and if _tpc-Accumulation_ is not provided, where
\- The $\delta_{\text{SRS},b,f,c}$ values are given in Table 7.1.1-1
\- $\delta_{\text{SRS},b,f,c}(m)$ is jointly coded with other TPC commands in
a PDCCH with DCI format 2_3, as described in clause 11.4
\- $\sum_{m = 0}^{\text{C}\left( S_{i} \right) -
1}{\delta_{\text{SRS},b,f,c}(m)}$ is a sum of TPC command values in a set
$S_{i}$ of TPC command values with cardinality $\text{C}\left( S_{i} \right)$
that the UE receives between $K_{\text{SRS}}\left( i - i_{0} \right) - 1$
symbols before SRS transmission occasion $i - i_{0}$ and $K_{\text{SRS}}(i)$
symbols before SRS transmission occasion $i$ on active UL BWP $b$ of carrier
$f$ _of_ serving cell $c$ for SRS power control adjustment state, where $i_{0}
> 0$ is the smallest integer for which $K_{\text{SRS}}(i)$ symbols before SRS
transmission occasion $i - i_{0}$ is earlier than $K_{\text{SRS}}(i - i_{0})$
symbols before SRS transmission occasion $i$
\- if the SRS transmission is aperiodic, $K_{\text{SRS}}(i)$ is a number of
symbols for active UL BWP $b$ of carrier $f$ _of_ serving cell $c$ after a
last symbol of a corresponding PDCCH triggering the SRS transmission and
before a first symbol of the SRS transmission
\- if the SRS transmission is semi-persistent or periodic, $K_{\text{SRS}}(i)$
is a number of $K_{SRS,min}$ symbols equal to the product of a number of
symbols per slot, $N_{\text{symb}}^{\text{slot}}$, and the minimum of the
values provided by _k2_ in _PUSCH-ConfigCommon_ for active UL BWP $b$ of
carrier $f$ _of_ serving cell $c$
\- If the first symbol of the SRS transmission occasion occurs within
$T_{proc,2}$ after a last symbol of a PDCCH reception where the UE detects the
DCI format providing the TPC command, the UE may postpone the application of
the TPC until the above condition is not valid. $T_{proc,2}$ is the PUSCH
preparation time for the corresponding UE processing capability [6, TS 38.214]
assuming $d_{2,1} = 0$_,_ and $\mu$ corresponds to the smallest SCS
configuration between the SCS configuration of the PDCCH carrying the DCI
format and the SCS configuration of the SRS.
\- If the UE has reached maximum power for active UL BWP $b$ of carrier $f$
_of_ serving cell $c$ at SRS transmission occasion $i - i_{0}$ and $\sum_{m =
0}^{\text{C}\left( S_{i} \right) - 1}{\delta_{\text{SRS},b,f,c}(m)} \geq 0$,
then $h_{b,f,c}\left( i \right) = h_{b,f,c}\left( i - i_{0} \right)$
\- If UE has reached minimum power for active UL BWP $b$ of carrier $f$ _of_
serving cell $c$ at SRS transmission occasion $i - i_{0}$ and $\sum_{m =
0}^{\text{C}\left( S_{i} \right) - 1}{\delta_{\text{SRS},b,f,c}(m)} \leq 0$,
then $h_{b,f,c}\left( i \right) = h_{b,f,c}\left( i - i_{0} \right)$
\- If a configuration for a $P_{O_ SRS,b,f,c}(q_{s})$ value or for a
$\alpha_{\text{SRS},b,f,c}(q_{s})$ value for a corresponding SRS power control
adjustment state $l$ for active UL BWP $b$ of carrier $f$ _of_ serving cell
$c$ is provided by higher layers
> \- $h_{b,f,c}\left( k \right) = 0,\ k = 0,1,\ldots,i$
>
> \- else
\- $h_{b,f,c}\left( 0 \right) = \ \Delta P_{\text{rampup},b,f,c} +
\delta_{b,f,c}$
where
$\delta_{b,f,c}$ is
\- the TPC command value indicated in the random access response grant
corresponding to a PRACH transmission according to Type-1 random access
procedure, or in a random access response grant corresponding to MsgA
transmissions according to Type-2 random access procedure with RAR message(s)
for fallbackRAR, or
\- the TPC command value indicated in a successRAR corresponding to MsgA
transmissions for Type-2 random access procedure,
and
$\mathrm{\Delta}P_{rampup,b,f,c} = min\left\lbrack \max\left( 0,P_{CMAX,f,c} -
\left( P_{\text{O_SRS},b,f,c}\left( q_{s} \right) + 10\log_{10}\left( 2^{\mu}
\cdot M_{\text{SRS},b,f,c}\left( i \right) \right) +
\alpha_{\text{SRS},b,f,c}\left( q_{s} \right) \cdot \text{PL}_{b,f,c}(q_{d})
\right) \right),\mathrm{\Delta}P_{rampup_ requested,b,f,c} \right\rbrack$;
> where ${\mathrm{\Delta}P}_{rampup_ requested,b,f,c}$ is provided by higher
> layers and corresponds to the total power ramp-up requested by higher layers
> from the first to the last preamble for active UL BWP $b$ of carrier $f$ of
> serving cell $c$.
\- $h_{b,f,c}(i) = \delta_{\text{SRS},b,f,c}(i)$ if the UE is not configured
for PUSCH transmissions on active UL BWP $b$ of carrier $f$ _of_ serving cell
$c$_, or_ if _srs-PowerControlAdjustmentStates_ indicates separate power
control adjustment states between SRS transmissions and PUSCH transmissions,
and _tpc-Accumulation_ is provided, and the UE detects a DCI format 2_3
$K_{SRS,min}$ symbols before a first symbol of SRS transmission occasion $i$,
where absolute values of $\delta_{\text{SRS},b,f,c}$ are provided in Table
7.1.1-1
\- if _srs-PowerControlAdjustmentStates_ indicates a same power control
adjustment state for SRS transmissions and PUSCH transmissions, the update of
the power control adjustment state for SRS transmission occasion $i$ occurs at
the beginning of each SRS resource in the SRS resource set $q_{s}$; otherwise,
the update of the power control adjustment state SRS transmission occasion $i$
occurs at the beginning of the first transmitted SRS resource in the SRS
resource set $q_{s}$.
If a UE transmits SRS based on a configuration by _SRS-PosResourceSet_ on
active UL BWP $b$ of carrier $f$ _of_ serving cell $c$, the UE determines the
SRS transmission power $P_{SRS,b,f,c}\left( i,q_{s} \right)$ in SRS
transmission occasion $i$ as
[dBm]
where,
> \- $P_{O_ SRS,b,f,c}\left( q_{s} \right)$ and
> $\alpha_{\text{SRS},b,f,c}\left( q_{s} \right)$ are provided by _p0-r16_ and
> _alpha-r16_ respectively, for active UL BWP $b$ of carrier $f$ _of_ serving
> cell $c$, and SRS resource set $q_{s}$ is indicated by _SRS-
> PosResourceSetId_ from _SRS-PosResourceSet_ , and
\- $\text{PL}_{b,f,c}\left( q_{d} \right)$ is a downlink pathloss estimate in
dB calculated by the UE, as described in clause 7.1.1 in case of an active DL
BWP _of_ a serving cell $c$, using RS resource indexed $q_{d}$ in a serving or
non-serving cell for SRS resource set $q_{s}$ [6, TS 38.214]. A configuration
for RS resource index $q_{d}$ associated with SRS resource set $q_{s}$ is
provided by _pathlossReferenceRS-Pos_
\- if a _ssb-IndexServing_ is provided _, referenceSignalPower_ is provided by
_ss-PBCH-BlockPower_
\- if a _ssb-Ncell_ is provided _, referenceSignalPower_ is provided by _ss-
PBCH-BlockPower-r16_
\- if a _dl-PRS_ is provided, _referenceSignalPower_ is provided by _dl-PRS-
ResourcePower_
If the UE is in the RRC_CONNECTED state and determines that the UE is not able
to accurately measure $\text{PL}_{b,f,c}\left( q_{d} \right)$, or the UE is
not provided with _pathlossReferenceRS-Pos, the UE calculates_
$\text{PL}_{b,f,c}\left( q_{d} \right)$ using _a RS resource obtained from the
SS/PBCH block of the serving cell that the UE uses to obtain MIB._ If the UE
is in the RRC_INACTIVE state and determines that the UE is not able to
accurately measure $\text{PL}_{b,f,c}\left( q_{d} \right)$, the UE does not
transmit SRS for the SRS resource set.
The UE may indicate a capability for a number of pathloss estimates that the
UE can simultaneously maintain for all SRS resource sets provided by _SRS-
PosResourceSet_ in addition to the up to four pathloss estimates that the UE
maintains per serving cell for PUSCH/PUCCH transmissions and for SRS
transmissions configured by _SRS-Resource_.
If a UE transmits SRS based on a configuration by _SRS-PosResourceSet_ outside
initial UL BWP of carrier _f_ of serving cell _c_ in RRC_INACTIVE state, the
active UL BWP _b_ refers to the BWP configuration provided by the higher layer
parameter _bwp-NUL_ or _bwp-SUL_ contained in _SRS-PosRRC-InactiveConfig_ for
the corresponding carrier.
## 7.4 Physical random access channel
A UE determines a transmission power for a physical random access channel
(PRACH), , on active UL BWP of carrier of serving cell based on DL RS for
serving cell in transmission occasion as
[dBm],
where is the UE configured maximum output power defined in [8-1, TS 38.101-1],
[8-2, TS 38.101-2] and [8-3, TS 38.101-3] for carrier of serving cell within
transmission occasion , is the PRACH target reception power
_PREAMBLE_RECEIVED_TARGET_POWER_ provided by higher layers [11, TS 38.321] for
the active UL BWP of carrier of serving cell , and is a pathloss for the
active UL BWP of carrier _based on_ the DL RS associated with the PRACH
transmission on the active DL BWP _of_ serving cell and calculated by the UE
in dB as _referenceSignalPower_ \-- higher layer filtered RSRP in dBm, where
RSRP is defined in [7, TS 38.215] and the higher layer filter configuration is
defined in [12, TS 38.331]. If the active DL BWP is the initial DL BWP and for
SS/PBCH block and CORESET multiplexing pattern 2 or 3, as described in clause
13, the UE determines based on the SS/PBCH block associated with the PRACH
transmission.
If a PRACH transmission from a UE is not in response to a detection of a PDCCH
order by the UE, or is in response to a detection of a PDCCH order by the UE
that triggers a contention based random access procedure, or is associated
with a link recovery procedure where a corresponding index _is associated with
a SS/PBCH block, as described in clause 6,_ _referenceSignalPower_ is provided
by _ss-PBCH-BlockPower_.
If a PRACH transmission from a UE is in response to a detection of a PDCCH
order by the UE that triggers a contention-free random access procedure and
depending on the DL RS that the DM-RS of the PDCCH order is quasi-collocated
with as described in clause 10.1, _referenceSignalPower_ is provided by _ss-
PBCH-BlockPower_ or, if the UE is configured resources for a periodic CSI-RS
reception or the PRACH transmission is associated with a link recovery
procedure where a corresponding index _is associated with a periodic CSI-RS
configuration_ _as described in clause 6_ , _referenceSignalPower_ is obtained
by _ss-PBCH-BlockPower_ and _powerControlOffsetSS_ where
_powerControlOffsetSS_ provides an offset of CSI-RS transmission power
relative to SS/PBCH block transmission power [6, TS 38.214]. If
_powerControlOffsetSS_ is not provided to the UE, the UE assumes an offset of
0 dB. If the active TCI state for the PDCCH that provides the PDCCH order
includes two RS, the UE expects that one RS is configured with _qcl-Type_ set
to \'typeD\' and the UE uses the one RS when applying a value provided by
_powerControlOffsetSS_.
If within a random access response window, as described in clause 8.2, the UE
does not receive a random access response that contains a preamble identifier
corresponding to the preamble sequence transmitted by the UE, the UE
determines a transmission power for a subsequent PRACH transmission, if any,
as described in [11, TS 38.321].
If prior to a PRACH retransmission, a UE changes the spatial domain
transmission filter, Layer 1 notifies higher layers to suspend the power
ramping counter as described in [11, TS 38.321].
If due to power allocation _to_ PUSCH/PUCCH/PRACH _/SRS transmissions as
described in clause 7.5, or due to power allocation in EN-DC or NE-DC or NR-DC
operation, or due to slot format determination as described in clause 11.1, or
due to the_ PUSCH/PUCCH/PRACH _/SRS transmission occasions are in the same
slot or the gap between a PRACH transmission and PUSCH/PUCCH/SRS transmission
is small as described in clause 8.1, or due to DAPS operation as described in
clause 15, or due to HD-UE operation_ in paired spectrum _as described in
clause 17.2,_ the UE does not transmit a PRACH _in a transmission occasion_ ,
Layer 1 notifies higher layers to suspend the corresponding power ramping
counter. If due to power allocation _to_ PUSCH/PUCCH/PRACH _/SRS transmissions
as described in clause 7.5, or due to power allocation in EN-DC or NE-DC or
NR-DC operation,_ the UE transmits a PRACH with reduced power _in a
transmission occasion_ , Layer 1 may notify higher layers to suspend the
corresponding power ramping counter.
## 7.5 Prioritizations for transmission power reductions
For single cell operation with two uplink carriers or for operation with
carrier aggregation, if a _total UE transmit power for PUSCH or PUCCH or PRACH
or SRS transmissions on serving cells in a frequency range in a respective
transmission occasion_ $i$ _would exceed_ ${\widehat{P}}_{\text{CMAX}}(i)$_,
where_ ${\widehat{P}}_{\text{CMAX}}(i)$ _is the linear value of_
$P_{\text{CMAX}}(i)$ _in transmission occasion_ $i$ _as defined in [8-1, TS
38.101-1] for FR1_ and [8-2, TS 38.101-2] _for FR2, the UE allocates power to_
PUSCH/PUCCH/PRACH _/SRS transmissions according to the following priority
order (in descending order) so that the total UE transmit power for
transmissions on serving cells in the frequency range is smaller than or equal
to_ ${\widehat{P}}_{\text{CMAX}}(i)$ _for that frequency range in every symbol
of transmission occasion_ $i$_. For the purpose of power allocation in this
clause, if a UE is provided uci-MuxWithDiffPrio_ and the UE multiplexes HARQ-
ACK information in a PUSCH, a priority index of the PUSCH is the larger of (a)
the priority index of the PUSCH according to clause 9 and (b) the larger
priority index of the HARQ-ACK information. _When determining a total transmit
power for serving cells in a frequency range in a symbol of transmission
occasion_ $i$_, the UE does not include power for transmissions starting after
the symbol of transmission occasion_ $i$_. The total UE transmit power in a
symbol of a slot is defined as the sum of the linear values of UE transmit
powers for PUSCH, PUCCH, PRACH, and SRS in the symbol of the slot._
\- PRACH transmission on the PCell
\- PUCCH or PUSCH transmissions with larger priority index
\- For PUCCH or PUSCH transmissions with same priority index
\- PUCCH transmission with HARQ-ACK information, and/or SR, and/or LRR, or
PUSCH transmission with HARQ-ACK information of the priority index
\- PUCCH transmission with CSI or PUSCH transmission with CSI
\- PUSCH transmission without HARQ-ACK information of the priority index or
CSI and, for Type-2 random access procedure, PUSCH transmission on the PCell
\- If the UE is configured with prioSCellPRACH-OverSP-PeriodicSRS-r17
\- Aperiodic SRS transmission or PRACH transmission on a serving cell other
than the PCell
\- Semi-persistent and/or periodic SRS transmission
\- otherwise,
\- SRS transmission, with aperiodic SRS having higher priority than semi-
persistent and/or periodic SRS, or PRACH transmission on a serving cell other
than the PCell
In case of same priority order and for operation with carrier aggregation, the
UE prioritizes power allocation for transmissions on the primary cell of the
MCG or the SCG over transmissions on a secondary cell. In case of same
priority order and for operation with two UL carriers, the UE prioritizes
power allocation for transmissions on the carrier where the UE is configured
to transmit PUCCH. If _PUCCH_ is not configured for any of the _two UL
carriers, the UE prioritizes power allocation for transmissions on_ the non-
supplementary UL carrier.
## 7.6 Dual connectivity
### 7.6.1 EN-DC
If a UE is configured with a MCG using E-UTRA radio access and with a SCG
using NR radio access, the UE is configured a maximum power for transmissions
on the MCG by _p-MaxEUTRA_ and a maximum power for transmissions in FR1 on the
SCG by _p-NR-FR1_.
The UE determines a transmission power for the MCG as described in [13, TS
36.213] using as the maximum transmission power. The UE determines
transmission power for the SCG in FR1 as described in clauses 7.1 through 7.5
using as the maximum transmission power. The UE determines transmission power
for the SCG in FR2 as described in clauses 7.1 through 7.5.
A UE does not expect to be configured for operation with shortened TTI and/or
processing time [13, TS 36.213] on a cell that is included in an EN-DC
configuration.
If a UE is configured with , where is the linear value of , is the linear
value of , and is the linear value of a configured maximum transmission power
for EN-DC operation as _defined in_ [8-3, TS 38.101-3] for FR1, the UE
determines a transmission power for the SCG as follows.
\- If the UE is configured with reference TDD configuration for E-UTRA (by
_tdm-PatternConfig_ or by _tdm-PatternConfig2_ in [13, TS 36.213])
\- If the UE does not indicate a capability for dynamic power sharing between
E-UTRA and NR for EN-DC, the UE does not transmit in a slot on the SCG in FR1
when a corresponding subframe on the MCG is an UL subframe in the reference
TDD configuration.
\- If the UE indicates a capability for dynamic power sharing between E-UTRA
and NR for EN-DC, and does not indicate a capability _tdm-restrictionDualTX-
FDD-endc-r16_ in [18, TS 38.306], and is configured with _tdm-PatternConfig2_
, the UE does not transmit on the SCG in FR1 when the UE has overlapped
transmission on a subframe on the MCG.
\- If the UE indicates a capability for dynamic power sharing between E-UTRA
and NR for EN-DC and
\- if UE transmission(s) in subframe of the MCG overlap in time with UE
transmission(s) in slot of the SCG in FR1, and
\- if in any portion of slot of the SCG,
the UE reduces transmission power in any portion of slot of the SCG so that in
any portion of slot , where and are the linear values of the total UE
transmission powers in subframe of the MCG and in slot of the SCG in FR1,
respectively. The UE is not required to transmit in any portion of slot of the
SCG if would need to be reduced by more than the value provided by _X~SCALE~_
in order for in any portion of slot of the SCG. The UE is required to transmit
in slot of the SCG if would not need to be reduced by more than the value
provided by _X~SCALE~_ in order for in all portions of slot .
\- If the UE does not indicate a capability for dynamic power sharing between
E-UTRA and NR for EN-DC, the UE expects to be configured with reference TDD
configuration for E-UTRA by _tdm-PatternConfig_ in [13, TS 36.213].
### 7.6.1A NE-DC
If a UE is configured with an MCG using NR radio access and with a SCG using
E-UTRA radio access, the UE is configured a maximum power for transmissions in
FR1 on the MCG by _p-NR-FR1_ and a maximum power for transmissions on the SCG
by _p-MaxEUTRA_.
The UE determines transmission power for the MCG in FR1 as described in
clauses 7.1 through 7.5 using as the maximum transmission power for . The UE
determines transmission power for the MCG in FR2 as described in clauses 7.1
through 7.5.
If the UE is not provided _tdd-UL-DL-ConfigurationCommon for the MCG, t_ he UE
determines a transmission power for the SCG as described in [13, TS 36.213]
using as the maximum transmission power.
If at least one symbol of slot of the MCG that is indicated as uplink or
flexible by _tdd-UL-DL-ConfigurationCommon_ or _tdd_ -_UL-DL-
ConfigurationDedicated_ overlaps with subframe of the SCG
\- for subframe , the UE determines a transmission power for the SCG as
described in [13, TS 36.213] using as the maximum transmission power
otherwise
\- the UE determines a transmission power for the SCG as described in [13, TS
36.213] without considering as the maximum transmission power
If a UE is configured with , where is the linear value of , is the linear
value of , and is the linear value of a configured maximum transmission power
for NE-DC operation as _defined in_ [8-3, TS 38.101-3] for FR1, the UE
determines a transmission power for the MCG as follows
\- If the UE is configured with reference TDD configuration for E-UTRA (by
_tdm-PatternConfigNE-DC-r15_ in [13, TS 36.213])
\- If the UE does not indicate a capability for dynamic power sharing between
E-UTRA and NR for NE-DC, the UE does not expect to transmit in a slot on the
MCG in FR1 when a corresponding subframe on the SCG is an UL subframe in the
reference TDD configuration.
\- If the UE indicates a capability for dynamic power sharing between E-UTRA
and NR for NE-DC and
\- if the UE transmission(s) in slot of the MCG in FR1 overlap in time with UE
transmission(s) in subframe of the SCG, and
\- if in any portion of slot of the MCG,
the UE reduces transmission power in any portion of slot of the MCG so that in
all portions of slot , where and are the linear values of the total UE
transmission powers in slot of the MCG in FR1 and in subframe of the SCG,
respectively.
\- If the UE does not indicate a capability for dynamic power sharing between
E-UTRA and NR for NE-DC, the UE expects to be configured with reference TDD
configuration for E-UTRA (by _tdm-PatternConfigNE-DC-r15_ in [13, TS 36.213]).
### 7.6.2 NR-DC
The UE procedures described in this clause are not applicable if the UE is
provided _scg-State_ [12, TS 38.331].
If a UE is configured with an MCG using NR radio access in FR1 or in FR2 and
with a SCG using NR radio access in FR2 or in FR1, respectively, the UE
performs transmission power control independently per cell group as described
in clauses 7.1 through 7.5.
If a UE is configured with an MCG and a SCG using NR radio access in FR1
and/or in FR2, the UE is configured a maximum power $P_{\text{MCG}}$ for
transmissions on the MCG by _p-NR-FR1_ and/or by _p-NR-FR2_ and a maximum
power $P_{\text{SCG}}$ for transmissions on the SCG by _p-NR-FR1_ and/or by
_p-NR-FR2_ and with an inter-CG power sharing mode by _nrdc-PCmode-FR1 for FR1
and/or_ by _nrdc-PCmode-FR2 for FR2_. The UE determines a transmission power
on the MCG and a transmission power on the SCG per frequency range.
If a UE is provided _semi-static-mode1 for nrdc-PCmode-FR1_ or for _nrdc-
PCmode-FR2, or semi-static-mode2 for nrdc-PCmode-FR1_ or for _nrdc-PCmode-FR2,
the UE does not expect_ $P_{\text{MCG}}$ and $P_{\text{SCG}}$ _to be
configured such that_ ${\widehat{P}}_{\text{MCG}} + {\widehat{P}}_{\text{SCG}}
> {\widehat{P}}_{\text{Total}}^{NR - DC}$, where ${\widehat{P}}_{\text{MCG}}$
is the linear value of $P_{\text{MCG}}$, ${\widehat{P}}_{\text{SCG}}$ is the
linear value of $P_{\text{SCG}}$, and ${\widehat{P}}_{\text{Total}}^{NR - DC}$
is the linear value of a configured maximum transmission power for NR-DC
operation in FR1 or FR2 as defined in [8-3, TS 38.101-3].
If a UE is provided _semi-static-mode1 for nrdc-PCmode-FR1_ or for _nrdc-
PCmode-FR2_ , the UE determines a transmission power for the MCG or for the
SCG as described in clauses 7.1 through 7.5 using $P_{\text{MCG}}$ or
$P_{\text{SCG}}$ as the maximum transmission power, respectively.
If a UE is provided _semi-static-mode2 for nrdc-PCmode-FR1_ or for _nrdc-
PCmode-FR2_
\- if the UE is not provided _tdd-UL-DL-ConfigurationCommon_ for the MCG or
SCG, the UE determines a transmission power for the MCG or for the SCG as
described in clauses 7.1 through 7.5 using $P_{\text{MCG}}$ or
$P_{\text{SCG}}$ as the maximum transmission power, respectively
\- if at least one symbol of slot $i_{1}$ of the MCG or of the SCG that is
indicated as uplink or flexible to a UE by _tdd-UL-DL-ConfigurationCommon_ and
_tdd_ -_UL-DL-ConfigurationDedicated_ , if provided, overlaps with a symbol
for any ongoing transmission overlapping with slot $i_{2}$ of the SCG or of
the MCG, respectively, the UE determines a power for the transmission on the
SCG or the MCG overlapping with slot $i_{2}$ as described in clauses 7.1
through 7.5 using $P_{\text{SCG}}$ or $P_{\text{MCG}}$, respectively, as the
maximum transmission power
\- otherwise, the UE determines a power for the transmission on SCG or the MCG
overlapping with slot $i_{2}$, as described in [8-3, TS 38.101-3] and in
clauses 7.1 through 7.5 without considering $P_{\text{SCG}}$ or
$P_{\text{MCG}}$ respectively
The UE expects to be provided _semi-static-mode2_ for _nrdc-PCmode-FR1_ or for
_nrdc-PCmode-FR2_ only for synchronous NR-DC operation [10, TS 38.133].
If a UE
\- is provided _dynamic_ for _nrdc-PCmode-FR1_ or for _nrdc-PCmode-FR2_ , and
\- indicates a capability to support dynamic power sharing for intra-FR NR DC,
the UE determines a maximum transmission power on the SCG at a first symbol of
a transmission occasion on the SCG by determining transmissions on the MCG
that
\- are scheduled by DCI formats in PDCCH receptions with a last symbol that is
earlier by at least $T_{\text{offset}}$ from the first symbol of the
transmission occasion on the SCG, or are configured by higher layers, and
\- overlap with the transmission occasion on the SCG
the maximum transmission power on the SCG is determined as
\- $\min\left(
{\widehat{P}}_{\text{SCG}},{\widehat{P}}_{\text{Total}}^{\text{NR-DC}} - \
{\widehat{P}}_{\text{MCG}}^{\text{actual}} \right)$, if the UE determines
transmissions on the MCG with a ${\widehat{P}}_{\text{MCG}}^{\text{actual}}$
total power
\- ${\widehat{P}}_{\text{Total}}^{\text{NR-DC}}$, if the UE does not determine
any transmissions on the MCG
where
> \- $T_{\text{offset}} = max{ T_{proc,MCG}^{\max},T_{proc,SCG}^{\max}}$,
\- $T_{proc,MCG}^{\max}$ and $T_{proc,SCG}^{\max}$ is the maximum of
$T_{proc,2}$**,** $T_{proc,CSI}$**,** $T_{proc,release}^{\text{mux}}$**,**
$T_{proc,2}^{\text{mux}}$**,** and $T_{proc,CSI}^{\text{mux}}$ based on the
configurations on the MCG and the SCG, respectively, when the UE indicates the
value of \'long\' for the capability,
\- $T_{proc,MCG}^{\max}$ and $T_{proc,SCG}^{\max}$ is the maximum of
$T_{proc,2}$**,** $T_{proc,release}^{\text{mux}}$**,**
$T_{proc,2}^{\text{mux}}$ based on the configurations on the MCG and the SCG,
respectively, when the UE indicates the value of \'short\' for the capability,
and
\- ${\widehat{P}}_{\text{MCG}}^{\text{actual}}$ is the total power for the
transmissions on the MCG that overlap with the transmission occasion on the
SCG where ${\widehat{P}}_{\text{MCG}}^{\text{actual}}$ is determined based on
transmissions configured by higher layers and on transmissions scheduled by
DCI formats in PDCCH receptions with a last symbol that is at least
$T_{\text{offset}}$ before the first symbol of the transmission occasion on
the SCG.
The UE does not expect to have PUSCH, PUCCH, PRACH, or SRS transmissions on
the MCG that
\- are scheduled/triggered by DCI formats in PDCCH receptions with a last
symbol that is earlier by less than $T_{\text{offset}}$ from the first symbol
of the transmission occasion on the SCG, and
> \- overlap with the transmission occasion on the SCG
The UE does not expect to receive a positive TPC command value in a DCI format
2_2 or a DCI format 2_3 in a PDCCH reception with a last symbol that is less
than $T_{\text{offset}}$ before the first symbol of the transmission occasion
on the SCG, if the transmission on the MCG overlaps with the transmission
occasion on the SCG.
The UE is not required to apply a TPC command the UE receives in a DCI format
2_2 or a DCI format 2_3 in a PDCCH reception with a last symbol that is less
than $T_{\text{offset}}$ before the first symbol of the transmission occasion
on the SCG, if the transmission on the MCG overlaps with the transmission
occasion on the SCG.
## 7.7 Power headroom report
The types of UE power headroom reports are the following. A Type 1 UE power
headroom that is valid for PUSCH transmission occasion on active UL BWP of
carrier _of_ serving cell . A Type 3 UE power headroom that is valid for SRS
transmission occasion on active UL BWP of carrier _of_ serving cell .
A UE determines whether a power headroom report for an activated serving cell
[11, TS 38.321] is based on an actual transmission or a reference format based
on the higher layer signalling of configured grant and periodic/semi-
persistent sounding reference signal transmissions and downlink control
information the UE received until and including the PDCCH monitoring occasion
where the UE detects the first DCI format scheduling an initial transmission
of a transport block since a power headroom report was triggered if the power
headroom report is reported on a PUSCH triggered by the first DCI format.
Otherwise, a UE determines whether a power headroom report is based on an
actual transmission or a reference format based on the higher layer signalling
of configured grant and periodic/semi-persistent sounding reference signal
transmissions and downlink control information the UE received until the first
uplink symbol of a configured PUSCH transmission minus _T\'~proc,2~_
=_T~proc,2~_ where _T~proc,2\ ~_ is determined according to [6, TS 38.214]
assuming _d~2,1\ ~_ = 1, _d~2,2~_ =0, and with _µ~DL~_ corresponding to the
subcarrier spacing of the active downlink BWP of the scheduling cell for a
configured grant if the power headroom report is reported on the PUSCH using
the configured grant.
If a UE
\- is configured with two UL carriers for a serving cell, and
\- determines a Type 1 power headroom report and a Type 3 power headroom
report for the serving cell
the UE
\- provides the Type 1 power headroom report if both the Type 1 and Type 3
power headroom reports are based on respective actual transmissions or on
respective reference transmissions
\- provides the power headroom report that is based on a respective actual
transmission if either the Type 1 report or the Type 3 report is based on a
respective reference transmission
If a UE is configured with a SCG and if _phr-ModeOtherCG_ for a CG indicates
\'virtual\' then, for power headroom reports transmitted on the CG, the UE
computes _PH_ assuming that the UE does not transmit PUSCH/PUCCH on any
serving cell of the other CG. For NR-DC when both the MCG and the SCG operate
either in FR1 or in FR2 and for a power headroom report transmitted on the MCG
or the SCG, the UE computes _PH_ assuming that the UE does not transmit
PUSCH/PUCCH on any serving cell of the SCG or the MCG, respectively.
If the UE is configured with a SCG,
\- For computing power headroom for cells belonging to MCG, the term \'serving
cell\' in this clause refers to serving cell belonging to the MCG.
\- For computing power headroom for cells belonging to SCG, the term \'serving
cell\' in this clause refers to serving cell belonging to the SCG. The term
\'primary cell\' in this clause refers to the PSCell of the SCG.
If the UE is configured with a PUCCH-SCell,
\- For computing power headroom for cells belonging to primary PUCCH group,
the term \'serving cell\' in this clause refers to serving cell belonging to
the primary PUCCH group.
\- For computing power headroom for cells belonging to secondary PUCCH group,
the term \'serving cell\' in this clause refers to serving cell belonging to
the secondary PUCCH group. The term \'primary cell\' in this clause refers to
the PUCCH-SCell of the secondary PUCCH group.
For a UE configured with EN-DC/NE-DC and capable of dynamic power sharing, if
E-UTRA Dual Connectivity PHR [14, TS 36.321] is triggered and,
\- if the duration of NR slot on active UL BWP is different from that of
E-UTRA subframe carrying the Dual Connectivity PHR, the UE provides power
headroom of the first NR slot that fully overlaps with the E-UTRA subframe;
\- if the duration of NR slot on active UL BWP is the same as that of E-UTRA
subframe carrying the Dual Connectivity PHR for asynchronous EN-DC/NE-DC [10,
TS 38.133], the UE provides power headroom of the first NR slot that overlaps
with the E-UTRA subframe.
### 7.7.1 Type 1 PH report
If a UE determines that a Type 1 power headroom report for an activated
serving cell is based on an actual PUSCH transmission then, for PUSCH
transmission occasion $i$ on active UL BWP $b$ _of_ carrier $f$ _of_ serving
cell $c$, the UE computes the Type 1 power headroom report as
{width="6.604166666666667in" height="0.275in"} [dB]
where $P_{\text{C}\text{MAX},f,c}(i)$, $P_{\text{O_P}\text{USCH},b,f,c}(j)$,
$M_{\text{RB},b,f,c}^{\text{PUSCH}}(i)$, $\alpha_{b,f,c}\left( j \right)$,
$\text{PL}_{b,f,c}(q_{d})$, $\mathrm{\Delta}_{\text{TF},b,f,c}\left( i
\right)$ and $f_{b,f,c}\left( i,l \right)$ are defined in clause 7.1.1.
If a UE is configured with multiple cells for PUSCH transmissions, where a SCS
configuration $\mu_{1}$ on active UL BWP $b_{1}$ _of_ carrier $f_{1}$ of
serving cell $c_{1}$ _is smaller than a_ SCS configuration $\mu_{2}$ on active
UL BWP $b_{2}$ _of_ carrier $f_{2}$ of serving cell $c_{2}$_, and if the UE
provides a Type 1 power headroom report in a PUSCH transmission in a slot on
active_ UL BWP $b_{1}$ _that overlaps with multiple slots on active_ UL BWP
$b_{2}$_, the UE provides a Type 1 power headroom report for the first PUSCH,
if any, on the first slot of the multiple slots on active_ UL BWP $b_{2}$ that
fully overlaps with the slot on active UL BWP $b_{1}$. If a UE is configured
with multiple cells for PUSCH transmissions, where a same SCS configuration on
active UL BWP $b_{1}$ _of_ carrier $f_{1}$ of serving cell $c_{1}$ _and_
active UL BWP $b_{2}$ _of_ carrier $f_{2}$ of serving cell $c_{2}$_, and if
the UE provides a Type 1 power headroom report in a PUSCH transmission in a
slot on active_ UL BWP $b_{1}$_, the UE provides a Type 1 power headroom
report for the first PUSCH, if any, on the slot on active_ UL BWP $b_{2}$ that
overlaps with the slot on active UL BWP $b_{1}$.
If a UE is configured with multiple cells for PUSCH transmissions _and
provides a Type 1 power headroom report in a PUSCH transmission with PUSCH
repetition Type B having a nominal repetition that spans multiple slots on
active_ UL BWP $b_{1}$ _and overlaps with one or more slots on active_ UL BWP
$b_{2}$_, the UE provides a Type 1 power headroom report for the first PUSCH,
if any, on the first slot of the one or more slots on active_ UL BWP $b_{2}$
that overlaps with the multiple slots of the nominal repetition on active UL
BWP $b_{1}$.
For a UE configured with EN-DC/NE-DC and capable of dynamic power sharing, if
E-UTRA Dual Connectivity PHR [14, TS 36.321] is triggered, the UE provides
power headroom of the first PUSCH, if any, on the determined NR slot as
described in clause 7.7.
If a UE is configured with multiple cells for PUSCH transmissions, the UE does
not consider for computation of a Type 1 power headroom report in a first
PUSCH transmission that includes an initial transmission of transport block on
active UL BWP $b_{1}$ _of_ carrier $f_{1}$ of serving cell $c_{1}$_, a second_
PUSCH transmission on active UL BWP $b_{2}$ _of_ carrier $f_{2}$ of serving
cell $c_{2}$ _that overlaps with the first PUSCH transmission if_
\- the second PUSCH transmission is scheduled by a DCI format in a PDCCH
received in a second PDCCH monitoring occasion, and
\- the second PDCCH monitoring occasion is after a first PDCCH monitoring
occasion where the UE detects the earliest DCI format scheduling an initial
transmission of a transport block after a power headroom report was triggered
or
\- the second PUSCH transmission is after the first uplink symbol of the first
PUSCH transmission minus _T\'~proc,2~_ =_T~proc,2~_ where _T~proc,2~_ is
determined according to [6, TS 38.214] assuming _d~2,1\ ~_ =1, _d~2,2~_ =0,
and with _µ~DL~_ corresponding to the subcarrier spacing of the active
downlink BWP of the scheduling cell for a configured grant if the first PUSCH
transmission is on a configured grant after a power headroom report was
triggered.
If the UE determines that a Type 1 power headroom report for an activated
serving cell is based on a reference PUSCH transmission then, for PUSCH
transmission occasion $i$ on active UL BWP $b$ _of_ carrier $f$ of serving
cell $c$, the UE computes the Type 1 power headroom report as
[dB]
where ${\widetilde{P}}_{\text{C}\text{MAX},f,c}(i)$ is computed assuming MPR=0
dB, A-MPR=0 dB, P-MPR=0 dB. ∆T~C~ = 0 dB. MPR, A-MPR, P-MPR and ∆T~C~ are
defined in [8-1, TS 38.101-1], [8-2, TS 38.101-2] and [8-3, TS 38.101-3]. The
remaining parameters are defined in clause 7.1.1 and, if _ul-powerControl_ is
not provided, $P_{\text{O_P}\text{USCH},b,f,c}(j)$ and $\alpha_{b,f,c}\left( j
\right)$ are obtained using $P_{\text{O_NOMINAL,P}\text{USCH},f,c}\left( 0
\right)$ and _p0-PUSCH-AlphaSetId_ _=_ 0 _,_ $\text{PL}_{b,f,c}(q_{d})$ is
obtained using _pusch-PathlossReferenceRS-Id =_ 0, and $l = 0$. If _ul-
powerControl_ is provided, $P_{\text{O_PUSCH},b,f,c}(j),$
$\alpha_{b,f,c}\left( j \right)$ and $l$ are obtained by _p0AlphaSetforPUSCH_
associated with the indicated _TCI-State_ or _TCI-UL-State,_
$\text{PL}_{b,f,c}(q_{d})$ is obtained by PL-RS associated with the indicated
_TCI-State_ or _TCI-UL-State_.
If a UE is configured with two UL carriers for a serving cell and the UE
determines a Type 1 power headroom report for the serving cell based on a
reference PUSCH transmission, the UE computes a Type 1 power headroom report
for the serving cell assuming a reference PUSCH transmission on the UL carrier
provided by _pusch-Config_. If the UE is provided _pusch-Config_ for both UL
carriers, the UE computes a Type 1 power headroom report for the serving cell
assuming a reference PUSCH transmission on the UL carrier provided by _pucch-
Config_. If _pucch-Config_ is not provided to the UE for any of the two UL
carriers, the UE computes a Type 1 power headroom report for the serving cell
assuming a reference PUSCH transmission on the non-supplementary UL carrier.
If a UE is not provided _twoPHRMode,_ and is provided _two SRS resource sets
in srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with
usage set to \'codebook\' or \'nonCodebook\'_ on active UL BWP $b$ _of_
carrier $f$ of serving cell $c$, the UE provides one Type 1 power headroom
report in a slot $n$. If the Type 1 power headroom report is for an actual
PUSCH repetition, the Type 1 power headroom report is for the first PUSCH
repetition associated with the first SRS resource set or the second SRS
resource set that overlaps with slot $n$.
If a UE is provided _twoPHRMode_ , and is provided _two SRS resource sets in
srs-ResourceSetToAddModList or srs-ResourceSetToAddModListDCI-0-2 with usage
set to \'codebook\' or \'nonCodebook\'_ on active UL BWP $b$ _of_ carrier $f$
of serving cell $c$, the UE provides two Type 1 power headroom reports in a
slot $n$, where
\- if the UE provides a first Type 1 power headroom report for an actual PUSCH
repetition of a PUSCH transmission starting earliest in slot $n$ that is
associated with one SRS resource set,
\- if the UE transmits PUSCH repetitions associated with the other SRS
resource set in slot $n$, the UE provides a second Type 1 power headroom
report for a first actual PUSCH repetition associated with the other SRS
resource set that overlaps with slot $n$
\- else, the UE provides a second Type 1 power headroom report for a reference
PUSCH transmission associated with the other SRS resource set, where
\- if the other SRS resource set is the first SRS resource set,
$P_{\text{O_PUSCH},b,f,c}(j)$ and $\alpha_{b,f,c}\left( j \right)$ are
obtained using $P_{\text{O_NOMINAL,PUSCH},f,c}\left( 0 \right)$ and _p0-PUSCH-
AlphaSetId_ _=_ 0 _,_ $\text{PL}_{b,f,c}(q_{d})$ is obtained using _pusch-
PathlossReferenceRS-Id =_ 0 if **_the UE is not provided enablePL-RS-
UpdateForPUSCH-SRS_ or is obtained** from _PUSCH-PathlossReferenceRS-Id_
mapped to _sri-PUSCH-PowerControlId_ = 0 of _sri-PUSCH-MappingToAddModList if_
_the UE is provided enablePL-RS-UpdateForPUSCH-SRS_ **, and $l = 0$
\- else, $P_{\text{O_PUSCH},b,f,c}(j)$ and $\alpha_{b,f,c}\left( j \right)$
are obtained using $P_{\text{O_NOMINAL,PUSCH},f,c}\left( 0 \right)$ and
_p0-PUSCH-AlphaSetId_ _= 1,_ $\text{PL}_{b,f,c}(q_{d})$ is obtained using
_pusch-PathlossReferenceRS-Id = 1_ if **_the UE is not provided enablePL-RS-
UpdateForPUSCH-SRS_ or is obtained** from _PUSCH-PathlossReferenceRS-Id_
mapped to _sri-PUSCH-PowerControlId_ = 0 of _sri-PUSCH-MappingToAddModList2
if_ _the UE is provided enablePL-RS-UpdateForPUSCH-SRS_ __, and $l = 1$ if the
UE is provided_ twoPUSCH-PC-AdjustmentStates_, or $l = 0$ if the UE is not
provided _twoPUSCH-PC-AdjustmentStates_
\- else, if the UE provides a Type 1 power headroom report for a reference
PUSCH transmission associated with the first SRS resource set, the UE provides
a Type 1 power headroom report for a reference PUSCH transmission associated
with the second SRS resource set, where
\- for the first Type 1 power headroom report, $P_{\text{O_PUSCH},b,f,c}(j)$
and $\alpha_{b,f,c}\left( j \right)$ are obtained using
$P_{\text{O_NOMINAL,PUSCH},f,c}\left( 0 \right)$ and _p0-PUSCH-AlphaSetId_ _=_
0 _,_ $\text{PL}_{b,f,c}(q_{d})$ is obtained using _pusch-PathlossReferenceRS-
Id =_ 0 if **_the UE is not provided enablePL-RS-UpdateForPUSCH-SRS_ , or is
obtained** from the _PUSCH-PathlossReferenceRS-Id_ mapped to _sri-PUSCH-
PowerControlId_ = 0 of _sri-PUSCH-MappingToAddModList if_ _the UE is provided
enablePL-RS-UpdateForPUSCH-SRS_ **, and $l = 0$.
\- for the second Type 1 power headroom report, $P_{\text{O_PUSCH},b,f,c}(j)$
and $\alpha_{b,f,c}\left( j \right)$ are obtained using
$P_{\text{O_NOMINAL,PUSCH},f,c}\left( 0 \right)$ and _p0-PUSCH-AlphaSetId_ _=
1,_ $\text{PL}_{b,f,c}(q_{d})$ is obtained using _pusch-PathlossReferenceRS-Id
= 1_ if **_the UE is not provided enablePL-RS-UpdateForPUSCH-SRS_ , or is
obtained** from the _PUSCH-PathlossReferenceRS-Id_ mapped to _sri-PUSCH-
PowerControlId_ = 0 of _sri-PUSCH-MappingToAddModList2 if_ _the UE is provided
enablePL-RS-UpdateForPUSCH-SRS_ __, and $l = 1$ if the UE is provided_
twoPUSCH-PC-AdjustmentStates_ or $l = 0$ if the UE is not provided _twoPUSCH-
PC-AdjustmentStates_
### 7.7.2 Type 2 PH report
This clause is reserved.
### 7.7.3 Type 3 PH report
If a UE determines that a Type 3 power headroom report for an activated
serving cell is based on an actual SRS transmission then, for SRS transmission
occasion on active UL BWP _of_ carrier _of_ serving cell $c$ and if the UE is
not configured for PUSCH transmissions on carrier _of_ serving cell $c$ and
the resource for the SRS transmission is provided by _SRS-Resource_ , the UE
computes a Type 3 power headroom report as
[dB]
where , , , , and are defined in clause 7.3.1 with corresponding values
provided by _SRS-ResourceSet_.
If the UE determines that a Type 3 power headroom report for an activated
serving cell is based on a reference SRS transmission then, for SRS
transmission occasion on UL BWP _of_ carrier _of_ serving cell $c$, and if the
UE is not configured for PUSCH transmissions on UL BWP _of_ carrier _of_
serving cell $c$ and a resource for the reference SRS transmission is provided
by _SRS-Resource_ , the UE computes a Type 3 power headroom report as
[dB]
where is an SRS resource set corresponding to _SRS-ResourceSetId = 0_ for UL
BWP and , , and are defined in clause 7.3.1 with corresponding values obtained
from _SRS-ResourceSetId = 0_ for UL BWP . is computed assuming MPR=0 dB,
A-MPR=0 dB, P-MPR=0 dB and ∆T~C~ =0 dB. MPR, A-MPR, P-MPR and ∆T~C~ are
defined in [8-1, TS 38.101-1], [8-2, TS 38.101-2] and [8-3, TS 38.101-3].
If a UE is configured with two UL carriers for a serving cell and the UE
determines a Type 3 power headroom report for the serving cell based on a
reference SRS transmission and a resource for the reference SRS is provided by
_SRS-Resource_ , the UE computes a Type 3 power headroom report for the
serving cell assuming a reference SRS transmission on the UL carrier provided
by _pucch-Config_. If _pucch-Config_ is not provided to the UE for any of the
two UL carriers, the UE computes a Type 3 power headroom report for the
serving cell assuming a reference SRS transmission on the non-supplementary UL
carrier.
# 8 Random access procedure
Prior to initiation of the physical random access procedure, Layer 1 receives
from higher layers a set of SS/PBCH block indexes and provides to higher
layers a corresponding set of RSRP measurements.
Prior to initiation of the physical random access procedure, Layer 1 may
receive from higher layers an indication to perform a Type-1 random access
procedure, as described in clauses 8.1 through 8.4, or a Type-2 random access
procedure as described in clauses 8.1 through 8.2A.
Prior to initiation of the physical random access procedure, Layer 1 receives
the following information from the higher layers:
\- Configuration of physical random access channel (PRACH) transmission
parameters (PRACH preamble format, time resources, and frequency resources for
PRACH transmission).
\- Parameters for determining the root sequences and their cyclic shifts in
the PRACH preamble sequence set (index to logical root sequence table, cyclic
shift (), and set type (unrestricted, restricted set A, or restricted set B)).
From the physical layer perspective, the Type-1 L1 random access procedure
includes the transmission of random access preamble (Msg1) in a PRACH, random
access response (RAR) message with a PDCCH/PDSCH (Msg2), and when applicable,
the transmission of a PUSCH scheduled by a RAR UL grant, and PDSCH for
contention resolution.
From the physical layer perspective, the Type-2 L1 random access procedure
includes the transmission of random access preamble in a PRACH and of a PUSCH
(MsgA) and the reception of a RAR message with a PDCCH/PDSCH (MsgB), and when
applicable, the transmission of a PUSCH scheduled by a fallback RAR UL grant,
and PDSCH for contention resolution.
If a random access procedure is initiated by a PDCCH order to the UE, a PRACH
transmission is with a same SCS as a PRACH transmission initiated by higher
layers.
If a UE is configured with two UL carriers for a serving cell and the UE
detects a PDCCH order, the UE uses the UL/SUL indicator field value from the
detected PDCCH order to determine the UL carrier for the corresponding PRACH
transmission.
## 8.1 Random access preamble
Physical random access procedure is triggered upon request of a PRACH
transmission by higher layers or by a PDCCH order. A configuration by higher
layers for a PRACH transmission includes the following:
\- A configuration for PRACH transmission [4, TS 38.211].
\- A preamble index, a preamble SCS, $P_{PRACH,target}$, a corresponding RA-
RNTI, and a PRACH resource.
A PRACH is transmitted using the selected PRACH format with transmission power
$P_{PRACH,b,f,c}(i)$, as described in clause 7.4, on the indicated PRACH
resource.
For Type-1 random access procedure, a UE is provided a number $N$ of SS/PBCH
block indexes associated with one PRACH occasion and a number $R$ of
contention based preambles per SS/PBCH block index per valid PRACH occasion by
_ssb-perRACH-OccasionAndCB-PreamblesPerSSB_.
For Type-2 random access procedure with common configuration of PRACH
occasions with Type-1 random access procedure, a UE is provided a number $N$
of SS/PBCH block indexes associated with one PRACH occasion by _ssb-perRACH-
OccasionAndCB-PreamblesPerSSB_ and a number $Q$ of contention based preambles
per SS/PBCH block index per valid PRACH occasion by _msgA-CB-PreamblesPerSSB-
PerSharedRO_. The PRACH transmission can be on a subset of PRACH occasions
associated with a same SS/PBCH block index within an SSB-RO mapping cycle for
a UE provided with a PRACH mask index by _msgA-SSB-SharedRO-MaskIndex_
according to [11, TS 38.321].
For Type-2 random access procedure with separate configuration of PRACH
occasions with Type-1 random access procedure, a UE is provided a number $N$
of SS/PBCH block indexes associated with one PRACH occasion and a number $R$
of contention based preambles per SS/PBCH block index per valid PRACH occasion
by _msgA-SSB-PerRACH-OccasionAndCB-PreamblesPerSSB when provided; otherwise,
by ssb-perRACH-OccasionAndCB-PreamblesPerSSB_.
For a random access procedure associated with a feature combination indicated
by _FeatureCombinationPreambles_ , a UE is provided a number $N$ of SS/PBCH
block indexes associated with one PRACH occasion by _ssb-perRACH-
OccasionAndCB-PreamblesPerSSB_ or _msgA-SSB-PerRACH-OccasionAndCB-
PreamblesPerSSB when provided_ and a number $S$ of contention based preambles
per SS/PBCH block index per valid PRACH occasion by
_startPreambleForThisPartition_ and _numberOfPreamblesPerSSB-
ForThisPartition_. The PRACH transmission can be on a subset of PRACH
occasions associated with a same SS/PBCH block index within an SSB-RO mapping
cycle for a UE provided with a PRACH mask index by _ssb-SharedRO-MaskIndex_
according to [11, TS 38.321].
For Type-1 random access procedure, or for Type-2 random access procedure with
separate configuration of PRACH occasions from Type 1 random access procedure,
if $N  \- second, in increasing order of DMRS resource indexes within a PUSCH
> occasion, where a DMRS resource index $\text{DMR}S_{\text{id}}$ **_is_**
> determined first in an ascending order of a DMRS port index and second in an
> ascending order of a DMRS sequence index [4, TS 38.211]
\- third, in increasing order of time resource indexes $t_{\text{id}}$ for
time multiplexed PUSCH occasions within a PUSCH slot
\- fourth, in increasing order of indexes for $N_{s}$ PUSCH slots
where $N_{\text{preamble}} = ceil\left(
\frac{T_{\text{preamble}}}{T_{\text{PUSCH}}} \right)$, $T_{\text{preamble}}$
is a total number of valid PRACH occasions per association pattern period
multiplied by the number of preambles per valid PRACH occasion provided by
_rach-ConfigCommonTwoStepRA_ , and $T_{\text{PUSCH}}$ is a total number of
valid PUSCH occasions per PUSCH configuration per association pattern period
multiplied by **the number of DMRS resource indexes per valid PUSCH occasion**
provided by _msgA-DMRS-Config_.
A PUSCH occasion is valid if it does not overlap in time and frequency with
any valid PRACH occasion associated with either a Type-1 random access
procedure or a Type-2 random access procedure. Additionally, for unpaired
spectrum and for SS/PBCH blocks with indexes provided by _ssb-
PositionsInBurst_ in _SIB1_ or by _ServingCellConfigCommon_
\- if a UE is not provided _tdd-UL-DL-ConfigurationCommon_ , a PUSCH occasion
is valid if the PUSCH occasion
\- does not precede a SS/PBCH block in the PUSCH slot, and
\- starts at least $N_{\text{gap}}$ symbols after a last SS/PBCH block symbol,
where $N_{\text{gap}}$ is provided in Table 8.1-2 and, if _channelAccessMode_
= \"_semiStatic_ \" is provided, does not overlap with a set of consecutive
symbols before the start of a next channel occupancy time where the UE does
not transmit [15, TS 37.213].
\- if a UE is provided _tdd-UL-DL-ConfigurationCommon_ , a PUSCH occasion is
valid if the PUSCH occasion
\- is within UL symbols, or
\- does not precede a SS/PBCH block in the PUSCH slot, and
\- starts at least $N_{\text{gap}}$ symbols after a last downlink symbol and
at least $N_{\text{gap}}$ symbols after a last SS/PBCH block symbol, where
$N_{\text{gap}}$ is provided in Table 8.1-2 and, if _channelAccessMode_ =
\"_semiStatic_ \" is provided, does not overlap with a set of consecutive
symbols before the start of a next channel occupancy time where the UE does
not transmit [15, TS 37.213].
## 8.2 Random access response - Type-1 random access procedure
In response to a PRACH transmission, a UE attempts to detect a DCI format 1_0
with CRC scrambled by a corresponding RA-RNTI during a window controlled by
higher layers [11, TS 38.321]. The window starts at the first symbol of the
earliest CORESET the UE is configured to receive PDCCH for Type1-PDCCH CSS
set, as defined in clause 10.1, that is at least one symbol, after the last
symbol of the PRACH occasion corresponding to the PRACH transmission, where
the symbol duration corresponds to the SCS for Type1-PDCCH CSS set as defined
in clause 10.1. If $N_{\text{TA,adj}}^{\text{UE}}$ or
$N_{\text{TA,adj}}^{\text{common}}$, as defined in [4, TS 38.211], is not
zero, _the_ window starts after an additional $T_{\text{TA}} + k_{\text{mac}}$
msec where $T_{\text{TA}}$ _is defined in [4, TS 38.211] and_ $k_{\text{mac}}$
is provided by _kmac_ or $k_{\text{mac}} = 0$ if _kmac_ is not provided. The
length of the window in number of slots, based on the SCS for Type1-PDCCH CSS
set, is provided by _ra-ResponseWindow_.
If the UE detects the DCI format 1_0 with CRC scrambled by the corresponding
RA-RNTI and LSBs of a SFN field in the DCI format 1_0, if included and
applicable, are same as corresponding LSBs of the SFN where the UE transmitted
PRACH, and the UE receives a transport block in a corresponding PDSCH within
the window, the UE passes the transport block to higher layers. The higher
layers parse the transport block for a random access preamble identity (RAPID)
associated with the PRACH transmission. If the higher layers identify the
RAPID in RAR message(s) of the transport block, the higher layers indicate an
uplink grant to the physical layer. This is referred to as random access
response (RAR) UL grant in the physical layer.
If the UE does not detect the DCI format 1_0 with CRC scrambled by the
corresponding RA-RNTI within the window, or if the UE detects the DCI format
1_0 with CRC scrambled by the corresponding RA-RNTI within the window and LSBs
of a SFN field in the DCI format 1_0, if included and applicable, are not same
as corresponding LSBs of the SFN where the UE transmitted PRACH, or if the UE
does not correctly receive the transport block in the corresponding PDSCH
within the window, or if the higher layers do not identify the RAPID
associated with the PRACH transmission from the UE, the higher layers can
indicate to the physical layer to transmit a PRACH. If requested by higher
layers, the UE shall be ready to transmit a PRACH no later than $N_{T,1} +
0.75$ msec after the last symbol of the window, or the last symbol of the
PDSCH reception, where $N_{T,1}$ is a time duration of $N_{1}$ symbols
corresponding to a PDSCH processing time for UE processing capability 1
assuming $\mu$ corresponds to the smallest SCS configuration among the SCS
configurations for the PDCCH carrying the DCI format 1_0, the corresponding
PDSCH when additional PDSCH DM-RS is configured, and the corresponding PRACH.
For $\mu = 0$, the UE assumes $N_{1,0} = 14$ [6, TS 38.214]. For a PRACH
transmission using 1.25 kHz or 5 kHz SCS, the UE determines $N_{1}$ assuming
SCS configuration $\mu = 0$.
If the UE detects a DCI format 1_0 with CRC scrambled by the corresponding RA-
RNTI and LSBs of a SFN field in the DCI format 1_0, if included and
applicable, are same as corresponding LSBs of the SFN where the UE transmitted
the PRACH, and the UE receives a transport block in a corresponding PDSCH, the
UE may assume same DM-RS antenna port quasi co-location properties, as
described in [6, TS 38.214], as for a SS/PBCH block or a CSI-RS resource the
UE used for PRACH association, as described in clause 8.1, regardless of
whether or not the UE is provided _TCI-State_ for the CORESET where the UE
receives the PDCCH with the DCI format 1_0.
If the UE attempts to detect the DCI format 1_0 with CRC scrambled by the
corresponding RA-RNTI in response to a PRACH transmission initiated by a PDCCH
order that triggers a contention-free random access procedure for the SpCell
[11, TS 38.321], the UE may assume that the PDCCH that includes the DCI format
1_0 and the PDCCH order have same DM-RS antenna port quasi co-location
properties. If the UE attempts to detect the DCI format 1_0 with CRC scrambled
by the corresponding RA-RNTI in response to a PRACH transmission initiated by
a PDCCH order that triggers a contention-free random access procedure for a
secondary cell, the UE may assume the DM-RS antenna port quasi co-location
properties of the CORESET associated with the Type1-PDCCH CSS set for
receiving the PDCCH that includes the DCI format 1_0.
A RAR UL grant schedules a PUSCH transmission from the UE. The contents of the
RAR UL grant, starting with the MSB and ending with the LSB, are given in
Table 8.2-1.
If the value of the frequency hopping flag is 0, the UE transmits the PUSCH
without frequency hopping; otherwise, the UE transmits the PUSCH with
frequency hopping.
The UE determines the MCS of the PUSCH transmission from the first sixteen
indexes of the applicable MCS index table for PUSCH as described in [6, TS
38.214].
The TPC command value $\delta_{msg2,b,f,c}$ is used for setting the power of
the PUSCH transmission, as described in clause 7.1.1, and is interpreted
according to Table 8.2-2.
The CSI request field is reserved.
The ChannelAccess-CPext field indicates a channel access type and CP extension
for operation with shared spectrum channel access [15, TS 37.213] in FR1 as
defined in Table 7.3.1.1.1-4 in [5, TS 38.212] or Table 7.3.1.1.1-4A in [5, TS
38.212] if _channelAccessMode_ = \"_semiStatic_ \" is provided. The
ChannelAccess-CPext field indicates a channel access type for operation with
shared spectrum channel access [15, TS 37.213] in FR2-2 as defined in Table
7.3.1.1.1-4B in [5, TS 38.212] if _ChannelAccessMode2-r17_ is provided.
Table 8.2-1: Random Access Response Grant Content field size
+----------------------------------+----------------------------------+ | RAR grant field | Number of bits | +==================================+==================================+ | Frequency hopping flag | 1 | +----------------------------------+----------------------------------+ | PUSCH frequency resource | 12, for operation with shared | | allocation | spectrum channel access in FR1 | | | or for FR2-2 when | | | _ChannelAccessMode2-r17_ is | | | provided | | | | | | 14, otherwise | +----------------------------------+----------------------------------+ | PUSCH time resource allocation | 4 | +----------------------------------+----------------------------------+ | MCS | 4 | +----------------------------------+----------------------------------+ | TPC command for PUSCH | 3 | +----------------------------------+----------------------------------+ | CSI request | 1 | +----------------------------------+----------------------------------+ | ChannelAccess-CPext | 2, for operation with shared | | | spectrum channel access in FR1 | | | or for FR2-2 when | | | _ChannelAccessMode2-r17_ is | | | provided | | | | | | 0, otherwise | +----------------------------------+----------------------------------+
Table 8.2-2: TPC Command $\mathbf{\delta}_{\mathbf{msg2}\mathbf{,b,f,c}}$ for
PUSCH
TPC Command Value (in dB)
* * *
0 -6 1 -4 2 -2 3 0 4 2 5 4 6 6 7 8
Unless the UE is configured a SCS, the UE receives subsequent PDSCH using same
SCS as for the PDSCH reception providing the RAR message.
If the UE does not detect the DCI format 1_0 with CRC scrambled by the
corresponding RA-RNTI within the window, or if the UE detects the DCI format
1_0 with CRC scrambled by the corresponding RA-RNTI within the window and the
LSBs of a SFN field in the DCI format 1_0, if included and applicable, are not
same as corresponding LSBs of the SFN where the UE transmitted the PRACH, or
the UE does not correctly receive a corresponding transport block within the
window, the UE procedure is as described in [11, TS 38.321].
## 8.2A Random access response - Type-2 random access procedure
In response to a transmission of a PRACH and a PUSCH, or to a transmission of
only a PRACH if the PRACH preamble is mapped to a valid PUSCH occasion, a UE
attempts to detect a DCI format 1_0 with CRC scrambled by a corresponding
MsgB-RNTI during a window controlled by higher layers [11, TS 38.321]. The
window starts at the first symbol of the earliest CORESET the UE is configured
to receive PDCCH for Type1-PDCCH CSS set, as defined in clause 10.1, that is
at least one symbol, after the last symbol of the PUSCH occasion corresponding
to the PRACH transmission, where the symbol duration corresponds to the SCS
for Type1-PDCCH CSS set. If $N_{\text{TA,adj}}^{\text{UE}}$ or
$N_{\text{TA,adj}}^{\text{common}}$, as defined in [4, TS 38.211], is not
zero, _the_ window starts after an additional $T_{\text{TA}} + k_{\text{mac}}$
msec where $T_{\text{TA}}$ _is defined in [4, TS 38.211] and_ $k_{\text{mac}}$
is provided by _kmac_ or $k_{\text{mac}} = 0$ if _kmac_ is not provided. The
length of the window in number of slots, based on the SCS for Type1-PDCCH CSS
set, is provided by _msgB-ResponseWindow_.
In response to a transmission of a PRACH, if the PRACH preamble is not mapped
to a valid PUSCH occasion, a UE attempts to detect a DCI format 1_0 with CRC
scrambled by a corresponding MsgB-RNTI during a window controlled by higher
layers [11, TS 38.321]. The window starts at the first symbol of the earliest
CORESET the UE is configured to receive PDCCH for Type1-PDCCH CSS set, as
defined in clause 10.1, that is at least one symbol, after the last symbol of
the PRACH occasion corresponding to the PRACH transmission, where the symbol
duration corresponds to the SCS for Type1-PDCCH CSS set. The length of the
window in number of slots, based on the SCS for Type1-PDCCH CSS set, is
provided by _msgB-ResponseWindow_.
If the UE detects the DCI format 1_0, with CRC scrambled by the corresponding
MsgB-RNTI and LSBs of a SFN field in the DCI format 1_0, if applicable, are
same as corresponding LSBs of the SFN where the UE transmitted PRACH, and the
UE receives a transport block in a corresponding PDSCH within the window, the
UE passes the transport block to higher layers. The higher layers indicate to
the physical layer
\- an uplink grant if the RAR message(s) is for fallbackRAR and a random
access preamble identity (RAPID) associated with the PRACH transmission is
identified, and the UE procedure continues as described in clauses 8.2, 8.3,
and 8.4 when the UE detects a RAR UL grant, or
\- transmission of a PUCCH with HARQ-ACK information having ACK value if the
RAR message(s) is for successRAR, where
\- a PUCCH resource for the transmission of the PUCCH is indicated by PUCCH
resource indicator field of 4 bits in the successRAR from a PUCCH resource set
that is provided by _pucch-ResourceCommon_
\- a slot for the PUCCH transmission is indicated by a HARQ Feedback Timing
Indicator field of 3 bits in the successRAR having a value $k$ from {1, 2, 3,
4, 5, 6, 7, 8} for $\mu \leq 3$, from {_7, 8, 12, 16, 20, 24, 28, 32} for_
$\mu = 5$, and from _{13, 16, 24, 32, 40, 48, 56, 64} for_ $\mu = 6$ and, with
reference to slots for PUCCH transmission having duration $T_{\text{slot}}$,
the slot is determined as $n + k + \mathrm{\Delta}{+ 2}^{\mu} \bullet
K_{cell,offset}$, where $n$ is a slot of the PDSCH reception,
$\mathrm{\Delta}$ is as defined for PUSCH transmission in Table 6.1.2.1.1-5 of
[6, TS 38.214], $\mu$ is the SCS configuration of the active UL BWP, and
$K_{cell,offset}$ is provided by _cellSpecificKoffset_ ; otherwise, _if not
provided,_ $K_{cell,offset} = 0$
\- the UE does not expect the first symbol of the PUCCH transmission to be
after the last symbol of the PDSCH reception by a time smaller than $N_{T,1} +
0.5$ msec where $N_{T,1}$ is the PDSCH processing time for UE processing
capability 1 [6, TS 38.214]
\- for operation with shared spectrum channel access in FR1, a channel access
type and CP extension [15, TS 37.213] for a PUCCH transmission is indicated by
a ChannelAccess-CPext field in the successRAR as defined in Table 7.3.1.1.1-4
in [5, TS 38.212] or Table 7.3.1.1.1-4A in [5, TS 38.212] if
_channelAccessMode_ = \"_semiStatic_ \" is provided
\- for operation with shared spectrum channel access in FR2-2, a channel
access type [15, TS 37.213] for a PUCCH transmission is indicated by a
ChannelAccess-CPext field in the successRAR as defined in Table 7.3.1.1.1-4B
in [5, TS 38.212] if _ChannelAccessMode2-r17_ is provided
\- the PUCCH transmission is with a same spatial domain transmission filter
and in a same active UL BWP **as a last PUSCH transmission**
If the UE detects the DCI format 1_0 with CRC scrambled by a C-RNTI and a
transport block in a corresponding PDSCH within the window, the UE transmits a
PUCCH with HARQ-ACK information having ACK value if the UE correctly detects
the transport block or NACK value if the UE incorrectly detects the transport
block and the time alignment timer is running [11, TS 38.321].
If the UE detects a DCI format 1_0 with CRC scrambled by the corresponding
MsgB-RNTI and receives a transport block within the window in a corresponding
PDSCH, the UE may assume same DM-RS antenna port quasi co-location properties,
as described in [6, TS 38.214], as for a SS/PBCH block the UE used for PRACH
association, as described in clause 8.1, regardless of whether or not the UE
is provided _TCI-State_ for the CORESET where the UE receives the PDCCH with
the DCI format 1_0.
The UE does not expect to be indicated to transmit the PUCCH with the HARQ-ACK
information at a time that is prior to a time when the UE applies a TA command
that is provided by the transport block. If the UE does not detect the DCI
format 1_0 with CRC scrambled by the corresponding MsgB-RNTI within the
window, or if the UE detects the DCI format 1_0 with CRC scrambled by the
corresponding MsgB-RNTI within the window and LSBs of a SFN field in the DCI
format 1_0, if applicable, are not same as corresponding LSBs of the SFN where
the UE transmitted the PRACH, or if the UE does not correctly receive the
transport block in the corresponding PDSCH within the window, or if the higher
layers do not identify the RAPID associated with the PRACH transmission from
the UE, the higher layers can indicate to the physical layer to transmit only
PRACH according to Type-1 random access procedure or to transmit both PRACH
and PUSCH according to Type-2 random access procedure [11, TS 38.321]. If
requested by higher layers, the UE shall be ready to transmit a PRACH no later
than $N_{\text{T,1}} + 0.75$ msec after the last symbol of the window, or the
last symbol of the PDSCH reception, where $N_{\text{T,1}}$ is a time duration
of $N_{1}$ symbols corresponding to a PDSCH processing time for UE processing
capability 1 when additional PDSCH DM-RS is configured. For $\mu = 0$, the UE
assumes $N_{\text{1,0}} = 14$ [6, TS 38.214].
Unless the UE is configured a SCS, the UE receives subsequent PDSCH using same
SCS as for the PDSCH reception providing the RAR message.
If the UE does not detect the DCI format 1_0 with CRC scrambled by the
corresponding MsgB-RNTI within the window, or if the UE detects the 1_0 with
CRC scrambled by the corresponding MsgB-RNTI within the window and LSBs of a
SFN field in the DCI format 1_0, if applicable, are not same as corresponding
LSBs of the SFN where the UE transmitted the PRACH, or the UE does not
correctly receive a corresponding transport block within the window, the UE
procedure is as described in [11, TS 38.321].
## 8.3 PUSCH scheduled by RAR UL grant
An active UL BWP with SCS configuration $\mu$, as described in clause 12 and
in [4, TS 38.211], for a PUSCH transmission scheduled by a RAR UL grant is
indicated by higher layers.
If _useInterlacePUCCH-PUSCH_ is not provided by _BWP-UplinkCommon_ and _BWP-
UplinkDedicated_ , for determining the frequency domain resource allocation
for the PUSCH transmission within the active UL BWP
\- if the active UL BWP and the initial UL BWP have same SCS and same CP
length and the active UL BWP includes all RBs of the initial UL BWP, or the
active UL BWP is the initial UL BWP, the initial UL BWP is used
\- else, the RB numbering starts from the first RB of the active UL BWP and
the maximum number of RBs for frequency domain resource allocation equals the
number of RBs in the initial UL BWP
The frequency domain resource allocation is by uplink resource allocation type
1 [6, TS 38.214]. For an initial UL BWP size of $N_{\text{BWP}}^{\text{size}}$
RBs, a UE processes the frequency domain resource assignment field as follows
\- if $N_{\text{BWP}}^{\text{size}} \leq 180$, or for operation with shared
spectrum channel access in FR1 or for FR2-2 when _ChannelAccessMode2-r17_ is
provided if $N_{\text{BWP}}^{\text{size}} \leq 90$
\- truncate the frequency domain resource assignment field to its $\left\lceil
\text{log}_{2}\left( \frac{N_{\text{BWP}}^{\text{size}} \bullet \left(
N_{\text{BWP}}^{\text{size}} + 1 \right)}{2} \right) \right\rceil$ least
significant bits and interpret the truncated frequency resource assignment
field as for the frequency resource assignment field in DCI format 0_0 as
described in [5, TS 38.212]
\- else
\- insert
\- $\left\lceil \text{log}_{2}\left( \frac{N_{\text{BWP}}^{\text{size}}
\bullet \left( N_{\text{BWP}}^{\text{size}} + 1 \right)}{2} \right)
\right\rceil - 12$ most significant bits, for operation with shared spectrum
channel access in FR1 or for FR2-2 when _ChannelAccessMode2-r17_ is provided;
\- $\left\lceil \text{log}_{2}\left( \frac{N_{\text{BWP}}^{\text{size}}
\bullet \left( N_{\text{BWP}}^{\text{size}} + 1 \right)}{2} \right)
\right\rceil - 14$ most significant bits, otherwise;
with value set to \'0\' after the $N_{UL,hop}$ bits to the frequency domain
resource assignment field, where $N_{UL,hop} = 0$ if the frequency hopping
flag is set to \'0\' and $N_{UL,hop}$ is provided in Table 8.3-1 if the
hopping flag bit is set to \'1\', and interpret the expanded frequency
resource assignment field as for the frequency resource assignment field in
DCI format 0_0 as described in [5, TS 38.212]
\- end if
If _useInterlacePUCCH-PUSCH_ is provided by _BWP-UplinkCommon_ or _BWP-
UplinkDedicated_ , the frequency domain resource allocation is by uplink
resource allocation type 2 [6, TS 38.214]. A UE processes the frequency domain
resource assignment field as follows
\- truncate the frequency domain resource assignment field to the $X = 6$ LSBs
if $\mu = 0$, or to the $X = 5$ LSBs if $\mu = 1$
\- for interlace allocation of a PUSCH transmission, interpret the $X$ MSBs of
the truncated frequency domain resource assignment field for the active UL BWP
as for the $X$ MSBs of the frequency domain resource assignment field in DCI
format 0_0 [6, TS 38.214]
\- for RB set allocation of a PUSCH transmission, the RB set of the active UL
BWP is the RB set of the PRACH transmission associated with the RAR UL grant.
The UE assumes that the RB set is defined as when the UE is not provided
_intraCellGuardBandsUL-List_ [6, TS 38.214]_._
A UE determines whether or not to apply transform precoding as described in
[6, TS 38.214].
For a PUSCH transmission with frequency hopping scheduled by RAR UL grant or
for a Msg3 PUSCH retransmission, the frequency offset for the second hop [6,
TS 38.214] is given in Table 8.3-1.
Table 8.3-1: Frequency offset for second hop of PUSCH transmission with
frequency hopping scheduled by RAR UL grant or of Msg3 PUSCH retransmission
**Number of PRBs in initial UL BWP** Value of $\mathbf{N}_{\mathbf{UL,hop}}$
Hopping Bits Frequency offset for 2^nd^ hop
* * *
$$N_{\text{BWP}}^{\text{size}}  1$ repetitions, within a slot of larger priority index as is subsequently
described in this clause, if any, and then the UE resolves the overlapping for
PUCCH transmissions without repetitions within the slot using the pseudo-code
in clause 9.2.5
\- if the UE determines that a first PUCCH transmission of the smaller
priority index is not dropped and the UCI of the first PUCCH transmission is
not multiplexed in a second PUCCH transmission of larger priority index in an
overlapping slot with _subslotLengthForPUCCH_ symbols, the first PUCCH
transmission is associated with the next overlapping slot with
_subslotLengthForPUCCH_ symbols for PUCCH transmissions with the larger
priority index
\- the UE does not expect a PUCCH transmission that includes UCI of different
priority indexes to overlap with a PUCCH transmission with
$N_{\text{PUCCH}}^{\text{repeat}} > 1$ repetitions after resolving the
overlapping for PUCCH transmissions without repetitions within a slot
\- the UE does not expect a PUCCH transmission with UCI of first and second
priority indexes to overlap with a PUCCH transmission with HARQ-ACK
information of the first priority index, or with a PUCCH transmission or with
a PUSCH transmission of the second priority index when the second priority
index is larger than the first priority index
\- the UE does not expect a PUCCH transmission with HARQ-ACK information of
larger priority index to overlap with more than one PUCCH transmissions with
HARQ-ACK information of smaller priority index
\- third, the UE resolves the overlapping for PUCCH and PUSCH transmissions of
different priority indexes
> \- the UE drops PUSCH transmissions of smaller priority index that overlap
> with a PUCCH transmission with positive SR of larger priority index prior to
> multiplexing UCI in a PUSCH transmission of smaller priority index, if any
>
> \- the UE drops PUSCH transmissions of smaller priority index that overlap
> with a PUCCH transmission with $N_{\text{PUCCH}}^{\text{repeat}} > 1$
> repetitions of larger priority index prior to multiplexing UCI in a PUSCH
> transmission of smaller priority index, if any
>
> \- the UE multiplexes HARQ-ACK information in a PUSCH transmission, as is
> subsequently described in this clause for multiplexing HARQ-ACK information
> from a PUCCH transmission in a PUSCH transmission of a same priority index,
> if a PUCCH transmission with HARQ-ACK information of a first priority index
> overlaps with one or more PUSCH transmissions of a second priority index
> that is different than the first priority index
\- if // this is for cases the UE supports multiplexing information of
different priorities in a PUCCH/PUSCH transmission
\- a PUCCH transmission with HARQ-ACK information, without repetitions, with
smaller priority index overlaps with a PUCCH transmission only with HARQ-ACK
information, without repetitions, with larger priority index, or
\- a PUCCH transmission without repetitions that includes HARQ-ACK information
of smaller priority index overlaps with a PUCCH transmission without
repetitions using a PUCCH resource with PUCCH format 2/3/4 with HARQ-ACK
information and SR of larger priority index, or
\- a PUCCH transmission with HARQ-ACK information, without repetitions, with
smaller or larger priority index overlaps, respectively, with a PUSCH
transmission with larger or smaller priority index
the UE
\- multiplexes HARQ-ACK information of different priority indexes and SR
information of larger priority index, if any, in a same PUCCH transmission of
larger priority index, or multiplexes HARQ-ACK information the UE would
provide in a PUCCH transmission of smaller or larger priority index in a PUSCH
transmission of larger or smaller priority index, respectively, and applies
the procedures in clause 9.2.5.3 or 9.3, respectively, and
\- drops CSI and/or SR carried in the PUCCH transmission of smaller priority
index, if any
\- drops negative SR carried in the PUCCH transmission of larger priority
index, if any, if the UE would multiplex the HARQ-ACK information of larger
priority index in a PUSCH transmission of smaller priority index
\- drops HARQ-ACK information of smaller priority index if the UE would
multiplex the HARQ-ACK information of smaller priority index in a PUSCH
transmission where the UE multiplexes Part 1 CSI reports and Part 2 CSI
reports of larger priority index
\- drops Part 2 CSI reports of smaller priority index if the UE would
multiplex the HARQ-ACK information of smaller and larger priority indexes in a
PUSCH transmission where the UE multiplexes Part 1 CSI reports and Part 2 CSI
reports of smaller priority index
\- drops HARQ-ACK information of smaller priority index if the UE would
multiplex the HARQ-ACK information of smaller priority index in a PUCCH
transmission of larger priority index using a PUCCH resource provided by
_n1PUCCH-AN_
\- drops Part 2 CSI reports of smaller priority index if the UE would
multiplex the HARQ-ACK information of larger priority index in a PUSCH
transmission where the UE multiplexes CG-UCI, Part 1 CSI reports and Part 2
CSI reports of smaller priority index
\- else
\- if the UE would transmit the following channels that would overlap in time
where, if a channel transmission is with repetitions, the following are
applicable per repetition
\- a first PUCCH transmission of larger priority index and a second PUCCH
transmission of smaller priority index
\- a first PUCCH transmission of larger priority index and a second PUSCH
transmission of smaller priority index when the UE cannot simultaneously
transmit the first PUCCH and second PUSCH
\- a first PUCCH transmission of smaller priority index and a second PUSCH
transmission of larger priority index when the UE cannot simultaneously
transmit the first PUCCH and second PUSCH
the UE
\- transmits the PUCCH or the PUSCH of the larger priority index subject to
the limitations for UE transmissions described in clauses 11.1, 11.1.1, 11.2A,
and 15 and
\- does not transmit a PUCCH or a PUSCH of smaller priority index
When a UE determines overlapping for PUCCH and/or PUSCH transmissions of
different priority indexes, other than PUCCH transmissions with SL HARQ-ACK
reports, before considering limitations for transmissions including with
repetitions, if any, as described in clauses 11.1, 11.1.1, 11.2A, 15 and 17.2,
if the UE is not provided _uci-MuxWithDiffPrio_ , the UE first resolves
overlapping for PUCCH and/or PUSCH transmissions of smaller priority index as
described in clauses 9.2.5 and 9.2.6. Then,
\- if a transmission of a first PUCCH of larger priority index scheduled by a
DCI format in a PDCCH reception would overlap in time with a repetition of a
transmission of a second PUSCH or a second PUCCH of smaller priority index,
the UE cancels the repetition of a transmission of the second PUSCH or the
second PUCCH before the first symbol that would overlap with the first PUCCH
transmission
\- if a transmission of a first PUSCH of larger priority index scheduled by a
DCI format in a PDCCH reception would overlap in time with a repetition of the
transmission of a second PUCCH of smaller priority index, the UE cancels the
repetition of the transmission of the second PUCCH before the first symbol
that would overlap with the first PUSCH transmission
where
\- the overlapping is applicable before or after resolving overlapping among
channels of larger priority index, if any, as described in clauses 9.2.5 and
9.2.6
\- any remaining PUCCH and/or PUSCH transmission after overlapping resolution
is subjected to the limitations for UE transmission as described in clauses
11.1, 11.1.1, 11.2A, 15 and 17.2
\- the UE expects that the transmission of the first PUCCH or the first PUSCH,
respectively, would not start before $T_{proc,2}$ after a last symbol of the
corresponding PDCCH reception
\- $T_{proc,2}\ $is the PUSCH preparation time for a corresponding UE
processing capability assuming $d_{2,1} = \ d_{1}$ [6, TS 38.214], based on
$\mu$ and $N_{2}$ as subsequently defined in this clause, and $d_{1}$ is
determined by a reported UE capability
> If a UE is scheduled by a DCI format in a first PDCCH reception to transmit
> a first PUCCH or a first PUSCH of larger priority index that overlaps with a
> second PUCCH or a second PUSCH transmission of smaller priority index that,
> if any, is scheduled by a DCI format in a second PDCCH
\- $T_{proc,2}$ is based on a value of $\mu$ corresponding to the smallest SCS
configuration of the first PDCCH, the second PDCCHs, the first PUCCH or the
first PUSCH, and the second PUCCHs or the second PUSCHs
\- if the overlapping group includes the first PUCCH
\- if _processingType2Enabled_ of _PDSCH-ServingCellConfig_ is set to _enable_
for the serving cell where the UE receives the first PDCCH and for all serving
cells where the UE receives the PDSCHs corresponding to the second PUCCHs, and
if _processingType2Enabled_ of _PUSCH-ServingCellConfig_ is set to _enable_
for the serving cells with the second PUSCHs, $N_{2}\ $is 5 for $\mu = 0$, 5.5
for $\mu = 1$ and 11 for $\mu = 2$
\- else, $N_{2}\ $is 10 for $\mu = 0$_,_ 12 for $\mu = 1$, 23 for $\mu = 2$,
36 for $\mu = 3$, 144 for $\mu = 5$, and 288 for $\mu = 6$;
\- if the overlapping group includes the first PUSCH
\- if _processingType2Enabled_ of _PUSCH-ServingCellConfig_ is set to _enable_
for the serving cells with the first PUSCH and the second PUSCHs and if
_processingType2Enabled_ of _PDSCH-ServingCellConfig_ is set to _enable_ for
all serving cells where the UE receives the PDSCHs corresponding to the second
PUCCHs, $N_{2}\ $is 5 for $\mu = 0$, 5.5 for $\mu = 1$ and 11 for $\mu = 2$
\- else, $N_{2}\ $is 10 for $\mu = 0$_,_ 12 for $\mu = 1$, 23 for $\mu = 2$,
36 for $\mu = 3$, 144 for $\mu = 5$, and 288 for $\mu = 6$;
> If a PUSCH of larger priority index scheduled by a DCI format overlaps in
> time with a PUSCH of smaller priority index with SP-CSI report(s) without a
> corresponding PDCCH in one or more symbols on the same carrier, and if the
> earliest symbol of these PUSCH channels starts no earlier than N~2~+d~2,1~
> symbols after the last symbol of the DCI scheduling the PUSCH of larger
> priority index where d~2,1~ is the maximum of the d~2,1~ associated with
> PUSCH of larger priority index scheduled by a DCI format and the PUSCH of
> smaller priority index with SP-CSI report(s) without a corresponding PDCCH,
> the PUSCH of smaller priority index with SP-CSI report(s) shall not be
> transmitted by the UE. Otherwise, if the timeline requirement is not
> satisfied this is an error case.
If a UE would transmit the following channels, including repetitions if any,
that would overlap in time
\- a first PUCCH of larger priority index with SR and a second PUCCH or PUSCH
of smaller priority index, or
\- a configured grant PUSCH of larger priority index and a PUCCH of smaller
priority index, or
\- a first PUCCH of larger priority index with HARQ-ACK information only in
response to PDSCH(s) reception without corresponding PDCCH(s) and a second
PUCCH of smaller priority index with HARQ-ACK information only in response to
PDSCH(s) reception without corresponding PDCCH(s), or a second PUCCH of
smaller priority index with SR and/or CSI, or a configured grant PUSCH with
smaller priority index, or a PUSCH of smaller priority index with SP-CSI
report(s) without a corresponding PDCCH, or
\- a PUSCH of larger priority index with SP-CSI report(s) without a
corresponding PDCCH and a PUCCH of smaller priority index with SR, or CSI, or
HARQ-ACK information only in response to PDSCH(s) reception without
corresponding PDCCH(s), or
\- a configured grant PUSCH of larger priority index and a configured grant
PUSCH of smaller priority index or a PUSCH of smaller priority index with SP-
CSI report(s) without a corresponding PDCCH on a same serving cell
\- a PUSCH of larger priority index with SP-CSI report(s) without a
corresponding PDCCH and a configured grant PUSCH of smaller priority index or
a PUSCH of smaller priority index with SP-CSI report(s) without a
corresponding PDCCH on a same serving cell
\- a PUSCH of smaller priority index scheduled by a DCI format and a
configured grant PUSCH of larger priority index on a same serving cell if the
UE is provided _prioLowDG-HighCG_
\- a PUSCH of larger priority index scheduled by a DCI format and a configured
grant PUSCH of smaller priority index on a same serving cell if the UE is
provided _prioHighDG-LowCG_
> the UE is expected to cancel a repetition of the PUCCH/PUSCH transmissions
> of smaller priority index before the first symbol overlapping with the
> PUCCH/PUSCH transmission of larger priority index if the repetition of the
> PUCCH/PUSCH transmissions of smaller priority index overlaps in time with
> the PUCCH/PUSCH transmissions of larger priority index. In case of a PUSCH
> of larger priority index scheduled by a DCI format in a PDCCH reception and
> a configured grant PUSCH of smaller priority index on a same serving cell
> and the UE is provided _prioHighDG-LowCG_
\- the UE expects that the transmission of the PUSCH of larger priority index
would not start before $T_{proc,2}$ after a last symbol of the corresponding
PDCCH reception
\- $T_{proc,2}\ $is the PUSCH preparation time for a corresponding UE
processing capability assuming $d_{2,1} = \ d_{1} + d_{3}$ [6, TS 38.214],
based on $\mu$ and $N_{2}$ as subsequently defined in this clause, and $d_{1}$
and $d_{3}$ are determined by a reported UE capability
When a UE determines overlapping for PUCCH transmissions with SL HARQ-ACK
reports and PUSCH of smaller priority index, including repetitions if any,
after resolving the overlapping PUCCH other than PUCCH transmissions with SL
HARQ-ACK reports and/or PUSCH transmissions, if the PUSCH includes no UCI, the
UE resolves the overlapping for PUCCH transmissions with SL HARQ-ACK reports
and PUSCH of smaller priority index as described in clauses 9.2.5 and 9.2.6.
When a UE determines overlapping for PUCCH transmissions with SL HARQ-ACK
reports and PUSCH of larger priority index only, including repetitions if any,
after resolving the overlapping PUCCH other than PUCCH transmissions with SL
HARQ-ACK reports and/or PUSCH transmissions, the UE does not transmit the
PUCCH with SL HARQ-ACK reports
where
> \- the UE expects that the transmission of the PUSCH would not start before
> $T_{\text{proc},2} + d_{1}$ after a last symbol of the corresponding PDCCH
> reception;
>
> \- $T_{\text{proc},2}\ $is the PUSCH preparation time for a corresponding UE
> processing capability assuming $d_{2,1} = 0$ [6, TS 38.214], based on $\mu$
> and $N_{2}$ as subsequently defined in this clause, and $d_{1}$ is
> determined by a reported UE capability.
The UE expects the PUCCH and PUSCH transmissions to fulfill the conditions in
clause 9 and clause 9.2.5 for UCI multiplexing replacing the reference time of
\"end of PDSCH\" with \"end of the last symbol of a last PSFCH reception
occasion\" as described in 16.5 and _T~proc,~_ ~1~ with _T~prep~_.
A UE does not expect that a PUCCH carrying SL HARQ-ACK reports overlaps with
PUSCH with aperiodic or semi-persistent CSI reports.
A UE does not expect to be scheduled to transmit a PUCCH or a PUSCH with
smaller priority index that would overlap in time with a PUCCH of larger
priority index with HARQ-ACK information only in response to a PDSCH reception
without a corresponding PDCCH unless the UE is provided _uci-MuxWithDiffPrio_.
A UE does not expect to be scheduled to transmit a PUCCH of smaller priority
index that would overlap in time with a PUSCH of larger priority index with
SP-CSI report(s) without a corresponding PDCCH unless the UE is provided _uci-
MuxWithDiffPrio_.
In the remaining of this clause, a UE multiplexes UCIs with same priority
index in a PUCCH or a PUSCH before considering limitations for UE transmission
as described in clauses 11.1, 11.1.1, 11.2A, 15 and 17.2. A PUCCH or a PUSCH
is assumed to have a same priority index as a priority index of UCIs a UE
multiplexes in the PUCCH or the PUSCH.
In the remaining of this clause, the multiplexing or prioritization for
overlapping channels are for overlapping channels with same priority index or
for overlapping channels with a PUCCH carrying SL HARQ-ACK information unless
stated otherwise.
In the remaining of this clause, if a UE is provided _subslotLengthForPUCCH
for a cell for PUCCH transmission_ , a slot for an associated PUCCH resource
of a PUCCH transmission with HARQ-ACK information on the cell includes a
number of symbols indicated by _subslotLengthForPUCCH, unless stated
otherwise_.
If a UE would transmit on a serving cell a PUSCH without UL-SCH that overlaps
with a PUCCH transmission on a serving cell that includes positive SR
information, the UE does not transmit the PUSCH.
If a UE would transmit CSI reports on overlapping physical channels, the UE
applies the priority rules described in [6, TS 38.214] for the multiplexing of
CSI reports.
If a UE
\- would multiplex UCI in a PUCCH transmission that overlaps with a PUSCH
transmission, and
\- the PUSCH and PUCCH transmissions fulfil the conditions in clause 9.2.5 for
UCI multiplexing,
the UE
\- multiplexes only HARQ-ACK information, if any, from the UCI in the PUSCH
transmission and does not transmit the PUCCH if the UE multiplexes aperiodic
or semi-persistent CSI reports in the PUSCH;
\- multiplexes only HARQ-ACK information and CSI reports, if any, from the UCI
in the PUSCH transmission and does not transmit the PUCCH if the UE does not
multiplex aperiodic or semi-persistent CSI reports in the PUSCH.
A UE does not expect to multiplex in a PUSCH transmission in one slot with SCS
configuration $\mu_{1}$ UCI of same type that the UE would transmit in PUCCHs
in different slots with SCS configuration $\mu_{2}$ if $\mu_{1}  \- a first HARQ-ACK codebook is associated with a PUCCH of priority index 0
> and a second HARQ-ACK codebook is associated with a PUCCH of priority index
> 1
>
> \- the UE is provided first and second for each of {_PUCCH-Config_ , _UCI-
> OnPUSCH_ , _PDSCH_ -_codeBlockGroupTransmission_} by {_PUCCH-
> ConfigurationList_ , _UCI-OnPUSCH-ListDCI-0-1_ , _PDSCH-
> CodeBlockGroupTransmissionList_} or {_PUCCH-ConfigurationList_ , _UCI-
> OnPUSCH-ListDCI-0-2_ , _PDSCH-CodeBlockGroupTransmissionList_},
> respectively, for use with the first and second HARQ-ACK codebooks,
> respectively
If a UE receives a PDSCH without receiving a corresponding PDCCH, or if the UE
receives a PDCCH indicating a SPS PDSCH release, the UE generates one
corresponding HARQ-ACK information bit. If the UE generates two HARQ-ACK
codebooks, the UE is indicated by _harq-CodebookID_ , per SPS PDSCH
configuration, a HARQ-ACK codebook index for multiplexing the corresponding
HARQ-ACK information bit.
If a UE is provided _pdsch-HARQ-ACK-OneShotFeedback and the UE detects a_ DCI
format in any PDCCH monitoring occasion that includes a One-shot HARQ-ACK
request field with value 1
\- the UE includes the HARQ-ACK information in a Type-3 HARQ-ACK codebook, as
described in clause 9.1.4
\- the UE does not expect that the PDSCH-to-HARQ_feedback timing indicator
field of the DCI format provides an inapplicable value from _dl-DataToUL-
ACK-r16_ or _dl-DataToUL-ACK-r17_
In the remaining of this clause, reference is to one HARQ-ACK codebook and to
DCI formats that schedule PDSCH reception, or have associated HARQ-ACK
information without scheduling a PDSCH reception and are associated with the
HARQ-ACK codebook.
If a UE is required to receive SPS PDSCHs in a slot according to Clause 5.1 of
[6] and Clause 11.1 for SPS configurations that are indicated to be released
by a DCI format, the UE is not expected to receive the DCI format in the slot
if the end of the last symbol of the PDCCH reception is after the end of a
last symbol of any of the SPS PDSCH receptions. For a SPS configuration
subject to _pdsch-AggregationFactor_ or _pdsch-AggregationFactor-r16_ , the UE
is not expected to receive the DCI format in a slot containing a SPS PDSCH
transmission occasion other than the first transmission occasion required to
be received by the UE for a TB.
If a UE is configured to receive SPS PDSCHs in a slot for SPS configurations
that are indicated to be released by a DCI format, and if the UE receives the
PDCCH providing the DCI format in the slot, and if HARQ-ACK information for
the SPS PDSCH release and the SPS PDSCH receptions would be multiplexed in a
same PUCCH, the UE does not expect to receive the SPS PDSCHs, does not
generate HARQ-ACK information for the SPS PDSCH receptions, and generates a
HARQ-ACK information bit for the SPS PDSCH release.
If a UE is configured to receive SPS PDSCH(s) in a slot for SPS
configuration(s), the UE does not expect to receive a PDCCH providing a DCI
format in the slot to indicate SPS PDSCH release of these SPS
configuration(s), if HARQ-ACK information for the SPS PDSCH release and the
SPS PDSCH reception(s) would map to different PUCCHs.
If a UE detects a DCI format 1_1 indicating
\- SCell dormancy without scheduling a PDSCH reception, as described in clause
10.3, and
\- is provided _pdsch-HARQ-ACK-Codebook = dynamic_ _or pdsch-HARQ-ACK-
Codebook-r16_
the UE generates a HARQ-ACK information bit as described in clause 9.1.3 for a
DCI format 1_1 indicating SCell dormancy and the HARQ-ACK information bit
value is ACK.
If a UE is not provided _PDSCH-CodeBlockGroupTransmission_ , the UE generates
one HARQ-ACK information bit per transport block.
For a HARQ-ACK information bit, a UE generates a positive acknowledgement
(ACK) if the UE detects a DCI format that provides a SPS PDSCH release or
detects a DCI format that does not schedule PDSCH reception and indicates a
TCI state update or correctly decodes a transport block, and generates a
negative acknowledgement (NACK) if the UE does not correctly decode the
transport block. A HARQ-ACK information bit value of 0 represents a NACK while
a HARQ-ACK information bit value of 1 represents an ACK.
In the following, the CRC for a DCI format is scrambled with a C-RNTI, an MCS-
C-RNTI, or a CS-RNTI, or a G-RNTI, or a G-CS-RNTI.
In the following, if the value of _maxNrofCodeWordsScheduledByDCI_ is not
provided, the value of _maxNrofCodeWordsScheduledByDCI_ equals one.
### 9.1.1 CBG-based HARQ-ACK codebook determination
If a UE is provided _PDSCH-CodeBlockGroupTransmission_ for a serving cell, the
UE receives a PDSCH scheduled by DCI format 1_1, that includes code block
groups (CBGs) of a transport block. The UE is also provided
_maxCodeBlockGroupsPerTransportBlock_ indicating a maximum number
{width="0.6375in" height="0.25277777777777777in"} of CBGs for generating
respective HARQ-ACK information bits for a transport block reception for the
serving cell.
For a number of code blocks (CBs) in a transport block, the UE determines a
number of CBGs according to clause 5.1.7.1 of [6, TS 38.214] and determines a
number of HARQ-ACK bits for the transport block as .
The UE generates an ACK for the HARQ-ACK information bit of a CBG if the UE
correctly received all code blocks of the CBG and generates a NACK for the
HARQ-ACK information bit of a CBG if the UE incorrectly received at least one
code block of the CBG. If the UE receives two transport blocks, the UE
concatenates the HARQ-ACK information bits for CBGs of the second transport
block after the HARQ-ACK information bits for CBGs of the first transport
block.
The HARQ-ACK codebook includes the HARQ-ACK information bits and, if for a
transport block, the UE generates a NACK value for the last HARQ-ACK
information bits for the transport block in the HARQ-ACK codebook.
If the UE generates a HARQ-ACK codebook in response to a retransmission of a
transport block, corresponding to a same HARQ process as a previous
transmission of the transport block, the UE generates an ACK for each CBG that
the UE correctly decoded in a previous transmission of the transport block.
If a UE correctly detects each of the CBGs and does not correctly detect the
transport block for the CBGs, the UE generates a NACK value for each of the
CBGs.
### 9.1.2 Type-1 HARQ-ACK codebook determination
This clause applies if the UE is configured with _pdsch-HARQ-ACK-Codebook =
semi-static_. In clauses 9.1.2, 9.1.2.1, and 9.1.2.2, if the UE is configured
with _pdsch-HARQ-ACK-Codebook = semi-static_ for only one of unicast or
multicast HARQ-ACK codebook, the Type-1 HARQ-ACK codebook is generated
considering only one of respective unicast or multicast configurations for
PDSCH receptions or for PDCCH monitoring for detection of DCI formats.
A UE does not provide a Type-1 HARQ-ACK codebook if the Type-1 HARQ-ACK
codebook would include only HARQ-ACK information for transport blocks
associated with HARQ processes with disabled HARQ-ACK information.
If a UE is provided _downlinkHARQ-FeedbackDisabled_ indicating disabled HARQ-
ACK information for a HARQ process associated with a transport block in PDSCH
reception occasion $m$ on serving cell $c$, the UE reports a NACK value for a
HARQ-ACK information bit corresponding to the transport block in a Type-1
HARQ-ACK codebook and does not consider the transport block as received in the
determination of $N_{m,c}^{\text{received}}$ in clause 9.1.2.1. If the UE is
also provided _PDSCH-CodeBlockGroupTransmission, the UE reports_ NACK values
for HARQ-ACK information bits corresponding to CBGs of the transport block in
the Type-1 HARQ-ACK codebook and does not consider the CBGs as received in the
determination of $N_{m,c}^{received,CBG}$ in clause 9.1.2.1. If the UE is also
provided _harq-feedbackEnablingforSPSactive_ = \'_enabled\'_ , the UE
considers a HARQ process associated with a transport block in a first SPS
PDSCH reception, after an activation of SPS PDSCH receptions, to have enabled
HARQ-ACK information and the UE provides a HARQ-ACK information bit according
to a decoding outcome for the transport block in the first SPS PDSCH
reception.
If a UE reports HARQ-ACK information associated with a G-RNTI for multicast or
a G-CS-RNTI with disabled HARQ-ACK information, as described in clause 18, a
value of the HARQ-ACK information is a UE implementation choice.
A UE reports HARQ-ACK information for a corresponding PDSCH reception or SPS
PDSCH release or TCI state update only in a HARQ-ACK codebook that the UE
transmits in a slot indicated by a value of a PDSCH-to-HARQ_feedback timing
indicator field in a corresponding DCI format or provided by _dl-DataToUL-ACK_
or _dl-DataToUL-ACK-r16_ or _dl-DataToUL-ACK-DCI-1-2_ or _dl-DataToUL-ACK-r17_
or _**dl-DataToUL-ACK-DCI-1-2** -r17_ if the PDSCH-to-HARQ_feedback timing
indicator field is not present in the DCI format as described in clause 9.2.3.
The UE reports NACK value(s) for HARQ-ACK information bit(s) in a HARQ-ACK
codebook that the UE transmits in a slot not indicated by a value of a PDSCH-
to-HARQ_feedback timing indicator field in a corresponding DCI format.
If a UE is not provided _pdsch-HARQ-ACK-OneShotFeedback_ , the UE does not
expect to receive a PDSCH scheduled by a DCI format that the UE detects in any
PDCCH monitoring occasion and includes a PDSCH-to-HARQ_feedback timing
indicator field providing an inapplicable value from _dl-DataToUL-ACK-r16 or
dl-DataToUL-ACK-r17_.
If the UE is provided _pdsch-AggregationFactor-r16_ in _SPS-Config_ , or
_pdsch-AggregationFactor_ in _PDSCH-Config_ and no entry in _pdsch-
TimeDomainAllocationList and pdsch-TimeDomainAllocationListDCI-1-2 includes
repetitionNumber_ in _PDSCH-TimeDomainResourceAllocation-r16_ ,
$N_{\text{PDSCH}}^{repeat,max}$ is a maximum value of _pdsch-
AggregationFactor-r16_ in _SPS-Config_ , or _pdsch-AggregationFactor_ in
_PDSCH-Config_ ; otherwise $N_{\text{PDSCH}}^{repeat,max} = 1$. The UE reports
HARQ-ACK information for a PDSCH reception
\- from DL slot ${n_{D} - N}_{\text{PDSCH}}^{\text{repeat}} + 1$ to DL slot
$n_{D}$, if $N_{\text{PDSCH}}^{\text{repeat}}$ is provided by _pdsch-
AggregationFactor_ or _pdsch-AggregationFactor-r16_ [6, TS 38.214], or
\- from DL slot $\ n_{D} - repetitionNumber + 1$ to DL slot $n_{D}$, if the
_time domain resource assignment_ field in the DCI format scheduling the PDSCH
reception indicates an entry containing _repetitionNumber,_ or
\- in DL slot $n_{D}$, otherwise
only in a HARQ-ACK codebook that the UE includes in a PUCCH or PUSCH
transmission in slot $n + k$, where $n$ is
\- an UL slot overlapping with the end of the PDSCH reception in DL slot
$n_{D}$ if the UE is provided _subslotLengthForPUCCH_ for the HARQ-ACK
codebook
\- the UL slot is on the primary cell if the UE is provided _pucch-
sSCellPattern_ ; otherwise, the UL slot is on the serving cell of the PUCCH
transmission
\- the last UL slot for PUCCH transmission overlapping with DL slot $n_{D}$ if
the UE is not provided _subslotLengthForPUCCH_ for the HARQ-ACK codebook
\- the last UL slot is on the primary cell if the UE is provided _pucch-
sSCellPattern_ ; otherwise, the last UL slot is on the serving cell of the
PUCCH transmission
and $k$ is a number of slots indicated by the PDSCH-to-HARQ_feedback timing
indicator field in a corresponding DCI format, or provided by _dl-DataToUL-
ACK_ or _dl-DataToUL-ACK-r16_ or _dl-DataToUL-ACK-DCI-1-2_ or _dl-DataToUL-
ACK-r17_ or _dl-DataToUL-ACK-DCI-1-2-r17_ if the PDSCH-to-HARQ_feedback timing
indicator field is not present in the DCI format. If the UE reports HARQ-ACK
information for the PDSCH reception in a slot other than slot $n + k$, the UE
sets a value for each corresponding HARQ-ACK information bit to NACK.
If a UE reports HARQ-ACK information in a PUCCH only for
\- a SPS PDSCH release indicated by DCI format 1_0 or by DCI format 4_1, with
counter DAI field value of 1, or
\- a PDSCH reception providing a transport block with enabled HARQ-ACK
information scheduled by DCI format 1_0 or by DCI format 4_1 having enabled
associated HARQ-ACK information report as described in clause 18, with counter
DAI field value of 1 on the PCell, or
\- SPS PDSCH receptions associated with a CS-RNTI or with G-CS-RNTIs having
enabled associated HARQ-ACK information reports as described in clause 18
within the $M_{\text{A,c}}$ occasions for candidate PDSCH receptions as
determined in clause 9.1.2.1, the UE determines a HARQ-ACK codebook only for
the SPS PDSCH release, or only for the PDSCH reception, or only for SPS PDSCH
receptions according to corresponding $M_{\text{A,c}}$ occasions on respective
serving cells, where the value of counter DAI in DCI format 1_0 or in DCI
format 4_1 is according to Table 9.1.3-1 and HARQ-ACK information bits in
response to more than one SPS PDSCH receptions that the UE is configured to
receive are ordered according to the following pseudo-code; otherwise, the
procedures in clause 9.1.2.1 and clause 9.1.2.2 for a HARQ-ACK codebook
determination apply.
In the following pseudo-code, SPS PDSCH receptions associated with a SPS PDSCH
configuration are activated by a DCI format with CRC scrambled by a CS-RNTI or
by a DCI format with CRC scrambled by a G-CS-RNTI.
Set $N_{\text{cells}}^{\text{DL}}$ to the number of serving cells configured
to the UE
Set $N_{c}^{\text{SPS}}$ to the number of SPS PDSCH configurations configured
to the UE for serving cell $c$
Set $N_{c}^{\text{DL}}$ to the number of DL slots for SPS PDSCH receptions on
serving cell $c$ with HARQ-ACK information multiplexed on the PUCCH
Set $j = 0$ -- HARQ-ACK information bit index
Set $c = 0$ -- serving cell index: lower indexes correspond to lower RRC
indexes of corresponding cell
while $c  a UE is configured to receive SPS PDSCHs from slot $n_{D} -
> N_{\text{PDSCH}}^{\text{repeat}} + 1$ to slot $n_{D}$ for SPS PDSCH
> configuration $s$ on serving cell $c$, excluding SPS PDSCHs that are not
> required to be received in any slot among overlapping SPS PDSCHs, if any
> according to [6, TS 38.214], or based on a UE capability for a number of
> PDSCH receptions in a slot according to [6, TS 38.214], or due to
> overlapping with a set of symbols indicated as uplink by _tdd-UL-DL-
> ConfigurationCommon_ or by _tdd-UL-DL-ConfigurationDedicated_ where, for
> unicast SPS PDSCHs, $N_{\text{PDSCH}}^{\text{repeat}}$ is provided by
> _pdsch-AggregationFactor-r16_ in _SPS-Config or_ , if _pdsch-
> AggregationFactor-r16_ is not included in _SPS-Config_ , by _pdsch-
> AggregationFactor_ in _PDSCH-config and,_ for multicast SPS PDSCHs,
> $N_{\text{PDSCH}}^{\text{repeat}}$ is provided by $\text{repetitionNumber}$
> if contained in an entry indicated by the time domain resource assignment
> field in the DCI format scheduling the PDSCH repetition, or provided by
> _pdsch-AggregationFactor-r16_ if included in _SPS-Config_ or, _otherwise,_
> $N_{\text{PDSCH}}^{\text{repeat}} = 1$_,_ and
>
> HARQ-ACK information for the SPS PDSCH is associated with the PUCCH
>
> }
>
> ${\widetilde{o}}_{j}^{\text{ACK}}$ = HARQ-ACK information bit for this SPS
> PDSCH reception
>
> $j = j + 1$;
end if
$n_{D} = n_{D} + 1$;
end while
$s = s + 1$;
end while
$c = c + 1$;
end while
#### 9.1.2.1 Type-1 HARQ-ACK codebook in physical uplink control channel
For a serving cell $c$, an active DL BWP, and an active UL BWP, as described
in clause 12, the UE determines a set of $M_{A,c}$ occasions for candidate
PDSCH receptions for which the UE can transmit corresponding HARQ-ACK
information in a PUCCH in slot $n_{U}$. If serving cell $c$ is deactivated,
the UE uses as the active DL BWP for determining the set of $M_{A,c}$
occasions for candidate PDSCH receptions a DL BWP provided by
_firstActiveDownlinkBWP-Id_. The determination is based:
a) on a set of slot timing values $K_{1}$ associated with the active UL BWP on
the primary cell or, if the PUCCH transmission is indicated by a DCI format to
be on the PUCCH-sSCell as described in clause 9A, on a set of slot timing
values $K_{1}$ associated with the active UL BWP on the PUCCH-sSCell
\- If the UE is configured to monitor PDCCH for DCI format 1_0 and is not
configured to monitor PDCCH for either DCI format 1_1 or DCI format 1_2 for
serving cell $c$, or the active DL BWP for serving cell $c$ is dormant BWP,
$K_{1}$ is provided by the slot timing values {1, 2, 3, 4, 5, 6, 7, 8} for SCS
configuration of PUCCH transmission $\mu \leq 3$, {_7, 8, 12, 16, 20, 24, 28,
32} for_ $\mu = 5$, and _{13, 16, 24, 32, 40, 48, 56, 64} for_ $\mu = 6$
\- If the UE is configured to monitor PDCCH for DCI format 1_1 and is not
configured to monitor PDCCH for DCI format 1_2 for serving cell $c$, $K_{1}$
is provided by _dl-DataToUL-ACK_ or _dl-DataToUL-ACK-r16_ or _dl-DataToUL-
ACK-r17_
\- If the UE is configured to monitor PDCCH for DCI format 1_2 and is not
configured to monitor PDCCH for DCI format 1_1 for serving cell $c$, $K_{1}$
is provided by _dl-DataToUL-ACK-DCI-1-2_ or _dl-DataToUL-ACK-DCI-1-2-r17_
\- If the UE is configured to monitor PDCCH for DCI format 1_1 and DCI format
1_2 for serving cell $c$, $K_{1}$ is provided by the union of _dl-DataToUL-
ACK_ or _dl-DataToUL-ACK-r16_ or _dl-DataToUL-ACK-r17_ and _dl-DataToUL-ACK-
DCI-1-2 o_ r _dl-DataToUL-ACK-DCI-1-2-r17_
\- _If_ an inapplicable value in _dl-DataToUL-ACK-r16_ or _dl-DataToUL-ACK-r17
is provided, the value is excluded from_ $K_{1}$
\- If the UE is configured to monitor PDCCH for multicast DCI formats for
serving cell $c$
\- if the UE is provided _fdmed-ReceptionMulticast_ or if the UE is not
provided _type1CodebookGenerationMode =_ \'mode1\'
\- if the UE is configured to monitor PDCCH for DCI format 4_2, _dl-DataToUL-
ACK_ is provided by _pucch-ConfigMulticast1/pucch-ConfigurationListMulticast1_
if provided; otherwise, by _pucch-Config/pucch-ConfigurationList_
\- if UE is configured to monitor PDCCH for DCI format 4_1, $K_{1}$ for
multicast, $K_{1,M}$, is provided by the union of _dl-DataToUL-ACK_ and _dl-
DataToUL-ACK-MulticastDCI-Format4-1, if provided; otherwise,_ by the union of
_dl-DataToUL-ACK_ and the slot timing values {1, 2, 3, 4, 5, 6, 7, 8}
\- otherwise, $K_{1,M}$ is provided by _dl-DataToUL-ACK_
\- otherwise, $K_{1,M}$ is provided by _dl-DataToUL-ACK-ForDCI Format4-1 if
provided; otherwise,_ by the slot timing values {1, 2, 3, 4, 5, 6, 7, 8}
\- else, if the UE is provided _type1CodebookGenerationMode =_ \'mode1\', the
UE
\- determines a first $K_{1,\text{UM}}$ set as $K_{1} \cap K_{1,M}$, a second
$K_{1,U\backslash M}$ set as $K_{1}\backslash K_{1,\text{UM}}$, and a third
$K_{1,M\backslash U}$ set as $K_{1,M}\backslash K_{1,\text{UM}}$
\- if the UE is configured to monitor PDCCH for DCI format 4_2, _dl-DataToUL-
ACK is provided by pucch-ConfigMulticast1/pucch-ConfigurationListMulticast1_
if provided; otherwise, by _pucch-Config/pucch-ConfigurationList_
\- if UE is configured to monitor PDCCH for DCI format 4_1, $K_{1,M}$ is
provided by the union of _dl-DataToUL-ACK_ _and_ _dl-DataToUL-ACK-
MulticastDCI-Format4-1, if provided; otherwise,_ by the union of _dl-DataToUL-
ACK_ and the slot timing values {1, 2, 3, 4, 5, 6, 7, 8}
\- otherwise, $K_{1,M}$ is provided by _dl-DataToUL-ACK_
\- otherwise, $K_{1,M}$ is provided by _dl-DataToUL-ACK-ForDCI Format4-1 if
provided; otherwise,_ by the slot timing values {1, 2, 3, 4, 5, 6, 7, 8}
b) on a set of row indexes $R$ of a table that is associated with the active
DL BWP and defining respective sets of slot offsets $K_{0}$, start and length
indicators _SLIV_ , and PDSCH mapping types for PDSCH reception as described
in [6, TS 38.214], where the row indexes $R$ of the table are provided by
\- the union of row indexes of time domain resource allocation tables for DCI
formats the UE is configured to monitor PDCCH for serving cell $c$ if the UE
is not configured to monitor PDCCH for multicast DCI formats for serving cell
$c$, or is not provided _type1CodebookGenerationMode =_ \'mode1\' and is not
provided _fdmed-ReceptionMulticast_ , or, if any, for the first
$K_{1,\text{UM}}$ set
\- the union of row indexes of time domain resource allocation tables for DCI
format 1_0 and/or DCI format 1_1 and/or DCI format 1_2 for serving cell $c$ if
UE is provided _fdmed-ReceptionMulticast,_ or for the second $K_{1,U\backslash
M}$ set, if any
\- the union of row indexes of time domain resource allocation tables for
multicast DCI formats the UE is configured to monitor PDCCH for serving cell
$c$ if UE is provided _fdmed-ReceptionMulticast, or_ for the third
$K_{1,M\backslash U}$ set, if any
\- if the UE is provided _referenceOfSLIVDCI-1-2_ , for each row index with
slot offset $K_{0} = 0$ and PDSCH mapping Type B in a set of row indexes of a
table for DCI format 1_2 [6, TS 38.214], for any PDCCH monitoring occasion in
any slot where the UE monitors PDCCH for DCI format 1_2 and with starting
symbol $S_{0} > 0$, if ${S + S}_{0} + L \leq 14$ for normal cyclic prefix and
${S + S}_{0} + L \leq 12$ for extended cyclic prefix, add a new row index in
the set of row indexes of the table by replacing the starting symbol $S$ of
the row index by ${S + S}_{0}$
c) on the ratio $2^{\mu_{\text{D}\text{L}} - \mu_{\text{U}\text{L}}}$ between
the downlink SCS configuration $\mu_{\text{D}\text{L}}$ and the uplink SCS
configuration $\mu_{\text{U}\text{L}}$ provided by _subcarrierSpacing_ in
_BWP-Downlink_ and _BWP-Uplink_ for the active DL BWP and the active UL BWP,
respectively
d) if provided, on _tdd-UL-DL-ConfigurationCommon_ and _tdd-UL-DL-
ConfigurationDedicated_ as described in clause 11.1
e) if _ca-SlotOffset is_ provided, on
$N_{\text{slot,offset,}\text{c}}^{\text{DL}}\ $_and_
$\mu_{\text{offset}\text{,}\text{DL}\text{,c}}$ provided by _ca-SlotOffset_
for serving cell $c$, _or on_ $N_{\text{slot,offset}}^{\text{UL}}\ $ and
$\mu_{\text{offset}\text{,}\text{U}\text{L}}$ provided by _ca-SlotOffset_ for
the primary cell, as described in [4, TS 38.211].
If a UE
\- is not provided _coresetPoolIndex_ or is provided _coresetPoolIndex_ with a
value of 0 for first CORESETs on active DL BWPs of serving cells, and
\- is provided _coresetPoolIndex_ with a value of 1 for second CORESETs on
active DL BWPs of the serving cells, and
\- is provided _ackNackFeedbackMode_ = _joint_
where
\- a serving cell is placed in a first set $S_{\text{0}}$ of
$N_{\text{cells}}^{\text{DL,0}}$ serving cells if the serving cell includes a
first CORESET, and
\- a serving cell is placed in a second set $S_{\text{1}}$ of
$N_{\text{cells}}^{\text{DL,1}}$ serving cells if the serving cell includes a
second CORESET, and
\- serving cells are placed in a set according to an ascending order of a
serving cell index
the UE generates a Type-1 HARQ-ACK codebook for the set $S_{\text{0}}$ and the
set $S_{1}$ of serving cells separately by setting
${N_{\text{cells}}^{\text{DL}} = N}_{\text{cells}}^{\text{DL,0}}$ and
${N_{\text{cells}}^{\text{DL}} = N}_{\text{cells}}^{\text{DL,1}}$ in the
following pseudo-code. The UE concatenates the HARQ-ACK codebook generated for
the set $S_{\text{0}}$ followed by the HARQ-ACK codebook generated for the set
$S_{1}$ to obtain a total number of $O_{\text{ACK}}$ HARQ-ACK information
bits.
If a UE is provided _fdmed-ReceptionMulticast_ and the UE is configured to
monitor PDCCH for detection of unicast DCI formats and to monitor PDCCH for
detection of multicast DCI formats
\- a serving cell is placed in a first set $S_{\text{U}}$ of
$N_{\text{cells}}^{\text{DL,U}}$ serving cells if the UE is configured to
monitor PDCCH for DCI formats 1_0/1_1/1_2 for scheduling on serving cell $c$,
and
\- a serving cell is placed in a second set $S_{\text{M}}$ of
$N_{\text{cells}}^{\text{DL,}\text{M}}$ serving cells if the UE is configured
to monitor PDCCH for detection of DCI format 4_1/4_2 for scheduling on serving
cell $c$, and
\- serving cells are placed in a set according to an ascending order of a
serving cell index
the UE generates a Type-1 HARQ-ACK codebook for the set $S_{\text{U}}$ and the
set $S_{M}$ of serving cells separately by setting
${N_{\text{cells}}^{\text{DL}} = N}_{\text{cells}}^{\text{DL,U}}$ and using
the _maxNrofCodeWordsScheduledByDCI_ provided in _PDSCH-config_ and
${N_{\text{cells}}^{\text{DL}} = N}_{\text{cells}}^{\text{DL,M}}$ and using
the _maxNrofCodeWordsScheduledByDCI_ provided in _PDSCH-configMulticast_ in
the following pseudo-code. The UE concatenates the HARQ-ACK codebook generated
for the set $S_{\text{U}}$ followed by the HARQ-ACK codebook generated for the
set $S_{M}$ to obtain a total number of $O_{\text{ACK}}$ HARQ-ACK information
bits.
If the UE is configured to monitor PDCCH for DCI formats with CRC scrambled by
G-RNTI for multicast or G-CS-RNTI and is provided _type1-Codebook-Generation-
Mode_ = \'mode1\', the UE separately applies the following pseudo-code for
each of the first $K_{1,\text{UM}}$ set, the second $K_{1,U\backslash M}$ set,
and third $K_{1,M\backslash U}$ set as the set of slot timing values $K_{1}$,
and for the corresponding sets of row indexes as $R$ to obtain first, second,
and third Type-1 HARQ-ACK sub-codebooks, and concatenates the first, second,
and third, Type-1 HARQ-ACK sub-codebooks to obtain the Type-1 HARQ-ACK
codebook.
If the UE is configured to monitor PDCCH for DCI formats with CRC scrambled by
G-RNTI for multicast or G-CS-RNTI and is not provided _fdmed-
ReceptionMulticast_ , the UE generates a Type-1 HARQ-ACK codebook using the
maximum value of _maxNrofCodeWordsScheduledByDCI_ in _PDSCH-config_ and
_PDSCH-configMulticast_ in the following pseudo-code.
If _timeDomainHARQ-BundlingType1_ is provided
\- set $R_{T}^{'} = R$
\- set $R_{T}$ to the set of row indexes that include the last SLIV of each
row of set $R_{T}^{'}$
If the set of rows $R$ includes a row with more than one SLIV entry as
described in [6, TS 38.214] and _timeDomainHARQ-BundlingType1_ is not
provided, the set of rows $R$ and the set of slot timing values $K_{1}$ are
updated in this clause according to the following pseudo-code.
set $R$ to the set of rows
set $\text{C}\left( R \right)$ to the cardinality of $R$
set $r = 0$ -- index of row in set $R$
set $R_{\text{T}} = \varnothing$
set $K_{1,T} = \varnothing$
while $r  if _pdsch-TimeDomainAllocationListForMultiPDSCH_ and _timeDomainHARQ-
> BundlingType1_ are provided for serving cell $c$
$R = R_{\text{T}}$;
$R' = R_{T}^{'}$;
> elseif _pdsch-TimeDomainAllocationListForMultiPDSCH_ is provided and
> _timeDomainHARQ-BundlingType1_ is not provided for serving cell $c$
$R = R_{\text{T}}$;
else
Set $R$ to the set of rows
end if
Set $\text{C}\left( R \right)$ to the cardinality of $R$
Set $r = 0$ -- index of row in set $R$
> if slot $n_{\text{U}}$ starts at a same time as or after a slot for an
> active DL BWP change on serving cell $c$ or an active UL BWP change on the
> serving cell of PUCCH transmission if the UE is provided _pucch-sSCellDyn_
> or _pucch-sSCellDynDCI-1-2_ , or an active UL BWP change on the PCell if the
> UE is not provided _pucch-sSCellDyn_ and _pucch-sSCellDynDCI-1-2,_ and slot
> $n_{0,k} + n_{D}$ is before the slot for the active DL BWP change on serving
> cell $c$ or the active UL BWP change on the serving cell of PUCCH
> transmission, or _subslotLengthForPUCCH_ is provided for the HARQ-ACK
> codebook and slot $n_{0,k} + n_{D}$ overlaps with UL slot $n_{U} - K_{1,k -
> 1}$, $k > 0$, where $n_{0,k}$ is a DL slot with a smallest index among DL
> slots overlapping with UL slot $n_{U} - K_{1,k}$,
>
> $n_{D} = n_{D} + 1$;
>
> else
>
> while $r 
> if the UE is not provided _timeDomainHARQ-BundlingType1_ and is provided
> _tdd-UL-DL-ConfigurationCommon_ , or _tdd-UL-DL-ConfigurationDedicated_ and,
> for each slot from slot $n_{0,k} + n_{D} - N_{\text{PDSCH}}^{repeat,max} +
> 1$ to slot $n_{0,k} + n_{D}$, at least one symbol of the PDSCH time resource
> derived by row $r$ is configured as UL by _tdd-UL-DL-ConfigurationCommon_ or
> _tdd-UL-DL-ConfigurationDedicated_ where $K_{\text{1,}\text{k}}$ is the _k_
> -th slot timing value in set $K_{\text{1}}$, where $n_{0,k}$ is a DL slot
> with a smallest index among DL slots overlapping with UL slot $n_{U} -
> K_{1,k}$, or _subslotLengthForPUCCH_ is provided for the HARQ-ACK codebook
> and the end of the PDSCH time resource for row $r$ is not within any UL slot
> $n_{U} - K_{1,l}$, $0 \leq l  TimeDomainAllocationListForMultiPDSCH_ is provided and HARQ-ACK information
> for PDSCH time resource derived by row $r$ in slot $n_{0,k} + n_{D}$ cannot
> be provided in slot $n_{U}$
$R = R\backslash r$;
> elseif the UE is provided _timeDomainHARQ-BundlingType1_ and _tdd-UL-DL-
> ConfigurationCommon_ , or _tdd-UL-DL-ConfigurationDedicated_ and, for each
> slot $n_{0,k} + n_{D} - \ \mathrm{\Delta}K_{\text{0,}\text{r}}(d)$, at least
> one symbol of each PDSCH time resource derived by row $r$ of set $R'$ is
> configured as UL by _tdd-UL-DL-ConfigurationCommon_ or _tdd-UL-DL-
> ConfigurationDedicated_ , and for each slot from $n_{0,k} + n_{D} -
> N_{\text{PDSCH}}^{repeat,max} + 1$ to slot $n_{0,k} + n_{D}$ at least one
> symbol of the PDSCH time resource derived by row $r$ of set _R_ is
> configured as UL by _tdd-UL-DL-ConfigurationCommon_ or _tdd-UL-DL-
> ConfigurationDedicated_ if the row $r$ of set _R_ belongs to time domain
> resource allocation table configured for DCI format 1_2, where $d$ =
> 0,1,...,$\text{C}\left( \mathrm{\Delta}K_{\text{0,}\text{r}} \right) - 1$,
> $\mathrm{\Delta}K_{\text{0,}\text{r}} = \max_{K_{\text{0}}}\left(
> K_{\text{0,}\text{r}} \right) - K_{\text{0,}\text{r}}$, and $\text{C}\left(
> \mathrm{\Delta}K_{\text{0,}\text{r}} \right)$ is the cardinality of
> $\mathrm{\Delta}K_{\text{0,}\text{r}}$.
$R = R\backslash r$;
$R' = R'\backslash r$;
> else
$r = r + 1$;
> end if
>
> end while
>
> if the UE is not provided with _multiPDSCH-perSlotType1-CB_ and the UE does
> not indicate a capability to receive more than one unicast PDSCH or
> multicast PDSCH per slot and $R \neq \varnothing$, or if the UE is provided
> with _multiPDSCH-perSlotType1-CB_ = 'disabled' and $R \neq \varnothing$,
>
> $M_{\text{A,c}} = M_{\text{A,c}} \cup j$;
>
> $j = j + 1$;
>
> else
>
> Set $\text{C}\left( R \right)$ to the cardinality of $R$
>
> Set $m$ to the smallest last OFDM symbol index, as determined by the _SLIV_
> , among all rows of $R$
>
> while $R \neq \varnothing$
>
> Set $r = 0$
while $r  if $S \leq m$ for start OFDM symbol index $S$ for row $r$
>
> $b_{\text{r,k,}n_{D}} = j$; - index of occasion for candidate PDSCH
> reception, or SPS PDSCH release, or TCI state update associated with row $r$
>
> $R = R\backslash r$;
>
> ${B = B \cup b}_{\text{r,k,}n_{D}}$;
>
> else
>
> $r = r + 1$;
>
> end if
end while
$M_{\text{A,c}} = M_{\text{A,c}} \cup j$
$j = j + 1$;
Set $m$ to the smallest last OFDM symbol index among all rows of $R$;
> end while
>
> end if
>
> $n_{D} = n_{D} + 1$;
>
> end if
>
> end while
end if
$k = k + 1$;
end while
else
while $k  Set $N_{\text{k}}$ to a number of DL slots overlapping with UL slot $n_{U} -
> K_{1,k}$ if _subslotLengthForPUCCH_ is provided for the HARQ-ACK codebook;
> otherwise, $N_{\text{k}} = \max\left( 2^{\mu_{\text{DL}} -
> \mu_{\text{UL}}},1 \right)$
while $n_{D}  if _pdsch-TimeDomainAllocationListForMultiPDSCH_ and _timeDomainHARQ-
> BundlingType1_ are provided for serving cell $c$
$R = R_{\text{T}}$;
$R' = R_{T}^{'}$;
> elseif _pdsch-TimeDomainAllocationListForMultiPDSCH_ is provided and
> _timeDomainHARQ-BundlingType1_ is not provided for serving cell $c$
$R = R_{\text{T}}$;
else
Set $R$ to the set of rows
end if
Set $\text{C}\left( R \right)$ to the cardinality of $R$
Set $r = 0$ -- index of row in set $R$
> if slot $n_{U}$ starts at a same time as or after a slot for an active DL
> BWP change on serving cell $c$ or an active UL BWP change on the serving
> cell of PUCCH transmission if the UE is provided _pucch-sSCellDyn_ or
> _pucch-sSCellDynDCI-1-2_ , or an active UL BWP change on the PCell if the UE
> is not provided _pucch-sSCellDyn_ and _pucch-sSCellDynDCI-1-2,_ and slot $\
> n_{0,k} + n_{D}$ is before the slot for the active DL BWP change on serving
> cell $c$ or the active UL BWP change on the serving cell of PUCCH
> transmission where $n_{0,k}$ is a DL slot with a smallest index among DL
> slots overlapping with UL slot $n_{U} - K_{1,k}$, or _subslotLengthForPUCCH_
> is provided for the HARQ-ACK codebook and slot $n_{0,k} + n_{D}$ overlaps
> with UL slot $n_{U} - K_{1,k - 1}$, $k > 0$,
$n_{D} = n_{D} + 1$;
else
while $r  if the UE is not provided _timeDomainHARQ-BundlingType1_ and is provided
> _tdd-UL-DL-ConfigurationCommon_ , or _tdd-UL-DL-ConfigurationDedicated_ and,
> for each slot from slot $n_{0,k} + n_{D} - N_{\text{PDSCH}}^{repeat,max} +
> 1$ to slot $n_{0,k} + n_{D}$, at least one symbol of the PDSCH time resource
> derived by row $r$ is configured as UL by _tdd-UL-DL-ConfigurationCommon_ or
> _tdd-UL-DL-ConfigurationDedicated_ where $K_{1,k}$ is the _k_ -th slot
> timing value in set $K_{1}$, where $n_{0,k}$ is a DL slot with a smallest
> index among DL slots overlapping with UL slot $n_{U} - K_{1,k}$, or
> _subslotLengthForPUCCH_ is provided for the HARQ-ACK codebook and the end of
> the PDSCH time resource for row $r$ is not within any UL slot $n_{U} -
> K_{1,l}$, $0 \leq l  TimeDomainAllocationListForMultiPDSCH_ is provided and HARQ-ACK information
> for PDSCH time resource derived by row $r$ in slot $n_{0,k} + n_{D}$ cannot
> be provided in slot $n_{U}$
$R = R\backslash r$;
> elseif the UE is provided _timeDomainHARQ-BundlingType1_ and _tdd-UL-DL-
> ConfigurationCommon_ , or _tdd-UL-DL-ConfigurationDedicated_ and, for each
> slot $n_{0,k} + n_{D} - \ \mathrm{\Delta}K_{\text{0,}\text{r}}(d)$, at least
> one symbol of each PDSCH time resource derived by row $r$ of set $R'$ is
> configured as UL by _tdd-UL-DL-ConfigurationCommon_ or _tdd-UL-DL-
> ConfigurationDedicated_ , and for each slot from $n_{0,k} + n_{D} -
> N_{\text{PDSCH}}^{repeat,max} + 1$ to slot $n_{0,k} + n_{D}$ at least one
> symbol of the PDSCH time resource derived by row $r$ of set _R_ is
> configured as UL by _tdd-UL-DL-ConfigurationCommon_ or _tdd-UL-DL-
> ConfigurationDedicated_ if the row $r$ of set _R_ belongs to time domain
> resource allocation table configured for DCI format 1_2, where $d$ =
> 0,1,...,$\text{C}\left( \mathrm{\Delta}K_{\text{0,}\text{r}} \right) - 1$.
$R = R\backslash r$;
$R' = R'\backslash r$;
else
$r = r + 1$;
end if
end while
> if the UE is not provided with _multiPDSCH-perSlotType1-CB_ and the UE does
> not indicate a capability to receive more than one unicast PDSCH or
> multicast PDSCH per slot and $R \neq \varnothing$, or if the UE is provided
> with _multiPDSCH-perSlotType1-CB_ = 'disabled' and $R \neq \varnothing$,
$M_{\text{A,c}} = M_{\text{A,c}} \cup j$;
$j = j + 1$;
else
Set $\text{C}\left( R \right)$ to the cardinality of $R$
Set $m$ to the smallest last OFDM symbol index, as determined by the _SLIV_ ,
among all rows of $R$
while $R \neq \varnothing$
> Set $r = 0$
>
> while $r 
> if $S \leq m$ for start OFDM symbol index $S$ for row $r$
>
> $b_{\text{r,k,}n_{D}} = j$; - index of occasion for candidate PDSCH
> reception, or SPS PDSCH release, or TCI state update associated with row $r$
>
> $R = R\backslash r$;
>
> ${B = B \cup b}_{\text{r,k,}n_{D}}$;
>
> else
>
> $r = r + 1$;
>
> end if
>
> end while
>
> $M_{\text{A,c}} = M_{\text{A,c}} \cup j$;
>
> $j = j + 1$;
>
> Set $m$ to the smallest last OFDM symbol index among all rows of $R$;
end while
end if
$n_{D} = n_{D} + 1$;
end if
end while
end if
$k = k + 1$;
end while
end if
If the UE indicates a capability to receive more than one PDSCH per slot, for
occasions of candidate PDSCH receptions corresponding to rows of $R$
associated with a same value of $b_{\text{r,k,}n_{D}}$, where
$b_{\text{r,k,}n_{D}} \in B$, the UE does not expect to receive more than one
PDSCH in a same DL slot associated with a same _coresetPoolIndex_ value if
provided, or if _coresetPoolIndex_ is not provided.
If a UE receives a SPS PDSCH, or a SPS PDSCH release, or TCI state update, or
a PDSCH that is scheduled by a DCI format that does not support CBG-based
PDSCH receptions and if
\- the UE is configured with one serving cell, and
\- $\text{C}\left( M_{\text{A,c}} \right) = 1$, and
\- _PDSCH-CodeBlockGroupTransmission_ is provided to the UE
the UE generates HARQ-ACK information only for the transport block in the
PDSCH, or only for the SPS PDSCH release, or only for the TCI state update.
If a UE receives a SPS PDSCH, or a SPS PDSCH release, or TCI state update, or
a PDSCH that is scheduled by a DCI format that does not support CBG-based
PDSCH receptions and if
\- the UE is configured with more than one serving cells, or
\- $\text{C}\left( M_{\text{A,c}} \right) > 1$, and
\- _PDSCH-CodeBlockGroupTransmission_ is provided to the UE
the UE repeats $N_{HARQ - ACK}^{CBG/TB,max}$ times the HARQ-ACK information
for the transport block in the PDSCH, or for the SPS PDSCH release, or for the
TCI state update.
A UE does not expect to detect a DCI format switching a DL BWP within $N_{3}$
symbols prior to a first symbol of a PUCCH transmission where the UE
multiplexes HARQ-ACK information, where $N_{3}$ is defined in clause 9.2.3.
If a UE is provided _dl-DataToUL-ACK_ or _dl-DataToUL-ACK-r16 or dl-DataToUL-
ACK-DCI-1-2_ or _dl-DataToUL-ACK-r17_ or _dl-DataToUL-ACK-DCI-1-2-r17_ , the
UE does not expect to be indicated by DCI format 1_0 a slot timing value for
transmission of HARQ-ACK information that does not belong to the intersection
of the set of slot timing values {1, 2, 3, 4, 5, 6, 7, 8} for SCS
configuration of PUCCH transmission $\mu \leq 3$, {_7, 8, 12, 16, 20, 24, 28,
32} for_ $\mu = 5$, and _{13, 16, 24, 32, 40, 48, 56, 64} for_ $\mu = 6$, and
the set of slot timing values provided by $K_{1}$ for the active DL BWP of a
corresponding serving cell for unicast.
If _maxNrofCodeWordsScheduledByDCI_ indicates reception of two transport
blocks, when the UE receives a PDSCH with one transport block or a SPS PDSCH
release or a TCI state update, the HARQ-ACK information is associated with the
first transport block and the UE generates a NACK for the second transport
block if _harq-ACK-SpatialBundlingPUCCH_ is not provided and generates HARQ-
ACK information with value of ACK for the second transport block if _harq-ACK-
SpatialBundlingPUCCH_ is provided.
A UE determines ${\widetilde{o}}_{0}^{\text{ACK}}\text{,\
}{\widetilde{o}}_{1}^{\text{ACK}}\text{,...,}{\widetilde{o}}_{O_{\text{ACK}} -
1}^{\text{ACK}}$ HARQ-ACK information bits, for a total number of
$O_{\text{ACK}}$ HARQ-ACK information bits, of a HARQ-ACK codebook for
transmission in a PUCCH according to the following pseudo-code. In the
following pseudo-code, if the UE does not receive a transport block or a CBG,
due to the UE not detecting a corresponding DCI format, the UE generates a
NACK value for the transport block or the CBG. The cardinality of the set
$M_{A,c}$ defines a total number $M_{c}$ of occasions for PDSCH reception or
SPS PDSCH release or TCI state update for serving cell $c$ corresponding to
the HARQ-ACK information bits.
Set $c = 0$ -- serving cell index: lower indexes correspond to lower RRC
indexes of corresponding cells including, when applicable, cells in the set
$S_{\text{0}}$ and the set $S_{1}$
Set $j = 0$- HARQ-ACK information bit index
Set $N_{\text{cells}}^{\text{DL}}$ to the number of serving cells configured
by higher layers for the UE
while $c  if _timeDomainHARQ-BundlingType1_ is provided for serving cell $\text{c\
> }$and a PDSCH associated with occasion $m$ is scheduled by a DCI format
> indicating a TDRA row that includes more than one SLIV entry
>
> if _harq-ACK-SpatialBundlingPUCCH_ is not provided and the UE is configured
> by _maxNrofCodeWordsScheduledByDCI_ with reception of two transport blocks
> for the active DL BWP of serving cell $c$
if the PDSCH is associated with the last SLIV in the TDRA row
> ${\widetilde{o}}_{j}^{\text{ACK}}$ = binary AND operation of the HARQ-ACK
> information bits corresponding to first transport blocks in PDSCH
> receptions, that do not overlap with an uplink symbol indicated by _tdd-UL-
> DL-ConfigurationCommon_ or _tdd-UL-DL-ConfigurationDedicated_ , scheduled by
> the DCI format on serving cell $c$;
>
> $j = j + 1$;
>
> ${\widetilde{o}}_{j}^{\text{ACK}}$ = binary AND operation of the HARQ-ACK
> information bits corresponding to second transport blocks in PDSCH
> receptions, that do not overlap with an uplink symbol indicated by _tdd-UL-
> DL-ConfigurationCommon_ or _tdd-UL-DL-ConfigurationDedicated_ , scheduled by
> the DCI format on serving cell $c$;
else
> ${\widetilde{o}}_{j}^{\text{ACK}} =$ NACK;
>
> $j = j + 1$;
>
> ${\widetilde{o}}_{j}^{\text{ACK}} =$ NACK;
end if
$j = j + 1$;
> elseif _harq-ACK-SpatialBundlingPUCCH_ is provided and the UE is configured
> by _maxNrofCodeWordsScheduledByDCI_ with reception of two transport blocks
> for the active DL BWP of serving cell $c$
>
> if the PDSCH is associated with the last SLIV in the TDRA row;
>
> ${\widetilde{o}}_{j}^{\text{ACK}}$ = binary AND operation of the HARQ-ACK
> information bits corresponding to all transport blocks in PDSCHs, that do
> not overlap with an uplink symbol indicated by _tdd-UL-DL-
> ConfigurationCommon_ or _tdd-UL-DL-ConfigurationDedicated_ , scheduled by
> the DCI format of serving cell $c$
>
> if the UE receives one transport block, the UE assumes ACK for the second
> transport block;
>
> else
>
> ${\widetilde{o}}_{j}^{\text{ACK}}$ = NACK;
>
> end if
>
> $j = j + 1$;
else
> if the PDSCH is associated with the last SLIV in the TDRA row;
>
> ${\widetilde{o}}_{j}^{\text{ACK}}$ =binary AND operation of the HARQ-ACK
> information bits corresponding to all transport blocks in PDSCHs, that do
> not overlap with an uplink symbol indicated by _tdd-UL-DL-
> ConfigurationCommon_ or _tdd-UL-DL-ConfigurationDedicated_ , scheduled by
> the DCI format of serving cell $c$
>
> else
>
> ${\widetilde{o}}_{j}^{\text{ACK}}$ = NACK;
>
> end if
>
> $j = j + 1$;
end if
else
> if _harq-ACK-SpatialBundlingPUCCH_ is not provided, _PDSCH-
> CodeBlockGroupTransmission_ is not provided, and the UE is configured by
> _maxNrofCodeWordsScheduledByDCI_ with reception of two transport blocks for
> the active DL BWP of serving cell $c$,
${\widetilde{o}}_{j}^{\text{ACK}}$= HARQ-ACK information bit corresponding to
a first transport block of this cell;
$j = j + 1$;
${\widetilde{o}}_{j}^{\text{ACK}}$ = HARQ-ACK information bit corresponding to
a second transport block of this cell;
$j = j + 1$;
> elseif _harq-ACK-SpatialBundlingPUCCH_ is provided, and the UE is configured
> by _maxNrofCodeWordsScheduledByDCI_ with reception of two transport blocks
> for the active DL BWP of serving cell $c$,
>
> ${\widetilde{o}}_{j}^{\text{ACK}}$ = binary AND operation of the HARQ-ACK
> information bits corresponding to first and second transport blocks of this
> cell
>
> if the UE receives one transport block, the UE assumes ACK for the second
> transport block;
>
> $j = j + 1$;
>
> elseif _PDSCH-CodeBlockGroupTransmission_ is provided, and $N_{HARQ -
> ACK,c}^{CBG/TB,max}$ CBGs are indicated by
> _maxCodeBlockGroupsPerTransportBlock_ for serving cell $c$,
Set $n_{\text{CBG}} = 0$- CBG index
while $n_{\text{CBG}}  ${\widetilde{o}}_{j + n_{\text{CBG}}}^{\text{ACK}}$ = HARQ-ACK information
> bit corresponding to CBG $n_{\text{CBG}}$ of the first transport block;
>
> if the UE is configured by _maxNrofCodeWordsScheduledByDCI_ with reception
> of two transport blocks for the active DL BWP of serving cell $c$
>
> ${\widetilde{o}}_{j + n_{\text{CBG}} + N_{HARQ -
> ACK,c}^{CBG/TB,max}}^{A\text{CK}}$ = HARQ-ACK information bit corresponding
> to CBG $n_{\text{CBG}}$ of the second transport block;
>
> end if
>
> $n_{\text{CBG}} = n_{\text{CBG}} + 1$;
>
> end while
>
> $j = j + N_{TB,c}^{\text{DL}} \bullet N_{HARQ - ACK,c}^{CBG/TB,max}$, where
> $N_{TB,c}^{\text{DL}}$ is the value of _maxNrofCodeWordsScheduledByDCI_ for
> the active DL BWP of serving cell $c$;
else
${\widetilde{o}}_{j}^{\text{ACK}}$ = HARQ-ACK information bit of serving cell
$c$;
$j = j + 1$;
end if
end if
$m = m + 1$;
end while
$c = c + 1$;
end while
If $O_{\text{ACK}} + O_{\text{SR}} + O_{\text{CSI}} \leq 11$, the UE
determines a number of HARQ-ACK information bits $n_{HARQ - ACK}$ for
obtaining a transmission power for a PUCCH, as described in clause 7.2.1, as
$n_{HARQ - ACK} = \sum_{c = 0}^{N_{\text{cells}}^{\text{DL}} - 1}{\sum_{m =
0}^{M_{c} - 1}{N_{m,c}^{\text{received}} + \sum_{c =
0}^{N_{\text{cells}}^{\text{DL}} - 1}{\sum_{m = 0}^{M_{c} -
1}N_{m,c}^{received,CBG}}}}$ where
\- $N_{\text{cells}}^{\text{DL}}$ are all DL cells where the UE is configured
to receive unicast or multicast PDSCHs
\- $M_{c}$ is the cardinality for the union of all sets $M_{A,c}$ of occasions
for unicast or multicast PDSCH receptions or SPS PDSCH releases for serving
cell $c$
\- $N_{m,c}^{\text{received}}$ is the number of transport blocks the UE
receives in PDSCH reception occasion $m$ for serving cell $c$ if _harq-ACK-
SpatialBundlingPUCCH_ and _PDSCH-CodeBlockGroupTransmission_ are not provided,
or the number of transport blocks the UE receives in PDSCH reception occasion
$m$ for serving cell $c$ if _PDSCH-CodeBlockGroupTransmission_ is provided and
the PDSCH reception is scheduled by a DCI format that does not support CBG-
based PDSCH receptions, or the number of PDSCH receptions if _harq-ACK-
SpatialBundlingPUCCH_ is provided or SPS PDSCH release or TCI state update in
PDSCH reception occasion $m$ for serving cell $c$ and the UE reports
corresponding HARQ-ACK information in the PUCCH.
\- If _timeDomainHARQ-BundlingType1_ is provided for serving cell $c$ and for
a DCI format indicating a TDRA row that includes more than one SLIV entry on
the serving cell $c$, the UE considers as received only a PDSCH associated
with the last SLIV.
\- $N_{m,c}^{received,CBG}$ is the number of CBGs the UE receives in a PDSCH
reception occasion $m$ for serving cell $c$ if _PDSCH-
CodeBlockGroupTransmission_ is provided and the PDSCH reception is scheduled
by a DCI format that supports CBG-based PDSCH receptions and the UE reports
corresponding HARQ-ACK information in the PUCCH.
#### 9.1.2.2 Type-1 HARQ-ACK codebook in physical uplink shared channel
If a UE is not provided _pdsch-HARQ-ACK-Codebook = \'semi-static\'_ for
unicast or multicast HARQ-ACK information, the UE does not multiplex the
unicast or multicast HARQ-ACK information in the PUSCH transmission,
respectively.
If a UE is provided _pdsch-HARQ-ACK-Codebook = \'semi-static\'_ for unicast
and/or multicast HARQ-ACK information, and would multiplex HARQ-ACK
information in a PUSCH transmission that is not scheduled by a DCI format or
is scheduled by a DCI format that does not include a DAI field, then
_\- if the_ UE has not received any PDSCH or SPS PDSCH release or TCI state
update that the UE multiplexes corresponding HARQ-ACK information in the
PUSCH, based on a value of a respective PDSCH-to-HARQ_feedback timing
indicator field in a DCI format scheduling the PDSCH reception or the SPS
PDSCH release or the TCI state update, or on the value of _dl-DataToUL-ACK_ or
_dl-DataToUL-ACK-r16_ _or dl-DataToUL-ACK-r17_ if the PDSCH-to-HARQ_feedback
timing indicator field is not present in DCI format 1_1 or on the value of
_dl-DataToUL-ACK-DCI-1-2_ or _dl-DataToUL-ACK-DCI-1-2-r17_ if the PDSCH-to-
HARQ_feedback timing indicator field is not present in DCI format 1_2 and the
UE is provided _pdsch-HARQ-ACK-Codebook = \'semi-static\'_ for unicast HARQ-
ACK information, or on the value of _dl-DataToUL-ACK_ if the PDSCH-to-
HARQ_feedback timing indicator field is not present in DCI format 4_2 and the
UE is provided _pdsch-HARQ-ACK-Codebook = \'semi-static\'_ for multicast HARQ-
ACK information, in any of the $M_{c}$ occasions for candidate PDSCH
receptions by a DCI format or SPS PDSCH on any serving cell $c$, as described
in clause 9.1.2.1 _,_ the UE does not multiplex HARQ-ACK information in the
PUSCH transmission
\- else the UE generates the HARQ-ACK codebook as described in clause 9.1.2.1,
except that _harq-ACK-SpatialBundlingPUCCH_ is replaced by _harq-ACK-
SpatialBundlingPUSCH_ , unless the UE receives only a SPS PDSCH release, or
only SPS PDSCH receptions, or only a PDSCH that is scheduled by DCI format 1_0
with a counter DAI field value of 1 if the UE is provided _pdsch-HARQ-ACK-
Codebook = \'semi-static\'_ for unicast HARQ-ACK information, or is scheduled
by DCI format 4_1 with a counter DAI field value of 1 if the UE is provided
_pdsch-HARQ-ACK-Codebook = \'semi-static\'_ for multicast HARQ-ACK
information, on the PCell in the $M_{c}$ occasions for candidate PDSCH
receptions in which case the UE generates HARQ-ACK information only for the
SPS PDSCH release or only for the PDSCH reception as described in clause
9.1.2.
A UE sets to NACK value in the HARQ-ACK codebook any HARQ-ACK information
corresponding to PDSCH reception or SPS PDSCH release or TCI state update that
the UE detects in a PDCCH monitoring occasion that starts after a PDCCH
monitoring occasion where the UE detects a DCI format scheduling the PUSCH
transmission.
A UE does not expect to detect a DCI format switching a DL BWP within $N_{2}$
symbols prior to a first symbol of a PUSCH transmission where the UE
multiplexes HARQ-ACK information, where $N_{2}$ is defined in [6, TS 38.214].
If a UE multiplexes HARQ-ACK information in a PUSCH transmission that is
scheduled by DCI format that includes a DAI field, and
\- is not provided _fdmed-ReceptionMulticast_ and is provided _pdsch-HARQ-ACK-
Codebook = \'semi-static\'_ for both unicast and multicast HARQ-ACK
information, or
\- is provided _pdsch-HARQ-ACK-Codebook = \'semi-static\'_ only for one of
unicast and multicast HARQ-ACK information
the UE generates the HARQ-ACK codebook as described in clause 9.1.2.1 when a
value of the DAI field is $V_{\text{T-DAI}}^{\text{UL}} = 1$ except that
_harq-ACK-SpatialBundlingPUCCH_ is replaced by _harq-ACK-
SpatialBundlingPUSCH_. The UE does not generate a HARQ-ACK codebook for
multiplexing in the PUSCH transmission when $V_{\text{T-DAI}}^{\text{UL}} = 0$
unless the UE receives
\- only a SPS PDSCH release, or
\- only unicast SPS PDSCH(s) associated with transport blocks having enabled
HARQ-ACK information report, or only a TCI state update, or only a PDSCH that
is scheduled by a DCI format 1_0 having enabled associated HARQ-ACK
information report if the UE is provided _pdsch-HARQ-ACK-Codebook = \'semi-
static\'_ for unicast HARQ-ACK information,
\- multicast SPS PDSCH(s) with transport blocks having enabled associated
HARQ-ACK information report or scheduled by a DCI format 4_1 having enabled
associated HARQ-ACK information report if the UE is provided _pdsch-HARQ-ACK-
Codebook = \'semi-static\'_ for multicast HARQ-ACK information,
with a counter DAI field value of 1 on the PCell in the $M_{c}$ occasions for
candidate PDSCH receptions in which case the UE generates HARQ-ACK information
only for the SPS PDSCH release or only for the TCI state update or only for
the PDSCH reception as described in clause 9.1.2.
$V_{\text{T-DAI}}^{\text{UL}} = 0$ if the PUSCH is scheduled by a DCI format
that includes a DAI field and the DAI field is set to \'0\'; otherwise,
$V_{\text{T-DAI}}^{\text{UL}} = 1$.
If a UE is provided _fdmed-ReceptionMulticast_ and is provided _pdsch-HARQ-
ACK-Codebook = \'semi-static\'_ for both unicast and multicast HARQ-ACK
information, the UE generates the HARQ-ACK codebook as described in clause
9.1.2.1, except that _harq-ACK-SpatialBundlingPUCCH_ is replaced by _harq-ACK-
SpatialBundlingPUSCH_
\- for the first set $S_{\text{U}}$ of $N_{\text{cells}}^{\text{DL,U}}$
serving cells if a value $V_{\text{T-DAI}}^{\text{UL,U}}$ of the DAI field
associated with unicast HARQ-ACK information is
$V_{\text{T-DAI}}^{\text{UL,U}} = 1$ [5, TS 38.212]
\- for the second set $S_{\text{M}}$ of
$N_{\text{cells}}^{\text{DL,}\text{M}}$ serving cells if a value
$V_{\text{T-DAI}}^{\text{UL,M}}$ of the DAI field associated with multicast
HARQ-ACK information is $V_{\text{T-DAI}}^{\text{UL,M}} = 1$ [5, TS 38.212]
The UE does not generate unicast or multicast HARQ-ACK information for
multiplexing in the PUSCH transmission when $V_{\text{T-DAI}}^{\text{UL,U}} =
0$ or $V_{\text{T-DAI}}^{\text{UL,M}} = 0$, respectively, unless the UE
receives respectively
\- only a unicast or a multicast SPS PDSCH release, or
\- only unicast SPS PDSCH(s) or multicast SPS PDSCH(s) having enabled
associated HARQ-ACK information reports, or
\- only a TCI state update, or a PDSCH with enabled associated HARQ-ACK
information report that is scheduled by a DCI format 1_0 or a DCI format 4_1
with counter DAI field value of 1 on the PCell
in the $M_{c}$ occasions for candidate PDSCH receptions in which case the UE
generates only the corresponding unicast or multicast HARQ-ACK information.
$V_{\text{T-DAI}}^{\text{UL,U}} = 0$ if the corresponding value of the DAI
field is set to \'0\'; otherwise, $V_{\text{T-DAI}}^{\text{UL,U}} = 1$.
$V_{\text{T-DAI}}^{\text{UL,M}} = 0$ if the corresponding value of the DAI
field is set to \'0\'; otherwise, $V_{\text{T-DAI}}^{\text{UL,M}} = 1$ [5, TS
38.212].
### 9.1.3 Type-2 HARQ-ACK codebook determination
This clause applies if the UE is configured with _pdsch-HARQ-ACK-Codebook =
dynamic_ or with _pdsch-HARQ-ACK-Codebook-r16_. Unless stated otherwise, a
PDSCH-to-HARQ_feedback timing indicator field provides an applicable value.
A UE does not expect to multiplex in a Type-2 HARQ-ACK codebook HARQ-ACK
information that is in response to a detection of a DCI format that does not
include a counter DAI field.
If a UE is provided _downlinkHARQ-FeedbackDisabled_ indicating disabled HARQ-
ACK information for a HARQ process associated with a transport block for PDCCH
monitoring occasion $m$ or for SPS PDSCH receptions on serving cell $c$, the
UE does not multiplex a HARQ-ACK information bit corresponding to the
transport block in a Type-2 HARQ-ACK codebook and does not consider the
transport block as received in the determination of
$N_{m,c}^{\text{received}}$ or of $N_{\text{SPS,}\text{c}}$ in clause 9.1.3.1.
If the UE is also provided _PDSCH-CodeBlockGroupTransmission, the UE_ does not
multiplex HARQ-ACK information bits corresponding to CBGs of the transport
block in the Type-2 HARQ-ACK codebook and does not consider the CBGs as
received in the determination of $N_{m,c}^{received,CBG}$ in clause 9.1.3.1.
If the UE is also provided _harq-feedbackEnablingforSPSactive_ = \'_enabled\'_
, the UE considers a HARQ process associated with a transport block in a first
SPS PDSCH reception, after an activation of SPS PDSCH receptions, to have
enabled HARQ-ACK information and the UE provides a HARQ-ACK information bit
according to a decoding outcome for the transport block in the first SPS PDSCH
reception.
If a UE is indicated to not provide multicast HARQ-ACK information, as
described in clause 18, associated with PDCCH monitoring occasion $m$ or for
SPS PDSCH receptions on serving cell $c$, the UE does not multiplex
corresponding HARQ-ACK information bits in a Type-2 HARQ-ACK codebook and does
not consider any transport blocks as received in the determination of
$N_{m,c}^{\text{received}}$ or of $N_{\text{SPS,}\text{c}}$ in clause 9.1.3.1.
If a UE receives a first DCI format that the UE detects in a first PDCCH
monitoring occasion and includes a PDSCH-to-HARQ_feedback timing indicator
field providing an inapplicable value from _dl-DataToUL-ACK-r16_ or _dl-
DataToUL-ACK-r17_ ,
\- if the UE detects a second DCI format, the UE multiplexes the corresponding
HARQ-ACK information in a PUCCH or PUSCH transmission in a slot that is
indicated by a value of a PDSCH-to-HARQ_feedback timing indicator field in the
second DCI format, where
\- if the UE is not provided _pdsch-HARQ-ACK-Codebook-r16_ , the UE detects
the second DCI format in any PDCCH monitoring occasion after the first one,
and where the slot indicated by the value of the PDSCH-to-HARQ_feedback timing
indicator field in the second DCI format is no later than a slot for HARQ-ACK
information in response to a SPS PDSCH reception, if any, received after the
PDSCHs scheduled by the first DCI format.
\- if the UE is provided _pdsch-HARQ-ACK-Codebook-r16_ , the UE detects the
second DCI format in any PDCCH monitoring occasion after the first one, and
the second DCI format indicates a HARQ-ACK information report for a same PDSCH
group index as indicated by the first DCI format as described in clause
9.1.3.3, and where the slot indicated by the value of the PDSCH-to-
HARQ_feedback timing indicator field in the second DCI format is no later than
a slot for HARQ-ACK information in response to a SPS PDSCH reception, if any,
received after the PDSCHs scheduled by the first DCI format.
\- if the UE is provided _pdsch-HARQ-ACK-Codebook-r16_ , the UE receives the
second DCI format later than the slot for HARQ-ACK information in response to
a SPS PDSCH reception received after the PDSCHs scheduled by the first DCI
format, and the second DCI format indicates a HARQ-ACK information report for
a same PDSCH group index as indicated by the first DCI format as described in
clause 9.1.3.3.
\- if the UE is provided _pdsch-HARQ-ACK-OneShotFeedback, the first DCI format
does not_ have associated _HARQ-ACK information without scheduling a PDSCH
reception or TCI state update, the UE detects_ the second DCI format in any
PDCCH monitoring occasion after the first one, and the second DCI format
includes a One-shot HARQ-ACK request field with value 1, the UE includes the
HARQ-ACK information in a Type-3 HARQ-ACK codebook, as described in clause
9.1.4, and where the slot indicated by the value of the PDSCH-to-HARQ_feedback
timing indicator field in the second DCI format is no later than a slot for
HARQ-ACK information in response to a SPS PDSCH reception, if any, received
after the PDSCHs scheduled by the first DCI format.
\- if the UE is provided _pdsch-HARQ-ACK-OneShotFeedback-r16_ , the first DCI
format does not have associated _HARQ-ACK information without scheduling a
PDSCH reception_ or TCI state update, and the UE receives the second DCI
format later than the slot for HARQ-ACK information in response to a SPS PDSCH
reception received after the PDSCHs scheduled by the first DCI format, and the
second DCI format includes a One-shot HARQ-ACK request field with value 1, the
UE includes the HARQ-ACK information in a Type-3 HARQ-ACK codebook, as
described in clause 9.1.4.
\- otherwise, the UE does not multiplex the corresponding HARQ-ACK information
in a PUCCH or PUSCH transmission.
#### 9.1.3.1 Type-2 HARQ-ACK codebook in physical uplink control channel
If a UE is configured to monitor PDCCH for multicast DCI formats with CRC
scrambled by one or more G-RNTIs for multicast or G-CS-RNTIs that the UE
generates a Type-2 HARQ-ACK codebook, the UE separately applies the procedures
in this clause per G-RNTI for multicast or per G-CS-RNTI using
_maxNrofCodeWordsScheduledByDCI_ in _pdsch-ConfigMulticast_ except the
procedures for SPS PDSCHs and applies the procedures in this clause using
_maxNrofCodeWordsScheduledByDCI_ provided in _pdsch-Config_ for unicast DCI
formats excluding the unicast DCI format activating SPS PDSCH receptions, and
determines the Type-2 HARQ-ACK codebook by concatenating the Type-2 HARQ-ACK
codebook for unicast DCI formats excluding the unicast DCI format activating
SPS PDSCH receptions, followed by the HARQ-ACK codebooks for the multicast DCI
formats in ascending order of the corresponding G-RNTI values, followed by the
HARQ-ACK codebooks for the multicast DCI formats in ascending order of the
corresponding G-CS-RNTI values excluding the multicast DCI format activating
SPS PDSCH receptions, followed by the HARQ-ACK codebooks for unicast and
multicast SPS PDSCH receptions.
A UE determines monitoring occasions for PDCCH with DCI format scheduling
PDSCH receptions, or having associated HARQ-ACK information without scheduling
PDSCH reception, on an active DL BWP of a serving cell $c$, as described in
clause 10.1, and for which the UE transmits HARQ-ACK information in a same
PUCCH in slot $n$ based on
\- PDSCH-to-HARQ_feedback timing indicator field values, or a _dl-DataToUL-
ACK_ , _dl-DataToUL-ACK-r16_ or _dl-DataToUL-ACK-DCI-1-2_ or _dl-DataToUL-
ACK-r17_ or _dl-DataToUL-ACK-DCI-1-2-r17_ value if the PDSCH-to-HARQ_feedback
timing indicator field is not present in a DCI format, for PUCCH transmission
with HARQ-ACK information in slot $n$, as described in clause 9.2.3, in
response to PDSCH receptions, or in response to a DCI format having associated
HARQ-ACK information without scheduling PDSCH reception
\- slot offsets $K_{0}$ [6, TS 38.214] provided by time domain resource
assignment field in a DCI format scheduling PDSCH receptions and by _pdsch-
AggregationFactor, or pdsch-AggregationFactor-r16, or_ _repetitionNumber_ ,
when provided.
The set of PDCCH monitoring occasions for DCI formats scheduling PDSCH
receptions, or having associated HARQ-ACK information without scheduling PDSCH
reception, is defined as the union of PDCCH monitoring occasions across active
DL BWPs of configured serving cells. PDCCH monitoring occasions are indexed in
an ascending order of their start times. The cardinality of the set of PDCCH
monitoring occasions defines a total number $M$ of PDCCH monitoring occasions.
A value of the counter downlink assignment indicator (DAI) field in DCI
formats denotes the accumulative number of {serving cell, PDCCH monitoring
occasion}-pairs in which PDSCH receptions, excluding PDSCH receptions that
provide only transport blocks for HARQ processes associated with disabled
HARQ-ACK information if _downlinkHARQ-FeedbackDisabled_ is provided or PDSCH
receptions scheduled by DCI formats associated with G-RNTI/G-CS-RNTI with
disabled HARQ-ACK information, or HARQ-ACK information bits that are not in
response for PDSCH receptions, associated with the DCI formats, excluding the
SPS activation DCI, is present up to the current serving cell and current
PDCCH monitoring occasion,
\- first, if the UE indicates by _type2-HARQ-ACK-Codebook_ support for more
than one PDSCH reception on a serving cell that are scheduled from a same
PDCCH monitoring occasion, in increasing order of the PDSCH reception starting
time for the same {serving cell, PDCCH monitoring occasion} pair,
\- second in ascending order of serving cell index, and
\- third in ascending order of PDCCH monitoring occasion index $m$, where $0
\leq m  if PDCCH monitoring occasion $m$ is before an active DL BWP change on
> serving cell $c$ or an active UL BWP change on the serving cell of PUCCH
> transmission if the UE is provided _pucch-sSCellDyn_ or _pucch-
> sSCellDynDCI-1-2_ , or an active UL BWP change on the PCell if the UE is not
> provided _pucch-sSCellDyn_ and _pucch-sSCellDynDCI-1-2,_ and an active DL
> BWP change is not triggered in PDCCH monitoring occasion $m$
$c = c + 1$;
else
> if there is a PDSCH providing a transport block for a HARQ process with
> enabled HARQ-ACK information on serving cell $c$ associated with PDCCH in
> PDCCH monitoring occasion $m$, or there is a PDCCH providing a DCI format
> associated with HARQ-ACK information without scheduling PDSCH reception on
> serving cell $c$
if $V_{C - \text{DAI},c,m}^{\text{DL}} \leq V_{\text{temp}}$
> $j = j + 1$
end if
$V_{\text{temp}} = V_{C - \text{DAI},c,m}^{\text{DL}}$
if $V_{\text{T-D}\text{AI},m}^{\text{DL}} = \varnothing$
> $V_{\text{temp},2} = V_{C - \text{DAI},c,m}^{\text{DL}}$
else
> $V_{\text{temp},2} = V_{T - \text{DAI},m}^{\text{DL}}$
end if
> if _harq-ACK-SpatialBundlingPUCCH_ is not provided and the UE is configured
> by _maxNrofCodeWordsScheduledByDCI_ with reception of two transport blocks
> for at least one configured DL BWP of at least one serving cell,
>
> ${\widetilde{o}}_{2 \cdot T_{D} \cdot j + 2\left( V_{C -
> \text{DAI},c,m}^{\text{DL}} - 1 \right)}^{\text{ACK}}$ = HARQ-ACK
> information bit corresponding to the first transport block of this cell
>
> ${\widetilde{o}}_{2 \cdot T_{D} \cdot j + 2\left( V_{C -
> \text{DAI},c,m}^{\text{DL}} - 1 \right) + 1}^{\text{ACK}}$ = HARQ-ACK
> information bit corresponding to the second transport block of this cell
$$V_{s} = V_{s} \cup \left{ 2 \cdot T_{D} \cdot j + 2\left( V_{C -
\text{DAI},c,m}^{\text{DL}} - 1 \right),\mspace{6mu} 2 \cdot T_{D} \cdot j +
2\left( V_{C - \text{DAI},c,m}^{\text{DL}} - 1 \right) + 1 \right}$$
> elseif _harq-ACK-SpatialBundlingPUCCH_ is provided to the UE and $m$ is a
> monitoring occasion for PDCCH with a DCI format that supports PDSCH
> reception with two transport blocks and the UE is configured by
> _maxNrofCodeWordsScheduledByDCI_ with reception of two transport blocks in
> at least one configured DL BWP of at least one serving cell,
>
> ${\widetilde{o}}_{T_{D} \cdot j + V_{C - \text{DAI},c,m}^{\text{DL}} -
> 1}^{\text{ACK}}$ = binary AND operation of the HARQ-ACK information bits
> corresponding to the first and second transport blocks of this cell
>
> $V_{s} = V_{s} \cup \left{ T_{D} \cdot j + V_{C -
> \text{DAI},c,m}^{\text{DL}} - 1 \right}$
else
> ${\widetilde{o}}_{T_{D} \cdot j + V_{C - \text{DAI},c,m}^{\text{DL}} -
> 1}^{\text{ACK}}$ = HARQ-ACK information bit of this cell
>
> $V_{s} = V_{s} \cup \left{ T_{D} \cdot j + V_{C -
> \text{DAI},c,m}^{\text{DL}} - 1 \right}$
end if
end if
$c = c + 1$
end if
end while
$m = m + 1$
end while
$V_{\text{temp}} = \left( j\ \text{mod}\left( \frac{4}{T_{D}} \right) \right)
\times \left( \frac{4}{T_{D}} \right) + V_{\text{temp}}$
if UE does not set $V_{\text{temp}2} = V_{T - \text{DAI}}^{\text{UL}}$ and
$T_{D} = 2$
$V_{\text{temp}2} = V_{\text{temp}}$
end if
$j = \left\lfloor \frac{j \times T_{D}}{4} \right\rfloor$
if $V_{temp2}  if _harq-ACK-SpatialBundlingPUCCH_ is not provided to the UE and the UE is
> configured by _maxNrofCodeWordsScheduledByDCI_ with reception of two
> transport blocks for at least one configured DL BWP of a serving cell,
$O^{\text{ACK}} = 2 \cdot \left( 4 \cdot j + V_{\text{temp}2} \right)$
else
$O^{\text{ACK}} = 4 \cdot j + V_{\text{temp}2}$
end if
${\widetilde{o}}_{i}^{\text{ACK}} = \text{NACK}$ for any $i \in \left{
0,1,\cdots,O^{\text{ACK}} - 1 \right}\backslash V_{s}$
If a UE is configured to receive SPS PDSCH and the UE multiplexes HARQ-ACK
information for one activated SPS PDSCH reception based on _downlinkHARQ-
FeedbackDisabled_ if provided [12, TS 38.331], including the ones associated
with the corresponding activation DCI, in the PUCCH in slot $n$, the UE
generates one HARQ-ACK information bit associated with the SPS PDSCH reception
and appends it to the $O^{\text{ACK}}$ HARQ-ACK information bits.
If a UE is configured to receive SPS PDSCH and the UE multiplexes HARQ-ACK
information for multiple activated SPS PDSCH receptions, including the ones
associated with the corresponding activation DCI and excluding the ones that
provide only transport blocks for HARQ processes associated with disabled
HARQ-ACK information if _downlinkHARQ-FeedbackDisabled_ is provided, in the
PUCCH in slot $n$, the UE generates the HARQ-ACK information as described in
clause 9.1.2 and appends it to the $O^{\text{ACK}}$ HARQ-ACK information bits.
The UE generates HARQ-ACK information with ACK value in response to a
detection of a DCI format that does not trigger a Type-3 HARQ-ACK codebook
report and has associated HARQ-ACK information without scheduling a PDSCH
reception.
For a PDCCH monitoring occasion with DCI format scheduling PDSCH reception, or
having associated HARQ-ACK information without scheduling a PDSCH reception,
in the active DL BWP of a serving cell, when a UE receives a PDSCH with one
transport block, or detects a DCI format having associated HARQ-ACK
information without scheduling PDSCH reception, and the value of
_maxNrofCodeWordsScheduledByDCI_ is 2 for at least one configured DL BWP of at
least one serving cell, the HARQ-ACK information is associated with the first
transport block and the UE generates a NACK for the second transport block if
_harq-ACK-SpatialBundlingPUCCH_ is not provided and generates HARQ-ACK
information with value of ACK for the second transport block if _harq-ACK-
SpatialBundlingPUCCH_ is provided.
If a UE is
\- not provided _PDSCH-CodeBlockGroupTransmission for any serving cell, or_
\- not provided _pdsch-TimeDomainAllocationListForMultiPDSCH_ for any serving
cell, or
\- provided _pdsch-TimeDomainAllocationListForMultiPDSCH_ and _nrofHARQ-
BundlingGroups_ with $N_{\text{HARQ} - \text{ACK}}^{TBG,max} = 1$ for a
serving cell
for PDSCH receptions scheduled by a DCI format that does not support CBG-based
PDSCH receptions, or for SPS PDSCH reception, or for a DCI format having
associated HARQ-ACK information without scheduling PDSCH reception, and if
$O_{\text{ACK}} + O_{\text{SR}} + O_{\text{CSI}} \leq 11$, the UE determines a
number of HARQ-ACK information bits $n_{\text{HARQ-ACK}}$ for obtaining a
transmission power for a PUCCH, as described in clause 7.2.1, as
$n_{\text{HARQ-ACK}} = n_{\text{HARQ-ACK,TB}} = \left( \left(
V_{\text{DAI},m_{\text{last}}}^{\text{DL}} - \sum_{c =
0}^{N_{\text{cells}}^{\text{DL}} - 1}U_{\text{DAI,}c} \right)\text{mod}\left(
T_{D} \right) \right)N_{\text{TB,}\max}^{\text{DL}} + \sum_{c =
0}^{N_{\text{cells}}^{\text{DL}} - 1}{\left( \sum_{m = 0}^{M -
1}{N_{m,c}^{\text{received}} + N_{\text{SPS},c}} \right) + \sum_{g = 0}^{G -
1}\left( \left( \left( V_{\text{DAI},m_{\text{last}},g}^{\text{DL}} - \sum_{c
= 0}^{N_{\text{cells}\text{,}g}^{\text{DL}} - 1}U_{\text{DAI},c,g}
\right)\text{mod}\left( T_{D,g} \right) \right)N_{\text{TB,}max,g}^{\text{DL}}
+ \sum_{c = 0}^{N_{\text{cells}\text{,}g}^{\text{DL}} - 1}\left( \sum_{m =
0}^{M_{g} - 1}{N_{m,c,g}^{\text{received}} + N_{\text{SPS},c,g}} \right)
\right)}$
where
\- $N_{\text{cells}}^{\text{DL}}$ is a number of serving cells where the UE is
configured to receive unicast PDSCHs
\- $N_{cells,g}^{\text{DL}}$ is a number of serving cells where the UE is
configured to receive multicast PDSCHs for a G-RNTI $g$ for multicast or a
G-CS-RNTI $g$
\- $G$ is a total number of G-RNTIs for multicast or G-CS-RNTIs configured to
the UE
\- $M$ is the number of PDCCH monitoring occasions for unicast DCI formats
\- $M_{g}$ is the number of PDCCH monitoring occasions for multicast DCI
formats with CRC scrambled by G-RNTI $g$ for multicast or G-CS-RNTI $g$
\- $T_{D} = 2^{N_{C - \text{DAI}}^{\text{DL}}}$ where $N_{C -
\text{DAI}}^{\text{DL}}$ the number of bits for the counter DAI field in
unicast DCI formats
\- $T_{D,g} = 2^{N_{C - \text{DAI}\text{,}g}^{\text{DL}}}$ where $N_{C -
\text{DAI}\text{,}g}^{\text{DL}}$ the number of bits for the counter DAI field
in multicast DCI formats with CRC scrambled by G-RNTI $g$ for multicast or
G-CS-RNTI $g$
\- if $N_{\text{cells}}^{\text{DL}} = 1$,
$V_{DAI,m_{\text{last}}}^{\text{DL}}$ is the value of the counter DAI in the
last DCI format scheduling PDSCH reception or having associated HARQ-ACK
information without scheduling PDSCH reception, that the UE detects within the
$M$ PDCCH monitoring occasions.
\- if $N_{cells,g}^{\text{DL}} = 1$, $V_{DAI,m_{last,g}}^{\text{DL}}$ is the
value of the counter DAI in the last multicast DCI format with G-RNTI $g$ for
multicast, or G-CS-RNTI $g$_,_ scheduling PDSCH reception or having associated
HARQ-ACK information without scheduling a PDSCH reception, that the UE detects
within the $M_{g}$ PDCCH monitoring occasions
> \- if $N_{\text{cells}}^{\text{DL}} > 1$ or if $N_{cells,g}^{\text{DL}} > 1$
>
> \- if the UE does not detect any DCI format that includes a total DAI field
> in a last PDCCH monitoring occasion within the $M$ or $M_{g}$ PDCCH
> monitoring occasions where the UE detects at least one DCI format scheduling
> PDSCH reception, or having associated HARQ-ACK information without
> scheduling PDSCH reception, for any serving cell $c$,
> $V_{DAI,m_{\text{last}}}^{\text{DL}}$ or $V_{DAI,m_{last,g}}^{\text{DL}}$,
> respectively, is the value of the counter DAI in a last DCI format the UE
> detects in the last PDCCH monitoring occasion
\- if the UE detects at least one DCI format that includes a total DAI field
in a last PDCCH monitoring occasion within the $M$ or $M_{g}$, for G-RNTI $g$
for multicast or G-CS-RNTI $g$_,_ PDCCH monitoring occasions where the UE
detects at least one DCI format scheduling PDSCH reception, or having
associated HARQ-ACK information without scheduling PDSCH reception, for any
serving cell $c$, $V_{DAI,m_{\text{last}}}^{\text{DL}}$ or
$V_{DAI,m_{last,g}}^{\text{DL}}$, respectively, is the value of the total DAI
in the at least one DCI format that includes a total DAI field
\- $V_{DAI,m_{\text{last}}}^{\text{DL}} = 0$ or
$V_{DAI,m_{last,g}}^{\text{DL}} = 0$ if the UE does not detect any DCI format
scheduling PDSCH reception, or having associated HARQ-ACK information without
scheduling PDSCH reception, for any serving cell $c$ in any of the $M$ or
$M_{g}$ PDCCH monitoring occasions, respectively.
\- $U_{\text{DAI,}\text{c}}$ or $U_{\text{DAI},c,g}$, for G-RNTI $g$ for
multicast or G-CS-RNTI $g$_,_ is the total number of DCI formats scheduling
PDSCH receptions providing transport blocks with enabled HARQ-ACK information,
or having associated HARQ-ACK information without scheduling a PDSCH
reception, that the UE detects within the $M$ or $M_{g}$ PDCCH monitoring
occasions, respectively, for serving cell $c$. $U_{\text{DAI,}\text{c}} = 0$
or $U_{\text{DAI},c,g} = 0$ if the UE does not detect any DCI format
scheduling PDSCH reception providing a transport block with enabled HARQ-ACK
information, or having associated HARQ-ACK information without scheduling
PDSCH reception, for serving cell $c$ in any of the $M$ or $M_{g}$,
respectively, PDCCH monitoring occasions.
\- $N_{TB,max}^{\text{DL}} = 2$ if the value of
_maxNrofCodeWordsScheduledByDCI_ is 2 for any serving cell $c$ and _harq-ACK-
SpatialBundlingPUCCH_ is not provided; otherwise, $N_{TB,max}^{\text{DL}} =
1$.
\- $N_{TB,max,g}^{\text{DL}} = 2$ if the value of
_maxNrofCodeWordsScheduledByDCI_ is 2 for any serving cell $c$ and _harq-ACK-
SpatialBundlingPUCCH_ is not provided for G-RNTI $g$ for multicast or G-CS-
RNTI $g$; otherwise, $N_{TB,max,g}^{\text{DL}} = 1$.
\- $N_{m,c}^{\text{received}}$ or $N_{m,c,g}^{\text{received}}$, for G-RNTI
$g$ for multicast or G-CS-RNTI $g$_,_ is
\- if _harq-ACK-SpatialBundlingPUCCH_ is not provided, the number of transport
blocks the UE receives in a PDSCH, or the number of transport block groups the
UE receives in PDSCHs if _nrofHARQ-BundlingGroups_ with $N_{\text{HARQ} -
\text{ACK}}^{TBG,max} = 1$ is provided, scheduled by a DCI format that the UE
detects in PDCCH monitoring occasion $m$ for serving cell $c$
\- else if _harq-ACK-SpatialBundlingPUCCH_ is provided, the number of PDSCHs,
or the number of PDSCH groups if _nrofHARQ-BundlingGroups_ with
$N_{\text{HARQ} - \text{ACK}}^{TBG,max} = 1$ is provided, scheduled by a DCI
format that the UE detects in PDCCH monitoring occasion $m$ for serving cell
$c$
\- else, the number of DCI formats that the UE detects and have associated a
HARQ-ACK information without scheduling PDSCH reception in PDCCH monitoring
occasion $m$ for serving cell $c$.
\- $N_{\text{SPS,}\text{c}}$ or $N_{\text{SPS},c,g}$, for G-RNTI $g$ for
multicast or G-CS-RNTI $g$_,_ is the number of SPS PDSCH receptions by the UE
on serving cell $c$ for which the UE transmits corresponding HARQ-ACK
information in the same PUCCH as for HARQ-ACK information corresponding to
PDSCH receptions within the $M$ or $M_{g}$ PDCCH monitoring occasions,
respectively.
If a UE
\- is provided _PDSCH-CodeBlockGroupTransmission_ for
$N_{\text{cells}}^{\text{DL,CBG}}$ serving cells; and
\- is not provided _PDSCH-CodeBlockGroupTransmission_ , for
$N_{\text{cells}}^{\text{DL,TB}}$ serving cells where
$N_{\text{cells}}^{\text{DL,TB}} + N_{\text{cells}}^{\text{DL,CBG}} =
N_{\text{cells}}^{\text{DL}}$
the UE determines the ${\widetilde{o}}_{0}^{\text{ACK}},\
{\widetilde{o}}_{1}^{\text{ACK}},\cdots,{\widetilde{o}}_{O_{\text{ACK}} -
1}^{\text{ACK}}$ according to the previous pseudo-code with the following
modifications
\- $N_{\text{cells}}^{\text{DL}}$ is used for the determination of a first
HARQ-ACK sub-codebook for
\- SPS PDSCH reception,
\- a DCI format having associated HARQ-ACK information without scheduling
PDSCH reception,
\- TCI state update, and
\- TB-based PDSCH receptions on the $N_{\text{cells}}^{\text{DL,CBG}}$ serving
cells and on the $N_{\text{cells}}^{\text{DL,TB}}$ serving cells,
\- $N_{\text{cells}}^{\text{DL}}$ is replaced by
$N_{\text{cells}}^{\text{DL,CBG}}$ for the determination of a second HARQ-ACK
sub-codebook corresponding to the $N_{\text{cells}}^{\text{DL,CBG}}$ serving
cells for CBG-based PDSCH receptions, and
\- if, for an active DL BWP of a serving cell, the UE is not provided
_coresetPoolIndex_ or is provided _coresetPoolIndex_ with value 0 for one or
more first CORESETs and is provided _coresetPoolIndex_ with value 1 for one or
more second CORESETs, and is provided _ackNackFeedbackMode_ = _joint, the
serving cell is counted as two times where the first time corresponds to the
first CORESETs and the second time corresponds to the second CORESETs_ , and
\- instead of generating one HARQ-ACK information bit per transport block for
a serving cell from the $N_{\text{cells}}^{\text{DL,CBG}}$ serving cells, the
UE generates $N_{\text{HARQ} - \text{ACK,max}}^{\text{CBG/TB,max}}$ HARQ-ACK
information bits, where $N_{\text{HARQ} - \text{ACK,max}}^{\text{CBG/TB,max}}$
is the maximum value of $N_{TB,c}^{\text{DL}} \cdot N_{\text{HARQ} -
\text{ACK,}\text{c}}^{\text{CBG/TB,max}}$ across all
$N_{\text{cells}}^{\text{DL,CBG}}$ serving cells and $N_{TB,c}^{\text{DL}}$ is
the value of _maxNrofCodeWordsScheduledByDCI_ for serving cell $c$. If for a
serving cell $c$ it is $N_{TB,c}^{\text{DL}} \cdot N_{HARQ -
ACK,c}^{\text{CBG/TB,max}}  If $O_{\text{ACK}} + O_{\text{SR}} + O_{\text{CSI}} \leq 11$, the UE also
> determines $n_{\text{HARQ-ACK}}{= n_{\text{HARQ-ACK,}\text{T}\text{B}} +
> n}_{\text{HARQ-ACK,CBG}}$ for obtaining a PUCCH transmission power, as
> described in clause 7.2.1, with
$n_{\text{HARQ-ACK,CBG}} = \left( \left(
V_{\text{DAI},m_{\text{last}}}^{\text{DL}} - \sum_{c =
0}^{N_{\text{cells}}^{\text{DL,CBG}} - 1}U_{\text{DAI,}c}^{\text{CBG}}
\right)\text{mod}\left( T_{D} \right) \right)N_{\text{HARQ} -
\text{ACK,max}}^{\text{CBG/TB,max}} + \sum_{c =
0}^{N_{\text{cells}}^{\text{DL}} - 1}{\sum_{m = 0}^{M -
1}N_{m,c}^{\text{received,CBG}}}$
> where
\- if $N_{\text{cells}}^{\text{DL}} = 1$,
$V_{DAI,m_{\text{last}}}^{\text{DL}}$ is the value of the counter DAI in the
last DCI format scheduling CBG-based PDSCH reception that the UE detects
within the $M$ PDCCH monitoring occasions
\- if $N_{\text{cells}}^{\text{DL}} > 1$,
$V_{DAI,m_{\text{last}}}^{\text{DL}}$ is the value of the total DAI in the
last DCI format scheduling CBG-based PDSCH reception for any serving cell $c$
that the UE detects within the $M$ PDCCH monitoring occasions
\- $V_{DAI,m_{\text{last}}}^{\text{DL}} = 0$, if the UE does not detect any
DCI format scheduling CBG-based PDSCH reception for any serving cell $c$ in
any of the $M$ PDCCH monitoring occasions
\- $U_{DAI,c}^{\text{CBG}}$ is the total number of DCI formats scheduling CBG-
based PDSCH receptions that the UE detects within the $M$ PDCCH monitoring
occasions for serving cell $c$. $U_{DAI,c}^{\text{CBG}} = 0$ if the UE does
not detect any DCI format scheduling CBG-based PDSCH reception for serving
cell $c$ in any of the $M$ PDCCH monitoring occasions
\- $N_{m,c}^{\text{received,CBG}}$ is the number of CBGs the UE receives in a
PDSCH scheduled by a DCI format that supports CBG-based PDSCH reception that
the UE detects in PDCCH monitoring occasion $m$ for serving cell $c$ and the
UE reports corresponding HARQ-ACK information in the PUCCH
If a UE is provided _nrofHARQ-BundlingGroups_ and is not provided _harq-ACK-
SpatialBundlingPUCCH_ for a serving cell $c$, the UE generates HARQ-ACK
information over transport block groups (TBGs) for PDSCH receptions where, for
a maximum number of $N_{\text{PDSCH}}^{\text{max}}$ PDSCH receptions scheduled
by a DCI format on the serving cell, a maximum number of TBGs $N_{\text{HARQ}
- ACK,c}^{TBG,max}$ is provided by _nrofHARQ-BundlingGroups_. If the UE
detects a DCI format scheduling $N_{PDSCH,c}$ PDSCH receptions on the serving
cell $c$, the UE generates $N_{\text{HARQ} - ACK,c}^{TBG,max}$ HARQ-ACK
information bits for the first TBs and, if applicable, generates
$N_{\text{HARQ} - ACK,c}^{TBG,max}$ HARQ-ACK information bits for the second
TBs as described in clause 9.1.1 by setting $N_{\text{HARQ} -
\text{ACK}}^{CBG/TB,max} = N_{\text{HARQ} - ACK,c}^{TBG,max}$ and $C =
N_{PDSCH,c}$. For a TBG associated with at least one PDSCH that does not
overlap with an UL symbol indicated by _tdd-UL-DL-ConfigurationCommon_ , or by
_tdd-UL-DL-ConfigurationDedicated_ if provided, the UE assumes that TB(s)
provided by a PDSCH that overlaps with an UL symbol indicated by _tdd-UL-DL-
ConfigurationCommon_ , or by _tdd-UL-DL-ConfigurationDedicated_ if provided,
are correctly received. For a TBG associated only with PDSCHs that overlap
with UL symbols indicated by _tdd-UL-DL-ConfigurationCommon_ , or by _tdd-UL-
DL-ConfigurationDedicated_ if provided, the UE generates a NACK value for the
TBG.
If a UE is provided _nrofHARQ-BundlingGroups_ and _harq-ACK-
SpatialBundlingPUCCH_ for a serving cell $c$, the UE generates HARQ-ACK
information over PDSCH reception groups for PDSCH receptions scheduled by a
DCI format on the serving cell $c$ where a maximum number of PDSCH reception
groups, $N_{\text{HARQ} - ACK,c}^{TBG,max}$, is provided by _nrofHARQ-
BundlingGroups_. If the UE detects a DCI format scheduling $N_{PDSCH,c}$ PDSCH
receptions on the serving cell $c$, the UE generates $N_{\text{HARQ} -
ACK,c}^{TBG,max}$ HARQ-ACK information bits for the $N_{PDSCH,c}$ PDSCH
receptions as described in clause 9.1.1 by setting $N_{\text{HARQ} -
\text{ACK}}^{CBG/TB,max} = N_{\text{HARQ} - ACK,c}^{TBG,max}$ and $C =
N_{PDSCH,c}$, after binary AND operation of the HARQ-ACK information bits
corresponding to the first and second transport blocks of each PDSCH
reception. For a PDSCH reception group associated with at least one PDSCH that
does not overlap with an UL symbol indicated by _tdd-UL-DL-
ConfigurationCommon_ , or by _tdd-UL-DL-ConfigurationDedicated_ if provided,
the UE assumes that TBs provided by a PDSCH that overlaps with an UL symbol
indicated by _tdd-UL-DL-ConfigurationCommon_ , or by _tdd-UL-DL-
ConfigurationDedicated_ if provided, are correctly received. For a PDSCH
reception group associated only with PDSCHs that overlap with UL symbols
indicated by _tdd-UL-DL-ConfigurationCommon_ , or by _tdd-UL-DL-
ConfigurationDedicated_ if provided, the UE generates a NACK value for the
PDSCH reception group.
If a UE
\- is provided _pdsch-TimeDomainAllocationListForMultiPDSCH_ and, if provided,
_nrofHARQ-BundlingGroups_ with value $N_{\text{HARQ} - \text{ACK}}^{TBG,max} >
1$ for $N_{\text{cells}}^{\text{DL,TBG}}$ serving cells; and
\- is not provided _pdsch-TimeDomainAllocationListForMultiPDSCH_ or is
provided _nrofHARQ-BundlingGroups_ with value $N_{\text{HARQ} -
\text{ACK}}^{TBG,max} = 1$, for $N_{\text{cells}}^{\text{DL,TB}}$ serving
cells where $N_{\text{cells}}^{\text{DL,TB}} +
N_{\text{cells}}^{\text{DL,TBG}} = N_{\text{cells}}^{\text{DL}}$
the UE determines the ${\widetilde{o}}_{0}^{\text{ACK}},\
{\widetilde{o}}_{1}^{\text{ACK}},\cdots,{\widetilde{o}}_{O_{\text{ACK}} -
1}^{\text{ACK}}$ according to the previous pseudo-code with the following
modifications
\- $N_{\text{cells}}^{\text{DL}}$ is used for the determination of a first
HARQ-ACK sub-codebook for
\- SPS PDSCH reception,
\- any DCI format having associated HARQ-ACK information without scheduling
PDSCH reception, and
\- PDSCH reception scheduled by a DCI format scheduling one PDSCH
\- PDSCH reception with $N_{\text{HARQ} - \text{ACK}}^{TBG,max} = 1$ for TBG-
based HARQ-ACK information on the $N_{\text{cells}}^{\text{DL,TB}}$ serving
cells,
\- $N_{\text{cells}}^{\text{DL}}$ is replaced by
$N_{\text{cells}}^{\text{DL,TBG}}$ for the determination of a second HARQ-ACK
sub-codebook corresponding to the $N_{\text{cells}}^{\text{DL,TBG}}$ serving
cells for TBG-based HARQ-ACK information, or for TB-based HARQ-ACK information
corresponding to multiple PDSCH receptions scheduled by a single DCI format,
and
\- if, for an active DL BWP of a serving cell, the UE is not provided
_coresetPoolIndex_ or is provided _coresetPoolIndex_ with value 0 for one or
more first CORESETs and is provided _coresetPoolIndex_ with value 1 for one or
more second CORESETs, and is provided _ackNackFeedbackMode_ = _joint, the
serving cell is counted as two times where the first time corresponds to the
first CORESETs and the second time corresponds to the second CORESETs_ , and
\- instead of generating one or two HARQ-ACK information bits per PDSCH for a
serving cell from the $N_{\text{cells}}^{\text{DL,TBG}}$ serving cells, the UE
generates $N_{\text{HARQ} - \text{ACK,max}}^{\text{T}\text{BG,max}}$ HARQ-ACK
information bits for the PDSCH receptions scheduled by a DCI format, where
$N_{\text{HARQ} - \text{ACK,max}}^{\text{T}\text{BG,max}}$ is the maximum
value between $N_{TB,c}^{\text{DL}} \cdot N_{\text{HARQ} -
\text{ACK,}\text{c}}^{\text{T}\text{BG,max}}$ across all
$N_{\text{cells}}^{\text{DL,TBG}}$ serving cells if the UE is provided
_nrofHARQ-BundlingGroups_ , and $N_{TB,c}^{\text{DL}} \cdot
N_{\text{PDSCH}\text{,}\text{c}}^{\text{max}}$ across all
$N_{\text{cells}}^{\text{DL,TBG}}$ serving cells where the UE is not provided
_nrofHARQ-BundlingGroups_ , and $N_{TB,c}^{\text{DL}}$ is the value of
_maxNrofCodeWordsScheduledByDCI_ for serving cell $c$ if _harq-ACK-
SpatialBundlingPUCCH_ is not provided; else, $N_{TB,c}^{\text{DL}} = 1$. If
for a serving cell $c$ where the UE is provided _nrofHARQ-BundlingGroups_ , it
is $N_{TB,c}^{\text{DL}} \cdot N_{HARQ - ACK,c}^{\text{T}\text{BG,max}}  0$, the UE also determines $n_{\text{HARQ-
ACK}}{= n_{\text{HARQ-ACK,}\text{T}\text{B}} + n}_{\text{HARQ-
ACK,}\text{T}\text{BG}}$ for obtaining a PUCCH transmission power, as
described in clause 7.2.1, with
$n_{\text{HARQ-ACK,TBG}} = \left( \left(
V_{\text{DAI},m_{\text{last}}}^{\text{DL}} - \sum_{c =
0}^{N_{\text{cells}}^{\text{DL,TBG}} - 1}U_{\text{DAI,}c}^{\text{TBG}}
\right)\text{mod}\left( T_{D} \right) \right)N_{\text{HARQ} -
\text{ACK,max}}^{\text{TBG,max}} + \sum_{c =
0}^{N_{\text{cells}}^{\text{DL}\text{,TBG}} - 1}{\sum_{m = 0}^{M -
1}N_{m,c}^{\text{received,TBG}}}$
where
\- if $N_{\text{cells}}^{\text{DL}} = 1$,
$V_{DAI,m_{\text{last}}}^{\text{DL}}$ is the value of the counter DAI in the
last DCI format scheduling more than one PDSCH receptions for any serving cell
$c$ from the $N_{\text{cells}}^{\text{DL,TBG}}$ serving cells with TBG-based
HARQ-ACK information or with TB-based HARQ-ACK information that the UE detects
within the $M$ PDCCH monitoring occasions
\- if $N_{\text{cells}}^{\text{DL}} > 1$,
$V_{DAI,m_{\text{last}}}^{\text{DL}}$ is the value of the total DAI in the
last DCI format scheduling more than one PDSCH receptions with TBG-based HARQ-
ACK information or with TB-based HARQ-ACK information for any serving cell $c$
from the $N_{\text{cells}}^{\text{DL,TBG}}$ serving cells that the UE detects
within the $M$ PDCCH monitoring occasions
\- $V_{DAI,m_{\text{last}}}^{\text{DL}} = 0$, if the UE does not detect any
DCI format scheduling more than one PDSCH receptions with TBG-based HARQ-ACK
information or with TB-based HARQ-ACK information for any serving cell $c$
from the $N_{\text{cells}}^{\text{DL,TBG}}$ serving cells in any of the $M$
PDCCH monitoring occasions
\- $U_{DAI,c}^{\text{TBG}}$ is the total number of DCI formats scheduling more
than one PDSCH receptions with TBG-based HARQ-ACK information or with TB-based
HARQ-ACK information for any serving cell $c$ from the
$N_{\text{cells}}^{\text{DL,TBG}}$ serving cells that the UE detects within
the $M$ PDCCH monitoring occasions for serving cell $c$.
$U_{DAI,c}^{\text{TBG}} = 0$ if the UE does not detect any DCI format
scheduling more than one PDSCH receptions for serving cell $c$ in any of the
$M$ PDCCH monitoring occasions
\- if _harq-ACK-SpatialBundlingPUCCH_ is provided,
> \- if _nrofHARQ-BundlingGroups_ is provided, $N_{m,c}^{\text{received,TBG}}$
> is the number of PDSCH groups that include at least one PDSCH not
> overlapping with a UL symbol indicated by _tdd-UL-DL-ConfigurationCommon_ ,
> or _tdd-UL-DL-ConfigurationDedicated_ if provided, that the UE receives in
> serving cell $c$ from the $N_{\text{cells}}^{\text{DL,TBG}}$ serving cells
> in PDCCH monitoring occasion $m$ and the UE reports corresponding HARQ-ACK
> information in the PUCCH
>
> \- if _nrofHARQ-BundlingGroups_ is not provided,
> $N_{m,c}^{\text{received,TBG}}$ is the number of PDSCHs that the UE receives
> in serving cell $c$ from the $N_{\text{cells}}^{\text{DL,TBG}}$ serving
> cells in PDCCH monitoring occasion $m$ and the UE reports corresponding
> HARQ-ACK information in the PUCCH
\- if harq-ACK-SpatialBundlingPUCCH is not provided,
> \- if _nrofHARQ-BundlingGroups_ is provided, $N_{m,c}^{\text{received,TBG}}$
> is the number of TBGs including at least one PDSCH not overlapping with an
> UL symbol indicated by _tdd-UL-DL-ConfigurationCommon_ , or by _tdd-UL-DL-
> ConfigurationDedicated_ if provided, that the UE receives in serving cell
> $c$ from the $N_{\text{cells}}^{\text{DL,TBG}}$ serving cells in PDCCH
> monitoring occasion $m$ and the UE reports corresponding HARQ-ACK
> information in the PUCCH
>
> \- if _nrofHARQ-BundlingGroups_ is not provided,
> $N_{m,c}^{\text{received,TBG}}$ is the number of transport blocks in PDSCHs
> that the UE receives in serving cell $c$ from the
> $N_{\text{cells}}^{\text{DL,TBG}}$ serving cells in PDCCH monitoring
> occasion $m$ and the UE reports corresponding HARQ-ACK information in the
> PUCCH.
Table 9.1.3-1: Value of counter DAI for
$\mathbf{N}_{\mathbf{C}\mathbf{-}\text{DAI}}^{\text{DL}}\mathbf{= 2}$ and of
total DAI
* * *
DAI\ $\mathbf{V}_{\text{C-DAI}}^{\text{DL}}$ or
$\mathbf{V}_{\text{T-DAI}}^{\text{DL}}$ Number of {serving cell, PDCCH
monitoring occasion}-pair(s) in which PDSCH transmission(s) associated with
PDCCH or PDCCH generating a HARQ-ACK information bit without scheduling a
PDSCH reception or providing TCI state update is present, denoted as
$\mathbf{Y}$ and $\mathbf{Y}\mathbf{\geq}\mathbf{1}$ MSB, LSB
* * *
0,0 1 $$\left( Y - 1 \right)\text{mod}T_{D} + 1 = 1$$
0,1 2 $$\left( Y - 1 \right)\text{mod}T_{D} + 1 = 2$$
1,0 3 $$\left( Y - 1 \right)\text{mod}T_{D} + 1 = 3$$
1,1 4 $$\left( Y - 1 \right)\text{mod}T_{D} + 1 = 4$$
* * *
Table 9.1.3-1A: Value of counter DAI for
$\mathbf{N}_{\mathbf{C}\mathbf{-}\text{DAI}}^{\text{DL}}\mathbf{= 1}$
* * *
**DAI\ $V_{\text{C-DAI}}^{\text{DL}}$ Number of {serving cell, PDCCH
monitoring occasion}-pair(s) in which PDSCH transmission(s) associated with
PDCCH or PDCCH generating a HARQ-ACK information bit without scheduling a
PDSCH reception** or providing TCI state update** is present, denoted as
$\mathbf{Y}$ and $\mathbf{Y}\mathbf{\geq}\mathbf{1}$ **
* * *
0 1 $$\left( Y - 1 \right)\text{mod}T_{D} + 1 = 1$$
1 2 $$\left( Y - 1 \right)\text{mod}T_{D} + 1 = 2$$
* * *
#### 9.1.3.2 Type-2 HARQ-ACK codebook in physical uplink shared channel
In this clause, a DAI field is either the one corresponding to unicast HARQ-
ACK information and associated PDSCH receptions or DCI formats, or is the one
corresponding to multicast HARQ-ACK information and associated PDSCH
receptions or DCI formats, as described in [5, TS 38.212].
If a UE would multiplex HARQ-ACK information in a PUSCH transmission that is
not scheduled by a DCI format or is scheduled by a DCI format that does not
include a DAI field, then
_\- if the_ UE has not received any PDCCH within the monitoring occasions for
DCI formats scheduling PDSCH receptions, or providing a DCI format having
associated HARQ-ACK information without scheduling a PDSCH reception, on any
serving cell $c$ and the UE does not have HARQ-ACK information in response to
a SPS PDSCH reception to multiplex in the PUSCH, as described in clause
9.1.3.1 _,_ the UE does not multiplex HARQ-ACK information in the PUSCH
transmission;
\- else, the UE generates the HARQ-ACK codebook as described in clause
9.1.3.1, except that _harq-ACK-SpatialBundlingPUCCH_ is replaced by _harq-ACK-
SpatialBundlingPUSCH_.
If a UE multiplexes HARQ-ACK information in a PUSCH transmission that is
scheduled by a DCI format that includes a DAI field, the UE generates the
HARQ-ACK codebook as described in clause 9.1.3.1, with the following
modifications:
\- For the pseudo-code for the HARQ-ACK codebook generation in clause 9.1.3.1,
after the completion of the $c$ and $m$ loops, the UE sets ${V_{temp2} = V}_{T
- \text{DAI}}^{\text{UL}}$ where $V_{T - \text{DAI}}^{\text{UL}}$ is the value
of the DAI field according to Table 9.1.3-2
_-_ if the UE multiplexes HARQ-ACK information associated with more than one
G-RNTIs for multicast or G-CS-RNTIs, the value of the DAI field $V_{T -
\text{DAI}}^{\text{UL}}$ is applicable to each of the more than one G-RNTIs
for multicast or each of the G-CS-RNTIs.
\- For the case of first and second HARQ-ACK sub-codebooks, the DCI format
includes a first DAI field corresponding to the first HARQ-ACK sub-codebook
and a second DAI field corresponding to the second HARQ-ACK sub-codebook
_\- harq-ACK-SpatialBundlingPUCCH_ is replaced by _harq-ACK-
SpatialBundlingPUSCH_.
If a UE is not provided _PDSCH-CodeBlockGroupTransmission_ and the UE is
scheduled for a PUSCH transmission by DCI format that includes a DAI field for
unicast PDSCH receptions with value $V_{\text{T-DAI}}^{\text{UL}} = 4$ and the
UE has not received any PDCCH within the monitoring occasions for a unicast
DCI format scheduling PDSCH receptions providing transport blocks with enabled
HARQ-ACK information or having associated HARQ-ACK information without
scheduling PDSCH receptions on any serving cell $c$, and the UE does not have
HARQ-ACK information in response to a unicast SPS PDSCH reception to multiplex
in the PUSCH as described in clause 9.1.3.1, the UE does not multiplex unicast
HARQ-ACK information in the PUSCH transmission.
If a UE is provided _PDSCH-CodeBlockGroupTransmission_ and the UE is scheduled
for a PUSCH transmission by DCI format that includes a DAI field for unicast
PDSCH receptions with first value $V_{\text{T-DAI}}^{\text{UL}} = 4$ or with
second value $V_{\text{T-DAI}}^{\text{UL}} = 4$ and the UE has not received
any PDCCH within the monitoring occasions for a unicast DCI format scheduling
PDSCH reception providing a transport block with enabled HARQ-ACK information
or having associated HARQ-ACK information without scheduling PDSCH reception
on any serving cell $c$, and the UE does not have HARQ-ACK information in
response to a unicast SPS PDSCH reception to multiplex in the PUSCH, as
described in clause 9.1.3.1, the UE does not multiplex unicast HARQ-ACK
information for the first sub-codebook or for the second sub-codebook,
respectively, in the PUSCH transmission.
If a UE is scheduled for a PUSCH transmission by DCI format that includes a
DAI field for multicast PDSCH receptions with value
$V_{\text{T-DAI}}^{\text{UL}} = 4$ and the UE has not received any PDCCH
within the monitoring occasions for a multicast DCI format scheduling PDSCH
reception providing a transport block with enabled HARQ-ACK information or
having associated HARQ-ACK information without scheduling PDSCH receptions on
any serving cell $c$, to multiplex in the PUSCH as described in clause
9.1.3.1, the UE does not multiplex multicast HARQ-ACK information associated
with a multicast DCI format in the PUSCH transmission.
Table 9.1.3-2: Value of DAI
* * *
DAI\ $\mathbf{V}_{\text{T-DAI}}^{\text{U}\text{L}}$ Number of {serving cell,
PDCCH monitoring occasion}-pair(s) in which PDSCH transmission(s) associated
with PDCCH or PDCCH indicating SPS PDSCH release or providing TCI state update
or DCI format 1_1 indicating SCell dormancy is present, denoted as
$\mathbf{X}$ and $\mathbf{X}\mathbf{\geq}\mathbf{1}$ MSB, LSB
* * *
0,0 1 $$\left( X - 1 \right)\text{mod}4 + 1 = 1$$
0,1 2 $$\left( X - 1 \right)\text{mod}4 + 1 = 2$$
1,0 3 $$\left( X - 1 \right)\text{mod}4 + 1 = 3$$
1,1 4 $$\left( X - 1 \right)\text{mod}4 + 1 = 4$$
* * *
#### 9.1.3.3 Type-2 HARQ-ACK codebook grouping and HARQ-ACK retransmission
If a UE is provided _pdsch-HARQ-ACK-Codebook-r16,_ the UE determines HARQ-ACK
information for multiplexing in a PUCCH transmission occasion according to the
following procedure.
Set $g$ to the value of a PDSCH group index field in a last DCI format that
provides a value of $g$ and indicates a PUCCH transmission occasion.
Set $i(g)$ to denote a PUCCH transmission occasion for multiplexing HARQ-ACK
information
Set $k$ to the value of a PDSCH-to-HARQ_feedback timing field, if any, in a
DCI format providing a value of $g$
\- If the DCI format does not include a PDSCH-to-HARQ_feedback timing field,
set $k$ to the value provided by _dl-DataToUL-ACK_ or _dl-DataToUL-ACK-r16_
Set $h(g)$ to the value of the New feedback indicator field in the last DCI
format providing the value of $g$ if the New feedback indicator field includes
1 bit, or to the MSB of the **New feedback indicator** field in the last DCI
format providing the value of $g$ if the New feedback indicator field includes
2 bits
Set $h^{\left( g + 1 \right)mod2}(g)$ to a value of the LSB of the **New
feedback indicator** field in the last DCI format providing the value of $g$
if the New feedback indicator field includes 2 bits, or to $\varnothing$
otherwise
Set $V_{\text{DAI}}^{\left( g + 1 \right)mod2}$ to the value of a total DAI
field for group $\left( g + 1 \right)mod2$ in the last DCI format providing
the value of $g$
\- If $g = 1$ and the UE detects a DCI format that does not include a PDSCH
group index field in a PDCCH reception that is after the PDCCH reception for
the last DCI format detection providing the value of $g$ and indicating a same
slot for a PUCCH transmission occasion, set $V_{\text{DAI}}^{\left( g + 1
\right)mod2} = \varnothing$
Set $q$ to the value of a number of requested PDSCH group(s) field in the last
DCI format providing the value of _g_
A UE does not expect to detect DCI formats with respective
\- Number of requested PDSCH group(s) field values of 0, and
\- PDSCH-to-HARQ_feedback timing field values that indicate a same PUCCH
transmission occasion, and
\- PDSCH group index field values that are different
Generate first HARQ-ACK information for PUCCH transmission occasion $i(g)$ in
a slot, as described in clause 9.1.3.1, where
\- the first HARQ-ACK information corresponds only to detections of DCI
formats each providing a same value of $g$, of $h(g)$, and to detections of
DCI formats that do not provide a value of $g$ and $h(g)$ and are associated
with a same value of $g$, of $h(g)$, and at least one of the DCI formats
providing a value of $k$ indicating the slot
\- at least one of the DCI formats provides a $h(g)$ value
\- $m = 0$ corresponds to a PDCCH monitoring occasion, where the UE detects a
DCI format that provides a value of $g$ or is associated with a value of $g$,
that is the first PDCCH monitoring occasion after a PDCCH monitoring occasion
where the UE detects another DCI format that provides a value different than
$h(g)$
The generation of the first HARQ-ACK information for PUCCH transmission
occasion $i\left( g \right)$ in a slot, as described in clause 9.1.3.1,
excludes the generation of HARQ-ACK information for SPS PDSCH receptions.
If $h^{\left( g + 1 \right)mod2}\left( g \right) = \varnothing$ or $h^{\left(
g + 1 \right)mod2}\left( g \right) = h(\left( g + 1 \right)mod2)$, generate
second HARQ-ACK information for PUCCH transmission occasion $i(\left( g + 1
\right)mod2)$ in a slot, as described in clause 9.1.3.1, where
\- the second HARQ-ACK information corresponds to detections of DCI formats
each providing a same value of $\left( g + 1 \right)mod2$, of $h(\left( g + 1
\right)mod2)$ and to detections of DCI formats that do not provide a value of
$\left( g + 1 \right)mod2$, of $h(\left( g + 1 \right)mod2)$, but are
associated with a same value of $\left( g + 1 \right)mod2$, of $h(\left( g + 1
\right)mod2)$
\- at least one of the DCI formats provides a $h(\left( g + 1 \right)mod2)$
value
\- $m = 0$ corresponds to a PDCCH monitoring occasion, where the UE detects a
DCI format that provides a value of $\left( g + 1 \right)mod2$ or that is
associated with a value of $\left( g + 1 \right)mod2$, that is the first PDCCH
monitoring occasion after a PDCCH monitoring occasion where the UE detects
another DCI format that provides a value different than $h(\left( g + 1
\right)mod2)$
\- the PUCCH transmission occasion $i(\left( g + 1 \right)mod2)$ is a last one
for multiplexing second HARQ-ACK information and it is not after PUCCH
transmission occasion $i(g)$
\- if $V_{\text{DAI}}^{\left( g + 1 \right)mod2} \neq \varnothing$, after the
completion of the $c$ and $m$ loops for the pseudo-code for the second HARQ-
ACK codebook generation in clause 9.1.3.1, set $V_{temp2} =
V_{\text{DAI}}^{\left( g + 1 \right)mod2}$. If the UE is provided _PDSCH-
CodeBlockGroupTransmission_ for $N_{\text{cells}}^{DL,CBG}$ serving cells, set
$V_{temp2} = V_{\text{DAI}}^{\left( g + 1 \right)mod2}$ for both sub-codebooks
before appending the second sub-codebook to the first sub-codebook.
If $h^{\left( g + 1 \right)mod2}\left( g \right) \neq \varnothing$ and
$h^{\left( g + 1 \right)mod2}\left( g \right) \neq h(\left( g + 1
\right)mod2)$, generate second HARQ-ACK information as described in clause
9.1.3.1 by setting $M = 0$ and, after the completion of the $c$ and $m$ loops
for the pseudo-code for the second HARQ-ACK codebook generation in clause
9.1.3.1, setting $V_{temp2} = V_{\text{DAI}}^{\left( g + 1 \right)mod2}$.
The generation of the second HARQ-ACK information for PUCCH transmission
occasion $i(\left( g + 1 \right)mod2)$ in a slot, as described in clause
9.1.3.1, excludes the generation of HARQ-ACK information for SPS PDSCH
receptions.
If $q = 0$, the UE
includes only the first HARQ-ACK information for multiplexing in PUCCH
transmission occasion $i(g)$
elseif $q = 1$
if g = 1
> appends the first HARQ-ACK information to the second HARQ-ACK information
> for multiplexing in PUCCH transmission occasion $i(g)$
else
> append the second HARQ-ACK information to the first HARQ-ACK information for
> multiplexing in PUCCH transmission occasion $i(g)$
end if
end if
The UE appends the HARQ-ACK information corresponding to SPS PDSCH receptions,
if any, as described in clause 9.1.3.1, after the first and second, if any,
HARQ-ACK information.
If the HARQ-ACK information is multiplexed in a PUSCH transmission, the HARQ-
ACK information is determined as
\- for multiplexing in PUCCH transmission occasion $i(g)$, if the PUSCH
transmission is not scheduled by a DCI format or is scheduled by a DCI format
that does not include a DCI field with value $V_{\text{DAI}}^{\text{UL}}$
\- for multiplexing in PUCCH transmission occasion $i(g)$, if the PUSCH
transmission is scheduled by a DCI format without _ul-TotalDAI-Included_
configured except that for PDSCH group $g$, the DCI field with value
$V_{\text{DAI}}^{\text{UL}}$ in the DCI format is used after the completion of
the $c$ and $m$ loops for the pseudo-code for the HARQ-ACK codebook generation
in clause 9.1.3.1, and when the HARQ-ACK information multiplexed in the PUCCH
transmission occasion $i\left( g \right)$ does not include HARQ-ACK
information for PDSCH group $\left( g + 1 \right)mod2$
\- for multiplexing in PUCCH transmission occasion $i(g)$, if the PUSCH
transmission is scheduled by a DCI format without _ul-TotalDAI-Included_
configured except that for PDSCH group $g = 0$, the DCI field with value
$V_{\text{DAI}}^{\text{UL}}$ in the DCI format is used after the completion of
the $c$ and $m$ loops for the pseudo-code for the HARQ-ACK codebook generation
in clause 9.1.3.1, and when the HARQ-ACK information multiplexed in the PUCCH
transmission occasion $i\left( g \right)$ includes HARQ-ACK information for
PDSCH groups $g$ and $\left( g + 1 \right)mod2$
\- for multiplexing in PUCCH transmission occasion $i(g)$, if the PUSCH
transmission is scheduled by a DCI format without _ul-TotalDAI-Included_
configured except that for PDSCH group $g = 0$, the DCI field with value in
the DCI format is used after the completion of the $c$ and $m$ loops for the
pseudo-code for the HARQ-ACK codebook generation in clause 9.1.3.1, and when
the UE has not detected any DCI format scheduling PDSCH receptions, and the UE
has not detected any DCI format with a request for HARQ-ACK information for
any PDSCH group
\- for multiplexing in PUCCH transmission occasion $i(g)$, if the PUSCH
transmission is scheduled by a DCI format with _ul-TotalDAI-Included_
configured except that MSBs of the DCI field with value
$V_{\text{DAI}}^{\text{UL}}$ in the DCI format are used for PDSCH group $g =
0$, and LSBs of DCI field with value $V_{\text{DAI}}^{\text{UL}}$ in the DCI
format are used for PDSCH group $g = 1$, after the completion of the $c$ and
$m$ loops for the pseudo-code for the HARQ-ACK codebook generation in clause
9.1.3.1.
If a UE is scheduled a PUSCH transmission by DCI format 0_1 having a DAI field
value $V_{\text{DAI}}^{\text{UL}} = 4$ for a PDSCH group index, and the UE has
not detected any DCI format scheduling PDSCH receptions for the PDSCH group
index, and the UE has not detected any DCI format with a request for HARQ-ACK
information for the PDSCH group index, the UE does not multiplex HARQ-ACK
information in the PUSCH transmission for the PDSCH group index.
If a UE detects DCI formats with respective PDSCH-to-HARQ_feedback timing
field values indicating a same PUCCH transmission occasion and none of the DCI
formats that the UE detects after a last PUCCH transmission occasion for $g =
0$ includes a **New feedback indicator** field for $g = 0$, and at least one
of the DCI formats is DCI format 1_0, the UE generates HARQ-ACK information
only for PDSCH receptions scheduled by detections of DCI format 1_0 and SPS
PDSCH releases indicated by detections of DCI format 1_0, as described in
clause 9.1.3.1 or 9.1.3.2 for multiplexing in the PUCCH transmission occasion.
If a DCI format indicating a slot for a PUCCH transmission occasion does not
include a New feedback indicator field, a PDSCH reception scheduled by the DCI
format or a SPS PDSCH release indicated by the DCI format is associated with
PDSCH group 0 and a value of _h_(_g_) associated with the DCI format is set
only if _h_(_g_) is provided by another DCI format that provides a value of
_h_(_g_) for PDSCH group 0 and indicates the slot for the PUCCH transmission
occasion.
For PUCCH transmission occasion $i(g)$, the UE determines a PUCCH or a PUSCH
transmission to multiplex the HARQ-ACK information according to the procedures
in clauses 9.2.3 and 9.2.5.
If $O_{\text{ACK}} + O_{\text{SR}} + O_{\text{CSI}} \leq 11$, the UE
determines a number of HARQ-ACK information bits $n_{HARQ - ACK,g}\ $for group
$g\ $and a number of HARQ-ACK information bits $n_{HARQ - ACK,(g + 1)mod2}$
for group $\left( g + 1 \right)mod2$ as described in clause 9.1.3.1 where
$N_{\text{SPS},c}$ is included in $n_{HARQ - ACK,g}$ and, if $q = 1$ and
$V_{\text{DAI}}^{\left( g + 1 \right)mod2} \neq \varnothing$, the UE
determines $n_{HARQ - ACK,(g + 1)mod2}$ by setting
${V_{DAI,m_{\text{last}}}^{\text{DL}} = V}_{\text{DAI}}^{\left( g + 1
\right)mod2}$. For obtaining a PUCCH transmission power, if $q = 0$, $n_{HARQ
- ACK}\ = \ n_{HARQ - ACK,\ \ g}$; else, $n_{HARQ - ACK}\ = \ n_{HARQ - ACK,g}
+ n_{HARQ - ACK,\ \ (g + 1)mod2}$.
### 9.1.4 Type-3 HARQ-ACK codebook determination
If a UE is provided _pdsch-HARQ-ACK-OneShotFeedback or pdsch-HARQ-ACK-
EnhType3ToAddModList,_ the UE determines
${\widetilde{o}}_{0}^{\text{ACK}},{\widetilde{o}}_{1}^{\text{ACK}},\ldots,{\widetilde{o}}_{O_{\text{ACK}}
- 1}^{\text{ACK}}$ HARQ-ACK information bits, for a total number of
$O_{\text{ACK}}$ HARQ-ACK information bits, of a Type-3 HARQ-ACK codebook
according to the following procedure. If the UE is provided _pdsch-HARQ-ACK-
EnhType3ToAddModList_ and a DCI format scheduling PDSCH reception and
triggering the Type-3 HARQ-ACK codebook includes an enhanced Type 3 codebook
indicator field that provides a value for _pdsch-HARQ-ACK-EnhType3Index_ , the
UE determines a size of a set of indicated serving cells
$N_{\text{cells}}^{DL,ind}$ and a size of a set of indicated HARQ process
numbers $N_{HARQ,c}^{DL,ind}$ for each indicated serving cell and each
indicated HARQ process number from the entry in _pdsch-HARQ-ACK-
EnhType3ToAddModList_ corresponding to the _pdsch-HARQ-ACK-EnhType3Index_
value. Each bit from MSB to LSB provided by _perCC_ corresponds to a serving
cell in ascending order of serving cell index, where value '1' or value '0'
indicate HARQ-ACK for the corresponding serving cell is included or not
included in the Type 3 HARQ-ACK codebook, respectively. Each bit string
provided by _perHARQ_ corresponds to a serving cell in ascending order of
serving cell index, and each bit from MSB to LSB within a bit string
corresponds to a HARQ process number on a corresponding serving cell in
ascending order of HARQ process number, where value '1' or value '0' indicate
HARQ-ACK for the corresponding HARQ process number on the corresponding
serving cell is included or not included in the Type 3 HARQ-ACK codebook,
respectively. If the DCI format does not include the enhanced Type 3 codebook
indicator field, the _pdsch-HARQ-ACK-EnhType3Index_ value is zero.
Set $N_{\text{cells}}^{\text{DL}}$ to the number of configured serving cells
or, when applicable, to $N_{\text{cells}}^{DL,ind}$.
Set $N_{HARQ,c}^{\text{DL}}$ to the value of _nrofHARQ-ProcessesForPDSCH_ or
_nrofHARQ-ProcessesForPDSCH-v1700_ for serving cell $c$, if provided; else,
set $N_{HARQ,c}^{\text{DL}} = 8$ . When applicable, set
$N_{HARQ,c}^{\text{DL}}$ to $N_{HARQ,c}^{DL,ind}$.
Set $N_{TB,c}^{\text{DL}}$ to the maximum value of
_maxNrofCodeWordsScheduledByDCI_ in _PDSCH-config_ and _PDSCH-configMulticast_
for serving cell $c$ if _harq-ACK-SpatialBundlingPUCCH_ is provided and
$\text{NDI}_{\text{HARQ}} = 0$, or if _harq-ACK-SpatialBundlingPUCCH_ is not
provided, or if _maxCodeBlockGroupsPerTransportBlock_ is provided for serving
cell $c$; else, set $N_{TB,c}^{\text{DL}} = 1$.
Set $N_{HARQ - ACK,c}^{CBG/TB,max}$ to the number of HARQ-ACK information bits
per TB for PDSCH receptions on serving cell $c$ as described in clause 9.1.1
if _maxCodeBlockGroupsPerTransportBlock_ is provided for serving cell $c$ and
_pdsch-HARQ-ACK-OneShotFeedbackCBG_ or _pdsch-HARQ-ACK-EnhType3CBG_
corresponding to the _pdsch-HARQ-ACK-EnhType3Index_ value is provided; else,
set $N_{HARQ - ACK,c}^{CBG/TB,max} = 0$. A UE provided with _pdsch-HARQ-ACK-
OneShotFeedbackCBG_ or _pdsch-HARQ-ACK-EnhType3CBG_ does not expect to be
provided with different values of _maxCodeBlockGroupsPerTransportBlock_ for
different priority indexes in _pdsch-CodeBlockGroupTransmissionList for
serving cell c._
Set $\text{NDI}_{\text{HARQ}} = 0$ if _pdsch-HARQ-ACK-OneShotFeedbackNDI_ or
_pdsch-HARQ-ACK-EnhType3NDI_ is provided; else set $\text{NDI}_{\text{HARQ}} =
1$.
Set $c = 0$ -- serving cell index in the set of serving cells
Set $h = 0$ -- HARQ process number index in the set of numbers of HARQ
processes
Set $t = 0$ -- TB index
Set $g = 0$ -- CBG index
Set $j = 0$
while ${c  if _downlinkHARQ-FeedbackDisabled_ is not provided, or is provided and
> indicates enabled HARQ-ACK information for $h$, or _harq-
> feedbackEnablingforSPSactive_ is provided and enabled and $h$ corresponds to
> a transport block in a first SPS PDSCH reception after an activation of SPS
> PDSCH receptions
if $\text{NDI}_{\text{HARQ}} = 0$
if $N_{HARQ - ACK,c}^{CBG/TB,max} > 0$
> while $t 
> while $g 
> ${\widetilde{o}}_{j}^{\text{ACK}}$= HARQ-ACK information bit for CBG $g$ of
> TB $t$ for HARQ process number index $h$ in the set of numbers of HARQ
> processes of serving cell $c$, if any; else,
> ${\widetilde{o}}_{j}^{\text{ACK}} = 0$
>
> $j = j + 1$
>
> $g = g + 1$
>
> end while
>
> ${\widetilde{o}}_{j}^{\text{ACK}}$= NDI value indicated in the DCI format
> corresponding to the HARQ-ACK information bit(s) for TB $t$ for HARQ process
> number index $h$ in the set of numbers of HARQ processes on serving cell
> $c$, if any; else, ${\widetilde{o}}_{j}^{\text{ACK}} = 0$
>
> $g = 0$
>
> $j = j + 1$
>
> $t = t + 1$
>
> end while
else
> while $t 
> ${\widetilde{o}}_{j}^{\text{ACK}}$= HARQ-ACK information bit for TB $t$ for
> HARQ process index $h$ in the set of numbers of HARQ processes of serving
> cell $c$, if any; else, ${\widetilde{o}}_{j}^{\text{ACK}} = 0$
>
> $j = j + 1$
>
> ${\widetilde{o}}_{j}^{\text{ACK}}$= NDI value indicated in the DCI format
> corresponding to the HARQ-ACK information bit(s) for TB $t$ for HARQ process
> number index $h$ in the set of numbers of HARQ processes on serving cell
> $c$, if any; else, ${\widetilde{o}}_{j}^{\text{ACK}} = 0$
>
> $j = j + 1$
>
> $t = t + 1$
>
> end while
end if
$t = 0$
else
if $N_{HARQ - ACK,c}^{CBG/TB,max} > 0$
> while $t 
> if UE has obtained HARQ-ACK information for TB $t$ for HARQ process number
> index $h$ in the set of numbers of HARQ processes on serving cell $c$
> corresponding to a PDSCH reception and has not reported the HARQ-ACK
> information corresponding to the PDSCH reception
>
> while $g 
> ${\widetilde{o}}_{j}^{\text{ACK}}$= HARQ-ACK information bit for CBG $g$ of
> TB $t$ for HARQ process number index $h$ in the set of numbers of HARQ
> processes of serving cell $c$
>
> $j = j + 1$
>
> $g = g + 1$
>
> end while
>
> else
>
> while $g 
> ${\widetilde{o}}_{j}^{\text{ACK}} = \text{NACK}$
>
> $j = j + 1$
>
> $g = g + 1$
>
> end while
>
> end if
>
> $g = 0$
>
> $t = t + 1$
>
> end while
else
> while $t 
> if UE has obtained HARQ-ACK information for TB $t$ for HARQ process number
> index $h$ in the set of numbers of HARQ processes on serving cell $c$
> corresponding to a PDSCH reception and has not reported the HARQ-ACK
> information corresponding to the PDSCH reception
>
> if _harq-ACK-SpatialBundlingPUCCH_ is not provided
>
> ${\widetilde{o}}_{j}^{\text{ACK}}$= HARQ-ACK information bit for TB $t$ for
> HARQ process number index $h$ in the set of numbers of HARQ processes of
> serving cell $c$
>
> else
>
> ${\widetilde{o}}_{j}^{\text{ACK}}$= binary AND operation of the HARQ-ACK
> information bits corresponding to first and second transport blocks for HARQ
> process number index $h$ in the set of numbers of HARQ processes of serving
> cell $c$. If the UE receives one transport block, the UE assumes ACK for the
> second transport block
>
> end if
>
> $j = j + 1$
>
> $t = t + 1$
>
> else
>
> ${\widetilde{o}}_{j}^{\text{ACK}} = \text{NACK}$
>
> $j = j + 1$
>
> $t = t + 1$
>
> end if
>
> end while
end if
$t = 0$
end if
end if
$h = h + 1$
end while
$h = 0$
$c = c + 1$
end while
If $N_{TB,c}^{\text{DL}} > 1$, when a UE receives a PDSCH with one transport
block, the HARQ-ACK information is associated with the first transport block.
If a UE receives a SPS PDSCH, or a PDSCH that is scheduled by a DCI format
that does not support CBG-based PDSCH receptions for a serving cell $c$, and
if _maxCodeBlockGroupsPerTransportBlock_ is provided for serving cell $c$, and
_pdsch-HARQ-ACK-OneShotFeedbackCBG_ or _pdsch-HARQ-ACK-EnhType3CBG_
corresponding to the _pdsch-HARQ-ACK-EnhType3Index_ value is provided, the UE
repeats $N_{HARQ - ACK,c}^{CBG/TB,max}$ times the HARQ-ACK information for the
transport block, if any, in the PDSCH.
If a UE detects a DCI format that includes a One-shot HARQ-ACK request field
with value 1, the UE determines a PUCCH or a PUSCH to multiplex a Type-3 HARQ-
ACK codebook for transmission in a slot as described in clauses 9.2.3 and
9.2.5. If the UE is provided a periodic cell switching pattern for PUCCH
transmissions by _pucch-sSCellPattern_ , the UE determines the slot and a
corresponding cell based on the periodic cell switching pattern as described
in clause 9.A. The UE multiplexes only the Type-3 HARQ-ACK codebook in the
PUCCH or the PUSCH for transmission in the slot. If the UE is provided _pdsch-
HARQ-ACK-EnhType3ToAddModList_ , the UE expects that HARQ-ACK information in a
Type-1 or Type-2 HARQ-ACK codebook in a slot is associated with HARQ
process(es) of the Type-3 HARQ-ACK codebook in the slot.
If
\- a UE detects a DCI format that includes a One-shot HARQ-ACK request field
with value 1, and
\- the CRC of the DCI is scrambled by a C-RNTI or an MCS-C-RNTI, and
\- _resourceAllocation_ = _resourceAllocationType0_ and all bits of the
frequency domain resource assignment field in the DCI format are equal to 0,
or
\- _resourceAllocation_ = _resourceAllocationType1_ and all bits of the
frequency domain resource assignment field in the DCI format are equal to 1,
or
\- _resourceAllocation = dynamicSwitch_ and all bits of the frequency domain
resource assignment field in the DCI format are equal to 0 or 1
the DCI format provides a request for a Type-3 HARQ-ACK codebook report and
does not schedule a PDSCH reception. If the UE is provided _pdsch-HARQ-ACK-
EnhType3ToAddModList_ and the DCI format includes an enhanced Type 3 codebook
indicator field that provides a value for _pdsch-HARQ-ACK-EnhType3Index_ , the
UE determines a size of a set of indicated serving cells
$N_{\text{cells}}^{DL,ind}$ and a size of a set of indicated HARQ process
numbers $N_{HARQ,c}^{DL,ind}$ for each indicated serving cell $\text{and\
each\ indicated\ HARQ\ process\ number}$ from the entry in _pdsch-HARQ-ACK-
EnhType3ToAddModList_ corresponding to the _pdsch-HARQ-ACK-EnhType3Index_
value. If the DCI format does not include the enhanced Type 3 codebook
indicator field, the _pdsch-HARQ-ACK-EnhType3Index_ value is provided by the
value of the MCS field for transport block 1 in the DCI format 1_1 or the MCS
field in the DCI format 1_2. The UE is expected to provide HARQ-ACK
information in response to the request for the Type-3 HARQ-ACK codebook after
$N$ symbols from the last symbol of a PDCCH providing the DCI format, where
the value of $N$ is provided in clause 10.2 by replacing \"SPS PDSCH release\"
with \"DCI format\".
If a UE multiplexes HARQ-ACK information in a PUSCH transmission, the UE
generates the HARQ-ACK codebook as described in this clause except that _harq-
ACK-SpatialBundlingPUCCH_ is replaced by _harq-ACK-SpatialBundlingPUSCH_.
### 9.1.5 HARQ-ACK codebook retransmission
With reference to slots of PUCCH transmissions on the primary cell and for
Type-1 or Type-2 HARQ-ACK codebooks, a UE that transmitted or would transmit a
PUCCH or a PUSCH with a first HARQ-ACK codebook in slot $m$ can be indicated
by a DCI format with CRC scrambled by a C-RNTI or a MCS-C-RNTI that does not
schedule a PDSCH reception [4, TS 38.212] and is received in a PDCCH ending in
slot $n$, to transmit a PUCCH with the first HARQ-ACK codebook in slot $n +
k$, where slot $n + k$ is after slot $m$. The UE determines $k$ and a resource
for the PUCCH transmission as described in clauses 9.2.3 and 9.2.5. If the UE
is provided a periodic cell switching pattern for PUCCH transmissions by
_pucch-sSCellPattern_ , the UE further determines a corresponding cell based
on the periodic cell switching pattern as described in clause 9.A.
If the HARQ-ACK retransmission indicator field value in the DCI format 1_1 or
1_2 is \'1\', the UE determines slot $m$ as $m = n - l$ where $l$ is
determined by a one-to-one mapping in ascending order among the values of the
MCS field for transport block 1 in the DCI format 1_1 or the MCS field in the
DCI format 1_2 and the values from -7 to 24.
If the DCI format 1_1 or 1_2 includes a priority indicator field having a
value, a priority value of first HARQ-ACK information in the first HARQ-ACK
codebook is same as the value of the priority indicator field; otherwise, the
priority value of the first HARQ-ACK information is zero.
If a UE
\- is not provided _coresetPoolIndex_ or is provided _coresetPoolIndex_ with a
value of 0 for first CORESETs on active DL BWPs of serving cells, and
\- is provided _coresetPoolIndex_ with a value of 1 for second CORESETs on
active DL BWPs of the serving cells, and
\- is provided _ackNackFeedbackMode_ = _separate_
the first HARQ-ACK codebook is associated with the first CORESETs or with the
second CORESETs, as described in clause 9, when the UE receives the PDCCH
providing the DCI format in a CORESET from the first CORESETs or from the
second CORESETs, respectively.
If the UE would also multiplex in the PUCCH transmission in slot $n + k$ a
second HARQ-ACK codebook with second HARQ-ACK information of same priority
value as for the first HARQ-ACK information in the first HARQ-ACK codebook,
the UE appends the first HARQ-ACK codebook to the second HARQ-ACK codebook.
The UE determines to multiplex the second HARQ-ACK information in the PUCCH
transmission in slot $n + k$ as described in clause 9.2.3.
If the UE performs a procedure for deferring first HARQ-ACK information for
SPS PDSCH receptions to slot $n + k$, as described in clause 9.2.5.4, and the
first HARQ-ACK information has same priority value as a priority value
indicated by the DCI format triggering the PUCCH transmission in slot $n + k$,
the UE multiplexes in the PUCCH transmission in slot $n + k$ second HARQ-ACK
information with the priority value that results in slot $n + k$ according to
the procedure in this clause, by appending the first HARQ-ACK information to
the second HARQ-ACK information. If the UE would also multiplex in the PUCCH
transmission in slot $n + k$ third HARQ-ACK information with the priority
value, the UE appends the second HARQ-ACK information followed by the first
HARQ-ACK information to the third HARQ-ACK information. The UE determines to
multiplex the third HARQ-ACK information in the PUCCH transmission in slot $n
+ k$ as described in clause 9.2.3.
If in slot $m$ the UE would transmit a first PUCCH with first HARQ-ACK
information over more than one slot and a second PUCCH with second HARQ-ACK
information over one or more slots, where the first and second HARQ-ACK
information have same priority value, the UE multiplexes in the PUCCH
transmission in slot $n + k$ one of
\- the first HARQ-ACK information if the first PUCCH starts at an earlier slot
than the second PUCCH, or
\- the second HARQ-ACK information if the second PUCCH starts at an earlier
slot than the first PUCCH.
## 9.2 UCI reporting in physical uplink control channel
UCI types reported in a PUCCH include HARQ-ACK information, SR, LRR, and CSI.
UCI bits include HARQ-ACK information bits, if any, SR information bits, if
any, LRR information bit, if any, and CSI bits, if any. The HARQ-ACK
information bits correspond to a HARQ-ACK codebook as described in clause 9.1.
For the remaining of this clause, any reference to SR is applicable for SR
and/or for LRR.
A UE may transmit one or two PUCCHs on a serving cell in different symbols
within a slot. When the UE transmits two PUCCHs in a slot and the UE is not
provided _ackNackFeedbackMode_ = _separate_ , at least one of the two PUCCHs
uses PUCCH format 0 or PUCCH format 2.
If a UE is provided _ackNackFeedbackMode_ = _separate, the UE_ may transmit up
to two PUCCHs with HARQ-ACK information in different symbols within a slot.
In clauses 9.2.3, 9.2.5.1, 9.2.5.2 and 9.2.5.3, a UE assumes 11 CRC bits if a
number of respective UCI bits is larger than or equal to 360; otherwise, the
UE determines a number of CRC bits based on the number of respective UCI bits
as described in [5, TS 38.212].
### 9.2.1 PUCCH Resource Sets
If a UE does not have dedicated PUCCH resource configuration, provided by
_PUCCH-ResourceSet_ in _PUCCH-Config_ , a PUCCH resource set is provided by
_pucch-ResourceCommon_ through an index to a row of Table 9.2.1-1 for
transmission of HARQ-ACK information on PUCCH in an initial UL BWP of
$N_{\text{BWP}}^{\text{size}}$ PRBs. For operation in FR2-2, _nrofPRBs_
provided in _PUCCH-ConfigCommon_ can also provide a number of $N_{\text{RB}}$
RBs for the PUCCH resource set; otherwise $N_{\text{RB}} = 1$.
The PUCCH resource set includes sixteen resources, each corresponding to a
PUCCH format, a first symbol, a duration, a PRB offset
$\text{RB}_{\text{BWP}}^{\text{offset}}$, and a cyclic shift index set for a
PUCCH transmission.
The UE transmits a PUCCH using frequency hopping if not provided
_useInterlacePUCCH-PUSCH in BWP-UplinkCommon_ ; otherwise, _the UE transmits a
PUCCH without frequency hopping_.
An orthogonal cover code with index 0 is used for a PUCCH resource with PUCCH
format 1 in Table 9.2.1-1 except when index 3, 7, or 11 is indicated by
_pucch-ResourceCommon_ and _useInterlacePUCCH-PUSCH in BWP-UplinkCommon_ is
provided.
The UE transmits the PUCCH using the same spatial domain transmission filter
as for a PUSCH transmission scheduled by a RAR UL grant as described in clause
8.3.
If a UE is not provided any of _pdsch-HARQ-ACK-Codebook_ , _pdsch-HARQ-ACK-
Codebook-r16_ , or _pdsch-HARQ-ACK-OneShotFeedback_ , the UE generates at most
one HARQ-ACK information bit.
If the UE provides HARQ-ACK information in a PUCCH transmission in response to
detecting a DCI format scheduling a PDSCH reception or having associated HARQ-
ACK information without scheduling a PDSCH reception, the UE determines a
PUCCH resource with index $r_{\text{PUCCH}}$, $0{\leq r}_{\text{PUCCH}} \leq
15$, as $r_{\text{PUCCH}} = \left\lfloor \frac{2{\cdot
n}_{CCE,0}}{N_{\text{CCE}}} \right\rfloor + 2 \cdot
\mathrm{\Delta}_{\text{PRI}}$, where $N_{\text{CCE}}$ is a number of CCEs in a
CORESET of a PDCCH reception with the DCI format, as described in clause 10.1,
$n_{CCE,0}$ is the index of a first CCE for the PDCCH reception, and
$\mathrm{\Delta}_{\text{PRI}}$ is a value of the PUCCH resource indicator
field in the DCI format.
When the PDCCH reception by a UE includes first and second PDCCH candidates
from respective first and second search space sets, as described in clause
10.1, the CORESET and $n_{CCE,0}$ are associated with the search space set
having the smaller index. If
\- the first search space set has larger index than the second search space
set and includes the first PDCCH candidate and a third PDCCH candidate that
have same first CCE index and CCE aggregation levels 8 and 16, or 16 and 8,
respectively,
\- the second search space set includes the second PDCCH candidate that has
same index and same CCE aggregation level as the first PDCCH candidate, and a
fourth PDCCH candidate that has same index and same CCE aggregation level as
the third PDCCH candidate,
\- the CORESET associated with the first search space set has _cce-REG-
MappingType_ = \'_nonInterleaved_ \' and has duration of one symbol, and
\- the second PDCCH candidate has different first CCE index than the fourth
PDCCH candidate
the UE determines $n_{CCE,0}$ from the PDCCH candidate with CCE aggregation
level 16 among the second PDCCH candidate and the fourth PDCCH candidate.
If $\left\lfloor \frac{r_{\text{PUCCH}}}{8} \right\rfloor = 0$ and a UE is
provided a PUCCH resource by _pucch-ResourceCommon_ and is not provided
_useInterlacePUCCH-PUSCH in BWP-UplinkCommon_
\- the UE determines the lowest PRB index of the PUCCH transmission in the
first hop as $\text{RB}_{\text{BWP}}^{\text{offset}} \cdot N_{\text{RB}} +
\left\lfloor \frac{r_{\text{PUCCH}}}{N_{\text{CS}}} \right\rfloor \bullet
N_{\text{RB}}$ and the lowest PRB index of the PUCCH transmission in the
second hop as ${N_{\text{BWP}}^{\text{size}} -
RB}_{\text{BWP}}^{\text{offset}} \bullet N_{\text{RB}} - \left( 1 +
\left\lfloor \frac{r_{\text{PUCCH}}}{N_{\text{CS}}} \right\rfloor \right)
\bullet N_{\text{RB}}$, where $N_{\text{CS}}$ is the total number of initial
cyclic shift indexes in the set of initial cyclic shift indexes
\- the UE determines the initial cyclic shift index in the set of initial
cyclic shift indexes as $r_{\text{PUCCH}}\text{mod}N_{\text{CS}}$
If $\left\lfloor \frac{r_{\text{PUCCH}}}{8} \right\rfloor = 1$ and a UE is
provided a PUCCH resource by _pucch-ResourceCommon_ and is not provided
_useInterlacePUCCH-PUSCH in BWP-UplinkCommon_
\- the UE determines the lowest PRB index of the PUCCH transmission in the
first hop as ${N_{\text{BWP}}^{\text{size}} - RB}_{\text{BWP}}^{\text{offset}}
\bullet N_{\text{RB}} - \left( 1 + \left\lfloor \frac{\left( r_{\text{PUCCH}}
- 8 \right)}{N_{\text{CS}}} \right\rfloor \right) \bullet N_{\text{RB}}$ and
the lowest PRB index of the PUCCH transmission in the second hop as
$\text{RB}_{\text{BWP}}^{\text{offset}} \bullet N_{\text{RB}} + \left\lfloor
\frac{\left( r_{\text{PUCCH}} - 8 \right)}{N_{\text{CS}}} \right\rfloor
\bullet N_{\text{RB}}$
\- the UE determines the initial cyclic shift index in the set of initial
cyclic shift indexes as
If a UE is provided a PUCCH resource by _pucch-ResourceCommon_ and is provided
_useInterlacePUCCH-PUSCH in BWP-UplinkCommon_
\- the UE determines for the PUCCH resource an interlace index $m$ as $m =
\left( m_{0} + \left\lfloor \frac{r_{\text{PUCCH}}}{N_{\text{CS}}}
\right\rfloor \right)\text{mod}M$ where $M$ is a number of interlaces [4, TS
38.211] and $m_{0} = \text{RB}_{\text{BWP}}^{\text{offset}}$ is an interlace
index offset and $\text{RB}_{\text{BWP}}^{\text{offset}}$ is as given in Table
9.2.1-1
\- the UE determines an initial cyclic shift index in a set of initial cyclic
shift indexes as $r_{\text{PUCCH}}\text{mod}N_{\text{CS}}$, where
$N_{\text{CS}}$ is the total number of initial cyclic shifts indexes in the
set of initial cyclic shift indexes in Table 9.2.1-1
\- if _pucch-ResourceCommon_ indicates
\- index 0: the first symbol is 9 for a PUCCH resource with PUCCH format 0 if
$r_{\text{PUCCH}} \geq 10$
\- index 1 or 2: the first symbol is 9 for a PUCCH resource with PUCCH format
0 if $r_{\text{PUCCH}} = 15$
\- index 3, 7, or 11: an orthogonal cover code with index 1 is used for a
PUCCH resource with PUCCH format 1 if $r_{\text{PUCCH}} \geq 10$; otherwise,
an orthogonal cover code with index 0 is used for a PUCCH resource with PUCCH
format 1
\- the UE does not expect _pucch-ResourceCommon_ to indicate index 15
Table 9.2.1-1: PUCCH resource sets before dedicated PUCCH resource
configuration
**Index** **PUCCH format** **First symbol** **Number of symbols** **PRB
offset** $\text{RB}_{\text{BWP}}^{\text{offset}}$ **Set of initial CS
indexes**
* * *
0 0 12 2 0 {0, 3} 1 0 12 2 0 {0, 4, 8} 2 0 12 2 3 {0, 4, 8} 3 1 10 4 0 {0, 6}
4 1 10 4 0 {0, 3, 6, 9} 5 1 10 4 2 {0, 3, 6, 9} 6 1 10 4 4 {0, 3, 6, 9} 7 1 4
10 0 {0, 6} 8 1 4 10 0 {0, 3, 6, 9} 9 1 4 10 2 {0, 3, 6, 9} 10 1 4 10 4 {0, 3,
6, 9} 11 1 0 14 0 {0, 6} 12 1 0 14 0 {0, 3, 6, 9} 13 1 0 14 2 {0, 3, 6, 9} 14
1 0 14 4 {0, 3, 6, 9} 15 1 0 14 $$\left\lfloor
\frac{N_{\text{BWP}}^{\text{size}}}{4} \right\rfloor$$ {0, 3, 6, 9}
If a UE has dedicated PUCCH resource configuration, the UE is provided by
higher layers with one or more PUCCH resources.
A PUCCH resource includes the following parameters:
\- a PUCCH resource index provided by _pucch-ResourceId_
\- an index of the first PRB prior to frequency hopping or for no frequency
hopping by _startingPRB_ , if a UE is not provided _useInterlacePUCCH-PUSCH in
BWP-UplinkDedicated_
\- an index of the first PRB after frequency hopping by _secondHopPRB_ , if a
UE is not provided _useInterlacePUCCH-PUSCH in BWP-UplinkDedicated_
\- an indication for intra-slot frequency hopping by
_intraSlotFrequencyHopping_ , if a UE is not provided _useInterlacePUCCH-PUSCH
in BWP-UplinkDedicated_
\- an index of a first interlace by _interlace0_ , if a UE is provided
_useInterlacePUCCH-PUSCH in BWP-UplinkDedicated_
\- if provided, an index of a second interlace by _interlace1_ , if a UE is
provided _useInterlacePUCCH-PUSCH in BWP-UplinkDedicated_
\- an index of an RB set by _rb-SetIndex_ , if a UE is provided
_useInterlacePUCCH-PUSCH in BWP-UplinkDedicated_
\- a configuration for a PUCCH format provided by _format_
For operation with shared spectrum channel access, the UE does not expect that
two hops of a PUCCH transmission are in different RB sets.
The UE expects that _useInterlacePUCCH-PUSCH in BWP-UplinkCommon and
useInterlacePUCCH-PUSCH in BWP-UplinkDedicated are provided either in all UL
BWPs or in none of the UL BWPs for a serving cell_.
If a UE is provided _useInterlacePUCCH-PUSCH in BWP-UplinkDedicated_ , the UE
determines available RBs for PUCCH transmissions within the active UL BWP as
the intersection of RBs _corresponding to an interlace index provided by
interlace0 and, if provided, interlace1, and RBs of an RB set provided by rb-
SetIndex. The intersection results in_ $M_{\text{interlace,0}}^{\text{PUCCH}}$
_RBs in the first interlace and the UE expects that_
$M_{\text{interlace,0}}^{\text{PUCCH}}$ _is either 10 or 11. If interlace1 is
provided, the intersection results in_ $M_{\text{interlace,1}}^{\text{PUCCH}}$
_RBs in the second interlace and the UE expects that_
$M_{\text{interlace,1}}^{\text{PUCCH}}$ _is either 10 or 11._
If the _format_ indicates _PUCCH-format0_ , the PUCCH format configured for a
PUCCH resource is PUCCH format 0, where the PUCCH resource also includes an
index for an initial cyclic shift provided by _initialCyclicShift_ , a number
of symbols for a PUCCH transmission provided by _nrofSymbols_ , a first symbol
for the PUCCH transmission provided by _startingSymbolIndex_. For PUCCH
transmission in FR2-2, the PUCCH resource can also include a number of PRBs
$M_{\text{RB}}^{\text{PUCCH,}0}$ provided by _nrofPRBs; otherwise,_
$M_{\text{RB}}^{\text{PUCCH,}0} = 1$_._
If the _format_ indicates _PUCCH-format1_ , the PUCCH format configured for a
PUCCH resource is PUCCH format 1, where the PUCCH resource also includes an
index for an initial cyclic shift provided by _initialCyclicShift_ , a number
of symbols for a PUCCH transmission provided by _nrofSymbols_ , a first symbol
for the PUCCH transmission provided by _startingSymbolIndex_ , and an index
for an orthogonal cover code by _timeDomainOCC_. For PUCCH transmission in
FR2-2, the PUCCH resource can also include a number of PRBs
$M_{\text{RB}}^{\text{PUCCH,}1}$ provided by _nrofPRBs; otherwise,_
$M_{\text{RB}}^{\text{PUCCH,}1} = 1$_._
If the _format_ indicates _PUCCH-format2_ or _PUCCH-format3_ , the PUCCH
format configured for a PUCCH resource is PUCCH format 2 or PUCCH format 3,
respectively, where the PUCCH resource also includes a number of PRBs provided
by _nrofPRBs_ , a number of symbols for a PUCCH transmission provided by
_nrofSymbols_ , and a first symbol for the PUCCH transmission provided by
_startingSymbolIndex_. If a UE is provided by _useInterlacePUCCH-PUSCH in BWP-
UplinkDedicated,_ and the _format_ indicates _PUCCH-format2_ or _PUCCH-format3
and PUCCH-ResourceExt_ is provided, the PUCCH resource also includes an index
of a second interlace by _interlace1, if provided_ ; otherwise, _if
interlace1_ is not provided, the PUCCH resource also includes, if provided, an
orthogonal cover code length by _occ-Length_ and an orthogonal cover code
index by _occ-Index_. If the _format_ indicates _PUCCH-format3 and PUCCH-
ResourceExt_ is provided _, the UE assumes that the_
$M_{\text{RB}}^{\text{PUCCH,}3}$ _[4, TS 38.211] PRBs with the lowest indexes
within the first, and if configured, second interlace are used for PUCCH
transmission._
If the _format_ indicates _PUCCH-format4_ , the PUCCH format configured for a
PUCCH resource is PUCCH format 4, where the PUCCH resource also includes a
number of symbols for a PUCCH transmission provided by _nrofSymbols_ , an
orthogonal cover code length by _occ-Length_ , an orthogonal cover code index
by _occ-Index_ , and a first symbol for the PUCCH transmission provided by
_startingSymbolIndex_. For PUCCH transmission in FR2-2, the PUCCH resource can
also include a number of PRBs $M_{\text{RB}}^{\text{PUCCH,}4}$ provided by
_nrofPRBs; otherwise,_ $M_{\text{RB}}^{\text{PUCCH,}4} = 1$_._
If a UE is provided _subslotLengthForPUCCH_ in a _PUCCH-Config_ , the first
symbol of a PUCCH resource provided by _PUCCH-ResourceSet_ or _SPS-PUCCH-AN-
List_ in _PUCCH-Config_ or by _n1PUCCH-AN_ in SPS-Config for multiplexing
HARQ-ACK in a PUCCH transmission is relative to the first symbol of the
_subslotLengthForPUCCH_ symbols [12, TS 38.331]. For the remaining cases, the
first symbol of a PUCCH resource is relative to the first symbol of a slot
with $N_{\text{sym}}^{\text{slot}}$ symbols [4, TS 38.211].
A UE can be configured up to four sets of PUCCH resources in a _PUCCH-Config_.
A PUCCH resource set is provided by _PUCCH-ResourceSet_ and is associated with
a PUCCH resource set index provided by _pucch-ResourceSetId_ , with a set of
PUCCH resource indexes provided by _resourceList_ that provides a set of
_pucch-ResourceId_ used in the PUCCH resource set, and with a maximum number
of UCI information bits the UE can transmit using a PUCCH resource in the
PUCCH resource set provided by _maxPayloadSize_. For the first PUCCH resource
set, the maximum number of UCI information bits is 2. A maximum number of
PUCCH resource indexes for a set of PUCCH resources is provided by
_maxNrofPUCCH-ResourcesPerSet_. The maximum number of PUCCH resources in the
first PUCCH resource set is 32 and the maximum number of PUCCH resources in
the other PUCCH resource sets is 8.
If the UE transmits $O_{\text{UCI}}$ UCI information bits, that include HARQ-
ACK information bits, the UE determines a PUCCH resource set to be
\- a first set of PUCCH resources with _pucch-ResourceSetId_ = 0 if
$O_{\text{UCI}} \leq 2$ including 1 or 2 HARQ-ACK information bits and a
positive or negative SR on one SR transmission occasion if transmission of
HARQ-ACK information and SR occurs simultaneously, or
\- a second set of PUCCH resources with _pucch-ResourceSetId_ = 1, if provided
by higher layers, if ${2  \- the PUCCH resource does not include an orthogonal cover code, or the UE
> is provided _useInterlacePUCCH-PUSCH_ in _BWP-UplinkDedicated_
\- PUCCH format 4 if
\- the transmission is over 4 or more symbols,
\- the number of UCI bits is more than 2,
\- the PUCCH resource includes an orthogonal cover code and the UE is not
provided _useInterlacePUCCH-PUSCH_ in _BWP-UplinkDedicated_
A spatial setting for a PUCCH transmission by a UE is provided by
\- an indicated _TCI-State or_ _TCI-UL-State_ , if provided, as described in
[6, TS 38.214];
\- _PUCCH-SpatialRelationInfo_ if the UE is configured with a single value for
_pucch-SpatialRelationInfoId_ ;
\- as described in [11, TS 38.321], if the UE is provided multiple values for
_PUCCH-SpatialRelationInfo_. **The UE applies corresponding actions in [11, TS
38.321] and a corresponding setting for a spatial domain filter to transmit
PUCCH** in the first slot that is after slot $k + 3 \cdot
N_{\text{s}\text{lot}}^{\text{s}\text{ubframe,}\mu}$ where $k$ is the slot
**where the UE would transmit a PUCCH with HARQ-ACK information with ACK value
corresponding to a PDSCH reception providing the _PUCCH-SpatialRelationInfo_ ,
each slot** consists of $N_{\text{symb}}^{\text{slot}}$ symbols as defined in
[4, TS 38.211], and $\mu$ is the SCS configuration for the PUCCH
\- If _PUCCH-SpatialRelationInfo_ or the indicated _TCI-UL-State_ provides
_ssb-Index_ , the UE transmits the PUCCH using a same spatial domain filter as
for a reception of a SS/PBCH block with index provided by _ssb-Index_ for a
same serving cell or, if _servingCellId_ is provided, for a serving cell
indicated by _servingCellId_
\- else if _PUCCH-SpatialRelationInfo_ or the indicated _TCI-UL-State_
provides _csi-RS-Index_ , or the indicated _TCI-State provides csi-rs
configured with qcl-Type set to \'typeD\',_ the UE transmits the PUCCH using a
same spatial domain filter as for a reception of a CSI-RS with resource index
provided by _csi-RS-Index_ or csi-rs for a same serving cell or, if
_servingCellId_ or _cell_ is provided, for a serving cell indicated by
_servingCellId_ or _cell_
\- else _PUCCH-SpatialRelationInfo_ or the indicated _TCI-UL-State_ provides
_srs_ , the UE transmits the PUCCH using a same spatial domain filter as for a
transmission of a SRS with resource index provided by _resource_ for a same
serving cell _and/or active UL BWP_ or, if _servingCellId_ and/or _uplinkBWP_
are provided, for a serving cell indicated by _servingCellId and/or for an UL
BWP indicated by uplinkBWP_
If a UE
\- is not provided _pathlossReferenceRSs_ in _PUCCH-PowerControl,_
\- is provided _enableDefaultBeamPL-ForPUCCH_ , and
\- is not provided _PUCCH-SpatialRelationInfo_ , _and_
\- is not provided _coresetPoolIndex_ value of 1 for any CORESET, or is
provided _coresetPoolIndex_ value of 1 for all CORESETs, in
_ControlResourceSet_ and no codepoint of a TCI field, if any, in a DCI format
of any search space set maps to two TCI states [5, TS 38.212]
_a spatial setting for a PUCCH transmission from the UE is same as a_ spatial
setting for PDCCH receptions by the UE in the CORESET with the lowest ID on
the active DL BWP of the PCell and, if the CORESET has two activated TCI
states as described in clause 10.1, the UE determines the spatial setting _for
the PUCCH transmission_ based on the first TCI state. For a PUCCH transmission
over multiple slots, a same spatial setting applies to the PUCCH transmission
in each of the multiple slots.
A number of DMRS symbols for a PUCCH transmission using PUCCH format 3 or 4 is
provided by _additionalDMRS_.
Use of π/2-BPSK, instead of QPSK, for a PUCCH transmission using PUCCH format
3 or 4 is indicated by _pi2BPSK_.
A UE that has indicated a capability _beamCorrespondenceWithoutUL-
BeamSweeping_ set to \'supported\', as described in [18, TS 38.306], can
determine a spatial domain filter to be used while performing the applicable
channel access procedures described in [15, TS 37.213] prior to a PUCCH
transmission as follows:
\- if UE is configured with a single value for _pucch-SpatialRelationInfoId_
for the UL transmission, the UE may use a spatial domain filter that is same
as the spatial domain filter associated with _referenceSignal_ in the
corresponding _pucch-SpatialRelationInfo_ ,
\- if UE is configured with more than one value for _pucch-
SpatialRelationInfoId_ for the UL transmission, the UE may use a spatial
domain filter that is same as the spatial domain filter associated with
_referenceSignal_ in the activated _pucch-SpatialRelationInfo_.
### 9.2.3 UE procedure for reporting HARQ-ACK
In this clause, for the purpose of determining a PUCCH resource for a PUCCH
transmission in a slot using a PUCCH resource indicator field in a DCI format
that schedules a PDSCH reception, and for the purpose of determining the slot
for the PUCCH transmission
\- a UE is assumed to generate HARQ-ACK information regardless of whether or
not the PDSCH reception provides a transport block for a HARQ process with
disabled HARQ-ACK information as indicated by _downlinkHARQ-FeedbackDisabled_
, if provided
\- a UE is assumed to not generate HARQ-ACK information associated with a
G-RNTI for multicast or a G-CS-RNTI with disabled HARQ-ACK information as
described in clause 18.
The UE determines a number of HARQ-ACK information bits $O_{\text{ACK}}$ as
described in clauses 9.1 through 9.1.5 and a corresponding set of PUCCH
resources as described in clause 9.2.1. If $O_{\text{ACK}} = 0$, the UE does
not transmit a PUCCH that only includes HARQ-ACK information bits.
A UE does not expect to transmit more than one PUCCH with HARQ-ACK information
in a slot per priority index, if the UE is not provided _ackNackFeedbackMode =
separate_.
For DCI format 1_0, the PDSCH-to-HARQ_feedback timing indicator field values
map to {1, 2, 3, 4, 5, 6, 7, 8} for SCS configuration of PUCCH transmission
$\mu \leq 3$, to {_7, 8, 12, 16, 20, 24, 28, 32} for_ $\mu = 5$, and to _{13,
16, 24, 32, 40, 48, 56, 64} for_ $\mu = 6$. For a unicast DCI format, other
than DCI format 1_0, the PDSCH-to-HARQ_feedback timing indicator field values,
if present, map to values for a set of number of slots provided by _dl-
DataToUL-ACK, dl-DataToUL-ACK-r16,_ or _dl-DataToUL-ACK-DCI-1-2_ , or _dl-
DataToUL-ACK-r17,_ or _dl-DataToUL-ACK-DCI-1-2-r17_ , or _dl-DataToUL-
ACK-v1700_ as defined in Table 9.2.3-1. If the DCI format indicates a cell for
the PUCCH transmission, as described in clause 9.A, the PDSCH-to-HARQ_feedback
timing indicator field value maps to slots of the active UL BWP of the cell;
otherwise, the PDSCH-to-HARQ_feedback timing indicator field value maps to
slots of the active UL BWP of the PCell. For DCI format 4_1, the PDSCH-to-
HARQ_feedback timing indicator field values are provided by _dl-DataToUL-ACK-
MulticastDCI-Format4-1_ or, if _dl-DataToUL-ACK-MulticastDCI-Format4-1_ is not
provided, by {1, 2, 3, 4, 5, 6, 7, 8}. For DCI format 4_2, the PDSCH-to-
HARQ_feedback timing indicator field values are provided by _dl-DataToUL-ACK_
from _pucch-ConfigMulticast1/pucch-ConfigurationListMulticast1_ or _pucch-
ConfigMulticast2/pucch-ConfigurationListMulticast2_ if provided; otherwise,
from _pucch-Config/pucch-ConfigurationList._
The following apply to the PCell if the UE is provided _pucch-sSCellPattern_ ;
otherwise, the following apply to the serving cell of the PUCCH transmission.
If the UE is provided _subslotLengthForPUCCH_ , $n$ is the last UL slot for
PUCCH transmission that overlaps with a PDSCH reception or with a PDCCH
reception providing a DCI format having associated HARQ-ACK information
without scheduling a PDSCH reception; otherwise, $n$ is the last UL slot for
PUCCH transmission that overlaps with the DL slot $n_{D}$ for the PDSCH
reception or with the DL slot $n_{D}\ $for the PDCCH reception in case of a
DCI format that triggers a HARQ-ACK information report and does not schedule a
PDSCH reception.
For a SPS PDSCH reception ending in DL slot $n_{D}$, the UE transmits the
PUCCH in UL slot $n + k$ where $k$ is provided by the PDSCH-to-HARQ_feedback
timing indicator field, if present, in a DCI format activating the SPS PDSCH
reception.
If the UE detects a DCI format that does not include a PDSCH-to-HARQ_feedback
timing indicator field and schedules a PDSCH reception or activates a SPS
PDSCH reception ending in DL slot $n_{D}$, the UE provides corresponding HARQ-
ACK information in a PUCCH transmission within UL slot $n + k$ where $k$ is
provided by _dl-DataToUL-ACK_ , or _dl-DataToUL-ACK-r16,_ or _dl-DataToUL-ACK-
DCI-1-2_ , or _dl-DataToUL-ACK-r17_ , or _dl-DataToUL-ACK-DCI-1-2-r17_ , or
_dl-DataToUL-ACK-v1700_.
If the UE detects a DCI format scheduling a number of PDSCH receptions ending
in DL slot $n_{D}$ or if the UE detects a DCI format generating a HARQ-ACK
information bit and does not schedule a PDSCH reception through a PDCCH
reception ending in DL slot $n_{D}$, the UE provides corresponding HARQ-ACK
information in a PUCCH transmission within UL slot $n + k$, where $k$ is a
number of slots and is indicated by the PDSCH-to-HARQ_feedback timing
indicator field in the DCI format, if present, or provided by _dl-DataToUL-
ACK_ , _dl-DataToUL-ACK-r16,_ or _dl-DataToUL-ACK-DCI-1-2_ , or _dl-DataToUL-
ACK-r17_ , or _dl-DataToUL-ACK-DCI-1-2-r17_ , or _dl-DataToUL-ACK-v1700_.
A PUCCH transmission with HARQ-ACK information is subject to the limitations
for UE transmissions described in clause 11.1, clause 11.1.1 and clause 17.2.
Table 9.2.3-1: Mapping of PDSCH-to-HARQ_feedback timing indicator field values
to numbers of slots
* * *
PDSCH-to-HARQ_feedback timing indicator Number of slots $\mathbf{k}$  
1 bit 2 bits 3 bits  
\'0\' \'00\' \'000\' 1^st^ value provided by _dl-DataToUL-ACK, dl-DataToUL-
ACK-r16,_ _dl-DataToUL-ACK-DCI-1-2, dl-DataToUL-ACK-r17, dl-DataToUL-ACK-
DCI-1-2-r17,_ or _dl-DataToUL-ACK-v1700, or dl-DataToUL-ACK-MulticastDCI-
Format4-1_ \'1\' \'01\' \'001\' 2^nd^ value provided by _dl-DataToUL-ACK, dl-
DataToUL-ACK-r16,_ _dl-DataToUL-ACK-DCI-1-2, dl-DataToUL-ACK-r17, dl-DataToUL-
ACK-DCI-1-2-r17,_ or _dl-DataToUL-ACK-v1700, or dl-DataToUL-ACK-MulticastDCI-
Format4-1_ \'10\' \'010\' 3^rd^ value provided by _dl-DataToUL-ACK, dl-
DataToUL-ACK-r16,_ _dl-DataToUL-ACK-DCI-1-2, dl-DataToUL-ACK-r17, dl-DataToUL-
ACK-DCI-1-2-r17,_ or _dl-DataToUL-ACK-v1700, or dl-DataToUL-ACK-MulticastDCI-
Format4-1_ \'11\' \'011\' 4^th^ value provided by _dl-DataToUL-ACK, dl-
DataToUL-ACK-r16,_ _dl-DataToUL-ACK-DCI-1-2, dl-DataToUL-ACK-r17, dl-DataToUL-
ACK-DCI-1-2-r17,_ or _dl-DataToUL-ACK-v1700, dl-DataToUL-ACK-MulticastDCI-
Format4-1_ \'100\' 5^th^ value provided by _dl-DataToUL-ACK, dl-DataToUL-
ACK-r16,_ _dl-DataToUL-ACK-DCI-1-2, dl-DataToUL-ACK-r17, dl-DataToUL-ACK-
DCI-1-2-r17,_ or _dl-DataToUL-ACK-v1700, or dl-DataToUL-ACK-MulticastDCI-
Format4-1_ \'101\' 6^th^ value provided by _dl-DataToUL-ACK, dl-DataToUL-
ACK-r16,_ _dl-DataToUL-ACK-DCI-1-2, dl-DataToUL-ACK-r17, dl-DataToUL-ACK-
DCI-1-2-r17,_ or _dl-DataToUL-ACK-v1700, or dl-DataToUL-ACK-MulticastDCI-
Format4-1_ \'110\' 7^th^ value provided by _dl-DataToUL-ACK, dl-DataToUL-
ACK-r16,_ _dl-DataToUL-ACK-DCI-1-2, dl-DataToUL-ACK-r17, dl-DataToUL-ACK-
DCI-1-2-r17,_ or _dl-DataToUL-ACK-v1700, or dl-DataToUL-ACK-MulticastDCI-
Format4-1_ \'111\' 8^th^ value provided by _dl-DataToUL-ACK, dl-DataToUL-
ACK-r16,_ _dl-DataToUL-ACK-DCI-1-2, dl-DataToUL-ACK-r17, dl-DataToUL-ACK-
DCI-1-2-r17,_ or _dl-DataToUL-ACK-v1700, or dl-DataToUL-ACK-MulticastDCI-
Format4-1_
* * *
For a PUCCH transmission with HARQ-ACK information, a UE determines a PUCCH
resource on the cell of the PUCCH transmission, as described in clause 9.A,
after determining a set of PUCCH resources for $O_{\text{UCI}}$ HARQ-ACK
information bits, as described in clause 9.2.1. The PUCCH resource
determination is based on a PUCCH resource indicator field [5, TS 38.212], if
present, in a last DCI format, excluding the SPS activation DCI, among the DCI
formats that have a value of a PDSCH-to-HARQ_feedback timing indicator field,
if present, or a value of _dl-DataToUL-ACK_ , _or dl-DataToUL-ACK-r16,_ or
_dl-DataToUL-ACK-DCI-1-2_ , or _dl-DataToUL-ACK-r17,_ or _dl-DataToUL-ACK-
DCI-1-2-r17,_ or _dl-DataToUL-ACK-MulticastDCI-Format4-1_ , or _dl-DataToUL-
ACK-v1700_ , indicating a same slot for the PUCCH transmission, that the UE
detects and for which the UE transmits corresponding HARQ-ACK information in
the PUCCH. For PUCCH resource determination, detected DCI formats are first
indexed in an ascending order across serving cells indexes for a same PDCCH
monitoring occasion and are then indexed in an ascending order across PDCCH
monitoring occasion indexes. For indexing DCI formats within a serving cell
for a same PDCCH monitoring occasion, if the UE is not provided
_coresetPoolIndex_ or is provided _coresetPoolIndex_ with value 0 for one or
more first CORESETs and is provided _coresetPoolIndex_ with value 1 for one or
more second CORESETs on an active DL BWP of a serving cell, and with
_ackNackFeedbackMode_ = _joint for the active UL BWP, detected DCI formats
from PDCCH receptions in the first CORESETs are indexed prior to detected DCI
formats from PDCCH receptions in the second CORESETs_.
The PUCCH resource indicator field values map to values of a set of PUCCH
resource indexes, as defined in Table 9.2.3-2 for a PUCCH resource indicator
field of 3 bits, provided by _resourceList_ for PUCCH resources from a set of
PUCCH resources provided by _PUCCH-ResourceSet_ with a maximum of eight PUCCH
resources. If the PUCCH resource indicator field includes 1 bit or 2 bits, the
values map to the first two values or the first four values, respectively, of
Table 9.2.3-2. If the last DCI format does not include a PUCCH resource
indicator field, the first value of Table 9.2.3-2 is used.
For the first set of PUCCH resources and when the size $R_{\text{PUCCH}}$ of
_resourceList_ is larger than eight, when a UE provides HARQ-ACK information
in a PUCCH transmission in response to detecting a last DCI format in a PDCCH
reception, excluding the SPS activation DCI, among DCI formats with a value of
the PDSCH-to-HARQ_feedback timing indicator field, if present, or a value of
_dl-DataToUL-ACK_ , _or dl-DataToUL-ACK-r16,_ or _dl-DataToUL-ACK-DCI-1-2_ ,
or _dl-DataToUL-ACK-r17,_ or _dl-DataToUL-ACK-DCI-1-2-r17_ , or _dl-DataToUL-
ACK-MulticastDCI-Format4-1_ , or _dl-DataToUL-ACK-v1700_ , indicating a same
slot for the PUCCH transmission, the UE determines a PUCCH resource with index
$r_{\text{PUCCH}}$, ${0 \leq r}_{\text{PUCCH}} \leq R_{\text{PUCCH}} - 1$, as
where $N_{\text{CCE,}\text{p}}$ is a number of CCEs in CORESET $p$ of the
PDCCH reception for the DCI format as described in clause 10.1,
$n_{\text{CCE,}\text{p}}$ is the index of a first CCE for the PDCCH reception,
and $\mathrm{\Delta}_{\text{PRI}}$ is a value of the PUCCH resource indicator
field in the DCI format. When the PDCCH reception includes first and second
PDCCH candidates from respective first and second search space sets, as
described in clause 10.1, the CORESET is associated with the search space set
having the smaller index. If
\- the first search space set has larger index than the second search space
set and includes the first PDCCH candidate and a third PDCCH candidate that
have same first CCE index and CCE aggregation levels 8 and 16, or 16 and 8,
respectively,
\- the second search space set includes the second PDCCH candidate that has
same index and same CCE aggregation level as the first PDCCH candidate, and a
fourth PDCCH candidate that has same index and same CCE aggregation level as
the third PDCCH candidate,
\- the CORESET associated with the first search space set has _cce-REG-
MappingType_ = \'_nonInterleaved_ \' and has duration of one symbol, and
\- the second PDCCH candidate has different first CCE index than the fourth
PDCCH candidate
the UE determines $n_{CCE,0}$ from the PDCCH candidate with CCE aggregation
level 16 among the second PDCCH candidate and the fourth PDCCH candidate.
If the DCI format does not include a PUCCH resource indicator field,
$\mathrm{\Delta}_{\text{PRI}} = 0$.
Table 9.2.3-2: Mapping of PUCCH resource indication field values to a PUCCH
resource in a PUCCH resource set with maximum 8 PUCCH resources
* * *
PUCCH resource indicator PUCCH resource  
1 bit 2 bits 3 bits  
\'0\' \'00\' \'000\' 1^st^ PUCCH resource provided by _pucch-ResourceId_
obtained from the 1^st^ value of _resourceList_ \'1\' \'01\' \'001\' 2^nd^
PUCCH resource provided by _pucch-ResourceId_ obtained from the 2^nd^ value of
_resourceList_ \'10\' \'010\' 3^rd^ PUCCH resource provided by _pucch-
ResourceId_ obtained from the 3^rd^ value of _resourceList_ \'11\' \'011\'
4^th^ PUCCH resource provided by _pucch-ResourceId_ obtained from the 4^th^
value of _resourceList_ \'100\' 5^th^ PUCCH resource provided by _pucch-
ResourceId_ obtained from the 5^th^ value of _resourceList_ \'101\' 6^th^
PUCCH resource provided by _pucch-ResourceId_ obtained from the 6^th^ value of
_resourceList_ \'110\' 7^th^ PUCCH resource provided by _pucch-ResourceId_
obtained from the 7^th^ value of _resourceList_ \'111\' 8^th^ PUCCH resource
provided by _pucch-ResourceId_ obtained from the 8^th^ value of _resourceList_
* * *
If a UE determines a first resource for a PUCCH transmission with HARQ-ACK
information corresponding only to a PDSCH reception without a corresponding
PDCCH or detects a first DCI format indicating a first resource for a PUCCH
transmission with corresponding HARQ-ACK information in a slot and also
detects at a later time a second DCI format indicating a second resource for a
PUCCH transmission with corresponding HARQ-ACK information in the slot, the UE
does not expect to multiplex HARQ-ACK information corresponding to the second
DCI format in a PUCCH resource in the slot if the PDCCH reception that
includes the second DCI format is not earlier than $N_{3} \bullet \left( 2048
+ 144 \right) \bullet \kappa \bullet 2^{- \mu} \bullet T_{c}$ from the
beginning of a first symbol of the first resource for PUCCH transmission in
the slot where, $\kappa$ and $T_{c}$ are defined in clause 4.1 of [4, TS
38.211] and $\mu$ corresponds to the smallest SCS configuration among the SCS
configurations of the PDCCHs providing the DCI formats and the SCS
configuration of the PUCCH. If _processingType2Enabled_ of _PDSCH-
ServingCellConfig_ is set to _enable_ for the serving cell with the second DCI
format and for all serving cells with corresponding HARQ-ACK information
multiplexed in the PUCCH transmission in the slot, $N_{3} = 3$ for $\mu = 0$,
$N_{3} = 4.5$ for $\mu = 1$, $N_{3} = 9$ for $\mu = 2$; otherwise, $N_{3} = 8$
for $\mu = 0$, $N_{3} = 10$ for $\mu = 1$, $N_{3} = 17$ for $\mu = 2$, $N_{3}
= 20$ for $\mu = 3$, $N_{3} = 80$ for $\mu = 5$, and $N_{3} = 160$ for $\mu =
6$.
If a UE _is not provided SPS-PUCCH-AN-List and_ transmits HARQ-ACK information
corresponding only to a PDSCH reception without a corresponding PDCCH, which
includes the first SPS PDSCH reception associated with the corresponding
activation DCI, a PUCCH resource for corresponding PUCCH transmission with
HARQ-ACK information is provided by _n1PUCCH-AN_.
If a UE transmits a PUCCH with HARQ-ACK information using PUCCH format 0, the
UE determines values $m_{0}$ and $m_{\text{CS}}$ for computing a value of
cyclic shift $\alpha$ [4, TS 38.211] where $m_{0}$ is provided by
_initialCyclicShift_ of _PUCCH-format0_ or, if _initialCyclicShift_ is not
provided, by the initial cyclic shift index as described in clause 9.2.1 and
$m_{\text{CS}}$ is determined from the value of one HARQ-ACK information bit
or from the values of two HARQ-ACK information bits as in Table 9.2.3-3 and
Table 9.2.3-4, respectively.
Table 9.2.3-3: Mapping of values for one HARQ-ACK information bit to sequences
for PUCCH format 0
* * *
HARQ-ACK Value 0 1 **Sequence cyclic shift** $$m_{\text{CS}} = 0$$
$$m_{\text{CS}} = 6$$
* * *
Table 9.2.3-4: Mapping of values for two HARQ-ACK information bits to
sequences for PUCCH format 0
* * *
HARQ-ACK Value {0, 0} {0, 1} {1, 1} {1, 0} **Sequence cyclic shift**
$$m_{\text{CS}} = 0$$ $$m_{\text{CS}} = 3$$ $$m_{\text{CS}} = 6$$
$$m_{\text{CS}} = 9$$
* * *
If a UE transmits a PUCCH with HARQ-ACK information using PUCCH format 1, the
UE is provided a value for by _initialCyclicShift_ of _PUCCH-format1_ or, if
_initialCyclicShift_ is not provided, by the initial cyclic shift index as
described in clause 9.2.1.
If a UE transmits a PUCCH with $O_{\text{ACK}}$ HARQ-ACK information bits and
$O_{\text{CRC}}$ bits using PUCCH format 2 or PUCCH format 3 in a PUCCH
resource that includes $M_{\text{RB}}^{\text{PUCCH}}$ PRBs, the UE determines
a number of PRBs $M_{RB,min}^{\text{PUCCH}}$ for the PUCCH transmission to be
the minimum number of PRBs, that is smaller than or equal to a number of PRBs
$M_{\text{RB}}^{\text{PUCCH}}$ provided respectively by _nrofPRBs_ of _PUCCH-
format2_ or _nrofPRBs_ of _PUCCH-format3_ and start from the first PRB from
the number of PRBs, that results to $\left( O_{\text{ACK}} + O_{\text{CRC}}
\right) \leq M_{RB,min}^{\text{PUCCH}} \cdot N_{\text{sc,ctrl}}^{\text{RB}}
\cdot N_{\text{symb-UCI}}^{\text{PUCCH}} \cdot Q_{m} \cdot r$ and, if
$M_{\text{RB}}^{\text{PUCCH}} > 1$, $\left( O_{\text{ACK}} + O_{\text{CRC}}
\right) > \left( M_{RB,min}^{\text{PUCCH}} - 1 \right) \cdot
N_{\text{sc,ctrl}}^{\text{RB}} \cdot N_{\text{symb-UCI}}^{\text{PUCCH}} \cdot
Q_{m} \cdot r$, where $N_{\text{sc,ctrl}}^{\text{RB}}$, $N_{\text{symb-
UCI}}^{\text{PUCCH}}$, $Q_{m}$, and $r$ are defined in clause 9.2.5.2. For
PUCCH format 3, if $M_{RB,min}^{\text{PUCCH}}$ is not equal $2^{\alpha_{2}}
\cdot 3^{\alpha_{3}} \cdot 5^{\alpha_{5}}$ according to [4, TS 38.211],
$M_{RB,min}^{\text{PUCCH}}$ is increased to the nearest allowed value of
_nrofPRBs_ [12, TS 38.331]. If $\left( O_{\text{ACK}} + O_{\text{CRC}} \right)
> \left( M_{\text{RB}}^{\text{PUCCH}} - 1 \right) \cdot
N_{\text{sc,ctrl}}^{\text{RB}} \cdot N_{\text{symb-UCI}}^{\text{PUCCH}} \cdot
Q_{m} \cdot r$, the UE transmits the PUCCH over $M_{\text{RB}}^{\text{PUCCH}}$
PRBs.
If a UE is provided a first interlace of
$M_{\text{Interlace,0}}^{\text{PUCCH}}$ PRBs by _interlace0_ in
_InterlaceAllocation_ and transmits a PUCCH with $O_{\text{ACK}}$ HARQ-ACK
information bits and $O_{\text{CRC}}$ bits using PUCCH format 2 or PUCCH
format 3, the UE transmits the PUCCH over the first interlace if $\left(
O_{\text{ACK}} + O_{\text{CRC}} \right) \leq
M_{\text{Interlace,0}}^{\text{PUCCH}} \cdot N_{\text{sc,ctrl}}^{\text{RB}}
\cdot N_{\text{symb-UCI}}^{\text{PUCCH}} \cdot Q_{m} \cdot r$; otherwise, if
the UE is provided a second interlace by _interlace1_ in _PUCCH-format2_ or
_PUCCH-format3_ , the UE transmits the PUCCH over the first and second
interlaces.
### 9.2.4 UE procedure for reporting SR
A UE can be provided by _SchedulingRequestResourceConfig_ a set of
configurations for SR in a PUCCH transmission using either PUCCH format 0 or
PUCCH format 1.
A UE can be provided by _schedulingRequestID-BFR-SCell_ a configuration for
LRR in a PUCCH transmission using either PUCCH format 0 or PUCCH format 1.
A UE can be provided by _schedulingRequestID-BFR_ a first configuration for
LRR and, if the UE provides _twoLRRcapability_ , the UE can be provided by
_schedulingRequestID-BFR2_ a second configuration for LRR in a PUCCH
transmission using either PUCCH format 0 or PUCCH format 1.
A UE can be provided by _schedulingRequestID-LBT-SCell_ a configuration for
consistent LBT failure recovery, as described in [11, TS 38.321], in a PUCCH
transmission using either PUCCH format 0 or PUCCH format 1. The UE can be
provided, by _phy-PriorityIndex_ in _SchedulingRequestResourceConfig_ , a
priority index 0 or a priority index 1 for the SR. If the UE is not provided a
priority index for SR, the priority index is 0.
The UE is also provided a periodicity $\text{SR}_{\text{PERIODICITY}}$ in
symbols or slots and an offset $\text{SR}_{\text{OFFSET}}$ in slots by
_periodicityAndOffset_ for a PUCCH transmission conveying SR. If
$\text{SR}_{\text{PERIODICITY}}$ is larger than one slot, the UE determines a
SR transmission occasion in a PUCCH to be in a slot with number
$n_{s,f}^{\mu}$ [4, TS 38.211] in a frame with number $n_{f}$ if $\left(
{n_{f} \cdot N_{\text{slot}}^{\text{frame},\mu} + n}_{s,f}^{\mu} -
\text{SR}_{\text{OFFSET}} \right)\text{mod}\text{SR}_{\text{PERIODICITY}} =
0$.
If $\text{SR}_{\text{PERIODICITY}}$ is one slot, the UE expects that
$\text{SR}_{\text{OFFSET}} = 0$ and every slot is a SR transmission occasion
in a PUCCH.
If $\text{SR}_{\text{PERIODICITY}}$ is smaller than one slot, the UE
determines a SR transmission occasion in a PUCCH to start in a symbol with
index $l$ [4, TS 38.211] if $\left( l -
l_{0}\text{mod}\text{SR}_{\text{PERIODICITY}}
\right)\text{mod}\text{SR}_{\text{PERIODICITY}} = 0$ where $l_{0}$ is the
value of _startingSymbolIndex_.
If the UE determines that, for a SR transmission occasion in a PUCCH, the
number of symbols available for the PUCCH transmission in a slot is smaller
than the value provided by _nrofSymbols_ , the UE does not transmit the PUCCH
in the slot.
SR transmission occasions in a PUCCH are subject to the limitations for UE
transmissions described in clause 11.1, clause 11.1.1 and clause 17.2.
The UE transmits a PUCCH in the PUCCH resource for the corresponding SR
configuration only when the UE transmits a positive SR. For a positive SR
transmission using PUCCH format 0, the UE transmits the PUCCH as described in
[4, TS 38.211] by obtaining $m_{0}$ as described for HARQ-ACK information in
clause 9.2.3 and by setting $m_{\text{cs}} = 0$. For a positive SR
transmission using PUCCH format 1, the UE transmits the PUCCH as described in
[4, TS 38.211] by setting $b\left( 0 \right) = 0$.
### 9.2.5 UE procedure for reporting multiple UCI types
This clause is applicable to the case that a UE has resources for PUCCH
transmissions or for PUCCH and PUSCH transmissions that overlap in time and
each PUCCH transmission is over a single slot without repetitions. Any case
that a PUCCH transmission is with repetitions over multiple slots is described
in clause 9.2.6. If a UE is configured with multiple PUCCH resources in a slot
to transmit CSI reports
\- if the UE is not provided _multi-CSI-PUCCH-ResourceList_ or if PUCCH
resources for transmissions of CSI reports do not overlap in the slot, the UE
determines a first resource corresponding to a CSI report with the highest
priority [6, TS 38.214]
\- if the first resource includes PUCCH format 2, and if there are remaining
resources in the slot that do not overlap with the first resource, the UE
determines a CSI report with the highest priority, among the CSI reports with
corresponding resources from the remaining resources, and a corresponding
second resource as an additional resource for CSI reporting
\- if the first resource includes PUCCH format 3 or PUCCH format 4, and if
there are remaining resources in the slot that include PUCCH format 2 and do
not overlap with the first resource, the UE determines a CSI report with the
highest priority, among the CSI reports with corresponding resources from the
remaining resources, and a corresponding second resource as an additional
resource for CSI reporting
\- if the UE is provided _multi-CSI-PUCCH-ResourceList_ and if any of the
multiple PUCCH resources overlap, the UE multiplexes all CSI reports in a
resource from the resources provided by _multi-CSI-PUCCH-ResourceList_ , as
described in clause 9.2.5.2.
A UE multiplexes DL HARQ-ACK information, with or without SR, and CSI
report(s) in a same PUCCH if the UE is provided _simultaneousHARQ-ACK-CSI_ ;
otherwise, the UE drops the CSI report(s) and includes only DL HARQ-ACK
information, with or without SR, in the PUCCH. If the UE would transmit
multiple PUCCHs in a slot that include DL HARQ-ACK information and CSI
report(s), the UE expects to be provided a same configuration for
_simultaneousHARQ-ACK-CSI_ each of PUCCH formats 2, 3, and 4.
If a UE would multiplex CSI reports that include Part 2 CSI reports in a PUCCH
resource, the UE determines the PUCCH resource and a number of PRBs for the
PUCCH resource or a number of Part 2 CSI reports assuming that each of the CSI
reports indicates rank 1, or rank combination of {1, 1} if applicable. If the
higher layer parameter _csi-ReportMode of CSI reports_ is set to \'Mode2\',
the UE determines the PUCCH resource and a number of PRBs for the PUCCH
resource or a number of Part 2 CSI reports assuming that each CRI in the CSI
report is associated with a resource pair.
If a UE would transmit multiple overlapping PUCCHs in a slot or overlapping
PUCCH(s) and PUSCH(s) in a slot and, when applicable as described in clauses
9.2.5.1, 9.2.5.2 and 9.2.5.3, the UE is configured to multiplex different UCI
types or UCI of different priority indexes in one PUCCH, and at least one of
the multiple overlapping PUCCHs or PUSCHs is in response to a DCI format
detection by the UE, the UE multiplexes all corresponding UCI types or UCI of
different priority indexes if the following conditions are met. If one of the
PUCCH transmissions or PUSCH transmissions is in response to a DCI format
detection by the UE, the UE expects that the first symbol $S_{0}$ of the
earliest PUCCH or PUSCH, among a group overlapping PUCCHs and PUSCHs in the
slot, satisfies the following timeline conditions
\- $S_{0}$ is not before a symbol with CP starting after
$T_{proc,1}^{\text{mux}}$ after a last symbol of any corresponding PDSCH,
$T_{proc,1}^{\text{mux}}$ is given by maximum of $\left{
T_{proc,1}^{mux,1},\cdots,T_{proc,1}^{mux,i},\cdots \right}$ where for the
i-th PDSCH with corresponding HARQ-ACK transmission on a PUCCH which is in the
group of overlapping PUCCHs and PUSCHs, $T_{proc,1}^{mux,i} = \left( N_{1} +
d_{1,1} + 1 \right) \cdot \left( 2048 + 144 \right) \cdot \kappa \cdot 2^{-
\mu} \cdot T_{C}$, $d_{1,1}$ is selected for the i-th PDSCH following [6, TS
38.214], $N_{1}$ is selected based on the UE PDSCH processing capability of
the i-th PDSCH and SCS configuration $\mu$, where $\mu$ corresponds to the
smallest SCS configuration among the SCS configurations used for the PDCCH
scheduling the i-th PDSCH, the i-th PDSCH, the PUCCH with corresponding HARQ-
ACK transmission for the i-th PDSCH, and all PUSCHs in the group of
overlapping PUCCHs and PUSCHs.
\- $S_{0}$ is not before a symbol with CP starting after
$T_{proc,release}^{\text{mux}}$ after a last symbol of a PDCCH reception
providing a DCI format having associated HARQ-ACK information without
scheduling a PDSCH reception. $T_{proc,release}^{\text{mux}}$ is given by
maximum of $\left{
T_{proc,release}^{mux,1},\cdots,T_{proc,release}^{mux,i},\cdots \right}$ where
for the i-th PDCCH providing the DCI format with corresponding HARQ-ACK
transmission on a PUCCH which is in the group of overlapping PUCCHs and
PUSCHs, $T_{proc,release}^{mux,i} = \left( N + 1 \right) \cdot \left( 2048 +
144 \right) \cdot \kappa \cdot 2^{- \mu} \cdot T_{C}$, $N$ as described in
clause 10.2, where $\mu$ corresponds to the smallest SCS configuration among
the SCS configurations used for the PDCCH, the PUCCH with corresponding HARQ-
ACK information, and all PUSCHs in the group of overlapping PUCCHs and PUSCHs.
\- if there is no aperiodic CSI report multiplexed in a PUSCH in the group of
overlapping PUCCHs and PUSCHs, $S_{0}$ is not before a symbol with CP starting
after $T_{proc,2}^{\text{mux}}$ after a last symbol of
\- any PDCCH with the DCI format scheduling an overlapping PUSCH, and
\- any PDCCH providing a DCI format with corresponding HARQ-ACK information in
an overlapping PUCCH in the slot
> If there is at least one PUSCH in the group of overlapping PUCCHs and
> PUSCHs, $T_{proc,2}^{\text{mux}}$ is given by maximum of $\left{
> T_{proc,2}^{mux,1},\cdots,T_{proc,2}^{mux,i},\cdots \right}$ where for the
> i-th PUSCH which is in the group of overlapping PUCCHs and PUSCHs,
> $T_{proc,2}^{mux,i} = \max\left( \left( N_{2} + d_{2,1} + 1 \right) \cdot
> \left( 2048 + 144 \right) \cdot \kappa \cdot 2^{- \mu} \cdot T_{C} +
> T_{\text{switch}},d_{2,2} \right)$, $d_{2,1}$, $d_{2,2}$ and
> $T_{\text{switch}}$ are selected for the i-th PUSCH following [6, TS
> 38.214], $N_{2}$ is selected based on the UE PUSCH processing capability of
> the i-th PUSCH and SCS configuration $\mu$, where $\mu$ corresponds to the
> smallest SCS configuration among the SCS configurations used for the PDCCH
> scheduling the i-th PUSCH, the PDCCHs scheduling the PDSCHs, or providing
> the DCI formats without scheduling PDSCHs, with corresponding HARQ-ACK
> information on a PUCCH which is in the group of overlapping PUCCHs/PUSCHs,
> and all PUSCHs in the group of overlapping PUCCHs and PUSCHs.
>
> If there is no PUSCH in the group of overlapping PUCCHs and PUSCHs,
> $T_{proc,2}^{\text{mux}}$ is given by maximum of $\left{
> T_{proc,2}^{mux,1},\cdots,T_{proc,2}^{mux,i},\cdots \right}$ where for the
> i-th PDSCH, or the i-th PDCCH providing a DCI format without scheduling
> PDSCH, with corresponding HARQ-ACK information on a PUCCH which is in the
> group of overlapping PUCCHs, $T_{proc,2}^{mux,i} = \left( N_{2} + 1 \right)
> \cdot \left( 2048 + 144 \right) \cdot \kappa \cdot 2^{- \mu} \cdot T_{C}$,
> $N_{2}\ $ is selected based on the UE PUSCH processing capability of the
> PUCCH serving cell if configured. $N_{2}$ is selected based on the UE PUSCH
> processing capability 1, if PUSCH processing capability is not configured
> for the PUCCH serving cell. $\mu$ is selected based on the smallest SCS
> configuration between the SCS configuration used for the PDCCH scheduling
> the i-th PDSCH, or providing the i-th DCI format without scheduling PDSCH,
> with corresponding HARQ-ACK information on a PUCCH which is in the group of
> overlapping PUCCHs, and the SCS configuration for the PUCCH serving cell.
\- if there is an aperiodic CSI report multiplexed in a PUSCH in the group of
overlapping PUCCHs and PUSCHs, $S_{0}$ is not before a symbol with CP starting
after $T_{proc,CSI}^{\text{mux}} = \max\left( \left( Z + d \right) \cdot
\left( 2048 + 144 \right) \cdot \kappa \cdot 2^{- \mu} \cdot T_{C} +
T_{\text{switch}},d_{2,2} \right)$ after a last symbol of
\- any PDCCH with the DCI format scheduling an overlapping PUSCH, and
\- any PDCCH scheduling a PDSCH, or providing a DCI format , with
corresponding HARQ-ACK information in an overlapping PUCCH in the slot
> where $\mu$ corresponds to the smallest SCS configuration among the SCS
> configuration of the PDCCHs, the smallest SCS configuration for the group of
> the overlapping PUSCHs, and the smallest SCS configuration of CSI-RS
> associated with the DCI format scheduling the PUSCH with the multiplexed
> aperiodic CSI report, and $d = 2$ for $\mu = 0,1$, $d = 3$ for $\mu = 2$,
> and $d = 4$ for $\mu = 3$. $T_{\text{switch}}$ is defined in [6, TS 38.214]
> and it is applied only if $Z_{1}$ of Table 5.4-1 in [6, TS 38.214] is
> applied to the determination of $Z$.
\- $N_{1}$, $N_{2}$, $d_{1,1}$, $d_{2,1}$, $d_{2,2}$, and $Z$ $\ $are defined
in [6, TS 38.214] and $\kappa$ and $T_{C}$ are defined in [4, TS 38.211].
If a UE would transmit multiple overlapping PUCCHs in a slot or overlapping
PUCCH(s) and PUSCH(s) in a slot, one of the PUCCHs includes HARQ-ACK
information in response to an SPS PDSCH reception, and any PUSCH is not in
response to a DCI format detection, the UE expects that the first symbol
$S_{0}$ of the earliest PUCCH or PUSCH satisfies the first of the previous
timeline conditions with the exception that components associated to a SCS
configuration for a PDCCH scheduling a PDSCH or a PUSCH are absent from the
timeline conditions.
A UE does not expect a PUCCH or a PUSCH that is in response to a DCI format
detection to overlap with any other PUCCH or PUSCH that does not satisfy the
above timing conditions.
A UE that
\- is not provided _coresetPoolIndex_ or is provided _coresetPoolIndex_ with a
value of 0 for first CORESETs on active DL BWPs of serving cells, and
\- is provided _coresetPoolIndex_ with a value of 1 for second CORESETs on
active DL BWPs of the serving cells, and
\- is provided _ackNackFeedbackMode_ = _separate_
does not expect a PUCCH or a PUSCH transmission triggered by a detection of a
DCI format in a PDCCH received in a CORESET from the first CORESETs to overlap
in time with a PUCCH or a PUSCH transmission triggered by a detection of a DCI
format in a PDCCH received in a CORESET from the second CORESETs.
If there is one or more aperiodic CSI reports multiplexed on a PUSCH in the
group of overlapping PUCCHs and PUSCHs and if symbol $S_{0}$ is before symbol
${Z'}_{\text{ref}}^{\text{\ mux}}$ that is a next uplink symbol with CP
starting after ${Z'}_{proc,CSI}^{\ \text{mux}} = \left( Z' + d \right) \cdot
\left( 2048 + 144 \right) \cdot \kappa \cdot 2^{- \mu} \cdot T_{C}$ after the
end of the last symbol of
\- the last symbol of aperiodic CSI-RS resource for channel measurements, and
\- the last symbol of aperiodic CSI-IM used for interference measurements, and
\- the last symbol of aperiodic NZP CSI-RS for interference measurements, when
aperiodic CSI-RS is used for channel measurement for triggered CSI report $n$
the UE is not required to update the CSI report for the triggered CSI report
$n$_._ $Z'$ is defined in [6, TS 38.214] and $\mu$ corresponds to the smallest
SCS configuration among the SCS configurations of the PDCCHs scheduling the
PUSCHs, the smallest SCS configuration of aperiodic CSI-RSs associated with
DCI formats provided by the PDCCHs triggering the aperiodic CSI reports, and
the smallest SCS configuration of the overlapping PUCCHs and PUSCHs and $d =
2$ for $\mu = 0,1$, $d = 3$ for $\mu = 2,$ and $d = 4$ for $\mu = 3$.
If a UE would transmit multiple PUCCHs in a slot that include HARQ-ACK
information, and/or SR, and/or CSI reports and any PUCCH with HARQ-ACK
information in the slot satisfies the above timing conditions and does not
overlap with any other PUCCH or PUSCH in the slot that does not satisfy the
above timing conditions, the UE multiplexes the HARQ-ACK information, and/or
SR, and/or CSI reports and determines corresponding PUCCH(s) for transmission
in the slot according to the following pseudo-code. If the multiple PUCCHs do
not include HARQ-ACK information and do not overlap with any PUSCH
transmission by the UE in response to a DCI format detection by the UE, the
timing conditions do not apply.
If
\- a UE is not provided _multi-CSI-PUCCH-ResourceList_ , and
\- a resource for a PUCCH transmission with HARQ-ACK information in response
to SPS PDSCH reception and/or a resource for a PUCCH associated with a SR
occasion overlap in time with two resources for respective PUCCH transmissions
with two CSI reports, and
\- there is no resource for a PUCCH transmission with HARQ-ACK information in
response to a DCI format detection that overlaps in time with any of the
previous resources, and
\- the following pseudo code results to the UE attempting to determine a
single PUCCH resource from the HARQ-ACK and/or the SR resource and the two
PUCCH resources with CSI reports
the UE
\- multiplexes the HARQ-ACK information and/or the SR in the resource for the
PUCCH transmission with the CSI report having the higher priority, and
\- does not transmit the PUCCH with the CSI report having the lower priority
Set $Q$ to the set of resources for transmission of corresponding PUCCHs in a
single slot without repetitions where
\- a resource with earlier first symbol is placed before a resource with later
first symbol
\- for two resources with same first symbol, the resource with longer duration
is placed before the resource with shorter duration
\- for two resources with same first symbol and same duration, the placement
is arbitrary
\- the above three steps for the set $Q$ are according to a subsequent pseudo-
code for a function $\text{order}(Q)$
\- a resource for negative SR transmission that does not overlap with a
resource for HARQ-ACK or CSI transmission is excluded from set $Q$
\- if the UE is not provided _simultaneousHARQ-ACK-CSI_ and resources for
transmission of HARQ-ACK information include PUCCH format 0 or PUCCH format 2,
resources that include PUCCH format 2, or PUCCH format 3, or PUCCH format 4
for transmission of CSI reports are excluded from the set $Q$ if they overlap
with any resource from the resources for transmission of HARQ-ACK information
\- if the UE is not provided _simultaneousHARQ-ACK-CSI_ and at least one of
the resources for transmission of HARQ-ACK information includes PUCCH format
1, PUCCH format 3, or PUCCH format 4
\- resources that include PUCCH format 3 or PUCCH format 4 for transmission of
CSI reports are excluded from the set $Q$
\- resources that include PUCCH format 2 for transmission of CSI reports are
excluded from the set $Q$ if they overlap with any resource from the resources
for transmission of HARQ-ACK information
Set $\text{C}\left( Q \right)$ to the cardinality of $Q$
Set $Q(j,0)$to be the first symbol of resource $Q(j)$ in the slot
Set $L\left( Q(j) \right)$ to be the number of symbols of resource $Q(j)$ in
the slot
Set $j = 0$ - index of first resource in set $Q$
Set $o = 0$ - counter of overlapped resources
while $j \leq \text{C}\left( Q \right) - 1$
if
$j  0$
determine a single resource for multiplexing UCI associated with resources
$\left{ Q\left( j - o \right),Q\left( j - o + 1 \right),\ldots,Q(j) \right}$
as described in clauses 9, 9.2.5.0, 9.2.5.1, 9.2.5.2, and 9.2.5.3
set the index of the single resource to $j$
$$Q = Q\backslash\left{ Q\left( j - o \right),Q\left( j - o + 1
\right),\ldots,Q(j - 1) \right}$$
$j = 0$ % start from the beginning after reordering unmerged resources at next
step
$o = 0$;
$\text{order}(Q)$ % function that re-orders resources in current set $Q$
Set $\text{C}\left( Q \right)$ to the cardinality of $Q$
else
$j = j + 1$;
end if
end if
end while
The function $\text{order}(Q)$ performs the following pseudo-code
{
$k = 0$;
while $k  Q(l + 1,0)$ OR $\left( Q\left( l,0 \right) = Q(l +
1,0)\& L(Q\left( l \right))  1$, $\left( O_{\text{ACK}} + {O_{\text{SR}} +
O}_{\text{CRC}} \right) > \left( M_{RB,min}^{\text{PUCCH}} - 1 \right) \cdot
N_{\text{sc,ctrl}}^{\text{RB}} \cdot N_{\text{symb-UCI}}^{\text{PUCCH}} \cdot
Q_{m} \cdot r$, where $N_{\text{sc,ctrl}}^{\text{RB}}$, $N_{\text{symb-
UCI}}^{\text{PUCCH}}$, $Q_{m}$, and $r$ are defined in clause 9.2.5.2. For
PUCCH format 3, if $M_{RB,min}^{\text{PUCCH}}$ is not equal $2^{\alpha_{2}}
\cdot 3^{\alpha_{3}} \cdot 5^{\alpha_{5}}$ according to [4, TS 38.211],
$M_{RB,min}^{\text{PUCCH}}$ is increased to the nearest allowed value of
_nrofPRBs_ [12, TS 38.331]. If $\left( O_{\text{ACK}} + {O_{\text{SR}} +
O}_{\text{CRC}} \right) > \left( M_{\text{RB}}^{\text{PUCCH}} - 1 \right)
\cdot N_{\text{sc,ctrl}}^{\text{RB}} \cdot N_{\text{symb-UCI}}^{\text{PUCCH}}
\cdot Q_{m} \cdot r$, the UE transmits the PUCCH over the
$M_{\text{RB}}^{\text{PUCCH}}$ PRBs.
If a UE is provided a first interlace of
$M_{\text{Interlace,0}}^{\text{PUCCH}}$ PRBs by _interlace0_ in
_InterlaceAllocation_ and transmits a PUCCH with $O_{\text{ACK}}$ HARQ-ACK
information bits, $O_{\text{SR}} = \left\lceil \log_{2}\left( K + 1 \right)
\right\rceil$ SR bits, and $O_{\text{CRC}}$ CRC bits using PUCCH format 2 or
PUCCH format 3, the UE transmits the PUCCH over the first interlace if $\left(
O_{\text{ACK}} + O_{\text{SR}} + O_{\text{CRC}} \right) \leq
M_{\text{Interlace,0}}^{\text{PUCCH}} \cdot N_{\text{sc,ctrl}}^{\text{RB}}
\cdot N_{\text{symb-UCI}}^{\text{PUCCH}} \cdot Q_{m} \cdot r$; otherwise, if
the UE is provided a second interlace by _interlace1_ in _PUCCH-format2_ or
_PUCCH-format3_ , the UE transmits the PUCCH over the first and second
interlaces.
#### 9.2.5.2 UE procedure for multiplexing HARQ-ACK/SR/CSI in a PUCCH
For a transmission occasion of a single CSI report, a PUCCH resource is
provided by _pucch-CSI-ResourceList_. For a transmission occasion of multiple
CSI reports, corresponding PUCCH resources can be provided by _multi-CSI-
PUCCH-ResourceList_. If a UE is provided first and second _PUCCH-Config_ ,
_multi-CSI-PUCCH-ResourceList_ is provided by the first  _PUCCH-Config_ , and
_PUCCH-ResourceId_ in _pucch-CSI-ResourceList_ or _multi-CSI-PUCCH-
ResourceList_ indicates a corresponding PUCCH resource in _PUCCH-Resource_
provided by the first _PUCCH-Config_.
If a UE is provided only one PUCCH resource set for transmission of HARQ-ACK
information in response to PDSCH reception scheduled by a DCI format or in
response to a DCI format having associated HARQ-ACK information without
scheduling PDSCH reception, the UE does not expect to be provided
_simultaneousHARQ-ACK-CSI_.
A UE is configured by _maxCodeRate_ a code rate for multiplexing HARQ-ACK, SR,
and CSI report(s) in a PUCCH transmission using PUCCH format 2, PUCCH format
3, or PUCCH format 4.
If a UE transmits CSI reports using PUCCH format 2, the UE transmits only
wideband CSI for each CSI report [6, TS 38.214]. In the following, a Part 1
CSI report refers either to a CSI report with only wideband CSI or to a Part 1
CSI report with wideband CSI and sub-band CSI.
Denote as
\- a total number of HARQ-ACK information bits, if any
\- a total number of SR bits. if there is no scheduling request bit;
otherwise, as described in clause 9.2.5.1
\- , where is a number of Part 1 CSI report bits for CSI report with priority
value , is a number of Part 2 CSI report bits, if any, for CSI report with
priority value [6, TS 38.214], and is a number of CSI reports that include
overlapping CSI reports
\- , where is a number of CRC bits, if any, for encoding HARQ-ACK, SR and Part
1 CSI report bits and is a number of CRC bits, if any, for encoding Part 2 CSI
report bits
In the following
\- $r$ is a code rate given by _maxCodeRate_ as in Table 9.2.5.2-1.
\- {width="0.5104166666666666in" height="0.22916666666666666in"} is a number
of PRBs provided by _nrofPRBs; otherwise, if nrofPRBs is not provided,_
{width="0.6145833333333334in" height="0.22916666666666666in"}
\- for PUCCH format 2 or, if the PUCCH resource with PUCCH format 2 includes
an orthogonal cover code with length provided by _occ-Length_ , , for PUCCH
format 3 or, if the PUCCH resource with PUCCH format 3 includes an orthogonal
cover code with length provided by _occ-Length_ , , and for PUCCH format 4,
where is a number of subcarriers per resource block [4, TS 38.211]
\- is equal to a number of PUCCH symbols for _PUCCH format 2_ provided by
_nrofSymbols_ in _PUCCH-format2. For PUCCH format 3 or for PUCCH format 4,_
_is equal to a number of PUCCH symbols_ f _or PUCCH format 3 or equal to a
number of PUCCH symbols_ f _or PUCCH format 4_ provided by _nrofSymbols_ in
_PUCCH-format3_ or _nrofSymbols_ in _PUCCH-format4_ , respectively, after
excluding a number of symbols used for DM-RS transmission for PUCCH format 3
or for PUCCH format 4, respectively [4, TS 38.211]
\- if pi/2-BPSK is the modulation scheme and if QPSK is the modulation scheme
as indicated by _pi2BPSK_ for PUCCH format 3 or PUCCH format 4. For PUCCH
format 2,
If a UE has one or more CSI reports and zero or more HARQ-ACK/SR information
bits to transmit in a PUCCH where the HARQ-ACK, if any, is in response to a
PDSCH reception without a corresponding PDCCH
\- if any of the CSI reports are overlapping and the UE is provided by _multi-
CSI-PUCCH-ResourceList_ with PUCCH resources in a slot, for PUCCH format 2
and/or PUCCH format 3 and/or PUCCH format 4, as described in clause 9.2.1,
where the resources are indexed according to an ascending order for the
product of a number of corresponding REs, modulation order , and configured
code rate ;
\- if , the UE uses PUCCH format 2 resource , or the PUCCH format 3 resource ,
or the PUCCH format 4 resource
\- else if and , , the UE transmits a PUCCH conveying HARQ-ACK information, SR
and CSI report(s) in a respective PUCCH where the UE uses the PUCCH format 2
resource , or the PUCCH format 3 resource , or the PUCCH format 4 resource
\- else the UE uses the PUCCH format 2 resource , or the PUCCH format 3
resource , or the PUCCH format 4 resource and the UE selects CSI report(s) for
transmission together with HARQ-ACK information and SR, when any, in ascending
priority value as described in [6, TS 38.214]
\- else, the UE transmits the bits in a PUCCH resource provided by _pucch-CSI-
ResourceList_ and determined as described in clause 9.2.5
If a UE has HARQ-ACK, SR and wideband or sub-band CSI reports to transmit and
the UE determines a PUCCH resource with PUCCH format 2, or the UE has HARQ-
ACK, SR and wideband CSI reports [6, TS 38.214] to transmit and the UE
determines a PUCCH resource with PUCCH format 3 or PUCCH format 4, where
> \- the UE determines the PUCCH resource using the PUCCH resource indicator
> field [5, TS 38.212] in a last of a number of DCI formats, excluding the SPS
> activation DCI, with a value of a PDSCH-to-HARQ_feedback timing indicator
> field, if present, or a value of _dl-DataToUL-ACK_ , or _dl-DataToUL-
> ACK-r16,_ or _dl-DataToUL-ACK-DCI-1-2_ , or _dl-DataToUL-ACK-r17,_ or _dl-
> DataToUL-ACK-DCI-1-2-r17_ , indicating a same slot for the PUCCH
> transmission, from a PUCCH resource set provided to the UE for HARQ-ACK
> transmission, and
>
> \- the UE determines the PUCCH resource set as described in clause 9.2.1 and
> clause 9.2.3 for UCI bits
and
\- if , the UE transmits the HARQ-ACK, SR, and CSI reports bits by selecting
the minimum number of the PRBs satisfying as described in clauses 9.2.3 and
9.2.5.1;
\- else, the UE selects CSI report(s), from the CSI reports, for transmission
together with HARQ-ACK and SR in ascending priority value [6, TS 38.214],
where the value of satisfies and , where is a number of CRC bits corresponding
to UCI bits, and is a number of CRC bits corresponding to UCI bits.
If a UE is provided a first interlace of
$M_{\text{Interlace,0}}^{\text{PUCCH}}$ PRBs by _interlace0_ in
_InterlaceAllocation_ , the UE has HARQ-ACK, SR and wideband or sub-band CSI
reports to transmit _,_ and the UE determines a PUCCH resource with PUCCH
format 2, or the UE has HARQ-ACK, SR and wideband CSI reports to transmit and
the UE determines a PUCCH resource with PUCCH format 3, where
\- the UE determines the PUCCH resource using the PUCCH resource indicator
field in a last of a number of DCI formats, excluding the SPS activation DCI,
with a value of a PDSCH-to-HARQ_feedback timing indicator field, or a value
provided by _dl-DataToUL-ACK_ or _dl-DataToUL-ACK-r16_ or _dl-DataToUL-ACK-
DCI-1-2_ or _dl-DataToUL-ACK-r17_ or _dl-DataToUL-ACK-DCI-1-2-r17_ if the
PDSCH-to-HARQ_feedback timing indicator field is not present in a DCI format,
indicating a same slot for the PUCCH transmission, from a PUCCH resource set
provided to the UE for HARQ-ACK transmission, and
\- the UE determines the PUCCH resource set as described in clauses 9.2.1 and
9.2.3 for $O_{\text{UCI}}$ UCI bits
and
\- if $\left( O_{\text{ACK}} + O_{\text{SR}} + O_{\text{CSI} - \text{part1}} +
O_{\text{CRC,CSI-part1}} \right) \leq M_{\text{Interlace,0}}^{\text{PUCCH}}
\cdot N_{\text{sc,ctrl}}^{\text{RB}} \cdot N_{\text{symb-UCI}}^{\text{PUCCH}}
\cdot Q_{m} \cdot r$, the UE transmits the HARQ-ACK, SR, and CSI reports bits
in a PUCCH over the first interlace
\- else, if the UE is provided a second interlace of
$M_{\text{Interlace,1}}^{\text{PUCCH}}$ PRBs by _interlace1_ and if $\left(
O_{\text{ACK}} + O_{\text{SR}} + O_{\text{CSI} - \text{part1}} +
O_{\text{CRC,CSI-part1}} \right) \leq \left(
M_{\text{Interlace,0}}^{\text{PUCCH}} + M_{\text{Interlace,1}}^{\text{PUCCH}}
\right) \cdot N_{\text{sc,ctrl}}^{\text{RB}} \cdot N_{\text{symb-
UCI}}^{\text{PUCCH}} \cdot Q_{m} \cdot r$, the UE transmits the HARQ-ACK, SR,
and CSI reports bits in a PUCCH over both the first and second interlaces
\- else, the procedure is same as the corresponding one when the UE is
provided _PUCCH-ResourceSet by replacing_ $M_{\text{RB}}^{\text{PUCCH}}$ with
$M_{\text{Interlace,0}}^{\text{PUCCH}}$, or, if the UE is provided
_interlace1_ , by $M_{\text{Interlace,0}}^{\text{PUCCH}} +
M_{\text{Interlace,1}}^{\text{PUCCH}}$.
If a UE has HARQ-ACK, SR and sub-band CSI reports to transmit and the UE
determines a PUCCH resource with PUCCH format 3 or PUCCH format 4, where
> \- the UE determines the PUCCH resource using the PUCCH resource indicator
> field [5, TS 38.212] in a last of a number of DCI formats, excluding the SPS
> activation DCI, with a value of a PDSCH-to-HARQ_feedback timing indicator
> field indicating a same slot for the PUCCH transmission, or by a value
> provided by _dl-DataToUL-ACK_ or _dl-DataToUL-ACK-r16_ or _dl-DataToUL-ACK-
> DCI-1-2_ or _dl-DataToUL-ACK-r17_ or _dl-DataToUL-ACK-DCI-1-2-r17_ if the
> PDSCH-to-HARQ_feedback timing indicator field is not present in the last DCI
> format, from a PUCCH resource set provided to the UE for HARQ-ACK
> transmission, and
>
> \- the UE determines the PUCCH resource set as described in clause 9.2.1 and
> clause 9.2.3 for UCI bits
and
\- if {width="3.5in" height="0.25in"}, the UE transmits the HARQ-ACK, SR and
the CSI report bits by selecting the minimum number of PRBs from the PRBs
satisfying as described in clauses 9.2.3 and 9.2.5.1
\- else,
\- if for Part 2 CSI report priority value(s), it is
and
,
the UE selects the first Part 2 CSI reports, according to respective priority
value(s) [6, TS 38.214], for transmission together with the HARQ-ACK, SR and
Part 1 CSI reports , where is the number of Part 1 CSI report bits for the CSI
report and is the number of Part 2 CSI report bits for the CSI report priority
value, is a number of CRC bits corresponding to , and is a number of CRC bits
corresponding to
\- else, the UE drops all Part 2 CSI reports and selects Part 1 CSI report(s),
from the CSI reports in ascending priority value [6, TS 38.214], for
transmission together with the HARQ-ACK and SR information bits where the
value of satisfies and , where is a number of CRC bits corresponding to UCI
bits, and is a number of CRC bits corresponding to UCI bits.
If a UE is provided a first interlace of
$M_{\text{Interlace,0}}^{\text{PUCCH}}$ PRBs by _interlace0_ in
_InterlaceAllocation_ , the UE has HARQ-ACK, SR and sub-band CSI reports to
transmit, and the UE determines a PUCCH resource with PUCCH format 3, where
\- the UE determines the PUCCH resource using the PUCCH resource indicator
field in a last of a number of DCI formats, excluding the SPS activation DCI,
that have a value of a PDSCH-to-HARQ_feedback timing indicator field
indicating a same slot for the PUCCH transmission, or a value provided by _dl-
DataToUL-ACK_ or _dl-DataToUL-ACK-r16_ or _dl-DataToUL-ACK-DCI-1-2_ or _dl-
DataToUL-ACK-r17_ or _dl-DataToUL-ACK-DCI-1-2-r17_ if the PDSCH-to-
HARQ_feedback timing indicator field is not present in the last DCI format,
from a PUCCH resource set provided to the UE for HARQ-ACK transmission, and
\- the UE determines the PUCCH resource set as described in clauses 9.2.1 and
9.2.3 for $O_{\text{UCI}}$ UCI bits
and
\- if $\left( O_{\text{ACK}} + O_{\text{SR}} + O_{\text{CSI}} + O_{\text{CRC}}
\right) \leq M_{\text{Interlace,0}}^{\text{PUCCH}} \cdot
N_{\text{sc,ctrl}}^{\text{RB}} \cdot N_{\text{symb-UCI}}^{\text{PUCCH}} \cdot
Q_{m} \cdot r$, the UE transmits the HARQ-ACK, SR and the
$N_{\text{CSI}}^{\text{total}}$ CSI report bits in a PUCCH over the first
interlace
\- else if the UE is provided a second interlace of
$M_{\text{Interlace,1}}^{\text{PUCCH}}$ PRBs by _interlace1_ and if $\left(
O_{\text{ACK}} + O_{\text{SR}} + O_{\text{CSI}} + O_{\text{CRC}} \right) \leq
\left( M_{\text{Interlace,0}}^{\text{PUCCH}} +
M_{\text{Interlace,1}}^{\text{PUCCH}} \right) \cdot
N_{\text{sc,ctrl}}^{\text{RB}} \cdot N_{\text{symb-UCI}}^{\text{PUCCH}} \cdot
Q_{m} \cdot r$, the UE transmits the HARQ-ACK, SR, and CSI reports bits in a
PUCCH over both the first and second interlaces
\- else, the procedure is same as the corresponding one when the UE is
provided _PUCCH-ResourceSet by replacing_ $M_{\text{RB}}^{\text{PUCCH}}$ with
$M_{\text{Interlace,0}}^{\text{PUCCH}}$, or, if the UE is provided
_interlace1_ , with $M_{\text{Interlace,0}}^{\text{PUCCH}} +
M_{\text{Interlace,1}}^{\text{PUCCH}}$.
Table 9.2.5.2-1: Code rate $\mathbf{r}$ corresponding to value of
_maxCodeRate_
* * *
_maxCodeRate_ **Code rate** $\mathbf{r}$
0 0.08 1 0.15 2 0.25 3 0.35 4 0.45 5 0.60 6 0.80 7 Reserved
* * *
#### 9.2.5.3 UE procedure for reporting UCI of different priorities
If a UE
\- is provided _PUCCH-ConfigurationList_ for PUCCH transmissions with priority
0 and 1,
\- is provided _uci-MuxWithDiffPrio_ , and
\- would transmit overlapping PUCCHs that include a first PUCCH with
$O_{ACK,0}$ HARQ-ACK information bits of priority 0 and a second PUCCH with
$O_{ACK,1}$ HARQ-ACK information bits of priority 1
\- if the PUCCH resource for the second PUCCH includes PUCCH format 2, 3, or 4
and additionally includes $O_{SR,1}$ SR bits of priority 1, $O_{ACK,1}$ is
replaced by $O_{ACK,1} + O_{SR,1}$ where $O_{SR,1}$ is determined according to
clause 9.2.5.1
the UE
\- determines
\- a PUCCH resource set from the second _PUCCH-Config_ using ${O_{\text{UCI}}
= O}_{ACK,0} + O_{ACK,1}$ as described in clause 9.2.1, and a PUCCH resource
from the PUCCH resource set as described in clause 9.2.3 where a DCI format,
if any, triggers PUCCH transmission of priority 1, or
\- a PUCCH resource from the second _sps-PUCCH-AN-List_ using ${O_{\text{UCI}}
= O}_{ACK,0} + O_{ACK,1}$ as described in clause 9.2.1, and
\- multiplexes the $O_{ACK,0}$ and $O_{ACK,1}$ HARQ-ACK information bits in a
same PUCCH using the PUCCH resource.
If the PUCCH resource includes PUCCH format 2 or PUCCH format 3 and
$M_{\text{RB}}^{\text{PUCCH}}$ PRBs, the UE determines a number of
$M_{RB,min}^{\text{PUCCH}} \leq M_{\text{RB}}^{\text{PUCCH}}$ PRBs for the
PUCCH transmission to be the minimum number of PRBs that starts from the first
PRB from the $M_{\text{RB}}^{\text{PUCCH}}$ PRBs and results to
$$\left( O_{\text{ACK}\text{,0}} + O_{\text{CRC}\text{,0}} \right) \cdot
r_{\text{1}} + \left( O_{\text{ACK}\text{,1}} + O_{\text{CRC}\text{,1}}
\right) \cdot r_{\text{0}} \leq M_{RB,min}^{\text{PUCCH}} \cdot
N_{\text{sc,c}\text{trl}}^{\text{RB}} \cdot N_{\text{symb-UCI}}^{\text{PUCCH}}
\cdot Q_{m} \cdot r_{\text{0}} \cdot r_{\text{1}}$$
where $O_{\text{CRC}\text{,0}}$ or $O_{\text{CRC}\text{,1}}$ is a number of
CRC bits, if any, for encoding the $O_{\text{ACK}\text{,0}}$ or the
$O_{\text{ACK}\text{,1}}$ HARQ-ACK information bits, respectively,
$r_{\text{0}}$ is provided by _maxCodeRateLP_ , and the remaining parameters
are as defined in clause 9.2.5.2 with $r_{\text{1}} = r$. For PUCCH format 3,
if $M_{RB,min}^{\text{PUCCH}}$ is not equal to $2^{\alpha_{2}} \cdot
3^{\alpha_{3}} \cdot 5^{\alpha_{5}}$ [4, TS 38.211],
$M_{RB,min}^{\text{PUCCH}}$ is increased to a nearest value that is equal to
$2^{\alpha_{2}} \cdot 3^{\alpha_{3}} \cdot 5^{\alpha_{5}}\ $and does not
exceed _nrofPRBs_.
If $\left( O_{\text{ACK}\text{,0}} + O_{\text{CRC}\text{,0}} \right) \cdot
r_{\text{1}} + \left( O_{\text{ACK}\text{,1}} + O_{\text{CRC}\text{,1}}
\right) \cdot r_{\text{0}} > M_{\text{RB}}^{\text{PUCCH}} \cdot
N_{\text{sc,ctrl}}^{\text{RB}} \cdot N_{\text{symb-UCI}}^{\text{PUCCH}} \cdot
Q_{m} \cdot r_{\text{0}} \cdot r_{\text{1}}$, the UE transmits the PUCCH over
the $M_{\text{RB}}^{\text{PUCCH}}$ PRBs.
If a UE transmits a PUCCH that includes HARQ-ACK information bits of priority
0 and 1 using a PUCCH resource that includes PUCCH format 2, 3 or 4, the UE
determines a power for the PUCCH transmission as described in clause 7.2.1
assuming that the PUCCH includes only UCI bits of priority 1, where
$N_{\text{RE}}(i) = \min\left( M_{\text{RB}}^{\text{PUCCH}} \cdot
N_{\text{sc,ctrl}}^{\text{RB}} \cdot N_{\text{symb-
UCI}}^{\text{PUCCH}},\left\lceil \frac{\left( O_{\text{ACK,1}} +
O_{\text{CRC}\text{,1}} \right)}{\left( Q_{m} \cdot r_{\text{1}} \right)}
\right\rceil \right)$. If $O_{\text{ACK}\text{,1}} \leq 11\ $bits, $n_{HARQ -
ACK,1} + O_{SR,1}$ replaces $n_{HARQ - ACK}\left( i \right) +
O_{\text{SR}}\left( i \right) + O_{\text{CSI}}\left( i \right)$ in the
$\mathrm{\Delta}_{\text{TF},b,f,c}\left( i \right)$ calculation in clause
7.2.1; otherwise, $O_{ACK,1} + O_{CRC,1}$ replaces $O_{\text{ACK}}\left( i
\right) + O_{\text{SR}}\left( i \right) + O_{\text{CSI}}\left( i \right) +
O_{\text{CRC}}\left( i \right)$ in the$\ BPRE(i)$ calculation in clause 7.2.1.
If a UE transmits a PUCCH that includes one HARQ-ACK information bit of
priority 0 and one HARQ-ACK information bit of priority 1
\- if the PUCCH transmission uses a resource that includes PUCCH format 0, the
HARQ-ACK information bits of priority 1 and priority 0 are set as the first
and second bits in Table 9.2.3-4, respectively, to derive the $m_{\text{CS}}$
of the PUCCH transmission
\- if the PUCCH transmission uses a resource that includes PUCCH format 1, the
HARQ-ACK information bits of priority 1 and priority 0 are the first and
second bits, respectively, of the QPSK modulated symbol for the PUCCH
transmission
If a UE transmits a PUCCH that includes HARQ-ACK information bits of priority
0 and 1 using PUCCH format 1, the UE determines a power for the PUCCH
transmission as described in clause 7.2.1 assuming that all HARQ-ACK
information bits have priority 1.
If a UE is provided a first interlace of
$M_{\text{Interlace,0}}^{\text{PUCCH}}$ PRBs by _interlace0_ in
_InterlaceAllocation_
\- if the UE is provided a second interlace of
$M_{\text{Interlace,1}}^{\text{PUCCH}}$ PRBs by _interlace1_ in
_InterlaceAllocation_
\- if $\left( O_{\text{ACK,0}} + O_{\text{CRC,0}} \right) \cdot r_{\text{1}} +
\left( O_{\text{ACK,1}} + O_{\text{CRC,1}} \right) \cdot r_{\text{0}} \leq
M_{Interlace,0}^{\text{PUCCH}} \cdot N_{\text{sc,ctrl}}^{\text{RB}} \cdot
N_{\text{symb-UCI}}^{\text{PUCCH}} \cdot Q_{m} \cdot r_{\text{0}} \cdot
r_{\text{1}}$, the UE transmits the PUCCH over the first interlace
\- else, the UE transmits the PUCCH over both the first and second interlaces
\- else the UE transmits the PUCCH over the first interlace
If the UE transmits a PUCCH that includes HARQ-ACK information bits of
priority 0 and 1 over interlaces, the UE determines a power for the PUCCH
transmission as described in clause 7.2.1 assuming that the PUCCH includes
only UCI bits of priority 1.
#### 9.2.5.4 UE procedure for deferring HARQ-ACK for SPS PDSCH
If a UE is provided _sps-HARQ-Deferral_ and, after performing the procedures
in clauses 9 and 9.2.5 to resolve overlapping among PUCCHs and PUSCHs in a
first slot, if any, the UE determines a PUCCH resource for a PUCCH
transmission with first HARQ-ACK information bits for SPS PDSCH receptions
that the UE would report for a first time, and the PUCCH resource
\- is provided by _SPS-PUCCH-AN-List_ as described in clause 9.2.1, or by
_n1PUCCH-AN_ if _SPS-PUCCH-AN-List_ is not provided
\- is not cancelled by an overlapping PUCCH or PUSCH transmission of larger
priority index
\- overlaps with a symbol indicated as downlink by _tdd-UL-DL-
ConfigurationCommon_ or _tdd-UL-DL-ConfigDedicated_ , or indicated for a
SS/PBCH block by _ssb-PositionsInBurst, or belonging to a CORESET associated
with a Type0-PDCCH CSS set_
the UE
\- determines an earliest second slot and, after performing the procedures in
clauses 9.2.1 and 9.2.3 to determine a PUCCH with HARQ-ACK information bits
including second HARQ-ACK information bits and then performing the procedures
in clauses 9 and 9.2.5 to resolve overlapping among PUCCHs and PUSCHs, if any,
a PUSCH or a PUCCH in the earliest second slot to multiplex HARQ-ACK
information bits that include second HARQ-ACK information bits from the first
HARQ-ACK information bits , where the second HARQ-ACK information bits
correspond to SPS PDSCH configurations with _sps-HARQ-Deferral_ values that
are larger than or equal to a time difference, with reference to slots for
PUCCH transmissions on the primary cell, between the second slot and the slot
of the SPS PDSCH reception, if any
\- if the UE detects a DCI format in a PDCCH reception that triggers a PUCCH
transmission with a Type-3 HARQ-ACK codebook in a slot as described in clause
9.1.4, the UE stops the procedure to determine the earliest second slot in the
slot
\- if the UE is provided a periodic cell switching pattern for PUCCH
transmissions by _pucch-sSCellPattern_ , the UE determines the earliest second
slot and a corresponding cell based on the periodic cell switching pattern as
described in clause 9.A
\- if the UE multiplexes the second HARQ-ACK information in a PUSCH, or in a
PUCCH using a resource that is not from _SPS-PUCCH-AN-List, or from n1PUCCH-AN
if SPS-PUCCH-AN-List is not provided, the UE stops the procedure to determine
the earliest second slot in the slot_
\- if the UE multiplexes the second HARQ-ACK information in a first PUCCH
using a resource provided by _SPS-PUCCH-AN-List, or by n1PUCCH-AN if SPS-
PUCCH-AN-List is not provided_ , of smaller priority index and the UE drops
the first PUCCH transmission due to an overlapping with a second PUSCH or
PUCCH transmission of larger priority index _, the UE stops the procedure to
determine the earliest second slot in the slot_
\- if the UE multiplexes the second HARQ-ACK information in a first PUCCH
using a resource provided by _SPS-PUCCH-AN-List, or by n1PUCCH-AN if SPS-
PUCCH-AN-List is not provided_ , and the PUCCH transmission is not dropped due
to an overlapping with a PUSCH or PUCCH transmission of larger priority and
does not have any symbol that overlaps with a symbol indicated as downlink by
_tdd-UL-DL-ConfigurationCommon_ or _tdd-UL-DL-ConfigDedicated_ , or indicated
for a SS/PBCH block by _ssb-PositionsInBurst, or belonging to a CORESET
associated with a Type0-PDCCH CSS set, the UE stops the procedure to determine
the earliest second slot in the slot_
\- the second HARQ-ACK information bits, generated as described in clause
9.1.2, are appended in a HARQ-ACK codebook the UE generates as described in
clauses 9.1.2, 9.1.2.1, 9.1.3.1, or 9.1.5
\- if the UE would receive a PDSCH providing a TB for a same HARQ process as a
HARQ-ACK information bit from the second HARQ-ACK information bits prior to
transmitting the PUCCH or the PUSCH, the UE does not include the HARQ-ACK
information bit in the HARQ-ACK information bits.
The UE does not expect to be provided both _sps-HARQ-Deferral_ and _nrofSlots_
or _pucch-RepetitionNrofSlots_ for any PUCCH resource of same priority.
### 9.2.6 PUCCH repetition procedure
A UE can be indicated to transmit a PUCCH over
$N_{\text{PUCCH}}^{\text{repeat}}$ slots using a PUCCH resource, where
\- if the PUCCH resource is indicated by a DCI format and includes _pucch-
RepetitionNrofSlots_ , $N_{\text{PUCCH}}^{\text{repeat}}$ is provided by
_pucch-RepetitionNrofSlots_
\- otherwise, $N_{\text{PUCCH}}^{\text{repeat}}$ is provided by _nrofSlots_
If the UE is provided _subslotLengthForPUCCH, a slot for a PUCCH transmission
with repetitions over_ $N_{\text{PUCCH}}^{\text{repeat}} > 1$ slots includes a
number of symbols indicated by _subslotLengthForPUCCH_.
For $N_{\text{PUCCH}}^{\text{repeat}} > 1$,
\- the UE repeats the PUCCH transmission with the UCI over
$N_{\text{PUCCH}}^{\text{repeat}}$ slots
\- a repetition of the PUCCH transmission in each of the
$N_{\text{PUCCH}}^{\text{repeat}}$ slots has a same number of consecutive
symbols, as provided by _nrofSymbols_
\- a repetition of the PUCCH transmission in each of the
$N_{\text{PUCCH}}^{\text{repeat}}$ slots has a same first symbol, as provided
by _startingSymbolIndex_ _if subslotLengthForPUCCH is not provided; otherwise
mod(startingSymbolIndex, subslotLengthForPUCCH)_
\- the UE is configured by _interslotFrequencyHopping_ whether or not to
perform frequency hopping for repetitions of the PUCCH transmission in
different slots
\- if the UE is configured to perform frequency hopping for repetitions of a
PUCCH transmission across slots and the UE is not provided _pucch-DMRS-
Bundling_ = \'enabled\'
\- the UE performs frequency hopping per slot
\- the UE transmits the PUCCH starting from a first PRB, provided by
_startingPRB_ , in slots with even number and starting from a second PRB,
provided by _secondHopPRB_ , in slots with odd number. The slot indicated to
the UE for the first repetition of the PUCCH transmission has number 0 and
each subsequent slot until the UE transmits the PUCCH in
$N_{\text{PUCCH}}^{\text{repeat}}$ slots is counted regardless of whether or
not the UE transmits the PUCCH in the slot
\- the UE does not expect to be configured to perform frequency hopping for a
repetition of the PUCCH transmission within a slot
\- if the UE is configured to perform frequency hopping for repetitions of a
PUCCH transmission across slots and the UE is provided _pucch-DMRS-Bundling_ =
\'enabled\'
\- the UE performs frequency hopping per interval of
$N_{\text{PUCCH}}^{\text{interval}}$ consecutive slots, that start from a slot
indicated to the UE and where the UE would transmit a first repetition of the
PUCCH, where $N_{\text{PUCCH}}^{\text{interval}}$ is the value of _pucch-
FrequencyHoppingInterval_ , if provided; otherwise,
$N_{\text{PUCCH}}^{\text{interval}}$ is the value of _pucch-
TimeDomainWindowLength_
\- the UE transmits the PUCCH over intervals until the UE transmits the PUCCH
in $N_{\text{PUCCH}}^{\text{repeat}}$ slots, where the first interval has
number 0 and each subsequent interval is counted regardless of whether or not
the UE transmits the PUCCH in a slot
\- the UE transmits the PUCCH starting from a first PRB, provided by
_startingPRB_ , in intervals with even number and starting from a second PRB,
provided by _secondHopPRB_ , in intervals of frequency hopping intervals with
odd number
\- the UE does not expect to be configured to perform frequency hopping for a
repetition of the PUCCH transmission within a slot
\- if the UE is not configured to perform frequency hopping for repetitions of
a PUCCH transmission across slots and the UE is configured to perform
frequency hopping for a repetition of the PUCCH transmission within a slot,
the frequency hopping pattern between the first PRB and the second PRB is same
within each slot
If the UE determines that, for a repetition of a PUCCH transmission in a slot,
the number of symbols available for the PUCCH transmission is smaller than the
value provided by _nrofSymbols_ for the corresponding PUCCH format, the UE
does not transmit the PUCCH repetition in the slot.
A SS/PBCH block symbol is a symbol of an SS/PBCH block with candidate SS/PBCH
block index corresponding to the SS/PBCH block index indicated to a UE by
_ssb-PositionsInBurst_ in _SIB1_ or _ssb-PositionsInBurst_ in
_ServingCellConfigCommon_ or by _NonCellDefiningSSB if_ provided or, if the UE
is not provided _dl-OrJointTCI-StateList_ , by _ssb-PositionsInBurst_ in _SSB-
MTCAdditionalPCI_ associated to physical cell ID with active TCI states for
PDCCH or PDSCH, or for a set of symbols of a slot corresponding to SS/PBCH
blocks configured for L1 beam measurement/reporting.
For unpaired spectrum, the UE determines the
$N_{\text{PUCCH}}^{\text{repeat}}$ slots for a PUCCH transmission starting
from a slot indicated to the UE as described in clause 9.2.3 for HARQ-ACK
reporting, or a slot determined as described in clause 9.2.4 for SR reporting
or in clause 5.2.1.4 of [6, TS 38.214] for CSI reporting and having
\- an UL symbol, as described in clause 11.1, or flexible symbol that is not
SS/PBCH block symbol provided by _startingSymbolIndex_ as a first symbol, and
\- consecutive UL symbols, as described in clause 11.1, or flexible symbols
that are not SS/PBCH block symbols, starting from the first symbol, equal to
or larger than a number of symbols provided by _nrofsymbols_
For paired spectrum or supplementary uplink band, the UE determines the
$N_{\text{PUCCH}}^{\text{repeat}}$ slots for a PUCCH transmission as the
$N_{\text{PUCCH}}^{\text{repeat}}$ consecutive slots starting from a slot
indicated to the UE as described in clause 9.2.3 for HARQ-ACK reporting, or a
slot determined as described in clause 9.2.4 for SR reporting or in clause
5.2.1.4 of [6, TS 38.214] for CSI reporting.
If a UE would transmit a PUCCH over a first number
$N_{\text{PUCCH}}^{\text{repeat}} > 1$ of slots and the UE would transmit a
PUSCH with repetition Type A or with TB processing over multiple slots over a
second number of slots, and the PUCCH transmission would overlap with the
PUSCH transmission in one or more slots, and the conditions in clause 9.2.5
for multiplexing the UCI in the PUSCH are satisfied in the overlapping slots,
the UE transmits the PUCCH and does not transmit the PUSCH in the overlapping
slots.
If a UE would transmit a PUCCH over a first number
$N_{\text{PUCCH}}^{\text{repeat}} > 1$ of slots and the UE would transmit a
PUSCH with repetition Type B over a second number of slots, and the PUCCH
transmission would overlap with actual PUSCH repetitions in one or more slots,
and the conditions in clause 9.2.5 for multiplexing the UCI in the PUSCH are
satisfied for the overlapping actual PUSCH repetitions, the UE transmits the
PUCCH and does not transmit the overlapping actual PUSCH repetitions.
A UE does not multiplex different UCI types in a PUCCH transmission with
repetitions over $N_{\text{PUCCH}}^{\text{repeat}} > 1$ slots. If a UE would
transmit a first PUCCH over more than one slot and at least a second PUCCH
over one or more slots, and the transmissions of the first PUCCH and the
second PUCCH would overlap in a number of slots then, for each slot of the
number of slots and with UCI type priority of HARQ-ACK > SR > CSI with higher
priority > CSI with lower priority, the UE determines an earliest first PUCCH
in a slot with the order of earliest starting symbol followed by longest
duration and the second PUCCHs overlapping with the earliest first PUCCH, and
then performs the following
\- the UE does not expect more than one PUCCH from the first PUCCH and the
second PUCCHs to start at a same slot and include a UCI type with same
priority
\- if more than one PUCCH from the first PUCCH and the second PUCCHs include a
UCI type with the same highest priority, the UE transmits the PUCCH with the
highest priority starting at an earliest slot and does not transmit the other
PUCCHs, otherwise,
\- the UE transmits the PUCCH that includes the UCI type with the highest
priority and does not transmit the PUCCHs that include the UCI type with lower
priority
The UE repeats the above procedure until there is no PUCCH overlapping with
any PUCCH with repetitions in the slot.
When a PUCCH resource used for repetitions of a PUCCH transmission by a UE
includes first and second spatial settings, or first and second sets of power
control parameters, as described in [11, TS 38.321] and in clause 7.2.1, the
UE
\- uses the first and second spatial settings, or the first and second sets of
power control parameters, for first and second repetitions of the PUCCH
transmission, respectively, when $N_{\text{PUCCH}}^{\text{repeat}} = 2$,
\- alternates between the first and second spatial settings, or between the
first and second sets of power control parameters, respectively, per
$N_{\text{PUCCH}}^{\text{switch}}$ repetitions of the PUCCH transmission,
where $N_{\text{PUCCH}}^{\text{switch}} = 1$ if _mappingPattern_ =
\'cyclicMapping\'; else, $N_{\text{PUCCH}}^{\text{switch}} = 2$.
A UE does not expect a PUCCH that is in response to a DCI format detection to
overlap with any other PUCCH that does not satisfy the corresponding timing
conditions in clause 9.2.5.
If a UE would transmit a PUCCH over $N_{\text{PUCCH}}^{\text{repeat}}$ slots
and the UE does not transmit the PUCCH in a slot from the
$N_{\text{PUCCH}}^{\text{repeat}}$ slots due to overlapping with another PUCCH
transmission in the slot, the UE counts the slot in the number of
$N_{\text{PUCCH}}^{\text{repeat}}$ slots.
For DAPS operation, if a UE would transmit a PUCCH over
$N_{\text{PUCCH}}^{\text{repeat}}$ slots on the source MCG and the UE does not
transmit the PUCCH in a slot from the $N_{\text{PUCCH}}^{\text{repeat}}$ slots
due to overlapping in time with UE transmission on the target MCG in the slot,
the UE counts the slot in the number of $N_{\text{PUCCH}}^{\text{repeat}}$
slots.
## 9.3 UCI reporting in physical uplink shared channel
Offset values are defined for a UE to determine a number of resources for
multiplexing HARQ-ACK information and for multiplexing CSI reports in a PUSCH.
Offset values are also defined for multiplexing CG-UCI [5, TS 38.212] in a CG-
PUSCH. The offset values are signalled to a UE either by a DCI format
scheduling the PUSCH transmission or by higher layers.
If a DCI format that does not include a beta_offset indicator field schedules
the PUSCH transmission from the UE and the UE is provided _betaOffsets =
\'semiStatic\' or betaOffsetsDCI-0-2 = \'semiStaticDCI-0-2\'_ , the UE applies
the $\beta_{\text{offset}}^{HARQ - ACK}$, $\beta_{\text{offset}}^{CSI - 1}$,
and $\beta_{\text{offset}}^{CSI - 2}$ values that are provided by _betaOffsets
= \'semiStatic\'_ for DCI formats 0_0/0_1 or by _betaOffsetsDCI-0-2 =
\'semiStaticDCI-0-2\'_ for DCI format 0_2 for the corresponding HARQ-ACK
information, Part 1 CSI reports and Part 2 CSI reports. If the PUSCH
transmission has priority 0 or priority 1 and the UE is configured by _uci-
MuxWithDiffPrio_ to multiplex HARQ-ACK information of priority 1 or priority
0, respectively, and if the UE multiplexes HARQ-ACK information of priority 1
or priority 0, the UE applies corresponding $\beta_{\text{offset}}^{HARQ -
ACK,1}$ or $\beta_{\text{offset}}^{HARQ - ACK,0}$ provided by
_betaOffsetsCrossPri1_ _= \'semiStatic\'_ for DCI formats 0_0/0_1 and by
_betaOffsetsCrossPri1DCI-0-2= \'semiStatic\'_ for DCI format 0_2, or by
_betaOffsetsCrossPri0 = \'semiStatic\'_ for DCI format 0_1 and by
_betaOffsetsCrossPri0DCI-0-2= \'semiStatic\'_ for DCI format 0_2,
respectively.
If the PUSCH transmission is with a configured grant and the UE is provided
_CG-UCI-OnPUSCH= \'semiStatic\'_ , the UE applies the
$\beta_{\text{offset}}^{HARQ - ACK}$, $\beta_{\text{offset}}^{CSI - 1}$, and
$\beta_{\text{offset}}^{CSI - 2}$ values that are provided by _CG-UCI-OnPUSCH
= \'semiStatic\'_ for the corresponding HARQ-ACK information, Part 1 CSI
reports and Part 2 CSI reports. If the PUSCH transmission has priority 0 or
priority 1 and the UE is configured by _uci-MuxWithDiffPrio_ to multiplex
HARQ-ACK information of priority 1 or priority 0, respectively, and if the UE
multiplexes HARQ-ACK information of priority 1 or priority 0, the UE applies
corresponding $\beta_{\text{offset}}^{HARQ - ACK,1}$ or
$\beta_{\text{offset}}^{HARQ - ACK,0}$ provided by _cg-betaOffsetsCrossPri1_
_= \'semiStatic\'_ or _cg-betaOffsetsCrossPri0 = \'semiStatic\'_ ,
respectively.
If the PUSCH transmission is scheduled by DCI format 0_0 and the UE is
provided _betaOffsets = \'dynamic\'_ , the UE applies the
$\beta_{\text{offset}}^{HARQ - ACK}$, $\beta_{\text{offset}}^{CSI - 1}$, and
$\beta_{\text{offset}}^{CSI - 2}$ values that are determined from the first
value of _betaOffsets = \'dynamic\'_. If the UE is configured by _uci-
MuxWithDiffPrio_ to multiplex HARQ-ACK information of priority 1, the UE
applies corresponding $\beta_{\text{offset}}^{HARQ - ACK,1}$ provided by the
first value of _betaOffsetsCrossPri1_ _= \'dynamic\'_.
If the PUSCH transmission is a configured grant Type 2 PUSCH and the UE is
provided _CG-UCI-OnPUSCH_ =_\'dynamic\'_ , the UE applies the
$\beta_{\text{offset}}^{HARQ - ACK}$, $\beta_{\text{offset}}^{CSI - 1}$, and
$\beta_{\text{offset}}^{CSI - 2}$ values that are determined from the first
value of _CG-UCI-OnPUSCH = \'dynamic\'_. If the PUSCH transmission has
priority 0 or priority 1 and the UE is configured by _uci-MuxWithDiffPrio_ to
multiplex HARQ-ACK information of priority 1 or priority 0, respectively, and
if the UE multiplexes HARQ-ACK information of priority 1 or priority 0, the UE
applies corresponding $\beta_{\text{offset}}^{HARQ - ACK,1}$ or
$\beta_{\text{offset}}^{HARQ - ACK,0}$ provided by the first value of _cg-
betaOffsetsCrossPri1_ _= \'dynamic\'_ or _cg-betaOffsetsCrossPri0_ _=
\'dynamic\'_ , respectively.
HARQ-ACK information offsets $\beta_{\text{offset}}^{HARQ - ACK}$ are
configured to values according to Table 9.3-1. The _betaOffsetACK-Index1_ ,
_betaOffsetACK-Index2_ , and _betaOffsetACK-Index3_ respectively provide
indexes $I_{offset,0}^{HARQ - ACK}$, $I_{offset,1}^{HARQ - ACK}$, and
$I_{offset,2}^{HARQ - ACK}$ for the UE to use if the UE multiplexes up to 2
HARQ-ACK information bits, more than 2 and up to 11 HARQ-ACK information bits,
and more than 11 bits in the PUSCH, respectively.
Offsets $\beta_{\text{offset}}^{HARQ - ACK,0}$ for multiplexing HARQ-ACK
information with priority 0 in a PUSCH transmission with priority 1 are
configured to values according to Table 9.3-1. The first, second and third
values provided by any of _betaOffsetsCrossPri0, betaOffsetsCrossPri0DCI-0-2,
or_ _cg-betaOffsetsCrossPri0_ respectively provide indexes $I_{offset,0}^{HARQ
- ACK,0}$, $I_{offset,1}^{HARQ - ACK,0}$, and $I_{offset,2}^{HARQ - ACK,0}$
for the UE to use if the UE multiplexes up to 2 bits, more than 2 and up to 11
bits, and more than 11 bits of HARQ-ACK information with priority 0 in the
PUSCH transmission with priority 1, respectively.
Offsets $\beta_{\text{offset}}^{HARQ - ACK,1}$ for multiplexing HARQ-ACK
information with priority 1 in a PUSCH transmission with priority 0 are
configured to values according to Table 9.3-1. The first, second and third
values provided by any of _betaOffsetsCrossPri1, betaOffsetsCrossPri1DCI-0-2,
or_ _cg-betaOffsetsCrossPri1_ respectively provide indexes $I_{offset,0}^{HARQ
- ACK,1}$, $I_{offset,1}^{HARQ - ACK,1}$, and $I_{offset,2}^{HARQ - ACK,1}$
for the UE to use if the UE multiplexes up to 2 bits, more than 2 and up to 11
bits, and more than 11 bits of HARQ-ACK information with priority 1 in the
PUSCH transmission with priority 0, respectively.
Part 1 CSI report and Part 2 CSI report offsets $\beta_{\text{offset}}^{CSI -
1}$ and $\beta_{\text{offset}}^{CSI - 2}$, respectively, are configured to
values according to Table 9.3-2. The _betaOffsetCSI-Part1-Index1_ and
_betaOffsetCSI-Part2-Index1_ respectively provide indexes $I_{offset,0}^{CSI -
1}$ and $I_{offset,0}^{CSI - 2}$ for the UE to use if the UE multiplexes up to
11 bits for Part 1 CSI reports or Part 2 CSI reports in the PUSCH. The
_betaOffsetCSI-Part1-Index2_ and _betaOffsetCSI-Part2-Index2_ respectively
provide indexes $I_{offset,1}^{CSI - 1}$ or $I_{offset,1}^{CSI - 2}$ for the
UE to use if the UE multiplexes more than 11 bits for Part 1 CSI reports or
Part 2 CSI reports in the PUSCH.
If a DCI format that includes a beta_offset indicator field with one bit or
two bits, as configured by _UCI-OnPUSCH_ for DCI format 0_1 _or by UCI-
OnPUSCH-DCI-0-2_ for DCI format 0_2, schedules the PUSCH transmission from the
UE, the UE is provided by each of {_betaOffsetACK-Index1_ , _betaOffsetACK-
Index2_ , _betaOffsetACK-Index3_}, the {first, second, third} values provided
by _betaOffsetsCrossPri0, or betaOffsetsCrossPri0DCI-0-2,_ and the {first,
second, third} values provided by _betaOffsetsCrossPri1, or_
_betaOffsetsCrossPri1DCI-0-2_ a set of two or four $I_{\text{offset}}^{HARQ -
ACK},\ I_{\text{offset}}^{HARQ - ACK,0},\ and\ I_{\text{offset}}^{HARQ -
ACK,1}\ $ indexes from Table 9.3-1 for multiplexing HARQ-ACK information in
the PUSCH transmission and by each of {_betaOffsetCSI-Part1-Index1_ ,
_betaOffsetCSI-Part1-Index2_} a set of two or four $I_{\text{offset}}^{CSI -
1}$ indexes, and by each of {_betaOffsetCSI-Part2-Index1_ , _betaOffsetCSI-
Part2-Index2_} a set of two or four $I_{\text{offset}}^{CSI - 2}$ indexes from
Table 9.3-2, respectively, for multiplexing Part 1 CSI reports and Part 2 CSI
reports, respectively, in the PUSCH transmission. The beta_offset indicator
field indicates a $I_{\text{offset}}^{HARQ - ACK}$ value and/or a
$I_{\text{offset}}^{HARQ - ACK,0}$ value, and/or a $I_{\text{offset}}^{HARQ -
ACK,1}$ value, a $I_{\text{offset}}^{CSI - 1}$ value and a
$I_{\text{offset}}^{CSI - 2}$ value from the respective sets of values, with
the mapping defined in Table 9.3-3 and in Table 9.3-3A. If the PUSCH
transmission has priority 0 or priority 1, and the UE is provided _uci-
MuxWithDiffPrio_ , and the UE multiplexes HARQ-ACK information of priority 1
or priority 0 in the PUSCH, the UE applies the {first, second, third} values
provided by _betaOffsetsCrossPri1_ _= \'dynamic\'_ for DCI format 0_1,
_betaOffsetsCrossPri1DCI-0-2= \'dynamic\'_ for DCI format 0_2, or applies the
{first, second, third} values provided by _betaOffsetsCrossPri0 = \'dynamic\'_
for DCI format 0_1, _betaOffsetsCrossPri0DCI-0-2= \'dynamic\'_ for DCI format
0_2.
For a PUSCH transmission that is configured by a _ConfiguredGrantConfig_ and
includes CG-UCI, the UE multiplexes CG-UCI in the PUSCH transmission if the UE
is provided by _betaOffsetCG-UCI_ a $I_{\text{offset}}^{\text{CG-UCI}}$ value,
from a set of values, with the mapping defined in Table 9.3-1. If the UE is
provided _cg-UCI-Multiplexing_ and multiplexes HARQ-ACK information in the
PUSCH transmission, as described in clauses 9 and 9.2.5, the UE jointly
encodes the HARQ-ACK information and the CG-UCI [5, TS 38.212] and determines
a number of resources for multiplexing the combined information in a PUSCH
using $\beta_{\text{offset}}^{HARQ - ACK}$ which provides indexes
$I_{offset,1}^{HARQ - ACK}$ and $I_{offset,2}^{HARQ - ACK}$ for the UE to use
if the UE multiplexes up to 11, and more than 11 combined information bits,
respectively.
Table 9.3-1: Mapping of beta_offset values for HARQ-ACK information and/or for
CG-UCI and the index signalled by higher layers
+----------------------------------+----------------------------------+ | $\mathbf{I}_{\te | $\mathbf{\beta}_{\mathbf{\tex | | xt{offset,0}}^{\text{HARQ-ACK}}$ | t{offset}}}^{\mathbf{\text{HARQ} | | or | }\mathbf{-}\mathbf{\text{ACK}}}$ | | $\mathbf{I}_{\te | or | | xt{offset,1}}^{\text{HARQ-ACK}}$ | $\mathbf{\beta}_{\mathbf{\t | | or | ext{offset}}}^{\mathbf{\text{CG} | | $\mathbf{I}_{\te | }\mathbf{-}\mathbf{\text{UCI}}}$ | | xt{offset,2}}^{\text{HARQ-ACK}}$ | | | or | or | | $\mathbf{I}_ | $ | | {\text{offset}}^{\text{CG-UCI}}$ | \mathbf{\beta}_{\mathbf{\text{of | | | fset}}}^{\mathbf{HARQ - ACK,0}}$ | | or | or | | $\mathbf{I}_{\text | $ | | {offset,0}}^{\text{HARQ-ACK,0}}$ | \mathbf{\beta}_{\mathbf{\text{of | | or | fset}}}^{\mathbf{HARQ - ACK,1}}$ | | $\mathbf{I}_{\text | | | {offset,1}}^{\text{HARQ-ACK,0}}$ | | | or | | | $\mathbf{I}_{\text | | | {offset,2}}^{\text{HARQ-ACK,0}}$ | | | | | |**or** | | | $\mathbf{I}_{\text | | | {offset,0}}^{\text{HARQ-ACK,1}}$ | | | or | | | $\mathbf{I}_{\text | | | {offset,1}}^{\text{HARQ-ACK,1}}$ | | | or | | | $\mathbf{I}_{\text | | | {offset,2}}^{\text{HARQ-ACK,1}}$ | | +==================================+==================================+ | 0 | 1.000 | +----------------------------------+----------------------------------+ | 1 | 2.000 | +----------------------------------+----------------------------------+ | 2 | 2.500 | +----------------------------------+----------------------------------+ | 3 | 3.125 | +----------------------------------+----------------------------------+ | 4 | 4.000 | +----------------------------------+----------------------------------+ | 5 | 5.000 | +----------------------------------+----------------------------------+ | 6 | 6.250 | +----------------------------------+----------------------------------+ | 7 | 8.000 | +----------------------------------+----------------------------------+ | 8 | 10.000 | +----------------------------------+----------------------------------+ | 9 | 12.625 | +----------------------------------+----------------------------------+ | 10 | 15.875 | +----------------------------------+----------------------------------+ | 11 | 20.000 | +----------------------------------+----------------------------------+ | 12 | 31.000 | +----------------------------------+----------------------------------+ | 13 | 50.000 | +----------------------------------+----------------------------------+ | 14 | 80.000 | +----------------------------------+----------------------------------+ | 15 | 126.000 | +----------------------------------+----------------------------------+ | 16 | 0.6 | +----------------------------------+----------------------------------+ | 17 | 0.4 | +----------------------------------+----------------------------------+ | 18 | 0.2 | +----------------------------------+----------------------------------+ | 19 | 0.1 | +----------------------------------+----------------------------------+ | 20 | 0.05 | +----------------------------------+----------------------------------+ | 21 | Reserved | +----------------------------------+----------------------------------+ | 22 | Reserved | +----------------------------------+----------------------------------+ | 23 | Reserved | +----------------------------------+----------------------------------+ | 24 | Reserved | +----------------------------------+----------------------------------+ | 25 | Reserved | +----------------------------------+----------------------------------+ | 26 | Reserved | +----------------------------------+----------------------------------+ | 27 | Reserved | +----------------------------------+----------------------------------+ | 28 | Reserved | +----------------------------------+----------------------------------+ | 29 | Reserved | +----------------------------------+----------------------------------+ | 30 | Reserved | +----------------------------------+----------------------------------+ | 31 | Reserved | +----------------------------------+----------------------------------+
Table 9.3-2: Mapping of beta_offset values for CSI and the index signalled by
higher layers
+----------------------------------+----------------------------------+ | $\mathbf{I}_{ | $$\mathbf{\beta}_{\ma | | \text{offset,0}}^{\text{CSI-1}}$ | thbf{\text{offset}}}^{\mathbf{\t | | or | ext{CSI}}\mathbf{-}\mathbf{1}}$$ | | $\mathbf{I}_{ | | | \text{offset,1}}^{\text{CSI-1}}$ | $$\mathbf{\beta}_{\ma | | | thbf{\text{offset}}}^{\mathbf{\t | | $\mathbf{I}_{ | ext{CSI}}\mathbf{-}\mathbf{2}}$$ | | \text{offset,0}}^{\text{CSI-2}}$ | | | or | | | $\mathbf{I}_{ | | | \text{offset,1}}^{\text{CSI-2}}$ | | +==================================+==================================+ | 0 | 1.125 | +----------------------------------+----------------------------------+ | 1 | 1.250 | +----------------------------------+----------------------------------+ | 2 | 1.375 | +----------------------------------+----------------------------------+ | 3 | 1.625 | +----------------------------------+----------------------------------+ | 4 | 1.750 | +----------------------------------+----------------------------------+ | 5 | 2.000 | +----------------------------------+----------------------------------+ | 6 | 2.250 | +----------------------------------+----------------------------------+ | 7 | 2.500 | +----------------------------------+----------------------------------+ | 8 | 2.875 | +----------------------------------+----------------------------------+ | 9 | 3.125 | +----------------------------------+----------------------------------+ | 10 | 3.500 | +----------------------------------+----------------------------------+ | 11 | 4.000 | +----------------------------------+----------------------------------+ | 12 | 5.000 | +----------------------------------+----------------------------------+ | 13 | 6.250 | +----------------------------------+----------------------------------+ | 14 | 8.000 | +----------------------------------+----------------------------------+ | 15 | 10.000 | +----------------------------------+----------------------------------+ | 16 | 12.625 | +----------------------------------+----------------------------------+ | 17 | 15.875 | +----------------------------------+----------------------------------+ | 18 | 20.000 | +----------------------------------+----------------------------------+ | 19 | Reserved | +----------------------------------+----------------------------------+ | 20 | Reserved | +----------------------------------+----------------------------------+ | 21 | Reserved | +----------------------------------+----------------------------------+ | 22 | Reserved | +----------------------------------+----------------------------------+ | 23 | Reserved | +----------------------------------+----------------------------------+ | 24 | Reserved | +----------------------------------+----------------------------------+ | 25 | Reserved | +----------------------------------+----------------------------------+ | 26 | Reserved | +----------------------------------+----------------------------------+ | 27 | Reserved | +----------------------------------+----------------------------------+ | 28 | Reserved | +----------------------------------+----------------------------------+ | 29 | Reserved | +----------------------------------+----------------------------------+ | 30 | Reserved | +----------------------------------+----------------------------------+ | 31 | Reserved | +----------------------------------+----------------------------------+
Table 9.3-3: Mapping of four beta_offset indicator values to offset indexes
+------------------------+--------------------------------------------+ | beta_offset indicator | ($\math | | | bf{I}_{\text{offset,0}}^{\text{HARQ-ACK}}$ | | | or | | | $\math | | | bf{I}_{\text{offset,1}}^{\text{HARQ-ACK}}$ | | | or | | | $\mathbf | | | {I}_{\text{offset,2}}^{\text{HARQ-ACK}}$), | | | | | | ($\mathbf | | | {I}_{\text{offset,0}}^{\text{HARQ-ACK,0}}$ | | | or | | | $\mathbf | | | {I}_{\text{offset,1}}^{\text{HARQ-ACK,0}}$ | | | or | | | $\mathbf{I | | | }_{\text{offset,2}}^{\text{HARQ-ACK,0}}$), | | | | | | ($\mathbf | | | {I}_{\text{offset,0}}^{\text{HARQ-ACK,1}}$ | | | or | | | $\mathbf | | | {I}_{\text{offset,1}}^{\text{HARQ-ACK,1}}$ | | | or | | | $\mathbf{I | | | }_{\text{offset,2}}^{\text{HARQ-ACK,1}}$), | | | | | | ($\m | | | athbf{I}_{\text{offset,0}}^{\text{CSI-1}}$ | | | or | | | $\mat | | | hbf{I}_{\text{offset,0}}^{\text{CSI-2}}$), | | | ($\m | | | athbf{I}_{\text{offset,1}}^{\text{CSI-1}}$ | | | or | | | $\ma | | | thbf{I}_{\text{offset,1}}^{\text{CSI-2}}$) | +------------------------+--------------------------------------------+ | \'00\' | 1^st^ offset index provided by higher | | | layers | +------------------------+--------------------------------------------+ | \'01\' | 2^nd^ offset index provided by higher | | | layers | +------------------------+--------------------------------------------+ | \'10\' | 3^rd^ offset index provided by higher | | | layers | +------------------------+--------------------------------------------+ | \'11\' | 4^th^ offset index provided by higher | | | layers | +------------------------+--------------------------------------------+
Table 9.3-3A: Mapping of two beta_offset indicator values to offset indexes
+----------------------------+----------------------------------------+ | **beta_offset indicator** | **(** $\mathbf{I | | | }_{\text{offset,0}}^{\text{HARQ-ACK}}$ | | |**or** | | | $\mathbf{I | | | }_{\text{offset,1}}^{\text{HARQ-ACK}}$ | | | **or** | | | $\mathbf{I}_{\te | | | xt{offset,2}}^{\text{HARQ-ACK}}$**),** | | | | | | ($\mathbf{I}_ | | | {\text{offset,0}}^{\text{HARQ-ACK,0}}$ | | | or | | | $\mathbf{I}_| | | {\text{offset,1}}^{\text{HARQ-ACK,0}}$ | | | or | | | $\mathbf{I}_{\ | | | text{offset,2}}^{\text{HARQ-ACK,0}}$), | | | | | | ($\mathbf{I}_| | | {\text{offset,0}}^{\text{HARQ-ACK,1}}$ | | | or | | | $\mathbf{I}_ | | | {\text{offset,1}}^{\text{HARQ-ACK,1}}$ | | | or | | | $\mathbf{I}_{\ | | | text{offset,2}}^{\text{HARQ-ACK,1}}$), | | | | | |**(** $\mathb | | | f{I}_{\text{offset,0}}^{\text{CSI-1}}$ | | | **or** | | | $\mathbf{I} | | | _{\text{offset,0}}^{\text{CSI-2}}$**), | | | (** $\mathb | | | f{I}_{\text{offset,1}}^{\text{CSI-1}}$ | | | **or** | | | $\mathbf{I}_ | | | {\text{offset,1}}^{\text{CSI-2}}$**)** | +----------------------------+----------------------------------------+ | \'0\' | 1^st^ offset index provided by higher | | | layers | +----------------------------+----------------------------------------+ | \'1\' | 2^nd^ offset index provided by higher | | | layers | +----------------------------+----------------------------------------+
# 10 UE procedure for receiving control information
If the UE is configured with a SCG, the UE shall apply the procedures
described in this clause for both MCG and SCG except for PDCCH monitoring in
Type0/0A/2/2A -PDCCH CSS sets where the UE is not required to apply the
procedures in this clause for the SCG
\- When the procedures are applied for MCG, the terms \'secondary cell\',
\'secondary cells\' , \'serving cell\', \'serving cells\' in this clause refer
to secondary cell, secondary cells, serving cell, serving cells belonging to
the MCG respectively.
\- When the procedures are applied for SCG, the terms \'secondary cell\',
\'secondary cells\', \'serving cell\', \'serving cells\' in this clause refer
to secondary cell, secondary cells (not including PSCell), serving cell,
serving cells belonging to the SCG respectively. The term \'primary cell\' in
this clause refers to the PSCell of the SCG.
A UE monitors a set of PDCCH candidates in one or more CORESETs on the active
DL BWP on each activated serving cell configured with PDCCH monitoring
according to corresponding search space sets where monitoring implies
receiving each PDCCH candidate and decoding according to the monitored DCI
formats.
In the remaining of this clause, when a PDCCH reception by a UE includes two
PDCCH candidates from corresponding search space sets, as described in clause
10.1
\- a PDCCH monitoring occasion is the union of the PDCCH monitoring occasions
for the two PDCCH candidates
\- the start of the PDCCH reception is the start of the earlier PDCCH
candidate
\- the end of the PDCCH reception is the end of the PDCCH candidate that ends
later
The PDCCH reception includes the two PDCCH candidates also when the UE is not
required to monitor one of the two PDCCH candidates as described in clauses 10
_(except clause 10.4)_ , 11.1, 11.1.1 and 17.2.
If a UE is provided _monitoringCapabilityConfig_ for a serving cell, the UE
obtains an indication to monitor PDCCH on the active DL BWP of the serving
cell for a maximum number of PDCCH candidates and non-overlapping CCEs
\- per slot, as in Tables 10.1-2 and 10.1-3, if _monitoringCapabilityConfig_ =
_r15monitoringcapability_ , or
\- per span, as in Tables 10.1-2A and 10.1-3A, if _monitoringCapabilityConfig_
= _r16monitoringcapability, or_
\- per group of $X_{s}$ slots according to combination $\left( X_{s},Y_{s}
\right)$, as in Tables 10.1-2B and 10.1-3B, if _monitoringCapabilityConfig_ =
_r17monitoringcapability_
The remaining of this clause, including clause 10.1, considers that a UE is
provided _monitoringCapabilityConfig for a serving cell_. If the UE is not
provided _monitoringCapabilityConfig for the serving cell, corresponding
statements that the UE is provided monitoringCapabilityConfig for the serving
cell are substituted as follows_
\- _for SCS configuration_ $\mu \in \left{ 0,\ 1,\ 2,\ 3 \right}$, the UE
monitors PDCCH on the active DL BWP of the serving cell for maximum numbers of
PDCCH candidates and non-overlapping CCEs per slot as in Tables 10.1-2 and
10.1-3.
\- for _SCS configuration_ $\mu \in \left{ 5,\ 6 \right}$, the UE monitors
PDCCH on the active DL BWP of the serving cell for maximum numbers of PDCCH
candidates and non-overlapping CCEs per group of $X_{s}$ slots according to
combination $\left( X_{s},Y_{s} \right) = (4,\ 1)$ for $\mu = 5$ and $\left(
X_{s},Y_{s} \right) = (8,\ 1)$ for $\mu = 6$ as in Tables 10.1-2B and 10.1-3B.
The UE does not expect to monitor PDCCH with SCS configuration $\mu = 6$
before the UE is provided dedicated higher layer parameters.
A UE can indicate a capability to monitor PDCCH according to one or more of
the combinations $\left( X,Y \right)$ = (2, 2), (4, 3), and (7, 3) per SCS
configuration of $\mu = 0$ and $\mu = 1$. A span is a number of consecutive
symbols in a slot where the UE is configured to monitor PDCCH. Each PDCCH
monitoring occasion is within one span. If a UE monitors PDCCH on a cell
according to combination $\left( X,Y \right)$, the UE supports PDCCH
monitoring occasions in any symbol of a slot with minimum time separation of
$X$ symbols between the first symbol of two consecutive spans, including
across slots. A span starts at a first symbol where a PDCCH monitoring
occasion starts and ends at a last symbol where a PDCCH monitoring occasion
ends, where the number of symbols of the span is up to $Y$.
If a UE indicates a capability to monitor PDCCH according to multiple $\left(
X,Y \right)$ combinations and a configuration of search space sets to the UE
for PDCCH monitoring on a cell results to a separation of every two
consecutive PDCCH monitoring spans that is equal to or larger than the value
of $X$ for more than one of the multiple combinations $\left( X,Y \right)$,
the UE monitors PDCCH on the cell according to the combination $\left( X,Y
\right)$, from the more than one combinations $\left( X,Y \right)$, that is
associated with the largest maximum number of $M_{\text{PDCCH}}^{max,\left(
X,Y \right),\mu}$ and $C_{\text{PDCCH}}^{max,\left( X,Y \right),\mu}$ defined
in Table 10.1-2A and Table 10.1-3A. The UE expects to monitor PDCCH according
to the same combination $\left( X,Y \right)$ in every slot on the active DL
BWP of a cell.
For SCS configuration $\mu = 5$ or $\mu = 6$, a UE can indicate a capability
to monitor PDCCH according to one or more combinations $\left( X_{s},Y_{s}
\right)$, where $X_{s}$ and $Y_{s}$ are numbers of consecutive slots. Groups
of $X_{s}$ slots are consecutive and non-overlapping and the $Y_{s}$ slots are
within the $X_{s}$ slots. The first group of $X_{s}$ slots starts from the
beginning of a subframe. The start of two consecutive groups of $Y_{s}$ slots
is separated by $X_{s}$ slots.
If a UE monitors PDCCH on a cell according to combination $\left( X_{s},Y_{s}
\right)$, the UE can monitor PDCCH for Type1-PDCCH CSS set provided by
dedicated higher layer signalling, Type3-PDCCH CSS sets, and USS sets in any
slot of the $Y_{s}$ slots, and the UE can monitor PDCCH for Type0/0A/2-PDCCH
CSS set and Type1-PDCCH CSS set provided in _SIB1_ in any slot of the $X_{s}$
slots. The UE determines the number of monitored PDCCH candidates and the
number of non-overlapped CCEs for combination $\left( X_{s},Y_{s} \right)$
based on all search space sets within the $X_{s}$ slots, as applicable
according to the search space set configurations, and maximum corresponding
values are provided in Table 10.1-2B and Table 10.1-3B, respectively.
For $\mu = 6$, if the UE indicates a capability to monitor PDCCH according to
multiple combinations $\left( X_{s},Y_{s} \right)$ and a configuration of
search space sets to the UE for PDCCH monitoring on a serving cell results to
a separation of every two consecutive groups of $Y_{s}$ slots that is not
smaller than $X_{s}$ for more than one combinations $\left( X_{s},Y_{s}
\right)$, of the multiple combinations $\left( X_{s},Y_{s} \right)$, the UE
monitors PDCCH on the cell according to the combination $\left( X_{s},Y_{s}
\right)$, from the more than one combinations $\left( X_{s},Y_{s} \right)$,
that is associated with the largest maximum number of
$M_{\text{PDCCH}}^{max,X_{s},\mu}$ and $C_{\text{PDCCH}}^{max,X_{s},\mu}$
defined in Table 10.1-2B and Table 10.1-3B.
A UE capability for PDCCH monitoring per slot, or per group of $X_{s}$ slots
according to combination $\left( X_{s},Y_{s} \right)$, or per span on an
active DL BWP of a serving cell is defined by a maximum number of PDCCH
candidates and non-overlapped CCEs the UE can monitor per slot, or per group
of $X_{s}$ slots according to combination $\left( X_{s},Y_{s} \right)$, or per
span, respectively, on the active DL BWP of the serving cell.
For monitoring of a PDCCH candidate by a UE, if the UE
\- has received _ssb-PositionsInBurst_ in _SIB1_ and has not received _ssb-
PositionsInBurst_ in _ServingCellConfigCommon_ for a serving cell, and
\- does not monitor PDCCH candidates in a Type0-PDCCH CSS set, and
\- at least one RE for a PDCCH candidate overlaps with at least one RE of a
candidate SS/PBCH block corresponding to a SS/PBCH block index provided by
_ssb-PositionsInBurst_ in _SIB1_ ,
the UE is not required to monitor the PDCCH candidate.
For monitoring of a PDCCH candidate by a UE, if the UE
\- has received _ssb-PositionsInBurst_ in _ServingCellConfigCommon_ for a
serving cell, and
\- does not monitor PDCCH candidates in a Type0-PDCCH CSS set, and
\- at least one RE for a PDCCH candidate overlaps with at least one RE of a
candidate SS/PBCH block corresponding to a SS/PBCH block index provided by
_ssb-PositionsInBurst_ in _ServingCellConfigCommon_ ,
the UE is not required to monitor the PDCCH candidate.
For monitoring of a PDCCH candidate by a UE, if the UE
\- has received _ssb-PositionsInBurst_ in _SSB-MTCAdditionalPCI_ for a serving
cell, and
\- at least one RE for a PDCCH candidate overlaps with at least one RE of a
candidate SS/PBCH block corresponding to a SS/PBCH block index provided by
_ssb-PositionsInBurst_ in _SSB-MTCAdditionalPCI_ with same physical cell
identity as the one associated with a RS having same quasi-collocation
properties as a CORESET for the PDCCH candidate,
the UE is not required to monitor the PDCCH candidate.
A UE is not required to monitor PDCCH candidates for a Type0/0A/0B/1/1A /2/2A
-PDCCH CSS set when the active TCI state for a corresponding CORESET is not
associated with _physCellId_ in _ServingCellConfigCommon_.
If a UE monitors the PDCCH candidate for a Type0-PDCCH CSS set on the serving
cell according to the procedure described in clause 13, the UE may assume that
no SS/PBCH block is transmitted in REs used for monitoring the PDCCH candidate
on the serving cell.
If _at least one RE of a PDCCH candidate for a UE on the serving cell overlaps
with at least one RE of lte-CRS-ToMatchAround_ , _or_ of _LTE-CRS-PatternList_
, _the UE is not required to monitor the PDCCH candidate_.
If a UE is provided _availableRB-SetsPerCell,_ the UE is not required to
monitor PDCCH candidates that overlap with any RB from RB sets that are
indicated as unavailable for receptions by an available RB set indicator field
in DCI format 2_0 as described in clause 11.1.1. If the UE does not obtain the
available RB set indicator for a symbol, the UE monitors PDCCH candidates on
all RB sets in the symbol.
If a UE can support
\- a first set of $N_{\text{cells,0}}^{\text{DL}}$ serving cells where the UE
is either not provided _coresetPoolIndex_ or is provided _coresetPoolIndex_
with a single value for all CORESETs on all DL BWPs of each scheduling cell
from the first set of serving cells, and
\- a second set of $N_{\text{cells,1}}^{\text{DL}}$ serving cells where the UE
is not provided _coresetPoolIndex_ or is provided _coresetPoolIndex_ with a
value 0 for a first CORESET, and with a value 1 for a second CORESET on any DL
BWP of each scheduling cell from the second set of serving cells
the UE determines, for the purpose of reporting _pdcch-BlindDetectionCA_ ,
_pdcch-BlindDetectionCA1_ , _and pdcch-BlindDetectionCA3_ , a number of
serving cells as $N_{\text{cells,0}}^{\text{DL}} + R \cdot
N_{\text{cells,1}}^{\text{DL}}$ where $R$ is a value reported by the UE.
If a UE indicates in _UE-NR-Capability_ a carrier aggregation capability
larger than 4 serving cells and the UE is not provided
_monitoringCapabilityConfig_ for any downlink cell or if the UE is provided
_monitoringCapabilityConfig_ = _r15monitoringcapability_ for all downlink
cells where the UE monitors PDCCH, the UE includes in _UE-NR-Capability_ an
indication for a maximum number of PDCCH candidates and for a maximum number
of non-overlapped CCEs the UE can monitor per slot when the UE is configured
for carrier aggregation operation over more than 4 cells. When a UE is not
configured for NR-DC operation, the UE determines a capability to monitor a
maximum number of PDCCH candidates and a maximum number of non-overlapped CCEs
per slot that corresponds to $N_{\text{cells}}^{\text{cap}}$ downlink cells,
where
\- $N_{\text{cells}}^{\text{cap}}$ is $N_{\text{cells,0}}^{\text{DL}} + R
\cdot N_{\text{cells,1}}^{\text{DL}}$ if the UE does not provide _pdcch-
BlindDetectionCA_ where $N_{\text{cells,0}}^{\text{DL}} +
N_{\text{cells,1}}^{\text{DL}}$ is the number of configured downlink serving
cells
\- otherwise, $N_{\text{cells}}^{\text{cap}}$ is the value of _pdcch-
BlindDetectionCA_
When a UE is configured for NR-DC operation, the UE determines a capability to
monitor a maximum number of PDCCH candidates and a maximum number of non-
overlapped CCEs per slot that corresponds to $N_{\text{cells}}^{\text{cap}} =
N_{\text{cells}}^{\text{MCG}}$ downlink cells for the MCG where
$N_{\text{cells}}^{\text{MCG}}$ is provided by _pdcch-BlindDetection_ for the
MCG and determines a capability to monitor a maximum number of PDCCH
candidates and a maximum number of non-overlapped CCEs per slot that
corresponds to $N_{\text{cells}}^{\text{cap}} = N_{\text{cells}}^{\text{SCG}}$
downlink cells for the SCG where $N_{\text{cells}}^{\text{SCG}}$ is provided
by _pdcch-BlindDetection_ for the SCG. When the UE is configured for carrier
aggregation operation over more than 4 cells, or for a cell group when the UE
is configured for NR-DC operation, the UE does not expect to monitor per slot
a number of PDCCH candidates or a number of non-overlapped CCEs that is larger
than the maximum number as derived from the corresponding value of
$N_{\text{cells}}^{\text{cap}}$.
When a UE is configured for NR-DC operation with a total of $N_{NR -
DC}^{DL,cells}$ downlink cells on both the MCG and the SCG, the UE expects to
be provided _pdcch-BlindDetection_ for the MCG and _pdcch-BlindDetection_ for
the SCG with values that satisfy
\- _pdcch-BlindDetection_ for the MCG + _pdcch-BlindDetection_ for the SCG \= pdcch-
BlindDetectionCA._
_Otherwise,_ if $N_{NR - DC,max}^{DL,cells}$ is a maximum total number of
downlink cells that the UE can be configured on both the MCG and the SCG for
NR-DC as indicated in _UE-NR-Capability_ ,
\- the value range of _pdcch-BlindDetectionMCG-UE_ or of _pdcch-
BlindDetectionSCG-UE_ is [1, 2, 3], and
_\- pdcch-BlindDetectionMCG-UE_ \+ _pdcch-BlindDetectionSCG-UE >=_ $N_{NR -
DC,max}^{DL,cells}$.
If a UE indicates in _UE-NR-Capability_ a carrier aggregation capability
larger than two downlink cells, the UE includes in _UE-NR-Capability_ an
indication for a maximum number of PDCCH candidates and a maximum number of
non-overlapped CCEs that the UE can monitor per span when the UE is configured
for carrier aggregation operation over more than two downlink cells with
_monitoringCapabilityConfig_ = _r16monitoringcapability_. When a UE is not
configured for NR-DC operation and the UE is provided
_monitoringCapabilityConfig_ = _r16monitoringcapability_ for all downlink
cells where the UE monitors PDCCH, the UE determines a capability to monitor a
maximum number of PDCCH candidates and a maximum number of non-overlapped CCEs
per span that corresponds to $N_{\text{cells}}^{\text{cap} - r16}$ downlink
cells, where
\- $N_{\text{cells}}^{\text{cap} - r16}$ is the number of configured downlink
cells if the UE does not provide _pdcch-MonitoringCA_
\- otherwise, $N_{\text{cells}}^{\text{cap} - r16}$ is the value of _pdcch-
MonitoringCA_
When a UE is configured for NR-DC operation and the UE is provided
_monitoringCapabilityConfig_ = _r16monitoringcapability_ for all downlink
cells where the UE monitors PDCCH, the UE determines a capability to monitor a
maximum number of PDCCH candidates and a maximum number of non-overlapped CCEs
per span that corresponds to
\- $N_{\text{cells}}^{cap - r16} = \ N_{cells,\ r16}^{\text{MCG}}$ downlink
cells for the MCG where $N_{cells,\ r16}^{\text{MCG}}$ is provided by _pdcch-
BlindDetection2_ for the MCG, and
\- $N_{\text{cells}}^{cap - r16} = \ N_{cells,\ r16}^{\text{SCG}}$ downlink
cells for the SCG where $N_{cells,\ r16}^{\text{SCG}}$ is provided by _pdcch-
BlindDetection2_ for the SCG
When the UE is configured for carrier aggregation operation over more than 2
cells, or for a cell group when the UE is configured for NR-DC operation, the
UE does not expect to monitor per span a number of PDCCH candidates or a
number of non-overlapped CCEs that is larger than the maximum number as
derived from the corresponding value of $N_{\text{cells}}^{cap - r16}$.
When a UE is configured for NR-DC operation with a total of $N_{NR -
DC}^{DL,cells}$ downlink cells on both the MCG and the SCG and the UE is
provided _monitoringCapabilityConfig_ = _r16monitoringcapability_ for all
downlink cells where the UE monitors PDCCH, the UE expects to be provided
_pdcch-BlindDetection2_ for the MCG and _pdcch-BlindDetection2_ for the SCG
with values that satisfy
\- _pdcch-BlindDetection2_ for the MCG + _pdcch-BlindDetection2_ for the SCG
\=
pdcch-MonitoringCA._
_Otherwise,_ if $N_{NR - DC,\ \ max,\ r16}^{DL,cells}$ is a maximum total
number of downlink cells for which the UE is provided
_monitoringCapabilityConfig_ = _r16monitoringcapability_ and the UE is
configured on both the MCG and the SCG for NR-DC as indicated in _UE-NR-
Capability_
\- the value of _pdcch-BlindDetectionMCG-UE-r16_ or of _pdcch-
BlindDetectionSCG-UE-r16_ is 1,
_\- pdcch-BlindDetectionMCG-UE-r16_ \+ _pdcch-BlindDetectionSCG-UE-r16 >=_
$N_{NR - DC,\ \ max,\ r16}^{DL,cells}$.
If a UE indicates in _UE-NR-Capability_ a carrier aggregation capability
larger than four downlink cells, the UE includes in _UE-NR-Capability_ an
indication for a maximum number of PDCCH candidates and a maximum number of
non-overlapped CCEs that the UE can monitor per group of $X_{s}$ slots when
the UE is configured for carrier aggregation operation over more than four
downlink cells _for which the UE is provided monitoringCapabilityConfig_ =
_r17monitoringcapability_. When a UE is not configured for NR-DC operation for
all downlink cells where the UE monitors PDCCH, the UE determines a capability
to monitor a maximum number of PDCCH candidates and a maximum number of non-
overlapped CCEs per group of $X_{s}$ slots that corresponds to
$N_{\text{cells}}^{cap - r17}$ downlink cells, where
\- $N_{\text{cells}}^{cap - r17}$ is $N_{\text{cells,0}}^{\text{DL}} + R \cdot
N_{\text{cells,1}}^{\text{DL}}$if the UE does not provide _pdcch-
MonitoringCA-r17 where_ $N_{\text{cells,0}}^{\text{DL}} +
N_{\text{cells,1}}^{\text{DL}}$ is the number of configured downlink serving
cells
\- otherwise, $N_{\text{cells}}^{cap - r17}$ is the value of _pdcch-
MonitoringCA-r17_
When the UE is configured for carrier aggregation operation over more than 4
cells, the UE does not expect to monitor per group of $X_{s}$ slots a number
of PDCCH candidates or a number of non-overlapped CCEs that is larger than the
maximum number as derived from the corresponding value of
$N_{\text{cells}}^{cap - r17}$.
When a UE is configured for NR-DC operation and the UE is provided
_monitoringCapabilityConfig_ = _r17monitoringcapability_ for all downlink
cells where the UE monitors PDCCH, the UE determines a capability to monitor a
maximum number of PDCCH candidates and a maximum number of non-overlapped CCEs
per group of $X_{s}$ slots that corresponds to
\- $N_{\text{cells}}^{cap - r17} = \ N_{cells,\ r17}^{\text{MCG}}$ downlink
cells for the MCG where $N_{cells,\ r17}^{\text{MCG}}$ is provided by _pdcch-
BlindDetection4_ for the MCG, and
\- $N_{\text{cells}}^{cap - r17} = \ N_{cells,\ r17}^{\text{SCG}}$ downlink
cells for the SCG where $N_{cells,\ r17}^{\text{SCG}}$ is provided by _pdcch-
BlindDetection4_ for the SCG
When a UE is configured for NR-DC operation with a total of $N_{NR -
DC}^{DL,cells}$ downlink cells on both the MCG and the SCG and the UE is
provided _monitoringCapabilityConfig_ = _r17monitoringcapability_ for all
downlink cells where the UE monitors PDCCH, the UE expects to be provided
_pdcch-BlindDetection4_ for the MCG and _pdcch-BlindDetection4_ for the SCG
with values that satisfy
\- _pdcch-BlindDetection4_ for the MCG + _pdcch-BlindDetection4_ for the SCG
\=
pdcch-MonitoringCA-r17._
_Otherwise,_ if $N_{NR - DC,\ \ max,\ r17}^{DL,cells}$ is a maximum total
number of downlink cells for which the UE is provided
_monitoringCapabilityConfig_ = _r17monitoringcapability_ and the UE is
configured on both the MCG and the SCG for NR-DC as indicated in _UE-NR-
Capability_
\- the value range of _pdcch-BlindDetectionMCG-UE-r17_ or of _pdcch-
BlindDetectionSCG-UE-r17_ is [1, 2, 3], and
_\- pdcch-BlindDetectionMCG-UE-r17_ \+ _pdcch-BlindDetectionSCG-UE-r17 >=_
$N_{NR - DC,\ \ max,\ r17}^{DL,cells}$.
If a UE indicates in _UE-NR-Capability_ a carrier aggregation capability
larger than one downlink cell with _monitoringCapabilityConfig_ =
_r15monitoringcapability_ or larger than one downlink cell with
_monitoringCapabilityConfig_ = _r16monitoringcapability_ , the UE includes in
_UE-NR-Capability_ an indication for a maximum number of PDCCH candidates and
a maximum number of non-overlapped CCEs the UE can monitor for downlink cells
with _monitoringCapabilityConfig_ = _r15monitoringcapability_ or for downlink
cells with _monitoringCapabilityConfig_ = _r16monitoringcapability_ when the
UE is configured for carrier aggregation operation over more than two downlink
cells with at least one downlink cell with _monitoringCapabilityConfig_ =
_r15monitoringcapability_ and at least one downlink cell with
_monitoringCapabilityConfig_ = _r16monitoringcapability_. When a UE is not
configured for NR-DC operation, the UE determines a capability to monitor a
maximum number of PDCCH candidates and a maximum number of non-overlapped CCEs
per slot or per span that corresponds to $N_{cells,r15}^{\text{cap} - r16}$
downlink cells or to $N_{cells,r16}^{\text{cap} - r16}$ downlink cells,
respectively, where
\- $N_{cells,r15}^{\text{cap} - r16}$ is the number of configured downlink
cells if the UE does not provide _pdcch-BlindDetectionCA1_
\- otherwise,
\- if the UE reports only one combination of (_pdcch-BlindDetectionCA1_ ,
_pdcch-BlindDetectionCA2_), $N_{\text{cells},r15}^{\text{cap} - r16}$ is the
value of _pdcch-BlindDetectionCA1_
\- else, $N_{cells,r15}^{\text{cap} - r16}$ is the value of _pdcch-
BlindDetectionCA1_ from a combination of (_pdcch-BlindDetectionCA1, pdcch-
BlindDetectionCA2_) that is provided by _pdcch-BlindDetectionCA-CombIndicator_
and
\- $N_{cells,r16}^{\text{cap} - r16}$ is the number of configured downlink
cells if the UE does not provide _pdcch-BlindDetectionCA2_
\- otherwise,
\- if the UE reports only one combination of (_pdcch-BlindDetectionCA1, pdcch-
BlindDetectionCA2_), $N_{cells,r16}^{\text{cap} - r16}$ is the value of
_pdcch-BlindDetectionCA2_
\- else, $N_{cells,r16}^{\text{cap} - r16}$ is the value of _pdcch-
BlindDetectionCA2_ from a combination of (_pdcch-BlindDetectionCA1, pdcch-
BlindDetectionCA2_) that is provided by _pdcch-BlindDetectionCA-CombIndicator_
If a UE indicates in _UE-NR-Capability_ a carrier aggregation capability
larger than one downlink cell with _monitoringCapabilityConfig_ =
_r15monitoringcapability_ or larger than one downlink cell with
_monitoringCapabilityConfig_ = _r17monitoringcapability_ , the UE includes in
_UE-NR-Capability_ an indication for a maximum number of PDCCH candidates and
a maximum number of non-overlapped CCEs the UE can monitor for downlink cells
with _monitoringCapabilityConfig_ = _r15monitoringcapability_ or for downlink
cells with _monitoringCapabilityConfig_ = _r17monitoringcapability_ when the
UE is configured for carrier aggregation operation over more than two downlink
cells with at least one downlink cell with _monitoringCapabilityConfig_ =
_r15monitoringcapability_ and at least one downlink cell with
_monitoringCapabilityConfig_ = _r17monitoringcapability_. When a UE is not
configured for NR-DC operation, the UE determines a capability to monitor a
maximum number of PDCCH candidates and a maximum number of non-overlapped CCEs
per slot or per group of $X_{s}$ slots that corresponds to
$N_{cells,r15/r17}^{\text{cap} - r17}$ downlink cells or to
$N_{cells,r17/r15}^{\text{cap} - r17}$ downlink cells, respectively, where
\- $N_{cells,r15/r17}^{\text{cap} - r17}$ is $N_{\text{cells,0}}^{\text{DL}} +
R \cdot N_{\text{cells,1}}^{\text{DL}}$ if the UE does not provide _pdcch-
BlindDetectionCA1_ in _pdcch-BlindDetectionMixedList1, where_
$N_{\text{cells,0}}^{\text{DL}} + N_{\text{cells,1}}^{\text{DL}}$ is the
number of configured downlink serving cells
\- otherwise,
\- if the UE reports only one combination of (_pdcch-BlindDetectionCA1_ ,
_pdcch-BlindDetectionCA2_) in _pdcch-BlindDetectionMixedList1_ ,
$N_{cells,r15/r17}^{\text{cap} - r17}$ is the value of _pdcch-
BlindDetectionCA1_
\- else, $N_{cells,r15/r17}^{\text{cap} - r17}$ is the value of _pdcch-
BlindDetectionCA1_ from a combination of (_pdcch-BlindDetectionCA1, pdcch-
BlindDetectionCA3_) that is provided by _pdcch-BlindDetectionCA-
CombIndicator-r17_
and
\- $N_{cells,r17/r15}^{\text{cap} - r17}$ is $N_{\text{cells,0}}^{\text{DL}} +
R \cdot N_{\text{cells,1}}^{\text{DL}}$ if the UE does not provide _pdcch-
BlindDetectionCA2_ in _pdcch-BlindDetectionMixedList1, where_
$N_{\text{cells,0}}^{\text{DL}} + N_{\text{cells,1}}^{\text{DL}}$ is the
number of configured downlink serving cells
\- otherwise,
\- if the UE reports only one combination of (_pdcch-BlindDetectionCA1, pdcch-
BlindDetectionCA2_) in _pdcch-BlindDetectionMixedList1_ ,
$N_{cells,r17/r15}^{\text{cap} - r17}$ is the value of _pdcch-
BlindDetectionCA2_
\- else, $N_{cells,r17/r15}^{\text{cap} - r17}$ is the value of _pdcch-
BlindDetectionCA3_ from a combination of (_pdcch-BlindDetectionCA1, pdcch-
BlindDetectionCA3_) that is provided by _pdcch-BlindDetectionCA-
CombIndicator-r17_
If a UE indicates in _UE-NR-Capability_ a carrier aggregation capability
larger than one downlink cell with _monitoringCapabilityConfig_ =
_r16monitoringcapability_ or larger than one downlink cell with
_monitoringCapabilityConfig_ = _r17monitoringcapability_ , the UE includes in
_UE-NR-Capability_ an indication for a maximum number of PDCCH candidates and
a maximum number of non-overlapped CCEs the UE can monitor for downlink cells
with _monitoringCapabilityConfig_ = _r16monitoringcapability_ or for downlink
cells with _monitoringCapabilityConfig_ = _r17monitoringcapability_ when the
UE is configured for carrier aggregation operation over more than two downlink
cells with at least one downlink cell with _monitoringCapabilityConfig_ =
_r16monitoringcapability_ and with at least one downlink cell with
_monitoringCapabilityConfig_ = _r17monitoringcapability_. When a UE is not
configured for NR-DC operation, the UE determines a capability to monitor a
maximum number of PDCCH candidates and a maximum number of non-overlapped CCEs
per span or per group of $X_{s}$ slots that corresponds to
$N_{cells,r16/r17}^{\text{cap} - r17}$ downlink cells or to
$N_{cells,r17/r16}^{\text{cap} - r17}$ downlink cells, respectively, where
\- $N_{cells,r16/r17}^{\text{cap} - r17}$ is the number of configured downlink
cells if the UE does not provide _pdcch-BlindDetectionCA1_ in _pdcch-
BlindDetectionMixedList2_
\- otherwise,
\- if the UE reports only one combination of (_pdcch-BlindDetectionCA1_ ,
_pdcch-BlindDetectionCA2_) in _pdcch-BlindDetectionMixedList2_ ,
$N_{cells,r16/r17}^{\text{cap} - r17}$ is the value of _pdcch-
BlindDetectionCA1_
\- else, $N_{cells,r16/r17}^{\text{cap} - r17}$ is the value of _pdcch-
BlindDetectionCA2_ from a combination of (_pdcch-BlindDetectionCA2, pdcch-
BlindDetectionCA3_) that is provided by _pdcch-BlindDetectionCA-
CombIndicator-r17_
and
\- $N_{cells,r17/r16}^{\text{cap} - r17}$ is the number of configured downlink
cells if the UE does not provide _pdcch-BlindDetectionCA2_ in _pdcch-
BlindDetectionMixedList2_
\- otherwise,
\- if the UE reports only one combination of (_pdcch-BlindDetectionCA1, pdcch-
BlindDetectionCA2_) in _pdcch-BlindDetectionMixedList2_ ,
$N_{cells,r17/r16}^{\text{cap} - r17}$ is the value of _pdcch-
BlindDetectionCA2_
\- else, $N_{cells,r17/r16}^{\text{cap} - r17}$ is the value of _pdcch-
BlindDetectionCA3_ from a combination of (_pdcch-BlindDetectionCA2, pdcch-
BlindDetectionCA3_) that is provided by _pdcch-BlindDetectionCA-
CombIndicator-r17_
If a UE indicates in _UE-NR-Capability_ a carrier aggregation capability
larger than one downlink cell with _monitoringCapabilityConfig_ =
_r15monitoringcapability_ , or larger than one downlink cell with
_monitoringCapabilityConfig_ = _r16monitoringcapability_ , or larger than one
downlink cell with _monitoringCapabilityConfig_ = _r17monitoringcapability_ ,
the UE includes in _UE-NR-Capability_ an indication for a maximum number of
PDCCH candidates and a maximum number of non-overlapped CCEs the UE can
monitor for downlink cells with _monitoringCapabilityConfig_ =
_r15monitoringcapability_ , or for downlink cells with
_monitoringCapabilityConfig_ = _r16monitoringcapability_ , or for downlink
cells with _monitoringCapabilityConfig_ = _r17monitoringcapability_ when the
UE is configured for carrier aggregation operation over more than three
downlink cells with at least one downlink cell with
_monitoringCapabilityConfig_ = _r15monitoringcapability_ , at least one
downlink cell with _monitoringCapabilityConfig_ = _r16monitoringcapability_
and at least one downlink cell with _monitoringCapabilityConfig_ =
_r17monitoringcapability_. When a UE is not configured for NR-DC operation,
the UE determines a capability to monitor a maximum number of PDCCH candidates
and a maximum number of non-overlapped CCEs per slot or per span or per group
of $X_{s}$ slots that corresponds to $N_{cells,r15/{ r16,r17}}^{\text{cap} -
r17}$ downlink cells or to $N_{cells,r16/{ r15,r17}}^{\text{cap} - r17}$
downlink cells or to $N_{cells,r17/{ r15,r16}}^{\text{cap} - r17}$ downlink
cells, respectively, where
\- $N_{cells,r15/{ r16,r17}}^{\text{cap} - r17}$ is the number of configured
downlink cells if the UE does not provide _pdcch-BlindDetectionCA1 in pdcch-
BlindDetectionMixedList3_
\- otherwise,
\- if the UE reports only one combination of (_pdcch-BlindDetectionCA1_ ,
_pdcch-BlindDetectionCA2_ , _pdcch-BlindDetectionCA3_) _in pdcch-
BlindDetectionMixedList3_ , $N_{cells,r15/{ r16,r17}}^{\text{cap} - r17}$ is
the value of _pdcch-BlindDetectionCA1_
\- else, $N_{cells,r15/{ r16,r17}}^{\text{cap} - r17}$ is the value of _pdcch-
BlindDetectionCA1_ from a combination of (_pdcch-BlindDetectionCA1_ , _pdcch-
BlindDetectionCA2, pdcch-BlindDetectionCA3_) that is provided by _pdcch-
BlindDetectionCA-CombIndicator-r17_
\- $N_{cells,r16/{ r15,r17}}^{\text{cap} - r17}$ is the number of configured
downlink cells if the UE does not provide _pdcch-BlindDetectionCA2 in pdcch-
BlindDetectionMixedList3_
\- otherwise,
\- if the UE reports only one combination of (_pdcch-BlindDetectionCA1_ ,
_pdcch-BlindDetectionCA2_ , _pdcch-BlindDetectionCA3_) _in pdcch-
BlindDetectionMixedList3_ , $N_{cells,r16/{ r15,r17}}^{\text{cap} - r17}$ is
the value of _pdcch-BlindDetectionCA2_
\- else, $N_{cells,r16/{ r15,r17}}^{\text{cap} - r17}$ is the value of _pdcch-
BlindDetectionCA2_ from a combination of (_pdcch-BlindDetectionCA1_ , _pdcch-
BlindDetectionCA2, pdcch-BlindDetectionCA3_) that is provided by _pdcch-
BlindDetectionCA-CombIndicator-r17_
and
\- $N_{cells,r17/{ r15,r16}}^{\text{cap} - r17}$ is the number of configured
downlink cells if the UE does not provide _pdcch-BlindDetectionCA3 in pdcch-
BlindDetectionMixedList3_
\- otherwise,
\- if the UE reports only one combination of (_pdcch-BlindDetectionCA1_ ,
_pdcch-BlindDetectionCA2, pdcch-BlindDetectionCA3_) _in pdcch-
BlindDetectionMixedList3_ , $N_{cells,r17/{ r15,r16}}^{\text{cap} - r17}$ is
the value of _pdcch-BlindDetectionCA3_
\- else, $N_{cells,r17/{ r15,r16}}^{\text{cap} - r17}$ is the value of _pdcch-
BlindDetectionCA3_ from a combination of (_pdcch-BlindDetectionCA1_ , _pdcch-
BlindDetectionCA2, pdcch-BlindDetectionCA3_) that is provided by _pdcch-
BlindDetectionCA-CombIndicator-r17_
When a UE is configured for NR-DC operation and is provided
_monitoringCapabilityConfig_ = _r15monitoringcapability_ for at least one
downlink cell and _monitoringCapabilityConfig_ = _r16monitoringcapability_ for
at least one downlink cell where the UE monitors PDCCH, the UE determines a
capability to monitor a maximum number of PDCCH candidates and a maximum
number of non-overlapped CCEs that corresponds to
\- $N_{cells,r15}^{cap - r16} = \ N_{cells,\ r15}^{\text{MCG}}$ downlink cells
for the MCG where $N_{cells,\ r15}^{\text{MCG}}$ is provided by _pdcch-
BlindDetection3_ for the MCG,
\- $N_{cells,r15}^{cap - r16} = \ N_{cells,\ r15}^{\text{SCG}}$ downlink cells
for the SCG where $N_{cells,\ r15}^{\text{SCG}}$ is provided by _pdcch-
BlindDetection3_ for the SCG, and
\- $N_{cells,r16}^{cap - r16} = \ N_{cells,\ r16}^{\text{MCG}}$ downlink cells
for the MCG where $N_{\text{cells},\ r16}^{\text{MCG}}$ is provided by _pdcch-
BlindDetection2_ for the MCG,
\- $N_{cells,r16}^{cap - r16} = \ N_{cells,\ r16}^{\text{SCG}}$ downlink cells
for the SCG where $N_{cells,\ r16}^{\text{SCG}}$ is provided by _pdcch-
BlindDetection2_ for the SCG
When a UE is configured for carrier aggregation operation over more than two
downlink cells with at least one downlink cell with
_monitoringCapabilityConfig_ = _r15monitoringcapability_ , at least one
downlink cell with _monitoringCapabilityConfig_ = _r16monitoringcapability_ ,
and no downlink cell has SCS configuration $\mu \in \left{ 5,\ 6 \right}$, or
for a cell group when the UE is configured for NR-DC operation, the UE does
not expect to
\- monitor per slot a number of PDCCH candidates or a number of non-overlapped
CCEs that is larger than the maximum number as derived from the corresponding
value of $N_{cells,r15}^{cap - r16}$, and
\- monitor per span a number of PDCCH candidates or a number of non-overlapped
CCEs that is larger than the maximum number as derived from the corresponding
value of $N_{cells,r16}^{cap - r16}$
When the UE is configured for carrier aggregation operation over more than two
downlink cells with at least one downlink cell with
_monitoringCapabilityConfig_ = _r15monitoringcapability_ , at least one
downlink cell with _monitoringCapabilityConfig_ = _r17monitoringcapability_ ,
and no downlink cell with _monitoringCapabilityConfig_ =
_r16monitoringcapability_ , the UE does not expect to
\- monitor per slot a number of PDCCH candidates or a number of non-overlapped
CCEs that is larger than the maximum number as derived from the corresponding
value of $N_{cells,r15/r17}^{\text{cap} - r17}$, and
\- monitor per group of $X_{s}$ slots a number of PDCCH candidates or a number
of non-overlapped CCEs that is larger than the maximum number as derived from
the corresponding value of $N_{cells,r17/r15}^{\text{cap} - r17}$
When the UE is configured for carrier aggregation operation over more than two
downlink cells with at least one downlink cell with
_monitoringCapabilityConfig_ = _r16monitoringcapability_ , at least one
downlink cell with _monitoringCapabilityConfig_ = _r17monitoringcapability_ ,
and no downlink cell with _monitoringCapabilityConfig_ =
_r15monitoringcapability_ , the UE does not expect to
\- monitor per span a number of PDCCH candidates or a number of non-overlapped
CCEs that is larger than the maximum number as derived from the corresponding
value of $N_{cells,r16/r17}^{\text{cap} - r17}$, and
\- monitor per group of $X_{s}$ slots a number of PDCCH candidates or a number
of non-overlapped CCEs that is larger than the maximum number as derived from
the corresponding value of $N_{cells,r17/r16}^{\text{cap} - r17}$
When the UE is configured for carrier aggregation operation over more than
three downlink cells with at least one downlink cell with
_monitoringCapabilityConfig_ = _r15monitoringcapability_ , at least one
downlink cell with _monitoringCapabilityConfig_ = _r16monitoringcapability_ ,
and at least one downlink cell with _monitoringCapabilityConfig_ =
_r17monitoringcapability_ , the UE does not expect to
\- monitor per slot a number of PDCCH candidates or a number of non-overlapped
CCEs that is larger than the maximum number as derived from the corresponding
value of $N_{cells,r15/{ r16,r17}}^{\text{cap} - r17}$, and
\- monitor per span a number of PDCCH candidates or a number of non-overlapped
CCEs that is larger than the maximum number as derived from the corresponding
value of $N_{cells,r16/{ r15,r17}}^{\text{cap} - r17}$, and
\- monitor per group of $X_{s}$ slots a number of PDCCH candidates or a number
of non-overlapped CCEs that is larger than the maximum number as derived from
the corresponding value of $N_{cells,r17/{ r15,r16}}^{\text{cap} - r17}$
When a UE is configured for NR-DC operation with a total of $N_{NR -
DC}^{DL,cells}$ downlink cells on both the MCG and the SCG and the UE is
provided _monitoringCapabilityConfig_ = _r15monitoringcapability_ for __
$N_{NR - DC,r15}^{DL,cells}$ downlink cells and _monitoringCapabilityConfig_ =
_r16monitoringcapability_ for $N_{NR - DC,r16}^{DL,cells}$ downlink cells
where the UE monitors PDCCH, the UE expects to be provided _pdcch-
BlindDetection3 and pdcch-BlindDetection2_ for the MCG, and _pdcch-
BlindDetection3 and pdcch-BlindDetection2_ for the SCG with values that
satisfy
\- _pdcch-BlindDetection3_ for the MCG + _pdcch-BlindDetection3_ for the SCG
\= pdcch-
BlindDetectionCA1._
_Otherwise,_ if $N_{NR - DC,\ \ max,\ r15}^{DL,cells}$ is a maximum total
number of downlink cells for which the UE is provided
_monitoringCapabilityConfig_ = _r15monitoringcapability_ and the UE is
configured on both the MCG and the SCG for NR-DC as indicated in _UE-NR-
Capability_
\- the value range of _pdcch-BlindDetectionMCG-UE1_ or of _pdcch-
BlindDetectionSCG-UE1_ is [0, 1, 2],
_\- pdcch-BlindDetectionMCG-UE1_ \+ _pdcch-BlindDetectionSCG-UE1 >=_ $N_{NR -
DC,\ \ max,\ r15}^{DL,cells}$.
If the UE reports _pdcch-BlindDetectionCA2_
\- the value range of _pdcch-BlindDetectionMCG-UE2_ or of _pdcch-
BlindDetectionSCG-UE2_ is [0, 1, ..., _pdcch-BlindDetectionCA2_], and
_\- pdcch-BlindDetectionMCG-UE2_ \+ _pdcch-BlindDetectionSCG-UE2 >= pdcch-
BlindDetectionCA2._
_Otherwise,_ if $N_{NR - DC,\ \ max,\ r16}^{DL,cells}$ is a maximum total
number of downlink cells for which the UE is provided
_monitoringCapabilityConfig_ = _r16monitoringcapability_ and the UE is
configured on both the MCG and the SCG for NR-DC as indicated in _UE-NR-
Capability_
\- the value range of _pdcch-BlindDetectionMCG-UE2_ or of _pdcch-
BlindDetectionSCG-UE2_ is [0, 1],
_\- pdcch-BlindDetectionMCG-UE2_ \+ _pdcch-BlindDetectionSCG-UE2 >=_ $N_{NR -
DC,\ \ max,\ r16}^{DL,cells}$.
When a UE is configured for NR-DC operation with a total of $N_{NR -
DC}^{DL,cells}$ downlink cells on both the MCG and the SCG and the UE is
provided _monitoringCapabilityConfig_ = _r15monitoringcapability_ for __
$N_{NR - DC,r15}^{DL,cells}$ downlink cells and _monitoringCapabilityConfig_ =
_r17monitoringcapability_ for $N_{NR - DC,r17}^{DL,cells}$ downlink cells
where the UE monitors PDCCH, the UE expects to be provided _pdcch-
BlindDetection3 and pdcch-BlindDetection4_ for the MCG, and _pdcch-
BlindDetection3 and pdcch-BlindDetection4_ for the SCG with values that
satisfy
\- _pdcch-BlindDetection3_ for the MCG + _pdcch-BlindDetection3_ for the SCG
\ = pdcch-BlindDetectionCA1._
_Otherwise,_ if $N_{NR - DC,\ \ max,\ r15}^{DL,cells}$ is a maximum total
number of downlink cells for which the UE is provided
_monitoringCapabilityConfig_ = _r15monitoringcapability_ and the UE is
configured on both the MCG and the SCG for NR-DC as indicated in _UE-NR-
Capability_
\- the value range of _pdcch-BlindDetectionCG-UE1_ for the MCG or of _pdcch-
BlindDetectionCG-UE1_ for the SCG is [0, 1, 2],
_\- pdcch-BlindDetectionCG-UE1_ for the MCG + _pdcch-BlindDetectionSCG-UE1_
for the SCG _> =_ $N_{NR - DC,\ \ max,\ r15}^{DL,cells}$.
If the UE reports _pdcch-BlindDetectionCA2 in pdcch-BlindDetectionMixedList1_
\- the value range of _pdcch-BlindDetectionCG-UE2_ for the MCG or of _pdcch-
BlindDetectionCG-UE2_ for the SCG is [0, 1, ..., _pdcch-BlindDetectionCA3_],
and
_\- pdcch-BlindDetectionCG-UE2_ for the MCG + _pdcch-BlindDetectionCG-UE2_ for
the SCG _> = pdcch-BlindDetectionCA2._
_Otherwise,_ if $N_{NR - DC,\ \ max,\ r17}^{DL,cells}$ is a maximum total
number of downlink cells for which the UE is provided
_monitoringCapabilityConfig_ = _r17monitoringcapability_ and the UE is
configured on both the MCG and the SCG for NR-DC as indicated in _UE-NR-
Capability_
\- the value range of _pdcch-BlindDetectionCG-UE2_ for the MCG or of _pdcch-
BlindDetectionCG-UE2_ for the SCG is [0, 1, 2],
_\- pdcch-BlindDetectionCG-UE2 for the MCG_ \+ _pdcch-BlindDetectionCG-UE2 for
the SCG >=_ $N_{NR - DC,\ \ max,\ r17}^{DL,cells}$.
When a UE is configured for NR-DC operation with a total of $N_{NR -
DC}^{DL,cells}$ downlink cells on both the MCG and the SCG and the UE is
provided _monitoringCapabilityConfig_ = _r16monitoringcapability_ for __
$N_{NR - DC,r16}^{DL,cells}$ downlink cells and _monitoringCapabilityConfig_ =
_r17monitoringcapability_ for $N_{NR - DC,r17}^{DL,cells}$ downlink cells
where the UE monitors PDCCH, the UE expects to be provided _pdcch-
BlindDetection2 and pdcch-BlindDetection4_ for the MCG, and _pdcch-
BlindDetection2 and pdcch-BlindDetection4_ for the SCG with values that
satisfy
\- _pdcch-BlindDetection2_ for the MCG + _pdcch-BlindDetection2_ for the SCG
\= pdcch-BlindDetectionCA1._
_Otherwise,_ if $N_{NR - DC,\ \ max,\ r16}^{DL,cells}$ is a maximum total
number of downlink cells for which the UE is provided
_monitoringCapabilityConfig_ = _r16monitoringcapability_ and the UE is
configured on both the MCG and the SCG for NR-DC as indicated in _UE-NR-
Capability_
\- the value range of _pdcch-BlindDetectionCG-UE1_ for the MCG or of _pdcch-
BlindDetectionCG-UE1_ for the SCG is [0, 1],
_\- pdcch-BlindDetectionCG-UE1_ for the MCG + _pdcch-BlindDetectionCG-UE1_ for
the SCG _> =_ $N_{NR - DC,\ \ max,\ r16}^{DL,cells}$.
If the UE reports _pdcch-BlindDetectionCA2 in pdcch-BlindDetectionMixedList2_
\- the value range of _pdcch-BlindDetectionCG-UE2_ for the MCG or of _pdcch-
BlindDetectionCG-UE2_ for the SCG is [0, 1, ..., _pdcch-BlindDetectionCA2_],
and
_\- pdcch-BlindDetectionCG-UE2_ for the MCG + _pdcch-BlindDetectionCG-UE2_ for
the SCG _> = pdcch-BlindDetectionCA2._
_Otherwise,_ if $N_{NR - DC,\ \ max,\ r17}^{DL,cells}$ is a maximum total
number of downlink cells for which the UE is provided
_monitoringCapabilityConfig_ = _r17monitoringcapability_ and the UE is
configured on both the MCG and the SCG for NR-DC as indicated in _UE-NR-
Capability_
\- the value range of _pdcch-BlindDetectionCG-UE2_ for the MCG or of _pdcch-
BlindDetectionCG-UE2_ for the SCG is [0, 1, 2],
_\- pdcch-BlindDetectionCG-UE2_ for the MCG + _pdcch-BlindDetectionCG-UE2_ for
the SCG _> =_ $N_{NR - DC,\ \ max,\ r17}^{DL,cells}$.
When a UE is configured for NR-DC operation with a total of $N_{NR -
DC}^{DL,cells}$ downlink cells on both the MCG and the SCG and the UE is
provided _monitoringCapabilityConfig_ = _r15monitoringcapability_ for __
$N_{NR - DC,r15}^{DL,cells}$ downlink cells, _monitoringCapabilityConfig_ =
_r16monitoringcapability_ for __ $N_{NR - DC,r16}^{DL,cells}$ downlink cells,
and _monitoringCapabilityConfig_ = _r17monitoringcapability_ for $N_{NR -
DC,r17}^{DL,cells}$ downlink cells where the UE monitors PDCCH, the UE expects
to be provided _pdcch-BlindDetection3_ , _pdcch-BlindDetection2_ , _and pdcch-
BlindDetection4_ for the MCG, and _pdcch-BlindDetection3_ , _pdcch-
BlindDetection2_ , _and pdcch-BlindDetection4_ for the SCG with values that
satisfy
\- _pdcch-BlindDetection3_ for the MCG + _pdcch-BlindDetection3_ for the SCG
\ = pdcch-BlindDetectionCA1._
_Otherwise,_ if $N_{NR - DC,\ \ max,\ r15}^{DL,cells}$ is a maximum total
number of downlink cells for which the UE is provided
_monitoringCapabilityConfig_ = _r15monitoringcapability_ and the UE is
configured on both the MCG and the SCG for NR-DC as indicated in _UE-NR-
Capability_
\- the value range of _pdcch-BlindDetectionCG-UE1_ for the MCG or of _pdcch-
BlindDetectionCG-UE1_ for the SCG is [0, 1, 2],
_\- pdcch-BlindDetectionCG-UE1_ for the MCG + _pdcch-BlindDetectionCG-UE1_ for
the SCG _> =_ $N_{NR - DC,\ \ max,\ r15}^{DL,cells}$.
If the UE reports _pdcch-BlindDetectionCA2_ in _pdcch-
BlindDetectionMixedList3,_
\- the value range of _pdcch-BlindDetectionCG-UE2_ for the MCG or of _pdcch-
BlindDetectionCG-UE2_ for the SCG is [0, 1, ..., _pdcch-BlindDetectionCA2_],
and
_\- pdcch-BlindDetectionCG-UE2_ for the MCG + _pdcch-BlindDetectionCG-UE2_ for
the SCG _> = pdcch-BlindDetectionCA2._
_Otherwise,_ if $N_{NR - DC,\ \ max,\ r16}^{DL,cells}$ is a maximum total
number of downlink cells for which the UE is provided
_monitoringCapabilityConfig_ = _r16monitoringcapability_ and the UE is
configured on both the MCG and the SCG for NR-DC as indicated in _UE-NR-
Capability_
\- the value range of _pdcch-BlindDetectionCG-UE2_ for the MCG or of _pdcch-
BlindDetectionCG-UE2_ for the SCG is [0, 1],
_\- pdcch-BlindDetectionCG-UE2_ for the MCG + _pdcch-BlindDetectionCG-UE2_ for
the SCG _> =_ $N_{NR - DC,\ \ max,\ r16}^{DL,cells}$.
If the UE reports _pdcch-BlindDetectionCA3_ in _pdcch-
BlindDetectionMixedList3_
\- the value range of _pdcch-BlindDetectionCG-UE3_ for the MCG or of _pdcch-
BlindDetectionCG-UE3_ for the SCG is [0, 1, ..., _pdcch-BlindDetectionCA3_],
and
_\- pdcch-BlindDetectionCG-UE3_ for the MCG + _pdcch-BlindDetectionCG-UE3_ for
the SCG _> = pdcch-BlindDetectionCA3._
_Otherwise,_ if $N_{NR - DC,\ \ max,\ r17}^{DL,cells}$ is a maximum total
number of downlink cells for which the UE is provided
_monitoringCapabilityConfig_ = _r17monitoringcapability_ and the UE is
configured on both the MCG and the SCG for NR-DC as indicated in _UE-NR-
Capability_
\- the value range of _pdcch-BlindDetectionCG-UE3_ for the MCG or of _pdcch-
BlindDetectionCG-UE3_ for the SCG is [0, 1, 2],
_\- pdcch-BlindDetectionCG-UE3_ for the MCG + _pdcch-BlindDetectionCG-UE3_ for
the SCG _> =_ $N_{NR - DC,\ \ max,\ r17}^{DL,cells}$.
## 10.1 UE procedure for determining physical downlink control channel
assignment
A set of PDCCH candidates for a UE to monitor is defined in terms of PDCCH
search space sets. A search space set can be a CSS set or a USS set. A UE
monitors PDCCH candidates in one or more of the following search spaces sets
\- a Type0-PDCCH CSS set on the primary cell of the MCG configured by
\- _pdcch-ConfigSIB1_ in MIB or by _searchSpaceSIB1 in PDCCH-ConfigCommon_ or
by _searchSpaceZero_ _in PDCCH-ConfigCommon_ for a DCI format 1_0 with CRC
scrambled by a SI-RNTI, or
\- _searchSpaceZero_ by providing _searchSpaceID_ =0 for _searchSpaceMCCH_ or
_searchSpaceMTCH_ for a DCI format 4_0 with CRC scrambled by a MCCH-RNTI or a
G-RNTI for broadcast
\- a Type0A-PDCCH CSS set configured by _searchSpaceOtherSystemInformation_
_in PDCCH-ConfigCommon_ for a DCI format 1_0 with CRC scrambled by a SI-RNTI
on the primary cell of the MCG
\- a Type0B-PDCCH CSS set configured by _searchSpaceMCCH and searchSpaceMTCH
for_ a DCI format 4_0 with CRC scrambled by a MCCH-RNTI or a G-RNTI for
broadcast, on the primary cell of the MCG
\- a Type1-PDCCH CSS set configured by _ra-SearchSpace_ _in PDCCH-
ConfigCommon_ for a DCI format with CRC scrambled by a RA-RNTI, a MsgB-RNTI,
or a TC-RNTI on the primary cell
\- a Type1A-PDCCH CSS set configured by _sdt-SearchSpace_ _in PDCCH-
ConfigCommon_ for a DCI format with CRC scrambled by a C-RNTI or a CS-RNTI on
the primary cell as described in clause 19.1
\- a Type2-PDCCH CSS set configured by _pagingSearchSpace_ _in PDCCH-
ConfigCommon_ for a DCI format 1_0 with CRC scrambled by a P-RNTI on the
primary cell of the MCG
\- a Type2A-PDCCH CSS set configured by _pei-SearchSpace_ _in pei-ConfigBWP_
for a DCI format 2_7 with CRC scrambled by a PEI-RNTI on the primary cell of
the MCG
\- a Type3-PDCCH CSS set configured by
\- _SearchSpace_ in _PDCCH-Config_ with _searchSpaceType_ = _common_ for DCI
formats with CRC scrambled by INT-RNTI, SFI-RNTI, TPC-PUSCH-RNTI, TPC-PUCCH-
RNTI, TPC-SRS-RNTI, or CI-RNTI and, only for the primary cell, C-RNTI, MCS-C-
RNTI, CS-RNTI(s), or PS-RNTI, or
\- _SearchSpace_ in _pdcch-ConfigMulticast_ for DCI formats with CRC scrambled
by G-RNTI, or G-CS-RNTI, or
\- _searchSpaceMCCH and searchSpaceMTCH on a secondary cell for_ a DCI format
4_0 with CRC scrambled by a MCCH-RNTI or a G-RNTI for broadcast, and
\- a USS set configured by
\- _SearchSpace_ in _PDCCH-Config_ with _searchSpaceType_ = _ue-Specific_ for
DCI formats with CRC scrambled by C-RNTI, MCS-C-RNTI, SP-CSI-RNTI, CS-RNTI(s),
SL-RNTI, SL-CS-RNTI, or SL Semi-Persistent Scheduling V-RNTI
In the following, DCI formats with CRC scrambled by C-RNTI or CS-RNTI or MCS-
C-RNTI are also referred to as unicast DCI formats, DCI formats with CRC
scrambled by G-RNTI for multicast or G-CS-RNTI are also referred to as
multicast DCI formats, and DCI formats with CRC scrambled by MCCH-RNTI or
G-RNTI for broadcast scheduling PDSCH receptions are also referred to as
broadcast DCI formats.
For a DL BWP, if a UE is not provided _searchSpaceSIB1_ for Type0-PDCCH CSS
set by _PDCCH-ConfigCommon_ , the UE does not monitor PDCCH candidates for a
Type0-PDCCH CSS set on the DL BWP. The Type0-PDCCH CSS set is defined by the
CCE aggregation levels and the number of PDCCH candidates per CCE aggregation
level given in Table 10.1-1.
If the active DL BWP and the initial DL BWP for a UE have same SCS and same CP
length and the active DL BWP includes all RBs of the CORESET with index 0, or
the active DL BWP is the initial DL BWP, or the active DL BWP includes all RBs
of an MBS frequency resource provided by _cfr-ConfigMCCH-MTCH_ as described in
clause 18, the CORESET configured for Type0-PDCCH CSS set has CORESET index 0
and the Type0-PDCCH CSS set has search space set index 0.
If the active DL BWP and an MBS frequency resource provided by _cfr-
ConfigMCCH-MTCH_ or determined by CORESET with index 0 when _cfr-ConfigMCCH-
MTCH_ is not provided for a UE have same SCS and same CP length and the active
DL BWP includes all RBs of the MBS frequency resource, and if the UE is
provided _searchSpaceMCCH_ or _searchSpaceMTCH_ for Type0B-PDCCH CSS set on
the primary cell or for Type3-PDCCH CSS set on a secondary cell, the UE
monitors PDCCH for detection of broadcast DCI formats, as described in clause
18, on the active DL BWP.
For a DL BWP, if a UE is not provided _searchSpaceOtherSystemInformation_ for
Type0A-PDCCH CSS set, the UE does not monitor PDCCH for Type0A-PDCCH CSS set
on the DL BWP. The CCE aggregation levels and the number of PDCCH candidates
per CCE aggregation level for Type0A-PDCCH CSS set are given in Table 10.1-1.
For a DL BWP, if a UE is not provided _ra-SearchSpace_ for Type1-PDCCH CSS
set, the UE does not monitor PDCCH for Type1-PDCCH CSS set on the DL BWP _._
If the UE has not been provided a Type3-PDCCH CSS set, or a Type1A-PDCCH CSS
set, or a USS set and the UE has received a C-RNTI and has been provided a
Type1-PDCCH CSS set, the UE monitors PDCCH candidates for DCI format 0_0 and
DCI format 1_0 with CRC scrambled by the C-RNTI in the Type1-PDCCH CSS set.
If a UE is not provided _pagingSearchSpace_ for Type2-PDCCH CSS set, the UE
does not monitor PDCCH for Type2-PDCCH CSS set on the DL BWP. The CCE
aggregation levels and the number of PDCCH candidates per CCE aggregation
level for Type2-PDCCH CSS set are given in Table 10.1-1.
If a UE is not provided _pei-SearchSpace_ for Type2A-PDCCH CSS set, the UE
does not monitor PDCCH for Type2A-PDCCH CSS set on the DL BWP. The CCE
aggregation levels and the maximum number of PDCCH candidates per CCE
aggregation level for Type2A-PDCCH CSS set are given in Table 10.1-1. If the
UE is provided _pei-SearchSpace_ with zero value for the Type2A-PDCCH CSS set
index, and for the SS/PBCH block and CORESET multiplexing patterns 2 and 3,
the UE determines PDCCH monitoring occasions as described in clause 13 and the
CCE aggregation levels and the number of PDCCH candidates per CCE aggregation
level for Type2A-PDCCH CSS set are given in Table 10.1-1.
If a UE is provided a zero value for _searchSpaceID in PDCCH-ConfigCommon_
_for_ a Type0/0A/2-PDCCH CSS set, or is provided a zero value for
_searchSpaceMCCH_ or _searchSpaceMTCH_ , the UE determines monitoring
occasions for PDCCH candidates of the Type0/0A/2-PDCCH CSS set as described in
clause 13, and the UE is provided a C-RNTI, the UE monitors PDCCH candidates
only at monitoring occasions associated with a SS/PBCH block, where the
SS/PBCH block is determined by the most recent of
\- a MAC CE activation command indicating a TCI state of the active BWP that
includes a CORESET with index 0, as described in [6, TS 38.214], where the
TCI-state includes a CSI-RS which is quasi-co-located with the SS/PBCH block,
or
\- a random access procedure that is not initiated by a PDCCH order that
triggers a contention-free random access procedure
If a UE monitors PDCCH candidates for DCI formats with CRC scrambled by a
C-RNTI and the UE is provided a non-zero value for _searchSpaceID in PDCCH-
ConfigCommon_ _for_ a Type0/0A/2-PDCCH CSS set, or monitors PDCCH candidates
for DCI formats with CRC scrambled by a MCCH-RNTI or a G-RNTI for broadcast
and the UE is provided a non-zero value for _searchSpaceMCCH_ and
_searchSpaceMTCH in PDCCH-ConfigCommon_ for a Type0/0B-PDCCH CSS set _,_ the
UE determines monitoring occasions for PDCCH candidates of the
Type0/0A/2-PDCCH CSS set, or of the Type0/0B-PDCCH set, respectively, based on
the search space set associated with the value of _searchSpaceID_.
The UE may assume that the DM-RS antenna port associated with PDCCH receptions
in the CORESET configured by _pdcch-ConfigSIB1_ in _MIB, the DM-RS antenna
port associated with_ corresponding PDSCH receptions, and the corresponding
SS/PBCH block are quasi co-located with respect to average gain, quasi co-
location \'typeA\' and \'typeD\' properties, when applicable [6, TS 38.214],
if the UE is not provided a TCI state indicating quasi co-location information
of the DM-RS antenna port for PDCCH reception in the CORESET. The value for
the DM-RS scrambling sequence initialization is the cell ID. For operation
without shared spectrum channel access in FR1 and FR2-1, a SCS is provided by
_subCarrierSpacingCommon_ in _MIB_. For operation with shared spectrum channel
access in FR1 and for operation in FR2-2, a SCS is same as the SCS of a
corresponding SS/PBCH block.
For single cell operation or for operation with carrier aggregation in a same
frequency band, a UE does not expect to monitor a PDCCH in a
Type0/0A/0B/2/3-PDCCH CSS set or in a USS set if a DM-RS for monitoring a
PDCCH in a Type1-PDCCH CSS set is not configured with same _qcl-Type_ set to
\'typeD\' properties [6, TS 38.214] with a DM-RS for monitoring the PDCCH in
the Type0/0A/0B/2/3-PDCCH CSS set or in the USS set, and if the PDCCH or an
associated PDSCH overlaps in at least one symbol with a PDCCH the UE monitors
in a Type1-PDCCH CSS set or with an associated PDSCH.
If a UE is provided
\- one or more search space sets by corresponding one or more of
_searchSpaceZero, searchSpaceSIB1, searchSpaceOtherSystemInformation_ ,
_pagingSearchSpace_ , _ra-SearchSpace_ , and
\- a C-RNTI, an MCS-C-RNTI, or a CS-RNTI
the UE monitors PDCCH candidates for DCI format 0_0 and DCI format 1_0 with
CRC scrambled by the C-RNTI, the MCS-C-RNTI, or the CS-RNTI in the one or more
search space sets in a slot where the UE monitors PDCCH candidates for at
least a DCI format 0_0 or a DCI format 1_0 with CRC scrambled by SI-RNTI, RA-
RNTI, MsgB-RNTI, or P-RNTI.
If a UE is provided
\- one or more search space sets by corresponding one or more of
_searchSpaceZero, searchSpaceSIB1, searchSpaceOtherSystemInformation_ ,
_pagingSearchSpace_ , _pei-SearchSpace, ra-SearchSpace_ , or a CSS set by
_PDCCH-Config_ , and
\- a SI-RNTI, a P-RNTI, a PEI-RNTI, a RA-RNTI, a MsgB-RNTI, a SFI-RNTI, an
INT-RNTI, a TPC-PUSCH-RNTI, a TPC-PUCCH-RNTI, or a TPC-SRS-RNTI
then, for a RNTI from any of these RNTIs, the UE does not expect to process
information from more than one DCI format with CRC scrambled with the RNTI per
slot.
Table 10.1-1: CCE aggregation levels and maximum number of PDCCH candidates
per CCE aggregation level for CSS sets configured by _searchSpaceSIB1_
* * *
CCE Aggregation Level Number of Candidates 4 4 8 2 16 1
* * *
For each DL BWP configured to a UE in a serving cell, the UE can be provided
by higher layer signalling with
\- $P \leq 3$ CORESETs if _coresetPoolIndex_ is not provided, or if a value of
_coresetPoolIndex_ is same for all CORESETs if _coresetPoolIndex_ is provided
\- $P \leq 5$ CORESETs if _coresetPoolIndex_ is not provided for a first
CORESET, or is provided and has a value 0 for a first CORESET, and is provided
and has a value 1 for a second CORESET
For each CORESET, the UE is provided the following by _ControlResourceSet_ :
\- a CORESET index $p$, by _controlResourceSetId or by
controlResourceSetId-v1610_ , where
\- $0  N_{\text{cells}}^{\text{cap}}$,
and
\- a DL BWP of an activated cell is the active DL BWP of the activated cell,
and a DL BWP of a deactivated cell is the DL BWP with index provided by
_firstActiveDownlinkBWP-Id_ for the deactivated cell,
the UE is not required to monitor more than
$M_{\text{PDCCH}}^{\text{total,slot,}\mu} = \left\lfloor
N_{\text{cells}}^{\text{cap}} \cdot M_{\text{PDCCH}}^{\text{max,slot,}\mu}
\cdot \frac{\left( N_{\text{cells,0}}^{\text{DL,}\mu} + \gamma \bullet
N_{\text{cells,1}}^{\text{DL,}\mu} \right)}{\sum_{j = 0}^{3}\left(
N_{\text{cells,0}}^{\text{DL,}j} + \gamma \bullet
N_{\text{cells,1}}^{\text{DL,}j} \right)} \right\rfloor$ PDCCH candidates or
more than $C_{\text{PDCCH}}^{\text{total,slot,}\mu} = \left\lfloor
N_{\text{cells}}^{\text{cap}} \cdot C_{\text{PDCCH}}^{\text{max,slot,}\mu}
\cdot \frac{\left( N_{\text{cells,0}}^{\text{DL,}\mu} + \gamma \bullet
N_{\text{cells,1}}^{\text{DL,}\mu} \right)}{\sum_{j = 0}^{3}\left(
N_{\text{cells,0}}^{\text{DL,}j} + \gamma \bullet
N_{\text{cells,1}}^{\text{DL,}j} \right)} \right\rfloor$ non-overlapped CCEs
per slot on the active DL BWP(s) of scheduling cell(s) from the
$N_{\text{cells,0}}^{\text{DL,}\mu} + N_{\text{cells,1}}^{\text{DL,}\mu}$
downlink cells. $N_{\text{cells}}^{\text{cap}}$ is replaced by
$N_{\text{cells,r15}}^{\text{cap-r16}}\ $_if a UE is configured with downlink
cells for which the UE is provided both monitoringCapabilityConfig_ =
_r15monitoringcapability and monitoringCapabilityConfig_ =
_r16monitoringcapability_. $N_{\text{cells}}^{\text{cap}}$ is replaced by
$N_{\text{cells,\ r15}\text{/r17}}^{\text{cap-r1}\text{7}}$, _if a UE is
configured with downlink cells for which the UE is provided both
monitoringCapabilityConfig_ = _r15monitoringcapability and
monitoringCapabilityConfig_ = _r17monitoringcapability._ $\
N_{\text{cells}}^{\text{cap}}$ is replaced by $N_{\text{cells,\ r15}\text{/\
{}\text{r16}\text{,\ r17}\ }}^{\text{cap-r1}\text{7}}$.I _f a UE is configured
with downlink cells for which the UE is provided monitoringCapabilityConfig_ =
_r15monitoringcapability and monitoringCapabilityConfig_ =
_r16monitoringcapability and monitoringCapabilityConfig_ =
_r17monitoringcapability._
For each scheduled cell from the $N_{\text{cells,0}}^{\text{DL,}\mu}$ downlink
cells, the UE is not required to monitor on the active DL BWP with SCS
configuration $\mu$ of the scheduling cell more than $\min\left(
M_{\text{PDCCH}}^{\text{max,slot,}\mu},M_{\text{PDCCH}}^{\text{total,slot,}\mu}
\right)$ PDCCH candidates or more than $\min\left(
C_{\text{PDCCH}}^{\text{max,slot,}\mu},C_{\text{PDCCH}}^{\text{total,slot,}\mu}
\right)$ non-overlapped CCEs per slot.
For each scheduled cell from the $N_{\text{cells,1}}^{\text{DL,}\mu}$ downlink
cells, the UE is not required to monitor on the active DL BWP with SCS
configuration $\mu$ of the scheduling cell
\- more than $\min\left( {\gamma \bullet
M}_{\text{PDCCH}}^{\text{max,slot,}\mu},M_{\text{PDCCH}}^{\text{total,slot,}\mu}
\right)$ PDCCH candidates or more than $\min\left( {\gamma \bullet
C}_{\text{PDCCH}}^{\text{max,slot,}\mu},C_{\text{PDCCH}}^{\text{total,slot,}\mu}
\right)$ non-overlapped CCEs per slot
\- more than $\min\left(
M_{\text{PDCCH}}^{\text{max,slot,}\mu},M_{\text{PDCCH}}^{\text{total,slot,}\mu}
\right)$ PDCCH candidates or more than $\min\left(
C_{\text{PDCCH}}^{\text{max,slot,}\mu},C_{\text{PDCCH}}^{\text{total,slot,}\mu}
\right)$ non-overlapped CCEs per slot for CORESETs with same
_coresetPoolIndex_ value
If a UE is configured with $N_{cells,r16}^{DL,\mu}$ downlink cells _for which
the UE is provided monitoringCapabilityConfig_ = _r16monitoringcapability and_
with associated PDCCH candidates monitored in the active DL BWPs of the
scheduling cells using SCS configuration $\mu$_, and with_
$N_{cells,r16}^{DL,(X,Y),\mu}$ _of the_ $N_{cells,r16}^{DL,\mu}$ _downlink
cells using combination_ $\left( X,Y \right)$ _for PDCCH monitoring, where_
$\sum_{\mu = 0}^{1}N_{cells,r16}^{DL,\mu} \leq
N_{\text{cells}}^{\text{cap-r16}}$, the UE is not required to monitor, on the
active DL BWP of the scheduling cell, more than
$M_{\text{PDCCH}}^{\text{total,(X,Y),}\mu} =
M_{\text{PDCCH}}^{\text{max,(X,Y),}\mu}$ PDCCH candidates or more than
$C_{\text{PDCCH}}^{\text{total,(X,Y),}\mu} =
C_{\text{PDCCH}}^{\text{max,(X,Y),}\mu}$ non-overlapped CCEs per span for each
scheduled cell when the scheduling cell is from the
$N_{cells,r16}^{DL,(X,Y),\mu}$ downlink cells. _If a UE is configured with
downlink cells for which the UE is provided both monitoringCapabilityConfig_ =
_r15monitoringcapability and monitoringCapabilityConfig_ =
_r16monitoringcapability,_ $N_{\text{cells}}^{\text{cap-r16}}$ is replaced by
$N_{\text{cells,r16}}^{\text{cap-r16}}$. _If a UE is configured with downlink
cells for which the UE is provided both monitoringCapabilityConfig_ =
_r16monitoringcapability and monitoringCapabilityConfig_ =
_r17monitoringcapability,_ $\ N_{\text{cells}}^{\text{cap}}$ is replaced by
$N_{\text{cells,\ r16}\text{/r17}}^{\text{cap-r1}\text{7}}$_._ $\ $_If a UE is
configured with downlink cells for which the UE is provided
monitoringCapabilityConfig_ = _r15monitoringcapability and
monitoringCapabilityConfig_ = _r16monitoringcapability and
monitoringCapabilityConfig_ = _r17monitoringcapability,_ $\
N_{\text{cells}}^{\text{cap}}$ is replaced by $N_{\text{cells,\ r16}\text{/\
{}\text{r15}\text{,\ r17}\ }}^{\text{cap-r1}\text{7}}$_._
_If a UE is configured only with_ $N_{cells,r16}^{DL,\mu}$ _downlink cells for
which the UE is provided monitoringCapabilityConfig_ =
_r16monitoringcapability and_ with associated PDCCH candidates monitored in
the active DL BWPs of the scheduling cells using SCS configuration $\mu$_, and
with_ $N_{cells,r16}^{DL,(X,Y),\mu}$ _of the_ $N_{cells,r16}^{DL,\mu}$
_downlink cells using combination_ $\left( X,Y \right)$ _for PDCCH monitoring,
where_ $\sum_{\mu = 0}^{1}N_{cells,r16}^{DL,\mu} >
N_{\text{cells}}^{\text{cap-r16}}$, a DL BWP of an activated cell is the
active DL BWP of the activated cell, and a DL BWP of a deactivated cell is the
DL BWP with index provided by _firstActiveDownlinkBWP-Id_ for the deactivated
cell, _the UE is not required to monitor more than_
$M_{\text{PDCCH}}^{\text{total,(X,Y),}\mu} = \left\lfloor
N_{\text{cells}}^{\text{cap-r16}} \cdot
M_{\text{PDCCH}}^{\text{max,(X,Y),}\mu} \cdot
\frac{N_{cells,r16}^{DL,(X,Y),\mu}}{\sum_{j = 0}^{1}N_{cells,r16}^{DL,j}}
\right\rfloor$ PDCCH candidates or more than
$C_{\text{PDCCH}}^{\text{total,(X,Y),}\mu} = \left\lfloor
N_{\text{cells}}^{\text{cap-r16}} \cdot
C_{\text{PDCCH}}^{\text{max,(X,Y),}\mu} \cdot
\frac{N_{cells,r16}^{DL,(X,Y),\mu}}{\sum_{j = 0}^{1}N_{cells,r16}^{DL,j}}
\right\rfloor$ non-overlapped CCEs
\- per set of spans on the active DL BWP(s) of all scheduling cell(s) from the
$N_{cells,r16}^{DL,(X,Y),\mu}$ downlink cells within every $X$ symbols, if the
union of PDCCH monitoring occasions on all scheduling cells from the
$N_{cells,r16}^{DL,(X,Y),\mu}$ downlink cells results to PDCCH monitoring
according to the combination $\left( X,Y \right)$ and any pair of spans in the
set is within $Y$ symbols, where first $X$ symbols start at a first symbol
with a PDCCH monitoring occasion and next $X$ symbols start at a first symbol
with a PDCCH monitoring occasion that is not included in the first $X$ symbols
\- per set of spans across the active DL BWP(s) of all scheduling cells from
the $N_{cells,r16}^{DL,(X,Y),\mu}$ downlink cells, with at most one span per
scheduling cell for each set of spans, otherwise
where $N_{cells,r16}^{DL,j}$ _is a number of configured cells with_ associated
PDCCH candidates monitored in the active DL BWPs of the scheduling cells using
_SCS configuration_ $j$. _If a UE is configured with downlink cells for which
the UE is provided both monitoringCapabilityConfig_ = _r15monitoringcapability
and monitoringCapabilityConfig_ = _r16monitoringcapability,_
$N_{\text{cells}}^{\text{cap-r16}}$ is replaced by
$N_{\text{cells,r16}}^{\text{cap-r16}}$. _If a UE is configured with downlink
cells for which the UE is provided both monitoringCapabilityConfig_ =
_r16monitoringcapability and monitoringCapabilityConfig_ =
_r17monitoringcapability,_ $\ N_{\text{cells}}^{\text{cap}}$ is replaced by
$N_{\text{cells,\ r16}\text{/r17}}^{\text{cap-r1}\text{7}}$_._ $\ $I _f a UE
is configured with downlink cells for which the UE is provided
monitoringCapabilityConfig_ = _r15monitoringcapability and
monitoringCapabilityConfig_ = _r16monitoringcapability and
monitoringCapabilityConfig_ = _r17monitoringcapability,_ $\
N_{\text{cells}}^{\text{cap}}$ is replaced by $N_{\text{cells,\ r16}\text{/\
{}\text{r15}\text{,\ r17}\ }}^{\text{cap-r1}\text{7}}$_._
For each scheduled cell from the $N_{cells,r16}^{DL,(X,Y),\mu}$ downlink cells
using combination $\left( X,Y \right)$, the UE is not required to monitor on
the active DL BWP with SCS configuration $\mu$ of the scheduling cell, more
than $\min\left(
M_{\text{PDCCH}}^{max,(X,Y),\mu},M_{\text{PDCCH}}^{total,(X,Y),\mu} \right)$
PDCCH candidates or more than $\min\left(
C_{\text{PDCCH}}^{max,(X,Y),\mu},C_{\text{PDCCH}}^{total,(X,Y),\mu} \right)$
non-overlapped CCEs per span.
A UE does not expect to be configured CSS sets, except for CSS sets provided
by _searchSpaceMCCH_ , _searchSpaceMTCH_ or by _SearchSpace_ in _pdcch-
ConfigMulticast_ for DCI formats with CRC scrambled by G-RNTI or G-CS-RNTI,
that result to corresponding total, or per scheduled cell, numbers of
monitored PDCCH candidates and non-overlapped CCEs per slot, per group of
$X_{s}$ slots for a corresponding combination $\left( X_{s},Y_{s} \right)$, or
per span that exceed the corresponding maximum numbers per slot, or per group
of $X_{s}$ slots for a corresponding combination $\left( X_{s},Y_{s} \right)$,
or per span, respectively.
For same cell scheduling or for cross-carrier scheduling, a UE does not expect
a number of PDCCH candidates, and a number of corresponding non-overlapped
CCEs per slot, or per group of $X_{s}$ slots for a corresponding combination
$\left( X_{s},Y_{s} \right)$, or per span, on a secondary cell to be larger
than the corresponding numbers that the UE is capable of monitoring on the
secondary cell per slot, or per group of $X_{s}$ slots for a corresponding
combination $\left( X_{s},Y_{s} \right)$, or per span, respectively. If a UE
is provided _monitoringCapabilityConfig_ = _r16monitoringcapability_ for the
primary cell, except the first span of each slot, the UE does not expect a
number of PDCCH candidates and a number of corresponding non-overlapped CCEs
per span on the primary cell to be larger than the corresponding numbers that
the UE is capable of monitoring on the primary cell per span.
If a UE is configured with $N_{\text{cells,r17,0}}^{\text{DL,}\mu} +
N_{\text{cells,r17,1}}^{\text{DL,}\mu}$ downlink cells f _or which the UE is
provided monitoringCapabilityConfig_ = _r17monitoringcapability and_ with
associated PDCCH candidates monitored in the active DL BWPs of the scheduling
cells using SCS configuration $\mu$_, and with_
$N_{\text{cells,r17,0}}^{\text{DL,}X_{s},\mu} +
N_{\text{cells,r17,1}}^{\text{DL,}X_{s},\mu}$ _of the_
$N_{\text{cells,r17,0}}^{\text{DL,}\mu} +
N_{\text{cells,r17,1}}^{\text{DL,}\mu}$ _downlink cells using any combination_
$\left( X_{s},Y_{s} \right)$ for a group of $X_{s}$ slots _for PDCCH
monitoring, where_ $\sum_{\mu = 5}^{6}\left(
N_{\text{cells,r17,0}}^{\text{DL},\mu} + {\gamma \bullet
N}_{\text{cells,r17,1}}^{\text{DL},\mu} \right) \leq
N_{\text{cells}}^{\text{cap-r17}}$, the UE is not required to monitor, on the
active DL BWP of the scheduling cell,
\- more than $M_{\text{PDCCH}}^{\text{total,}X_{s}\text{,}\mu} =
M_{\text{PDCCH}}^{\text{max,}X_{s}\text{,}\mu}$ PDCCH candidates or more than
$C_{\text{PDCCH}}^{\text{total,}X_{s}\text{,}\mu} =
C_{\text{PDCCH}}^{\text{max,}X_{s}\text{,}\mu}$ non-overlapped CCEs per group
of $X_{s}$ slots for each scheduled cell when the scheduling cell is from the
$N_{cells,r17,0}^{DL,X_{s},\mu}$ downlink cells, or
\- more than $M_{\text{PDCCH}}^{\text{total,}X_{s}\text{,}\mu} = {\gamma
\bullet M}_{\text{PDCCH}}^{\text{max,}X_{s}\text{,}\mu}$ PDCCH candidates or
more than $C_{\text{PDCCH}}^{\text{total,}X_{s}\text{,}\mu} = {\gamma \bullet
C}_{\text{PDCCH}}^{\text{max,}X_{s}\text{,}\mu}$ non-overlapped CCEs per group
of $X_{s}$ slots for each scheduled cell when the scheduling cell is from the
$N_{cells,r17,1}^{DL,X_{s},\mu}$ downlink cells, or
\- more than $M_{\text{PDCCH}}^{\text{max,}X_{s}\text{,}\mu}$ PDCCH candidates
or more than $C_{\text{PDCCH}}^{\text{max,}X_{s}\text{,}\mu}$ non-overlapped
CCEs per group of $X_{s}$ slots for CORESETs with same _coresetPoolIndex_ for
each scheduled cell when the scheduling cell is from the
$N_{cells,r17,1}^{DL,X_{s},\mu}$ downlink cells
_If the UE is configured with downlink cells for which the UE is provided
monitoringCapabilityConfig_ = _r15monitoringcapability and downlink cells for
which the UE is provided monitoringCapabilityConfig_ =
_r17monitoringcapability_ for the active DL BWPs _,_
$N_{\text{cells}}^{\text{cap-r17}}$ is replaced by
$N_{\text{cells,r17/r15}}^{\text{cap-r17}}$. _If the UE is configured with
downlink cells for which the UE is provided monitoringCapabilityConfig_ =
_r16monitoringcapability and downlink cells for which the UE is provided
monitoringCapabilityConfig_ = _r17monitoringcapability_ for the active DL BWPs
_,_ $N_{\text{cells}}^{\text{cap-r17}}$ is replaced by
$N_{\text{cells,r17/r16}}^{\text{cap-r17}}$. _If the UE is configured with
downlink cells for which the UE is provided monitoringCapabilityConfig_ =
_r15monitoringcapability and downlink cells for which the UE is provided
monitoringCapabilityConfig_ = _r16monitoringcapability and downlink cells for
which the UE is provided monitoringCapabilityConfig_ =
_r17monitoringcapability_ for the active DL BWPs _,_
$N_{\text{cells}}^{\text{cap-r17}}$ is replaced by
$N_{\text{cells,r17/{r15,r16}}}^{\text{cap-r17}}$. If, for one or more of the
cells, the UE is provided with _monitoringCapabilityConfig_ =
_r16monitoringcapability,_ $\gamma = 1$.
_If a UE is configured_ $N_{\text{cells,r17,0}}^{\text{DL,}\mu} +
N_{\text{cells,r17,1}}^{\text{DL,}\mu}$ _downlink cells_ for which the UE is
provided _monitoringCapabilityConfig_ = _r17monitoringcapability_ _and_ with
associated PDCCH candidates monitored in the active DL BWPs of the scheduling
cells using SCS configuration $\mu$_, and with_
$N_{\text{cells,r17,0}}^{\text{DL,}X_{s},\mu} +
N_{\text{cells,r17,1}}^{\text{DL,}X_{s},\mu}$ _of the_
$N_{\text{cells,r17,0}}^{\text{DL,}\mu} +
N_{\text{cells,r17,1}}^{\text{DL,}\mu}$ _downlink cells using any combination_
$\left( X_{s},Y_{s} \right)$ for a group of $X_{s}$ slots _for PDCCH
monitoring, where_ $\sum_{\mu = 5}^{6}\left(
N_{\text{cells,r17,0}}^{\text{DL},\mu} + {\gamma \bullet
N}_{\text{cells,r17,1}}^{\text{DL},\mu} \right) >
N_{\text{cells}}^{\text{cap-r17}}$, a DL BWP of an activated cell is the
active DL BWP of the activated cell, and a DL BWP of a deactivated cell is the
DL BWP with index provided by _firstActiveDownlinkBWP-Id_ for the deactivated
cell, _the UE is not required to monitor more than_
$M_{\text{PDCCH}}^{total,X_{s},\mu} = \left\lfloor
N_{\text{cells}}^{\text{cap-r17}} \cdot M_{\text{PDCCH}}^{max,X_{s},\mu} \cdot
\frac{\left( N_{\text{cells,r17,0}}^{\text{DL,}X_{s},\mu} + {\gamma \bullet
N}_{\text{cells,r17,1}}^{\text{DL,}X_{s},\mu} \right)}{\sum_{j = 5}^{6}\left(
N_{\text{cells,r17,0}}^{\text{DL},j} + {\gamma \bullet
N}_{\text{cells,r17,1}}^{\text{DL},j} \right)} \right\rfloor$ PDCCH
candidates, or more than $C_{\text{PDCCH}}^{total,X_{s},\mu} = \left\lfloor
N_{\text{cells}}^{\text{cap-r17}} \cdot C_{\text{PDCCH}}^{max,X_{s},\mu} \cdot
\frac{\left( N_{\text{cells,r17,0}}^{\text{DL,}X_{s},\mu} + {\gamma \bullet
N}_{\text{cells,r17,1}}^{\text{DL,}X_{s},\mu} \right)}{\sum_{j = 5}^{6}\left(
N_{\text{cells,r17,0}}^{\text{DL},j} + {\gamma \bullet
N}_{\text{cells,r17,1}}^{\text{DL},j} \right)} \right\rfloor$ non-overlapped
CCEs, per group of $X_{s}$ slots on the active DL BWP(s) of scheduling cell(s)
from the $N_{\text{cells,r17,0}}^{\text{DL,}X_{s},\mu} +
N_{\text{cells,r17,1}}^{\text{DL,}X_{s},\mu}$ downlink cells where
$N_{\text{cells,r17,0}}^{\text{DL},j} + N_{\text{cells,r17,1}}^{\text{DL},j}$
_is a number of configured cells with_ associated PDCCH candidates monitored
in the active DL BWPs of the scheduling cells using _SCS configuration_ $j$.
_If the UE is configured with downlink cells for which the UE is provided
monitoringCapabilityConfig_ = _r15monitoringcapability and downlink cells for
which the UE is provided monitoringCapabilityConfig_ =
_r17monitoringcapability_ for the active DL BWPs _,_
$N_{\text{cells}}^{\text{cap-r17}}$ is replaced by
$N_{\text{cells,r17/r15}}^{\text{cap-r17}}$. _If the UE is configured with
downlink cells for which the UE is provided monitoringCapabilityConfig_ =
_r16monitoringcapability and downlink cells for which the UE is provided
monitoringCapabilityConfig_ = _r17monitoringcapability_ for the active DL BWPs
_,_ $N_{\text{cells}}^{\text{cap-r17}}$ is replaced by
$N_{\text{cells,r17/r16}}^{\text{cap-r17}}$. _If the UE is configured with
downlink cells for which the UE is provided monitoringCapabilityConfig_ =
_r15monitoringcapability and downlink cells for which the UE is provided
monitoringCapabilityConfig_ = _r16monitoringcapability and downlink cells for
which the UE is provided monitoringCapabilityConfig_ =
_r17monitoringcapability_ for the active DL BWPs _,_
$N_{\text{cells}}^{\text{cap-r17}}$ is replaced by
$N_{\text{cells,r17/{r15,r16}}}^{\text{cap-r17}}$. If, for one or more of the
cells, the UE is provided with _monitoringCapabilityConfig_ =
_r16monitoringcapability,_ $\gamma = 1$.
For each scheduled cell from the $N_{cells,r17,0}^{DL,X_{s},\mu}$ downlink
cells using any combination $\left( X_{s},Y_{s} \right)$ for a group of
$X_{s}$ slots, the UE is not required to monitor on the active DL BWP with SCS
configuration $\mu$ of the scheduling cell, more than $\min\left(
M_{\text{PDCCH}}^{max,X_{s},\mu},M_{\text{PDCCH}}^{total,X_{s},\mu} \right)$
PDCCH candidates or more than $\min\left(
C_{\text{PDCCH}}^{max,X_{s},\mu},C_{\text{PDCCH}}^{total,X_{s},\mu} \right)$
non-overlapped CCEs per group of $X_{s}$ slots.
For each scheduled cell from the $N_{cells,r17,1}^{DL,X_{s},\mu}$ downlink
cells using any combination $\left( X_{s},Y_{s} \right)$ for a group of
$X_{s}$ slots, the UE is not required to monitor on the active DL BWP with SCS
configuration $\mu$ of the scheduling cell,
\- more than $\min\left( {\gamma \bullet
M}_{\text{PDCCH}}^{max,X_{s},\mu},M_{\text{PDCCH}}^{total,X_{s},\mu} \right)$
PDCCH candidates or more than $\min\left( {\gamma \bullet
C}_{\text{PDCCH}}^{max,X_{s},\mu},C_{\text{PDCCH}}^{total,X_{s},\mu} \right)$
non-overlapped CCEs per group of $X_{s}$ slots
\- more than $\min\left(
M_{\text{PDCCH}}^{max,X_{s},\mu},M_{\text{PDCCH}}^{total,X_{s},\mu} \right)$
PDCCH candidates or more than $\min\left(
C_{\text{PDCCH}}^{max,X_{s},\mu},C_{\text{PDCCH}}^{total,X_{s},\mu} \right)$
non-overlapped CCEs per group of $X_{s}$ slots for CORESETs with the same
_coresetPoolIndex_ value.
For cross-carrier scheduling, the number of PDCCH candidates for monitoring
and the number of non-overlapped CCEs per span or per slot or per group of
$X_{s}$ slots are separately counted for each scheduled cell.
The UE allocates PDCCH candidates for monitoring to USS sets for the primary
cell having an active DL BWP with SCS configuration $\mu$ in a slot if the UE
is not provided _monitoringCapabilityConfig_ for the primary cell or if the UE
is provided _monitoringCapabilityConfig_ = _r15monitoringcapability_ for the
primary cell, or in the first span of each slot if the UE is provided
_monitoringCapabilityConfig_ = _r16monitoringcapability_ for the primary cell,
or in a group of $X_{s}$ slots for a corresponding combination $\left(
X_{s},Y_{s} \right)$ if the UE is provided _monitoringCapabilityConfig_ =
_r17monitoringcapability_ for the primary cell, according to the following
pseudocode.
If for the USS sets for scheduling on the primary cell the UE is not provided
_coresetPoolIndex_ for first CORESETs, or is provided _coresetPoolIndex_ with
value 0 for first CORESETs, and is provided _coresetPoolIndex_ with value 1
for second CORESETs, and if $\min\left( {\gamma \bullet
M}_{\text{PDCCH}}^{\text{max,slot,}\mu},M_{\text{PDCCH}}^{\text{total,slot,}\mu}
\right) > \min\left(
M_{\text{PDCCH}}^{\text{max,slot,}\mu},M_{\text{PDCCH}}^{\text{total,slot,}\mu}
\right)$ or $\min\left( {\gamma \bullet
C}_{\text{PDCCH}}^{\text{max,slot,}\mu},C_{\text{PDCCH}}^{\text{total,slot,}\mu}
\right) > \min\left(
C_{\text{PDCCH}}^{\text{max,slot,}\mu},C_{\text{PDCCH}}^{\text{total,slot,}\mu}
\right)$, the following pseudocode applies only to USS sets associated with
the first CORESETs. A UE does not expect to monitor PDCCH in a USS set without
allocated PDCCH candidates for monitoring.
In the following pseudocode, if the UE is provided
_monitoringCapabilityConfig_ = _r16monitoringcapability_ for the primary
cell,$\ M_{\text{PDCCH}}^{\text{max,slot,}\mu}\ $_and_
$C_{\text{PDCCH}}^{\text{max,slot,}\mu}\ $_are_ replaced by
$M_{\text{PDCCH}}^{\text{max,(X,Y),}\mu}\ $and
$C_{\text{PDCCH}}^{\text{max,(X,Y),}\mu}$ respectively, and
$M_{\text{PDCCH}}^{\text{total,slot,}\mu}\ $_and_
$C_{\text{PDCCH}}^{\text{total,slot,}\mu}\ $_are_ replaced by
$M_{\text{PDCCH}}^{\text{total,(X,Y),}\mu}\ $and
$C_{\text{PDCCH}}^{\text{total,(X,Y),}\mu}$ respectively.
In the following pseudocode, if the UE is provided
_monitoringCapabilityConfig_ = _r17monitoringcapability_ for the primary
cell,$\ M_{\text{PDCCH}}^{\text{max,slot,}\mu}\ $_and_
$C_{\text{PDCCH}}^{\text{max,slot,}\mu}\ $_are_ replaced by
$M_{\text{PDCCH}}^{\text{max,}X_{s}\text{,}\mu}\ $and
$C_{\text{PDCCH}}^{\text{max,}X_{s}\text{,}\mu}$ respectively, and
$M_{\text{PDCCH}}^{\text{total,slot,}\mu}\ $_and_
$C_{\text{PDCCH}}^{\text{total,slot,}\mu}\ $_are_ replaced by
$M_{\text{PDCCH}}^{\text{total,}X_{s}\text{,}\mu}\ $and
$C_{\text{PDCCH}}^{\text{total,}X_{s}\text{,}\mu}$ respectively.
For all search space sets that a UE monitors PDCCH on the primary cell within
a slot $n$, or within a group of $X_{s}$ slots for a corresponding combination
$\left( X_{s},Y_{s} \right)$, or within a span in slot $n$, denote by
$S_{\text{css}}$ a set of CSS sets, except for CSS sets provided by
_searchSpaceMCCH_ , _searchSpaceMTCH_ or by _SearchSpace_ in _pdcch-
ConfigMulticast_ for DCI formats with CRC scrambled by G-RNTI or G-CS-RNTI,
with cardinality of $I_{\text{css}}$ and by $S_{\text{uss}}$ a set of USS sets
and CSS sets provided by _searchSpaceMCCH_ , _searchSpaceMTCH_ or by
_SearchSpace_ in _pdcch-ConfigMulticast_ for DCI formats with CRC scrambled by
G-RNTI or G-CS-RNTI with cardinality of $J_{\text{uss}}$ for scheduling on the
primary cell. The location of search space sets $s_{j}$, $0 \leq j  4$ downlink cells or
$N_{\text{cells}}^{\text{UL}} > 4$ uplink cells, or
\- is configured with NR-DC operation and for a cell group with
$N_{\text{cells}}^{\text{DL}}$ downlink cells or
$N_{\text{cells}}^{\text{UL}}$ uplink cells
the UE expects to have respectively received at most ${16 \bullet
N}_{\text{cells}}^{\text{cap}}$ PDCCHs for
\- DCI formats with CRC scrambled by a C-RNTI, or a CS-RNTI, or a MCS-C-RNTI,
or a G-RNTI for multicast, or a G-CS-RNTI scheduling ${16 \bullet
N}_{\text{cells}}^{\text{cap}}$ PDSCH receptions for which the UE has not
received any corresponding PDSCH symbol over all
$N_{\text{cells}}^{\text{DL}}$ downlink cells
\- DCI formats with CRC scrambled by a C-RNTI, or a CS-RNTI, or a MCS-C-RNTI
scheduling ${16 \bullet N}_{\text{cells}}^{\text{cap}}$ PUSCH transmissions
for which the UE has not transmitted any corresponding PUSCH symbol over all
$N_{\text{cells}}^{\text{UL}}$ uplink cells
If a UE is provided _monitoringCapabilityConfig_ = _r16monitoringcapability
for all_ serving _cells, and_
\- is not configured for NR-DC operation and indicates through _pdcch-
MonitoringCA_ a capability to monitor PDCCH candidates for
$N_{\text{cells}}^{cap - r16} \geq 2$ downlink cells and the UE is configured
with $N_{\text{cells}}^{\text{DL}} > 2$ downlink cells or
$N_{\text{cells}}^{\text{UL}} > 2$ uplink cells, or
\- is configured with NR-DC operation and for a cell group with
$N_{\text{cells}}^{\text{DL}}$ downlink cells or
$N_{\text{cells}}^{\text{UL}}$ uplink cells
the UE expects to have respectively received at most ${16 \bullet
N}_{\text{cells}}^{cap - r16}$ PDCCHs for
\- DCI formats with CRC scrambled by a C-RNTI, or a CS-RNTI, or a MCS-C-RNTI,
or a G-RNTI for multicast, or a G-CS-RNTI scheduling ${16 \bullet
N}_{\text{cells}}^{cap - r16}$ PDSCH receptions for which the UE has not
received any corresponding PDSCH symbol over all
$N_{\text{cells}}^{\text{DL}}$ downlink cells
\- DCI formats with CRC scrambled by a C-RNTI, or a CS-RNTI, or a MCS-C-RNTI
scheduling ${16 \bullet N}_{\text{cells}}^{cap - r16}$ PUSCH transmissions for
which the UE has not transmitted any corresponding PUSCH symbol over all
$N_{\text{cells}}^{\text{UL}}$ uplink cells.
If a UE is provided _monitoringCapabilityConfig_ = _r16monitoringcapability
for at least one serving cell and is not provided monitoringCapabilityConfig_
= _r16monitoringcapability for at least one serving cell, and_
\- is not configured for NR-DC operation, and indicates a capability to
monitor PDCCH candidates for $N_{cells,r15}^{cap - r16} \geq 1$ downlink cells
and $N_{cells,r16}^{cap - r16} \geq 1$ downlink cells, and the UE is
configured with $N_{\text{cells}}^{\text{DL}} > 1$ downlink cells or
$N_{\text{cells}}^{\text{UL}} > 1$ uplink cells, _or_
\- is configured with NR-DC operation and for a cell group with
$N_{\text{cells}}^{\text{DL}}$ downlink cells or
$N_{\text{cells}}^{\text{UL}}$ uplink cells
the UE expects to have respectively received
\- at most ${16 \bullet N}_{cells,r15}^{cap - r16}$ PDCCHs for DCI formats
with CRC scrambled by a C-RNTI, or a CS-RNTI, or a MCS-C-RNTI, or a G-RNTI for
multicast, or a G-CS-RNTI scheduling ${16 \bullet N}_{cells,r15}^{cap - r16}$
PDSCH receptions for which the UE has not received any corresponding PDSCH
symbol over all serving cells that are not provided
_monitoringCapabilityConfig_ = _r16monitoringcapability_
\- at most ${16 \bullet N}_{cells,r15}^{cap - r16}$ PDCCHs for DCI formats
with CRC scrambled by a C-RNTI, or a CS-RNTI, or a MCS-C-RNTI scheduling ${16
\bullet N}_{cells,r15}^{cap - r16}$ PUSCH transmissions for which the UE has
not transmitted any corresponding PUSCH symbol over all serving cells that are
not provided _monitoringCapabilityConfig_ = _r16monitoringcapability_
\- at most ${16 \bullet N}_{cells,r16}^{cap - r16}$ PDCCHs for DCI formats
with CRC scrambled by a C-RNTI, or a CS-RNTI, or a MCS-C-RNTI, or a G-RNTI for
multicast, or a G-CS-RNTI scheduling ${16 \bullet N}_{cells,r16}^{cap - r16}$
PDSCH receptions for which the UE has not received any corresponding PDSCH
symbol over all serving cells that are provided _monitoringCapabilityConfig_ =
_r16monitoringcapability_
\- at most ${16 \bullet N}_{cells,r16}^{cap - r16}$ PDCCHs for DCI formats
with CRC scrambled by a C-RNTI, or a CS-RNTI, or a MCS-C-RNTI scheduling ${16
\bullet N}_{cells,r16}^{cap - r16}$ PUSCH transmissions for which the UE has
not transmitted any corresponding PUSCH symbol over all serving cells that are
provided _monitoringCapabilityConfig_ = _r16monitoringcapability_
If a UE is provided serving _cells with_ SCS configuration $\mu \in \left{ 5,\
6 \right}$ for the active DL BWP, is not configured for NR-DC operation and
indicates through _pdcch-MonitoringCA_ a capability to monitor PDCCH
candidates for $N_{\text{cells}}^{\text{cap} - r17} \geq 4$ downlink cells and
the UE is configured with $N_{\text{cells}}^{\text{DL}} > 4$ downlink cells or
$N_{\text{cells}}^{\text{UL}} > 4$ uplink cells, the UE expects to have
respectively received at most ${16 \bullet N}_{\text{cells}}^{\text{cap} -
r17}$ PDCCHs for
\- DCI formats with CRC scrambled by a C-RNTI, or a CS-RNTI, or a MCS-C-RNTI,
or a G-RNTI, or a G-CS-RNTI scheduling ${16 \bullet
N}_{\text{cells}}^{\text{cap} - r17}$ PDSCH receptions for which the UE has
not received any corresponding PDSCH symbol over all
$N_{\text{cells}}^{\text{DL}}$ downlink cells
\- DCI formats with CRC scrambled by a C-RNTI, or a CS-RNTI, or a MCS-C-RNTI
scheduling ${16 \bullet N}_{\text{cells}}^{\text{cap} - r17}$ PUSCH
transmissions for which the UE has not transmitted any corresponding PUSCH
symbol over all $N_{\text{cells}}^{\text{UL}}$ uplink cells.
If a UE _is_ provided _monitoringCapabilityConfig_ = _r17monitoringcapability
for at least one serving cell, is_ provided _monitoringCapabilityConfig_ =
_r15monitoringcapability for at least one serving cell, is not provided
monitoringCapabilityConfig_ = _r16monitoringcapability for any serving cell,_
is not configured for NR-DC operation, indicates a capability to monitor PDCCH
candidates for $N_{\text{cells},r15/r17}^{\text{cap} - r17} \geq 1$ downlink
cells and $N_{\text{cells},r17/r15}^{\text{cap} - r17} \geq 1$ downlink cells,
and UE is configured with $N_{\text{cells}}^{\text{DL}} > 1$ downlink cell or
$N_{\text{cells}}^{\text{UL}} > 1$ uplink cells, the UE expects to have
respectively received
\- at most ${16 \bullet N}_{cells,r15/r17}^{cap - r17}$ PDCCHs for DCI formats
with CRC scrambled by a C-RNTI, or a CS-RNTI, or a MCS-C-RNTI, or a G-RNTI for
multicast, or a G-CS-RNTI scheduling ${16 \bullet N}_{cells,r15/r17}^{cap -
r17}$ PDSCH receptions for which the UE has not received any corresponding
PDSCH symbol over all serving cells that are provided
_monitoringCapabilityConfig_ = _r15monitoringcapability_
\- at most ${16 \bullet N}_{cells,r15/r17}^{cap - r17}$ PDCCHs for DCI formats
with CRC scrambled by a C-RNTI, or a CS-RNTI, or a MCS-C-RNTI scheduling ${16
\bullet N}_{cells,r15/r17}^{cap - r17}$ PUSCH transmissions for which the UE
has not transmitted any corresponding PUSCH symbol over all serving cells that
are provided _monitoringCapabilityConfig_ = _r15monitoringcapability_
\- at most ${16 \bullet N}_{cells,r17/r15}^{cap - r17}$ PDCCHs for DCI formats
with CRC scrambled by a C-RNTI, or a CS-RNTI, or a MCS-C-RNTI, or a G-RNTI for
multicast, or a G-CS-RNTI scheduling ${16 \bullet N}_{cells,r17/r15}^{cap -
r17}$ PDSCH receptions for which the UE has not received any corresponding
PDSCH symbol over all serving cells with _monitoringCapabilityConfig_ =
_r17monitoringcapability_
\- at most ${16 \bullet N}_{cells,r17/r15}^{cap - r17}$ PDCCHs for DCI formats
with CRC scrambled by a C-RNTI, or a CS-RNTI, or a MCS-C-RNTI scheduling ${16
\bullet N}_{cells,r17/r15}^{cap - r17}$ PUSCH transmissions for which the UE
has not transmitted any corresponding PUSCH symbol over all serving cells with
_monitoringCapabilityConfig_ = _r17monitoringcapability_
If a UE _is_ provided _monitoringCapabilityConfig_ = _r17monitoringcapability
for at least one serving cell, is_ provided _monitoringCapabilityConfig_ =
_r16monitoringcapability for at least one serving cell, is not provided
monitoringCapabilityConfig_ = _r15monitoringcapability for any serving cell,_
is not configured for NR-DC operation, indicates a capability to monitor PDCCH
candidates for $N_{\text{cells},r16/r17}^{\text{cap} - r17} \geq 1$ downlink
cells and $N_{\text{cells},r17/r16}^{\text{cap} - r17} \geq 1$ downlink cells,
and the UE is configured with $N_{\text{cells}}^{\text{DL}} > 1$ downlink
cells or $N_{\text{cells}}^{\text{UL}} > 1$ uplink cells
the UE expects to have respectively received
\- at most ${16 \bullet N}_{cells,r16/r17}^{cap - r17}$ PDCCHs for DCI formats
with CRC scrambled by a C-RNTI, or a CS-RNTI, or a MCS-C-RNTI, or a G-RNTI for
multicast, or a G-CS-RNTI scheduling ${16 \bullet N}_{cells,r16/r17}^{cap -
r17}$ PDSCH receptions for which the UE has not received any corresponding
PDSCH symbol over all serving cells that are provided
_monitoringCapabilityConfig_ = _r16monitoringcapability_
\- at most ${16 \bullet N}_{cells,r16/r17}^{cap - r17}$ PDCCHs for DCI formats
with CRC scrambled by a C-RNTI, or a CS-RNTI, or a MCS-C-RNTI scheduling ${16
\bullet N}_{cells,r16/r17}^{cap - r17}$ PUSCH transmissions for which the UE
has not transmitted any corresponding PUSCH symbol over all serving cells that
are provided _monitoringCapabilityConfig_ = _r16monitoringcapability_
\- at most ${16 \bullet N}_{cells,r17/r16}^{cap - r17}$ PDCCHs for DCI formats
with CRC scrambled by a C-RNTI, or a CS-RNTI, or a MCS-C-RNTI, or a G-RNTI for
multicast, or a G-CS-RNTI scheduling ${16 \bullet N}_{cells,r17/r16}^{cap -
r17}$ PDSCH receptions for which the UE has not received any corresponding
PDSCH symbol over all serving cells with _monitoringCapabilityConfig_ =
_r17monitoringcapability_
\- at most ${16 \bullet N}_{cells,r17/r16}^{cap - r17}$ PDCCHs for DCI formats
with CRC scrambled by a C-RNTI, or a CS-RNTI, or a MCS-C-RNTI scheduling ${16
\bullet N}_{cells,r17/r16}^{cap - r17}$ PUSCH transmissions for which the UE
has not transmitted any corresponding PUSCH symbol over all serving cells with
_monitoringCapabilityConfig_ = _r17monitoringcapability_
If a UE _is_ provided _monitoringCapabilityConfig_ = _r17monitoringcapability
for at least one serving cell, is provided monitoringCapabilityConfig_ =
_r16monitoringcapability for at least one serving cell, and
monitoringCapabilityConfig_ = _r15monitoringcapability for at least one
serving cell,_ is not configured for NR-DC operation, indicates a capability
to monitor PDCCH candidates for $N_{\text{cells},r15/{ r16,r17}}^{\text{cap} -
r17} \geq 1$ downlink cells, $N_{\text{cells},r16/{ r15,r17}}^{\text{cap} -
r17} \geq 1$, and $N_{\text{cells},r17/{ r15,r16}}^{\text{cap} - r17} \geq 1$
downlink cells, and is configured with $N_{\text{cells}}^{\text{DL}} > 1$
downlink cells or $N_{\text{cells}}^{\text{UL}} > 1$ uplink cells
the UE expects to have respectively received
\- at most ${16 \bullet N}_{cells,r15/{ r16,r17}}^{cap - r17}$ PDCCHs for DCI
formats with CRC scrambled by a C-RNTI, or a CS-RNTI, or a MCS-C-RNTI, or a
G-RNTI for multicast, or a G-CS-RNTI scheduling ${16 \bullet N}_{cells,r15/{
r16,r17}}^{cap - r17}$ PDSCH receptions for which the UE has not received any
corresponding PDSCH symbol over all serving cells that are provided
_monitoringCapabilityConfig_ = _r15monitoringcapability_
\- at most ${16 \bullet N}_{cells,r15/{ r16,r17}}^{cap - r17}$ PDCCHs for DCI
formats with CRC scrambled by a C-RNTI, or a CS-RNTI, or a MCS-C-RNTI
scheduling ${16 \bullet N}_{cells,r15/{ r16,r17}}^{cap - r17}$ PUSCH
transmissions for which the UE has not transmitted any corresponding PUSCH
symbol over all serving cells that are provided _monitoringCapabilityConfig_ =
_r15monitoringcapability_
\- at most ${16 \bullet N}_{cells,r16/{ r15,r17}}^{cap - r17}$ PDCCHs for DCI
formats with CRC scrambled by a C-RNTI, or a CS-RNTI, or a MCS-C-RNTI, or a
G-RNTI for multicast, or a G-CS-RNTI scheduling ${16 \bullet N}_{cells,r16/{
r15,r17}}^{cap - r17}$ PDSCH receptions for which the UE has not received any
corresponding PDSCH symbol over all serving cells that are provided
_monitoringCapabilityConfig_ = _r16monitoringcapability_
\- at most ${16 \bullet N}_{cells,r16/{ r15,r17}}^{cap - r17}$ PDCCHs for DCI
formats with CRC scrambled by a C-RNTI, or a CS-RNTI, or a MCS-C-RNTI
scheduling ${16 \bullet N}_{cells,r16/{ r15,r17}}^{cap - r17}$ PUSCH
transmissions for which the UE has not transmitted any corresponding PUSCH
symbol over all serving cells that are provided _monitoringCapabilityConfig_ =
_r16monitoringcapability_
\- at most ${16 \bullet N}_{cells,r17/{ r16,r17}}^{cap - r17}$ PDCCHs for DCI
formats with CRC scrambled by a C-RNTI, or a CS-RNTI, or a MCS-C-RNTI, or a
G-RNTI for multicast, or a G-CS-RNTI scheduling ${16 \bullet N}_{cells,r17/{
r16,r17}}^{cap - r17}$ PDSCH receptions for which the UE has not received any
corresponding PDSCH symbol over all serving cells with
_monitoringCapabilityConfig_ = _r17monitoringcapability_
\- at most ${16 \bullet N}_{cells,r17/{ r16,r17}}^{cap - r17}$ PDCCHs for DCI
formats with CRC scrambled by a C-RNTI, or a CS-RNTI, or a MCS-C-RNTI
scheduling ${16 \bullet N}_{cells,r17/{ r16,r17}}^{cap - r17}$ PUSCH
transmissions for which the UE has not transmitted any corresponding PUSCH
symbol over all serving cells with _monitoringCapabilityConfig_ =
_r17monitoringcapability_
If a UE
\- is configured to monitor a first PDCCH candidate for a DCI format 0_0 and a
DCI format 1_0 from a CSS set and a second PDCCH candidate for a DCI format
0_0 and a DCI format 1_0 from a USS set, where the CSS set and the USS set do
not include _searchSpaceLinkingId_ , in a CORESET with index zero on an active
DL BWP, and
\- the DCI formats 0_0/1_0 associated with the first PDCCH candidate and the
DCI formats 0_0/1_0 associated with the second PDCCH candidate have same size,
and
\- the UE receives the first PDCCH candidate and the second PDCCH candidate
over a same set of CCEs, and
\- the first PDCCH candidate and the second PDCCH candidate have identical
scrambling, and
\- the DCI formats 0_0/1_0 for the first PDCCH candidate and the DCI formats
0_0/1_0 for the second PDCCH candidate have CRC scrambled by either C-RNTI, or
MCS-C-RNTI, or CS-RNTI
the UE decodes only the DCI formats 0_0/1_0 associated with the first PDCCH
candidate.
If a UE detects a DCI format with inconsistent information, the UE discards
**all** the information in the DCI format.
A UE configured with a bandwidth part indicator in a DCI format determines, in
case of an active DL BWP or of an active UL BWP change, that the information
in the DCI format is applicable to the new active DL BWP or UL BWP,
respectively, as described in clause 12.
For unpaired spectrum operation, if a UE is not configured for PUSCH/PUCCH
transmission on serving cell $c_{2}$, the UE does not expect to monitor PDCCH
on serving cell $c_{1}$ if the PDCCH overlaps in time with SRS transmission
(including any interruption due to uplink or downlink RF retuning time [10, TS
38.133]) on serving cell $c_{2}$ and if the UE is not capable of simultaneous
reception and transmission on serving cell $c_{1}$and serving cell $c_{2}$.
If a UE is provided _resourceBlocks_ and s _ymbolsInResourceBlock_ in
_RateMatchPattern_ , or if the UE is additionally provided
_periodicityAndPattern_ in _RateMatchPattern_ , the UE can determine a set of
RBs in symbols of a slot that are not available for PDSCH reception scheduled
by a DCI format as described in [6, TS 38.214]. If a PDCCH candidate that
provides a DCI format is mapped to one or more REs that overlap with REs of
any RB in the set of RBs in symbols of the slot, the UE does not expect to
monitor the PDCCH candidate.
A UE does not expect to be configured with _dci-FormatsSL_ and _dci-
FormatsExt_ in a same USS.
### 10.1.1 Self-carrier and cross-carrier scheduling on the primary cell
A UE can be configured for scheduling on the primary cell from the primary
cell and from a secondary cell [12, TS 38.331]. The UE is either not provided
_monitoringCapabilityConfig for_ the primary cell or for the secondary cell,
_or the UE is_ provided only _monitoringCapabilityConfig_ =
_r15monitoringcapability for_ the primary cell and for the secondary cell. The
UE is not provided _coresetPoolIndex_ on the primary cell or on the secondary
cell.
The SCS configuration $\mu_{P}$ for the active DL BWP on the primary cell is
smaller than or equal to the SCS configuration $\mu_{S}$ for the active DL BWP
on the secondary cell.
If a UE indicates capability _disablingScalingFactorDeactSCell_ [18, TS
38.306] and the secondary cell is deactivated, or if the UE indicates
capability _disablingScalingFactorDormantSCell_ [18, TS 38.306] and the active
DL BWP of the secondary cell is a dormant DL BWP for the UE, $\alpha = 1$
applies for the procedures described in the remaining of this clause. If
$\mu_{P}  the UE sets the timer value to the value provided by
> _searchSpaceSwitchTimer_ if the UE detects a DCI format by monitoring PDCCH
> in any search space set
\- if the UE monitors PDCCH for a serving cell according to search space sets
with group index 1, the UE starts monitoring PDCCH for the serving cell
according to search space sets with group index 0, and stops monitoring PDCCH
according to search space sets with group index 1, for the serving cell
\- at the beginning of the first slot that is at least $P_{\text{switch}}$
symbols after a slot where the timer expires or, if the UE is provided a
search space set to monitor PDCCH for detecting a DCI format 2_0, after a last
symbol of a remaining channel occupancy duration for the serving cell if
indicated by DCI format 2_0 when $\mu \in \left{ 0,\ 1,\ 2,\ 3 \right}$
\- at the beginning of the first slot, of a group of $X_{s}$ slots, that is at
least $P_{\text{switch}}$ symbols after a slot where the timer expires or, if
the UE is provided a search space set to monitor PDCCH for detecting a DCI
format 2_0, after a last symbol of a remaining channel occupancy duration for
the serving cell if indicated by DCI format 2_0 when $\mu \in \left{ 5,\ 6
\right}$
A UE determines a slot and a symbol in the slot to start or stop PDCCH
monitoring according to search space sets for a serving cell that the UE is
provided _searchSpaceGroupIdList_ or, if _cellGroupsForSwitchList_ is
provided, for a set of serving cells, based on the largest $X_{s}$ if the SCS
configuration $\mu$ among all configured DL BWPs in the set of serving cells
equals to 6, otherwise, based on the smallest SCS configuration $\mu$ among
all configured DL BWPs in the serving cell or in the set of serving cells and,
if any, in the serving cell where the UE receives a PDCCH and detects a
corresponding DCI format 2_0 triggering the start or stop of PDCCH monitoring
according to search space sets.
A UE can be provided a set of durations by _pdcch-SkippingDurationList_ for
PDCCH monitoring on an active DL BWP of a serving cell _and, if the UE is not
provided searchSpaceGroupIdList-r17 on the active DL BWP of the serving cell,
a_ DCI format 0_1 and a DCI format 0_2 that schedule PUSCH transmission, and a
DCI format 1_1 and a DCI format 1_2 that schedule PDSCH receptions can include
a PDCCH monitoring adaptation field of 1 bit or of 2 bits.
If the field has 1 bit and for PDCCH monitoring by the UE according to
Type3-PDCCH CSS sets or USS sets on the active DL BWP of the serving cell
\- a \'0\' value for the bit indicates no skipping in PDCCH monitoring
\- a \'1\' value for the bit indicates skipping PDCCH monitoring for a
duration provided by the first value in the set of durations
If the field has 2 bits and for PDCCH monitoring by the UE according to
Type3-PDCCH CSS sets or USS sets on the active DL BWP of the serving cell
\- a \'00\' value for the bits indicates no skipping in PDCCH monitoring
\- a \'01\' value for the bits indicates skipping PDCCH monitoring for a
duration provided by the first value in the set of durations
\- a \'10\' value for the bits indicates skipping PDCCH monitoring for a
duration provided by the second value in the set of durations
\- a \'11\' value for the bits indicates skipping PDCCH monitoring for a
duration provided by the third value in the set of durations, if any;
otherwise, if the set of durations includes two values, a use of the \'11\'
value is reserved
A UE can be provided group indexes for a Type3-PDCCH CSS set or USS set by
_searchSpaceGroupIdList-r17_ for PDCCH monitoring on an active DL BWP of a
serving cell and, _if the UE is not provided pdcch-SkippingDurationList for
the active DL BWP of the serving cell,_ a DCI format 0_1 and a DCI format 0_2
that schedule PUSCH transmissions and a DCI format 1_1 and a DCI format 1_2
that schedule PDSCH receptions can include a PDCCH monitoring adaptation field
of 1 bit or of 2 bits for the serving cell.
If the field has 1 bit and for PDCCH monitoring by the UE according to
Type3-PDCCH CSS sets or USS sets on the active DL BWP of the serving cell
\- a \'0\' value for the bit indicates start of PDCCH monitoring according to
search space sets with group index 0 and stop of PDCCH monitoring according to
search space sets with other group indexes, if any
\- a \'1\' value for the bit indicates start of PDCCH monitoring according to
search space sets with group index 1 and stop of PDCCH monitoring according to
search space sets with other group indexes, if any, and the UE sets the timer
value to the one provided by _searchSpaceSwitchTimer-r17, if provided_
If the field has 2 bits and for PDCCH monitoring by the UE according to
Type3-PDCCH CSS sets or USS sets on the active DL BWP of the serving cell
\- a \'00\' value for the bit indicates start of PDCCH monitoring according to
search space sets with group index 0 and stop of PDCCH monitoring according to
search space sets with other group indexes, if any
\- a \'01\' value for the bit indicates start of PDCCH monitoring according to
search space sets with group index 1 and stop of PDCCH monitoring according to
search space sets with other group indexes, if any, and the UE sets the timer
value to the one provided by _searchSpaceSwitchTimer-r17, if provided_
\- a \'10\' value for the bit indicates start of PDCCH monitoring according to
search space sets with group index 2 and stop of PDCCH monitoring according to
search space sets with other group indexes, if any, and the UE sets the timer
value to the one provided by _searchSpaceSwitchTimer-r17, if provided_
\- a \'11\' value is reserved
A UE can be provided a set of durations by _pdcch-SkippingDurationList and_
group indexes for a Type3-PDCCH CSS set or USS set by
_searchSpaceGroupIdList-r17_ for PDCCH monitoring on an active DL BWP of a
serving cell _and, a_ DCI format 0_1 and a DCI format 0_2 that schedule PUSCH
transmissions, and a DCI format 1_1 and a DCI format 1_2 that schedule PDSCH
receptions can include a PDCCH monitoring adaptation field of 2 bits.
If the set of durations includes one value and for PDCCH monitoring by the UE
according to Type3-PDCCH CSS sets or USS sets on the active DL BWP of the
serving cell
\- a \'00\' value for the bits indicates start of PDCCH monitoring according
to search space sets with group index 0 and stop of PDCCH monitoring according
to search space sets with group index 1, if any
\- a \'01\' value for the bits indicates start of PDCCH monitoring according
to search space sets with group index 1 and stop of PDCCH monitoring according
to search space sets with group index 0, if any, and the UE sets the timer
value to the one provided by _searchSpaceSwitchTimer-r17, if provided_
\- a \'10\' value for the bits indicates skipping PDCCH monitoring for a
duration provided by the value in the set of durations
\- a \'11\' value is reserved
If the set of durations includes two values and for PDCCH monitoring by the UE
according to Type3-PDCCH CSS sets or USS sets on active DL BWP of the serving
cell
\- a \'00\' value for the bits indicates start of PDCCH monitoring according
to search space sets with group index 0 and stop of PDCCH monitoring according
to search space sets with group index 1, if any
\- a \'01\' value for the bits indicates start of PDCCH monitoring according
to search space sets with group index 1 and stop of PDCCH monitoring according
to search space sets with group index 0, if any, and the UE sets the timer
value to the one provided by _searchSpaceSwitchTimer-r17, if provided_
\- a \'10\' value for the bits indicates skipping PDCCH monitoring for a
duration provided by the first value in the set of durations
\- a \'11\' value for the bits indicates skipping PDCCH monitoring for a
duration provided by the second value in the set of durations
When the PDCCH monitoring adaptation field indicates to a UE to start PDCCH
monitoring according to search space sets with a first group index and stop
PDCCH monitoring according to search space sets with a second group index, the
UE applies the indication
\- at the beginning of a first slot that is at least $P_{\text{switch}}$
symbols after the last symbol of the PDCCH reception providing the DCI format
with the PDCCH monitoring adaptation field when $\mu \in \left{ 0,\ 1,\ 2,\ 3
\right}$,
\- at the beginning of a first slot, of a slot group of $X_{s}$ slots, that is
at least $P_{\text{switch}}$ symbols after the last symbol of the PDCCH
reception providing the DCI format with the PDCCH monitoring adaptation field
when $\mu \in \left{ 5,\ 6 \right}$
When the PDCCH monitoring adaptation field indicates to a UE to skip PDCCH
monitoring for a duration on the active DL BWP of a serving cell, the UE
starts skipping of PDCCH monitoring at the beginning of a first slot that is
after the last symbol of the PDCCH reception providing the DCI format with the
PDCCH monitoring adaptation field. If the UE transmits a PUCCH providing a
positive SR before the UE detects a DCI format providing the PDCCH monitoring
adaptation field indicating to the UE to skip PDCCH monitoring for the
duration on the active DL BWP of the serving cell, the UE shall monitor PDCCH
regardless of PDCCH skipping indication on all serving cells of the
corresponding Cell Group when the SR is pending [11, TS 38.321]. If the UE
transmits a PUCCH providing a positive SR after the UE detects a DCI format
providing the PDCCH monitoring adaptation field indicating to the UE to skip
PDCCH monitoring for the duration on the active DL BWP of the serving cell,
the UE resumes PDCCH monitoring starting at the beginning of a first slot that
is after a last symbol of the PUCCH transmission in all serving cells of the
corresponding Cell Group. During the time of _ra-ResponseWindow_ or _msgB-
ResponseWindow_ or the duration where _ra-ContentionResolutionTimer_ is
running, the UE shall not skip PDCCH monitoring on SpCell. After the UE
detects a DCI format providing the PDCCH monitoring adaptation field
indicating to the UE to skip PDCCH monitoring for the duration on the active
DL BWP of a SpCell, when contention resolution is successful [11, TS 38.321],
the UE resumes PDCCH monitoring on the SpCell. After the UE detects a DCI
format providing the PDCCH monitoring adaptation field indicating to the UE to
skip PDCCH monitoring for the duration on the active DL BWP of a serving cell,
when a pending SR is cancelled [11, TS 38.321], the UE resumes PDCCH
monitoring in all serving cells of the corresponding Cell Group. If UE
transmits a RACH due to positive SR, the UE shall not skip PDCCH monitoring on
any serving cell of the corresponding Cell Group during the time of _ra-
ResponseWindow_ or _msgB-ResponseWindow_ or the duration where _ra-
ContentionResolutionTimer_ is running. If the DRX group of the serving cell is
configured and enters outside Active Time, the UE terminates PDCCH skipping
for the serving cell.
If the UE changes to a new active DL BWP of the serving cell by the expiration
of _bwp-InactivityTimer_ or by RRC configuration, the UE
\- resumes PDCCH monitoring according to the search space sets on the new
active BWP of the serving cell when UE is in a PDCCH skipping duration, if the
UE _is not provided searchSpaceGroupIdList-r17_ on the new active DL BWP
\- monitors PDCCH according to search space sets with group index 0 on the new
active BWP of the serving cell, if the UE is _provided
searchSpaceGroupIdList-r17_.
If a UE is provided group indexes for a Type3-PDCCH CSS set or a USS set by
_searchSpaceGroupIdList-r17_ and a timer value by _searchSpaceSwitchTimer-r17_
for PDCCH monitoring an active DL BWP of on a serving cell and the timer is
running, the UE
\- resets the timer after a slot of the active DL BWP of the serving cell if
the UE detects a DCI format in a PDCCH reception in the slot for with CRC
scrambled by C-RNTI/CS-RNTI/MCS-C-RNTI
\- otherwise, decrements the timer value by one after a slot of the active DL
BWP of the serving cell
When the timer expires in a first slot, the UE monitors PDCCH on the serving
cell according to search space sets with group index 0 starting in a second
slot that
\- is not earlier than $P_{\text{switch}}$ symbols after the first slot when
$\mu \in \left{ 0,\ 1,\ 2,\ 3 \right}$,
\- is a first slot in a slot group of $X_{s}$ slots that is not earlier than
$P_{\text{switch}}$ symbols after the first slot when $\mu \in \left{ 5,\ 6
\right}$,
\- is not earlier than a slot where a PDCCH skipping duration expires, if
applicable
When a UE receives
\- a first PDCCH in a first slot that provides a DCI format with a PDCCH
monitoring adaptation field having a first value indicating skipping PDCCH
monitoring, or indicating start of PDCCH monitoring according to a search
space sets with a first group index and stop of PDCCH monitoring according to
search space sets with a second group index, for an active DL BWP and
\- a second PDCCH that provides a DCI format with a PDCCH monitoring
adaptation field having a second value indicating skipping PDCCH monitoring,
or indicating start of PDCCH monitoring according to search space sets with a
first group index and stop of PDCCH monitoring according to search space sets
with a second group index different than the first group index, for the active
DL BWP where the second PDCCH is received
\- in the first slot if the first value indicates skipping PDCCH monitoring
\- before a slot that is at least $P_{\text{switch}}$ symbols after the first
slot if the first value indicates start of PDCCH monitoring according to
search space sets with a first group index
the UE does not expect the second value to be different than the first value.
A UE does not expect to receive in a second slot a PDCCH on an active DL BWP
that provides a DCI format indicating skipping PDCCH monitoring, or start of
PDCCH monitoring according to search space sets with group index 1 or 2 for
the active DL BWP, if the second slot is not at least $P_{\text{switch}}$
symbols after a first slot where the timer expires.
## 10.4A PDCCH monitoring for early indication of paging
A UE can be provided the following for detection of a DCI format 2_7 in
RRC_IDLE state or in RRC_INACTIVE state [12, TS 38.331]
\- a search space set, by _pei-SearchSpace,_ to monitor PDCCH for detection of
DCI format 2_7 according to a Type2A-PDCCH CSS set as described in clause 10.1
\- a number of frames, by _pei-FrameOffset_ , from the start of a frame to the
start of a first paging frame of paging frames associated with a number of
PDCCH monitoring occasions for DCI format 2_7 [17, TS 38.304]
\- a number of symbols, by _firstPDCCH-MonitoringOccasionOfPEI-O_ , from the
start of the frame to the start of the first PDCCH monitoring occasion for DCI
format 2_7
\- a size, by _payloadSizeDCI-2-7_
\- a number of subgroups per paging occasion, $N_{\text{SG}}^{\text{PO}}$, by
_subgroupsNumPerPO_
\- a number of paging occasions associated with the number of PDCCH monitoring
occasions for DCI format 2_7, $N_{\text{PO}}^{\text{PEI}}$, by _po-NumPerPEI_
A paging indication field of DCI format 2_7 includes
$N_{\text{PO}}^{\text{PEI}}$ segments of $K$ bits, where ${K =
N}_{\text{SG}}^{\text{PO}}$. For a subgroup index $i_{\text{SG}}$, $0 \leq
i_{\text{SG}}  \- a _pattern1_.
The _pattern1_ provides
\- a slot configuration period of msec by _dl-UL-TransmissionPeriodicity_
\- a number of slots with only downlink symbols by _nrofDownlinkSlots_
\- a number of downlink symbols by _nrofDownlinkSymbols_
\- a number of slots with only uplink symbols by _nrofUplinkSlots_
\- a number of uplink symbols by _nrofUplinkSymbols_
A value _P_ =0.625 msec is valid only for $\text{\ μ}_{\text{ref}} = 3$,
$\text{\ μ}_{\text{ref}} = 5\ \text{or\ μ}_{\text{ref}} = 6$. A value _P_
=1.25 msec is valid only for $\text{\ μ}_{\text{ref}} = 2,\ \text{\
μ}_{\text{ref}} = 3$, $\text{\ μ}_{\text{ref}} = 5\ \text{or\ μ}_{\text{ref}}
= 6$. A value _P_ =2.5 msec is valid only for$\text{\ μ}_{\text{ref}} = 1,\
\text{\ μ}_{\text{ref}} = 2,\ \text{\ μ}_{\text{ref}} = 3$,$\text{\
μ}_{\text{ref}} = 5\ \text{or\ μ}_{\text{ref}} = 6$. A value _P_ =10 msec is
valid only for $\text{\ μ}_{\text{ref}} = 0$, $\text{\ μ}_{\text{ref}} = 1,\
\text{\ μ}_{\text{ref}} = 2,\ \text{\ μ}_{\text{ref}} = 3$ or $\text{\
μ}_{\text{ref}} = 5\ $.
A slot configuration period of msec includes slots with SCS configuration .
From the slots, a first slots include only downlink symbols and a last slots
include only uplink symbols. The symbols after the first slots are downlink
symbols. The symbols before the last slots are uplink symbols. The remaining
are flexible symbols.
The first symbol every periods is a first symbol in an even frame.
If _tdd-UL-DL-ConfigurationCommon_ provides both _pattern1_ and _pattern2_ ,
the UE sets the slot format per slot over a first number of slots as indicated
by _pattern1_ and the UE sets the slot format per slot over a second number of
slots as indicated by _pattern2_.
The _pattern2_ provides
\- a slot configuration period of msec by _dl-UL-TransmissionPeriodicity_
\- a number of slots with only downlink symbols by _nrofDownlinkSlots_
\- a number of downlink symbols by _nrofDownlinkSymbols_
\- a number of slots with only uplink symbols by _nrofUplinkSlots_
\- a number of uplink symbols by _nrofUplinkSymbols_
The applicable values of are same as the applicable values for .
A slot configuration period of msec includes first slots and second slots.
From the slots, a first slots include only downlink symbols and a last include
only uplink symbols. The symbols after the first slots are downlink symbols.
The symbols before the last slots are uplink symbols. The remaining are
flexible symbols.
A UE expects that divides 20 msec.
The first symbol every periods is a first symbol in an even frame.
A UE expects that the reference SCS configuration is smaller than or equal to
a SCS configuration for any configured DL BWP or UL BWP. Each slot provided by
_pattern1_ or _pattern2_ is applicable to consecutive slots in the active DL
BWP or the active UL BWP where the first slot starts at a same time as a first
slot for the reference SCS configuration and each downlink or flexible or
uplink symbol for the reference SCS configuration corresponds to consecutive
downlink or flexible or uplink symbols for the SCS configuration .
If the UE is additionally provided _tdd-UL-DL-ConfigurationDedicated_ , the
parameter _tdd-UL-DL-ConfigurationDedicated_ overrides only flexible symbols
per slot over the number of slots as provided by _tdd-UL-DL-
ConfigurationCommon_.
The _tdd-UL-DL-ConfigurationDedicated_ provides
\- a set of slot configurations by _slotSpecificConfigurationsToAddModList_
\- for each slot configuration from the set of slot configurations
\- a slot index for a slot provided by _slotIndex_
\- a set of symbols for a slot by _symbols_ where
\- if _symbols_ = _allDownlink_ , all symbols in the slot are downlink
\- if _symbols_ = _allUplink_ , all symbols in the slot are uplink
\- if _symbols_ = _explicit_ , _nrofDownlinkSymbols_ provides a number of
downlink first symbols in the slot and _nrofUplinkSymbols_ provides a number
of uplink last symbols in the slot. If _nrofDownlinkSymbols_ is not provided,
there are no downlink first symbols in the slot and if _nrofUplinkSymbols_ is
not provided, there are no uplink last symbols in the slot. The remaining
symbols in the slot are flexible
For each slot having a corresponding index provided by _slotIndex_ , the UE
applies a format provided by a corresponding _symbols_. The UE does not expect
_tdd-UL-DL-ConfigurationDedicated_ to indicate as uplink or as downlink a
symbol that _tdd-UL-DL-ConfigurationCommon_ indicates as a downlink or as an
uplink symbol, respectively.
For each slot configuration provided by _tdd-UL-DL-ConfigurationDedicated_ , a
reference SCS configuration is the reference SCS configuration
{width="0.25277777777777777in" height="0.21944444444444444in"} provided by
_tdd-UL-DL-ConfigurationCommon_.
A slot configuration period and a number of downlink symbols, uplink symbols,
and flexible symbols in each slot of the slot configuration period are
determined from _tdd-UL-DL-ConfigurationCommon_ and _tdd-UL-DL-
ConfigurationDedicated_ and are common to each configured BWP.
A UE considers symbols in a slot indicated as downlink by _tdd-UL-DL-
ConfigurationCommon_ , or _tdd-UL-DL-ConfigurationDedicated_ to be available
for receptions and considers symbols in a slot indicated as uplink by _tdd-UL-
DL-ConfigurationCommon_ , or by _tdd_ -_UL-DL-ConfigurationDedicated_ to be
available for transmissions.
If a UE is not configured to monitor PDCCH for DCI format 2_0, for a set of
symbols of a slot that are indicated as flexible by _tdd-UL-DL-
ConfigurationCommon_ and _tdd_ -_UL-DL-ConfigurationDedicated_ if provided, or
when _tdd-UL-DL-ConfigurationCommon_ and _tdd_ -_UL-DL-ConfigurationDedicated_
are not provided to the UE
\- the UE receives PDSCH or CSI-RS in the set of symbols of the slot if the UE
receives a corresponding indication by a DCI format
\- the UE transmits PUSCH, PUCCH, PRACH, or SRS in the set of symbols of the
slot if the UE receives a corresponding indication by a DCI format, a RAR UL
grant, fallbackRAR UL grant, or successRAR
For operation on a single carrier in unpaired spectrum, if a UE is configured
by higher layers to receive a PDCCH, or a PDSCH, or a CSI-RS, or a DL PRS in a
set of symbols of a slot, the UE receives the PDCCH, the PDSCH, the CSI-RS, or
the DL PRS if the UE does not detect a DCI format that indicates to the UE to
transmit a PUSCH, a PUCCH, a PRACH, or a SRS in at least one symbol of the set
of symbols of the slot; otherwise, the UE does not receive the PDCCH, or the
PDSCH, or the CSI-RS, or the DL PRS in the set of symbols of the slot.
For a UE operation with shared spectrum channel access in FR1, or in FR2-2
when the UE is provided _ChannelAccessMode2_ = \'_enabled_ \', if the UE is
provided _csi-RS-ValidationWithDCI_ , is not provided _CO-DurationsPerCell_ ,
and is not provided _SlotFormatCombinationsPerCell_ , and if the UE is
configured by higher layers to receive a CSI-RS in a set of symbols of a slot,
the UE cancels the CSI-RS reception in the set of symbols of the slot if the
UE does not detect a DCI format indicating an aperiodic CSI-RS reception or
scheduling a PDSCH reception in the set of symbols of the slot.
If a UE is provided _channelAccessMode =\'dynamic\' and is provided
availableRB-SetsToAddModList_ and _availableRB-SetsToReleaseList_ , _the UE
expects to be provided co-DurationsPerCellToAddModList_ and _co-
DurationsPerCellToReleaseList_ and/or _slotFormatCombToAddModList_ and
_slotFormatCombToReleaseList._
For operation on a single carrier in unpaired spectrum, if a UE is configured
by higher layers to transmit SRS, or PUCCH, or PUSCH, or PRACH in a set of
symbols of a slot and the UE detects a DCI format indicating to the UE to
receive CSI-RS or PDSCH in a subset of symbols from the set of symbols, then
\- If the UE does not indicate the capability of [partialCancellation], the UE
does not expect to cancel the transmission of the PUCCH or PUSCH or PRACH in
the set of symbols if the first symbol in the set occurs within $T_{proc,2\ }$
relative to a last symbol of a PDCCH reception where the UE detects the DCI
format; otherwise, the UE cancels the PUCCH, or the PUSCH, or an actual
repetition of the PUSCH [6, TS 38.214], determined from clauses 9, 9.2.5 and
9.2.6 or clause 6.1 of [6, TS 38.214], or the PRACH transmission in the set of
symbols.
\- If the UE indicates the capability of [partialCancellation], the UE does
not expect to cancel the transmission of the PUCCH or PUSCH or PRACH in
symbols from the set of symbols that occur within $T_{proc,2}$ relative to a
last symbol of a PDCCH reception where the UE detects the DCI format. The UE
cancels the PUCCH, or the PUSCH, or an actual repetition of the PUSCH [6, TS
38.214], determined from clauses 9, 9.2.5 and 9.2.6 or clause 6.1 of [6, TS
38.214], or the PRACH transmission in remaining symbols from the set of
symbols.
\- The UE does not expect to cancel the transmission of SRS in symbols from
the subset of symbols that occur within $T_{proc,2}$ relative to a last symbol
of a PDCCH reception where the UE detects the DCI format. The UE cancels the
SRS transmission in remaining symbols from the subset of symbols.
$T_{proc,2}$ is the PUSCH preparation time for the corresponding UE processing
capability [6, TS 38.214] assuming $d_{2,1} = 1$ and $\mu$ corresponds to the
smallest SCS configuration between the SCS configuration of the PDCCH carrying
the DCI format and the SCS configuration of the SRS, PUCCH, PUSCH or
$\mu_{r}$, where $\mu_{r}$ corresponds to the SCS configuration of the PRACH
if it is 15kHz or higher; otherwise $\mu_{r} = 0$.
For a set of symbols of a slot that are indicated to a UE as uplink by _tdd-
UL-DL-ConfigurationCommon_ , or _tdd-UL-DL-ConfigurationDedicated_ , the UE
does not receive PDCCH, PDSCH, or CSI-RS when the PDCCH, PDSCH, or CSI-RS
overlaps, even partially, with the set of symbols of the slot.
For a set of symbols of a slot that are indicated to a UE as uplink by _tdd-
UL-DL-ConfigurationCommon_ , or _tdd-UL-DL-ConfigurationDedicated_ , the UE
does not receive DL PRS in the set of symbols of the slot, if the UE is not
provided with a measurement gap.
For a set of symbols of a slot that are indicated to a UE as downlink by _tdd-
UL-DL-ConfigurationCommon_ , or _tdd-UL-DL-ConfigurationDedicated_ , the UE
does not transmit PUSCH, PUCCH, PRACH, or SRS when the PUSCH, PUCCH, PRACH, or
SRS overlaps, even partially, with the set of symbols of the slot.
For a set of symbols of a slot that are indicated to a UE as flexible by _tdd-
UL-DL-ConfigurationCommon_ , and _tdd-UL-DL-ConfigurationDedicated_ if
provided, the UE does not expect to receive both dedicated higher layer
parameters configuring transmission from the UE in the set of symbols of the
slot and dedicated higher layer parameters configuring reception by the UE in
the set of symbols of the slot.
For operation on a single carrier in unpaired spectrum, for a set of symbols
of a slot indicated to a UE for reception of SS/PBCH blocks by _ssb-
PositionsInBurst_ in _SIB1_ or by _ssb-PositionsInBurst_ in
_ServingCellConfigCommon or,_ if the UE is not provided _dl-OrJointTCI-
StateList_ , by _ssb-PositionsInBurst_ in _SSB-MTCAdditionalPCI_ associated to
physical cell ID with active TCI states for PDCCH or PDSCH, or for a set of
symbols of a slot corresponding to SS/PBCH blocks configured for L1 beam
measurement/reporting, the UE does not transmit PUSCH, PUCCH, PRACH in the
slot if a transmission would overlap with any symbol from the set of symbols
and the UE does not transmit SRS in the set of symbols of the slot. The UE
does not expect the set of symbols of the slot to be indicated as uplink by
_tdd-UL-DL-ConfigurationCommon_ , or _tdd-UL-DL-ConfigurationDedicated_ , when
provided to the UE.
If a UE
\- is configured with multiple serving cells and is provided with
_directionalCollisionHandling-r16_ = \'enabled\' for a set of serving cell(s)
among the multiple serving cells, and
\- indicates support of _half-DuplexTDD-CA-SameSCS-r16_ capability, and
\- is not configured to monitor PDCCH for detection of DCI format 2_0 on any
of the multiple serving cells,
for a set of symbols of a slot that are indicated to the UE for reception of
SS/PBCH blocks in a first cell of the multiple serving cells by _ssb-
PositionsInBurst_ in _SystemInformationBlockType1_ or by _ssb-
PositionsInBurst_ in _ServingCellConfigCommon_ or, if the UE is not provided
_dl-OrJointTCI-StateList_ , by _ssb-PositionsInBurst_ in _SSB-
MTCAdditionalPCI_ associated to physical cell ID with active TCI states for
PDCCH or PDSCH, or for a set of symbols of a slot corresponding to SS/PBCH
blocks configured for L1 beam measurement/reporting, the UE does not transmit
PUSCH, PUCCH, or PRACH in the slot if a transmission would overlap with any
symbol from the set of symbols, and the UE does not transmit SRS in the set of
symbols of the slot in
\- any of the multiple serving cells if the UE is not capable of simultaneous
transmission and reception as indicated by _simultaneousRxTxInterBandCA_ among
the multiple serving cells, and
\- any one of the cells corresponding to the same band as the first cell,
irrespective of any capability indicated by _simultaneousRxTxInterBandCA_.
For a set of symbols of a slot corresponding to a valid PRACH occasion and
symbols before the valid PRACH occasion, as described in clause 8.1, the UE
does not receive PDCCH, PDSCH, or CSI-RS in the slot if a reception would
overlap with any symbol from the set of symbols. The UE does not expect the
set of symbols of the slot to be indicated as downlink by _tdd-UL-DL-
ConfigurationCommon_ or _tdd-UL-DL-ConfigurationDedicated_.
For a set of symbols of a slot indicated to a UE by _pdcch-ConfigSIB1_ in
_MIB_ for a CORESET for Type0-PDCCH CSS set, the UE does not expect the set of
symbols to be indicated as uplink by _tdd-UL-DL-ConfigurationCommon_ , or
_tdd-UL-DL-ConfigurationDedicated_.
If a UE is scheduled by a DCI format to receive PDSCH over multiple slots, and
if _tdd-UL-DL-ConfigurationCommon_ , or _tdd-UL-DL-ConfigurationDedicated_ ,
indicate that, for a slot from the multiple slots, at least one symbol from a
set of symbols where the UE is scheduled PDSCH reception in the slot is an
uplink symbol, the UE does not receive the PDSCH in the slot.
If a UE is scheduled by a DCI format to transmit PUSCH over multiple slots,
and if _tdd-UL-DL-ConfigurationCommon_ , or _tdd-UL-DL-ConfigurationDedicated_
, indicates that, for a slot from the multiple slots, at least one symbol from
a set of symbols where the UE is scheduled PUSCH transmission in the slot is a
downlink symbol, the UE does not transmit the PUSCH in the slot.
If a UE
\- is configured with multiple serving cells and is provided with
_directionalCollisionHandling-r16_ = \'enabled\' for a set of serving cell(s)
among the configured multiple serving cells, and
\- indicates support of _half-DuplexTDD-CA-SameSCS-r16_ capability, and
\- is not configured to monitor PDCCH for detection of DCI format 2_0 on any
of the multiple serving cells,
the UE determines a reference cell for a symbol as an active cell with the
smallest cell index among
\- the configured multiple serving cells if the UE is not capable of
simultaneous transmission and reception as indicated by
_simultaneousRxTxInterBandCA_ among the multiple serving cells, and
\- the cells of each band respectively if the UE is capable of simultaneous
transmission and reception by _simultaneousRxTxInterBandCA_ for the configured
multiple serving cells,
where the symbol is configured as
\- downlink, or uplink, as indicated by _tdd-UL-DL-ConfigurationCommon_ or
_tdd-UL-DL-ConfigurationDedicated_
\- uplink, if the symbol is flexible and the UE is **configured to transmit**
SRS, PUCCH, PUSCH, or PRACH on the symbol
\- downlink, if the symbol is flexible and the UE is configured to receive
PDCCH, PDSCH or CSI-RS on the symbol.
And if another cell among the cells configured with
**_directionalCollisionHandling-r16_** operates in the same frequency band as
the reference cell, the UE does not expect
\- a symbol to be indicated as downlink or uplink on the reference cell and as
uplink or downlink on another cell, respectively, by _tdd-UL-DL-
ConfigurationCommon_ or by _tdd-UL-DL-ConfigurationDedicated_ ,
\- _tdd-UL-DL-ConfigurationCommon_ or _tdd-UL-DL-ConfigurationDedicated_ to
indicate a symbol as downlink on the reference cell and to detect a DCI format
scheduling a transmission on the symbol on another cell, and
\- to be configured by **higher layers to receive** PDCCH, PDSCH, or CSI-RS on
a flexible symbol on the reference cell and to detect a DCI format scheduling
a transmission on the symbol on another cell,
if the reference cell and another cell among the cells configured with
**_directionalCollisionHandling-r16_** operate in different frequency bands,
the UE
\- assumes symbol as flexible, is not required to receive higher layer
configured PDCCH, PDSCH, or CSI-RS and not expected to transmit higher layer
configured SRS, PUCCH, PUSCH, or PRACH, when _tdd-UL-DL-ConfigurationCommon_
or _tdd-UL-DL-ConfigurationDedicated_ indicates symbol as downlink or uplink
on another cell and as uplink or downlink for the reference cell,
respectively,
\- transmits a signal/channel scheduled by a DCI format on a symbol of another
cell when the symbol is indicated as downlink by _tdd-UL-DL-
ConfigurationCommon_ or _tdd-UL-DL-ConfigurationDedicated_ for the reference
cell,
\- is not required to receive a higher layer configured PDCCH, PDSCH, or CSI-
RS on flexible symbols on the reference cell in a set of symbols, if the UE
detects a DCI format scheduling a transmission on one or more symbols in the
set of symbols on another cell,
and regardless of whether the reference cell and another cell operate in same
or different frequency bands,
the UE
\- does not expect _tdd-UL-DL-ConfigurationCommon_ or _tdd-UL-DL-
ConfigurationDedicated_ for the reference cell to indicate a symbol as uplink
and to detect a DCI format scheduling a reception on the symbol on another
cell
\- does not expect to be configured by higher layers to transmit SRS, PUCCH,
PUSCH, or PRACH on a flexible symbol on the reference cell and to detect a DCI
format scheduling a reception on the symbol on another cell
\- does not transmit a PUCCH, PUSCH or PRACH that is configured by higher
layers on a set of symbols on another cell if at least one symbol from the set
of symbols is indicated as downlink by _tdd-UL-DL-ConfigurationCommon_ or
_tdd-UL-DL-ConfigurationDedicated_ or is a symbol corresponding to a PDCCH,
PDSCH, or CSI-RS reception that is configured by higher layers on the
reference cell
\- does not transmit a SRS that is configured by higher layers on a set of
symbols on another cell if the set of symbols is indicated as downlink by
_tdd-UL-DL-ConfigurationCommon_ or _tdd-UL-DL-ConfigurationDedicated_ or
corresponds to a PDCCH, PDSCH or CSI-RS reception that is configured by higher
layers on the reference cell
\- does not receive a PDCCH, PDSCH or CSI-RS that is configured by higher
layers on a set of symbols on another cell if at least one symbol from the set
of symbols is indicated as uplink by _tdd-UL-DL-ConfigurationCommon_ or _tdd-
UL-DL-ConfigurationDedicated_ or is a symbol corresponding to a SRS, PUCCH,
PUSCH, or PRACH transmission that is configured by higher layers on the
reference cell
\- assumes a symbol indicated as downlink or uplink by _tdd-UL-DL-
ConfigurationCommon_ or _tdd-UL-DL-ConfigurationDedicated_ on another cell to
be flexible, if the UE is respectively configured by higher layers to transmit
SRS, PUCCH, PUSCH, or PRACH or to receive PDCCH, PDSCH, or CSI-RS on the
reference cell
\- does not expect to detect a first DCI format scheduling a transmission or
reception on a symbol on a first cell and a second DCI format scheduling a
reception or transmission on the symbol on a second cell, respectively.
After the UE applies the procedures described above for directional collision
handling within the set of cells that have been configured with
_directionalCollisionHandling-r16_ , the UE does not expect any directional
collision among the serving cells that the UE is not capable of simultaneous
transmission and reception.
### 11.1.1 UE procedure for determining slot format
This clause applies for a serving cell that is included in a set of serving
cells configured to a UE by _slotFormatCombToAddModList_ and
_slotFormatCombToReleaseList_ , _availableRB-SetsToAddModList_ and
_availableRB-SetsToReleaseList_ , _switchTriggerToAddModList_ and
_switchTriggerToReleaseList_ , or _co-DurationsPerCellToAddModList_ and _co-
DurationsPerCellToReleaseList_.
If a UE is configured by higher layers with parameter _SlotFormatIndicator_ ,
the UE is provided an SFI-RNTI by _sfi-RNTI_ and with a payload size of DCI
format 2_0 by _dci-PayloadSize_.
The UE is also provided in one or more serving cells with a configuration for
a search space set {width="0.13541666666666666in"
height="0.13541666666666666in"} and a corresponding CORESET $p$ for monitoring
$M_{p,s}^{\left( L_{\text{SFI}} \right)}$ PDCCH candidates for DCI format 2_0
with a CCE aggregation level of $L_{\text{SFI}}$ CCEs as described in clause
10.1. The $M_{p,s}^{\left( L_{\text{SFI}} \right)}$ PDCCH candidates are the
first $M_{p,s}^{\left( L_{\text{SFI}} \right)}$ PDCCH candidates _for CCE
aggregation level_ $L_{\text{SFI}}$ for search space set $s$ in CORESET $p$.
For each serving cell in the set of serving cells, the UE can be provided:
\- an identity of the serving cell by _servingCellId_
\- a location of a SFI-index field in DCI format 2_0 by _positionInDCI_
\- a set of slot format combinations by _slotFormatCombinations_ , where each
slot format combination in the set of slot format combinations includes
\- one or more slot formats indicated by a respective _slotFormats_ for the
slot format combination, and
\- a mapping for the slot format combination provided by _slotFormats_ to a
corresponding SFI-index field value in DCI format 2_0 provided by
_slotFormatCombinationId_
\- for unpaired spectrum operation, a reference SCS configuration
$\mu_{\text{SFI}}$ by _subcarrierSpacing_ and, when a supplementary UL carrier
is configured for the serving cell, a reference SCS configuration
$\mu_{SFI,SUL}$ by _subcarrierSpacing2_ for the supplementary UL carrier
\- for paired spectrum operation, a reference SCS configuration $\mu_{SFI,DL}$
for a DL BWP by _subcarrierSpacing_ and a reference SCS configuration
$\mu_{SFI,UL}$ for an UL BWP by _subcarrierSpacing2_
\- a location of an available RB set indicator field in DCI format 2_0, by
_availableRB-SetsPerCell_ , where the field is
\- one bit, if _intraCellGuardBandsDL-List_ for the serving cell indicates no
intra-cell guard-bands are configured, where a value of \'1\' indicates that
the serving cell is available for receptions, a value of \'0\' indicates that
the serving cell is not available for receptions, and the serving cell remains
available or unavailable for reception until the end of the remaining channel
occupancy duration; or,
\- a bitmap having a one-to-one mapping with the RB sets [6, TS 38.214] of the
serving cell, if _intraCellGuardBandsDL-List_ for the serving cell indicates
intra-cell guard-bands are configured or if _intraCellGuardBandsDL-List_ is
not provided for the serving cell, where the bitmap includes $N_{RB,set,DL}$
bits and $N_{RB,set,DL}$ is the number of RB sets in the serving cell, a value
of \'1\' indicates that an RB set is available for receptions, a value of
\'0\' indicates that an RB set is not available for receptions, _and a RB set
remains available or unavailable for receptions until the end of the_
remaining _channel occupancy duration_
\- a location of a channel occupancy duration field in DCI format 2_0, by _CO-
DurationsPerCell_ , where the field indicates a remaining channel occupancy
duration for the serving cell starting from a first symbol of a slot where the
UE detects the DCI format 2_0 by providing a value from _co-DurationList_. The
channel occupancy duration field includes $\max\left{ \left\lceil
\log_{2}\left( \text{COdurationListSize} \right) \right\rceil,1 \right}$ bits,
where $\text{COdurationListSize}$ is the number of values provided by _co-
DurationList_. If _CO-DurationsPerCell_ is not provided, the remaining channel
occupancy duration for the serving cell is a number of slots, starting from
the slot where the UE detects the DCI format 2_0, that the SFI-index field
value provides corresponding slot formats
\- a reference SCS configuration for _co-DurationList_ , by
_subcarrierSpacing_
\- a location of a search space set group switching flag field in DCI format
2_0, by _SearchSpaceSwitchTrigger_ , where the field indicates a group from
two groups of search space sets for PDCCH monitoring for scheduling for the
serving cell or the set of serving cells, provided by _CellGroupsForSwitching_
, as described in clause 10.4.
If neither _CO-DurationsPerCell_ nor _SlotFormatCombinationsPerCell_ are
provided and if _channelAccessMode_ = _\"semiStatic\"_ is provided, the
procedures in this clause apply with assuming a channel occupancy time defined
in clause 4.3 of [15, TS 37.213] is the remaining channel occupancy duration
if a DL transmission burst(s) is detected within the channel occupancy time.
A SFI-index field value in a DCI format 2_0 indicates to a UE a slot format
for each slot in a number of slots for each DL BWP or each UL BWP starting
from a slot where the UE detects the DCI format 2_0. The number of slots is
equal to or larger than a PDCCH monitoring periodicity for DCI format 2_0. The
SFI-index field includes bits where maxSFIindex is the maximum value of the
values provided by corresponding _slotFormatCombinationId_. A slot format is
identified by a corresponding format index as provided in Table 11.1.1-1 where
\'D\' denotes a downlink symbol, \'U\' denotes an uplink symbol, and \'F\'
denotes a flexible symbol.
If a PDCCH monitoring periodicity for DCI format 2_0, provided to a UE for the
search space set by _monitoringSlotPeriodicityAndOffset_ , is smaller than a
duration of a slot format combination the UE obtains at a PDCCH monitoring
occasion for DCI format 2_0 by a corresponding SFI-index field value, and the
UE detects more than one DCI formats 2_0 indicating a slot format for a slot,
the UE expects each of the more than one DCI formats 2_0 to indicate a same
format for the slot.
A UE does not expect to be configured to monitor PDCCH for DCI format 2_0 on a
second serving cell that uses larger SCS than the serving cell.
Table 11.1.1-1: Slot formats for normal cyclic prefix
**Format** **Symbol number in a slot**
* * *
               **0**                                                                                                                                                             **1**   **2**   **3**   **4**   **5**   **6**   **7**   **8**   **9**   **10**   **11**   **12**   **13**
0 D D D D D D D D D D D D D D 1 U U U U U U U U U U U U U U 2 F F F F F F F F
F F F F F F 3 D D D D D D D D D D D D D F 4 D D D D D D D D D D D D F F 5 D D
D D D D D D D D D F F F 6 D D D D D D D D D D F F F F 7 D D D D D D D D D F F
F F F 8 F F F F F F F F F F F F F U 9 F F F F F F F F F F F F U U 10 F U U U U
U U U U U U U U U 11 F F U U U U U U U U U U U U 12 F F F U U U U U U U U U U
U 13 F F F F U U U U U U U U U U 14 F F F F F U U U U U U U U U 15 F F F F F F
U U U U U U U U 16 D F F F F F F F F F F F F F 17 D D F F F F F F F F F F F F
18 D D D F F F F F F F F F F F 19 D F F F F F F F F F F F F U 20 D D F F F F F
F F F F F F U 21 D D D F F F F F F F F F F U 22 D F F F F F F F F F F F U U 23
D D F F F F F F F F F F U U 24 D D D F F F F F F F F F U U 25 D F F F F F F F
F F F U U U 26 D D F F F F F F F F F U U U 27 D D D F F F F F F F F U U U 28 D
D D D D D D D D D D D F U 29 D D D D D D D D D D D F F U 30 D D D D D D D D D
D F F F U 31 D D D D D D D D D D D F U U 32 D D D D D D D D D D F F U U 33 D D
D D D D D D D F F F U U 34 D F U U U U U U U U U U U U 35 D D F U U U U U U U
U U U U 36 D D D F U U U U U U U U U U 37 D F F U U U U U U U U U U U 38 D D F
F U U U U U U U U U U 39 D D D F F U U U U U U U U U 40 D F F F U U U U U U U
U U U 41 D D F F F U U U U U U U U U 42 D D D F F F U U U U U U U U 43 D D D D
D D D D D F F F F U 44 D D D D D D F F F F F F U U 45 D D D D D D F F U U U U
U U 46 D D D D D F U D D D D D F U 47 D D F U U U U D D F U U U U 48 D F U U U
U U D F U U U U U 49 D D D D F F U D D D D F F U 50 D D F F U U U D D F F U U
U 51 D F F U U U U D F F U U U U 52 D F F F F F U D F F F F F U 53 D D F F F F
U D D F F F F U 54 F F F F F F F D D D D D D D 55 D D F F F U U U D D D D D D
56 -- 254 Reserved  
255 UE determines the slot format for the slot based on _tdd-UL-DL-
ConfigurationCommon_ , or _tdd-UL-DL-ConfigurationDedicated_ and, if any, on
detected DCI formats
For unpaired spectrum operation for a UE on a serving cell, the UE is provided
by _subcarrierSpacing_ a reference SCS configuration $\mu_{\text{SFI}}$ for
each slot format in a combination of slot formats indicated by an SFI-index
field value in DCI format 2_0. The UE expects that for a reference SCS
configuration $\mu_{\text{SFI}}$ and for an active DL BWP or an active UL BWP
with SCS configuration $\mu$, it is $\mu \geq \mu_{\text{SFI}}$. Each slot
format in the combination of slot formats indicated by the SFI-index field
value in DCI format 2_0 is applicable to $2^{\left( \mu - \mu_{\text{SFI}}
\right)}$ consecutive slots in the active DL BWP or the active UL BWP where
the first slot starts at a same time as a first slot for the reference SCS
configuration $\mu_{\text{SFI}}$ and each downlink or flexible or uplink
symbol for the reference SCS configuration $\mu_{\text{SFI}}$ corresponds to
{width="0.5in" height="0.19791666666666666in"} consecutive downlink or
flexible or uplink symbols for the SCS configuration $\mu$.
For paired spectrum operation for a UE on a serving cell, the SFI-index field
in DCI format 2_0 indicates a combination of slot formats that includes a
combination of slot formats for a reference DL BWP and a combination of slot
formats for a reference UL BWP of the serving cell. The UE is provided by
_subcarrierSpacing_ a reference SCS configuration $\mu_{SFI,DL}$ for the
combination of slot formats indicated by the SFI-index field value in DCI
format 2_0 for the reference DL BWP of the serving cell. The UE is provided by
_subcarrierSpacing2_ a reference SCS configuration $\mu_{SFI,UL}$ for the
combination of slot formats indicated by the SFI-index field value in DCI
format 2_0 for the reference UL BWP of the serving cell. If $\mu_{SFI,DL} \geq
\mu_{SFI,UL}$ and for each $2^{\left( \mu_{SFI,DL} - \mu_{SFI,UL} \right)} +
1$ values provided by a value of _slotFormats_ , where the value of
_slotFormats_ is determined by a value of _slotFormatCombinationId_ in
_slotFormatCombination_ and the value of _slotFormatCombinationId_ is set by
the value of the SFI-index field value in DCI format 2_0, the first $2^{\left(
\mu_{SFI,DL} - \mu_{SFI,UL} \right)}$ values for the combination of slot
formats are applicable to the reference DL BWP and the next value is
applicable to the reference UL BWP. If $\mu_{SFI,DL}  \- If the UE does not indicate the capability of [partialCancellation], the
> UE does not expect to cancel the transmission of the PUCCH or PUSCH or PRACH
> in the set of symbols if the first symbol in the set occurs within
> $T_{proc,2}$ relative to a last symbol of a PDCCH reception where the UE
> detects the DCI format; otherwise, the UE cancels the PUCCH, or the PUSCH,
> or an actual repetition of the PUSCH [6, TS 38.214], determined from clauses
> 9, 9.2.5 and 9.2.6 or clause 6.1 of [6, TS 38.214], or the PRACH
> transmission in the set of symbols.
\- If the UE indicates the capability of [partialCancellation], the UE does
not expect to cancel the transmission of the PUCCH or PUSCH or PRACH in
symbols from the set of symbols that occur within $T_{proc,2}$ relative to a
last symbol of a PDCCH reception where the UE detects the DCI format. The UE
cancels the PUCCH, or the PUSCH, or an actual repetition of the PUSCH [6, TS
38.214], determined from clauses 9, 9.2.5 and 9.2.6 or clause 6.1 of [6, TS
38.214], or the PRACH transmission in remaining symbols from the set of
symbols.
\- The UE does not expect to cancel the transmission of SRS in symbols from
the subset of symbols that occur within $T_{proc,2}$ relative to a last symbol
of a PDCCH reception where the UE detects the DCI format. The UE cancels the
SRS transmission in remaining symbols from the subset of symbols.
$T_{proc,2}$ is the PUSCH preparation time for the corresponding UE processing
capability [6, TS 38.214] assuming $d_{2,1} = 1$ and $\mu$ corresponds to the
smallest SCS configuration between the SCS configuration of the PDCCH carrying
the DCI format and the SCS configuration of the SRS, PUCCH, PUSCH or
$\mu_{r}$, where $\mu_{r}$ corresponds to the SCS configuration of the PRACH
if it is 15kHz or higher; otherwise $\mu_{r} = 0$.
If a UE is configured by higher layers to receive a CSI-RS or detects a DCI
format 0_1 indicating to the UE to receive a CSI-RS in one or more RB sets and
a set of symbols of a slot, and the UE detects a DCI format 2_0 with bitmap
indicating that any RB set from the one or more RB sets is not available for
reception, the UE cancels the CSI-RS reception in the set of symbols of the
slot.
A UE assumes that flexible symbols in a CORESET configured to the UE for PDCCH
monitoring are downlink symbols if the UE does not detect an SFI-index field
value in DCI format 2_0 indicating the set of symbols of the slot as flexible
or uplink and the UE does not detect a DCI format indicating to the UE to
transmit SRS, PUSCH, PUCCH, or PRACH in the set of symbols.
For a set of symbols of a slot that are indicated as flexible by _tdd-UL-DL-
ConfigurationCommon_ , and _tdd-UL-DL-ConfigurationDedicated_ if provided, or
when _tdd-UL-DL-ConfigurationCommon_ , and _tdd-UL-DL-ConfigurationDedicated_
are not provided to the UE, and if the UE does not detect a DCI format 2_0
providing a slot format for the slot
\- the UE receives PDSCH or CSI-RS in the set of symbols of the slot if the UE
receives a corresponding indication by a DCI format
\- the UE transmits PUSCH, PUCCH, PRACH, or SRS in the set of symbols of the
slot if the UE receives a corresponding indication by a DCI format, a RAR UL
grant, fallbackRAR UL grant, or successRAR
\- the UE receives PDCCH as described in clause 10.1
\- if the UE is configured by higher layers to receive PDSCH in the set of
symbols of the slot, the UE does not receive the PDSCH in the set of symbols
of the slot
\- if the UE is configured by higher layers to receive CSI-RS in the set of
symbols of the slot, the UE does not receive the CSI-RS in the set of symbols
of the slot, except when UE is provided _CO-DurationsPerCell_ and the set of
symbols of the slot are within the remaining channel occupancy duration.
\- if the UE is configured by higher layers to receive DL PRS in the set of
symbols of the slot, the UE receives the DL PRS
\- if the UE is configured by higher layers to transmit SRS, or PUCCH, or
PUSCH, or PRACH in the set of symbols of the slot and the UE is not provided
_enableConfiguredUL_ , then
\- if the UE does not indicate the capability of [partialCancellation], the UE
does not expect to cancel the transmission of the PUCCH, or the PUSCH, or an
actual repetition of the PUSCH [6, TS 38.214], as determined in clauses 9,
9.2.5 and 9.2.6 or in clause 6.1 of [6. TS 38.214], or the PRACH in the slot
if the first symbol of the PUCCH or the PUSCH or actual repetition of the
PUSCH or the PRACH in the slot occurs within $T_{proc,2}$ relative to a last
symbol of a PDCCH reception where the UE is configured to monitor PDCCH for
DCI format 2_0; otherwise, the UE cancels the PUCCH, or the PUSCH, or an
actual repetition of the PUSCH [6, TS 38.214], as determined in clauses 9,
9.2.5 and 9.2.6 or in clause 6.1 of [6. TS 38.214], or the PRACH in the slot;
\- if the UE indicates the capability of [partialCancellation], the UE does
not expect to cancel the transmission of the PUCCH, or the PUSCH, or an actual
repetition of the PUSCH [6, TS 38.214], as determined in clauses 9, 9.2.5 and
9.2.6 or in clause 6.1 of [6. TS 38.214], or the PRACH in symbols from the set
of symbols that occur within $T_{proc,2}$ relative to a last symbol of a PDCCH
reception where the UE is configured to monitor PDCCH for DCI format 2_0. The
UE cancels the PUCCH, or the PUSCH, or an actual repetition of the PUSCH [6,
TS 38.214], as determined in clauses 9, 9.2.5 and 9.2.6 or in clause 6.1 of
[6. TS 38.214], or the PRACH transmission in remaining symbols from the set of
symbols;
\- the UE does not expect to cancel the transmission of SRS in symbols from
the set of symbols that occur within $T_{proc,2}\ $relative to a last symbol
of a PDCCH reception where the UE is configured to monitor PDCCH for DCI
format 2_0. The UE cancels the SRS transmission in remaining symbols from the
set of symbols;
\- $T_{proc,2}$ is the PUSCH preparation time for the corresponding UE
processing capability [6, TS 38.214] assuming $d_{2,1} = 1$ and $\mu$
corresponds to the smallest SCS configuration between the SCS configuration of
the PDCCH carrying the DCI format 2_0 and the SCS configuration of the SRS,
PUCCH, PUSCH or $\mu_{r}$, where $\mu_{r}$ corresponds to the SCS
configuration of the PRACH if it is 15kHz or higher; otherwise $\mu_{r} = 0$;
\- if the UE is configured by higher layers to transmit SRS, or PUCCH, or
PUSCH, or PRACH in the set of symbols of the slot and the UE is provided
_enableConfiguredUL_ , the UE can transmit the SRS, or PUCCH, or PUSCH, or
PRACH, respectively.
For unpaired spectrum operation for a UE on a cell in a frequency band of FR1,
and when the scheduling restrictions due to RRM measurements [10, TS 38.133]
are not applicable, if the UE detects a DCI format indicating to the UE to
transmit in a set of symbols, the UE is not required to perform RRM
measurements [10, TS 38.133] based on a SS/PBCH block or CSI-RS reception on a
different cell in the frequency band if the SS/PBCH block or CSI-RS reception
includes at least one symbol from the set of symbols.
## 11.2 Interrupted transmission indication
If a UE is provided _DownlinkPreemption_ , the UE is configured with an INT-
RNTI provided by _int-RNTI_ for monitoring PDCCH conveying DCI format 2_1 [5,
TS 38.212]. The UE is additionally configured with
\- a set of serving cells by _int-ConfigurationPerServingCell_ that includes a
set of serving cell indexes provided by corresponding _servingCellId_ and a
corresponding set of locations for fields in DCI format 2_1 by _positionInDCI_
\- an information payload size for DCI format 2_1 by _dci-PayloadSize_
\- an indication granularity for time-frequency resources by
_timeFrequencySet_
If a UE detects a DCI format 2_1 for a serving cell from the configured set of
serving cells, the UE may assume that no transmission to the UE is present in
PRBs and in symbols that are indicated by the DCI format 2_1, from a set of
PRBs and a set of symbols of the last monitoring period. The indication by the
DCI format 2_1 is not applicable to receptions of SS/PBCH blocks.
The set of PRBs is equal to the active DL BWP as defined in clause 12 and
includes PRBs.
If a UE detects a DCI format 2_1 in a PDCCH reception in a slot, the set of
symbols is the last symbols prior to the first symbol of the PDCCH reception
in the slot where is the PDCCH monitoring periodicity provided by the value of
_monitoringSlotPeriodicityAndOffset,_ as described in clause 10.1, is the
number of symbols per slot, is the SCS configuration for a serving cell with
mapping to a respective field in the DCI format 2_1, is the SCS configuration
of the DL BWP where the UE receives the PDCCH with the DCI format 2_1. If the
UE is provided _tdd-UL-DL-ConfigurationCommon_ , symbols indicated as uplink
by _tdd-UL-DL-ConfigurationCommon_ are excluded from the last symbols prior to
the first symbol of the PDCCH reception in the slot. The resulting set of
symbols includes a number of symbols that is denoted as .
The UE does not expect to be provided values of , , and resulting to a value
of that is not an integer. The UE does not expect to be configured by
_monitoringSymbolsWithinSlot_ with more than one PDCCH monitoring occasion for
DCI format 2_1 in a slot.
A UE is provided the indication granularity for the set of PRBs and for the
set of symbols by _timeFrequencySet_.
If the value of _timeFrequencySet_ is \'set0\', 14 bits from MSB of a field in
DCI format 2_1 have a one-to-one mapping with 14 groups of consecutive symbols
from the set of symbols where each of the first symbol groups includes
symbols, each of the last symbol groups includes symbols, a bit value of 0
indicates transmission to the UE in the corresponding symbol group and a bit
value of 1 indicates no transmission to the UE in the corresponding symbol
group.
If the value of _timeFrequencySet_ is \'set1\', 7 pairs of bits from MSB of a
field in the DCI format 2_1 have a one-to-one mapping with 7 groups of
consecutive symbols where each of the first symbol groups includes symbols,
each of the last symbol groups includes symbols, a first bit in a pair of bits
for a symbol group is applicable to the subset of first PRBs from the set of
PRBs, a second bit in the pair of bits for the symbol group is applicable to
the subset of last PRBs from the set of PRBs, a bit value of 0 indicates
transmission to the UE in the corresponding symbol group and subset of PRBs,
and a bit value of 1 indicates no transmission to the UE in the corresponding
symbol group and subset of PRBs.
## 11.2A Cancellation indication
If a UE is provided _UplinkCancellation_ , the UE is provided, in one or more
serving cells, search space sets for monitoring the first PDCCH candidate with
a CCE aggregation level of $L_{\text{CI}}$ CCEs of each search space set for
detection of a DCI format 2_4 [5, TS 38.212] with a CI-RNTI provided by _ci-
RNTI_ as described in clause 10.1. _UplinkCancellation_ additionally provides
to the UE
\- a set of serving cells, by _ci-ConfigurationPerServingCell,_ that includes
a set of serving cell indexes and a corresponding set of locations for fields
in DCI format 2_4 by _positionInDCI_
\- a number of fields in DCI format 2_4, by _positionInDCI-forSUL_ , for each
serving cell for a SUL carrier, if the serving cell is configured with a SUL
carrier
\- an information payload size for DCI format 2_4 by _dci-PayloadSize-ForCI_
\- an indication for time-frequency resources by _timeFrequencyRegion_
For a serving cell having an associated field in a DCI format 2_4, for the
field denote by
\- $N_{\text{CI}}$ a number of bits provided by _ci-PayloadSize_
\- $B_{\text{CI}}$ a number of PRBs provided by _frequencyRegionforCI_ in
_timeFrequencyRegion_
\- $T_{\text{CI}}$ a number of symbols, excluding symbols for reception of
SS/PBCH blocks and DL symbols indicated by _tdd-UL-DL-ConfigurationCommon_ ,
from a number of symbols that
\- is provided by _timeDurationforCI_ in _timeFrequencyRegion,_ if the PDCCH
monitoring periodicity for the search space set with the DCI format 2_4 is one
slot and there are more than one PDCCH monitoring occasions in a slot, or
\- is equal to the PDCCH monitoring periodicity, otherwise.
\- $G_{\text{CI}}$ a number of partitions for the $T_{\text{CI}}$ symbols
provided by _timeGranularityforCI_ in _timeFrequencyRegion_
$G_{\text{CI}}$ sets of bits from the MSB of the $N_{\text{CI}}$ bits have a
one-to-one mapping with $G_{\text{CI}}$ groups of symbols where each of the
first $G_{\text{CI}} - T_{\text{CI}} + \left\lfloor
\frac{T_{\text{CI}}}{G_{\text{CI}}} \right\rfloor \cdot G_{\text{CI}}$ groups
includes $\left\lfloor \frac{T_{\text{CI}}}{G_{\text{CI}}} \right\rfloor$
symbols and each of the remaining $T_{\text{CI}} - \left\lfloor
\frac{T_{\text{CI}}}{G_{\text{CI}}} \right\rfloor \cdot G_{\text{CI}}$ groups
includes $\left\lceil \frac{T_{\text{CI}}}{G_{\text{CI}}} \right\rceil$
symbols. A UE determines a symbol duration with respect to a SCS configuration
of an active DL BWP where the UE monitors PDCCH for DCI format 2_4 detection.
For a group of symbols, $N_{\text{BI}} = \frac{N_{\text{CI}}}{G_{\text{CI}}}$
bits from MSB of each set of bits have a one-to-one mapping with
$N_{\text{BI}}$ groups of PRBs where each of the first $N_{\text{BI}} -
B_{\text{CI}} + \left\lfloor \frac{B_{\text{CI}}}{N_{\text{BI}}} \right\rfloor
\cdot N_{\text{BI}}$ groups includes $\left\lfloor
\frac{B_{\text{CI}}}{N_{\text{BI}}} \right\rfloor$ PRBs and each of the
remaining $B_{\text{CI}} - \left\lfloor \frac{B_{\text{CI}}}{N_{\text{BI}}}
\right\rfloor \cdot N_{\text{BI}}$ groups includes $\left\lceil
\frac{B_{\text{CI}}}{N_{\text{BI}}} \right\rceil$ PRBs. A UE determines a
first PRB index as ${N_{\text{RFR}}^{\text{start}} = O}_{\text{carrier}} +
\text{RB}_{\text{start}}$ and a number of contiguous RBs as ${B_{\text{CI}} =
L}_{\text{RB}}\ $ from _frequencyRegionforCI_ that indicates an offset
$\text{RB}_{\text{start}}$ and a length $L_{\text{RB}}$ as RIV according to
[6, TS 38.214], and from _offsetToCarrier_ in _FrequencyInfoUL-SIB_ or
_FrequencyInfoUL_ that indicates $O_{\text{carrier}}$ for a SCS configuration
of an active DL BWP where the UE monitors PDCCH for DCI format 2_4 detection.
An indication by a DCI format 2_4 for a serving cell is applicable to a PUSCH
transmission or an SRS transmission on the serving cell. If the PUSCH
transmission or the SRS transmission is scheduled by a DCI format, the
indication by the DCI format 2_4 is applicable to the PUSCH transmission or
SRS transmission only if the last symbol of the PDCCH reception providing the
DCI format is earlier than the first symbol of the PDCCH reception providing
the DCI format 2_4.
For the serving cell, the UE determines the first symbol of the
$T_{\text{CI}}$ symbols to be the first symbol that is after ${T'}_{proc,2}$
from the end of a PDCCH reception where the UE detects the DCI format 2_4,
where ${T'}_{proc,2}$ is obtained from $T_{proc,2}$ for PUSCH processing
capability 2 [6, TS 38.214] assuming $d_{2,1} = d_{\text{offset}} \cdot
\frac{2^{- \mu_{\text{UL}}}}{2^{- \mu}}$ where $d_{\text{offset}}$ is provided
by _delta_Offset_ , $\mu$ being the smallest SCS configuration between the SCS
configuration of the PDCCH and the smallest _SCS configuration_
$\mu_{\text{UL}}$ _provided in scs-SpecificCarrierList of FrequencyInfoUL or
FrequencyInfoUL-SIB_. The UE does not expect to cancel the PUSCH transmission
or the SRS transmission before a corresponding symbol that is $T_{proc,2}$
assuming that $d_{2,1} = 0$ after a last symbol of the PDCCH reception where
the UE detects the DCI format 2_4.
A UE that detects a DCI format 2_4 for a serving cell cancels a PUSCH
transmission or an actual repetition of a PUSCH transmission [6, TS 38.214] if
the PUSCH transmission is with repetition Type B, as determined in clauses 9
and 9.2.5 or in clause 6.1 of [6, TS 38.214], or an SRS transmission on the
serving cell if, respectively,
\- the transmission is PUSCH with priority 0, if the UE is provided
_uplinkCancellationPriority_ ,
\- a group of symbols, from the $T_{\text{CI}}$ symbols, has at least one bit
value of \'1\' in the corresponding set of $N_{\text{BI}}$ bits in the DCI
format 2_4 and includes a symbol of the (repetition of the) PUSCH transmission
or of the SRS transmission, and
\- a group of PRBs, from the $B_{\text{CI}}$ PRBs, has a corresponding bit
value of \'1\' in the set of bits corresponding to the group of symbols in the
DCI format 2_4 and includes a PRB of the (repetition of the) PUSCH
transmission or of the SRS transmission,
where
\- the cancellation of the (repetition of the) PUSCH transmission includes all
symbols from the earliest symbol of the (repetition of the) PUSCH transmission
that is in a group of symbols having corresponding bit values of \'1\' in the
DCI format 2_4;
\- the cancellation of the SRS transmission includes only symbols that are in
one or more groups of symbols having corresponding bit values of \'1\' in the
DCI format 2_4.
If, based on an indication by a DCI format 2_4, a UE cancels a PUSCH
transmission or an SRS transmission, the UE does not expect to be scheduled by
a second DCI format to transmit a PUSCH or an SRS over symbols that include
symbols of the cancelled PUSCH transmission or SRS transmission, where the
last symbol of the PDCCH reception providing the second DCI format is no
earlier than the first symbol of the PDCCH reception providing the DCI format
2_4.
## 11.3 Group TPC commands for PUCCH/PUSCH
For PUCCH transmission on a serving cell, a UE can be provided
\- a TPC-PUCCH-RNTI for a DCI format 2_2 by _tpc-PUCCH-RNTI_
\- a field in DCI format 2_2 is a TPC command of 2 bits mapping to
$\delta_{\text{PUCCH},b,f,c}$ values as described in clause 7.2.1
\- an index for a location in DCI format 2_2 of a first bit for a TPC command
field for the PCell, or for a carrier of the PCell by _tpc-IndexPCell_
\- an index for a location in DCI format 2_2 of a first bit for a TPC command
field for a PUCCH-sSCell in the primary PUCCH cell group, by _tpc-IndexPUCCH-
sScell_
\- an index for a location in DCI format 2_2 of a first bit for a TPC command
field for the PUCCH-SCell or for a carrier for the PUCCH-SCell by _tpc-
IndexPUCCH-Scell_
\- an index for a location in DCI format 2_2 of a first bit for a TPC command
field for a PUCCH-sSCell in the secondary PUCCH cell group, by _tpc-
IndexPUCCH-sScellSecondaryPUCCHgroup_
\- a mapping for the PUCCH power control adjustment state $l \in \left{ 0,1
\right}$, by a corresponding {0, 1} value of a closed loop index field that is
appended to the TPC command field in DCI format 2_2 if the UE indicates a
capability to support two PUCCH power control adjustment states by
_twoDifferentTPC-Loop-PUCCH_ , and if the UE is configured for two PUCCH power
control adjustment states by _twoPUCCH-PC-AdjustmentStates_
The UE is also provided on a serving cell with a configuration for a search
space set $s$ and a corresponding CORESET $p$ for monitoring PDCCH candidates
for DCI format 2_2 with CRC scrambled by a TPC-PUCCH-RNTI as described in
clause 10.1.
For PUSCH transmission on a serving cell, a UE can be provided
\- a TPC-PUSCH-RNTI for a DCI format 2_2 by _tpc-PUSCH-RNTI_
\- a field in DCI format 2_2 is a TPC command of 2 bits mapping to
$\delta_{\text{PUSCH},b,f,c}$ values as described in clause 7.1.1
\- an index for a location in DCI format 2_2 of a first bit for a TPC command
field for an uplink carrier of the serving cell by _tpc-Index_
\- an index for a location in DCI format 2_2 of a first bit for a TPC command
field for a supplementary uplink carrier of the serving cell by _tpc-IndexSUL_
\- an index of the serving cell by _targetCell_. If _targetCell_ is not
provided, the serving cell is the cell of the PDCCH reception for DCI format
2_2
\- a mapping for the PUSCH power control adjustment state $l \in \left{ 0,1
\right}$, by a corresponding {0, 1} value of a closed loop index field that is
appended to the TPC command field for the uplink carrier or for the
supplementary uplink carrier of the serving cell in DCI format 2_2 if the UE
indicates a capability to support two PUSCH power control adjustment states,
by _twoDifferentTPC-Loop-PUSCH_ , and if the UE is configured for two PUSCH
power control adjustment states by _twoPUSCH-PC-AdjustmentStates_
The UE is also provided for the serving cell of the PDCCH reception for DCI
format 2_2 with a configuration for a search space set $s$ and a corresponding
CORESET $p$ for monitoring PDCCH candidates for DCI format 2_2 with CRC
scrambled by a TPC-PUSCH-RNTI as described in clause 10.1.
## 11.4 SRS switching
DCI format 2_3 is applicable for uplink carrier(s) of serving cells where a UE
is not configured for PUSCH/PUCCH transmission or for uplink carrier(s) of a
serving cell where _srs-PowerControlAdjustmentStates_ indicates a separate
power control adjustment state between SRS transmissions and PUSCH
transmissions.
A UE configured by higher layers with parameter _carrierSwitching_ can be
provided
\- a TPC-SRS-RNTI for a DCI format 2_3 by _tpc-SRS-RNTI_
\- an index of a serving cell where the UE interrupts transmission in order to
transmit SRS on one or more other serving cells by _srs-
SwitchFromServCellIndex_
\- an indication of an uplink carrier where the UE interrupts transmission in
order to transmit SRS on one or more other serving cells by _srs-
SwitchFromCarrier_
\- a DCI format 2_3 field configuration type by _typeA_ or _typeB_
\- for _typeA_ , an index for a set of serving cells is provided by _cc-
SetIndex_ , indexes of serving cells in the set of serving cells are provided
by _cc-IndexInOneCC-Set_ , and a DCI format 2_3 field includes a TPC command
for each serving cell from the set of serving cells and can also include a SRS
request for SRS transmission on the set of serving cells
\- for _typeB_ , DCI format 2_3 field includes a TPC command for a serving
cell index and can also include a SRS request for SRS transmission on the
serving cell
\- an indication for a serving cell for whether or not a field in DCI format
2_3 includes a SRS request by _fieldTypeFormat2-3_ where a value of 0/1
indicates absence/presence of the SRS request -- a mapping for a 2 bit SRS
request to SRS resource sets is as provided in [6, TS 38.214]
\- an index for a location in DCI format 2_3 of a first bit for a field for a
non-supplementary uplink carrier of the serving cell by
_startingBitOfFormat2-3_
\- an index for a location in DCI format 2_3 of a first bit for a field for a
supplementary uplink carrier of the serving cell by
_startingBitOfFormat2-3SUL-v1530_
# 12 Bandwidth part operation
If the UE is configured with a SCG, the UE shall apply the procedures
described in this clause for both MCG and SCG
\- When the procedures are applied for MCG, the terms \'secondary cell\',
\'secondary cells\' , \'serving cell\', \'serving cells\' in this clause refer
to secondary cell, secondary cells, serving cell, serving cells belonging to
the MCG respectively.
\- When the procedures are applied for SCG, the terms \'secondary cell\',
\'secondary cells\', \'serving cell\', \'serving cells\' in this clause refer
to secondary cell, secondary cells (not including PSCell), serving cell,
serving cells belonging to the SCG respectively. The term \'primary cell\' in
this clause refers to the PSCell of the SCG.
A UE configured for operation in bandwidth parts (BWPs) of a serving cell, is
configured by higher layers for the serving cell a set of at most four
bandwidth parts (BWPs) for receptions by the UE (DL BWP set) in a DL bandwidth
by parameter _BWP-Downlink_ or by parameter _initialDownlinkBWP_ with a set of
parameters configured by _BWP-DownlinkCommon_ and _BWP-DownlinkDedicated_ ,
and a set of at most four BWPs for transmissions by the UE (UL BWP set) in an
UL bandwidth by parameter _BWP-Uplink_ or by parameter _initialUplinkBWP_ with
a set of parameters configured by _BWP-UplinkCommon_ and _BWP-
UplinkDedicated_.
For operation with shared spectrum channel access, a UE expects that the BWP
configured by the parameter _initialUplinkBWP_ provided in
_UplinkConfigCommonSIB_ is mapped to only a single RB set.
If a UE is not provided _initialDownlinkBWP_ , an initial DL BWP is defined by
a location and number of contiguous PRBs, starting from a PRB with the lowest
index and ending at a PRB with the highest index among PRBs of a CORESET for
Type0-PDCCH CSS set, and a SCS and a cyclic prefix for PDCCH reception in the
CORESET for Type0-PDCCH CSS set; otherwise, the initial DL BWP is provided by
_initialDownlinkBWP_. For operation on the primary cell or on a secondary
cell, a UE is provided an initial UL BWP by _initialUplinkBWP_. If the UE is
configured with a supplementary UL carrier, the UE can be provided an initial
UL BWP on the supplementary UL carrier by _initialUplinkBWP_.
If a UE has dedicated BWP configuration, the UE can be provided by
_firstActiveDownlinkBWP-Id_ a first active DL BWP for receptions and by
_firstActiveUplinkBWP-Id_ a first active UL BWP for transmissions on a carrier
of the primary cell.
For each DL BWP or UL BWP in a set of DL BWPs or UL BWPs, respectively, the UE
is provided the following parameters for the serving cell as defined in [4, TS
38.211] or [6, TS 38.214]:
\- a SCS by _subcarrierSpacing_
\- a cyclic prefix by _cyclicPrefix_
\- a common RB $N_{\text{BWP}}^{\text{start}} = O_{\text{carrier}} +
\text{RB}_{\text{start}}$ and a number of contiguous RBs
$N_{\text{BWP}}^{\text{size}} = L_{\text{RB}}$ provided by
_locationAndBandwidth_ that indicates an offset $\text{RB}_{\text{start}}$ and
a length $L_{\text{RB}}$ as RIV according to [6, TS 38.214], setting
$N_{\text{BWP}}^{\text{size}} = 275$, and a value $O_{\text{carrier}}$
provided by _offsetToCarrier_ for the _subcarrierSpacing_
\- an index in the set of DL BWPs or UL BWPs by respective _BWP-Id_
\- a set of BWP-common and a set of BWP-dedicated parameters by _BWP-
DownlinkCommon_ and _BWP-DownlinkDedicated_ for the DL BWP, or _BWP-
UplinkCommon_ and _BWP-UplinkDedicated_ for the UL BWP [12, TS 38.331]
For unpaired spectrum operation, a DL BWP from the set of configured DL BWPs
with index provided by _BWP-Id_ is linked with an UL BWP from the set of
configured UL BWPs with index provided by _BWP-Id_ when the DL BWP index and
the UL BWP index are same. For unpaired spectrum operation, a UE does not
expect to receive a configuration where the center frequency for a DL BWP is
different than the center frequency for an UL BWP when the _BWP-Id_ of the DL
BWP is same as the _BWP-Id_ of the UL BWP.
For each DL BWP in a set of DL BWPs of the PCell, a UE can be configured
CORESETs for every type of CSS sets and for USS as described in clause 10.1.
The UE does not expect to be configured without a CSS set on the PCell in the
active DL BWP.
If a UE is provided _controlResourceSetZero_ and _searchSpaceZero_ in _PDCCH-
ConfigSIB1 or PDCCH-ConfigCommon, the UE determines a CORESET for a_ search
space set from _controlResourcesetZero_ as described in clause 13 and for
Tables 13-1 through 13-10, and determines corresponding PDCCH monitoring
occasions as described in clause 13 and for Tables 13-11 through 13-15. If the
active DL BWP is not the initial DL BWP, t _he UE_ determines PDCCH monitoring
occasions _for the_ search space set only if the CORESET bandwidth _is within
the active DL BWP and the active DL BWP has same SCS configuration and same
cyclic prefix as the initial DL BWP_.
For each UL BWP in a set of UL BWPs of the PCell, or of the PUCCH-SCell, or of
the PUCCH-sSCell the UE is configured resource sets for PUCCH transmissions as
described in clause 9.2.1.
A UE receives PDCCH and PDSCH in a DL BWP according to a configured SCS and CP
length for the DL BWP. A UE transmits PUCCH and PUSCH in an UL BWP according
to a configured SCS and CP length for the UL BWP.
If a bandwidth part indicator field is configured in a DCI format, the
bandwidth part indicator field value indicates the active DL BWP, from the
configured DL BWP set, for DL receptions as described in [5, TS 38.212]. If a
bandwidth part indicator field is configured in a DCI format, the bandwidth
part indicator field value indicates the active UL BWP, from the configured UL
BWP set, for UL transmissions as described in [5, TS 38.212]. If a bandwidth
part indicator field is configured in a DCI format and indicates an UL BWP or
a DL BWP different from the active UL BWP or DL BWP, respectively, the UE
shall
\- for each information field in the DCI format
\- if the size of the information field is smaller than the one required for
the DCI format interpretation for the UL BWP or DL BWP that is indicated by
the bandwidth part indicator, the UE prepends zeros to the information field
until its size is the one required for the interpretation of the information
field for the UL BWP or DL BWP prior to interpreting the DCI format
information fields, respectively
\- if the size of the information field is larger than the one required for
the DCI format interpretation for the UL BWP or DL BWP that is indicated by
the bandwidth part indicator, the UE uses a number of least significant bits
of the DCI format equal to the one required for the UL BWP or DL BWP indicated
by bandwidth part indicator prior to interpreting the DCI format information
fields, respectively
\- set the active UL BWP or DL BWP to the UL BWP or DL BWP indicated by the
bandwidth part indicator in the DCI format
If a bandwidth part indicator field is configured in a DCI format 0_1 and
indicates an active UL BWP with different SCS configuration $\mu$_,_ or with
different number $N_{RB - set,UL}^{\text{BWP}}$ of RB sets, than a current
active UL BWP, the UE determines an uplink frequency domain resource
allocation Type 2 based on $X'$ bits and $Y'$ bits that are generated by
independently truncating or padding the $X$ MSBs and the $Y$ LSBs [6, TS
38.214] of the frequency domain resource assignment field of DCI format 0_1,
where truncation starts from the MSBs of the X bits or the Y bits, zero-
padding prepends zeros to the X bits or the Y bits, and
\- if the indicated active UL BWP has SCS configuration $\mu = 1$ and the
current active BWP has SCS configuration $\mu = 0$_,_ the $X$ MSBs are
truncated to $X^{'} = X - 1$ bits, or
\- if the indicated active UL BWP has SCS configuration $\mu = 0$ and the
current active BWP has SCS configuration $\mu = 1$, the $X$ MSBs are zero-
padded to $X^{'} = X + 1$ bits
\- otherwise, the $X$ MSBs are unchanged
and
\- the $Y$ LSBs are truncated or zero-padded to $Y' = \left\lceil
\text{log}_{2}\left( \frac{N_{RB - set,UL}^{\text{BWP}}\left( N_{RB -
set,UL}^{\text{BWP}} + 1 \right)}{2} \right) \right\rceil$ bits where $N_{RB -
set,UL}^{\text{BWP}}$ is a number of RB sets configured for the indicated
active UL BWP
A UE does not expect to detect a DCI format with a BWP indicator field that
indicates an active DL BWP or an active UL BWP change with the corresponding
time domain resource assignment field providing a slot offset value for a
PDSCH reception or PUSCH transmission that is smaller than a delay required by
the UE for an active DL BWP change or UL BWP change, respectively [10, TS
38.133].
If a UE detects a DCI format with a BWP indicator field that indicates an
active DL BWP change for a cell, the UE is not required to receive or transmit
in the cell during a time duration from the end of the third symbol of a slot
where the UE receives the PDCCH that includes the DCI format in a scheduling
cell until the beginning of a slot indicated by the slot offset value of the
time domain resource assignment field in the DCI format.
If a UE detects a DCI format with SCell dormancy indication that indicates an
active DL BWP change for an Scell in slot _n_ of primary cell, the UE is not
required to receive or transmit in the SCell during a time duration specified
in [10, TS 38.133].
If a UE detects a DCI format indicating an active UL BWP change for a cell,
the UE is not required to receive or transmit in the cell during a time
duration from the end of the third symbol of a slot where the UE receives the
PDCCH that includes the DCI format in the scheduling cell until the beginning
of a slot indicated by the slot offset value of the time domain resource
assignment field in the DCI format.
A UE does not expect to detect a DCI format indicating an active DL BWP change
or an active UL BWP change for a scheduled cell within FR1 (or FR2) in a slot
other than the first slot of a set of slots for the DL SCS of the scheduling
cell that overlaps with a time duration where the UE is not required to
receive or transmit, respectively, for an active BWP change in a different
cell from the scheduled cell within FR1 (or FR2).
A UE expects to detect a DCI format with a BWP indicator field that indicates
an active UL BWP change or an active DL BWP change only if a corresponding
PDCCH is received within the first 3 symbols of a slot. If the UE detects the
DCI format from two PDCCH receptions in search space sets $s_{i}$ and $s_{j}$
that include _searchSpaceLinkingId with same value_ , as described in clause
10.1, the UE considers the PDCCH reception where the UE detects the DCI format
to be the one from the two PDCCH receptions that ends later.
For a serving cell, a UE can be provided by _defaultDownlinkBWP-Id_ a default
DL BWP among the configured DL BWPs. If a UE is not provided a default DL BWP
by _defaultDownlinkBWP-Id_ , the default DL BWP is the initial DL BWP.
If a UE is provided by _bwp-InactivityTimer_ a timer value for the serving
cell [11, TS 38.321] and the timer is running, the UE decrements the timer at
the end of a subframe for FR1 or at the end of a half subframe for FR2 if the
restarting conditions in [11, TS 38.321] are not met during the interval of
the subframe for FR1 or of the half subframe for FR2.
For a cell where a UE changes an active DL BWP due to a BWP inactivity timer
expiration and for accommodating a delay in the active DL BWP change or the
active UL BWP change required by the UE [10, TS 38.133], the UE is not
required to receive or transmit in the cell during a time duration from the
beginning of a subframe for FR1, or of half of a subframe for FR2, that is
immediately after the BWP inactivity timer expires until the beginning of a
slot where the UE can receive or transmit.
When a UE\'s BWP inactivity timer for a cell within FR1 (or FR2) expires
within a time duration where the UE is not required to receive or transmit for
an active UL/DL BWP change in the cell or in a different cell within FR1 (or
FR2), the UE delays the active UL/DL BWP change triggered by the BWP
inactivity timer expiration until a subframe for FR1 or half a subframe for
FR2 that is immediately after the UE completes the active UL/DL BWP change in
the cell or in the different cell within FR1 (or FR2).
If a UE is provided by _firstActiveDownlinkBWP-Id_ a first active DL BWP and
by _firstActiveUplinkBWP-Id_ a first active UL BWP on a carrier of a secondary
cell, the UE uses the indicated DL BWP and the indicated UL BWP as the
respective first active DL BWP on the secondary cell and first active UL BWP
on the carrier of the secondary cell.
A UE does not expect to monitor PDCCH when the UE performs RRM measurements
[10, TS 38.133] over a bandwidth that is not within the active DL BWP for the
UE.
# 13 UE procedure for monitoring Type0-PDCCH CSS sets
If during cell search a UE determines from _MIB_ that a CORESET for
Type0-PDCCH CSS set is present, as described in clause 4.1, the UE determines
a number of consecutive resource blocks and a number of consecutive symbols
for the CORESET of the Type0-PDCCH CSS set from _controlResourceSetZero in_
_pdcch-ConfigSIB1_ , as described in Tables 13-1 through 13-10, for operation
without shared spectrum channel access in FR1 and FR2-1, or as described in
Tables 13-1A and 13-4A for operation with shared spectrum channel access in
FR1, or as described in Table 13-10A for FR2-2, and determines PDCCH
monitoring occasions from _searchSpaceZero in pdcch-ConfigSIB1_ , included in
_MIB_ , as described in Tables 13-11 through 13-15A. $\text{SFN}_{c}$ and
$n_{c}$ are the SFN and slot index within a frame of the CORESET based on SCS
of the CORESET and $\text{SFN}_{SSB,i}$ and $n_{SSB,i}$ are the SFN and slot
index based on SCS of the CORESET, respectively, where the SS/PBCH block with
index $i$ overlaps in time with system frame $\text{SFN}_{SSB,i}$ and slot
$n_{SSB,i}$. The symbols of the CORESET associated with _pdcch-ConfigSIB1_ in
_MIB_ or with _searchSpaceSIB1 in PDCCH-ConfigCommon have normal cyclic
prefix._
For operation with shared spectrum channel access in FR2-2 and for operation
without shared spectrum channel access, a UE assumes that the offset in Tables
13-1 through 13-10A is defined with respect to the SCS of the CORESET for
Type0-PDCCH CSS set from the smallest RB index of the CORESET for Type0-PDCCH
CSS set to the smallest RB index of the common RB overlapping with the first
RB of the corresponding SS/PBCH block. The SCS of the CORESET for Type0-PDCCH
CSS set is provided by _subCarrierSpacingCommon for FR1 and FR2-1 and same as
the SCS of the corresponding SS/PBCH block for FR2-2._ In Tables 13-7, 13-8,
and 13-10, $k_{\text{SSB}}$ is defined in [4, TS 38.211].
For operation with shared spectrum channel access in FR1, a UE determines an
offset from a smallest RB index of the CORESET for Type0-PDCCH CSS set to a
smallest RB index of the common RB overlapping with a first RB of the
corresponding SS/PBCH block
\- _according to the offset in_ Table 13-1A or Table 13-4A, _if the_ frequency
position _of the_ SS/PBCH block corresponds to the GSCN of a synchronization
raster entry as defined in [8-1, TS 38.101-1], and
\- according to _a sum of a first offset and a second offset_ if the frequency
position of the SS/PBCH block is provided by _ssbFrequency_ in a measurement
configuration associated with a reporting configuration providing _reportCGI_
and does not correspond to the GSCN of a synchronization raster entry as
defined in [8-1, TS 38.101-1]_, where_
\- the first offset is _provided in_ Table 13-1A or Table 13-4A, and
\- the second offset is determined as the offset from a smallest RB index of
the common RB overlapping with the first RB of the SS/PBCH block indicated in
the measurement configuration to a smallest RB index of the common RB
overlapping with the first RB of a SS/PBCH block hypothetically located at the
GSCN of a synchronization raster entry, where the single synchronization
raster entry is located in the same channel as the SS/PBCH block used for the
shared spectrum channel access procedure, as described in [15, TS 37.213]
where the offsets are defined with respect to the SCS of the CORESET for
Type0-PDCCH CSS set that is _same as the SCS of the corresponding SS/PBCH
block._
For operation without shared spectrum channel access and for the SS/PBCH block
and CORESET multiplexing pattern 1, a UE monitors PDCCH in the Type0-PDCCH CSS
set over two slots. For SS/PBCH block with index $i$, the UE determines an
index of slot $n_{0}$ as $n_{0} = \left( O \bullet 2^{\mu} + \left\lfloor i
\bullet M \right\rfloor \right)\text{mod}N_{\text{slot}}^{\text{frame},\mu}\ $
that is in a frame with system frame number (SFN) $\text{SFN}_{C}$ satisfying
$\text{SFN}_{c}\text{mod}2 = 0$ if $\left\lfloor \frac{\left( O \bullet
2^{\mu} + \left\lfloor i \bullet M \right\rfloor
\right)}{N_{\text{slot}}^{\text{frame},\mu}} \right\rfloor\text{mod}2 = 0$, or
in a frame with SFN satisfying $\text{SFN}_{c}\text{mod}2 = 1$ if
$\left\lfloor \frac{\left( O \bullet 2^{\mu} + \left\lfloor i \bullet M
\right\rfloor \right)}{N_{\text{slot}}^{\text{frame},\mu}}
\right\rfloor\text{mod}2 = 1$ where $\mu \in \left{ 0,1,2,3,5,6 \right}$ based
on the SCS for PDCCH receptions in the CORESET [4, TS 38.211].
\- For $\mu \in { 0,\ 1,\ 2,\ 3}$ and for a SS/PBCH block index $i$, the two
slots including the associated Type0-PDCCH monitoring occasions are slots
$n_{0}$ and $n_{0} + 1$. $M$, $O$, and the index of the first symbol of the
CORESET in slots $n_{0}$ and $n_{0} + 1$ are provided by Table 13-11 and Table
13-12.
\- For $\mu = 5$ and for a SS/PBCH block index $i$, the two slots including
the associated Type0-PDCCH monitoring occasions are slots $n_{0}$ and $n_{0} +
4$. $M$, $O$, and the index of the first symbol of the CORESET in slots
$n_{0}$ and $n_{0} + 4$ are provided by Table 13-12A, where $X = 1.25$.
\- For $\mu = 6$ and for a SS/PBCH block index $i$, the two slots including
the associated Type0-PDCCH monitoring occasions are slots $n_{0}$ and $n_{0} +
8$. $M$, $O$, and the index of the first symbol of the CORESET in slots
$n_{0}$ and $n_{0} + 8$ are provided by Table 13-12A, where $X = 0.625$.
For operation with shared spectrum channel access and for the SS/PBCH block
and CORESET multiplexing pattern 1, a UE monitors PDCCH in the Type0-PDCCH CSS
set over slots that include Type0-PDCCH monitoring occasions associated with
SS/PBCH blocks that are quasi co-located with the SS/PBCH block that provides
a CORESET for Type0-PDCCH CSS set with respect to average gain, quasi co-
location \'typeA\' and \'typeD\' properties, when applicable [6, TS 38.214].
For a candidate SS/PBCH block index $\overline{i}$, where $0 \leq \overline{i}
\leq {\overline{L}}_{\max} - 1$, two slots include the associated Type0-PDCCH
monitoring occasions. The UE determines an index of slot $n_{0}$ as $n_{0} =
\left( O \cdot 2^{\mu} + \left\lfloor \overline{i} \cdot M \right\rfloor
\right)\text{\ mod\ }N_{\text{slot}}^{frame,\ \mu}$ that is in a frame with
system frame number (SFN) $\text{SFN}_{C}$ satisfying $\text{SFN}_{C}\ mod\ 2
= 0$ if $\left\lfloor \left( O \cdot 2^{\mu} + \left\lfloor \overline{i} \cdot
M \right\rfloor \right)/N_{\text{slot}}^{frame,\ \mu} \right\rfloor\ mod\ 2 =
0$, or in a frame with SFN satisfying $\text{SFN}_{C}\ mod\ 2 = 1$ if
$\left\lfloor \left( O \cdot 2^{\mu} + \left\lfloor \overline{i} \cdot M
\right\rfloor \right)/N_{\text{slot}}^{frame,\ \mu} \right\rfloor\ mod\ 2 = 1$
where $\mu \in { 0,\ 1,3,5,6}$ based on the SCS for PDCCH receptions in the
CORESET [4, TS 38.211].
\- For $\mu \in { 0,\ 1}$ and for a candidate SS/PBCH block index
$\overline{i}$, the two slots including the associated Type0-PDCCH monitoring
occasions are slots $n_{0}$ and $n_{0} + 1$. $M$, $O$, and the index of the
first symbol of the CORESET in slots $n_{0}$ and $n_{0} + 1$ are provided by
Table 13-11. The UE does not expect to be configured with $M = 1/2$, or with
$M = 2$, when $N_{\text{SSB}}^{\text{QCL}} = 1$.
\- For $\mu = 3$ and for a candidate SS/PBCH block index $\overline{i}$, the
two slots including the associated Type0-PDCCH monitoring occasions are slots
$n_{0}$ and $n_{0} + 1$. $M$, $O$, and the index of the first symbol of the
CORESET in slots $n_{0}$ and $n_{0} + 1$ are provided by Table 13-12.
\- For $\mu = 5$ and for a candidate SS/PBCH block index $\overline{i}$, the
two slots including the associated Type0-PDCCH monitoring occasions are slots
$n_{0}$ and $n_{0} + 4$. $M$, $O$, and the index of the first symbol of the
CORESET in slots $n_{0}$ and $n_{0} + 4$ are provided by Table 13-12A, where
$X = 1.25$.
\- For $\mu = 6$ and for a candidate SS/PBCH block index $\overline{i}$, the
two slots including the associated Type0-PDCCH monitoring occasions are slots
$n_{0}$ and $n_{0} + 8$. $M$, $O$, and the index of the first symbol of the
CORESET in slots $n_{0}$ and $n_{0} + 8$ are provided by Table 13-12A, where
$X = 0.625$.
For operation without shared spectrum channel access and for the SS/PBCH block
and CORESET multiplexing patterns 2 and 3, a UE monitors PDCCH in the
Type0-PDCCH CSS set over one slot with Type0-PDCCH CSS set periodicity equal
to the periodicity of SS/PBCH block. For a SS/PBCH block with index $i$, the
UE determines the slot index $n_{c}$ and $\text{SFN}_{c}$ based on parameters
provided by Tables 13-13 through 13-15A.
For operation with shared spectrum channel access and for SS/PBCH block and
CORESET multiplexing pattern 3, a UE monitors PDCCH in the Type0-PDCCH CSS set
over slots that include Type0-PDCCH monitoring occasions associated with
SS/PBCH blocks that are quasi co-located with the SS/PBCH block that provides
a CORESET for Type0-PDCCH CSS set with respect to average gain, quasi co-
location \'typeA\' and \'typeD\' properties, when applicable. _For a candidate
SS/PBCH block index_ $\overline{i}$_, where_ $0 \leq \overline{i} \leq
{\overline{L}}_{\max} - 1$,_the periodicity of_ the slot including _the
associated Type0-PDCCH monitoring occasion is same as the periodicity of the_
candidate SS/PBCH block, and the UE determines the slot index $n_{c}$ and
$\text{SFN}_{c}$ based on parameters provided by Tables 13-15 and 13-15A,
where $i$ _is replaced by_ $\overline{i}$ _for operation with shared spectrum
channel access in FR2-2_.
For the SS/PBCH block and CORESET multiplexing patterns 2 and 3, if the active
DL BWP is the initial DL BWP, the UE is expected to be able to perform radio
link monitoring, as described in clause 5, and measurements for radio resource
management [10, TS 38.133] using a SS/PBCH block that provides a CORESET for
Type0-PDCCH CSS set.
Table 13-1: Set of resource blocks and slot symbols of CORESET for Type0-PDCCH
search space set when {SS/PBCH block, PDCCH} SCS is {15, 15} kHz for frequency
bands with minimum channel bandwidth 5 MHz or 10 MHz
**Index** SS/PBCH block and CORESET multiplexing pattern Number of RBs
$\mathbf{N}_{\mathbf{\text{RB}}}^{\mathbf{\text{CORESET}}}$ Number of Symbols
$\mathbf{N}_{\mathbf{\text{symb}}}^{\mathbf{\text{CORESET}}}$ Offset (RBs)
* * *
0 1 24 2 0 1 1 24 2 2 2 1 24 2 4 3 1 24 3 0 4 1 24 3 2 5 1 24 3 4 6 1 48 1 12
7 1 48 1 16 8 1 48 2 12 9 1 48 2 16 10 1 48 3 12 11 1 48 3 16 12 1 96 1 38 13
1 96 2 38 14 1 96 3 38 15 Reserved
Table 13-1A: Set of resource blocks and slot symbols of CORESET for
Type0-PDCCH search space set when {SS/PBCH block, PDCCH} SCS is {15, 15} kHz
for frequency bands operated with shared spectrum channel access
**Index** SS/PBCH block and CORESET multiplexing pattern Number of RBs
$\mathbf{N}_{\text{RB}}^{\text{CORESET}}$ Number of Symbols
$\mathbf{N}_{\text{symb}}^{\text{CORESET}}$ Offset (RBs)
* * *
0 1 96 1 10 1 1 96 1 12 2 1 96 1 14 3 1 96 1 16 4 1 96 2 10 5 1 96 2 12 6 1 96
2 14 7 1 96 2 16 8 Reserved  
9 Reserved  
10 Reserved  
11 Reserved  
12 Reserved  
13 Reserved  
14 Reserved  
15 Reserved
Table 13-2: Set of resource blocks and slot symbols of CORESET for Type0-PDCCH
search space set when {SS/PBCH block, PDCCH} SCS is {15, 30} kHz for frequency
bands with minimum channel bandwidth 5 MHz or 10 MHz
**Index** SS/PBCH block and CORESET multiplexing pattern Number of RBs
$\mathbf{N}_{\text{RB}}^{\text{CORESET}}$ Number of Symbols
$\mathbf{N}_{\text{symb}}^{\text{CORESET}}$ Offset (RBs)
* * *
0 1 24 2 5 1 1 24 2 6 2 1 24 2 7 3 1 24 2 8 4 1 24 3 5 5 1 24 3 6 6 1 24 3 7 7
1 24 3 8 8 1 48 1 18 9 1 48 1 20 10 1 48 2 18 11 1 48 2 20 12 1 48 3 18 13 1
48 3 20 14 Reserved  
15 Reserved
Table 13-3: Set of resource blocks and slot symbols of CORESET for Type0-PDCCH
search space set when {SS/PBCH block, PDCCH} SCS is {30, 15} kHz for frequency
bands with minimum channel bandwidth 5 MHz or 10 MHz except for the frequency
bands defined by note 17 of Table 5.2-1 in [8-1, TS 38.101-1]
**Index** SS/PBCH block and CORESET multiplexing pattern Number of RBs
$\mathbf{N}_{\text{RB}}^{\text{CORESET}}$ Number of Symbols
$\mathbf{N}_{\text{symb}}^{\text{CORESET}}$ Offset (RBs)
* * *
0 1 48 1 2 1 1 48 1 6 2 1 48 2 2 3 1 48 2 6 4 1 48 3 2 5 1 48 3 6 6 1 96 1 28
7 1 96 2 28 8 1 96 3 28 9 Reserved  
10 Reserved  
11 Reserved  
12 Reserved  
13 Reserved  
14 Reserved  
15 Reserved
Table 13-4: Set of resource blocks and slot symbols of CORESET for Type0-PDCCH
search space set when {SS/PBCH block, PDCCH} SCS is {30, 30} kHz for frequency
bands with minimum channel bandwidth 5 MHz or 10 MHz except for the frequency
bands defined by note 17 of Table 5.2-1 in [8-1, TS 38.101-1]
**Index** SS/PBCH block and CORESET multiplexing pattern Number of RBs
$\mathbf{N}_{\text{RB}}^{\text{CORESET}}$ Number of Symbols
$\mathbf{N}_{\text{symb}}^{\text{CORESET}}$ Offset (RBs)
* * *
0 1 24 2 0 1 1 24 2 1 2 1 24 2 2 3 1 24 2 3 4 1 24 2 4 5 1 24 3 0 6 1 24 3 1 7
1 24 3 2 8 1 24 3 3 9 1 24 3 4 10 1 48 1 12 11 1 48 1 14 12 1 48 1 16 13 1 48
2 12 14 1 48 2 14 15 1 48 2 16
Table 13-4A: Set of resource blocks and slot symbols of CORESET for
Type0-PDCCH search space set when {SS/PBCH block, PDCCH} SCS is {30, 30} kHz
for frequency bands operated with shared spectrum channel access
**Index** SS/PBCH block and CORESET multiplexing pattern Number of RBs
$\mathbf{N}_{\text{RB}}^{\text{CORESET}}$ Number of Symbols
$\mathbf{N}_{\text{symb}}^{\text{CORESET}}$ Offset (RBs)
* * *
0 1 48 1 0 1 1 48 1 1 2 1 48 1 2 3 1 48 1 3 4 1 48 2 0 5 1 48 2 1 6 1 48 2 2 7
1 48 2 3 8 Reserved  
9 Reserved  
10 Reserved  
11 Reserved  
12 Reserved  
13 Reserved  
14 Reserved  
15 Reserved
Table 13-5: Set of resource blocks and slot symbols of CORESET for Type0-PDCCH
search space set when {SS/PBCH block, PDCCH} SCS is {30, 15} kHz for frequency
bands with minimum channel bandwidth 40MHz or for the frequency bands defined
by note 17 of Table 5.2-1 in [8-1, TS 38.101-1]
**Index** SS/PBCH block and CORESET multiplexing pattern Number of RBs
$\mathbf{N}_{\text{RB}}^{\text{CORESET}}$ Number of Symbols
$\mathbf{N}_{\text{symb}}^{\text{CORESET}}$ Offset (RBs)
* * *
0 1 48 1 4 1 1 48 2 4 2 1 48 3 4 3 1 96 1 0 4 1 96 1 56 5 1 96 2 0 6 1 96 2 56
7 1 96 3 0 8 1 96 3 56 9 Reserved  
10 Reserved  
11 Reserved  
12 Reserved  
13 Reserved  
14 Reserved  
15 Reserved
Table 13-6: Set of resource blocks and slot symbols of CORESET for Type0-PDCCH
search space set when {SS/PBCH block, PDCCH} SCS is {30, 30} kHz for frequency
bands with minimum channel bandwidth 40MHz or for the frequency bands defined
by note 17 of Table 5.2-1 in [8-1, TS 38.101-1]
**Index** SS/PBCH block and CORESET multiplexing pattern Number of RBs
$\mathbf{N}_{\text{RB}}^{\text{CORESET}}$ Number of Symbols
$\mathbf{N}_{\text{symb}}^{\text{CORESET}}$ Offset (RBs)
* * *
0 1 24 2 0 1 1 24 2 4 2 1 24 3 0 3 1 24 3 4 4 1 48 1 0 5 1 48 1 28 6 1 48 2 0
7 1 48 2 28 8 1 48 3 0 9 1 48 3 28 10 Reserved  
11 Reserved  
12 Reserved  
13 Reserved  
14 Reserved  
15 Reserved
Table 13-7: Set of resource blocks and slot symbols of CORESET for Type0-PDCCH
search space set when {SS/PBCH block, PDCCH} SCS is {120, 60} kHz
+-----------+-------------+-------------+-------------+-------------+ | **Index** | SS/PBCH | Number of | Number of | Offset | | | block and | RBs | Symbols | (RBs) | | | CORESET | $\mathbf | $\mathbf{N | | | | m | {N}_{\text{ | }_{\text{sy | | | | ultiplexing | RB}}^{\text | mb}}^{\text | | | | pattern | {CORESET}}$ | {CORESET}}$ | | +===========+=============+=============+=============+=============+ | 0 | 1 | 48 | 1 | 0 | +-----------+-------------+-------------+-------------+-------------+ | 1 | 1 | 48 | 1 | 8 | +-----------+-------------+-------------+-------------+-------------+ | 2 | 1 | 48 | 2 | 0 | +-----------+-------------+-------------+-------------+-------------+ | 3 | 1 | 48 | 2 | 8 | +-----------+-------------+-------------+-------------+-------------+ | 4 | 1 | 48 | 3 | 0 | +-----------+-------------+-------------+-------------+-------------+ | 5 | 1 | 48 | 3 | 8 | +-----------+-------------+-------------+-------------+-------------+ | 6 | 1 | 96 | 1 | 28 | +-----------+-------------+-------------+-------------+-------------+ | 7 | 1 | 96 | 2 | 28 | +-----------+-------------+-------------+-------------+-------------+ | 8 | 2 | 48 | 1 | -41 if | | | | | | $k_{\text | | | | | | {SSB}} = 0$ | | | | | | | | | | | | -42 if | | | | | | $k_{\text | | | | | | {SSB}} > 0$ | +-----------+-------------+-------------+-------------+-------------+ | 9 | 2 | 48 | 1 | 49 | +-----------+-------------+-------------+-------------+-------------+ | 10 | 2 | 96 | 1 | -41 if | | | | | | $k_{\text | | | | | | {SSB}} = 0$ | | | | | | | | | | | | -42 if | | | | | | $k_{\text | | | | | | {SSB}} > 0$ | +-----------+-------------+-------------+-------------+-------------+ | 11 | 2 | 96 | 1 | 97 | +-----------+-------------+-------------+-------------+-------------+ | 12 | Reserved | | | | +-----------+-------------+-------------+-------------+-------------+ | 13 | Reserved | | | | +-----------+-------------+-------------+-------------+-------------+ | 14 | Reserved | | | | +-----------+-------------+-------------+-------------+-------------+ | 15 | Reserved | | | | +-----------+-------------+-------------+-------------+-------------+
Table 13-8: Set of resource blocks and slot symbols of CORESET for Type0-PDCCH
search space set when {SS/PBCH block, PDCCH} SCS is {120, 120} kHz for FR2-1
+-----------+-------------+-------------+-------------+-------------+ | **Index** | SS/PBCH | Number of | Number of | Offset | | | block and | RBs | Symbols | (RBs) | | | CORESET | $\mathbf | $\mathbf{N | | | | m | {N}_{\text{ | }_{\text{sy | | | | ultiplexing | RB}}^{\text | mb}}^{\text | | | | pattern | {CORESET}}$ | {CORESET}}$ | | +===========+=============+=============+=============+=============+ | 0 | 1 | 24 | 2 | 0 | +-----------+-------------+-------------+-------------+-------------+ | 1 | 1 | 24 | 2 | 4 | +-----------+-------------+-------------+-------------+-------------+ | 2 | 1 | 48 | 1 | 14 | +-----------+-------------+-------------+-------------+-------------+ | 3 | 1 | 48 | 2 | 14 | +-----------+-------------+-------------+-------------+-------------+ | 4 | 3 | 24 | 2 | -20 if | | | | | | $k_{\text | | | | | | {SSB}} = 0$ | | | | | | | | | | | | -21 if | | | | | | $k_{\text | | | | | | {SSB}} > 0$ | +-----------+-------------+-------------+-------------+-------------+ | 5 | 3 | 24 | 2 | 24 | +-----------+-------------+-------------+-------------+-------------+ | 6 | 3 | 48 | 2 | -20 if | | | | | | $k_{\text | | | | | | {SSB}} = 0$ | | | | | | | | | | | | -21 if | | | | | | $k_{\text | | | | | | {SSB}} > 0$ | +-----------+-------------+-------------+-------------+-------------+ | 7 | 3 | 48 | 2 | 48 | +-----------+-------------+-------------+-------------+-------------+ | 8 | Reserved | | | | +-----------+-------------+-------------+-------------+-------------+ | 9 | Reserved | | | | +-----------+-------------+-------------+-------------+-------------+ | 10 | Reserved | | | | +-----------+-------------+-------------+-------------+-------------+ | 11 | Reserved | | | | +-----------+-------------+-------------+-------------+-------------+ | 12 | Reserved | | | | +-----------+-------------+-------------+-------------+-------------+ | 13 | Reserved | | | | +-----------+-------------+-------------+-------------+-------------+ | 14 | Reserved | | | | +-----------+-------------+-------------+-------------+-------------+ | 15 | Reserved | | | | +-----------+-------------+-------------+-------------+-------------+
Table 13-9: Set of resource blocks and slot symbols of CORESET for Type0-PDCCH
search space set when {SS/PBCH block, PDCCH} SCS is {240, 60} kHz
**Index** SS/PBCH block and CORESET multiplexing pattern Number of RBs
$\mathbf{N}_{\text{RB}}^{\text{CORESET}}$ Number of Symbols
$\mathbf{N}_{\text{symb}}^{\text{CORESET}}$ Offset (RBs)
* * *
0 1 96 1 0 1 1 96 1 16 2 1 96 2 0 3 1 96 2 16 4 Reserved  
5 Reserved  
6 Reserved  
7 Reserved  
8 Reserved  
9 Reserved  
10 Reserved  
11 Reserved  
12 Reserved  
13 Reserved  
14 Reserved  
15 Reserved
Table 13-10: Set of resource blocks and slot symbols of CORESET for
Type0-PDCCH search space set when {SS/PBCH block, PDCCH} SCS is {240, 120} kHz
+-----------+-------------+-------------+-------------+-------------+ | **Index** | SS/PBCH | Number of | Number of | Offset | | | block and | RBs | Symbols | (RBs) | | | CORESET | $\mathbf | $\mathbf{N | | | | m | {N}_{\text{ | }_{\text{sy | | | | ultiplexing | RB}}^{\text | mb}}^{\text | | | | pattern | {CORESET}}$ | {CORESET}}$ | | +===========+=============+=============+=============+=============+ | 0 | 1 | 48 | 1 | 0 | +-----------+-------------+-------------+-------------+-------------+ | 1 | 1 | 48 | 1 | 8 | +-----------+-------------+-------------+-------------+-------------+ | 2 | 1 | 48 | 2 | 0 | +-----------+-------------+-------------+-------------+-------------+ | 3 | 1 | 48 | 2 | 8 | +-----------+-------------+-------------+-------------+-------------+ | 4 | 2 | 24 | 1 | -41 if | | | | | | $k_{\text | | | | | | {SSB}} = 0$ | | | | | | | | | | | | -42 if | | | | | | $k_{\text | | | | | | {SSB}} > 0$ | +-----------+-------------+-------------+-------------+-------------+ | 5 | 2 | 24 | 1 | 25 | +-----------+-------------+-------------+-------------+-------------+ | 6 | 2 | 48 | 1 | -41 if | | | | | | $k_{\text | | | | | | {SSB}} = 0$ | | | | | | | | | | | | -42 if | | | | | | $k_{\text | | | | | | {SSB}} > 0$ | +-----------+-------------+-------------+-------------+-------------+ | 7 | 2 | 48 | 1 | 49 | +-----------+-------------+-------------+-------------+-------------+ | 8 | Reserved | | | | +-----------+-------------+-------------+-------------+-------------+ | 9 | Reserved | | | | +-----------+-------------+-------------+-------------+-------------+ | 10 | Reserved | | | | +-----------+-------------+-------------+-------------+-------------+ | 11 | Reserved | | | | +-----------+-------------+-------------+-------------+-------------+ | 12 | Reserved | | | | +-----------+-------------+-------------+-------------+-------------+ | 13 | Reserved | | | | +-----------+-------------+-------------+-------------+-------------+ | 14 | Reserved | | | | +-----------+-------------+-------------+-------------+-------------+ | 15 | Reserved | | | | +-----------+-------------+-------------+-------------+-------------+
Table 13-10A: Set of resource blocks and slot symbols of CORESET for
Type0-PDCCH search space set when {SS/PBCH block, PDCCH} SCS is {120, 120}
kHz, {480, 480} kHz, or {960, 960} kHz for FR2-2
+-----------+-------------+-------------+-------------+-------------+ | **Index** | SS/PBCH | Number of | Number of | Offset | | | block and | RBs | Symbols | (RBs) | | | CORESET | $\mathbf | $\mathbf{N | | | | m | {N}_{\text{ | }_{\text{sy | | | | ultiplexing | RB}}^{\text | mb}}^{\text | | | | pattern | {CORESET}}$ | {CORESET}}$ | | +===========+=============+=============+=============+=============+ | 0 | 1 | 24 | 2 | 0 | +-----------+-------------+-------------+-------------+-------------+ | 1 | 1 | 24 | 2 | 4 | +-----------+-------------+-------------+-------------+-------------+ | 2 | 1 | 48 | 1 | 0 | +-----------+-------------+-------------+-------------+-------------+ | 3 | 1 | 48 | 1 | 14 | +-----------+-------------+-------------+-------------+-------------+ | 4 | 1 | 48 | 1 | 28 | +-----------+-------------+-------------+-------------+-------------+ | 5 | 1 | 48 | 2 | 0 | +-----------+-------------+-------------+-------------+-------------+ | 6 | 1 | 48 | 2 | 14 | +-----------+-------------+-------------+-------------+-------------+ | 7 | 1 | 48 | 2 | 28 | +-----------+-------------+-------------+-------------+-------------+ | 8 | 1 | 96 | 1 | 0 | +-----------+-------------+-------------+-------------+-------------+ | 9 | 1 | 96 | 1 | 76 | +-----------+-------------+-------------+-------------+-------------+ | 10 | 1 | 96 | 2 | 0 | +-----------+-------------+-------------+-------------+-------------+ | 11 | 1 | 96 | 2 | 76 | +-----------+-------------+-------------+-------------+-------------+ | 12 | 3 | 24 | 2 | -20 if | | | | | | $k_{\text | | | | | | {SSB}} = 0$ | | | | | | | | | | | | -21 if | | | | | | $k_{\text | | | | | | {SSB}} > 0$ | +-----------+-------------+-------------+-------------+-------------+ | 13 | 3 | 24 | 2 | 24 | +-----------+-------------+-------------+-------------+-------------+ | 14 | 3 | 48 | 2 | -20 if | | | | | | $k_{\text | | | | | | {SSB}} = 0$ | | | | | | | | | | | | -21 if | | | | | | $k_{\text | | | | | | {SSB}} > 0$ | +-----------+-------------+-------------+-------------+-------------+ | 15 | 3 | 48 | 2 | 48 | +-----------+-------------+-------------+-------------+-------------+
Table 13-11: Parameters for PDCCH monitoring occasions for Type0-PDCCH CSS set
- SS/PBCH block and CORESET multiplexing pattern 1 and FR1
**Index** $$\mathbf{O}$$ Number of search space sets per slot $$\mathbf{M}$$
**First symbol index**
* * *
0 0 1 1 0 1 0 2 1/2 {0, if $i$ is even}, {$N_{\text{symb}}^{\text{CORESET}}$,
if $i$ is odd} 2 2 1 1 0 3 2 2 1/2 {0, if $i$ is even},
{$N_{\text{symb}}^{\text{CORESET}}$, if $i$ is odd} 4 5 1 1 0 5 5 2 1/2 {0, if
$i$ is even}, {$N_{\text{symb}}^{\text{CORESET}}$, if $i$ is odd} 6 7 1 1 0 7
7 2 1/2 {0, if $i$ is even}, {$N_{\text{symb}}^{\text{CORESET}}$, if $i$ is
odd} 8 0 1 2 0 9 5 1 2 0 10 0 1 1 1 11 0 1 1 2 12 2 1 1 1 13 2 1 1 2 14 5 1 1
1 15 5 1 1 2
Table 13-12: Parameters for PDCCH monitoring occasions for Type0-PDCCH CSS set
- SS/PBCH block and CORESET multiplexing pattern 1 and FR2-1, or SS/PBCH block
and CORESET multiplexing pattern 1 and {SS/PBCH block, PDCCH} SCS {120, 120}
kHz in FR2-2
**Index** $$\mathbf{O}$$ Number of search space sets per slot $$\mathbf{M}$$
**First symbol index**
* * *
0 0 1 1 0 1 0 2 1/2 {0, if $i$ is even}, {7, if $i$ is odd} 2 2.5 1 1 0 3 2.5
2 1/2 {0, if $i$ is even}, {7, if $i$ is odd} 4 5 1 1 0 5 5 2 1/2 {0, if $i$
is even}, {7, if $i$ is odd} 6 0 2 1/2 {0, if $i$ is even},
{$N_{\text{symb}}^{\text{CORESET}}$, if $i$ is odd} 7 2.5 2 1/2 {0, if $i$ is
even}, {$N_{\text{symb}}^{\text{CORESET}}$, if $i$ is odd} 8 5 2 1/2 {0, if
$i$ is even}, {$N_{\text{symb}}^{\text{CORESET}}$, if $i$ is odd} 9 7.5 1 1 0
10 7.5 2 1/2 {0, if $i$ is even}, {7, if $i$ is odd} 11 7.5 2 1/2 {0, if $i$
is even}, {$N_{\text{symb}}^{\text{CORESET}}$, if $i$ is odd} 12 0 1 2 0 13 5
1 2 0 14 Reserved  
15 Reserved
Table 13-12A: Parameters for PDCCH monitoring occasions for Type0-PDCCH CSS
set - SS/PBCH block and CORESET multiplexing pattern 1 and {SS/PBCH block,
PDCCH} SCS {480, 480} kHz or {960, 960} kHz in FR2-2
**Index** $$\mathbf{O}$$ Number of search space sets per slot $$\mathbf{M}$$
**First symbol index**
* * *
0 0 1 1 0 1 0 2 1/2 {0, if $i$ is even}, {7, if $i$ is odd} 2 X 1 1 0 3 X 2
1/2 {0, if $i$ is even}, {7, if $i$ is odd} 4 5 1 1 0 5 5 2 1/2 {0, if $i$ is
even}, {7, if $i$ is odd} 6 0 2 1/2 {0, if $i$ is even},
{$N_{\text{symb}}^{\text{CORESET}}$, if $i$ is odd} 7 X 2 1/2 {0, if $i$ is
even}, {$N_{\text{symb}}^{\text{CORESET}}$, if $i$ is odd} 8 5 2 1/2 {0, if
$i$ is even}, {$N_{\text{symb}}^{\text{CORESET}}$, if $i$ is odd} 9 5+X 1 1 0
10 5+X 2 1/2 {0, if $i$ is even}, {7, if $i$ is odd} 11 5+X 2 1/2 {0, if $i$
is even}, {$N_{\text{symb}}^{\text{CORESET}}$, if $i$ is odd} 12 0 1 2 0 13 5
1 2 0 14 Reserved  
15 Reserved
Table 13-13: PDCCH monitoring occasions for Type0-PDCCH CSS set - SS/PBCH
block and CORESET multiplexing pattern 2 and {SS/PBCH block, PDCCH} SCS {120,
60} kHz
+-----------+---------------------------+---------------------------+ | **Index** | PDCCH monitoring | **First symbol index** | | | occasions (SFN and slot | | | | number) | **(_k_ = 0, 1, ... 15)** | +===========+===========================+===========================+ | 0 | $$\text{SFN}_{ | 0, 1, 6, 7 for | | | c} = \text{SFN}_{SSB,i}$$ | | | | | $i = 4k$, $i = 4k + 1$, | | | $n_{c} = n_{SSB,i}$ | $i = 4k + 2$, | | | | $i = 4k + 3$ | +-----------+---------------------------+---------------------------+ | 1 | Reserved | | +-----------+---------------------------+---------------------------+ | 2 | Reserved | | +-----------+---------------------------+---------------------------+ | 3 | Reserved | | +-----------+---------------------------+---------------------------+ | 4 | Reserved | | +-----------+---------------------------+---------------------------+ | 5 | Reserved | | +-----------+---------------------------+---------------------------+ | 6 | Reserved | | +-----------+---------------------------+---------------------------+ | 7 | Reserved | | +-----------+---------------------------+---------------------------+ | 8 | Reserved | | +-----------+---------------------------+---------------------------+ | 9 | Reserved | | +-----------+---------------------------+---------------------------+ | 10 | Reserved | | +-----------+---------------------------+---------------------------+ | 11 | Reserved | | +-----------+---------------------------+---------------------------+ | 12 | Reserved | | +-----------+---------------------------+---------------------------+ | 13 | Reserved | | +-----------+---------------------------+---------------------------+ | 14 | Reserved | | +-----------+---------------------------+---------------------------+ | 15 | Reserved | | +-----------+---------------------------+---------------------------+
Table 13-14: PDCCH monitoring occasions for Type0-PDCCH CSS set - SS/PBCH
block and CORESET multiplexing pattern 2 and {SS/PBCH block, PDCCH} SCS {240,
120} kHz
+-----------+---------------------------+---------------------------+ | **Index** | PDCCH monitoring | **First symbol index** | | | occasions (SFN and slot | | | | number) | **(_k_ = 0, 1, ..., 7)** | +===========+===========================+===========================+ | 0 | $$\text{SFN}_{ | 0, 1, 2, 3, 0, 1 in | | | c} = \text{SFN}_{SSB,i}$$ | $i = 8k$, $i = 8k + 1$, | | | | $i = 8k + 2$, | | | $n_{c} = n_{SSB,i}$ or | $i = 8k + 3$, | | | $n_{c} = n_{SSB,i} - 1$ | $i = 8k + 6$, | | | | $i = 8k + 7$ | | | | ($n_{c} = n_{SSB,i}$) | | | | | | | | 12, 13 in $i = 8k + 4$, | | | | $i = 8k + 5$ | | | | ($n_{c} = n_{SSB,i} - 1$) | +-----------+---------------------------+---------------------------+ | 1 | Reserved | | +-----------+---------------------------+---------------------------+ | 2 | Reserved | | +-----------+---------------------------+---------------------------+ | 3 | Reserved | | +-----------+---------------------------+---------------------------+ | 4 | Reserved | | +-----------+---------------------------+---------------------------+ | 5 | Reserved | | +-----------+---------------------------+---------------------------+ | 6 | Reserved | | +-----------+---------------------------+---------------------------+ | 7 | Reserved | | +-----------+---------------------------+---------------------------+ | 8 | Reserved | | +-----------+---------------------------+---------------------------+ | 9 | Reserved | | +-----------+---------------------------+---------------------------+ | 10 | Reserved | | +-----------+---------------------------+---------------------------+ | 11 | Reserved | | +-----------+---------------------------+---------------------------+ | 12 | Reserved | | +-----------+---------------------------+---------------------------+ | 13 | Reserved | | +-----------+---------------------------+---------------------------+ | 14 | Reserved | | +-----------+---------------------------+---------------------------+ | 15 | Reserved | | +-----------+---------------------------+---------------------------+
Table 13-15: PDCCH monitoring occasions for Type0-PDCCH CSS set - SS/PBCH
block and CORESET multiplexing pattern 3 and {SS/PBCH block, PDCCH} SCS {120,
120} kHz
+-----------+---------------------------+---------------------------+ | **Index** | PDCCH monitoring | **First symbol index** | | | occasions (SFN and slot | | | | number) | **(_k_ = 0, 1, ... 15)** | +===========+===========================+===========================+ | 0 | $$\text{SFN}_{ | 4, 8, 2, 6 in | | | c} = \text{SFN}_{SSB,i}$$ | | | | | $i = 4k$, $i = 4k + 1$, | | | $n_{c} = n_{SSB,i}$ | $i = 4k + 2$, | | | | $i = 4k + 3$ | +-----------+---------------------------+---------------------------+ | 1 | Reserved | | +-----------+---------------------------+---------------------------+ | 2 | Reserved | | +-----------+---------------------------+---------------------------+ | 3 | Reserved | | +-----------+---------------------------+---------------------------+ | 4 | Reserved | | +-----------+---------------------------+---------------------------+ | 5 | Reserved | | +-----------+---------------------------+---------------------------+ | 6 | Reserved | | +-----------+---------------------------+---------------------------+ | 7 | Reserved | | +-----------+---------------------------+---------------------------+ | 8 | Reserved | | +-----------+---------------------------+---------------------------+ | 9 | Reserved | | +-----------+---------------------------+---------------------------+ | 10 | Reserved | | +-----------+---------------------------+---------------------------+ | 11 | Reserved | | +-----------+---------------------------+---------------------------+ | 12 | Reserved | | +-----------+---------------------------+---------------------------+ | 13 | Reserved | | +-----------+---------------------------+---------------------------+ | 14 | Reserved | | +-----------+---------------------------+---------------------------+ | 15 | Reserved | | +-----------+---------------------------+---------------------------+
Table 13-15A: PDCCH monitoring occasions for Type0-PDCCH CSS set - SS/PBCH
block and CORESET multiplexing pattern 3 and {SS/PBCH block, PDCCH} SCS {480,
480} kHz or {960, 960} kHz
+-----------+---------------------------+--------------------------+ | **Index** | PDCCH monitoring | **First symbol index** | | | occasions (SFN and slot | | | | number) | **(_k_ = 0, 1, ... 31)** | +===========+===========================+==========================+ | 0 | $$\text{SFN}_{ | 2, 9 in | | | c} = \text{SFN}_{SSB,i}$$ | | | | | $i = 2k$, $i = 2k + 1$ | | | $$n_{c} = n_{SSB,i}$$ | | +-----------+---------------------------+--------------------------+ | 1 | Reserved | | +-----------+---------------------------+--------------------------+ | 2 | Reserved | | +-----------+---------------------------+--------------------------+ | 3 | Reserved | | +-----------+---------------------------+--------------------------+ | 4 | Reserved | | +-----------+---------------------------+--------------------------+ | 5 | Reserved | | +-----------+---------------------------+--------------------------+ | 6 | Reserved | | +-----------+---------------------------+--------------------------+ | 7 | Reserved | | +-----------+---------------------------+--------------------------+ | 8 | Reserved | | +-----------+---------------------------+--------------------------+ | 9 | Reserved | | +-----------+---------------------------+--------------------------+ | 10 | Reserved | | +-----------+---------------------------+--------------------------+ | 11 | Reserved | | +-----------+---------------------------+--------------------------+ | 12 | Reserved | | +-----------+---------------------------+--------------------------+ | 13 | Reserved | | +-----------+---------------------------+--------------------------+ | 14 | Reserved | | +-----------+---------------------------+--------------------------+ | 15 | Reserved | | +-----------+---------------------------+--------------------------+
If a UE detects a first SS/PBCH block and determines that a CORESET for
Type0-PDCCH CSS set is not present, and for $24 \leq k_{\text{SSB}} \leq 29$
for FR1 or for $12 \leq k_{\text{SSB}} \leq 13$ for FR2, the UE may determine
the nearest (in the corresponding frequency direction) global synchronization
channel number (GSCN) of a second SS/PBCH block having a CORESET for an
associated Type0-PDCCH CSS set as $N_{\text{GSCN}}^{\text{Reference}} +
N_{\text{GSCN}}^{\text{Size}} \cdot N_{\text{GSCN}}^{\text{Offset}}$.
$N_{\text{GSCN}}^{\text{Reference}}$ is the GSCN of the first SS/PBCH block,
$N_{\text{GSCN}}^{\text{Size}} = 1$ in FR1 and FR2-1,
$N_{\text{GSCN}}^{\text{Size}} =$ 3 in FR2-2, and
$N_{\text{GSCN}}^{\text{Offset}}$ is a GSCN offset provided by Table 13-16 for
FR1 and Table 13-17 for FR2. If the UE detects the second SS/PBCH block and
the second SS/PBCH block does not provide a CORESET for Type0-PDCCH CSS set,
as described in clause 4.1, the UE may ignore the information related to GSCN
of SS/PBCH block locations for performing cell search.
If a UE detects a SS/PBCH block and determines that a CORESET for Type0-PDCCH
CSS set is not present, and for $k_{\text{SSB}} = 31$ for FR1 or for
$k_{\text{SSB}} = 15$ for FR2, the UE determines that there is no SS/PBCH
block having an associated Type0-PDCCH CSS set within a GSCN range
$\left\lbrack {N_{\text{GSCN}}^{\text{Reference}} -
N_{\text{GSCN}}^{\text{Start}},\ N}_{\text{GSCN}}^{\text{Reference}} +
N_{\text{GSCN}}^{\text{End}} \right\rbrack$.
$N_{\text{GSCN}}^{\text{Start}}$and $N_{\text{GSCN}}^{\text{End}}$ are
respectively determined by _controlResourceSetZero_ and _searchSpaceZero in
pdcch-ConfigSIB1._ If the GSCN range is $\left\lbrack
{N_{\text{GSCN}}^{\text{Reference}},\ N}_{\text{GSCN}}^{\text{Reference}}
\right\rbrack$, the UE determines that there is no information for a second
SS/PBCH block with a CORESET for an associated Type0-PDCCH CSS set on the
detected SS/PBCH block _._
If a UE does not detect any SS/PBCH block providing a CORESET for Type0-PDCCH
CSS set, as described in clause 4.1, within a time period determined by the
UE, the UE may ignore the information related to GSCN of SS/PBCH locations in
performing cell search.
Table 13-16: Mapping between the combination of
$\mathbf{k}_{\mathbf{\text{SSB}}}$ and _controlResourceSetZero_ and
_searchSpaceZero in pdcch-ConfigSIB1_ to
$\mathbf{N}_{\mathbf{\text{GSCN}}}^{\mathbf{\text{Offset}}}$ for FR1
$$k_{\text{SSB}}$$ _16×controlResourceSetZero +searchSpaceZero_
$$N_{\text{GSCN}}^{\text{Offset}}$$
* * *
24 0, 1, ..., 255 1, 2, ..., 256 25 0, 1, ..., 255 257, 258, ..., 512 26 0, 1,
..., 255 513, 514, ...., 768 27 0, 1, ..., 255 -1, -2, ..., -256 28 0, 1, ...,
255 -257, -258, ..., -512 29 0, 1, ..., 255 -513, -514, ...., -768 30 0, 1,
..., 255 Reserved, Reserved, ..., Reserved
Table 13-17: Mapping between the combination of
$\mathbf{k}_{\mathbf{\text{SSB}}}$ and _controlResourceSetZero_ and
_searchSpaceZero in pdcch-ConfigSIB1_ to
$\mathbf{N}_{\mathbf{\text{GSCN}}}^{\mathbf{\text{Offset}}}$ for FR2
$$k_{\text{SSB}}$$ _16×controlResourceSetZero +searchSpaceZero_
$$N_{\text{GSCN}}^{\text{Offset}}$$
* * *
12 0, 1, ..., 255 1, 2, ..., 256 13 0, 1, ..., 255 -1, -2, ..., -256 14 0, 1,
..., 255 Reserved, Reserved, ..., Reserved
# 14 Integrated access-backhaul operation
Throughout this specification, unless otherwise noted, statements using the
term \"UE\" in clauses 4 through 13 are equally applicable to the IAB-MT of an
IAB node.
A procedure for an IAB-MT to perform cell search, system information
acquisition, or random access procedure is same as a corresponding one for a
UE except for the following.
For initial cell selection, an IAB-MT may assume that half frames with SS/PBCH
blocks occur with a periodicity of 16 frames.
For PRACH transmission, an IAB-MT determines frames and subframes/slots within
the frames containing PRACH occasions as described in [4, TS 38.211].
The IAB-MT determines an association period for mapping SS/PBCH blocks to
PRACH occasions based on a PRACH configuration period as described in clause
8.1 and according to Table 14-1 instead of Table 8.1-1. An association pattern
period includes one or more association periods and is determined so that a
pattern between PRACH occasions and SS/PBCH blocks repeats at most every 640
msec. A PRACH occasion in a PRACH slot is valid according to the conditions in
clause 8.1.
Table 14-1: Mapping between PRACH configuration period and SS/PBCH block to
PRACH occasion association period for an IAB-MT
PRACH configuration period (msec) Association period (number of PRACH
configuration periods)
* * *
10 {1, 2, 4, 8, 16, 32, 64} 20 {1, 2, 4, 8, 16, 32} 40 {1, 2, 4, 8, 16} 80 {1,
2, 4, 8} 160 {1, 2, 4} 320 {1, 2} 640 {1}
If an IAB-node is provided an index $T_{\text{delta}}$ in a Timing Delta MAC
CE [11, TS 38.321] from a serving cell, the IAB-node may assume that
$T_{\text{TA}}/2 + \left( N_{\text{delta}} + T_{\text{delta}} \cdot
G_{\text{step}}{- N}_{\text{TA}\text{,Offset}}/2 \right) \cdot T_{\text{c}}$
_is a time difference between a DU transmission of a signal from the serving
cell and a reception of the signal by the IAB-MT_ when $T_{\text{TA}}/2 +
\left( N_{\text{delta}} + T_{\text{delta}} \cdot G_{\text{step}}{-
N}_{\text{TA}\text{,Offset}}/2 \right) \cdot T_{\text{c}} > 0$, where
\- $T_{\text{TA}}$ is the difference between the IAB-MT reception time and the
IAB-MT transmission time for IAB-MT transmission timing mode \'Case-6\', and
is defined in clause 4.3.1 of [4, TS 38.211] for IAB-MT transmission timing
mode \'Case-1\' and parent node reception mode \'Case-7\'
\- $N_{\text{delta}}$ and $G_{\text{step}}$ are determined as
\- $N_{\text{delta}} = - 70528$ and $G_{\text{step}} = 64$, if the serving
cell providing the Timing Delta MAC CE operates in FR1
\- $N_{\text{delta}} = - 17664$ and $G_{\text{step}} = 32$, if the serving
cell providing the Timing Delta MAC CE operates in FR2
The IAB node may assume that a same value of index $T_{\text{delta}}$ is
provided from a serving cell for the IAB-MT transmission timing modes
\'Case-7\' and \'Case-1\'
The IAB-node may use the time difference to determine a DU transmission time.
For a serving cell of an IAB-MT, the IAB-MT can be provided by Timing Case
Indication MAC CE [11, TS 38.321] an indication of the IAB-MT transmission
timing mode in a slot. Upon reception of the Timing Case Indication for a
serving cell in a TAG, the IAB-MT applies a same IAB-MT transmission timing
mode in a slot on all serving cells in the TAG.
If the indicated IAB-MT transmission timing mode in a slot is set to
\'Case-1\' or the IAB-MT transmission timing mode indication in a slot is not
provided, the IAB-MT transmission time is determined as for a \"UE\" in clause
4.2.
If the indicated IAB-MT transmission timing mode in a slot is set to
\'Case-6\', the IAB-node sets the IAB-MT transmission time to the transmission
time of the IAB-DU.
If the indicated IAB-MT transmission timing mode in a slot is set to
\'Case-7\', the IAB-MT is provided a timing advance offset value
$N_{TA,offset,2}$ for a serving cell by _Case-7 Timing advance offset MAC CE_
[11, TS 38.321]. The IAB-MT determines its uplink transmission timing as
**T~TA~ + N~TA,offset,2~ ·T~c~** where $T_{\text{TA}}$ is defined in clause
4.3.1 of [4, TS 38.211] and $N_{TA,offset,2} = T_{offset,2} \cdot 16 \cdot
\frac{64}{2^{\mu}}$ where $T_{offset,2}$ is provided by the _Case-7_ Timing
_advance_ offset MAC CE [11, TS 38.321].
A slot format for an IAB-DU or an IAB-MT includes downlink symbols, uplink
symbols, and flexible symbols.
For each cell of an IAB-DU, the IAB-DU can be provided an indication for a
slot format over a number of slots by _gNB-DU Cell Resource Configuration_
[16, TS 38.473].
For each serving cell, an IAB-MT can be provided an indication for a slot
format over a number of slots by _tdd-UL-DL-ConfigurationDedicated-IAB-MT_. If
the IAB-MT is provided _tdd-UL-DL-ConfigurationDedicated-IAB-MT_ , the
statements in clause 11.1 that include \"_tdd-UL-DL-ConfigurationDedicated_ \"
apply to the IAB-MT of an IAB node by replacing \"_tdd-UL-DL-
ConfigurationDedicated_ \" with \"_tdd-UL-DL-ConfigurationDedicated-IAB-MT_ \"
for the IAB-MT, except that the _tdd-UL-DL-ConfigurationDedicated-IAB-MT_
provides
\- a set of slot configurations by _slotSpecificConfigurationsToAddModList-
IAB-MT_
\- for each slot configuration from the set of slot configurations
\- a slot index for a slot provided by _slotIndex_
\- a set of symbols for a slot by _symbols-IAB-MT_ where
\- if _symbols-IAB-MT_ = _allDownlink_ , all symbols in the slot are downlink
\- if _symbols-IAB-MT_ = _allUplink_ , all symbols in the slot are uplink
\- if _symbols-IAB-MT_ = _explicit_ , _nrofDownlinkSymbols_ provides a number
of downlink first symbols in the slot and _nrofUplinkSymbols_ provides a
number of uplink last symbols in the slot. If _nrofDownlinkSymbols_ is not
provided, there are no downlink first symbols in the slot and if
_nrofUplinkSymbols_ is not provided, there are no uplink last symbols in the
slot. The remaining symbols in the slot are flexible.
\- if _symbols-IAB-MT_ = _explicit-IAB-MT_ , _nrofUplinkSymbols_ provides a
number of uplink first symbols in the slot and _nrofDownlinkSymbols_ provides
a number of downlink last symbols in the slot. If _nrofUplinkSymbols_ is not
provided, there are no uplink first symbols in the slot and if
_nrofDownlinkSymbols_ is not provided, there are no downlink last symbols in
the slot. The remaining symbols in the slot are flexible.
If an IAB-MT is configured with an MCG and an SCG, is not capable of
simultaneous transmission and reception, and would simultaneously transmit and
receive on the MCG and the SCG,
\- if flexible symbols are configured by both parent nodes for operation with
inter-donor NR-DC, the IAB-MT operates according to the scheduling from the
MCG
\- otherwise, if the IAB-MT is configured with multiple serving cells, is
provided _directionalCollisionHandling-_ r17 = \'enabled\' for a set of
serving cell(s) from the multiple serving cells, and indicates _half-
DuplexTDD-CA-SameSCS_ capability across MCG and SCG for NR-DC operation, the
IAB-MT applies the procedures for resolving directional collisions as
described in clause 11.1 for resolving directional collisions across serving
cells.
An IAB-MT can be provided, by _SlotFormatCombinationsPerCell_ , a list of slot
format combinations applicable for one serving cell and, by
_SlotFormatIndicator_ , a configuration for monitor a DCI format 2_0
indicating a slot format combination, from the list of slot format
combinations, over a number of slots as described in clause 11.1.1. In
addition to the slot formats in Table 11.1.1-1, an SFI field for an IAB-MT in
DCI format 2_0 can indicate to the IAB-MT a slot format from the slot formats
in Table 14-2.
Table 14-2: Slot formats for normal cyclic prefix
**Slot** **Format** | **Symbol number in a slot** |  |  |  |  |  |  |  |  |  |  |  |  |   
---|---|---|---|---|---|---|---|---|---|---|---|---|---|---  
| **0** | **1** | **2** | **3** | **4** | **5** | **6** | **7** | **8** | **9** | **10** | **11** | **12** | **13**  
56 | U | U | U | U | U | U | U | U | U | U | U | U | U | F  
57 | U | U | U | U | U | U | U | U | U | U | U | U | F | F  
58 | U | U | U | U | U | U | U | U | U | U | U | F | F | F  
59 | U | U | U | U | U | U | U | U | U | U | F | F | F | F  
60 | U | U | U | U | U | U | U | U | U | F | F | F | F | F  
61 | U | U | U | U | U | U | U | U | F | F | F | F | F | F  
62 | U | U | U | U | U | U | U | F | F | F | F | F | F | F  
63 | U | U | U | U | U | U | F | F | F | F | F | F | F | F  
64 | U | U | U | U | U | F | F | F | F | F | F | F | F | F  
65 | U | U | U | U | F | F | F | F | F | F | F | F | F | F  
66 | U | U | U | F | F | F | F | F | F | F | F | F | F | F  
67 | U | U | F | F | F | F | F | F | F | F | F | F | F | F  
68 | U | F | F | F | F | F | F | F | F | F | F | F | F | F  
69 | U | F | F | F | F | F | F | F | F | F | F | F | F | D  
70 | U | U | F | F | F | F | F | F | F | F | F | F | F | D  
71 | U | U | U | F | F | F | F | F | F | F | F | F | F | D  
72 | U | F | F | F | F | F | F | F | F | F | F | F | D | D  
73 | U | U | F | F | F | F | F | F | F | F | F | F | D | D  
74 | U | U | U | F | F | F | F | F | F | F | F | F | D | D  
75 | U | F | F | F | F | F | F | F | F | F | F | D | D | D  
76 | U | U | F | F | F | F | F | F | F | F | F | D | D | D  
77 | U | U | U | F | F | F | F | F | F | F | F | D | D | D  
78 | U | U | U | U | U | U | U | U | U | U | U | U | F | D  
79 | U | U | U | U | U | U | U | U | U | U | U | F | F | D  
80 | U | U | U | U | U | U | U | U | U | U | F | F | F | D  
81 | U | U | U | U | U | U | U | U | U | U | U | F | D | D  
82 | U | U | U | U | U | U | U | U | U | U | F | F | D | D  
83 | U | U | U | U | U | U | U | U | U | F | F | F | D | D  
84 | U | F | D | D | D | D | D | D | D | D | D | D | D | D  
85 | U | U | F | D | D | D | D | D | D | D | D | D | D | D  
86 | U | U | U | F | D | D | D | D | D | D | D | D | D | D  
87 | U | F | F | D | D | D | D | D | D | D | D | D | D | D  
88 | U | U | F | F | D | D | D | D | D | D | D | D | D | D  
89 | U | U | U | F | F | D | D | D | D | D | D | D | D | D  
90 | U | F | F | F | D | D | D | D | D | D | D | D | D | D  
91 | U | U | F | F | F | D | D | D | D | D | D | D | D | D  
92 | U | U | U | F | F | F | D | D | D | D | D | D | D | D  
93 | U | U | U | U | U | U | U | U | U | F | F | F | F | D  
94 | U | U | U | U | U | U | F | F | F | F | F | F | D | D  
95 | U | U | U | U | U | U | F | F | D | D | D | D | D | D  
96 | U | U | U | U | U | U | U | D | D | D | D | D | D | D  
For a serving cell of an IAB-MT, the IAB-MT can be provided by Provided Guard
Symbols MAC CE, for Case-1, Case-6 and Case-7 timing modes, respectively, a
number of symbols that will not be used for the IAB-MT in slots where the IAB-
node transitions between IAB-MT and IAB-node DU and a SCS configuration for
the number of symbols [11, TS 38.321].
With reference to slots of an IAB-DU cell, a symbol in a slot of an IAB-DU
cell can be configured to be of hard, soft, or unavailable type by _HSNA Slot
Configuration List_ in _gNB-DU Cell Resource Configuration_ [16, TS 38.473].
When a downlink, uplink, or flexible symbol is configured as hard, the IAB-DU
cell can respectively transmit, receive, or either transmit or receive in the
symbol. A symbol of a slot is equivalent to being configured as hard if an
IAB-DU would transmit a SS/PBCH block, PDCCH for Type0-PDCCH CSS sets
configured by _pdcchConfigSIB1,_ or a periodic CSI-RS in the symbol of the
slot, or would receive a PRACH or a SR in the symbol of the slot.
When a downlink, uplink, or flexible symbol is configured as soft, the IAB-DU
cell can respectively transmit, receive or either transmit or receive in the
symbol only if
\- the IAB-MT does not transmit or receive during the symbol of the IAB-DU
cell, or
\- with respect to all serving cells, the IAB-MT would transmit or receive
during the symbol of the IAB-DU cell, and the transmission or reception during
the symbol of the IAB-DU cell is not changed due to a use of the symbol by the
IAB-DU, or
\- the IAB-MT detects a DCI format 2_5 with an AI index field value indicating
the soft symbol as available if the IAB-MT is not configured with an SCG, or
\- the IAB-MT detects two DCI formats 2_5 with an AI index field indicating
the soft symbol as available from the MCG and SCG, respectively, or
\- the IAB-MT detects a DCI format 2_5 with an AI index field value indicating
the soft symbol as available from one cell group and with respect to all
serving cells of the other cell group
\- the IAB-MT does not transmit or receive during the symbol of the IAB-DU
cell, or
\- the IAB-MT would transmit or receive during the symbol of the IAB-DU cell,
and the transmission or reception during the symbol of the IAB-DU cell does
not change due to a use of the symbol by the IAB-DU.
When the IAB-MT receives a DCI format 2_5 from a serving cell in a cell group,
the IAB-MT applies the information of the DCI format 2_5 to all serving cells
of the cell group.
When a symbol is configured as unavailable, the IAB-DU neither transmits nor
receives in the symbol.
With reference to slots of an IAB-DU cell, the IAB-DU can be provided an
indication of hard, soft or unavailable type per RB set for symbols configured
as downlink, uplink or flexible in a slot by _Frequency-Domain HSNA
Configuration List_ [16, TS 38.473]. The RB set size and the number of RB sets
are configured by _RB Set Configuration_ [16, TS 38.473]. The IAB-node can
assume the RB set size for the IAB-DU cell is larger than or equal to the IAB-
MT's smallest RBG size of the configured BWPs of the FDM required IAB-MT's
serving cell(s) as indicated in Multiplexing Info [16, TS 38.473] of the DU
cell. If an indication of hard, soft or unavailable type is not provided for
an RB set of a symbol in a slot, the IAB-DU applies the configuration of hard,
soft or unavailable type provided by _HSNA Slot Configuration List_ in _gNB-DU
Cell Resource Configuration_ [16, TS 38.473] for the RB set of the symbol in
the slot. If an indication of hard, soft, or unavailable type is provided for
an RB set in a symbol of a slot, the IAB-DU applies the configuration of hard,
soft, or unavailable type provided by _Frequency-Domain HSNA Configuration
List_ [16, TS 38.473] unless the symbol is configured as soft type in _HSNA
Slot Configuration List_ in _gNB-DU Cell Resource Configuration_ [16, TS
38.473] and the IAB-DU cell can transmit or receive in the symbol.
When an RB set of a downlink, uplink, or flexible symbol is configured as
hard, the IAB-DU cell can respectively transmit, receive, or either transmit
or receive on the RB set in the symbol. An RB set of a symbol is equivalent to
being configured as hard if an IAB-DU would transmit a SS/PBCH block, PDCCH
for Type0-PDCCH CSS sets configured by _pdcchConfigSIB1_ , or a periodic CSI-
RS in the RB set of the symbol, or would receive a PRACH or a SR in the RB set
of the symbol.
When an RB set of a downlink, uplink, or flexible symbol is configured as
soft, the IAB-DU cell can respectively transmit, receive or either transmit or
receive on the RB set in the symbol only if
\- the IAB-MT does not transmit or receive on the RB set during the symbol of
the IAB-DU cell, or
> \- with respect to all serving cells, the IAB-MT would transmit or receive
> on the RB set during the symbol of the IAB-DU cell, and the transmission or
> reception on the RB set or any RB set that is configured as unavailable or
> configured as soft and not indicated as available during the symbol of the
> IAB-DU cell is not changed due to a use of the RB set in the symbol by the
> IAB-DU, or
>
> \- the IAB-MT detects a DCI format 2_5 with an AI index field value
> indicating the soft RB set as available if the IAB-MT is not configured with
> an SCG, or
>
> \- the IAB-MT detects two DCI formats 2_5 with an AI index field value
> indicating the soft RB set as available from the MCG and SCG, respectively,
> or
>
> \- the IAB-MT detects a DCI format 2_5 with an AI index field value
> indicating the soft RB set as available from one cell group and with respect
> to all serving cells of the other cell group, the IAB-MT would transmit or
> receive on the RB set during the symbol of the IAB-DU cell, and the
> transmission or reception on the RB set during the symbol of the IAB-DU cell
> does not change due to a use of the RB set in the symbol by the IAB-DU.
When an RB set of a downlink, uplink, or flexible symbol is configured as
unavailable, the IAB-DU neither transmits nor receives in the RB set in the
symbol.
If an IAB-node is provided an _AvailabilityIndicator_ , the IAB-node is
provided an AI-RNTI by _ai-RNTI_ and a payload size of a DCI format 2_5 by
_dci-PayloadSizeAI_. The IAB-node is also provided a search space set
configuration, by **_SearchSpace, for monitoring PDCCH._**
For each cell of an IAB-DU in a set of cells of the IAB-DU, the IAB-DU can be
provided:
\- an identity of the IAB-DU cell by _iab-DU-CellIdentity_
\- a location of an availability indicator (AI) index field in DCI format 2_5
by _positionInDCI-AI-r16_ and/or by _positionInDCI-AI-RBGroups-v1720_
\- a set of availability combinations by _availabilityCombinations-r16_ or by
_availabilityCombinationsRB-Groups-r17_ , where each availability combination
in the set of availability combinations includes
\- _resourceAvailability-r16_ indicating availability of soft symbols in one
or more slots for the IAB-DU cell, or one _resourceAvailability-r17_
indicating availability of soft resources in all RB sets in one or more slots
for the IAB-DU cell, or one or multiple RB set groups by _rb-SetGroups-r17_
with each RB set groups by _RB-SetGroup-r17_ indicating
_resourceAvailability-r17_ for soft resources in one or more slots for the
associated _rb-Sets-r17_ , and
\- a mapping for the soft symbol, and/or for soft resources, availability
combinations provided by _resourceAvailability-r16 or
resourceAvailability-r17_ to a corresponding AI index field value in DCI
format 2_5 provided by _availabilityCombinationId-r16 or
availabilityCombinationId-r17, respectively_
With reference to a slot of an IAB-DU cell, if the IAB-DU is not provided an
indication of hard, soft or unavailable type per RB set by _Frequency-Domain
HSNA Configuration List_ [16, TS 38.473], the indication of availability for
the slot is based solely on _availabilityCombinations-r16_.
The IAB-DU can assume a same SCS configuration for
_availabilityCombinations-r16_ or _availabilityCombinationsRB-Groups-r17_ for
slots of a cell as an SCS configuration provided by _gNB-DU Cell Resource
Configuration_ for the cell.
The IAB-DU can assume a same SCS configuration for
_availabilityCombinationsRB-Groups-r17_ for RB sets of a cell as a SCS
configuration provided by _RB Set Configuration_ for the cell.
An AI index field value in a DCI format 2_5 indicates to an IAB-DU a soft
symbol and/or a soft RB set in an RB set group availability in each slot for a
number of slots starting from the earliest slot of the IAB-DU which overlaps
in time with the slot of the IAB-MT where the IAB-MT detects the DCI format
2_5. The number of slots is equal to or larger than a PDCCH monitoring
periodicity for DCI format 2_5 as provided by **_SearchSpace_**. The AI index
field includes $\max\left{ \left\lceil \log_{2}\left( \text{maxAIindex} + 1
\right) \right\rceil,1 \right}$ bits where maxAIindex is the maximum of the
values provided by corresponding _availabilityCombinationId_. An availability
for a soft symbol or a soft RB set in an RB set group in a slot is identified
by a corresponding value _resourceAvailability_ as provided in Table 14-3.
Table 14-3: Mapping between values of _resourceAvailability_ elements and
types of soft symbol or soft RB set availability in a slot
+-------+-------------------------------------------------------------+ | Value | Indication | +=======+=============================================================+ | 0 | No indication of availability for soft symbols or soft RB | | | sets in an RB set group | +-------+-------------------------------------------------------------+ | 1 | DL soft symbols or soft RB sets in an RB set group are | | | indicated available | | | | | | No indication of availability for UL and Flexible soft | | | symbols or soft RB sets in an RB set group | +-------+-------------------------------------------------------------+ | 2 | UL soft symbols or soft RB sets in an RB set group are | | | indicated available | | | | | | No indication of availability for DL and Flexible soft | | | symbols or soft RB sets in an RB set group | +-------+-------------------------------------------------------------+ | 3 | DL and UL soft symbols or soft RB sets in an RB set group | | | are indicated available | | | | | | No indication of availability for Flexible soft symbols or | | | soft RB sets in an RB set group | +-------+-------------------------------------------------------------+ | 4 | Flexible soft symbols or soft RB sets in an RB set group | | | are indicated available | | | | | | No indication of availability for DL and UL soft symbols or | | | soft RB sets in an RB set group | +-------+-------------------------------------------------------------+ | 5 | DL and Flexible soft symbols or soft RB sets in an RB set | | | group are indicated available | | | | | | No indication of availability for UL soft symbols or soft | | | RB sets in an RB set group | +-------+-------------------------------------------------------------+ | 6 | UL and Flexible soft symbols or soft RB sets in an RB set | | | group are indicated available | | | | | | No indication of availability for DL soft symbols or soft | | | RB sets in an RB set group | +-------+-------------------------------------------------------------+ | 7 | DL, UL, and Flexible soft symbols or soft RB sets in an RB | | | set group are indicated available | +-------+-------------------------------------------------------------+
If a PDCCH monitoring periodicity for DCI format 2_5 is smaller than a
duration of an availability combination of soft symbols over a number of slots
that the IAB-MT obtains at a PDCCH monitoring occasion for DCI format 2_5 by a
corresponding AI index field value, and the IAB-MT detects more than one DCI
formats 2_5 indicating an availability combination of soft symbols or of soft
RB sets in RB set groups in a slot, the IAB-MT expects that each of the more
than one DCI formats 2_5 indicates a same value for the availability
combination of the soft symbols or of soft RB sets in an RB set group in the
slot. An IAB-MT monitors PDCCH candidates for a DCI format 2_5 with CRC
scrambled by AI-RNTI in one or both of the following search space sets:
\- a Type3-PDCCH CSS set configured by _SearchSpace_ in _PDCCH-Config_ with
_searchSpaceType_ = _common_ ;
\- a USS set configured by _SearchSpace_ in _PDCCH-Config_ with
_searchSpaceType_ = ue-Specific.
The IAB-node can be provided by the parent node a set of RS resource indexes
that indicate quasi co-location properties of an IAB-DU cell where
simultaneous transmission/reception from the IAB-MT and transmission from the
IAB-DU cells is restricted by Child IAB-DU Restricted Beam Indication MAC CE
as described in [11, TS 38.321]. The IAB-DU does not transmit on a cell if the
IAB node is operating in a non-TDM multiplexing mode using an indicated RS
resource index on a symbol or RB set configured as soft in an IAB-DU cell
\- when it is not indicated as available by _resourceAvailability_
\- when the IAB-MT is operating on an associated carrier, if that indication
is provided
\- when the current IAB-DU transmission mode corresponds to an associated
multiplexing mode, if that indication is provided
\- when one of the associated TCI states, RS resource indexes, or SRI of the
IAB-MT, if provided, is simultaneously used for reception or transmission of
the IAB-MT
\- when simultaneous transmission/reception by the IAB-MT and transmission
from the IAB-DU cell occur in non-overlapping frequency resources, if such
indication is provided, or when simultaneous transmission/reception by the
IAB-MT and transmission from the IAB-DU cell occur in overlapping frequency
resources
\- in a given slot, if that indication is provided
For a serving cell of an IAB-MT, the IAB-MT can be provided a set of TCI
states or a set of RS resource indexes corresponding to a SS/PBCH block or to
a CSI-RS resource index for a slot where a PDSCH EPRE adjustment is indicated
by DL Tx Power Adjustment MAC CE as described in [11, TS 38.321]. The PDSCH
EPRE can be derived from a downlink CSI-RS EPRE as described in [6, TS 38.214]
and a power offset provided by the _DL Tx Power adjustment_ field in _DL TX
Power Adjustment_ MAC CE as described in [11, TS 38.321]. The downlink CSI-RS
EPRE refers to the CSI-RS indicated by Reference CSI-RS ID in _DL Tx Power
Adjustment_ MAC CE as described in [11, TS 38.321]. The _DL TX Power
Adjustment_ provides the offset between PDSCH EPRE and CSI-RS EPRE. For a
downlink DM-RS and/or PT-RS associated with a PDSCH, the IAB-MT may assume
that the ratio of PDSCH EPRE to DM-RS EPRE, and/or PT-RS EPRE to PDSCH EPRE,
is obtained as for a \"UE\" in [6, TS 38.214]. If no TCI state or RS resource
index is provided to the IAB-MT, the IAB-MT may assume that a same PDSCH EPRE
adjustment applies to all TCI states or RS resource indexes configured for the
IAB-MT. A PDSCH EPRE adjustment provided by DL Tx Power Adjustment MAC CE may
be associated with
\- multiplexing mode of the IAB-node, if provided, and/or
\- when simultaneous reception by the IAB-MT and transmission/reception by an
IAB-DU cell occur in non-overlapping frequency resources, if provided, or when
simultaneous reception by the IAB-MT and transmission/reception by an IAB-DU
cell occur in overlapping frequency resources, if provided, and/or
\- slots indicated by slot indexes, if provided.
# 15 Dual active protocol stack based handover
If a UE indicates a capability for dual active protocol stack based handover
(DAPS HO), the UE can be provided with a source MCG and a target MCG.
If a UE is configured with a target MCG using NR radio access in FR1 or in FR2
and with a source MCG using NR radio access in FR2 or in FR1, respectively,
the UE performs transmission power control independently per cell group as
described in clauses 7.1 through 7.5.
When a PDCCH reception by a UE includes two PDCCH candidates from
corresponding search space sets, as described in clause 10.1, the end of the
PDCCH reception is the end of the PDCCH candidate that ends later.
If a UE is configured with a target MCG using NR radio access in FR1 and a
source MCG using NR radio access in FR1, the UE is configured a maximum power
$P_{\text{MCG}}$ for transmissions on the target MCG by _p-DAPS-Target_ and a
maximum power $P_{\text{SCG}}$ for transmissions on the source MCG by _p-DAPS-
Source_ and with an inter-CG power sharing mode by _uplinkPowerSharingDAPS-
Mode_. The UE determines a transmission power on the target MCG and a
transmission power on the source MCG per frequency range.
If the UE indicates support for semi-static power sharing mode1 and is
provided _uplinkPowerSharingDAPS-Mode_ = _Semi-static-mode1_ , the UE
determines a transmission power for the target MCG or for the source MCG as
described in clause 7.6.2 for **_nrdc-PCmode-FR1_** = _Semi-static-mode1_ by
considering the target MCG as the MCG and the source MCG as the SCG.
If the UE indicates support for semi-static power sharing mode2 and is
provided _uplinkPowerSharingDAPS-Mode_ = _Semi-static-mode2_ , the UE
determines a transmission power for the target MCG or for the source SCG as
described in clause 7.6.2 for **_nrdc-PCmode-FR1_** = _Semi-static-mode2_ by
considering the target MCG as the MCG and the source MCG as the SCG. The UE
expects to be provided _uplinkPowerSharingDAPS-Mode_ = _Semi-static-mode2_
only for synchronous DAPS HO operation [10, TS 38.133].
If the UE indicates support for dynamic power sharing and is provided
_uplinkPowerSharingDAPS-Mode_ = _Dynamic_ , the UE determines a transmission
power for the target MCG or for the source MCG as described in clause 7.6.2
for **_nrdc-PCmode-FR1_** = _Dynamic_ by considering the target MCG as the MCG
and the source MCG as the SCG.
Intra-frequency DAPS handover is described in clause 6.1.3.2 of [10, TS
38.133].
For DAPS handover that is not intra-frequency, if
> \- the UE does not indicate support of _interFreqUL-
> TransCancellationDAPS-r16_ , and
>
> \- UE does not indicate a capability for power sharing between source and
> target MCG in DAPS handover or the UE is not provided with
> _uplinkPowerSharingDAPS-Mode_ ,
the UE does not expect transmissions on the target and source cell in
overlapping time resources.
For DAPS handover that is not intra-frequency, if
> \- the UE indicates support of _interFreqUL-TransCancellationDAPS-r16_ , and
>
> \- UE does not indicate a capability for power sharing between source and
> target MCG in DAPS handover or the UE is not provided with
> _uplinkPowerSharingDAPS-Mode_ , and
>
> \- UE transmissions on the target cell and the source cell are in
> overlapping time resources,
the UE transmits only on the target cell, and cancels the transmission to
source cell.
For intra-frequency DAPS handover, if
> \- UE transmissions on the target cell and the source cell are in
> overlapping time resources,
the UE transmits only on the target cell and cancels the transmission on the
source cell.
The UE does not expect to cancel a transmission on the source cell if a first
symbol of the transmission on the source cell is less than $T_{\text{proc,2}}
+ d$ after a last symbol of a PDCCH reception where the UE receives a PDCCH
providing a DCI format scheduling a transmission on the target cell.
$T_{\text{proc,2}}$ is the PUSCH preparation time for the corresponding PUSCH
processing capability [6, TS 38.214] assuming $d_{\text{2}\text{,1}} = 1$, $d$
is a time duration corresponding to 2 symbols for SCS configuration $\mu$, and
$\mu$ is the smallest SCS configuration between the SCS configuration of the
PDCCH providing the DCI format and the SCS configuration for the transmission
on the source cell. If the UE transmits PRACH using 1.25 kHz or 5 kHz SCS on
the source cell, the UE determines $T_{\text{proc,2}}$ assuming SCS
configuration $\mu = 0$.
A UE does not expect to cancel a transmission on the source cell if the first
symbol of the source cell transmission occurs, relative to a last symbol of a
PDSCH reception conveying a RAR message with a RAR UL grant on the target
cell, after a number of symbols that is smaller than $N_{\text{T,1}} +
N_{\text{T,2}} + 0.5$ msec, where $N_{\text{T,1}}$ is a time duration of
$N_{\text{1}}$ symbols corresponding to a PDSCH processing time for UE
processing capability 1 when additional PDSCH DM-RS is configured,
$N_{\text{T,2}}$ is a time duration of $N_{\text{2}}$ symbols corresponding to
a PUSCH preparation time for UE processing capability 1 [6, TS 38.214] and the
UE considers that $N_{\text{1}}$ and $N_{2}$ correspond to the smaller of the
SCS configurations for the PDSCH on the target cell and the transmission on
the source cell. For $\mu = 0$, the UE assumes $N_{\text{1,0}} = 14$ [6, TS
38.214].
For intra-frequency DAPS handover operation, the UE expects that an active DL
BWP and an active UL BWP on the target cell are within an active DL BWP and an
active UL BWP on the source cell, respectively.
If a UE is provided search space sets on both the target MCG and the source
MCG, in any slot the UE does not expect to have USS sets on both the target
MCG and the source MCG that result in the number of monitored PDCCH candidates
and the total number of non-overlapped CCEs in both cells that each exceed the
corresponding maximum numbers per slot defined in Table 10.1-2 and Table
10.1-3.
For DAPS operation in a same frequency band, a UE does not transmit
PUSCH/PUCCH/SRS to the source MCG in a slot overlapping in time with a PRACH
transmission to the target MCG or when a gap between a first or last symbol of
a PRACH transmission to the target MCG in a first slot would be separated by
less than $N$ symbols from a last or first symbol, respectively, of the
PUSCH/PUCCH/SRS transmission to the source MCG in a second slot. For DAPS
operation in a same frequency band, a UE does not transmit PRACH on the source
MCG in a slot overlapping in time with a PUSCH/PUCCH/SRS transmission on the
target MCG or when a gap between the first or last symbol of a PUSCH/PUCCH/SRS
transmission on the target MCG is separated by less than $N$ symbols from a
last or a first symbol, respectively, of a PRACH transmission on the source
MCG. $N = 2$ for $\mu = 0$ or $\mu = 1$, $N = 4$ for $\mu = 2$ or $\mu = 3$,
and $\mu$ is the SCS configuration of the active UL BWP for the
PUSCH/PUCCH/SRS transmission. The PUSCH processing capability is the
processing capability of source cell.
# 16 UE **procedures for sidelink**
A UE is provided by _SL-BWP-Config_ or _SL-BWP-ConfigCommon_ a BWP for SL
transmissions (SL BWP) with numerology and resource grid determined as
described in [4, TS 38.211]. For a resource pool within the SL BWP, the UE is
provided by _sl-NumSubchannel_ a number of sub-channels where each sub-channel
includes a number of contiguous RBs provided by _sl-SubchannelSize_. The first
RB of the first sub-channel in the SL BWP is indicated by _sl-StartRB-
Subchannel_. Available slots for a resource pool are provided by _sl-
TimeResource_ and occur with a periodicity of 10240 ms. For an available slot
without S-SS/PSBCH blocks, SL transmissions can start from a first symbol
indicated by _sl-StartSymbol_ and be within a number of consecutive symbols
indicated by _sl-LengthSymbols_. For an available slot with S-SS/PSBCH blocks,
the first symbol and the number of consecutive symbols is predetermined.
The UE expects to use a same numerology in the SL BWP and in an active UL BWP
in a same carrier of a same cell. If the active UL BWP numerology is different
than the SL BWP numerology, the SL BWP is deactivated.
A priority of a PSSCH according to **NR radio access** or according to E-UTRA
**radio access** is indicated by a priority field in a respective scheduling
SCI format. A priority of a PSSS/SSSS/PSBCH according to E-UTRA radio access
is provided by _sl-SSB-PriorityEUTRA_ [13, TS 36.213]. A priority of an
S-SS/PSBCH block is provided by _sl-SSB-PriorityNR_. A priority of a PSFCH is
determined as described in clause 16.2.4.2.
**A UE does not expect to be provided search space sets associated with
CORESETs on more than one cell to monitor PDCCH for detection of DCI format
3_0 or DCI format 3_1.**
## 16.1 Synchronization procedures
A UE receives the following SL synchronization signals in order to perform
synchronization procedures based on S-SS/PSBCH blocks: SL primary
synchronization signals (S-PSS) and SL secondary synchronization signals
(S-SSS) [4, TS 38.211].
A UE assumes that reception occasions of a physical sidelink broadcast channel
(PSBCH), S-PSS, and S-SSS are in consecutive symbols [4, TS 38.211] and form a
S-SS/PSBCH block.
For reception of a S-SS/PSBCH block, a UE assumes a frequency location
corresponding to the subcarrier with index 66 in the S-SS/PSBCH block [4, TS
38.211], is provided by _sl-AbsoluteFrequencySSB_. The UE assumes that a S-PSS
symbol, a S-SSS symbol, and a PSBCH symbol have a same transmission power. The
UE assumes a same numerology of the S-SS/PSBCH as for a SL BWP of the
S-SS/PSBCH block reception, and that a bandwidth of the S-SS/PSBCH is within a
bandwidth of the SL BWP. The UE assumes the subcarrier with index 0 in the
S-SS/PSBCH block is aligned with a subcarrier with index 0 in an RB of the SL
BWP.
A UE is provided, by _sl-NumSSB-WithinPeriod_ , a number $N_{\text{period}}^{S
- SSB}$ of S-SS/PSBCH blocks in a period of 16 frames. The UE assumes that a
transmission of the S-SS/PSBCH blocks in the period is with a periodicity of
16 frames. The UE determines indexes of slots that include S-SS/PSBCH block as
$N_{\text{offset}}^{S - SSB}$+$\left( N_{\text{interval}}^{S - SSB} + 1
\right) \cdot i_{S - SSB}$, where
\- index 0 corresponds to a first slot in a frame with SFN of the serving cell
satisfying $(SFN\ mod\ 16) = 0$ or DFN satisfying (DFN mod 16) = 0
\- $i_{S - SSB}$ is a S-SS/PSBCH block index within the number of S-SS/PSBCH
blocks in the period, with $0 \leq i_{S - SSB} \leq N_{\text{period}}^{S -
SSB} - 1$
\- $N_{\text{offset}}^{S - SSB}$ is a slot offset from a start of the period
to the first slot including S-SS/PSBCH block, provided by _sl-TimeOffsetSSB_
\- $N_{\text{interval}}^{S - SSB}$ is a slot interval between S-SS/PSBCH
blocks, provided by _sl-TimeInterval_
For paired spectrum, an S-SS/PSBCH block can be transmitted/received only in a
slot of an UL carrier. For unpaired spectrum, an S-SS/PSBCH block can be
transmitted/received only in a slot of which all OFDM symbols are configured
as UL by _tdd-UL-DL-ConfigurationCommon_ of the serving cell if provided or
_sl-TDD-Configuration_ if provided or _sl-TDD-Config_ of the received PSBCH if
provided. Or if _tdd-UL-DL-ConfigurationCommon_ and _sl-TDD-Configuration_ are
not provided for a spectrum indicated with only PC5 interface in Table
5.2E.1-1 in [TS 38.101-1], an S-SS/PSBCH block can be transmitted/received in
any slot of the spectrum.
For transmission of an S-SS/PSBCH block, a UE includes a bit sequence $a_{0},\
a_{1},\ a_{2},\ a_{3},\ \ldots,\ a_{11}$ in the PSBCH payload to indicate _sl-
TDD-Config_ and provide a slot format over a number of slots.
For paired spectrum, or if _tdd-UL-DL-ConfigurationCommon_ and _sl-TDD-
Configuration_ are not provided for a spectrum indicated with only PC5
interface in Table 5.2E.1-1 in [TS 38.101-1],
\- $a_{0},\ a_{1},\ a_{2},\ a_{3},a_{4}{,\ a}_{5},\ a_{6},\ a_{7},a_{8},\
a_{9},\ a_{10},\ a_{11}$ are set to \'1\';
else
\- $a_{0} = 0$ if _pattern1_ is provided by _sl-TDD-Configuration or tdd-UL-
DL-ConfigurationCommon_ ; $a_{0} = 1$ if both _pattern1_ and _pattern2_ are
provided by _sl-TDD-Configuration or tdd-UL-DL-ConfigurationCommon_ as
described in clause 11.1
\- $a_{1},\ a_{2},\ a_{3},a_{4}$ are determined based on
\- $P$ _in pattern1_ as described in Table 16.1-1 for $a_{0} = 0$
\- $P$ _in pattern1_ and $P_{2}$ _in pattern2_ as described in Table 16.1-2
for $a_{0} = 1$
where $P$ and $P_{2}$ are as described in clause 11.1
\- $a_{5},\ a_{6},\ a_{7},a_{8},\ a_{9},\ a_{10},\ a_{11}$ are the 7th to 1st
LSBs of $u_{\text{slots}}^{\text{SL}}$_, respectively_
\- for $a_{0} = 0$, $u_{\text{slots}}^{\text{SL}} = u_{\text{slots}}_2^{\mu -
\mu_{\text{ref}}} + \left\lfloor \frac{u_{\text{sym}}_ 2^{\mu -
\mu_{\text{ref}}}}{L} \right\rfloor + I_{1}$
\- for $a_{0} = 1$, $u_{\text{slots}}^{\text{SL}} = \left\lfloor
\frac{u_{slots,2}_2^{\mu - \mu_{\text{ref}}} + \left\lfloor \frac{u_{sym,2}_
2^{\mu - \mu_{\text{ref}}}}{L} \right\rfloor + I_{2}}{w} \right\rfloor
_\left\lceil \frac{{P_ 2}^{\mu} + 1}{w} \right\rceil + \left\lfloor
\frac{u_{\text{slots}}_2^{\mu - \mu_{\text{ref}}} + \left\lfloor
\frac{u_{\text{sym}}_ 2^{\mu - \mu_{\text{ref}}}}{L} \right\rfloor + I_{1}}{w}
\right\rfloor$
> where
\- $L$ is the number of symbols in a slot: $L = 12$ if _cyclicPrefix_ =
\"ECP\"; else, $L = 14$
\- $I_{1}$ is 1 if $u_{\text{sym}}*2^{\mu - \mu_{\text{ref}}}\ mod\ L \geq \ L
- Y$, else $I_{1}$ is 0
\- $I_{2}$ is 1 if $u_{sym,2}*2^{\mu - \mu_{\text{ref}}}\ mod\ L \geq L - Y$,
else $I_{2}$ is 0
\- $Y$ is the sidelink starting symbol index provided by _sl-StartSymbol_
\- $w$ is the granularity of slots indication as described in Table 16.1-2
\- $\mu_{\text{ref}}$_,_ $u_{\text{slots}}$, $u_{\text{sym}}$, $u_{slots,2}$,
$u_{sym,2}$ are the parameters of _tdd-UL-DL-ConfigurationCommon_ as described
in clause 11.1, or the parameters of _sl-TDD-Configuration_ as defined in [12,
TS 38.331]
\- $\mu = 0,\ 1,\ 2,\ 3$ corresponds to SL SCS as defined in [4, TS 38.211]
Table 16.1-1: Slot configuration period when one pattern is indicated
+----------------------------------+----------------------------------+ | $$ | Slot configuration period of | | \mathbf{a}_{\mathbf{1}}\mathbf{, |_pattern1_ | | \ }\mathbf{a}_{\mathbf{2}}\mathb | | | f{,\ }\mathbf{a}_{\mathbf{3}}\ma | $\mathbf{P}$ (msec) | | thbf{,}\mathbf{a}_{\mathbf{4}}$$ | | +==================================+==================================+ | 0, 0, 0, 0 | 0.5 | +----------------------------------+----------------------------------+ | 0, 0, 0, 1 | 0.625 | +----------------------------------+----------------------------------+ | 0, 0, 1, 0 | 1 | +----------------------------------+----------------------------------+ | 0, 0, 1, 1 | 1.25 | +----------------------------------+----------------------------------+ | 0, 1, 0, 0 | 2 | +----------------------------------+----------------------------------+ | 0, 1, 0, 1 | 2.5 | +----------------------------------+----------------------------------+ | 0, 1, 1, 0 | 4 | +----------------------------------+----------------------------------+ | 0, 1, 1, 1 | 5 | +----------------------------------+----------------------------------+ | 1, 0, 0, 0 | 10 | +----------------------------------+----------------------------------+ | Reserved | Reserved | +----------------------------------+----------------------------------+
Table 16.1-2: Slot configuration period and granularity when two patterns are
indicated
+---------+---------+---------+---------+--------+--------+---------+ | $$\m | Slot | Slot | * | | | | | athbf{a | config | config | _Granul | | | | | }_{\mat | uration | uration | arity_ _| | | | | hbf{1}} | period | period | $\mat | | | | | \mathbf | of | of | hbf{w}$ | | | | | {,\ }\m |_ pa | _pa |__in | | | | | athbf{a | ttern1_ | ttern2 _| slots | | | | | }_{\mat | | | with | | | | | hbf{2}} | $\mat | $\ma | di | | | | | \mathbf | hbf{P}$ | thbf{P} | fferent | | | | | {,\ }\m | (msec) |_{\math | SCS_* | | | | | athbf{a | | bf{2}}$ | | | | | | }_{\mat | | (msec) | | | | | | hbf{3}} | | | | | | | | \mathbf | | | | | | | | {,}\mat | | | | | | | | hbf{a}_ | | | | | | | | {\mathb | | | | | | | | f{4}}$$ | | | | | | | +=========+=========+=========+=========+========+========+=========+ | | | | 15kHz | 30 kHz | 60 kHz | 120 kHz | +---------+---------+---------+---------+--------+--------+---------+ | 0, 0, | 0.5 | 0.5 | 1 | | | | | 0, 0 | | | | | | | +---------+---------+---------+---------+--------+--------+---------+ | 0, 0, | 0.625 | 0.625 | | | | | | 0, 1 | | | | | | | +---------+---------+---------+---------+--------+--------+---------+ | 0, 0, | 1 | 1 | | | | | | 1, 0 | | | | | | | +---------+---------+---------+---------+--------+--------+---------+ | 0, 0, | 0.5 | 2 | | | | | | 1, 1 | | | | | | | +---------+---------+---------+---------+--------+--------+---------+ | 0, 1, | 1.25 | 1.25 | | | | | | 0, 0 | | | | | | | +---------+---------+---------+---------+--------+--------+---------+ | 0, 1, | 2 | 0.5 | | | | | | 0, 1 | | | | | | | +---------+---------+---------+---------+--------+--------+---------+ | 0, 1, | 1 | 3 | 1 | 2 | | | | 1, 0 | | | | | | | +---------+---------+---------+---------+--------+--------+---------+ | 0, 1, | 2 | 2 | | | | | | 1, 1 | | | | | | | +---------+---------+---------+---------+--------+--------+---------+ | 1, 0, | 3 | 1 | | | | | | 0, 0 | | | | | | | +---------+---------+---------+---------+--------+--------+---------+ | 1, 0, | 1 | 4 | | | | | | 0, 1 | | | | | | | +---------+---------+---------+---------+--------+--------+---------+ | 1, 0, | 2 | 3 | | | | | | 1, 0 | | | | | | | +---------+---------+---------+---------+--------+--------+---------+ | 1, 0, | 2.5 | 2.5 | | | | | | 1, 1 | | | | | | | +---------+---------+---------+---------+--------+--------+---------+ | 1, 1, | 3 | 2 | | | | | | 0, 0 | | | | | | | +---------+---------+---------+---------+--------+--------+---------+ | 1, 1, | 4 | 1 | | | | | | 0, 1 | | | | | | | +---------+---------+---------+---------+--------+--------+---------+ | 1, 1, | 5 | 5 | 1 | 2 | 4 | | | 1, 0 | | | | | | | +---------+---------+---------+---------+--------+--------+---------+ | 1, 1, | 10 | 10 | 1 | 2 | 4 | 8 | | 1, 1 | | | | | | | +---------+---------+---------+---------+--------+--------+---------+
If a UE would transmit or receive an S-SS/PSBCH block, and the transmission or
reception would overlap in time with transmissions or receptions on the
sidelink using E-UTRA radio access, the UE transmits or receives the
signal/channel with the higher priority.
If a UE would transmit or receive sidelink synchronization signals for E-UTRA
radio access, and the transmission or reception would overlap in time with
sidelink transmissions or receptions using NR radio access, the UE transmits
or receives the signal/channel with the higher priority.
## 16.2 Power control
### 16.2.0 S-SS/PSBCH blocks
A UE determines a power $P_{\text{S-SSB}}(i)$ for an S-SS/PSBCH block
transmission occasion in slot $i$ on active SL BWP $b$ of carrier $f$ as
$P_{\text{S-SSB}}(i) = \min\left( P_{\text{CMAX}},P_{\text{O},S - SSB} +
10\log_{10}\left( 2^{\mu} \bullet M_{\text{RB}}^{S - SSB} \right) + \alpha_{S
- SSB} \cdot \text{PL} \right)$ [dBm]
where
\- $P_{\text{CMAX}}$ is defined in [8-1, TS 38.101-1]
\- $P_{\text{O},S - SSB}$ is a value of _dl-P0-PSBCH-r17_ if using the
parameter is supported by the UE and the parameter is provided; else
_dl-P0-PSBCH-r16 if provided;_ otherwise, $P_{\text{S-SSB}}(i) =
P_{\text{CMAX}}$
\- $\alpha_{S - SSB}$ is a value of _dl-Alpha-PSBCH, if_ provided; else,
$\alpha_{S - SSB} = 1$
\- $PL = PL_{b,f,c}(q_{d})$ when the active SL BWP is on a serving cell $c$,
as described in clause 7.1.1 except that
\- the RS resource is the one the UE uses for determining a power of a PUSCH
transmission scheduled by a DCI format 0_0 in serving cell $c$ when the UE is
configured to monitor PDCCH for detection of DCI format 0_0 in serving cell
$c$
\- the RS resource is the one corresponding to the SS/PBCH block the UE uses
to obtain MIB when the UE is not configured to monitor PDCCH for detection of
DCI format 0_0 in serving cell $c$
\- $M_{\text{RB}}^{S - SSB} = 11$ is a number of resource blocks for a
S-SS/PSBCH block transmission with SCS configuration $\mu$
### 16.2.1 PSSCH
A UE determines a power $P_{\text{PSSCH}}(i)$ for a PSSCH transmission on a
resource pool in symbols where a corresponding PSCCH is not transmitted in
PSCCH-PSSCH transmission occasion $i$ on active SL BWP $b$ of carrier $f$ as:
$P_{\text{PSSCH}}(i) = \min\left(
P_{\text{CMAX}},P_{\text{MAX},CBR},\min\left( P_{\text{PSSCH},D}\left( i
\right),P_{\text{PSSCH},\text{SL}}(i) \right) \right)$ [dBm]
where
\- $P_{\text{CMAX}}$ is defined in [8-1, TS 38.101-1]
\- $P_{\text{MAX},CBR}$ is determined by a value of _sl-MaxTxPower based on a
priority level of the PSSCH transmission and a CBR range that includes a CBR
measured in slot_ $i - N$ [6, TS 38.214]; if _sl-MaxTxPower_ is not provided,
then $P_{\text{MAX},CBR} = P_{\text{CMAX}}$;
\- if _dl-P0-PSSCH-PSCCH_ is provided
\- $P_{\text{PSSCH},D}(i) = P_{\text{O},D} + 10\log_{10}\left( 2^{\mu} \cdot
M_{\text{RB}}^{\text{PSSCH}}\left( i \right) \right) + \alpha_{D} \cdot
PL_{D}$ [dBm]
\- else
\- $P_{\text{PSSCH},D}(i) = \min\left( P_{\text{CMAX}},P_{\text{MAX},CBR}
\right)$ [dBm]
where
\- $P_{\text{O},D}$ is a value of _dl-P0-PSSCH-PSCCH-r17_ if using the
parameter is supported by the UE and the parameter is provided; else
_dl-P0-PSSCH-PSCCH-r16 if provided_
\- $\alpha_{D}$ is a value of _dl-Alpha-PSSCH-PSCCH, if_ provided; else,
$\alpha_{D} = 1$
\- $PL_{D} = PL_{b,f,c}(q_{d})$ when the active SL BWP is on a serving cell
$c$, as described in clause 7.1.1 except that
\- the RS resource is the one the UE uses for determining a power of a PUSCH
transmission scheduled by a DCI format 0_0 in serving cell $c$ when the UE is
configured to monitor PDCCH for detection of DCI format 0_0 in serving cell
$c$
\- the RS resource is the one corresponding to the SS/PBCH block the UE uses
to obtain MIB when the UE is not configured to monitor PDCCH for detection of
DCI format 0_0 in serving cell $c$
\- $M_{\text{RB}}^{\text{PSSCH}}(i)$ is a number of resource blocks for the
PSSCH transmission occasion $i$ and $\mu$ is a SCS configuration
\- if _sl-P0-PSSCH-PSCCH_ is provided and if a SCI format scheduling the PSSCH
transmission includes a cast type indicator field indicating unicast or is SCI
format 2-C
\- $P_{\text{PSSCH},\text{SL}}(i) = P_{\text{O},\text{SL}} + 10\log_{10}\left(
2^{\mu} \cdot M_{\text{RB}}^{\text{PSSCH}}\left( i \right) \right) +
\alpha_{\text{SL}} \cdot PL_{\text{SL}}$ [dBm]
\- else
\- $P_{\text{PSSCH}\text{,SL}}(i) = \min\left(
P_{\text{CMAX}},P_{\text{PSSCH},D}(i) \right)$ [dBm]
where
\- $P_{\text{O},SL}$ is a value of _sl-P0-PSSCH-PSCCH-r17, if_ using the
parameter is supported by the UE and the parameter is _provided;_ else
_sl-P0-PSSCH-PSCCH-r16 if provided_
\- $\alpha_{\text{SL}}$ is a value of _sl-Alpha-PSSCH-PSCCH, if_ provided;
else, $\alpha_{\text{SL}} = 1$
\- $PL_{\text{SL}} = \ \text{referenceSignalPower}\ –\ \text{higher\ layer\
filtered\ RSRP}$, where
\- $\text{referenceSignalPower}$ is obtained from a PSSCH transmit power per
RE summed over the antenna ports of the UE, higher layer filtered across PSSCH
transmission occasions using a filter configuration provided by _sl-
FilterCoefficient_ , and
\- $\text{higher}\ \text{layer}\ \text{filtered}\ \text{RSRP}$ _is a_ RSRP, as
defined in [7, TS 38.215], that is _reported to the UE from a UE receiving the
PSCCH-PSSCH transmission and is obtained from a PSSCH DM-RS using a filter
configuration provided by sl-FilterCoefficient_
\- $M_{\text{RB}}^{\text{PSSCH}}(i)$ is a number of resource blocks for PSCCH-
PSSCH transmission occasion $i$ and $\mu$ is a SCS configuration
The UE splits the power $P_{\text{PSSCH}}(i)$ equally across the antenna ports
on which the UE transmits the PSSCH with non-zero power.
A UE determines a power $P_{\text{PSSCH2}}(i)$ for a PSSCH transmission on a
resource pool in the symbols where a corresponding PSCCH is transmitted in
PSCCH-PSSCH transmission occasion $i$ on active SL BWP $b$ of carrier $f$ as
$P_{PSSCH2}(i) = 10\log_{10}\left( \frac{M_{\text{RB}}^{\text{PSSCH}}\left( i
\right) - M_{\text{RB}}^{\text{PSCCH}}\left( i
\right)}{M_{\text{RB}}^{\text{PSSCH}}\left( i \right)} \right) +
P_{\text{PSSCH}}(i)$ [dBm]
where $M_{\text{RB}}^{\text{PSCCH}}(i)$ is a number of resource blocks for the
corresponding PSCCH transmission in PSCCH-PSSCH transmission occasion $i$.
The UE splits the power $P_{PSSCH2}(i)$ equally across the antenna ports on
which the UE transmits the PSSCH with non-zero power.
### 16.2.2 PSCCH
A UE determines a power $P_{\text{PSCCH}}(i)$ for a PSCCH transmission on a
resource pool in PSCCH-PSSCH transmission occasion $i$ as
$P_{\text{PSCCH}}(i) = 10\log_{10}\left(
\frac{M_{\text{RB}}^{\text{PSCCH}}\left( i
\right)}{M_{\text{RB}}^{\text{PSSCH}}\left( i \right)} \right) +
P_{\text{PSSCH}}(i)$ [dBm]
where
\- $P_{\text{PSSCH}}(i)$ is specified in clause 16.2.1
\- $M_{\text{RB}}^{\text{PSCCH}}(i)$ is a number of resource blocks for the
PSCCH transmission in PSCCH-PSSCH transmission occasion $i$
\- $M_{\text{RB}}^{\text{PSSCH}}(i)$ is a number of resource blocks for PSCCH-
PSSCH transmission occasion _i_
### 16.2.3 PSFCH
A UE with $N_{sch,Tx,PSFCH}$ scheduled PSFCH transmissions for HARQ-ACK
information and conflict information, and capable of transmitting a maximum of
$N_{max,PSFCH}$ PSFCHs, determines a number $N_{Tx,PSFCH}$ of simultaneous
PSFCH transmissions and a power $P_{\text{PSFCH}\text{,k}}(i)$ for a PSFCH
transmission $k$, $1 \leq k \leq N_{Tx,PSFCH}$, on all the resource pools in
PSFCH transmission occasion $i$ on active SL BWP $b$ of carrier $f$ as
\- if _dl-P0-PSFCH_ is provided,
$P_{\text{PSFCH}\text{,one}} = P_{\text{O},\text{PSFCH}} + 10\log_{10}\left(
2^{\mu} \right) + \alpha_{\text{PSFCH}} \cdot \text{PL}$ [dBm]
where
\- $P_{\text{O},\text{PSFCH}}$ is a value of _dl-P0-PSFCH-r17, if_ using the
parameter is supported by the UE and the parameter is _provided;_ else
_dl-P0-PSFCH-r16 if provided_
\- $\alpha_{\text{PSFCH}}$ is a value of _dl-Alpha-PSFCH, if_ provided; else,
$\alpha_{\text{PFSCH}} = 1$
\- $PL = PL_{b,f,c}(q_{d})$ when the active SL BWP is on a serving cell $c$,
as described in clause 7.1.1 except that
\- the RS resource is the one the UE uses for determining a power of a PUSCH
transmission scheduled by a DCI format 0_0 in serving cell $c$ when the UE is
configured to monitor PDCCH for detection of DCI format 0_0 in serving cell
$c$
\- the RS resource is the one corresponding to the SS/PBCH block the UE uses
to obtain MIB when the UE is not configured to monitor PDCCH for detection of
DCI format 0_0 in serving cell $c$
\- if $N_{sch,Tx,PSFCH} \leq N_{max,PSFCH}$
\- if $P_{\text{PSFCH}\text{,one}} + 10log_{10}\left( N_{sch,Tx,PSFCH} \right)
\leq P_{\text{CMAX}}$, where $P_{\text{CMAX}}$ is determined for
$N_{sch,Tx,PSFCH}$ PSFCH transmissions according to [8-1, TS 38.101-1]
\- $N_{Tx,PSFCH} = N_{sch,Tx,PSFCH}$ and $P_{\text{PSFCH,k}}(i) =
P_{\text{PSFCH,one}}$ [dBm]
\- else
\- UE autonomously determines $N_{Tx,PSFCH}$ PSFCH transmissions first with
ascending order of corresponding priority field values as described in clause
16.2.4.2 over the PSFCH transmissions with HARQ-ACK information, if any, and
then with ascending order of priority value over the PSFCH transmissions with
conflict information, if any, such that $N_{Tx,PSFCH} \geq \max\left(
1,\sum_{i = 1}^{K}M_{i} \right)$ where $M_{i}$, for $1 \leq i \leq \ 8$, is a
number of PSFCHs with priority value $i$ for PSFCH with HARQ-ACK information
and $M_{i}$, for $i > 8$, is a number of PSFCHs with priority value $i - 8$
for PSFCH with conflict information and $K$ is defined as
\- _the largest value satisfying_ $P_{\text{PSFCH}\text{,one}} +
10log_{10}\left( \max\left( 1,\sum_{i = 1}^{K}M_{i} \right) \right) \leq
P_{\text{CMAX}}$ where $P_{\text{CMAX}}$ is determined according to [8-1, TS
38.101-1] for transmission of all PSFCHs in $\sum_{i = 1}^{K}M_{i}$_, if any_
\- zero, otherwise
and
$P_{\text{PSFCH,k}}(i) = \min\left( P_{\text{CMAX}} -
10log_{10}(N_{Tx,PSFCH}),P_{\text{PSFCH,one}} \right)$ [dBm]
> where $P_{\text{CMAX}}$ is defined in [8-1, TS 38.101-1] and is determined
> for the $N_{Tx,PSFCH}$ PSFCH transmissions
\- else
\- the _UE autonomously_ _selects_ $N_{max,PSFCH}$ PSFCH transmissions with
ascending order of corresponding priority field values as described in clause
16.2.4.2
\- if $P_{\text{PSFCH}\text{,one}} + 10log_{10}\left( N_{max,PSFCH} \right)
\leq P_{\text{CMAX}}$, where $P_{\text{CMAX}}$ is determined for the
$N_{max,PSFCH}$ PSFCH transmissions according to [8-1, TS 38.101-1]
\- $N_{Tx,PSFCH} = N_{max,PSFCH}$ and $P_{\text{PSFCH,k}}(i) =
P_{\text{PSFCH,one}}$ [dBm]
\- else
\- the UE autonomously selects $N_{Tx,PSFCH}$ PSFCH transmissions in ascending
order of corresponding priority field values as described in clause 16.2.4.2
over the PSFCH transmissions with HARQ-ACK information, if any, and then with
ascending order of priority value over the PSFCH transmissions with conflict
information, if any, such that $N_{Tx,PSFCH} \geq \max\left( 1,\sum_{i =
1}^{K}M_{i} \right)$ where $M_{i}$, $1 \leq i \leq 8$, is a number of PSFCHs
with priority value $i$ for PSFCH with HARQ-ACK information and $M_{i}$, $i >
8,$ is a number of PSFCHs with priority value $i - 8$ for PSFCH with conflict
information and $K$ is defined as
> \- _the largest value satisfying_ $P_{\text{PSFCH}\text{,one}} +
> 10log_{10}\left( \max\left( 1,\sum_{i = 1}^{K}M_{i} \right) \right) \leq
> P_{\text{CMAX}}$ where $P_{\text{CMAX}}$ is determined according to [8-1, TS
> 38.101-1] for transmission of all PSFCHs in $\sum_{i = 1}^{K}M_{i}$_, if
> any_
>
> \- zero, otherwise
and
$P_{\text{PSFCH,k}}(i) = \min\left( P_{\text{CMAX}} -
10log_{10}(N_{Tx,PSFCH}),P_{\text{PSFCH,one}} \right)$ [dBm]
where $P_{\text{CMAX}}$ is determined for the $\ N_{Tx,PSFCH}$ simultaneous
PSFCH transmissions according to [8-1, TS 38.101-1]
\- else
$P_{\text{PSFCH,k}}(i) = P_{\text{CMAX}} - 10log_{10}(N_{Tx,PSFCH})$ [dBm]
where the _UE autonomously determines_ $N_{Tx,PSFCH}$ _PSFCH transmissions
with ascending order_ of corresponding priority field values _as described in
clause 16.2.4.2_ over the PSFCH transmissions with HARQ-ACK information, if
any, and then with ascending order of priority value over the PSFCH
transmissions with conflict information, if any, _such that_ $N_{Tx,PSFCH}
\geq 1$ and where $P_{\text{CMAX}}$ is determined for the $N_{Tx,PSFCH}$ PSFCH
transmissions according to [8-1, TS 38.101-1].
For resource pools configured with PSFCH resources overlapping in time, the UE
either expects not to be provided with _dl-P0-PSFCH_ or _dl-Alpha-PSFCH_ in
any of the resource pools, or expects to be provided with the same values of
_dl-P0-PSFCH_ and the same values of _dl-Alpha-PSFCH_ for all the resource
pools.
### 16.2.4 Prioritization of transmissions/receptions
#### 16.2.4.1 Simultaneous NR and E-UTRA transmission/reception
If a UE
\- **would transmit a first channel/signal using** E-UTRA radio access **and
second channels/signals using NR radio access, and**
\- **a transmission of the first channel/signal would overlap in time with a
transmission of the second channels/signals, and**
\- **the priorities of the channels/signals are known to both E-UTRA radio
access and NR radio access at the UE** $T$ **msec prior to the start of the
earliest of the two transmissions, where** $T \leq 4$ **and is based on UE
implementation,**
the UE transmits only the channels/signals of the radio access technology with
the highest priority
\- as determined by the SCI formats scheduling the transmissions, or
\- as indicated by higher layers in case of a S-SS/PSBCH block or a sidelink
synchronization signal using E-UTRA radio access, or
\- as determined in clause 16.2.4.2 in case of PSFCH transmissions.
If a UE
\- **would respectively transmit or receive a first channel/signal using**
E-UTRA radio access **and receive a second channel/signal or transmit second
channels/signals using NR radio access, and**
\- **a transmission or reception of the first channel/signal would
respectively overlap in time with a reception of the second channel/signal or
transmission of the second channels/signals, and**
\- **the priorities of the channels/signals are known to both E-UTRA radio
access and NR radio access at the UE** $T$ **msec prior to the start of the
earliest transmission or reception, where** $T \leq 4$ **and is based on UE
implementation,**
the UE transmits or receives the channels/signals of the radio access
technology with the highest priority
\- as determined by the SCI formats scheduling the transmissions, or
\- as indicated by higher layers in case of a S-SS/PSBCH block or a sidelink
synchronization signal using E-UTRA radio access, or
\- as determined in clause 16.2.4.2 among PSFCH transmissions/receptions.
#### 16.2.4.2 Simultaneous PSFCH transmission/reception
For a PSFCH transmission or reception with HARQ-ACK information, a priority
value for the PSFCH is equal to the priority value indicated by an SCI format
1-A associated with the PSFCH.
For PSFCH transmission with conflict information, a priority value for the
PSFCH is equal to the smallest priority value determined by the corresponding
SCI format(s) 1-A for the conflicting resource(s).
For PSFCH reception with conflict information, a priority value for the PSFCH
is equal to the priority value determined by the corresponding SCI format 1-A
for the conflicting resource.
If a UE
\- **would transmit** $N_{sch,Tx,PSFCH}$ **PSFCHs and receive**
$N_{sch,Rx,PSFCH}$ **PSFCHs, and**
\- **transmissions of the** $N_{sch,Tx,PSFCH}$ **PSFCHs would overlap in time
with receptions of the** $N_{sch,Rx,PSFCH}$ **PSFCHs**
the UE transmits or receives only a set of PSFCHs corresponding to the
smallest priority field value, as determined by a first set of SCI format 1-A
and/or a second set of SCI format 1-A [5, TS 38.212] that are respectively
associated with PSFCHs with HARQ-ACK information from the $N_{sch,Tx,PSFCH}$
PSFCHs and PSFCHs with HARQ-ACK information from the $N_{sch,Rx,PSFCH}$ PSFCHs
when one or more of the PSFCHs provide HARQ-ACK information. If none of the
$N_{sch,Tx,PSFCH}$ PSFCHs and none of the $N_{sch,Rx,PSFCH}$ PSFCHs provide
HARQ-ACK information, the UE transmits or receives only a set of PSFCHs
corresponding to the smallest priority value of the first set of PSFCHs and
the second set of PSFCHs that are respectively associated with the
$N_{sch,Tx,PSFCH}$ PSFCHs and the $N_{sch,Rx,PSFCH}$ PSFCHs when the PSFCHs
provide conflict information.
If a UE **would transmit** $N_{sch,Tx,PSFCH}$ **PSFCHs in a PSFCH transmission
occasion,** the UE first transmits PSFCHs with HARQ-ACK information from
$N_{Tx,PSFCH}$ PSFCHs corresponding to the smallest priority field values from
the $N_{Tx,PSFCH}$ priority field values, if any. Subsequently, the UE
transmits remaining PSFCHs with conflict information corresponding to the
smallest remaining priority field values from the $N_{Tx,PSFCH}$ priority
field values, if any.
If a UE indicates a capability to receive $N_{Rx,PSFCH}$ PSFCHs in a PSFCH
reception occasion [18, TS 38.306], the UE first receives PSFCHs with HARQ-ACK
information, if any, and subsequently receives PSFCHs with conflict
information, if any.
#### 16.2.4.3 Simultaneous SL and UL transmissions/receptions
If a UE
\- **would simultaneously transmit on the UL and on the SL in a carrier or in
two respective carriers, and**
\- **the UE is not capable of simultaneous transmissions on the UL and on the
SL in the carrier or in the two respective carriers**
the UE transmits only on the link, UL or SL, with the higher priority.
If a UE
\- would simultaneously transmit on the UL and receive on the SL in a carrier,
or
\- **would simultaneously transmit on the UL and receive on the SL in two
respective carriers and the UE is not capable of simultaneous transmission on
the UL and reception on the SL in the two respective carriers**
the UE transmits on UL or receives on SL, with the higher priority.
**If a UE**
\- is capable of simultaneous transmissions on the UL and on the SL in two
respective carriers,
\- **would transmit on the UL and on the SL in the two respective carriers,**
\- **the transmission on the UL would overlap with the transmission on the SL
over a time period, and**
\- **the total UE transmission power over the time period would exceed**
$P_{\text{CMAX}}$
the UE
\- reduces the power for the UL transmission prior to the start of the UL
transmission**, if the SL transmission has higher priority than the UL
transmission** as determined in clause 16.2.4.3.1**, so that the total UE
transmission power would not exceed** $P_{\text{CMAX}}$
\- reduces the power for the SL transmission prior to the start of the SL
transmission**, if the UL transmission has higher priority than the SL
transmission** as determined in clause 16.2.4.3.1**, so that the total UE
transmission power would not exceed** $P_{\text{CMAX}}$
##### 16.2.4.3.1 Prioritizations for sidelink and uplink
transmissions/receptions
A UE performs prioritization between SL transmissions/receptions and UL
transmissions after performing the procedures described in clause 9, clause
9.2.5, and clause 9.2.6, and in clause 6.1 of [6, TS 38.214].
PSFCH transmissions in a slot, as determined in clause 16.2.4.2, have a same
priority value as the smallest priority value among PSSCH receptions with
corresponding HARQ-ACK information provided by the PSFCH transmissions in the
slot, if any, and among PSFCH transmissions with conflict information in the
slot, if any, where each priority value is equal to the smallest priority
value determined by corresponding SCI formats 1-A as described in clause 16.3.
PSFCH receptions in a slot, as determined in clause 16.2.4.2, have a same
priority value as the smallest priority value among PSSCH transmissions with
corresponding HARQ-ACK information provided by the PSFCH receptions in the
slot, if any, and among PSFCH receptions with conflict information in the
slot, if any, where each priority value is equal to the priority value
determined by corresponding SCI format 1-A as described in clause 16.3.
A priority of S-SS/PSBCH block transmission or reception is provided by _sl-
SSB-PriorityNR._
For prioritization between SL transmission or PSFCH/S-SS/PSBCH block reception
and UL transmission other than a PRACH, or a PUSCH scheduled by an UL grant in
a RAR and its retransmission, or a PUSCH corresponding to Type-2 random access
procedure and its retransmission, or a PUCCH with sidelink HARQ-ACK
information report
\- if the UL transmission is for a PUSCH or for a PUCCH with priority index 1,
\- if _sl-PriorityThreshold-UL-URLLC_ is provided
\- the SL transmission or reception has higher priority than the UL
transmission if the priority value of the SL transmission or reception is
smaller than _sl-PriorityThreshold-UL-URLLC;_ otherwise, the UL transmission
has higher priority than the SL transmission or reception
\- else
\- the UL transmission has higher priority than the SL transmission or
reception
\- else
\- the SL transmission or reception has higher priority than the UL
transmission if the priority value of the SL transmission(s) or reception is
smaller than _sl-PriorityThreshold;_ otherwise, the UL transmission has higher
priority than the SL transmission or reception
A PRACH transmission, or a PUSCH scheduled by an UL grant in a RAR and its
retransmission, or a PUSCH for Type-2 random access procedure and its
retransmission, or a PUCCH with HARQ-ACK information in response to
successRAR, or a PUCCH indicated by a DCI format 1_0 with CRC scrambled by a
corresponding TC-RNTI has higher priority than a SL transmission or reception.
A PUCCH transmission with a sidelink HARQ-ACK information report has higher
priority than a SL transmission if a priority value of the PUCCH is smaller
than a priority value of the SL transmission. The priority value of the PUCCH
transmission is as described in clause 16.5. If the priority value of the
PUCCH transmission is larger than the priority value of the SL transmission,
the SL transmission has higher priority.
A PUCCH transmission with a sidelink HARQ-ACK information report has higher
priority than a PSFCH/S-SS/PSBCH block reception if a priority value of the
PUCCH is smaller than a priority value of the SL reception. If the priority
value of the PUCCH transmission is larger than the priority value of the
PSFCH/S-SS/PSBCH block reception, the SL reception has higher priority.
When one or more SL transmissions from a UE overlap in time with multiple non-
overlapping UL transmissions from the UE, the UE performs the SL transmissions
if at least one SL transmission is prioritized over all UL transmissions
subject to the UE processing timeline with respect to the first SL
transmission and the first UL transmission.
When one or more UL transmissions from a UE overlap in time with multiple non-
overlapping SL transmissions, the UE performs the UL transmissions if at least
one UL transmission is prioritized over all SL transmissions subject to the UE
processing timeline with respect to the first SL transmission and the first UL
transmission.
When one SL transmission overlaps in time with one or more overlapping UL
transmissions, the UE performs the SL transmission if the SL transmission is
prioritized over all UL transmissions subject to both the UE multiplexing and
processing timelines with respect to the first SL transmission and the first
UL transmission, where the UE processing timeline with respect to the first SL
transmission and the first UL transmission is same as when one or more SL
transmissions overlap in time with multiple non-overlapping UL transmissions.
When one SL transmission overlaps in time with one or more overlapping UL
transmissions, the UE performs the UL transmission if at least one UL
transmission is prioritized over the SL transmission subject to both the UE
multiplexing and processing timelines with respect to the first SL
transmission and the first UL transmission, where the UE processing timeline
with respect to the first SL transmission and the first UL transmission is
same as when one or more SL transmissions overlap in time with multiple non-
overlapping UL transmissions.
## 16.3 UE procedure for reporting and obtaining control information in PSFCH
Control information provided by a PSFCH transmission includes HARQ-ACK
information or conflict information.
### 16.3.0 UE procedure for transmitting PSFCH with control information
A UE can be indicated by an SCI format scheduling a PSSCH reception to
transmit a PSFCH with HARQ-ACK information in response to the PSSCH reception.
The UE provides HARQ-ACK information that includes ACK or NACK, or only NACK.
A UE can be provided, by _sl-PSFCH-Period_ , a number of slots in a resource
pool for a period of PSFCH transmission occasion resources. If the number is
zero, PSFCH transmissions from the UE in the resource pool are disabled.
A UE can be enabled, by _sl-InterUE-CoordinationScheme2_ , to transmit a PSFCH
with conflict information in a resource pool. The UE can determine, based on
an indication by a SCI format 1-A, a set of resources that includes one or
more slots and resource blocks that are reserved for PSSCH transmission. If
the UE determines a conflict for a reserved resource for PSSCH transmission,
the UE provides conflict information in a PSFCH.
A UE expects that a slot ${t'}_{k}^{\text{SL}}$ $(0 \leq k  RSRP_{1} + deltaRSRPThresh$, where $\text{RSR}P_{1}$ and $\text{RSR}P_{2}$
are the RSRP measurements from the first UE for the second UE and the third
UE, respectively
\- if the first UE is an intended receiver for PSSCH in a reserved resource of
the third UE, the first UE determines a resource conflict if $\text{RSR}P_{1}
> RSRP_{2} + deltaRSRPThresh$
If a UE transmits a PSFCH with conflict information corresponding to a
reserved resource indicated in an SCI format 1-A, the UE transmits the PSFCH
in the resource pool in a slot determined based on _sl-PSFCH-Occasion_
\- If _sl-PSFCH-Occasion_ = \'_0_ \', the UE transmits the PSFCH in a first
slot that includes PSFCH resources and is at least a number of slots, provided
by _sl-MinTimeGapPSFCH_ , of the resource pool after a slot of a PSCCH
reception that provides the SCI format 1-A. The PSFCH resource is in a slot
that is at least $T_{3}$ slots [6, TS 38.214] before the resource associated
with the conflict information; otherwise, the UE does not transmit the PSFCH
with conflict information.
\- If _sl-PSFCH-Occasion_ = \'_1_ \', the UE transmits the PSFCH in a latest
slot that includes PSFCH resources and is at least $T_{3}$ slots of the
resource pool before a slot of the resource associated with conflict
information. The PSFCH resource is in a slot that is at least _sl-
MinTimeGapPSFCH_ slots after a slot of a PSCCH reception that provides the SCI
format 1-A; otherwise, the UE does not transmit the PSFCH with conflict
information.
### 16.3.1 UE procedure for receiving PSFCH with control information
A UE that transmitted a PSSCH scheduled by a SCI format 2-A/2-B/2-C that
indicates HARQ feedback enabled, attempts to receive associated PSFCHs with
HARQ-ACK information according to PSFCH resources determined as described in
clause 16.3.0. The UE determines an ACK or a NACK value for HARQ-ACK
information provided in each PSFCH resource as described in [8-4, TS
38.101-4]. The UE does not determine both an ACK value and a NACK value at a
same time for a PSFCH resource.
For each PSFCH reception occasion, from a number of PSFCH reception occasions,
the UE generates HARQ-ACK information to report to higher layers. For
generating the HARQ-ACK information, the UE can be indicated by a SCI format
to perform one of the following
**\- if** the UE receives a PSFCH associated with a SCI format 2-A with Cast
type indicator field value of \"10\" or a SCI format 2-C
\- report to higher layers HARQ-ACK information with same value as a value of
HARQ-ACK information that the UE determines from the PSFCH reception
**\- if** the UE receives a PSFCH associated with a SCI format 2-A with Cast
type indicator field value of \"01\"
\- report an ACK value to higher layers if the UE determines an ACK value from
at least one PSFCH reception occasion from the number of PSFCH reception
occasions in PSFCH resources corresponding to every identity $M_{\text{ID}}$
of UEs that the UE expects to receive corresponding PSSCHs as described in
clause 16.3; otherwise, report a NACK **value to higher layers**
**\- if** the PSFCH reception occasion is associated with a SCI format 2-B or
a SCI format 2-A with Cast type indicator field value of \"11\"
\- report to higher layers an ACK value if the UE determines absence of PSFCH
reception for the PSFCH reception occasion; otherwise, report a NACK value to
higher layers
A UE that transmitted SCI format 1-A, indicating one or more reserved
resources in a resource pool enabled by _sl-InterUE-CoordinationScheme2_ ,
attempts to receive associated PSFCH with conflict information in the resource
pool with PSFCH resources that the UE determines as described in clause
16.3.0. If the UE determines presence of a resource conflict based on conflict
information in a PSFCH reception, the UE reports the resource conflict to
higher layers
**\- if** _sl-SlotLevelResourceExclusion_ is not provided, the UE reports
resources overlapping with a next in time reserved resource indicated by the
SCI format 1-A
**\- if** _sl-SlotLevelResourceExclusion_ is provided, the UE reports
resources in a slot of a next in time reserved resource indicated by the SCI
format 1-A
If a UE receives a PSFCH with conflict information corresponding to a reserved
resource indicated in an SCI format 1-A, the UE receives the PSFCH in the
resource pool in a slot determined based on _sl-PSFCH-Occasion_
\- If _sl-PSFCH-Occasion_ = \'_0_ \', the UE receives the PSFCH in a first
slot that includes PSFCH resources and is at least a number of slots, provided
by _sl-MinTimeGapPSFCH_ , of the resource pool after a slot of a PSCCH
transmission that provides the SCI format 1-A. The PSFCH resource is in a slot
that is at least $T_{3}$ slots [6, TS 38.214] before the resource associated
with the conflict information; otherwise, the UE does not receive the PSFCH
with conflict information
\- If _sl-PSFCH-Occasion_ = \'_1_ \', the UE receives the PSFCH in a latest
slot that includes PSFCH resources and is at least $T_{3}$ slots of the
resource pool before a slot of the resource associated with conflict
information. The PSFCH resource is in a slot that is at least _sl-
MinTimeGapPSFCH_ slots after a slot of a PSCCH transmission that provides the
SCI format 1-A; otherwise, the UE does not receive the PSFCH with conflict
information
## 16.4 UE procedure for transmitting PSCCH
A UE can be provided a number of symbols in a resource pool, by _sl-
TimeResourcePSCCH_ , starting from a second symbol that is available for SL
transmissions in a slot, and a number of PRBs in the resource pool, by _sl-
FreqResourcePSCCH_ , starting from the lowest PRB of the lowest sub-channel of
the associated PSSCH, for a PSCCH transmission with a SCI format 1-A.
A UE that transmits a PSCCH with SCI format 1-A using sidelink resource
allocation mode 2 [6, TS 38.214] sets
\- \"Resource reservation period\" as an index in _sl-
ResourceReservePeriodList_ corresponding to a reservation period provided by
higher layers [11, TS 38.321], if the UE is provided _sl-MultiReserveResource_
\- the values of the frequency resource assignment field and the time resource
assignment field as described in [6, TS 38.214] to indicate $N$ resources from
a set $\left{ R_{\text{y}} \right}$ of resources selected by higher layers as
described in [11, TS 38.321] with $N$ smallest slot indices $y_{i}$ for $0
\leq i \leq N - 1$ such that $y_{0}  if slot $n_{U}$ starts at a same time as or after a slot for an active UL
> BWP change on the serving cell of PUCCH transmission and slot $\left\lfloor
> \left( n_{U} - K_{1,k} \right) \cdot 2^{\mu_{\text{SL}} - \mu_{\text{UL}}}
> \right\rfloor + n_{S}$ is before the slot for the active UL BWP change on
> the serving cell of PUCCH transmission
$n_{S} = n_{S} + 1$;
else
> if slot $\left\lfloor \left( n_{U} - K_{1,k} \right) \cdot
> 2^{\mu_{\text{SL}} - \mu_{\text{UL}}} \right\rfloor + n_{S}$ belongs to the
> sidelink resource pool and includes PSFCH resources as indicated by a
> sidelink resource pool bitmap and _sl-PSFCH-Period_ , where $K_{1,k}$ is the
> _k_ -th slot timing value in set $K_{1}$
Set $n_{F} = 0$ -- index of a SL slot within an PSFCH period
while $n_{F}  $M_{A} = M_{A} \cup j$;
>
> $j = j + 1$;
>
> $n_{F} = n_{F} + 1$;
end while
end if
$n_{S} = n_{S} + 1$;
end if
end while
end if
$k = k + 1$;
end while
The cardinality of the set $M_{A}$ defines a total number $M$ of occasions for
candidate PSSCH transmissions with corresponding PSFCH reception occasions
corresponding to the HARQ-ACK information bits. A UE determines
${\widetilde{o}}_{0}^{\text{ACK}},{\widetilde{o}}_{1}^{\text{ACK}},\ldots,{\widetilde{o}}_{O_{\text{ACK}}
- 1}^{\text{ACK}}$ HARQ-ACK information bits, for a total number of
$O_{\text{ACK}}$ HARQ-ACK information bits as
${\widetilde{o}}_{j}^{\text{ACK}}$ = HARQ-ACK information bit for candidate
PSSCH transmission with index $j$ with corresponding PSFCH reception, for $0\
\leq j  then in any of the set $M_{A}$ of occasions for candidate PSSCH
> transmissions with corresponding PSFCH reception occasions, as described in
> clause 16.5.1.1 _,_ the UE does not multiplex HARQ-ACK information in the
> PUSCH transmission;
\- else the UE generates the HARQ-ACK codebook as described in clause
16.5.1.1, unless the UE generates HARQ-ACK information only for
_-_ PSFCH reception occasions associated with PSSCH transmissions
corresponding to a SL configured grant, or
_-_ PSFCH reception occasions associated with PSSCH transmissions that are
scheduled by DCI format 3_0 with a counter SAI field value of 1
> in the set $M_{A}$ of occasions for candidate PSSCH transmissions with
> corresponding PSFCH reception occasions, in which case the UE generates
> HARQ-ACK information only for the PSFCH reception occasions as described in
> clause 16.5.1.
A UE sets to NACK value in the HARQ-ACK codebook any HARQ-ACK information
corresponding to PSFCH reception occasions associated with PSSCH transmissions
scheduled by a DCI format 3_0 that the UE detects in a PDCCH monitoring
occasion that starts after a PDCCH monitoring occasion where the UE detects a
DCI format scheduling the PUSCH transmission.
If a UE multiplexes HARQ-ACK information in a PUSCH transmission that is
scheduled by a DCI format that includes a SAI field, the UE generates the
HARQ-ACK codebook as described in clause 16.5.1.1 when a value of the SAI
field in the DCI format is $V_{T - \text{SAI}}^{\text{UL}} = 1$. The UE does
not generate a HARQ-ACK codebook for multiplexing in the PUSCH transmission
when $V_{T - \text{SAI}}^{\text{UL}} = 0$ unless the UE generates HARQ-ACK
information only for
\- PSFCH reception occasions associated with PSSCH transmissions corresponding
to a SL configured grant, or
\- PSFCH reception occasions associated with PSSCH transmissions that are
scheduled by a DCI format 3_0 with a counter SAI field value of 1,
> in the set $M_{A}$ of occasions for candidate PSSCH transmissions with
> corresponding PSFCH reception occasions as described in clause 16.5.1.
$V_{T - \text{SAI}}^{\text{UL}} = 0$ if the SAI field in the DCI format is set
to \'0\'; otherwise, $V_{T - \text{SAI}}^{\text{UL}} = 1$.
### 16.5.2 Type-2 HARQ-ACK codebook determination
This clause applies if the UE is configured with _pdsch-HARQ-ACK-Codebook =
dynamic_.
#### 16.5.2.1 Type-2 HARQ-ACK codebook in physical uplink control channel
A UE determines monitoring occasions for PDCCH with DCI format 3_0 for
scheduling PSSCH transmissions with associated PSFCH reception occasions on an
active DL BWP of a serving cell $c$, as described in clause 10.1, and for
which the UE transmits HARQ-ACK information in a same PUCCH in slot $n$ based
on
\- PSFCH-to-HARQ feedback timing indicator field values, or a value provided
by _sl-PSFCH-ToPUCCH-CG-Type1,_ for PUCCH transmission with HARQ-ACK
information in slot $n$ in response to PSFCH receptions;
\- time gap field in DCI format 3_0 for scheduling PSSCH transmissions with
associated PSFCH receptions;
\- time resource assignment in DCI format 3_0 for scheduling PSSCH
transmissions with associated PSFCH receptions;
\- a configured sidelink resource pool bitmap;
\- a value of a period of PSFCH resources provided in _sl-PSFCH-Period;_
\- a value of a minimum time gap provided in _sl-MinTimeGapPSFCH._
The set of PDCCH monitoring occasions for DCI format 3_0 for scheduling PSSCH
transmissions with associated PSFCH reception occasions is defined as the
PDCCH monitoring occasions in the active DL BWP of the configured serving
cell, indexed in ascending order of start time of the associated search space
sets. The cardinality of the set of PDCCH monitoring occasions defines a total
number $M$ of PDCCH monitoring occasions. A UE is not expected to receive a
DCI format 3_0 with CRC scrambled by SL-RNTI and a DCI format 3_0 with CRC
scrambled by SL-CS-RNTI for scheduling retransmission corresponding to a SL
configured grant Type 1 or a sidelink configured grant Type 2 simultaneously
in a same monitoring occasion.
A value of a counter sidelink assignment indicator (SAI) field in DCI format
3_0, excluding DCI format 3_0 for the SL configured grant Type 2 activation,
denotes an accumulative number of PDCCH monitoring occasions where PSSCH
transmissions with associated PSFCH receptions are scheduled, up to a current
PDCCH monitoring occasion, in ascending order of PDCCH monitoring occasion
index $m$, where $0 \leq m  if PDCCH monitoring occasion $m$ is before an active UL BWP change on the
> serving cell of PUCCH transmission
$m = M$;
else
> if there is a PSFCH reception occasion associated with a PSSCH transmission
> scheduled by a DCI format in PDCCH monitoring occasion $m$
if $V_{C - \text{SAI},m}^{\text{SL}} \leq V_{\text{temp}}$
> $j = j + 1$;
end if
> $V_{\text{temp}} = V_{C - \text{SAI},m}^{\text{SL}}$
>
> ${\widetilde{o}}_{4j + V_{C - \text{SAI},m}^{\text{SL}} - 1}^{\text{ACK}}$ =
> HARQ-ACK information bit
>
> $V_{s} = V_{s} \cup \left{ 4j + V_{C - \text{SAI},m}^{\text{SL}} - 1
> \right}$
end if
end if
$m = m + 1$;
end while
> $O_{\text{ACK}} = 4 \cdot j + V_{\text{temp}}$
${\widetilde{o}}_{i}^{\text{ACK}} = \text{NACK}$ for any $i\ \in \left{
0,1,\ldots,O_{\text{ACK}} - 1 \right}\backslash V_{s}\ $
> if a SL configured grant Type 1 is configured for a UE, or a SL configured
> grant Type 2 is configured and activated for a UE, and the SL configured
> grant provides a grant for PSSCH transmissions, including the PSSCH
> transmission(s) associated with the corresponding activation DCI format 3_0,
> with PSFCH reception occasions in a slot $n - K_{1}$, where $K_{1}$ is the
> $k$ value for the SL configured grant as described in clause 16.5
$O_{\text{ACK}} = O_{\text{ACK}} + 1$;
> ${\widetilde{o}}_{O_{\text{ACK}} - 1}^{\text{ACK}}$= HARQ-ACK information
> bit associated with the PSFCH reception occasions associated with the PSSCH
> transmissions scheduled by the SL configured grant
end if
If $O_{\text{ACK}} \leq 11$, the UE determines a number of HARQ-ACK
information bits $n_{\text{HARQ} - \text{ACK}}$ for obtaining a transmission
power for a PUCCH, as described in clause 7.2.1, as
$$n_{\text{HARQ-ACK}} = \left( V_{\text{SAI},m_{\text{last}}}^{\text{SL}} -
U_{\text{SAI}} \right)\text{mod}4 + \sum_{m = 0}^{M -
1}N_{m}^{\text{received}} + N_{\text{CG}}$$
where
\- $V_{\text{S}\text{AI},m_{\text{last}}}^{\text{S}\text{L}}$ is a value of a
counter SAI field in a last DCI format 3_0, excluding the DCI format 3_0
activating a SL configured grant, scheduling PSSCH transmissions associated
with PSFCH reception occasions that the UE detects within the $M$ PDCCH
monitoring occasions
\- $V_{\text{S}\text{AI},m_{\text{last}}}^{\text{S}\text{L}} = 0$ if the UE
does not detect any DCI format 3_0, excluding the DCI format 3_0 activating a
SL configured grant, scheduling PSSCH transmissions associated with PSFCH
reception occasions in any of the $M$ PDCCH monitoring occasions
\- $U_{\text{S}\text{AI}}$ is a total number of DCI format 3_0, excluding the
DCI format 3_0 activating a SL configured grant, scheduling PSSCH
transmissions associated with PSFCH reception occasions, that the UE detects
within the $M$ PDCCH monitoring occasions. $U_{\text{S}\text{AI}} = 0$ if the
UE does not detect any DCI format 3_0, excluding the DCI format 3_0 activating
a SL configured grant, scheduling PSSCH transmissions with associated PSFCH
reception occasions in any of the $M$ PDCCH monitoring occasions
\- $N_{m}^{\text{received}}$ is a number of DCI format 3_0, excluding the DCI
format 3_0 activating a SL configured grant, scheduling PSSCH transmissions
with associated PSFCH reception occasions that the UE detects in PDCCH
monitoring occasion $m$
\- $N_{\text{CG}}$ is a number of SL configured grants for which the UE
transmits corresponding HARQ-ACK information in a same PUCCH as for HARQ-ACK
information corresponding to PSFCH reception occasions associated with _PSSCH
transmissions_ scheduled by a dynamic grant within the $M$ PDCCH monitoring
occasions
Table 16.5.2.1-1: Value of counter SAI in DCI format 3_0
* * *
SAI\ $\mathbf{V}_{\mathbf{C}\mathbf{-}\mathbf{S}\text{AI}}^{\text{SL}}$ Number
of PDCCH monitoring occasions in which DCI format 3_0 scheduling PSSCH
transmissions with corresponding PSFCH reception occasions is present, denoted
as $\mathbf{Y}$ and $\mathbf{Y \geq 1}$ MSB, LSB
* * *
0,0 1 $$\left( Y - 1 \right)\text{mod}4 + 1 = 1$$
0,1 2 $$\left( Y - 1 \right)\text{mod}4 + 1 = 2$$
1,0 3 $$\left( Y - 1 \right)\text{mod}4 + 1 = 3$$
1,1 4 $$\left( Y - 1 \right)\text{mod}4 + 1 = 4$$
* * *
#### 16.5.2.2 Type-2 HARQ-ACK codebook in physical uplink shared channel
If a UE would multiplex HARQ-ACK information in a PUSCH transmission that is
not scheduled by a DCI format or is scheduled by a DCI format without an SAI
field, then
_\- if the_ UE
_-_ has not received any PDCCH within the monitoring occasions for DCI format
3_0 for scheduling PSSCH with corresponding PSFCH reception occasions on any
serving cell, and
_-_ does not have HARQ-ACK information in response to a PSSCH transmission
with corresponding PSFCH reception occasions associated with a SL configured
grant to multiplex in the PUSCH, as described in clause 16.5.2.1 _,_
> the UE does not multiplex HARQ-ACK information in the PUSCH transmission;
\- else, the UE generates and multiplexes in the PUSCH transmission the HARQ-
ACK codebook as described in clause 16.5.2.1.
If a UE multiplexes HARQ-ACK information in a PUSCH transmission that is
scheduled by a DCI format that includes a SAI field, the UE generates the
HARQ-ACK codebook as described in clause 16.5.2.1, with the following
modifications:
\- For the pseudo-code for the HARQ-ACK codebook generation in clause
16.5.2.1, after the completion of the $m$ loop, the UE sets $V_{\text{temp}} =
V_{\text{T-}\text{SAI}}^{\text{UL}}$ where
$V_{\text{T-}\text{SAI}}^{\text{UL}}$ is the value of the SAI field in the DCI
format according to Table 16.5.2.2-1.
If a UE
\- is scheduled for a PUSCH transmission by a DCI format that includes a SAI
field with value $V_{\text{T-SAI}}^{\text{UL}} = 4$, and
\- has not received any PDCCH within the monitoring occasions for PDCCH with
DCI format 3_0 for scheduling PSSCH with corresponding PSFCH reception
occasions on a serving cell, and
\- does not have HARQ-ACK information in response to PSFCH reception occasions
associated with a SL configured grant to multiplex in the PUSCH, as described
in clause 16.5.2.1,
the UE does not multiplex HARQ-ACK information in the PUSCH transmission.
Table 16.5.2.2-1: Value of SAI
* * *
SAI\ $\mathbf{V}_{\text{T-S}\text{AI}}^{\text{UL}}$ Number of PDCCH monitoring
occasions in which DCI format 3_0 scheduling PSSCH transmissions with
corresponding PSFCH reception occasions is present, denoted as $\mathbf{X}$
and $\mathbf{X \geq 1}$ MSB, LSB
* * *
0,0 1 $$\left( X - 1 \right)\text{mod}4 + 1 = 1$$
0,1 2 $$\left( X - 1 \right)\text{mod}4 + 1 = 2$$
1,0 3 $$\left( X - 1 \right)\text{mod}4 + 1 = 3$$
1,1 4 $$\left( X - 1 \right)\text{mod}4 + 1 = 4$$
* * *
## 16.6 UE procedure for LTE sidelink transmission
If the UE detects a DCI format 3_1 with CRC scrambled by SL Semi-Persistent
Scheduling V-RNTI in slot $n$, the DCI format 3_1 activates or releases an LTE
sidelink SPS configuration that is indicated by a SL SPS configuration index
field [5, TS 38.212]. If the DCI format 3_1 activates an SL SPS configuration,
the UE procedure for transmitting a PSCCH and a PSSCH is as described in [13,
TS 36.213] except that a transmission starts no earlier than $T_{\text{DCI}} -
\frac{N_{\text{TA}}}{2} \times T_{C} \times 10^{3} + X + \left( 4 + m \right)$
ms, where $T_{\text{DCI}}$ is a start time of slot $n$, $N_{\text{TA}}$ and
$T_{C}$ are defined in [4, TS 38.211], $X$ is a value indicated by a Timing
offset field in DCI format 3_1, and $m$ is a value indicated by SL index field
in DCI format 3_1 if the SL index field is present; otherwise, $m = 0$.
## 16.7 Operation for in-device coexistence
If a UE would transmit or receive a first channel/signal using E-UTRA radio
access and a second channel/signal using NR radio access, when
\- the first channel/signal and the second channel/signal are time-division
multiplexed, and
\- the UE knows the frame indexes of the first channel/signal and the frame
indexes of the second channel/signal,
the UE transmits or receives each channel/signal so that the subframe boundary
of the second channel/signal is aligned with the subframe boundary of the
first channel/signal where the subframe boundary alignment is achieved by UE
implementation means.
# 17 UE with reduced capabilities
A UE with reduced capabilities (RedCap UE) supports all Layer-1 UE features
that are mandatory without capability signalling, unless stated otherwise.
## 17.1 RedCap UE procedures
Procedures for a RedCap UE are same as described for a UE in all other clauses
of this document unless stated otherwise. In this clause, the term \'UE\'
refers to a RedCap UE.
A UE expects the initial DL BWP and the active DL BWP after the UE
(re)establishes dedicated RRC connection to be smaller than or equal to the
maximum DL bandwidth that the UE supports. A UE can be provided a DL BWP by
_initialDownlinkBWP-RedCap_ in _DownlinkConfigCommonSIB_ , and an UL BWP by
_initialUplinkBWP-RedCap_ in _UplinkConfigCommonSIB_. If _initialUplinkBWP_ in
_UplinkConfigCommonSIB_ indicates an UL BWP that is larger than a maximum UL
BWP that a UE supports, the UE expects to be provided an UL BWP by
_initialUplinkBWP-RedCap_ in _UplinkConfigCommonSIB_ that is smaller than or
equal to the maximum UL bandwidth that the UE supports.
For unpaired spectrum operation, a RedCap UE does not expect to receive a
configuration where the center frequency for an initial DL BWP in which the UE
is configured to monitor Type1-PDCCH CSS set, or a CSS set provided by _sdt-
SearchSpace_ for random-access based PUSCH transmission as described in clause
19.2, is different than the center frequency for an initial UL BWP in which
the RedCap UE may transmit Msg1/Msg3 or MsgA.
A UE can be provided by _BWP-DownlinkDedicated_ a DL BWP, other than the
initial DL BWP. A UE can be provided by _BWP-UplinkDedicated_ an UL BWP, other
than the initial UL BWP, that is smaller than or equal to the maximum UL
bandwidth that the UE supports.
If a UE is provided an UL BWP by _initialUplinkBWP-RedCap_ in
_UplinkConfigCommonSIB_ and is provided _rach-ConfigCommon_ or _msgA-
ConfigCommon_ in _BWP-UplinkCommon_ for the UL BWP, the UE uses corresponding
parameters to perform the procedures in clauses 8.1, 8.1A, and 8.3; otherwise,
the UE uses corresponding parameters from _rach-ConfigCommon_ or _msgA-
ConfigCommon_ in _BWP-UplinkCommon_ for the UL BWP provided by
_initialUplinkBWP_.
If a UE is provided _initialUplinkBWP-RedCap_ in _UplinkConfigCommonSIB_ and
does not have dedicated PUCCH resource configuration, the UE transmits PUCCH
with HARQ-ACK information as described in clause 9.2.1 using a PUCCH resource
set provided by _pucch-ResourceCommonRedCap_ , except that frequency hopping
for the PUCCH transmission is disabled if _intra-SlotFH_ is present in _PUCCH-
ConfigCommon_. If frequency hopping of the PUCCH transmission is disabled
then, for the PUCCH transmission, the UE determines the initial cyclic shift
index in the set of initial cyclic shift indexes as
$r_{\text{PUCCH}}\text{mod}N_{\text{CS}}$ and determines the PRB index as
\- $\text{RB}_{\text{BWP}}^{\text{offset}} +
\text{RB}_{\text{BWP}}^{\text{offset}\text{-add}} + \left\lfloor
\frac{r_{\text{PUCCH}}}{N_{\text{CS}}} \right\rfloor$, if _intra-SlotFH_ =
\'_fromLowerEdge_ \'
\- ${N_{\text{BWP}}^{\text{size}} - RB}_{\text{BWP}}^{\text{offset}} -
\text{RB}_{\text{BWP}}^{\text{offset}\text{-add}} - 1 - \left\lfloor
\frac{r_{\text{PUCCH}}}{N_{\text{CS}}} \right\rfloor$_, otherwise_
where $\text{RB}_{\text{BWP}}^{\text{offset}\text{-add}}$ is provided by
_additionalPRBOffset_ , if provided; otherwise,
$\text{RB}_{\text{BWP}}^{\text{offset}\text{-add}} = 0.$
If a UE is not provided _initialUplinkBWP-RedCap_ in _UplinkConfigCommonSIB_
and does not have dedicated PUCCH resource configuration, the UE transmits
PUCCH with HARQ-ACK information as described in clause 9.2.1 using a PUCCH
resource set provided by _pucch-ResourceCommonRedCap_ if _pucch-
ResourceCommonRedCap_ is present or by _pucch-ResourceCommon_ if _pucch-
ResourceCommonRedCap_ is absent. For an initial DL BWP provided by
_initialDownlinkBWP-RedCap_ in _DownlinkConfigCommonSIB_ , if a UE in RRC_IDLE
state or in RRC_INACTIVE state monitors PDCCH according to Type1-PDCCH CSS set
and does not monitor PDCCH according to Type2-PDCCH CSS set, the UE does not
expect the initial DL BWP to include SS/PBCH blocks and the CORESET with index
0.
For an active DL BWP not provided by _BWP-DownlinkDedicated, if a UE does not
indicate a capability to operate in the active DL BWP without receiving an
SS/PBCH block,_ the UE in RRC_CONNECTED state assumes that the active DL BWP
includes the SS/PBCH blocks that the UE used to obtain SIB1 and, for SS/PBCH
block and CORESET multiplexing pattern 1, the CORESET with index 0.
For an active DL BWP provided by _BWP-DownlinkDedicated_ , unless a UE
indicates a capability to operate in the active DL BWP without receiving an
SS/PBCH block, the UE in RRC_CONNECTED state assumes that the active DL BWP
includes the SS/PBCH blocks that the UE used to obtain SIB1 or the SS/PBCH
blocks provided by _NonCellDefiningSSB_. If the active DL BWP includes the
SS/PBCH blocks that the UE used to obtain SIB1, for SS/PBCH block and CORESET
multiplexing pattern 1, the UE expects the active DL BWP to include the
CORESET with index 0.
For a RedCap UE indicating a capability to use an initial DL BWP that includes
the SS/PBCH blocks provided by _NonCellDefiningSSB_ for PUSCH transmission in
RRC_INACTIVE state, if the UE is provided _NonCellDefiningSSB_ in _ncd-SSB-
RedCapInitialBWP-SDT_ , then during procedure of PUSCH transmission in
RRC_INACTIVE state (as described in clause 19) the UE uses the SS/PBCH blocks
provided by _NonCellDefiningSSB_ for the purposes for which the UE would
otherwise have used the SS/PBCH blocks that the UE used to obtain SIB1.
If the active DL BWP provided by _BWP-DownlinkDedicated_ , or the initial DL
BWP during procedure of PUSCH transmission in RRC_INACTIVE state (as described
in clause 19), includes the SS/PBCH blocks provided by _NonCellDefiningSSB_ ,
these SS/PBCH blocks and the SS/PBCH blocks that the UE used to obtain SIB1
have the same QCL properties, if they have the same index _._
For a RedCap UE indicated presence of SS/PBCH blocks within an active DL BWP
by _NonCellDefiningSSB_ , collision handling between downlink receptions or
uplink transmissions and the SS/PBCH blocks are same as described for a UE
indicated presence of SS/PBCH blocks by _ssb-PositionsInBurst_ in _SIB1_ or in
_ServingCellConfigCommon_ described in all other clauses, unless otherwise
stated.
For monitoring of a PDCCH candidate by a UE configured with
_NonCellDefiningSSB_ , if the UE
\- does not monitor PDCCH candidates in a Type0-PDCCH CSS set, and
\- at least one RE for a PDCCH candidate overlaps with at least one RE of a
candidate SS/PBCH block corresponding to a SS/PBCH block index provided by
_NonCellDefiningSSB_ ,
the UE is not required to monitor the PDCCH candidate.
The SS/PBCH blocks in clause 8.1 for determining valid PRACH occasions in
unpaired spectrum correspond to the SS/PBCH blocks that the UE used to obtain
SIB1.
The SS/PBCH blocks in clause 8.1A for determining valid PUSCH occasions in
unpaired spectrum correspond to the SS/PBCH blocks that the UE used to obtain
SIB1.
The SS/PBCH blocks in **clause 6.1.2.1 in [6, TS 38.214] and** clause 8.3 for
determining the $N_{\text{PUSCH}}^{\text{repeat}}$ slots for a PUSCH
transmission in unpaired spectrum correspond to the SS/PBCH blocks that the UE
used to obtain SIB1.
The SS/PBCH blocks in clause 19.1 for determining valid PUSCH occasions in
unpaired spectrum correspond to the SS/PBCH blocks that the UE used to obtain
SIB1.
## 17.2 Half-Duplex UE in paired spectrum
A half-duplex UE (HD-UE) in paired spectrum is not capable of simultaneous
transmissions and receptions on a serving cell with paired spectrum. This
clause is applicable for communication of a HD-UE on a serving cell with
paired spectrum. Procedures for a HD-UE are same as described for a UE in all
other clauses of this document unless stated otherwise.
A HD-UE does not expect to detect a DCI format scheduling a reception in a set
of symbols and detect a DCI format scheduling a transmission in any symbol
from the set of symbols.
When a PDCCH reception by a UE includes two PDCCH candidates from
corresponding search space sets, as described in clause 10.1, the end of the
PDCCH reception is the end of the PDCCH candidate that ends later.
If a HD-UE is configured by higher layers to receive a PDCCH, or PDSCH, or
CSI-RS, or DL PRS in a set of symbols, the HD-UE receives the PDCCH, or PDSCH,
or CSI-RS, or DL PRS if the HD-UE does not detect a DCI format that indicates
to the HD-UE to transmit a PUSCH, or PUCCH, or PRACH, or SRS in at least one
symbol of the set of symbols; otherwise, the HD-UE does not receive the PDCCH,
or PDSCH, or CSI-RS, or DL PRS in the set of symbols.
If a HD-UE is configured by higher layers to transmit SRS, or PUCCH, or PUSCH
in a set of symbols and the UE detects a DCI format indicating to the HD-UE to
receive CSI-RS or PDSCH in a subset of symbols from the set of symbols, then
\- the HD-UE does not expect to cancel the transmission of the PUCCH or PUSCH
in the set of symbols if the first symbol in the set occurs within $T_{proc,2\
}$ relative to a last symbol of a PDCCH reception where the HD-UE detects the
DCI format; otherwise, the HD-UE cancels the PUCCH, or the PUSCH, or an actual
repetition of the PUSCH [6, TS 38.214], determined from clauses 9 and 9.2.5 or
clause 6.1 of [6, TS 38.214].
\- the HD-UE does not expect to cancel the transmission of SRS in symbols from
the subset of symbols that occur within $T_{proc,2}$ relative to a last symbol
of a PDCCH reception where the HD-UE detects the DCI format. The HD-UE cancels
the SRS transmission in remaining symbols from the subset of symbols.
$T_{proc,2}$ is the PUSCH preparation time for UE processing capability 1 [6,
TS 38.214] assuming $d_{2,1} = 1$ and $\mu$ corresponds to the smallest SCS
configuration between the SCS configuration of the PDCCH carrying the DCI
format and the SCS configuration of the SRS, PUCCH, PUSCH.
A HD-UE does not expect to receive both dedicated higher layer parameters
configuring transmission in a set of symbols and dedicated higher layer
parameters configuring reception in the set of symbols. A HD-UE does not
expect to receive both a Type-0/0A/1/2-PDCCH CSS set configuration for PDCCH
reception in a set of symbols and dedicated higher layer parameters
configuring transmission in the set of symbols.
If a HD-UE would transmit a PUSCH, or PUCCH, or SRS based on a configuration
by higher layers and the HD-UE is indicated presence of SS/PBCH blocks within
the active DL BWP by _ssb-PositionsInBurst_ in _SIB1_ or in
_ServingCellConfigCommon_ or by _NonCellDefiningSSB_ , the HD-UE does not
transmit
\- PUSCH or PUCCH if a last symbol of the PUSCH or PUCCH transmission would
not be at least $N_{\text{Tx-Rx}} \cdot T_{\text{c}}$ [4, TS 38.211] prior to
a first symbol of the next earliest SS/PBCH block
\- PUSCH or PUCCH if a first symbol of the PUSCH or PUCCH transmission would
not be at least $N_{\text{R}\text{x-}\text{T}\text{x}} \cdot T_{\text{c}}$ [4,
TS 38.211] after a last symbol of the previous latest SS/PBCH block
\- SRS in symbols that would not be at least $N_{\text{Tx-Rx}} \cdot
T_{\text{c}}$ prior to a first symbol of the next earliest SS/PBCH block
\- SRS in symbols that would not be at least
$N_{\text{R}\text{x-}\text{T}\text{x}} \cdot T_{\text{c}}$ after a last symbol
of the previous latest SS/PBCH block
If a HD-UE would transmit a PRACH based on a detected DCI format, or PUSCH, or
PUCCH, or SRS and the HD-UE is indicated presence of SS/PBCH blocks within the
active DL BWP by _ssb-PositionsInBurst_ in _SIB1_ or in
_ServingCellConfigCommon_ or by _NonCellDefiningSSB in a set of symbols_ , the
HD-UE does not transmit PUSCH or PUCCH or PRACH if a transmission would
overlap with any symbol from the set of symbols and the HD-UE does not
transmit SRS in the set of symbols.
If a HD-UE would transmit a PRACH or MsgA PUSCH triggered by higher layers in
a set of symbols and would receive a PDCCH, or a PDSCH, or a CSI-RS, or a DL
PRS, or is indicated presence of SS/PBCH blocks within the active DL BWP by
_ssb-PositionsInBurst_ in _SIB1_ or in _ServingCellConfigCommon_ or by
_NonCellDefiningSSB_ in symbols that include any symbol from the set of
symbols, the HD-UE can select based on its implementation whether to either
transmit the PRACH or the MsgA PUSCH or receive the PDSCH, or the CSI-RS, or
the PL RS, or the PDCCH, or the SS/PBCH blocks.
If a HD-UE would receive a PDCCH, or a PDSCH, or a CSI-RS, or a DL PRS based
on a configuration by higher layers or is indicated presence of SS/PBCH blocks
within the active DL BWP by _ssb-PositionsInBurst_ in _SIB1_ or in
_ServingCellConfigCommon_ or by _NonCellDefiningSSB in a set of symbols_ , and
the HD-UE would transmit PRACH or MsgA PUSCH triggered by higher layers
starting or ending at a symbol that is earlier or later than
$N_{\text{R}\text{x-}\text{T}\text{x}} \cdot T_{\text{c}}$ or
$N_{\text{T}\text{x-}\text{R}\text{x}} \cdot T_{\text{c}}$, respectively, from
the last or first symbol in the set of symbols, the HD-UE can select based on
its implementation whether to either transmit the PRACH or the MsgA PUSCH or
receive the PDSCH, or the CSI-RS, or the DL PRS, or the PDCCH, or the SS/PBCH
blocks.
# 18 Multicast Broadcast Services
This clause is applicable only for PDCCH receptions, PDSCH receptions, and
PUCCH transmissions for MBS on a serving cell. DCI formats with CRC scrambled
by G-RNTI for multicast or G-CS-RNTI scheduling PDSCH receptions are referred
to as multicast DCI formats and the PDSCH receptions are referred to as
multicast PDSCH receptions. DCI formats with CRC scrambled by MCCH-RNTI or
G-RNTI for broadcast scheduling PDSCH receptions are referred to as broadcast
DCI formats and the PDSCH receptions are referred to as broadcast PDSCH
receptions. HARQ-ACK information associated with multicast DCI formats or
multicast PDSCH receptions is referred to as multicast HARQ-ACK information.
A UE can be provided one or more G-RNTIs for multicast per serving cell for
scrambling the CRC of multicast DCI formats for scheduling PDSCH receptions.
The UE can be provided one or more G-CS-RNTI per serving cell for scrambling
the CRC of multicast DCI formats providing activation/release/scheduling
retransmission for SPS PDSCH receptions.
A UE can be configured by _cfr-ConfigMCCH-MTCH_ an MBS frequency resource for
PDCCH and PDSCH receptions providing MCCH and broadcast MTCH [12, TS 38.331];
otherwise, the MBS frequency resource is same as for the CORESET with index 0
that is associated with the Type0-PDCCH CSS set for PDCCH and PDSCH receptions
providing MCCH and broadcast MTCH. A UE monitors PDCCH for scheduling PDSCH
receptions for MCCH or broadcast MTCH as described in clause 10.1.
In clauses referring to a higher layer parameter value provided by _PDCCH-
ConfigCommon_ or _PDSCH-ConfigCommon_ , when applicable a corresponding higher
layer parameter value for MCCH/broadcast MTCH PDCCH receptions or PDSCH
receptions, respectively, is provided as described in [12, TS 38.331].
A UE can be configured, per DL BWP by _cfr-ConfigMulticast_ , an MBS frequency
resource within the DL BWP for PDCCH and PDSCH receptions [4, TS 38.211]. If
_cfr-ConfigMulticast_ does not include _locationAndBandwidthMulticast_ , the
MBS frequency resource is the DL BWP. In clauses referring to a higher layer
parameter value provided by _PDCCH-Config_ or _PDSCH-Config_ or _SPS-Config_
for a DL BWP, when applicable a corresponding higher layer parameter value for
multicast PDCCH, PDSCH, or SPS PDSCH receptions is provided as described in
[12, TS 38.331].
In clauses referring to a higher layer parameter value provided by a first or
second _PUCCH-Config_ , when applicable a corresponding higher layer parameter
value for PUCCH transmissions associated with multicast PDCCH or PDSCH
receptions is provided as described in [12, TS 38.331]. In clauses referring
to a higher layer parameter value provided by _n1-PUCCH-AN_ or _SPS-PUCCH-AN-
List_ , when applicable a corresponding higher layer parameter value for PUCCH
transmissions associated with multicast SPS PDSCH receptions is provided as
described in [12, TS 38.331]. In clauses referring to a higher layer parameter
value provided by _pdsch-HARQ-ACK-Codebook_ or _pdsch-HARQ-ACK-CodebookList_ ,
when applicable a corresponding higher layer parameter value for HARQ-ACK
codebooks associated with multicast HARQ-ACK information is provided as
described in [12, TS 38.331].
A UE monitors PDCCH for scheduling PDSCH receptions or for activation/release
of SPS PDSCH receptions for a corresponding SPS PDSCH configuration as
described in clause 10.1.
A UE can be configured by _harq-FeedbackOptionMulticast,_ for a G-RNTI for
multicast or for a G-CS-RNTI, to provide HARQ-ACK information for a transport
block reception associated with the G-RNTI for multicast or with the G-CS-
RNTI, according to the first HARQ-ACK reporting mode or according to the
second HARQ-ACK reporting mode. The UE determines a priority for a PUCCH
transmission with multicast HARQ-ACK information according to any HARQ-ACK
reporting mode as described in clause 9 for a PUCCH transmission with unicast
HARQ-ACK information.
For the first HARQ-ACK reporting mode, the UE generates HARQ-ACK information
with ACK value when a UE correctly decodes a transport block; otherwise, the
UE generates HARQ-ACK information with NACK value, as described in clauses 9
and 9.1 through 9.3. The UE determines a PUCCH or a PUSCH to provide the HARQ-
ACK information as described in clause 9.2.
For the second HARQ-ACK reporting mode, the UE does not transmit a PUCCH that
would include only HARQ-ACK information with ACK values. The second HARQ-ACK
reporting mode is not applicable for the first SPS PDSCH reception after
activation of SPS PDSCH receptions for a SPS configuration.
For the second HARQ-ACK reporting mode, when a number of HARQ-ACK information
bits is one, a UE transmits a PUCCH only when the HARQ-ACK information bit has
NACK value. The UE determines a PUCCH to provide the HARQ-ACK information as
described in clause 9.2.1 when UE is not provided _moreThanOneNackOnlyMode, or
as the first PUCCH in Table 18-1_ when UE is provided
_moreThanOneNackOnlyMode._ For a PUCCH resource associated with PUCCH format
0, the UE transmits the PUCCH as described in [4, TS 38.211] by obtaining
$m_{0}$ as described for HARQ-ACK information in clause 9.2.3 and by setting
$m_{\text{cs}} = 0$. For a PUCCH resource associated with PUCCH format 1, the
UE transmits the PUCCH as described in [4, TS 38.211] by setting $b\left( 0
\right) = 0$.
A UE that is indicated the second HARQ-ACK reporting mode, and for the case
when the UE reports more than one HARQ-ACK information bits, the UE can be
indicated to provide the HARQ-ACK information bits in a PUCCH either according
to the first HARQ-ACK reporting mode when the UE is not provided
_moreThanOneNackOnlyMode_ or, for only one G-RNTI or only one G-CS-RNTI,
according to the second HARQ-ACK reporting mode by selecting a PUCCH resource
from a set of PUCCH resources for the PUCCH transmission based on the values
of the HARQ-ACK information bits as described in Table 18-1 when the UE is
provided _moreThanOneNackOnlyMode_. The UE generates HARQ-ACK information bits
for the second HARQ-ACK reporting mode according to a Type-2 HARQ-ACK codebook
as described in clause 9.1.3.1. For a PUCCH resource associated with PUCCH
format 0, the UE transmits the PUCCH as described in [4, TS 38.211] by
obtaining $m_{0}$ as described for HARQ-ACK information in clause 9.2.3 and by
setting $m_{\text{cs}} = 0$. For a PUCCH resource associated with PUCCH format
1, the UE transmits the PUCCH as described in [4, TS 38.211] by setting
$b\left( 0 \right) = 0$.
For a UE that is indicated the second HARQ-ACK reporting mode, the UE does not
expect to be provided _pdsch-HARQ-ACK-Codebook = semi-static_ for multicast
HARQ-ACK information.
For a UE that is indicated the second HARQ-ACK reporting mode and
_moreThanOneNackOnlyMode_ , all PUCCH resources associated with the second
HARQ-ACK reporting mode have same starting symbol and same number of symbols
and, when PUCCH resources in Table 18-1 are located in more than one PRBs, the
more than one PRBs are adjacent and are associated with a same MPR value [8-1,
TS 38.101-1].
Table 18-1: Mapping of values of HARQ-ACK information bits to PUCCH resources
for the second HARQ-ACK reporting mode
* * *
Value of HARQ-ACK information bits PUCCH resource  
{0} {0,0} {0,0,0} {0,0,0,0} 1^st^ PUCCH resource from _resourceList/n1PUCCH-
AN/sps-PUCCH-AN-ListMulticast_ {1,0} {1,0,0} {1,0,0,0} 2^nd^ PUCCH resource
from _resourceList/sps-PUCCH-AN-ListMulticast_ {0,1} {0,1,0} {0,1,0,0} 3^rd^
PUCCH resource from _resourceList/sps-PUCCH-AN-ListMulticast_ {1,1,0}
{1,1,0,0} 4^th^ PUCCH resource from _resourceList_ {0,0,1} {0,0,1,0} 5^th^
PUCCH resource from _resourceList_ {1,0,1} {1,0,1,0} 6^th^ PUCCH resource from
_resourceList_ {0,1,1} {0,1,1,0} 7^th^ PUCCH resource from _resourceList_
{1,1,1,0} 8^th^ PUCCH resource from _resourceList_ {0,0,0,1} 9^th^ PUCCH
resource from _resourceList_ {1,0,0,1} 10^th^ PUCCH resource from
_resourceList_ {0,1,0,1} 11^th^ PUCCH resource from _resourceList_ {1,1,0,1}
12^th^ PUCCH resource from _resourceList_ {0,0,1,1} 13^th^ PUCCH resource from
_resourceList_ {1,0,1,1} 14^th^ PUCCH resource from _resourceList_ {0,1,1,1}
15^th^ PUCCH resource from _resourceList_
* * *
If a UE is provided _pucch-ConfigurationListMulticast1_ or _pucch-
ConfigurationListMulticast2_ for PUCCH transmissions with a priority value,
the UE transmits a PUCCH with the priority value according to _pucch-
ConfigurationListMulticast1_ or _pucch-ConfigurationListMulticast2_ for each
G-RNTI for multicast or G-CS-RNTI that the UE provides associated HARQ-ACK
information according to the first HARQ-ACK reporting mode or the second HARQ-
ACK reporting mode, respectively. For HARQ-ACK information associated only
with the second HARQ-ACK reporting mode, when the UE is not provided
_moreThanOneNackOnlyMode_ and the UE provides the HARQ-ACK information
according to the first HARQ-ACK reporting mode, the UE determines a PUCCH
resource from _pucch-ConfigMulticast1/pucch-ConfigurationListMulticast1_ , if
provided; otherwise, the UE determines a PUCCH resource from _pucch-
Config/pucch-ConfigurationList_.
A PDSCH reception providing an initial transmission of a transport block is
scheduled only by a multicast DCI format. For the first HARQ-ACK reporting
mode, a PDSCH reception providing a retransmission of the transport block can
be scheduled either by a multicast DCI format using a same G-RNTI for
multicast as the G-RNTI for multicast of the initial transmission of the
transport block, or by a unicast DCI format using a C-RNTI [6, TS 38.214].
An activation for SPS PDSCH receptions using a G-CS-RNTI for a corresponding
SPS PDSCH configuration is provided only by a multicast DCI format as
described in clause 10.2 by replacing CS-RNTI with the G-CS-RNTI. A release
for SPS PDSCH receptions using a G-CS-RNTI for a corresponding SPS PDSCH
configuration is provided by a multicast DCI format as described in clause
10.2 by replacing CS-RNTI with the G-CS-RNTI, or by a DCI format with CRC
scrambled by CS-RNTI. For the first HARQ-ACK reporting mode and for a
transport block that a UE received in a SPS PDSCH, a PDSCH reception providing
a retransmission of the transport block can be scheduled either by a unicast
DCI format using a CS-RNTI or by a multicast DCI format using a same G-CS-RNTI
as the G-CS-RNTI of the initial transmission of the transport block [6, TS
38.214].
For a DCI format indicating SPS PDSCH release, the UE provides the associated
HARQ-ACK information as described in clause 9.1.
A UE can be configured per G-RNTI for multicast or per G-CS-RNTI, by _harq-
FeedbackEnablerMulticast_ with value set to \'enabled\', to provide HARQ-ACK
information for PDSCH receptions. When the UE is not provided _harq-
FeedbackEnablerMulticast_ for a G-RNTI for multicast or G-CS-RNTI and _pdsch-
HARQ-ACK-Codebook = dynamic_ for multicast HARQ-ACK information, the UE does
not provide HARQ-ACK information for respective PDSCH receptions. If a UE is
provided _harq-FeedbackEnablerMulticast_ with value set to \'dci-enabler\' for
a G-RNTI for multicast or a G-CS-RNTI, the UE provides HARQ-ACK information
for PDSCH receptions scheduled by multicast DCI format 4_1 associated with the
G-RNTI or the G-CS-RNTI, and determines whether or not to provide the HARQ-ACK
information for PDSCH receptions scheduled or activated by multicast DCI
format 4_2 based on an indication by the multicast DCI format 4_2 associated
with the G-RNTI for multicast or the G-CS-RNTI [4, TS 38.212]. If a UE is
provided _pdsch-HARQ-ACK-Codebook = semi-static_ for multicast HARQ-ACK
information, the UE does not expect to be provided _harq-
FeedbackEnablerMulticast_ with value set to \'dci-enabler\' for a G-RNTI or a
G-CS-RNTI.
If a UE would multiplex second multicast HARQ-ACK information according to the
second HARQ-ACK reporting mode with first multicast HARQ-ACK information
according to the first HARQ-ACK reporting mode, or unicast HARQ-ACK
information, or CSI reports in a first PUCCH or in a PUSCH, as described in
clauses 9 and 9.2.5, the UE provides the second HARQ-ACK information according
to the first HARQ-ACK reporting mode. For resolving an overlapping among a
second PUCCH with HARQ-ACK information according to the second HARQ-ACK
reporting mode and other PUCCHs or PUSCHs prior to multiplexing the HARQ-ACK
information in a PUCCH or PUSCH, the UE considers that the UE would transmit
the second PUCCH when all values of the HARQ-ACK information are \'ACK\'. For
resolving an overlapping among a second PUCCH with HARQ-ACK information
according to the second HARQ-ACK reporting mode and other PUCCHs or PUSCHs
prior to multiplexing the HARQ-ACK information in a PUCCH or PUSCH when the UE
is provided _moreThanOneNackOnlyMode_ , the UE considers that the UE would
transmit the second PUCCH using any PUCCH resource from the PUCCH resources
associated with the second HARQ-ACK reporting mode when all values of the
HARQ-ACK information are \'ACK\'. If a UE would only transmit a first PUCCH
with only positive SR and a second PUCCH with HARQ-ACK information according
to the second HARQ-ACK reporting mode, where the first and second PUCCHs would
overlap in time in a slot and have same priority index, it is up to UE
implementation for the UE to transmit either the first PUCCH or the second
PUCCH.
If a UE is provided multiple G-RNTIs for multicast or G-CS-RNTIs, a
configuration for a HARQ-ACK codebook type applies to all G-RNTIs for
multicast or G-CS-RNTIs.
If a UE is provided _pdsch-HARQ-ACK-Codebook = semi-static_ for multicast
HARQ-ACK information, the UE generates a Type-1 HARQ-ACK codebook as described
in clauses 9.1.2, 9.1.2.1, and 9.1.2.2.
If a UE is provided _pdsch-HARQ-ACK-Codebook = dynamic_ for multicast HARQ-ACK
information, the UE generates a Type-2 HARQ-ACK codebook as described in
clauses 9.1.3.1 and 9.1.3.2.
If a UE would report unicast HARQ-ACK information and multicast HARQ-ACK
information with same priority index in a slot, the UE multiplexes the unicast
HARQ-ACK information and the multicast HARQ-ACK information following the
procedures in this clause and in clauses 9.1.2, 9.1.3, and 9.1.4.
If, for unicast and multicast HARQ-ACK information of same priority value, a
UE
\- is provided
\- either _pdsch-HARQ-ACK-Codebook_ = _dynamic_ or _pdsch-HARQ-ACK-
Codebook-r16 for unicast HARQ-ACK information_ and _pdsch-HARQ-ACK-Codebook_ =
_semi-static_ for multicast HARQ-ACK information _,_
\- _or_ _pdsch-HARQ-ACK-Codebook_ = _semi-static_ _for unicast HARQ-ACK
information_ and _pdsch-HARQ-ACK-Codebook_ = _dynamic_ for multicast HARQ-ACK
information _, and_
\- would multiplex the unicast and multicast HARQ-ACK information in a same
PUCCH or PUSCH
the UE
\- appends the HARQ-ACK codebooks for the multicast HARQ-ACK information to
the HARQ-ACK codebooks for the unicast HARQ-ACK information
\- if $O_{\text{ACK}} + O_{\text{SR}} + O_{\text{CSI}} \leq 11$, the UE
determines $n_{HARQ - ACK}$ for obtaining a power of a PUCCH transmission with
the HARQ-ACK information, as described in clause 7.2.1, as a sum of the
$n_{HARQ - ACK}$ value from clause 9.1.2.1 or clause 9.1.3.3 and the $n_{HARQ
- ACK}$ value from clause 9.1.3.1.
A UE determines a PUCCH resource for a PUCCH transmission with HARQ-ACK
information as described in clauses 9.2 and 9.2.1 through 9.2.5.
If a UE multiplexes in a PUCCH HARQ-ACK information of same priority
associated with unicast DCI formats and with multicast DCI formats in a same
PUCCH, the last DCI format that the UE uses to determine the PUCCH resource
from _pucch-Config/pucch-ConfigurationList_ , as described in clause 9.2.3, is
a last unicast DCI format.
If the UE multiplexes in a PUCCH only multicast HARQ-ACK information of same
priority that is according to both the first and second HARQ-ACK reporting
modes, the last DCI format that the UE uses to determine the PUCCH resource
from _pucch-ConfigMulticast1/pucch-ConfigurationListMulticast1_ , if provided;
otherwise, from _pucch-Config/pucch-ConfigurationList_ , as described in
clause 9.2.3, is a last DCI format associated with multicast HARQ-ACK
information that is according to the first HARQ-ACK reporting mode.
If a UE multiplexes in a PUCCH only first HARQ-ACK information associated with
multicast SPS PDSCH receptions and second HARQ-ACK information associated with
multicast DCI formats and having same priority value as the first HARQ-ACK
information, and both the first and second HARQ-ACK information are according
to the first HARQ-ACK reporting mode, the UE determines the PUCCH resource
based on the last multicast DCI format, as described in clause 9.2.3.
If a UE multiplexes in a PUCCH only first HARQ-ACK information associated with
multicast SPS PDSCH receptions and second HARQ-ACK information associated with
multicast DCI formats and having same priority value as the first HARQ-ACK
information, and the first and second HARQ-ACK information are indicated by
_harq-FeedbackOptionMulticast_ different HARQ-ACK reporting modes, the UE
determines the PUCCH resource based on:
_\- sps-PUCCH-AN-ListMulticast, or sps-PUCCH-AN-List if sps-PUCCH-AN-
ListMulticast is not provided, if the first HARQ-ACK information is according
to the_ first HARQ-ACK reporting mode or
\- the last multicast DCI format, as described in clause 9.2.3, if the second
_HARQ-ACK information is according to the_ first HARQ-ACK reporting mode.
If a UE multiplexes in a PUCCH first HARQ-ACK information associated with
unicast SPS PDSCH receptions and second HARQ-ACK information associated with
multicast DCI formats and having same priority value as the first HARQ-ACK
information in a same PUCCH, the UE determines the PUCCH resource from
\- if provided, _SPS-PUCCH-AN-List_ for unicast SPS PDSCH receptions as
described in clause 9.2.1;
\- else, if provided, _PUCCH-Config/PUCCH-ConfigurationList_ for multicast
PDSCH receptions;
\- else, _PUCCH-Config/PUCCH-ConfigurationList_ for unicast PDSCH receptions.
If a UE multiplexes in a PUCCH first HARQ-ACK information associated with
unicast SPS PDSCH receptions and second HARQ-ACK information associated with
multicast SPS PDSCH receptions and having same priority value as the first
HARQ-ACK information in a same PUCCH, the UE determines the PUCCH resource
from _SPS-PUCCH-AN-List_ for unicast SPS PDSCH receptions as described in
clause 9.2.1.
If a UE multiplexes in a PUCCH only HARQ-ACK information associated with
multicast SPS PDSCHs receptions of same priority that is according to the
first HARQ-ACK reporting mode and is not provided _sps-PUCCH-AN-ListMulticast_
, the UE determines the PUCCH resource from the _sps-PUCCH-AN-List_ provided
for unicast SPS PDSCH reception as described in clause 9.2.1 _._
If a UE multiplexes in a PUCCH multicast HARQ-ACK information only according
to second HARQ-ACK reporting modes and CSI reports and, if any, SR, the UE
determines a PUCCH resource as described in clause 9.2.5.2 for multiplexing
CSI reports with HARQ-ACK information that is in response to PDSCH receptions
without corresponding PDCCHs.
A UE is not required to multiplex in a PUCCH multicast HARQ-ACK information of
a priority and unicast UCI of the priority if the UE is provided
_subslotLengthForPUCCH_ for PUCCH transmissions with unicast UCI of the
priority.
# 19 PUSCH transmission in RRC_INACTIVE state
## 19.1 Configured-grant based PUSCH transmission
_A UE indicated to release a dedicated RRC connection_ can be provided one or
more configurations by respective one or more _ConfiguredGrantConfig_ , for
configured grant Type 1 PUSCH transmissions on the initial UL BWP [12, TS
38.331]. For the remaining of this clause, PUSCH transmissions refer to
configured grant Type-1 PUSCH transmissions for a configuration provided by
_ConfiguredGrantConfig_.
A UE can be provided by _sdt-SSB-Subset_ a number of SS/PBCH block indexes
$N_{\text{PUSCH}}^{SS/PBCH}$ to map to a number of valid PUSCH occasions for
PUSCH transmissions over an association period. If the UE is not provided
_sdt-SSB-Subset_ , the UE determines $N_{\text{PUSCH}}^{SS/PBCH}$ from the
value of _ssb-PositionsInBurst_ in _SIB1._ A PUSCH occasion for a PUSCH
transmission is defined by a time resource and a frequency resource and is
associated with a DM-RS provided by _cg-DMRS-Configuration_ for the
configuration of PUSCH transmissions. _A UE can be provided a number of
repetitions for a PUSCH transmission by repK or numberOfRepetitions. If the
number of repetitions is provided and larger than 1, all the PUSCH occasions
of the repetitions for the PUSCH transmission are mapped to the same_ SS/PBCH
block index(es)_. All the PUSCH occasions of the repetitions are not valid if
any PUSCH occasion of the repetitions is not valid._
An association period, starting from frame with SFN 0, for mapping
$N_{\text{PUSCH}}^{SS/PBCH}$ SS/PBCH block indexes, from the number of SS/PBCH
block indexes, to valid PUSCH occasions and associated DM-RS resources is the
smallest value in the set determined by the PUSCH configuration period
provided by _periodicity_ in _ConfiguredGrantConfig_ according to Table 19.1-1
such that $N_{\text{PUSCH}}^{SS/PBCH}$ SS/PBCH block indexes are mapped at
least once to valid PUSCH occasions and associated DM-RS resources within the
association period. A UE is provided a number of SS/PBCH block indexes
associated with a PUSCH occasion and a DM-RS resource by _sdt-SSB-PerCG-
PUSCH_. If after an integer number of SS/PBCH block indexes to PUSCH occasions
and associated DMRS resources mapping cycles within the association period
there is a set of PUSCH occasions and associated DMRS resources that are not
mapped to $N_{\text{PUSCH}}^{SS/PBCH}$ SS/PBCH block indexes, no SS/PBCH block
indexes are mapped to the set of PUSCH occasions and associated DMRS
resources. An association pattern period includes one or more association
periods and is determined so that a pattern between PUSCH occasions with
associated DMRS resources and SS/PBCH block indexes repeats at most every 640
msec. PUSCH occasions and associated DMRS resources not associated with
SS/PBCH block indexes after an integer number of association periods, if any,
are not used for PUSCH transmissions.
Table 19.1-1: Mapping between PUSCH configuration period and SS/PBCH block to
configured PUSCH resource association period
PUSCH configuration period $\mathbf{T}_{\mathbf{\text{cg}}}$ (msec)
Association period (number of PUSCH configuration periods)
* * *
5 {1, 2, 4, 8,16, 32, 64, 128} 8 {1, 2, 4, 5, 8, 10, 16, 20, 40, 80} 10 {1, 2,
4, 8,16, 32, 64} 16 {1, 2, 4, 5, 8,10,20,40} 20 {1, 2, 4, 8,16, 32} 32 {1, 2,
4, 5, 10, 20} 40 {1, 2, 4, 8, 16} 64 {1, 2, 5, 10} 80 {1, 2, 4, 8} 128 {1, 5}
160 {1, 2, 4} 320 {1, 2} 640 {1}
$N_{\text{PUSCH}}^{SS/PBCH}$ SS/PBCH block indexes are mapped to valid PUSCH
occasions and associated DMRS resources in the following order
> \- first, in increasing order of DMRS resource indexes within a PUSCH
> occasion, where a DMRS resource index $\text{DMR}S_{\text{id}}$ **_is_**
> determined first in an ascending order of a DMRS port index and second in an
> ascending order of a DMRS sequence index [4, TS 38.211]
>
> \- second, in increasing order of PUSCH configuration period indexes
A PUSCH occasion is valid if it does not overlap with a valid PRACH occasion
as described in clause 8.1.
For unpaired spectrum and for SS/PBCH blocks with indexes provided by _ssb-
PositionsInBurst_ in _SIB1_
\- if a UE is not provided _tdd-UL-DL-ConfigurationCommon_ , a PUSCH occasion
is valid if the PUSCH occasion
\- does not precede a SS/PBCH block in the PUSCH slot, and
\- starts at least $N_{\text{gap}}$ symbols after a last SS/PBCH block symbol,
where $N_{\text{gap}}$ is provided in Table 8.1-2
\- if a UE is provided _tdd-UL-DL-ConfigurationCommon_ , a PUSCH occasion is
valid if the PUSCH occasion
\- is within UL symbols
\- starts at least $N_{\text{gap}}$ symbols after a last downlink symbol, and
at least $N_{\text{gap}}$ symbols after a last SS/PBCH block symbol, where
$N_{\text{gap}}$ is provided in Table 8.1-2
A UE determines a power of a PUSCH transmission as described in clause 7.1.1,
where the UE obtains $\text{PL}_{b,f,c}(q_{d})$ _using a RS resource from an
SS/PBCH block_ with index associated with the PUSCH transmission.
_A UE can be provided a USS set by_ _SearchSpace_ , or a CSS set by _sdt-
SearchSpace_ , _to monitor PDCCH for detection of DCI format 0_0 with CRC
scrambled by C-RNTI or CS-RNTI for scheduling PUSCH transmission or of DCI
format 1_0 with CRC scrambled by C-RNTI for scheduling PDSCH receptions [12,
TS 38.331]._ The UE may assume that the DM-RS antenna port associated with the
PDCCH receptions, the DM-RS antenna port associated with the PDSCH receptions,
and the SS/PBCH block associated with the PUSCH transmission are quasi co-
located with respect to average gain and quasi co-location \'typeA\' or
\'typeD\' properties. The UE transmits a PUCCH with HARQ-ACK information
associated with the PDSCH receptions as described in clause 9.2.1 using a same
spatial domain transmission filter as for the last PUSCH transmission.
For initial transmission or autonomous retransmission of an initial transport
block provided for the PUSCH transmission as described in clause 18.0 in [19,
TS 38.300], the UE encodes the transport block using redundancy version number
0 if the UE is not provided _repK-RV_.
## 19.2 Random-access based PUSCH transmission
_A UE indicated to release a dedicated RRC connection_ can be provided a
configuration for a Type-1 and/or a Type-2 random access procedure on the
initial UL BWP [12, TS 38.331]. PRACH occasions can have either a common
configuration as, or a separate configuration from, PRACH occasions for Type-1
or Type-2 random access procedure as described in clause 8.1. _The_ UE
procedure is as described in clause 8, including clauses 8.1 through 8.4. _The
UE transmits a PRACH preamble with a power determined as described in clause
7.4._
_For a common configuration of PRACH occasions and a Type-1 or a Type-2 random
access procedure, a UE can be provided_ a number of contention based preambles
per SS/PBCH block index per valid PRACH occasion by
_startPreambleForThisPartition_ and _numberOfPreamblesPerSSB-ForThisPartition_
when _smallData_ is present in corresponding _FeatureCombination_. A PRACH
transmission can be on a subset of PRACH occasions associated with a same
SS/PBCH block index within an SSB-RO mapping cycle as determined by a PRACH
mask index provided by _ssb-SharedRO-MaskIndex_ according to [11, TS 38.321].
_A UE can be provided by_ _sdt-SearchSpace_ _a CSS set to monitor, after
contention resolution as described in clause 8.4, PDCCH for detection of a DCI
format 0_0 or DCI format 1_0 with CRC scrambled by C-RNTI for scheduling
respective PUSCH transmissions or PDSCH receptions; otherwise, if the UE is
not provided sdt-SearchSpace, the UE monitors PDCCH according to a Type1-PDCCH
CSS set as described in clause 10.1._ The UE may assume that the DM-RS antenna
port associated with the PDCCH receptions, the DM-RS antenna port associated
with the PDSCH receptions, and the SS/PBCH block associated with the PRACH
transmission are quasi co-located with respect to average gain and quasi co-
location \'typeA\' or \'typeD\' properties.
#
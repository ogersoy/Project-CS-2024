# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
This Technical Report investigates following aspects for UEs that can
establish a MA PDU Session to 5GC over both 3GPP and non-3GPP accesses:
\- Whether and how to support additional steering mode(s), with potential PMF
extensions if needed.
\- Whether and how to support additional steering functionality(ies). Proposed
solutions shall be based on IETF protocols or extension of such protocols
(i.e. QUIC/MP-QUIC).
\- Whether and how to support multi-access PDU session with one 3GPP access
leg over EPC and the other access leg over non-3GPP access 5GS.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] IEEE Std 802.11-2012: \"IEEE Standard for Information technology -
Telecommunications and information exchange between systems - Local and
metropolitan area networks - Specific requirements - Part 11: Wireless LAN
Medium Access Control (MAC) and Physical Layer (PHY) Specifications\".
[3] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[4] 3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".
[5] 3GPP TS 23.503: \"Policy and Charging Control Framework for the 5G System;
Stage 2\".
[6] draft-ietf-quic-transport: \"QUIC: A UDP-Based Multiplexed and Secure
Transport\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[7] draft-ietf-quic-recovery: \"QUIC Loss Detection and Congestion Control\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[8] draft-ietf-quic-datagram: \"An Unreliable Datagram Extension to QUIC\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[9] draft-piraux-quic-tunnel: \"Tunneling Internet protocols inside QUIC\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[10] draft-deconinck-quic-multipath: \"Multipath Extensions for QUIC (MP-
QUIC)\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[11] IETF RFC 1928: \"SOCKS Protocol Version 5\".
[12] 3GPP TS 23.316: \"Wireless and wireline convergence access support for
the 5G System (5GS); Stage 2\".
[13] 3GPP TR 23.793: \"Study on access traffic steering, switch and splitting
support in the 5G System (5GS) architecture\".
[14] 3GPP TS 33.210: \"3G security; Network Domain Security (NDS); IP network
layer security\".
[15] IETF RFC 3393: \"IP Packet Delay Variation Metric for IP Performance
Metrics (IPPM)\".
[16] IETF RFC 3550: \" RTP: A Transport Protocol for Real-Time Applications\".
[17] IETF RFC 5481: \" Packet Delay Variation Applicability Statement\".
[18] draft-ietf-quic-tls: \"Using Transport Layer Security (TLS) to Secure
QUIC\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[19] draft-ietf-masque-connect-udp: \"The CONNECT-UDP HTTP Method\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[20] draft-westerlund-masque-transport-issues-00: \"Transport Considerations
for IP and UDP Proxying in MASQUE\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[21] 3GPP TS 29.512: \"5G System; Session Management Policy Control Service;
Stage 3\".
[22] 3GPP TS 29.244: \"Interface between the Control Plane and the User Plane
nodes\".
[23] 3GPP TS 24.193: \"5G System; Access Traffic Steering, Switching and
Splitting (ATSSS); Stage 3\".
[24] 3GPP TS 29.214: \"Policy and charging control over Rx reference point\".
[25] draft-ietf-quic-invariants: \"Version-Independent Properties of QUIC\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[26] draft-pauly-masque-quic-proxy: \"QUIC-Aware Proxying Using CONNECT-UDP\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
[27] draft-ietf-masque-ip-proxy-reqs: \"Requirements for a MASQUE Protocol to
Proxy IP Traffic\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC.
# 3 Definitions of terms, symbols and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in TR 21.905 [1] and
the following apply. A term defined in the present document takes precedence
over the definition of the same term, if any, in TR 21.905 [1].
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
\ \
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
# 4 Architectural Assumptions and Requirements
Editor\'s note: This clause will list general architectural assumptions and
principles for this study.
For all objectives, the architectural requirements and assumption include:
\- NG RAN, W-5GAN and any 5G AN shall not be impacted.
\- The study is restricted to ATSSS support for traffic routed over one 3GPP
access and one non-3GPP access.
\- The study uses 5GS Rel-16 ATSSS as a starting point: MA PDU Session shall
be reused.
\- Any additional steering functionality shall be based on IETF protocols or
extensions of such protocols (i.e. QUIC/MP-QUIC [10]), any differences from
the existing IETF drafts shall be clearly specified and minimized.
\- the Rel-17 ATSSS work applies also to 5G-RG.
For the support of additional steering mode(s) or of additional steering
functionality(ies), the architectural requirements and assumptions include
also:
\- Any additional steering functionalities in the User Plane should reside in
UE and UPF as shown in Figure -1 below.
Figure 4-1: Architecture assumption for ATSSS_Ph2 support
## 4.1 Architecture Assumptions
In this release, for a GBR QoS Flow of MA PDU Session, it is assumed that the
SMF provides a QoS profile to a single access network at a given time.
## 4.2 Architectural Requirements
# 5 Key Issues
Editor\'s note: This clause will describe the key issues for the enhancement
of Network Slicing.
## 5.1 Key issue #1: Additional Steering Modes
### 5.1.1 Description
This key issue aims to study whether and how to support additional steering
mode(s).
The key issue will study:
\- identify gaps with steering modes supported in Rel-16;
\- identify whether and how new steering mode(s) can improve the network
service delivered to UE and 5G RG, and determine if additional steering
mode(s) can be defined for ATSSS_Ph2:
\- whether and how to negotiate the support of additional steering mode(s)
between the UE and the network and potentially between NF (e.g. between SMF
and UPF);
\- whether and how to enhance PCC rules, ATSSS rules and N4 rules to support
these additional steering mode(s);
\- whether and how to enhance PMF to support these additional steering
mode(s), and what the impact to the UE and the network would be.
## 5.2 Key issue #2: Additional Steering Functionalities
### 5.2.1 Description
This key issue aims to study whether and how to support additional steering
functionality(ies).
Traffic splitting for Ethernet and UDP based traffic is not fully supported in
Rel-16: for example, traffic within an UDP/IP flow may not be split across
multiple accesses without introducing out of order packet delivery.
NOTE: IETF is actively defining QUIC [6] with the target to have the core
protocol sent to IESG in July 2020 and planning for a Multipath extension
document sent to IESG by end of 2021.
The key issue will study:
\- whether additional steering functionality(ies) can be defined for
ATSSS_Ph2, and if defined study:
\- use cases of traffic splitting for Ethernet and UDP;
\- the impact on user plane performance of additional steering
functionality(ies);
\- how to negotiate the support of additional steering functionality(ies)
between the UE and the network and potentially between NF(s) (e.g. between SMF
and UPF);
\- how it(they) co-exist with MPTCP and ATSSS-LL from Rel-16;
\- whether and how to enhance PCC rules, ATSSS rules and N4 rules to support
these additional steering functionality(ies);
\- what type of traffic these new steering functionality(ies) address, e.g.
\- PDU Session type,
\- Ethernet / UDP,
\- whether and how to support latency sensitive and real time traffic,
\- etc.
\- UE impacts in order to support additional steering functionality(ies).
If steering functionality(ies) defined require(s) new protocol(s) between the
UE and the 5GC, the work will (as per study item scope) focus only on the
usage of QUIC [6] protocol and its extensions from IETF, considering the
following:
\- security aspects, e.g. related with QUIC [6] currently mandating usage of
TLS 3.0 for key exchange, authentication, and negotiation of security and
performance parameters, will be studied in conjunction with SA WG3;
\- work on this key issue may trigger additional liaison exchanges with IETF.
## 5.3 Key Issue #3: Supporting MA PDU with 3GPP access leg over EPC and
Non-3GPP access leg over 5GC
### 5.3.1 Description
This feature is already supported for 5G RG (as defined in TS 23.316 [12]
clause 4.12.3) and the Key Issue is to extend the support to UEs in general.
This Key Issue addresses how to support a MA PDU session with its 3GPP access
leg over EPC and its non-3GPP access leg over 5GC, including the following
aspects:
1\. How to establish a MA PDU session with its 3GPP access leg over EPC and
its non-3GPP access leg over 5GC?
2\. How to replace the 3GPP access leg of a MA PDU session (i.e. both access
legs over 5GC) with a 3GPP access leg over EPC, or vice-versa?
3\. Whether and how to enhance NAS signalling including ATSSS rules, PCC
rules, and/or N4 rules to support traffic steering over both EPC and 5GC?
4\. Identify gaps (if any) of the existing Rel-16 ATSSS interworking support
for 5G-RG to support UEs in general. Additional solutions are not precluded
but re-use of the Rel-16 solution is preferred assuming it meets the
requirements.
NOTE 1: MA PDU session with its non-3GPP access leg over EPC is not in the
scope of FS_ATSSS_Ph2.
Impacts to Rel-16.MME and SGW shall be minimized.
NOTE 2: Whether any new steering functionality and steering modes defined as
part of the Rel-17 ATSSS work can be applied also when the MA PDU Session has
user-plane resources in 3GPP access in EPC and non-3GPP access in 5GC is FFS
and needs further evaluation when the study evaluation/conclusion is taking
place. This evaluation should apply to any solution to Key Issue #3.
# 6 Solutions
## 6.0 Mapping Solutions to Key Issues
Table 6.0-1: Mapping of Solutions to Key Issues
Solutions Title Key Issue(s)
* * *
#1 QUIC-LL Steering Functionality 1 & 2 #2 New steering mode -- Autonomous
steering mode 1 #3 New steering mode -- Autonomous steering mode with advanced
PMF 1 #4 New steering mode -- Redundant steering mode 1 #5 Replacing 3GPP
access leg of MA-PDU Session with PDN connection in EPC 3 #6 MPQUIC-LL
Steering Functionality 1 & 2 #7 Proposed solution based on MP-QUIC 2 #8
Proposed solution based on QUIC 2 #9 Supporting a PDN connection in EPC as a
3GPP access leg of MA-PDU Session 3 #10 Extension of 5G RG solution to support
Ethernet PDU Session types 3 #11 New steering mode -- RTT difference based
steering mode 1 #12 New steering mode -- UE assisted traffic steering mode 1
#13 Proxy based solution using QUIC 2 #14 Proxy based solution using MP-QUIC 2
#15 Enhancements to steering mode operation 1
## 6.1 Solution #1: QUIC-LL Steering Functionality
### 6.1.1 Introduction {#introduction-1}
This clause defines a new ATSSS steering functionality called QUIC-Low Layer
(QUIC-LL). It is a \"Low Layer\" steering functionality because it operates
below the IP layer (such as ATSSS-LL), in contrast to a high layer steering
functionality that operates above the IP layer (such as MPTCP).
The QUIC-LL provides an unreliable tunnelling service between the UE and the
UPF that is based on:
1\. The QUIC protocol (version 1) specified in draft-ietf-quic-transport [6]
along with accompanying documents that describe QUIC\'s loss detection and
congestion control (draft-ietf-quic-recovery [7]) and the use of TLS for key
negotiation (draft-ietf-quic-tls [18]); and
2\. The QUIC extensions specified in draft-ietf-quic-datagram [8] for
supporting unreliable datagram transport.
The Figure 6.1.1-1 shows the model of an MA PDU Session that operates using
the QUIC-LL steering functionality.
Figure 6.1.1-1: Model of MA PDU Session using QUIC-LL
The QUIC-LL is composed of the following components:
\- **QUIC Tunnel Client (QTC)** : The QUIC tunnel client operates in the UE as
a QUIC client application and provides the following functionality:
\- It establishes _N_ QUIC connections over 3GPP access and _N_ QUIC
connections over non-3GPP access with the QUIC tunnel server in the UPF. The
number _N_ of QUIC connections, as well as the destination IP address & port
for each QUIC connection, is determined from information contained in the PDU
Session Establishment Accept message (see the \"QUIC Connection Setup
Information\" below). Each QUIC connection is established immediately after
the setup of the MA PDU Session.
NOTE: As explained below, each QUIC connection carries the traffic of one QoS
flow only and for each QoS flow there is one QUIC connection per access. This
is required because the QUIC protocol can multiplex several PDUs in a single
QUIC packet. By using a separate QUIC connection for each QoS flow, we ensure
that PDUs belonging to different QoS flows cannot be multiplexed in the same
QUIC packet.
\- It receives UL PDUs from the upper layer (e.g. Ethernet frames or IP
packets) and, for each UL PDU, it selects a QUIC connection to transmit the
PDU over the access type indicated by the Access Selection component. The QUIC
connection is selected based on the ATSSS rules which contain QUIC connection
selection information (see further details below).
\- It retrieves the measurements obtained by the QUIC protocol per QUIC
connection (e.g. RTT, loss rate, congestion) and forwards the measurements to
the Access Selection component.
\- **QUIC Tunnel Server (QTS)** : The QUIC tunnel server operates in the UPF
as a QUIC server application and provides the following functionality:
\- It accepts the QUIC connections requested by QUIC tunnel client (QTC) in
the UE.
\- It receives DL PDUs from the Access Selection component and, for each DL
PDU, it selects a QUIC connection to transmit the PDU over the access type
indicated by the Access Selection component. The QUIC connection is selected
based on the MAR rules which contain QUIC connection selection information
(see further details below).
\- It retrieves the measurements obtained by the QUIC protocol per QUIC
connection (e.g. RTT, loss rate, congestion) and forwards the measurements to
the Access Selection component.
\- It instructs the QUIC protocol to send PING frames over a QUIC connection
on 3GPP access and/or non-3GPP access to detect whether the UE is reachable
via this access. The PING frames can be sent over one QUIC connection only per
access or over multiple QUIC connections (i.e. multiple QoS flows) per access.
\- **QUIC protocol** : The QUIC protocol component is the standard QUIC
protocol as defined by IETF.
To support ATSSS using the QUIC-LL steering functionality, the architecture
reference model for ATSSS, as specified in TS 23.501 [3] clause 4.2.10, is
enhanced as shown in Figure 6.1.1-2. The QUIC-LL steering functionality is
implemented in the UE and in the PSA UPF. The PMF functionality is not needed
for an MA PDU Session that applies QUIC-LL. However, the PMF may be needed for
an MA PDU Session that does not apply QUIC-LL.
Figure 6.1.1-2: Reference Architecture for ATSSS using QUIC-LL
The QUIC-LL steering functionality tunnels PDUs (e.g. IP packets or Ethernet
frames) over a QUIC transport. The protocol stack in the UE and UPF is shown
in Figure 6.1.1-3. The different IP addresses shown in this figure are
explained in the next clause.
Figure 6.1.1-3: Protocol stack for QUIC-LL
In summary, the QUIC-LL:
a. Supports an unreliable and secure tunnelling service between the UE and
UPF.
b. Does not support retransmission of lost QUIC datagram frames but supports
loss detection, according to draft-ietf-quic-datagram [6].
c. Supports congestion control per QUIC connection, i.e. it employs the QUIC
connection\'s congestion controller. As a result, the UE and the UPF may stop
sending datagram frames on a QUIC connection when congestion is detected by
the QUIC protocol on this connection.
d. Supports round-trip and packet loss measurements per QUIC connection, as
specified in draft-ietf-quic-transport [6]. Since each QUIC connection is
transmitted on a specific QoS flow (see details below), this means that QUIC-
LL supports round-trip measurements per QoS flow and packet loss measurements
per QoS flow.
### 6.1.2 MA PDU Session Establishment procedure
Figure 6.1.2-1: MA PDU Session establishment using QUIC-LL
The above Figure 6.1.2-1 shows how an MA PDU Session is established when (a)
the UE indicates support for QUIC-LL and (b) the network accepts to apply
QUIC-LL for one or more traffic flows. All steps are the same as the steps
used to establish an MA PDU Session in Rel-16 specifications. The additions to
support QUIC-LL are discussed below.
1a. In the PDU Session Establishment Request the UE indicates (in the 5GSM
capability) that it supports the QUIC-LL steering functionality and, possibly,
other steering functionalities such as MPTCP and ATSSS-LL.
1b. The AMF selects an SMF supporting ATSSS. It is assumed that, if the
network supports QUIC-LL, then all SMFs supporting ATSSS can also support
QUIC-LL.
5a. In the SM Policy Control Create Request, the SMF includes the ATSSS
Capabilities of the UE (see TS 23.502 [4] and TS 29.512 [21]), which contain
the QUIC-LL capability and, possibly, other capabilities already defined, such
as \"MPTCP functionality with any steering mode and ATSSS-LL functionality
with any steering mode\", etc.
5b. The PCF decides to allow the requested MA PDU Session and creates PCC
rules containing MA PDU Session Control information (see TS 29.512 [21]),
which specifies a steering functionality (e.g. QUIC-LL, ATSSS-LL), a steering
mode (e.g. Active/Standby), etc.
6a. Based on the received PCC rules, the SMF creates N4 rules for the UPF
including MAR rules for QUIC-LL. An example MAR rule may indicate: Steering
functionality = QUIC-LL, Steering mode = Smallest loss rate, QUIC Connection
Selection = QUIC Connection #1.
6b. In the N4 Session Establishment Request, the SMF includes the N4 rules and
indicates to UPF that QUIC-LL Control Information should be provided (see next
step). The QUIC-LL Control Information indicates to UPF how many QUIC
connections are needed per access, which is determined from the received PCC
rules. For example, if the SMF received two PCC rules containing steering
functionality = QUIC-LL, then the SMF indicates to UPF that two QUIC
connections are needed per access (i.e. two QUIC connections over 3GPP access
and another two QUIC connections over non-3GPP access).
6c. Based on the requested QUIC-LL Control Information, the UPF provides the
following QUIC-LL parameters:
1) Two \"UE link-specific QUIC-LL\" IP addresses used only by the QUIC-LL
functionality in the UE, one associated with the 3GPP access and another
associated with the non-3GPP access. It is possible that the UPF provides \"UE
link-specific QUIC-LL\" IP addresses that are not routable via N6 (e.g. IPv6
link-local addresses). For example, the \"UE link-specific QUIC-LL\" IP
addresses may be the following:
\- UE link-specific QUIC-LL IP address over 3GPP access = 10.10.1.1
\- UE link-specific QUIC-LL IP address over non-3GPP access = 10.10.2.1
NOTE 1: The \"UE link-specific QUIC-LL\" IP addresses are similar to the \"UE
link-specific multipath\" IP addresses used for MPTCP, specified in TS 23.502
[4] and TS 29.244 [22].
NOTE 2: If QUIC-LL and MPTCP are enabled for the same MA PDU Session, the \"UE
link-specific QUIC-LL\" IP addresses and the \"UE link-specific multipath\" IP
addresses can be the same.
2) \"QUIC Address Information\" which contains (1) two \"UPF link-specific
QUIC-LL\" IP addresses for the UPF, one for each access type and (2) one UPF
port number per QUIC connection.
7\. Based on the received PCC rules and the QUIC-LL parameters received from
UPF, the SMF creates the following information, which will be sent to the UE:
\- ATSSS rules containing QUIC connection selection information (see details
below),
\- QoS rules (see details below), and
\- \"QUIC Connection Setup Information\" which contains information for the UE
to setup the QUIC connections with the UPF. For example, it indicates that
QUIC Connection #1 over 3GPP access should be established toward the UPF IP
address 10.10.1.2 and UPF port 53671.
8a. In the PDU Session Establishment Accept, the ATSSS Container (defined in
TS 24.193 [23]) contains:
1) The ATSSS rules, which are applied by QTC in the UE to route the traffic of
the MA PDU Session across the QUIC connections; and
2) The \"network steering functionalities information\" (see TS 24.193 [23]),
which contains:
a. The two \"UE link-specific QUIC-LL\" IP addresses provided by UPF in step
6c; and
b. The \"QUIC Connection Setup information\" created by SMF in step 7.
11\. Based on the received \"QUIC Connection Setup information\" the QTC in
the UE establishes one or more QUIC connections with the QTS in the UPF over
each access. The UE establishes a QUIC connection immediately after receiving
the PDU Session Establishment Accept message. The application protocol
negotiated during each QUIC connection will be decided by stage-3 (for
example, it could be \"quic-ll\"). Note that each QUIC connection requires the
negotiation of an application protocol and it applies the Application Layer
Protocol Negotiation (ALPN) to select the application protocol (see draft-
ietf-quic-tls [18].
The QUIC connections established between the QTC in UE and the QTS in UPF
include also QUIC connections associated with downlink-only QoS flows.
Therefore, when the UPF wants to send DL traffic using a downlink-only QoS
flow, this traffic is sent to UE via the associated QUIC connection. When
reflective QoS is applied (i.e. the UE receives a DL packet marked with RQI
via a downlink-only QUIC connection), the UE creates a derived QoS rule based
on the outer header information in the received DL packet and creates also a
derived ATSSS rule that forwards the corresponding UL packets to this QUIC
connection.
Editor\'s note: Further details on how reflective QoS operates are FFS.
### 6.1.3 MA PDU Session Modification procedure
The MA PDU Session Modification procedure (either network-requested or UE-
requested) may be used to add or remove QoS flows from an established MA PDU
Session, as already specified in Rel-16.
After the MA PDU Session Modification procedure is completed, then:
\- If a QoS flow is deleted and this QoS flow was used to transfer QUIC-LL
traffic, then the two QUIC connections associated with this QoS flow (one QUIC
connection per access) are released. The UE receives updated \"QUIC Connection
Setup Information\" in order to determine which QUIC connections to release.
\- If a QoS flow is created and this QoS flow will be used to transfer QUIC-LL
traffic, then two QUIC connections associated with this QoS flow (one QUIC
connection per access) are established between the UE and UPF. The UE receives
updated \"QUIC Connection Setup Information\" in order to determine the UPF IP
addresses and ports for the new QUIC connections.
### 6.1.4 Example of QUIC-LL Operation
To better explain the QUIC-LL operation, we consider an example in this
clause. In this example, it is assumed that the PCF creates two PCC rules
which contain steering functionality = QUIC-LL (see Table 6.1.4-1 below) and
the UPF provides the following QUIC-LL parameters:
1) \"UE Link-specific QUIC-LL\" IP addresses:
UE Link-specific QUIC-LL IP address over 3GPP access = 10.10.1.1.
UE Link-specific QUIC-LL IP address over non-3GPP access = 10.10.2.1.
2) QUIC-LL Address Information:
UPF Link-specific QUIC-LL IP address for 3GPP access = 10.10.1.2.
UPF Link-specific QUIC-LL IP address for non-3GPP access = 10.10.2.2.
UPF Port for QUIC Connection #1 = 53671.
UPF Port for QUIC Connection #2 = 53672.
Based on the above QUIC-LL Address Information, the SMF creates the following
\"QUIC Connection Setup information\", which is sent to UE. Each line
indicates the UPF address and port used for a QUIC connection.
QUIC Connection #1 over 3GPP access: 10.10.1.2 / 53671.
QUIC Connection #1 over non-3GPP access: 10.10.2.2 / 53671.
QUIC Connection #2 over 3GPP access: 10.10.1.2 / 53672.
QUIC Connection #2 over non-3GPP access: 10.10.2.2 / 53672.
Figure 6.1.4-1
Based on the two PCC rules and the QUIC-LL parameters, the SMF creates the
corresponding ATSSS rules and the QoS rules shown in the table below. The
Comments column explains the meaning of these rules.
Table 6.1.4-1
+---+---------------+---------------+---------------+---------------+ | | PCC Rules | ATSSS Rules | QoS Rules | Comments | | | | | | | | | (created by | (created by | (created by | | | | PCF) | SMF) | SMF) | | +===+===============+===============+===============+===============+ | 1 | Precedence = | Precedence = | Precedence = | The ATSSS | | | 1 | 1 | 1 | rule | | | | | | specifies | | | Service Data | Traffic | Rule | that the | | | Flow | Descriptor: | Operation | traffic of | | | Template: | | Code = Create | \"app1. | | | | App Identity | new QoS rule | example.com\" | | | App Identity | = | | should be | | | = | app | Packet Filter | sent on the | | | app | 1.example.com | List 1: | QUIC | | | 1.example.com | | | Connection | | | | Access | Direction = | #1 over 3GPP | | | Direction= | Selection | Bidirectional | access when | | | Bidirectional | Descriptor: | | the loss rate | | | | | Dst. | of this | | | Policy | Steering | IP=10.10.1.2, | connection is | | | control: | functionality | Dst. | smaller than | | | | = QUIC-LL | port=53671 | the loss rate | | | 5QI=3, ARP=1 | | | of the QUIC | | | | Steering mode | or Dst. | connection | | | MA PDU | = smallest | IP=10.10.2.2, | #1 over | | | Session | loss rate | Dst. | non-3GPP | | | Control: | | port=53671 | access; | | | | QUIC | | otherwise, it | | | Steering | Connection | QFI=3 | should be | | | functionality | Selection | | sent to the | | | = QUIC-LL | Descriptor: | | QUIC | | | Steering mode | | | connection | | | = smallest | QUIC | | #1 over | | | loss rate | Connection | | non-3GPP | | | | #1 | | access. | | | | | | | | | | | | The QoS rule | | | | | | specifies | | | | | | that the | | | | | | traffic of | | | | | | QUIC | | | | | | connection | | | | | | #1 over 3GPP | | | | | | access and | | | | | | the traffic | | | | | | of QUIC | | | | | | connection | | | | | | #1 over | | | | | | non-3GPP | | | | | | access is | | | | | | mapped to the | | | | | | QoS flow with | | | | | | QFI=3. | | | | | | Essentially, | | | | | | this means | | | | | | that QUIC | | | | | | connection | | | | | | #1 (over any | | | | | | access) is | | | | | | mapped to QoS | | | | | | flow with | | | | | | QFI=3. | +---+---------------+---------------+---------------+---------------+ | 2 | Precedence = | Precedence = | Precedence = | The ATSSS | | | 2 | 2 | 2 | rule | | | | | | specifies | | | Service Data | Traffic | Rule | that the | | | Flow | Descriptor: | Operation | default | | | Template: | | Code = Create | traffic | | | | Match-all | new QoS rule | (match-all) | | | Match-all | | | should be | | | | Access | Packet Filter | sent on the | | | Direction= | Selection | List 1: | QUIC | | | Bidirectional | Descriptor: | | Connection | | | | | Direction = | #2 over 3GPP | | | Policy | Steering | Bidirectional | access when | | | control: | functionality | | the delay of | | | | = QUIC-LL | Dst. | this | | | 5QI=5, ARP=3 | | IP=10.10.1.2, | connection is | | | | Steering mode | Dst. | smaller than | | | MA PDU | = smallest | port=53672 | the delay of | | | Session | delay | | the QUIC | | | Control: | | or Dst. | connection | | | | QUIC | IP=10.10.2.2, | #2 over | | | Steering | Connection | Dst. | non-3GPP | | | functionality | Selection | port=53672 | access; | | | = QUIC-LL | Descriptor: | | otherwise, it | | | Steering mode | | QFI=5 | should be | | | = smallest | QUIC | | sent to the | | | delay | Connection | | QUIC | | | | #2 | | connection | | | | | | #2 over | | | | | | non-3GPP | | | | | | access. | | | | | | | | | | | | The QoS rule | | | | | | specifies | | | | | | that the | | | | | | traffic of | | | | | | QUIC | | | | | | connection | | | | | | #2 over 3GPP | | | | | | access and | | | | | | the traffic | | | | | | of QUIC | | | | | | connection | | | | | | #2 over | | | | | | non-3GPP | | | | | | access is | | | | | | mapped to the | | | | | | QoS flow with | | | | | | QFI=5. | | | | | | Essentially, | | | | | | this means | | | | | | that QUIC | | | | | | connection | | | | | | #2 (over any | | | | | | access) is | | | | | | mapped to QoS | | | | | | flow with | | | | | | QFI=5. | +---+---------------+---------------+---------------+---------------+
As can be seen from the table above, the QoS rules map the traffic of a QUIC
connection to a specific QoS flow. Therefore, all traffic sent on the same
QUIC connection is also sent on the same QoS flow. This is necessary because
the QUIC protocol can multiplex many PDUs in one QUIC packet, hence, all these
PDUs must be sent on the QoS flow which the QUIC packet is forwarded to.
Editor\'s note: It is FFS if the QoS rules can map SDFs to QoS flows, instead
of mapping the traffic of QUIC connections to QoS flows, as stated above. This
is further considered in clause 6.1.4a.
After the four QUIC connections are established between the UE and the UPF,
the QUIC-LL routes the PDUs received from the upper layers to one of these
QUIC connections, as illustrated in Figure 6.1.4-2 below.
The Access Selection component in the UE receives PDUs (e.g. IP packets or
Ethernet frames) from the upper layers and, for each PDU, it finds a matching
ATSSS rule. Based on the steering mode in the matching ATSSS rule and the
received measurements (RTT, loss rate, etc.) from the QUIC protocol, the
Access Selection component selects an access type for each PDU and forwards
the PDU with the selected access type to the QTC component.
The QTC component selects a QUIC connection for each PDU based on the selected
access type and the QUIC Connection Selection Descriptor in the matching ATSSS
rule. For example, if the selected access type is 3GPP and the QUIC Connection
Selection Descriptor is \"QUIC Connection #1\", then QTC sends the PDU to the
QUIC connection #1 over 3GPP access. Subsequently, the PDU is encapsulated in
a QUIC DATAGRAM frame (possibly with more PDUs) and is added to a QUIC/UDP/IP
packet destined to [UPF Link-specific QUIC-LL IP address = 10.10.1.2, UPF Port
= 53671].
When the QUIC/UDP/IP packet reaches the 3GPP access interface, the QoS rules
are applied and the packet is sent to a QoS flow that matches the [UPF Link-
specific QUIC-LL IP address = 10.10.1.2, UPF Port = 53671].
Figure 6.1.4-2: Example of user-plane operation with QUIC-LL
### 6.1.4a Alternative User-Plane Operation
In order to enable the QoS rules to be applied to the inner IP packets (as in
Rel-16), the alternative user-plane operation shown in the figure below can
use used. In this alternative, the QoS rules are applied before the Access
Selection component and, therefore, they map SDFs to QFIs, as in Rel-16.
The functionality of the Access Selection component and the QTC component
remain the same (as specified above). More specifically, the Access Selection
component selects an access type (3GPP or non-3GPP) for a PDU (e.g. IP packet)
based on the steering mode in the matched ATSSS rule and the QTC component in
the UE selects a QUIC connection for a PDU based on the QUIC Connection
Selection Descriptor in the matched ATSS rule.
NOTE: The QFI selected by the QoS flow selection component is transferred down
to the selected access (3GPP or non-3GPP). For a packet created by the QUIC
protocol itself (e.g. a PING frame), the QFI delivered to the access is the
QFI associated with the QUIC connection over which this packet is transmitted.
Editor\'s note: Further details of this alternative user-plane operation are
FFS. It is also FFS which of the two alternatives (in Figure 6.1.4-2 and in
Figure 6.1.4a-1) will be selected.
Figure 6.1.4a-1: Example of alternative user-plane operation with QUIC-LL
### 6.1.5 Support of Steering Modes
The QUIC-LL supports the steering modes defined in Rel-16 with the following
clarifications:
\- Active-Standby: Supported.
\- Smallest Delay: Supported with improved RTT estimation. The QUIC protocols
estimates the RTT for each QUIC connection as defined in in draft-ietf-quic-
recovery [7]. Since the traffic of each QUIC connection is mapped to a QoS
flow, then QUIC-LL supports RTT estimation per QoS flow. Hence, the access
with the smallest delay is more accurately estimated, than in Rel-16 where the
RTT is estimated using the default QoS flow only.
\- Load-Balancing: Supported without re-ordering. The QUIC-LL does not support
re-ordering of the packets transmitted via different accesses. If, for
example, 80% of the packets of a data flow are sent to QUIC connection #1 over
3GPP access and 20% of the packets of the same data flow are sent to QUIC
connection #1 over non-3GPP access, then the packets of this data flow may
arrive at the receiving end out of order. However, the upper layers (e.g. TCP)
or the application itself may be able to do packet re-ordering.
\- Priority-based: Supported by using the congestion control mechanism of QUIC
(defined in draft-ietf-quic-recovery [7]). When a data flow is sent to QUIC
connection #1 over 3GPP access, and the QUIC protocol determines that this
QUIC connection is congested, then the data flow is transferred also to QUIC
connection #1 over non-3GPP access (so it is split over the two accesses). In
this case, the data may be received out-of-order. The upper layers (e.g. TCP)
or the application itself may be able to do packet re-ordering.
The QUIC-LL supports also the following steering modes, not supported in
Rel-16:
\- Smallest Loss Rate: Supported by using the ack-eliciting mechanism defined
in draft-ietf-quic-recovery, with which the QUIC protocol can estimate the
loss rate of a QUIC connection. Example of ATSSS rule using this steering
mode: \"Send the traffic of App1 to the access with the smallest loss rate\".
\- Loss Rate Threshold: Supported by using the ack-eliciting mechanism defined
in draft-ietf-quic-recovery, with which the QUIC protocol can estimate the
loss rate of a QUIC connection. Example of ATSSS rule using this steering
mode: \"Send the traffic of App1 to the access with loss rate \< 1%; if both
accesses have loss rate \< 1%, send it to 3GPP access\". There is no need to
(periodically) re-evaluate the loss rate of each access and to select the
access with the smallest loss rate. As long as the selected access has loss
rate \< 1%, the traffic can remain on this access.
\- RTT Threshold: Supported by using the RTT estimation mechanism defined in
draft-ietf-quic-recovery, with which the QUIC protocol can estimate the RTT of
a QUIC connection. Example of ATSSS rule using this steering mode: \"Send the
traffic of App1 to the access with RTT \< 100ms; if both accesses have RTT \<
100ms, send it to non-3GPP access\". Note that this is different from the
\"Smallest Delay\" steering mode because it specifies a preferred access (i.e.
non-3GPP access in this example). There is no need to (periodically) re-
evaluate the RTT of each access and to select the access with the smallest
delay. As long as the selected access has RTT \< 100ms, the traffic can remain
on this access.
The above steering modes illustrate the kind of steering modes that can be
supported with QUIC-LL using information provided by the QUIC protocol. More
steering modes can be derived by combining the above steering modes.
### 6.1.6 Impacts on services, entities, interfaces and IETF protocols
IETF protocols
\- The QUIC-LL solution is based on the following QUIC draft specifications
defined by IETF. The QUIC-LL does not require any changes to these
specifications.
\- draft-ietf-quic-transport [6].
\- draft-ietf-quic-recovery [7].
\- draft-ietf-quic-tls [18].
\- draft-ietf-quic-datagram [8].
NOTE: If the draft-piraux-quic-tunnel [9] is sufficiently progressed in IETF
until the Rel-17 freeze date, the QUIC-LL can easily adopt the procedures
specified in this document. This will align the QUIC tunnelling procedures
defined in IETF and in 3GPP.
\- If there is need to support QUIC using NULL encryption between UE and UPF,
this need should be communicated to IETF and either addressed by IETF or
addressed by 3GPP, e.g. by specifying a \"3GPP 5G profile for QUIC\" which can
support different cipher suites than those defined by IETF, including cipher
suites using NULL encryption. This aspect should be further investigated by SA
WG3.
AMF
\- No impact. It is assumed that if 5GC supports ATSSS / Rel-17, then all
ATSSS-capable SMFs in 5GC are capable of supporting QUIC-LL.
SMF
\- From the PCC rules, it shall determine the number of QUIC connections
needed per access.
\- Shall indicate to UPF the number of QUIC connections needed per access.
\- Shall create and send to UE the \"QUIC Connection Setup Information\" based
on the QUIC-LL Address Information received from UPF.
\- From the received PCC rules, it shall create corresponding ATSSS rules and
QoS rules for the UE. An ATSSS rule using the QUIC-LL steering functionality
shall map the traffic of a service data flow to a specific QUIC connection.
\- Each QoS rule shall map the traffic of a QUIC connection to an associated
QoS flow.
\- From the received PCC rules, it shall create corresponding N4 rules (PDRs,
MAR, QER, etc.) for the UPF.
PCF
\- Shall be able to create PCC rules using the QUIC-LL steering functionality.
UPF:
\- Shall be able to allocate the \"UE Link-specific QUIC-LL\" IP addresses.
\- Shall be able to allocate QUIC-LL Address Information, i.e. two IP
addresses used for QUIC-LL (one per access) and one UDP port number for each
QUIC connection.
\- Shall apply the N4 rules (e.g. PDRs and associated MARs) to select an
access type and a QUIC connection for each DL PDU. Each MAR using the QUIC-LL
steering functionality shall identify a QUIC Connection.
\- Shall apply the QoS Enforcement Rules (QERs) to map the traffic of each
QUIC connection to a QoS flow.
UE:
\- Shall be able to indicate support of QUIC-LL when requesting a MA PDU
Session.
\- Shall establish _N_ QUIC connections to UPF via each access, based on the
received \"QUIC Connection Setup Information\".
\- Shall apply the ATSSS rules to select an access type and a QUIC connection
for each UL PDU. Each ATSSS rule using the QUIC-LL steering functionality
shall identify a QUIC Connection.
\- Shall apply the QoS rules to map the traffic of each QUIC connection to a
QoS flow.
## 6.2 Solution #2: New steering mode - Autonomous steering mode
### 6.2.1 Introduction {#introduction-2}
This solution addresses KI#1 on Additional Steering Modes.
As specified in ATSSS Rel-16, the traffic of MA PDU session could be
distributed across both accesses by using different steering modes. There are
four steering modes as defined in Rel-16, i.e. Active-Standby, Smallest Delay,
Priority-based and Load balancing. All the Rel-16 steering modes are decided
by the network side, and performed by the UE and UPF based on the link
performance measurement. For example, if one access becomes unavailable, the
UE and UPF can switch all the traffic to the other available access. However,
except the access available/unavailable status, the UE and UPF cannot
flexibility distribute the traffic over both accesses according to the link
performance in real time. To be more specific, for the Load balancing mode,
the traffic splitting weight is statically set by the network based on the
operators\' requirement instead of the link performance measurement. For the
Priority-based mode, the traffic can take over both access resources only when
one access is congested. In sum, both of these steering modes do not allow the
UE or the UPF to adjust the traffic splitting weight over both accesses
dynamically based on the link status, not even mention Active-Standby and
Smallest Delay.
### 6.2.2 High-level Description
This steering mode, called Autonomous steering mode, provides to both the UE
and the UPF flexibility on the traffic splitting control in order to maximize
the bandwidth/throughput when two accesses are applicable for this traffic.
For example, some traffic has high bandwidth requirement, such as video
service, download service, etc, the higher bandwidth/throughput is provided by
the network, the better service quality can be achieved. Then the autonomous
steering mode can be applied on these traffic for UE and UPF to flexibly
adjust the weight factor on both accesses in order to maximize the
bandwidth/throughput. Additionally, this Autonomous steering mode should only
be allowed by the operator when both accesses can be applied to transport the
traffic, and from the operator point of view, high bandwidth/throughput is
more important than the control on the access selection for the traffic
steering/switching/splitting. See Figure 6.2.2-1 for details, where one single
packet flow is shown as an example for UL and DL respectively. The weight
factor for the traffic over each access, e.g. 30% for UL and 50% for DL on
3GPP access, and 70% for UL and 50% for DL on non 3GPP access, as shown in the
figure, is decided by the UE and the UPF independently for both UL and DL,
subject to link status to achieve the high bandwidth/throughput. As the weight
factor for each access can be adjusted dynamically by the UE and the UPF,
there is no need for the PCF/SMF to send the static weight factor values to
the UE and the UPF.
NOTE 1: It can also be considered to send the initial weight factor to the UE
and the UPF from the PCF/SMF. This initial value is applied at the beginning
of the traffic steering when the link status measurement has not been started.
Figure 6.2.2-1: Autonomous steering mode
Optionally, the threshold can also be provided together with the Autonomous
steering mode, including Maximum RTT, UL/DL Maximum Packet Loss Rate, UL/DL
Maximum Jitter as described in clause 6.3.2.2. These thresholds can assist UE
and UPF to decide whether the traffic can be transported via a specific
access. For example, when one access cannot satisfy the threshold requirement,
the UE and UPF will treat this access as unavailable, and then switch all the
packets to the other access. When both accesses cannot satisfy the thresholds,
how to steer/switch/split the traffic depends on the UE and UPF
implementation.
This autonomous steering mode can be applied by the MPTCP, ATSSS-LL and
(MP)QUIC steering methods. To be more specific, for the MPTCP (as defined in
Rel-16) or (MP)QUIC (e.g. as defined in solution #7 and solution #8) steering
methods, as the packet reordering is supported by the MPTCP or (MP)QUIC
protocol, one packet flow splitting per packet with flexible weight factor on
both accesses can be decided and applied by the UE and the UPF based on the
autonomous steering mode. For the ATSSS-LL (as defined in Rel-16) steering
method, only different packet flow via different accesses, i.e. traffic
splitting per packet flow, can be supported in the autonomous steering mode.
NOTE 2: The Autonomous steering mode can be applied by all the steering
methods, i.e. independent on the selection of the steering method.
### 6.2.3 Procedures
The MA PDU session establishment procedure is based on the signalling flow in
clause 4.22.2 with the following changes:
\- In step 1, the UE provides Request Type as \"MA PDU Request\" in UL NAS
message and its ATSSS capabilities as defined in TS 23.501 [3] clause 5.32.2.
If the UE includes in its ATSSS capabilities MPTCP functionality with any
steering mode and/or ATSSS-LL functionality with any steering mode, the any
steering mode includes the Autonomous steering mode both in uplink and
downlink direction in addition to the steering modes defined in Rel-16.
\- In step 7, if dynamic PCC is to be used for the MA PDU session, the SMF
includes Autonomous steering mode as the ATSSS capabilities of the MA PDU
session. The PCF provides PCC rules which include the MA PDU session control
information which includes the Steering Functionality and the Steering mode.
When the steering mode in the MA PDU session control information indicates the
rules for distribution of traffic between accesses for Autonomous steering
mode it also includes the default the traffic splitting weight set by the
network based on the operators\' requirement together with the thresholds for
Maximum RTT, UL/DL Maximum Packet Loss Rate, UL/DL Maximum Jitter as defined
in Solution 3 of the present TR. The SMF from the received PCC rules derives
the ATSSS rules and N4 rules that will be sent to the UE and the UPF
respectively. Both the UE and UPF will control the traffic steering,
splitting, and switching in the UL/ DL direction and adjust the traffic
splitting weight when Autonomous steering mode is supported based on the
combination of link status and the threshold for RTT, UL/DL Maximum Packet
Loss Rate, UL/DL Maximum Jitter.
\- In step 8, the SMF selects one or more UPFs as defined TS 23.502 [4] clause
6.3.3.3, where the information regarding the ATSSS Steering Capability of the
UE may include support for Autonomous steering mode.
### 6.2.4 Impacts on services, entities, interfaces and IETF Protocols
This solution will impact the following entities in 5GS:
\- SMF: Supports to select the UPF with support of the new steering mode.
\- PCF: Supports to authorize the new steering modes for the SDF.
\- UPF: Supports the new steering modes.
\- UE: Supports the new steering modes.
\- 5G-AN/ NG RAN: No impact.
## 6.3 Solution #3: New steering mode - Autonomous steering mode with advanced
PMF
### 6.3.1 Introduction {#introduction-3}
This solution addresses KI#1 on Additional Steering Modes, and it is like
solution #2 but with advanced link performance measurement function (PMF)
To support these new steering modes, the link performance measurement function
(PMF) defined in Rel-16 needs to be enhanced. The Rel-16 PMF can support the
RTT measurement and access availability report per PDU session. Regarding the
RTT measurement, a default QoS flow is used to transport the measurement
traffic, and the RTT value detected on this QoS flow is treated as the RTT for
this PDU session via this access. Obviously, it cannot reflect the accurate
RTT for every traffic in this PDU session via this access. For some latency
sensitive service traffic, the RTT measurement per QoS flow is needed.
Furthermore, except the RTT, the loss ratio and jitter are also valuable to be
measured for decision of the link performance, and consequently enable better
traffic steering/switching/splitting. At the same time, some thresholds
corresponding to these parameters, such as Maximum RTT, Maximum UL/DL Packet
Loss Rate and jitter, can be sent to the UE and the UPF for triggering traffic
steering/switching/splitting, similar as RAN support information defined for
3GPP access supporting the RAN for handover threshold decision.
The solution describes following different features:
\- RTT measurement per QoS flow;
\- Packet loss ratio measurement per QoS flow;
\- Jitter measurement per QoS flow;
\- Thresholds for traffic steering/switching/splitting;
These features may be independently selected for normative phase.
### 6.3.2 High-level Description
#### 6.3.2.1 Enhancement on link performance measurement
The Rel-16 PMF is enhanced to support the RTT measurement per QoS flow, and to
support measurement of the loss ratio and jitter per QoS flow, with both the
UE and the UPF sending PMF messages per QoS flow. The enhancement of PMF is
applied to the Rel-16 ATSSS-LL steering method and the QUIC-based steering
method as defined in the solution #8, to improve the traffic steering.
**RTT measurement per QoS flow:**
Same as in Rel-16, when an MA PDU Session is established, the network may
provide the UE with Measurement Assistance Information.
The RTT measurement per QoS flow may be triggered by UE or the UPF
independently. The Measurement Assistance Information contains the QFI(s) for
which the RTT measurement is to be applied. Optionally, the RTT measurement
frequency can also be decided by the network side and sent to UE if available
via Measurement Assistance Information.
The following mechanism is used.
In the case of the MA PDU session of IP type:
\- The PMF in the UE sends PMF messages via one QoS flow to the PMF in the UPF
over UDP/IP. The destination IP address and UDP port are as defined in Rel-16,
i.e. the destination IP address is the PMF IP address, and the UDP port number
corresponds to the access via which this message is sent. When the message is
received by the UPF, the UPF can identify the PMF message based on the
destination IP address.
\- The PMF in the UPF sends PMF messages to the PMF in the UE over UDP/IP. The
source IP address is the same IP address as the one provided in the
Measurement Assistance Information and the source UDP port is one of the two
UDP ports as provided in the Measurement Assistance Information as defined in
Rel-16. The destination IP address is the MA PDU session IP address allocated
by the UE, and the UDP port is also sent by the UE via user plane after the MA
PDU session establishment as defined in Rel-16. When the message is received
by the UE, the UE can identify the PMF message based on the source IP address
of the PMF.
In the case of the MA PDU session of Ethernet type:
\- The PMF in the UE sends PMF messages to the PMF in the UPF over Ethernet.
The destination MAC address is included in the Measurement Assistance
Information as defined in Rel-16. Then the UPF can identify the PMF message
based on the destination MAC address.
\- The PMF in the UPF sends PMF messages to the PMF in the UE over Ethernet.
The source MAC address and destination MAC address are as defined in Rel-16.
Then the UE can identify the PMF message based on the source MAC address.
The UE and the UPF derive an estimation of the average RTT over an access type
by averaging the RTT measurements obtained over this access.
Figure 6.3.2.1-1: RTT measurement in Rel-16 and enhancement for Rel-17
It is not suggested to perform the RTT measurement for GBR QoS flow,
considering the QoS parameters for GBR traffic are guaranteed, and the GBR
traffic is only transported via one access resulting in no comparing with the
other path RTT value.
Comparing with the RTT measurement per PDU session as defined in Rel-16, this
solution makes the RTT measurement more accurate. Because even for the non-GBR
QoS flow, different QoS flow corresponding to the different 5QI has the
different packet delay budget requirement, quote from TS 23.501 [3] Table
5.7.4-1. For example, when the 5QI=5, the packet delay budget is 100ms, but if
the 5QI=6, the packet delay budget is equal to 300 ms, three times than 5QI=5.
Therefore it is incorrect to use one non-GBR QoS flow RTT representing all the
other non-GBR QoS flows.
1) Packet loss ratio measurement per QoS flow, the same mechanism as described
in the TR 23.793 [13] clause 6.3.1.4.
UE and UPF exchange the packet counting information in certain period to
calculate the packet loss ratio during the path performance measurement
procedure.
\- The UE counts the number of UL packets via one QoS flow between one PMF
request message and the previous PMF echo request message, and provides the
result to the UPF via this PMF request message.
\- UPF also counts the number of received UL packets between one PMF request
message and the previous PMF request message via one QoS flow. UPF calculates
the UL packet loss ratio based on the local counting result and the number of
UL packets send by UE.
\- UPF sends the UL packet loss ratio result to the UE via PMF response
message. In the same message, it can also include the counting number of DL
packets between one PMF response message and the previous PMF response message
if the DL packets loss ratio is measured.
\- UE counts the number of received DL between one PMF response message and
the previous PMF response message. The UE calculates the DL packet loss ratio
based on the local counting result and the number of DL packets send by UPF,
and sends the DL packet loss ratio to the UPF via the subsequent PMF message.
The PMF message applied to calculate the packet loss ratio is the same as the
PMF message used to measure the RTT, just adding the number of packet or/and
the packet loss ratio IE(s) to these PMF messages. Taking the UE initiated UL
packet loss ratio measurement as an example, the PMF request messages from UE
and the corresponding PMF response messages (Transaction ID is used to
identify the request/response message) from UPF are applied to transport the
number of packet and loss ratio, see the following figure 6.3.2.1-2.
Figure 6.3.2.1-2: packet loss ratio measurement for UL traffic
2) Jitter measurement per QoS flow, the same mechanism as described in the TR
23.793 [13] clause 6.3.1.4.
Jitter is regarded as the reflection of transfer quality stability within
certain time interval. The UL jitter could be calculated by the UPF, and the
DL jitter could be calculated by the UE. The following solution is an example
method for calculating the UL jitter per QoS flow, and the DL jitter could be
calculated using the similar method.
\- It is assumed to calculate the jitter between one PMF request message and
the Nth PMF request message after this certain PMF request message received by
the UPF. The PMF request messages are sent periodically by the UE and the PMF
request messages are labelled with unique sequence numbers.
These continuous PMF request message could be numbered from n-N+1 to n.
The average expectation value of arriving time interval between any two PMF
requests could be represented as Avg(n).
The value of variance of arriving time interval of N PMF echo request could be
represented as Var(n).
In this example, the Var(n) is regarded as the packet transport jitter for the
corresponding QoS Flow. It is assumed that t~k~ is the local time of UPF when
receiving the PMF request message numbered by variable k between n-N+1 and n.
$\text{Avg}\left( n \right) = \ \sum_{n - N + 1}^{n}\left( t_{k} - t_{k - 1}
\right)/N$, $\text{Var}\left( n \right) = \ \sqrt{\frac{{\sum_{n - N +
1}^{n}\left( t_{k} - t_{k - 1} - Avg\left( n \right) \right)}^{2}}{N}}$
Alternatively, average absolute inter-packet arrival interval, worst case
packet delay variation can be used to represent jitter.
The absolute inter-packet arrival interval is calculated as:
Δ𝑑𝑘−1,=𝑡𝑘−𝑡𝑘−1−Avgn. There are two options to calculate the average of
absolute inter-packet arrival interval [16]:
$j_{n} = j_{n - 1} + \left( \left| {\Delta d}_{n - 1,n}^{\left( n \right)}
\right| - j_{n - 1} \right)/16$
$j_{n} = \left( \sum_{k = n - N + 1}^{n}\left| {\Delta d}_{k - 1,k}^{(n)}
\right| \right)/N$
The packet delay variation [15] with respect to packet 𝑛−𝑁 is:
${\Delta d}_{n - N,k}^{\left( n \right)} = \left( t_{k} - t_{n - N} \right) -
\left( k - \left( n - N \right) \right) \bullet Avg\left( n \right)$
The worst-case packet delay variation [17] among packet 𝑛−𝑁+1 to packet 𝑛 is:
${\Delta d}_{\max} = \max_{n - N < k \leq n}{\Delta d}_{n - N,k}^{\left( n
\right)} - \min_{n - N < k \leq n}{\Delta d}_{n - N,k}^{\left( n \right)}$
Only successfully received PMF request messages will be used by the receiver
to calculate the jitter metric. The receiver (UE or the UPF) calculates the
jitter metric using one of the approach described above and reports the
measured jitter metric via a PMF report message.
The jitter measurement can be enabled based on the indication from PCF. For
example, the PCF sends the jitter threshold (as defined in clause 6.3.2.2) for
SDF to the SMF. If one or more SDF(s) in the QoS flow apply the jitter
threshold, the jitter measurement for this QoS flow is enabled. The PMF
message for jitter measurement is transported via this QoS flow, and the
frequency of these PMF messages can be decided based on the implementation,
according to jitter threshold received from PCF.
NOTE: The jitter measurement precision depends on the number of PMF messages
sent within a certain time interval. It can be decided based on the
requirement of the traffic. For example, the microsecond-level latency-
sensitive services will need more PMF messages sent in a certain period than
the millisecond-level delay-sensitive services.
#### 6.3.2.2 Thresholds for traffic steering/switching/splitting
Some thresholds, such as Maximum RTT, Maximum UL/DL Packet Loss Rate and/or
jitter, are provided to the UE and the UPF for triggering traffic
steering/switching/splitting. These thresholds are to be applied to non-GBR
QoS flow For the GBR QoS flow, only the jitter threshold parameter may be
considered for the traffic steering/switching.
The PCF can provide the Maximum RTT, UL/DL Maximum Packet Loss Rate and jitter
threshold parameters to the SMF, and SMF will forward these parameters to the
UE and UPF via ATSSS rule or MAR rule. The threshold can be provided per QoS
flow, working together with the link performance measurement per QoS flow as
defined in clause 6.3.2.1. It can be applied to both the MPTCP functionality
and ATSSS-LL functionality if the PMF is enhanced to support the RTT, loss
rate and jitter measurement per QoS flow as defined in clause 6.3.2.1.
\- The _Maximum RTT_ indicates parameter for the decision of access
availability via 3GPP access and non-3GPP access, i.e. the maximum RTT
threshold that can be tolerated in the round trip for the QoS flow.
\- The _UL Maximum Packet Loss Rate_ indicates parameters for the decision of
UL access availability via 3GPP access and non-3GPP access, i.e. the maximum
rate for lost packets that can be tolerated in the uplink direction for the
QoS flow.
\- The _DL Maximum Packet Loss Rate_ indicates parameters for the decision of
DL access availability via 3GPP access and non-3GPP access, i.e. the maximum
rate for lost packets that can be tolerated in the downlink direction for the
QoS flow.
\- The _UL Maximum jitter_ indicates parameters for the decision of UL access
availability via 3GPP access and non-3GPP access, i.e. the maximum jitter that
can be tolerated in the uplink direction for the QoS flow.
\- The _DL Maximum jitter_ indicates parameters for the decision of DL access
availability via 3GPP access and non-3GPP access, i.e. the maximum jitter that
can be tolerated in the uplink direction for the QoS flow.
The Maximum RTT, UL Maximum Packet Loss Rate or DL Maximum Packet Loss Rate
parameters for 3GPP and non-3GPP access can be provided separately. If the
parameters for non-3GPP access are not included in the PCC rule, the
corresponding values for 3GPP access apply.
Taking the redundancy steering mode as an example by using the above
thresholds, if one access packet loss rate does not reach the UL/DL Maximum
Packet Loss Rate, then only one access is applied to transport the traffic.
But when one access packet loss rate is equal to or higher than the UL/DL
Maximum Packet Loss Rate, then the redundancy transmission mode is triggered,
till one access performance is improved.
NOTE: These thresholds can also be applied to existing steering modes, such as
Priority-based steering mode, Active-Standby steering mode.
#### 6.3.2.3 Considerations to support per QoS flow measurement
When a UE performs per QoS flow measurement by using PMF message, the UE and
UPF needs to send PMF message over the target the QoS flow. In order to
support this, the following methods are possible:
1) SMF provides necessary QoS rule(s) and N4 rule(s) to the UE and UPF for PMF
message. Also, the SMF provides Measurement Assistance Information to UE,
which contains different PMF addresses/ports for the different QoS flows.
2) The UE and UPF ignores the QoS rule(s) and N4 rule(s) for the PMF message
and send it over a target QoS flow by examining the header of the PMF message,
which contains the target QoS flow identity.
3) The SMF does not provide QoS rule(s) and N4 rule(s) to the UE and UPF for
PMF message. However, the SMF provides Measurement Assistance Information to
UE, which contains different PMF addresses/ports for the different QoS flows.
When the UE attempts to transmit a PMF message, the UE determines the target
QoS flow for this PMF message, based on the received Measurement Assistance
Information. As in Option 2, the UE and UPF ignore the QoS rules and N4 rules
when they determine the target QoS flow for a PMF message
Option 1 is more aligned with overall QoS design but each PMF message over a
QoS flow should use different PMF address information e.g. different address
or port number. It means that the UE or UPF should allocate different PMF IP
addresses or ports for each QoS flow. If the UE allocates different
addresses/ports, the information should be sent to the network and based on
the information SMF needs to generate QoS rule(s) and N4 rule(s). However, it
will cause additional NAS signalling. So it is reasonable to allocate
different addresses/ports by the UPF.
Option 2 is more simple approach because UE and UPF does not need to manages
different PMF addresses/ports for each QoS flow. However, this is not aligned
with general QoS framework. The UE and UPF shall ignore existing QoS rule(s)
and N4 rule(s) when it sends PMF message over a QoS flow or ignore existing
TFT(s) and Sx rule(s) when it sends PMF message over a dedicated bearer if the
3GPP access leg is established over a EPC.
Option 3 is similar to Option 2 in that (a) it does not require the SMF to
create QoS rules and N4 rules specifically for the PMF traffic and (b) the QoS
rules and the N4 rules are ignored for PMF messages. As in Option 1, the UPF
(or the SMF) allocates a different PMF addresses/ports for each QoS flow on
which access performance measurements may be needed (as in Option 1). The SMF
includes the PMF addresses/ports and the associated QoS flows in the
Measurement Assistance Information. The UE then applies the Measurement
Assistance Information whenever it wants to determine the target QoS flow for
a PMF message. Option 3 does not require the header of a PMF message to
contain the target QoS flow identity. It requires however the header of a PMF
message to contain an appropriate destination PMF addresses/ports.
In 5GS, different from EPS, multiple QoS flows can be mapped to a single AN
resource (i.e. DRB in 3GPP access, IKE tunnel in non-3GPP access) in the AN.
If such mapping is done by the AN, per QoS flow level measurement can be
optimized considering the end-to-end performance largely depends on radio
performance. A UE may provide AN resource -- QoS flow mapping information to
the UPF via PMF message. Based on the information, UPF may selectively perform
measurement via one or some of the QoS flows instead of measuring all QoS
flows.
### 6.3.4 Impacts on services, entities, interfaces and IETF Protocols
This solution will impact the following entities in 5GS:
\- SMF: Supports to select the UPF with support of the new steering modes.
\- PCF: Supports to authorize the new steering modes for the SDF
\- UPF: Supports the new steering modes and the enhancement of the PMF.
\- UE: Supports the new steering modes and the enhancement of the PMF.
\- 5G-AN/ NG RAN: No impact.
## 6.4 Solution #4: New steering mode - Redundant steering mode
### 6.4.1 Introduction {#introduction-4}
This solution addresses KI#1 on Additional Steering Modes.
### 6.4.2 High-level Description
During Rel-16 ATSSS study, the redundancy steering mode is documented (see
clause 6.3.1.1, 6.4.1 in the TR 23.793 [13]) for the loss rate sensitive
traffic, such as IMS singling, video, and some TCP-based traffic. It allows
the traffic transmitted via 3GPP and non-3GPP accesses in a redundant way to
achieve the lowest latency and lower the loss rate. It is proposed to further
enhance the redundancy steering mode as described in the TR 23.793 [13], with
which the traffic will always be transmitted over both accesses once applied,
to make it possible that the traffic transmission goes via both accesses if
necessary or via only one access to save the transport resource. In details,
when the traffic is allowed on both accesses, the UE and the UPF can decide to
transport the traffic via one access or both accesses based on the link
performance measurement (e.g. based on the packet loss rate and the threshold
of the loss rate). For example, if the loss rate on one access does not exceed
the threshold, then only this one access is applied, otherwise, redundant
transmission is triggered. Especially, the redundancy transmission solution
may be triggered during the traffic switching phase to avoid the packet lost
in the handover procedure. See below Figure 6.4.2-1 for details, where UL
packet flow is taken as an example. The DL shares the same mechanism.
This redundancy steering mode can be applied by the MPTCP (as defined in
Rel-16) and QUIC (as defined in solution #8) steering methods and MPQUIC (e.g.
as defined in solution #7). For the ATSSS-LL (as defined in Rel-16), the
redundancy steering mode is not supported.
Figure 6.4.2-1: Redundancy steering mode
The enhancement on link performance measurement as described in the clause
6.3.2 and definition of thresholds for traffic steering/switching/splitting in
the clause 6.3.3 are also applicable to this Redundancy steering mode.
### 6.4.3 Impacts on services, entities, interfaces and IETF Protocols
This solution will impact the following entities in 5GS:
\- SMF: Supports to select the UPF with support of the new steering mode.
\- PCF: Supports to authorize the new steering mode for the SDF.
\- UPF: Supports the new steering mode and the enhancement of the PMF.
\- UE: Supports the new steering mode and the enhancement of the PMF.
\- 5G-AN/ NG RAN: No impact.
## 6.5 Solution #5: Replacing 3GPP access leg of MA-PDU Session with PDN
connection in EPC
### 6.5.1 Introduction {#introduction-5}
This solution enables a capable UE and network to replace the 3GPP access leg
of a normal MA PDU Session with a PDU connection in EPC, while keeping the
non-3GPP access leg in 5GC.
This solution is meant as a complement to solution \"Supporting a PDN
connection in EPC as a 3GPP access leg of MA-PDU Session\" so taking the
Rel-16 solution (for 5G RG) as the baseline to support any UE BUT with a focus
on the support of mobility of a MA PDU Session with a 3GPP leg over 5GC (PDU
Session) towards a MA PDU session with a 3GPP leg over EPC (PDN connection).
Editor\'s note: NOTE 1 of clause 5.3.1 (Description of KI#3) about Whether any
new steering functionality and steering modes defined as part of the Rel-17
ATSSS can be applied to this solution is applicable as for any solution to
KI#3.
### 6.5.2 High-level Description
In this solution, it is assumed that the UE is able to attach to the EPC over
E-UTRAN and simultaneously register with the 5GC over non-3GPP access.
Initially, the UE is registered with 5GC via both 3GPP access and non-3GPP
access and has established a MA-PDU Session with UP resources for both 3GPP
access and non-3GPP access in 5GC.
Editor\'s note: The UE may also establish from scratch a MA PDU with 3GPP
access leg in EPC, i.e. without pre-existence of a normal MA-PDU. This case is
not covered in this solution and may be addressed by other solutions.
For brevity, the scenario of 5GS to EPS mobility in IDLE mode without N26
interface is used to describe the solution.
The UE may indicate its support for 3GPP access leg in EPC for a MA-PDU
Session as part of ATSSS capability during the MA-PDU Session establishment.
If the network also supports it, and based on the network local policies, the
network may indicate that the MA-PDU Session is allowed to have its 3GPP
access leg replaced by a PDN connection in the EPC.
During the 5GS to EPS mobility procedure, for the MA-PDU Session which is
allowed to have 3GPP access leg in EPC, the UE may provide an indication of
\"MA PDU Request\", in addition to MA-PDU Session ID in PCO, in the UE
initiated PDN Connectivity request (Step 13 of Figure 4.11.2.2.-1 in TS 23.502
[4]). The \"MA PDU Request\" indicates that the UE requests to keep the PDN
Connection as the 3GPP access leg of the original MA PDU Session. If this is
accepted by the network, the PGW-C/SMF should not release the UP resources of
the non-3GPP access leg in 5GC.
After the PDN Connection is successfully established in the EPC, the network
may initiate the session modification procedure with the PGW-U/UPF to
associate the PDN Connection with the MA-PDU Session and modify the forwarding
rules. The network may also initiate PDU Session Modification procedure in the
5GC over non-3GPP access. The network indicates to the UE that the 3GPP access
leg of the MA-PDU Session has been replaced by the PDN connection. The UE then
locally associates the PDN connection as the 3GPP access leg of the MA-PDU
Session. The network may also update the ATSSS rules over the 5GC non-3GPP
access.
At this point, the original MA PDU Session is converted to a new MA PDU
Session with the 3GPP access leg in EPC. In the uplink, for the data
associated with the PDN connection, if the PDN connection is part of a MA PDU
Session, the UE further checks the ATSSS rules and according to the rules, the
UE may steer the data toward the PDN connection in EPC, or non-3GPP connection
in 5GC.
When the UE moves back from the EPS to 5GS, the UE may re-establish the MA-PDU
Session over 3GPP access of 5GC.
### 6.5.3 Procedures
Figure 6.5.3-1: Replacing 3GPP access leg of MA PDU Session with PDN
connection in EPC
1\. The UE is registered in the 5GS over both 3GPP access and non-3GPP access.
2\. The UE established a normal MA PDU Session in 5GS, with UP resources in 5G
for both 3GPP access and non-3GPP access.
3\. The UE moves from 5GS to EPS due to mobility.
4\. In the case of 5GS-EPS mobility without N26 interface, Steps 1-12 of
Figure 4.11.2.2-1 in TS 23.502 [4] are performed.
In case of 5GS-EPS mobility with N26 interface, Steps 1-19 of Figure
4.11.1.3.2-1 in TS 23.502 [4] are performed, and Step 5 below is skipped.
5\. In the case of 5GS-EPS mobility without N26 interface, in Step 13 of
Figure 4.11.2.2-1 in TS 23.502 [4], the UE provides additional indication of
\"MA PDU request\" (e.g. in PCO), and PDU Session ID of the MA PDU session.
This indication informs the network that the UE hopes to keep the PDN
Connection as the 3GPP access leg of the MA PDU Session.
If the MA-PDU session is the only PDU Session that needs to be handed over to
the EPS, Step 5 may be realized in the PDN Connectivity Request combined in
EPS Attach procedure of step 4. And in this case step 5 is not needed.
6\. If the network accepts the PDN Connection as the 3GPP access leg of the MA
PDU Session, the PGW-C+SMF initiate the N4 session modification procedure to
associate the PDN Connection with the MA-PDU Session and modify the forwarding
rules accordingly.
7\. The UE locally associates the PDN connection with the MA PDU Session. The
network may also update the ATSSS rules to make them more adapted to the new
MA PDU Session with one leg in EPC.
### 6.5.4 Impacts on services, entities, interfaces and IETF Protocols
The solution has the following impacts on entities and interfaces:
\- PGW-C+SMF/PGW-U+UPF:
\- Supports the MA-PDU Session Request indication and PDU Session ID in the
PCO PDN Connection request as in Rel-16.
\- Supports the session modification procedure to associate the EPS UP
resource with the existing MA-PDU Session as in the Rel-16.
\- PGW-U+UPF:
\- Supports the session modification procedure to associate the EPS UP
resource with the existing MA-PDU Session.
\- UE:
\- Supports the association of the EPS UP connection with the existing MA-PDU
Session.
## 6.6 Solution #6: MPQUIC-LL Steering Functionality
### 6.6.1 Introduction {#introduction-6}
This clause defines a new ATSSS steering functionality called MPQUIC-Low Layer
(MPQUIC-LL). It is a \"Low Layer\" steering functionality because it operates
below the IP layer (such as ATSSS-LL), in contrast to a high layer steering
functionality that operates above the IP layer (such as MPTCP).
The MPQUIC-LL provides an unreliable tunnelling service between the UE and the
UPF that is based on:
1\. The QUIC protocol (version 1) specified in draft-ietf-quic-transport [6]
along with accompanying documents that describe QUIC\'s loss detection and
congestion control (draft-ietf-quic-recovery [7]) and the use of TLS for key
negotiation (draft-ietf-quic-tls [18]); and
2\. The QUIC extensions specified in draft-ietf-quic-datagram [8] for
supporting unreliable datagram transport; and
3\. _The QUIC extensions specified in draft-deconinck-multipath-quic [10] for
supporting multipath QUIC._
The Figure 6.6.1-1 shows the model of an MA PDU Session that operates using
the MPQUIC-LL steering functionality.
Figure 6.6.1-1: Model of MA PDU Session using MPQUIC-LL
The MPQUIC-LL is composed of the following components:
\- **MPQUIC Tunnel Client (MQTC)** : The MQTC operates in the UE as a MPQUIC
client application and provides the following functionality:
\- It establishes N MPQUIC connections with the MPQUIC tunnel server (MQTS) in
the UPF. The number N of MPQUIC connections, as well as the destination IP
address & port for each MPQUIC uniflow, is determined from information
contained in the PDU Session Establishment Accept message (see the \"MPQUIC
Connection Setup Information\" below). Each MPQUIC connection is established
immediately after the setup of the MA PDU Session.
NOTE 1: As explained below, each MPQUIC connection carries the traffic of one
QoS flow only. This is required because the MPQUIC protocol can multiplex
several PDUs in a single QUIC packet. By using a separate MPQUIC connection
for each QoS flow, we ensure that PDUs belonging to different QoS flows, which
may require a different QoS treatment, are not multiplexed in the same QUIC
packet.
\- It receives UL PDUs from the upper layer and, for each UL PDU:
\- First, it selects a QoS flow based on the QoS rules in the UE.
\- Then, it selects a steering mode to be applied for the UL PDU based on the
ATSSS rules in the UE.
\- It compresses the headers (e.g. IP, UDP, TCP, Ethernet) of the UL PDU.
\- Finally, it selects a MPQUIC connection to transmit the PDU based on the
selected QoS flow and the selected steering mode. For each established MPQUIC
connection, the MQTC maintains an associated steering mode and QoS flow
indicator.
NOTE 2: It is assumed that the scheduler of a MPQUIC connection can apply only
one steering mode. Therefore, if different steering modes are needed for the
traffic of a QoS flow, then different MPQUIC connections are setup for this
QoS flow, one per steering mode.
\- In addition, it decompresses the headers of each DL PDU received from UPF.
\- **MPQUIC Tunnel Server (MQTS)** : The MQTS operates in the UPF as a MPQUIC
server application and provides the following functionality:
\- It accepts the MPQUIC connections requested by MQTC in the UE.
\- It receives DL PDUs from the upper layer and, for each DL PDU, it selects a
MPQUIC connection to transmit the PDU. The MPQUIC connection is selected based
on the N4 (e.g. MAR) rules.
\- It appends to each DL PDU received from the upper layer 1-bit header, which
indicates if the PDU should trigger reflective QoS in the UE or not. This
enables the QUIC protocol to encapsulate several DL PDUs in the same QUIC
packet, as shown below, and still make it feasible for the UE to determine
which of these packets should trigger reflective QoS procedures.
Editor\'s note: It is FFS if the 1-bit header can be avoided e.g. by
configuring the QUIC protocol not to encapsulate multiple PDUs with different
RQI markings in the same QUIC packet.
\- It compresses the headers (e.g. IP, UDP, TCP, Ethernet) of each DL PDU
received from the upper layer and decompresses the headers of each UL PDU
received from the UE.
Editor\'s note: Whether further stage-2 details are needed for the header
compression if FFS.
\- **MPQUIC protocol** : The QUIC protocol as defined by IETF with the
applicable multipath extensions (e.g. the extensions defined in draft-
deconinck-quic-multipath [10]). It receives PDUs from the MQTC in the UE (or
the MQTS in the UPF) indicating the MPQUIC connection to be sent on and, for
each PDU, it selects an access type (i.e. a MPQUIC uniflow) to transmit the
PDU. The access type selection is based on the steering mode associated with
the MPQUIC connection and the measurements provided by the MPQUIC protocol
(e.g. RTT, loss rate, congestion). If the QUIC protocol does not supports
multipath extensions, then the equivalent solution #1 in clause 6.1 is
applicable.
It is assumed that if RAN sets the ECN marking in the IP header of an QUIC
packet, then all encapsulated PDUs in this QUIC packet would be ECN-marked.
To support ATSSS using the MPQUIC-LL steering functionality, the architecture
reference model for ATSSS, as specified in TS 23.501 [3] clause 4.2.10, is
enhanced as shown in Figure 6.6.1-2. The MPQUIC-LL steering functionality is
implemented in the UE and in the PSA UPF. The PMF functionality is not needed
for an MA PDU Session that applies MPQUIC-LL. However, the PMF may be needed
for an MA PDU Session that does not apply MPQUIC-LL.
Figure 6.6.1-2: Reference Architecture for ATSSS using QUIC-LL
The MPQUIC-LL functionality tunnels PDUs (e.g. IP packets or Ethernet frames)
over a multipath QUIC transport. The protocol stack in the UE and UPF is shown
in Figure 6.6.1-3. The different IP addresses shown in this figure are
explained in the next clause.
Figure 6.6.1-3: Protocol stack for MPQUIC-LL
In summary, the MPQUIC-LL steering functionality:
a. Supports a multipath, unreliable and secure tunnelling service between the
UE and UPF.
b. Does not support retransmission of lost QUIC datagram frames but supports
loss detection, according to draft-ietf-quic-datagram [6].
c. Supports congestion control per MPQUIC uniflow, i.e. each uniflow of a
MPQUIC connection has its own congestion control state (see draft-deconinck-
multipath-quic [10]). As a result, the UE and the UPF may stop sending
datagram frames on a MPQUIC uniflow when congestion is detected by the MPQUIC
protocol on this uniflow.
d. Supports round-trip and packet loss measurements per MPQUIC uniflow, as
specified in draft-deconinck-multipath-quic [10]. Since each MPQUIC uniflow is
transmitted on a specific QoS flow, this means that MPQUIC-LL supports round-
trip measurements per QoS flow and packet loss measurements per QoS flow.
e. Applies the ATSSS rules, the QoS rules and the N4 rules defined in Rel-16
without any modifications.
### 6.6.2 MA PDU Session Establishment procedure
Figure 6.6.2-1: MA PDU Session establishment using MPQUIC-LL
The above Figure 6.6.2-1 shows how an MA PDU Session is established when (a)
the UE indicates support for MPQUIC-LL and (b) the network accepts to apply
MPQUIC-LL for one or more traffic flows. All steps are the same as the steps
used to establish an MA PDU Session in Rel-16 specifications. The additions to
support MPQUIC-LL are further discussed below.
1a. In the PDU Session Establishment Request the UE indicates (in the 5GSM
capability) that it supports the MPQUIC-LL steering functionality and,
possibly, other steering functionalities such as MPTCP and ATSSS-LL.
1b. The AMF selects an SMF supporting ATSSS. It is assumed that, if the
network supports MPQUIC-LL, then all SMFs supporting ATSSS can also support
QUIC-LL.
5a. In the SM Policy Control Create Request, the SMF includes the ATSSS
Capabilities of the UE (see TS 23.502 [4] and TS 29.512 [21]), which contain
the MPQUIC-LL capability and, possibly, other capabilities already defined,
such as \"MPTCP functionality with any steering mode and ATSSS-LL
functionality with any steering mode\", etc.
5b. The PCF decides to allow the requested MA PDU Session and creates PCC
rules containing MA PDU Session Control information (see TS 29.512 [21]),
which specifies a steering functionality (e.g. MPQUIC-LL, ATSSS-LL), a
steering mode (e.g. Active/Standby), etc.
6a. Based on the received PCC rules, the SMF creates N4 rules for the UPF
including MAR rules for MPQUIC-LL.
6b. In the N4 Session Establishment Request, the SMF includes the N4 rules and
indicates to UPF that MPQUIC-LL Control Information should be provided (see
next step). The MPQUIC-LL Control Information indicates to UPF how many MPQUIC
connections are needed, which is determined from the received PCC rules. For
example, if the SMF received two PCC rules containing steering functionality =
MPQUIC-LL, then the SMF indicates to UPF that two MPQUIC connections are
needed.
6c. Based on the requested MPQUIC-LL Control Information, the UPF provides the
following MPQUIC-LL parameters:
1) Two \"UE link-specific MPQUIC-LL\" IP addresses used only by the MPQUIC-LL
functionality in the UE, one associated with the 3GPP access and another
associated with the non-3GPP access. It is possible that the UPF provides \"UE
link-specific MPQUIC-LL\" IP addresses that are not routable via N6 (e.g. IPv6
link-local addresses). For example, the \"UE link-specific MPQUIC-LL\" IP
addresses may be the following:
UE link-specific MPQUIC-LL IP address over 3GPP access = 10.10.1.1
UE link-specific MPQUIC-LL IP address over non-3GPP access = 10.10.2.1
NOTE 1: The \"UE link-specific MPQUIC-LL\" IP addresses are similar to the
\"UE link-specific multipath\" IP addresses used for MPTCP, specified in TS
23.502 [4] and TS 29.244 [22].
NOTE 2: In case MPQUIC-LL and MPTCP are enabled for the same MA PDU Session,
the \"UE link-specific MPQUIC-LL\" IP addresses and the \"UE link-specific
multipath\" IP addresses can be the same.
2) \"MPQUIC Address Information\" which contains (1) two \"UPF link-specific
MPQUIC-LL\" IP addresses for the UPF, one for each access and (2) one UPF port
number per MPQUIC connection.
7\. Based on the received PCC rules and the MPQUIC-LL parameters received from
UPF, the SMF creates the following information, which will be sent to the UE:
\- ATSSS rules;
\- QoS rules; and
\- \"MPQUIC Connection Setup Information\" which contains information for the
UE to setup the MPQUIC connections with the UPF. For example, it indicates
that MPQUIC Connection #1 over 3GPP access should be established toward the
UPF IP address 10.10.1.2 and UPF port 53671.
8a. In the PDU Session Establishment Accept, the ATSSS Container (defined in
TS 24.193 [23]) contains:
1) The ATSSS rules, which are applied by MQTC in the UE to route the traffic
of the MA PDU Session across the QUIC connections; and
2) The \"network steering functionalities information\" (see TS 24.193 [23]),
which contains:
a. The two \"UE link-specific MPQUIC-LL\" IP addresses provided by UPF in step
6c; and
b. The \"MPQUIC Connection Setup information\" created by SMF in step 7.
11\. Based on the received \"MPQUIC Connection Setup information\" the MQTC in
the UE establishes one or more MPQUIC connections with the MQTS in the UPF.
The UE establishes the MPQUIC connections immediately after receiving the PDU
Session Establishment Accept message. The application protocol negotiated
during each MPQUIC connection will be decided by stage-3 (for example, it
could be \"mpquic-ll\").
NOTE 3: Each MPQUIC connection requires the negotiation of an application
protocol and it applies the Application Layer Protocol Negotiation (ALPN) to
select the application protocol (see draft-ietf-quic-tls [18]).
The MPQUIC connections established between the MQTC in UE and the MQTS in UPF
include also MPQUIC connections associated with downlink-only QoS flows. This
is achieved by sending \"MPQUIC connection setup information\" to UE that
includes information for establishing a MPQUIC connection associated with a
downlink-only QoS flow. The UE does not send uplink PDUs to a MPQUIC
connection associated with a downlink-only QoS flow, because the UE has no
associated QoS rule for this MPQUIC connection. However, the UE sends QUIC
packets (e.g. PING, ACK, etc.) over this MPQUIC connection based on the normal
MPQUIC protocol operation.
How MPQUIC-LL can support reflective QoS is specified in clause 6.6.4.
### 6.6.3 MA PDU Session Modification procedure
The MA PDU Session Modification procedure (either network-requested or UE-
requested) may be used to add or remove QoS flows from an established MA PDU
Session, as already specified in Rel-16.
After the MA PDU Session Modification procedure is completed, then:
\- If a QoS flow is deleted and this QoS flow was used to transfer MPQUIC-LL
traffic, then the MPQUIC connection associated with this QoS flow (one QUIC
connection per access) is released. The UE receives updated \"MPQUIC
Connection Setup Information\" in order to determine which MPQUIC connection
to release.
\- If a QoS flow is created and this QoS flow will be used to transfer MPQUIC-
LL traffic, then the MPQUIC connection associated with this QoS flow (one QUIC
connection per access) is established between the UE and UPF. The UE receives
updated \"MPQUIC Connection Setup Information\" in order to determine the UPF
IP addresses and ports for the new MPQUIC connections.
### 6.6.4 Example of MPQUIC-LL Operation
To better explain the MPQUIC-LL operation, we consider an example in this
clause. In this example, it is assumed that the PCF creates two PCC rules
which contain steering functionality = MPQUIC-LL (see Table 6.6.4-1 below) and
the UPF provides the following MPQUIC-LL parameters:
1) \"UE Link-specific MPQUIC-LL\" IP addresses:
UE Link-specific MPQUIC-LL IP address over 3GPP access = 10.10.1.1
UE Link-specific MPQUIC-LL IP address over non-3GPP access = 10.10.2.1
2) MPQUIC-LL Address Information:
UPF Link-specific MPQUIC-LL IP address for 3GPP access = 10.10.1.2
UPF Link-specific MPQUIC-LL IP address for non-3GPP access = 10.10.2.2
UPF Port for MPQUIC Connection #1 = 53671.
UPF Port for MPQUIC Connection #2 = 53672.
Based on the above MPQUIC-LL Address Information, the SMF creates the
following \"MPQUIC Connection Setup information\", which is sent to UE.
\- MPQUIC Connection #1:
\- UPF Link-specific QUIC-LL IP address for 3GPP access: 10.10.1.2
\- UPF Link-specific QUIC-LL IP address for non-3GPP access: 10.10.2.2
\- UPF Port: 53671.
\- Associated QFI: QFI-x.
\- Associated Steering Mode: Active/Standby.
\- MPQUIC Connection #2:
\- UPF Link-specific QUIC-LL IP address for 3GPP access: 10.10.1.2
\- UPF Link-specific QUIC-LL IP address for non-3GPP access: 10.10.2.2
\- UPF port: 53672.
\- Associated QFI: QFI-y.
\- Associated Steering Mode: Smallest Delay.
The UE applies the received \"UE link-specific MPQUIC-LL\" IP addresses and
the \"MPQUIC Connection Setup information\" and establishes two MPQUIC
connections with the UPF over both 3GPP access and non-3GPP access, as shown
below.
Figure 6.6.4-1
After the two MPQUIC connections are established between the UE and the UPF,
the MPQUIC-LL routes the PDUs received from the upper layers to one of the
unidirectional flows of a MPQUIC connection, as illustrated in Figure 6.6.3-2
below.
First, the QoS rules are applied on a received PDU (e.g. IP packet or Ethernet
frame) to determine a QFI for this PDU. Subsequently, the MQTC finds a
matching ATSSS rule for the PDU based on which it identifies the steering mode
that should be applied for this PDU. Finally, the MQTC selects a MPQUIC
connection for the PDU based on the selected QFI and the steering mode. For
each MPQUIC Connection, the MQTC maintains an associated steering mode and QFI
according on the received \"MPQUIC Connection Setup information\". Finally,
the PDU is encapsulated in a QUIC DATAGRAM frame (possibly with more PDUs) and
is added to a QUIC/UDP/IP packet destined to [UPF Link-specific QUIC-LL IP
address = 10.10.1.2, UPF Port = 53671].
NOTE 1: The QFI selected for a PDU is transferred down to the selected access
(3GPP or non-3GPP) so that the selected access can transfer the PDU via the
corresponding QoS flow. For a packet created by the MPQUIC protocol itself
(e.g. a PING frame), the QFI delivered to the access is the QFI associated
with the MPQUIC connection over which this packet is transmitted.
NOTE 2: The header compression performed by the MQUIC Tunnel Client and the
MQUIC Tunnel Server (see clause 6.6.1) is not shown in the following two
figures for simplicity.
As shown in Figure 6.6.4-3, the UPF appends an 1-bit header to each DL packet
indicating whether this DL packet should trigger reflective QoS procedures in
the UE. This 1-bit header enables many different DL packets to be multiplexed
in the same QUIC packet (according to the normal QUIC protocol operation) and
yet enable the UE to determine which of these DL packets should trigger
reflective QoS procedures.
Figure 6.6.4-2: Example of user-plane operation with MPQUIC-LL(UL direction)
Figure 6.6.4-3: Example of user-plane operation with MPQUIC-LL (DL direction)
### 6.6.5 Support of Steering Modes
The MPQUIC-LL supports all the steering modes defined in Rel-16. In addition,
the MPQUIC-LL may support additional steering modes defined in other clauses
of this technical report.
### 6.6.6 Impacts on services, entities, interfaces and IETF protocols
The MPQUIC-LL solution does not impact the structure of the ATSSS rules, the
QoS rules and the N4 rules, which remain the same and they are applied as in
Rel-16. However, the ATSSS rules and the N4 rules are enhanced to support
values for the MPQUIC-LL steering functionality and for potentially new
steering modes. The UE and the UPF receive information (see the \"MPQUIC
Connection Setup information\") which indicates how many MPQUIC connections
should be established between the UE and the UPF, and the QoS flow and
steering mode associated with each MPQUIC connection.
IETF protocols:
\- The MPQUIC-LL solution is based on the following QUIC draft specifications
defined by IETF. The MPQUIC-LL does not require any changes to these
specifications.
\- draft-ietf-quic-transport [6].
\- draft-ietf-quic-recovery [7].
\- draft-ietf-quic-tls [18].
\- draft-ietf-quic-datagram [8].
\- draft-deconinck-quic-multipath [10] or another specification created by
IETF for supporting multipath QUIC.
\- If there is need to support MPQUIC using NULL encryption between UE and
UPF, this need should be communicated to IETF and either addressed by IETF or
addressed by 3GPP, e.g. by specifying a \"3GPP 5G profile for (MP)QUIC\" which
can support different cipher suites than those defined by IETF, including
cipher suites using NULL encryption. This aspect should be further
investigated by SA WG3.
AMF:
\- No impact. It is assumed that if 5GC supports ATSSS / Rel-17, then all
ATSSS-capable SMFs in 5GC are capable of supporting MPQUIC-LL.
SMF:
\- From the PCC rules, it shall determine the number of MPQUIC connections
needed.
\- Shall indicate to UPF the number of MPQUIC connections needed.
\- Shall create and send to UE the \"MPQUIC Connection Setup Information\"
based on the MPQUIC-LL Address Information received from UPF.
\- From the received PCC rules, it shall create corresponding ATSSS rules and
QoS rules for the UE.
\- From the received PCC rules, it shall create corresponding N4 rules (PDRs,
MAR, QER, etc.) for the UPF.
PCF:
\- Shall be able to create PCC rules using the MPQUIC-LL steering
functionality.
UPF:
\- Shall be able to allocate the \"UE Link-specific MPQUIC-LL\" IP addresses.
\- Shall be able to allocate MPQUIC-LL Address Information, i.e. two IP
addresses used for MPQUIC-LL (one per access) and one UDP port number for each
MPQUIC connection.
\- Shall apply the N4 rules (e.g. PDRs and associated MARs) to select a MPQUIC
connection and an access (uniflow) on this connection, for each DL PDU. Each
MAR using the MPQUIC-LL steering functionality shall identify a MPQUIC
Connection.
\- Shall select a MPQUIC connection for an DL PDU based on the steering mode
and QoS flow selected with this PDU.
\- Shall be able to support the QUIC protocol with multipath extensions.
\- Shall apply the QoS Enforcement Rules (QERs) to map the traffic of each
MPQUIC connection to a QoS flow.
UE:
\- Shall be able to indicate support of MPQUIC-LL when requesting a MA PDU
Session.
\- Shall establish _N_ MPQUIC connections to UPF via each access, based on the
received \"MPQUIC Connection Setup Information\".
\- Shall apply the ATSSS rules to select a steering mode for each UL PDU.
\- Shall select a MPQUIC connection for an UL PDU based on the steering mode
and QoS flow selected with this PDU.
\- Shall be able to support the QUIC protocol with multipath extensions.
\- Shall apply the QoS rules to map the traffic of a SDF to a QoS flow.
## 6.7 Solution #7: Proposed solution based on MP-QUIC
### 6.7.1 Introduction {#introduction-7}
This solution addresses KI#2 on Additional Steering Functionalities.
The ATSSS feature is to enable UE simultaneously connecting to the 3GPP access
and non-3GPP access. Then the traffic can take advantage of both accesses
resource to raise the bandwidth or/and access reliability. In release-16, for
UDP traffic, it can only be supported by the ATSSS-LL functionality, thus an
IP packet flow cannot be split over both accesses, so actually the increase of
bandwidth requirement is not achieved. This solution is proposed to introduce
a new steering method based on MP-QUIC to resolve this issue, referring to the
KI#2 on additional steering methods.
This solution applies to UDP based application traffic only, with IP-based MA
PDU Sessions (IPv4, IPv6, IPv4v6).
### 6.7.2 High-level Description
The solution is applicable to the UDP (without QUIC) based applications.
The MP-QUIC protocol is being drafted in IETF draft-deconinck-quic-
multipath-04 [10]: \" Multipath Extensions for QUIC (MP-QUIC)\". It is
designed to support the multipath scenario, and except the QUIC connection ID,
a Uniflow ID is defined for the MP-QUIC connection. When an uniflow is in use,
each end host associates it with a network path. Each uniflow is an
independent flow of packets over a given network path, it can experience very
different network conditions (latency, packet loss rate, etc.). To handle
this, each uniflow has its own packet sequence number space. When the MP-QUIC
protocol is applied in 5G system, especially in the ATSSS architecture, the
3GPP and non-3GPP accesses are the different paths, and the different uniflows
are bound to the different paths. With this uniflow, the MP-QUIC functionality
can perform the congestion control on each path and support the traffic
splitting per packet as MPTCP. Therefore, it is proposed to define the MP-QUIC
functionality to be supported by the UE and UPF, see the following figure
6.7.2-1 for the model on the UE side. The UDP fragmentation can be avoided by
restricting the maximum QUIC packet size.
NOTE 1: ECN can be supported. For transparent proxy mode, the IP/UDP headers
of the original packet are transported between UE and UPF without any change.
For non-transparent proxy mode, all the IP/UDP headers of the original packet
are transported unchanged except the source IP address and port for downlink
packet and destination IP address and port for uplink packet.
-
Figure 6.7.2-1: Steering functionality of MP-QUIC in the UE
This MP-QUIC functionality can be applied to steer, switch and split the UDP
traffic of applications allowed to use MP-QUIC. The MP-QUIC functionality in
the UE communicates with an associated MP-QUIC Proxy functionality in the UPF,
by using the MP-QUIC protocol over the 3GPP and/or the non-3GPP user plane.
MP-QUIC functionality can support any steering modes as defined in Rel-16.
NOTE 2: If the application applies MP-QUIC with the server, there is no need
to enable the MP-QUIC functionality between the UE and UPF. If the application
applies QUIC with the server, the solution #8 as described in clause 6.8.2 is
applied.
The MP-QUIC connection is established between the UE and the UPF per IP flow
as defined in clauses 6.7.2.1 and 6.7.2.2a, or per PDU Session as defined in
clause 6.7.2.2b.
The application data encapsulation description is as defined in clause 6.8.2,
similar as QUIC functionality. One or more MP-QUIC connections between the UE
and the UPF may be established based on information received in the procedure
described in clause 6.7.3. These MP-QUIC connections can be encrypted or NULL
encrypted. The NULL encrypted solution is similar as solution #8, referring to
the description in clause 6.8.2.
NOTE 3: The Protocol stack in the UPF towards the server is based on UDP
protocol, i.e. the application data is encapsulated with UDP header.
Similar as MPTCP functionality, the MP-QUIC proxy functionality is deployed in
the UPF, and the UPF can be transparent MP-QUIC proxy, or non-transparent MP-
QUIC proxy.
For both transparent and non-transparent MP-QUIC proxy, the UPF allocates the
link-specific IP addresses to the UE, and these link-specific IP addresses may
be the same or different with link-specific IP addresses for MPTCP. The UPF
can detect the MP-QUIC traffic based on the UE link-specific IP address and
forward it to the MP-QUIC functionality. The MP-QUIC proxy terminates an MP-
QUIC connection with UE and apply regular UDP transport to the remote host.
The transparent MP-QUIC proxy and non-transparent MP-QUIC proxy solutions are
described separately in clauses 6.7.2.1 and 6.7.2.2.
NOTE 4: In the case of transparent MP-QUIC proxy, the packet from the UE is
encapsulated with the destination IP address of the remote server.
#### 6.7.2.1 Transparent MP-QUIC proxy solution
The UE and UPF establish the MP-QUIC connection per IP flow, and the UPF
applies regular UDP to the remote host. The MP-QUIC packet is received in the
MP-QUIC connection, the UPF removes the MP-QUIC header and then forwards it to
the remote host by using UDP. The MP-QUIC establishment procedure via user
plane is defined in IETF draft-deconinck-quic-multipath: \"Multipath
Extensions for QUIC (MP-QUIC)\".
The UP protocol stack for transparent MP-QUIC solution is shown below, taking
untrusted non-3GPP access as an example. (The \"Application payload\" in the
protocol stack represents the application layer traffic carried on top of UDP,
i.e. it does not include the UDP/IP headers):
Figure 6.7.2.1-1: UP Protocol stack for transparent proxy
The transparent MP-QUIC solution has no impact on the QoS control.
#### 6.7.2.2a Non-Transparent QUIC proxy solution
In the case of non-transparent MP-QUIC proxy, similar with MPTCP solution
defined in Rel-16, the network sends the MP-QUIC proxy information to the UE,
i.e. the MP-QUIC functionality IP address, and port number. The UE uses this
MP-QUIC IP address as the destination IP address to encapsulate the user
packets. The following IETF protocol is needed in this non-transparent MP-QUIC
solution, e.g. to transport the IP address of the remote server to the UPF,
and details refer to Solution 8 as described in clause 6.8.2.2:
\- IETF draft-ietf-masque-connect-udp: \"The CONNECT-UDP HTTP Method\".
The protocol stack for non-transparent MP-QUIC solution is shown in Figure
6.7.2.2-1, taking untrusted non-3GPP access as an example.
Figure 6.7.2.2-1: UP Protocol stack for non-transparent proxy
The UE instructs the proxy to forward the traffic to the target server,
similar as described in clause 6.8.2 of solution #8. For the QoS control,
there is no impact on the transparent QUIC solution. For the non-transparent
QUIC solution, similar mechanism is applied as defined in Rel-16 for MPTCP,
i.e. both the QoS rule and N4 rules are provided for the original IP packets.
#### 6.7.2.2b MP-QUIC connection per PDU Session
The MP-QUIC connection can be established between the UE and the UPF per PDU
Session. When the network decides to activate the MP-QUIC based functionality
for an MA PDU Session, the network shall provide the following \"MP-QUIC
connection setup information\" to the UE in the PDU Session establishment
procedure.
a. two UE IP addresses/prefixes called \"link-specific multipath QUIC\"
addresses (one for each access); and
b. the UPF IP address(es) and port(s), where the MP-QUIC connections are to be
setup.
After the UE receives the \"MP-QUIC connection setup information\", the UE
initiates the establishment of MP-QUIC connection via MP-QUIC based
functionality in user plane between the UE and the UPF. This MP-QUIC
connection is applied to encapsulate the application data (i.e. UDP payload)
as defined in Solution 7/14, or to encapsulate the IP/UDP packet (i.e. MP-QUIC
connection is treated as tunnel) as defined in Solution 6.
The MP-QUIC based functionality defined in Solution 7/14/6 can be reused to
establish the MP-QUIC connection. But this MP-QUIC Connection is shared by all
the IP flows which is allowed to apply MP-QUIC based steering functionality in
this MA PDU Session. Especially, if the different IP flows are in the same QoS
flow and applies the same RQI, these IP packets may also be encapsulated in
the same MP-QUIC packet, i.e. multiplex per packet. If these IP flows belong
to different QoS flows or have different RQIs, these IP packets cannot be
encapsulated in the same MP-QUIC packet.
NOTE: As described in the IETF QUIC protocol, if the different IP packets are
bundled into a single QUIC packet, loss of that packet blocks all the IP flows
from making progress. Therefore, it is advised to bundle as few different IP
packets as necessary in outgoing QUIC packets without losing
transmission/forwarding efficiency to underfilled packets. This is the same
for MP-QUIC. Additionally, multiplex per MP-QUIC packet will also impact the
forwarding efficiency, e.g. assembling/disassembling the inner different IP
packets will reduce the UPF processing efficiency.
Apart from the above differences, MP-QUIC connection per PDU Session has the
following improvements compared with Solution 6 and Solution 14.
\- Datagram-Flow-Id is applied to identify the IP flow in this single MP-QUIC
connection, so there is no need to define the Global Datagram-Flow-Id across
different MP-QUIC connections when the UL and DL IP flows are transported via
different MP-QUIC connections as required by Solution 14.
\- The MP-QUIC connection per PDU Session can also be applied to transport the
traffic via the DL-only QoS flow, so there is no need to create specific UL
QoS rule for uplink messages/packet such as PING, ACK frames for the DL-only
QoS flow as required by Solution 6 and Solution 14.
### 6.7.3 Procedures
The signalling flow for a MA PDU Session establishment when the UE is not
roaming, or when the UE is roaming and the PDU Session Anchor (PSA) is located
in the VPLMN, is described as below. The flow relates to the case of non-
transparent proxy.
Figure 6.7.3-1: MP-QUIC based MA PDU Session establishment procedure
\- In step 1, the UE provides a \"MA PDU Request\" indication in UL NAS
Transport message and an ATSSS Capability indicating support of \"MP-QUIC
Capability\" in PDU Session Establishment Request message.
\- In step 2, if the AMF supports MA PDU sessions, then the AMF selects an
SMF, which supports MA PDU sessions, and forwards the MA PDU Session
Establishment Request to the SMF.
\- In step 3, if the MA PDU session is allowed and dynamic PCC is to be used
for the MA PDU Session, the SMF sends an \"MA PDU Request\" indication and the
ATSSS Capability of MA PDU Session to the PCF in the SM Policy Control Create
message. The ATSSS Capability indicates the MP-QUIC functionality.
The PCF provides ATSSS policy if the MA PDU session is allowed. The PCF
provides PCC rules for the MA PDU session, i.e. PCC rules that include ATSSS
policy control information, which includes the MP-QUIC functionality
indication. Additionally, the PCC rules may also indicate on whether the
encryption of the MP-QUIC connection is needed or not based on operator policy
and subscription data or access type for this MA PDU session.
\- In step 4, the SMF establishes the user-plane resources over the 3GPP
access and/or non-3GPP.
\- the N4 rules derived by SMF for the MA PDU session are sent to UPF and one
or two N3 UL CN tunnels info may be allocated by the UPF. If the ATSSS
functionality for the MA PDU Session indicates \"MP-QUIC functionality\", the
SMF includes MP-QUIC functionality indication into the N4 rule to instruct the
UPF to activate the MP-QUIC functionality for the traffic. If the MP-QUIC
connection needs encryption or NULL encryption, the SMF also indicates it to
the UPF.
\- In step 5, the UPF allocates the UE \"link-specific multipath\"
addresses/prefixes and MP-QUIC functionality information if the non-
transparent MP-QUIC functionality is applied for this MA PDU session in the
UPF. The UPF sends the \"link-specific multipath\" addresses/prefixes and MP-
QUIC functionality information to the SMF. The MP-QUIC functionality
information includes the MP-QUIC functionality IP address and UDP port number,
uniflow ID with corresponding access type and the MP-QUIC connection ID.
\- In step 6, for the MA PDU session, the SMF includes an \"MA PDU session
Accepted\" indication and PDU Session Establishment Accept message which
includes ATSSS rules for MA PDU Session, the \"link-specific multipath\"
addresses/prefixes and the MP-QUIC functionality information in the
Namf_Communication_N1N2MessageTransfer message to the AMF and the AMF marks
this PDU session as MA PDU session based on the received \"MA PDU session
Accepted\" indication, same as defined in Rel-16 specifications.
\- In step 8, the UE receives a PDU Session Establishment Accept message,
which indicates to the UE that the requested MA PDU session was successfully
established. This message includes the ATSSS rules for the MA PDU Session, the
\"link-specific multipath\" addresses/prefixes and the MP-QUIC functionality
indication and encryption or NULL encryption indication for the traffic.
\- After step 8 in Figure 6.7.3-1, if the SMF was informed in step 2 that the
UE is registered over both accesses, then the SMF initiates the establishment
of user-plane resources over non-3GPP access too as specified in TS 23.502 [4]
clause 4.22.2.1.
The last step above is not executed when the UE is registered over one access
only, in which case the MA PDU Session is established with user-plane
resources over one access only. How user-plane resources can be added over an
access of the MA PDU Session is specified in TS 23.502 [4] clause 4.22.7.
### 6.7.4 Impacts on services, entities, interfaces and IETF protocols
#### 6.7.4.1 Transparent MP-QUIC proxy solution
This solution will impact the following entities in 5GS:
\- SMF: Supports to select the UPF based on its MP-QUIC capability.
\- PCF: Supports to authorize MP-QUIC functionality steering method for the
SDF.
\- UPF: Supports the MP-QUIC proxy functionality, and establishes the MP-QUIC
connection with the UE. Adds/removes the MP-QUIC header before forwarding the
packet to the UE or the remote server over N6 interface.
\- UE: Supports the MP-QUIC functionality, and establishes the MP-QUIC
connection with the UPF per IP flow. To be more specific, for uplink traffic,
the UE obtains the application data (i.e. UDP payload) and put it into the
QUIC datagram if unreliable QUIC transport is applied, and encapsulated with
QUIC header. The QUIC packet is then encapsulated with an original IP/ UDP
header. For downlink traffic, the UE decapsulates the received MP-QUIC packet
and retrieves the MP-QUIC payload (application data) and delivers it to the
application.
\- 5G-AN/ NG RAN: No impact.
This solution needs to enhance the existing SM NAS protocol, N5 and N4
interfaces, Npcf service to support this MP-QUIC based steering functionality.
This solution has dependency on the following IETF drafts, apart from the IETF
drafts described in solution 8 in clause 6.8.4.1:
\- IETF draft-deconinck-quic-multipath: \"Multipath Extensions for QUIC (MP-
QUIC)\".
This solution may have additional impact on IETF:
\- As the current MP-QUIC connection defined by IETF shall be encrypted based
on the TLS 1.3, the NULL encryption MP-QUIC connection requires IETF support.
#### 6.7.4.2 Non-transparent MP-QUIC proxy solution
Besides the impact listed above in clause 6.7.4.1, there are some additional
impacts on the UE and UPF to support the non-transparent MP-QUIC proxy
solution.
\- UPF: Supports the MASQUE protocol, i.e. handles the HTTP message to obtain
the remote Server IP address and UDP port number per IP flow. The target
IP/UDP header will be replaced by the remote Server IP address and UDP port
number for the UL. For the DL, the source IP address and UDP port are replaced
by the ones of the MP-QUIC proxy in the UPF.
\- UE: Supports the MASQUE protocol, i.e. creates the HTTP message and sends
the remote Server IP address and UDP port number to the UPF.
This solution has additional dependency on an IETF draft, apart from those
listed in clause 6.7.4.1:
\- IETF draft-ietf-masque-connect-udp [19]: \"The CONNECT-UDP HTTP Method\".
## 6.8 Solution #8: Proposed solution based on QUIC
### 6.8.1 Introduction {#introduction-8}
This solution addresses KI#2 on Additional Steering Functionalities.
This solution allows transport of the IP/UDP based application traffic by
using QUIC protocol via multiple paths. It addresses two cases:
1) the QUIC functionality is supported by the UE, and with the QUIC proxy
functionality enabled in the UPF, the QUIC connection can be established
between the UE and UPF;
2) the QUIC functionality is implemented by the application layer between the
UE and the application server.
As the QUIC connection cannot detect multiple paths, the Rel-16 ATSSS-LL,
which supports four steering modes, Priority-based mode, Load-balancing mode,
Smallest Delay mode and Active-standby mode, is still needed to perform
traffic steering, switching, and splitting, Therefore, this solution proposes
to apply a combination of QUIC functionality and ATSSS-LL functionality as a
new steering method enabling UDP flows to use multiple paths, addressing the
KI#8 on additional steering methods.
### 6.8.2 High-level Description
The QUIC functionality in the UE applies the QUIC protocol defined by IETF
draft-ietf-quic-transport-27: \"QUIC: A UDP-Based Multiplexed and Secure
Transport\". Additionally, the unreliable packet transported is also applied,
the QUIC extensions are defined in draft-ietf-quic-datagram: \"An Unreliable
Datagram Extension to QUIC\". It may be implemented by the operating system or
by the application layer. This QUIC functionality in the UE will communicate
with the QUIC Proxy functionality in the UPF or QUIC functionality in the
remote server. The solution details for each case are described as below.
**QUIC connection between the UE and the UPF:**
The QUIC connection is established between the UE and the UPF per IP flow.
This case is applicable to the UDP (without QUIC) based applications.
The QUIC functionality in the UE obtain the application data (i.e. UDP
payload) and put it into QUIC datagram as unreliable QUIC transport is
applied. Then after the QUIC header is added, the QUIC packet is encapsulated
with a UDP header. The UDP fragmentation can be avoided by restricting the
maximum QUIC packet size.
NOTE 1: ECN can be supported. For transparent proxy mode, the IP/UDP headers
of the original packet are transported between UE and UPF without any change.
For non-transparent proxy mode, all the IP/UDP headers of the original packet
are transported unchanged except the source IP address and port for downlink
packet and destination IP address and port for uplink packet.
The following Figure 6.8.2.-1 shows the QUIC functionality in the UE model and
its relationship with the other functionalities.
Figure 6.8.2-1: QUIC Functionality in the UE
As shown in the above Figure 6.8.2-1, the application data is encapsulated by
the QUIC functionality and then transported to the ATSSS-LL functionality. The
ATSSS-LL functionality decides on the path for transport of the QUIC packet
based on the link performance measurement of PMF. But different from the
Rel-16 ATSSS solution, in which the ATSSS-LL could only split a SDF per
traffic on both accesses, the ATSSS-LL functionality can split a traffic per
packet on both accesses with combination of QUIC functionality, to take
advantage of both access resource to raise bandwidth, since the QUIC
functionality supports the packet reordering with the sequence number included
in the QUIC header. Especially, compared with TCP, the QUIC ACK frame contains
one or more ACK ranges. Each ACK range could identify acknowledged packets and
also contain additional ranges of packets which are alternately not
acknowledged (Gap). With such enhancement, the QUIC protocol can solve the
packet disordering issue received from lower layer, e.g. ATSSS-LL.
The traffic steering, switching or splitting is performed by the ATSSS-LL
functionality, so there is no need to allocate the link-specific IP address
for the UE as MPTCP functionality. Therefore, only one UE IP address of the MA
PDU session is applied.
NOTE 2: The QUIC congestion control mechanism can be able to handle the
packets in a single QUIC Connection transported via different paths, which can
be different in packet delay, jitter, loss ratio etc, since this is the normal
case over the Internet. For example, the different packets transported over
the internet between the Client and the Server may be routed via different
intermediate nodes. This is similar for this QUIC based solution for ATSSS
where the packets go via different paths, i.e. 3GPP and non 3GPP accesses,
between the UE and the UPF.
NOTE 3: When the path performance, e.g. the RTT, is quite different over 3GPP
and non 3GPP accesses, the convergent bandwidth if applying packet splitting
via two paths may not be higher than packet transport via only single path
with higher performance, due to the impact of packet delay over the poor
quality path, no matter which splitting method is applied, including MPTCP.
This can be alleviated by implementation in the UE and the UPF or by enforcing
some specific steering modes, to avoid packet splitting in case there is a big
difference of the performance, e.g. RTT, between the two accesses.
NOTE 4: QUIC loss detection and congestion control as defined in IETF:
\"draft-ietf-quic-recovery\" and ATSSS-LL with ePMF can work together to
achieve the similar congestion control as MP-QUIC as defined in the MP-QUIC
draft, i.e. QUIC performs the packet reordering and controls the sending
window, and ATSSS-LL takes responsibility to select the access/path based on
the link status reported by ePMF for each access. The upper QUIC protocol sees
one link over two paths, and a single buffer memory is shared by both paths to
perform packet reordering. If a packet is lost over one path/access (e.g. 3GPP
access, due to congestion), the QUIC congestion controller will limit the
overall transmission rate, whatever there is congestion or not over the other
path. Actually, it is the same for MPTCP and MP-QUIC to couple the two paths
for congestion control, as described in the MPQUIC draft: \"_the windows of
the different sending uniflows MUST be coupled together [RFC6356]_ \". The RFC
6356 defines \"Coupled Congestion Control for Multipath Transport Protocols\".
The QUIC proxy functionality is enabled in the UPF, and it can be transparent
QUIC proxy, or non-transparent QUIC proxy. For both transparent and non-
transparent solutions, the UE needs to enable the QUIC stack in the data path
based on the QUIC steering method indication from SMF. The difference is that
for transparent QUIC proxy, the traffic packets transported in the QUIC
connection are encapsulated with the remote Server IP address, while for non-
transparent QUIC proxy, the traffic packets transported in the QUIC connection
are encapsulated with the QUIC proxy IP address. The transparent QUIC proxy
and non-transparent QUIC proxy solutions are described separately in clauses
6.8.2.1 and 6.8.2.2.
NOTE 5: If TLS 1.3 is applied, the UE will accept the credential of UPF during
QUIC connection establishment procedure for both transparent and non-
transparent QUIC proxy, as the UE knows the QUIC connection is established
between the UE and UPF.
NOTE 6: There is no need to support both transparent and non-transparent
proxy.
**QUIC connection between the UE and remote server:**
If the QUIC functionality is implemented by the application layer, between the
UE and the server (i.e. remote host), there is no need to enable the QUIC
proxy functionality in the UPF. These QUIC packets can directly be handled by
ATSSS-LL as described above when the UPF knows this is a QUIC connection. For
example, the PCF is aware that the application supports QUIC, the PCF may
allow the traffic splitting per packet for a SDF by indicating only one packet
flow in this SDF. Otherwise, it depends on the UPF to identify the QUIC packet
from the other UDP packets, e.g. based on DPI analysis. When the UPF
identifies the QUIC packets, the traffic switching or splitting per packet
based on the steering mode and link performance measurement of PMF can be
performed by the ATSSS-LL functionality. The PCF can be aware of the
application transport protocol, i.e. QUIC protocol, based on the local policy
or the protocol from AF, similar as the protocol from AF to PCRF as defined in
TS 29.214 [24] clause 5.3.8.
#### 6.8.2.1 Transparent QUIC proxy solution
The UE and UPF establish the QUIC connection, and the UPF apply regular UDP to
the remote host. The packet from the UE is encapsulated with the destination
IP address of the remote server. The QUIC packet is received in the QUIC
connection. The UPF removes the QUIC header and then forward it to the remote
host by using UDP.
One or more QUIC connections per IP flow may be established between the UE and
the UPF. These QUIC connections can be encrypted or be NULL encryption. The
following two possible solutions can be considered to support the NULL
encryption QUIC connection, which needs further to be studied in SA3.
\- Solution 1: TLS 1.3 can be extended to support the NULL encryption
algorithm.
\- Solution 2: The TLS layer is taken as optional for QUIC protocol, as the
TLS authentication and encryption can be skipped when it is applied between
the UE and UPF.
If the radio level security is enabled, it is proposed to use the NULL
encrypted QUIC connection.
Regarding the QUIC connection establishment procedure, the version
information, transport parameters of the QUIC protocol applied by the QUIC
proxy can be sent to UE in QUIC connection establishment procedure via user
plane, as defined in IETF draft-ietf-quic-transport [6]. Alternatively, the
QUIC functionality information , including security information (e.g. Pre-
Shared Key as defined by IETF TLS 1.3) if QUIC connection is encrypted, the
QUIC version information and transport parameters as defined in the IETF QUIC
protocol, etc, can also be sent to UE via NAS message during MA PDU
establishment procedure as described in clause 6.8.3, in order to achieve
0-RTT QUIC connection establishment. In the QUIC proxy side, it will identify
the QUIC traffic based on the packet filter and QUIC method indication from
SMF via N4 rule and forward these packets to the target server after removing
QUIC header.
For the QoS control, there is no impact on the transparent QUIC solution as
the QUIC packet IP/UDP header is the original IP/UDP header.
The UP protocol stack for transparent solution is defined in Figure 6.8.1-1,
taking untrusted non 3GPP access as an example:
Figure 6.8.1-1: UP Protocol stack for transparent proxy
NOTE 7: The Protocol stack in the UPF towards the server is based on UDP
protocol, i.e. the application data is encapsulated with UDP header.
Figure 6.8.2.1-2: Example of User-Plane operation (uplink direction, UDP based
application/PDU)
In the above Figure 6.8.2.1-2, there is no order restriction between the
operation (3) and (4), as the QoS rule is access agnostic based on Rel-16
definition. For example, the operation (4) may be processed before the
operation (3), depending on UE implementation.
#### 6.8.2.2 Non-Transparent QUIC proxy solution
Similar as MPTCP solution in Rel-16, the network needs to send the QUIC proxy
information to the UE, i.e. the QUIC functionality IP address and the port
number. The UE will use this QUIC IP address as the destination IP address to
encapsulate the user data and when receiving the uplink packet the UPF
replaces it with the remote server IP address. The following IETF protocol is
needed in this non-transparent QUIC solution to transport the IP address of
the remote server to the UPF:
\- IETF draft-ietf-masque-connect-udp: \"The CONNECT-UDP HTTP Method\". The
call follow is the same as Solution 13 as defined in clause 6.13.3.2, with the
following difference:
1) There is no need to notify the UPF about the QoS flow ID in the HTTP
message, since the QUIC connection is established for the IP flows which need
to perform traffic splitting per packet, rather than for the QoS flows.
2) Usage of Datagram-Flow-Id to identify the IP flow is optional, since the
QUIC connection is established per single IP flow and the HTTP message is also
transported with this QUIC connection.
NOTE: The SOCKSv5 protocol can also be applied to support the QUIC proxy
between the UE and UPF.
The UP protocol stack for Non-transparent solution is defined in Figure
6.8.2.2-1, taking untrusted non 3GPP access as an example:
Figure 6.8.2.2-1: UP Protocol stack for non-transparent proxy
Figure 6.8.2.2-2: Example of User-Plane operation (uplink direction, UDP based
application/PDU)
In the Figure 6.8.2.2-2, the user-plane operation is similar with the
operation defined in figure 6.8.2.1-2, with an additional IP/UDP header
replacement operation. The UE replaces the original IP address and UDP port of
the packet by using QUIC proxy IP address/UDP port received via NAS. The UPF
replaces the target IP/UDP information back to the Server IP address/UDP port
received from MASQUE, when sending the packet to the server over N6.
The QUIC connections between the UE and UPF per IP flow can be encrypted or be
NULL encrypted as described in clause 6.8.2.1.
The QUIC connection establishment procedure is the same as transparent QUIC
proxy solution as described in clause 6.8.2.1, with the addition of QUIC
functionality IP address and UDP port number included in the QUIC
functionality information. For the QoS control, similar mechanism is applied
as defined in Rel-16 MPTCP solution, i.e. both the QoS rule and N4 rules are
provided for the original IP packets instead of the QUIC packet IP/UDP header
information.
### 6.8.3 Procedure
For the first case, i.e. QUIC connection is between the UE and the UPF, the
signalling flow for a MA PDU Session establishment when the UE is not roaming,
or when the UE is roaming and the PDU Session Anchor (PSA) is located in the
VPLMN, is described as below.
Figure 6.8.3-1: QUIC based MA PDU Session establishment procedure
\- In step 1, the UE provides a \"MA PDU Request\" indication in UL NAS
Transport message and an ATSSS Capability indicating support of \"QUIC
Capability\" in PDU Session Establishment Request message.
\- In step 2, if the AMF supports MA PDU sessions, then the AMF selects an
SMF, which supports MA PDU sessions, and forwards the MA PDU Session
Establishment Request to the SMF.
\- In step 3, if the MA PDU session is allowed and dynamic PCC is to be used
for the MA PDU Session, the SMF sends an \"MA PDU Request\" indication and the
ATSSS Capability of MA PDU Session to the PCF in the SM Policy Control Create
message and. The ATSSS Capability includes the QUIC functionality.
The PCF provides ATSSS Steering policy if the MA PDU session is allowed. The
PCF provides PCC rules for the MA PDU session, i.e. PCC rules that include
ATSSS policy control information, which includes the QUIC functionality and
ATSSS-LL functionality indication if both QUIC functionality and ATSSS-LL
functionality are supported. Additionally, the PCC rules may also indicate on
whether the encryption of the QUIC connection is needed or not based on
operator policy and subscription data or access type for this MA PDU session.
\- In step 4, the SMF establishes the user-plane resources over the 3GPP
access and/or non-3GPP.
\- the N4 rules derived by SMF for the MA PDU session are sent to UPF and one
or two N3 UL CN tunnels info may be allocated by the SMF or by the UPF. If the
ATSSS functionality for the MA PDU Session indicates \"QUIC functionality and
ATSSS-LL functionality\", the SMF includes QUIC functionality and ATSSS-LL
functionality into the N4 rule to instruct the UPF to activate the QUIC
functionality and ATSSS-LL functionality for the traffic. If the QUIC
connection needs encryption or NULL encryption, the SMF also indicates it to
the UPF.
\- In step 5, the UPF allocates QUIC functionality information if the non-
transparent QUIC functionality applied for this MA PDU session in the UPF. The
UPF sends QUIC functionality information to the SMF. The QUIC functionality
information includes the QUIC functionality IP address and UDP port number.
Optionally, for both transparent and non-transparent QUIC functionality, the
QUIC functionality information may also include security information (e.g.
Pre-Shared Key as defined by IETF TLS 1.3) if QUIC connection is encrypted,
the QUIC version information and transport parameters as defined in the IETF
QUIC protocol etc.
\- In step 6, for the MA PDU session, the SMF includes an \"MA PDU session
Accepted\" indication and PDU Session Establishment Accept message which
includes ATSSS rules for MA PDU Session and the QUIC functionality information
in the Namf_Communication_N1N2MessageTransfer message to the AMF and the AMF
marks this PDU session as MA PDU session based on the received \"MA PDU
session Accepted\" indication, same as defined in Rel-16 specifications.
\- In step 8, the UE receives a PDU Session Establishment Accept message,
which indicates to the UE that the requested MA PDU session was successfully
established. This message includes the ATSSS rules for the MA PDU Session,
which includes steering mode, the QUIC functionality and ATSSS-LL
functionality indication and encryption or NULL encryption indication for the
traffic.
\- After step 8 in Figure 6.8.3-1, if the SMF was informed in step 2 that the
UE is registered over both accesses, then the SMF initiates the establishment
of user-plane resources over non-3GPP access too as specified in TS 23.502 [4]
clause 4.22.2.1.
The last step above is not executed when the UE is registered over one access
only, in which case the MA PDU Session is established with user-plane
resources over one access only. How user-plane resources can be added over an
access of the MA PDU Session is specified in TS 23.502 [4] clause 4.22.7.
For the second case, i.e. QUIC connection between the UE and remote server,
the existing procedure as specified in TS 23.502 [4] clause 4.22.2 is applied.
### 6.8.4 Impacts on services, entities, interfaces and IETF protocols
#### 6.8.4.1 Transparent QUIC proxy solution
This solution will impact the following entities in 5GS:
\- SMF: Supports to select the UPF based on its QUIC and ATSSS-LL capability.
\- PCF: Supports to authorize both QUIC functionality and ATSSS-LL
functionality steering method for the SDF.
\- UPF: Supports the QUIC proxy functionality, and establishes the QUIC
connection with the UE. Adds/removes the QUIC header before forwarding the
packet to the UE or the remote server over N6 interface.
\- UE: Supports the QUIC functionality, and establishes the QUIC connection
with the UPF per IP flow. To be more specific, for uplink traffic, the QUIC
functionality in the UE obtains the application data (i.e. UDP payload) and
put it into the QUIC datagram if unreliable QUIC transport is applied, and
encapsulated with QUIC header. The QUIC packet is then encapsulated with an
original IP/ UDP header. For downlink traffic, the UE decapsulates the
received QUIC packet and retrieves the QUIC payload (application data) and
delivers it to the application.
\- 5G-AN/ NG RAN: No impact.
This solution needs to enhance the existing SM NAS protocol, N5 and N4
interfaces, Npcf service to support this QUIC based steering functionality.
This solution has dependency on the following IETF drafts:
\- IETF draft-ietf-quic-transport[6]: \"QUIC: A UDP-Based Multiplexed and
Secure Transport\" along with the loss detection and congestion control as
defined in draft-ietf-quic-recovery [7].
\- IETF draft-ietf-quic-datagram [8]: \"An Unreliable Datagram Extension to
QUIC\".
This solution may have additional impact on IETF:
\- As the current QUIC connection defined by IETF shall be encrypted based on
the TLS 1.3, the NULL encryption QUIC connection requires IETF support.
#### 6.8.4.2 Non-transparent QUIC proxy solution
Besides the impact listed above in clause 6.8.4.1, there are some additional
impacts on the UE and UPF to support the non-transparent QUIC proxy solution.
\- UPF: Supports the MASQUE protocol, i.e. handles the HTTP message to obtain
the remote Server IP address and UDP port number per IP flow. The target
IP/UDP header will be replaced by the remote Server IP address and UDP port
number for the UL. For the DL, the source IP address and UDP port are replaced
by the ones of the QUIC proxy in the UPF.
\- UE: Supports the MASQUE protocol, i.e. creates the HTTP message and sends
the remote Server IP address and UDP port number to the UPF.
This solution has additional dependency on an IETF draft, apart from those
listed in clause 6.8.4.1:
\- IETF draft-ietf-masque-connect-udp [19]: \"The CONNECT-UDP HTTP Method\".
## 6.9 Solution #9: Supporting a PDN connection in EPC as a 3GPP access leg of
MA-PDU Session
### 6.9.1 Introduction {#introduction-9}
This solution to KI #3 is re-using the solution in TS 23.316 [12] clause
4.12.3 but supports other devices than 5G RG.
This solution enables a capable UE and network to Support a PDN connection in
EPC as a 3GPP access leg of MA-PDU Session.
For this scenario, the general principles for ATSSS as described in Rel-16 TS
23.501 [3], clause 5.32 apply, with the additions provided in this solution.
### 6.9.2 High-level Description
A Multi-Access PDU Session may be extended with user-plane resources via an
associated PDN Connection on 3GPP access in EPC. This enables a scenario where
a MA PDU Session can simultaneously be associated with user-plane resources on
3GPP access network connected to EPC and Non 3GPP access connected to 5GC.
Such a PDN Connection in EPS would thus be associated with multi-access
capability in the UE and in PGW-C+SMF.
NOTE: To the MME and SGW this is a regular PDN Connection and the support for
ATSSS is transparent to MME and SGW.
The UE may operate in either single-registration mode or dual-registration
mode in 3GPP access. Irrespective of whether the UE operates in single-
registration mode or dual-registration mode in 3GPP access, it is assumed that
the UE supports simultaneous registrations for non-3GPP access in 5GC and 3GPP
access in EPC.
The use of ATSSS with EPS interworking applies to IP-based PDU Session and PDN
Connection types.
The ATSSS rules are provided from the PGW-C+SMF to the UE via SM NAS
signalling over 5GC, as described in TS 23.501 [3], clause 5.32.2. ATSSS rules
are not provided via EPC.
After the establishment of a MA PDU Session and setting up user-plane
resources in 3GPP access in EPC and non-3GPP access in 5GC, the UE distributes
the uplink traffic across the two access networks as described in TS 23.501
[3], clause 5.32.1. Similarly, the PDU Session Anchor UPF performs
distribution of downlink traffic across the two access networks as described
in TS 23.501 [3], clause 5.32.1.
Additional steering functionality and steering modes defined in other
solutions in the TR may also be applicable when the MA PDU Session has user-
plane resources in 3GPP access in EPC and non-3GPP access in 5GC.
The PMF protocol may be used via any user plane connection, i.e. via 3GPP
access in EPC or non-3GPP access in 5GC.
The PCF functionality to support ATSSS, as described in TS 23.501 [3], clause
5.32.1 and TS 23.503 [5] applies also in the case of interworking with EPC.
Editor\'s note: NOTE 1 of clause 5.3.1 (Description of KI #3) about Whether
any new steering functionality and steering modes defined as part of the
Rel-17 ATSSS can be applied to this solution is applicable as for any solution
to KI 3.
### 6.9.3 Procedures
When a UE wants to use a PDN Connection as user-plane resource associated with
a MA PDU Session, the UE and the network act as defined in TS 23.316 [12]
clause 4.12.3 with only following modifications with regard to TS 23.316 [12]
clause 4.12.3:
\- any UE can act as described for the 5G-RG, and any Non 3GPP access may be
used (instead of only W-5GAN)
\- the UE indicates to the SMF whether it supports a PDN Connection as user-
plane resource associated with a MA PDU Session. This allows the SMF to keep
the MA PDU Session when the 3GPP access leg has been moved from 5GC to EPC.
### 6.9.4 Impacts on services, entities, interfaces and IETF Protocols
The impact to the UE is to support the procedure described in TS 23.316 [12],
clause 4.12.3, e.g.
\- Providing over PCO in 4G NAS: an indication that a PDN Connection is
requested to be associated with a MA PDU Session and the UE\'s ATSSS
capabilities.
\- Receiving over PCO in 4G NAS: An indication whether the request for using
the PDN Connection for MA-PDU Session is accepted, MPTCP proxy information (as
described in TS 23.501 [3] clause 5.32.2), UE Measurement Assistance
Information (as described in clause TS 23.501 [3] clause 5.32.2).
\- The transfer of MA PDU session related information over PCO in 4G NAS
described above does not require protocol change (no new information exchange
is to be defined) except that a UE needs to be able to indicate whether it
supports a MA PDU Session over EPC based 3GPP access.
The impact to the SMF+PGW is to support the procedure described in 23.316 [12]
clause 4.12.3 including the transfer of MA PDU session related information
over PCO in 4G NAS described above and to support the removal of the need to
remove the MA PDU Session capability when a UE (that is not a 5G RG) moves
from 5GC to EPC based 3GPP access.
## 6.10 Solution #10: Extension of 5G RG solution to support Ethernet PDU
Session types
### 6.10.1 Introduction {#introduction-10}
Editor\'s note: This clause lists the key issue(s) addressed by this solution.
This solution addresses Key Issue #3: Supporting MA PDU with 3GPP access leg
over EPC and Non-3GPP access leg over 5GC.
### 6.10.2 High-level Description
Editor\'s note: This clause outlines solution principles, assumptions and
high-level architectures, etc.
In Rel-16 ATSSS, ATSSS interworking for 5G-RG, i.e. MA PDU Session with 3GPP
access leg over EPC and Non-3GPP access leg over 5GC, is introduced without
significant impact to EPC. Hence, the same solution can be used for general
UEs. However, there is a limitation that only for IP-based PDU Session is
supported.
In Rel-17, because we are extending the ATSSS interworking for 5G-RG to
general UEs, it is reasonable to extend supported session types to Ethernet
PDU Session type. There is no procedure change to support Ethernet PDU Session
type.
### 6.10.3 Procedures
Figure 6.10.3-1 shows procedure to establish MA PDU Session with 3GPP access
leg in EPC and non-3GPP access leg in 5GC. Details of this procedure follows
the same procedure as described in TS 23.316 [12]. There is no actual
procedure change compared to exiting procedure.
Figure 6.10.3-1. MA PDU Establishment with 3GPP leg in EPC and non-3GPP leg in
5GC
1\. In the EPC, the UE sends PDN Connectivity Request message to create 3GPP
leg of MA PDU Session. If the UE knows that EPC supports Ethernet PDN Type,
the UE requests the sets PDN Type to Ethernet in the PDN Connectivity Request.
If the UE does not know whether EPC supports Ethernet PDN Type, the UE can try
to establish Ethernet PDN Connection. If the EPC does support Ethernet PDN
Type, the request will be rejected and the UE requests PDN Connection with
non-IP PDN Type.
In the PCO of PDN Connectivity Request message, the UE includes MA PDU
indication and ATSSS Capability according to the Rel-16 procedure.
2\. The MME sends Create Session Request to the PGW-C+SMF including PCO. The
MME selects PGW-C+SMF based on APN in the PDN Connectivity Request message,
which is the same with Rel-16 behaviour. It means that deployment shall ensure
that all PGW-C+SMF(s) configured to support the APN are capable to support
ATSSS.
3\. If the UE request is accepted, when the PGW-C+SMF establishes user plane,
the PGW-C+SMF selects an PGW-U+UPF based on local configuration.
NOTE: It is assumed that the operator configuration shall ensure that both UE
and PGW-C+SMF is configured to know associated PDU Session type for the
corresponding APN/DNN. This assumption is aligned with EPS to 5GS interworking
procedure as described in TS 23.502 [4] clause 4.11.1.2.2.1.
4\. The PGW-C+SMF sends Create Session Response to the MME with PCO, which
contains ATSSS information.
5\. The MME sends PDN Connectivity Accept message to the UE.
6\. In the 5GC, the UE sends PDU Session Establishment Request message over
non-3GPP access to establish non-3GPP access leg. The UE sets the PDU Session
type based on configuration in the UE. This should be the same PDU Session
type selected by the PGW-C+SMF in step 3.
7\. The AMF selects PGW-C+SMF based on existing mechanism, i.e. PDU Session ID
provided by the UE.
8\. The PGW-C+SMF modifies N4 Session to add non-3GPP access leg.
9-10. The PGW-C+SMF sends PDU Session Establishment Accept message to the UE
including ATSSS rules.
### 6.10.4 Impacts on services, entities, interfaces and IETF protocols
Editor\'s note: This clause describes impacts to existing services and
interfaces.
\- For both EPS and 5GS, there is no changes to existing procedures.
## 6.11 Solution #11: Steering mode enhancements for handling-- RTT
differences
### 6.11.1 Introduction {#introduction-11}
This solution addresses KI#1 on Additional Steering Modes.
Currently, there are four steering modes defined in Rel-16, which are Active-
Standby, Smallest Delay, Load-Balancing and Priority-based steering modes.
Among these steering modes, only Smallest Delay steering mode considers the
RTT of each access because it selects the access with the smallest RTT.
However, only one access will be selected to transmit SDFs in this steering
mode, which does not utilize the double bandwidth provided by MA PDU Session.
Additionally, although steering modes such as Priority-based and Load-
Balancing may use both accesses to transmit SDFs, the RTT of both accesses may
be quite different, which can cause asynchronous problems and affect the user
experience.
In many cases a difference in RTT is not an issue for steering functionalities
that support packet re-ordering, such as MPTCP, or newly proposed steering
functionalities as Solutions #6, 7 and 14. However, ATSSS-LL does not support
packet re-ordering. Knowing how sensitive an application is to disordering may
in that case be beneficial for UE/UPF to decide how frequently to switch (or
even split) between accesses for a given service data flow. This may also be
the case for newly proposed QUICv1-based steering functionalities not
supporting packet re-ordering (e.g. solutions # 1, 13).
Therefore, steering mode enhancements may be beneficial, which not only tries
to make use of double bandwidth provided by two accesses, but also tries to
avoid asynchronous problems as much as possible in case the steering
functionality cannot handle it well.
### 6.11.2 High-level Description
With these enhancements, the UE and UPF may receive a new parameter indicating
whether the application is sensitive to disordering or not. In case the
application is sensitive or disordering, both UE and UPF may measure the RTT
of both accesses and calculate the RTT difference between the two accesses.
For RTT measurement, both UE and UPF can apply the existing RTT measurement
mechanism defined in TS 23.501 [3] clause 5.32.5 or can use measurement
available at the MPTCP/MPQUIC/QUIC layer. In addition, a new parameter called
\"out-of-order sensitivity\" can be sent to UE and UPF by the network that may
assist UE/UPF to determine which access(es) will be selected to transmit SDFs.
It may be used as described below:
\- When the application is sensitive to disordering, and the steering
functionality does not support in-order delivery, the UE and UPF may take the
RTT in each access and the RTT difference between two accesses into account
when deciding how frequently it can switch a traffic flow between the two
accesses.
\- When the application is not sensitive to disordering, the UE and UPF may
switch traffic more frequently, even if the steering functionality does not
support in-order delivery.
This new indication may be used together with the following Steering Modes:
\- Load Balancing: The indication is used by UE and UPF to decide how
frequently it can switch traffic between accesses, e.g. if the steering
functionality does not support in-order delivery.
\- Priority-based: The indication is used by UE and UPF to decide how it can
simultaneously use the high-priority and low-priority accesses, e.g. if the
steering functionality does not support in-order delivery.
### 6.11.3 Procedures
#### 6.11.3.1 Establishment of MA PDU Session supporting RTT difference based
steering mode
Figure 6.11.3.1-1: Enhancement of MA PDU Session Establishment for RTT
difference based steering mode support
The procedure of establishing MA PDU Session supporting RTT difference based
steering is based on the existing MA PDU Session establishment procedure
specified in TS 23.502 [4] clause 4.22.2 with the following additions:
1\. In step 5b, PCF may decide that MA PDU Session is allowed and decide to
apply RTT difference based steering for target SDFs based on policy or
parameters provided by AFs. For example, an AF may determine that target
traffic flows are sensitive to asynchronous transmission and provide an
indication about this to the PCF. PCF may decide to apply Load-Balancing or
Priority-based steering mode together with the indication provided by the AF
to these target traffic flows.
When SMF receives PCC rules with MA PDU Session Control from PCF, it shall
derive rules for the UPF i.e. N4 rules containing MAR which includes a
steering mode with associated parameters (e.g. weight) and indication on
whether the traffic flow is sensitive to out-of-order delivery. In addition,
SMF shall derive rules for the UE i.e. ATSSS rules including a steering mode
associated parameters (e.g. weight) and indication on whether the traffic flow
is sensitive to re-ordering.
2\. In step 6, SMF sends the N4 rules determined in step 5 to the UPF.
3\. From step 7 to step 9, SMF sends the ATSSS rules within PDU Session
Establishment Accept message to the UE via AMF.
### 6.11.4 Impacts on services, entities, interfaces and IETF Protocols
This solution will impact the following entities in 5GS:
\- PCF: Supports to authorize the new indication for the SDF.
\- UPF: Supports the new indication and associated behaviour.
\- UE: Supports the new indication and associated behaviour.
\- 5G-AN/ NG RAN: No impact.
## 6.12 Solution #12: New steering mode operation -- UE assisted operation
### 6.12.1 Introduction {#introduction-12}
This solution addresses KI#1 on Additional Steering Modes by extending the
operation of existing steering modes (e.g. Active-Standby, Smallest Delay).
For several reasons, it may be beneficial for the UE to choose how it
distributes traffic among 3GPP and non-3GPP access. For example, a UE may
choose a particular uplink traffic distribution based on considerations of
energy consumption or battery state.
While the UE has control over uplink traffic distribution, the downlink
traffic distribution is controlled by the UPF. For maximum synergy (e.g. to
ensure that the downlink and uplink use the same access for conserving
energy), it is desirable for the UE to inform its desired downlink traffic
distribution to the UPF so that the UPF can consider it when applying downlink
traffic steering/splitting. This can be achieved by enhancing the PMF protocol
if available, or another mechanism, if the PMF protocol is not available.
### 6.12.2 High-level Description
We refer to the steering mode operation described here as UE assisted
operation. When this steering mode operation is applied, the UE decides how
traffic is steered, switched and split between 3GPP and non-3GPP access based
on UE state and UE knowledge of access conditions. The solution works as
follows.
1\. The UE is configured with ATSSS rules including the UE assisted traffic
steering mode defined in Release 16 by the network. In addition, the ATSSS
rule indicates whether the \"UE assisted operation\" is allowed. Similarly,
the UPF is configured with N4 rules, indicating whether the UE is allowed to
use UE assisted operation. The network indicates if splitting / load balancing
is allowed.
2\. The UE monitors UE state and access conditions of both 3GPP and non-3GPP
accesses (e.g. power consumption profile). Based on UE monitoring , the UE may
decide to activate the \"UE assisted operation\". If traffic splitting / load
balancing is allowed, the UE may determine the desired ratio of traffic split
for uplink and downlink directions. If traffic splitting is not allowed, the
UE decides which access to use for steering and switching for uplink and
preferred access for downlink.
3\. In the uplink, the UE distributes traffic based on the desired traffic
split ratio or preferred access for uplink. The UE informs the UPF of the
desired traffic ratio or preferred access for the downlink via the PMF
protocol. It is up to the UPF to take into consideration the information
provided by the UE for downlink scheduling purposes.
Editor\'s note: What information the UE provides to UPF in order to allow the
UPF to identify the traffic and related PDRs, MARs etc is FFS
The new steering mode operation only applies to non-GBR traffic.
NOTE: As specified in rel-16, a GBR flow is sent over a single access, i.e.
the access to which the QoS profile has been provided.
The UE assisted operation works will all Release 16 steering modes, and is
applicable for all steering functionalities.
### 6.12.3 Procedures
Figure 6.12.3-1 provides an example call flow of how the UE operates with the
UE assisted traffic steering mode.
Figure 6.12.3-1: UE assisted traffic steering mode operation in case PMF is
used to assist UPF
1\. The UE and the network establish an MA PDU session as specified in Clause
5.32.6.1 of TS 23.501. The SMF configures the allowed steering mode (e.g.
Active-Standby or Smallest Delay) in ATSSS rules as specified in Release 16.
In addition, the SMF may indicate, for each ATSSS rule, if the UE can switch
to the UE assisted operation.. The SMF also indicates if traffic splitting /
load balancing is allowed or not in the ATSSS/N4 rules pushed to the UE/UPF. A
UE that does not support the UE assisted operation ignores the indication for
this operation in ATSSS rules.
2\. The UE monitors UE state (e.g. battery state, temperature) and conditions
for both 3GPP and non-3GPP access (e.g. power profile). If some conditions
(based on UE implementation) are met, the UE invokes the UE assisted operation
for the traffic associated with one or more of the ATSSS rules that allow UE
assisted operation. It determines the desired traffic split for both uplink
and downlink directions. If traffic splitting/ load balancing is not allowed,
the UE determines the preferred access.
NOTE: The details of UE monitoring and determination of desired traffic split
ratios/preferred access in uplink and downlink is up to UE implementation.
3\. The UE sends a UE assistance report via the PMF protocol. The report
contains information that allows the UPF to identify traffic or PDR for which
the UE assisted operation has been activated, and the desired downlink traffic
load balancing ratios for the associated downlink traffic. If traffic
splitting / load balancing is not allowed, the UE indicates the preferred
access.
Editor\'s note: It is FFS how ATSSS rules are indicated (e.g. using traffic
descriptors, identifier, etc) in the UE assistance report.
4\. The UPF sends an acknowledgment to the UE.
Editor\'s note: Contents in the acknowledgement are FFS.
5\. The UPF takes into account the UE\'s preferences and applies DL traffic
steering/splitting for the associated downlink traffic. If a desired load
balancing ratio is provided by the UE, the UPF may perform load balancing in
DL with the desired load balancing ratio. If the UE provides a preferred
access, the UPF may perform active-standby using the preferred access if
available. The UE uses the desired traffic split ratio in uplink or preferred
access for uplink traffic distribution.
Editor\'s note: It is FFS if and how the UE switches back to the allowed
steering mode specified in ATSSS rules, when the UE determines that it is
feasible to do so.
### 6.12.4 Impacts on services, entities, interfaces and IETF Protocols
SMF:
\- Supports a UPF that supports the new steering mode operation.
PCF:
\- Supports authorization of the new steering modes operation for an SDF.
UPF:
\- Supports the new steering mode operation.
UE:
\- Supports the new steering mode operation.
## 6.13 Solution #13: Proxy based solution using QUIC
### 6.13.1 Introduction {#introduction-13}
This solution describes a new ATSSS steering functionality called based on
proxying of end-user traffic in UPF. In particular, the UE uses QUIC (and
HTTP/3) to request the UPF to forward packets to a final destination based on
the MASQUE framework being developed in the IETF.
The solution enables UDP payload to be carried over QUIC between the UE and
the UPF, and then proxied by the UPF towards the final destination. Support
for general IP payload is expected to be added once the IETF MASQUE work
provides support for IP proxying (part of MASQUE WG charter). Support for
Ethernet PDU Sessions can also be added, if needed. The solution is hereafter
called QUIC-PROXY, but it should be noted that the solution is not based on
proxying QUIC connections; it is based on QUIC between UE and UPF to carry
payload via QUIC and this payload is then forwarded by UPF to the destination
(see further details below). The payload of the UDP datagrams may contain
anything, including a e2e QUIC connection between the UE and a remote server
on the DN.
It is a \"Low Layer\" steering functionality because it operates below the UE
IP layer (such as ATSSS-LL), in contrast to a high layer steering
functionality that operates above the IP layer (such as MPTCP).
The solution is based on:
1\. The QUIC protocol specified in draft-ietf-quic-transport [6] along with
the loss detection and congestion control specified in draft-ietf-quic-
recovery [7]; and
2\. The QUIC extensions specified in draft-ietf-quic-datagram [8] for
supporting unreliable datagram transport.
3\. The QUIC proxy extensions specified in draft-ietf-masque-connect-udp [19]
for support of proxying UDP payload. This draft has been adopted by the MASQUE
WG.
NOTE: Support for proxying of both UDP and general IP payload is part of the
IETF MASQUE WG charter. According to the charter, the WG will first deliver a
solution for UDP proxying, and then a solution for IP proxying.
Editor\'s note: It is FFS whether a MASQUE solution for IP proxying will be
available in time for Rel-17.
Support for proxying of Ethernet traffic is not part of the MASQUE WG charter
but could be added as a 3GPP-specific extension or be added based on later
IETF work.
### 6.13.2 High-level Description
This clause provides a brief overview of how the solution operates and how it
is applied to support ATSSS for a MA PDU Session.
The Figures are on purpose made similar to some existing figures in the TR, to
simplify comparison with existing solutions in the TR.
Control plane aspects
1\. During the establishment of the MA PDU Session, the UE indicates whether
it supports QUIC-PROXY and the network selects whether QUIC-PROXY will be used
for routing (some or all) traffic of the MA PDU Session across 3GPP and
non-3GPP accesses.
UP model
2\. There are separate QUIC connections per access and QoS Flow. Each QUIC
connection is mapped to one QoS flow. So, if for example two QoS flows are
assigned to the MA PDU Session (as shown Figure 6.13.2-1), then two QUIC
connections are established between the UE and the UPF over 3GPP access and
two QUIC connections are established between the UE and the UPF over non-3GPP
access.
Control and triggers for QUIC Connection establishment
3\. The UE initiates new QUIC Connections, one per access and QoS Flow. There
are different ways for how this can be done:
3a. One option is that UE triggers setup of a QUIC Connection when a new QoS
Flow is created, i.e. when a QFI us used for which no QUIC Connection exists.
This is triggered either when the UE receives a QoS Rule from the network with
a new QFI, or when a derived QoS Rule is created with a new QFI.
The protocol used for MASQUE (i.e. HTTP) may then be used to coordinate the
mapping between QoS Flow and QUIC Connection between UE and UPF.
Alternatively, the UE encodes the QFI into the Connection ID that is provided
to UPF during the QUIC Connection setup (which would require that the QUIC
implementation in the UE is able to select QUIC Connection ID based on QFI).
This ensures that UE and UPF will use the same QUIC Connection for a given QoS
Flow (QFI) in both uplink and downlink directions.
Editor\'s note: Whether to use the option to notify UPF about QFI via the
MASQUE protocol or encode it in the Connection ID provided by the UE is FFS.
3b. Another alternative is that the network explicitly requests creation of
new QUIC Connections by providing the UE with \"QUIC Connection Setup
information\" as proposed in Solution#1 (clause 6.1.2). This contains
information for the UE to setup the QUIC connections with the UPF. For
example, it indicates that QUIC Connection #1 over 3GPP access should be
established toward the UPF IP address 10.10.1.2 and UPF port 53671.
The \"QUIC Connection Setup information\" is provided from UPF to SMF based on
SMF request, as described on Solution#1.
Editor\'s note: The solution works with either way to trigger QUIC Connection
establishment described in bullets 3a and 3b, and it is FFS which option to
use.
Editor\'s note: How to support cases where the DL traffic for a traffic flow
is using a different QoS Flow than UL traffic is FFS.
NOTE 1: The QUIC protocol can multiplex several PDUs in a single QUIC packet.
By using a separate QUIC connection for each QoS flow, we ensure that PDUs
belonging to different QoS flows cannot be multiplexed in the same QUIC
packet. Furthermore, the UE and UPF will use the same QUIC Connection for a
given QoS Flow in uplink and downlink directions. This ensures that e.g.
downlink ACK frames are sent with the same QoS as the uplink data packets. In
case Reflective QoS is used, traffic flows using Reflective QoS and traffic
flows not using Reflective QoS should not be mixed in the same QUIC packet,
since only a single Reflective QoS Indication (RQI) per packet can be carried
via N3/N9.
Figure 6.13.2-1: Proxying MA PDU traffic via different QUIC connections
Sending of uplink data
5\. The UE applies the ATSSS rules to steer each PDU to a specific access and
the QoS Rules to steer each PDU to a QoS Flow.
6\. To request proxy forwarding the UE sends a request (a HTTP message) for
proxying to the UPF via the User Plane. The UE includes information about the
IP address and port of the final destination, as well as a request for a
\"Datagram-Flow-Id\", as described in draft-ietf-masque-connect-udp [19]. The
\"Datagram-Flow-Id\" represents a flow of datagrams within a single QUIC
connection, allowing multiplexing of multiple UDP \"flows\" on a single QUIC
connection. The proxying request needs to be sent by the UE over each QUIC
connection where the traffic will be carried, i.e. over the QUIC connection(s)
corresponding to the appropriate access(es) and QoS Flow(s). Therefore, when a
PDU is steered to a specific QUIC connection and the UE has not yet requested
proxy forwarding for this destination server IP address and port (for UDP) for
this QUIC connection, the UE sends a HTTP request to UPF, to requests the
proxy connection.
The UE and UPF stores state information for each UDP flow sent over a QUIC
connection, including a Datagram-Flow-Id.
The lifetime of the proxy state is bound to the lifetime of the stream used
for the HTTP request. A UE and UPF can close the stream to terminate the
forwarding for that specific flow.
7\. Sending of PDUs: Each QUIC connection carries a sequence of QUIC packets
and each QUIC packet carries one or more datagram frames (defined in draft-
ietf-quic-datagram [8]). The UE encapsulates the payload of the UDP packet (of
the PDU) in a QUIC datagram frame, together with the \"Datagram-Flow-Id\".
Each QUIC datagram frame thus contains the payload of a UDP packet, the
payload of an IP packet, or an Ethernet frame, depending of the type of
traffic being proxied. Since the QUIC datagram service is used, the QUIC
connection provides an unreliable transport service between the UE and the
UPF.
8\. Once the UPF receives the QUIC packet with the QUIC datagram frame, the
UPF extracts the UDP payload, adds re-creates) the appropriate UDP/IP headers
based on the \"Datagram-Flow-Id\", as described in draft-ietf-masque-connect-
udp [19], and forwards the PDU via N6.
The protocol stack in Figure 6.13.2-2 illustrates the content \"on the wire\"
for different interfaces.
Figure 6.13.2-2: UP protocol stack
9\. To coordinate what QUIC Connection to use for a given QoS Flow, the UE
sends a HTTP message to the UPF (possibly together with the proxy request
described in bullet 4 above) including the QFI for which the QUIC Connection
is used. Alternatively, the UE encodes the QFI into the Connection ID that is
provided to UPF during the QUIC Connection setup. This allows the UE and UPF
to associate the same QUIC Connection to the QoS Flow.
10\. Figure 6.13.2-3 explains (via an example) how the QUIC-PROXY steering
functionality is applied to route the traffic of an MA PDU Session in uplink:
a. The UE is assigned with three IP addresses: The IP\@3, which is the IP
address of the MA PDU Session, and two link-specific IP addresses, one for
3GPP access (IP\@1) and one for non-3GPP access (IP\@2). The scope of the
link-specific IP addresses is local, i.e. they are used only for UE-UPF
communication.
b. In the example scenario shown in Figure 6.13.2-3, it is assumed that two
QoS flows are assigned to the MA PDU Session. Hence, the UE uses the IP\@1 to
establish two QUIC connections to UPF over 3GPP access and uses the IP\@2 to
establish two QUIC connections to UPF over non-3GPP access.
c. The UP processing is schematically described below, taking an example with
up-link traffic and UDP-based application in the UE. On the UE side, each IP
packet that enters the IP interface associated with the MA PDU Session (refer
to Figure 6.13.2-3 for the \"step numbers\"):
(1). First, it goes through QoS Flow selection based on the QoS Rules.
(2). Next the IP packet goes through an Access Selection, which selects the
access on which the packet should be transmitted. This selection is based on
the ATSSS rules and the measurements (e.g. RTT, loss rate, etc.) received by
the QUIC protocol.
(3). Then, the IP packet goes through the QUIC Connection Selection/Creation.
QUIC Connections associated with the selected Access Type (3GPP or non-3GPP
access) and QoS Flow is used to carry the IP packet.
(4). The IP packet then goes through the MASQUE functionality. In case a proxy
state for the given UDP flow (destination address + port) has not yet been
requested on this QUIC Connection, the UE sends a proxy request (HTTP request)
to the UPF and includes destination IP address + port. The UPF replies with a
200 OK, and includes a new Datagram-Flow-Id. In case a new QUIC Connection was
established in step 3, the UE also notifies the UPF about the QFI for this
QUIC Connection. This step is further described in clause 6.13.3.2.
QUIC datagram payload is generated with the UDP payload of the IP packet, and
the Datagram-Flow-Id.
(5)-(7). Finally, the packet goes through the QUIC protocol. The QUIC datagram
frame is included in a QUIC packet (possibly with other datagram frames of the
same QUIC connection) and goes to an access interface (3GPP or non-3GGP) via
the UDP/IP layers. The outer IP packet has source address IP\@1 or IP\@2 and
destination address an IP address of UPF, which is provided to UE during the
MA PDU Session establishment.
(8-9). When the UPF receives the GTP-tunnelled packet, it identifies the N4
Session based on the PDR, as normal. The UPF processes the QUIC protocol and
delivers the QUIC datagram content to the MASQUE application.
(10). The UPF identifies the UDP flow based on the Datagram-Flow-Id in the
QUIC datagram frame and adds the appropriate UDP/IP headers based on the proxy
state.
(11). The UPF executes the QER, URR, FAR processing and sends the packet onto
N6 interface.
NOTE 2: The purpose of the stepwise description above is to explain and
exemplify the solution. Internal interfaces of UE and UPF are not to be
standardized by ATSSS.
Figure 6.13.2-3: Example of User-Plane operation (uplink direction, UDP based
application/PDU)
Sending of downlink data
11\. Downlink data is steered in a similar way, with the difference that UPF
uses N4 rules in order to determine the appropriate access and QoS Flow. Once
the UPF has determined the QoS Flow based on the QER(s), the UPF uses the
association between QoS Flow and QUIC Connection established as described in
bullet 7 to select the suitable QUIC Connection. An example of UPF processing
is shown in Figure 6.13.2-4.
When the UE receives the packet, the UE delivers the UDP payload to the
application.
In case Reflective QoS is used, i.e. the downlink packet carries a RQI, the UE
creates a \"UE derived QoS rule\" for the uplink traffic based on the received
DL traffic.
Figure 6.13.2-4: Example of UPF User-Plane operation (downlink direction, UDP
based application/PDU)
Other aspects
12\. Normally, the QUIC-PROXY steering functionality does not split the
packets of an IP flow (defined by a 5-tuple) across the two accesses. Separate
QUIC Connections are used per access, and there is thus no mechanism that
ensures in-order delivery for an IP flow split over both accesses. Therefore,
if an IP flow is split across the two accesses the QUIC-PROXY will not prevent
out-of-order delivery. Layers above the QUIC-PROXY (e.g. the application
layer) may be able to handle the out-of-order delivery. This aspect is thus
similar as for rel-16 ATSSS-LL. Note that QUIC Datagram frames are not
retransmitted upon loss detection (see draft-ietf-quic-datagram [8]), hence,
duplications are not possible.
13\. The QUIC-PROXY can transfer an IP flow from one access to another access
according with the ATSSS rules and the measurements (e.g. RTT) received from
the QUIC protocol. For example, the blue IP flow in Figure 6.13.2-3 can be
transferred from QUIC connection #4 over 3GPP access to QUIC connection #2
over non-3GPP access, when the Access Selection determines e.g. that the RTT
of QUIC connection #4 is higher than the RTT of QUIC connection #2. Note that
when an IP flow is transferred to another access, the QoS flow used for this
IP flows remains the same.
14\. Lost QUIC datagram frames are not retransmitted, detection of lost
packets is supported according to draft-ietf-quic-datagram [6]. Congestion
control per QUIC connection is supported, as per the QUIC draft. As a result,
the UE and the UPF may stop sending datagram frames on a QUIC connection when
congestion is detected by the QUIC protocol on this connection.13.
15\. Round-trip and packet loss measurements per QUIC connection is supported,
as specified in draft-ietf-quic-transport [6]. Since each QUIC connection is
transmitted on a specific QoS Flow, this means that QUIC-PROXY supports round-
trip measurements per QoS Flow and packet loss measurements per QoS Flow.
The UPF can use QUIC PING frames, as described in [6], to verify that the UE
is still reachable over an access. or to check reachability to the peer. The
PING frames can be sent over one QUIC connection only per access or over
multiple QUIC connections (i.e. multiple QoS flows) per access.
16\. Since the original IP header (IP\@3) is not included in the packets sent
between UE and UPF, IP fragmentation is not supported. A suitable MTU would
need to be provided to the UE to avoid the need for IP fragmentation. Handling
of other parameters carried via IP and UDP headers, such as ECN, DSCP, IPv6
Extension headers, is discussed in draft-westerlund-masque-transport-issues
[20].
Editor\'s note: It is FFS whether this solution needs double-layer security
between the UE and the 5GS (radio level security + QUIC mandatory security).
If that is the case, it needs to be clarified how QUIC/DTLS security is set-
up.
### 6.13.2a Alternate user plane handling in the UE
In the description above in clause 6.13.2, it is assumed that the ATSSS Rules
and QoS Rules operate as in rel-16, i.e. that ATSSS Rule is applied to the e2e
packet header (\"SDF\") to determine access based on steering mode, and QoS
Rule is applied to e2e header (SDF) to determine QoS Flow for the packet. Then
the QUIC Connection is selected based on the QoS Flow / QFI for the packet.
Another option is that the same operation as described in Solution #1, clause
6.1.4, is applied, i.e. ATSSS Rule is applied to the e2e packet header
(\"SDF\") to determine access based on steering mode and QUIC Connection based
on a \"QUIC Connection Selection Descriptor\" added to the ATSSS Rule (see
Table 6.1.4-1). The QoS Rule is applied to outer header of the QUIC packet
(i.e. with the link local IP addresses) to map a QUIC Connection to a QoS
Flow.
Such a user plane handling in the UE can be used also with this proxy-based
solution.
One issue however with this approach is how to handle Reflective QoS. As per
rel-15/16, the UE shall create a \"UE derived QoS rule\" for the uplink
traffic based on the received DL traffic. However, if the QoS Rule acts on the
outer header (and this is per QUIC Connection), such approach will not work.
It is no point for the UE to generate yet another QoS Rule mapping a QUIC
Connection to a certain QFI.
Editor\'s note: Support for Reflective QoS with this alternate user plane
approach is FFS.
This alternate user plane handling is illustrated in Figure 6.13.2a-1.
Figure 6.13.2a-1: Example of alternate User-Plane operation (uplink direction,
UDP based application/PDU)
### 6.13.3 Procedures
#### 6.13.3.1 MA PDU Session Establishment
This clause describes the MA PDU Session Establishment, with support for QUIC-
PROXY steering functionality. The call flow below is only showing a subset of
the messages.
Figure 6.13.3.1-1: MA PDU Session Establishment
The procedure is based on rel-16 MA PDU Session Establishment procedure, with
the following differences:
1\. The UE indicates support for QUIC-PROXY steering functionality.
3a. The SMF determines the MA PDU Session capability to support QUIC-PROXY,
based on UE capabilities and local configuration.
3b. The PCF authorizes the use of QUIC-PROXY and provides PCC Rules, including
steering information for QUIC-PROXY.
4a. The SMF initiates N4 Session Establishment and indicates to UPF the use of
QUIC-PROXY.
4b. The UPF provides QUIC-PROXY information to the SMF (proxy IP address).
5\. The SMF sends Namf_Communication_N1N2MessageTransfer with a PDU Session
Establishment Accept. The PDU Session Establishment Accept contains ATSSS
information such as QUICK proxy address and ATSSS Rules with steering
information for QUIC-PROXY.
6-7. The PDU Session Establishment Accept is sent to the UE.
8\. The leg over non-3GPP access is added to the MA PDU Session.
9\. QUIC Connection(s) are established between UE and UPF. In order to allow
the UPF to use a QUIC connection for downlink traffic before UE needs it for
uplink traffic, the UE should initiate QUIC Connection establishment after MA
PDU Session Establishment, even if the UE does not have uplink traffic for
that QUIC Connection.
#### 6.13.3.2 Proxy related signalling
This clause describes the procedure for 1) how the UE requests proxying of UDP
packets, and 2) notifies the UPF about the QoS Flow -- QUIC Connection
association. This signalling takes place via a QUIC Connection of the MA PDU
Session user plane.
Figure 6.13.3.2-1: Proxy related signalling
1\. The UE determines that there is a need to request proxying towards a new
destination IP address / port, or to notify the UPF about the QFI associated
with a newly established QUIC Connection.
2\. The UE sends a HTTP Request over a specific QUIC Connection. To request
proxying of PDUs, the UE sends a HTTP Request with the proxy information
(destination address and port), as described in draft-ietf-masque-connect-udp
[19]. To notify the UPF about the QFI for a newly established QUIC Connection,
the UE sends a HTTP Request including the QFI.
3\. The UPF sets up the appropriate proxying state, and/or stores the QFI
associated to the QUIC Connection, depending on the content of step 2\. The
UPF replies with a HTTP Response. If step 2 was a request for proxying, the
UPF provides a Datagram-Flow-Id in the response.
4\. User data is carried between UE and UPF via the QUIC Connection, and
proxied by UPF.
NOTE: As described in the draft-ietf-masque-connect-udp [19], step 4 may be
done before step 3 to reduce delays.
### 6.13.4 Impacts on services, entities, interfaces and IETF protocols
The solution has the following impacts:
Services/Interfaces
Extensions will be needed to SM NAS protocol, Npcf service and N4 protocol to
support the new QUIC-PROXY steering functionality
Network Functions and entities
UE
\- Support QUIC protocol and the use of QUIC proxy in the network, based on
IETF protocols described below
SMF
\- Support for handling new Steering Functionality towards PCF, UPF and UE
UPF
\- Support for QUIC protocol and QUIC proxy (MASQUE), based on IETF protocols
described below.
PCF
\- Support for handling new Steering Functionality
IETF protocols
The solution is dependent on the following IETF drafts:
1\. The QUIC protocol specified in draft-ietf-quic-transport [6] along with
the loss detection and congestion control specified in draft-ietf-quic-
recovery [7]; and
2\. The QUIC extensions specified in draft-ietf-quic-datagram [8] for
supporting unreliable datagram transport;
3\. The QUIC proxy extensions specified in draft-ietf-masque-connect-udp [19]
for support of proxying UDP payload.
In order to support IP proxying (for any type of IP payload, not only UDP) and
Ethernet PDU Sessions, additional work is needed.
## 6.14 Solution #14: Proxy based solution using MP-QUIC
### 6.14.1 Introduction {#introduction-14}
This solution describes a new ATSSS steering functionality called based on
proxying of end-user traffic in UPF. In particular, the UE uses QUIC (and
HTTP/3) to request the UPF to forward packets to a final destination based on
the MASQUE framework being developed in the IETF.
The solution enables UDP payload to be carried over QUIC between the UE and
the UPF, and then proxied by the UPF towards the final destination. Support
for general IP payload is expected to be added once the IETF MASQUE work
provides support for IP proxying (part of MASQUE WG charter). Support for
Ethernet PDU Sessions can also be added, if needed. The solution is hereafter
called MP-QUIC-PROXY, but it should be noted that the solution is not based on
proxying MP-QUIC connections; it is based on MP-QUIC between UE and UPF to
carry payload via MP-QUIC and this payload is then forwarded by UPF to the
destination (see further details below). The payload of the UDP datagrams may
contain anything, including a e2e QUIC connection between the UE and a remote
server on the DN.
It is a \"Low Layer\" steering functionality because it operates below the UE
IP layer (such as ATSSS-LL), in contrast to a high layer steering
functionality that operates above the IP layer (such as MPTCP).
The solution is based on:
1\. The QUIC protocol specified in draft-ietf-quic-transport [6] along with
the loss detection and congestion control specified in draft-ietf-quic-
recovery [7]; and
2\. The QUIC extensions specified in draft-ietf-quic-datagram [8] for
supporting unreliable datagram transport;
3\. Multipath extensions for QUIC, as defined in draft-deconinck-quic-
multipath [10];
4\. The QUIC proxy extensions specified in draft-ietf-masque-connect-udp [19]
for support of proxying UDP payload. This draft has been adopted by the MASQUE
WG.
Note that support for proxying of both UDP and general IP payload is part of
the IETF MASQUE WG charter. According to the charter, the WG will first
deliver a solution for UDP proxying, and then a solution for IP proxying.
Editor\'s note: Whether a MASQUE solution for IP proxying will be available in
time for Rel-17 depends on IETF progress.
Support for proxying of Ethernet traffic is not part of the MASQUE WG charter
but could be added as a 3GPP-specific extension or be added based on later
IETF work.
### 6.14.2 High-level Description
This clause provides a brief overview of how the solution operates and how it
is applied to support ATSSS for a MA PDU Session.
The Figures are on purpose made similar to some existing figures in the TR, to
simplify comparison with existing solutions in the TR.
Control plane aspects
1\. During the establishment of the MA PDU Session, the UE indicates whether
it supports MPQUIC-PROXY and the network selects whether MPQUIC-PROXY will be
used for routing (some or all) traffic of the MA PDU Session across 3GPP and
non-3GPP accesses.
UP model
2\. There are separate MP-QUIC connections per QoS Flow. Each QUIC connection
is mapped to one QoS Flow. So, if for example two QoS Flows are assigned to
the MA PDU Session (as shown Figure 6.14.2-1), then two MP-QUIC connections
are established between the UE and the UPF.
Editor\'s note: MP-QUIC is not yet mature in IETF and the ATSSS solution
therefore may need to adapt to the outcome in IETF. For example, it is not
clear whether one MP-QUIC Connection can support multiple simultaneous
steering modes, and it is FFS how to solve it if it turns out that MP-QUIC
will only support a single steering mode.
Control and triggers for QUIC Connection establishment
3\. The UE initiates a new MP-QUIC Connections, one per QoS Flow. There are
different ways for how this can be done:
3a. One option is that UE triggers setup of a MP-QUIC Connection when there
are ATSS Rules utilizing MP-QUIC and when a new QoS Flow is created, i.e. when
a QFI us used for which no MP-QUIC Connection exists. This is triggered either
when the UE receives a QoS Rule from the network with a new QFI, or when a
derived QoS Rule is created with a new QFI.
The protocol used for MASQUE (i.e. HTTP) may then be used to coordinate the
mapping between QoS Flow and MP-QUIC Connection between UE and UPF.
Alternatively, the UE encodes the QFI into the Connection ID that is provided
to UPF during the QUIC Connection setup (which would require that the QUIC
implementation in the UE is able to select QUIC Connection ID based on QFI).
This ensures that UE and UPF will use the same QUIC Connection for a given QoS
Flow (QFI) in both uplink and downlink directions.
3b. Another alternative is that the network explicitly requests creation of
new MP-QUIC Connections by providing the UE with \"MPQUIC Connection Setup
information\" as proposed in Solution#6 (clause 6.6.2). This contains
information for the UE to setup the MP-QUIC connections with the UPF. For
example, it indicates that MP-QUIC Connection #1 should be established toward
specific UPF IP address and UPF port.
The \"MPQUIC Connection Setup information\" is provided from UPF to SMF based
on SMF request, as described on Solution#6.
NOTE 1: The solution works with either way to trigger QUIC Connection
establishment described in bullets 3a and 3b.
NOTE 2: The MP-QUIC protocol can multiplex several PDUs in a single QUIC
packet. By using a separate QUIC connection for each QoS Flow, we ensure that
PDUs belonging to different QoS Flows cannot be multiplexed in the same QUIC
packet. Furthermore, the UE and UPF will use the same QUIC Connection for a
given QoS Flow in uplink and downlink directions. This ensures that e.g.
downlink ACK frames are sent with the same QoS as the uplink data packets. In
case Reflective QoS is used, traffic flows using Reflective QoS and traffic
flows not using Reflective QoS should not be mixed in the same QUIC packet,
since only a single Reflective QoS Indication (RQI) per packet can be carried
via N3/N9.
Figure 6.14.2-1: Proxying MA PDU traffic via different QUIC connections
Support for different types of payload
5\. The solution supports different types of payload within the PDU:
\- UDP payload: In this case the PDU contains a UDP/IP packet with UDP
payload. The UDP payload is forwarded as described in bullets 6-10 below.
\- IP payload: In this case the PDU contains an IP packet with some kind of IP
payload. The MASQUE WG has not yet defined a solution for proxying IP payload,
but the WG draft for IP proxying requirements has draft requirements for such
a solution in draft-ietf-masque-ip-proxy-reqs [27]. The requirements include
e.g. to proxy IP packets in their unmodified entirety. The protocol stack is
shown in the Figure below.
Figure 6.14.2-2: UP protocol stack
\- QUIC payload: In this case the PDU contains a QUIC/UDP/IP packet, with some
kind of QUIC payload. This is for a case where QUIC is used e2e between UE and
an application server, and is thus a different QUIC connection compared to the
QUIC Connection between UE and UPF. The Internet Draft draft-pauly-masque-
quic-proxy [26], proposed for the IETF MASQUE WG, enables such QUIC traffic to
be proxied in the UPF without an underlying extra QUIC header. This avoids the
need for double QUIC layers and double QUIC encryption between UE and UPF. The
protocol stack is shown in the Figure below.
Figure 6.14.2-2: UP protocol stack
Sending of uplink UDP data
5\. The UE applies the ATSSS rules to steer each PDU to a specific access and
the QoS Rules to steer each PDU to a QoS Flow.
6\. To request proxy forwarding the UE sends a request (a HTTP message) for
proxying to the UPF via the User Plane. The UE includes information about the
IP address and port of the final destination, as well as a request for a
\"Datagram-Flow-Id\", as described in draft-ietf-masque-connect-udp [19]. The
\"Datagram-Flow-Id\" represents a flow of datagrams within a single QUIC
connection, allowing multiplexing of multiple UDP \"flows\" on a single MP-
QUIC connection. The proxying request needs to be sent by the UE over the MP-
QUIC connection where the traffic will be carried, i.e. over the MP-QUIC
connection corresponding to the appropriate QoS Flow. Therefore, when a PDU is
steered to a specific MP-QUIC connection and the UE has not yet requested
proxy forwarding for this destination server IP address and port (for UDP) for
this MP-QUIC connection, the UE sends a HTTP request to UPF, to requests the
proxy connection.
The UE and UPF stores state information for each UDP flow sent over a QUIC
connection, including a Datagram-Flow-Id.
The lifetime of the proxy state is bound to the lifetime of the stream used
for the HTTP request. A UE and UPF can close the stream to terminate the
forwarding for that specific flow.
To support cases where the DL traffic for a traffic flow is using a different
QoS Flow (and thus a different MP-QUIC Connection) than UL traffic, it is
assumed that the Datagram-Flow-Id assigned for the UDP flow can be used in
different MP-QUIC Connections.
NOTE 3: The above assumption on Datagram-Flow-Id being \"global\" across MP-
QUIC Connections between UE and UPF depends on MASQUE work.
7\. Sending of PDUs: The MP-QUIC connection carries QUIC packets and each QUIC
packet carries one or more datagram frames (defined in draft-ietf-quic-
datagram [8]). The UE encapsulates the payload of the UDP packet (of the PDU)
in a QUIC datagram frame, together with the \"Datagram-Flow-Id\". Each QUIC
datagram frame thus contains the payload of a UDP packet, the payload of an IP
packet, or an Ethernet frame, depending of the type of traffic being proxied.
Since the QUIC datagram service is used, the QUIC connection provides an
unreliable transport service between the UE and the UPF.
The MP-QUIC connection carries QUIC packets via MP-QUIC uniflows. Each uniflow
is associated with an access (3GPP access or non-3GPP access) and has its own
congestion control state, as described in draft-deconinck-quic-multipath [10].
Editor\'s note: The usage of MASQUE with MP-QUIC has not been discussed in
IETF. Whether and how the CONNECT-UDP method and use of Datagram-Flow-Id will
be impacted is FFS. The MP-QUIC draft in [10] is not mature in IETF and
changes to different aspects are likely to happen.
8\. Once the UPF receives the QUIC packet with the QUIC datagram frame, the
UPF extracts the UDP payload, adds (re-creates) the appropriate UDP/IP headers
based on the \"Datagram-Flow-Id\", as described in draft-ietf-masque-connect-
udp [19], and forwards the PDU via N6.
The protocol stack in Figure 6.14.2-2 illustrates the content \"on the wire\"
for different interfaces.
Figure 6.14.2-2: UP protocol stack
9\. To coordinate what MP-QUIC Connection to use for a given QoS Flow, the UE
sends a HTTP message to the UPF (possibly together with the proxy request
described in bullet 4 above) including the QFI for which the MP-QUIC
Connection is used. Alternatively, the UE encodes the QFI into the Connection
ID that is provided to UPF during the QUIC Connection setup. This allows the
UE and UPF to associate the same QUIC Connection to the QoS Flow.
10\. Figure 6.14.2-3 explains (via an example) how the MPQUIC-PROXY steering
functionality is applied to route the traffic of an MA PDU Session in uplink:
a. The UE is assigned with three IP addresses: The IP\@3, which is the IP
address of the MA PDU Session, and two link-specific IP addresses, one for
3GPP access (IP\@1) and one for non-3GPP access (IP\@2). The scope of the
link-specific IP addresses is local, i.e. they are used only for UE-UPF
communication.
b. In the example scenario shown in Figure 6.14.2-3, it is assumed that two
QoS flows are assigned to the MA PDU Session. Hence, two QUIC connections are
established between UE and UPF. The UE uses the IP\@1 to establish MP-QUIC UL
uniflows over 3GPP access and uses the IP\@2 to establish MP-QUIC UL uniflows
over non-3GPP access. The UPF uses IP\@1 and IP\@2 to establish DL uniflows
over 3GPP access and non-3GPP access, respectively
c. The UP processing is schematically described below, taking an example with
up-link traffic and UDP-based application in the UE. On the UE side, each IP
packet that enters the IP interface associated with the MA PDU Session (refer
to Figure 6.14.2-3 for the \"step numbers\"):
(1) First, the IP packet goes through QoS Flow selection based on the QoS
Rules. This is similar to rel-16 ATSSS functionality.
(2) Then, the IP packet goes through the MP-QUIC Connection
Selection/Creation. A MP-QUIC Connection associated with the selected QoS Flow
is used to carry the IP packet.
(3) The IP packet then goes through the MASQUE functionality. In case a proxy
state for the given UDP flow (destination address + port) has not yet been
requested on this MP-QUIC Connection, the UE sends a proxy request (HTTP
request) to the UPF and includes destination server name + port. The UPF
replies with a 200 OK, and includes a new Datagram-Flow-Id. In case a new MP-
QUIC Connection was established in step 2, the UE also notifies the UPF about
the QFI for this MP-QUIC Connection. This step is further described in clause
6.14.3.2.
QUIC datagram payload is generated with the UDP payload of the IP packet, and
the Datagram-Flow-Id.
(4-6) Then the packet goes through the MP-QUIC protocol. The MP-QUIC protocol
selects an uniflow with a certain access type based on the ATSSS Rules
(steering mode etc) and measurements to send the packet i.e. a uniflow over
the selected access type is used for transmitting the QUIC packet.
The QUIC datagram frame is included in a QUIC packet (possibly with other
datagram frames of the same MP-QUIC connection) and goes to an access
interface (3GPP or non-3GGP) via the UDP/IP layers. The outer IP packet has
source address IP\@1 or IP\@2 and destination address an IP address of UPF,
which is provided to UE during the MA PDU Session establishment.
(7-8) When the UPF receives the GTP-tunnelled packet, it identifies the N4
Session based on the PDR, as normal. The UPF processes the MP-QUIC protocol
and delivers the QUIC datagram content to the MASQUE application.
(9) The UPF identifies the UDP flow based on the Datagram-Flow-Id in the QUIC
datagram frame and adds the appropriate UDP/IP headers based on the proxy
state.
(10) The UPF executes the QER, URR, FAR processing and sends the packet onto
N6 interface.
NOTE 4: The purpose of the stepwise description above is to explain and
exemplify the solution. Internal interfaces of UE and UPF are not to be
standardized by ATSSS.
Figure 6.14.2-3: Illustration of User-Plane operation (uplink direction, UDP
based application/PDU)
Sending of downlink data
11\. Downlink data is steered in a similar way, with the difference that UPF
uses N4 rules in order to determine the appropriate access and QoS Flow. Once
the UPF has determined the QoS Flow based on the QER(s), the UPF uses the
association between QoS Flow and MP-QUIC Connection established as described
in bullet 7 (above) to select the suitable MP-QUIC Connection. The MP-QUIC
protocol in UPF selects an uniflow with a certain access type based on the N4
Rules (steering mode etc) and measurements to send the packet i.e. a uniflow
over the selected access type is used for transmitting the downlink QUIC
packet. An example of UPF processing is shown in Figure 6.14.2-4.
When the UE receives the packet, the UE delivers the UDP payload to the
application.
In the case of Reflective QoS is used, i.e. the downlink packet carries a RQI,
the UE creates a \"UE derived QoS rule\" for the uplink traffic based on the
received DL traffic.
Figure 6.14.2-4: Illustration of UPF User-Plane operation (downlink direction,
UDP based application/PDU)
Other aspects
12\. Packet splitting is supported based on MP-QUIC functionality
13\. Round-trip and packet loss measurements per MP-QUIC uniflow is supported,
as specified in draft-ietf-quic-transport [6] and draft-deconinck-quic-
multipath [10]. Since each QUIC connection is transmitted on a specific QoS
Flow, this means that QUIC-PROXY supports round-trip measurements per QoS Flow
and packet loss measurements per QoS Flow.
The UPF can use QUIC PING frames, as described in [6], to verify that the UE
is still reachable over an access. or to check reachability to the peer. The
PING frames can be sent over one QUIC connection only per access or over
multiple QUIC connections (i.e. multiple QoS flows) per access.
14\. Since the original IP header (IP\@3) is not included in the packets sent
between UE and UPF, IP fragmentation is not supported. A suitable MTU would
need to be provided to the UE to avoid the need for IP fragmentation. Handling
of other parameters carried via IP and UDP headers, such as ECN, DSCP, IPv6
Extension headers, is discussed in draft-westerlund-masque-transport-issues
[20].
Editor\'s note: It is FFS whether this solution needs double-layer security
between the UE and the 5GS (radio level security + QUIC mandatory security).
If that is the case, it needs to be clarified how QUIC/DTLS security is set-
up.
### 6.14.3 Procedures
#### 6.14.3.1 MA PDU Session Establishment
This clause describes the MA PDU Session Establishment, with support for
MPQUIC-PROXY steering functionality. The call flow below is only showing a
subset of the messages.
Figure 6.14.3.1-1: MA PDU Session Establishment
The procedure is based on rel-16 MA PDU Session Establishment procedure, with
the following differences:
1\. The UE indicates support for MPQUIC-PROXY steering functionality.
3a. The SMF determines the MA PDU Session capability to support MPQUIC-PROXY,
based on UE capabilities and local configuration.
3b. The PCF authorizes the use of MPQUIC-PROXY and provides PCC Rules,
including steering information for QUIC-PROXY.
4a. The SMF initiates N4 Session Establishment and indicates to UPF the use of
MPQUIC-PROXY.
4b. The UPF provides MPQUIC-PROXY information to the SMF (proxy IP address).
5\. The SMF sends Namf_Communication_N1N2MessageTransfer with a PDU Session
Establishment Accept. The PDU Session Establishment Accept contains ATSSS
information such as MP-QUICK proxy address and ATSSS Rules with steering
information for MPQUIC-PROXY.
6-7. The PDU Session Establishment Accept is sent to the UE.
8\. The leg over non-3GPP access is added to the MA PDU Session.
9\. QUIC Connection(s) are established between UE and UPF. In order to allow
the UPF to use a QUIC connection for downlink traffic before UE needs it for
uplink traffic, the UE should initiate QUIC Connection establishment after MA
PDU Session Establishment, even if the UE does not have uplink traffic for
that QUIC Connection.
#### 6.14.3.2 Proxy related signalling
This clause describes the procedure for 1) how the UE requests proxying of UDP
packets, and 2) notifies the UPF about the QoS Flow - MP-QUIC Connection
association. This signalling takes place via a MP-QUIC Connection of the MA
PDU Session user plane.
Figure 6.14.3.2-1: Proxy related signalling
1\. The UE determines that there is a need to request proxying towards a new
destination IP address / port, or to notify the UPF about the QFI associated
with a newly established MP-QUIC Connection.
2\. The UE sends a HTTP Request over a specific MP-QUIC Connection. To request
proxying of PDUs, the UE sends a HTTP Request with the proxy information
(destination address and port), as described in draft-ietf-masque-connect-udp
[19]. To notify the UPF about the QFI for a newly established MP-QUIC
Connection, the UE sends a HTTP Request including the QFI.
3\. The UPF sets up the appropriate proxying state, and/or stores the QFI
associated to the MP-QUIC Connection, depending on the content of step 2. The
UPF replies with a HTTP Response. If step 2 was a request for proxying, the
UPF provides a Datagram-Flow-Id in the response.
4\. User data is carried between UE and UPF via the MP-QUIC Connection and
proxied by UPF.
NOTE: As described in the draft-ietf-masque-connect-udp [19], step 4 may be
done before step 3 to reduce delays.
### 6.14.4 Impacts on services, entities, interfaces and IETF protocols
The solution has the following impacts:
Services/Interfaces
\- Extensions will be needed to SM NAS protocol, Npcf service and N4 protocol
to support the new QUIC-PROXY steering functionality.
Network Functions and entities
UE
\- Support MP-QUIC protocol and the use of QUIC proxy in the network, based on
IETF protocols described below.
SMF
\- Support for handling new Steering Functionality towards PCF, UPF and UE.
UPF
\- Support for MP-QUIC protocol and QUIC proxy (MASQUE), based on IETF
protocols described below.
PCF
\- Support for handling new Steering Functionality
IETF protocols
The solution is dependent on the following IETF drafts:
1\. The QUIC protocol specified in draft-ietf-quic-transport [6] along with
the loss detection and congestion control specified in draft-ietf-quic-
recovery [7]; and
2\. The QUIC extensions specified in draft-ietf-quic-datagram [8] for
supporting unreliable datagram transport;
3\. The QUIC proxy extensions specified in draft-ietf-masque-connect-udp [19]
for support of proxying UDP payload;
4\. The multipath extensions for QUIC, as defined in draft-deconinck-quic-
multipath [10].
Editor\'s note: The draft-deconinck-quic-multipath is an individual draft.
IETF WG adoption of is still FFS.
In order to support IP proxying (for IP-based PDU Session types) and Ethernet
PDU Sessions, additional work is needed.
## 6.15 Solution #15: Enhancements to Load Balancing steering mode operation
### 6.15.1 Introduction {#introduction-15}
This solution addresses KI#1 on Additional Steering Modes.
As specified in ATSSS Rel-16, the traffic of MA PDU session could be
distributed across one or both accesses by using different steering modes.
There are four steering modes as defined in Rel-16, i.e. Active-Standby,
Smallest Delay, Priority-based and Load balancing. All the Rel-16 steering
modes are decided by the network side and performed by the UE and UPF based on
the link performance measurement. For example, if one access becomes
unavailable, the UE and UPF can switch all the traffic to the other available
access. However, except the access available/unavailable status, the UE and
UPF cannot flexibility distribute the traffic over both accesses according to
the link performance in real time. To be more specific, for the Load balancing
mode, the traffic splitting weight is statically set by the network based on
the operators\' requirement without considering the link performance
measurement. For the Priority-based mode, the traffic can be steered on
alternative access only when one access is congested. In summary, none of the
rel-16 steering modes allow the UE or the UPF to adjust the usage of the
accesses dynamically based on the link status. Not accounting link performance
conditions in existing modes can impact service experience for some
applications which are sensitive to delay and/or loss.
### 6.15.2 High-level Description
Extending the steering mode configuration with link performance conditions as
an option enables PCF to authorize when needed extra flexibility for both the
UE and the UPF to perform the traffic steering accounting the mode intention
but also the dynamic link characteristics.
It is proposed to extend the configuration of Load Balancing mode with access
performance indicator thresholds as an option. Since PCF does not have a mean
to provide different performance settings per access it is proposed that
setting of such thresholds is common to both accesses. Thresholds are based on
existing QoS parameters and inline with existing QoS model. Threshold values
should thus be based on QoS requirements of the applications/SDFs. The
adaptation ratio avoids dramatic variations of traffic throughput in case of
(frequent) link status changes, enabling a more gentle adaptation mechanism.
In the case of Load Balancing steering mode, the PCF can indicate any
combination of Maximum RTT and UL/DL Maximum Packet Loss Rate in the PCC rule.
The parameters are common for 3GPP and non-3GPP access and provided per PCC
rule (i.e. per SDF). Jitter, as proposed in Solution 3, is not considered in
the current 3GPP QoS model and is thus not taken into account in ATSSS.
Alternatively, the SMF derives Maximum RTT and UL/DL Maximum Packet Loss Rate
based on the rel-15/16 QoS parameters in the PCC rule.
Editor\'s note: It is FFS whether the ATSSS QoS parameters/thresholds would be
derived by PCF or SMF.
The SMF determines Maximum RTT and UL/DL Maximum Packet Loss Rate per QoS Flow
and provides to the UE and UPF as part of the ATSSS information.
The UE (and UPF) shall load-balance the traffic by accounting the weight
factor configured and initiate the monitoring of the configured access
performance indicators. If the performance of both accesses is within all the
configured thresholds, the UE (or UPF) shall consider both accesses valid for
steering and load balance based on the configured weight factor. If the
performance of an access is not within any of the configured thresholds, the
UE (or UPF) shall not consider this access as valid for steering and thus
decrease the Load Balancing weight by an implementation specific amount. The
adjustment of the Load Balancing weight avoids dramatic variations of traffic
throughput in case of (frequent) link status changes, enabling a more gentle
adaptation mechanism. The UE and UPF may decrease the Load Balancing weight
with a lower or higher amount depending on how much an access exceeds a
threshold. When all thresholds are met again. UE (or UPF) shall consider an
access valid again when all thresholds are met again and reset the Load
Balancing weight as initially indicated by PCF. In practice this means the UE
(or UPF) will start and stop sending traffic based on the real time link
performance so the actual average Load Balancing over a time period resulting
can differ from the one configured by PCF but will the benefit of providing a
better service experience to subscribers. If none of the access are considered
valid, UE (or UPF) shall steer traffic to a default access configured by PCF
and notify PCF.
Editor\'s note: It is FFS if thresholds, and if so what thresholds, are
applicable to other steering modes.
Editor\'s note: It is FFS how the default access is configured for UE (or UPF)
when both accesses are not valid and how to notify the PCF.
See Figure 6.15.2-1 for details considering the load balancing example, where
one single packet flow is shown as an example for UL and DL respectively. The
weight factor for the traffic over each access is provided by PCF 50% for
3GPP/N3GPP in both UL and DL. In this example the application is latency
sensitive and PCF provides maximum RTT.
Initially, both the 3GPP and non 3GPP access RTT is below the threshold and UE
and UPF schedulers e.g. use round robin mechanism in such a way that 50%
weight is enforced. However, at some point of time, the UL delay in 3GPP
access increases beyond the maximum threshold In this case, the UE reduces the
traffic via that access through reducing the Load Balancing weight by 100%.
The UE may also have chosen a different Load Balancing weight, e.g. 20% over
3GPP access and 80% over non-3GPP access. Once the situation is recovered, the
UE scheduler will apply again the round robin mechanism considering the 50%
weight. If the traffic distribution is observed for a longer period, e.g.
during the busy hour, the effective average load balancing weight achieved in
UL will be less than the prescribed 50% in UL, e.g.30% for UL and 50% for DL
on 3GPP access, and 70% for UL and 50% for DL on non 3GPP access, as shown in
the figure. The \"longer term\" load balancing weight may thus differ from the
weight factor prescribed in the PCC rule, since the thresholds and access link
conditions have been taken into account based on the thresholds provided to UE
and UPF. The target for UE/UPF is however always to fulfil the operator\'s
prescribed weight provided by PCF, if the link conditions allow it. In this
way the operator use case is maintained at the same time as access link
conditions are taken into account to ensure a good QoE.
NOTE 1: It is up to the UE and UPF scheduler implementation on how to schedule
when several performance conditions are configured. It is up to the
implementation how frequently the KPI measurements are monitored.
Figure 6.15.2-1: Steering mode example (average weight over some time)
This steering mode enhancement can be applied by the MPTCP, ATSSS-LL and
(MP)QUIC steering functionalities.
### 6.15.3 Procedures
The MA PDU session establishment procedure is based on the signalling flow in
clause 4.22.2 with the following changes:
\- In step 1, the UE provides Request Type as \"MA PDU Request\" in UL NAS
message and its ATSSS capabilities as defined in TS 23.501 [3] clause 5.32.2.
The UE includes in its ATSSS capabilities MPTCP functionality with any
steering mode and/or ATSSS-LL functionality with any steering mode. The UE
also indicates its capability to use a steering mode with thresholds.
\- In step 7, if dynamic PCC is to be used for the MA PDU session, the SMF
includes the ATSSS capabilities of the MA PDU session. The PCF provides PCC
rules which include the MA PDU session control information which includes the
Steering Functionality and the Steering mode. When the steering mode in the MA
PDU session control information indicates Load Balancing, it also includes the
traffic splitting weight set by the network based on the operators\'
requirement together with the thresholds for Maximum RTT, UL/DL Maximum Packet
Loss Rate. Alternatively the SMF derives the Maximum RTT, UL/DL Maximum Packet
Loss Rate based on the existing rel-15/16 QoS parameters in the PCC rule. The
SMF, from the received PCC rules, derives the ATSSS rules and N4 rules that
will be sent to the UE and the UPF respectively. Both the UE and UPF will
control the traffic steering, splitting, and switching in the UL/ DL direction
based on the combination of link status and the threshold for RTT, UL/DL
Maximum Packet Loss Rate.
\- In step 8, the SMF selects one or more UPFs as defined TS 23.502 [4] clause
6.3.3.3.
### 6.15.4 Impacts on services, entities, interfaces and IETF Protocols
This solution will impact the following entities in 5GS:
\- SMF: Supports to select the UPF with support of the new steering mode
capabilities.
\- PCF: Supports to authorize the new steering mode capabilities for the SDF.
\- UPF: Supports the new steering mode capabilities.
\- UE: Supports the new steering mode capabilities.
\- 5G-AN/ NG RAN: No impact.
# 7 Evaluation
Editor\'s note: This clause will provide a general evaluation of the
solutions.
## 7.1 Evaluation for KI#1: Steering Modes
**General:**
The following steering modes are proposed in Rel-17 for addressing KI#1:
\- Autonomous Steering Mode (Solution #2).
\- Autonomous Steering Mode with Advanced PMF (Solution #3).
\- Redundant Steering Mode (Solution #4).
\- RTT Difference based Steering Mode (Solution #11).
\- UE Assisted Traffic Steering Mode (Solution #12).
They can be divided into four categories depending on what they are trying to
achieve:
A. Enable more flexibility in UE/UPF to select best traffic distribution (Sol
#2, 3) in order to maximize the bandwidth/throughput..
B. Take additional performance parameters into account, such as packet loss
rate of the link vs the maximum packet loss rate for the service, the RTT
differences and other thresholds etc as defined in Sol #2, 3, 11 and the
steering modes suggested in Sol #1.
C. Add packet duplication (bi-casting) as a way to reduce impacts of packet
loss (Sol #4).
D. Add a possibility for the UE to influence the steering mode and/or steering
mode parameters such as the weight (Sol #12).
**Category A, B proposals:**
These type of solutions aims to address some limitations where each rel-16
steering mode is focusing too much on one specific aspect (e.g. fixed load-
balancing weight or lowest RTT).
The additional performance parameters of the new steering modes described for
Categories B can also be applied to the existing Rel-16 steering modes where
thresholds can be added e.g. for maximum packet loss and packet delay budget
and then, providing a room of freedom for scheduler implementations. That
would allow each steering mode covers a larger set of behaviours, instead of
being limited to only consider a single characteristic (e.g. RTT).
**Solutions 2/3:**
There are three main aspects proposed in solutions 2/3. They are analysed
below:
1) Autonomous steering by UE and UPF in order to maximize the
bandwidth/throughput:
\- Such autonomous steering mode (in order to maximize the
bandwidth/throughput) provides flexibility to both the UE and the UPF to
maximize the resource usage of the two accesses considering the situation of
the link and UE/UPF status, so that the user can get best service experience /
throughput, which cannot be reached by Rel-16 steering modes which focus on a
single characteristic (e.g. RTT or weight) and fixed splitting rate.
To be more specific, even with the extension of thresholds on the existing
Rel-16 steering mode, where the thresholds define the conditions on the access
availability, the UE and UPF shall follow the Rel-16 steering modes in most
cases (i.e. normally both accesses are available according to the threshold
value). For example, if the Rel-16 load-balancing weight factors are set to
fixed rates 50% and 50% per each access for UL, and in the case the transport
bandwidth is different between 3GPP and non3GPP, e.g. 50Mbps over 3GPP, and
100Mbps over non3GPP, the UE cannot fully take advantage of 100Mbps via non
3GPP access as not satisfying the fixed 50% and 50% weight factors
requirement.
2) Thresholds:
Thresholds provided to the UPF may be a useful addition as proposed in
Solution #2/#3:
\- Sol#3 suggest that PCF provides thresholds in PCC rules and that thresholds
are set per IP Flow and per access.
\- There is no explicit relation between the thresholds described in Sol#3 and
the QoS requirements for an SDF/application but the PCF when setting the
threshold needs to consider the QoS requirements for an SDF/application.
Thresholds parameter defined in Sol#3 are independent parameters per access,
but can also be defined to be access independent, considering the QoS
requirements are independent of access type. It is also proposed to introduce
loss rate thresholds for non-GBR traffic. Although for now the Maximum Packet
Loss Rate value is currently only applied to GBR, it doesn\'t mean the packet
loss impact can be ignored for the non-GBR traffic. Obviously, the more
packets are lost, the worse service quality will be, not only for GBR but also
for non-GBR. The packet loss rate over each access can be calculated in real-
time based on the MPTCP, MPQUIC or the extension of PMF as defined in clause
6.3.2.1.
\- Solution#3 also proposes jitter threshold. Although there is no jitter
value defined in the existing 5G QoS framework, it is an important KPI to
impact the service quality. Jitter\'s impact on the service quality can be
measurable, i.e. jitter threshold can be configured based on the requirement
of application, e.g. according to the SLA between the operator and service
provide. Finally, the jitter over each access can be calculated in real-time
based on the MPTCP, MP-QUIC or the extension of PMF as described in clause
6.3.2.1. Therefore it is necessary and valuable to consider jitter in ATSSS to
enhance the service QoE.
3) Enhanced PMF measurements:
\- The benefits of performing RTT measurements per QoS flow improves the
precision of RTT measurements and has small impacts to the PMF protocol.
\- Jitter measurements reuses RTT measurement message for Jitter calculation.
Some services such as game, IMS voice are sensitive to jitter, therefore it is
possible that PCF can configure such threshold.
\- Packet loss rate measurements may be useful in case loss rate thresholds
are introduced. In case a PMF echo packet is lost, the UE or the UPF can
resend PMF request or carry the lost information in the subsequent PMF
message. Details can be left to stage 3.
It should be noted that jitter and packet loss rate measurement do not
introduce any new PMF messages, rather just need to extend the existing PMF
message for RTT measurement as described in clause 6.3.2.1.
\- As described in clause 6.3.2.3,
\- for option 1, additional PMF addresses (e.g. IP address or ports) may needs
to be allocated by the UPF.
\- for option 2, UE and UPF needs to ignore QoS rule(s) and N4 rule(s) for PMF
messages.
\- UE may provide AN resource -- QoS flow mapping information to the UPF via
PMF message. For the case where measurements are primarily impacted by what AN
resources the QoS Flow is assigned to, this can assist the UPF to selectively
perform measurement via one or some of the QoS flows and help avoid measuring
on two QoS Flows sharing the same AN resources.
**Solution 11:**
Solution #11 proposes a new steering mode to take RTT difference into account.
The functionality of RTT difference based steering mode can however be
achieved through proper implementation of other steering modes by UE/UPF
implementation simply taking the RTT difference into account when making
traffic switching/splitting decisions.
**Category C proposal:**
**Solution 4:**
The Solution states that it is targeting \"loss rate sensitive traffic, such
as IMS signalling, video, and some TCP-based traffic\". This redundant
transport is only initiated when one access cannot satisfy the loss rate so it
could be useful, which is much better than retransmission after packet loss.
For QUIC or TCP based applications, the value of redundant transmission is not
clear since those applications anyway rely on retransmissions by the transport
layer. Usage of ATSSS with IMS has not be studied properly and introducing a
new steering mode specifically for IMS would require further investigation
also from an IMS point of view.
**Category D proposal:**
**Solution 12** (UE-assisted traffic steering mode) proposes to let the UE
influence the steering mode and/or steering mode parameters. This may be based
e.g. on UE battery consumption and battery level. Getting such feedback from
the UE may be valuable to achieve a good user experience for ATSSS, but it
needs to be ensured that operator control is maintained. The network controls
whether or not the UE is allowed to use this mode/operation. Whether
additional network control is needed while the UE is operating in the UE
assisted steering mode (e.g. support for the PCF to set boundaries of the
steering decisions by UE and UPF) needs further study.
## 7.2 Evaluation for KI#2: Steering Functionality
The following aspects of each solution is evaluated:
1\. Granularity of QUIC Connections.
2\. QUICv1 vs MP-QUIC.
3\. UP model: tunnelling vs proxy and transport resource consumption.
4\. Control/Trigger of QUIC Connection setup by the UE.
5\. Mapping UL traffic in UE to QUIC Connection.
6\. Association between QoS Flow and QUIC Connection in UPF.
7\. QoS Rule and QER enforcement.
8\. Support for link performance measurements.
NOTE: Topics 4-7 are somewhat coupled and need to be analysed together.
Topic 1: Granularity of QUIC Connections
+----------------+----------------+----------------+----------------+ | Topic | Solution #1, | Solution #7, | Solution #13, | | | #6 | #8 | #14 | +================+================+================+================+ | Granularity of | QUICv1: Per | QUICv1: Per IP | QUICv1: Per | | QUIC | access and per | Flow (common | access and per | | Connections | QoS Flow. | across | QoS Flow. | | | | accesses). | | | | MP-QUIC: Per | | MP-QUIC: Per | | | QoS Flow and | MP-QUIC: Per | QoS Flow. | | | per steering | IP Flow. | | | | mode. | | | +----------------+----------------+----------------+----------------+
Solution #7,8 differs from the other solutions in that it has one QUIC
Connection per IP Flow, which is common across the two accesses (even for
QUICv1).
Having one QUICv1 Connection across two accesses, possibly with quite
different characteristics in terms of RTT, loss rate etc., a special QUIC
implementation may be able to take this into account. The goal with having one
QUIC connection across two accesses is to support traffic splitting (with
support for re-ordering). But in order to do that it it is preferable to go
with a MP-QUIC based approach that has inherent support for using multiple
paths with different characteristics.
Sol #7,8 also propose to use one QUIC Connection per IP Flow. This needs to
setup new QUIC Connections for every IP Flow. Sol#6 propose to use a MP-QUIC
Connection per QoS Flow and per steering mode as a way to avoid having to
support multiple steering modes per MP-QUIC Connection.
One aspect to consider is that MP-QUIC is not yet mature in IETF. The ATSSS
solution using MP-QUIC therefore may need to be adjusted in order to work with
the final outcome from IETF.
Topic 2: QUICv1 vs MP-QUIC and support for traffic splitting/switching
+----------------+----------------+----------------+----------------+ | Topic | Solution #1, | Solution #7, | Solution #13, | | | #6 | #8 | #14 | +================+================+================+================+ | QUICv1 vs | Both variants | Both variants | Both variants | | MP-QUIC | supported | supported | supported | +----------------+----------------+----------------+----------------+ | Traffic | Switching | Switching and | Switching | | switc | supported. | splitting | supported. | | hing/splitting | | supported. | Splitting | | with QUICv1 | Splitting | | likely to | | | likely to | | cause | | | cause | | out-of-order | | | out-of-order | | packets and | | | packets and | | requires | | | requires | | application | | | application | | level support. | | | level support. | | | +----------------+----------------+----------------+----------------+ | Traffic | Switching and | Switching and | Switching and | | switc | splitting | splitting | splitting | | hing/splitting | supported. | supported. | supported. | | with MP-QUIC | | | | +----------------+----------------+----------------+----------------+
All three solution pairs have variants for both QUICv1 and MP-QUIC.
None of the QUICv1 solutions provide full multi-path capability as there are
trade-offs in all solutions. Solution #7 uses a QUIC connection over the two
accesses with the aim to support traffic splitting, but this may need specific
implementation for congestion control as described under topic #1 above.
Solutions #1 and #13 do not support re-ordering of packets, and in case of
packet splitting the packets may thus arrive out-of-order. Solutions #1 and
#13 thus is similar to ATSSS-LL in that respect.
A full multi-path capable solution (based on MP-QUIC) is thus preferable over
the QUICv1 based approaches.
Topic 3a: UP model: tunnelling vs proxy
+----------------+----------------+----------------+----------------+ | Topic | Solution #1, | Solution #7, | Solution #13, | | | #6 | #8 | #14 | +================+================+================+================+ | UP model: | Tunnelling of | QUIC proxying. | UDP proxying | | tunnelling vs | any traffic | | initially. | | proxy | (IP, | | | | | Ethernet). | | IP proxying | | | | | later. | | | | | | | | | | Ethernet | | | | | proxying is | | | | | FFS. | +----------------+----------------+----------------+----------------+
The user plane model differs between the three solutions. Sol #1,6 is using
tunnelling of the PDU over a QUIC/UDP/IP between UE and UPF, while Sol
#7,8,13,14 are based on QUIC proxying where the UDP/IP header does not need to
be duplicated between UE and UPF. Sol #7,8 is based on using MASQUE proxy with
QUIC, or a 3GPP-specific \"transparent\" variant, while Sol #13,14 is based on
MASQUE proxy currently defined for QUIC by IETF.
Sol#7/8 can use a 3GPP-specific \"transparent\" proxying method.
Topic 3b: Transport resource consumption
+-------------+-------------+-------------+-------------+-------------+ | | Impact on | Impact on | | | | | User plane | Entities | | | | | transport | and | | | | | | interfaces | | | +=============+=============+=============+=============+=============+ | | Transport | Delay for | Impact on | Impact on | | | resource | packet | entities | interfaces | | | consumption | forwarding | | | +-------------+-------------+-------------+-------------+-------------+ | Solution 1 | 1) | 1) | Additional | **N1:** | | QUIC-LL | QUIC/IP/UDP | Multiplex: | impacts, | QUIC-LL | | | header with | Assemble/ | besides the | capability, | | | at least | disassemble | impacts as | QUIC | | | additional | different | described | connection | | | 29 bytes | datagram | in | setup | | | per PACKET | frames | cl | i | | | (for IPv4) | to/from | ause 6.1.6: | nformation, | | | or 48 bytes | single QUIC | | new ATSSS | | | (for IPv6). | packet | UE: | rule, new | | | | | | QoS rule. | | | 2) PING | 2) | 1) Create | | | | frame for | Add/Remove | PING frame | **N | | | the access | QUIC/UDP/IP | when there | 4:** QUIC-LL | | | without | header per | is no real | Address | | | real | packet | traffic | I | | | traffic. | | over the | nformation, | | | | 3) Twice | access and | new MARs, | | | | PDR mapping | calculation | new QERs | | | | per packet, | on RTT, | | | | | one for | packet loss | | | | | outer | and jitter. | | | | | QUIC/IP/UDP | | | | | | header, the | 2) Handle | | | | | other one | new QoS | | | | | for the | rule for DL | | | | | inner IP | only QoS | | | | | header. | flow to | | | | | | establish | | | | | | and | | | | | | maintain | | | | | | the QUIC | | | | | | connection. | | | | | | | | | | | | UPF: | | | | | | | | | | | | 1) Create | | | | | | PING frame | | | | | | when there | | | | | | is no real | | | | | | traffic | | | | | | over the | | | | | | access. | | | | | | | | | | | | 2) Twice | | | | | | PDR mapping | | | | | | for outer | | | | | | QUIC/IP/UDP | | | | | | header and | | | | | | inner IP | | | | | | header | | | | | | separately. | | | | | | | | | | | | SMF: | | | | | | | | | | | | 1) Create | | | | | | QoS rules, | | | | | | and QoS | | | | | | Flow level | | | | | | QoS | | | | | | parameters | | | | | | (GBR case), | | | | | | for DL only | | | | | | QoS flow | | | | | | without PCC | | | | | | rules. | | +-------------+-------------+-------------+-------------+-------------+ | Solution 13 | 1)QUIC | 1) | Additional | **N1:** | | proxy QUIC | header with | Multiplex: | impacts, | QUIC-LL | | | at least | Assemble/ | besides the | capability, | | | additional | disassemble | impacts as | QUIC | | | 1 byte per | different | described | connection | | | packet. | datagram | in | setup | | | | frames | cla | i | | | 2) PING | to/from | use 6.13.4: | nformation. | | | frame for | single QUIC | | | | | the access | packet | UE: | **N4:** | | | without | | | QUIC-LL | | | real | 2) | Same as | Address | | | traffic | Add/Remove | solution 1. | Information | | | | QUIC | | | | | | header, and | UPF: | | | | | update the | | | | | | IP/UDP | Same as | | | | | header per | solution 1, | | | | | packet | except the | | | | | | twice PDR | | | | | 3) 0- 1 | mapping. | | | | | RTT delay | | | | | | for HTTP | SMF: | | | | | message | | | | | | handling | Same as | | | | | before the | solution 1. | | | | | user data | | | | | | processing | | | +-------------+-------------+-------------+-------------+-------------+ | ATSSS-LL | PMF message | No delay | UE/UPF: | No impact | | | (3 bytes | | Create and | | | | per each | | handle the | | | | PMF | | PMF message | | | | message) | | per QoS | | | | | | flow. | | | | | | Calculation | | | | | | for RTT, | | | | | | packet loss | | | | | | and jitter. | | | | | | | | | | | | Other | | | | | | entities: | | | | | | **No | | | | | | impact** | | +-------------+-------------+-------------+-------------+-------------+ | Solution 6 | 1) | Add/Remove | As describe | | | | QUIC/IP/UDP | MP | in | | | MPQUIC-LL | header with | QUIC/UDP/IP | c | | | | at least | header per | lause 6.6.6 | | | | additional | packet. | | | | | 29 bytes | | | | | | per PACKET | | | | | | (for IPv4) | | | | | | or 48 bytes | | | | | | (for IPv6). | | | | +-------------+-------------+-------------+-------------+-------------+ | Solution 7 | 1) QUIC | 1) | As defined | | | M | header with | Add/Remove | in | | | PQUIC-based | at least | MPQUIC | c | | | solution | additional | header, and | lause 6.7.4 | | | (non-t | 1 byte per | update the | and 6.14.4 | | | ransparent) | packet. | IP/UDP | | | | / | | header. | | | | | | | | | | Solution14 | | 2) 0-1 RTT | | | | | | delay (HTTP | | | | Proxy | | message | | | | MPQUIC | | exchange). | | | | (NOTE 1) | | | | | +-------------+-------------+-------------+-------------+-------------+ | Solution 7 | 1) QUIC | Add/Remove | As defined | | | | header with | QUIC header | in | | | M | at least | per packet | c | | | PQUIC-based | additional | | lause 6.7.4 | | | solution | 1 byte per | | | | | (t | packet. | | | | | ransparent) | | | | | +-------------+-------------+-------------+-------------+-------------+ | Solution 8 | 1) QUIC | Add/Remove | As defined | | | | header with | QUIC header | in | | | QUIC-based | at least | per packet | cla | | | solution | additional | | use 6.8.4.1 | | | (t | 1 byte per | | | | | ransparent) | packet. | | | | +-------------+-------------+-------------+-------------+-------------+ | Solution 8 | 1) QUIC | 1) | As defined | | | | header with | Add/Remove | in | | | QUIC-based | at least | QUIC header | cla | | | solution | additional | | use 6.8.4.2 | | | (non-t | 1 byte per | Header, and | | | | ransparent) | packet. | update the | | | | | | IP/UDP | | | | | | header | | | | | | | | | | | | 2) 1 RTT | | | | | | delay (HTTP | | | | | | message | | | | | | exchange) | | | +-------------+-------------+-------------+-------------+-------------+
NOTE 1: As the MPQUIC-based solution 7 (non-transparent) and MPQUIC proxy
solution 14 are similar in terms of transport resource consumption, they are
treated as one proxy MPQUIC solution in the evaluation.
Sol #1/6 tunnels the full PDU in a QUIC datagram and thus has a higher per-
packet overhead than the proxy solutions. For a IPv6 PDU there is e.g. 48 byte
UDP/IP header in the QUIC frame, compared to a 2-byte flow-id in the proxy
method. The tunnelling approach is however more transparent to the PDU Session
type since the full PDU is encapsulated. The proxying method requires explicit
support per proxied packet type (UDP, IP, Ethernet), and solution #13/14
initially supports UDP with later extensions for IP and potentially Ethernet,
up to potential IETF support.
Topic 4: Control/Trigger of QUIC Connection setup by the UE
+----------------+----------------+----------------+----------------+ | Topic | Solution #1, | Solution #7, | Solution #13, | | | #6 | #8 | #14 | +================+================+================+================+ | C | Triggered by | Triggered when | Triggered when | | ontrol/Trigger | \"QUIC | UE has a new | UE receives a | | of QUIC | Connection | UDP/IP Flow | QoS Rule with | | Connection | Setup | that is to be | a new QFI. | | setup by the | information\" | proxied. | | | UE | sent from UPF | | Can | | | to SMF and | | alternatively | | | then to the | | be triggered | | | UE. | | by \"QUIC | | | | | Connection | | | | | Setup | | | | | information\" | | | | | similar to | | | | | Sol#1/6. | +----------------+----------------+----------------+----------------+
In the case that a QUIC Connection per QoS Flow is applied, two options
remain:
\- Triggered by \"QUIC Connection Setup information\" sent from UPF to SMF to
UE
\- Triggered when UE receives a new QoS Rule
The \"QUIC Connection Setup information\" is an explicit request from the
network to setup a QUIC connection to a specific IP address and port in UPF.
The use of QoS Rule is a more implicit trigger to setup a QUIC Connection
whenever a new QFI is activated.
Both options seem feasible. The choice depends also on how aspects related to
mapping UL traffic in UE to QUIC Connection, and mapping between QoS Flow and
QUIC Connection should be done (see topics 5 and 6 below).
Topic 5: Mapping UL traffic in UE to QUIC Connection
+----------------+----------------+----------------+----------------+ | Topic | Solution #1, | Solution #7, | Solution #13, | | | #6 | #8 | #14 | +================+================+================+================+ | Mapping UL | UE determines | Not well | UE determines | | traffic in UE | QFI (based on | described. | QFI (based on | | to QUIC | QoS Rule) and | | QoS Rule) and | | Connection | access (based | UE has local | access (based | | | on ATSSS | association | on ATSSS | | | Rules). | between IP | Rules). | | | | Flow and QUIC | | | | The UE then | Connection. | The UE then | | | has local | | has local | | | association | (UE selects | association | | | between QFI, | QFI based on | between QFI, | | | access and | QoS Rule and | access and | | | QUIC | access based | QUIC | | | Connection. | on ATSSS | Connection. | | | | Rules). | | +----------------+----------------+----------------+----------------+
All solutions decouple access selection (based on ATSSS Rules) and QoS Flow
selection (based on QoS Rules). The UE uses the association between access
type, QFI and QUIC Connection that was created when the QUIC Connection was
established.
Topic 6: Association between QoS Flow and QUIC Connection in UPF
+----------------+----------------+----------------+----------------+ | Topic | Solution #1, | Solution #7, | Solution #13, | | | #6 | #8 | #14 | +================+================+================+================+ | Association | Determined by | Solution uses | When UE | | between QoS | UPF, when | separate QUIC | initiates a | | Flow and QUIC | providing | Connection per | QUIC | | Connection in | \"QUIC | IP flow. The | Connection | | UPF | Connection | association to | setup, | | | Setup | QoS Flow is | triggered by a | | | information\" | thus based on | new QFI being | | | to SMF. | the QoS of the | activated, the | | | | IP flow. | UE informs UPF | | | | | via MASQUE | | | | | protocol. | | | | | | | | | | Alternatively, | | | | | the UE informs | | | | | UPF via QUIC | | | | | Connection ID. | | | | | | | | | | Can also be | | | | | determined by | | | | | UPF, when | | | | | providing | | | | | \"QUIC | | | | | Connection | | | | | Setup | | | | | information\" | | | | | to SMF as in | | | | | Sol#1/6. | +----------------+----------------+----------------+----------------+
Sol #1, 6 uses explicit \"QUIC Connection Setup information\" determined by
UPF for each QFI, which is then provided to the UE. This ensures that UE and
UPF have the same mapping between QFI and QUIC Connection.
For Sol #7, 8, since a separate QUIC Connection is established per UDP/IP
flow, the UPF knows to map downlink traffic for that UDP/IP flow to that QUIC
Connection.
Sol #13, 14 assumes that the UE initiates a new QUIC Connection when a new QFI
(in a QoS Rule) is received. The UE then also informs UPF via MASQUE protocol
(or the QUIC Connection ID) what QFI the QUIC Connection refers to. This
ensures that UE and UPF have the same mapping between QFI and QUIC Connection.
As alternative, the solution also described the use of \"QUIC Connection Setup
information\" similar to Sol#1/6.
In the case a QUIC Connection per QoS Flow is applied, the two options in
Sol#1,6 and Sol#13,14 remain. Both options seem feasible. This topic is
however also related to 6 and 7 below.
Topic 7: QoS Rule and QER enforcement
Topic Solution #1, #6 Solution #7, #8 Solution #13, #14
* * *
QoS Rule and QER enforcement QoS Rule and QER acting on inner header. QoS Rule
and QER acting on inner header. QoS Rule and QER acting on inner header.
All solutions apply QoS Rules (and QER) to the inner header as in rel-16. This
requires that the UE needs to provide the QFI as \"metadata\" to the packet
processing functionality after the QUIC packet has been created (and possibly
been encrypted). This option is also more straightforward when it comes to
Reflective QoS and easier to support in SMF since the SMF does not need to
generate special QoS Rules for the QUIC Connections.
For the UPF, applying QER and URR on SDF granularity is required. For the UE,
either option can work, but there is an open issue on how to support
Reflective QoS in case QoS Rules are applied to the outer header.
Topic 8. Support for link performance measurements
+----------+----------+----------+----------+----------+----------+ | | Active | Smalle | Priori | Impact | | | | -standby | st-Delay | ty-based | on UE | | | | | | | and UPF | | | | | | | to | | | | | | | achieve | | | | | | | these | | | | | | | meas | | | | | | | urements | | | | | | | and | | | | | | | report | | +==========+==========+==========+==========+==========+==========+ | | Access | RTT | Co | UE | UPF | | | avai | meas | ngestion | | | | | lability | urement. | meas | | | | | mea | | urement. | | | | | surement | | | | | | | and | | | | | | | report. | | | | | +----------+----------+----------+----------+----------+----------+ | Solution | PING | per QoS | QUIC | 1) | 1) | | 1 | frames | flow | loss | Create | Create | | QUIC-LL | per QoS | with | d | PING | PING | | | flow (as | real | etection | frames | frames | | | mea | path | and | for UL | for UL | | | surement | load. | co | to | to | | | result | | ngestion | measure | measure | | | can be | | control. | access | access | | | d | | | avail | avail | | | ifferent | | | ability. | ability. | | | per QoS | | | | | | | flow); | | | 2) | 2) | | | UL and | | | Create | Create | | | DL | | | ACK | ACK | | | sep | | | frames | frames | | | arately. | | | for the | for the | | | | | | received | received | | | | | | packets. | packets. | | | | | | | | | | | | | 3) | 3) | | | | | | Measure | Measure | | | | | | RTT and | RTT and | | | | | | co | co | | | | | | ngestion | ngestion | | | | | | based on | based on | | | | | | QUIC | QUIC. | +----------+----------+----------+----------+----------+----------+ | Solution | The same | per QoS | The same | The same | The same | | 13 proxy | as | flow in | as | as | as | | QUIC | solution | real | solution | solution | solution | | | 1. | path | 1. | 1. | 1. | | | | load. | | | | +----------+----------+----------+----------+----------+----------+ | ATSSS-LL | Per | per PDU | UE/UPF | 1) | 1) | | | access | Session | implem | Create | Create | | | by | with | entation | PMFs to | PMFs to | | | in | real | as | measure | measure | | | dication | path | defined | RTT. | RTT. | | | from the | load, | in | | | | | UE (as | with the | Rel-16. | 2) | 2) | | | Rel-16). | same | | Control | Control | | | | accuracy | | co | co | | | | as | | ngestion | ngestion | | | | solution | | as | as | | | | 1 and | | Rel-16. | Rel-16. | | | | 13. | | | | +----------+----------+----------+----------+----------+----------+
All QUIC based solutions can perform link performance measurements using the
built-in QUIC protocol capabilities, e.g. to detect access
availability/unavailability based on PING frames as well as QUIC loss
detection and congestion control functionality.
## 7.3 Evaluation for KI #3: Supporting MA PDU with 3GPP access leg over EPC
and Non-3GPP access leg over 5GC
There are three solutions (Solution #5, #9 and #10) for KI #3.
All solutions are based on 5G RG solution in Rel-16. More in detail:
\- Solution #5 describes the mobility procedure from 3GPP access over 5GC to
3GPP access over EPC;
\- Solution #9 extends the usage of the Rel-16 solution to any N3GPP access
(not only limiting it to W-5GAN) and describes capability negotiation aspect
between UE and CN
\- Solution #10 extends the usage of the Rel-16 solution to support Ethernet
PDU Session type.
Because all solutions are based on 5G RG solution, there is no impact to the
MME or SGW.
These three solutions are complementary and needed for Rel-17 as it is very
likely that there will be areas where 3GPP radio supports only LTE connected
to EPC. Thus, ATSSS service continuity should be ensured in these areas.
Solution #10 suggests to fully reuse the procedure in TS 23.316 [12] clause
4.12.3 without any enhancement. Some functionalities such as MPTCP or some
steering modes may not be supported by this solution.
# 8 Conclusions
Editor\'s note: This clause will capture conclusions from the study.
## 8.1 Conclusions for KI#1: Steering Modes
The following enhancements to the steering modes shall be specified:
1) For the Load-Balancing steering mode:
\- The network may not provide pre-defined split percentages, in which case
the UE and the UPF can freely and independently decide how to split the
traffic across the two accesses.
NOTE 1: The above bullet covers the \"autonomous\" steering mode defined in
Solution #2. Whether and how to provide an initial weight factors for two
accesses are to be decided during normative work.
2) For all steering modes that will be considered in the normative phase:
\- The network may provide a UE-assistance indication, which indicates that
(a) the UE can decide how to distribute the UL traffic based on its internal
state (e.g. battery level), and (b) the UE can request from UPF to apply the
same distribution for the DL traffic, and the UPF can take the UE\'s request
into account when deciding the DL transmission traffic distribution.
\- The UE requests from UPF to apply the same distribution for the DL traffic
by using the PMF protocol, if available, or another mechanism, if the PMF
protocol is not available. This other mechanism will be determined during the
normative phase of the work.
3) For the Load-Balancing steering mode with fixed weights, and Priority-based
steering mode:
\- It shall be possible to apply a threshold condition, which indicates
whether a measured parameter is above or below a threshold.
\- A threshold condition specifies details about how the steering mode should
be applied. For example, if the threshold condition \"RTT \< 100ms\" is
applied to a Load-Balancing steering mode, it indicates that traffic can be
transferred on 3GPP or non-3GPP access if the measured RTT of this access is
less than 100ms.
\- The measured parameter in a threshold condition may include (a) the RTT
(derived from PDB) and (b) the Packet Loss Rate (derived from the Maximum
Packet Loss Rate (MPLR) or the PER).
\- The threshold conditions will be the same for both 3GPP and non-3GPP
accesses since QoS requirements are per SDF/service.
\- The thresholds are considered as \"soft\" thresholds, i.e. UE (and UPF) can
continue to use an access that does not meet a threshold but should reduce its
use of that access by an implementation specific amount.
NOTE 2: During the normative phase it will be decided if the Jitter can also
be included in a threshold condition. During the normative phase it will also
be decided if the hard thresholds can be applied in certain cases, e.g. for
ATSSS-LL.
4) The PMF protocol shall be enhanced to support RTT and Packet Loss Rate(PLR)
measurements per QoS flow.
\- When the UE and the UPF decide to initiate access performance measurements
to estimate the RTT and/or the PLR for an SDF, the PMF messages used for the
measurements shall be transmitted either (a) over the default QoS Flow, or (b)
over the \"target\" QoS Flow, which is the QoS Flow that the SDF traffic is
transmitted on. The UE shall perform access performance measurements based on
(b) only when this is explicitly indicated in the Measurement Assistance
Information. Otherwise, the UE shall perform access performance measurements
based on (a).
\- When the access performance measurements for an SDF are performed based on
(b):
a) How the UE and the UPF determine the target QoS Flow will be determined
during the normative phase of the work.
b) The PMF messages used for the measurements shall be transmitted over the
target QoS Flow by using one of the options considered in clause 6.3.2.3. One
of these options will be selected during the normative phase of the work.
## 8.2 Interim Conclusions for KI#2: Additional Steering Functionalities
Editor\'s note: This clause specifies the principle of a QUIC-based steering
functionality, which can be specified by 3GPP after IETF adopts a WG draft for
QUIC multipath extensions. Some aspects of the QUIC-based steering
functionality are left open since they depend on IETF work that has not yet
started or is not yet completed. These aspects are listed at the end of this
clause.
For the ATSSS steering functionality defined in Rel-17 shall be based on
\"Multipath QUIC\" and shall apply the following principles:
1\. A QUIC-based steering functionality shall be specified, which shall use
the QUIC protocol defined by IETF in draft-ietf-quic-transport [6], draft-
ietf-quic-recovery [7], draft-ietf-quic-tls [18], draft-ietf-quic-invariants
[25] and the following extensions (see also bullet a) below):
(a) the unreliable datagram extension, specified in draft-ietf-quic-datagram
[8]; and
(b) the multipath extension, which will be specified by IETF (e.g. possibly
based on the draft-deconinck-multipath-quic [10]).
2\. The QUIC-based steering functionality shall be optional for the UE and the
network. The UE shall indicate whether it supports QUIC-based steering
functionality during the MA PDU Session establishment procedure.
3\. The QUIC-based steering functionality may be used in parallel with ATSSS-
LL and MPTCP functionalities for a MA PDU Session.
4\. The QUIC-based steering functionality shall be able to support traffic
splitting per-packet and to measure the RTT and the packet loss rate per QoS
flow by using the statistics exposed by the QUIC protocol. There is no need
for the QUIC-based steering functionality to use the PMF protocol.
5\. The QUIC-based steering functionality shall be able to use the QUIC
protocol to determine when an access becomes unavailable / available (e.g. it
may use the QUIC liveness testing or a similar mechanism).
NOTE 1: Although the PMF protocol is not required by the QUIC-based steering
functionality, the PMF protocol could be required when the ATSSS-LL
functionality is also applied. If the QUIC-based steering functionality is
applied in parallel with ATSSS-LL, then it is possible to determine the access
availability by using the PMF protocol.
6\. When the network decides to activate the QUIC-based steering functionality
for an MA PDU Session, the network shall provide to UE:
a. two IP addresses/prefixes called \"link-specific multipath QUIC\" addresses
(one for each access); and
b. the UPF IP address(es) and port(s), where the QUIC connections should be
setup to.
7\. The QUIC-based steering functionality shall be defined as a low-layer
steering functionality and shall support one multipath QUIC connection per QoS
flow. Whether there is a need to support one QUIC connection per QoS Flow and
per steering mode depends on bullet b) below.
8\. The QUIC-based steering functionality should introduce minimal overhead.
9\. It shall be possible to apply reflective QoS to the traffic routed with
the QUIC-based steering functionality. See bullet d) below.
10\. The QUIC-based steering functionality shall be applicable to MA PDU
Sessions with IP type.
11\. The QUIC-based steering functionality shall be able to support traffic
steering or switching between two accesses based on the measurements provided
by QUIC protocol.
NOTE 2: Encryption is currently mandated by the QUIC protocol (see draft-ietf-
quic-tls [18]), which may not be necessary when it is applied in a 3GPP 5G
network (i.e. between UE and UPF) that supports underlying security
mechanisms. Studying QUIC with NULL encryption will be considered by SA3 after
normative work on KI#2 is initiated.
The following aspects of the QUIC-based steering functionality are left open:
a) Whether the QUIC-based steering functionality will apply other IETF
protocols, such as the MASQUE protocol defined in draft-ietf-masque-connect-
udp [19] or the tunnel protocol defined in draft-piraux-quic-tunnel [9].
b) Whether a single multipath QUIC connection can support one or multiple
steering modes. If one steering mode can be supported per multipath QUIC
connection, then the QUIC-based steering functionality shall support one
multipath QUIC connection per QoS flow and per steering mode.
c) How the additional overhead can be minimized. This can be achieved e.g.
with header compression or as described in draft-ietf-masque-connect-udp [19].
d) The details of how reflective QoS can be applied to the traffic routed with
the QUIC-based steering functionality.
e) Whether the QUIC-based steering functionality shall support only UDP
traffic or also other type of traffic (such as IP and/or Ethernet traffic).
## 8.3 Conclusion for KI#3: Supporting MA PDU with 3GPP access leg over EPC
and Non-3GPP access leg over 5GC
It is proposed that Solutions #5, #9 and #10 are selected as a baseline for
normative work. Solution#10 (Ethernet) is not applicable to MPTCP steering
functionality.
Support of Solutions #5, #9 and #10 shall not induce changes to MME and SGW.
NOTE: Whether solution #10 is applicable to Multipath QUIC or new steering
modes will be determined during the normative phase.
#
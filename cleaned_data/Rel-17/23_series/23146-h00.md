# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The present document defines the technical realization of facsimile group 3
using non‑transparent network support within the 3GPP system.
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document describes the procedures allowing the technical
realization of the real time end‑to‑end facsimile group 3 service within the
UMTS PLMN using non‑transparent network support according to the definition of
the Teleservices 61 and 62 specified in 3GPP TS 22.003. Within the present
document particular attention is given to Teleservice \"Alternate
speech/facsimile group 3\" (Teleservice 61). However, the definitions apply
also to Teleservice \"Automatic facsimile group 3\" (Teleservice 62) with the
exception of all actions concerned with the speech phase. Consequently, in the
following descriptions the term \"Teleservice\" denotes both Teleservice 61
and Teleservice 62 as appropriate.
NOTE: V.25bis is outdated. References to V.25bis procedures need to be
replaced by corresponding procedures based on V.250 and 3GPP TS 27.007.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TS 22.003: \"Circuit Teleservices supported by a Public Land Mobile
Network (PLMN)\".
[2] 3GPP TR 23.910: \"Circuit Switch Data Bearer Services\".
[3] 3GPP TS 24.008: \"Mobile radio interface layer 3 specification\".
[4] 3GPP TS 27.001: \"General on Terminal Adaptation Functions (TAF) for
Mobile Stations (MS)\".
[5] 3GPP TS 27.002: \"Terminal Adaptation Functions (TAF) for services using
asynchronous bearer capabilities\".
[6] 3GPP TS 27.007: \"AT command set for 3GPP User Equipment(UE)\".
[7] 3GPP TS 29.007: \"3GPP; TSG CN; General requirements on interworking
between the Public Land Mobile Network (PLMN) and the Integrated Services
Digital Network (ISDN) or Public Switched Telephone Network (PSTN)\".
[8] ITU-T Recommendation T.4: \"Standardization of group 3 facsimile apparatus
for document transmission\".
[9] ITU-T Recommendation T.30: \"Procedures for document facsimile
transmission in the general switched telephone network\".
[10] ITU-T Recommendation V.21: \"300 bits per second duplex modem
standardized for use in the general switched telephone network\".
[11] ITU-T Recommendation V.24: \"List of definitions for interchange circuits
between data terminal equipment (DTE) and data circuit‑terminating equipment
(DCE)\".
[12] ITU-T Recommendation V.27 ter: \"4 800/2 400 bits per second modem
standardized for use in the general switched telephone network\".
[13] ITU-T Recommendation V.29: \"9 600 bits per second modem standardized for
use on point‑to‑point 4‑wire leased telephone‑type circuits\".
[14] ITU-T Recommendation V.17: \"A 2-wire modem for facsimile applications
with rates up to 14 400 bit/s\".
[15] ITU-T Recommendation V.250: \"Serial asynchronous automatic dialling and
control\".
[16] ITU-T Recommendation X.300: \"General principles and arrangements for
interworking between public data networks, and between public data networks
and other networks\".
[17] ITU-T Recommendation T.38: \"Procedures for real-time Group 3 facsimile
communication over IP networks\".
[18] ITU-T Recommendation X.680: \"Information technology - Abstract Syntax
Notation One (ASN.1): Specification of basic notation\".
[19] ITU-T Recommendation X.691: \"Information technology -- ASN.1 encoding
rules -- Specification of Packed Encoding Rules (PER)\".
[20] IETF RFC 1662: \"PPP in HDLC-like Framing\".
[21] IETF RFC 1661: \"The Point-to-Point Protocol (PPP)\".
[22] IETF RFC 1570: \"PPP LCP Extensions\".
[23] IETF RFC 1332: \"The PPP Internet Protocol Control Protocol (IPCP)\".
[24] IETF RFC 791: \"Internet Protocol\".
[25] IETF RFC 768: \"User Datagram Protocol\".
# 3 Definition and abbreviations
## 3.1 Definitions
For the purposes of the present document, the following terms and definitions
apply:
**E-T.38:** to use E-T.38 between both the FAs across the radio interface.
E-T.38 is based on ITU-T Recommendation T.38, but there are some differences
with regards to the packet elements, transcoding methods, and the procedure of
controlling signals. The same procedure as T.38 is used for the structure of
the frame and the protocol stack (Refer to the following clause, annex A and
T.38 for the details).
**TAF:** TAF usually shows a function of the UE side, but when IWF has the
function that is equal to the UE side TAF, TAF is used to express the function
of the IWF in the present document.
## 3.2 Abbreviations
For the purposes of the present document, the following abbreviations apply:
AAL2 ATM Adaptation Layer type 2
ARQ Automatic Retransmission Request
BCS Binary coded signalling
CCT Circuit(s)
CD Data Call Direction
CDMA Code Division Multiple Access
CONTP Character Oriented Non‑Transparent Protocol
DTCH Dedicated Traffic Channel
E-T.38 Enhanced T.38
IE Information element
IFP Internet Fax Protocol
IP Internet Protocol
IWF Interworking Function
I/F Interface
L2RCOP Layer 2 Relay Character Oriented Protocol
MAC Medium Access Control (protocol layering context)
MMI Man-Machine Interface
MT Mobile Terminal
PPP Point to Point Protocol
PSTN Public Switched Telephone Network
RCSD Reverse Call Setup Direction
R-FA Reception side facsimile adaptor that does not have TAF capability
R-FAX Reception side facsimile
RLC Radio Link Control
RLP Radio Link Protocol
R-TAF Reception side terminal adaptation function
SREJ Selective reject
TAF Terminal Adapter Function
TE Terminal Equipment
T-FA Transmission side facsimile adaptor that does not have TAF capability
T-FAX Transmission side facsimile
T-TAF Transmission side terminal adaptation function
UE User Equipment
UDP User Datagram Protocol
UDPTL Facsimile UDP Transport Layer protocol
The abbreviations for the facsimile specific protocol elements and signals are
listed in annex B.
# 4 Network architecture
## 4.1 Service definition
The fixed network facsimile group 3 service is an international telematic
service for document transmission between two facsimile group 3 terminals.
The service specifications are comprised of two parts:
\- the control procedures described in ITU-T Recommendation T.30;
\- the document transmission coding described in ITU-T Recommendation T.4.
The UMTS facsimile group 3 Teleservice allows connections between facsimile
group 3 terminals using:
\- a UMTS PLMN as stand‑alone facility for mobile‑to‑mobile communication;
\- a UMTS PLMN to have access to fixed networks PSTN and/or ISDN for mobile
to/from fixed network communication.
For this Teleservice, the coding of the facsimile document is as per ITU-T
Recommendation T.4 and the protocol as per ITU-T Recommendation T.30 both
modified within the PLMN as detailed in the present document.
The interworking between different networks is based on ITU-T Recommendation
X.300.
The particular features of this Teleservice are:
\- it uses point‑to‑point communication;
\- the information transfer mode is circuit, duplex, asynchronous;
\- the information transfer capability is alternate speech/ facsimile group 3
or facsimile group 3 only;
\- both mobile originated and mobile terminated calls are supported;
\- different end‑to‑end message speeds as per ITU-T Recommendation T.30 may be
used within the same connection to match the appropriate quality requirements;
\- use of the standard asynchronous terminal adaptation function for
non‑transparent network support (as per 3GPP TS 27.002) within the UE is
envisaged.
## 4.2 Network architecture
The network architecture applicable to this Teleservice is shown in figure 1.
: ╔════════╗ :\ : ║ ║ :\ :─╢ PLMN ╟─:\ : ║ ║ :\ : ╚════════╝ :\ v v :
╔════════╗ :\ ╔═════╗ ┌──────┐ │ │ ┌───────┐ ┌───────┐ : ║ ║ : ╔═════╗\ ║ FAX
╟─┤ MT ├─┘ └─┤ RAN ├─┤MSC/IWF├─:─╢ PSTN ╟─:─╢ FAX ║\ ╚═════╝ └──────┘
└───────┘ └───────┘ : ║ ║ : ╚═════╝\ : ╚════════╝ :\ : ╔════════╗ :\ : ║ ║ :\
:─╢ ISDN ╟─:\ : ║ ║ :\ : ╚════════╝ :
Figure 1: Network architecture
It shows the case of mobile to fixed network interworking. For
mobile‑to‑mobile calls, there would effectively be a loop back within the PLMN
using two IWFs.
# 5 Reference configuration at the mobile station
The user equipment reference configurations described in this clause are
defined as per 3GPP TS 27.001.
\\ \ ╔═══════╗
┌───────────┐ R ┌─────┐ :\ a) ║ FAX ╟──┼──┤ FA ├──╫───────────────┤ MT ├─╫\
╚═══════╝ └───────────┘ : └─────┘ :\ : :\ ╔═══════╗ R : ┌─────┐ :\ b) ║ FAX
╟────────────────────╫───────────────┤ MT ├─╫\ ╚═══════╝ : : └─────┘ :\ : : :\
┌──────────────────────────┐ :\ c) \| FAX \| FA \| MT ├────────────────╫\
└──────────────────────────┘ :\ :
Figure 2: Reference configurations
The teleservice definitions in 3GPP TS 22.003 regard the facsimile group 3
terminal as a 2‑wire analogue terminated equipment. In order to connect this
to the MT a separate \"FA\" device is necessary. This configuration, shown in
figure 2a, shall be considered as the standard configuration, so that all the
existing facsimile group 3 terminals may be connected to the PLMN.
An alternative realization would be to combine a facsimile group 3 terminal
and the FA into a special \"UMTS facsimile machine\", directly providing a
digital output. Although such a terminal shall appear to the MT as identical
as the FA (i.e. with an identical interface and protocol), it would allow for
a significantly smaller and simpler facsimile machine. This configuration is
shown in figure 2b.
In addition of course, it is always possible to realize a single device, as
per figure 2c, where both the facsimile and mobile termination functions are
considered to be part of one integrated unit.
The particular terminal adaptation functions used are those detailed in 3GPP
TS 27.002 for non‑transparent bearer capability. The interface to the MT used
is according to ITU-T Recommendation V.24 with an option for support of 3GPP
TS 27.007 procedures for auto calling and auto answering.
## 5.1 FA functionality
The FA block, figure 3, is intended to specifically complement the facsimile
group 3 terminal in order to be able to communicate over a UMTS PLMN.
╔═══════════════════╤═══════════════════╗\ ║ │ ║\ ║ Composite │ ║\ ║ Modem │
Control, ║\ 2-w ║ │ Protocol ║ R\ ──┼──╫───────────────────┤ Monitoring
╟──╫──\ ║ │ & ║\ ║ Tone │ Buffer ║\ ║ Handling │ ║\ ║ │ ║\
╚═══════════════════╧═══════════════════╝
Figure 3: FA scheme
Whether it has to be a function internal to the UMTS PLMN, or an external
accessory associated with the facsimile group 3 terminal, is beyond the scope
of the present document, and in any case, does not affect the working of the
procedure as described here.
It may be functionally partitioned in two sections:
‑ an analogue section, dealing with:
‑ the modulation and demodulation processes according to ITU-T Recommendation
V.21, V.27ter, V.29 and V.17 as explained in ITU-T Recommendation T.4 and
T.30;
‑ handling of the signalling on a 2‑wire path to the associated facsimile
terminal, including auto calling and auto answering functions where necessary
(see clause 7).
‑ a digital section, dealing with:
‑ overall control of the FA;
‑ where necessary, manipulating the ITU-T Recommendation T.30 protocol as
detailed in the present document;
‑ connection to the TAF using the interface according to ITU-T Recommendation
V.24 as described in 3GPP TS 27.002;
‑ where necessary, auto calling and auto answering functions according to 3GPP
TS 27.007.
## 5.2 UMTS facsimile machine functionality
The special UMTS facsimile machine shown in the UE configuration of figure 2b
is similar to the digital part of the FA, but without any of the analogue
portions.
It appears at the ITU-T Recommendation V.24 interface as identical as the FA,
i.e. the MT needs to have no knowledge of the particular configuration used.
# 6 Connection types
In UMTS, the following connection elements attributes are applicable to these
Teleservices.
Connection element: Non-transparent
Duplex Mode: Full Duplex
Synchronous/Asynchronous: Asynchronous
Fixed Network User Rate: 14 400 or 9 600[bit/s]
Wanted Air User Rate: 28 800 or 14 400[bit/s]
Layer 1 and Layer 2 at R reference point are specified in 3GPP TS 27.002, but
not here.
To support the ITU-T Recommendation T.30, requiring different transmission
rates, the following strategy shall be implemented:
\- the channel on the radio interface in UMTS shall be a channel that is
satisfied with a user rate of 28 800 bit/s or 14 400 bit/s;
\- the transmission rate between the FA and the associated facsimile terminal
at both ends shall be the same, i.e. there shall be only one common end‑to‑end
transmission rate at any given time;
\- the message speed shall be negotiated between T-FAX and R-FAX; this also
allows for message speeds of 2 400, 4 800, 7 200, 9 600, or 12 000, 14 400
bit/s to be used;
\- the connection between the fax terminals is divided into three logical
sections (T-FAX ‑(1)‑ T-FA‑(2)‑ -R-FA-(3)-R-FAX);
\- flag stuffing is applied by the FA towards the associated facsimile
terminal within the constraints of ITU-T Recommendation T.30, to keep the data
link active whenever a procedure delay occurs;
\- the BCS protocol elements and the facsimile coded data are buffered at both
FAs , if necessary, to guarantee data integrity;
\- a specific FA protocol (FA protocol) is provided between both FAs to cater
for appropriate link control.
## 6.1 Protocol model
Figure 4 depicts the protocol stack for this Teleservice.
Depending on the particular implementation, the R reference point may not
explicitly exist. In this case, the Layer2 protocol between the FA and the TAF
and consequently the Layer2 protocol between the FA and the TAF entities
operating across this interface may be omitted. The protocol stack at the
radio interface, however, is not affected by this consideration, i.e. RLP and
L2RCOP always apply.
All protocol modules specific for this Teleservice shall be confined in the FA
functions at both the UE and MSC/IWF ends. The TAF shall comply with the
specifications 3GPP TS 27.001 and 3GPP TS 27.002.
Figure 4: Protocol stack for non‑transparent support in UMTS
Figure 5: Communication model
## 6.2 Mobile to mobile calls
Tandem operation shall be applied to mobile to mobile calls.
## 6.3 Procedure interrupts
Procedure interrupts shall be supported only in Teleservices 61. In the case
of Teleservice 62 any attempt to invoke procedure interrupts by MMI on the MT
(see clause 6.4) shall have no effect.
## 6.4 Radio channel modification
This clause applies to Teleservice 61 only, if a change of the radio channel
during the call swapping from speech to facsimile or vice versa is required.
For this purpose the in‑call modification procedure (ICM) as detailed in 3GPP
TS 24.008 is carried out.
The change from speech to facsimile shall be initiated by MMI at the facsimile
terminal starting the ICM procedure via MODIFY signalling.
# 7 Facsimile adaptor
## 7.1 Principles of the Facsimile Protocol Adaptation
The basic approach of the present document for facsimile group 3 is:
\- to use the ITU-T Recommendation T.30 procedure at both ends of the
connection between the FA and the associated facsimile terminal;
\- to intervene within the FAs in order to avoid a T.30 timer timeout due to
delays in the radio interface;
\- to check the message speed; the R-FA selects the appropriate modem
indicated by the DIS/DTC frames from the R-FAX. The T-FA switches the
appropriate modem according to the TSI/DCS frames from the T-FAX after
selecting the modem indicated by the DIS/DTC frames from the R-FA.
Following this strategy, an interchange model is defined concentrating on the
facsimile relevant components. According to this model, three connection
sections may be distinguished:
a) between the T-FA and the T-FAX;
b) between the FAs;
c) between the R-FA and the R-FAX.
The FAs shall cater for the correct establishment and control of these layers,
including traffic channel synchronization and status information exchange, in
particular, with respect to circuit 106 and circuit 109 (according to ITU-T
Recommendation V.24). Once these circuits have been set to ON (traffic channel
synchronization), they shall be kept in the ON condition during the entire
facsimile phase of a connection.
## 7.2 FA functionality
Basically there are four problem areas:
\- support of facsimile group 3 with a digital connection type;
\- unpredictable delays on the radio interface due to actual RLP working
conditions (ARQ);
\- the need to change the transmission rate \"locally\" in the FAs both in the
UE and in the MSC/IWF and to adapt it to the constant user rate of the radio
interface;
\- the inability to support some ITU-T Recommendation T.30 features.
To overcome these problems some particular functions within the FAs are
necessary, such as:
\- buffering of BCS frames and facsimile coded data prior to transfer;
\- autonomous interventions such as BCS frame inhibiting within the FAs;
\- provision of a FA protocol (IFP/UDPTL/UDP/IP/PPP) as an interchange
protocol between the FAs.
The main features relevant to ITU-T Recommendation T.30 adaptation functions
are detailed in the following.
The proper configuration is settled on both network sides by detecting the
DIS/DTC frame just at the beginning of the phase B in ITU-T Recommendation
T.30 protocol procedure.
The optional error correction mode, as defined in ITU-T Recommendation
T.4‑Annex A and ITU-T Recommendation T.30‑Annex A, may be fully supported,
provided some specific features are included in the FA procedure. ECM is
optional for the FA.
In order to support ECM:
\- additional BCS frames need to be detected;
\- the handling of the message phase needs to be adjusted.
The overall framework as described in the present document applies, i.e. it
shall be the same mode, ECM or non-ECM, at the transmitting side and the
receiving side, because the FA stores FAX signals but does not convert the
format of ECM and non-ECM.
The error correction mode is entered upon detection of the relevant bits in
the DIS/DTC frame.
The working principle of the present document is based on the detection,
control, deletion, and generation of key messages between the:
\- the T-FAX and the T- FA;
\- the T- FA and the R- FA;
\- the R- FA and the R- FAX.
While in BCS phases, the following frames shall be detected:
\- DIS/DTC, to monitor all operational parameters of the transmitting
terminal;
\- CSI, to monitor all operational parameters of the receiving terminal;
\- DCS, to realize the actual operational parameters, e.g. message
transmission speed accepted by the sender terminal and the relevant message
transfer direction (see table 2/ITU-T Recommendation T.30);
\- TSI, to indicate that the following FIF information is the identification
of the transmitting terminal. It may be used to provide additional security to
the facsimile procedures;
\- TCF, to verify training and to give a first indication of the acceptability
of the channel for this data rate;
\- FTT, to reject the training signal and requesting a retrain;
> \- CTC/EOR, to fix the retransmission strategy by the facsimile transmitting
> terminal (error correction mode);
\- CTR/ERR, to act as the confirmation message and so closing a BCS phase
before a new message phase;
\- EOM, to indicate the end of a complete page of facsimile information and to
return to the beginning of the phase B;
\- MPS, to indicate the end of a complete page of facsimile information and to
return to the beginning of the phase C upon receipt of a confirmation;
\- EOP, to indicate the end of a complete page of facsimile information and to
further indicate that no further documents are forthcoming and to proceed to
phase E, upon receipt of a confirmation;
\- PRI-Q, to indicate the same as EOM/MPS/EOP command with the additional
optional capability of requesting operator intervention, therefore PRI-Q is
treated as EOM/MPS/EOP;
\- DCN, to initiate the call release procedure.
> While in BCS phases, the following frames shall additionally be detected.
> However, these following signals shall not be transmitted to the radio
> network:
\- NSF, to indicate the specific user requirements, which are not covered by
ITU-T T-Series Recommendations;
\- NSC, to indicate the response to NSF, however this signal is not
transmitted to the radio network;
\- CFR and MCF, to trigger the message phase;
\- PPR, as above, but after the fourth consecutive PPR request, the BCS phase
continues with either CTC or EOR (error correction mode);
\- RR, to ask for the status of the receiver;
\- RTP, to indicate that a complete message has been received and that an
additional message may follow after retransmission of training and CFR;
\- RTN, to indicate that the previous message has not been satisfactorily
received. Several receptions may be possible, provided training is
retransmitted;
\- PIP/PIN, to indicate that further transmissions are not possible without
operator intervention;
\- RNR, to indicate that the receiver is not ready to receive more facsimile
data;
\- ERR, to indicate the response to EOR;
\- CRP, to require the retransmission of the previous received signal in
errors.
Furthermore, all BCS command messages shall be monitored to eliminate repeated
command messages at the FA towards the other FA and to initiate a repetition
of those command messages, if necessary, at the FA towards the associated FAX.
Additionally, all BCS response messages shall be monitored to be able to clear
the former condition.
### 7.2.1 Packet elements between FAs
To cater for the appropriate facsimile transmission some protocol elements and
the related procedures are defined. These protocol elements shall be exchanged
between both FAs. They are based on E-T.38 and described as follows. They are
structured as outlined in annex A:
IFP packet (see clause A.1 in annex A):
> The IFP packet is used to relay ITU-T Recommendation T.30 BCS frames. It
> includes the possibility also to transmit parts of an entire BCS frame
> (segmentation).
>
> 1) T.30_INDICATOR:
\- CNG packet;
\- CED packet;
\- TCF error detection packet: The TCF error detection packet is used to
notify the opposite FA of the TCF error; - FA_busy_packet: The FA_busy_packet
is used to notify the T-FA that the R-FA has received the image signal from
T-FA;
\- FA_non_busy_packet: The FA_non_busy_packet is used to notify the T-FA that
the R-FA has received the MCF, RTP or PIP frame from R-FAX.
2) T.30_DATA:
\- T.30_DATA conforms to T.38;
Packets defined in T.38 but not used in the present document:
\- Training packet;
\- V.21 Preamble Flags packet.
### 7.2.2 Interactions between and interventions within the FAs
Interactions between the FAs and between FA and TAF are necessary:
\- where the content of the protocol packets, except NSF and NSC, shall be
aligned with the capabilities of the supporting the UMTS PLMN (e.g. figure
D.5);
\- where the hardware flow control of V.24 shall be adopted for the flow
control between the FA and the TAF (refer to 3GPP TS27.002);
‑ read the facsimile coded data from the buffer, for transmission across the
radio interface using the appropriate FA protocol packets (see annex A);
\- during the transmission of facsimile coded data where the document content
is transcoded to save transmission capacity at the radio interface (see
clause7.2.4.1);
‑ write the facsimile coded data received across the radio interface into a
buffer at the R-FA;
\- where the T-FA distinguishes the phase at the R-FA by using FA_busy_packet
and FA_non_busy_packet (see clause7.2.1).
To perform the necessary interactions, the FAs at the UE side and at the
MSC/IWF side shall monitor the BCS frames (commands/responses) and the
facsimile coded data exchanged between the two facsimile terminals and perform
the actions detailed below:
‑ receive the BCS frames from the associated facsimile terminal discarding the
BCS frames repetitively received due to time‑out in the facsimile terminal;
‑ store the BCS frames completely received from the associated facsimile
terminal;
\- change information elements of the BCS frames indicating capabilities which
may not be supported by the PLMN (e.g. figure D.5);
\- change BCS frames received from the associate FAX into FA protocol packets,
and transmit it to the opposite FA (see annex A and refer to ITU-T
Recommendations T.38);
\- change FA protocol packets received from the opposite FA into BCS frames,
and transmit it to the associate FAX (see annex A and refer to ITU-T
Recommendations T.38);
‑ transcode the normal facsimile coded data received from the T-FAX and store
the data into a buffer in the T-FA (see clause 7.2.4.1);
Intervention with in the associated facsimile are necessary:
‑ control the half duplex connections between the FA and the associated
facsimile terminal (refer to ITU-T Recommendation T.30);
‑ perform phasing/training with the associated facsimile terminal (refer to
ITU-T Recommendation T.30).
‑ transmit the BCS frames to the associated facsimile terminal autonomously
repeating the BCS frames towards the accepting facsimile terminal if necessary
after time‑out or on request by the CRP (e.g. figure D.4);
‑ where BCS frames shall be repeated autonomously by the FA after a time-out
when no response has been received from the associated facsimile terminal
(e.g. figure D.18);
‑ transmit/receive the ITU-T Recommendation T.30 training check frames (TCF)
to/from the associated facsimile terminal (refer to ITU-T Recommendation
T.30);
‑ read and reverse transcoding of the buffered normal facsimile coded data and
transmitting them to the associated Facsimile terminal (see clause 7.2.4.1);
\- select a appropriate dummy signal (i.e. PPR, FTT, RTC, RTP) : For example,
the dummy signal shall be sent to the T-FAX in order to avoid T.30 timer time-
out at the turn of phases (e.g. figure D.7);
\- adjust the time interval between the transmitted BCS frames (e.g. figure
D.5);
\- adjust the time interval between receiving a BCS frame and transmitting a
response to it (e.g. figure D.14);
The support of guard tones by the FA in the MSC/IWF is an implementation
option.
### 7.2.3 BCS phase
#### 7.2.3.1 BCS command/response procedures
The ITU-T Recommendation T.30 procedures are segmented in sections of
associated BCS commands and responses. Any command sent by a facsimile
terminal shall be answered by an appropriate BCS response (refer to Appendix
III in ITU-T Recommendation T.30). To guarantee that the transmission and
reception of responses have the correct timing, the response time after
reception of a previous command shall be 75m seconds, when the opposite FA is
not busy. When the opposite FA is busy the corresponding timer shall be
extended to 2,4 seconds.
According to the command/response relationship, the FA receiving a BCS command
from its associated facsimile terminal is called the commanding FA. Similarly,
the FA receiving a BCS response is called the responding FA.
The FA shall not transmit the preamble from the associated FAX to the radio
network. The opposite FA shall record the BCS frame received from the other FA
and transmit the preamble and procedure signal to the associated facsimile
within the proper timing. The procedures are as follows:
1) BCS command procedures; A BCS command which has been received correctly
from the associated facsimile terminal, is stored within the commanding FA.
Any forwarding of BCS commands repetitively received from the facsimile
terminal is further on inhibited. If an error occurs during the reception of
the BCS command from the associated facsimile terminal, the commanding FA
shall re-transmit the previously transmitted procedure signal to the
associated FAX and request the proper procedure signal. The commanding FA
transmits the received BCS frame using \"IFP packets\" to the radio network.
The commanding FA shall not transmit the incorrect procedure signal received
from the associated FAX to the radio network.
> Contiguously received parts of a BCS command packet received from the radio
> interface are stored in the responding FA. The stored complete BCS command
> is used for autonomous transmissions towards the associated facsimile
> terminal which may start at the earliest possible time according to ITU-T
> Recommendation T.30.
>
> The responding FA receiving \"IFP packets\" checks their correct sequence
> and starts reassembling the BCS command and transmits it when it has been
> completely received and no sequence error has been detected. All IFP packets
> except IFP packets for the next procedure are ignored. The sequence has to
> be reconstituted at the responding FA before sending it to the associated
> facsimile terminal.
2) BCS response procedures; A BCS response which has been received correctly
from the associated facsimile terminal, is stored within the responding FA.
> If an error occurs during the reception of the BCS response from the
> associated facsimile terminal, the responding FA shall re-transmit the
> previously transmitted procedure signal to the associated FAX and request
> the proper procedure signal. The responding FA shall not transmit the
> incorrect procedure signal received from the associated facsimile to the
> radio network.
>
> Contiguously received parts of a BCS response received from the radio
> interface are stored in the commanding FA. The stored complete BCS response
> is used for autonomous answering towards the associated facsimile terminal
> which may start at the earliest possible time according to ITU-T
> Recommendation T.30.
>
> After transmission of a response towards the FA/fax terminals by the FA
> function, after which the FA function waits for message data (CFR, CTR, MCF
> after MPS, PPS_MPS, PPS_NULL, ERR after EOR_MPS, EOR_NULL) a repeated BCS
> command shall be locally responded, without transferring a preamble element
> towards the radio link.
The FA shall take care of the control of the local modem. The condition is
derived from the reception of certain FA protocol elements. Additionally,
there shall be a control of the half duplex transmission path towards the
associated facsimile terminal. For that purpose, the receiver signal is
monitored and the transmitter is activated, only if no receive signal is
active.
#### 7.2.3.2 Compatibility checking
Some features shall not be supported in the UMTS PLMN environment. The FA is
in charge of dealing with such compatibility checking which is carried out by
monitoring certain BCS frames (DIS/DTC).
\- Group 1 and group 2 equipments shall not be supported by the Teleservice as
described in the present document.
\- Error limiting mode shall not be supported.
\- Only standard 300 bit/s Binary Coded Signalling shall be supported. For
this purpose, the FA shall ignore the 2400 bit/s capability within phase B of
the ITU-T Recommendation T.30 procedure by looking for DIS frames from ITU-T
Recommendation V.21 modem only.
\- The following facsimile message speeds shall be supported: 2400, 4800,
7200, 9600, 12000 and 14400bit/s. For this purpose the FAs are responsible to
carry out appropriate actions, e.g. to set the applicable fields in the DIS
frame accordingly.
\- It is not possible to support non‑standard facilities since some of these
contain proprietary methods of changing the modem speed that are un-
interpretable to the IWF and hence impossible to track.
#### 7.2.3.3 Training Check
The training check sequence (TCF) as described in ITU-T Recommendation T.30 is
exchanged only locally between the FA and the associated facsimile terminal.
The training check sequence sent by the FA shall be transmitted at the
earliest possible time, and shall have a duration that complies with the
minimum duration requirement of ITU-T Recommendation T.30. Because CFR is not
transmitted end to end the T- FA generates CFR or FTT, and sends it to the
T-FAX.
The T-FA shall send CFR to the T-FAX, 2.4s after it received TCF from the
T-FAX.
However in the following cases, the T-FA shall send FTT to the T-FAX instead
of CFR (see figure D.7):
\- when it receives the TCF error detection packet from the R-FA;
\- when it receives the FTT packet from the R-FA;
\- when it recognizes the R-FA busy status by the FA_busy_packet.
(The T-FA shall transmit FTT to avoid the phase difference between the
transmitting and the receiving side when the phase is returned to phase B by
EOM.)
This is done by using the FA_busy_packet and the FA_non_busy_packet to monitor
the state of the R-FA. When the T-FA receives the FA_busy_packet it can deduce
that the training has been successful on the receiving side.
As a consequence of this local procedure, the T_FA shall check the received
TCF to see whether the quality requirements are satisfied. Depending on the
result of that check, the T-FA recognizing a corrupted line shall send FTT
instead of CFR. If the T-FA receives corrupted TCF from the T-FAX, it shall
transmit the TCF_error_detection_packet to the R-FA. On the other hand, if the
R-FA receives the TCF_error_detection_packet from the radio network, it shall
transmit a corrupted TCF to the R-FAX (see figure D.7).
The message transfer phase in the R-FA shall be entered upon reception of CFR.
The modem training at transmission speed shall start after the R-FA receives
the facsimile coded data if it receives the data within 3 s after the receipt
of CFR from the R-FAX (see figures D.5 and D.9).
The R-FA shall transmit the TSI, DCS to the R-FAX, if it does not receive the
facsimile coded data within 3,0 s after the receipt of the CFR from the R-FAX
(see figures D.5 and D.9).
#### 7.2.3.4 Control of transmission rate
The controlling entity of the FA shall recognize a change of the transmission
rate, and in conjunction with this a change of the modem function has to
commence. The transmission rate shall be changed only locally, i.e. between
the facsimile terminal and the FA at both the MSC/IWF and the UE ends.
The actual message speed and the modem function are derived from the content
of the related BCS frames (DIS/DTC, DCS, CTC).
There are two methods to decide the transmission rate as follows:
\- Use DIS DCS signal between FAXs (see figures D.4 and D.5);
\- Trigger Fallback by the TCF error detection.
Fallback is triggered both on the transmitting and receiving sides.
In the case that fallback occurs on the transmitting side, the R-FA shall be
notified of the fact by the TCF error detection packet (see figure D.9).
In the case that fallback occurs on the receiving side, the T-FA shall be
notified of the fact by the FTT packet from the R-FA (see figure D.7).
### 7.2.4 Message phase
During the message phase (phase C of ITU-T Recommendation T.30) the EOL
character shall be detected, (see clause 4.1.2 of ITU-T Recommendation T.4).
The EOL character is a unique code word that may never be found within a valid
line of facsimile coded data, and is used:
\- to identify the start of the message phase;
\- to control the transcoding procedure;
\- to mark the end of the message phase (6 consecutive EOLs).
If the R-FA has stored more than 0,28 kbyte of facsimile coded data and
detected two or more EOLs in the data, then the R-FA shall send the
FA_busy_packet to the T-FA. After the R-FA receives MCF from the R-FAX, the
R-FA shall send the FA_non_busy_packet to the T-FA. The R-FA shall notify the
T-FA of the state of the reception side by sending the FA_busy_packet or the
FA_non_busy_packet to avoid that the phase at the T-FA proceeds the next phase
(as a result of EOP, MPS, EOM, CTC, PPS-Q, EOR-Q, RR) while the R-FA is still
busy in the current phase.
#### 7.2.4.1 Message Transcoding
To save transmission capacity at the radio interface the content of the
document shall be transcoded. This applies only when using the normal
facsimile data transfer. This does not apply when using the ITU-T
Recommendation T.30 error correction mode.
The facsimile coded data received by the T-FA from the T-FAX is transcoded and
transmitted to the corresponding R‑FA across the radio interface. Then it is
transcoded and transmitted to the R-FAX by R-FA.
The transcoding is based on the minimum line length capability of the T.30
protocol for the normal facsimile data transfer. According to this the
transmitting facsimile terminal has to fill up each coded scan line with FILL
information to conform to this requirement (refer to ITU-T Recommendation
T.4).
To do so, the FA associated with the T=FAX shall force this to use (at least)
the standard value of 20 ms by replacing the applicable parameter value of the
exchanged DIS/DTC messages. All FILL information of the facsimile coded data
received from the FAX shall be deleted prior to forwarding the data across the
radio interface. The FA associated with the R-FAX shall recognize and store
the originally requested minimum line length to be able to regenerate to
correct line length.
It should be noted that ITU-T Recommendation T.4 document coding may be
1‑dimensional or 2‑dimensional and, in addition, uncompressed. The FAs shall
take care of this when transcoding the document content.
#### 7.2.4.2 Generation of the normal data packet
This is specified in ITU-T Recommendations T.38 and X.691. X.691 provides
details on octet alignment.
#### 7.2.4.3 Generation of the error correction data packet
This is specified in ITU-T Recommendations T.38 and X.691. X.691 provides
details on octet alignment.
#### 7.2.4.4 Normal facsimile data
The T-FA starts the message phase by transmitting CFR or MCF to the T-FAX. The
R-FA enters the message phase by receiving CFR or MCF from the R-FAX.
\- If the R- FA does not receive the facsimile coded data from the radio
network within 3s of receiving CFR from the R-FAX, it shall re-transmit a
preamble of 1.0s and the previously transmitted TSI, DCS to the R-FAX after
changing the modem to V.21.
\- If the R- FA does receive the facsimile coded data from radio network
within 3s of receiving CFR from the R‑FAX, it shall transmit the training to
the R-FAX after changing the modem to V.17, V.27ter or V. 29.
\- If the R-FA does not receive the facsimile coded data from the radio
network within 3s of receiving MCF from the R-FAX, it shall re-transmit a
preamble of 1.0s and the previously transmitted MPS to the R-FAX after
changing the modem to V.21.
\- If the R-FA does receive the facsimile coded data from the radio network
within 3s of receiving MCF from the R-FAX, it shall transmit the training to
the R-FAX after changing the modem to V.17, V.27ter or V. 29.
Following the training sequence, the R-FA shall transmit FILL towards the
R-FAX (see clause 4.1.2 of ITU-T Recommendation T.4), disregarding all
information received from the radio interface, until an EOL character is
detected, which shall mark the beginning of the image data (see figure 1 of
ITU-T Recommendation T.4).
If due to a preceding error the message phase may not be entered, the training
sequence shall be aborted when a new IFP packet is received by the T-FA.
#### 7.2.4.5 Error correction facsimile data
As the facsimile coded data between the FA and the facsimile terminal are
structured in HDLC frames, the handling of this procedure segment shall
exploit such formatting. The content of such an HDLC frame is called a block
(refer to ITU-T Recommendation T.4 Annex A).
Each such block is included in the information field of an
Error_Correction_Data_Packet of the FA protocol, which is processed for
transmission across the radio interface as outlined in clause 7.2.4.3.
The message phase at both the PLMN ends is triggered by the transit of a
confirmation frame (CFR, MCF, PPR, CTR or ERR) sent by the receiving terminal
and marking the end of the BCS phase.
The PPR that the T-FA sends to the T-FAX has two purposes:
\- PPR is used to request re-transmission of the facsimile coded data. When
the T-FA receives corrupted facsimile coded data, it requests correct
facsimile coded data to the T-FAX (refer to ITU-T Recommendation T.30).
\- In addition to the T.30 purpose, PPR is used to avoid the timer timeout of
the T.30 protocol. If the R-FA is busy, the T-FA shall transmit PPR to the
T-FAX (see figure D.20).
If four consecutive PPR are counted within the same \"partial page\", the BCS
phase continues.
The T-FA shall enter the message phase as described in ITU-T Recommendation
T.30.
\- If the R-FA does not receive the facsimile coded data from the radio
network within 3s of receiving CFR from the R-FAX, it shall re-transmit a
preamble of 1.0s and the previously transmitted TSI, DCS to the R-FAX after
changing the modem to V.21.
\- If the R-FA does receive the facsimile coded data from radio network within
3s of receiving MCF from the R-FAX, it shall transmit the training to the
R-FAX after changing the modem to V.17, V.27ter or V.29.
\- If the R-FA does not receive the facsimile coded data from the radio
network within 3s of receiving MCF from the R-FAX, it shall re-transmit a
preamble of 1.0s and the previously transmitted MPS to the R-FAX after
changing the modem to V.21.
\- If the R-FA does receive the facsimile coded data from the radio network
within 3s of receiving MCF from the R-FAX, it shall transmit the training to
the R-FAX after changing the modem to V.17, V.27ter or V.29.
Following the training sequence, HDLC flags shall be stuffed into the signal
sent to the facsimile terminal until a FCD frame is detected, which shall mark
the beginning of the image data.
If due to a preceding error the message phase may not be entered, the training
sequence shall be aborted when a new IFP packet is received by the T-FA.
#### 7.2.4.6 Controlling of facsimile coded data
The procedure for controlling the FAX data within the FA is described in the
following two clauses.
It is recommended that the buffer size inside FA is more than 256 kbytes.
##### 7.2.4.6.1 Transmitting Fax Adapter
In the T-FA the facsimile coded data being received from the T-FAX are
transcoded stripping of FILL information and written into the buffer.
When data is read out from the buffer, an FA protocol element shall be
generated and processed as described in Annex A or ITU-T Recommendation T.38.
It is transferred to the R-FA using one of the standard FA protocol element.
For that purpose the data shall be segmented into blocks.
Due to the ARQ techniques of the RLP, the throughput across the radio
interface may be less than the message speed between the T-FAX and the T-FA,
i.e. the content of the buffer may increase.
If the throughput at the radio interface is greater than the message speed
between the T-FAX terminal and the T-FA (e.g. when the end to end speed is
lower than 14400 bit/s), the buffer may be empty most of the time.
##### 7.2.4.6.2 Receiving Fax Adapter
In the R-FA, FILL information is transmitted to the R-FAX at the beginning of
each page, if necessary, to bridge the gap between the training sequence and
the reception of the image data. In case of normal fax data, the duration of
the FILL 0\'s may be increased by only 4,5 s or less.
The reverse transcoding consists of the insertion of FILL information before
the facsimile coded data is forwarded to the facsimile terminal to comply with
the recognized minimum line length as defined in ITU-T Recommendation T.4.
At the beginning of each page, the facsimile coded data to be sent to the
facsimile terminal is not read out from the buffer until either at least 2
instances of EOL have been received and the buffer size is at least 0,28
kbytes or, an RTC has been received, which does not depend on the end-to-end
data transfer rate.
##### 7.2.4.6.2.1 Fill insertion method for NON- ECM {#fill-insertion-method-
for-non--ecm .H6}
The R-FA controls FILL insertion according to the accumulation value of image
signals (see figure D.11).
The condition for starting FILL insertion:
\- when the pix memory accumulation value is 0,28 kbytes or less.
The condition for stopping FILL insertion:
\- when the pix memory value is 0,9 kbytes or more;
\- when the pix memory value is not over 0,9 kbytes and the interval between
EOLs (one line period) reaches 4,5 s.
When the interval between EOL reaches 4,5 s, the R-FA shall stop FILL
insertion, and shall transmit EOL and shall start to transmit the next
facsimile coded line. If however the pix memory value is below \"the forced
RTC transmission value\"(=7byte or less), the R-FA shall send RTC to the R-FAX
to force end of Phase C. Then it shall wait for a post-message (EOP, EOM, MPS)
to be received from the air interface.
##### 7.2.4.6.2.2 Flag insertion method for ECM {#flag-insertion-method-for-
ecm .H6}
The R-FA controls Flag insertion according to the accumulation value of the
image signals(see figure D.13).
The condition for starting Flag insertion:
\- when pix memory accumulation value is 0,28 kbytes or less.
The condition for stopping Flag insertion:
\- when the pix memory value is 0,9 kbytes or more.
### 7.2.5 Disconnect procedure
The T-FA sends the MCF frame to the T-FAX after receiving the
FA_non_busy_packet from the R-FA. The T- FAX sends the DCN frame (see ITU-T
Recommendation T.30) to the T-FA after receiving the MCF frame. The T-FA, upon
detection of the DCN frame sent by the T-FAX to indicate the end of the
facsimile transmission, shall initiate the disconnect procedure. The T-FA
transmits the DCN packet to the R-FA after receiving the DCN frame from the
T‑FAX, while the R-FA transmits the DCN frame to the R-FAX after receiving the
DCN packet.
### 7.2.6 Timeouts
The T.30 timer between the T-FAX and the T-FA, and the T.30 timer between the
R-FAX and the R-FA are independent of each other. Therefore, the overall fax
adaptation function is in principle bound to the timing constraints associated
with the associated FAX ITU-T Recommendation T.30 procedure. This means that,
no matter of the reference configuration used at the mobile station, the
progress of the call shall be mainly subject to the ITU-T Recommendation T.30
typical timing protections, settled externally.
However, due to the specific conditions caused by the UMTS PLMN system, there
is the need for a special support with respect to BCS command repetitions as
explained above. For that purpose, the FAs shall provide means for local time-
out. The timer shall be started and stopped as described in annex D (see table
D.2).
# 8 Use of terminal adaptation functions
The protocol stack of the connection type is shown in figure 4.
The TAFs described in 3GPP TS 27.002 for asynchronous bearer capabilities in
the non‑transparent mode. The interchange signalling mapping is in accordance
with 3GPP TS 27.002.
## 8.1 Principles of terminal adaptation functions
The TAF, located at both PLMN ends, is in charge of:
‑ call set-up, in particular the BC negotiation;
‑ establishment and maintenance of a Layer2 protocol link between the FA and
the TAF according to 3GPP TS 27.002, where applicable;
\- establishment and maintenance of an L2RCOP link between the TAFs according
to 3GPP TS 27.002;
\- initiation of the In-Call Modification (ICM) procedure.
The basic approach of the present document for facsimile group 3 is:
‑ to use the network support of BS 20 NT as defined in 3GPP TS 27.001, 3GPP TS
27.002 and 3GPP TS 29.007.
## 8.2 Specific TAFs for facsimile service
In order to perform the procedures described in the present document, the UE
and the IWF environment shall be designed to transmit and receive facsimile
data continuously with flow control. This specifically applies between RLP
entities, L2RCOP (within TAF) entities, and between the FA and the TAF
entities within the UE or the IWF.
Furthermore, the RLP entity shall be able to make error recovery by using the
SREJ command/response.
# 9 Signalling aspects
3GPP TS 27.002 identifies the bearer capability requirements to be supported
by the terminal adaptation function in the MT (see 3GPP TS 27.001for BC and
HLC coding). The specific signalling requirements are those for \"speech\" and
\"facsimile group 3\" or \"facsimile group 3\" only, respectively. The MT
indicates in the call set up request the requirements, e.g. first speech,
second facsimile by sending the bearer capability information element(s) in
the appropriate order. For an \"auto calling\" facsimile request, the
facsimile group 3 bearer capability is sent as the first or the only bearer
capability for Teleservice 61 or 62, respectively.
For interworking between Teleservice 61 and Teleservice 62, refer to 3GPP TS
22.003 and 3GPP TS 27.001.
## 9.1 Handling of tonal signals
Because the ITU-T defined service uses modems, there are some signals received
from the analogue link at the MSC/IWF and (where used) the FA which do not
have a direct binary representation.
These signals are the modem called (CED) and calling (CNG) tones sent at the
start of each fax data phase of the call. These tonal signals shall be used
for the selection of ATD or ATA. No later than 3 sec after connecting the fax
apparatus to the line the FA/UE is able to determine the AT command. If a CNG
tone or nothing is detected by the FA/UE the mobile fax station is the calling
station, if a CED tone or a BCS signal frame is detected by the FA/UE the
mobile fax station is the called station. If the associate fax is the calling
station, the FA shall transmit ATD toward the TAF. If the associate fax is the
called station, the FA shall transmit ATA toward the TAF.
After the link of the FA_protocol is established, these tonal signals shall be
sent to the opposite FA as the IFP_packet(CNG,CED). The FA receiving the
FA_packet(CNG,CED) shall generate the tonal signal and transmit the signal
toward the associated facsimile terminal.(see figure D.3)
## 9.2 Call establishment
### 9.2.1 Mobile terminated call
The call may be set-up manually or automatically by the PSTN facsimile group
3.
#### 9.2.1.1 Speech then facsimile
Refer to the diagrams in figures C.1a and C.1b. In both of the figures, the
initial call setup is mobile terminated. In figure C.1a, the DCD is also
mobile terminated (MT), while the DCD in figure C.1b is mobile originated
(MO).
The connection of the FA to the TAF causes the initialization between the FA
and the TAF. At this time, the setting of speech/facsimile call should be done
in the FA. The operation of the FA for the speech/facsimile call setting is
implementation dependent.
At first, the FA at the UE shall turn on circuit 108/2 and circuit 105. After
that, the TAF at the UE shall turn on circuit 106 and circuit 107 toward the
FA. The FA which detected ON condition of circuit 106 and circuit 107 requires
facsimile call of the TAF by appropriate AT command (e.g. AT+CMOD=1,
AT+FCLASS=1, 2). If the AT command is recognized, the TAF shall transmit
\"OK\" to the FA as a result code.
In order to make the transition from the speech phase to the facsimile phase,
the MODIFY message shall be initiated by the MMI at the facsimile terminal,
which shall result in the establishment of RLP across the radio interface and
connection to the line of the FA/IWF.
When the facsimile machine is connected to the line by manual intervention,
the facsimile machine should transmit tonal signal (CNG or CED) toward the FA.
The FA shall select ATD or ATA according to the rules in clause 9.1 and
transmit ATD or ATA toward the TAF.
On detecting ATD or ATA, the TAF shall transmit the MODIFY message that has
G3FAX ability as a bearer capability. After that, RLP and L2RCOP shall be
established across the radio interface.Once the connection is established,
circuit 109 shall be clamped to the ON condition by the TAF at the IWF. Then,
the FA protocol shall be started between the FAs.
#### 9.2.1.2 Auto answer
Refer to the diagram in figure C.2. The connection of the FA to the TAF causes
the initialization between the FA and the TAF. At first, the FA at the UE
shall turn on circuit 108/2 and circuit 105. After that, the TAF at the UE
shall turn on circuit 106 and circuit 107 toward the FA. The FA which detected
ON condition of circuit 106 and circuit 107 shall require facsimile call of
the TAF by appropriate AT command (e.g. AT+FCLASS=1, 2). If the AT command is
recognized, the TAF shall transmit \"OK\" to the FA as a result code.
When the MT receives a call in the condition finished the above
initialization, the TAF shall transmit the result code \"RING\" toward the FA.
\"RING\" shall cause a ring current to be sent to the facsimile terminal. The
FA shall transmit ATA toward the TAF when the FAX terminal connects to the
line and begins behaviour of receiving. On receiving ATA, the FA shall
transmit a signal that notifies the calling side that called facsimile
terminal connected to the line.
Once the connection is established, circuit 109 shall be clamped to the ON
condition by the TAF at the IWF. Then, the FA protocol shall be started
between the FAs.
### 9.2.2 Mobile originated calls
The PSTN facsimile group 3 terminal may manually or automatically answer the
call originated by the mobile station.
#### 9.2.2.1 Speech then facsimile
Refer to the diagrams in figure C.3a and figure C.3b. In both of the figures,
the initial call setup is mobile originated. In figure C.3a the DCD is also
MO, while in figure C.3b the DCD is MT.
The connection of the FA to the TAF causes the initialization between the FA
and the TAF. At this time, the setting of speech/facsimile call should be done
in the FA. The operation of the FA for the speech/facsimile call setting is
implementation dependent.
At first, the FA at the UE shall turn on circuit 108/2 and circuit 105. After
that, the TAF at the UE shall turn on circuit 106 and circuit 107 toward the
FA. The FA which detected ON condition of circuit 106 and circuit 107 requires
facsimile call of the TAF by appropriate AT command (e.g. AT+CMOD=1,
AT+FCLASS=1, 2). If the AT command is recognized, the TAF shall transmit
\"OK\" to the FA as a result code.
In order to make the transition from the speech phase to the facsimile phase,
the MODIFY message shall be initiated by the MMI at the facsimile terminal,
which shall result in the establishment of RLP across the radio interface and
connection to line of the FA/IWF.
When the facsimile machine is connected to the line by manual intervention,
the facsimile machine should transmit tonal signal (CNG or CED) toward the FA.
The FA shall select ATD or ATA according to the rules in clause 9.1 and
transmit ATD or ATA toward the TAF. On detecting ATD or ATA, the TAF shall
transmit the MODIFY message that has G3FAX ability as a bearer capability.
After that, RLP and L2RCOP shall be established across the radio interface.
Once the connection is established, circuit 109 shall be clamped to the ON
condition by the TAF at the IWF. Then, the FA protocol shall be started
between the FAs.
#### 9.2.2.2 Auto calling
Refer to the diagram in figure C.4. The FA at the UE shall turn on circuit
108/2 and circuit 105 when the fax apparatus is connected to the line by
manual intervention. After that, the TAF at the UE shall turn on circuit 106
and circuit 107 toward the FA. The FA which detected ON condition of circuit
106 and circuit 107 shall require facsimile call of the TAF by appropriate AT
command (e.g. AT+FCLASS=1, 2). If the AT command is recognized, the TAF shall
transmit \"OK\" to the FA as a result code.
The FA shall make ATD [Dial signal] from DTMF dialling information and
transmit ATD[Dial signal] toward the TAF. On detecting ATD [Dial signal], the
TAF shall transmit the call set-up signal that has G3FAX ability as a bearer
capability. When the call is answered, the synchronization process shall be
started and the RLP shall be established across the radio interface.
After that, RLP and L2RCOP are established across the radio interface. Once
the connection is established, circuit 109 shall be clamped to the ON
condition by the TAF at the IWF. Then, the FA protocol is started between the
FAs.
#### 9.2.2.3 Manual calling
Refer to the diagram in figure C.5. The connection of the FA to the TAF causes
the initialization between the FA and the TAF. At first, the FA shall turn on
circuit 108/2 and circuit 105. After that, the TAF at the UE shall turn on
circuit 106 and circuit 107 toward the FA. The FA which detected ON condition
of circuit 106 and circuit 107 shall require facsimile call of the TAF by
appropriate AT command (e.g. AT+FCLASS=1, 2). If the AT command is recognized,
the TAF shall transmit \"OK\" to the FA as a result code.
After the initialization of the FA and the TAF, the dialling operation shall
be done at the MT. Then, the MT shall transmit the call set-up signal that has
G3FAX ability as a bearer capability.
After that, RLP and L2RCOP shall be established across the radio interface.
Once the connection is established, circuit 109 shall be clamped to the ON
condition by the TAF at the IWF. Then, the FA protocol shall be started
between the FAs. And the fax apparatus is connected to the line by manual
intervention.
# 10 Interworking to fixed networks
Only PSTN and ISDN are considered, and may be used as transit networks to
complement the PLMN in the end‑to‑end connection between facsimile group 3
terminals (figure 6).
{width="5.614583333333333in" height="2.8645833333333335in"}
Figure 6: Network interworking
## 10.1 Interworking to PSTN
As the standard access of facsimile group 3 terminals for this Teleservice is
a 2-wire analogue interface, all the technical requirements for network
interworking to PSTN are identical in principle to those encountered for the
terminal connection to the UE. The key functional block is the FA described in
clause 7 of the present document.
As far as network interworking is concerned, the main function to be performed
by such a block is the correct managing of a composite modem, in accordance
with the requirements of ITU-T Recommendation T.30:
\- ITU-T Recommendation V.21 synchronous mode, as standard facility for all
BCS phases;
\- ITU-T Recommendation V.27ter for message speeds of 4 800 and 2 400 bit/s;
\- ITU-T Recommendation V.29 for message speeds of 9 600 and 7 200 bit/s;
\- ITU-T Recommendation V.17 for message speeds of 14 400, 12 000, 9 600, 7
200 bit/s.
The mechanism for selecting the correct modem is the following:
\- the actual message speed is obtained by detecting the DCS frame (see table
2/ITU-T Recommendation T.30) while in BCS phase;
\- on entering the message phase, there is an interchange between the V.21
modem and the actual modem agreed upon between the terminals for message
transmission;
\- on exiting the message phase (RTC) the ITU-T Recommendation V.21 modem is
selected again.
Times for settling the modem shall be in accordance with the requirements of
ITU-T Recommendation T.30.
## 10.2 Interworking to ISDN
The use of 3,1 kHz audio bearer capability of ISDN allows for an interworking
of PLMN very similar in practice to the scheme for PSTN (figure 6). The FA
function shall comply with the description given in clause 7 of the present
document.
###### ## Annex A (normative): Structure and contents of the FA protocol
elements
# A.1 Internet Fax Protocol
This ANNEX is related to the application of the T.38 protocol within the
present document.
Only the following packets are used:
\- T30_INDICATOR
\- CNG
\- CED
\- TCF error detection (not in T.38)
\- FA_busy_packet (not in T.38)
\- FA_non_busy_packet (not in T.38)
\- T30_DATA
\- V.21 channel 2 (except MCF, CFR, RTN, RTP, PIP, PIN, PRI, PPR, NSF, NSC,
RR, RNR, ERR)
\- V.27 ter 2400
\- V.27 ter 4800
\- V.29 7200
\- V.29 9600
\- V.17 7200
\- V.17 9600
\- V.17 12000
\- V.17 14400
In T30_ DATA the maximum length of T.4-Non-ECM/HDLC data is equal to 1 400
octets.
Aligned Packet Encoding Rule is applied to ASN.1.
# A.2 Facsimile UDP Transport Layer Protocol
The FEC option and the redundant message option shall not be used.
# A.3 User Datagram Protocol
The port number at client side is ephemeral (assigned on a call by call
basis). The port number at the server side is manually preassigned by the
operator.
# A.4 Internet Protocol
The IP address is not required because a circuit switched connection is used
between the UE and IWF. However, IP addresses shall be used in order to be
consistent with IP.
The IP address at UE side and IWF side are assigned by PPP.
# A.5 Point to Point Protocol
For the communication between the two FAs IP is provided on top of PPP.
PPP shall conform to RFC 1662, 1661, 1570 and 1332.
# A.6 Mapping of FA frames
Refer also to 3GPP TS 27.002.
Figure A.1: Typical frame mapping within FA protocol
Figure A.2: Typical frame mapping between FA Protocol and RLP
###### ## Annex B (informative): Abbreviations from ITU-T Recommendation T.30
and T.4
Table B.1: Abbreviations from ITU-T Recommendation T.30
* * *
Abbreviation Function Signal format T.30 T.30 standard err.corr. CED Called
station identification 2100 Hz X X CFR Confirmation to receive X010 0001 X X
CRP Command repeat X101 1000 X X CIG Calling subscriber identification 1000
1000 X X CNG Calling tone 1100 Hz X X CSI Called subscriber identification
0000 0010 X X CTC Continue to correct X100 1000 X CTR Response to continue to
correct X010 0011 X DCN Disconnect X101 1111 X X DCS Digital command signal
X100 0001 X X DIS Digital identification signal 0000 0001 X X DTC Digital
transmit command 1000 0001 X X EOM End of message X111 0001 X  
EOP End of procedure X111 0100 X  
EOR End of retransmission X111 0011 X ERR Response to end of retransmission
X011 1000 X FCD Facsimile coded data 0110 0000 X FCF Facsimile control field
‑‑‑ X X FCS Frame checking sequence 16 bits X X FIF Facsimile information
field ‑‑‑ X X FTT Failure to train X010 0010 X X MCF Message confirmation X011
0001 X X MPS Multi‑page signal X111 0010 X  
NSC Non‑standard facilities command 1000 0100 X X NSF Non‑standard facilities
0000 0100 X X NSS Non‑standard set‑up X100 0100 X X PIN Procedural interrupt
negative X011 0100 X X PIP Procedural interrupt positive X011 0101 X X PIS
Procedure interrupt signal 462 Hz X X PPR Partial page request X011 1101 X PPS
Partial page signal X111 1101 X PRI Procedure interrupt X111 XXXX X  
RCP Return to control for partial page 0110 0001 X RNR Receive not ready X011
0111 X RR Receive ready X111 0110 X RTN Retrain negative X011 0010 X X RTP
Retrain positive X011 0011 X X TCF Training check frame 0... 1.5s X X TSI
Transmitting subscriber identification X100 0010 X X
* * *
Table B.2: Abbreviations from ITU-T Recommendation T.4
* * *
Abbreviation Function Signal format EOL End of line 0000 0000 0001 RTC Return
to control 6 * EOL
* * *
###### ## Annex C (informative): Procedure examples
{width="6.690972222222222in" height="5.868055555555555in"}
105, 106, 107, 108/2, 109: circuits according to ITU-T Recommendation V.24
(1) speech/fax call setting
(2) manual intervention
(3) triggered by ATA
(4) locally generated by the IWF
Figure C.1a: Mobile terminated call - speech then facsimile DCD mobile
terminated
{width="6.686805555555556in" height="5.898611111111111in"}
105, 106, 107, 108/2, 109: circuits according to ITU-T Recommendation V.24
(1) speech/fax call setting
(2) manual intervention
(3) triggered by ATD
(4) locally generated by the IWF
Figure C.1b: Mobile terminated call - speech then facsimile DCD mobile
originated
{width="6.6930555555555555in" height="6.354166666666667in"}
105, 106, 107, 108/2, 109: circuits according to ITU-T Recommendation V.24
(1) fax call setting
(2) manual or automatic operation
(3) triggered by ATA
(4) locally generated by the IWF
Figure C.2: Mobile terminated call - auto answer
{width="6.69375in" height="5.9319444444444445in"}
105, 106, 107, 108/2, 109: circuits according to ITU-T Recommendation V.24
(1) speech/fax call setting
(2) manual intervention
(3) triggered by ATA
(4) locally generated by the IWF
Figure C.3a: Mobile originated call - speech then facsimile DCD mobile
terminated
{width="6.690972222222222in" height="5.979166666666667in"}
105, 106, 107, 108/2, 109: circuits according to ITU-T Recommendation V.24
(1) speech/fax call setting
(2) manual intervention
(3) triggered by ATD
(4) locally generated by the IWF
Figure C.3b: Mobile originated call - speech then facsimile DCD mobile
originated
{width="6.6930555555555555in" height="6.354166666666667in"}
105, 106, 107, 108/2, 109: circuits according to ITU-T Recommendation V.24
(1) manual intervention
(2) locally generated by the IWF
Figure C.4: Mobile originated call - auto calling
{width="6.689583333333333in" height="5.454861111111111in"}
105, 106, 107, 108/2, 109: circuits according to ITU-T Recommendation V.24
(1) fax call setting
(2) manual intervention
(3) locally generated by the IWF
Figure C.5: Mobile originated call - manual calling
{width="5.958333333333333in" height="4.665972222222222in"}
(1) triggered by delayed DCS(75 ms)
(2) triggered by delayed TCF(2,4 s)
Figure C.6: Mobile originated facsimile transmission
{width="5.989583333333333in" height="4.615277777777778in"}
(1) triggered by delayed DCS(75 ms)
(2) triggered by delayed TCF(2,4 s)
Figure C.7: Mobile terminated facsimile transmission
{width="5.989583333333333in" height="4.615277777777778in"}
(1) triggered by delayed DCS(75 ms)
(2) triggered by delayed TCF(2,4 s)
Figure C.8: Mobile originated facsimile transmission (error correction mode)
{width="5.989583333333333in" height="2.6375in"}
Figure C.9: Mobile originated facsimile transmission - error recovery
(example)
{width="5.989583333333333in" height="2.5125in"}
Figure C.10: Mobile terminated facsimile transmission - error recovery
(example)
{width="5.989583333333333in" height="4.5125in"}
(1) triggered by delayed DCS(75 ms)
(2) triggered by delayed FTT(75 ms)
Figure C.11: Mobile originated facsimile transmission - error recovery
(example)
{width="5.96875in" height="2.7375in"}
(1) triggered by delayed TCF error detection element (2,4 s)
Figure C.12: Mobile originated facsimile transmission - error recovery
(example)
{width="5.989583333333333in" height="3.4298611111111112in"}
Figure C.13: Mobile originated facsimile transmission - error recovery
(example)
###### ## Annex D (normative): SDL Diagrams
The SDL specification within this Appendix shall be used as a reference model
for implementation. The external behaviour of an implementation shall comply
with the present document. However internal behaviour may be implementation
dependent.
Table D.1: State symbols
* * *
State symbol Phase / Mode  
A Phase A Transmission / Reception side FA NONECM / ECM R-A1 Reception side FA  
T Phase B Transmission side FA  
T_B1  
T_B2  
T_B4  
T_B5  
R Reception side FA  
R_B1  
R_B3  
R_B4  
R_B5  
T_C1 Phase C Transmission side FA NONECM T_C2 ECM R_C1 Reception side FA
NONECM R_C2 ECM T_D1 Phase D Transmission side FA NONECM T_D2 ECM T_D2_res1  
T_D2_res2  
R_D1 Reception side FA NONECM R_D2 ECM R_D1_MPS NONECM R_D1_EOM  
R_D1_EOP  
R_D2_NULL ECM R_D2_MPS  
R_D2_EOM  
R_D2_EOP  
R_D2_E_NULL  
R_D2_E_MPS  
R_D2_E_EOM  
R_D2_E_EOP  
E1 Phase E Transmission / Reception side FA NONECM / ECM E2  
E3
* * *
Figure D.1: System 23.146 - Overview
Figure D.2a: Block FA_UE Entity
Figure D.2b: Procedure Reference
Figure D.3: Initial operation flow for a FA (Analogue)
Figure D.4: Transmission side FA, Phase B (Basic control flow)
Figure D.5: Reception side FA, Phase B
{width="3.772222222222222in" height="5.3597222222222225in"}
Figure D.6: Output conditions for \"TCF error detection\" for ECM&NONECM
Figure D.7: Selection algorithm for CFR /FTT for T-FA ECM & NONECM
Figure D.8: Stand-by method for V.21/V.17/V.27ter/V.29 for T-FA
Figure D.9: Output conditions for FTT and specified TX rate decision
algorithm\ for DCS NONECM & ECM
Figure D.10: Transmission side FA, Phase C for NONECM
Figure D.11: Reception side FA, phase C for NONECM
Figure D.12: Transmission side FA, Phase C for
Figure D.13: Reception side FA, phase C for ECM
Figure D.14: Transmission side FA for NON ECM, Phase D (Basic control flow)
{width="6.791666666666667in" height="7.527083333333334in"}
Figure D.15: Reception side FA for NON ECM, Phase D (Basic control flow)
Figure D.16: Reception FA, Phase D (MPS)
Figure D.17: Reception FA, Phase D (EOM)
Figure D.18: Reception FA, Phase D (EOP)
{width="6.627083333333333in" height="5.558333333333334in"}
Figure D.19: Transmission side FA for ECM, Phase D (Basic control flow)
Figure D.20: Selection algorithm for MCF/PPR/RNR
Figure D.21: Selection for ERR / RNR ECM
Figure D.22: Reception side FA for ECM, Phase D (Basic control flow)
Figure D.23: Reception FA, Phase D (PPS-NULL)
Figure D.24: Reception FA, Phase D (PPS-MPS)
Figure D.25: Reception FA, Phase D (PPS-EOP)
{width="6.771527777777778in" height="8.160416666666666in"}
Figure D.26: Reception FA, Phase D (PPS-EOM)
Figure D.27: Reception FA, Phase D (EOR-NULL)
Figure D.28: Reception FA, Phase D (EOR-MPS)
Figure D.29: Reception FA, Phase D (EOR-EOP)
Figure D.30: Reception FA, Phase D (EOR-EOM)
Figure D.31: Command reception subroutine
Figure D.32: Wait subroutine
{width="6.470138888888889in" height="6.942361111111111in"}
Figure D.33: Response reception subroutine
Figure D.34: RR response reception subroutine
{width="4.288194444444445in" height="6.285416666666666in"}
Figure D.35: FA release flow (1)
Figure D.36: FA release flow (2)
Table D.2: Specified Timer values
* * *
Name of Timer Timer Value Refer to T1 35 ± 5(sec) ITU-T T.30 T2 6 ± 1(sec)
ITU-T T.30 T4 3,0(sec) ± 15% ITU-T T.30 Twa 60(sec) - Fill_insertion_timer
4,5(sec) ITU-T T.30 Flag_insertion_timer 50(sec) ITU-T T.30 66s 66(sec) ITU-T
T.30 3s 3(sec) -
* * *
###### ## Annex E (normative): ASN.1 notation
ASN.1 notation
3GTS23146 DEFINITIONS AUTOMATIC TAGS ::=
BEGIN
IFPPacket ::= SEQUENCE
{
type-of-msg Type-of-msg,
data-field Data-Field OPTIONAL
}
Type-of-msg ::= CHOICE
{
t30-indicator ENUMERATED
{
no-signal,
cng,
ced,
tcf-error-detect,
fa-busy,
fa-non-busy,
},
data ENUMERATED
{
v21,
v27-2400,
v27-4800,
v29-7200,
v29-9600,
v17-7200,
v17-9600,
v17-12000,
v17-14400,
...
}
}
Data-Field ::= SEQUENCE OF SEQUENCE
{
field-type ENUMERATED
{
hdlc-data,
hdlc-sig-end,
hdlc-fcs-OK,
hdlc-fcs-BAD,
hdlc-fcs-OK-sig-end,
hdlc-fcs-BAD-sig-end,
t4-non-ecm-data,
t4-non-ecm-sig-end
},
field-data OCTET STRING (SIZE(1..65535)) OPTIONAL
}
UDPTLPacket ::= SEQUENCE
{
seq-number INTEGER (0..65535),
primary-ifp-packet TYPE-IDENTIFIER.&Type(IFPPacket),\ error-recovery CHOICE
{
secondary-ifp-packets SEQUENCE OF TYPE-IDENTIFIER.&Type(IFPPacket),
fec-info SEQUENCE
{
fec-npackets INTEGER,
fec-data SEQUENCE OF OCTET STRING
}
}
}
END
#
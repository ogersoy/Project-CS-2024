# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
3GPP Rel-16 added 5GS support for Non-Public Networks based on stage 1 service
requirements in TS 22.261 [2]. The scope of this Technical Report is to study
further enhancements to the 5GS to fulfil the not yet supported stage 1
service requirements for Non-Public Networks in TS 22.261 [2] and requirements
described in e.g. TS 22.263 [3].
The following aspects are in scope of the study:
1\. Study enhancements to enable support for SNPN along with subscription /
credentials owned by an entity separate from the SNPN.
2\. Study how to support UE onboarding and provisioning for non-public
networks.
3\. Study enhancements to the 5GS for NPN to support service requirements for
production of audio-visual content and services e.g. for service continuity.
4\. Study the possibility for customizations or optimizations of 5GS when used
for NPN considering different deployment scenarios, e.g. when the NPN is
deployed and managed with the support of PLMN, when the NPN is deployed for
different coverage and device density.
5\. Study the need for additional exposure capabilities due to support for
NPN.
6\. Study support for SNPN and PLMN sharing the same NG-RAN, if anything
missing from Rel-16.
7\. Study support for voice/IMS emergency services for SNPN.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 22.261: \"Service requirements for next generation new services
and markets\".
[3] 3GPP TS 22.263: \" Service requirements for Video, Imaging and Audio for
Professional Applications (VIAPA)\".
[4] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[5] 3GPP TS 23.122: \"Non-Access-Stratum (NAS) functions related to Mobile
Station in idle mode\".
[6] 3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".
[7] 3GPP TS 33.501: \"Security architecture and procedures for 5G system\".
[8] 3GPP TS 24.501: \"Non-Access-Stratum (NAS) protocol for 5G System (5GS);
Stage 3\".
[9] Internet Assigned Numbers Authority (IANA): \"Private Enterprise
Numbers\"; https://www.iana.org/assignments/enterprise-numbers/enterprise-
numbers (retrieved March 26, 2020).
[10] 3GPP TS 24.502: \"Access to the 3GPP 5G System (5GS) via non-3GPP access
networks; Stage 3\".
[11] 3GPP TS 24.229: \"IP multimedia call control protocol based on Session
Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".
[12] 3GPP TS 33.203: \"3G Security; Access Security for IP-based services\".
[13] 3GPP TS 23.632: \"User Data Interworking, Coexistence and Migration;
stage 2\".
[14] 3GPP TS 23.503: \"Policy and charging control framework for the 5G System
(5GS); Stage 2\".
[15] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[16] 3GPP TS 23.228: \"IP Multimedia Subsystem (IMS); Stage 2\".
[17] 3GPP TS 22.228: \"Service requirements for the Internet Protocol (IP)
multimedia core network subsystem (IMS); Stage 1\".
[18] 3GPP TS 22.101: \"Service aspects; Service principles\".
[19] 3GPP TS 23.167: \"IP Multimedia Subsystem (IMS) emergency sessions\".
[20] SP-191038: \"IMS emergency support for SNPN\" (IESNPN).
[21] 3GPP TS 33.210: \"Network Domain Security (NDS); IP network layer
security\".
[22] GSMA SGP.01: \"Embedded SIM Remote Provisioning Architecture\", Version
4.0.
[23] GSMA SGP.02: \"Remote Provisioning Architecture for Embedded UICC
Technical Specification\", Version 4.0.
[24] GSMA SGP.21: \"eSIM Architecture Specification\", Version 2.2.
[25] GSMA SGP.22: \"eSIM Technical Specification\", Version 2.2.1.
[26] 3GPP TS 31.115: \"Secured packet structure for (Universal) Subscriber
Identity Module (U)SIM Toolkit applications.
[27] 3GPP TS 31.111: \"Universal Subscriber Identity Module (USIM),
Application Toolkit (USAT)\".
[28] 3GPP TR 23.716: \"Study on the Wireless and Wireline Convergence for the
5G system architecture\".
[29] 3GPP TS 23.287: \"Architecture enhancements for 5G System (5GS) to
support Vehicle-to-Everything (V2X) services\".
[30] 3GPP TS 24.587: \"Vehicle-to-Everything (V2X) services in 5G System
(5GS); Stage 3\".
[31] 3GPP TS 29.244: \"Interface between the Control Plane and the User Plane
Nodes; Stage 3\".
[32] IETF draft: \"Remote Attestation Procedures Architecture\" ( draft-ietf-
rats-architecture-04).
[33] IETF draft: \"The Entity Attestation Token (EAT)\" (draft-ietf-rats-
eat-03).
[34] MulteFire Alliance (MFA), Architecture for Neutral Host Network Access
Mode Stage 2 (Release 1.1), MFA TS MF.202, https://www.multefire.org/, Release
1.1.
[35] 3GPP TS 33.310: \"Network Domain Security (NDS); Authentication Framework
(AF)\".
[36] 3GPP TS 23.973: \"User data interworking, coexistence and migration\".
[37] 3GPP TS 29.544: \"5G System; Secured Packet Application Function (SP-AF)
services; Stage 3\".
[38] 3GPP TS 29.561: \"5G System; Interworking between 5G Network and external
Data Networks; Stage 3\".
[39] 3GPP TS 23.558: \"Architecture for enabling Edge Applications (EA)\".
[40] 3GPP TS 23.288: \"Architecture enhancements for 5G System (5GS) to
support network data analytics services\".
# 3 Definitions of terms and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in TR 21.905 [1] and
the following apply. A term defined in the present document takes precedence
over the definition of the same term, if any, in TR 21.905 [1].
**Default UE credentials** : Information that the UE have before the actual
onboarding procedure to make it uniquely identifiable and verifiably secure.
**Default Credential Server (DCS)** : The server that can authenticate a UE
with default UE credentials or provide means to another entity to do it.
**NPN:** Non-Public Network as defined in TS 23.501 [4]. The terminology NPN
refers to both SNPN and PNI-NPN in this TR unless otherwise stated.
**NPN credentials:** Information that the UE uses for authentication to access
a NPN. NPN credentials may be 3GPP credentials or non-3GPP credentials.
**ON Group:** A group of Onboarding Networks.
**ON Group ID:** Identifying an ON Group.
**Onboarding Network (ON)** : The network providing initial registration
and/or access to the UE for UE Onboarding.
**Onboarding SUCI:** A SUCI created from the Onboarding SUPI and used for
onboarding purposes.
**Onboarding SUPI:** A SUPI that is based on the Unique UE Identifier and/or
the Default UE Credentials and is used for onboarding purposes.
**Overlay network:** When UE is accessing SNPN service via PLMN, SNPN is the
overlay network. When UE is accessing PLMN services via SNPN, PLMN is the
overlay network.
**Provisioning Server:** The server that provisions the
authenticated/authorized UE with the subscription data and optionally other
configuration information.
**Remote provisioning:** Provisioning of information, to a UE and within the
network, required for the UE to get authorized access and connectivity to an
NPN.
**Subscription Owner (SO):** The entity that stores and as result of the UE
Onboarding procedures provide the subscription data and optionally other
configuration information via the PS to the UE.
**Support for Onboarding Indication:** Indicating that the network
supports/allows UE Onboarding.
**UE Onboarding:** Enabling 3GPP connectivity for UE to realize remote
provisioning.
**Underlay network:** When UE is accessing SNPN service via PLMN, PLMN is the
underlay network. When UE is accessing PLMN services via SNPN, SNPN is the
underlay network.
**Unique UE identifier** : Identifying the UE in the network and the DCS and
is assigned and configured by the DCS.
NOTE 1: The unique UE identifier is assumed to be unique within the DCS. It
takes the form of a Network Access Identifier (NAI) using the NAI RFC 7542.
NOTE 2: the definition of terms has the scope to provide a common language
compared to the definitions in specific solutions. It is up to solutions to
use the common terms, when applicable.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
DCS Default Credential Server
IMC IMS Credentials
ON Onboarding Network
PS Provisioning Server
SO Subscription Owner
# 4 Architectural Assumptions and Requirements
## 4.1 Architectural Requirements
\- Solutions shall build on the 5G System architectural principles as in TS
23.501 [4], including flexibility and modularity for newly introduced
functionalities.
# 5 Key Issues
## 5.1 Key Issue #1: Enhancements to Support SNPN along with credentials owned
by an entity separate from the SNPN
### 5.1.1 Description
One area that needs further study is enhancements to the 5GS in order to
enable support for SNPN along with subscriptions or credentials owned by an
entity separate from the SNPN.
Studying 5GS enhancements specifically oriented towards support of SNPN with
credentials owned by an entity separate from the SNPN is necessary to enable
some of the main use cases for Non-Public Networks, such as wireless
connectivity for industry, large residential buildings, campuses, malls, and
merged SNPNs, which all contain several specialized and stringent
requirements. Many of the relevant use cases may in turn potentially have an
impact on the architecture.
This key issue aims at addressing the following points for SNPN along with
subscription owned by an entity separate from the SNPN:
\- How to identify the separate entity providing the subscription;
\- Network selection enhancements, including UEs with multiple subscriptions;
\- E.g. how does the UE discover and select an SNPN which provides
authentication in an external entity;
\- Architecture enhancements needed to support multiple separate entities,
e.g.:
\- What are the interfaces exposed and/or used by SNPN and the separate
entity;
\- What is the architecture and solution for a UE accessing a separate entity
via SNPN access network;
\- How to exchange authentication signalling between the SNPN and the separate
entity, including:
\- Authentication by the PLMN, based on PLMN identities and credentials, for
access to the SNPN;
\- Authentication via SNPN to separate entity based on non-3GPP identities
(e.g. non-IMSI) and credentials;
\- Mobility scenarios, including service continuity, for:
\- UE moving from SNPN#1 with separate entity#1 to SNPN#2 with separate
entity#1 available; and
\- UE moving between SNPN#1 (where separate entity=PLMN) and PLMN.
NOTE: Security aspects should be defined by SA WG3.
## 5.2 Key Issue #2: NPN support for Video, Imaging and Audio for Professional
Applications (VIAPA)
### 5.2.1 Description
The TS 22.263 [3] captures the service requirements for \"Video, Imaging and
Audio for Professional Applications (VIAPA)\".
This key issue aims at addressing the following aspects:
1\. Study whether there are support for service continuity (assuming PSA may
reside in either PLMN or in the NPN) between PLMN and NPN (SNPN or PNI-NPN)
with overlapping radio coverage areas;
2\. Study means to enable a UE to receive data services from one network (e.g.
NPN), and paging as well as data services from another network (e.g. PLMN)
simultaneously.
NOTE: The data service from NPN can be the low latency and high data rate
service while serving massive number of UEs in a small area, e.g. the
integrated audience multicast service in large live production events, such as
music festivals (such as those listed in TS 22.263 [3] Table 6.3.1-1:
Performance requirements for low latency deterministic periodic traffic with
multicast service). It is assumed that the FS_IIoT will cover aspects to
enable low latency data services, and that FS_5MBS will cover aspects to
enable low latency multicast downlink services, while the scope of the FS_eNPN
is to enable these services while the UE is using two networks e.g. NPN and
PLMN.
## 5.3 Key Issue #3: Support of IMS voice and emergency services for SNPN
### 5.3.1 Description
3GPP Rel-16 includes IMS voice and emergency services support for Public
network integrated Non-Public Networks, while for SNPNs the following was
captured in TS 23.501 [4]:
\"_Emergency services are not supported in SNPN access mode._
_NOTE 1: Voice support with emergency services in SNPN access mode is not
specified in this release_ \".
This key issue aims at addressing the following points for SNPN:
\- Study the architectural impacts for support of IMS voice and emergency
services offered by SNPN;
\- Study whether basic IMS functionality for SNPN via 3GPP access requires any
specification changes to enable non-IMSI based IMPI usage over 3GPP access;
\- Study whether and how SNPN selection is impacted when taking into account
IMS voice support.
## 5.4 Key issue #4: UE Onboarding and remote provisioning
### 5.4.1 Description
The Key Issue is aiming to study the architecture and solutions to support UE
onboarding and provisioning for the NPN. This key issue includes some common
aspects such as:
\- Means for a UE, that is verifiably secure and uniquely identifiable to 5GS,
for onboarding and remote provisioning;
\- Support of exposure via APIs to support UE onboarding and remote
provisioning, if required.
But also specific aspects for component 1 (UE onboarding i.e. to enable 3GPP
connectivity):
\- How does the UE discover and select the onboarding SNPN before UE NPN
credentials and other information to enable UE to get 3GPP connectivity are
provisioned.
NOTE 1: Provisioning of PLMN credentials is not in scope of this KI. A UE
accessing a PLMN is assumed to have provisioned 3GPP credentials.
\- How and whether the onboarding SNPN authenticates the UE, and establishes a
secure 3GPP connectivity, before the UE\'s NPN credentials and other
information to enable SNPN access are provisioned.
\- How to establish a secure connectivity between the UE and the network
entity for provisioning the NPN credentials and other information to enable
SNPN access, i.e. how to enable ciphering and integrity protection of the
connection and the authentication of UE at the Provisioning Server.
\- How does the 5G system provides and updates in the network the subscription
of an authorized UE in order to allow the UE to request connectivity to a
desired SNPN.
\- Architecture including which NFs are involved, and which scenario(s) the
solution is addressing, including:
\- Which network entity performs UE\'s subscription provisioning and where is
the network entity located.
\- If the network entity performing UE subscription provisioning is external
to the SNPN, what is the service-based interface exposed by the SNPN towards
that network entity for UE onboarding and provisioning.
And for component 2 (remote provisioning of credentials to allow access to NPN
services):
\- SNPN case: provisioning of NPN credentials (i.e. for primary
authentication) and other information to enable SNPN access.
\- PNI-NPN case: provisioning of NPN credentials for access to specific
slice(s) and/or PDU Sessions offering NPN services, i.e. for Network Slice
Specific Authentication and Authorization and/or secondary authentication for
PDU Sessions
\- Means to remotely provision the required new or updated information to the
UE for enabling the UE to access the NPN using 5GS, including e.g.:
\- Triggers and procedures used to initiate the provisioning procedure.
\- How the network entity provisions the NPN credentials to the UE.
The associated solutions need to consider the following UE characteristics:
\- Before the UE onboarding process there should be information in the UE for
it to be \"uniquely identifiable and verifiably secure\".
NOTE 2: This does not mean the UE is required to support the frequency bands
the PLMN deploys for public network.
\- A TE might not have an interface that can be used to provision the MT.
NOTE 3: This key issue covers devices with and without a UICC.
NOTE 4: Security aspects should be discussed and confirmed by SA WG3.
NOTE 5: For the provisioning of IMSI accompanied by AKA credentials it is
assumed that protocol for provisioning in USIM outside 3GPP scope is used,
e.g. as specified in GSMA RSP.
NOTE 6: The separation in two components 1 and 2 is done for readability.
NOTE 7: Existing Provisioning server (e.g. CA (Certificate Authority)) in IT
architecture provides N3GPP credential to the terminal device using protocol
out of scope of 3GPP e.g. CMPv2 protocol (Certificate Management Protocol
version 2).
## 5.5 Key Issue #5: Support for equivalent SNPNs
### 5.5.1 Description
This key issue is to enable a UE access multiple SNPNs and the ability to
support optimized access control and service continuity between SNPNs. This is
to enable support for equivalent SNPN (similar to equivalent PLMN) and/or
equivalent home SNPN (similar to equivalent HPLMN). Impact to 5G System due to
the following scenarios are in the scope:
\- Individual SNPNs with their own PLMN ID and NID identification but they are
all equivalent. This implies that the UE with subscription for one of the SNPN
has access to its equivalent SNPN(s). This also implies that the UE treat
individual SNPNs with equal priority for network selection.
It has the following objectives for study:
\- Enabling an authorized UE to be able to efficiently access and move between
equivalent SNPNs; and
\- Enabling an authorized UE to be able to efficiently select equivalent SNPNs
during network selection.
NOTE: This key issue is not addressed within Rel-17 timeframe.
## 5.6 Key Issue #6: Support of non-3GPP access for SNPN services
### 5.6.1 Description
One area that needs further study is enhancements to the 5GS in order to
enable support for direct connection of non-3GPP access networks to the
SNPN\'s 5GC. There are already non-3GPP access technologies which are in use
in enterprises and campuses and it is foreseen that such non-3GPP access
technologies will continue to evolve. The integration of these existing assets
in the SNPN would add flexibility to the SNPN operators.
This key issue aims at addressing the following points for SNPN:
\- How to provide direct access to SNPN services via non-3GPP access networks:
\- Support of trusted non-3GPP access network (TNAN);
\- Support of untrusted non-3GPP access network; and
\- Whether and how Wireline 5G Access Network can be used to connect to SNPN.
NOTE: This key issue is not addressed within Rel-17 timeframe.
# 6 Solutions
## 6.0 Mapping Solutions to Key Issues
Table 6.0-1: Mapping of Solutions to Key Issues
              Key Issues
* * *
Solutions 1 2 3 4 5 6 1 X X  
2 X X  
3 X  
4 X  
5 X  
6 X  
7 X  
8 X  
9 X  
10 X  
11 X  
12 X  
13 X  
14 X  
15 X  
16 X  
17 X  
18 X  
19 X  
20 X  
21 X  
22 X  
23 X  
24 X  
25 X  
26 X  
27 X  
28 X  
29 X  
30 X  
31 X  
32 X  
33 X  
34 X  
35 X  
36 X  
37 X  
38 X  
39 X  
40 X  
41 X  
42 X  
42 X  
43 X  
44 X  
45 X  
46 X  
47 X  
48 X  
49 X  
50 X  
51 X  
52 X  
53 X  
54 X  
55 X  
56 X
## 6.1 Solution #1: Standalone non-public network supporting service providers
### 6.1.0 Definitions {#definitions-1}
**Visited-SNPN (V-SNPN):** An SNPN for which the UE does not have a
subscription associated with the SNPN\'s identity (PLMN ID and NID
combination) and which supports access using credentials (Home SP credentials)
owned by an entity separate from the SNPN.
**Home Service Provider (Home SP):** An entity separate from the SNPN that
supports that its subscription is used to access a (different) SNPN. Also
referred in the text simply as \"Service Provider\".
### 6.1.1 Introduction {#introduction-1}
The solution addresses key issue #1 (Enhancements to Support SNPN along with
credentials owned by an entity separate from the SNPN). The solution also
addresses the service continuity aspect in KI#2.
Figure 6.1.1-1: Standalone Non-public network supporting service providers
with services provided by the Serving SNPN; Home SP = SNPN
Figure 6.1.1-2: Standalone Non-public network supporting service providers
with services provided by the Serving SNPN; Home SP = PLMN
Figure 6.1.1-3: Standalone Non-public network supporting service providers
with services provided by the Service Provider; Home SP =SNPN
Figure 6.1.1-4: Standalone Non-public network service providers with services
provided by the Service Provider; Home SP =PLMN
NOTE 1: The entity separate from the SNPN is referred to as service provider.
The SP owns at least an AUSF and a UDM.
NOTE 2: Reference points between the SNPN and the Home SP need not be roaming
interfaces (e.g. N12, N8, N10, N16...).
The following are the main principles of the solution:
\- Depicted in Figure 6.1.1-1 and Figure 6.1.1-2 is the architecture for
Standalone Non-Public Network (SNPN) supporting Service Providers with
services provided by the Serving SNPN for the case where SP is an SNPN and a
PLMN, respectively.
\- Depicted in Figure 6.1.1-3 and Figure 6.1.1-4 is the architecture for SNPN
supporting Service Providers with services provided by the Service Provider
for the case where SP is an SNPN and a PLMN, respectively.
\- It is assumed that there is a service level agreement between the SNPN
owner and the Service Provider.
\- The Service Provider owns the subscription of the UE(s) and Standalone NPN
provides access and connectivity for the UE. When the Service Provider uses
PLMN credentials for its subscribers, the UE uses USIM credentials.
\- For each subscription with a service provider, the UE is configured with an
\"Equivalent Home Service Provider\" list and/or a \"Service Provider
Controlled Network Selector\" list and/or \"User Controlled Network Selector\"
list that assists the UE in network selection.
### 6.1.2 Functional Description
The solution has the following assumptions:
\- A standalone non-public network has control plane and optionally user plane
interfaces with one or more service providers. At the minimum, the 5GC of the
SNPN needs to have an interface with the AUSF/UDM residing in the Service
Provider.
\- For the case where SP=SNPN: the network selection is controlled via
configured lists (refer below to the \"Equivalent Home Service Provider\"
list, \"Service Provider Controlled Network Selector\" list and \"User
Controlled Network Selector\" list) which include (PLMN ID, NID) tuples and
the SNPN selection follows the principles of PLMN selection as specified in TS
23.122 [5] by replacing PLMN IDs with (PLMN ID, NID) tuples.
NOTE 1: Equivalent Home Service Provider list will not be pursued in Rel-17 as
equivalent (H)SNPN functionality has been deprioritized, see also clause 5.5.1
\- For the case where SP=PLMN: the network selection is controlled via
configured lists (refer below to the \"Equivalent Home Service Provider\"
list, \"Service Provider Controlled Network Selector\" list and \"User
Controlled Network Selector\" list) which include a mix of both PLMN IDs and
(PLMN ID + NID) tuples and the SNPN selection is fully integrated into PLMN
selection as specified in TS 23.122 [5].
Editor\'s note: For the case where SP=PLMN, SA WG1 needs to clarify the
service requirements for the solution and CT WG1 needs to confirm the solution
and therefore the network selection proposal in this solution for the case
where SP=PLMN is FFS.
NOTE 2: When using SNPN credentials the device is in SNPN access mode. For
devices configured with both SNPN and PLMN credentials, the SNPN access mode
is turned on or off when the device uses SNPN or PLMN credentials,
respectively.
The solution is based on the following principles:
\- The UE has subscription with Service Provider identified with a service
provider ID. The service provider identifier may be identified by a PLMN ID or
PLMN ID+NID.
\- When the Service Provider of the UE is identified by a PLMN ID, the UE
subscription data and credentials are stored at the UDM/UDR and the UE uses
USIM credentials. This is represented in Figure 6.1.1-2 and Figure 6.1.1-4.
\- The stand-alone non-public network can provide local services to the UE
using the architecture in Figure 6.1.1-1 and Figure 6.1.1-2, or provide access
to the Service Provider services using the architecture in Figure 6.1.1-3 and
Figure 6.1.1-4.
\- When the Service Provider of the UE is identified by a PLMN ID, the
standalone non-public network selects the session management function and PDU
Session Anchor (PSA) in the SP to support PDU sessions that require service
continuity using the architecture in Figure 6.1.1-3 or Figure 6.1.1-4.
\- Mobility in the absence of the N14 interface between SNPN and PLMN is
handled by the \"Existing PDU Session\" indication in the PDU Session
Establishment Request.
NOTE 4: Service continuity even between SNPN requires 3GPP credentials being
used as usage of non-3GPP credentials in this release is per service
requirement for isolated networks only. Session establishment and continuity
with an Home SP requires 3GPP credentials as usage of non-3GPP credentials in
this release is per service requirement for isolated networks only.
\- When the Service Provider of the UE is a SNPN, the UE subscription data and
credentials are maintained by the SNPN. This is represented in Figure 6.1.1-1,
where UE has subscription with the Service Provider which is a SNPN and the UE
is authorized to services provided by the SNPN.
\- The NG-RAN nodes in the standalone non-public network broadcasts the
following:
\- List of combined PLMN IDs and NIDs identifying the standalone non-public
networks to which the NG-RAN provides access.
\- The UE shall be configured with the following:
\- Subscriber identifier and credentials for the subscribed service provider
(which is identified by PLMN ID or a combination of PLMN ID and NID).
\- A \"Service Provider Controlled Network Selector\" list which is modelled
based on the Operator Controlled PLMN Selector with Access Technology list
defined in TS 23.122 [5]. This list can include both PLMN IDs and (PLMN ID,
NID) tuples (case where SP=PLMN) or only (PLMN ID, NID) tuples (case where
SP=SNPN) ranked in priority order.
\- A \"User Controlled Network Selector\" list which is modelled based on the
User Controlled PLMN Selector with Access Technology list defined in TS 23.122
[5]. This list can include both PLMN IDs and (PLMN ID, NID) tuples (case where
SP=PLMN) or only (PLMN ID, NID) tuples (case where SP=SNPN) ranked in priority
order.
\- In addition, the UE may be configured with an \"Equivalent Home Service
Provider\" list which is modelled based on the EHPLMN list defined in TS
23.122 [5]. This list can include both PLMN IDs and (PLMN ID, NID) tuples
(case where SP=PLMN) or only (PLMN ID, NID) tuples (case where SP=SNPN) ranked
in priority order.
\- The above information can be updated by a Home SP (for its subscription)
using the UE Configuration Update procedure as defined in TS 23.502 [6] clause
4.2.4.2. An alternative is to use the UE parameter update procedure and other
provisioning methods can be considered by Stage 3 WGs.
If the Rel-17 UE does not need to be prevented from attempting to register
with a Rel-16 SNPN completely (i.e. not even make a single attempt), the
Rel-17 UE may attempt to connect to a Rel-16 SNPN (e.g. because the serving
SNPN identity is configured in the UE configured lists). In this case the SNPN
rejects the registration attempt with an appropriate rejection cause specified
in TS 24.501 [8] e.g. #74 (Temporarily not authorized for this SNPN) or #75
(Permanently not authorized for this SNPN). This will prevent the Rel-17 UEs
(either temporarily or permanently) from future registration attempts with
this SNPN.
If the Rel-17 UE needs to be prevented from attempting to register with a
Rel-16 SNPN completely (i.e. not even make a single attempt), then it is
proposed to use a new SIB indication (with the meaning \"access using Home SP
credentials is supported\") so that Rel-17 UEs can only attempt to connect to
an SNPN using Home SP credentials when this indication is advertised. For
introducing this indication, co-ordination with RAN WG2 is required.
### 6.1.3 Procedures
The UE configuration is described in clause 6.1.2.
The principles for standalone non-public network discovery and selection with
support for service providers is as given below:
\- UE has subscription with a service provider identified in the configured
lists in the UE by its PLMN ID or combination of PLMN ID and NID. (For example
- identified as SP#X).
\- SP#X has an agreement with standalone non-public network (NPN#A) that is
identified in the information broadcasted on the radio interface by its
combination of PLMN ID and NID (For example - identified as NPN#A), allowing
the UEs that have subscription with SP#X to access the services of SP#X via
NPN#A.
\- The UE has a stored \"Service Provider Controlled Network Selector\" list
and/or a \"User Controlled Network Selector\" list, and optionally an
\"Equivalent Home Service Provider\" list, that contains both SP#X and NPN#A.
\- The radio access network of NPN#A broadcasts its own ID i.e. NPN#A.
\- The UE which has subscription with SP #X selects NPN #A if NPN #A is
configured in one of UE\'s configured lists. The UE evaluates the configured
lists in the following precedence order for network selection: first
\"Equivalent Home Service Provider\" list, then \"User Controlled Network
Selector\" list, then \"Service Provider Controlled Network Selector\" list.
This is similar as currently specified in TS 23.122 [5] where EHPLMN list has
higher priority than Operator Controlled PLMN Selector list.
NOTE: If the UE is in coverage of the service provider\'s SNPN (i.e. the
information broadcasted on the radio interface includes the PLMN ID + NID
tuple of the SNPN), the UE selects this SNPN.
\- Once the network selection is complete, the UE registers with the network
by providing the UE identity, (including the SP identity e.g. as part of the
\"realm\" part in the UE identity) and credential corresponding to the service
provider. It is assumed that the authentication request is routed to UDM in
the service provider\'s administrative domain.
\- If during network selection the UE has exhausted all the PLMN ID or PLMN ID
+ NID tuples in the configured list without finding a match with the
information advertised on the radio interface, the UE does not attempt to
register with any SNPN.
\- If the UE has subscriptions with multiple service providers, this solution
assumes that the user selects the subscription which it wants to use before
network selection is triggered.
### 6.1.4 Impacts on services, entities and interfaces
UE:
\- UE is configured with \"Service Provider Controlled Network Selector\" list
and/or \"User Controlled Network Selector\", and optionally an \"Equivalent
Home Service Provider\" list, that contains both SNPN identities and PLMN
identities (case where SP=PLMN) or only SNPN identities (case where SP=SNPN).
\- Integrated PLMN and SNPN selection procedure if SP=PLMN.
\- SNPN selection procedure enhancements if SP=SNPN
NG-RAN:
\- None (if the use of rejection cause is deemed sufficient) or a new SIB
indication with the meaning of \"access using Home SP credentials is
supported\".
5GC:
\- Support for PlmnIdNid data type on N8, N12, N16, N24 and N31.
## 6.2 Solution #2: SNPN access using credentials owned by an entity separate
from the SNPN
### 6.2.1 Introduction {#introduction-2}
This solution addresses Key Issue #1 (\"Enhancements to Support SNPN along
with credentials owned by an entity separate from the SNPN \"). Those entities
separate from the SNPN are referred to as Home SPs hereafter. The solution
also addresses Key Issue 2 (\"NPN support for Video, Imaging and Audio for
Professional Applications (VIAPA)\") as it enables UEs with e.g. a PLMN
subscription to access a venue NPN that provides e.g. audience services.
Key idea of the solution is that a Visited-SNPN (V-SNPN) broadcasts
information that enables a UE to determine whether the UE can access the
V-SNPN using any of the Home SP credentials that the UE is configured with.
In particular, a V-SNPN may broadcast identities of Home SPs that the V-SNPN
has an agreement with, i.e. which supports access to the V-SNPN using the
credentials of those Home SPs.
This approach addresses e.g. scenarios where it is not guaranteed that the
Home SP can always provide the UE with the list of all allowed V-SNPNs before
the UE needs to select a V-SNPN. The latter refers for example to scenarios
where a new SNPN needs to be added for a UE while the UE is disabled and the
UE is powered on in a location where only that V-SNPN is available. One
example is audio/video recording equipment that is transported from a storage
facility to a venue where it needs to be temporarily installed and connected
to the venue\'s SNPN.
A V-SNPN may also broadcast the identities of Home SP Groups that the V-SNPN
has an agreement with for access to the V-SNPN using the credentials of any of
the Home SPs that are part of the Home SP Group. The UE is assumed to be
configured by the Home SP with one or more Home SP Groups that the Home SP is
part of so that the UE can select a V-SNPN that supports one of the Home SP
Groups the UE is configured with. One benefit of the Home SP Group is that the
V-SNPN does not need to broadcast the identities of all the Home SPs that are
part of the Home SP Group but only needs to broadcast the Home SP Group ID
instead.
Home SP Group examples include:
\- National operating companies of a multi-national operator
\- By broadcasting the Home SP Group ID assigned to the multi-national
operator, a V-SNPN can enable the UEs from all the national operating
companies of the multi-national operator to select the V-SNPN (instead of
having to broadcast the Home SP IDs of each of the national operating
companies, which may also exceed the number of Home SP IDs supported by SIB).
\- Home SPs that are connected to an interconnection provider
\- Typically mobile operators have direct interconnections and agreements only
with large partner networks.
\- For the large amount of small partner networks, mobile operators typically
use the services of an interconnection provider that provides interconnection
with a large amount of partner networks while avoiding the need for bilateral
agreements and interconnections.
\- By broadcasting the Home SP Group ID assigned to the interconnection
provider, a V-SNPN can enable the UEs from all the Home SPs connected to the
interconnection provider to select the V-SNPN (instead of having to broadcast
the IDs of each of the Home SPs, which may also exceed the number of Home SP
IDs supported by SIB) while also avoiding the need for the Home SPs to
maintain an accurate list of all the supported V-SNPNs.
NOTE 1: The Home SP Group ID is assumed to be globally unique or self-managed.
Assignment of a unique Home SP Group ID is beyond the scope of 3GPP.
Editor\'s note: Home SP Group ID can be based on private enterprise number
issued to e.g. a multi-national operator group or to an interconnection
provider by Internet Assigned Numbers Authority (IANA) in its capacity as the
private enterprise number administrator [9].The exact format of the Home SP
Group ID will be defined by CT WG4. Considering only subsets of the solution
during conclusion of the key issue is not precluded, e.g. the need for Home SP
ID broadcast is FFS.
Editor\'s note: Interconnection provider and Home SP Group approach involving
PLMNs (i.e. for UEs using a PLMN subscription) needs to be clarified with GSMA
and is therefore FFS.
The following clauses illustrate the solution in greater detail.
### 6.2.2 Functional Description
#### 6.2.2.1 Definitions {#definitions-2}
The following definitions apply:
**Visited-SNPN (V-SNPN):** An SNPN for which the UE does not have a
subscription associated with the SNPN\'s identity (PLMN ID and NID
combination) and which supports access using credentials owned by an entity
separate from the SNPN (Home SP credentials).
**Home Service Provider (Home SP):** A PLMN or an SNPN that supports that its
subscription is used to access a (different) SNPN.
**Home SP subscription:** A subscription issued by an SNPN or a PLMN.
**Home SP-ID:** Identifies the Home-SP that issued the subscription that a UE
is using to access a V-SNPN. The Home SP ID consists of a PLMN ID, if the Home
SP is a PLMN or a PLMN and NID, if the Home SP is an SNPN.
**Home SP Group:** A group of Home SPs that a V-SNPN has an agreement with for
access to the V-SNPN using the credentials of any of the Home SPs that are
part of the Home SP Group.
**Home SP Group ID:** Identifies a Home SP Group.
#### 6.2.2.2 Architectures
Registration with V-SNPNs and access to data networks located in the V-SNPN or
the Home SP is supported based on the following architectures:
1) 5GS architecture for local breakout scenarios as documented in TS 23.501
[4] clause 4.2.4 with the V-SNPN taking the role of the V-PLMN and the Home SP
taking the role of the HPLMN (Figure 6.2.2.2-1). In other words the Home SP
takes the role of the subscription owner and authenticates the UE.
This architecture enables access to V-SNPN services (e.g. local IP access or
Internet access).
2) 5GS architecture for home-routed scenarios as documented in TS 23.501 [4]
clause 4.2.4) with the V-SNPN taking the role of the V-PLMN and the Home SP
taking the role of the HPLMN (Figure 6.2.2.2-2). This architecture only
applies to UEs with a PLMN subscription , i.e. 3GPP credentials are required.
\- This architecture enables access to Home SP services using a home-routed
PDU session.
Figure 6.2.2.2-1: Access to V-SNPN services (e.g. local IP access or Internet
access) using home SP credentials for authentication in the V-SNPN
Figure 6.2.2.2-2: Access to Home PLMN services using a home-routed PDU
session.
#### 6.2.2.3 System information broadcast
NG-RAN nodes which support access using Home SP credentials broadcast the
following information per SNPN:
\- Indication that access using Home SP credentials is supported
\- List of supported Home SP IDs
\- List of supported Home SP Group IDs
NOTE: Further details, number of supported Home SP IDs and number of supported
Home SP Group IDs that can be broadcast as well as optimizations will be
determined by RAN WG2. This includes whether the indication that access using
Home SP credentials is supported is needed or can be combined with other
information and whether the (full) list of supported Home SP IDs/Home SP Group
IDs is always provided or only on demand as part of the broadcast information.
#### 6.2.2.4 UE configuration
##### 6.2.2.4.1 General
A UE is configured with a Home SP subscription and the corresponding Home SP
ID.
NOTE 1: Home SPs that support access to V-SNPNs using the Home SP subscription
are assumed to provision the UE with a SUPI that enables the V-SNPN to find
the Home SP\'s UDM.
NOTE 2: If the UE has multiple Home SP subscriptions it is assumed that the
subscription to use is selected by implementation specific means (e.g. based
on user input) prior to network selection.
##### 6.2.2.4.2 SNPN subscription
A Home SP subscription issued by an SNPN may optionally contain the following
additional information:
\- User-controlled prioritized list of preferred SNPNs
\- Home SP-controlled prioritized list of preferred SNPNs and Home SP Groups
The above information (except the user-controlled list) can be updated by the
Home SP using the UE Configuration Update procedure as defined in TS 23.502
[6] clause 4.2.4.2.
The UE operates in SNPN access mode.
##### 6.2.2.4.3 PLMN subscription
A Home SP subscription issued by a PLMN may optionally contain the following
additional information:
\- User-controlled prioritized list of preferred SNPNs, preferred PLMNs
\- Home SP-controlled prioritized list of preferred SNPNs, preferred PLMNs and
Home SP Groups
\- Visited Network Type Preference (PLMN preferred or SNPN preferred or PLMN
only, or SNPN only)
The above information (except the user-controlled list) can be updated by the
Home SP using the UE Configuration Update procedure as defined in TS 23.502
[6] clause 4.2.4.2.
The UE does not operate in SNPN access mode.
NOTE 1: Details of AS/NAS impacts of searching for SNPNs when using a Home SP
subscription issued by a PLMN are expected to be discussed by RAN WG2 and CT
WG1.
NOTE 2: AKA credentials are assumed when using a Home SP subscription issued
by a PLMN.
### 6.2.3 Procedures
#### 6.2.3.1 Procedures for UEs using an SNPN subscription
##### 6.2.3.1.1 Automatic network selection and registration procedure
If the UE\'s Home SP network is not available, then the UE discovers and
selects an SNPN as follows:
\- In the remainder of this clause the UE ignores SNPNs that do not broadcast
the indication that access using Home SP credentials is supported.
\- If the UE is configured with a user-controlled prioritized list of
preferred SNPNs then the UE evaluates the list in priority order as follows:
\- if a PLMN ID and NID in the list matches the PLMN ID and NID of an
available SNPN, then the UE selects that SNPN;
\- If the UE has not been able to select a network based on the above and the
UE is configured with a Home SP-controlled prioritized list of preferred SNPNs
and Home SP Groups then the UE evaluates the list in priority order as
follows:
\- if a PLMN ID and NID in the list matches the PLMN ID and NID of an
available SNPN, then the UE selects that SNPN;
\- if a Home SP Group ID in the list matches a Home SP Group ID broadcast by
an available SNPN, then the UE selects that SNPN.
NOTE 1: Which SNPN to select if multiple SNPNs support access using the same
Home SP Group ID is up to UE implementation.
\- If the UE has not been able to select a network based on the above but if
an available SNPN broadcasts a supported Home SP ID that matches the UE\'s
Home SP subscription then the UE selects that SNPN.
NOTE 2: Which SNPN to select if multiple SNPNs broadcast the UE\'s Home SP ID
is up to UE implementation.
\- If the UE has not been able to select a network based on the above, then
the UE selects an available SNPN.
NOTE 3: The term \"selecting an available SNPN\" assumes the same selection
for SNPNs as currently defined for PLMNs in TS 23.122 [5] clause 4.4.3.1.1
steps iv) and v). Details are up to CT WG1.
Once the UE has selected an SNPN according to the procedure above, the UE
performs the Registration procedure (TS 23.502 [6], clause 4.2.2.2.2). The UE
provides the SUCI of the Home SP subscription. The UE is authenticated by the
Home SP.
NOTE 1: The procedure is assumed to be analyzed and further details are
assumed to be defined by CT WG1.
##### 6.2.3.1.2 Manual network selection and registration procedure
For manual selection the UE shall present the following SNPNs for selection:
\- Available SNPNs that broadcast the indication that access using Home SP
credentials is supported
Once the user has selected an SNPN from the available networks, the UE
performs the Registration procedure (TS 23.502 [6], clause 4.2.2.2.2). The UE
provides the SUCI of the Home SP subscription. The UE is authenticated by the
Home SP.
NOTE 1: Further details are assumed to be defined by CT WG1.
#### 6.2.3.2 Procedures for UEs using a PLMN subscription
##### 6.2.3.2.1 Automatic network selection and registration procedure
If the UE\'s RPLMN or (E)HPLMN is not available, then the UE discovers and
selects an SNPN or PLMN as follows:
\- In the remainder of this clause the UE ignores SNPNs that do not broadcast
the indication that access using Home SP credentials is supported.
\- If the UE is configured with a user-controlled prioritized list of
preferred SNPNs and PLMNs then the UE evaluates the list in priority order as
follows:
\- if a PLMN ID and NID in the list matches the PLMN ID and NID of an
available SNPN, then the UE selects that SNPN;
\- if a PLMN ID in the list matches the PLMN ID of an available PLMN, then the
UE selects that PLMN.
\- If the UE has not been able to select a network based on the above and the
UE is configured with a Home SP-controlled prioritized list of preferred
SNPNs, Home SP Groups and PLMNs then the UE evaluates the list in priority
order as follows:
\- if a PLMN ID and NID in the list matches the PLMN ID and NID of an
available SNPN, then the UE selects that SNPN;
\- if a PLMN ID in the list matches the PLMN ID of an available PLMN, then the
UE selects that PLMN;
\- if a Home SP Group ID in the list matches a Home SP Group ID broadcast by
an available SNPN, then the UE selects that SNPN.
NOTE 1: Which SNPN to select if multiple SNPNs support access using the same
Home SP Group ID is up to UE implementation.
\- If the UE has not been able to select a network based on the above and the
UE is configured with a Visited Network Type Preference indicating \"SNPN
preferred\" or \"SNPN only\" and an available SNPN broadcasts a supported Home
SP ID that matches the UE\'s Home SP subscription then the UE selects that
SNPN.
NOTE 2: Which SNPN to select if multiple SNPNs broadcast the UE\'s Home SP ID
is up to UE implementation.
NOTE 3: In the remainder of this clause the term \"selecting an available
SNPN\" assumes the same selection for SNPNs as currently defined for PLMNs in
TS 23.122 [5] clause 4.4.3.1.1 steps iv) and v). Details are up to CT WG1.
\- If the UE has not been able to select a network based on the above:
\- If the UE has been configured with a Visited Network Type Preference, then
the UE selects a network as follows:
\- If the Visited Network Type Preference indicates \"PLMN only\" then the UE
ignores available SNPNs and selects an available PLMN according to TS 23.122
[5] clause 4.4.3.1.1 steps iv) and v).
\- If the Visited Network Type Preference indicates \"PLMN preferred\" then
the UE tries to first select an available PLMN according to TS 23.122 [5]
clause 4.4.3.1.1 steps iv) and v) before trying to select an available SNPN.
\- If the Visited Network Type Preference indicates \"SNPN only\" then the UE
tries to select an available SNPN and ignores the PLMNs.
\- If the Visited Network Type Preference indicates \"SNPN preferred\" then
the UE tries to first select an available SNPN before trying to select a PLMN
according to TS 23.122 [5] clause 4.4.3.1.1 steps iv) and v).
\- If the UE has not been configured with a Visited Network Type Preference,
then the UE selects an available PLMN according to TS 23.122 [5] clause
4.4.3.1.1 steps iv) and v).
Once the UE has selected an SNPN or PLMN according to the procedure above, the
UE performs the Registration procedure (TS 23.502 [6], clause 4.2.2.2.2). The
UE provides the SUCI of the Home SP subscription. The UE is authenticated by
the Home SP.
Editor\'s note: The need to support access to SNPNs using a PLMN subscription
(and the related changes to the PLMN selection procedure) will be determined
during conclusion of the study.
Editor\'s note: Network selection is in scope of SA WG1 and CT WG1. Whether
there are service requirements for this, needs to be clarified with SA WG1 and
the issue should be analysed by CT WG1. This clause needs to be updated based
on the response from these groups
##### 6.2.3.2.2 Manual network selection and registration procedure
For manual selection the UE shall present the following networks for
selection:
\- Available SNPNs that broadcast the indication that access using Home SP
credentials is supported. (SNPNs shall only be presented if the UE is
configured with a Visited Network Type Preference other than \"PLMN only\".);
\- the available PLMNs.
Once the user has selected an SNPN or PLMN from the available networks, the UE
performs the Registration procedure (TS 23.502 [6], clause 4.2.2.2.2). The UE
provides the SUCI of the Home SP subscription. The UE is authenticated by the
Home SP.
NOTE 1: Further details are assumed to be defined by CT WG1.
##### 6.2.3.2.3 Session continuity support
If a UE is registered with a V-SNPN using a Home SP subscription moves to a
different V-SNPN that supports access using Home SP credentials for the same
Home SP but no N14 interface between source and target V-SNPN, then the UE
attempts to transfer PDU sessions to the target V-SNPN using the PDU Session
Establishment procedure with Existing PDU Session indication as defined in TS
23.502 [6] clause 4.3.2.2.
If a UE is registered with a V-SNPN using a Home SP subscription (where Home
SP = PLMN) moves to a PLMN which does not support the N14 interface between
V-SNPN and PLMN, then the UE attempts to transfer PDU sessions to the PLMN
using the PDU Session Establishment procedure with Existing PDU Session
indication as defined in TS 23.502 [6] clause 4.3.2.2.
If a UE is registered with a PLMN and moves to a V-SNPN that supports access
using Home SP credentials for the UE\'s HPLMN but does not support the N14
interface between V-SNPN and PLMN, then the UE attempts to transfer PDU
sessions to the target V-SNPN using the PDU Session Establishment procedure
with Existing PDU Session indication as defined in TS 23.502 [6] clause
4.3.2.2.
NOTE 1: Session continuity is only supported for PDU sessions anchored in the
Home SP network.
Editor\'s note: The need to support access to SNPNs using a PLMN subscription
(and the related changes to the PLMN selection procedure) will be determined
during conclusion of the study.
NOTE 2: Service continuity even between SNPN requires 3GPP credentials being
used as usage of non-3GPP credentials in this release is per service
requirement for isolated networks only. Session establishment and continuity
with an Home SP requires 3GPP credentials as usage of non-3GPP credentials in
this release is per service requirement for isolated networks only.
#### 6.2.3.3 Home SP Group Identity
##### 6.2.3.3.1 General
The Home SP Group Identity shall consist of an Assignment Mode and Home SP
Group Value as shown in figure 6.2.3.3.1-1.
Figure 6.2.3.3.1-1: Home SP Group ID (HSP ID)
Home SP Group Identity can be assigned using following assignment modes
a) Self-managed Home SP Group ID. This assignment mode is encoded by setting
the assignment mode to 1.
b) Globally Managed Home SP Group ID. This assignment mode is encoded by
setting the assignment mode to 2
Other Assignment mode values are reserved.
Home SP Group Value can be based on IANA Private Enterprise Numbers (PEN)
while the assignment mode allows the flexibility to support both locally
managed (enterprise self-managed) and globally managed (by a central
authority, e.g. IANA).
NOTE: Further details of Home SP Group ID, e.g. to further sub-divide the Home
SP Group Value can be discussed by CT WG4.
##### 6.2.3.3.2 Home SP Group ID of assignment mode 1
Home SP Group Value is assigned by organizations and used internal to the
organization. It does not remain unique. It can be assigned to UEs belonging
to the Organization and moving between different V-SNPNs which are part of the
Organization Network.
### 6.2.4 Impacts on services, entities and interfaces
NG-RAN:
\- Broadcast of additional information.
UE:
\- Support of additional configuration information (user-controlled
prioritized list of preferred SNPNs and PLMNs (if Home SP=PLMN); Home SP-
controlled prioritized list of preferred SNPNs, PLMNs (if Home SP=PLMN) and
Home SP Groups, Visited Network Type Preference (if Home SP=PLMN).
\- Reading and processing of additional information from SIB.
\- Support of V-SNPN selection and registration procedure.
AMF/UDM:
\- Support of additional information for UE Configuration Update procedure.
## 6.3 Solution #3: SNPN access using MOCN
### 6.3.1 Introduction {#introduction-3}
This solution addresses key issue 1 \"Enhancements to Support SNPN along with
credentials owned by an entity separate from the SNPN \".
NOTE: There is no consensus that the solution addresses key issue 1 because
the \"external entity\" in this solution is external to the RAN, not to the
5GS. However, the solution does not require any normative changes.
The solution enables UEs to get network connectivity of an SNPN deploying a
5GS with ability to share the SNPN\'s NG-RAN with other 5GCs. The entity
separate from the SNPN holds ability to deploy a complete 5GC and the SNPN
offers a shared NG-RAN for both 5GCs i.e. using MOCN functionality.
The NG-RAN broadcasts the network identities of the SNPN as well as the entity
separate from the SNPN.
### 6.3.2 Functional Description
#### 6.3.2.1 Architecture
Figure 6.3.2.2-1 depicts the architecture for the solution, i.e. the SNPN
includes an NG-RAN and, optionally, a 5GC and capabilities to host 5GC from
the entity separate from the SNPN leveraging on a shared NG-RAN. The entity
separate from the SNPN provides a complete 5GC.
Figure 6.3.2.1-1: Access to SNPN services using credentials from entity
separate from SNPN for authentication in the SNPN
#### 6.3.2.2 High level principles of the solution
The entity separate from the SNPN gets its 5GC available as a 5GC behind an
NG-RAN including getting its network identity in the broadcasted system
information. The PLMN IDs are limited to those being allowed in the region of
the NG-RAN, e.g. country specific MCC cannot be used outside the specific
country.
The UEs (of the entity separate from the SNPN) sees the entity separate from
the SNPN as its \"home network\".
### 6.3.3 Procedures
Existing procedures are used as is.
### 6.3.4 Impacts on services, entities and interfaces
There are no impacts to services, entities nor interfaces within SA WG2 scope.
It is assumed that the ability to add another 5GC to a shared NG-RAN can use
current RAN and SA WG5 specifications.
## 6.4 Solution #4: External Authentication and Authorization
### 6.4.1 Introduction {#introduction-4}
This solution addresses the key issue #1: Enhancements to Support SNPN along
with credentials owned by an entity separate from the SNPN. This solution
allows the UE using subscription or credentials owned by an entity separate
from the desired SNPN to register and request connectivity at the desired
SNPN.
This solution assumes that the AAA Server is the separate entity that owns and
authenticates UE\'s SNPN security related subscription (non-3GPP identities
e.g. non-IMSI and credentials). In addition, there are several ways to provide
the access and mobility subscription data, e.g. information on DNN, S-NSSAI,
UE-AMBR, dedicated SMF, etc. to enable AMF perform UE\'s access and mobility
management, optionally SMF selection, or the session management subscription
data, e.g. information on DNN, S-NSSAI, session-AMBR, service flow template,
UE address, etc. to enable SMF perform PDU session management:
Architecture approach 1:
\- AAA-S owns the access and mobility related subscription data and session
management subscription data as individual UE subscription and provides them
to AMF or SMF via AAA-P; or
\- AAA-P is pre-configured with the access and mobility related subscription
and session management subscription as common UE subscription per SO, and
provides them to AMF or SMF; or
Architecture approach 2:
\- UDM/UDR owns the access and mobility related subscription and session
management subscription data as individual or common UE subscription, the UE
subscription is indexed by a SUPI generated based on External UE ID, i.e. UE
ID assigned as part of the subscription owned by the AAA-S.
NOTE: It is assumed that the SNPN supports the SUPI generated based on
External UE ID, the UE subscription indexed by the SUPI is provisioned at the
SNPN UDM/UDR per agreements between SNPN and the SO.
\- UDM/UDR owns the mobility related subscription and service related
subscription as individual or common UE subscription, the UE subscription is
indexed by a SUPI assigned by the SNPN and this SUPI has no relation with the
External UE ID.
This applies for the cases where:
\- SNPN is deployed as an incremental enhancement or supplementary to the
existing communications (e.g. Ethernet, WLAN) infrastructure to leverage the
benefits of reliable, low latency wireless communications to meet specialized
and stringent requirements for industries. The existing user account (e.g.
identities/credentials) management server is used as the AAA Server; or
\- SNPN is deployed as an ad-hoc communication infrastructure to support
audio/video applications (includes television and radio studios, private
events, medical operating). An entity separate from the SNPN provides the user
account (e.g. identities/credentials) management server as the AAA Server and
the ad-hoc SNPN allows UE access with the non-3GPP identities/credentials
(e.g. user name/password).
### 6.4.2 Functional Description
#### 6.4.2.1 Architecture and Concept
Figure 6.4.2.1-1: Architecture in case separate entity that owns the
subscription is AAA-S
NOTE: For the sake of simplicity, the figures above do not show all NFs and
interfaces.
**Subscription Owner (SO):** The entity that provides the AAA-S and the
services to the end user.
**AAA-Server (AAA-S):** Entity separate from the desired SNPN but owns UE\'s
desired SNPN subscription. It is also responsible to authenticate/authorize
the UE based on the UE\'s SNPN subscription. It is deployed by the SO. It is
assumed that AAA-S and the Nx interface can provide UE individual subscription
data.
**AAA Proxy (AAA-P):** It acts as the relay for interactions between SNPN and
the AAA-S and undertakes any AAA protocol interworking with the AAA protocol
supported by the AAA-S. The AAA-P uses towards the AAA-S an AAA protocol
message of the same protocol supported by the AAA-S. It is deployed per SNPN.
AAA-P can be a new 5GC NF or collocated with AUSF or NSSAAF. It is assumed to
provide a service-based interface to AMF and SMF. AAA-P can also keep local
configuration per SO on the common UE subscription data to use.
**Nx:** Reference point between AAA-P and AAA-S that support AAA protocol,
e.g. Diameter.
**SO-ID:** SO Identity, it is used to uniquely identify a SO. SO-ID can be
domain name. The AAA-P can address the AAA-S with the SO-ID. The subscription
owner can use the domain name as a SO-ID. A valid domain name is issued
according to Internet Corporation for Assigned Names and Numbers - ICANN
regulations or be free form complying with a domain name format. A domain name
based SO-ID has a short form and a long form. The short form domain name based
SO-ID is calculated from the long form domain name by calculating the SHA-256
hash value of the long form and then extract and use the 24 most significant
bits as the short from domain name based SO-ID. The short form domain name
based SO-ID may be broadcast. Refer to MFA TS MF.202 [34].
**External Subscription (E-Sub):** UE\'s SNPN subscription
(credential/identity), which is stored in AAA-S. It can be non-3GPP identities
(e.g. non-IMSI) and credentials. E-Sub is used to authenticate and authorize
UE\'s access to the desired SNPN that provides connectivity to services of the
SO.
**External Authentication and Authorization (EAA):**
Authentication/Authorization executed by the AAA-S based on UE\'s E-Sub, in
particular the authentication related subscription.
#### 6.4.2.2 EAA for the UEs with E-Sub
This clause applies when the UE is provisioned with the E-Sub (subscription
stored at entity separate from the desired SNPN):
\- UE that is provisioned with E-Sub also contains the network configuration,
which is used for SNPN discovery and selection; the network configuration
contains the following information for each desired SNPN:
\- PLMN ID+NID; and
\- Priority; and optionally
\- Subscribed SO ID.
\- SNPN broadcasts the following information:
\- PLMN ID+NID; and
\- Access using credentials of SO separate from the SNPN supported (referred
to EAA for the sake of this solution), and optionally
\- Supported SO-ID list.
\- UE discovers and selects the desired SNPN based on network configuration
and the broadcast information. When the UE receives the broadcast from the
network that supports the EAA, the UE in order of the priority in network
configuration checks the first desired SNPN that is supported in the
broadcast, i.e. the PLMN ID+NID of the desired SNPN is equal to the PLMN
ID+NID received in broadcast, and the Subscribed SO ID of the desired SNPN is
present in the Supported SO-ID list received in broadcast.
\- UE using E-Sub performs registration to the SNPN. The SUPI provided at
Registration request message is generated based on External UE ID of E-Sub.
Alternatively, the SUPI provided at Registration request message is pre-
configured at the UE and has no relation with the E-Sub.
\- Based on local policy or UDM indication the SNPN triggers the EAA for the
UE. The EAA is performed between the UE and the AAA-S via SNPN.
\- SNPN and UE establishes the PDU Session to access to SP services.
### 6.4.3 Procedures
This figure 6.4.3-1 outlines the procedure for Architecture approach 1. In
this case, E-Sub is used to authenticate and authorize the UE for access to
the desired SNPN that provides connectivity to services of the SO.
In this case, UE selects and registers to the desired SNPN using network
configuration in E-Sub and received broadcast system information. Instead of
Authentication/Security at AUSF/UDM of SNPN during the registration, the AMF
triggers the EAA for UEs using E-Sub based on local policy, or the UDM
triggers the EAA for UEs using E-Sub based on UE subscription stored at
UDM/UDR. The SNPN establishes security context and decides whether to accept
the registration based on EAA results.
Figure 6.4.3-1: AMF triggered EAA of UEs with E-Sub
In this procedure AAA-S owns the access and mobility related subscription and
session management subscription data as individual UE subscription and
provides them to AMF or SMF via AAA-P; or AAA-P is pre-configured with the
mobility related subscription and service related subscription as common UE
subscription per SO, and provides them to AMF or SMF. This mobility related
subscription and service related subscription are used during UE\'s access and
mobility management, session management procedure.
1\. Steps 1-7 in clause 4.2.2.2.2 of TS 23.502 [6] are performed with the
following changes:
In Step 1, the UE includes the support for EAA in the AN message and \"EAA\"
Registration Type value in Registration Request message. The UE generates the
SUPI based on the UE Identity in E-Sub and include this SUPI in the
Registration Request message.
In Step 2, the RAN selects an AMF that supports for EAA.
The Registration Type indicates that the UE desires to use the E-Sub to
register to the SNPN, then AMF needs to select the AAA-P that supports
interactions with the AAA-S, the AMF needs to contact with the selected AAA-P
when the AMF needs to perform primary authentication/authorization.
2\. The AMF decides to trigger EAA based on UE request and local policy, the
AMF may ask the UE to start EAA procedure, and selects an AAA-P that supports
for exchange of EAA signalling between UE and AAA-S.
3\. Based on the UE Identity that contains the SO-ID, the AAA-P addresses the
AAA-S. The EAA is performed between the UE and the AAA-S via SNPN and the AMF
receives the EAA results. Besides that, AAA-S provides the anchor key to
AAA-P, AAA-P further provides it to AMF, and the AMF generates the security
context with that anchor key.
NOTE: The details of this EAA procedure will be defined by SA WG3.
4\. AMF retrieves the UE subscription from AAA-P, which obtains the UE
subscription from AAA-S as individual UE subscription or obtain the local
configuration per SO as common UE subscription. The UE subscription data may
include, e.g. information on DNN, S-NSSAI, UE-AMBR, dedicated SMF, etc. to
enable AMF perform UE\'s access and mobility management, optionally SMF
selection. Then steps 21-22 in clause 4.2.2.2.2 of TS 23.502 [6] are
performed.
5\. When SMF receives the PDU Session Establishment request, the SMF may
retrieve the UE subscription from AAA-P, which obtains the UE subscription
from AAA-S as individual UE subscription or obtain the local configuration per
SO as common UE subscription. The UE subscription data may include, e.g.
information on DNN, S-NSSAI, session-AMBR, service flow template, UE address,
etc. to enable SMF perform PDU session management.
Figure 6.4.3-2: UDM triggered EAA of UEs with E-Sub
This figure 6.4.3-2 outlines the procedure for Architecture approach 2. In
this procedure, UDM/UDR owns the mobility related subscription and session
related subscription as individual or common UE subscription, and provides
them to AMF or SMF during UE\'s access and mobility management, session
management procedure. The SUPI that used to index the subscription is
generated based on the UE Identity in E-Sub or the SUPI has no relation with
the UE Identity in E-Sub and is pre-configured at the UE.
In the case of a SUPI generated based on UE Identity in E-Sub is provided
during registration procedure, the subscription in UDM indicates that the
primary authentication and authorization should be performed towards the AAA-S
server, and the AUSF/AAA-P initiates the authentication and authorization
towards the AAA-S based on the SO-ID extracted from the SUPI and the UDM
indication.
In the case of a SUPI which has no relation with UE Identity in E-Sub is
provided during registration procedure, the AMF uses the primary
authentication procedure as defined in TS 33.501, consequently the AUSF sends
to AMF the Authentication method (primary authentication towards AAA-S) for
UE(s) whose subscription credential is owned by AAA. Then AMF triggers the
primary network authentication, asks UE to provide the UE Identity in E-Sub
and selects the AAA-P that supports interactions with the AAA-S. AMF and SMF
will obtain common, mobility related subscription and session related
subscription from the UDM during registration procedure and session management
procedure respectively.
### 6.4.4 Impacts on services, entities and interfaces
Impacts on UE:
Provisions with the E-Sub owned by the SO, as well as the corresponding
network configuration for discovery and selection of the available desired
SNPN that connects to the AAA-S.
Selects the desired SNPN based on network configuration and the received
broadcast information.
Indicates the support of EAA to RAN and the EAA Registration Type to AMF.
Impacts on RAN:
Broadcasts the support for EAA and the supported SO-ID list.
Selects the AMF that supports for EAA based on UE\'s EAA indication.
Impacts on AMF:
Triggers the EAA based on \"EAA\" Registration Type or UDM indication and
Selects the AAA-P that supports for EAA.
Receives UE subscription from AAA-P (only needed for architecture approach 1).
Impacts on SMF:
Receives UE subscription from AAA-P (only needed for architecture approach 1).
Impacts on UDM:
Determines to trigger the primary authentication and authorization towards the
AAA-S server and indicate to AAA-P/AUSF (only needed for architecture approach
2).
AUSF/AAA-P:
Addresses the AAA-S with UE Identity.
Interacts with the AAA-S to obtain the EAA results and UE subscription.
Relays EAA messages towards AAA-S for primary authentication and performs
related protocol conversion based on AMF indication or UDM indication.
Store local configuration per SO on the common UE subscription data and
provide it to AMF and SMF
Interface to AAA-S:
Is assumed to be able to transport individual UE subscription data (only
needed for architecture approach 1).
## 6.5 Solution #5: UE Onboarding and provisioning for an SNPN
### 6.5.1 Introduction {#introduction-5}
This solution addresses key issue 4 \"UE Onboarding and remote provisioning\".
Especially when the UEs are deployed without provisioned subscription, it
provides a solution on how UE subscription/credentials are afterward
provisioned to the UEs.
The solution enables UEs to get network connectivity to an O-SNPN
(\"onboarding SNPN\") so that it can be provisioned with necessary
subscription credentials and configuration for the SO-SNPN that will own the
UE\'s subscription (\"SNPN owning the subscription\").
Figure 6.5.1-1: UE onboarding in non-public network
The following assumptions are considered:
\- The UE is provisioned with some _default UE credentials_ and a _unique UE
identifier and ON Group IDs_.
NOTE 1: The unique UE identifier is assumed to be unique within the DCS. It
takes the form of a Network Access Identifier (NAI) which is composed of the
user part and the realm part which may identify the domain name of the DCS.
Editor\'s note: The exact definition and details of these default UE
credentials are FFS and need to be discussed with SA WG3.
\- The UE is not provisioned with _subscription credentials_ that grant access
to a SO-PLMN or to an SO-SNPN.
\- As part of the onboarding process the UE shall get access granted to an
O-SNPN based on e.g. default UE credentials.
\- The Onboarding SNPN (O-SNPN) that is used by the UE in the onboarding
process is not necessarily the same as the SO-SNPN (Subscription Owner SNPN)
for which subscription credentials will be provisioned in the UE.
\- The O-SNPN operator has access to a Default Credential Server (DCS), which
is used to verify that UE is subject to onboarding based on UE identifier and
the associated default UE credentials. The DCS is used for 5GS-level UE
authentication/authorization during registration to O-SNPN for onboarding
purpose. The owner of the DCS is out of scope of this document and can be
inside or outside of the O-SNPN e.g. DCS can be owned by the device
manufacturer, by a PLMN, by a SNPN other than the O-SNPN or by a 3rd party.
The DCS has the business relationship with the O-SNPN if the DCS is outside of
the O-SNPN.
Editor\'s note: Whether the 5GS-level UE authentication/authorization during
registration for onboarding purposes is needed is FFS and will be determined
by SA WG3.
NOTE 2: The security aspects and mechanisms for the data connection between
the UE and the Provisioning Server (e.g. to prevent a fake Provisioning Server
from provisioning the UE) are to be studied by SA WG3.
\- The O-SNPN operator provides the UE with connectivity to a Provisioning
Server that allows UEs to retrieve their subscription credentials and other
personalized configuration. The owner of the Provisioning Server is out of
scope of this document.
NOTE 3: In some deployments the DCS and the Provisioning Server can be the
same entity. In deployments where the DCS and the Provisioning Server are
different entities, it is expected that they communicate with each other to
share the security based on the default UE credentials for UE authentication
in the Provisioning Server via an interface that is outside of 3GPP scope.
Editor\'s note: It is determined by SA WG3 whether the DCS may share the
default UE credentials with the Provisioning Server which is a different
entity from the DCS.
\- The SO-SNPN owning the subscription (SO-SNPN) is provisioned to its UDM/UDR
from the Provisioning Server the corresponding UE\'s subscription credentials
and provides the Provisioning Server with the corresponding UE\'s
configuration data to be provisioned using the UE onboarding procedure, where
default UE credentials is used to identify the corresponding data to be
provisioned to the UE.
\- The DCS makes a contract with the SO-SNPNs owning the subscription for
provisioning the subscriptions to the UE and provides the SO-SNPN with the
list of UE identifiers.
\- The O-SNPN broadcasts system information including an identity of O-SNPN, a
Support for Onboarding Indication and optionally a list of ON Group IDs.
NOTE 4: Selection of O-SNPN in case of multiple O-SNPNs supporting UE
Onboarding for the UE is up to UE implementation.
### 6.5.2 Functional Description
#### 6.5.2.1 Introduction {#introduction-6}
The procedure hereby described allows a UE, which is not initially provisioned
with subscription credentials to access an Onboarding SNPN (O-SNPN) and to
obtain subscription credentials and configuration for an SO-SNPN which can be
the same as or different from the O-SNPN.
The UE selects the O-SNPN based on information broadcasted by the O-SNPN and
registers to it for onboarding service to obtain connectivity to the
Provisioning Server. If the UE is not configured with network selection
parameters for O-SNPN, the O-SNPN may be manually selected, or the UE may
randomly select a network that\'s available and supports onboarding
functionalities. If the UE fails to complete the remote provisioning through
the selected O-SNPN (e.g. the UE fails the authentication by the DCS), the UE
may select another O-SNPN to try the process again. During the registration
procedure the O-SNPN may authenticate the UE with the Default Credential
Server (DCS) to determine whether the UE is a genuine device subject to
onboarding and authorized to access a Provisioning Server via a Configuration
PDU Session. Upon establishment of connectivity to the Provisioning Server,
the UE is provisioned with the subscription credentials for the SO-SNPN (i.e.
SNPN that will own the UE\'s subscription) and additional configuration data.
Then the UE de-registers from the O-SNPN, performs a new network selection,
and registers the SO-SNPN using the provisioned subscription credentials and
configuration data.
#### 6.5.2.2 Architecture
Figure 6.5.2.2-1: Architecture for UE Onboarding to an SO-SNPN
NOTE: AUSF* inside the O-SNPN is there to achieve isolation from 3rd party
owned DCS, while keeping the same procedures between AMF and AUSF from AMF
perspective (N12).
### 6.5.3 Procedures
#### 6.5.3.1 General
The figure 6.5.3.1-1 below shows a high-level flow of the actions needed for a
successful onboarding of the device into an SO-SNPN.
Figure 6.5.3.1-1: High-level flow for onboarding of the UE into an SO-SNPN
The procedure includes the following steps:
A) UE pre-configuration: The UE is provisioned with default UE credentials
that allows for successful UE authentication (step B1 or D) and a _unique UE
identifier_. If an agreement was in place between the UE and the SNPN, the UE
might have been provisioned with some initial default configuration, including
PLMN ID and NID of the SNPN, S-NSSAI, DNN needed to access the provisioning
server, and a list of ON Group IDs.
NOTE 1: The format of default UE credential need to be defined by SA WG3.
B) Initial access: The NG-RAN includes an identity of its O-SNPN, Support for
Onboarding Indication and optionally a list of ON Group IDs. If the UE
realizes that UE Onboarding is required to access an SNPN, it either manually
or automatically discovers and selects the O-SNPN network according to
broadcasted information and configured information in the UE. If multiple
networks are broadcasting the \"Support for onboarding\" indication, then the
UE will select a network at random. If the UE identifies that it has no
subscription to access the O-SNPN, the UE registers to O-SNPN for onboarding
indicating that the registration is regardless of UE subscription, and during
the registration procedure the UE provides to the network device-specific
information e.g. its default UE credential and corresponding identity (SUPI),
and the User may also provide the UE with additional information, such as an
PS identity and/or SO-SNPN identity. During the registration procedure, the UE
provides an RRC indication that can be used by the NG-RAN to select an AMF for
onboarding and an indication in the Registration Request indicating that the
registration is for restricted onboarding service only. The UE may also
provide additional information for selection of the PS and the SO-SNPN owing
the subscription, such as a list of identities of SNPNs the UE can hear, the
identity of O-SNPN, location of the UE, type of the UE, etc.
Editor\'s note: Whether the ON Group IDs is same as Home SP Group ID is for
FFS.
B1) The O-SNPN may discover and connect the DCS for the UE by checking the
realm part of the unique UE identifier. The O-SNPN authenticates the UE with
the DCS and verify whether the UE is allowed to access the O-SNPN for
onboarding purposes. If the DCS is outside of the O-SNPN, this authentication
is anchored in AUSF* inside the O-SNPN in order to achieve isolation from 3rd
party owned DCS. DCS can fulfil the rest of security functions of ARPF, SDIF,
AUSF and UDM. EAP terminates at the DCS, Kausf & Kseaf needs to be derived
(which is responsibility of AUSF currently) by the DCS and send to the O-SNPN.
If the authentication is successful, the DCS optionally sends the identity of
the selected SO-SNPN and the information (e.g. address of PS, identity of PS,
etc) of the selected Provisioning Server which are selected based on the
information sent by the UE in step B. If the DCS selects multiple SO-SNPNs, it
may send the priority of the SO-SNPNs.
NOTE 2: Whether both options (i.e. primary authentication and NSSAA) are
needed is to be determined by SA WG3.
NOTE 3: If there is an agreement between the DCS and the O-SNPN for providing
UE onboarding, the O-SNPN may decide whether the UE is allowed to access the
O-SNPN for onboarding purposes by checking the realm part of the unique UE
identifier which includes the information of the DCS before sending the UE
authentication request to the DCS.
C) Configuration PDU session: The O-SNPN sends the information from the DCS in
step B1 and also may send a combination of S-NSSAI and DNN for the PDU Session
to the selected PS to the UE. The UE establishes a Configuration PDU session.
This PDU Session may be established either to a well-known or pre-configured
S-NSSAI or DNN, or a combination of S-NSSAI and DNN sent by the UE, which is
used just for provisioning purposes and has limited connectivity capabilities.
Based on this information, the AMF selects a designated SMF which in turn
selects a designated PSA that provides a data connection restricted only to
the Provisioning Server. In the Configuration PDU Session Establishment
Request, the UE includes DCS identity and optionally includes PS identity, SO-
SNPN identity or both. When SO-SNPN identity is provided by the UE, the SMF in
the O-SNPN may decide to override the PS identity provided by the UE and send
the new PS identity to the UE in the PDU Session Establishment Accept as PCO
parameter. The PS identity received in the PDU Session Establishment Accept,
overrides any configured PS identity in the device. The PCF may in addition
provision URSP rules for the UE that restrict communication only to the
provisioning server and/or specific applications.
NOTE 4: It is assumed that one and only one Configuration PDU session can be
established and connectivity of this PDU session is limited (cf. RLOS), so
that the UE can only access a Provisioning Server.
C1) The PDU Session establishment authentication/authorization as described in
TS 23.502 [6] clause 4.3.2.3 is triggered by the SMF during PDU Session
establishment with the DCS based on the DCS identity sent from the UE to the
SMF in step C.
NOTE 5: Whether step B1 is required, in addition to step C1 needs to be
determined by SA WG3.
D1) The UE discovers the Provisioning Server using the stored PS identity.
NOTE 5a: At this point the stored PS identity is one of the following: PS
identity preconfigured in the UE, or PS identity entered manually by the user,
or PS identity received from the O-SNPN.
If the UE at this point still does not have a stored PS identity, then the UE
uses a well-known FQDN to perform PS discovery. The UE provides the
provisioning server with the unique UE identifier, the default UE credentials,
optionally the identity of the selected SO-SNPN, and the priority of the SO-
SNPNs. Onboarding SNPN may also assist UE in discovery of Provisioning Server
address as defined in clause 6.5.3.2. The provisioning server may discover and
connect the DCS using the realm part of the unique UE identity and may
authenticate the UE and make a secure connection for provisioning with the UE,
based on the default UE credentials out of scope of 3GPP.
Editor\'s note: The security aspects are to be specified by SA WG3 or out of
3GPP scope.
D2) The Provisioning Server selects the SO-SNPN owning the subscription and
contacts the future SO-SNPN owning the subscription to provide the
subscription credentials for access to the SNPN owning the subscription, and
may retrieve other UE configuration parameters (e.g. PDU session parameters,
such as S-NSSAI, DNN, URSPs, QoS rules, and other required parameters to
access the SNPN and establish a regular PDU session). The Provisioning Server
selects the SNPN owning the subscription in one of the following ways:
\- If the UE is pre-configured with the identity of the future SNPN, the UE
provides this identity to the Provisioning Server.
\- Otherwise, the Provisioning Server determines the future SNPN by comparing
the UE identity with a configured onboarding list.
\- based on the information from the UE in step D1.
NOTE 6: In scenarios where the UE is not preconfigured with the identity of
the future SNPN (e.g. an off-the-shelf UE) and the Provisioning Server cannot
be configured with information about the specific Subscription Owner SNPN,
onboarding can be performed with the assumption that O-SNPN is the same as the
Subscription Owner SNPN, and the Provisioning Server is owned by the SNPN.
D3) The Provisioning Server provisions the UE\'s subscription credentials for
the SO-SNPN and other configuration information into the UE over the secure
connection.
NOTE 7: The provisioning procedure (step D3) is out of 3GPP scope, where e.g.
provisioning protocols of GSMA RSP may be used with some modification
considering SNPN architecture than PLMN.
E) De-registration: Upon a successful provisioning in the previous step, the
UE releases the Configuration PDU Session and deregisters from the O-SNPN. The
UE will then perform SNPN selection and register to the appropriate SNPN as
per received configuration and general SNPN selection procedures (ref.
solutions to key issue #1).
NOTE 8: The O-SNPN can monitor the time duration of the Configuration PDU
Session or Onboarding Registration in order to prevent misuse. Based on the
local configuration policy in the 5GC, the network can impose maximum time
duration for the Configuration PDU session or Onboarding Registration, upon
expiry of which the session is released or the de-registration is triggered.
The determination of maximum time duration of the Configuration PDU session is
Onboarding Registration is per O-SNPN network configuration.
F) Normal service: Upon a successful de-registration as per step E, the device
initiates a regular procedure, including selection of an SO-SNPN, Registration
using the provisioned credentials with the SO-SNPN owning the subscription,
and PDU Session establishment(s). Depending on the provisioned subscription
credentials the UE may select an SNPN that is the same or different from the
SNPN owning the credentials (depending on the outcome on Key Issue #1).
#### 6.5.3.2 Provisioning Server configuration
To provide Onboarding Services, SNPN is configured with Onboarding
Configuration Data in a manner similar to Emergency Configuration Data
specified for Emergency Services in TS 23.501 [4] clause 5.16.4.
The AMF is configured with Onboarding Configuration Data that are applied to
Onboarding Services that are established by an AMF based on request from the
UE. The AMF Onboarding Configuration Data contains the S-NSSAI and Onboarding
DNN which is used to derive an SMF. In addition, the AMF Onboarding
Configuration Data may contain the statically configured SMF for the
Onboarding DNN. The SMF may also store Onboarding Configuration Data that
contains statically configured UPF information for the Onboarding DNN. The PCF
(and UDR) may store S-NSSAI and Onboarding DNN specific policy information.
Onboarding Configuration Data available to (designated onboarding) PCF and/or
SMF includes Provisioning Server (PS) address(es).
Provisioning Server address may be configured within Onboarding Configuration
Data locally, as part of authentication signalling with AAA/DCS (FFS) or
dynamically by AF via NEF at O-SNPN, for instance using Service specific
parameter provisioning procedure as specified in TS 23.502 [6] clause
4.15.6.7, or by using new onboarding specific API to be defined. Provisioning
Server Address may represent address of Local Provisioning Server (LPS) as
defined in solution #36.
In case a UE with a preconfigured Provisioning Server Address receives a
Provisioning Server Address from the onboarding network, the Provisioning
Server Address received from the onboarding network shall prevail.
In case the provisioning process using a network provided Provisioning Server
Address fails, the UE shall reinitiate the provisioning process using the
preconfigured Provisioning Server Address.
In case this attempt also fails or if the UE does not have a preconfigured
Provisioning Server Address the UE shall detach from the onboarding network
and select another network for onboarding purposes.
It is assumed that FQDN of the Provisioning Server address(es) is configured
to appropriate DNS resolver(s) before Provisioning Server address(es) are
configured to O-SNPN.
Figure 6.5.3.1-1: Provisioning Server address(es) configuration using NEF
1\. Authorized AF invokes NEF at O-SNPN to configure Provisioning Server
address(es) for UE.\ AF provides AF-Service-Identifier.\ As there is no
subscription data for the device within the O-SNPN the UE is identified with
Onboarding Identity or Onboarding Group Identity. The Onboarding Identity may
be IMEI/PEI, or IMEI/PEI in NAI format. NEF maps/associates the API request
with S-NSSAI and provisioning specific DNN and other information it may have
or query from other NFs in O-SNPN.\ Onboarding Service Data includes Service
Descriptor and Service Parameters. Service Parameters include Provisioning
Server address(es), associated validity timer(s), and geographical area
restrictions, data volume restrictions.\ Onboarding Group Identity may be used
to separate the provisioning configuration data from provisioning identity and
membership configuration.
2\. NEF stores the provisioning information (e.g. provisioning server
address(es) etc received via API from AF) in the UDR via UDM. It is ffs
whether the API request is stored as part application data in UDR.
3\. UDR notifies PCFs that have subscribed to changes with data keys mapping
to provisioning specific information. PCF may derive AM and SM specific
onboarding policies based on data received from UDR.
In some cases, Provisioning Server address(es) may be pre-configured in UE as
described in step D1. In these cases, it may that the onboarding network may
not be able to change the pre-configured address at UE. Here it is assumed
that in case the UE has pre-configured Provisioning Server address(es) the
onboarding network is able to configure new Provisioning Server address(es) to
the UE as follows.
Provisioning Server address may be provided to UE by SMF as part of PDU
Session establishment. Upon UE requesting Configuration PDU Session the SMF
requests policy configuration data from PCF. On establishment of SM Policy
Association as specified in TS 23.502 [6] clause 4.16.4 PCF acquires policy
data for onboarding by invoking UDR (API) with S-NSSAI and Onboarding DNN.
Editor\'s note: It is FFS whether PCF can provide device specific SM policy
based on IMEI/PEI (Onboarding Identity).
Provisioning Server address is part of policy data at UDR. PCF provides
Provisioning Server address(es) as part of SM policy data to SMF. Based on
restricted/provisioning indication from AMF SMF sets appropriate user plane
filters (PDR/FAR) with selected/onboarding designated UPF based on SM policy
data received from PCF.
SMF may deliver the Provisioning Server address(es) as part of extended
Protocol Configuration Options (PCO) in PDU Session Establishment Response to
UE. This is similar to use of PCO to configure Autoconfiguration server for UE
in Wireless and Wireline Convergence (TR 23.716 [28] clause 6.10).
Alternatively, Provisioning Server address(es) may be configured to UE during
Registration Procedure using UE Route Selection Policy (URSP) that may be
subject UE capabilities.
Editor\'s note: It is FFS if this is an appropriate use of URSP.
As part of UE initial registration (based on received UE capability
information) AMF indicates to PCF that UE has requested
restricted/provisioning registration. The PCF may initiate UE Policy delivery
using UE Route Selection Policies (URSP), for instance to trigger UE after
successful registration to request establishment of specific type of PDU
Session limited to onboarding purposes only.
In addition, Provisioning Server address(es) may be configured to UE using
service specific policies subject to UE capabilities similar to what is used
for V2X communications as specified in TS 23.287 [29] clause 5.1.1 for ways
how parameters may be made available to the UE and TS 23.287 [29] clause 6.2.5
for AF-based service parameter provisioning and TS 24.587 [30] clause 5.2.4
for configuration parameters such as validity timer, server address and
geographical area.
### 6.5.4 Impacts on services, entities and interfaces
UE:
\- During registration procedure, UE provides information to the SNPN
indicating that the registration is for restricted onboarding service only.
\- During Configuration PDU Session Establishment procedure, UE may provide
information for PS and/or SO-SNPN selection to the network in the PDU Session
Establishment Request and may receive information for PS and/or SO-SNPN
selection from the network in the PDU Session Establishment Accept.
\- the UE might have been provisioned with some initial default configuration,
including PLMN ID and NID of the SNPN, S-NSSAI, DNN needed to access the
provisioning server, and a list of ON Group IDs.
\- If multiple networks are broadcasting the \"Support for onboarding\"
indication, then the UE will select a network at random.
NG-RAN:
\- A new indication in SIB, and a list of ON Group IDs to indicate that the
SNPN provides access to onboarding service.
5GC: (Impacts if any to be completed)
\- During Configuration PDU Session Establishment procedure, 5GC may receive
information for PS and/or SO-SNPN selection from the UE in the PDU Session
Establishment Request and may provide information for PS and/or SO-SNPN
selection to the UE in the PDU Session Establishment Accept.
\- trigger PDU Session release or de-registration when time duration is
expired.
## 6.6 Solution #6: Control Plane-Based UE Onboarding and Provisioning
Solution
### 6.6.1 Introduction {#introduction-7}
This is a solution for Key Issue #4: UE Onboarding and Provisioning Solution.
The solution is based on authenticating the Device Vendor (DV) or the UE
loaded with a UE certificate, authorising the UE to perform the onboarding
procedure, and invoking the UE Parameters Update procedure for the purpose of
remote provisioning the UE with credentials and configuration parameters for
enabling regular access to the NPN.
### 6.6.2 Functional Description
Figure 6.6.2-1 illustrates the architecture of the Control Plane-based
onboarding solution. The solution assumes the presence of a Default Credential
Server (DCS), which is able to authenticate the UE\'s vendor (i.e. the Device
Vendor) and authorize the UE to proceed with the onboarding procedure.
The architecture also assumes the presence of a provisioning server, also
administered by the Subscription Owner (SO) e.g. an SNPN or a delegated
administration entity, which is able to provide the configuration parameters
of the SO to the UE.
Figure 6.6.2-1: Control Plane-Based Onboarding architecture
When CP is used to provision the UE there is a need for a relationship between
the PS and the ON, but the relationship between DCS and PS is dependent on the
used security for the provisioning and is therefore an SA WG3 issue.
NOTE: The reference points between AUSF and DCS, and between ON and the PS is
dependent on SA WG3.
### 6.6.3 Procedures
#### 6.6.3.1 General
Figure 6.6.3-1 provides an overall view of the Control Plane-based solution
for onboarding and configuring UEs.
Figure 6.6.3-1: Overview of the Control Plane-based Onboarding solution
A1: The UE is pre-configured with Default UE credentials (e.g. including a
digital certificate) that identifies the vendor or manufacturer of the UE i.e.
the Device Vendor (DV). This certificate need not be different for every UE,
since it merely identifiers the Device Vendor or manufacturer, but not the UE.
The UE is assumed to be uniquely identifiable with a unique identifier, such
as a host ID or a MAC address. Alternatively, the UE may be provisioned with a
unique UE certificate, but in this case each UE is required to be provisioned
with a different unique certificate. The UE may have been provisioned with the
identity of the ON for selection of ON, but if the UE has not been provisioned
the UE selects an ON that broadcast that Onboarding is allowed.
Editor\'s note: The security assumptions and details must be confirmed by SA
WG3.
A2: The DCS is provisioned with the certificate path of the DV, as well as the
unique UE identifier (e.g. host ID or MAC address) of the UEs that are
authorized to perform the onboarding procedure. If UE-specific Default UE
credentials are used, the DCS is provisioned, instead, with the UE-specific
certificates of the UEs that are authorized to perform the onboarding
procedure. The ON is also provisioned with the SUPIs of the UEs to be used for
the onboarding procedure and is not authorized to establish any PDU Session.
The provisioning server is provisioned with the data that needs to be
configured to every UE.
B: The UE, either manually or automatically (e.g. due to the lack of a valid
UE configuration to access the network) selects an access network and
initiates the onboarding process. During this initial access/registration the
UE initiates a dedicated registration procedure, whereby the UE uses a SUPI
just for the onboarding process. The Subscription Owner authenticates either
the DV of the UE (through a vendor\'s certificate) or the UE (through UE\'s
certificate). Then the network authorizes the UE to continue with the
onboarding process.
Editor\'s note: Whether the UE can also authenticate the Subscription Owner is
FFS for SA WG3.
C: AMF starts the Control Plane UE provisioning procedure. This may require
AMF to trigger the data to be provisioned from a provisioning server by
providing the SUPI used for onboarding to the PS.
D: Once the Control Plane UE provisioning procedure is completed, the UE de-
registers from the network.
E: The UE uses the provisioned data to perform network selection and then a
regular registration procedure using the provisioned data from the
Subscription Owner.
##### 6.6.3.2 Initial Access/Registration
This clause provides details of the initial access of the UE (step B in Figure
6.6.3-1). The procedure is based on the initial registration of the UE
specified in TS 23.502 [6]. Figure 6.6.3.2-1 provides the sequence flow of the
initial access of the onboarding procedure.
Figure 6.6.3.2-1: Initial access sequence flow of Onboarding solution
1\. The UE receives a trigger to initiate the onboarding procedure. This
trigger may be manual, for example provoked by a user pressing a given
combination of keys, or can be automatically provoked, e.g. due to the UE
starting and not being previously provisioned.
2\. The UE selects a network to connect to, for which the NG-RAN broadcast
that onboarding is allowed. This network selection ca be manual, if a user
selects a network from a list of available networks, or automatic, e.g. if the
UE is provisioned with a list of PLMN IDs and NIDs to connect to.
NOTE: how SUCI based on the SUPI is derived can be determined by SA WG3 and CT
WG4 during normative phase.
3\. The UE crafts a special SUPI used for the onboarding procedure. This SUPI
may be derived from any of the Host ID of the UE, its MAC address, or Subject
field in a UE digital certificate. Then the UE sends a Registration Request to
the access network including that the RRC is for onboarding as AN parameter
and Registration Request (Registration type set to \"onboarding\", Onboarding
SUPI, and PEI). The Registration type indicates that the UE wants to perform
and Onboarding procedure.
4\. The (R)AN selects an AMF that supports onboarding.
5\. The AMF receives an N2 message (N2 parameters, Registration Request as for
step 3). When NG-RAN is used, the N2 parameters include the PLMN ID and the
NID, Location information and Cell Identity related to the cell in which the
UE is camping, and an indication that request is for onboarding, UE Context
Request which indicates that a UE context including security information needs
to be setup at the NG-RAN.
6\. The AMF selects an AUSF that supports onboarding and sends an
Authentication request to it.
7,8. The AUSF authenticates the supplied SUPI. This may require additional
interaction between the AUSF and the UE, e.g. to request the UE to supply a
vendor certificate or UE certificate. Depending on the supplied SUPI and the
authentication mechanism, the AUSF may also need to contact a DCS and/or UDM
for authentication and/or authorization purposes. The DCS may provide the
identity of one or more SNPNs, for example, the PS addresses.
Editor\'s note: The exact details of authentication and authorization is FFS
and must be agreed with SA WG3.
9,10. The AMF and the UE initiate a NAS Security Mode Command procedure, as
per TS 33.501 [7].
Editor\'s note: The exact details of NAS Security Mode Command procedure must
be agreed with SA WG3.
11-12. The AMF request from PS, authorization of the UE and the UE
Configuration Subscription Data for the SUPI subject to the onboarding
procedure. The UE Configuration Subscription Data includes an indication on
whether the UE needs to send an ACK and a positive indication that the UE
needs to re-register after updating its configuration data.
Editor\'s note: UE Configuration Subscription Data is a new type of data set
that includes all the configuration data that needs to be provisioned to the
UE. How to enable integrity and confidentiality of the configuration data is
FFS for SA WG3.
13\. The AMF sends to the UE a Registration accept message, including
Registration area, and other relevant information.
##### 6.6.3.3 Control Plane UE Provisioning
This clause provides details of the Control Plane UE provisioning procedure
(step C in Figure 6.6.3-1). The procedure is based on the UE Parameters Update
procedure specified in TS 23.502 [6] clause 4.20.
Figure 6.6.3.3-1: Control Plane UE Provisioning sequence flow of the
Onboarding solution
1\. Once the registration is complete, the AMF sends a DL NAS TRANSPORT
message to the UE. The AMF includes in the DL NAS TRANSPORT message the
Configuration Subscription Data received from the PS.
2\. The UE receives the DL NAS TRANSPORT message and verifies, based on
mechanisms defined in TS 33.501 [7], the Update Data.
\- If the security check on the Update Data is successful, as defined in TS
33.501 [7] the UE stores the information and uses those parameters from that
point onwards; and
\- If the security check on the Update Data fails, the UE discards the
contents of the Update Data.
Editor\'s note: The extend of this verification, considering that the UE is
not yet configured with a Home Public Key, is FFS for SA WG3.
3\. If the UE has verified that the Update Data is provided by Subscription
Owner and the PS has requested the UE to send an ack to the PS, the UE sends
an UL NAS TRANSPORT message to the serving AMF with a transparent container
including the UE acknowledgement.
4\. If the AMF receives an UL NAS TRANSPORT message with a transparent
container carrying a UE acknowledgement from the UE, the AMF sends an Ack
request message including the transparent container to the PS.
### 6.6.4 Impacts on services, entities and interfaces
Editor\'s note: This clause lists impacts to services, entities and
interfaces.
UE:
\- Support being pre-configured with Default UE credentials and optionally
with a list of ON identifiers for ON selection
\- Support Registration procedure for onboarding and provisioning
NG-RAN:
\- Supports broadcast that onboarding is allowed
\- Supports selection of AMF based on AMF support for onboarding and UE
indication that RRC is for onboarding
AMF:
\- Supports configurations to be used for onboarding as described above
\- Supports Registration procedure for onboarding and provisioning from a PS
AUSF:
\- Supports authentication towards DCS
DCS:
\- Supports authentication from ON including an option to provide the SNPN
address as part of the authentication signalling
PS:
\- Supports provisioning
## 6.7 Solution #7: UE Onboarding and Provisioning for a PNI-NPN
### 6.7.1 Introduction {#introduction-8}
This solution addresses key issue 4 \"UE Onboarding and remote Provisioning\".
Especially the solution enables UEs to get network connectivity so that it can
be provisioned with necessary information for access to a PNI-NPN and vertical
networks attached to this PNI-NPN.
Figure 6.7.1-1: UE onboarding in PNI-NPN scenarios
The following assumptions are considered:
\- The UE is provisioned with the **_public_ *subscription****/**
credentials*** of UE side for accessing to PLMN.
\- The UE is provisioned with the **_on-boarding credentials_** for secondary
authentication to grant access to Provisioning Server. The on-boarding
credentials may be provisioned during manufacturing process, or may be input
by the user.
\- The UE is **not** provisioned with **_vertical credentials_** for
secondary/slice authentication to grant access to the vertical network
attached to a PNI-NPN.
\- The UE is **not** provisioned with **_UE configuration_** (e.g. Mobility
Restriction, URSP, etc.) for CAG selection or DNN/NSSAI selection.
\- The PLMN is pre-configured with **_public subscription/credentials_** of
network side which include at least the minimum set of contents which common
public UE owns, e.g. UE identifiers and associated security credential,
optionally support indication and valid period for the on-boarding
registration.
\- The PLMN may be pre-configured with **_static vertical configurations_**
(e.g. SO DNN, SO NSSAI) which can constitute part of subscriptions of UEs
allowed for on-boarding and accessing to the vertical DN via the PNI-NPN.
Vertical enterprises may sign agreement with PLMN for static vertical
subscriptions assignment.
\- The PLMN may be pre-configured with **_Provisioning Server Routing
Information_** (e.g. PS DNN, PS NSSAI, allowed PS and/or PS AAA address list,
port ID, SMF selection subscription data, allowed number of PDU Session for
provisioning per UE and QoS) which is used to trigger the on-boarding
authentication and establish connectivity to the expected Provisioning Server.
In this solution, it is recommended to reuse secondary authentication to
realize the on-boarding authentication.
\- The OIMF (On-boarding Information Mapping Function) is pre-configured with
**_mapping information_** of PNI-NPN ID (e.g. CAG ID) and Provisioning Server
Routing Information. The OIMF can be located implemented in UDM. When the UE
is requesting PNI-NPN\'s Provisioning Server Routing Information, the OIMF
triggers to initiate UPUprocedure to update Provisioning Server Routing
Information to the UE.
Editor\'s note: The definition of CAG ID is changed by this proposal and it is
FFS whether same CAG ID as in Rel-16 can be re-used as such CAG-ID can be used
by multiple NPNs and is related to an area.
\- PS AAA is provisioned with the **_on-boarding credentials_** to
authenticate the UE for on-boarding. The on-boarding credentials may be
provisioned via out-of-band way, e.g. via application.
\- Provisioning Server may be provisioned with the **_dynamic vertical
configurations_** (e.g. updated CAG information, updated QoS) based on UE
granularity, which can constitute part of subscriptions of UEs allowed for on-
boarding and accessing to the vertical DN via the PNI-NPN.
\- Provisioning Server may be provisioned with the **_vertical credentials_**
(e.g. N3GPP credential) for updating NPN credentials of UEs who are allowed
for on-boarding.
NOTE: The exact definition and details of these UE credentials need to be
discussed in SA WG3.
### 6.7.2 Functional Description
#### 6.7.2.1 Introduction {#introduction-9}
The procedure allows the UE, which owns _public subscription/credentials_ and
is not initially provisioned with _vertical credentials_ to obtain vertical
credentials and configuration parameters to access vertical network and its
service.
When the UE is provisioned with _vertical credentials_ and configuration
parameters related to a PNI-NPN, it may re-register to the PNI-NPN according
to the updated CAG information or S-NSSAIs included in UE configuration
parameters. The PS and vertical server can be located in the same DN or
different DN.
#### 6.7.2.2 Architecture
Figure 6.7.2.2-1: Architecture for UE Onboarding to a PNI-NPN
NOTE: The secure storage of the credentials for secondary authentication or
NSSAA needs to be confirmed by SA WG3.
### 6.7.3 Procedures
The figure 6.7.3-1 below shows a high-level flow of the actions needed for a
successful onboarding of the device into a PNI-NPN.
Figure 6.7.3-1: High-level flow of onboarding of the UE into a PNI-NPN
The procedure includes the following steps:
A) Pre-configuration: as depicted in clause 6.7.1.
B) Enquiry On-boarding Information: the UE registers to the PLMN using the
public subscription/credentials and primary authentication is performed in
this step. The UE either manually or automatically discovers and selects the
PNI-NPN ID for UE on-boarding (e.g. CAG ID) based on the broadcast
information. Then the UE requests the OIMF for the Provisioning Server Routing
Information (e.g. PS DNN, PS NSSAI, allowed PS and/or PS AAA address list,
port ID) using PNI-NPN ID via NAS message, the OIMF may trigger the UDM to
perform UPU procedure to update the information.
If support indication for the on-boarding registration is included in the
public subscription, the PLMN shall provide the UE with the restricted
registration and PDU Session for limited services based on the valid period in
the public subscription, and extra restriction information involved in
Provisioning Server Routing Information (e.g. SMF selection subscription data,
and allowed number of PDU Session for provisioning per UE, allowed PS address
list and QoS).
Editor\'s note: For the non-CAG-based PNI-NPN, whether new identifiers other
than CAG ID should be defined for requesting Provisioning Server Routing
Information is FFS.
C) **On-boarding authentication and** **PLMN subscription update** : The UE
selects the slice or DNN to access PS according to _Provisioning Server
Routing Information._ The UE may re-register to the PLMN using selected slice.
The UE performs on-boarding authentication via 5GC with PS AAA using the _on-
boarding credentials_ , potentially reusing the secondary authentication
procedure, which triggered by SMF, to realize the on-boarding authentication.
When the UE has been successfully authenticated, the PLMN subscription should
be updated, including static vertical subscriptions and dynamic vertical
credentials.
(C1) Update static vertical subscriptions: the static vertical subscription
(e.g. SO DNN, SO NSSAI) is preconfigured in PLMN based on the agreement
between PLMN and vertical. By using the on-boarding authentication, the 5GC
can be aware of authentication result. If the authentication is successful,
the 5GC authorizes the UE, and updates UE\'s subscriptions according to pre-
configured _static vertical subscriptions_.
(C2) Update dynamic vertical subscriptions: the dynamic vertical subscription
(e.g. updated CAG information, updated QoS) is the information that Vertical
intends to revised to UE\'s subscription. Obviously, PLMN may reject the
update of dynamic vertical subscriptions. If the provisioning is successful,
the Provisioning Server may transfer the UE\'s dynamic vertical subscriptions
(e.g. updated CAG information, updated QoS) to the PLMN via NEF, and the PLMN
may update UE\'s subscriptions for dynamic vertical subscriptions.
D) **Provisioning** : the Provisioning Server provisions the _UE configuration
parameters_ to the PLMN and _vertical credentials_ to UE.
(D1) UE Configuration Update: When UE configurations are updated, the PLMN may
update _UE configurations_ to the UE by triggering the UE Configuration Update
procedure.
(D2) Vertical credentials provisioning: After successful on-boarding
authentication, the UE is authorized to establish the PDU session to access
the Provisioning Server and the Provisioning Server provisions the _vertical
credentials_ to UE by the established user plane path. The UE may reuse
existing N3GPP credential management protocol with the PS. For example, to
reuse CMPv2 protocol to ask CA for signing a vertical\'s certificate. The
credential can be stored in either ME or UICC but is expected to be stored in
UICC in this solution.
E) **Access to vertical network:** The UE accesses the NPN using UE
configuration parameters and vertical credentials.
E1) Re-registration using updated UE configuration: after the provisioning
procedure, the UE may perform Re-registration procedures using _UE
configuration_ to reselect CAG ID, slice and DNN, establish specific PDU
session with suitable QoS.
E2) Secondary/Slice authentication using vertical credentials: When the UE
requests to access the vertical server, the PLMN may trigger secondary/slice
authentication, the UE uses _vertical credentials_ to process the
authentication.
E3) Normal service: Upon a successful step E2, the UE can initiate regular
services to the vertical network via the PNI-NPN.
During the procedure, if the secondary authentication at Step C failed or the
Step D2 is not finished but the valid period described at Step B) expires, the
PLMN can trigger the network-initiated de-registration.
### 6.7.4 Impacts on services, entities and interfaces
UE impact:
The UE is provisioned with the **_public subscription/credentials_** of UE
side for accessing to PLMN. This is existing functionality.
The UE is provisioned with the on-boarding credentials for secondary
authentication to grant access to Provisioning Server.
The UE discover and select the PNI-NPN ID for UE on-boarding (e.g. CAG ID)
based on the existing broadcast information.
The UE requests the OIMF for the Provisioning Server Routing Information (e.g.
PS DNN, PS NSSAI, allowed PS and/or PS AAA address list, port ID)
Receive the Credential from Provisioning server.
UDM impact:
The UDM is pre-configured with public subscription/credentials
In case OIMF is implement in UDM, the UDM is pre-configured with the
Provisioning Server Routing Information.
Update the subscription if on-boarding procedure is successfully performed and
update it to UE via existing UPU procedure.
RAN impact:
Broadcast existing support indication (e.g. CAG ID).
SMF impact:
Manage the Restricted PDU Session for limited services together with UPF.
Trigger the Secondary authorization/authentication which can acts as on-
boarding authentication.
Provisioning server impact:
Provide the Credential to UE over user plane.
## 6.8 Solution #8: SNPN access using 3rd party credentials via external
Credential Provider
### 6.8.1 Introduction {#introduction-10}
This solution addresses key issue 1 \"Enhancements to Support SNPN along with
credentials owned by an entity separate from the SNPN\".
The solution enables UEs to access an SNPN which makes use of a credential
management system managed by a credential provider external to the SNPN 5GS.
### 6.8.2 Functional Description
#### 6.8.2.1 Definitions {#definitions-3}
The following definitions apply to this solution:
**SNPN:** An SNPN which enables access for UEs using credentials owned by an
entity separate from the SNPN.
**Credentials Provider (CdP):** An entity, separate from the SNPN that
supports that its credentials are used to access an SNPN.
**CdP-ID:** Identifies the CdP that issued the credentials that a UE is using
to access an SNPN.
NOTE: Appropriate terminology regarding Credential Provider can be decided in
normative phase.
#### 6.8.2.2 Architecture
Figure 6.8.2.2-1 depicts the architecture for the solution, i.e. the SNPN
includes a complete 5GS SNPN network and the CdP provides credential
management type of functionality.
Figure 6.8.2.2-1: Access to SNPN services using credentials from Credential
Provider (CdP) for authentication in the SNPN
Editor\'s note: Impacts to security architecture and key derivation resulting
from the above architecture need to be evaluated by SA WG3.
#### 6.8.2.3 High level principles of the solution
This solution enables UEs to access an SNPN which makes use of a credential
management system managed by a credential provider external to the SNPN. The
credential management functionality provided by the CdP includes handling of
identifiers and corresponding security material used to identify the devices
used within the SNPN and to mutually authenticate these devices and the SNPN
5GS. The credential provider will typically correspond with an already
existing credential management system owned by the vertical owner of the SNPN
5GS.
The UE is provisioned with non-AKA credentials managed by the CdP, which
include an identifier and related security information and the CdP Identifier.
The UE initiates registration in the SNPN using a SUPI containing a network-
specific identifier, provided by the CdP and provisioned in the UE.
The AMF initiates primary authentication, registration and subscription
management procedures for the UE towards the AUSF and UDM of the SNPN based on
existing procedures defined in TS 33.501 [7]. It is assumed that there are
AUSF and UDM instances within the SNPN supporting the SUPIs of the CdPs (e.g.
SUPI ranges or CdP ID) the SNPN has agreements with. Alternatively, the SNPN
may use the SUPIs separate from the identities used in the CdPs.
For the primary authentication procedure, the UDM allows the UE to run primary
authentication with non-AKA credentials owned by a certain CdP. The UDM
indicates to the AUSF to proceed with primary authentication involving the
corresponding CdP.
One possibility is for the SNPN to delegate the authentication server role to
the CdP (i.e. the CdP supports AAA functionality). In this case, the AUSF acts
as EAP authenticator and interacts with the CdP to execute the primary
authentication procedure using the CdP credentials. The AUSF uses a AAA-P/IWF
to interact with the CdP. The AAA-P/IWF undertakes any AAA protocol
interworking between SBI services used by the AUSF and the AAA protocol
supported by the CdP. This allows the AUSF to remain a full SBA entity within
the 5GC architecture.
For the registration and subscription management procedures, it is assumed
that the SNPN has provisioned in the UDM/UDR individual subscriptions for the
UEs that use non-AKA credentials from the CdP. Alternatively, the SNPN may use
common subscription profiles per CdP for these UEs.
\- In the case of SNPN UDM/UDR provides the individual subscription data, the
AMF/SMF can retrieve the data using a SUPI. It is assumed that the SUPI may be
generated based on CdP-UE ID and provisioned at the UDM/UDR as part of the
individual subscription data or the SUPI may not relate with the CdP-UE ID and
is provisioned at the UDM/UDR and UE.
\- In the case of SNPN UDM/UDR provides the common subscription data, the
AMF/SMF can retrieve the data using a SUPI. It is assumed that the SUPI may be
generated based on CdP-UE ID, which can be derived from UE\'s SUPI/SUCI. The
SNPN UDM/UDR provides a pointer to the common subscription data.
\- In the case of SNPN UDM/UDR doesn\'t provide the common subscription data
nor individual subscription data and this scenario need to be supported
solution #4 can be used.
### 6.8.3 Procedures
This clause shows the interactions to enable UEs to access an SNPN which makes
use of a credential management system managed by a Credential Provider
external to the SNPN proposed in this solution.
Figure 6.8.3-1: UE registration in SNPN using CdP as authentication server and
CdP-UE ID for SUPI derivation
0\. The UE is configured with non-AKA credentials from the CdP e.g. SUPI
containing a network-specific identifier, CdP ID and security information, and
optionally a list of SNPNs that the CdP has an agreement/SLA with.
It is also assumed that there are AUSF and UDM instances within the SNPN that
support the SUPIs of the CdPs (e.g. SUPI ranges or CdP ID) the SNPN has
agreements with. The AMF selects these AUSF/UDM instances based on information
locally configured in the AMF or provided by the SNPN NRF.
1\. The UE selects the SNPN and initiates UE registration in the SNPN. The UE
creates a SUCI/SUPI based on the CdP-UE ID provided by the CdP and provisioned
in the UE.
NOTE 1: It is assumed that the SUPI is on NAI format and includes also the CdP
ID in the domain part of the NAI, e.g. UEID\@CdPID. Whether the SUPI within
the SUCI is encrypted is FFS in SA WG3.
2\. The AMF within the SNPN initiates primary authentication for the UE using
a Nausf_UEAuthentication_Authenticate service operation with the AUSF as
currently specified in TS 33.501 [7]. The AMF selects an AUSF based on the
SUCI presented by the UE as specified in TS 23.501 [4].
3\. The AUSF checks with UDM within the SNPN for the authentication method to
be executed for the UE using a Nudm_UEAuthentication_Get service operation as
currently specified in TS 33.501 [7]. The AUSF selects a UDM also using the
SUCI provided by the AMF as specified in TS 23.501 [4]. The UDM resolves the
SUCI to the SUPI before checking the authentication method applicable for the
UE. The UDM can obtain the common subscription data or individual subscription
data based on the SUPI.
4\. The UDM provides the AUSF with the UE SUPI and the applicable
authentication method for the UE. In this case, the UDM indicates to the AUSF
to run primary authentication with non-AKA credentials owned by a certain CdP.
The UDM provides the AUSF also with the address of the CdP if required.
NOTE 2: The SNPN may support credentials managed by different CdPs.
5\. Based on the indication from the UDM, the AUSF interacts with the CdP to
execute the primary authentication procedure. The AUSF derives the CdP-UE ID
from the SUPI. The AUSF uses a AAA-P/IWF to interact with the CdP. The
AAA-P/IWF undertakes any AAA protocol interworking between SBI services used
by the AUSF and the AAA protocol supported by the CdP.
NOTE 3: In this case, the AUSF is not exposing primary authentication services
externally to the SNPN 5GS but rather the AUSF is consuming primary
authentication service from an authentication server external to the SNPN
based on SNPN configuration.
6\. The UE executes the applicable authentication method with the CdP.
7\. After successful authentication, the AMF is provided with the successful
indication together with the SUPI of the UE and the resulting security key.
NOTE 4: Details of the authentication procedure are for FFS in SA WG3. This
includes potential impacts on key hierarchy and how UE is aware of key
hierarchy to be used.
8\. After successful authentication, the AMF continues with the registration
procedure for the UE in the SNPN. The AMF selects a UDM based on the UE\'s
SUPI to perform AMF registration and subscription management procedures with
UDM. The SNPN may have provisioned individual subscriptions for the UEs that
use non-AKA credentials from the CdP in the UDM/UDR. Alternatively, the SNPN
may use common subscription profiles for these UEs.
NOTE 5: The details of how subscriptions for UEs that use credentials from the
CdP are provisioned/managed within the UDM/UDR are Out of Scope of this
solution.
9\. The AMF completes the registration procedure in the SNPN. The security
keys result from the primary authentication procedure using CdP non-AKA
credentials are used for subsequent security procedures within the SNPN (i.e.
Security Mode Command).
Figure 6.8.3-2: UE registration in SNPN using CdP as authentication server and
an SUPI not related with CdP
In this procedure, the UE and SNPN/UDM is configured with the SUPI, which has
no relation with the CdP-UE ID. Compared to procedure in figure 6.8.3-1, the
following differences are captured:
0\. UE is configured with a SUPI that has no relation with CdP-UE ID. The
UDM/UDR is also provisioned with this SUPI.
1\. The SUPI/SUCI used in this step is the SUPI configured at step 0.
5\. Based on the indication from the UDM, the SNPN AUSF asks the UE to provide
the CdP-UE ID via AMF before initiating the primary authentication and
authorization towards CnP. An alternative is that the authenticator uses EAP
identity request towards UE to provide EAP identity which is equal to CdP-UE
ID.
### 6.8.4 Impacts on services, entities and interfaces
UE impacts:
\- Possible impact on key hierarchy (to be confirmed by SA WG3).
AMF impacts:
\- Possible impact to provide the CdP-UE ID as requested by AUSF.AUSF impacts:
\- Delegation of authentication server role to the CdP; possible impacts on
key hierarchy need to be analysed by SA WG3.
UDM impacts:
\- Possible impact on SUCI to SUPI de-concealment (to be confirmed by SA WG3).
\- Indication of authentication method using non-AKA credentials from
applicable CdP to the UE.
AAA-IWF/P impacts:
\- New NF supporting protocol interworking with CdP acting as e.g. external
EAP server.
## 6.9 Solution #9: Solution #1 plus support for UEs that do not have
sufficient information for SNPN selection
### 6.9.1 Introduction {#introduction-11}
The solution addresses Key Issue #1 (Enhancements to Support SNPN along with
credentials owned by an entity separate from the SNPN) and builds on top of
Solution #1.
The solution aims at addressing the case of UEs that do not have sufficient
information for SNPN selection, which is not covered by Solution #1. A UE does
not have sufficient configuration for SNPN selection if the UE does not have
an entry in the UE configured lists \"Service Provider Controlled Network
Selector\" list or in \"User Controlled Network Selector\" matching any of the
SNPNs in the area.
It is possible to classify the SNPN network selection modes as closed,
restricted or open:
\- Closed: The UE might select a network only, if the selected cell broadcasts
the SNPN ID of the SUPI used by the UE to register.
\- Restricted: In addition to networks available in \"Closed\" mode, the UE
may select a network, if the cells SNPN Id is in the UE\'s \"Service Provider
Controlled Network Selector\" list.
\- Open: In addition to the networks available as part of \"restricted mode\",
the UE may also select any SNPN even if it is not present in the \"Service
Provider Controlled Network Selector\" list. This mode allows selection
without further precondition using opportunistic try and error strategy.
The first SIB indication \"access using Home SP credentials is supported\"
indicate if SNPN is closed or not. The second SIB bit indication
\"restricted\" indicates if SNPN is \"restricted\" or \"open\".
### 6.9.2 Functional Description
The solution is based on Solution #1 with the addition of the following
principles:
\- The Serving SNPN advertises a first SIB indication with the meaning that
\"access using Home SP credentials is supported\" as in Solution #1.
\- If the first SIB indication indicates that the SNPN supports access using
Home SP credentials, then a second SIB indication is used to indicate whether
the Serving SNPN is open or restricted.
### 6.9.3 Procedures
The procedures are based on Solution #1 with the addition of the following:
\- If the first SIB indication indicates that access using Home SP is not
supported, the UE adopts Rel-16 behaviour i.e. the UE attempts to register
with the SNPN only if the advertised SNPN identifier matches UE\'s
subscription.
\- If the first SIB indication indicates that access using Home SP is
supported, the UE goes through the preconfigured list looking for match, as
described in Solution #1.
\- If the UE has exhausted all the entries in the pre-configured lists without
finding a match, the UE considers the \"restricted\" SIB indication for each
SNPN in the area:
\- If the second SIB indication is set to \"restricted\", the automatic
network selection will not select that SNPN.
\- If the second SIB indication is set to \"open\", the UE may attempt to
register with the SNPN. Before attempting the registration the user may be
presented with a list of available serving SNPN IDs to choose from.
### 6.9.4 Impacts on services, entities and interfaces
UE:
\- Same as Solution #1 with the addition of handling of the new SIB indication
whether the network supports UEs that do not have sufficient information for
SNPN selection.
NG-RAN:
\- New \"restricted\" SIB indication.
## 6.10 Solution #10: UE external subscription data stored in the SNPN
### 6.10.1 Introduction {#introduction-12}
This solution is for Key Issue #1, \"Enhancements to Support SNPN along with
credentials owned by an entity separate from the SNPN\". In particular, this
solution targets the scenario when the Subscription Owner (SO) domain
implements AAA infrastructure to store the UE identities and credentials (and
potentially the service subscription data).
The solution is based on the following principles:
\- The UE identities and credentials (e.g. UE-ID, UE Keys) are stored in the
SO domain (e.g. AAA server). During the Registration procedure, the primary
network authentication and authorisation is performed by the SO domain via
eAUSF in the SNPN.
\- The subscription data for the UE is stored in the SNPN\'s UDM/UDR, and it
may be either a) pre-provisioned via SLA between SNPN and SO, or b)
provisioned on-demand during the UE initial registration with the SNPN.
\- The UDM/UDR in the SNPN may identify the UE subscription data in different
ways:
a) a UE subscription identifier having the form of SUPI (called SI-SUPI) is
local for the SNPN and is used to identify the provisioned Subscription Data.
The SI-SUPI is used in the Serving SNPN to identify the Subscription Data
(without security credentials). The SI-SUPI is sent to AMF and used internally
in the SNPN during the UE is served by the SNPN;
b) the (external) UE-ID is used to identify the provisioned subscription data.
NOTE: In the case b), the SNPN\'s UDM/UDR stores UE Subscription Data which is
identified by UE-ID having the domain name of the external SO. The SNPN 5GC
has to be configured to select the correct UDM, e.g. the NRF is configured how
to select the UDM/UDR which stores the Subscription Data identified by the
external UE-ID.
\- If SI-SUPI is used to identify the Subscription Data, the AMF uses both UE
identities: UE-ID (from the Registration Request message) and the SI-SUPI as
follows:
\- The UE-ID is used for security procedures (e.g. key derivation in the AMF,
signaling exchange with the AUSF).
\- The SI-SUPI is used for subscription data retrieval from the UDM/UDR.
\- The AMF uses the SI-SUPI to the other NFs (SMFs, PCF, etc.) during various
procedures.
\- If the (external) UE-ID is used to identify the Subscription Data, the SNPN
5GC (including the AMF, SMF, PCF) use the UE-ID to select the UDM/UDR and as
identifier for the UE context in the different NFs.
Figure 6.10.1-1 shows the architecture assumed for this solution. The AAA
server stores the UE security data (for authentication and authorisation) and
also the UE service subscription which is valid for the UE (e.g. type of
service, allowed bitrate, spending allowance, mobility restrictions, etc.).
The red path shows the signalling flow exchange for the primary network access
authentication and authorization. The eAUSF (enhanced Authentication Server
Function) can be a known AUSF function, but can be also considered as enhanced
AUSF implementing additional functionality (e.g. AAA proxy functionality, AAA
message translation to SBI, etc.). The blue path shows the signaling flow
exchange for the UE subscription data provisioning in the SNPN\'s UDM/UDR. The
signaling flow between UDM and AAA server can be sent directly or traversing
through the eAUSF.
Figure 6.10.1-1: Architecture for storing the UE subscription data in the SNPN
while the security signalling is performed to the SO
### 6.10.2 Functional Description
The solution uses the principles from clause 6.10.1.
In a nutshell, the solution proposes that the UE Subscription Data (except the
UE credentials) is stored in the Serving SNPN in order to allow consistency of
the Subscription Data content in the SNPN, i.e. the AMF and SMF need to
understand the S-NSSAIs or DNNs to be used in the SNPN. It also allows the
SNPN to configure further subscription parameters, e.g. AMBR, access and
mobility restrictions, according to the SLA with the UE\'s SO.
### 6.10.3 Procedures
Two different procedures are shown below.
#### 6.10.3.1 UE subscription data pre-stored in the SNPN
Figure 6.10.3.1-1: Registration and PDU Session establishment procedures when
the UE subscription data is pre-stored in the SNPN
0a. The UE has a subscription with service provider (SP). The subscription is
identified by an UE-ID.
0b. The SNPN can store one or more subscription data sets for different groups
of UEs, which are SP subscribers. The subscription data set is generated and
stored based on the SLA with the SP. Each subscription data/profile/set is
associated with a unique subscription identifier (SI). The SI-SUPI can be
generated internally by the SNPN.
0c. The SP is provided with the SI-SUPI during the SLA. The SP is may
associate a specific UE subscription with the SI-SUPI received from the SNPN.
The SP may have contract with multiple SNPNs and the SP may maintain multiple
SI-SUPIs from different SNPNs.
1\. The UE selects the SNPN as suitable serving network and sends Registration
Request message. The UE includes its UE identifier (UE-ID). For example, the
UE-ID can be in form of NAI, where the \"realm\"-part of the NAI identifies
the UE\'s subscription owner (SO).
2a. The AMF triggers the primary network authentication procedure for network
access. The AMF may select a specific AUSF (e.g. eAUSF) in the own network
based on the SO identifier (e.g. \"realm\" part of the UE-ID).
2b. The UE is authenticated by the AAA server. Any EAP authentication method
may be used.
2c. The AAA server sends the authentication result (Success or Failure) to the
AMF. In case the authentication is successful, the message may also contain
Key material (e.g. Kseaf for deriving further keys for NAS or AS) and SI-SUPI
(used to identify the UE subscription data in the SNPN).
NOTE: In case that the UE Subscription Data is identified in the SNPN\'s UDM
by the (external) UE-ID, the SI-SUPI is not used. This is valid for the
following steps.
3\. The AMF performs NAS security mode command (SMC) with the UE to setup the
NAS security with the UE. The AMF uses the Key material received in step 2c to
derive the further security keys.
4a. The AMF uses 2 identifiers for the UE the UE-ID and the SI-SUPI. The SI-
SUPI is used for internal network operations to retrieve subscription data
from UDM/UDR (e.g. AM/SM subscription retrieval from UDM). The UE-ID is used
for security procedures, e.g. deriving of (NAS or AS) security keys for the
UE, communication towards the eAUSF during (re-)authentication/authorization
procedure.
4b. The AMF may register with the UDM using Nudm_UECM_Registration for the
access to be registered using the UE-ID. The AMF retrieves the UE subscription
data from the UDM, by using the SI-SUPI as a subscription identifier for this
UE towards the UDM, whereas the UE-ID used to identify the UE in the UDM for
the UE-context (not to identify the UE subscription data).
5\. The AMF completes the registration procedure as per specification TS
23.502 [6]. The AMF may provide Configured NSSAI to the UE in order to allow
the correct use of the S-NSSAIs available in the SNPN. The 5GC may provide
URSP rules to the UE (depending on the SLA with the SO).
6a. The UE may request PDU Session establishment.
6b. The AMF selects an appropriate SMF. In the N11 message to the SMF, the AMF
includes an additional information of the SI-SUPI.
7\. The SMF uses the SI-SUPI to retrieve the UE\'s Session Management (SM)
subscription data from the UDM. The UE-ID is used in the SMF to uniquely
identify the UE context.
8\. The SMF completes the PDU Session establishment procedure with the UE.
The benefit of this solution is that the UE-specific signalling exchange
between the SNPN and the SP is reduced to the UE (primary) authentication and
authorization procedure. Once the primary authentication is successfully
completed, the SNPN can serve the UE without further interaction with the SP.
#### 6.10.3.2 UE subscription data sent on-demand to the SNPN
Figure 6.10.3.2-1: Registration procedures when the UE subscription data is
sent on-demand to the SNPN
0a. The UE has a subscription with service provider (SP). The subscription is
identified by an UE-ID.
0b. - 0c. The SNPN and SO has an SLA in place and may have agreed how to
handle SO UEs in the SNPN.
1\. -- 2b. Same as steps 1 -- 2b in Figure 6.10.3.1-1.
2c. The AAA server sends the authentication result (Success or Failure) to the
AMF. In case the authentication is successful, the message may also contain
Key material (e.g. Kseaf for deriving further keys for NAS or AS) and
Subscription Retrieval Parameters. The Subscription Retrieval Parameters may
include an Access Token (e.g. for authorization at the AAA server),
Subscription-Data-URI (for uniquely find the UE\'s subscription data in the SO
domain).
3\. Same as step 3 in Figure 6.10.3.1-1.
4\. The AMF initiates UE subscription data retrieval with the UDM. The AMF
sends Nudm_SDM_Get Request which may contain the UE-ID and the Subscription
Retrieval Parameters.
5\. The UDM initiates a procedure to retrieve the UE service subscription data
with the AAA server. For example, the UDM may use the HTTP GET (Subscription-
Data-URI, Authorization: Access Token).
6\. The AAA server replies, e.g. sending \"200 OK\" message and including the
UE Service Subscription, validity time.
6b. The AAA server keeps track that the UE service subscription data has been
sent to the SNPN and may start a validity timer. The UDM may start a validity
timer with a value \'Cache time\' as received from the AAA server.
7\. The UDM/UDR creates subscription data based on received Service
Subscription for the UE. The UDM/UDR generates a subscription identifier for
this UE (e.g. SI-SUPI).
8a. The UDM responds to step 4 sending the UE subscription data to the AMF.
The UDM also sends the subscription identifier for the subscription data.
8b. The AMF stores the received UE subscription data. The AMF uses both UE-ID
and SI-SUPI. The use of both parameters is as described in step 4a in Figure
6.10.3.1-1.
9\. The AMF completes the registration procedure as per specification TS
23.502 [6]. The AMF may provide Configured NSSAI to the UE in order to allow
the correct use of the S-NSSAIs available in the SNPN. The 5GC may provide
URSP rules to the UE (e.g. depending on the SLA with the SO if the UE has not
been configured with URSP by the SO) to allow the UE to map its applications
to the S-NSSAIs used in the SNPN.
10\. - 11. The UDM and AAA server can perform one of the following procedures:
renewal, update or removal of the UE subscription data. The procedures can be
triggered either in the UDM towards AAA server, or in the AAA server towards
the UDM, e.g. upon expiration of the validity timer in step 10a or 10b.
The benefit of the UE subscription data sent on-demand to the SNPN is that the
UE Service Subscription data can be updated dynamically.
### 6.10.4 Impacts on services, entities and interfaces
\- Impacts to UDM/UDR in the SNPN:
\- The subscription data for the UE is stored in the SNPN\'s UDM/UDR in one of
the variants: a) pre-provisioned, or b) provisioned on-demand during the
initial Registration procedure;
\- If provisioning on demand is used, the UDM retrieves the UE service
subscription data with the AAA server (e.g. using the HTTP GET including
Authorization info (Access Token));
\- Support the retrieval of UE subscription data with a SI-SUPI, which can be
generated by UDM/UDR or be provided by the AAA server.
\- Impacts to AMF:
\- initiates the UE primary authentication with AUSF in the SNPN, although the
UE-ID is from external Subscription Owner domain.
\- AMF may use both UE identities: (external) UE-ID (from the Registration
Request message for the security procedures) and the UE Subscription
Identifier (SI-SUPI) to identify the UE Subscription Data in the UDM/UDR.
\- Impacts to SMF:
\- Uses the SI-SUPI as UE identifier to retrieve the UE Subscription Data from
UDM.
## 6.11 Solution #11: Steering of UEs towards selected Serving SNPN for key
issue #1
### 6.11.1 Introduction {#introduction-13}
This solution is based on solution #1 and #2 with adding \"Steering of
Roaming\" alike solution to allow service provider to be able to proactively
steer the UE toward the preferred network. Current solution #1 and #2 are
based on the preferred network list provided by the service provider, and are
not be able to fully address the following scenarios:
\- The solution #1 and #2 rely on the preconfigured network selector list (\"
operator controlled Network selector\" list (for solution 1) or \"Home SP
subscription information\" (for solution 2)), which lists the preferred
service SNPN networks or roaming groups list, to select the service SNPN
network mainly during network selection phase. There are scenarios which the
preconfigured network selector list is outdated or not sufficient lead UE to
select and camp on a SNPN that is not the best desirable to the SP. Under
those scenarios, the updated preferred network list will not steer UE to
another more preferred network until UE conducts another network selection,
which may be too late to the service provider. SP should be able to have way
to trigger UE moving to another more suitable network as early as possible,
without waiting for UE to start another network selection only when UE is
losing the network coverage of the service network.
\- Due to the nature of SNPN deployment, the SP who owns UE subscription may
have SLAs with different SNPNs in a same location for different services. The
SP may be basing on its business or applications needs to trigger UE to
different SNPN networks than the network which UE is currently connecting to.
E.g. if the hotspot SNPN is overload or others issue to restrict the new
incoming UEs to access this SNPN, the SP may direct some low priority UEs of
its own in that SNPN to another SNPN which has the coverage of the same area
and has the SLA with. For this onetime case, the SP may not update UE\'s the
prefer list but instead provide a target network for UE to steer to directly.
Therefore, as supplement with the existing solution 1 and 2, this solution to
propose to add network steering indication with the preferred network to the
UE, in order to trigger UE to move to that indicated network as early as
possible. This indication solution is using the same mechanism as the existing
\"Steering of Roaming\" defined in TS 23.122 [5]. This indication can be
provided to the UE either along with the \"operator controlled network
selector\" (for solution 1) or \"Home SP subscription information\" (solution
2), or being delivered separately.
NOTE: The solutions, like #1 and #2 that is re-using existing primary
authentication procedure can also re-use the integrity protection of SoR
procedure. But how the steering indication information can be delivered with
integrity protection for the SNPN when non-3GPP credential being used for
primary authentication needs to be determined by SA WG3.
The steering indication can be sent to UE when UE is connecting a network
during network registration phase or has connected to a network, because
either the UE had connected to the current network with the outdated priority
list or the home service provider wants to steer UE to another more preferred
network as early possible in that location for some business or operation
reasons, such as QoS, network load balancing, etc. Because UE has the best
knowledge of its own connectivity performance as well as the connection
condition with the current network as well as the potential new networks, the
indication will not force UE to move to the new network immediately, instead
UE will take into the account of this indication information and make final
decision if it wants to move the new network. After UE decides to move, it
will move to the network in its earliest suitable time or within a time window
provided by the service provider.
Editor\'s note: The benefit of an explicit \"switch\" indication, and any
interactions with existing principles, compared to sending an updated list of
preferred networks that already are listed in priority order (as proposed in
solution 1 and solution 2) is FFS.
Editor\'s note: Regarding service continuity: As non-3GPP credentials are
limited to isolated networks per service requirement this clause needs to be
updated accordingly.
### 6.11.2 Functional Description
This solution is using the similar concept and mechanism of \"steering of
roaming\" defined in TS 23.122 [5], to supplemented to both the solution 1 and
2 with the following changes:
1\. After UE connects to a serving network, the service provider of UE who
owns UE\'s the subscription may provide UE a network steering indication to
steer UE to move to another network provider. After receives this steering
indication, UE can either use the stored the preferred network list which it
receives from home as illustrated in solution #1 and #2, to start selecting
and moving to the most preferred and available network; or move to the target
network which is being listed in the indicator if it contains. For the latter
case, the prioritized preferred target network(s) listed in the steering
indication will not be used to update the Operator controlled network
selector\" list or \"SP controlled network selector\" list as described in
solution #1 and #2, but it\'s only for this single steering operation. This
network switch indication is similar to the SoR (Steering of Roaming) as
defined in TS 23.122 [5]. This indication can be part of the updated
\"operator controlled Network selector\" list (for solution 1) or \"Home SP
subscription information\" (for solution 2) being sent to UE using the UE
Configuration Update procedure as defined in TS 23.502 [6] clause 4.2.4.2 or
UE parameters update procedure as defined TS 23.502 [6] clause 4.20.
Alternatively, SNPN identity can be integrated into a UE policy. UE can obtain
the update of the UE policy containing SNPN identity using the UE
Configuration Update procedure as defined in TS 23.502 [6] clause 4.2.4.3 or
UE Parameter Update procedure as defined in TS 23.502 [6] clause 4.20. The
obtained SNPN identity information derived from the UE policy can also be used
to update the \"Operator controlled network selector\" list or \"SP controlled
network selector\" list.
NOTE 1: The SNPN identity can be included as part of URSP or a new UE Policy.
The new UE policy can be a new UE route selection rule containing the traffic
descriptor (e.g. Application descriptor or IP address or DNN) and SNPN
identity.
NOTE 2: Stage 3 work will determine whether to use UPU or SoR or other OTA
methods to deliver the steering information.
2\. After receiving the indication from service provider, UE can start to
select the new target V-SNPN given by the network steering indicator if there
is one, or use the updated \" operator controlled Network Selector\"
list(solution 1) or \" Home SP subscription information) to select the new
most preferred network V-SNPN, then attempt to transfer PDU sessions to the
target V-SNPN using the PDU Session Establishment procedure with Existing PDU
Session indication as defined in TS 23.502 [6] clause 4.3.2.2.2. Because UE
has the best knowledge of its performance and condition with various networks,
the final moving to another network decision should be done by UE.
Before the service provider to send the steering inform to UE, in order for
the service provider to precisely steer the UE to the suitable network based
on UE\'s present location, also avoid steering UE to a network which UE can\'t
receive service in that location then lead to service disruption, the service
provider may want to have the latest network performance information of the
potential candidate network in that area as one of the inputs for the steering
decision. Knowing the potential target network for UE to steer to is not the
reason for steering, instead an optional verification step for the service
provider to check if the target network(s) are suitable to be sent to UE for
steering.
Editor\'s Note: The need for additional verification is FFS.
With the collected measurement information, the service provider can send the
right target network to UE to steer to. There are 2 options for the service
provider to get the candidate network measurement in order to identify the
suitable network to steer the UE to:
\- Option 1: By using existing LCS service procedure, the service provider can
obtain UE\'s location using the connectivity of the visiting network that UE
is connecting to. Then the service provider can use the location information
provided by the UE to query the network performance information of the
candidate V-SNPN or PLMN networks which have the coverage for that location,
then decide the suitable candidate network for UE to steer in that location.
\- Option 2: The service provider can instruct UE to measure and report the
performance information of the candidate networks as part of UE configuration
update procedure. The measurement information from UE can be simple indication
if those candidate network\'s signalling strength is suitable for the UE or
not in that location, without exposing further detail of the target network.
Editor\'s note: If solution 1 and solution 2 are merged, this can be
integrated into the merged solution.
### 6.11.3 Procedure
For network selection, similar procedures of \"steering of Roaming\" as
defined in TS 23.122 [5] can be re-used and modified on the top of solution #1
or #2 or the final merged solution of solution #1 and #2.
After UE receives the steering indication and selects the preferred network as
being included in the steering indication, the session continuity procedure
defined by solution 2 can be re-used.
### 6.11.4 Impacts on services, entities and interfaces
Editor\'s note: Further impacts are FFS.
UE
\- Determines to switch network to SNPN based on the SNPN identity in the URSP
or in the new UE policy.
\- After receiving the network steering indicator, UE conducts network
selection and connect to the selected target network. Similar mechanism to
\"Steering of Roaming\" defined in TS 23.122 [5] can be used.
\- If instructed by the service provider, UE can provide indication if the
candidate networks are good enough for the UE to switch to.NG-RAN:
\- None
5GC:
\- Complement to solution #1 and #2 \'s UE configuration update procedure by
providing UE the network steering indication to steer the UE to the selected
SNPN.
## 6.12 Solution #12: Solution on Key Issue #1 about service discovery between
NPN and separate entity
### 6.12.1 Introduction {#introduction-14}
The entity separate from the SNPN can be a PLMN or some other Service
provider. Considering SNPN follows similar architecture as 5GC, Rel-16 roaming
architecture can be used as the reference in this case. Where the AMF in SNPN
interacts with the UDM in PLMN/other Service provider to get the UE
credentials.
### 6.12.2 High-level Description
This solution completes the current cross network service discovery mechanism
in roaming architecture to support the KI#1 scenarios. A local NRF relays the
registration/discovery request to NRF in other network and also the response
back.
**Note this solution only capture how the service between SNPN and SP related
to authentication on Key issue #1 are registered and discovered. Afterwards,
the specific UE registration procedure for external subscription and service
continuity support relies on Solution #1 and/or solution #2.**
### 6.12.3 Procedures
**In case of 5GC aligned SNPN architecture, cross network service discovery
procedure is similar to the one indicated in** _TS 23.502_[6] _clause 4.17.5_
Figure 6.12.3-1 NF/NF service discovery cross SNPNs or cross SNPN and SP NW
1\. The NF service consumer in SNPN invokes Nnrf_NFDiscovery_Request (Expected
Service Name, NF type of the expected NF, SP NW ID, SNPN ID, NF type of the NF
service consumer) to an appropriate configured NRF in the SP NW. The request
may also include optionally producer NF Set ID, NF Service Set ID, S-NSSAI,
NSI ID if available, and other service related parameters.
2\. The NRF in SNPN identifies NRF in SP NW based on the SP NW ID, and it
requests \"NF Discovery\" service from NRF in SP NW according the procedure in
TS 23.502 [6] clause 4.17.4 to get the expected NF profile(s) of the NF
instance(s) deployed in the SP NW. As the NRF in the SNPN triggers the \"NF
Discovery\" on behalf of the NF service consumer, the NRF in the SP NW shall
not replace the information of the NF service consumer, i.e. NF consumer ID,
in the Discovery Request message it sends to the NRF in SP NW.
The NRF in SP NW may further query an appropriate local NRF in SP NW based on
the input information received from NRF of the SNPN.
3\. The NRF in SNPN provides same as step 3 in TS 23.502 [6] clause 4.17.4
applies.
**In case of 5GC aligned SNPN architecture, cross network service registration
procedure is done as following:**
Figure 6.12.3-2: NF/NF service registration across SNPNs or cross SNPN and SP
NW
1\. SP NW NF sends the registration request to SP NW NRF with the SP NW NF
service profile.
2\. SP NW NRF identifies NRF in SNPN based on the SNPN ID, and it requires
\"NF Registration\" service from SNPN NRF according to the procedure specified
in TS 23.502 [6] clause 4.17.1 to register the NF profile(s) of the NF
instance(s) deployed in the SP NW. As the NRF in SP NW triggers the \"NF
Registration\" on behalf of the NF service provider, the NRF in the SP NW
shall not replace the information of the service provider NF, i.e. NF provider
ID, in the Registration Request message it sends to the NRF in SNPN.
3\. SP NW NRF responses to SP NW NF on the registration results same as step 3
in TS 23.502 [6] clause 4.17.1.
NOTE 1: The communication above via NRFs may happen via SEPP.
**After the registration, SNPN NF can discover the services provided by** SP
NW **by inquiring SNPN NRF as specified in TS 23.502 [6] clause 4.17.4.**
NOTE 2: SP NW can be PLMN or some other SNPN.
### 6.12.4 Impacts on services, entities and interfaces
**This solution requires the local NRF to send the registration request to NRF
in other network and relay the response back.**
## 6.13 Solution #13: Solution using N3IWF to support service continuity
between two networks and paging from both networks
### 6.13.1 Introduction {#introduction-15}
This solution proposes to use N3IWF architecture to address the key issue #2
service continuity between NPN and PLMN, and paging from both networks.
In this solution the UE has two subscription i.e. one PLMN (aka \"PLMN UE\"
for PLMN parts of the UE) and one SNPN (aka \"SNPN UE\" for SNPN parts of the
UE) subscription. The scenarios described uses PLMN and SNPN, but same
principles can apply between SNPNs, if allowed.
### 6.13.2 Functional Description
#### 6.13.2.1 Service Continuity
There is an existing solution in Release 16 to address how to access the
service of one network (e.g. PLMN) via the other network (e.g. SNPN), as
described in clause 5.30.2.7 and 5.30.2.8 in TS 23.501 [4].
For single radio UE, it provides the basic function to achieve service
continuity between PLMN and SNPN, by utilizing the handover procedure between
non-3GPP access and 3GPP access described in clause 4.9.2 in TS 23.502 [6],
with one network is acting as 3GPP access and the other network is acting as
non-3GPP network.
But for single radio UE, it may take long time to complete such handover
procedure between PLMN and SNPN, due to the following reasons:
\- UE needs to detect and trigger the procedure to activate/deactivate the
SNPN access mode, otherwise UE may not be able to perform the corresponding
network selection on the target side.
\- Depends on the handover direction, several extra signaling procedures are
required prior to the actual PDU Session establishment procedure which
initiates the handover of the PDU session:
\- If the handover target is 3GPP access (i.e. UE accesses the target directly
via NG-RAN), UE needs to perform one initial registration procedure.
\- If the handover target is non-3GPP access (i.e. UE accesses the target via
N3IWF), UE needs to perform two initial registration procedures (first a 3GPP
access registration for the other network followed by non-3GPP access
registration) and one PDU session establishment procedure.
For dual radio UE, the UE can use one radio operating in SNPN access mode and
the other operating the normal PLMN selection, in order to avoid SNPN access
mode switch. Optionally, dual radio UE can prepare a smoother service
continuity by:
\- Register to both SNPN and PLMN via separated radio interface if the
corresponding network is available.
\- Register to the same 5GC via both Uu and NWu interface and possibly
establish MA-PDU session.
NOTE: When dual radio is described in this solution, only 2Rx/2Tx dual radio
UEs are assumed.
Figure 6.13.2.1-1 UPF PSA in SNPN
Figure 6.13.2.1-1 depicts a scenario where the UPF PSA of the PDU session is
in SNPN. The dual radio UE uses one radio to register under the SNPN NG-RAN,
and the other radio to register under the SNPN N3IWF via the PLMN NG-RAN and
5GC. From SNPN 5GC point of view, the UE is registered under both 3GPP access
and non-3GPP access.
When the dual radio UE needs to do mobility, e.g. UE is leaving SNPN NG-RAN
radio coverage, the second radio of the UE may have already performed the PLMN
selection, cell selection, initial registration and PDU session establishment
in PLMN. Then, UE can directly initiate the handover of the PDU session:
\- For single access PDU session, UE shall follow the procedure described in
clause 4.9.2 in TS 23.502 [6].
\- For MA-PDU session, UE and UPF could switch the user plane resource to the
corresponding access type.
If the UPF PSA of the PDU session is in PLMN, the following Figure 6.13.2.1-2
applies:
Figure 6.13.2.1-2: UPF PSA in PLMN
#### 6.13.2.2 Data services from both networks
The N3IWF solution enables the UE to receive data services from both network
at the same time.
For single radio UE, it could register to both PLMN 5GC and SNPN 5GC, with
option described in Figure 6.13.2.2-1 or Figure 6.13.2.2-2. But from one
specific 5GC point of view, for example SNPN 5GC, the UE could only register
to SNPN 5GC either via Uu or via NWu.
For dual radio UE, it could register to the same 5GC via both Uu and NWu
interface, as illustrated by Figure 6.13.2.2-3. So that, it could take
advantage of the MA-PDU session for data services and use ATSSS to steer
traffic to desired interface.
Figure 6.13.2.2-1 single UE connects to PLMN via Uu
Figure 6.13.2.2-2 single radio UE connects to SNPN via Uu
Figure 6.13.2.2-3 Dual radio UE connects to 5GC via both Uu and NWu
#### 6.13.2.3 Paging
For single radio UE, The N3IWF solution described in clauses 5.30.2.7 and
5.30.2.8 in TS 23.501 [4] can also be enhanced to address the paging aspect of
the key issue.
The underlay network is taking the role of \"Untrusted non-3GPP access\" of
the overlay network. UE is accessing the underlay network service via Uu
interface and accessing the overlay network service via NWu interface. The
paging aspect of this key issue is to address UE to receive paging from the
overlay network.
According to NOTE 3 in clause 5.5.2 in TS 23.501 [4], it is assumed that the
UE configured to receive services from the overlay 5GC network that is CM-IDLE
over the NWu interface will attempt to establish the NWu connection and
transition to CM-CONNECTED state in the overlay network, whenever the UE
successfully connects to a non-3GPP access (i.e. the underlay network). So
that both UE triggered and network triggered service request procedures in the
overlay network can be performed as the UE is in CM-CONNECTED state.
It is proposed to always establish at least one PDU session in the underlay
network, in order to simulate the scenario that UE successfully connects to a
non-3GPP access of the overlay network, then the UE is expected to stay in CM-
CONNECTED state in overlay network. The user plane of such PDU session in
underlay network does not always need to be active.
NAT-Traversal mechanisms described in RFC 7296 and NAT-Keepalive described in
RFC 3948 are also recommended, to avoid any NAT entries between UPF in
underlay network and N3IWF in overlay network timeout. Existing liveness check
procedure described in clause 7.8 and 7.9 in TS 24.502 [10] is used to monitor
the NWu connection, in order to secure the CM-Connected state in overlay
network is valid. Detailed procedure could be found in clauses 6.13.3.5 and
6.13.3.6.
For dual radio (2Rx/2Tx), the UE listens and is prepared to receive MT data
services on both networks.
#### 6.13.2.4 Dual radio UE architecture
A UE able to access both a PLMN and an SNPN has subscription to both networks
(SNPN UE and PLMN UE). When a UE is dual radio capable, each radio can be
associated to each subscription, e.g. as shown in figure 6.49.2.3-1.
NOTE: When dual radio is described in this solution, only 2Rx/2Tx dual radio
UEs are assumed.
Figure 6.13.2.4-1: Example of a dual radio capable UE
When the UE is dual radio capable, as shown in Figure 6.13.2.4-1, then the
SNPN side of the UE (i.e. SNPN UE) can use the PLMN side (PLMN UE) for
accessing the network, and the PLMN side of the UE (PLMN UE) can use the SNPN
side (SNPN UE) for accessing the network.
NOTE: The internal architecture of a dual radio UE is up to UE implementation.
### 6.13.3 Procedures
#### 6.13.3.1 Handover of PLMN anchored PDU Session from N3IWF to NG-RAN
Figure 6.13.3.1-1: Handover of PLMN anchored PDU Session from N3IWF to NG-RAN
This procedure assumes the UE has initially registered in SNPN NG-RAN/5GC and
established a PDU session in SNPN.
1\. UE performs PLMN non-3GPP access registration via SNPN.
2\. UE establishes the non-3GPP access PDU session in PLMN and the
corresponding user plane. This PDU session is anchored in PLMN UPF, and
subject to the handover procedure described in the following steps.
3\. For single radio UE, after SNPN UE detects the coverage loss of SNPN NG-
RAN, it first needs to activate the PLMN UE and switch its radio interface
from SNPN NG-RAN to PLMN NG-RAN, and then performs 3GPP access registration in
PLMN.
For dual radio UE, it is possible that this step of 3GPP access registration
in PLMN is done at any time prior to the coverage loss of SNPN NG-RAN, if
there is PLMN radio coverage available.
If it is MA-PDU session established in step 2, the user plane for 3GPP access
could be activated due to the registration procedure.
4\. If it is a single access PDU session, UE performs handover of a PDU
Session procedure from non-3GPP to 3GPP access as described in clause 4.9.2.1
in TS 23.502 [6].
If it is a MA-PDU session, UE shall add the user plane resource for 3GPP
access by following the procedure in clause 4.22.7 in TS 23.502 [6], if 3GPP
access user plane resource is not activated in step 3. Then UE shall trigger
the release of non-3GPP access user plane resource by following clause
4.22.10.2 in TS 23.502 [6].
#### 6.13.3.2 Handover of PLMN anchored PDU Session from NG-RAN to N3IWF
Figure 6.13.3.2-1: Handover of PLMN anchored PDU Session from NG-RAN to N3IWF
1\. UE performs 3GPP access registration in PLMN.
2\. UE establishes the 3GPP access PDU session in PLMN and the corresponding
user plane. This PDU session is anchored in PLMN UPF, and subject to the
handover procedure described in the following steps.
3\. For single radio UE, after PLMN UE detects the coverage loss of PLMN NG-
RAN, it first needs to activate the SNPN UE and switch its radio interface
from PLMN NG-RAN to SNPN NG-RAN, and then perform initial registration and PDU
session establishment with SNPN.
For dual radio UE, it is possible to register in SNPN, via its SNPN UE, and
establish the SNPN PDU session whenever the radio coverage of SNPN is
available, even prior to the PLMN radio coverage loss.
Once the SNPN PDU session is established, the PLMN UE performs the non-3GPP
access registration in PLMN using the SNPN PDU Session connectivity of the
SNPN UE.
If it is MA-PDU session established in step 2, the user plane for non-3GPP
access could be activated due to the registration procedure.
4\. If it is a single access PDU session, UE performs handover of a PDU
Session procedure from 3GPP to non-3GPP access as described in clause 4.9.2.2
in TS 23.502 [6].
If it is a MA-PDU session, UE shall add the user plane resource for non-3GPP
access by following the procedure in clause 4.22.7 in TS 23.502 [6], if
non-3GPP access user plane resource is not activated in step 3. Then UE shall
trigger the release of 3GPP access user plane resource by following clause
4.22.10.2 in TS 23.502 [6].
#### 6.13.3.3 Handover of SNPN anchored PDU Session from N3IWF to NG-RAN
Figure 6.13.3.3-1: Handover of SNPN anchored PDU Session from N3IWF to NG-RAN
This procedure assumes the UE has initially registered in PLMN NG-RAN/5GC and
established a PDU session in PLMN.
1\. UE performs SNPN non-3GPP access registration via PLMN.
2\. UE establishes the non-3GPP access PDU session in SNPN and the
corresponding user plane. This PDU session is anchored in SNPN UPF, and
subject to the handover procedure described in the following steps.
3\. For single radio UE, after PLMN UE detects the coverage loss of PLMN NG-
RAN, it first needs to activate the SNPN UE and switch its radio interface
from PLMN NG-RAN to SNPN NG-RAN, and then performs 3GPP access registration in
SNPN.
For dual radio UE, it is possible that this step of 3GPP access registration
in SNPN is done at any time prior to the coverage loss of PLMN NG-RAN, if
there is SNPN radio coverage available.
If it is MA-PDU session established in step 2, the user plane for 3GPP access
could be activated due to the registration procedure.
4\. If it is a single access PDU session, UE performs handover of a PDU
Session procedure from non-3GPP to 3GPP access as described in clause 4.9.2.1
in TS 23.502 [6].
If it is a MA-PDU session, UE shall add the user plane resource for 3GPP
access by following the procedure in clause 4.22.7 in TS 23.502 [6], if 3GPP
access user plane resource is not activated in step 3. Then UE shall trigger
the release of non-3GPP access user plane resource by following clause
4.22.10.2 in TS 23.502 [6].
#### 6.13.3.4 Handover of SNPN anchored PDU Session from NG-RAN to N3IWF
Figure 6.13.3.4-1: Handover of SNPN anchored PDU Session from NG-RAN to N3IWF
1\. UE performs 3GPP access registration in SNPN.
2\. UE establishes the 3GPP access PDU session in SNPN and the corresponding
user plane. This PDU session is anchored in SNPN UPF, and subject to the
handover procedure described in the following steps.
3\. For single radio UE, after SNPN UE detects the coverage loss of SNPN NG-
RAN, it first needs to activate the PLMN UE and switch its radio interface
from SNPN NG-RAN to PLMN NG-RAN, and then perform initial registration and PDU
session establishment with PLMN.
For dual radio UE, it is possible to register in PLMN, via its PLMN UE, and
establish the PLMN PDU session whenever the radio coverage of PLMN is
available, even prior to the SNPN radio coverage loss.
Once the PLMN PDU session is established, the SNPN UE performs the non-3GPP
access registration in SNPN using the SNPN PDU Session connectivity of the
PLMN UE.
If it is MA-PDU session established in step 2, the user plane for non-3GPP
access could be activated due to the registration procedure.
4\. If it is a single access PDU session, UE performs handover of a PDU
Session procedure from 3GPP to non-3GPP access as described in clause 4.9.2.2
in TS 23.502 [6].
If it is a MA-PDU session, UE shall add the user plane resource for non-3GPP
access by following the procedure in clause 4.22.7 in TS 23.502 [6], if
non-3GPP access user plane resource is not activated in step 3. Then UE shall
trigger the release of 3GPP access user plane resource by following clause
4.22.10.2 in TS 23.502 [6].
#### 6.13.3.5 UE initiated liveness check
NOTE 1: This clause is a summary from existing TS 24.502 [10] clause 7.3.2.2
and clause 7.8.
Figure 6.13.3.5-1 UE obtains liveness check timeout value from N3IWF and
initiates liveness check
1\. During the IKE SA and Signalling IP Sec SA establishment(e.g. within the
non-3GPP registration procedure), UE indicates its support of liveness check
by including the TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute in the
CFG_REQUEST payload in the IKE_AUTH request message.
2\. N3IWF includes the TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute in the
CFG_REPLY payload in the IKE_AUTH response message, and then UE set its
liveness check timeout value according to the
TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute value in the IKE_AUTH response
message from N3IWF.
3\. Once UE has not received any cryptographically protected IKEv2 or IP Sec
message for the duration of the timeout period, UE initiates the liveness
check by sending an INFORMATIONAL Request message to N3IWF. N3IWF shall
respond with INFORMATIONAL Response message to UE.
NOTE 2: If UE does not support TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute, or
the TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute is not sent by N3IWF in the
IKE_AUTH response message, UE shall use a pre-configured timeout value to
perform liveness check. The pre-configured timeout value is implementation
specific.
#### 6.13.3.6 Network initiated liveness check
NOTE: This clause is a summary from existing TS 24.502 [10] clause 7.9.
Figure 6.13.3.6-1 Network initiated liveness check
1\. N3IWF shall send an INFORMATIONAL request message to UE, if N3IWF has not
received cryptographically protected IKEv2 or IPsec message from UE for the
duration of the timeout period for liveness check selected according to the
local policy.
2\. UE shall reply with INFORMATIONAL response message to N3IWF.
### 6.13.4 Impacts on services, entities and interfaces
UE:
\- Optionally support for Dual radio capability to be able to connect to both
networks via Uu interface and achieve seamless continuity.
\- Support keeping one PDU session in underlay network, in order to simulate
\"successfully connected to the non-3GPP access network\", where the underlay
network is acting the non-3GPP access network.
\- Support establishing MA-PDU session where the non-3GPP access is simulated
by a 3GPP access.
UE and N3IWF:
\- Liveness check procedure shall be used over NWu interface, either triggered
from UE or N3IWF as described by TS 24.502 [10] clause 7.3.2.2, 7.8 and 7.9.
\- NAT-Traversal and NAT-Keepalive (RFC7296, RFC3948) shall be used to keep
NAT entries alive.
## 6.14 Solution #14: Always in CM Connected state in the two networks.
### 6.14.1 Introduction {#introduction-16}
This solution relates the second objective in KI#2. The Purpose of the
objective is to allow the UE to be either in connected state or in a power
save state in the serving network and still get service from the other
network. This solution proposes that the UE is always in CM connected state in
both networks and that the IPsec tunnel between the UE and N3IWF over Nwu is
always maintained even if the UE enters RRC-Inactive mode as a power save mode
in the serving network. It may involve that the UE send IPsec keep alive
messages. This solution will allow the UE to enter a power save mode and still
the other network\'s service can trigger paging (RAN based) in the serving
network.
Editor\'s note: Why the UE needs to be kept in CM Connected state in the
serving network is FFS given that the Nwu connection can be maintained even if
the UE enters CM Idle in the serving network.
### 6.14.2 Functional Description
This solution is based on the following functional principals:
\- The UE is in CM-Connected state in network A (e.g. a NPN) and the UE
connects to network B via N3IWF e.g. network B could be a PLMN.
\- The UE is always in CM-Connected in network B and network B is unaware of
whether the UE enters a power save mode in the serving network A.
\- The assumption is that if the UE always remains also in CM-connected state
in the serving network i.e. Network A, then the PDU session will remain active
and this allows the network A to configure/maintain the IP@ and port# as long
as the PDU session is active and the IPsec tunnel is kept alive.
\- The UE may only enter RRC-Inactive as power save mode in network A.
\- A new indication in the RRC Inactive Assistance Information is added to
inform the RAN node that the UE shall only be released to RRC Inactive and
never to RRC-Idle. The trigger to include the indication can be:
\- The UE informs the serving network in the Service Request message or the
PDU Session Establishment request that the PDU session is for communication
with another network via a N3IWF
\- The network A detects that the PDU session is used for an IPSec tunnel to a
N3IWF. The detection is based on e.g. the IP address used belongs to a well-
known N3IWF of another network.
\- The lifetime of the IPsec Tunnel between UE and N3IWF is configured to
suitable long time to allow the UE to enter power save mode.
\- The DL data on existing PDU session or NAS messages sent across N3IWF to
the NPN network will trigger the RAN node to page the UE.
\- The UE performs all necessary periodic registrations/updates to both
networks and any keepalive activities to maintain the IPsec tunnel over Nwu.
### 6.14.3 Procedures
Since only RRC-Inactive mode shall be used as power save mode then a new
indication needs to be added to the RRC Inactive Assistance Information
indicating to the RAN that the UE shall only be released to RRC-Inactive. This
is shown in the procedure below.
Figure 6.14.3-1: Procedure to secure that the UE is always released to RRC
Inactive.
1\. UE register to the NPN
2\. UE request service in order to setup an IPsec tunnel to the N3IWF. The
Service Requests may need to indicate the specific service (connection to the
PLMN/network B).
3\. Optional: The PDU session is setup according to TS 23.502 [6] clause
4.3.2.2.1 step 2-14
4\. The AMF includes in the RRC Inactive Assistance Information that this UE
shall only be released to RRC Inactive and sends the RRC Inactive Assistance
Information to the RAN. This behaviour in the AMF is triggered by:
a. Either based on the UE indication in the NAS message (SR or PDU session
establishment), or
b. Informed by the SMF/UPF. The SMF/UPF, during step 5, detects that the
target address for the IPSec tunnel is a well-known N3IWF of a PLMN (in this
case the RRC Inactive Assistance IE may need to be updated if already sent),
or
c. The AF requests the PLMN AMF via the NEF to forward specific information to
a UE with the GPSI. The information contains that the UE is allowed to request
the NPN that the UE should preferably always be released to RRC-Inactive. The
AMF forwards the information from the AF to the UE using NAS transport
message. The UE requests the NPN AMF to update the UE Context in RAN and the
RRC Inactive Assistance Information through PDU Session Modification request
containing the indication that the PDU session is for communication with
another network via a N3IWF.
NOTE 1: The AF may be notified by one of the PLMN NF (e.g. AMF or N3IWF)
through NEF once a new UE is in CM Connected via the N3IWF. The notification
is triggered after the AF sends a subscription request to the PLMN NEF.
NOTE 2: The AF triggered mechanism may apply when AF and SNPN are managed by
the same party.
NOTE 3: The impact of AF triggered mechanism to the CT WG1 is FFS.
5\. UE sets up the IPSec tunnel and registers to the PLMN according to TS
23.502 [6] clause 4.12.2.2
NOTE: Based on implementation it is assumed that IP address has long TTL and
if NAT is used the port number is maintained as long as the PDU session is
active.
6\. Due to inactivity in the NPN the RAN releases the UE to RRC Inactive mode.
The RAN always releases the UE to RRC-Inactive based on the indication
included in the RRC Inactive Assistance Information in step 4.
7\. RAN receives DL data or NAS message from the PLMN to the UE. The figure
above shows the that the first packet towards the UE will trigger the RAN node
to page the UE
8\. RAN pages the UE
9\. UE resumes the RRC-Connection.
10\. The DL data or NAS message sent to the UE
### 6.14.4 Impacts on services, entities and interfaces
UE:
\- Optionally: The Service Requests may indicate that the request is for
setting up a connection to a second network via N3IWF to access services in
that second network (connection to the PLMN/network B via N3IWF).
\- Triggers the PDU session modification request upon the receipt of the NAS
message, including the indication for RRC-Inactive mode to UE through N3IWF,
from the AMF
AMF:
\- The AMF includes in the RRC Inactive Assistance Information that this UE
shall always be released to RRC Inactive and sends the RRC Inactive Assistance
Information to RAN.
\- Forwards the information containing that the UE is allowed to request the
NPN that the UE should preferably always be released to RRC-Inactive to UE.
\- Sends RRC-Inactive assistance information to the gNB upon the receipt of
PDU session establishment request or PDU session modification request that
contains the indication (e.g. new element or within the N1 SM container) that
the PDU session is for communication with another network via a N3IWF.
\- Sends notification to AF through NEF regarding the UE ID (i.e. GPSI)
RAN:
\- The RAN always releases the UE to RRC-Inactive if the \"Always release to
RRC-Inactive indication\" is included in the RRC Inactive Assistance
Information.
SMF/UPF:
\- The SMF requests the AMF to update the RRC Inactive Assistance Information
either based on the optional indication in the SR or by detecting that the
target address for the IPSec tunnel is a well-known address to a N3IWF.
AF
\- Obtains UE ID (i.e. GPSI) info from one of the PLMN NF (e.g. AMF or N3IWF)
through NEF
\- Triggers the RRC state change request though PLMN NEF and AMF to UE
N3IWF
\- Sends notification to AF through NEF regarding the UE ID (i.e. GPSI), the
notification may send to the NEF through AMF.
## 6.15 Solution #15: Existing and implementation means for service continuity
and simultaneous reception
### 6.15.1 Introduction {#introduction-17}
This solution proposes to address the following issues in KI #2 by using the
existing and implementation means:
1\. Study whether there are support for service continuity (assuming PSA may
reside in either PLMN or in the NPN) between the PLMN and NPN (SNPN or PNI-
NPN) with overlapping radio coverage areas.
2\. Study means to enable a UE to receive data services from one network (e.g.
NPN), and paging as well as data services from another network (e.g. PLMN)
simultaneously.
### 6.15.2 Functional Description
#### 6.15.2.1 PDU session continuity and service continuity
In Rel-16, UE access PLMN via SNPN and vice-versa are supported by the
mechanisms in clauses 5.30.2.7 and 5.30.2.8 of TS 23.501 [4]. In these two
procedures, it specifies that the UE can have optional support for PDU Session
continuity between PLMN and SNPN by using the procedures specified in clauses
4.9.2.1 and 4.9.2.2 of TS 23.502 [6].
The above solution is illustrated in Figure 6.15.2.1-1 -- if the UE can
maintain concurrent accesses to an SNPN i.e. direct and indirect, both PDU
Session continuity and service continuity can be provided mostly by the UE
while using a single PDU Session anchor in the SNPN hence providing IP address
preservation. This requires dual-radio UEs.
However, a single radio UE is simply not able to maintain concurrent data
paths over two radio accesses i.e. PLMN and SNPN as shown in Figure
6.15.2.1-2. As a result, service continuity as is theoretically possible with
dual-radio UEs cannot be provided with single radio UEs. PDU Session
Continuity may however be provided if the PDU Session Anchor (here in the
SNPN) is not changed when moving between the PLMN access and the SNPN access.
Figure 6.15.2.1-1: Concurrent accesses to an SNPN for Session and Service
Continuity\ (Dual-radio UE)
Figure 6.15.2.1-2: Distinct accesses to an SNPN for a single radio UE
#### 6.15.2.2 UE support for concurrent data or data/paging reception from
PLMN and NPN
In the scenario where the PLMN and NPN are accessed over the very same 3GPP
Radio Access (one of PLMN and NPN being accessed via its N3IWF), receiving
data and paging (i.e. notification) in this situation is possible as per
Rel-16 definition. This is possible with single radio UEs.
In the scenario where the PLMN and NPN are accessed over different 3GPP Radio
Accesses (i.e. PLMN\'s 3GPP Access and NPN\'s 3GPP Access) simultaneously,
\- either multi-SIM like implementation solution can be used (concurrent
paging and data reception), or
\- no solution can be used for single radio UEs (concurrent data reception),
or
\- some implementation option can be used as a solution with dual radio UEs
(concurrent paging and data reception, and concurrent data reception).
### 6.15.3 Procedures
No impact to any procedures has been identified.
### 6.15.4 Impacts on services, entities and interfaces
UE:
\- Single Radio UEs: concurrent data/paging reception is possible using multi-
SIM like implementation option. Concurrent data reception is not possible.
\- Dual Radio UEs: concurrent data/paging reception and concurrent data
reception is possible using implementation options.
## 6.16 Solution #16: Service Continuity between PNI-NPN and PLMN
### 6.16.1 Introduction {#introduction-18}
Editor\'s note: This clause lists the key issue(s) addressed by this solution,
and briefly the main principles of the solution.
This solution address the first aspect of key issue#2 i.e. \"whether there are
support for service continuity (assuming PSA may reside in either PLMN or in
the NPN) between PLMN and PNI-NPN with overlapping radio coverage areas.\"
### 6.16.2 Functional Description
Editor\'s note: This clause further details the solution principles and any
assumptions made.
Regarding to service continuity between PNI-NPN and PLMN, when there is
overlapping or neighboring radio coverage, service continuity can be supported
because the PNI-NPN is part of PLMN. The PNI-NPN may have an local UPF and the
VIAPA server may locate in the DN connected by the local UPF. The VIAPA server
may also locate in the DN which is connected by the PSA UPF. The PNI-NPN may
have dedicated NG-RAN but it may also or may not have dedicated 5GC. In case
PNI-NPN has no dedicated 5GC, the NG-RAN of PNI-NPN may be connected to UPF 1
via N3 interface. In the shared 5GC with PLMN, there is another UPF 2. The
VIAPA server can be connected via either UPF1 or UPF2. In such case, service
continuity can be supported by handover procedure.
The PSA UPF may reside in PNI-NPN or in PLMN. If the UE establish one PDU
session with a single PSA, No matter the PSA UPF resides in PNI-NPN or PLMN,
it is possible to configure the N3 and N9 tunnel to support service continuity
via SMF.
Figure 6.16.2-1:
### 6.16.3 Procedures
Editor\'s note: This clause describes procedures and information flows for the
solution.
#### 6.16.3.1 Handover from PNI-NPN to PLMN
For handover from PNI-NPN to PLMN, the procedure can reuse procedure defined
in clause 4.9.1.3 of TS 23.502 [6], i.e. inter NG-RAN node N2 based handover.
The source NG-RAN is PNI-NPN NG-RAN and the target NG-RAN is PLMN NG-RAN.
Within the procedure, SMF needs to configure N3 and N9 tunnels properly.
If handover from PNI-NPN to PLMN does not cause PSA UPF change, service
continuity is guaranteed with SSC mode 1. Otherwise, with SSC mode 2 and SSC
mode 3 is adopted to achieve service continuity.
#### 6.16.3.2 Handover from PLMN to PNI-NPN
For handover from PLMN to PNI-NPN, the procedure can use the procedure defined
in clause 4.9.1.3 of TS 23.502 [6], i.e. inter-NG-RAN node N2 based handover.
The source NG-RAN is PLMN NG-RAN and the target NG-RAN is PNI-NPN NG-RAN.
If handover from PLMN to PNI-NPN does not cause PSA UPF change, service
continuity is guaranteed with SSC mode 1. Otherwise, with SSC mode 2 and SSC
mode 3 is adopted to achieve service continuity.
### 6.16.4 Impacts on services, entities and interfaces
Editor\'s note: This clause lists impacts to existing entities and interfaces.
## 6.17 Solution #17: Data notification for SNPN/PLMN support VIAPA
### 6.17.1 Introduction {#introduction-19}
This solution addresses KI#2 \"NPN support for Video, Imaging and Audio for
Professional Applications (VIAPA)\". This solution is for SNPN scenario and
target to the following aspect:
\"2. Study means to enable a UE to receive data services from one network
(e.g. NPN), and paging as well as data services from another network (e.g.
PLMN) simultaneously.\"
### 6.17.2 Functional Description
The key idea of this solution is that N3IWF and UE retain the context of the
security tunnel (IKE and IPSec) between the UE and the N3IWF and mark it as
\"inactive\" internally when release message for the security tunnel is
received or sent, i.e. the security tunnel is not really released in UE and
N3IWF, just the handling process of the IKEv2 messages and IPSec tunnel data
is suspended by UE and N3IWF. In this case, the N3IWF can retain the N3 tunnel
with UPF, hence the AMF considers the UE is still in CM-CONNECTED state over
non-3GPP access, or the N3IWF can release the N3 tunnel with UPF, hence the
AMF considers the UE is in CM-IDLE state over non-3GPP access (the UE can
periodically register to the network via another network to keep the RM-
REGISTERED state over non-3GPP access).
When DL data or NAS message is received by the N3IWF in one network, a new
process in the N3IWF finds the context and sends the data/message encapsulated
in IPSec packet according to the context, which will trigger the network
initiated service request procedure in another network. After the IPSec packet
is successfully received by a new process in the UE, the context of the
security tunnel is reactivated and the handling process of the IKEv2 messages
and IPSec tunnel data is resumed.
Editor\'s note: Whether there\'s impact on IKEv2 or whether the UE, triggered
by the IPSec data, needs to initiate a new IKEv2 association for new security
tunnel establishment is FFS.
The following procedures illustrate the flows for UE having PDU sessions in
PLMN when accessing SNPN, which is similar with UE having PDU sessions in SNPN
when accessing PLMN.
### 6.17.3 Procedures
The following figure 6.17.3-1 illustrates the procedure of data notification
from PLMN when UE accessing SNPN.
Figure 6.17.3-1: Data notification from PLMN when UE accessing SNPN
1\. The UE is accessing SNPN and has established security tunnel with the PLMN
N3IWF. The UE has established PDU sessions in PLMN, the PDU session
establishment procedure may be through SNPN or not. The PDU sessions in the
PLMN may be inactive now.
2\. UE to PLMN AMF: N1 message (non-3GPP reachability).
The N1 message is sent via the SNPN UP and PLMN N3IWF. The non-3GPP
reachability indicates that the UE supports retain the context of the security
tunnel between the UE and the PLMN N3IWF when the security tunnel is released.
The non-3GPP reachability shall not be included when the UE access PLMN/SNPN
via WLAN.
The N1 message in step 2 may be involved in different procedure with the N1
message in step 3, e.g. the N1 message in step 2 may be the Registration
Request of a registration procedure while the N1 message in step 3 may be a DL
NAS message in service request procedure.
3\. PLMN AMF to PLMN N3IWF: N2 message (release assistance info, N1 message
(reachability indicator)).
The PLMN AMF determines, based on the received non-3GPP reachability,
subscription data (whether the user reachability is needed or not when
accessing SNPN/PLMN) or information of the existing PDU sessions (whether the
DL data notification is needed or not when accessing SNPN/PLMN) for the user,
capability of the PLMN N3IWF, etc. to indicate the release assistance info to
the PLMN N3IWF and indicate the reachability indicator to the UE for making
the UE reachable via non-3GPP access.
The release assistance info indicates the PLMN N3IWF to retain the context of
the security tunnel for the UE as well as whether to make the UE in CM-IDLE
when the security tunnel is released. The reachability indicator indicates the
UE to retain the context of the security tunnel with the PLMN N3IWF when the
security tunnel is released.
4\. PLMN N3IWF forward the N1 message (reachability indicator) over SNPN UP to
the UE.
5\. The UE sends release message related to the security tunnel to the N3IWF,
the UE retains the context of the security tunnel according to the
reachability indicator received in step 4. The PLMN N3IWF retains the context
of the security tunnel and may trigger the AN release procedure to make the UE
in CM-IDLE state over non-3GPP access according to the release assistance info
received in step 3. In this way, the security tunnel is not really released,
it is just inactivated in the UE and the N3IWF.
6\. When DL data of a PDU session in the PLMN is arrived, the PLMN tries to
notify the UE of the data arrival.
6a. If the PLMN UPF does not have corresponding FAR for the DL data, the PLMN
UPF notifies the PLMN SMF of the DL data, the PLMN SMF triggers the PLMN AMF
to notify the UE, the PLMN AMF determines that the UE is reachable over
non-3GPP access, then sends a N1 message to the UE via the PLMN N3IWF.
6b. If the PLMN UPF has corresponding FAR for the DL data over non-3GPP
access, the PLMN UPF sends the DL data to the PLMN N3IWF.
7\. The PLMN N3IWF finds out the retained context for the security tunnel
based on the received N2 message or the DL data, e.g. 5G-GUTI in the N2
message or destination IP of the DL data, and encapsulates the received N1
message or DL data in an IPSec protocol data destined to the UE with the
context, e.g. encapsulation with the destination IP in the context, encryption
and/or integrity protection with the keys, algorithms, and parameters in the
context.
8\. The PLMN N3IWF sends out the IPSec protocol data, which will be routed to
the SNPN UPF.
9\. The SNPN performs the network triggered service request procedure with the
UE, i.e. page the UE if UE is in CM-IDLE state in the SNPN, or notify the UE
over NAS if UE is in CM-CONNECTED state in the SNPN.
Editor\'s note: How the IPSec data can reach the UE if the SNPN uses NAT and
the NAT state has timed out in the SNPN\'s NAT is FFS.
10\. After the PDU session for delivering the IPSec protocol data has been
established in the SNPN, the SNPN UPF forwards the IPSec protocol data to the
UE via the PDU session in the SNPN.
11\. The UE finds out the retained context for the security tunnel based on
the source IP of the received IPSec protocol data, and uses the corresponding
context to handle the IPSec protocol data, e.g. decryption and/or integrity
check with the keys, algorithms, and parameters in the context.
12\. If the N1 message or the DL data from PLMN is successfully received, the
security tunnel is reactivated in the UE and N3IWF until it has been expired,
there\'s no IKEv2 message exchange for the reactivation. If the security
tunnel is expired, the UE establish a new security tunnel with the PLMN N3IWF
for further message or data transmission.
If N1 message from PLMN is received, the UE initiates service request
procedure with the PLMN via the SNPN to activate corresponding PDU session in
the PLMN.
The UE and PLMN N3IWF shall remove the retained context after the new security
tunnel has been established.
### 6.17.4 Impacts on services, entities and interfaces
Editor\'s note: This clause lists impacts to services, entities and
interfaces.
## 6.18 Solution #18: simultaneous connection with NPN and PLMN for VIAPA
### 6.18.1 Introduction {#introduction-20}
The solution addresses key issue #2 basing on the use case and requirements
from VIAPA (TS 22.263 [3]). In some of the VIAPA use cases, e.g. live
production with integrated audience services, UEs need to connect to both NPN
and PLMN simultaneously. In order for the UE to be simultaneously attached to
both NPN and PLMN while keeping active data session with both networks at the
same time, three different UE deployments need to be considered: 1Tx/1Rx,
2Tx/1Rx, 2Tx/2Rx.
For 1Tx/1Rx, Release 16 solutions for \"Untrusted non-3GPP access\" with SNPNs
can be reused to allow a Single Radio UE to camp on one network (either PLMN
or NPN) with 1Tx/1Rx radio, while using IPsec tunnel via N3IWF in the other
network to send/receive data from the other network. For 2Tx/2Rx, the UE can
send and receive data to/from both networks simultaneously with its 2Tx and
2Rx channels Hence, there will be no issue for 2Rx/2Tx. Therefore, this
solution only focuses on 2Tx/1Rx.
### 6.18.2 Functional Description
#### 6.18.2.1 General
Some Key assumptions are listed below to reflect the requirements from VIAPA:
\- UE can be simultaneously attached to both NPN and PLMN while keeping active
data session with both networks at the same time. Assume UE is the area which
is covered by the NR-RAN of both PLMN and SNPN.
\- The two networks (PLMN and NPN) can be operated by different operators.
\- The UE has separated subscriptions to both PLMN and NPN.
\- No assumptions or restrictions on UE implementation regarding single
radio/dual radio.
\- The NPN may be a SNPN including its own NG-RAN and 5GC.
NOTE 1: For the case of integrated audience service, The NPN aims at providing
local production and DL audience data services.
\- The Data services being provided in this VIAPA KI require high 5QI and high
network resource demand, e.g. One of main AVPROD use case of this KI is that
the NPN provides services for high 5QI downlink audio/video stream data
(multicast or broadcast traffic) e.g. 5ms latency and 30 multicast streams
with 200kbit/s for massive number of UEs in a small area.
NOTE 2: See TS 22.263 [3], clause 6.3.1 KPI requirement for integrated audio
service.
\- Depending on the capabilities and configurations of the UE, limitations of
data-rate and latency may be expected.
NOTE 3: This solution follows the same architecture principle of \"Untrusted
non-3GPP access\" that is defined in Release 16 for SNPN. But the concept can
be applied for \"Trusted non-3GPP access\" for SNPN when it\'s supported.
#### 6.18.2.2 Dual Radio UE (2Rx/1Tx)
In this solution, the UE shares the 1Tx for the UL traffic for both network
(SNPN and PLMN) and splits the 2Rx to each network for their DL user plane
traffic, as illustrated in figure 6.18.2.2-1 below.
Figure 6.18.2.2-1: Architectural overview of a 2Rx/1Tx dual radio UE
simultaneously connected to a SNPN and a PLMN
In the case of UE\'s Tx is connected to PLMN, the UE sends SNPN\'s UL traffic
over PLMN to SNPN\'s N3IWF, while UE uses 1Rx to receive SNPN DL user plane
traffic from SNPN NG-RAN directly. This solution also allows the UE to receive
SNPN DL user plane traffic from PLMN\'s NG-RAN via SNPN\'s N3IWF when it\'s
needed. At the same time, UE can use the other 1Rx as well as the shared Tx to
send and receive user traffic for PLMN traffic. Using this traffic split
capability it\'s up to UE implementation and selecting network which the Tx
will be camp on can be up to UE implementation or the operator policy. By
splitting the traffic between going through RAN (DL) and N3IWF (UL), UE can
simultaneously send data to both network at the same time without suspending
transmission in any network.
The key technical principles for this option are:
1\. UE should be in overlapped coverage areas by the both PLMN NG-RAN and SNPN
NG-RAN.
2\. It\'s preferred that the same SNPN AMF is selected and used for the UE
with both registrations via SNPN\'s NG-RAN and SNPN\'s N3IWF. This can be done
by the AMF selection in the network.
3\. UE conducts 2 registrations to SNPN per clause 5.3.2.4 of TS 23.501 [4] on
\" Support of a UE registered over both 3GPP and Non-3GPP access): register to
SNPN via Uu for DL only traffic and register to SNPN via NWu for UL traffic
and possible other DL traffics. During the registrations, UE provides the
split indication to help Network to configure the different traffic paths. The
NAS control plane between AMF and UE is going via NWu.3. SMF and UPF bases on
the UEs\' split indication and network policy to create, configure and
correlate the DL and UL traffic flows, following the session management
procedures defined in TS 23.501 [4] and TS 23.502 [6].
4\. SNPN sends paging message to UE via Uu, and UE responses to the paging
message via NWu. If the UL data UE sent is the paging response or other NAS
message, the data shall be transmitted via the signalling IPSec SA. If the UL
data are normal user plane data, those can be transmitted via the other IPsec
child SA as defined in TS 23.501 [4].
This option can support both multicast and unicast traffic.
### 6.18.3 Procedures
#### 6.18.3.1 2Rx/1Tx UE exchanges data with two networks simultaneously (with
paging consideration)
Figure 6.18.3.1-1: 2Rx/1Tx UE exchanges data with two networks simultaneously
(with paging consideration)
1\. UE switch its transmitter to the SNPN\'s RAN to conduct initial
registration with SNPN to allow SNPN RAN to be configured with N2 (RAN \--
AMF) for this UE, as well as allow UE to synchronize with RAN for receiving
data. This step is preparing the DL path for UE in SNPN. (assume UE already
registered in PLMN, so UE can suspend the traffic transmission with PLMN and
using the Tx to communicate with SNPN as defined in MUSIM).
1a. During the UE registration with AMF (SNPN), UE sends traffic split
indication to indicate to network that it can split the 2Rx and 1Tx and
corresponding UL/DL traffic via different path after the network registration.
In this phase, AMF may allocate 5G-GUTI for UE, which the UE will provide to
the SNPN\'s AMF during the secondary registration via N3WIF, so AMF can
correlate these two phase of registrations together and also provide proofs
that UE has successfully registered to SNPN\'s RAN. With the split indication,
which implies the NAS control plane between AMF and UE is going via NWu, so
AMF will not accept any new PDU session establishment request until UE
completes its secondary registration with this AMF via NWu and ready to
receive and send data simultaneously.
2\. After UE completes initial registration with SNPN, UE switch its
transmitter to PLMN and resume data transmission with PLMN.
3\. UE can either creates a new or re-uses an existing PDU session of PLMN to
start second registration with SNPN\'s AMF via N3IWF to prepare the UL data
path with SNPN. In this step, UE provides AMF with traffic split indication,
as well as the previous allocated 5G-GUTI. N3IWF or AMF can use the split
indication and 5G-GUTI to select the same AMF with which the UE has conducted
the first registration via SNPN\'s NG-RAN. With this 5G-GUTI, AMF can
associate this registration with the previous registration to identify the
traffic split UE and skip some registration procedures if already conducted in
step 1. After this step, AMF and UE establish NAS connection via N3IWF.
4\. UE initiates PDU session establishment procedure with AMF for the data
services, including DL/UL. This procedure re-uses the existing defined
procedure in TS 23.502 [6] with the consideration of traffic split. The
information for split can include the information such as: of all UL traffic
will be established via Uu, or different DL filters for different DL paths,
such as some DL traffic will go through NWu, while some go through Uu, so on.
This split information can be realized using the existing traffic routing
information for non-3GPP and 3GPP access in PDU session establish/modification
procedures, such as, packet filter information or other traffic routing
policy/information between Uu and Nwu.
NOTE: Based on the network policy, it\'s possible that different PDU sessions
are created basing on the direction (DL/UL), or within one bi-directional PDU
session, there can be different QoS flows which are direction specific.
4b. basing traffic split information, AMF sends N2 PDU session establish
request to RAN and N3IWF to send up DL N2 with RAN, and UL with N3IWF.
5\. if there is no NPN traffic to UE for a while, UE goes into idle mode in
SNPN and triggers the SNPN PDU session release as defined in TS 23.502 [6].
6\. When there is SNPN DL data for the UE, SNPN 5G AMF starts paging procedure
and send paging request to the SNPN RAN, subsequently SNPN RAN broadcasts the
paging.
7\. After receiving the paging via SNPN RAN, UE starts service request
procedure with SNPN via N3IWF over PLMN network. In this step, UE puts
\"response to paging\" as reason code. N3IWF forward the paging response to
AMF in SNPN. The UE sends RRC messages to both SNPN RAN and RAN in PLMN
network with single Tx.
Editor\'s note: To support receiving unicast or high reliable and low latency
multicast traffic via SNPN RAN, it will be up to RAN WG2 and RAN WG3 to
evaluate and decide what the RAN impact will be or if reusing the existing RAN
mechanism is feasible.
8-9. After the PDU session in SNPN is established, SNPN\'s UPF starts to
forward the DL data to UE via SNPN\'s RAN (step 8), while UE transmits the UL
data via the over-the-top IPsec tunnel with N3IWF through PLMN. During this
whole period, UE can still exchange data with PLMN freely without
interruptions.
### 6.18.4 Impacts on services, entities and interfaces
NG-RAN impact:
\- Because UE needs to send UL RAN feedback signalling for the traffics from
both networks using single Tx, RAN impact may be expected and require RAN
WGs\' evaluation and feedback:
\- May need to support some RAN control messages (e.g. latency tolerant
measurement information) being exchanged between PLMN NG-RAN and SNPN NG-RAN
as UE\'s single Tx is being shared to send UL traffic to both networks.
\- May need to support UE to send RAN layer 2 UL control signalling (e.g.
HARQ) to both networks with single Tx.
\- NG-RAN may receive indication from AMF that the UE will be only in listen
model, so NG-RAN can conduct configuration accordingly for RAN optimization.
Editor\'s note: It will be up to RAN WG2 and RAN WG3 to evaluate and decide
what the RAN impact will be or if reusing the existing RAN mechanism is
feasible to support unicast traffic and low latency multicast traffic in the
both networks, as well as to decide if there are split information from 5GC
which is useful for RAN optimization.
UE impact:
\- UE sends split indication to network to indicate UE will split the 2Tx/1Tx
as well as the UL and DL traffics.
\- UE routes the traffic accordingly to different paths.
AMF impact:
\- AMF Handles UE with split indication during the registrations via Uu and
NWu. And It forwards UE traffic split information to SMF.
\- AMF Supports paging responses via NWu if the DL traffic via Uu is unicast.
SMF/UPF impact:
\- No impact, because the existing QoS and traffic routing policy modification
procedures can be re-used when UE splits the traffic to different paths ( Uu
and NWu).
## 6.19 Solution #19: KI #3, Solution for providing IMS voice and emergency
services for SNPN subscribers using eSIM for onboarding of IMS credentials
### 6.19.1 Introduction {#introduction-21}
This solution addresses Key Issue #3 (\"Support of IMS voice and emergency
services for SNPN\"). The solution enables SNPN UEs to receive IMS and
emergency services through provisioning e.g. a UICC containing an ISIM.
This solution requires that the UE has a subscription in a PLMN for providing
IMS services.
The solution also enables the same PLMN to provide IMS services to multiple
SNPNs.
### 6.19.2 Functional Description
#### 6.19.2.1 Solution Principles
Figure 6.19.2.1-1 shows the reference architecture to provide IMS services to
SNPN users used in this solution.
Figure 6.19.2.1-1: Access to IMS services via Stand-alone Non-Public Network
The architecture depicted in the Figure assumes a 1:1 relationship between an
SNPN 5GC and an IMS provider. In this solution, the IMS service may be
provided by a PLMN operator, separate from SNPN provider, as depicted in
clause 6.19.2.2.
This solution proposes that the IMS Core system is accessed over N6 reference
point as a Data Network offered by the SNPN. Gm reference point between the UE
ad the P-CSCF is managed as user plane traffic via UPF.
This solution requires interconnectivity between P-CSCF in the IMS with the
UPF at the SNPN 5GC, and HSS in IMS with UDM at the SNPN 5GC. In addition, N5
reference point between P-CSCF and PCF may be deployed.
The solution requires that the SNPN 5GC enables relevant functionality to
support IMS services as defined in clause 5.16.3.1 of TS 23.501 [4].
NOTE: The SNPN can also be IMS provider and in that case the SNPN and IMS
operations remain the same.
#### 6.19.2.2 Independent IMS Provider
The solution enables a single IMS provider, separate from the SNPN provider,
to provide voice and emergency services to multiple SNPNs as depicted in
Figure 6.19.2.2-1. This is achieved through provisioning a UICC in SNPN UEs.
The actual provisioning of UICC is independent of the UE SNPN access
subscription, and can be performed on demand.
**Roaming**
There is currently no requirement to support roaming between multiple SNPNs.
For roaming between an SNPN and a public PLMN supported by a roaming
agreement, there is no additional functionality required. Existing procedures
are applicable as is, considering that the interface between P-CSCF and PCF
may be inter-operator as mentioned previously.
### 6.19.3 Procedures
#### 6.19.3.1 Procedure to support External IMS Provider and multiple SNPN
The existing procedures and reference points supported in IMS and 5GS can be
used to provide IMS services to a UE accessing an SNPN.
The determination whether the user belongs to the PLMN or another SNPN can be
based on information included in the home network domain provided during IMS
registration procedure and IMS user identities.
Additionally, the P-CSCF identifies the SNPN, and the corresponding PCF to
interact with, via the PLMN ID + NID corresponding to the SNPN where the UE is
located.
### 6.19.4 Impacts on services, entities and interfaces
**UE:**
\- Use PLMN subscription (belonging to the IMS provider) to access IMS
services.
**HSS:**
\- Select UDM instance, if applicable, corresponding to the registering SNPN.
## 6.20 Solution #20: KI #3, Solution for providing IMS voice and emergency
services for SNPN subscribers reusing access level identifiers and credentials
### 6.20.1 Introduction {#introduction-22}
This solution addresses Key Issue #3 (\"Support of IMS voice and emergency
services for SNPN\"). The solution enables SNPN UEs to receive IMS and
emergency services reusing access level identifiers and credentials to provide
SNPN system.
This solution has no impact on the configuration of SNPN UEs. The requirements
for the SNPN 5GC and the subscription profile of SNPN UEs in the 5GC and the
IMS system are also described.
### 6.20.2 Functional Description
#### 6.20.2.1 Solution Principles
Figure 6.20.2.1-1 shows the reference architecture to provide IMS services to
SNPN users used in this solution.
Figure 6.20.2.1-1: Access to IMS services via Stand-alone Non-Public Network
This solution proposes that the IMS Core system is accessed over N6 reference
point as a Data Network offered by the SNPN. Gm reference point between the UE
and the P-CSCF is managed as user plane traffic via UPF.
This solution requires interconnectivity between P-CSCF and HSS-IMS in the IMS
Core system with the UPF, the PCF and the UDM at the SNPN 5GC which according
to Figure 6.20.2.1-1 are all operated by the SNPN.
The solution can be applicable if the IMS network supports SBI interfaces or
legacy interfaces.
The solution requires that the SNPN 5GC enables relevant functionality to
support IMS services as defined in clause 5.16.3.1 of TS 23.501 [4].
This solution proposes that SNPN UEs reuse the user identifiers and
credentials used for accessing the SNPN 5GC for accessing the SNPN IMS system
as follows:
\- SNPN UEs generate an IMPI (in NAI format) and an IMPU based on the SUPI
used by the SNPN UE to access the SNPN 5GC. This SUPI based IMPI/IMPU pair is
used during IMS registration (including emergency registration). The SUPI
based IMPU is barred for call session establishment.
\- The SNPN UE credentials used for primary authentication in the SNPN 5GC are
reused for IMS level authentication.
\- If the SNPN UE is provided with a USIM including AKA credentials, the HSS-
IMS can requests AKA AVs to the UDM/ARPF over the NU1 reference point as
already defined in TS 23.632 [13]. In this case, the UDM/ARPF behaves as an
AuC and provides IMS AKA AVs to the HSS-IMS.
\- Alternatively, in case that SNPN UEs use authentication credentials other
than AKA, this solution proposes the use of GIBA, as defined in TS 33.203
[12], and TS 24.229 [11] adapted for 5GS to authenticate every SNPN UE
accessing to IMS services.
\- The GIBA security solution works by creating a secure binding in the HSS
between the public/private user identity (SIP-level identity) and the IP
address currently allocated to the user at the access level after
authentication in the access network. Therefore, IMS level signalling, and
especially the IMS identities claimed by a user, can be bound together
securely to the PS domain bearer level security context.
\- The adaptation of the GIBA concept to 5GS (i.e. 5G IMS Bundled
Authentication, 5GIBA) enables an authentication mechanism for allowing access
to the IMS domain to SNPN UEs based on the primary authentication of SNPN UEs
in 5GC and without the need to provision IMS level credentials in SNPN UEs.
See clause 6.20.3 for further details.
Additionally, the IMS subscription for SNPN UEs needs to include at least one
additional IMPU used for call session establishment.
\- For call session establishment amongst SNPN users, the IMPUs defined in IMS
subscriptions for SNPN users can be assigned by the SNPN.
\- For call session establishment to/from SNPN users with PLMN or PSTN
numbers, the SNPN operator needs to have the means to be allocated E.164
routable numbers and be able to establish NNI connectivity with other PLMN and
PSTN networks. How an SNPN operator is able to be allocated E.164 routable
numbers is out of the scope of 3GPP and this solution.
Finally, the IMS subscription for SNPN UEs needs to include a subscription
profile for multimedia telephony service. Subscription profile for additional
IMS related services (e.g. messaging, presence, ...) can be provisioned on a
per need basis. The provisioning of the IMS subscriptions for SNPN UEs in the
IMS system may be also realized during onboarding of the SNPN UE in the SNPN
5GC or via auto-activation mechanism during registration in the IMS system.
The details of this process are though out of the scope of this solution.
The rest of the IMS procedures are used as is today. The HSS-IMS and the UDM
may interact over the NU1 reference point during e.g. User location requests,
P-CSCF restoration procedures as defined in TS 23.632 [13].
##### 6.20.2.1.1 Support for IMS services provided by different provider from
the SNPN.
If the SNPN owns and operates the IMS network providing the IMS services, then
there are no additional impacts beyond what is described above.
Different strategies may be adopted to support multiple SNPNs. The IMS network
operator can use common IMS NF instances (e.g. P-CSCF or HSS) for all IMS
users or deploy separate IMS NF instances for each SNPN.
The identification of the corresponding SNPN for these purposes can be based
on the home network domain and IMPI/IMPU identifiers generated and provided by
the UE during the IMS registration procedure, as described in clause 6.20.3.3.
If the owner of the IMS network is an entity different from the SNPN (e.g. a
PLMN operator), interconnectivity via N6, N5 and NU1 reference points implies
using inter-operator interfaces, and hence there is a need to support
additional security requirements over these interfaces.
NOTE: In this solution, it is assumed that no NAT is present between the UPF
and the P-CSCF in 5GIBA (or that it is kept transparent to the UE). If a NAT
device is between the UPF and P-CSCF, problems may arise if it is not deployed
properly as the IP address in the Via header of the SIP header provided by the
P-CSCF to the S-CSCF may not match the one stored in HSS. Similar deployment
considerations and solutions to mitigate the problem of the use of NATs as the
ones defined in Annex V of TS 33.203 [12] apply when adapting the use of GIBA
to 5G. For example, the P-CSCF can retrieve the address mapping information
from the NAT device (e.g. using SNMP), and add the correct address information
in the SIP message. It is assumed that this is possible even if the owner of
the IMS network is an entity different from the SNPN.
The IMPI, the IMPU and the home network domain name are related to the SUPI
used in the SNPN 5GC in the following way:
\- If the SUPI contains an IMSI:
\- The IMPI is derived from the IMSI as defined in TS 24.229 [11] and TS
23.003 [15], including in the realm part the PLMN ID and NID that corresponds
to the SNPN.
\- The Temporary IMPU is derived from the IMSI as defined in TS 24.229 [11]
and TS 23.003 [15], including in the domain part the PLMN ID and NID that
corresponds to the SNPN.
\- The home network domain is derived from the IMSI as defined in TS 24.229
[11] and TS 23.003 [15], including the PLMN ID and NID that corresponds to the
SNPN.
\- If the SUPI is in NAI format, the realm part of the NAI can be used to
build the realm of the IMPI, the domain of the IMPU and the home network
domain name identifying the SNPN serving the UE, e.g. including the PLMN ID +
NID or a domain name that uniquely identifies the corresponding SNPN.
If the IMS network is used to provide services to own users (e.g. PLMN users)
and support of SNPN is enabled (i.e. IMS network provides services to users
belonging to SNPN(s) as well), the home network domain and IMS user identities
can also be used to determine whether the user belongs to the PLMN or an SNPN.
##### 6.20.2.1.2 Roaming
There is currently no requirement to support roaming between multiple SNPNs.
For roaming between an SNPN and a public PLMN supported by a roaming
agreement, there is no additional functionality required in the IMS
procedures. Existing procedures are applicable as is, considering that the
interface between P-CSCF and PCF may be inter-operator as mentioned
previously.
### 6.20.3 Procedures
#### 6.20.3.1 Reuse of SNPN USIM credentials for IMS AKA
The procedure for the HSS-IMS to requests IMS-AKA AVs from UDM/ARPF is already
described in TS 23.632 [13] (see clause 5.2.3).
#### 6.20.3.2 5GIBA Procedure
Figure 6.20.3.2-1 depicts how the GIBA procedure can be adapted to 5G (i.e.
5GIBA procedure):
Figure 6.20.3.2-1: 5GIBA procedure
During the establishment of the PDU session for the IMS DNN, this solution
proposes that the SMF provides the UDM with the binding information (i.e. IP
address, SUPI/GPSI) over the existing Nudm_UEContextManagement_Registration
service operation (step 4). The UDM may indicate for which DNNs the reporting
of binding information is required (5GIBA indicator in step 3).
Later on, the SNPN UE initiates a SIP registration using an IMPI/IMPU pair
based on the SUPI used in 5GC. For the authentication of SNPN user in IMS,
this solution proposes that the HSS-IMS retrieves 5G binding information from
UDM using Nudm_SDM_Get service operation. This interaction between HSS-IMS and
UDM is defined in TS 23.632 [13]. The address of the UDM at the SNPN 5GC may
be locally configured in the HSS-IMS at IMS system or they could be
dynamically discovered by HSS-IMS via NRF.
5GIBA avoids the need to provision IMS level credentials for IMS access in
SNPN UEs and HSS-IMS of the IMS system.
NOTE: Security aspects of the 5GIBA procedure need to be covered by SA WG3.
#### 6.20.3.3 Procedure to support external IMS provider and multiple SNPNs
The existing procedures and reference points supported in IMS and 5GS can be
used to provide IMS services to a UE accessing to an SNPN.
How the IMS user identities and the home network domain name are related to
the SUPI used by the UE in the SNPN is described in clause 6.20.2.2.1.
The determination whether the user belongs to the PLMN or an SNPN can be based
on information included in the home network domain provided by the UE during
IMS registration procedure and IMS user identities.
This is:
\- The P-CSCF determines the SNPN the UE belongs to, based on the home network
domain name contained in the Request-URI of the SIP REGISTER sent to the
P-CSCF. The P-CSCF may also determine that the UE is accessing from an SNPN by
the access network configuration (e.g. from the IP addresses used by the
SNPN).
\- Additionally, the P-CSCF may request the PCF at the SNPN associated with
the home network domain name contained in the Request-URI to report the PLMN
ID + NID where the UE is claiming to be registered, according to PLMN
identifier procedure defined in TS 23.228 [16] clause Y.9.4 and TS 23.503
[14]. This allows the P-CSCF to confirm/assert that the home network domain
name provided by the UE is correct.
\- The HSS determines the SNPN the UE belongs to, based on the visited network
identifier provided by the I-CSCF during the authorization of the IMS
registration. The visited network identifier is also related to the home
network domain name provided by the UE to the P-CSCF as discussed in previous
bullet.
\- For subsequent IMS requests related to the SNPN UE, the IMS NF instances
can identify the SNPN based on the information received during the IMS
registration procedure and/or IMS user identities. This can be applied to
charging and collection of statistics data.
### 6.20.4 Impacts on services, entities and interfaces
When the SNPN owns and operates the IMS network providing the IMS services,
the following impacts apply:
**UE:**
\- Generate an IMPI and an IMPU based on the SUPI used by the SNPN UE to
access the SNPN 5GC and including the NID the UE selected to connect to the
SNPN.
**SMF and UDM and HSS-IMS:**
\- To support 5GIBA in 5GS as defined as depicted in clause 6.20.3.
Additionally, if the owner of the IMS network and the SNPN are different
entities, the following impacts apply:
\- Possibly additional security requirements over NU1, N5 and N6 between the
IMS network and the SNPN as they become inter-operator interfaces.
\- Define the NRF based discovery procedure between an NRF at the IMS network
(e.g. at a PLMN) and a target SNPN using the PLMN ID and NID provided by the
requester NF, in a similar way as the discovery procedure across PLMNs is
defined using PLMN ID. Otherwise selection of NFs at the SNPN (e.g. UDM, PCF)
by IMS nodes can be performed based on local configuration of SNPN NFs at the
IMS nodes.
\- For multi-tenancy support, the UE is required to generate a home network
domain name to address the IMS registration, containing the PLMN ID and NID
that corresponds to the SNPN the UE belongs to, in a similar way the UE
currently generates the home network domain name for IMS when belonging to a
PLMN. The IMS nodes (HSS and P-CSCF) determine whether the user belongs to the
PLMN or an SNPN, based on the home network domain provided by the UE or access
network configuration.
## 6.21 Solution #21: IMS voice support in SNPN for UEs with IMS Credentials
(IMC)
### 6.21.1 Introduction {#introduction-23}
The solution applies to Key Issue #3 \"_Support of IMS voice and emergency
services for SNPN_ \".
The solution proposes to clarify that the IMS Credentials (IMC) can be used
for IMS access security even when the terminal supports 3GPP access
technology, provided that it accesses the IMS of an SNPN. In this solution the
IMS provider is the same administrative entity as the SNPN owner.
### 6.21.2 Functional Description
IMS (e.g. in TS 23.228 [16]) assumes an ISIM or USIM is used when the UE
supports 3GPP access, but for support of SNPN the UE is not required to
support USIM/ISIM.
During the \"Common IMS\" work in Rel-8, when IMS was extended to support
fixed access (i.e. defined by ETSI TISPAN) and other wireless accesses (i.e.
cdma2000), there were some provisions agreed for using the IMS by UEs
supporting IMS that do not have SIM credentials.
Specifically, the term IMC (IMS Credentials) was introduced in TS 21.905 [1]
defined as follows:
_**IMS Credentials (IMC):** A set of IMS security data and functions for IMS
access by a terminal that does not support any 3GPP access technology. The IMC
is not including an ISIM or a USIM. The IMC is not used if ISIM or USIM is
present._
As indicated in the IMC definition, the use of IMC is restricted to terminals
that do not support any 3GPP access technology. This restriction obviously
precludes the use of the IMS architecture in an SNPN that uses a 3GPP access
technology.
To enable the use of IMS in an SNPN there is a need to update the 3GPP
specifications in order to lift this restriction. Below is a non-exhaustive
list of stage 1, stage 2 and stage 3 specifications that will need to be
updated.
\- TR 21.905 [1] clause 1:
\- Current text: _**IMS Credentials (IMC):** A set of IMS security data and
functions for IMS access by a terminal that does not support any 3GPP access
technology. The IMC is not including an ISIM or a USIM. The IMC is not used if
ISIM or USIM is present_.
\- New text: **_IMS Credentials (IMC):_ * A set of IMS security data and
functions for IMS access by a terminal that does not support any 3GPP access
technology **or a terminal accessing IMS in an SNPN*_. The IMC is not
including an ISIM or a USIM. The IMC is not used if ISIM or USIM is present_.
\- TS 23.228 [16] clause 4.3.3.1:
\- Current text: _An ISIM application shall securely store one Private User
Identity. For UEs supporting only non-3GPP accesses, if neither ISIM nor USIM
is present, but IMC is present, the Private User Identity shall be stored in
IMC. It shall not be possible for the UE to modify the Private User Identity
information stored on the ISIM application or IMC_.
\- New text: _An ISIM application shall securely store one Private User
Identity. For UEs supporting only non-3GPP accesses_ _or a UE accessing IMS in
an SNPN_ _, if neither ISIM nor USIM is present, but IMC is present, the
Private User Identity shall be stored in IMC. It shall not be possible for the
UE to modify the Private User Identity information stored on the ISIM
application or IMC_.
\- TS 24.229 [11] clause 4.2 NOTE 1 and NOTE 3:
\- Current text: _TS 33.203 [12] specifies that a UE attached to a 3GPP
network has an ISIM or a USIM_.
\- New text: _TS 33.203 [12] specifies that a UE attached to a 3GPP network
has an ISIM or a USIM_. **_This restriction does not apply to UE accessing IMS
in an SNPN_**.
\- TS 33.203 [12] clause 9:
_\- Current text: This clause identifies requirements on the IMC to support
IMS access security. The IMC is used to enable access using IMS AKA. The IMC
may be used for IMS access by a non-3GPP-only terminal when specified in the
access specific annexes of this specification. The IMC shall not used if ISIM
or USIM is present._
_\- New text: This clause identifies requirements on the IMC to support IMS
access security. The IMC is used to enable access using IMS AKA. The IMC may
be used for IMS access by a non-3GPP-only terminal_ _or for IMS access in an
SNPN_ _when specified in the access specific annexes of this specification.
The IMC shall not used if ISIM or USIM is present._
The existing mechanism define in the TS 23.501 [4] clause 5.16.3 for IMS voice
except EPS fallback is re-used for SNPN, e.g.:
\- During the registration, the UE indicate the VoNR capability to NG-RAN.
\- In the registration accept, the AMF indicates the \"IMS voice over PS
Session Supported Indication\" to the UE.
\- The SMF provides the P-CSCF address to UE during PDU session establishment
for IMS DNN.
\- Support the usage of \"Homogeneous Support of IMS Voice over PS Sessions\"
indication between AMF and UDM.
\- The EPS fallback is not supported;
\- The T-ADS is not supported.
A UE using IMC shall not contain a USIM or ISIM.
NOTE: This excludes UEs which want to use in parallel to SNPN services and
PLMN services.
### 6.21.3 Procedures
The use of IMC is already supported by existing 3GPP specifications and there
is no impact on existing procedures.
In this solution:
\- ISIM and USIM are not used.
\- The Private User Identity, Public User Identity and home domain name are
configured in the UE within the IMC.
\- There are no changes related to the storage format of the Private User
Identity and Public User Identity in the HSS/UDM.
The specifications with procedures currently mandating a UE to use ISIM or
USIM when 3GPP access is used are to be updated to allow usage of IMC for
SNPNs.
NOTE 1: Which specifications to be updated beyond the ones listed in the
solution will be identified during normative phase.
NOTE 2: SA WG3 needs to study security impacts and provide feedback to SA WG2.
NOTE 3: IMC needs to be provisioned to the UE and the IMS network. The
provisioning of IMC is out of scope of 3GPP.
### 6.21.4 Impacts on services, entities and interfaces
Enabling the use of IMS in an SNPN requires minor updates to specification
text like those indicated in clause 6.21.2.
## 6.22 Solution #22: Providing IMS voice services to SNPN UEs
### 6.22.1 Introduction {#introduction-24}
This solution is merged to solution#21.
This solution is for the Key issue #3 \"Support of IMS voice and emergency
services for SNPN\", especially the IMS voice part. The IMC (IMS credential)
is used for the IMS service provided by the SNPN.
This solution does not impact on the IMS level procedure.
### 6.22.2 Functional Description
In TS 22.228 [17], there is restriction on the IMC usage:
For non-3GPP-only terminals with neither ISIM nor USIM, the IMC may be used to
access the IMS via a non-3GPP access technology. However, if ISIM (TS 33.210
[21]) is present it shall be used to access IMS or if ISIM is not present but
USIM (GSMA SGP.21 [24]) is present, USIM shall be used to access IMS.
In this solution, the restriction on the IMC is removed when the UE access
3GPP via SNPN.
Editor\'s note: If FFS how and whether this can be achieved.
The existing mechanism define in the TS 23.501 [4] clause 5.16.3 for IMS voice
except EPS fallback is re-used for SNPN, e.g.:
\- During the registration, the UE indicate the VoNR capability to NG-RAN.
\- In the registration accept, the AMF indicates the \"IMS voice over PS
Session Supported Indication\" to the UE.
\- The SMF provides the P-CSCF address to UE during PDU session establishment
for IMS DNN.
\- Support the usage of \"Homogeneous Support of IMS Voice over PS Sessions\"
indication between AMF and UDM.
\- The EPS fallback is not supported;
\- The T-ADS is not supported.
The IMS level roaming is not supported, i.e. the other SNPN UE or PLMN UE
cannot access the IMS via the SNPN.
Editor\'s note: functional description is incomplete and therefore for FFS.
### 6.22.3 Procedures
Editor\'s note: impact to procedures is FFS.
### 6.22.4 Impacts on services, entities and interfaces
SNPN UE
\- Support procedures described in TS 23.501 [4] for IMS voice when in SNPN
access mode with the exception of EPS Fallback.
\- Use the IMC as IMS credential when the it access 3GPP via SNPN.
AMF of SNPN
\- Include an \"IMS voice over PS Session Supported Indication\" within the
Registration Accept to the SNPN UE.
\- Select proper SMF for PDU session with IMS DNN.
SMF of SNPN
\- Send the P-CSCF address to UE at PDU session establishment.
NG-RAN of SNPN
\- Support UE Radio Capability Match Request.
Editor\'s note: Further impact is FFS.
## 6.23 Solution #23: Solution for support of emergency services for SNPN
### 6.23.1 Introduction {#introduction-25}
This is a solution for Key issue #3 \"Support of IMS voice and emergency
services for SNPN\".
In SA#86 the SA WG1 WID for \"IMS emergency support for SNPN\" (IESNPN)
SP-191038 [20] was approved and related SA WG1 CR pack was also approved. The
service requirements for support of emergency services for SNPN are documented
in TS 22.101 [18], TS 22.228 [17], and TS 22.261 [2].
### 6.23.2 Functional Description
Based on the above service requirements the following impacts for support of
emergency services by SNPN are foreseen for the specifications under SA WG2
control:
\- AMF of SNPN needs include an indication for Emergency Services Support
within the Registration Accept to the UE also for UE in SNPN access mode;
\- NG-RAN of SNPN needs to support related broadcast indicator that the cell
supports Emergency Services over NG-RAN in order to support UEs in limited
service state.
The functionality that is already described in TS 23.501 [4] clause 5.16.4.1
for PLMN access, need to apply to SNPN NG-RAN, 5GC belonging to SNPN and UE
operating in SNPN access mode.
Support for Emergency Services fallback as described in clause TS 23.501 [4]
clause 5.16.4.11 are not possible for the SNPN nor the UE in SNPN access mode.
For selection and priority where emergency services would be used, given the
UE may or may not be registered in SNPN or PLMN at the time of initiating
emergency services. The following are proposed:
\- If the UE is registered, use the current PLMN or SNPN if emergency services
are supported.
NOTE 1: If the UE wants to register with PLMN the UE needs a PLMN subscription
in addition to the SNPN subscription.
\- If the UE is registered in both PLMN and SNPN, then the UE uses the network
from which the UE is already registered to IMS, and if UE is registered to IMS
via both PLMN and SNPN then the UE selects one network to use based on local
UE policy.
\- If the UE is not registered, the UE uses either a PLMN 3GPP access (with
emergency support), or an SNPN (with emergency support), and if neither are
available the UE uses a PLMN non-3GPP access, if available.
NOTE 2: The normative procedures for domain selection for emergency services
can be documented eventually in new Annex in TS 23.167 [19].
### 6.23.3 Procedures
No new signalling procedures needed.
### 6.23.4 Impacts on services, entities and interfaces
UE
\- Support procedures described in TS 23.501 [4] for emergency services when
in SNPN access mode with the exception of Emergency Services Fallback.
\- Perform domain selection as described in clause 6.23.2.
AMF of SNPN
\- Include an indication for Emergency Services Support within the
Registration Accept to the SNPN UE.
\- Needs Emergency configuration.
NG-RAN of SNPN
\- Include related broadcast indicator that the cell supports Emergency
Services over NG-RAN for UEs in limited service state, and if the NG-RAN is
shared by more than one network, and the networks do not have the same support
for Emergency Services, the broadcast indicator is related to those networks
that supports Emergency Services.
## 6.24 Solution #24: Solution for IMS (voice) service for SNPN
### 6.24.1 Introduction {#introduction-26}
This is a solution for Key issue #3 \"Support of IMS voice and emergency
services for SNPN\".
Solution is to reuse the procedures defined in Annex Y of TS 23.228 [16] to
support normal IMS service (i.e. not for IMS emergency) when SNPN (visited
network) is providing access and connectivity service for Home Service
Provider (i.e. related to KI#1). Specifically, this solution requires the IMS
traffics to be routed back to Home Service Provider using home routed model
(see solution #1 in 6.1 and solution #2 in clause 6.2).
### 6.24.2 Functional Description
Supporting IMS over SNPN can reuse the normative requirements defined in TS
23.228 [16] Annex Y. The exceptions are as followed:
When Visited SNPN and Hone Service Provider has service level agreement for
routing IMS traffic back to hone network, the following home-routed model is
adopted:
Figure 6.24.2-1: IMS traffic home routed
Since for home routed model, the serving SNPN is not visible at the Gm
interface from the UE at SIP REGISTGER. Additional PLMN+NID information for
the PLMN ID change subscription (TS 23.228 [16], clause Y.9.4) is needed as
shown in the following:
This procedure shall be applied by the P-CSCF at initial UE IMS registration.
Figure 6.24.2-2: (ref: TS 23.228 [16] Figure Y.9.4-1 as basis: Subscription by
P-CSCF to changes in PLMN ID during initial IMS Registration)
1\. The UE sends a SIP REGISTER request to the P-CSCF.
2\. If this is initial IMS registration then the P-CSCF subscribes to the PCF
to be notified of the PLMN ID + NID where the UE is currently attached.
3\. The PCF forwards the PLMN ID + NID to the P-CSCF. The P-CSCF stores the
PLMN ID + NID.
4\. The P-CSCF includes the received PLMN ID + NID in the SIP REGISTER request
before forwarding the request to the I-CSCF.
5\. Normal IMS registration procedure is then completed.
### 6.24.3 Procedures
See clause 6.24.2. No new signalling procedures needed.
### 6.24.4 Impacts on services, entities and interfaces
Enabling the use of IMS with home routed model (using procedure defined in TS
23.228 [16], Annex Y) has no new impact to call flow for solutions addressing
KI#1 with home-routed model.
At Home IMS, PLMN ID information is expanded to PLMN ID+NID in SIP signalling.
H-PCF needs to indicate PLMN ID+NID to P-CSCF. P-CSCF includes PLMN ID+NID in
SIP and I-CSCF includes PLMN-ID+NID in Cx to HSS.
## 6.25 Solution #25: Solution for IMS emergency session for SNPN without IMS
roaming interface.
### 6.25.1 Introduction {#introduction-27}
This is a solution for Key issue #3 \"Support of IMS voice and emergency
services for SNPN\".
Solution is to reuse TS 23.167 [19] Annex K (w/o IMS roaming interface) to
support IMS emergency session when normal IMS session between the visited SNPN
and Home Service Provider is done using home routed model for addressing KI#1.
### 6.25.2 Functional Description
Supporting IMS emergency reuses the following procedure defined in TS 23.167
[19] clause K.3 as basis.
### 6.25.3 Procedures
The call flow for support of IMS emergency sessions when normal IMS session
between the visited SNPN and Home Service Provider is done using home routed
model for addressing KI#1.
Figure 6.25.3-1: IMS Emergency Session Establishment in deployments without
IMS roaming interface between Visited Network (SNPN) and local PSAP
1\. UE establishes PDU session (for 5GC) for IMS emergency services.
2\. SUPI and PEI are retrieved from the UE context stored in the AMF; the SUPI
may contain an IMSI or a network-specific identifier and the PEI as specified
in TS 23.501 [4] clause 5.9.3. The GPSI (if available) is provided by the UDM;
the GPSI needs to contain an MSISDN.
Editor\'s note: It is FFS how uniqueness of an MSISDN of a SNPN subscriber can
be guaranteed, how it can comply to regulatory requirements and how it can be
rerouted.
Editor\'s note: It is FFS how the uniqueness of an IMSI of a SNPN subscriber
can be guaranteed, how it can comply to regulatory requirements and how it can
be rerouted.
Editor\'s note: It is FFS whether NSI is allowed to be used, subject to
service requirements and security assessment.
3\. AMF sends a Nsmf_PDUSession_CreateSMContextRequest towards the SMF/UPF
including the SUPI, the PEI and the GPSI (if available) as specified in TS
23.502 [6].
4\. SMF establishes an SM Policy Association with the PCF as described in TS
23.502 [6] and TS 23.503 [14]. The PDU session is identified with UE\'s IPv4
address or IPv6 prefix. The SUPI, PEI, GPSI (if available) and emergency DNN
are passed to the PCF.
5\. PDU Session Establishment procedure (for 5GC) is being completed.
Steps 6-12 apply in case the UE performs IMS Emergency Registration, based on
conditions specified in clause 4.1 (in TS 23.167 [19]) e.g. UE is aware that
it has sufficient IMS authentication material.
Editor\'s note: It is FFS how UE is aware that it has sufficient IMS
authentication material when using IMC.
6\. UE initiates IMS emergency registration by sending a SIP REGISTER
(UserID-1) message. The UserID-1 parameter is an IMPI and optionally an IMPU.
7a. Upon reception of the SIP REGISTER message the P-CSCF determines that
there is no IMS NNI to the user\'s H-SNPN. The P-CSCF requests the PCF for
5GS-level identities (e.g. SUPI, PEI, MSISDN). P-CSCF uses the
Npcf_PolicyAuthorization service as described in TS 23.502 [6] and TS 23.503
[14].
7b. PCF performs session binding based on the UE\'s IP address/prefix (as
defined in TS 23.503 [14]). If the Npcf_PolicyAuthorization service is used,
the PCF provides SUPI, PEI, and if available GPSI, and the P-CSCF extracts
IMSI or network-specific identifier, PEI, and if available MSISDN from those
identities.
8\. Based on operator configuration and if the network supports the GIBA
procedure over Gm as defined in TS 24.229 [11], the P-CSCF responds with a 420
response with sec-agree value listed in the unsupported header field.
Otherwise it rejects the IMS registration request with SIP 403 (Forbidden) as
defined in TS 24.229 [11]. If the network supports anonymous IMS emergency
sessions, P-CSCF may add an indication whether it supports anonymous IMS
emergency sessions to the 403 or 420 response.
Steps 9-12 apply in case the P-CSCF has responded with a 420 response in step
8 and if the UE supports GIBA procedure as part of emergency IMS registration
(irrespective of whether indication of anonymous IMS emergency session support
was included in step 8).
9\. UE according to TS 24.229 [11], performs a new initial registration by
sending a SIP REGISTER (UserID-2, PEI) message and without inclusion of the
Authorization header field. UserID-2 is a public user identity derived from
SUPI. P-CSCF may verify the SUPI/PEI provided by the PCF in step 7b against
the SUPI/PEI derived from the public user identity provided by the UE, prior
to accepting the SIP REGISTER message.
10\. P-CSCF accepts the registration with 200 OK and provides a tel-URI based
on the MSISDN (if available) received from PCF in step 7b to the UE. From the
UE point of view, the procedure is the same as specified for GIBA (GPRS-IMS
bundled authentication) procedures in TS 24.229 [11].
11\. UE then attempts an IMS emergency session by sending a SIP INVITE
(UserID-3) message. UserID-3 is set to UE\'s public identity (i.e. MSISDN as
Tel-URI received in step 10).
12\. The P-CSCF verifies whether the UserID-3 indicated in the SIP INVITE
message complies with the tel-URI that was provided to the UE. If compliant,
P-CSCF forwards the SIP INVITE towards the PSAP including a callback parameter
(CallBackPar) in the form of TEL-URI derived from the MSISDN received in step
7. The procedure stops here.
Steps 13-15 apply if the UE attempts anonymous IMS emergency session, e.g. the
P-CSCF has responded in step 8 with a 403 (Forbidden) response, or the P-CSCF
has responded in step 8 with 420 response and the UE does not support GIBA as
part of emergency IMS registration, or if the UE skipped IMS emergency
registration:
13\. The UE may attempt an unauthenticated IMS emergency session including an
\"anonymous user\" parameter in the SIP INVITE message.
14\. Upon reception of the SIP INVITE the P-CSCF either internally retrieves
the one or more 5GS-level identities and the MSISDN (if available) that were
received in step 7b, or performs step 7 again.
15\. The P-CSCF forwards the SIP INVITE (UserID-4, CallBackPar) towards the
PSAP. UserID-4 is derived from one of the 5GS-level identities received in
step 7b. CallBackPar in the form of TEL-URI is derived from the MSISDN
received in step 7b. The procedure stops here.
### 6.25.4 Impacts on services, entities and interfaces
No new signalling procedures needed.
Editor\'s note: FFS whether Stage 3 needs to define (as shown in step 9
above), the public user identity derived from SUPI by the UE so that P-CSCF
can verify the received SUPI provided by PCF vs. the one received from Gm.
Editor\'s note: Further impact, e.g. to UE, IMS nodes and PSAP are FFS.
## 6.26 Solution #26: PLMN assisted IMS voice service and emergency service
for SNPN
### 6.26.1 Introduction {#introduction-28}
This solution addresses key issue #3 \" Support of IMS voice and emergency
services for SNPN \".
This solution utilizes the IMS network of PLMN to provide IMS voice service
and emergency services for SNPN, with consideration that PLMN can provide with
legacy IMS network low cost voice service and voice service continuity when
SNPN UE moves out of SNPN coverage, which avoid SNPN owner build a standalone
IMS network only for voice service. Moreover, the MSISDN or tel URI of the
SNPN voice users may only be allocated by PLMN, and the interconnection
between SNPN users and other legacy voice users may be impossible for SNPN
owner.
In this solution, most of the IMS functional entities are deployed in PLMN
network. But if the SNPN has requirement for isolation of internal IMS voice
traffic from public network, entities related to IMS voice user plane,
including P-CSCF, MRFP and AS, can be deployed in SNPN area.
The IMS network of PLMN and SNPN network are in different trust domains, but
the two networks builds trust relationship by business contract and the
interfaces in between, are security protected to allow the interoperability
between two network domains.
The IMS subscription data, including IMS credential, is normally required to
be handled by SNPN owner itself and is therefore stored in SNPN, i.e. in SNPN
UDM/IMS HSS. If SNPN owner allow the IMS subscription data to be stored in
PLMN network, then the IMS HSS is located in PLMN network, with the
interaction to SNPN UDM using solutions specified in TR 23.973 [36].The IMS
configuration in UE can be provisioned or derived in different scenarios:
\- If the UE has UICC and is provisioned USIM for SNPN, the IMS identities
(IMPI and IMPU) and IMS domain name can be provisioned by adding ISIM in the
UICC; or
\- If the UE has no UICC, the IMS identities (IMPI and IMPU) and IMS domain
name can be based on IMC as specified in TS 33.203 [12].
### 6.26.2 Functional Description
#### 6.26.2.1 IMS voice service
Figure 6.26.2.1-1: Solution architecture 1
In architecture 1, the PLMN IMS network is totally separate from SNPN network.
There is no IMS functional entity required to be deployed in SNPN network area
except for IMS HSS which is collocated with SNPN UDM.
Figure 6.26.2.1-2: Solution architecture 2
In architecture 2, to keep IMS voice traffic in SNPN network area, IMS
functional entities related to user plane including P-CSCF, MRFP and AS is
deployed in SNPN network area.
NOTE 1: The architectures above do not reflect the scenarios that the HSS is
located in PLMN network, which can refer to TR 23.973 [36] including different
UDICOM architectures for deployment.
Editor\'s note: SA WG3 needs to evaluate if Mp reference point can go across
multiple domains securely.
The key principles of the solution to support IMS voice service are as
follows:
1\. The UDM of SNPN supports IMS HSS and is provisioned with IMS subscription
of SNPN UE. PLMN IMS network connects to SNPN UDM via standard
N70/Cx/Dx/N71/Sh interfaces.
2\. The P-CSCF address is configured in SMF of SNPN or is discovered by SMF as
specified in TS 23.502 [6].
3\. The AMF includes \"IMS Voice over PS session supported Indication\" in
Registration Accept message.
4\. Each SNPN is identified by its unique IMS network domain name. When there
are multiple SNPNs, this domain name and the IMPI/IMPU based on it is used for
correct routing via N70/Cx/Dx and N71/Sh to correct IMS HSS. If N5 is used
between PLMN P-CSCF and SNPN PCF, P-CSCF includes IMS network domain name in
session binding procedure to discover correct PCF. If Rx is used, P-CSCF
discovers correct PCF based on local configuration (the mapping between IMS
network domain name of SNPN and PCF address) or via Diameter Routing Agent
based on UE IP address.
5\. The IMS authentication is actually mutual authentication between UDM/HSS
and UE belonging to the same SNPN via IMS CN which has trusted relationship.
The security on interfaces between SNPN and PLMN networks follows the current
Network Domain Security mechanism specified in TS 33.210 [21].
NOTE 2: In current 3GPP specifications, e.g. TS 24.229 [11], TS 33.203 [12]
and TS 33.210 [21], IMS HSS is not required to be in the same trust domain and
Cx interface is protected by security association as specified in TS 33.210
[21].
NOTE 3: How SNPN UE selects SNPN based on SNPN voice capability is solved in
other solutions.
Editor\'s note: The security impacts is to be checked by SA WG3.
#### 6.26.2.2 IMS emergency service
In this solution, IMS emergency service is provided by local PLMN network,
i.e. the PLMN IMS network providing IMS emergency service shall be in the same
country with the SNPN network. For scenario in KI#1 that Home SP of the SNPN
is in other country than the one where the SNPN is located, the emergency
service is not provided by the PLMN from the country of Home SP, but the PLMN
from the country of SNPN, similar to the way emergency service is provided for
inbound roamer nowadays.
Editor\'s note: The impact on UE for SNPN selection is FFS.
The key principles to support of IMS emergency service are as follows:
1\. The functionality to support emergency service as specified in TS 23.501
[4], TS 23.502 [6], TS 23.167 [19] and TS 24.229 [11], e.g. support of
emergency PDU session and AMF supports indicates support of emergency service
as specified in TS 23.501 [4], also applies to the NFs in the SNPN and network
functionality entities in the PLMN IMS network.
2\. Architectures defined in Figure 6.26.2-1 and Figure 6.26.2-2 also applies
with E-CSCF is added in PLMN IMS network. The PLMN IMS network for emerngecy
service is in the same country with the SNPN.
3\. If the SNPN supports emergency service, the SNPN is configured with
Emergency Configuration Data in AMF, and the P-CSCF address(es) for emerngecy
service in SMF. The UE shall establishes emergency PDU session in SNPN and
shall do IMS emergency registration via the P-CSCF for emergency service
before initiating IMS emergency session. For scenario in KI#1 that Home SP of
the SNPN is in other country than the one where the SNPN is located, the
P-CSCF for emergency service is not the one for IMS voice service, provided by
different PLMNs.
If the SNPN doesn\'t support emergency service, the UE selects and registers
to other network, e.g. PLMN network, for emergency service as specified in TS
23.167 [19].
### 6.26.3 Procedures
The IMS voice procedure is the same as specified in current specifications,
e.g. TS 23.228 [16], TS 23.501 [4] and TS 23.502 [6], with the following
additional enhancement:
\- the security associations over interfaces between SNPN and PLMN IMS network
is established;
\- when the same PLMN IMS network supports multiple SNPN, IMS network domain
name of SNPN is used for correct routing for N70/Cx/Dx, N71/Sh to HSS and N5
to PCF.
The IMS emergency procedure is the same as specified in current
specifications, e.g. TS 23.228 [16], TS 23.167 [19], TS 23.501 [4] and TS
23.502 [6], with the following additional enhancement:
\- For scenario in KI#1 that Home SP of the SNPN is in other country than the
one where the SNPN is located, the UE shall do IMS registration to connect to
the P-CSCF for emergency service other than the one for IMS voice service,
provided by different PLMNs.
### 6.26.4 Impacts on services, entities and interfaces
No functional impact on PLMN IMS and SNPN 5GC to support IMS voice and
emergency services.
The UE shall do IMS emergency registration to connect to the P-CSCF for
emergency service other than the one for IMS voice service.
## 6.27 Solution #27: Common UP/CP onboarding solution for SNPN
### 6.27.1 Introduction {#introduction-29}
#### 6.27.1.1 General
This solution proposes a general Onboarding solution that addresses both UP
and CP UE Provisioning Procedures for non-3GPP credentials used for accessing
a SNPN. The solution includes a common registration part, where the UE is
first authenticated in a DCS and then authorized to do the onboarding
procedure at the SNPN owning the subscription. Then, there is a decision point
to do the provisioning of data to the UE either via CP or UP.
#### 6.27.1.2 Assumptions
\- The UE is provisioned with an Onboarding UE certificate that includes the
UE ID (PEI, MAC, or Hash of Public Key), so that the UE ID cannot be forged.
The certificate is signed by the device manufacturer.
\- The DCS is used for authentication of the device. Additionally, the DCS
should be provisioned (after the device has been sold to an SNPN) with an
identity of the SNPN owning the subscription. This identity could be a simple
FQDN, the exact details are FFS.
\- The Onboarding Network (ON) has an \"onboarding connectivity agreement\"
with one or more SNPNs. This requires some sort of Service Level Agreement
between each of the ON and SNPN.
\- The ON outsources authentication of the UE to the DCS.
\- The ON outsources authorization of the UE (to proceed with the onboarding
procedure) to a PS (typically deployed in the SNPN owning the subscription).
\- For the UE to authenticate the SNPN, transitive trust is suggested: the UE
trusts the DCS, the DCS trusts the SNPN, the DCS asserts that this SNPN is the
correct one.
\- There is a decision point for continuing with either using the CP or the UP
for provisioning. This decision point might be based on device capabilities,
onboarding agreements, network policy, etc.
\- SIB broadcasts an indication of support for Onboarding of UEs.
\- RRC enhancements allowing the UE to indicate that the request is for UE
onboarding purposes and NG-RAN then can use it to select an AMF supporting UE
onboarding.
\- NG-RAN indicating UE request was for UE onboarding to AMF to allow AMF to
differentiate the request from normal requests.
\- When User Plane provisioning is used, the SMF is assumed to be provisioned
with a default subscription profile that is applicable to Onboarding PDU
sessions.
### 6.27.2 Functional Description
#### 6.27.2.1 General
The procedure hereby described allows a UE, which is not initially provisioned
with NPN credentials to access an Onboarding Network (ON) and to get
provisioned with NPN credentials and configuration for an SNPN which can be
the same as or different from the ON.
The UE selects the ON (the exact details of ON selection are FFS) and
registers to it for the onboarding service. During the registration procedure
the ON requests the Default Credential Server (DCS) to authenticate the UE and
determine whether the UE ID is authentic. The ON also requests from the DCS to
provide details of the SNPN owning the device. The ON requests from the SNPN
authorization to proceed with the onboarding registration. The SNPN, taking
into account UE capabilities, onboarding agreements with the ON, and local
policy, determines whether a UP or CP provisioning should be executed.
Alternatively, the ON can determine whether a UP or CP provisioning should be
executed taking into account the UE capabilities and preferences, onboarding
agreements with the SNPN (including SNPN capabilities and preferences), and
local policy (including ON capabilities and preferences).
NOTE 1: If there is a failure of using the decided option of UP based or CP
based provisioning, then whether to define fallback option or performing re-
attempts would be a stage 3 responsibility.
NOTE 2: this solution illustrates how to determine the UP or CP provisioning
by using the SNPN as an example.
If CP solution is chosen, provisioning of the UE using CP follows the
registration. This procedure is based on the existing UE Parameters Update
triggered from UDM terminated in ME.
Editor\'s note: Whether an additional layer of security is required e.g. to
secure the provisioning data from PS beyond the security currently provided by
UDM.
If UP solution is chosen, the UE is duly informed and proceeds to establish an
onboarding PDU session, which is restricted for just providing connectivity to
the Provisioning Server. Once established, the UE uses any available mechanism
to contact the Provisioning Server for provisioning.
At the end of any of the CP or UP procedures, the UE is provisioned with NPN
credentials (for the SNPN owning the UE\'s subscription) and additional
configuration data. Then the UE de-registers from the ON, performs a new
network selection, and registers using the provisioned NPN credentials with
the SNPN owning the UE\'s subscription.
#### 6.27.2.2 Architecture
Figure 6.27.2.2-1: Architecture for UE Onboarding to an SNPN
NOTE: The figure presents a typical deployment. However, other deployments are
also supported. For example, the DCS is presented as being located in the
Device Vendor administrative domain. This is just one of the few possible
deployment options. The DCS may be also located in other domains, such as the
ON domain or the SNPN domain. Similarly, the AUSF may be deployed by the ON,
the SNPN, or the DCS. Solutions presented here are agnostic with respect to
deployment options.
### 6.27.3 Procedures
#### 6.27.3.1 High-level Procedures
Figure 6.27.3.1-1: Overview of the Onboarding solution
A1: At manufacturing time, the device vendor configures the UE with default UE
credentials. The device vendor may, optionally, configure the UE with a Home
Network Identifier and Home Network Public Key of the vendor.
A2: The DCS administrator configures the DCS with the default UE credentials
and its Unique UE identifier, as well as data identifying the SNPN owning the
subscription, including the name PLMN ID + NID of the SNPN and a SNPN security
information. The latter step can be done after the device is manufactured. It
is also possible that the DCS is configured with more than one network owning
the SNPN.
A3: The ON may need configuration to, e.g. enforce the onboarding connectivity
agreements with the SNPN, configuration of the DCS to contact based on the
onboarding SUPI presented by the UE, etc.
A4: The SNPN configures its network, by adding, to the PS, the onboarding
SUPIs to the list of authorized UEs to perform the onboarding function. Then,
if static allocation of NPN credentials is used, the SNPN binds the onboarding
SUPIs with the NPN credentials assigned by the SNPN. The SNPN also configures
the Provisioning Server with access to the data that should be provisioned to
the UE, including access to the NPN credentials and other data (e.g. PLMN ID
and NID of the SNPN, Configured S-NSSAIs, DNNs, etc.). The PS may also be
provisioned with the supported capabilities of the UE. This data may be
provisioned in UDR, from which the PS retrieves it. Additionally, if the PS is
located outside the trust domain, a NEF may be located at the edge of the
trust domain.
B1: NG-RAN broadcasts an indication of support for Onboarding UE. The UE,
either manually or automatically (e.g. due to the lack of a valid UE
configuration to access the network) selects an access network that supports
UE onboarding and initiates the onboarding process. During this initial
access/registration the UE initiates a dedicated onboarding registration
procedure (i.e. registration type set to \"onboarding\"), whereby the UE
derives an Onboarding SUPI and creates an Onboarding SUCI just for the
onboarding process. As part of the registration procedure the ON authenticates
the UE with the help of a DCS. During the authentication procedure, the UE
supplies its onboarding UE certificate signed by the device manufacturer (or a
delegated CA root). The ON inspects the UE certificate, selects the DCS of the
device manufacturer, and contacts the DCS for authenticating the UE.
Editor\'s note: The details of the derivation of the onboarding SUPI and the
creation of the onboarding SUCI are to be decided by SA WG3.
B2: The ON retrieves from the DCS the data that identifies the SNPN owning the
subscription for the UE that is attempting the onboarding procedure. These
data may include, e.g. the PLMN ID and NID of the SNPN and SNPN security
information that may be use for authentication purposes (for the UE to
authenticate the SNPN at a later stage).
B3: The ON provides the onboarding SUCI of the onboarding UE to the SNPN. The
SNPN verifies that the ON is trusted for onboarding purposes, and then
verifies internally that the onboarding SUPI is authorized to perform the
onboarding procedure.
C: The SNPN, based on UE capabilities, connectivity agreements (SLA which also
takes into account the level of trust) with the Onboarding Network, and local
policy, decides whether a Control Plane UE provisioning or User Plane UE
provisioning procedure should be used. The SNPN informs the ON about the
selected UE provisioning method. The onboarding UE registration procedure is
completed. The SNPN informs the ON, and the ON informs the UE, of the selected
onboarding method. If CP UE provisioning procedure is selected, the SNPN may
create a secure blob of UE provisioning data and send it to the ON. The
endpoint of the secure data provisioning using UE Parameters Update procedure
is though the ME and not UICC unlike current TS 33.501 [7].
NOTE: Steps B1 and B2 can be combined. Steps B3 and C can be combined.
D1: If a CP UE provisioning procedure is selected, the SNPN initiates it. If
the SNPN got the UE provisioning data in step C, it proceeds provisioning this
data to the UE. Otherwise, the ON first collects the UE provisioning data from
the SNPN prior to proceeding with sending this data to the UE.
D2: If instead, a UP provisioning procedure is chosen, upon reception of a
successful registration indication, the UE initiates the establishment of an
Onboarding PDU session. This registration provides restricted connectivity
just to the Provisioning Server.
D3: Upon successful Onboarding PDU Session establishment, the UE initiates an
User Plane protocol connection toward the Provisioning Server to retrieve the
UE provisioning data. This step needs not be standardized by 3GPP.
E: Once the UE has been provisioned with NPN credentials and additional data,
it deregisters from the network, and it may perform a PLMN selection and
registration with the new provisioned data.
#### 6.27.3.2 Detailed Procedures
##### 6.27.3.2.1 Registration procedures
Figure 6.27.3.2.1-1: UE Registration, authentication, and authorization flow
of the Onboarding solution
1\. The UE receives a trigger to start the onboarding procedure. This trigger
can be manual, provoked by a user pressing a given combination of keys; or it
can be automatic, for example, due to the UE starting and not being previously
provisioned.
2\. The UE derives an onboarding SUPI and creates its corresponding onboarding
SUCI.
NOTE 1: The UE is assumed to lack configuration of the home SNPN (SO), in
particular, the UE is assumed to not be provisioned with a Home Network
Identifier or Home Network Public Key for the SNPN/SO. However, the UE may
optionally be provisioned with an HNI and HN Public Key of the DCS, and in
such case, the UE is able to create the onboarding SUCI using the security
information known to the DCS, and the Home Network Identifier corresponds to
the DCS, and the DCS in such case supports functionality to de-conceal the
onboarding SUCI. If the UE does not have HNI and HN Public Key of the DCS, the
UE creates a SUCI with the Home Network Identifier, Routing Indicator, and
Home Network Public Key Id, and Protection Scheme Identifier uninitialized (or
zeroed).
3\. The UE scans for a network that supports Onboarding procedures and selects
an Onboarding Network to connect to. This network selection can be manual, if
a user selects a network from a list of available networks, or automatic, e.g.
if the UE is provisioned with a list of PLMN IDs and NIDs to connect to.
4\. The UE sets the AS signalling. The UE sets up an RRC connection
(RRCSetupRequest) and includes Access Network Parameters. The AN parameters
include an EstablishmentCause Information Element set to a new _Onboarding_
value. Once the AS is setup, the UE establishes a NAS connection by sending a
Registration request containing an onboarding SUCI, PEI, and a 5GS
Registration type set to a new _Onboarding_ value. The 5GS Registration type
indicates that the UE wants to perform an Onboarding procedure.
5\. The RAN node examines EstablishmentCause IE and selects an appropriate
onboarding AMF in the ON.
NOTE 2: The above assumes that the RAN node can only route toward a default
onboarding AMF in the ON. RAN sharing scenarios, where the RAN node is serving
multiple default onboarding AMFs belonging to different onboarding networks,
is not supported in this version of the specification.
6\. The RAN node forwards the Registration request to the selected onboarding
AMF. The AMF receives an N2 message (N2 parameters, Registration Request as
for step 4). When NG-RAN is used, the N2 parameters include Location
information and Cell Identity related to the cell in which the UE is camping.
7\. AMF receives the Onboarding SUCI in the Registration Request. If this is a
null-schemed protected SUCI, AMF can safely de-conceal it and extract the
SUPI. However, if the SUCI is protected with a Protection Scheme Identifier
different than the null-scheme, then the AMF needs to select a DCS, based on
the Home Network Identifier, and request the DCS the de-concealing of the SUCI
(optional steps 7a and 7b).
NOTE 3: TS 23.003 [15] enables an AMF to de-conceal the SUCI when the Routing
Indicator is zero and the protection scheme is null.
8\. Then, the AMF, based on the onboarding SUPI and local policy, selects an
AUSF that supports onboarding procedures.
9\. The AMF sends an authentication request to the AUSF, including the
onboarding SUPI.
10\. The AUSF, based on local configuration and the value of the onboarding
SUPI, selects a DCS that can handle the authentication of the UE.
11\. The AUSF sends an authentication request to the selected DCS, including
the onboarding SUPI.
12\. The DCS requests authentication to the UE. In this procedure, the UE
supplies its onboarding UE certificate to the DCS. The DCS verifies the
validity of the certificate path of the supplied onboarding UE and matches its
binding PEI/MAC-address/HostID.
Editor\'s note: The authentication details to be agreed by SA WG3.
13\. Then the DCS generates a successful response to AUSF. The DCS also
provides AUSF with a list of SNPNs (PLMN ID + NID) that are able to accept the
onboarding of the UE. The DCS may also send the security information for each
SNPN.
14\. The AUSF forwards the Authentication response to AMF, including the list
of SNPNs that are able to accept the onboarding of the UE and the security
information for each SNPN. The AMF temporarily stores this information.
15\. The AMF sends an Authentication response to the UE.
16\. The AMF selects an SNPN from the list of SNPNs provided by the DCS (an
SNPN for which and Onboarding agreement exists). The AMF requests
authorization to that SNPN for proceeding with the Onboarding of the UE. For
that, the AMF contacts the PS in the SNPN.
17\. The PS receives the Onboarding SUPI from the AMF. The PS verifies that
the SUPI is entitled to proceed with the onboarding procedure.
18\. The PS, based on the type of UE (determined from the PEI), connectivity
agreement with the ON, and local policy, decides whether the provisioning of
the UE shall be done using Control Plane or User Plane procedures.
19\. The PS sends an Authorization response to the AMF, including the decision
for continuing with either Control Plane UE provisioning or User Plane UE
provisioning procedures. Then, depending on the selected UE provisioning
procedure, PS does:
a) If a Control Plane provisioning solution was chosen, PS plays the role of
UDM in current UE Parameters Update procedure, this message may also include
the data that needs to be provisioned to the UE. The UE provisioning data may
be integrity protected and signed with the private key of the PS (UDM).
b) If a user plane provision solution has been chosen, this message contains
an authorization for an onboarding PDU session as well as a list of triplets
that restrict the connectivity of the Onboarding PDU Session to just those
instances of the PS that matches any of the triplets.
Editor\'s note: It is expected that all these data to the UE needs to read are
subject to both integrity and confidentially protection. The details,
including the security details of the data, need to be agreed with SA WG3.
20\. AMF sends a NAS Security Mode Command to the UE.
Editor\'s note: It is expected that the NAS Security Mode Command procedure
specified in TS 33.501 [7] clause 6.7.2 needs to be adapted to the security
aspects of the onboarding procedure.
21\. The UE responds with a NAS Security Mode Command Complete answer.
22\. The AMF sends a Registration Accept message to the UE. This includes a
decision on whether CP UE Provisioning procedure or UP UE Provisioning
procedure should be used, as well as SNPN security information that is
selected for the onboarding of the device.
##### 6.27.3.2.2 Control Plane UE Provisioning Procedures
This clause provides details of the Control Plane UE provisioning procedure
(step D1 in Figure 6.27.3-1). The procedure is based on the UE Parameters
Update procedure specified in TS 23.502 [6] clause 4.20.
Figure 6.27.3.2.2-1: Control Plane UE Provisioning sequence flow of the
Onboarding solution
0\. It is assumed that the AMF has already received, from the Provisioning
Server, the UE Provisioning data that needs to be provisioned to the UE (see
previous clause).
1\. Once the registration is complete (i.e. the AMF has sent to the UE a
Registration Accept message), the AMF sends a DL NAS TRANSPORT message to the
UE. The AMF includes in the DL NAS TRANSPORT message the data to be
provisioned to the UE previously received from the Provisioning Server.
2\. The UE receives the DL NAS TRANSPORT message and verifies, based on
mechanisms defined in TS 33.501 [7], that the Update Data is provided by the
SNPN.
\- If the security check on the Update Data is successful, as defined in TS
33.501 [7] the UE either stores the information and uses those parameters from
that point onwards, or forwards the information to the USIM; and
\- If the security check on the Update Data fails, the UE discards the
contents of the Update Data.
Editor\'s note: It is assumed that the UE uses the SNPN security information
received from the DCS during the registration for verifying the integrity of
the data. The exact details must be confirmed by SA WG3.
3\. If the UE has verified that the Update Data is provided by SNPN and the
there was an indication for the UE to send an ack to the PS in the SNPN, the
UE sends an UL NAS TRANSPORT message to the serving AMF with a transparent
container including the UE acknowledgement.
4\. If the AMF receives an UL NAS TRANSPORT message with a transparent
container carrying a UE acknowledgement from the UE, the AMF sends an
information request message including the transparent container to the PS. PS
can use this information to activate the NPN subscription into UDM.
##### 6.27.3.2.3 Configuration PDU Session Establishment Procedures
This clause provides details of the configuration PDU session establishment
that the UE needs to establish prior to downloading the configuration data
from the Provisioning Server. The procedure is based on the PDU Session
Establishment specified in TS 23.502 [6].
The UE starts this procedure once it has been informed that User Plane UE
Provisioning procedure has been selected.
Figure 6.27.3.2.3-1: Configuration PDU Session establishment sequence flow of
the Onboarding solution
1\. The UE sends a NAS message to request the establishment of a new PDU
Session. The request PDU Session ID, Request type set to \"Configuration PDU
Session\", N1 SM container (PDU Session Establishment Request, [Port
Management Information Container]). The request need not contain a UE-
requested DNN nor S-NSSAI(s).
2\. The AMF determines that this is a request for a new \"Configuration PDU
Session\" for this UE. This type of PDU session has been already authorized by
the SNPN during the registration procedure. The AMF, therefore, authorizes the
establishment of this PDU session and selects an SMF that can handle a
Configuration PDU Session for the Requested S-NSSAIs.
3\. The AMF sends an Nsmf_PDUSession_Create_SMContext request to the selected
SMF, including the onboarding SUPI, PDU Session ID, and sets the Requested PDU
Session Type to \"Onboarding\". The AMF also includes a list of triplets (IP
address, port number, protocol) indicating the authorized list of Provisioning
Server to which the PDU Session can steer traffic to. Due to the type of
Onboarding PDU Session, the SMF need not contact a UDM in the SNPN, since
there is no subscription in UDM for an onboarding SUPI.
4\. The SMF informs the AMF with Nsmf_PDUSession_CreateSMContext Response of
the result of the Configuration PDU Session establishment.
5\. The SMF selects a UPF for the Onboarding PDU Session.
6,7.The SMF establishes the Configuration PDU session with the UPF by sending
an N4 Session Establishment Request, including enforcement and reporting rules
created upon the list of triplets of authorized Provisioning Servers.
8,9.The SMF sends to the AMF an Namf_Communication_N1N2MessageTransfer (PDU
Session ID, N2 SM Information (PDU Session ID, QFI, QoS Profile, CN Tunnel
Info, S-NSSAI, Session AMBR, PDU Session Type, User Plane Security Enforcement
information, UE integrity Protection Maximum Data Rate, RSN), N1 SM container
(PDU Session Establishment Accept ([QoS Rule(s) and QoS Flow level QoS
parameters if needed for the QoS Flow(s) associated with the QoS rule(s)],
selected SSC mode, Sâ€‘NSSAI(s), allocated IPv4 address, interface identifier,
Session-AMBR, selected PDU Session Type, [Reflective QoS Timer] (if
available)).
10\. The AMF sends to the (R)AN N2 PDU Session Request (N2 SM information, NAS
message (PDU Session ID, N1 SM container (PDU Session Establishment Accept))).
11\. (R)AN to UE: The (R)AN may issue AN specific signalling exchange with the
UE that is related with the information received from SMF.
Once this is completed, an Onboarding PDU Session is established. This allows
the UE to establish an application-level session toward the Provisioning
Server.
### 6.27.4 Impacts on services, entities, and interfaces
New network functions and main impacts:
\- Default Credential Server (DCS): It implements procedures to authenticate
the UE with the default UE credentials. It is provisioned with a list of SNPNs
that are able to accept the onboarding of the UE, as well as SNPN security
information. It provides Onboarding SUCI de-concealing functionality.
\- Provisioning Server (PS): It stores (or has access to an external storage)
the data that needs to be provisioned to the UE. It binds the Onboarding SUPI
with the NPN credentials. Authorizes the UE to proceed with the onboarding
procedure. Determination of provisioning the UE with either Control Plane or
User Plane provisioning procedures.
Main impacts on existing network functions and UE:
\- AMF: Identify Onboarding registrations and Onboarding PDU Session
establishment. Capability for selecting a proper DCS based on the onboarding
SUPI. Selection of AUSF and SMF that support onboarding procedures. Selection
of an SNPN from a list received from DCS. Request authorization from PS to
proceed with the onboarding procedure. In control plane UE provisioning,
receiving data to be provisioned and forwarding it to the UE.
\- AUSF: Selects a proper DCS based on the Onboarding SUPI.
\- UE: Capability for deriving an Onboarding SUPI from the Onboarding UE
credentials. Setting up a new type of Onboarding registration in AS and NAS.
Setting up a new type of Onboarding PDU Session. Authentication procedures
with the DCS. Support for either CP or UP provisioning procedure.
\- RAN: SIB broadcast of an indication of support for Onboarding of UEs. RRC
enhancements allowing the UE to indicate that the request is for UE onboarding
purposes and NG-RAN then can use it to select an AMF supporting UE onboarding.
NG-RAN indicating UE request was for UE onboarding to AMF.
## 6.28 Solution #28: Onboarding of NPN in a PLMN subscription (PNI-NPN) by
exposure
### 6.28.1 Introduction {#introduction-30}
This solution addresses key issue 4 \"UE Onboarding and remote provisioning\".
This solution addresses the UE Onboarding aspects to enable a PLMN
subscription to be updated to support NPN (aka PNI-NPN).
The existing architecture as per TS 23.501 [4] applies, e.g. as per the non-
roaming architecture shown in Figure 6.28.1-1 which is a copy of the Figure
4.2.3-1 in TS 23.501 [4].
Figure 6.28.1-1: 5G System architecture
In addition, to the architecture of Figure 6.28.1-1, means are available for a
3rd party e.g. NPN administrative entity to provide input to the PLMN operator
as how to update the PLMN subscription.
### 6.28.2 Functional Description
The following are assumed to enable a PNI-NPN from a PLMN subscription:
1\. The UE is provisioned with a PLMN subscription without any content related
to NPN.
2\. The PNI-NPN is realized by a specific NPN Network Slice (NPN S-NSSAI).
3\. There exist APIs enabling a 3rd party e.g. NPN administrative entity to
provide input to the PLMN operator as how to update the PLMN subscription.
Editor\'s note: It is FSS what type of APIs are used by the NPN to provision
the subscription information to the PLMN.
### 6.28.3 Procedures
Figure 6.28.3-1: High-level flow of onboarding of the UE into a PNI-NPN
The procedure includes the following steps:
A) Pre-configuration of UE and 5GC:
A1) UE is pre-configured with PLMN subscription as per current means, i.e.
without any NPN content.
A2) The NPN administrator uses APIs to enable PLMN operator to update the PLMN
subscription in the 5GC e.g. with NPN S-NSSAI, content of the NPN DN to enable
URSP rules. This includes the request of the NPN for the 5GC to trigger an
onboarding procedure for the UE with the NPN. This request includes
information of the NPN (e.g. NPN onboarding DNN for the UP based onboarding
method) relevant for the NPN onboarding procedure.
B) The UE registers to the PLMN as per current procedures e.g. using eMBB
S-NSSAI as Requested NSSAI.
C) The UE is updated with the subscription data for the NPN using existing
Rel-16 capabilities/procedures e.g. Configured NSSAI, CAG information, URSP
rules for the NPN, new SoR information.
D) The 5GC triggers the provisioning procedure with the NPN via UP or CP based
methods.
\- For the UP based method, the 5GC requests the UE to initiate the NPN
provisioning process by establishing a PDU Session to the onboarding DNN of
the NPN.
Editor\'s note: How this indication is provided to the UE (e.g. triggered by
UCU, UPU) is FFS.
\- For the CP based method, the trigger of the NPN provisioning process is
based on the request received by the NPN in step A2).
E) The NPN provisioning process is executed. This includes the provisioning to
the UE of the following information e.g.:
\- Credentials to access the NPN via NSSAA or secondary authentication.
Editor\'s note: The provisioning of NPN credentials for NSSAA or secondary
authentication is dependent on SA WG1 LS.
F) The UE issues a re-registration.
G) NSSAA or secondary authentication is done as per rel-16 procedures.
H) The UE access the NPN DN via the PNI-NPN.
### 6.28.4 Impacts on services, entities and interfaces
OSS: APIs to enable updates of the PLMN subscriptions
NPN: Support provisioning of NPN credentials to the UE
5GC: Trigger PNI-NPN provisioning (see step C) and support of NPN provisioning
(see step D)
NG-RAN: None
## 6.29 Solution #29: Key Issue #4: Discovery of the Onboarding Network
### 6.29.1 Introduction {#introduction-31}
This solution focuses on the following aspects of Key Issue #4, \"UE
Onboarding and remote provisioning\":
\- How does the UE discover and select the NPN before UE subscription is
provisioned.
\- A TE might not have an interface that can be used to provision the MT.
The main idea of the solution is that the UE is provisioned with some _default
UE credentials, a default device Identifier,_ and a _temporary Network
Identifier/Network readable name for Onboarding_. The _default UE credentials,
default device Identifier,_ and the _temporary Network Identifier/Network
readable name for Onboarding_ can be assigned by the manufacturer. The UE may
be configured with this information before the Onboarding Network is known
(e.g. at manufacturing).
Before the UE needs to be onboarded (e.g. before it is turned on for the first
time), the Onboarding Network is configured to begin broadcasting the
_temporary Network Identifier/Network readable name for Onboarding_ that is
provisioned in the UE. When the UE turns on (or reset, etc.), it discovers the
Onboarding Network that is broadcasting the expected _temporary Network
Identifier/Network readable name for Onboarding_ value. The UE may then use
other Key Issue #4 solutions to obtain subscription/credentials.
### 6.29.2 Functional Description
The principle behind the solution is that the UE is provisioned with some
_default UE credentials,_ a _default device identifier,_ and a _temporary
Network Identifier/Network readable name for Onboarding_. In a scenario where
the TE does not have an interface that can be used to provision the MT, this
information could be provisioned during the manufacturing process and provided
to the customer at the time of purchase (e.g. on or within the product box).
Before onboarding is performed, the SO (Subscription Owner) selects what
O-SNPN will be used to onboard the UE and provides the O-SPNP with a
_temporary Network Identifier/Network readable name for Onboarding. The UE
will then select the O-SNPN that is broadcasting the temporary Network
Identifier/Network readable name for Onboarding._
Before the UE is made to begin the process of onboarding network discovery
(e.g. before it is turned on for the first time), the onboarding network is
configured based on the provisioned parameters (e.g. via OAM). The RAN is
configured to broadcast the _temporary Network Identifier/Network readable
name for Onboarding_ that the UE will attempt to discover. Furthermore, the
onboarding network can also be provided with time window and area parameters.
The time window and area parameters indicate the time window and the area
where the UE is expected to be onboarded. The Onboarding Network can use the
information that was provided to determine when and where to broadcast the
_temporary Network Identifier/Network readable name for Onboarding_ that the
UE will attempt to discover. For example, this configuration operation may be
performed by a person that is physically located at a location where the
person has access to platform that enables configuration or it can be
performed remotely by a technician in the field who uses a smart phone to
access the configuration platform before initiating onboarding (e.g. the
technician obtains the _temporary Network Identifier for Onboarding from the
packaging of a new device, uses an application on a smart phone to request
that the RAN broadcast the temporary Network Identifier for Onboarding and
then turns the device on for the first time)_.
NOTE 1: How the onboarding network is configured based on the provisioned
parameters needs to be coordinated with RAN WGs (e.g. whether OAM is used).
The _temporary Network Identifier/Network readable name for Onboarding_ does
not always need to be broadcasted by the RAN. Rather it only needs to be
broadcasted in a time window and in an area where device onboarding
operations(s) are expected. If the network is relatively large, then the area
parameters can be used to limit the area where the _temporary Network
Identifier/Network readable name for Onboarding_ needs to be broadcasted _.
For example, when an SO selects an O-SNPN to onboard its device(s), the SO
provides the time_ window and area parameters to the O-SNPN. The SO provides
the area parameters to the O-SNPN if the SO knows the area where the UE is
expected to be located when the UE attempts onboarding (i.e. where the UE will
be when it is turned on for the first time). The O-SNPN may use the area
information to limit the number of cells that broadcast the _temporary Network
Identifier/Network readable name for Onboarding._
The benefit of the _temporary Network Identifier/Network readable name for
Onboarding is that, compared to a network that only broadcasts a single
\"Onboarding Supported\" indication, it minimizes the chances that a UE will
attempt to onboard with the wrong network and that a UE will be tricked to
attempt to onboard with a rouge network that broadcasts a single \"Onboarding
Supported\" indication._
NOTE 2: The exact format of the _temporary Network Identifier/Network readable
name for Onboarding_ will be determined by RAN WG2.
NOTE 3: The temporary Network Identifier/Network readable name for Onboarding
could be equal to the default device identifier. In other words, when in the
time window, the RAN could broadcast the identity of the device(s) that it is
willing to onboard. This may be desirable in order to minimize the likelihood
that the UE will attempt to onboard with the wrong O-SNPN.
NOTE 4: Should UEs that have already been onboarded need to be reset (e.g.
returned to their default factory state some weeks or months after its first
time use), the SO will need to select an O-SNPN and onboard the device again.
This is also necessary if the UE needs to be onboarded again after expiry of
the time window (e.g. if the UE did not attempt onboarding within the time
window).
### 6.29.3 Procedures
Figure 6.29.3-1 illustrates the procedure. The Onboarding SNPN (O-SNPN) that
is used by the UE in the onboarding process is not necessarily the same as the
SNPN for which network credentials will be provisioned in the UE.
Figure 6.29.3-1: Discovery of the Onboarding Network
1\. _default UE credentials, a default device identifier,_ and a _temporary
Network Identifier/Network readable name for Onboarding_ are provisioned in
the UE(s) as described in clause 6.29.2.
2\. The network is provisioned and configured to broadcast the _temporary
Network Identifier/Network readable name for Onboarding(s) in a time window
and in an area. The onboarding network starts to broadcast the temporary
Network Identifier/Network readable name for Onboarding(s)._
3\. The UE(s) are made to begin the process of onboarding network discovery
(e.g. they are turned on for the first time, reset, etc.).
4\. The UE begins the process by searching for a network that is broadcasting
the same _temporary Network Identifier/Network readable name for Onboarding_
that is provisioned on the UE.
NOTE 1: Whether the _temporary Network Identifier/Network readable name for
Onboarding(s)_ are always broadcasted in the time window or are broadcasted
on-demand will be determined by RAN WGs.
NOTE 2: How many _temporary Network Identifier/Network readable name for
Onboarding(s)_ can be simultaneously transmitted will be determined by RAN
WGs.
5\. Other Key Issue #4 solutions (e.g. Solution #5 or Solution #6) are used to
complete the onboarding process. For example:
This solution can be integrated with Solution #5 as follows.
\- The pre-configuration step (step A) of clause 6.5.3 can be updated to
include steps 1-2 above.
\- The initial access step (step B) of clause 6.5.3 can be updated to include
step 3-4 above. In other words, the \"broadcasted information\" in step B of
clause 6.3.5 is the _temporary Network Identifier/Network readable name for
Onboarding._
This solution can be integrated with Solution #6 as follows.
\- The pre-configuration step (step A) of clause 6.6.3.1 can be updated to
include steps 1-2 above.
\- The initial access step (step B) of clause 6.6.3.1 can be updated to
include step 3-4 above. In other words, the UE selects an access network as
described in step 3-4 above.
### 6.29.4 Impacts on services, entities and interfaces
NG-RAN:
\- Is configured to enable the broadcast (i.e. new SIB) of a _temporary
Network Identifier/Network readable name for Onboarding_ in a given time
window and location within the network.
\- Broadcasts the _temporary Network Identifier/Network readable name for
Onboarding_ that was provided.
UE:
\- Support for being configured with _default UE credentials, a default device
identifier,_ and a _temporary Network Identifier/Network readable name for
Onboarding_.
\- Reading and processing the _temporary Network Identifier/Network readable
name for Onboarding_ broadcasted from NG-RAN during O-SNPN discovery.
## 6.30 Solution #30: UE Onboarding via Control Plane
### 6.30.1 Introduction {#introduction-32}
This solution addresses key issue 4 \"UE Onboarding and remote provisioning\".
Especially when the UEs are deployed without provisioned subscription, it
provides a solution on how UE subscription/credentials are afterward
provisioned to the UEs.
The solution enables UEs to get network connectivity to an SNPN (\"onboarding
SNPN\"; O-SNPN) based on e.g. the pre-provisioned default UE credentials, and
invoking the UE Parameters Update procedure for the purpose of remote
provisioning the UE with Subscription Credentials and Configuration data for
enabling regular access to the SNPN that will own the UE\'s subscription
(\"SNPN owning the subscription\"; SO-SNPN).
### 6.30.2 Functional Description
Figure 6.30.2-1 illustrates the architecture of the Control Plane-based
onboarding solution. The solution assumes the presence of a Default Credential
Server (DCS), which is able to authenticate and authorize the UE to proceed
with the onboarding procedure, based on the default UE credentials.
We assume that the DCS has trust with the O-SNPN and the Provisioning Server,
that the Provisioning Server has trust with the SO-SNPN and the O-SNPN, and
that the O-SNPN has trust with the SO-SNPN.
Figure 6.30.2-1: Control Plane-Based Onboarding architecture
Editor\'s note: It is FFS whether the AMF in the SNPN communicates with the
DCS directly or via the AUSF (TBD1 reference point).
### 6.30.3 Procedures
##### 6.30.3.1 General
Figure 6.30.3-1 provides an overall view of the Control Plane-based solution
for onboarding and configuring UEs.
Figure 6.30.3-1: Overview of the Control Plane-based Onboarding procedure
A: UE pre-configuration: the provision of default UE credentials that allow
for successful UE authentication (step B1).
Editor\'s note: The default UE credential need to be defined by SA WG3.
A1) The provisioning server subscribes to either AMF or UDM on the event that
UE registers without subscription credentials to the O-SNPN.
NOTE 1: we may assume that PS know where the UEs will be deployed(i.e.
candidate O-SNPNs are known to the PS)
B: Initial access/registration: In this step, the UE identifies that it has no
subscription to access an SNPN. The UE either manually or automatically (if
the UE is configured with initial access data) discovers and selects the
O-SNPN based on the broadcasted information. The UE registers to it for
onboarding services indicating that the registration is regardless of UE
subscription, and during the registration procedure UE provides to the network
some device-specific information e.g. its PEI and its default UE credentials
in place of UE subscription-related info e.g. SUPI, and the User may also
provide the UE with additional information, such as an application identifier
and/or Service Provider Identifier, which is used to discover DCS in the Step
B1).
B1) The network authenticates the UE with the DCS and/or verify whether the UE
is allowed to access the network for onboarding purposes. This authentication
can be performed as either primary authentication or, if primary
authentication is skipped, as Network Slice Specific Authentication and
Authorisation (NSSAA).
NOTE 2: Whether both options (i.e. primary authentication, and NSSAA) are
needed is to be determined by SA WG3. Note that the use of NSSAA in this
solution is different from current specifications where the primary
authentication is a pre-requisite for the NSSAA.
Editor\'s note: How UE selects cell for provisioning e.g. based on what
information in SIB is FFS.
Editor\'s note: Authorization and authentication for Initial Access is FFS.
NOTE 3: Step B (including B1) is same as the UP-based solutions (e.g. Step B
of the clause 6.5.3).
C: Control Plane UE provisioning procedure: During the step C1 and C2, the
corresponding Subscription Credentials and Configuration data are retrieved
from the provisioning server and provisioned to the UE. And, its PEI or
certificate ID of default UE credentials is used to identify subscription
credentials that need to be provisioned to the UE.
C1) The Provisioning Server provides the subscription credentials for the SNPN
owning the subscription, and may retrieves other Configuration data (e.g. PDU
session parameters, such as S-NSSAI, DNN, URSPs, QoS rules, and other required
parameters to access the SNPN with subscription credentials).
C2) On the UE registering without subscription/credentials to the O-SNPN, the
Provisioning Server is notified the event from either AMF or UDM and then
provides the UDM with the corresponding Subscription Credentials and
Configuration data, which is to be provisioned to the UE.
D: Once the Control Plane UE provisioning procedure is completed, the UE de-
registers from the O-SNPN.
E: The UE performs regular registration procedure to the SO-SNPN with the
provisioned subscription credentials.
##### 6.30.3.2 Initial Access/Registration procedure
This clause provides details of the initial access of the UE (step A1, B and
C2 in Figure 6.6.3-1). The procedure is based on the initial registration of
the UE specified in TS 23.502 [6]. Figure 6.6.3.2-1 provides the sequence flow
of the initial access/registration and event subscription/notification for
onboarding.
Editor\'s note: It is FFS whether UDM or another NF is used as per the
procedure below.
Figure 6.30.3.2-1: Initial access/registration sequence flow for Onboarding
0\. The Provisioning server may subscribe either UDM(0a) or AMF(0b) in the
onboarding network on the event of UE registration without subscription
credentials.
1\. The UE receives a trigger to initiate the onboarding procedure. This
trigger may be manual, e.g. provoked by a user, or can be automatically
provoked, e.g. due to the UE starting and having no subscription credentials.
2\. The UE selects a network to connect for onboarding. This network selection
can be manual, if a user selects a network from a list of available networks
broadcasting special information for onboarding, e.g. indicating that
onboarding is supported, or automatic, e.g. if the UE is provisioned with a
list of PLMN IDs and NIDs to connect for onboarding.
3\. The UE sends a Registration Request to the AMF including AN parameters and
onboarding indication (i.e. Registration type set to \"onboarding\"), and PEI
or certificate ID of default UE credentials. The Registration type indicates
that the UE wants registration without subscription credentials to perform
onboarding.
4\. The (R)AN selects an onboarding-dedicated AMF.
5\. The AMF receives an N2 message (N2 parameters, Registration Request as per
step 3). When NG-RAN is used, the N2 parameters include the PLMN ID and the
NID, Location information and Cell Identity related to the cell in which the
UE is camping, UE Context Request which indicates that a UE context including
security information needs to be setup at the NG-RAN.
6,7,8. The AMF selects an AUSF and sends an Authentication request for UE
authentication with DCS to it. The DCS authenticates the UE each other, based
on the default UE credentials.
Editor\'s note: The exact details of authentication and authorization is FFS
and must be agreed with SA WG3.
9,10. The AMF and the UE may initiate a NAS Security Mode Command procedure
after successful authentication, according to TS 33.501 [7].
Editor\'s note: The exact details of NAS Security Mode Command procedure must
be agreed with SA WG3.
11,12. The AMF may notify the UE registration for onboarding to the default
UDM, to which the provisioning server subscribes the event \"UE registration
for onboarding\". If the event subscription is done for the AMF, step 11&12
are skipped.
13,14. The AMF may fetch from the default UDM, if it has, the onboarding-
dedicated configuration data. If the onboarding-dedicated configuration data
is pre-configured in the AMF, step 13&14 are skipped.
15\. The AMF sends to the UE a Registration accept message, including
Registration area, and other relevant information.
##### 6.30.3.3 UE Provisioning procedure via control plane
This clause provides details of the UE provisioning procedure via control
plane (step C including C2 in Figure 6.30.3-1).
Figure 6.30.3.3-1: UE Provisioning procedure for onboarding via control plane
0\. As described in the Figure 6.30.3.2-1, UE registers for onboarding
successfully to the O-SNPN.
1\. Per the event subscription at step 0 in the Figure 6.30.3.2-1 the UE
registration for onboarding is notified to the provisioning server. PEI or
certificate ID of default UE credentials is used to identify the corresponding
data to be provisioned to the UE(i.e. Subscription Credentials & Configuration
data).
1a. (in case of 0a in the Figure 6.30.3.2-1) the default UDM notifies the UE
registration of the provisioning server.
1b. (in case of 0b in the Figure 6.30.3.2-1) the AMF notifies the UE
registration of the provisioning server.
If the event subscription at step 0 in the Figure 6.30.3.2-1 is skipped, the
AMF/ the default UDM requests the provisioning data to the pre-configured
provisioning server, which is identified by PEI or certificate ID of default
UE credentials.
2\. On receiving the notification, the Provisioning server provides the
corresponding Subscription Credentials & Configuration data. In case of 1b,
the serving AMF info is also provided together.
3\. The UDM provide the Subscription Credentials & Configuration data received
from the provisioning server with the AMF as the UE Parameters Update
procedure specified in TS 23.502 [6] clause 4.20.
4\. The AMF sends a DL NAS TRANSPORT message to the UE. The AMF includes in
the DL NAS TRANSPORT message the Subscription Credentials & Configuration data
received from the UDM.
5\. The UE receives the DL NAS TRANSPORT message and verifies, based on
mechanisms defined in TS 33.501 [7], that the Subscription Credentials &
Configuration data is provided from the provisioning server.
\- If the security check on the Subscription Credentials & Configuration data
fails, the UE discards the contents of the Subscription Credentials &
Configuration data.
6\. If the UE has verified that the Subscription Credentials & Configuration
data is provided and the UDM has requested the UE to send an Ack to the UDM,
the UE sends an UL NAS TRANSPORT message to the serving AMF with a transparent
container including the UE acknowledgement.
7,8. If the AMF receives an UL NAS TRANSPORT message with a transparent
container carrying a UE acknowledgement from the UE, the AMF sends a
Nudm_SDM_Info request message including the transparent container to the UDM.
And, the acknowledgement is delivered to the Provisioning server.
### 6.30.4 Impacts on services, entities and interfaces
UE:
\- Supports being pre-configured with Default UE credentials for successful UE
authentication.
\- Manually or automatically (if the UE is provisioned with a list of PLMN IDs
and NIDs to connect for onboarding) discovers and selects the O-SNPN based on
the broadcasted information.
\- Supports Registration procedure for onboarding and provisioning.
NG-RAN:
\- Broadcast special information for onboarding, e.g. indicating that
onboarding is supported.
\- Selects an onboarding-dedicated AMF.
AMF:
\- Supports onboarding-dedicated configuration data locally or from UDM.
\- Supports Registration procedure for onboarding and provisioning from a PS.
\- Supports the subscription/notification for event \"UE registration for
onboarding\" towards PS or UDM.
UDM:
\- Supports CP-based provisioning as described above.
\- Supports onboarding-dedicated configuration data.
\- Supports the subscription/notification for event \"UE registration for
onboarding\" towards PS or AMF.
AUSF:
\- Supports authentication and authorization towards DCS.
DCS:
\- Supports authentication and authorization from ON.
PS:
\- Supports CP-based provisioning as described above.
\- Supports the subscription/notification for event \"UE registration for
onboarding\" towards AMF or UDM.
## 6.31 Solution #31: UE onboarding and provisioning for SNPN subscription
### 6.31.1 Introduction {#introduction-33}
This solution addresses the key issue #4: UE onboarding and remote
provisioning, in particular for UE\'s subscription to standalone non-public
networks. This solution allows the UEs without subscription to the desired
SNPN to temporarily register to a 5G network that supports UE onboarding and
to establish a restricted PDU Session for reception of a newly assigned
subscription for the desired SNPN from the network entity for provisioning.
This solution applies for the cases where SNPN is deployed to support
**audio/video applications (includes television and radio studios, live news-
gathering, sports events, music festivals, medical operating, lecture hall,
press center, trade fair, company/TV evening) for Programme Making and Special
Events (PMSE) equipment, which has no user interfaces (** screens and
keyboards**) or physical ports (** network ports, USB ports, and card
slots**), such as** microphones, speakers, headphones, cameras, recorders,
mixers, consoles**. The PMSE equipment can only be provisioned/updated during
UE onboarding at the onboarding 5G Network.**
**This solution assumes the AAA Server as defined in clause 6.4 acts as the
Provisioning Server and provisions the UE with** a newly assigned subscription
(non-3GPP identities e.g. non-IMSI and credentials) for the desired SNPN.
\- If the onboarding 5G network is PLMN or PNI-NPN, it is assumed the UE
already has a subscription and credentials to the PLMN for the UE to be
\"uniquely identifiable and verifiably secure\" during onboarding and remote
provisioning.
\- If the onboarding 5G network is SNPN, it is assumed the UE already has the
default UE credentials e.g. provided at manufacture, for the UE to be
\"uniquely identifiable and verifiably secure\" during onboarding and remote
provisioning.
### 6.31.2 Functional Description
#### 6.31.2.1 Architecture and Concept
Figure 6.31.2.1-1: Architecture in case network entity for provisioning is
deployed by the SNPN Operator or the Vertical, onboarding 5G network is SNPN
Figure 6.31.2.1-1: Architecture in case network entity for provisioning is
deployed by the SNPN Operator or the Vertical, onboarding 5G network is PLMN
or PNI-NPN
NOTE 1: The Desired SNPN can also be the onboarding SNPN.
Onboarding 5G network: 5G network that supports UE onboarding and remote
provisioning for UE subscription of desired SNPN.
Provisioning Server: network entity for provisioning, it is responsible to
provision the desired SNPN subscription to the UE. It is owned by the
Subscription Owner.
**Subscription Owner (SO)** : refer to **clause 6.4.**
**AAA Proxy (** AAA-P): refer to **clause 6.4**.
**AAA-Server (** AAA-S): refer to **clause 6.4**.
**SO-ID:** refer to **clause 6.4**.
External Subscription (E-Sub): refer to **clause 6.4. Additionally, this is
allowed to be** provisioned to the UE from Provisioning Server in this
solution.
Internal Subscription (I-Sub): it is the credential/identity stored at UDM of
the onboarding 5G. It is PLMN identities and credentials. I-Sub is used to
authenticate and authorize the UE for access to the onboarding 5G that
provides connectivity to Provisioning Server. I-Sub is provisioned to a UE
before E-Sub provisioning, e.g. at manufacture. This is used only when the
onboarding 5G network is PLMN or PNI-NPN.
#### 6.31.2.2 Onboarding for E-Sub provisioning in case onboarding 5G is PLMN
or PNI-NPN
This clause applies when a UE already has a subscription and credentials to
the PLMN in case of PNI-NPN; I-Sub refers to subscription and credentials to
the PLMN for the UE to be \"uniquely identifiable and verifiably secure\" in
this case.
It works as following:
\- UE and the onboarding 5G network(PLMN) supports the I-Sub;
\- UE discovers and selects the onboarding 5G network using the I-Sub;
\- Based on I-Sub the onboarding 5G network provides the temporary
registration for limited service and a PDU Session to the UE for the purpose
of performing remote provisioning;
\- Over that PDU Session, the AAA-S provisions a newly assigned E-Sub to the
UE;
\- After UE obtained the E-Sub, the UE may de-register from the onboarding 5G
network, then discover and select the desired SNPN to request access using
E-Sub as defined in Solution #4: External Authentication and Authorization,
clause 6.4.
If the onboarding 5G network belongs to the PNI-NPN, than the UE may also have
CAG information for network and cell (re-)selection as defined in clause
5.30.3.4 of TS 23.501 [4].
If the onboarding 5G network belongs to the PLMN, than the UE may also have
information for network selection as defined in clause 5.2.2 of TS 23.501 [4].
#### 6.31.2.3 Onboarding for E-Sub provisioning in case onboarding 5G is SNPN
This clause applies when the UE without any subscriptions and credentials to
the onboarding 5G network (SNPN) may have default UE credentials provided e.g.
at manufacture. The default UE credentials are for the UE to be \"uniquely
identifiable and verifiably secure\", which are further used to authenticate
and authorize the UE that is permitted for onboarding and remote provisioning.
It works as following:
\- UE is provisioned with default configuration at manufacture, the default
configuration is used for onboarding 5G network (SNPN) discovery and
selection; the default configuration contains the following information for
each available onboarding SNPN:
\- PLMN ID+NID; and
\- Priority; and optionally
\- Subscribed SO ID
\- Onboarding SNPN broadcasts the following information:
\- PLMN ID+NID; and
\- support of UE onboarding, and optionally
\- Supported SO-ID list;
\- UE discovers and selects the onboarding SNPN based on default configuration
and the broadcast information; when the UE receives the broadcast that
supports the UE onboarding, the UE in order of the priority in network
configuration checks the first Onboarding SNPN that is supported in the
broadcast, i.e. the PLMN ID+NID of the Onboarding SNPN is equal to the PLMN
ID+NID received in broadcast, and the Subscribed SO ID of the Onboarding SNPN
is present in the Supported SO-ID list received in broadcast.
\- Based on local policy the onboarding SNPN provides the temporary
registration for limited service and a PDU Session to the UE for the purpose
of performing remote provisioning;
\- Over that PDU Session, the AAA-S provisions a newly assigned E-Sub to the
UE who is authenticated and authorized using the default UE credentials
provided e.g. at manufacture;
\- After UE obtained the E-Sub, the UE may de-register from the onboarding
SNPN, and then select the desired SNPN (which may also be the onboarding SNPN)
to request access using E-Sub as defined in Solution #4: External
Authentication and Authorization, clause 6.4.
### 6.31.3 Procedures
#### 6.31.3.0 General
For E-Sub provisioning in case onboarding 5G is PLMN or PNI-NPN, refer to
clause 6.31.3.1. In this case, UE selects and registers to the onboarding PLMN
(in case of PNI-NPN) using the I-Sub (subscription and credentials to the
onboarding PLMN for the UE to be \"uniquely identifiable and verifiably
secure\").
For E-Sub provisioning in case onboarding 5G is SNPN, refer to clause
6.31.3.2. In this case, UE selects and registers to the onboarding SNPN using
broadcast system information and default configuration (including default UE
credentials for the UE to be \"uniquely identifiable and verifiably secure\").
In both cases, the onboarding 5G network allows the UE to temporarily register
for limited service and setup a restricted PDU Session for the purpose of
performing remote provisioning. The UE initiates the de-registration at
onboarding 5G network after finishing the E-Sub provisioning or the onboarding
5G network initiates the de-registration, e.g. when the time is up.
#### 6.31.3.1 E-Sub provisioning in case onboarding 5G is PLMN or PNI-NPN
For E-Sub provisioning in case onboarding 5G is PLMN or PNI-NPN, refer to
figure 6.31.3.1-1.
Figure 6.31.3.1-1: E-Sub provisioning in case onboarding 5G is PLMN or PNI-NPN
1\. Steps 1-14a in clause 4.2.2.2.2 of TS 23.502 [6] are performed with the
following changes:
In Step 1, sends a Registration Request.
In Step 2, the RAN selects an AMF.
2\. AMF retrieves the PLMN subscription data from UDM using Nudm_SDM_Get
service operation. The PLMN subscription includes the indication and period
for temporary registration, as well as other restriction information, e.g. SMF
selection subscription data, number of PDU Session, subscribed DNN, S-NSSAI.
3\. AMF starts the temporary registration based on UE\'s request and I-Sub
data.
4\. Steps 14c-25 in clause 4.2.2.2.2 of TS 23.502 [6] are performed.
5\. Steps 1-21 in clause 4.3.2.2.1 of TS 23.502 [6] are performed with the
following changes:
In Step 2, the AMF validates UE request and selects the SMF that supports UE
onboarding based on I-Sub data.
In Step 4, the SMF retrieves the PLMN subscription\'s SM data from UDM using
Nudm_SDM_Get service operation. The PLMN subscription SM data may include the
restriction information of the PDU Session for the purpose of performing
remote provisioning, e.g. port ID, valid period, allowed destination address
list and QoS information. This restriction information is used by the SMF to
set the N4 rules in the UPF, QoS rules at the UE and QoS profile at RAN.
6\. E-Sub is provisioned to the UE over the restricted PDU Session.
NOTE: The details of this E-Sub Provisioning procedure are outside the scope
of the present document.
7\. When UE completes the E-Sub provisioning, UE triggers the UE-initiated de-
registration in clause 4.2.2.3.2 of TS 23.502 [6]. Otherwise when the
temporary registration is invalid, i.e. the valid period expires, the AMF
triggers the network-initiated de-registration.
#### 6.31.3.2 E-Sub provisioning in case onboarding 5G is SNPN
For E-Sub provisioning in case onboarding 5G is SNPN, refer to figure
6.31.3.2-1.
Figure 6.31.3.2-1: E-Sub provisioning in case onboarding 5G is SNPN
1\. Steps 1-8 in clause 4.2.2.2.2 of TS 23.502 [6] are performed with the
following changes:
In Step 1, the UE includes the support for UE onboarding in the AN message and
Registration Request.
In Step 2, the RAN selects an AMF that supports for UE onboarding.
In Step 8, the AMF decides to trigger authentication/security between UE and
DCS based on UE request and local policy, the AMF may ask the UE to start EAA
procedure, and then selects an AAA-P that supports for exchange of
authentication signalling between UE and DCS.
2\. AMF performs the authentication between UE and DCS using the default UE
credentials provided e.g. at manufacture. This can refer to **clause 6.4,
where** the **DCS acts as AAA-S; the DCS uses the default** UE **credentials
to authenticate/authorize the UE\'s access to the onboarding SNPN, and grants
the UE with rights** for remote provisioning of newly assigned SNPN
subscription.
3\. AMF starts the temporary registration based on local configuration. The
local configuration includes the period for temporary registration, as well as
other restriction information, e.g. SMF selection subscription data, number of
PDU Session, subscribed DNN, S-NSSAI.
4\. Steps 21-22 in clause 4.2.2.2.2 of TS 23.502 [6] are performed.
5\. Steps 1-21 in clause 4.3.2.2.1 of TS 23.502 [6] are performed with the
following changes:
In Step 2, the AMF validates UE request and selects the SMF that supports UE
onboarding based on local configuration.
In Step 4, the SMF obtains the local configuration instead of retrieving the
subscription data from UDM. The local configuration includes the restriction
information of the PDU Session for the purpose of performing remote
provisioning, e.g. port ID, valid period, allowed destination address list and
QoS information. This restriction information is used by the SMF to set the N4
rules in the UPF, QoS rules at the UE and QoS profile at RAN.
6\. E-Sub is provisioned to the UE over the restricted PDU Session.
NOTE: The details of this E-Sub Provisioning procedure are outside the scope
of the present document.
7\. When UE completes the E-Sub provisioning, UE triggers the UE-initiated de-
registration in clause 4.2.2.3.2 of TS 23.502 [6]. Otherwise when the
temporary registration is invalid, i.e. the valid period expires, the AMF
triggers the network-initiated de-registration.
### 6.31.4 Impacts on services, entities and interfaces
In the case of onboarding 5G network is SNPN, the solution has the following
impacts:
**Impacts on UE:**
Provisions with the default UE credentials owned by the DCS, as well as the
corresponding default configuration for discovery and selection of the
available Onboarding SNPN that connects to the DCS.
Selects the Onboarding SNPN based on network configuration and the received
broadcast information.
**Impacts on RAN:**
Broadcasts the support for UE Onboarding and the supported SO-ID list.
Selects the AMF that supports for UE Onboarding based on UE\'s UE Onboarding
indication.
**Impacts on AMF:**
Triggers the authentication/authorization between UE and DCS or PS (AAA-S).
Determines the \"onboarding\" registration based on UE indication that support
for UE Onboarding, local configuration.
Triggers the network-initiated de-registration when the \"onboarding\"
registration is invalid, e.g. the time is up.
**Impacts on SMF:**
Establishes a PDU Session for the purpose of performing remote provisioning to
the UE with the assistance with local configuration.
**AAA-P:**
Addresses the DCS or PS (AAA-S) with UE Identity.
Interacts with the DCS/PS to obtain the authentication/authorization results
and UE subscription.
Relays EAA messages towards AAA-S and performs related protocol conversion.
In the case of onboarding 5G network is PLMN or PNI-NPN, the solution has the
following impacts:
**Impacts on UDM:**
PLMN Subscription needs to support an indication and period for temporary
registration.
**Impacts on AMF:**
Determines the \"onboarding\" registration based on PLMN subscription data.
Triggers the network-initiated de-registration when the \"onboarding\"
registration is invalid, e.g. the time is up.
## 6.32 Solution #32: UE onboarding for PNI-NPN with Provisioning Server
integrated in PLMN
### 6.32.1 Introduction {#introduction-34}
This solution addresses key issue #4 \"UE Onboarding and remote
provisioning\". This solution only applies to PNI-NPN.
The assumptions of the UE onboarding and remote provisioning for this solution
are as follows:
\- The credential for registration to PLMN and default S-NSSAI for PNI-NPN can
be used as default UE credential before onboarding procedure, and is pre-
configured on UE (UICC) by existing mechanism.
\- The remaining UE requirement for accessing the PNI-NPN is to obtain (or be
provisioned with) credentials for NSSAA or secondary authentication when
required.
\- On the network side, the credentials for NSSAA or secondary authentication
can be provisioned in advance and securely stored in PLMN 5GC or an separate
entity who allows 5GC to retrieve credentials, e g. PLMN operator can provide
a platform to PNI-NPN owner to create credentials for their users and store
them in PLMN 5GC.
The architecture of this solution is shown in figure 6.32.1-1. The
architecture of PLMN 5GS is as specified in TS 23.501 [4].
The vertical network includes AAA server, vertical AS and PNI-NPN provisioning
platform entity which generates and optionally stores credentials for NSSAA or
secondary authentication.
The security mechanisms of steering of roaming mechanism as specified in TS
33.501 [7] are used for credentials protection between UE and 5GC. The
existing domain security mechanisms as specified in TS 33.210 [21] and TS
33.310 [35] are used between 5GC and PNI-NPN provisioning platform to protect
the credentials.
The PNI-NPN provisioning platform is responsible for provisioning NPN
credential combined with S-NSSAI/DNN to UDM, and/or notifying UDM that NPN
credential for particular S-NSSAI/DNN has changed and then UDM could fetch NPN
credential from PNI-NPN provisioning platform when UE is registered in PLMN.
PNI-NPN provisioning platform connects UDM via NEF.
Figure 6.32.1-1 Solution architecture
### 6.32.2 Functional Description
Before the UE onboarding procedure, the user using the UE has been subscribed
to the PLMN by demand of PNI-NPN owner and a USIM is provisioned with
credentials for this PLMN.
If there is need for NSSAA or secondary authentication, PNI-NPN owner creates
corresponding credential for the UE via PNI-NPN provisioning platform. This
might involve a check by the PNI-NPN provisioning platform with the device
manufacturer or its database for e.g. about validity of the device. The
credential is stored in UDM as part of subscription data or in the platform
and is combined with the S-NSSAI/DNN for the PNI-NPN.
NOTE: The check can also be done by operator and the procedure between the
PNI-NPN provisioning platform and the device manufacturer is out of 3GPP
scope.
When the UE inserts the USIM and is switched on, the UE performs PLMN
selection and registration as per TS 23.122 [5] and TS 23.502 [6]. Since there
is no configuration on UE, i.e. no S-NSSAI is provided, the PLMN network
selects the correct slice based on subscription for the UE using existing
mechanisms. During the registration procedure, UE will obtain the NPN
credential from UDM. The solution provides two alternatives to store the NPN
credential. Namely, alt1: the UICC store the NPN credential and alt2: the ME
store the NPN credential.
For alt 1, if NPN credential is stored in ME after remote provisioning
procedure, during the registration procedure, the UDM checks if the PEI of the
UE included in registration request is same with the one saved in the UDM. If
there is no PEI saved, or the PEI of the UE is not same with the saved PEI
(e.g. the user get a new mobile phone with UICC unchanged), the UDM includes
credentials for NSSAA or secondary authentication when sending UE subscription
data to the AMF. The UDM may request provisioning platform for the credentials
if they are not stored in the UDM. The UDM saves the PEI of the UE afterwards.
If the PEI of UE is the same with the PEI stored in UDM and the UDM confirm
the \"NPN credential changed\" indication(s) of the UE is set, UDM provides UE
with credentials for S-NSSAI(s)/DNN(s) according to \"NPN credential changed\"
indication(s).
If the registration is successful, or the UE is authenticated successfully by
PLMN, but to the S-NSSAIs that require NSSAA are put in pending state, the AMF
includes all credentials for all S-NSSAIs or DNNs requiring NSSAA or secondary
authentication to the UE in Registration Accept message.
UDM sets \"NPN credential changed\" indication(s) associated with
S-NSSAI(s)/DNN(s) if the credentials stored in UDM change or the credentials
stored in PNI-NPN provisioning platform change and UDM receives the
notification from PNI-NPN provisioning platform.
For alt 2, if the NPN credential is stored in UICC after remote provisioning
procedure, the UDM check whether there exists \"NPN credential changed\"
indication(s) in UDM for this UE. If so, UDM provides UE with credentials for
S-NSSAI(s)/DNN(s) according to \"NPN credential changed\" indication(s). The
credentials are included in Registration Accept message or are updated to UE
by using UPU procedure. The UDM clears the \"NPN credential changed\"
indication if receives the acknowledgement from UE that the corresponding
credential has been successfully provisioned or updated.
After successful registration on PLMN, the AMF may initiate DL NAS TRANSPORT
to the UE with other UE Parameters Provisioning accordingly as specified in TS
23.502 [6].
### 6.32.3 Procedures
Figure 6.32.3-1 Solution procedure
0\. The PNI-NPN user is subscribed to the PLMN by demand of PNI-NPN owner by
means that are out of 3GPP scope. A USIM is provisioned with credential for
this PLMN.
1\. PNI-NPN owner creates corresponding credential for the UE via PNI-NPN
provisioning platform and combines the credential with the S-NSSAI/DNN for the
PNI-NPN.
2\. PNI-NPN provisioning platform may store the credential locally or send the
credential to UDM for storage. If the credential is sent to UDM, it is stored
as part of UE subscription data. The UDM sets \"NPN credential changed\"
indication associated with corresponding S-NSSAI/DNN for the UE. If the
credential is stored in PNI-NPN provisioning platform, the UDM sets \"NPN
credential changed\" indication associated with corresponding S-NSSAI/DNN for
the UE when the PNI-NPN provisioning platform notifies UDM that the credential
for S-NSSAI/DNN has changed.
3\. The user inserts USIM in the UE and switches on the UE.
4\. The UE selects the PLMN supporting the PNI-NPN automatically or manually
as specified in TS 23.122 [5], e.g. based on PLMN ID or CAG ID broadcasted by
gNB.
5\. The UE initiates a normal registration procedure to the selected PLMN, and
is authenticated with the provisioned PLMN credential. The PLMN network
selects the correct slice based on subscription for the UE using existing
mechanism.
6\. The AMF retrieve UE subscription data by invoking Nudm_SDM_Get service
operation.
7\. For alt 1 as described in clause 6.32.2, the UDM checks if the PEI of the
UE is present in the UDM. If it is not, the UDM stores the PEI and provides
the UE with additional credentials for all NSSAIs or DNNs requiring NSSAA or
Secondary authentication/authorization according to the subscription. If the
PEI of UE is the same with the PEI stored in UDM and the UDM confirm the \"NPN
credential changed\" indication(s) of the UE is set, UDM provides UE with
credentials for S-NSSAI(s)/DNN(s) according to \"NPN credential changed\"
indication(s).
For alt 2 as described in clause 6.32.2, if the UDM confirm the \"NPN
credential changed\" indication(s) of the UE is set, UDM provides UE with
credentials for S-NSSAI(s)/DNN(s) according to \"NPN credential changed\"
indication(s).
If the PNI-NPN provisioning platform did not store the credentials in the UDM,
the UDM retrieves the credential from PNI-NPN provisioning platform executes
step 8. If there are multiple PNI-NPN provisioning platforms, the UDM is pre-
configured with information, e.g. the mapping information between S-NSSAI/DNN
for PNI-NPN and PNI-NPN provisioning platform address, which allows UDM to
select PNI-NPN provisioning platform storing UE\'s corresponding credentials.
8\. [Conditional] The PNI-NPN provisioning platform provides the credentials
and the combined S-NSSAIs or DNNs to the UDM. As part of its checks before
providing the credentials and the combined S-NSSAI, the PNI-NPN provisioning
platform can interface with the device manufacturer or its database for e.g.
about validity of the device. The PNI-NPN provisioning platform has the trust
relationship with the PLMN.
Step 7 and 8 may be executed multiple times if there are multiple PNI-NPN
provisioning platforms for different S-NSSAIs or DNNs.
NOTE 1: Whether and how the vertical authenticate/authorize the UE is based on
SA WG3 decision.
9\. The UDM sends the credentials and the combined S-NSSAIs or DNNs to the
AMF. The provisioned credentials are provided along with other subscription
data using steering of roaming mechanism.
NOTE 2: The provisioned credentials are protected by reusing steering of
roaming security mechanism as specified in TS 33.501 [7].
10\. The AMF includes the credential for NSSAA and/or for Secondary
authentication/authorization in Registration Accept message, to provision the
credential into the UE. If the S-NSSAI for the PNI-NPN is required for NSSAA,
the AMF also includes the S-NSSAI in the pending S-NSSAI list. The provisioned
credentials for NSSAA or secondary PDU session are stored in the ME if the
\"secure packet\" is not used to provision credentials for NSSAA or secondary
PDU session. If the \"secure packet\" is used to provision credentials for
NSSAA or secondary PDU session, then the provisioned credentials are stored in
the UICC.
NOTE 3: How the UE will handle the provisioned credentials is decided by SA
WG3.
10b. After the UE has successfully updated the provisioned credential for
NSSAA and/or for Secondary authentication/authorization, the UE provides an
acknowledgment to AMF in Registration Complete, and the AMF provides the UE
acknowledgement to UDM using Nudm_SDM_Info, as specified in TS 23.502 [6]
clause 4.2.2.2. Then UDM clears the \"NPN credential changed\" indication(s)
if exist.
11\. The UE may re-register with the PLMN credentials and/or establish PDU
session requiring secondary authentication. 5GC triggers NSSAA procedure or
secondary authentication procedure using the new credential for NSSAA or
Secondary authentication/authorization provisioned.
12\. In case PNI-NPN provisioning platform further update the credentials of
NSSAA or secondary authentication. The UDM updates the credential using UE
Parameter Update procedure after it receive the updated credentials of NSSAA
or secondary authentication.
### 6.32.4 Impacts on services, entities and interfaces
Impact on UDM:
\- UDM supports interaction with PNI-NPN provisioning platform to receive or
retrieve credential.
\- UDM includes the credential in Nudm_SDM_Get response to AMF.
\- UDM initiates UE Parameter Provisioning procedure when the credential is
updated.
\- UDM checks if the PEI of the UE is present in the UDM. If it is not, the
UDM stores the PEI.
Impact on AMF:
\- AMF includes the credential in Registration Accept message.
\- AMF support UE Parameter Provisioning procedure to update the credential in
the UE.
Impact in the UE (ME or UICC):
\- Provisioning and secure storage of the credential for NSSAA and secondary
PDU session authentication.
\- ME is impacted if the credential for NSSAA or secondary PDU session
authentication is be stored in ME secure container.
\- UICC is impacted if the credential for NSSAA or secondary PDU session
authentication is stored in the UICC.
## 6.33 Solution 33: UE Onboarding and remote provisioning based on eSIM
### 6.33.1 Introduction {#introduction-35}
The solution is based on an example private network in factory environment:
\- Inside a factory, the devices may have been provided by the device vendors
to enable the functionalities necessary to the required tasks in the factory.
However, most of those devices are sealed and usually stay static when they
are deployed. Furthermore, those devices may have no User Interfaces enabling
manual configuration. Therefore, an efficient mechanism is required to allow
remote provisioning of subscriptions/credentials and to configure those
devices. This mechanism shall also enable updating the subscription
information if necessary.
Based on the above scenario, the private network may be deployed as a
Standalone NPN (SNPN) or a PLMN integrated NPN (PNI-NPN) as described in
clause 5.20.2 and clause 5.20.3 in TS 23.501 [4].
### 6.33.2 Functional Description
The assumption for this solution:
\- Each UE is embedded with a secure element, i.e. eUICC which can accommodate
multiple NPN operator profiles (i.e. NPN subscription including network
identifier and credentials). Before any UE onboarding procedure, the device
has a default PLMN operator profile (i.e. default subscription) stored in the
eUICC to allow the UE to initially gain the IP connectivity through PLMN
access. It is assumed that through the default PLMN operator profile, the UE
gains connectivity to the PLMN for which credentials are going to be
provisioned either directly or through roaming agreement.
NOTE 1: An PLMN operator profile includes the HPLMN credentials and
potentially the information required by eSIM solution. The contents of profile
stored in eUICC are same as Traditional SIM cards which include the IMSI-based
information for the authentication.
\- Each device supports Bearer Independent Protocol (BIP) required in GSMA
eSIM solution to enable the eUICC to set up the communication channel between
eUICC and the eUICC platform via the IP connectivity of the UE on top of the
established PDU Session to receive the information as shown in Figure
6.33.2-1. The underlying protocol used for BIP is based on TCP/IP which is one
of the options used for M2M device as specified in eSIM solution GSMA SGP.21
[24] and GSMA SGP.22 [25]. When UE gets the IP connectivity, the ME will send
the network attachment event to the eUICC and then the eUICC opens a BIP
channel with the relevant parameters to address eUICC platform as shown in
Figure 6.33.2-1.
NOTE 2: The role of eUICC platform can be regarded as the Default Credential
Server (DCS) and Provisioning Server (PS) as described in current TR.
Figure 6.33.2-1: BIP Channel established among eUICC, UE and eUICC platform.
Therefore, when the UE initially obtains IP connectivity, the eSIM-based UE
onboarding procedure is triggered by eUICC inside the device on top of the
established PDU Session. The new NPN operator profile can be provided by using
eSIM-based UE onboarding procedure between eUICC and eUICC platform as shown
in Step A in Figure 6.33.2-1. The device may deregister from the current
network and initiate a PLMN/SNPN selection procedure to register to an NPN
after onboarding procedure is completed.
After the provisioning, if the NPN operator wants to update or replace the NPN
operator profile, the eUICC platform can always update or send new NPN
operator profile toward the eUICC in the device if necessary as shown in Step
B in Figure 6.33.2-1 as long as UE can get IP connectivity. If eUICC platform
(i.e. DCS + PS) is in PLMN and UE has the related operator profiles in eUICC,
the procedure in clause 5.30.2.7 of TS 23.501 [4] can be used to establish the
connection between the eUICC in the UE and eUICC platform.
Editor\'s note: The eSIM solution is developed for IMSI with AKA-based
credentials for securely provisioning with the information to the UE. However,
how to support non-AKA based on eSIM architecture is needed to cooperate with
GSMA, e.g. modify the existing procedure. Furthermore, if the eSIM is extended
to support SNPN, how to provide the SNPN ID (i.e. PLMN ID + NID) will require
the coordination with GSMA.
NOTE 3: The detailed operations of the interaction among the eUICC, the device
and the eUICC platform are specified in GSMA SGP.01 [22], SGP.02 [23], SGP.21
[24] and SGP.22 [25] and are out of 3GPP scope.
### 6.33.3 Procedures
Changes to the current procedures are FFS.
### 6.33.4 Impacts on services, entities and interfaces
UE:
\- eUICC with PLMN operator profile that includes the HPLMN credentials.
\- eUICC storage of the NPN operator profiles (i.e. NPN subscription including
of network identifier and credentials).
\- UE devices shall support the BIP protocol for the secure channel
establishment between the eUICC and eUICC platform.
## 6.34 Solution #34: PLMN assisted On-boarding Procedures
### 6.34.1 Introduction {#introduction-36}
The solution addresses key issue #4 \"UE Onboarding and remote Provisioning\".
The current solution applies to both SNPN onboarding and PNI-NPN onboarding.
The solution applies when UE have registered to the PLMN. Basic idea of the
solution is to send the on-boarding information (e.g. subscription
credentials), which used to connect to an SNPN or a PNI-NPN, from provisioning
server to UE over PLMN. Figure 6.34.1-1 illustrates the concept of PLMN
assisted On-boarding Procedures.
Take the concert, which deploys the SNPN or PNI-NPN, as the example.
Step 0: Some guys may buy the ticket for the concert and provide the GPSI to
host of the concert. The provisioning server sends the on-boarding
information, which used to connect to the SNPN or PNI-NPN, to the PLMN.
Step 1-2: The PLMN sends the on-boarding information to corresponding UE based
on GPSI. Specifically, it may send the on-boarding information to UE
immediately or send it to UE triggered by some events as shown in step 1 (e.g.
when the concert start, PLMN sends the on-boarding information to UE).
Step 3: UE can connect to the SNPN or PNI-NPN via the received on-boarding
information. This step is not shown in the figure.
Figure 6.34.1-1 PLMN assisted On-boarding Procedures
For SNPN, the on-boarding information contains the credentials used for the
primary authentication and the configuration parameters to access SNPN, e.g.
network selection list, updated S-NSSAI/DNN.
For PNI-NPN, the on-boarding information contains the credentials for NSSAA or
secondary authentication and the configuration parameters to access PNI-NPN,
e.g. updated allowed CAG list, updated allowed S-NSSAI/DNN.
### 6.34.2 Functional Description
#### 6.34.2.1 Architecture
Figure 6.34.2.1-1: Architecture for UE Onboarding via a PLMN
### 6.34.3 Procedures
#### 6.34.3.1 CP based PLMN assisted on-boarding procedure
The figure 6.34.3.1-1 below shows the call flow for PLMN assisted on-boarding
procedure. In case the UE has registered to the PLMN when PS provide the on-
boarding information to 5GC, the following procedure can be used to send the
On-boarding information to UE.
Figure 6.34.3.1-1: High-level flow of PLMN assisted CP onboarding procedure
0\. The AMF, which UE camp on, may subscribe to UDM about On-boarding
information. Afterwards, the provisioning server can be triggered to initial
the on-boarding procedures by some events, e.g. the use case shown in the
introduction part in clause 6.34.1.
1\. The provisioning server sends the Onboarding request to NEF, which
includes following parameters: the GPSI of target UE, Onboarding Information,
NPN type, and optional Triggering Events.
For SNPN case, the On-boarding information may be protected by a default UE
credential. Similarly, for PNI-NPN case, the credential for NSSAA or secondary
authentication in On-boarding information may be protected by a default UE
credential. The default UE credential is also pre-configured in the UE(USIM).
The protection for On-boarding information shall meet the requirement of
secured packet defined in TS 31.115 [26]. The UE may know which default UE
credentials are applied for protection (optionally via SNPN identity or
default UE credential identity).
The NPN type indicates the provisioning for SNPN or PNI-NPN via the PLMN.
The Triggering Events describe the event to provision the subscription
credentials to the target UEs, e.g. when and where to provision the
subscription credentials to the target UE.
NOTE: The default UE credential should be stored accompanied with credential
ID which corresponding to different SNPN. Based on the credential ID, UE can
differentiate the default UE credentials when a UE is requested to onboard
multiple SNPNs that managed by different parties. Mechanism to handle the
default UE credentials should be confirmed by SA WG3.
2\. The NEF transfers the Onboarding request to the UDM which stores the
target UE\'s subscription based on the GPSI.
3\. If the NPN Type contained in Onboarding request indicates that the
procedures are used to provision the primary credential/configuration
parameters for SNPN, UDM should not be aware of the content of Onboarding
Information and transparently transfer the Onboarding Information to the
target UEs.
If the NPN type contained in Onboarding request indicates that the procedures
are used to provision the credentials/configuration parameters for PNI-NPN,
UDM should update target UE\'s subscription according to the configuration
parameters in Onboarding Information (e.g. updated allowed CAG list, updated
allowed S-NSSAI/DNN).
If the Triggering Event existed, UDM can temporarily store the Onboarding
Information based on the Triggering Event.
4-5. Conditional step: The AMF subscribes the Triggering Events to the serving
AMF for the target UEs via existing Nudm_SDM_Notification message.
6-7. The UDM sends the onboarding response to the NEF and then the NEF
transfers to provisioning server.
8\. As specified in TS 23.502 [6] clause 4.20, AMF is triggered by Subscriber
Data Update Notification, which include the On-boarding information, from UDM
and perform UE Parameters Update procedures to send the Onboarding Information
to the UE (USIM).
The UE verifies based on mechanisms defined in TS 33.501 [7] that the UDM
Update Data is provided by PLMN, and:
\- If the security check on the UDM Update Data is successful, and UPU Data
contains any parameters that is protected by default UE credential, the ME
shall forward the secured packet to the USIM using procedures in TS 31.111
[27] and UE uses those parameters from that point onwards, in USIM; and
\- If the security check on the UDM Update Data fails, the UE discards the
contents of the UDM Update Data.
9\. After the UE receives the Onboarding Information, it may deregister from
the PLMN. For SNPN scenarios, the UE can perform SNPN selection and primary
authentication based on subscription/credentials obtained in Onboarding
Information. For PNI-NPN scenarios, the UE can perform CAG cell selection,
NSSAA and/or secondary authentication via the credentials contained in
Onboarding Information.
In case the UE has not registered to the PLMN when PS provide the on-boarding
information to 5GC, the Registration procedure, as specified in TS 23.502 [6]
clause 4.2.2, can be reused to send the On-boarding information to UE with the
following difference:
\- The Onboarding Information can be included in UE subscription data and send
to UE via step 14b and step 21, if the Triggering Events occur.
#### 6.34.3.2 UP based PLMN assisted on-boarding procedure
Figure 6.34.3.2-1: High-level flow of PLMN assisted UP onboarding procedure
0-7. These steps are same as described in clause 6.34.3.1 except that instead
of providing complete on boarding information to the UE only an indication is
provided. It is assumed that there is an agreement between PS and PLMN and
hence PS is able to access PLMN through its NEF, PSA of the PLMN. How PS
determines whether to use CP or UP will be aligned based on the conclusions of
the solutions which are handing same issue in the TR.
8\. An indication is provided to the UE which indicates to the UE that it has
to establish PDU session for on boarding procedure. Depending on the UP based
solution gets agreed for KI#4 more parameters like PS address may be provided
to the UE.
9\. Following the principles of UP based solution gets agreed for KI#4, the UE
establishes the PDU session for on boarding purpose, which establishes the
user plane connectivity to the PS. PS updates the UE with subscription
information of the new SNPN.
10\. The UE may choose to deregister with current PLMN, perform SNPN selection
and register with new SNPN.
### 6.34.4 Impacts on services, entities and interfaces
UE:
\- Support obtaining onboarding information for SNPN or PNI-NPN via PLMN\'s
UPU procedures.
\- Support using the On-boarding Information to access SNPN or PNI-NPN.
\- Support decrypting the content in On-boarding Information potentially via
default credential.
UDM:
\- Enhanced to receive on-boarding information via NEF from Provisioning
Server.
\- In the case of PNI-NPN, UDM shall update the subscription data based on
Onboarding Information.
\- Enhanced to use PLMN\'s UPU or UCU procedures to update onboarding
information for SNPN or PNI-NPN.
## 6.35 Solution #35: Solution for On Boarding for SNPN Compatible with SO\'s
Existing Provisioning Server
### 6.35.1 Introduction {#introduction-37}
This solution addresses key issue 4 \"UE Onboarding and remote Provisioning\".
Comparing to solution #5 \"UE Onboarding and provisioning for an SNPN\", the
main difference are:
\- This solution considers both scenario that DCS is deployed or not. In case
that device vendor does not maintain a DCS, or the on-boarding network has no
agreement with DCS, the solution does not involve DCS to perform
authentication. Instead, the solution assumes that SO holds both UDM and PS
because they are both related to subscription management. Since the SO has
ownership of on-boarding UE, the solution assumes that the SO could get the
UE\'s default UE credential (e.g. out of band method, for example, by scanning
QR code on the on-boarding UE, reading from USB flash from device vendor,
etc.), and configures it in its UDM. The UDM may reuse a primary
authentication based default UE credential to authorize the UE for on-
boarding. In other case that device vendor maintains a DCS, and the SO\'s
network has an agreement with the DCS, the solution involves DCS connecting
SO\'s network to perform authentication. After successful authentication,
SO\'s network authorizes the UE for on-boarding.
\- In solution 5, both credential and configuration information (e.g. PDU
session parameters, such as NSSAI, DNN, and other required parameters to
access the SNPN) are sent over user plane. However, in this solution, only
credential is sent over user plane while the configuration information is sent
over control plane. The motivation is to be compatible to existing Provision
Server of Subscription Owner (SO).
\- In solution 5, DCS is connected to O-SNPN. However, in this solution, when
DCS is deployed, the DCS is connected to SO-SNPN. The motivation is to ensure
the SO-SNPN has authenticated the UE so that the SO-SNPN can trigger on-
boarding procedure.
Figure 6.35.1-1: UE Onboarding in SNPN
The solution at least requires two parts, one is O-SNPN, which is connected
with SO\'s network, and is \"bridge\" for on-boarding. Another is SO, which is
owner for the on-boarding UE, and provide authentication, provisioning service
for the UE. SO\'s network is consisted of newly established 3GPP part and
legacy part. The 3GPP part includes 5GC NEs, such as UDM, AUSF, etc. while the
legacy part includes SO\'s existing NEs, such as provisioning server,
application server, terminals. Optionally, if device vendor has an agreement
with SO\'s network, the SO\'s network could contact the third part, i.e. DCS,
the UE performs on-boarding authentication with DCS instead of UDM.
NOTE 1: SO may also own the O-SNPN.
The solution separates provisioning data into two parts, one is _3GPP
configuration subscription data_ , which is used for 3GPP network selection
and configuration, and another is _N3GPP credential data_ , which reuses SO\'s
existing N3GPP credential.
The following assumptions and general procedure are given as below:
\- The UE can retrieve _on-boarding information_ of SO\'s network via the
broadcast information, for initial registration for on-boarding. The _on-
boarding information_ may include PLMN ID, NID of SO\'s network.
\- The UE is provisioned with _unique ID_ and _default_ UE _credential_ by
device vendor for on-boarding authentication. After on-boarding
authentication, the SO could identify whether on-boarding procedure is allowed
for UE or not. The _unique ID_ may be derived from PEI. In case the device
vendor maintains DCS, the domain part can be derived from the unique ID, and
the _default_ UE _credential_ may be certificate, key, etc. The UE may reuse
primary authentication for on-boarding authentication.
NOTE 2: The exact definition and details of these default UE credential and
on-boarding authentication will be determined by SA WG3.
\- After on-boarding authentication is successfully performed, the UE is _TO
BE_ provisioned with _3GPP_ _configuration data which is used_ to select and
access SO\'s SNPN. The _3GPP configuration data_ may include DNN, NSSAI to
access O-SNPN; PLMN ID and NID list for SNPN selection; a newly assigned SUPI
for UE identification in SO\'s SNPN etc.
\- After on-boarding authentication is successfully performed, the UE is _TO
BE_ provisioned with _N3GPP credential data_ for authentication of an SNPN.
The _N3GPP credential data_ may reuse SO\'s N3GPP credential, e.g.
certificate.
\- In case that SO\'s network does not deploy DCS, the SO\'s UDM is
provisioned with on-boarding UE\'s _unique ID_ , _default_ UE _credential_ and
desired _3GPP configuration subscription data._ In case that the SO\'s network
deploy DCS, the SO\'s UDM is provisioned with on-boarding UE\'s _unique ID_
and desired _3GPP configuration subscription data_. The SO can use the
provisioning method which is out of band, for example, the SO may retrieve
_unique ID_ and/or _default_ UE _credential_ by scanning QR code on the UE, or
by reading from USB flash from device vendor, the SO may determine desired
_3GPP configuration subscription data_ based on the UE\'s specific service
requirement, and the SO may configure them on the UDM using O&M.
\- The SO\'s PS could reuse existing Provisioning Server to provide _N3GPP
credential data_ to the UE, e.g. certificate authority (CA) for certificate
issue. The N3GPP credential can replace the default UE credential, and be used
for next registration.
\- If DCS is deployed, the DCS is provisioned with on-boarding UE\'s _unique
ID,_ and _default UE credential_.
The solution uses on-boarding authentication procedure using _unique ID_ ,
_default_ UE _credential_ and _on-boarding information_ for UDM or DCS to
authenticate the UE for on-boarding. If on-boarding authentication successes,
it means the SO authenticates UE\'s default UE credential, and the UE can be
authorized for on-boarding. The on-boarding authentication may reuse existing
primary authentication.
The solution reuses existing user plane protocol for PS to provide _N3GPP
credential data_ to the UE, e.g. using CMPv2 for credential provisioning or
other protocols out of scope of 3GPP. So, the solution could be compatible to
SO\'s existing provisioning server (e.g. CA).
The solution reuses existing UPU or UCU procedure for UDM to provide _3GPP
configuration subscription data_ to the UE. So, the solution has minimal
changes.
### 6.35.2 Functional Description
#### 6.35.2.1 Introduction {#introduction-38}
The procedure hereby described allows a UE, which is not initially provisioned
with network credentials to access an On-boarding SNPN (O-SNPN) and to obtain
network credentials and configuration for the SO.
#### 6.35.2.2 Architecture
Figure 6.35.2.2-1: Architecture for UE Onboarding to an SNPN
UDM:
UDM is used to perform:
\- Reusing primary authentication as on-boarding authentication: retrieve
UE\'s unique ID and default UE credential, use unique ID and default UE
credential for mutual authentication and security establishment with the UE.
\- 3GPP configuration subscription data provisioning: retrieve UE\'s desired
3GPP configuration subscription data, provide 3GPP configuration subscription
data to the successfully authenticated UE via existing procedure.
PS:
\- provide N3GPP credential data to the successfully authenticated UE. The PS
may reuse existing provisioning server, e.g. CA.
DCS:
\- In this solution, it is assumed that the DCS is owned by device vendor.
There is an agreement between DCS and SO if the DCS is.
### 6.35.3 Procedures
#### 6.35.3.1 Procedure in case no DCS is deployed
Figure 6.35.3.1-1: High-level flow for onboarding of the UE into an SNPN
**Pre-condition:**
a) UE has been provisioned _unique ID_ and _default_ UE _credential_ that
allows for successful mutual authentication of the device during the on-
boarding authentication (step 6).
b) UDM has been provisioned _unique ID_ , _default_ UE _credential_ and
desired _3GPP configuration subscription data_ of on-boarding UEs.
NOTE 3: How provisioning of the default UE credential is protected and
potential leakage of default UE credential is avoid will be determined by SA
WG3.
**Call-flow:**
1\. RAN broadcasts on-boarding information.
2\. In order to be consistent with current procedure, UE constructs SUCI
according to on-boarding information and unique ID, e.g. it\'s based on PEI,
PLMN ID, and NID using NAI format.
3\. UE registers to the network using the SUCI. The AMF finds AUSF according
to PLMN ID and NID in SUCI. The AUSF finds a default UDM for on-boarding if
the UE does not include domain part of device vendor in SUCI or the AUSF
cannot find DCS according to the domain part.
**Success case:**
4\. UE and UDM performs on-boarding authentication which may reuse primary
authentication based on _default_ UE _credential_. The UDM retrieves UE
context according to _unique ID_ in the SUCI.
5\. The UE establishes a configuration PDU session. This PDU Session may be
established either to a well-known or pre-configured S-NSSAI or DNN, or the UE
receives the URSP including the S-NSSAI or DNN for on-boarding, or the UE
receives the S-NSSAI by using the indication that this is registration for UE
onboarding provided by the UE in step 6, which is used just for provisioning
purposes and has limited connectivity capabilities. Based on this information,
the AMF selects a designated SMF which in turn selects a designated PSA that
provides a restricted data connection to the Provisioning Server.
NOTE 4: It is assumed that connectivity of this PDU session is limited (cf.
RLOS), so that the UE can only access a Provisioning Server.
The UE discovers and connects, at application level, to a provisioning server
address (that was preconfigured in the UE or received in step 6 from O-SNPN or
is derived from the application identifier and/or Service Provider Identifier
provided by the user in step 1).
The UE retrieves _N3GPP credential data_ from the PS, the UE may reuse
existing N3GPP credential management protocol with PS. For example, possibly
to reuse CMPv2 protocol to ask CA for signing a SO\'s certificate or other
similar protocols.
6\. The UDM triggers to provide the _3GPP configuration subscription data_ to
the UE after successful on-boarding authentication, e.g. using UPU procedure
to send PLMN ID, NID, routing ID, newly assigned SUPI, etc. to the UE, and
using UCU procedure to send MM and SM policy to the UE. The UDM may delay
triggering after receiving successfully provisioning notification from PS.
7\. Upon a successful provisioning in the previous step, the UE releases the
configuration PDU session and deregisters from the O-SNPN. The UE initiates a
regular procedure, including selection of an SNPN, registration using the
provisioned credentials with the SNPN owning the subscription, and PDU Session
establishment(s). Depending on the provisioned network credentials the UE may
select an SNPN that is the same or different from the SNPN owning the
credentials.
Failure case:
4\. The UE receives reject message, the reason may include UDM cannot find
UE\'s _default_ UE _credential_ , authentication failed, etc.
5\. UE re-selects _on-boarding information_ and try again.
#### 6.35.3.2 Procedure in case DCS is deployed
Figure 6.35.3.2-1: High-level flow for onboarding of the UE into an SNPN
**Pre-condition:**
The same with 6.35.3.1, the only difference is that the UDM does not need to
be provisioned _default_ UE _credential_ , and the AUSF is provisioned _unique
ID_.
**Call-flow:**
The difference of 6.35.3.1 is that the AUSF finds DCS via AAA-P according to
domain part of device vendor in SUCI. After the authentication, AUSF shall
indicates UDM to generate _3GPP configuration subscription data_ on both UDM
and UE identified by _unique ID_.6.35.4 Impacts on services, entities and
interfaces
The solution could be compatible for external authentication procedure
(depending on the outcome on Key Issue #1).
The solution could be compatible for SO\'s existing provisioning server, e.g.
certificate authority (CA).
The solution could have the least modification based on current procedure.
## 6.36 Solution #36: Providing **provisioning details to UEs using local and
central provisioning server**
### 6.36.1 Introduction {#introduction-39}
**This solution addresses Key issue #4: \"UE Onboarding and remote
provisioning\".**
One of the objectives for key issue 4 \"UE Onboarding and remote
provisioning\" is to study solutions for which network entity or entities take
part in subscription provisioning for a UE subject to onboarding and where the
network entity or entities are located.
**When devices subject to onboarding are deployed without provisioned
subscription the device needs to be able to obtain such provisioning related
information during the onboarding process.**
In non-public network deployment when the standalone NPN is independent of
Service Provider, the subscription is owned by the SP and there are multiple
SP(s) as part of the roaming group
When there are multiple SPs and/or SNPNs in a roaming group (referred to by
RG), each SP and/or SNPN will have access to provisioning information for its
own subscribers and not the subscribers of other SNPNs and/or SPs in the RG
In the above scenario where the onboarding SNPN is different from service
provider/subscription owner, this solution will provide the provisioning
details from Central provisioning server
The following are the main principles of the solution:
\- The scenario where the onboarding SNPN is same as the SP (O-SNPN is same as
SO-SNPN) then provisioning details will be provided from local provisioning
server
\- The scenario where the onboarding SNPN is independent SP (O-SNPN is
different from SO-SNPN) then the provisioning will be done by central
provisioning server
### 6.36.2 Functional Description
#### 6.36.2.1 Definitions {#definitions-4}
The following definitions apply:
**Onboarding-SNPN (O-SNPN):** An SNPN which onboards the UE. It may be same as
the SP/subscription owner or can be independent of SP/subscription owner.
There are multiple SP(s)/subscription owners as part of the roaming group.
**Local Provisioning Server (LPS):** Provisioning server will be hosted by the
SNPN network and/or Service Provider domain (different) SNPN. The LPS will be
configured with the SNPN network ID and/or SP ID along with roaming group id
based on the roaming agreement between SNPNs/SPs for all the UEs for which it
owns the subscription.
**Central Provisioning Server (CPS): Provisioning server will be outside of
the SNPN network and the SP domain. This will be common to all the service
providers/SNPNs which will have agreement to onboard the UEs through their
networks. The owner of this CPS is out of scope of this document and can be
hosted by third party.**
#### 6.36.2.2 Architectures
Figure 6.36.2.2-1 Onboarding architecture with Local and Central Provisioning
Servers
The solution has the following assumptions:
\- The PEI has been assumed to be the default UE credential present in UE and
used as key to store the provisioning details
It is assumed that the provisioning server (LPS) in the O-SNPN is performing
the onboarding with the UE and the actual onboarding procedure is out of scope
for this solution.
Whenever UE will be camped to one O-SNPN after initial access to the cells &
successful authentication, the LPS will check whether subscription details are
present for this UE or not. If it is present, then it will push the details to
UE. Otherwise it may sent the CPS address to UE or redirect the request to
CPS.
After this step UE can do successful registration using the SNPN network ID/SP
ID or roaming group ID received from provisioning server
Editor\'s note: The protocol and messages need to be defined between LPS and
CPS. Interaction between LPS and CPS can be done using SBA but it also depends
on the underlying solution used for provisioning methods (e.g. user plane or
control plane). Thus it is FFS.
The main benefit here is that LPS can be configured with the information
needed to reach the CPS (can be hosted by third party) to obtain subscription
information for a given UE based on the default UE credential provided by the
UE during the onboarding process (e.g. as in solution 5).
### 6.36.3 Procedures
Provisioning Server
The principles for standalone non-public network discovery and selection with
support for service providers is as given below:
\- Device Manufacturer or SNPN subscription owner (S-NPN1/SP1) will configure
the provisioning details in their local provisioning server for PEI1 (List of
Home service provider & roaming group ID.
\- Local PS (S-NPN1/SP1) will push the provisioning details to central
provisioning server.
UE LPS (S-NPN1/SP1) CPS
* * *
PEI1 PEI1: S-NPN1/SP1, RG1 PEI1: S-NPN1/SP1, RG1
\- Another device Manufacturer or SNPN subscription owner (S-NPN2/SP2) will
configure the provisioning details in their local provisioning server for PEI2
(List of Home service provider & roaming group id)
\- Local PS (S-NPN2/SP2) will push the provisioning details to central
provisioning server
* * *
UE LPS (S-NPN2/SP2) CPS
* * *
PEI2 PEI2: S-NPN2/SP2, RG2 PEI1: S-NPN1/SP1, RG1\ PEI2: S-NPN2/SP2, RG2
* * *
\- At this step Central PS will have subscription details for both the UEs
+------+-----------------------+ | UE | CPS | +======+=======================+ | PEI1 | PEI1: S-NPN1/SP1, RG1 | | | | | PEI2 | PEI2: S-NPN2/SP2, RG2 | +------+-----------------------+
Figure 6.36.3-1 High-level call flow for onboarding of the UE
Use Case # 1: O-SNPN and the Home service provider are same: (O-SNPN is same
as SO-SNPN):
\- PEI (IMEI1) has been preconfigured in the UE1.
\- As part of initial access UE1 is camped with S-NPN1.
\- Authentication is done with DCS.
\- As part of PDU session establishment Local provisioning server will
provision the UE with the access credential and provisioning parameters, as it
has all the details for IMEI1.
\- After onboarding procedure is completed, then UE1 will deregister from
S-NPN1/SP1 network and again attach to it using the provisioned credentials
with S-NPN1/SP1 ID to get normal service.
Use Case # 2: O-SNPN and the Home service provider are different and Home
service provider is available: (O-SNPN is different from SO-SNPN)
\- PEI (IMEI2) has been preconfigured in the UE2.
\- As part of initial access UE2 is camped with S-NPN1.
\- Authentication is done with DCS.
\- Local provisioning server will not find IMEI2 details. Hence either it will
provide the CPS address to UE or the LPS simply directs the request to CPS so
that the UE can be provisioned directly by the CPS.
\- After onboarding procedure is completed, then UE2 will deregister from
S-NPN1/SP1 network.
\- UE2 will attach to S-NPN2 network using the credentials received as part of
provisioning procedure to get normal service.
Use Case # 3: O-SNPN and the Home service provider are different and Home
service provider is not available: **(** O-SNPN is different from SO-SNPN and
S-NPN2 is not available):
\- PEI (IMEI2) has been preconfigured in the UE2.
\- As part of initial access UE2 is camped with S-NPN1.
\- Authentication is done with DCS.
\- Local provisioning server will not find IMEI2 details. Hence either it will
provide the CPS address to UE or the LPS simply directs the request to CPS so
that the UE can be provisioned directly by the CPS.
\- After onboarding procedure is completed, then UE2 will deregister from
S-NPN1/SP1 network.
\- In this area where UE2 is trying to access the regular service does not
have S-NPN2/SP2 cells, then it will use the RG2 ID to get the normal service
based on roaming group ID.
### 6.36.4 Impacts on services, entities and interfaces
Editor\'s note: This clause lists impacts to services, entities and interfaces
## 6.37 Solution #37: UE Onboarding and remote provisioning for SNPN
### 6.37.1 Introduction {#introduction-40}
This solution addresses key issue 4 \"UE Onboarding and remote provisioning\".
It enables the UEs without the subscription data to access to the Onboarding
SNPN (O-SNPN) to obtain the full provisioning data from the home network
owning the UE\'s subscription data. So that the provisioned UE can normally
access to the desired network services.
In this solution, it assumes the presence of an Onboarding and Provisioning
Function (OPF), which stores both the default configuration and provisioning
data for the UE, and to provide onboarding authentication and authorization
between UE and OPF. The OPF may be located inside of O-SNPN, or outside of
O-SNPN.
Figure 6.37.1-1: UE onboarding in SNPN scenario
The following assumptions are considered:
\- The UE is provisioned with necessary _default configuration, e.g_. _UE
identity, default_ UE _credential, default OPF address, optional list of
onboarding SNPNs_.
The _default OPF address_ is used for O-SNPN to discover the OPF which can
provide the O&P service for the UE.
Editor\'s note: The exact definition and details of these default
configuration are FFS and need to be discussed with SA WG3.
\- the Onboarding and Provisioning Function (OPF) is pre-configured with UE
provisioning data, e.g. subscriber identifier, individual credential, etc.
Editor\'s note: The exact definition and details of provisioning data is FFS
\- The OPF is pre-configured with the same default configuration as in UE.
\- The OPF is pre-configured with additional OPF address that stores default
configuration and provisioning data for the UE, in case the default OPF has no
provisioning data of the UE.
\- the OPF can provide onboarding authentication and authorization between UE
and OPF.
Editor\'s note: the entity for performing onboarding authentication and
authorization is FFS
\- the Onboarding SNPN (O-SNPN) could be the UE\'s home network owning UE\'s
subscription data or could be not.
\- The O-SNPN can discover the OPF that owned the UE\'s provisioning data, by
using the information from UE (e.g. default OPF address), or information from
default OPF (e.g. additional OPF address).
### 6.37.2 Functional Description
#### 6.37.2.1 Introduction {#introduction-41}
The UE selects the O-SNPN by manual or automatic network selection and
initiates the registration for Onboarding and Provisioning Service (O&P
service) when UE detects no subscription data. During the registration, O-SNPN
determines whether to permit the further O&P service for the UE and selects
the OPF which can provide the O&P service for the UE based on the information
provided by UE, e.g. default OPF address. The selected OPF performs the
authentication and authorization between UE and the OPF, after that UE can
download the provisioning data from the OPF via O-SNPN. Finally, UE de-
registers to the desired network by using the received provisioning data.
#### 6.37.2.2 Architecture
Figure 6.37.2.2-1, it describes overview of the architecture, and it depends
on the real business deployment which OPF(s) needs to exist.
\- Case 1 shown in Figure 6.37.2.2-1,this is the simplest case when the O-SNPN
is also UE\'s home network, and the OPF is deployed in O-SNPN stored the
default configuration and provisioning data for the UE. In this case, O-SNPN
can recognize UE by the UE identity and discover the right OPF, since the OPF
stores UE default configuration. No matter what the default OPF address is
Figure 6.37.2.2-1 architecture for UE onboarding home network (O-SNPN)
\- Case 2 shown in Figure 6.37.2.2-2, this case is for UE onboarding its home
network to obtain provisioning data via O-SNPN. The UE is assumed to be pre-
configured with default OPF address where the UE\'s default configuration and
provisioning data are stored, the O-SNPN can discover the default OPF by the
information provided by UE, e.g. _default OPF address_.
NOTE: whether AMF directly connects to default OPF, or via vOPF deployed in
O-SNPN, it depends on the implementation.
Figure 6.37.2.2-2 architecture for UE onboarding home network via O-SNPN
\- Case 3 shown in Figure 6.37.2.2-3, it is the most complicated case. UE is
pre-configured with default OPF address , but the default OPF has no
provisioning data and stores the target OPF address where the provisioning
data is stored, at this time, O-SNPN can obtain the target OPF address by
querying to the default OPF.
For example, the default OPF can store and feedback the target OPF address in
case receiving the onboarding and provisioning request from the O-SNPN.
Figure 6.37.2.2-3: Architecture for UE Onboarding home network via OPF
relocation
There are two potential new interfaces:
\- Interface X1 between AMF and OPF.
\- Interface Y1 between two OPFs.
### 6.37.3 Procedures
The figure 6.37.3-1 below shows a high-level flow how to perform onboarding
and provisioning for the UE, which combines the case 1, case 2 and case 3.
Figure 6.37.3-1: High-level flow for onboarding and provisioning for the UE
The procedure includes the following steps:
A1, UE pre-configuration: UE is pre-configured with default configuration,
which includes UE identity, default UE credential, default OPF address,
optional list of onboarding SNPNs, in order for UE to access the O-SNPN and
download the provisioning data.
A2, OPF pre-configuration: the vOPF is pre-configured with default
configuration and provisioning data for the UE in case 1;
For case 2, and case 3, the vOPF has no provisioning data for the UE
A3, conditional, default OPF is pre-configured with default configuration and
provisioning data for the UE in case 2. For case 3 default OPF has no
provisioning data for the UE and stores target OPF address, .
A4, conditional, only for case 3, target OPF is pre-configured with default
configuration and provisioning data for the UE.
B, Initial access: In this step, UE either manually or automatically discovers
and selects the O-SNPN network by some means, for example based on the list of
onboarding SNPNs if available in the default configuration, when it detects
that it has no subscription to access the network.
During the initial registration, UE provides information including UE identity
(e.g. PEI), default OPF address, and may also provide additional information,
such as SP info. The O-SNPN may determine whether to allow the further O&P
service for this UE, based on the local policy and information provide by UE.
C1, as described in case 1, O-SNPN discovers the vOPF that stores UE\'s
provisioning data, based on the information provided by UE, e.g. UE identity,
or/and default OPF address.
C2, as described in case 2, O-SNPN discovers the default OPF that stores UE\'s
provisioning data, based on the information provided by UE, e.g. default OPF
address.
C3, as described in case 3, O-SNPN discovers the target OPF that stores UE\'s
provisioning data, based on the information (e.g. target OPF address)
feedbacked from default OPF when the O-SNPN queries the default OPF.
D, the selected OPF owning UE\'s provisioning data performs onboarding
authentication and authorization between UE and the selected OPF.
E, UE downloads the provisioning data from the selected OPF after successful
onboarding authentication and authorization.
F, UE performs re-registration or network re-selection to access the desired
network service by using the provisioned subscription data.
### 6.37.4 Impacts on services, entities and interfaces
UE:
\- Support for additional configuration information (default UE credential,
default OPF address, optional list of onboarding SNPNs)
OPF:
\- Support authentication and authorization for onboarding between UE and the
OPF owning UE\'s provisioning data
\- Configured with UE default configuration and provisioning data
\- Discover the target OPF and transfer data to the target OPF owning UE\'s
provisioning data.
AMF:
\- Support to perform OPF selection based on information provided by UE or
local policy via new interface. Transfer the provisioning request/data between
UE and the target OPF
## 6.38 Solution #38: Provisioning for PNI-NPN when secondary authentication
is required
### 6.38.1 Introduction {#introduction-42}
This solution is for Key Issue #4, \"UE Onboarding and remote provisioning\"
and in particular the provisioning of the identities and credentials for PNI-
NPN required for the secondary authentication (NSSAA or secondary
authentication for a DNN).
The scenario assumed in this solution is that a PNI-NPN is deployed in a PLMN
using a dedicated S-NSSAI(s) or DNN(s) as e.g. described in TS 23.501 [4]
Annex D.2. The PNI-NPN customer/service provider may require a secondary
authentication and authorisation (SAA), which can be either secondary
authentication for the network slice (NSSAA, e.g. in TS 23.501 [4] clause
5.15.10) or secondary authentication by a DN-AAA server during the
establishment of a PDU Session (e.g. in TS 23.501 [4] clause 5.6.6). For the
required SAA, the UE needs to be provisioned with identities and credentials
in order to successfully use the services of the PNI-NPN customer/service
provider.
The solution is based on the following principles:
\- There is an SLA agreement in place between the PLMN and the PNI-NPN
customer (or service provider). It is assumed that the PLMN is aware about the
UEs which need provisioning before the S-NSSAI or DNN used for PNI-NPN is
activated.
\- The S-NSSAI or DNN which is used for PNI-NPN is not included (i.e. not
activated) in the UE Subscription Data before the UE is provisioned with the
identities and credentials for PNI-NPN access.
\- The 5GS provides the transport (CP or UP) means to the PNI-NPN customer to
perform the provisioning of the credentials required for the SAA (NSSAA or
secondary authentication for a DNN).
\- After successful UE provisioning, the UE Subscription Data in the UDM/UDR
is updated to include the S-NSSAI or DNN, for which the credentials have been
provisioned. For example, the AF/E-PS (external provisioning server) can
activate or provision the network (e.g. UDM/UDR) via the exposed network
provisioning capabilities via NEF.
\- The UE NAS configuration is updated by using existing procedures when the
Subscription Data changes (i.e. no impacts to the UE are required).
### 6.38.2 High Level Description
The solution uses the principles from clause 6.38.1.
### 6.38.3 Procedures
Figure 6.38.3-1 shows the procedure for provisioning of the (user) identities
and credentials for the secondary authentication and authorisation (SAA) to
allow the UE to use the PNI-NPN. The PNI-NPN customer is shown as AF/E-PS
(external provisioning server).
The procedure shows two alternatives for provisioning of the UE:
\- User Plane (UP) provisioning which includes step 8A b) and step 9; and
\- Control Plane (CP) provisioning which includes either step 8A a) or step
8B.
Figure 6.38.3-1: Procedure for provisioning of identities and credentials for
PNI-NPN requiring NSSAA or secondary authentication for a DNN
0\. The UE has subscription for the PLMN.
1\. The service provider (e.g. AF/E-SP) has a contract with the network
operator to provide specific service (e.g. service ID#x) to a group of
devices/UEs. In Alternative A (step 1a), the AF/E-PS uses the service-level
agreement (SLA) to request a service subscription and the AF/E-PS can
implicitly subscribe to notifications when the UE is reachable. In Alternative
B (step 1b), the AF/E-PS subscribes with the 5GS (e.g. UDM/UDR) to be notified
when a UE (identified by external ID) is reachable.
2\. The UDM/UDR stores UE Subscription Data where the parameters
S-NSSAI#x/DNN#x related with the PNI-NPN requiring SAA should be \"inactive\"
in the subscription data, i.e. S-NSSAI#x/DNN#x should not be included in the
UE subscription data sent to the AMF.
3--6. Registration procedure according to TS 23.502 [6]. It is noted that in
step 5 the UDM does not include the S-NSSAI#x/DNN#x in the UE Subscription
Data.
7\. The UDM/UDR notifies the AF/E-PS about the UE reachability.
8\. The AF/E-PS initiates a C-plane procedure to update/provision the UE with
identity and security parameters for SAA.
In alternative 8A: the C-plane communication is used to trigger the UE to
perform U-plane provisioning.
In option a), the AF/E-PS can either initiate Device Triggering procedure
towards the UE, or send an MT SMS in order to trigger the application in the
UE to use IP connectivity for provisioning of the PNI-NPN identity and
credentials. The communication between the AF and UE is on the path AF \
NEF \ SMS-SC \ UE (for Device Triggering) or AF \ SMS-SC \ UE (for
MT SMS). The AF can trigger an application in the UE to perform application-
level signalling to trigger UP provisioning (step 9). The AF may additionally
send to the UE the external provisioning server (E-PS) address and
Authentication Token to allow the application in the UE to trigger secure UP
communication with the PS.
NOTE 1: Sending the Authentication Token to UE is in scope of SA WG3.
In another option b), if PNI-NPN identity and credentials are to be
provisioned to the UE\'s eUICC, the AF/E-PS may use Remote SIM Provisioning
(RSP) mechanism by sending an SMS PUSH to enable the U-plane provisioning of
the eUICC via HTTPS. This alternative is not shown in the Figure 6.38.3-1.
In alternative 8B: the C-plane communication is used to provision the PNI-NPN
identity and credentials to the UE. The communication between the AF/E-PS and
UE is on the path AF \ NEF \ UDM \ UE. The signalling between the UDM
\ UE is via the AMF and is similar to the UE parameters update procedure,
which may be updated to carry PNI-NPN identity and credentials for SAA.
NOTE 2: Whether and how the AF/E-PS authenticate/authorize the UE, during the
procedure in alternative 8B, is based on SA WG3 decision.
In one option, the AF/E-PS may use Nspaf API to send a secure packet to UDM,
as described in TS 29.544 [37]. Afterward, the UDM send the PNI-NPN identity
and credentials to UE over existing UPU procedure. This alternative is not
shown in the Figure 6.38.3-1.
9\. [conditional] If step 8A is performed, the UE (e.g. an application in the
UE) can perform application-level signalling, whereby the PNI-NPN identity and
credentials needed for the SAA are provisioned in the UE. The UE needs to
first establish a PDU Session before sending the application-level signalling.
During this step, the application in the UE may use the E-PS server address
received in step 8A to establish the communication with the E-PS. In addition,
the E-PS may first trigger an authentication procedure with the application in
the UE and the application uses the Authentication Token received in step 8A.
NOTE: The use of E-PS address and Authentication Token in the Device
Triggering procedure in step 8A and in step 9 do not impact the network
entities and the UE, as this is an application container information.
In the UE, the security parameters should be associated with a service
subscription identified by service ID (e.g. application ID, S-NSSAI, DNN) in
order to allow the UE to differentiate among multiple sets of security
parameters. The AF/E-PS can learn the service ID for the subscribed service
during step 1 when the service is provisioned in the network. In such case,
the AF/E-PS includes the service ID in the U-plane signalling exchange.
10\. After the successful provision of the identity and credentials for SAA in
the UE, the AF/E-PS initiates a procedure to activate the service subscription
(identified by ID#x) status in the UDM/UDR.
11\. The UDM/UDR activates the service subscription associated with identifier
ID#x in the UE\'s subscription data. The UDM/UDR is able to map the service
subscription identifier ID#x with the corresponding parameters
S-NSSAI#x/DNN#x.
12\. The UDM/UDR initiates procedure to update the UE Subscription Data in the
corresponding NFs, specifically to add the NSSAI#x/DNN#x in the Subscription
Data for AMF.
13\. The AMF performs UCU procedure to update the configured NSSAI with
registration required.
14\. The UE performs Registration procedure including an update Requested
NSSAI. The target AMF (if AM relocation is required) performs the NSSAA
procedure for S-NSSAI#x
This procedure can be also performed in case when the authorization of the UE
in the AF/E-PS expires and the AF/E-PS can deactivate the service subscription
associated with S-NSSAI#x in the UDM/UDR. After the UE is updated via
application-level signalling via User Plane (e.g. step 9) or via Control Plane
step 8B, the AF/E-PS can activate or deactivate the service subscription
associated with S-NSSAI#x in the UDM/UDR.
### 6.38.4 Impacts on services, entities and interfaces
\- Impacts to UDM/UDR:
\- In case of CP provisioning, the UE parameters update procedure may be
updated to carry identities and credentials for SAA;
\- Expose the capability to NEF to activate or deactivate a service
subscription associated with a particular S-NSSAI/DNN.
\- Impacts to NEF:
\- Expose capability to AF/E-PS to activate or deactivate a service
subscription in the UDM/UDR.
## 6.39 Solution #39: UE onboarding using PLMNs
### 6.39.1 Introduction {#introduction-43}
This is a solution to Key Issue #4; it addresses the UE onboarding for the
SNPN with non-AKA credentials.
The UE is configured with Default credentials in USIM to attach to any PLMN in
which the UE can register with the Default credentials, i.e. an Onboarding
Network (ON). This enables UEs to be provisioned with necessary network
credentials and configuration for the SNPN that will own the UE\'s
subscription.
Figure 6.39.1-1: UE onboarding using PLMNs
The following assumptions are considered:
\- The UE is as defined in TR 21.905 [1] i.e. consists of a ME and a UICC.
\- The UE is equipped with a USIM containing Default credentials belonging to
a PLMN operator.
\- The UE is not provisioned with NPN credentials.
\- PLMN coverage exists at the location where UE onboarding takes place.
\- As part of the onboarding process the UE is eventually provisioned with NPN
credentials that grant access to an SNPN.
\- No relationship is assumed between the PLMN used as ON and the SNPN.
\- The UE manufacturer has a business relationship with one PLMN operator.
\- The PLMNs provides the UE with connectivity to a Provisioning Server that
allows UEs to retrieve their NPN credentials and other personalized
configuration. The Provisioning Server can be owned by the device manufacturer
or an entity affiliated with the device manufacturer.
\- The SNPN owning the subscription has a list of GPSI identifying the UEs for
which a subscription will be provisioned using the UE onboarding procedure and
provides this list to the Provisioning Server.
### 6.39.2 Functional Description
The UE is manufactured with Default credentials that consist in a USIM profile
that will be used only for UE onboarding. This USIM profile can be issued by
any PLMN operator the manufacturer has an agreement with. In what follows,
this PLMN is referred to as \"HPLMN\". The UDM (or HSS) of the HPLMN plays the
role of Default Credential Server (DCS) and the Provisioning Server (PS) is in
a DN that the HPLMN provides access to.
As part of the agreement between the UE manufacturer and the HPLMN, the UE
subscription in the HPLMN allows access to a DN that provides connectivity to
the Provisioning Server.
Any PLMN available at the location where the UE is when performing UE
onboarding can be used as Onboarding Network (ON), as long as it has a roaming
agreement with the HPLMN.
At power-up, the UE does not have information for SNPN selection and therefore
performs normal PLMN selection, registers and establishes a PDU Session using
normal procedures. The UE subscription corresponding to the USIM profile
contains a default Subscribed S-NSSAI and a default DNN that are appropriate
to reach the Provisioning Server; consequently a PDU Session that provides
access to the Provisioning Server is established without the UE having to
indicate any NSSAI or DNN information.
The UE connects to the Provisioning Server through the established PDU
Session. The HPLMN provides the GPSI of the UE subscription to the
Provisioning Server using secondary authorization/authentication. Upon
establishment of connectivity to the Provisioning Server, the UE is
provisioned with NPN credentials (for the SNPN that will own the UE\'s
subscription) and additional configuration data. Then the UE deregisters from
the PLMN and, using the information acquired during UE onboarding, performs a
new network selection and registers using the provisioned NPN credentials with
the SNPN owning the UE\'s subscription.
### 6.39.3 Procedures
Figure 6.39.3-1: High-level flow for onboarding of the UE into an SNPN
The procedure consists in the following steps:
A) UE pre-configuration: the UE is equipped with a USIM containing Default
credentials that allows for successful authentication of the device during the
PLMN access step (step B).
B) PLMN access: In this step, the UE discovers and selects the PLMN to be used
as ON using regular procedures. The UE performs a Registration procedure as
specified in TS 23.502 [6] clause 4.2.2.2.2, without providing any Requested
NSSAI. The AMF uses the S-NSSAI marked as default in the Subscribed S-NSSAIs
of the UE subscription.
C) PDU Session Establishment: The UE establishes a PDU session as specified in
TS 23.502 [6] clause 4.3.2.2, without providing any DNN. The AMF determines
the DNN for the requested PDU Session by selecting the default DNN present in
the UE\'s Subscription Information.
C1) During the PDU Session establishment, secondary DN authorization without
DN authentication (as specified in TS 23.502 [6] clause 4.3.2.3 and TS 29.561
[38]) is triggered by the SMF with the Provisioning Server acting as DN-AAA
server. The SMF provides the GPSI to the Provisioning Server. If the GPSI is
part of an onboarding list configured in the Provisioning Server, the
Provisioning Server authorizes the PDU Session establishment and correlates
the GPSI with the IPv4 address and/or IPv6 prefix allocated (by the SMF or by
the Provisioning Server). Alternatively, this procedure can be performed with
DN authentication.
D1) The device discovers and connects, at application level, to a provisioning
server address (that was preconfigured in the UE in step A or is derived from
the application identifier and/or Service Provider Identifier provided by the
user in step B) for retrieving its own personalized information. The
Provisioning Server identifies the UE by its IP address and deduces the GPSI
based on the correlation made at step C1. Provisioning Server identifies the
UE by its IP address and deduces the GPSI based on the correlation made at
step C1. Alternatively, the Provisioning Server authenticates the UE at
application level, the UE uses application-level onboarding credentials either
pre-provisioned in the UE or entered by the user.
D2) The Provisioning Server contacts the future SNPN owning the subscription,
identified by comparing the GPSI with a configured onboarding list, to
retrieve the network credentials for access to the SNPN owning the
subscription, as well as other UE configuration parameters (e.g. PDU session
parameters, such as SNSSAI, DNN, URSPs, QoS rules, and other required
parameters to access the SNPN and establish a regular PDU session).The
Provisioning Server selects the SNPN owning the subscription in one of the
following ways:
\- If the UE is pre-configured with the identity of the future SNPN, the UE
provides this identity to the Provisioning Server.
\- Otherwise, the Provisioning Server determines the future SNPN by comparing
the GPSI with a configured onboarding list.
NOTE: In scenarios where the UE is not preconfigured with the identity of the
future SNPN (e.g. an off-the-shelf UE), this solution requires that the
Provisioning Server be configured with onboarding list information from the
device vendor. However, it cannot be assumed that the device vendor always has
information about the specific SNPN where a specific UE is to be used.
D3) The Provisioning Server pushes the UE\'s NPN credentials for the SNPN and
other configuration information into the UE. The UE stores the NPN credentials
in the ME.
E) De-registration: Upon a successful provisioning in the previous step, the
device releases the PDU Session and deregisters from the ON.
F) Normal service: Upon a successful de-registration as per step E, the device
initiates a regular procedure, including selection of an SNPN, Registration
using the provisioned NPN credentials with the SNPN owning the subscription,
and PDU Session establishment(s).
### 6.39.4 Impacts on services, entities and interfaces
UE:
\- The UE is to be pre-configured with provisioning server address or derive
it, and initiate a connection to this address.
\- The UE stores the NPN credentials in the ME.
\- In one of the alternatives the UE is pre-provisioned with application-level
credentials or means to request them from the user.
Network configuration:
\- Network needs to be pre-configured with N6/SGi tunnels to Provisioning
Server.
\- UE\'s onboarding subscription needs to enable selection of a specific
Provisioning Server.
## 6.40 Solution #40: Solution for UE onboarding and remote provisioning
### 6.40.1 Introduction {#introduction-44}
This solution addresses key issue#4 \"UE Onboarding and remote provisioning\".
### 6.40.2 Functional Description
Figure 6.40.2-1: UE Onboarding and provisioning architecture
Figure 6.40.2-1 illustrates the architecture of UE onboarding and
provisioning.
This solution uses the device attestation architecture that is defined in IETF
draft \"Remote Attestation Procedures Architecture\". The UE functions in the
\"Attester\" role, the provisioning server functions as the \"Relying Party\"
role and the DCS (Default Credential Server) functions as the \"Verifier\"
role that defined in IETF draft \"Remote Attestation Procedures
Architecture\".
The solution has the following assumption:
1\. UE: The manufacturer provisions universally unique identity (Universal
Entity ID) into the UE during manufacturing.
The manufacturer may also provision secret attestation key material (AKM) into
the UE during manufacturing which is used to sign the UE\'s attestation token
and the DCS (verifier) can verify the UE\'s attestation token using the
correspondent AKM that is pre-configured in DCS.
The UE may have many different execution environments operating with different
security levels to store the AKM and other information such as TEE (Trusted
Execution Environment), eSE (embedded Secure Element) etc.
2\. DCS (Default Credential Server): The DCS is configured with the
correspondent attestation key material (AKM) which is used to verify UE\'s
attestation token. The DCS functions as the \"verifier\" as defined in IETF
draft \"Remote Attestation Procedures Architecture\".
3\. Provisioning Server: Provisioning server functions the relaying party as
defined in IETF draft \"Remote Attestation Procedures Architecture\".
### 6.40.3 Procedures
Figure 6.40.3-1 shows the high-level procedure of the solution.
Figure 6.40.3-1: Option 2: Onboarding and provisioning Procedures
1\. Onboarding - attestation.
The UE establishes the network connectivity that can communicate with the
provisioning server. This is achieved by defining a new registration type,
i.e. 5GS Registration type set to a new _Onboarding_ value, which allows the
onboarding SNPN network to provide limited connectivity PDU session that is
only allowing the UE to access the provisioning server.
The network may support a UE to onboard without a 3GPP credential, with the
addition of a SIB indication meaning that \"access with no credentials for a
limited PDU session\".
\- If the SIB indication indicates that UEs with no 3GPP credentials are
supported, the UE may attempt to access the network for a limited PDU session.
Based on the limited connection, the UE\'s non-3GPP credential can be
authenticated by SNPN through 5GC.
\- If the SIB indication indicates that UEs with no 3GPP credentials are not
supported, the network onboarding stops here.
After establishing the network connectivity for onboarding, the UE starts the
onboarding procedure.
The UE sends attestation token which contains the universal UE identity and
signing by attestation key material to the provisioning server by application
layer protocol. One option of the protocol is based on CoAP. The provisioning
server functions as the relaying party defined in IETF draft \"Remote
Attestation Procedures Architecture\" and forwards the attestation token to
the DCS. The DCS verifies the attestation token\'s signing using the
attestation key material.
2\. Onboarding - provisioning.
If the UE completes the onboarding-attestation procedure successfully in step
1:
The provisioning server stores the UE\'s credential used for the SNPN
authentication. How the UE\'s credentials created/configured in the
provisioning server is out of scope.
NOTE: The detailed format of UE\'s credential for desired SNPN authentication
will be studied by SA WG3.
2.1-2.2. The provisioning server acts as DN-AAA server and pushes the UE\'s
credentials to the network entity that stores the UE\'s credentials for
authentication. The desired SNPN stores UE\'s credentials in UDM. The
provisioning server pushes the UE\'s credentials to the SNPN\'s UDM via the
NEF. The interface between the provisioning server and the NEF is N33.
2.3. The provisioning server pushes the UE\'s credentials to the UE.
3\. Onboarding - UE selects the desired SNPN and authentication.
The UE selects the desired SNPN and starts the authentication procedure using
the credentials that provisioned in Step 2. The SNPN selection may be based on
the broadcast information sent by the SNPN.
### 6.40.4 Impacts on services, entities and interfaces
NG-RAN:
\- A new SIB indication whether the network supports UEs that do not have 3GPP
credentials for the network.
Provisioning Server/NEF:
\- The service interface between the provisioning server and the NEF, the
service interface between the NEF and the UDM need to be defined.
UE and AMF:
\- The new registration type which allows the onboarding SNPN network to
provide limited PDU session connectivity that is only allowing the UE to
access the provision server need to be defined.
## 6.41 Solution #41: support of roaming-like or N3IWF-based architecture for
mobility scenarios
### 6.41.1 Introduction {#introduction-45}
This solution takes solution 1 or solution 2 as baseline to further clarify
how to support Inter-PLMN like (i.e. roaming-like) or N3IWF-based architecture
between source network, and target network or home SP to address the mobility
scenarios of KI#1 considering that there may exist three possible options for
interworking support between two different networks: i.e. no interworking
support, roaming-like interworking, or N3IWF based interworking.
This solution assumes that there are neither Xn interface (common AMF) nor N14
interface between the source network and target network during mobility
scenarios. For the scenario where exists Xn interface or N14 interface among
the source network, target network or home SP, mechanism defined in TS 23.502
[6] clause 4.9.1 is used to address the mobility and it is out of the scope of
this solution.
### 6.41.2 Functional Description
In support of Figure 6.1.1-1, 6.1.2-1 of solution 1 or in support of Figure
6.2.2.2-1, 6.2.2.2-2 of solution 2 where Home SP is PLMN, the mobility
scenarios (including service continuity) should consider the following cases:
\- UE moving from SNPN#1 to SNPN#2 with PDU session anchored in the Home
SP(Figure 6.41.2-1 and 6.41.2-2); and
\- UE moving from SNPN#1 to SNPN#2 with PDU session anchored in the
SNPN#1(Figure 6.41.2-3 and 6.41.2-4); and
\- UE moving between SNPN#1 and Home SP with PDU session anchored in the Home
SP(Figure 6.41.2-5); and
\- UE moving between SNPN#1 and Home SP with PDU session anchored in the
SNPN#1(Figure 6.41.2-6).
Figure 6.41.2-1: UE moving from SNPN#1 to SNPN#2 with PDU session anchored in
the Home SP and Inter-PLMN like interworking between SNPN#2 and Home SP.
Figure 6.41.2-2: UE moving from SNPN#1 to SNPN#2 with PDU session anchored in
the Home SP and N3IWF interworking between SNPN#2 and Home SP.
Figure 6.41.2-3: UE moving from SNPN#1 to SNPN#2 with PDU session anchored in
the SNPN#1 and Inter-PLMN like interworking between SNPN#2 and SNPN#1.
Figure 6.41.2-4: UE moving from SNPN#1 to SNPN#2 with PDU session anchored in
the SNPN#1 and N3IWF interworking between SNPN#2 and SNPN#1.
Figure 6.41.2-5: UE moving from SNPN#1 to Home SP with PDU session anchored in
the Home SP.
Figure 6.41.2-6: UE moving from SNPN#1 to Home SP with PDU session anchored in
the SNPN#1.
Between SNPN#1 and SNPN#2, there may three possible options for interworking
support: i.e. no interworking support, roaming-like interworking, or N3IWF
based interworking. If the UE attempts to connect to the SNPN#2 using the
credentials of a Home SP by e.g. manual selection disregarding the SIB
indication, the SNPN#2 will reject this attempt if SNPN#2 is not present in
the allowed SNPN list in the subscription data of Home SP during the
registration procedure. The allowed SNPN list is also used by source network
as the criteria to trigger the HO procedure towards the target SNPN.
Between SNPN#1 or SNPN#2 and Home SP, roaming-like interworking is supported.
However, it is also possible to support N3IWF based interworking between
SNPN#1 or SNPN#2 and Home SP at the same time. In this case, a UE that can
register in a SNPN using the credentials of a Home SP can also access services
of the Home SP using the architecture depicted in Figure 6.1.2-1 of solution 1
or Figure 6.2.2.2-2 of solution 2\. The UE will not attempt to access the Home
SP services via the Home SP\'s N3IWF; however, the Home SP will not reject
UE\'s attempt if there is one, and will accept it as a normal N3GPP
registration.
During mobility scenarios (Figure 6.41.2-1, 6.41.2-2, 6.41.2-5), the target
network may inform the UE of a mobility indication to instruct UE to handover
the PDU Session anchored at the Home SP during UE registration with the target
network. This mobility indication is per PDU session, and it is made by the
AMF based on the interworking situations between the target network and the
Home SP (e.g. mobility indication set with \"1\" means roaming-like
interworking, mobility indication set with \"2\" means N3IWF-based
interworking, mobility indication set with \"3\" means no interworking
support).
According to the received mobility indication the UE performs the handover of
the PDU session anchored at the Home SP using one of the following procedures,
or according to the local configuration when mobility indication is not
received, the UE performs the handover of the PDU session anchored at the Home
SP using procedures in the following order:
\- PDU Session Establishment procedure with Existing PDU Session indication as
defined in TS 23.502 [6] clause 4.3.2.2.2; this is for PDU session handover in
case of roaming-like interworking;
\- Handover of a PDU Session procedure between 3GPP and untrusted non-3GPP
access Procedure as defined in TS 23.502 [6] clause 4.9.2.3 or 4.9.2.4 that
follows the PDU Session Establishment procedure at the target network as
defined TS 23.502 [6] clause 4.3.2.2.1; this is for PDU session handover in
case of N3IWF-like interworking.
During mobility scenarios (Figure 6.41.2-3, 6.41.2-4, 6.41.2-6), the target
network may inform the UE of a mobility indication to instruct UE how to
handover the PDU Session anchored at the SNPN#1 during UE registration with
the target network.
This mobility indication is per PDU session, and it is made by the AMF based
on the interworking situations between the source network and the target
network (e.g. mobility indication set with \"1\" means roaming-like
interworking, mobility indication set with \"2\" means N3IWF-based
interworking, mobility indication set with \"3\" means no interworking
support).
According to the received mobility indication the UE performs the handover of
the PDU session anchored at the SNPN#1 using one of the following procedures,
or according to the local configuration when mobility indication is not
received, the UE performs the handover of the PDU session anchored at the
SNPN#1 using procedures in the following order:
\- PDU Session Establishment procedure with Existing PDU Session indication as
defined in TS 23.502 [6] clause 4.3.2.2.2; this is for PDU session handover in
case of roaming-like interworking;
\- Handover of a PDU Session procedure between 3GPP and untrusted non-3GPP
access Procedure as defined in TS 23.502 [6] clause 4.9.2.1 or 4.9.2.2 that
follows the PDU Session Establishment procedure at the target network as
defined TS 23.502 [6] clause 4.3.2.2.1; this is for PDU session handover in
case of N3IWF-like interworking;
\- PDU Session Establishment procedure with Initial Request indication as
defined in TS 23.502 [6] clause 4.3.2.2.1; this is for PDU session handover in
case of no support of interworking;
The UE registers within the SNPN#2 using SUPI assigned by Home SP and includes
the PDU session to handover in [List of PDU Sessions to Be Activated]:
\- In case the SNPN#2 supports roaming-like interworking with Home SP, then
the AMF of SNPN#2 can know where each PDU session in [List of PDU Sessions to
Be Activated] anchors based on UE context in SMF data from the UDM of Home SP,
and determine the mobility indication for each PDU session based on the
interworking situation between the SNPN#2 and the network where this PDU
session anchors. The AMF of SNPN#2 can provide UE with the information where
each PDU session anchors and the mobility indication indicating which
procedure to use for handover of each PDU session;
\- In case the SNPN#2 does not support roaming-like interworking with Home SP,
the AMF of SNPN#2 determines the Home SP using SUPI from UE and assumes that
each PDU session in [List of PDU Sessions to Be Activated] anchors at the Home
SP. The AMF of SNPN#2 can provide UE with the information that each PDU
session anchors at Home SP, as well as with the mobility indication for each
PDU session indicating to use Handover of a PDU Session procedure between 3GPP
and untrusted non-3GPP access Procedure as defined in TS 23.502 [6] clause
4.9.2.3 or 4.9.2.4. The UE tries to handover each PDU session towards the Home
SP based on the mobility indication. For each failed PDU session that
handovers towards the Home SP, the UE again tries to handover this PDU session
towards the SNPN#1 based on the mobility indication;
On one hand, the AMF of SNPN#2 may provide UE with the information where each
PDU session anchors. On the other hand, the UE is aware of the SNPN#1 and the
Home SP, so the UE can first try to handover the PDU session towards the Home
SP using mobility indication or local configuration. If the handover of a PDU
session procedure fails, the UE can again try to handover the PDU session
towards the SNPN#1 using mobility indication or local configuration.
Alternatively, the AMF within the source network may provide the mobility
assistance information (e.g. allowed SNPN list, information where each PDU
session anchors, mobility indication for each PDU session per candidate target
network) during the registration procedure. In the case that source network
and Home SP support Inter-PLMN like interworking, the AMF within the source
network can obtain the allowed SNPN list, DNN/S-NSSAI subscription (whether
LBO roaming is allowed) from UDM of Home SP, therefore the AMF can know where
each PDU session anchors and the candidate target networks. For each candidate
target network, the AMF determines the interworking situation between source
network and target network, the interworking situation between Home SP and
target network, so that the AMF can know mobility indication indicating which
procedure to use for each PDU session handover. Based on such mobility
assistance information, the UE may select SNPN supporting the expected
procedure for PDU Session handover if the UE selects target SNPN based on
manual selection. In the case that source network and Home SP do not support
Inter-PLMN like interworking, the AMF does not provide the mobility assistance
information. Therefore, the UE will assume that all the PDU sessions anchor at
the source network. Based on the mobility indication (if provided by the
source network) or local configuration the UE can perform handover of PDU
session as described in previous paragraphs.
NOTE 1: Usage of mobility assistance information for network selection needs
evaluation and confirmation from SA1 and CT1.
NOTE 2: The Home SP SEPP/IPUPS entity used for interactions between Home SP
and SNPN is recommended to be deployed independently from the ones used for
roaming with other PLMNs. In addition, they can be deployed distributed or
locally within the Home SP to mitigate the configuration and routing load, as
well as optimize the routing path and simplify the maintenance work.
### 6.41.3 Procedures
Refer to solution 1 or solution 2.
### 6.41.4 Impacts on existing entities and interfaces
Besides the impacts captured in solution #1 or #2, the UE needs to support of
mobility indication or local configuration for service continuity of PDU
session handover, the 5GC may support allowed SNPN list subscription and
determination of mobility indication for the PDU session, the RAN may support
the allowed SNPN list for HO trigger.
Impacts on AMF of source network if mobility assistance information is
provided by source network:
\- In the case that source network and Home SP support Inter-PLMN like
interworking, the AMF within the source network may provide UE with the
mobility assistance information (e.g. allowed SNPN list, information where
each PDU session anchors, mobility indication for each PDU session per
candidate target network) during the registration procedure
Impacts on AMF of target network if mobility assistance information is
provided by target network:
\- The AMF determines the mobility indication for each ongoing PDU session
based on the interworking situation between the target network and the network
where this PDU session anchors, provides UE with the information where each
PDU session anchors and the mobility indication indicating which procedure to
use for handover of each PDU session
Impacts on UE:
\- According to local configuration or the received mobility indication from
source/target network, the UE performs the handover of the PDU session within
the target network.
## 6.42 Solution #42: Optimization of SP info in SIB
### 6.42.1 Introduction {#introduction-46}
This solution addresses key issue#1 \"Enhancements to Support SNPN along with
credentials owned by an entity separate from the SNPN\". It assumes the
architecture according to solution #2 and the issue addressed with this
solution is how it is possible to reduce the amount of SP identities announced
in SIB without introducing new identities like for example roaming groups.
This is achieved by a shared SP-ID which is handled by UE and RAN exactly as
any SP-ID but is in fact a shared SP-ID between a well-defined set of service
providers. Each service provider can be part of zero, one or many shared SP
sets. It is assumed that SP identities can be based on NID (potentially
together with a PLMN id) and then a shared SP identity is also a NID. A shared
SP identity is allocated in the same way as a NID.
### 6.42.2 Functional Description
#### 6.42.2.1 Definitions {#definitions-5}
The following definitions apply on top of the definitions in 6.2.2.1:
**Shared SP-ID:** Identifies a set of service providers and is in the same
format as Home SP-ID.
#### 6.42.2.2 System information broadcast
NG-RAN nodes which support access using Home SP credentials broadcast the
following information per SNPN:
\- Indications on support for home SP credentials according to solution #1 and
optionally also indication for \"under configured UEs\" as described in
solution #9.
\- List of supported Home SP IDs where one or more of the identities can be
shared SP-IDs.
Editor\'s note: SIB details will be determined by RAN WG2.
#### 6.42.2.3 UE configuration
UE is configured according to solution #1 but with the addition of:
\- Each home SP subscription can have a list of SP identities where one or
more of the identities can be a shared SP-ID.
### 6.42.3 Procedures
#### 6.42.3.1 Network selection
Network selection is done according to solution #1 but when UE has exhausted
all the PLMN ID or PLMN ID + NID tuples in the configured list without finding
a match with the network identities advertised on the radio interface, the UE
can read the announced list of supported Home SP IDs and compare with the list
of SP identities in the UE home SP subscription.
Editor\'s note: As this solution proposes to extend the PLMN selection
procedure, SA WG1 needs to first clarify the related service requirements.
### 6.42.4 Impacts on services, entities and interfaces
Additional impact compared to solution #1:
UE:
\- UE is configured with list of home SP-ID for each home SP subscription.
NG-RAN:
\- Broadcast of additional information.
## 6.43 Solution #43: Network Selection using Home SP subscription to access a
supported SNPN
### 6.43.1 Introduction {#introduction-47}
Editor\'s note: This clause lists the key issue(s) addressed by this solution,
and briefly the main principles of the solution.
The proposed solution resolves the issue of network selection addressed in
KI#1 for a UE using Home SP subscription (which may be a PLMN subscription or
an SNPN subscription) to select an SNPN for which the UE does not have a
subscription. The proposed network selection relies on the UE being
additionally configured with a list of Supported SNPNs i.e. SNPNs that can be
accessed using the UE\'s Home SP subscription. The Home SP subscription and
associated data are as defined as per legacy i.e. PLMN or SNPN. .
### 6.43.2 Functional Description
Editor\'s note: This clause further details the solution principles and any
assumptions made.
#### 6.43.2.1 Definition and Terminology
Home SP: a service provider which owns the UE subscription. The Home SP can be
a PLMN or an SNPN.
Supported SNPN: an SNPN for which the UE does not have a subscription but that
the UE may access using its Home SP subscription.
Supported SNPN List: A list of one or more Supported SNPN identifiers that the
UE is allowed to access using its Home SP subscription. It is configured to
the UE by the Home SP.
Home SP indication: An indication broadcast by an SNPN cell informing whether
access to this cell is allowed for UEs using their Home SP subscription.
#### 6.43.2.2 General
The solution only focuses on the issues of network selection in KI#1. After UE
performs network selection, the registration and authentication procedures can
be referred to the other solutions in current TR.
The solution introduces the following:
\- UE is configured by a Home SP with corresponding subscriber identifier,
credentials as per legacy (i.e. legacy PLMN information or Rel-16 SNPN
information), and a Supported SNPN List which contains the Supported SNPN
ID(s) (i.e. corresponding PLMN IDs and NIDs).
\- The Supported SNPN List can only be updated by the Home SP via Steering of
Roaming information mechanism as defined in TS 23.122 [5] or via UE Parameters
Update procedures defined in clause 4.20 of TS 23.502 [6] in case UE is
accessing to Home SP indirectly via an Serving SNPN.
\- The Supported SNPN List lists SNPN ID(s) in a prioritized order (e.g. the
first listed SNPN ID is of highest priority among the Supported SNPNs, etc.
and the last listed SNPN ID is of lowest priority among the Supported SNPNs).
The Home SP has a higher priority than any of the Supported SNPNs.
\- Two alternative network selections are proposed depending whether or not
SNPN Access Mode is kept in Rel-17. Only one alternative is to be specified.
\- With SNPN Access Mode (preferred): Network selection operates such that the
UE in SNPN Access Mode attempts to select a suitable SNPN cell of the Home SP
(if the Home SP is an SNPN) or of a Supported SNPN (if the Home SP is a PLMN
or an SNPN), see clause 6.43.2.3.1.
\- Without SNPN Access Mode: Network selection operates such that the UE
prioritizes PLMN Selection (if the Home SP is a PLMN) over SNPN Selection. If
the Home SP is an SNPN, the UE operates SNPN selection only. See clause
6.43.2.3.2.
\- An SNPN cell broadcasts an Home SP indication as defined in clause
6.43.2.1.
#### 6.43.2.3 Network selection
##### 6.43.2.3.1 Re-using SNPN Access Mode (preferred)
For Single Radio UEs, network selection is performed as Figure 6.43.2.3.1-1.
Network selection operates as illustrated in the diagram below:
Figure 6.43.2.3.1-1: SNPN selection
\- If UE is not in SNPN access mode:
\- the UE follows PLMN selection rules as defined in TS 23.122 [5].
\- Otherwise i.e. if the UE is in SNPN access mode:
\- if the Home SP is a PLMN
\- the UE shall attempt to camp on a suitable cell of the highest priority
Supported SNPN.
\- if the UE is not able to camp on a suitable cell of the highest priority
Supported SNPN, it shall attempt to camp on a suitable cell of the next
highest priority Supported SNPN, etc.
\- otherwise, if the Home SP is an SNPN
\- the UE shall attempt to camp on a suitable cell of the Home SP.
\- if the UE is not able to camp on a suitable cell of the Home SP, it shall
attempt to camp on a suitable cell of the highest priority Supported SNPN.
\- if the UE is not able to camp on a suitable cell of the highest priority
Supported SNPN, it shall attempt to camp on a suitable cell of the next
highest priority Supported SNPN, etc.
\- If the UE is not able to camp on a suitable cell of the Home SP or of any
Supported SNPN:
\- the UE shall attempt to camp on an acceptable cell as specified in TS
23.122 [5], in limited service state.
A suitable cell of a Supported SNPN is a cell meeting the suitability criteria
as defined in RAN groups, broadcasting the SNPN ID of the Supported SNPN, and
broadcasting a Home SP Indication (for this SNPN) indicating access to this
cell is allowed for UEs using their Home SP subscription.
For Dual Radio UEs capable of simultaneously connecting to an SNPN and a PLMN,
network selection is performed as Annex D4 of TS 23.501 [4] with the
difference that:
\- If UE decide to uses SNPN for its services, UE select the SNPN based on the
supported SNPN list as described in clause 6.43.2.2.
The UE is not allowed to use the same subscription to be registered via 3GPP
access on both SNPN and a PLMN network at the same time.
##### 6.43.2.3.2 Not re-using SNPN Access Mode
If reusing SNPN Access Mode is not desired i.e. network selection then fully
aggregates PLMN and SNPN selection, it is proposed that PLMN selection always
takes priority over SNPN selection i.e. if the Home SP is a PLMN, PLMN
selection takes place first, followed by SNPN selection should no suitable
cell be found at PLMN selection.
NOTE: the above proposal to prioritize PLMN selection over any SNPN selection
may be too simplistic in practice when SNPN Access Mode is not used. Priority
selection should be considered between PLMNs and SNPNs that could e.g. allow
the UE to prioritize selecting e.g. its Office SNPN over a PLMN when under
suitable coverage of both.
Network selection in this case operates as described below (showing PLMN
selection being prioritized over SNPN selection):
Figure 6.43.2.3.2-1: Network selection without SNPN Access Mode
\- If the Home SP is a PLMN
\- the UE follows PLMN selection rules as defined in TS 23.122 [5].
\- if the UE is unable to camp on a suitable cell following these rules and if
the UE is configured with a Supported SNPN list
\- the UE shall attempt to camp on a suitable cell of the highest priority
Supported SNPN
\- if the UE is not able to camp on a suitable cell of the highest priority
Supported SNPN, it shall attempt to camp on a suitable cell of the next
highest priority Supported SNPN, etc.
\- Otherwise i.e. if the Home SP is an SNPN
\- the UE shall attempt to camp on a suitable cell of the Home SP SNPN
\- if the UE is unable to camp on a suitable cell of the Home SP SNPN and if
the UE is configured with a Supported SNPN list
\- the UE shall attempt to camp on a suitable cell of the highest priority
Supported SNPN.
\- if the UE is not able to camp on a suitable cell of the highest priority
Supported SNPN, it shall attempt to camp on a suitable cell of the next
highest priority Supported SNPN, etc.
\- If the UE is not able to camp on a suitable cell of the Home SP or of any
Supported SNPN:
\- the UE shall attempt to camp on an acceptable cell as specified in TS
23.122 [5], in limited service state.
The same definition as described above for a suitable cell of a Supported SNPN
is used.
### 6.43.3 Procedures
Editor\'s note: This clause describes procedures and information flows for the
solution.
The network selection procedure is defined in clause 6.43.2.3.
### 6.43.5 Impacts on existing entities and interfaces
Editor\'s note: This clause lists impacts to existing entities and interfaces.
UE:
\- is configured with the Supported SNPN List by its home network (Home SP).
\- performs network selection taking into account the Supported SNPN List and
the Home SP Indication broadcast in NG-RAN.
NG-RAN
\- broadcast of Home SP indication
## 6.44 Solution #44: UE external subscription data management in the SNPN
### 6.44.1 Introduction {#introduction-48}
In the case, it is to address how the SNPN to obtain the UE\'s subscription
data owned by 3rd party (e.g. AAA-Server). Due to business requirement or
other reason, the 3rd party has an agreement with the SNPN that can
store/manage the UE\'s subscription data locally in SNPN UDM so that the
necessary procedures (e.g. registration procedure, PDU session management
procedure, etc.) can be completed with the UE\'s subscription data.
The subscription data includes:
\- Session related subscription data.
\- Access and mobility subscription data.
\- Slice related and others.
The assumptions are following:
\- The 3rd party has an agreement with SNPN to store/manage the 3rd party
UE\'s subscription data locally.
\- The 3rd party reformats the subscription data to fit the SNPN UDM based on
the agreement.
NOTE: 3rd party can provide the subscription data that may include the slice
information fit for the SNPN based on agreement if needed.
\- The security parameters are not sent to SNPN so that the authentication and
authorization between SNPN and the 3rd party is not impacted.
\- There is one dedicated UDM in the SNPN which handle the external UE
subscription data, when there are multiple UDMs in the serving SNPN.
Additionally, AMF/SMF/PCF may be preconfigured with the dedicated UDM ID for
UDM selection when the subscription of the UE is stored in 3rd party.
Alternatively, AMF/SMF/PCF may act as the NF consumer to NRF to discover the
UDM instance(s) and selects a UDM instance based on the available UDM
instances obtained from NRF, as described in clause 6.3.8 in TS 23.501 [4].
### 6.44.2 Functional Description
Figure 6.44.2.2-1, it describes overview of the architecture.
Figure 6.44.2.2-1 architecture for UE external subscription data exchange
between UDM and AAA-Server
New potential interface:
\- Interface Y1: between UDM and AAA-Server
NOTE: it is also possible to exchange the subscription data between UDM and
AAA-Server via AUSF, or other 3GPP function defined in future.
### 6.44.3 Procedures
The figure 6.44.3-1 below shows a high-level flow how to enable the SNPN to
obtain UE external subscription data.
Figure 6.44.3-1: High-level flow for UE external subscription exchange between
serving SNPN and AAA-Server
The general procedure is described as following:
1\. 3rd party UE turns on and initiates registration request to the SNPN AMF
via AN, including UE ID
NOTE 1: How the UE discoveries and selects the SNPN can be based on any
applicable mechanisms described in other TR solutions in which the Home SP can
be the 3rd party.
2\. AMF triggers to perform external authentication and authorization between
UE and 3rd party AAA-server.
NOTE 2: external authentication and authorization is in scope of SA WG3.
3\. Once the authentication and authorization is success, AAA-Server
determines whether to send the UE subscription data to the SNPN UDM via based
on the 3rd party policy/service agreement with the SNPN, including UE ID, and
subscription data, e.g. session management subscription data, access and
mobility subscription data, etc.
Since 3rd party has the service agreement with other networks (e.g. SNPN), it
could create and maintain a set of subscription data that is suitable for the
network in advance or on demand.
4\. 3rd party AAA-Server sends the UE\'s subscription to SNPN UDM, including
UE ID, subscription data.
5\. UDM determines if accept and store the UE\'s subscription to the UDR when
receiving the request from 3rd party AAA-Server based on local policy and the
agreement between SNPN and the 3rd party.
6\. UDM feedbacks the result to 3rd party AAA-Server. 3rd party AAA-Server
records the SNPN for which AAA-Server has provisioned UE subscription data.
7\. SNPN completes the registration procedure. During this step, SNPN may
generate UE configuration parameters (e.g. NSSAI, DNN, etc) based on the
subscription data provided by 3rd party and send the UE configuration
parameters to UE.
8\. If the UE subscription data in 3rd party AAA-Server is changed, and 3rd
party AAA-Server has provisioned UE subscription data to SNPN UDM before UE
subscription data is changed, 3rd party AAA-Server sends the updated UE
subscription data to corresponding SNPN UDM.
9\. UDM feedbacks the result to 3rd party AAA-Server.
### 6.44.4 Impacts on services, entities and interfaces
Impacts on UDM and AAA-Server
\- Exchange the subscription data between UDM and AAA-Server.
Impacts on UE, SNPN and AAA-Server
\- SNPN supports External authentication and authorization between UE and AAA-
Server.
## 6.45 Solution #45: enhanced Steering of Roaming for SNPN/PLMN
### 6.45.1 Introduction {#introduction-49}
Key Issue #1 is aim to enable one SNPN to support the UEs from other separate
party, e.g. SNPN/PLMN. This solution is focusing on the case that separate
party is SNPN and to address only how the home SNPN/PLMN of the UE to update
the roaming information (e.g. list of allowed SNPN(s)) when the UE accesses to
the visited SNPN. This solution is based on Solution#1 and Solution 2, and
provides alternative way to update the list of allowed SNPN(s) comparing to
other methods \"UE Configuration Update\" and \"UE Parameter Update\"
described in Solution#1 and Solution#2.
There are following assumptions:
\- There is \"list of allowed SNPN(s)\" is stored in UE, and referring to the
information that indicates which SNPN/PLMN can allow the UE to access.
\- Enhanced steering of roaming (eSoR) is defined to carry the higher priority
SNPN(s)/PLMN(s) information to UE so that the home SNPN/PLMN can steering the
UE to a desired SNPN.
\- Enhanced steering of roaming (eSoR) includes list of allowed higher
priority SNPN(s) /PLMN(s) (SNPN identity defined as PLMN ID or combination of
PLMN ID and NID) , and optional the unified access control information
Editor\'s note: the terms of the \"list of allowed SNPN(s)\" and \"list of
allowed higher priority SNPN(s)/PLMN(s)\" will be adapt to the conclusion
regarding to solution 1 and solution 2;
Editor\'s note: Steering of Roaming terminates in the UICC. Whether and how
similar mechanisms can be supported is up to SA WG3.
Editor\'s note: It is to be clarified with SA WG1 whether there are
requirements to support SoR for a combination of NPN/PLMN.
### 6.45.2 Functional Description
Figure 6.45.2.2-1, it describes overview of the architecture, which has no
impact on existing architecture.
Figure 6.45.2.2-1 architecture of Steering and Roaming for SNPN/PLMN
### 6.45.3 Procedures
#### 6.45.3.1 Steering of UE in vSNPN during registration
Figure 6.45.3.1 shows the flow for Steering of UE in vSNPN during
registration, which referring to the flow as in TS 23.122 [5].
Figure 6.45.3.1 Steering of UE in vSNPN during registration
Procedureï¼š
1\. The UE initiates registration by sending Registration Request message to
the vSNPN AMF;
2\. The vSNPN AMF invokes Nudm_SDM_Get service operation message to the
hSNPN/hPLMN UDM to get the Access and Mobility Subscription data for the UE.
3\. The UDM determines if send the eSoR information to UE due to initial
registration in a vSNPN based on the indication in the subscription data.
4\. The hSNPN/hPLMN UDM sends a response to the Nudm_SDM_Get service operation
to the vSNPN AMF, which includes the eSoR information.
5\. The vSNPN AMF also invokes Nudm_SDM_Subscribe service operation to the
hSNPN/hPLMN UDM to subscribe to notification of changes of the eSoR
information.
6\. The vSNPN AMF send the received eSoR information to the UE in the
Registration Accept message;
7\. The UE performs steering of roaming information security check.
8\. UE sends the acknowledgement to the UDM in Registration Complete message
If the UDM has requested an acknowledgement from the UE
9\. vSNPN AMF sends the acknowledgement to UDM if any in step 8)
10\. UE may determine to make network re-selection based on the received eSoR
information.
#### 6.45.3.2 Steering of UE in vSNPN after registration
Figure 6.45.3.2 shows the flow for Steering of UE in vSNPN after registration,
which referring to the flow as in TS 23.122 [5].
Figure 6.45.3.2 Steering of UE in vSNPN during registration
Procedure:
1\. The UDM notifies the changes of the user profile to the affected AMF by
the means of invoking Nudm_SDM_Notification service operation, which including
the eSoR information
2\. The AMF sends a DL NAS TRANSPORT message to the served UE, including the
eSoR information
3\. The UE performs steering of roaming information security check.
4\. If the UDM has requested an acknowledgement from the UE and the security
check in step 2 was successful, the UE sends the acknowledgement in UL NAS
TRANSPORT message to the vSNPN AMF.
5\. vSNPN AMF sends the acknowledgement to hSNPN/hPLMN UDM if any in step 4)
6\. UE may determine to make network re-selection based on the received eSoR
information.
### 6.45.4 Impacts on services, entities and interfaces
UE:
\- Support for configuring and handle the new additional SNPN list (_list of
allowed SNPN_)
\- Support for handling the _list of allowed higher priority SNPN/PLMN_ from
home SNPN/PLMN
UDM:
\- Support for additional list of higher priority SNPN/PLMN information (list
of allowed higher priority SNPN/PLMN) in steering of roaming.
## 6.46 Solution #46: Steering a single access UE to use Uu interface of the
SNPN or the PLMN
### 6.46.1 Introduction {#introduction-50}
The solution addresses key issue #2 \" NPN support for Video, Imaging and
Audio for Professional Applications (VIAPA)\". It applies for a single radio
UE with both a SNPN subscription and at least a PLMN subscription as exemplify
in figure 6.46.1-1:
Figure 6.46.1-1: Example of a single radio capable UE with both a SNPN and
multiple PLMN subscriptions
Note that Figure 6.46.1-1 shows multiple PLMNs, however the typical case is
that the UE is subscribed to one PLMN only and multiple PLMNs are shown for
illustration purposes only. So this means that this solution is not related
with the number of PLMN subscriptions a UE has.
This solution proposes a mechanism to allow the network to steer a single
access UE to use a certain Uu interface for VIAPA traffic, either via PLMN or
SNPN and then use IPSec tunnel via N3IWF in the other network to send or
receive other type of data from the other network.
The selection of the Uu interface to use for VIAPA services is based on
operator policies that take into account:
\- the SLA between the PLMN and the SNPN indicating that UEs acceding VIAPA
application or VIAPA DNN from other NWs can be served.
\- User preferences, that may be either stored in the UDR or received from the
UE in NAS signalling.
\- UE capabilities to support SNPN mode and
\- QoS sustainability analytics
Two possible scenarios are shown below:
Figure 6.46.1-1. VIAPA traffic delivered over PLMN. The UE is connected to
PLMN via Uu interface
Figure 6.46.1-2. VIAPA traffic delivered over SNPN. The UE is connected to
SNPN via Uu interface
### 6.46.2 Functional Description
#### 6.46.2.1 General
Some assumptions are listed below:
\- The UE is the area which is covered by the NG-RAN of both PLMN and SNPN.
\- Both networks (PLMN and SNPN) can be operated by different operators.
\- The user has separated subscriptions to both PLMN and SNPN. Alternatively,
as SNPN is less regulated and for more local service, the UE does not have
subscription with the SNPN, but SLA between the SNPN and the PLMN exist to
serve X number of PLMN UEs PDU session for VIAPA applications or for VIAPA
DNN.
\- The SNPN operator can have a business agreement with the PLMN operators
serving the area where the UE is located.
\- The Data services being provided in this VIAPA KI are very demanding in
terms of QoS.
When the user has a separate subscription to both PLMN and the SNPN, each
Network may provide UE Policies that indicates that the traffic of VIAPA
Application X should be transferred a different NW and the indication of the
subscription to be used for Network selection. As result of this evaluation,
the UE may select a different NW, either the PLMN or the SNPN, registers and
is configured with URSP rules that indicate the characteristics of the PDU
session for this VIAPA application (among other URSP rules that may also be
provided).
When the user has a subscription to the PLMN only and no subscription with the
SNPN exists, the PLMN provides UE Policies that indicate that the traffic of
VIAPA Application X should be transferred over the Uu interface of the SNPN,
including the SNPNid. The UE registers to the SNPN, note that in KI#1 is
studied how to access the SNPN using credentials owned by the PLMN, those
solutions can be used in this case as well. The SNPN sends URSP rules that
indicate the characteristics of the PDU session for this VIAPA application
(among other URSP rules that may also be provided). These rules are generated
based on the roaming agreements with the PLMN.
The UE may still register to the other NW via IPSec to the N3IWF of the other
network to transfer other services that do not require Uu interface as
depicted in Figure 6.46.1-1 and Figure 6.46.1-2.
#### 6.46.2.2 High-level Procedures
##### 6.46.2.1.1 General description
The high-level flow describes the scenario where the VIAPA ASP checks with the
PLMN the QoS requirements to serve the UEs that bought tickets for the
concert. The PLMN has an SLA with an SNPN. The SNPN may be either less
regulated and more a local service where the UE does not have a subscription
with the SNPN or the UE may have a subscription with the SNPN. The procedure
below aims to depict both options.
The high level flow is also applicable for the scenario where VIAPA ASP checks
with the SNPN the QoS requirements to serves the UEs and then the PLMN has an
SLA with an SNPN covering the same area where the VIAPA service is to be
delivered. The reader is assumed to understand that in this case the VIAPA ASP
checks with the PLMN and the PLMN checks SLA with SNPN, and other data to take
into account if the VIAPA service can be served for the UEs attending the
concert. Later if a UE registers in the SNPN, it may be moved to his PLMN
instead.
Figure 6.46.2.2-1: Checking QoS requirements for VIAPA applications - overview
1\. The following steps takes place at the time the VIAPA ASP, the SNPN and
the PLMN prepare to deliver VIAPA services:
\- The VIAPA Application Service Provider configures its portal with
information on the SNPN to be used for delivering the VIAPA application to
their consumers.
\- The PLMN configures its network with the list of SNPNs that has an
agreement with. For each SNPN, the SLA indicates the number of PLMN UE PDU
sessions for VIAPA applications (or for VIAPA DNN) that can be served.
2\. A number of users buy tickets to the concert.
3\. The VIAPA ASP portal informs the PLMN about the number of UEs (and its
identities) that bought tickets, the area where the concert will take place,
the type of Application that will be delivered and the time of the day. The
VIAPA ASP informs on the duration of the concert (i.e. time when the concert
ends).
4\. The PLMN checks QoS requirements then estimates using analytics whether
QoS degradation may happen. If PLMN estimates that QoS requirements can be
fulfilled for all the VIAPA sessions, then step 6 follows.
5\. If the PLMN estimates that QoS requirements can be fulfilled for a subset
of all the VIAPA sessions, then checks the SLA with the PLMN(s) that serve the
area where the concert will take place and the users that bought a tickets .
The PLMN determines, based on UE capabilities to support SNPN mode, QoS
sustainability analytics, user preferences, which UE PDU sessions for VIAPA
applications should be served by the SNPN.
6\. As result of the above process, the PLMN knows the list of UEs that use
PLMN Uu access for VIAPA service and the list of UEs that use SNPN Uu access
for VIAPA service. Then, at the time the UE registers to the PLMN where it has
a subscription, the network provides URSP rules to indicate whether the PLMN
Uu interface should be used to transfer the VIAPA traffic or a UE Policy to
indicate that registration to the SNPN is needed. The UE Policy includes, both
the VIAPA traffic identifier (such as IP 3- tuple or DNN) the indication of
the subscription to use for NW selection (if the SNPN does not require to have
subscriptions, then the SNPN id is provided to the UE instead) and a validity
time. When the UE determines that the UE Policy is applicable to VIAPA
application the UE checks the indication of the subscription to be used for NW
selection or the SNPN id, then registers to the SNPN.
NOTE 1: When the UE Policy is a URSP rule, the UE determines if the URSP
policy is applicable to VIAPA traffic as defined in TS 23.503 [14] clause
6.6.2.1. For a UE Policy that is not a URSP rule, but still contains a traffic
descriptor the same procedure as described in TS 23.503 [14] clause 6.6.2.1
applies
NOTE 2: The indication of the subscription to use for network selection may be
part of the URSP rule or a separate indication in a new UE Policy.
The UE determines the URSP rules that are applicable to VIAPA traffic by
evaluating the traffic descriptor as defined in clause 6.6.2.1 in TS 23.503
[14]. Since the URSP rules are evaluated when the UE is registered in the PLMN
or the SNPN, then the UE evaluates the URSP rules that are provided by that
network. The same applies for a new UE Policy. The UE evaluates the URSP rules
of the active network subscription.
When the validity time expires, or the UE gets out of the area where the
concert takes place, the UE removes the UE Policy (e.g. URSP rule) for the
VIAPA service, then falls back to decision per local policy for which
subscription to use for network selection.
#### 6.46.2.3 How to indicate to the UE which Uu interface to use for VIAPA
traffic.
**Method 1: Extending URSP rules**
The RSD in the URSP rule is extended to indicate the subscription to use for
Network selection as described below:
Table 6.46.2.3-1: Route Selection Descriptor extended with \"indication on
subscription to use for NW selection\"
+--------------+--------------+-----------+--------------+------------+ | Information | Description | Category | PCF | Scope | | name | | | permitted to | | | | | | modify in | | | | | | URSP | | +==============+==============+===========+==============+============+ | **Route | *This part | Mandatory | | | | selection | defines the | | | | | components** | route | | | | | | selection | | | | | | components* | | | | +--------------+--------------+-----------+--------------+------------+ | Access Type | Indicates | Optional | Yes | UE context | | preference | the | | | | | | preferred | | | | | | Access Type | | | | | | (3GPP or | | | | | | non-3GPP or | | | | | | M | | | | | | ulti-Access) | | | | | | when the UE | | | | | | establishes | | | | | | a PDU | | | | | | Session for | | | | | | the matching | | | | | | application. | | | | | | | | | | | | The | | | | | | preferred | | | | | | access type | | | | | | may include | | | | | | a reference | | | | | | to the NW | | | | | | subscription | | | | | | to be used | | | | | | for the | | | | | | matching | | | | | | application. | | | | +--------------+--------------+-----------+--------------+------------+
Table 6.46.2.3-2: SNPN URSP rules to route VIAPA App1 using the PLMN_1
subscription
+----------------------------------+----------------------------------+ | Example SNPN URSP rules | Comments | +==================================+==================================+ | Traffic descriptor: VIAPA App1 | This SNPN URSP rule associates | | | the traffic of application | | Route Selection Descriptor | \"VIAPA App1\"with the | | Precedence=1 | subscription of the | | | | | Access Type preference: | PLMN_id_1 should be used for | | | network selection. | | subscription PLMN id_1 | | +----------------------------------+----------------------------------+
The UE may register on an equivalent PLMN, however the selected PCF to provide
PCC Rules is the PCF that serves the UE in its PLMN and equivalent PLMNs.
The UE may register on a different PLMN that may not have agreements with SNPN
to serve their UEs, not equivalent one, then the UE may observe QoS
degradation, since there was no agreement between the PLMN and the SNPN to
provide QoS.
Table 6.46.2.3-3: PLMN URSP rules to route VIAPA App1 though 3GPP access of
PLMN_1
+----------------------------------+----------------------------------+ | Example PLMN URSP rules | Comments | | (PLMN_URSP_1) | | +==================================+==================================+ | Traffic descriptor: VIAPA App1 | This PLMN URSP rule associates | | | the traffic of application | | Route Selection Descriptor | \"VIAPA App1\" with S-NSSAI-a, | | Precedence=1 | SSC Mode 3, the \"internet\" DNN | | | and 3GPP Access. | | Network Slice Selection: | | | S-NSSAI-b | | | | | | SSC Mode Selection: SSC Mode 3 | | | | | | DNN Selection: internet | | | | | | Access Type preference: 3GPP | | | access | | +----------------------------------+----------------------------------+
**Method 2: A new UE Policy**
A UE Policy to indicate which subscription to use for NW selection for VIAPA
applications or VIAPA DNNs is described below:
Table 6.46.2.3-4: New UE Policy that associates VIAPA traffic with the
subscription to be used for NW selection
+---------------------------+---------------------------+-----------+ | Information name | Description | Category | +===========================+===========================+===========+ | **Traffic descriptor** | Application descriptor or | Mandatory | | | IP descriptor or DNN | | +---------------------------+---------------------------+-----------+ | **Indication on | Indicates the | Mandatory | | subscription to use for | subscription to use for | | | NW selection** | NW selection when the UE | | | | detects an application | | | | matching the traffic | | | | descriptor. | | | | | | | | If a match is found, the | | | | UE uses the indication to | | | | select a subscription to | | | | trigger NW selection. | | +---------------------------+---------------------------+-----------+ | **Validity time** | Indicates the validity of | Optional | | | the UE Policy, the UE | | | | removes the UE Policy | | | | when the validity time | | | | expires. | | +---------------------------+---------------------------+-----------+ | **Location criteria** | Indicates the area where | Optional | | | the UE Policy applies. | | +---------------------------+---------------------------+-----------+
Note that the UE may have other applications running, and those will be
interrupted if the UE decides to select a different NW when the UE Policy
becomes active. The UE may prioritize applications such as the regulatory
services, or emergency services or mission critical.
The UE Policy is provided to the UE only if user consent is given. The user
consent to be moved to a different network is either stored as part of the
user preferences or may be a separate indication. This is described in clause
6.46.3.1.
### 6.46.3 Procedures
#### 6.46.3.1 Initial provisioning of QoS requirements from the ASP to the
PLMN
Prior to transfer of VIAPA applications, both the ASP provides QoS
requirements for an initial check at the PLMN, the ASP provides the number of
UEs that are registered for the event, their location and the time of the day.
The PLMN requests predictions on QoS Sustainability to know the number of QoS
flows (for VIAPA services) that will be released in the area and time where
the UEs will be located. If the number reaches a threshold, then the PLMN
considers that there will be QoS degradation and will determine with UE should
use Uu interface in the SNPN to access VIAPA application, this decision
depends on SLA between the PLMN and the SNPN, UE support to connect to SNPN
and user preferences.
Figure 6.46.3.1-1. VIAPA ASP negotiates a Transfer Policy for users of the
VIAPA application
1\. Web portal at the ASP offers tickets to VIAPA application to end users. At
some point in time, before the VIAPA application starts, the ASP informs the
PLMN, using Nnef_Negotiate_Transfer_Policy Request service operation that a
number of users, list of users, will use a VIAPA application, at certain time
and location, and the duration.
2\. The PLMN NEF authorizes the ASP request, select then send
Npcf_Negotiate_Transfer_Policy Request to the PLMN PCF to handle the ASP
request, this can be any PCF supporting this capability or service. The PLMN
PCF checks the QoS requirements for the VIAPA application, the number of users
and their location/time and determines using local policies and analytics on
the \"QoS sustainability\" in the location (i.e. gNB) where UEs would be
located, and the 5QI of the VIAPA application. If the PLMN PCF estimates that
the users of the VIAPA application would not experience QoS degradation, since
the QoS sustainability threshold is not met then step 6 takes place.
3\. The PLMN PCF may decide that QoS sustainability threshold will not be met
and then determine which UE should use Uu interface in one of SNPN that has an
agreement with to access VIAPA application. The PCF determines which UEs
should use the Uu interface of the SNPN based on the SLA that the PLMN has
with the SNPN, UE capabilities, user preferences, and operator policies.
4\. The PLMN PCF stores the PLMN_Transfer_Policy Id and its context into PLMN
UDR using Nudr_DM_Create_Request for Data Set Application data.
5\. The PLMN UDR sends Nudr_DM_Create_Response.
6\. The PLMN PCF sends Npcf_Negotiate_Transfer_Policy Response to SNPN NEF
including the PLMN _Transfer_Policy_Id.
7\. The SNPN NEF sends Nnef_Negotiate_Transfer_Policy Response including the
PLMN _Transfer_Policy_id that indicates whether some users may experience QoS
degradation based on predictions, and its VIAPA traffic will be transfer via
SNPN or whether VIAPA traffic of all UEs will be transferred via the PLMN.
**Example:**
\- AF informs that VIAPA_App_1 is delivered to 100 users, (GPSI_1, GPSI_100),
geographical area and time of day.
\- NEF translate GPSI. Geographical area to SUPI and area of interest.
\- PLMN PCF calculates 5QI, PER and PDB for VIAPA_App_1. PCF subscribes to
NWDAF to report predictions on QoS retainability when threshold is reached,
threshold is set to 10, area of interest (gnB) and time of day.
\- PLMN PCF is informed that QoS retainability threshold is reached, so that
10 QoS flows are predicted to be released.
\- PLMN PCF checks which SNPN has a SLA with and determines which UEs should
use Uu interface of the SNPN.
\- PLMN PCF informs the VIAPA ASP via PLMN NEF on which UEs will be served by
the PLMN and which UEs will be served by the SNPN.
#### 6.46.3.2 Provisioning of NW preferences on the Uu interface to use for
VIAPA applications to the UE
The procedure for UE Policy Association Establishment defined in TS 23.502 [6]
clause 4.16.11 is used, and then the PCF provides a new UE Policy (method 2)
or a URSP Rule (method 1) to route VIAPA traffic via a different Network.
Note that Figure 6.46.3.2-1 shows multiple PLMNs, however the typical case is
that the UE is subscribed to one PLMN only and the input for selection of the
subscription to use will select the Subscription of PLMN.
Figure 6.46.3.2-1. input for selection of subscription in the UE to use for
Network selection
Editor\'s note: Whether the decision which PLMN subscription to use can be
determined by an SNPN is expected to be confirmed by SA WG1.
The selected NW for VIAPA services should be transparent to the application
itself that will start sending and receiving traffic prior to the actual
content is delivered.
As part of the preparation for the concert, both SNPN and PLMN operator decide
the model to follow, i.e. either the SNPN may move some users to their PLMN or
the PLMN may move some users to the local SNPN. Then if e.g, the SNPN moves
users to its PLMN, the SNPN provides UE Policies to those UEs and the PLMN
does not provide UE Policies to any UE.
### 6.46.4 Impacts on existing entities and interfaces
NEF:
\- New service to request negotiation of transfer policy for VIAPA
applications.
PCF:
\- New service to request negotiation of transfer policy for VIAPA
applications.
\- Subscription to NWDAF Analytics on QoS Sustainability for GBR QoS flows for
a 5QI, PDB, PER corresponding to a VIAPA application.
\- Store Transfer Policy indicating which UEs will transfer VIAPA applications
via a different Network.
\- Provide URSP rule (method 1) or a new UE policy (method 2) for VIAPA
applications to be transferred over a different Network.
UE:
\- Determine the subscription to use for NW selection be used to send VIAPA
traffic based on the URSP rule extended (method 1) or a new UE Policy (method
2) with the indication of the subscription to use for NW selection.
NWDAF:
\- Providing the number of UEs that will receive VIAPA traffic in the area
where QoS Sustainability is requested.
## 6.47 Solution #47: Support of simultaneous active communication with SNPN
and PLMN by using N3IWF
### 6.47.1 Introduction {#introduction-51}
This solution addresses key issue #2: NPN support for VIAPA based on following
assumptions.
\- A UE has a single RX and a single TX, i.e. activate communication is only
possible with one network.
\- The VIAPA services require high level QoS.
### 6.47.2 Functional Description
The solution uses architecture shown in Figure 6.47.2-1.
Figure 6.47.2-1: SNPN access via N3IWF using a PLMN PDU Session
Because it is assumed that a UE has a single RX and a single TX, the UE can
get a service either over a PLMN or SNPN at a given time. In order to get a
service simultaneously from PLMN and SNPN, the UE registers SNPN via N3IWF
using a PDU Session of PLMN and establishes a PDU Session over non-3GPP access
of the SNPN to get a service of SNPN. Then the UE can get a service not only
from a PLMN but also from an SNPN.
The issue is how to ensure QoS of the SNPN (e.g. VIAPA) service. In order to
guarantee the QoS requirement of the SNPN service, there should be an SLA
between PLMN and SNPN. However, the UE does not know whether there is an SLA
or not. So the SNPN need to provide list of PLMNs that the SNPN has an SLA
during the Registration procedure. The UE should access SNPN via N3IWF only
when the HPLMN of the UE is included in the SNPN provided list.
### 6.47.3 Procedures
Figure 6.47.3-1: Procedure for simultaneous communication with SNPN and PLMN
by using N3IWF
1\. A UE registers to a PLMN via 3GPP access and get a service from the PLMN.
2\. The UE sends Registration Request via 3GPP access. In the Registration
Request message, the UE indicates that it wants to use PLMN service
simultaneously.
3\. The SNPN AMF provides Supported PLMN List which includes the list of PLMNs
that the SNPN has an SLA so that QoS can be supported when the UE access SNPN
via N3IWF using a PDU Session of the PLMN.
4\. If the UE is registered to the PLMN included in the Supported PLMN List,
the UE may register to SNPN via SNPN N3IWF over the PDU Session of the PLMN.
In case of roaming, the UE checks whether the HPLMN is included in the
Supported PLMN List.
If the UE is registered to the PLMN not included in the Supported PLMN List,
the UE may registers to PLMN via PLMN N3IWF over the PDU Session of the SNPN.
The UE handovers 3GPP access PDU Sessions to non-3GPP access and receives
service.
NOTE: If the handover is not allowed due to policies or if the PLMN does not
N3IWF, the UE cannot get a service from SNPN and PLMN simultaneous. In this
case, the UE may need to prioritize service and select either SNPN or PLMN
service and how to do it is up to UE implementation.
5\. The AMF sends Registration Accept message to the UE.
### 6.47.4 Impacts on services, entities and interfaces
UE:
\- provides indication that it wants to use PLMN service simultaneously when
it registers SNPN over 3GPP access.
\- decides whether to access SNPN service via SNPN N3IWF using PLMN PDU
Session based on Supported PLMN List during the SNPN registration.
SNPN AMF:
\- provides Supported PLMN List to the UE during the Registration.
## 6.48 Solution #48: Solution on Key Issue #2 Optimization of service
continuity for mobility between SNPN and PLMN
### 6.48.1 Introduction {#introduction-52}
Current solutions for service continuity is based on the principle that the
anchor will remain unchanged during mobility. However, this principle may
introduce additional service delay during mobility. For example, if the UE
moves from PLMN to SNPN, to keep the service continuity in PLMN, following
procedures are needed:
1\. The UE needs to firstly register to SNPN and establish the PDU Session in
SNPN.
2\. Afterward, the UE needs to register to PLMN and establish the PDU Session
in PLMN (via IPSEC tunnel between UE and PLMN N3IWF) over SNPN.
The procedures in step 2 above will cause additional service delay.
This solution proposes another way that doesn\'t require an unchanged anchor,
and avoids the additional service delay as described above.
### 6.48.2 High-level Description
Assumption of the solution:
\- The VIAPA service can be received via both SNPN and PLMN, e.g. the VIAPA
service in Internet.
\- The VIAPA service can keep service continuity via application layer
mechanism, like Multi-homing, MPTCP, etc.
For example, if the UE moves from PLMN to SNPN and the intention is to keep
the service continuity. The general steps are given as below:
1\. Before the UE moves out of coverage of PLMN, the UE registers to SNPN (via
IPSEC tunnel between UE and SNPN N3IWF) over PLMN and establishes the PDU
Session in SNPN. Note this step will not cause service delay since UE is still
connecting to PLMN and receiving the service.
2\. When the UE moves out of PLMN coverage, the UE register to SNPN (via SNPN
3GPP access) and perform handover procedure to move the PDU Session
established in step 1 to SNPN 3GPP access.
The UE moves the service based on the service continuity mechanism in
application layer in step 1 from the PDU session in PLMN to the new PDU
session in SNPN and resumes the service by handover procedure between non-3GPP
access and 3GPP access in step 2.
The indication from the network (e.g. in the example below from the PLMN) to
establish NWu connection toward the N3IWF in the target network ( e.g. in the
example below to the SNPN), taken considering for example the current UE
location, the network deployment, the SLA between operators (PLMN and SNPN),
the PDU session type, the SSC mode for the PDU session, event or request from
AF, etc, allows to improve the service and session continuity reducing the
time to switch anticipating the registration and PDU session establishment
making it ready. Furthermore the network control may improve also the
consistent behaviour of UEs. However this solution does not preclude decision
taken by UE.
The detailed procedure is given as below:
### 6.48.3 Procedures
Figure 6.48.3-1 Procedure to keep service continuity
0\. UE is registered in PLMN using 3GPP access and with a PDU session
established in PLMN.
1\. PLMN may indicate the UE to activate the non-3GPP access to SNPN via PLMN
using an activation signalling based on information available in the network
(e.g. UE location, network deployment, SLA between operators, request from AF,
etc.). The activation signal includes the information of UE actions to connect
to SNPN (e.g. registration, PDU session establishment, and correspondent
parameters such as target network identifier, access type, SSC mode,
applicable area for UE actions, etc.).
2\. UE decides on the actions based on the activation signal received in step
1 and other local information (e.g. UE subscription, UE location), and
performs initial registration to SNPN via SNPN N3IWF before UE moves out of
PLMN coverage to NPN, using the procedure in TS 23.502 [6] clause 4.12.2.2.
3\. Afterward, UE establish a PDU session in SNPN via SNPN N3IWF, using the
procedure in TS 23.502 [6] clause 4.12.5.
4\. When UE detects coverage loss of PLMN NG-RAN and in the coverage of SNPN
NG-RAN, it registers to SNPN via NG-RAN, using the procedure in TS 23.502
4.2.2.2.
5\. UE establishes a new PDU session using SNPN 3GPP access and handover
existing PDU session established in step 3 to 3GPP access, using the procedure
in TS 23.502 [6] clause 4.9.2.
When the PLMN NG-RAN coverage is still available (but signal strength might be
weakening), the UE can move the service via application layer mechanism **from
the PDU session in PLMN network (i.e. PDU session in step 0) to the PDU
session in SNPN network (i.e. PDU session in step 3) as preparation for
handover to SNPN. From step 3 to step 5, UE service continuity is ensured by
the handover procedure between 3GPP access and non-3GPP access.**
**In case UE moves from SNPN to PLMN or some other SNPN, similar procedure
applies.**
**Step 1- 3 enables a network to prepare for a 3GPP access PDU session before
a UE actually connects to this network via 3GPP access. It can also be used in
combination with other handover procedure between SNPN and PLMN as listed in
solution #13 to shorten the handover latency for SR UE.**
### 6.48.4 Impacts on services, entities and interfaces
**The solution is based on the service continuity mechanism in application
layer.**
**The assumption on service:**
\- The VIAPA service can be received via both SNPN and PLMN, e.g. the VIAPA
service in Internet, or from different SNPNs.
\- The VIAPA service can keep service continuity via application layer
mechanism, like Multi-homing, MPTCP, etc.
**The impact on UE:**
\- UE needs to support N3IWF-architecture in TS 23.501 [4], clause D.3
**The impact on the network:**
\- The network signals to UE on the activation of non-3GPP access to other
network.
Editor\'s note: It is FFS regarding how the information is obtained by the
3GPP network from the application layer regarding the mobility decision.
NOTE 1: The network provides the activation signal to UE reusing the existing
procedure, e.g. UE configuration update.
NOTE 2: This solution may also support the activation of UE non-3GPP access to
other network based on the application trigger (e.g. AF request). While how
the information is obtained by the 3GPP network from the application layer
regarding the mobility decision is not specified in this solution.
## 6.49 Solution #49: Solution for service continuity triggered by application
### 6.49.1 Introduction {#introduction-53}
This solution addresses Key Issue #2 (NPN support for Video, Imaging and Audio
for Professional Application VIAPA).
The solution aims at addressing the case that UE is triggered from application
level to connect to a dedicated application which requires the UE to handover
from existing PLMN to SNPN.
### 6.49.2 Functional Description
There are three potential procedures can be used in the solution:
\- Procedure \"AF triggered UE Handover of PLMN anchored PDU Session from NG-
RAN to N3IWF\" in clause 6.49.2.1. In this procedure, UE is triggered from
application level and needs to switch to a target SNPN from PLMN. The anchor,
i.e. PLMN SMF/UPF, is kept after UE switching.
The reason for switching a network can be the current connected network cannot
provide the guaranteed service quality of the specific application.
\- Procedure \"AF triggered UE network switch and PDU session anchor re-
selection\" in clause 6.49.2.2. In this procedure, UE is triggered by AF over
control plane and needs to switch to a target SNPN from PLMN. This procedure
meet the requirement of service continuity based on application context
relocation. The anchor, i.e. PLMN SMF/UPF, is not kept after UE switching.
The reason for switching a network can be the current connected network cannot
provide the guaranteed service quality of the specific application or a high
resolution video streaming service of a live concert is available to be
accessed from a local edge server which can only be available to be connected
via a SNPN.
\- Procedure \"UE triggered network switch and PDU session anchor re-
selection\" in clause 6.49.2.3. In this procedure, UE is triggered by AF over
application layer and needs to switch to a target SNPN from PLMN. This
procedure meet the requirement of service continuity based on application
context relocation. The anchor, i.e. PLMN SMF/UPF, is not kept after UE
switching.
The reason for switching a network can be the current connected network cannot
provide the guaranteed service quality of the specific application or a high
resolution video streaming service of a live concert is available to be
accessed from a local edge server which can only be available to be connected
via a SNPN.
### 6.49.2 Procedure
#### 6.49.2.1 AF triggered UE Handover of PLMN anchored PDU Session from NG-
RAN to N3IWF
Figure 6.49.2.1-1: AF triggered UE Handover of PLMN anchored PDU Session from
NG-RAN to N3IWF
1\. UE performs 3GPP access registration in PLMN.
2\. UE set up the 3GPP access PDU session in PLMN and establishes the
corresponding user plane. This PDU session is anchored in PLMN UPF, and
subject to the handover procedure described in the following steps.
3\. Optional: UE receives the user\'s request to change the application (e.g.
for the same content but with high resolution), and receives from the
application layer that the network cannot provide the guaranteed service
quality of the specific application. This information can be sent to the AF
through the application layer.
4\. AF indicates the UE to switch to SNPN via 5GC.
4a. AF triggers a de-registration request to the UDM (optionally via NEF). If
the UDM accepts the de-registration request from the AF, the UDM performs the
network triggered de-registration according to TS 23.502 [6] clause 4.2.2.3.3.
4b. AF triggers a handover request to the UDM (optionally via NEF). If the UDM
accepts the handover request from the AF, the UDM notifies the UE through AMF
to perform PLMN non-3GPP access registration and the subsequent PDU session
handover.
NOTE: The handover request may contain the PDU session ID for which the PDU
session is expected to be handovered after the UE switches to the SNPN.
5\. If the UE has single radio, it first needs to activate the SNPN UE and
switches its radio interface from PLMN NG-RAN to SNPN NG-RAN, and then
performs initial registration and PDU session establishment with SNPN.
If the UE has dual radio, it is possible to register in SNPN, via its SNPN UE,
and establishes the SNPN PDU session whenever the radio coverage is available.
Alternatively, the UE can register the SNPN once it receives the de-
registration request from the AF via PLMN 5GC for the reason of the demand of
specific application.
Once the SNPN PDU session is established, the PLMN UE performs the non-3GPP
access registration in PLMN using the SNPN PDU Session connectivity of the
SNPN UE.
6\. After the registration, UE set up the PDU session through the PLMN UPF
using SNPN NG-RAN.
6a. If the UE de-registers from the PLMN, UE performs a new PDU session
establishment procedure as described in clause 4.12.5 in TS 23.502 [6].
6b. If the UE does not de-register from the PLMN, UE performs handover of a
PDU Session procedure from 3GPP to non-3GPP access as described in clause
4.9.2.2 in TS 23.502 [6].
#### 6.49.2.2 AF triggered UE network switch and PDU session anchor re-
selection
Figure 6.49.2.2-1: AF triggered UE network switch and PDU session anchor re-
selection
1\. UE performs 3GPP access registration in PLMN.
2\. UE set up the 3GPP access PDU session in PLMN and establishes the
corresponding user plane. This PDU session is anchored in PLMN UPF.
3\. Optional: UE is triggered from application level to switch to a target
SNPN which is for example a dedicated SNPN for a high resolution video source
(e.g. high resolution live concert video streaming).
4\. AF triggers a de-registration request to the UDM (optionally via NEF). If
the UDM accepts the de-registration request from the AF, the UDM perform the
network triggered de-registration according to TS 23.502 [6] clause 4.2.2.3.3.
5\. The Application context relocation is triggered by the AF and the
relocation completes between the DN that is connected with the PLMN UPF and
the Local DN which is dedicatedly connected with the SNPN UPF.
6\. If the UE has single radio, it first needs to activate the SNPN UE and
switches its radio interface from PLMN NG-RAN to SNPN NG-RAN, and then
performs initial registration and PDU session establishment with SNPN.
If the UE has dual radio, it is possible to register in SNPN, via its SNPN UE,
and establishes the SNPN PDU session whenever the radio coverage is available.
Alternatively, the UE can register the SNPN once it receives the de-
registration request from the AF via PLMN 5GC for the reason of the demand of
specific application.
7\. UE set up the PDU session towards the local DN for the dedicated
application.
#### 6.49.2.3 UE triggered network switch and PDU session anchor re-selection
Figure 6.49.2.3-1: UE triggered network switch and PDU session anchor re-
selection
1\. UE performs 3GPP access registration in PLMN.
2\. UE set up the 3GPP access PDU session in PLMN and establishes the
corresponding user plane. This PDU session is anchored in PLMN UPF.
3\. UE is triggered from application level to switch to a target SNPN which is
for example a dedicated SNPN for a high resolution video source (e.g. high
resolution live concert video streaming). Meanwhile, the UE may receive an
SNPN identity from the application level. The SNPN identity indicates the SNPN
which can be used to connect to the dedicated application.
4\. The Application context relocation is triggered by the source DN and the
relocation completes between the source DN that is connected with the PLMN UPF
and the Local DN which is dedicatedly connected with the SNPN UPF. The
application context relocation can use the mechanism in TS 23.558 [39].
5\. UE triggers the network switch between PLMN and the SNPN based on the
network switch indication (i.e. SNPN identity) received from the application
level in step 3.
6\. For single radio UE, it first needs to activate the SNPN UE and switches
its radio interface from PLMN NG-RAN to SNPN NG-RAN, and then perform initial
registration and PDU session establishment with SNPN.
For dual radio UE, it is possible to register in SNPN, via its SNPN UE, and
establish the SNPN PDU session whenever the radio coverage is available.
Alternatively, the UE can register the SNPN once it receives the
deregistration request from the AF via PLMN 5GC because of certain
application.
7\. UE set up a new PDU session towards the local DN via a different UPF that
belongs to the SNPN for the dedicated application.
### 6.49.4 Impacts on services, entities and interfaces
AF:
\- AF can trigger UE handover of PLMN anchored PDU Session from NG-RAN to
N3IWF (connected by SNPN) via 5GC or optionally via the application layer.
\- AF can trigger UE network switch from PLMN to SNPN and PDU session anchor
re-selection via 5GC or optionally via the application layer.
UDM:
\- Perform Registration when receive the de-registration request/handover
request from AF.
UE:
\- UE can receive AF\'s indication for handover of PLMN anchored PDU Session
from NG-RAN to N3IWF (connected by SNPN), via 5GC or optionally via the
application layer.
\- UE can receive AF\'s indication for network switch from PLMN to SNPN and
PDU session anchor re-selection via 5GC or optionally via the application
layer.
\- UE itself can trigger handover of PLMN anchored PDU Session from NG-RAN to
N3IWF (connected by SNPN) or network switch from PLMN to SNPN and PDU session
anchor re-selection.
## 6.50 Solution #50: a consolidated solution to KI#2
### 6.50.1 Introduction {#introduction-54}
This solution is a consolidated solution of Solution 1, Solution 2, Solution
13, Solution 15 and Solution 16, in order to address the key issue #2: NPN
support for Video, Imaging and Audio for Professional Applications (VIAPA).
If the UE performs access to the SNPN services and access to the PLMN services
using the credentials/subscription of the PLMN, the roaming based solutions
(in Sol#1 or Sol#2) can be engaged.
If the UE performs access to the SNPN services and access to the PLMN services
using the credentials/subscription of the SNPN and credentials/subscription of
the PLMN respectively, the N3IWF based solutions (in Sol#13 or Sol#15) can be
engaged.
If the UE performs access to the PNI-NPN services and access to the PLMN
services using the credentials/subscription of the PLMN, the Sol#16 can be
engaged.
Taking the above as baseline, this solution further considers how to enable
the SNPN operator to control whether a UE can establish an HR PDU session via
SNPN, or whether a UE can access to PLMN N3IWF via SNPN, and how to enable the
PLMN operator to control whether a UE can perform the secondary 3GPP
registration at the PLMN.
### 6.50.2 Functional Description
#### 6.50.2.1 Roaming based architecture
This is based on solution #1 or #2. In this case the UE performs access to the
SNPN services and access to the PLMN services using the
credentials/subscription of the PLMN. More specifically, the UE can access to
SNPN service by an LBO PDU Session, at the same time the UE can access to the
PLMN services:
\- by the HR PDU session, which makes use of the SNPN resources (RAN, UPF), or
\- by a secondary registration and a subsequent non-roaming PDU session, which
makes use of the PLMN RAN resources.
The former applies to the SR UE while the latter applies to the DR UE.
Certainly, this should allow the SNPN operator to control whether a UE can
establish an HR PDU session via SNPN, and allow the PLMN operator to control
whether a UE can perform the secondary 3GPP registration at the PLMN.
\- To enable the control of the SNPN operator, taking the UE subscription, UE
capability (SR or DR), local policy and agreements between SNPN and PLMN into
account, the SNPN can make a decision whether the HR PDU session targeting to
the PLMN services is allowed, or indicate the UE to establish the PDU session
targeting to the PLMN services via PLMN cell or SNPN cell, e.g. via URSP.
\- To enable the control of the PLMN operator, taking the UE subscription, UE
capability, local policy and network topology (whether 5GC is shared between
SNPN and PLMN, e.g. Solution #3) into account, the SNPN or PLMN can indicate
the UE whether secondary registration is allowed and whether the GUTI assigned
by SNPN can be reused. Therefore, the UE can determine to perform the
secondary 3GPP registration at the PLMN based on local configuration, UE
capability and the network indication. The PLMN UDM will determine whether to
accept UE\'s secondary 3GPP registration based on local policy and UE\'s first
registration via SNPN.
#### 6.50.2.2 N3IWF based architecture
This is based on solution #13 or #15. In this case the UE performs access to
the SNPN services and access to the PLMN services using the
credentials/subscription of the SNPN and credentials/subscription of the PLMN
respectively. More specifically, the UE can access to SNPN service by a PDU
session anchored at the SNPN, at the same time the UE can access to the PLMN
services by a registration at PLMN via N3IWF and a subsequent non-roaming PDU
session, which makes use of the SNPN resources (RAN, UPF).
Certainly, this should allow the SNPN operator to control whether a UE can
access to PLMN via SNPN. This control can be achieved by the pre-configured
agreements between SNPN and PLMN.
#### 6.50.2.3 PNI-NPN
This clause can refer to Solution #16.
### 6.50.3 Procedures
#### 6.50.3.1 Roaming based procedure
Procedures of Solution #1 or #2 can be used with the following modification:
\- Taking the UE subscription, UE capability (SR or DR), local policy and
agreements between SNPN and PLMN into account, the SNPN can make a decision
whether the HR PDU session targeting to the PLMN services is allowed during
the PDU session establishment procedure.
\- Taking the UE subscription, UE capability (SR or DR), local policy and
agreements between SNPN and PLMN into account, the PCF can indicate the UE to
establish the PDU session targeting to the PLMN services via PLMN cell or SNPN
cell, e.g. via URSP during UCU procedure.
\- Taking the UE subscription, UE capability, local policy and network
topology (whether 5GC is shared between SNPN and PLMN, e.g. Solution #3) into
account, the SNPN or PLMN can indicate the UE whether secondary registration
is allowed and whether the GUTI assigned by SNPN can be reused during
registration procedure. Subsequently, the UE can determine to perform the
secondary 3GPP registration at the PLMN based on local configuration, UE
capability and the network indication. The PLMN UDM will determine whether to
accept UE\'s secondary 3GPP registration based on local policy and UE\'s first
registration via SNPN during registration procedure.
#### 6.50.3.2 N3IWF based procedure
Procedures of Solution #13 or #15 can be used with the following modification:
\- SMF or UPF of SNPN controls the UE packets towards the PLMN N3IWF based on
pre-configured agreements between SNPN and PLMN.
#### 6.50.3.3 PNI-NPN
Procedures of Solution #16 can be used.
### 6.50.4 Impacts on existing entities and interfaces
Besides the impacts in solution #1, #2, #13, #15, #16, more impacts are
captured in clause 6.50.3.
## 6.51 Solution #51: QoS notification between SNPN and PLMN for VIAPA
### 6.51.1 Introduction {#introduction-55}
When UE obtains both SNPN and PLMN service by using N3IWF, we need to consider
the special traffic characteristics of the VIAPA applications, such as high
5QI in a concentrated area, which can dramatically impact the underlay network
if VIAPA SNPN is overlay network, and lead to significant performance impact
not only to those over-the-top users but also other users of the underlay
network in this area. Also in the case of VIAPA, which the services are tied
to strict SLA, it\'s important for NPN operators to be notified about the
coming service degradation from the underlay network (e.g. PLMN) in advanced,
so SNPN can justify the QoS configuration accordingly if the traffic are going
through the underlay PLMN network. Similarly, PLMN to be notified about the
coming service degradation from the overlay network (e.g. SNPN) in advanced,
so PLMN can justify the QoS configuration accordingly if the traffic are going
through the overlay SNPN network.
NOTE 1: The same solution can be also applied to the case when N3IWF is hosted
in PLMN and using SNPN as underlay network, so PLMN can be notified by the
SNPN which is the underlay network.
NOTE 2: How to transfer those massive lower latency multicast traffic from NPN
to PLMN more efficiently will not be addressed in this study and this release.
Other WI, such as IIoT and 5MBS may be able to address this performance issue.
### 6.51.2 Functional Description
This notification solution is based on the defined procedures in TS 23.288
[40] of subscribing the \"QoS monitoring\" or \"QoS sustainability\" via the
interface between NEF and AF for the given location where SNPN is deployed.
SNPN acts as AF to subscribe those notifications from PLMN. This subscription
can include the QoS threshold (e.g. for degradation) for triggering the QoS
notification.
### 6.51.3 Procedure
#### 6.51.3.1 QoS degradation notification and reporting between PLMN and SNPN
Figure 6.51.1.3-1: QoS degradation notification and reporting between PLMN and
SNPN
This procedure demonstrates the case where SNPN receive \"QoS sustainability\"
information from PLMN. If UE connects PLMN through SNPN via the N3IWF in PLMN,
the similar procedure can also be applied.
NOTE: SNPN can collect other QoS information from PLMN using the defined
procedures in TS 23.288 [40]. Here only illustrates one example procedure.
Step 0: UE connected to SNPN via it N3IWF over PLMN. During the UE
registration with SNPN via N3IWF, SNPN identify the PLMN which provide the PDU
session for the IPsec tunnel. UE may also provide other PLMN connectivity
information during the registration to help SNPN to acquire the QoS
information from PLMN, such as PDU session ID of the PLMN which the IPsec
tunnel is encapsulated.
Step 1: SNPN\'s AF can subscribe \"QoS sustainability\" notification to the
PLMN with the location information of the area of SNPN. This subscription can
include the QoS threshold for triggering the notification. SNPN\'s AF can also
send request to PLMN to collect the QoS performance data after detecting the
performance degradation via those IPsec tunnels. The granularity of SNPN AF\'s
subscription and request can be per UE, per PDU session or per network.
Step 3-4, Follow the existing procedure defined in TS 23.288 [40]. In the
notification report, the PLMN may include the new 5QI for downgraded the PDU
session based on agreed SLA and QoS mapping, so SNPN may reconfigured its SNPN
service QoS accordingly. Specifically, AF may request PCF to performs a PCF
initiated SM Policy Association Modification procedure as defined in clause
4.16.5.2 of TS 23.502 [6] to adjust the service QoS in SNPN based on the
received 5QI.
### 6.51.4 Impacts on services, entities and interfaces
UE impact:
\- UE may provide underlay network ID (e.g. PLMN ID if PLMN is the underlay
network) to AMF during the registration with SNPN via NWu.
\- UE may provide AMF the PDU session ID which it uses in underlay network for
IPsec connection.
AMF impact:
\- AMF Provides underlay network connectivity information to AF for QoS
monitor subscription.
AF impact:
\- AF may trigger PCF to performs a PCF initiated SM Policy Association
Modification procedure to adjust the QoS.
## 6.52 Solution #52: Enabling service continuity with pre-established backup
connection
### 6.52.1 Introduction {#introduction-56}
This solution addresses the service continuity problem of KI#2. The solution
enables a single-radio UE to achieve service continuity between SNPN and PLMN
by pre-establishing a backup UP connection in the PLMN for SNPN services.
### 6.52.2 Functional Description
R16 already supports UE accessing the SNPN services via the PLMN and N3IWF in
SNPN. However, for a single-radio UE, when it moves from the SNPN to the PLMN,
it has to go through a lot of procedures before it can resume the SNPN
services from the PLMN:
\- The UE needs to register with the PLMN (over 3GPP access) if it has not
previously registered;
\- The UE needs to establish a PDU session in PLMN for the UP connectivity to
the N3IWF in SNPN;
\- The UE needs to establish IPsec SA with the N3IWF;
\- The UE needs to establish PDU Session via N3IWF for the SNPN services.
It\'s obvious that these procedures take significant time and will cause
service interruption.
In this solution, we propose that the UE may temporarily leave the SNPN
network when it is still served by the SNPN and switch to the PLMN to pre-
establish a backup UP connection in the PLMN. After the backup connection is
ready, the UE may return to the SNPN network. When the UE actually loses SNPN
coverage and switches to the PLMN, it may find the backup UP connection ready
and re-activate it to resume the SNPN services. The solution has the following
building blocks:
\- Triggering of temporary leave.
When the UE establishes a PDU Session in the SNPN, the network may indicate
that whether the PDU Session is subject to a backup connection in PLMN. The
network may take into account a few factors to make the decision, such as the
UE and the network\'s capability, the network policy, whether the related
service requires inter-network service continuity, etc. If the network
indicates that the PDU Session may benefit from a backup connection, the UE
may choose an appropriate occasion to request temporarily leave from the
serving SNPN. During the temporary leave, the UE may switch to the target PLMN
to establish backup connections for the SNPN services or perform registration
update with the PLMN. How the UE determines the time to leave is based on UE
implementation and may take into consideration the UE\'s CM state, data
inactivity period, radio conditions, etc.
\- Temporary leave request and confirmation.
When the UE decides to temporarily leave the SNPN, it may initiate a NAS
procedure to request temporary leave. Similar procedure was discussed in the
MUSIM study and may be reused here. If the network can accept the UE\'s
temporary leave, it confirms the request and may buffer the UE\'s downlink
data before the UE returns. Then the UE may exit SNPN access mode and select a
target PLMN network based on UE configuration.
\- Backup connection establishment in the PLMN.
The UE establish a backup PDU Session from the PLMN for the original SNPN
services using existing procedures.
When the backup connection is ready, the UE re-activates SNPN access mode and
returns to previously registered SNPN.
### 6.52.3 Procedures
Figure 6.52.3-1 below shows a high-level procedure of this solution.
Figure 6.52.3-1: Pre-establishment of backup UP connection in PLMN for service
continuity
1\. The UE is registered in the SNPN
2\. The UE has established the PDU Session (ID=1) for a certain SNPN service
x. The network may indicate that the PDU Session may benefit from or may need
a backup connection in PLMN.
3\. The UE determines an appropriate timing based on implementation to
initiate temporary leave from SNPN.
4\. The UE sends a NAS message to the serving SNPN requesting temporary leave.
It may indicate the reason for temporary leave, e.g. for preparing backup
connection in PLMN, and estimated period of leave.
5\. The SNPN network may confirm the UE\'s request and indicate expected
period of leave and a list of preferred target networks for establishing
backup connections. The network may start to buffer incoming data for the UE
during the expected period of temporary leave.
6\. The UE then exit SNPN access mode and start searching for available PLMN
networks. It may prioritize the selection of previously registered PLMN or the
high priority target PLMN network indicated by the SNPN in Step 5.
7\. The UE registers with the selected PLMN if it has not previously
registered.
8\. The UE establish a PDU session in the PLMN for the connectivity to the
SNPN N3IWF.
9\. Using the established PLMN PDU Session, the UE establishes IPSec Secure
Association with the N3IWF.
10\. The UE initiates the backup PDU Session for the SNPN services X. It may
indicate Existing PDU Session and use the same PDU Session ID. The UE may also
indicate this PDU Session is for backup or standby purpose so the SNPN network
will not steer data to the PDU session before it is really needed. If there
are multiple PDU sessions in SNPN that require service continuity, the UE may
continue to establish backup connections for those too.
11\. After the backup connections are successfully established, the UE may re-
enter SNPN access mode and returns to previously registered SNPN.
12\. The UE may notify the SNPN that it has returned. The UE may initiate
other existing procedures, e.g. Service Request or Registration Update to
notify its return to the SNPN. The UE shall listen to the radio in PLMN while
it stays in SNPN to exchange IKE liveness check. Also the UE need to perform
necessary procedure e.g. periodic registration update to maintain
registration.
### 6.52.4 Impacts on services, entities and interfaces
The solution has the following impacts on the entities and interfaces:
UE:
\- Supports the procedure to temporarily leave a network.
\- Supports the switch between SNPN access mode and non-SNPN access mode when
necessary.
\- Supports the indication that a PDU Session is established for back-up
purposes.
\- Monitors PLMN radio to listen Paging to receive any signalling (e.g. IKE
liveness check).
AMF:
\- Supports the UE temporary leave procedure.
SMF/UPF:
\- Supports buffering downlink data when the UE is in temporary leave.
\- Supports the establishment and re-activation of a PDU Session for back-up
purpose.
## 6.53 Solution #53: KI #3, Solution for providing IMS voice and emergency
services for SNPN subscribers using SIP digest with passwords generated based
on keys generated during access level authentication
### 6.53.1 Introduction {#introduction-57}
This solution addresses Key Issue #3 (\"Support of IMS voice and emergency
services for SNPN\"). The solution enables SNPN UEs to receive IMS and
emergency services using credentials generated during access level
authentication at the SNPN system. The solution assumes trust relationship
between the \"transport\" SNPN owning the UDM and DN owning the IMS core and
HSS-IMS. This solution has no impact on the configuration of SNPN UEs. The UE
can derive IMPI/IMPU from the SUPI. The SNPN or an IMS provider provisioned
with the SUPI can equally do the same.
NOTE: The Realm used is that of the SNPN and IMS is aware of that.
### 6.53.2 Functional Description
#### 6.53.2.1 Solution Principles
Figure 6.53.2.1-1 shows the reference architecture to provide IMS services to
SNPN users used in this solution.
Figure 6.53.2.1-1: Access to IMS services via Stand-alone Non-Public Network
The reference architecture used in this solution is the same as the one
depicted in solution#20. The only difference is that the support of AUSF in
the SNPN 5GC becomes relevant.
The requirements for the interconnectivity between the IMS Core system and the
SNPN 5GC, use of UE identifiers and the subscription profile of SNPN UEs in
the 5GC and the IMS system are also the same as described in solution#20 and
not further described in this solution.
This solution proposes that SNPN UEs authenticate to the IMS Core system with
SIP-digest using passwords generated based on the Kausf generated during
primary authentication of the UE in the SNPN 5GC.
### 6.53.3 Procedures
Figure 6.53.3.2-1 depicts how SIP digest authentication of SNPN UEs in the IMS
Core system can use passwords based on the Kausf generated during the primary
authentication procedure of the UE in the SNPN 5GC:
Figure 6.53.3.2-1: SIP Digest using passwords generated based on Kausf
1\. The UE authenticates and registers in 5GC. The SUPI and credentials used
by the UE may not be based on IMSI/AKA. As part of the UE authentication in
the 5GC of the SNPN, the UE and the AUSF stores a Kausf.
2\. The UE establishes a PDU session for the DNN IMS and initiates IMS
Registration. The IMPI/IMPU used by the UE to register in IMS are based on the
UE\'s SUPI used to register in 5GC. Note that the SUPI may contain a NAI used
as an IMPI.
3\. Upon receiving the SIP REGISTER the Sâ€‘CSCF uses a SIP Digest
Authentication Vector (SD-AV) for authenticating the user. The Sâ€‘CSCF sends a
request for SD-AV(s) to the HSS.
4\. Upon receipt of a request from the Sâ€‘CSCF, this solution proposes that the
HSS generates an SD-AV based on the Kausf generated during primary
authentication of the UE in the 5GC of the SNPN. For that, the HSS sends a
request to the UDM to retrieve a password from the AUSF. This request can be
realized e.g. based on the existing Nudm_UEAuthenticate_Get service operation
with an additional indication for SIP Digest authentication. The request
includes a SUPI generated from the IMPI.
5\. The UDM selects the AUSF that stores the latest Kausf for the UE and sends
a request to the AUSF to generate a SIP Digest password. This solution
proposes a new generic Nausf_Password_Get service operation including an
indication for SIP Digest as passwords based on Kausf may be used in other
contexts. A specific Nausf_SIPDigestPWD_Get service operation may be feasible
too. The AUSF generates a password for SIP digest authentication for the UE
and sends it to the UDM.
NOTE 1: Subsequent SIP Digest authentication requests in IMS result in a new
request and generation of a new password based on the latest Kausf agreed
between the UE and the AUSF available at that time. In principle, re-
authentication at access level resulting in new Kausf has no impact on the
status of the IMS authentication based on passwords generated from previously
available Kausf. In any case, the generation of passwords for SIP Digest based
on Kausf and how it will be affected by potential Kausf refresh is to be
specified by SA WG3.
6\. The UDM provides the password for SIP Digest generated by the AUSF to the
HSS.
7\. The HSS generates a SD-AV using the password received from the 5GC of the
SNPN. The SD-AV is generated as specified in TS 33.203 [12].
8\. The S-CSCF executes SIP-Digest authentication with the UE and completes
the IMS registration as currently specified.
NOTE 2: The final name and details of the SBA services and operations used
during steps 4-6 can be further defined during normative phase.
NOTE 3: Security aspects of the procedure to run SIP Digest using passwords
generated based on Kausf need to be checked by SA WG3.
NOTE 4: The details on how the UE distinguishes whether a manual or a derived
password is to be used can be defined during stage 3 normative phase.
It is worth to mention that as per TS 33.203 [12], the use of SIP Digest shall
not be used with 3GPP access networks. Such restriction can be applicable to
the execution of SIP Digest with static passwords provisioned at the UE and
HSS. However mind that as the password used to generate the SD-AV according to
the proposal in this solution is based on the Kausf and the Kausf is refreshed
at each primary authentication of the UE in the 5GC of the SNPN, the SIP
Digest mechanism proposed in this solution provides enhanced security as the
traditional SIP Digest methods using static passwords stored in HSS.
NOTE 5: SA WG3 needs to review the feasibility of the security aspects of the
solution.
It is proposed therefore that the restriction for the usage of SIP Digest as
defined in TS 33.203 [12] does not apply to the procedure defined in this
solution. This is also in line with solution #21 which proposes to lift the
restriction of the use of IMC so it can also be used with a terminal accessing
IMS in an SNPN over 3GPP access technology.
### 6.53.4 Impacts on services, entities and interfaces
Authentication of SNPN UEs in the IMS Core system with SIP-digest using
passwords generated based on the Kausf generated during primary authentication
of the UE in the SNPN 5GC has the following impacts.
**UE:**
\- Generate passwords for SIP digest based on Kausf.
**HSS:**
\- Request generation of passwords for SIP Digest to UDM.
**UDM:**
\- Receive requests for the generation of password for SIP Digest from HSS and
provide corresponding answer to HSS.
\- Request generation of passwords for SIP Digest to AUSF.
**AUSF:**
\- Generate passwords for SIP Digest as requested by UDM.
## 6.54 Solution #54: KI #3, Solution for providing IMS Services for SNPN
subscribers using NAI-based SUPI Identifiers
### 6.54.1 Introduction {#introduction-58}
This solution addresses Key Issue #3 (\"Support of IMS voice and emergency
services for SNPN\"). The solution enables SNPN UEs, who have an NAI-based
SUPI to receive IMS and emergency services without needing to provision any
IMC or any ISIM in the UE. In this solution, the UE generates from the NAI-
SUPI a Home Domain, a Private Identifier and a Public Identifier that will be
used for IMS Registration purposes.
The solution assumes no IMS credentials needed. IMS authentication is based on
access network credentials.
Editor\'s note: Use of Access Level Credentials proposed in the TR for IMS
authentication needs to be confirmed by SA WG3.
This solution applies to the case where the SNPN owns the IMS system, or when
the IMS is owned by an entity other than the SNPN, i.e. an independent IMS
provider, and where that IMS provider must be provisioned with the NAI-SUPI.
### 6.54.2 Functional Description
#### 6.54.2.1 Solution Principles
For non-IMSI based SUPI, with or without UICC, and in the absence of an
ISIM/IMC, the following enables the generation of the Home domain, Private and
Public Use Identity for initial IMS registration:
\- The Home domain consists of the string \"ims\" appended with the same as
the domain part of the non-IMSI SUPI.
\- The Private User Identity is obtained as follows: the username is the same
as the username in the non-IMSI SUPI NAI, and the domain portion is identical
with the Home domain above.
\- The temporary Public User Identity derived from the SUPI, consists of the
string \"sip:\" appended with a username and domain portion equal to the non-
IMSI SUPI derived Private User Identity.
### 6.54.3 Procedures
#### 6.54.3.1 Procedure to support Generation of IMS Private and Public
Identifier from NAI-based SUPI Identifiers.
When the UE wants to initiate an IMS initial Registration it shall generate
the Home domain, Private Identifiers and Public Identifier from the NAI-based
SUPI as follows:
\- The Home domain consists of the string \"ims\" appended with the domain
part of the non-IMSI SUPI,
\- The Private User Identity is obtained as follows: the username is the same
as the username in the non-IMSI SUPI NAI, and the domain portion is identical
with the Home domain above.
\- The temporary Public User Identity derived from the SUPI, consists of the
string \"sip:\" appended with a username and domain portion equal to the non-
IMSI SUPI derived Private User Identity.
### 6.54.4 Impacts on services, entities and interfaces
**UE:**
\- Needs to support the derivation of the Home domain, Private and Public
Identifier generation from the non-IMSI SUIPI, and to use them for initial IMS
registration.
**HSS:**
\- Needs to be provisioned with the non-IMSI SUPI.
\- Needs to be provisioned with the derived Private and Public Identifier.
## 6.55 Solution #55: Paging in one network for another network
### 6.55.1 Introduction {#introduction-59}
This solution addresses the study to enable a UE to receive data services from
one network (e.g. NPN), and paging as well as data services from another
network (e.g. PLMN) simultaneously in key issue 2 (NPN support for Video,
Imaging and Audio for Professional Applications (VIAPA)).
In particular, the solution enables a UE accessing the one network (e.g. PLMN)
via another network (e.g. NPN) to receive the paging in the network (e.g. NPN)
for downlink data in another network (e.g. PLMN). In this solution, we propose
the event notification (e.g. paging event or downlink data event) operation
between two networks to send the paging message from another network (e.g.
PLMN) to the network (e.g. NPN).
### 6.55.2 Functional Description
#### 6.55.2.1 Architectures
**We assume that the UE has single transmitter and single receiver.**
Registration with both SNPN and PLMN over one access network:
1) Access to PLMN services via SNPN depicted in clause D.3 of TS 23.501 [4]
(Figure 1).
\- In order to obtain access to PLMN services when the UE is camping in NG-RAN
of SNPN, the UE obtains IP connectivity, discovers and establishes
connectivity to an N3IWF in the PLMN.
\- The N1 (for SNPN) represents the reference point between UE and the AMF in
SNPN. The NWu (for PLMN) represents the reference point between the UE and the
N3IWF in the PLMN for establishing secure tunnel between UE and the N3IWF over
the SNPN. N1(for PLMN) represents the reference point between UE and the AMF
in PLMN.
\- When the UE is in CM_IDLE in PLMN, the NWu (secure tunnel between UE and
N3IWF) is released. So, if the UE has a data to receive in PLMN, the PLMN just
discards the data without any paging because the UE is registered via non-3GPP
access.
\- In order to receive the paging from the PLMN when the UE is in CM_IDLE in
the PLMN while camping in NG-RAN of SNPN, the UE requests the SNPN to
subscribe the event notification service for paging when the UE
establishes/modifies the PDU Sessions in SNPN for PLMN services.
\- Either the AMF or SMF in the SNPN can subscribe the event notification
service for paging of the specific UE to the AMF in the PLMN using the
exposure of network events between SNPN and PLMN.
\- The subscription or the notification of the event notification service for
paging event between the PLMN and SNPN is done between NEF in SNPN and NEF in
PLMN (optionally, via AF).
2) Access to SNPN services via PLMN depicted in clause D.3 of TS 23.501 [4]
(Figure 2).
\- This solution can be applied in vice versa scenario.
Figure 6.55.2.1-1: Access to PLMN services via Stand-alone Non-Public Network
Figure 6.55.2.1-2: Access to Stand-alone Non-Public Network services via PLMN
#### 6.55.2.2 Functional Description
The solution is described with the scenario \"Access to PLMN via SNPN\" as
depicted below Figure 3:
Figure 6.55.2.2-1: Access to PLMN service via SNPN
**Paging Service**
In order to receive the paging message from the PLMN in the SNPN (i.e. while
camping in NG-RAN of SNPN) when the UE is in CM_IDLE in the PLMN, the UE
requests the Paging Service to the SNPN network when establishing or modifying
the PDU Session in SNPN for PLMN services.
When the UE establishes or modifies the PDU Session in SNPN for PLMN services,
it requests the service either to the AMF in SNPN (Paging Event Notification)
or the SMF in SNPN (Downlink Data Event Notification).
**Paging Event Notification**
\- If the AMF in SNPN is requested the Paging Service by the UE, it subscribes
the Paging Event Notification service to the AMF in PLMN via NEFs in both
networks.
Optionally, when the AMF requests the subscription to the NEF in SNPN, it can
request it to the NEF in PLMN via the AF.
\- If the CM state of the UE in PLMN is CM-IDLE and there is DL data for the
UE in PLMN, the AMF in PLMN sends the Paging Event Notification to the AMF in
SNPN via NEFs.
**Downlink Data Event Notification**
\- If the SMF in SNPN is requested the Paging Service by the UE, it subscribes
the Downlink Data Event Notification service to the AMF in PLMN via NEFs in
both networks.
Optionally, when the SMF requests the subscription to the NEF in SNPN, it can
request it to the NEF in PLMN via the AF.
\- If the CM state of the UE in PLMN is CM-IDLE and there is DL data for the
UE in PLMN, the AMF in PLMN sends the Downlink Data Notification to the SMF in
SNPN via NEFs.
### 6.55.3 Procedures
This procedure describes the solution for the scenario where the UE registers
both SNPN and PLMN over SNPN access network.
Figure 6.55.3-1: procedure where UE registers to both SNPN and PLMN over SNPN
access network.
1\. A UE registers with the SNPN.
2\. In order to register the PLMN network, the UE requests PDU Session
Establishment in the SNPN network. If the UE wants to request the Paging
Service which enables the UE to receive the paging message of the PLMN in SNPN
(i.e. camping in the NG-RAN of SNPN), it includes the PLMN ID and its GPSI of
the PLMN either in the NAS Message encapsuling the PDU Session Establishment
Request message to the AMF (for Paging Event Notification Service) or in the
PDU Session Establishment Request message to the SMF (for Downlink Data Event
Notification Service). After establishment of the PDU Session, the UE can
request the Paging Service with the PDU Session Modification Request message
including the PLMN ID and it GPSI of the PLMN.
3\. The UE registers with the PLMN over the PDU Session of the SNPN via N3IWF
of PLMN. After registration of the PLMN, the UE establishes the PDU Session in
the PLMN for the PLMN services. After a while, the UE becomes CM-IDLE in PLMN
(e.g. no traffic over the PDU Session, failure of maintaining IPSec tunnel,
and etc.) and the IPSec tunnel between UE and N3IWF is released.
4\. The AMF or SMF in SNPN subscribes the Paging Event Notification Service or
the Downlink Data Event Notification Service for the UE requesting Paging
Service to AMF in PLMN via NEF in SNPN and NEF in PLMN (optionally, via AF),
respectively.
NOTE: The mapping information between the address of the NEF and PLMN/SNPN ID
can be configured in the network during the SLA for the Event Exposure
services.
5\. The AMF in PLMN receives the paging request from the SMF in PLMN.
6\. The AMF in PLMN sends the Paging Event Notification or the Downlink Data
Event Notification to the AMF or the SMF in SNPN via NEF in SNPN and NEF in
PLMN (optionally, via AF) depending on which event notification service is
subscribed.
7\. The Network Triggered Service Request procedure is triggered by the AMF or
the SMF in SNPN for the UE camping in NG-RAN of SNPN. By including PLMN ID in
the Service Accept message, the UE knows that the paging message is for the
PLMN.
8\. The UE requests the Service Request procedure to the PLMN.
9\. The UE receives the downlink data from the PLMN via SNPN.
### 6.55.4 Impacts on existing entities and interfaces
AMF:
\- Reading PLMN ID/SNPN ID and GPSI of another network in the NAS Message
encapsuling PDU Session Establishment/Modification Request message.
\- Support of subscription of the Paging Event Notification Service to another
network via NEF.
\- Support of notification of the Paging Event Notification to another network
via NEF.
\- Support of notification of the Downlink Data Event Notification to another
network via NEF.
\- Including PLMN ID/SNPN ID in the Service Accept message for informing
paging from the another network.
SMF:
\- Reading PLMN ID/SNPN ID and GPSI of another network in PDU Session
Establishment/Modification Request message.
\- Support of subscription of the Downlink Data Event Notification Service to
another network via NEF.
UE:
\- Request Paging Service with PDU Session Establishment/Modification
procedure.
\- Reading PLMN ID/SNPN ID in Service Accept message.
NEF:
\- Exposure of the new network events externally (Paging Event Notification
Service/ Downlink Data.
\- Event Notification Service).
## 6.56 Solution #56: SNPN selection impact consideration on top of solution
#21
### 6.56.1 Introduction {#introduction-60}
The solution addresses Key Issue #3 (Support of IMS voice and emergency
services for SNPN) and builds on top of Solution #21.
### 6.56.2 Functional Description
The solution is based on Solution #21 with the following considerations:
\- The UE\'s usage setting is required and can be set to \"voice centric\" or
\"data centric\" in the SNPN;
\- The SNPN selection or the PLMN selection based on the presence or absence
of the \"IMS voice over PS Session Supported Indication\" provided by the AMF
of the SNPN to the \"voice centric\" UE;
### 6.56.3 Procedures
The procedures are as following:
\- If the \"voice centric\" UE has received the \"IMS voice over PS Session
Supported Indication\" set to FALSE or has not received the \"IMS voice over
PS Session Supported Indication\", the UE considers that the SNPN does not
support the IMS voice.
\- the \"voice centric\" UE should maintain a list of SNPNs where voice
service was not possible in SNPN access mode.
NOTE 1: Since in SNPN access mode there is only support for NR and the \"voice
centric\" UE cannot reselect to another RAT in the same registered SNPN if the
first TA-list that the UE tries to register from cannot support IMS voice, it
is recommended that support for IMS voice is provided homogeneously in the
whole SNPN if at all.
\- the UE may perform SNPN selection or PLMN selection (if it has PLMN
subscription) as it will be defined in procedures of Key issue #1. The UE does
not consider SNPNs where voice service was not possible as SNPN selection
candidates.
NOTE 2: The detailed procedure for SNPN and/or PLMN selection in this case
will be defined in normative work by CT1.
\- To avoid the stored SNPNs not supporting voice service never being retried
again even when they support voice service later, the UE may retry these SNPNs
to verify voice services support, e.g. when no directly available SNPN or by
timer expiry.
### 6.56.4 Impacts on services, entities and interfaces
UE:
\- the \"voice centric\" UE should maintain a list of SNPNs where voice
service was not possible in SNPN access mode;
\- the UE has the subscription for the other PLMN or SNPN, then the UE can
register to the PLMN network or the SNPN.
\- The UE may retry the SNPNs that initially indicated no support for IMS
voice services, to verify their voice service support, so as to avoid never
retrying them again.
# 7 Evaluation
## 7.1 Key Issue #1: Enhancements to Support SNPN along with credentials owned
by an entity separate from the SNPN
### 7.1.1 General
Steering of UE to a target network is proposed to be handled as follows in the
proposed solutions:
\- Solution #11:
a) After UE connects to a serving network, the service provider of UE who owns
UE\'s the subscription may provide UE a network steering indication to guide
UE to move to another network provider being listed in the indicator or using
the latest preferred network list which UE receives from the procedure that
the preferred SNPN list is updated. This network switch indication is similar
to the SoR (Steering of Roaming) as defined in TS 23.122 [5]. This indication
can be part of the updated \"operator controlled Network selector\" list (for
solution 1) or \"Home SP subscription information\" (for solution 2) being
sent to UE using the UE Configuration Update procedure as defined in TS 23.502
[6] clause 4.2.4.2 or UE parameters update procedure as defined TS 23.502 [6]
clause 4.20.2.
b) Alternatively, SNPN identity can be integrated into a UE policy. UE can
obtain the update of the UE policy containing SNPN identity using the UE
Configuration Update procedure as defined in TS 23.502 [6] clause 4.2.4.3 or
UE parameters update procedure as defined TS 23.502 [6] clause 4.20.2. The
obtained SNPN identity information derived from the UE policy can also be used
to update the \"Operator controlled network selector\" list or \"SP controlled
network selector\" list.
c) 2 options are proposed for the service provider to get the candidate
network measurement to make sure UE is the coverage of target network for
steering. This is not the reason for steering, and it\'s optional for network
steering.
\- Solution #45: eSoR is included in the Registration Accept or the DL NAS
Transport to steer the UE to the desired SNPN. eSoR includes list of allowed
higher priority SNPN(s) /PLMN(s), and optional the unified access control
information
The item a) of the solution #11 and solution #45 are similar with different
messages. Also solution #11 is based on the concept of SoR but not directly
reusing existing SoR which is defined for the interconnection between two
PLMNs, while #45 is the directly extension of the SoR. How the current defined
SoR can be reused and extented for interconnection between PLMN and NPN, or
between SNPNs is in scope of stage 3.
The item b) of the solution #11 proposesthe SA WG3 to determine how the
steering indication information can be delivered with integrity protection for
the SNPN when non-3GPP credential being used for primary authentication. The
item c) of the solution # 11 proposes optional procedures for the home service
provider to collect the network performance information of the candidate
V-SNPN which have the coverage for UE in that location. The option of the UE
reporting the network performance information of the candidate V-SNPN requires
enhancement.
### 7.1.2 Evaluations for scenario where the SNPN offers connectivity for
UE(s) with credentials owned by separate entity offering AAA Server
This clause provides evaluations for the solutions that address the scenario
where the SNPN offers connectivity for UE(s) with credentials owned by
separate entity offering AAA Server (AAA-S), among these solutions:
\- Sol#4 proposes that
\- In the case that SNPN UDM does not provide any subscription data the
primary authentication and authorization towards the AAA-S is triggered by AMF
based on local policy and UE indication, the AMF selects the AAA-P that
supports the primary authentication and authorization towards the AAA-S. The
AMF derives the external UE ID from the SUCI/SUPI or receives the external UE
ID from UE. The AMF selects the AAA-P that supports the primary authentication
and authorization towards the AAA-S. The AMF obtains the access and mobility
subscription data from AAA-P/AAA-S to complete the registration procedures,
the SMF obtains the session management subscription data from AAA-P/AAA-S to
complete the session management procedures. This is applicable when UDM is not
involved in the primary authentication and authorization towards the AAA-S,
e.g. the UDM is not deploy in the SNPN.
\- In the case that SNPN UDM provides access and mobility subscription data,
session management subscription data, the primary authentication and
authorization towards the AAA-S is triggered by the UDM indication in
subscription data. The AMF may re-select a AAA-P that supports the primary
authentication and authorization towards the AAA-S based on the UDM
indication. The AAA-P derives the external UE ID from the SUPI or receives the
external UE ID from UE via AMF. The AMF obtains the access and mobility
subscription data from UDM to complete the registration procedures, the SMF
obtains the session management subscription data from UDM to complete the
session management procedures. This is applicable when UDM is involved in the
primary authentication and authorization towards the AAA-S.
\- Sol#8 proposes the similar mechanism as the Sol#4\'s case that SNPN UDM
provides subscription data for the UE, where CdP (Credentials Provider)
replaces the AAA-S, and AAA-P is implemented by enhanced AUSF that supports
delegation of authentication server role to the CdP via new NF supporting
protocol interworking with CdP.
\- Sol#10 proposes the similar mechanism as the Sol#4\'s case that the primary
authentication and authorization towards the AAA-S is triggered by AMF based
on local policy and UE indication where the AMF derives the external UE ID
from the SUCI/SUPI and uses this for the security procedures. In addition, the
subscription data is pre-configured at UDM or dynamically provisioned at UDM
on-demand. The AMF or SMF can obtain the UE subscription data from UDM using a
UE Subscription Identifier (SI-SUPI), which can be generated by UDM/UDR or be
provided by the AAA server. The SI-SUPI is new key for subscription data
retrieval and has impacts on the procedural level.
\- Sol#44 proposes that the similar mechanism as the Sol#4\'s case that the
primary authentication and authorization towards the AAA-S is triggered by AMF
based on local policy and UE indication. In addition, the AAA Server can
interact with SNPN UDM, supporting to provision the UE subscription data e.g.
session management subscription data, access and mobility subscription data at
UDM during registration procedure once the primary authentication and
authorization at AAA-S succeeds. The direct interaction between AAA server and
UDM has impacts on the system level.
Additionally, Sol#4 further addresses how to perform the selection the SNPN
that supports connection with AAA server using the network configuration per
desired SNPN at UE (PLMN ID + NID, Priority and optionally Subscribed SO ID)
and the broadcast information per SNPN (PLMN ID + NID, indication that
supports access using credentials of SO separate from the SNPN, and optionally
Supported SO ID list). While Sol#8, #10, #44 assume that existing network
selection mechanism can be reused to select the SNPN that supports access
using credentials of SO separate from the SNPN.
### 7.1.3 Evaluations for mobility scenarios
This clause provides evaluations for the solutions that address the mobility
scenario, among the solutions below described:
\- Sol#1 and Sol#2 supports mobility scenario based on roaming architecture
(i.e. Inter-PLMN like interworking) between the source/target network and the
Home SP, making use the PDU Session Establishment procedure with Existing PDU
Session indication as defined in TS 23.502 [6] clause 4.3.2.2 to address the
session continuity for the PDU sessions anchored in the home SP (SNPN or
PLMN). This only addresses the session continuity for \"Home Routed\" PDU
sessions and only considers the Inter-PLMN like interworking for mobility
cases.
\- Sol#41 considers all possible mobility cases and supports service
continuity taking into account the Inter-PLMN like interworking, usage of
N3IWF located in the network where PDU session is anchored and no
interconnection between source and target network. A new mobility indication
is provided by AMF of the target network to UE in order to instruct UE to use
which exact procedure for handover of the PDU session anchored at the Home SP
or anchored at the source SNPN network, i.e. A) for inter-PLMN like
architecture, B) for usage of N3IWF located in the network where PDU session
is anchored and C) for no interconnection between source and target network.
Alternatively, the UE is configured to perform the mobility procedure for
session handover in the order to A), B), C) until the PDU session is recovered
at the target network.
\- A): The UE performs the handover of the PDU session anchored at SNPN#1
using PDU Session Establishment procedure with Existing PDU Session indication
as defined in TS 23.502 [6] clause 4.3.2.2.2;
\- Or B): Handover of a PDU Session procedure between 3GPP and untrusted
non-3GPP access Procedure as defined in TS 23.502 [6] clause 4.9.2.1 or
4.9.2.2 that follows the PDU Session Establishment procedure at the target
network as defined TS 23.502 [6] clause 4.3.2.2.1;
\- Or C): PDU Session Establishment procedure with Initial Request indication
as defined in TS 23.502 [6] clause 4.3.2.2.1.
### 7.1.4 Evaluations for simultaneous data service from both V-SNPN and Home
SP (PLMN or SNPN)
This clause provides evaluations for the solutions that address the
simultaneous data services from both V-SNPN and Home SP (PLMN or SNPN) of
KI#2, among these solutions:
\- Sol#1 or #2 propose to support the Local Breakout PDU sessions and Home
routed PDU sessions to address the simultaneous data services from both V-SNPN
and Home SP (PLMN or SNPN).
\- This is not in the scope of KI#1.
Editor\'s note: Evaluate solution #50 when solution and impact is clear.
### 7.1.5 Evaluations for scenario where the SNPN offers connectivity for
UE(s) with credentials owned by separate entity offering AUSF/UDM
In case UE credentials are owned by separate entity offering AUSF/UDM, SNPN
needs to interact with AUSF/UDM in separate entity. Sol#12 proposes to reuse
the cross network service discovery mechanism specified in TS 23.502 [6]
clause 4.17.5 for service discovery. Sol#12 adds also cross network service
registration procedure, which allows for more dynamic deployment and service
update in case of multiple separate entities.
NOTE: Such cross network service discovery mechanism assumes that both SNPN
and separate entity support SBI based interworking architecture.
## 7.2 Key Issue #2: NPN support for Video, Imaging and Audio for Professional
Applications (VIAPA)
The evaluation is based on major principles from the KI#2 solutions. The
evaluation separates to different areas for each principle as below table:
Table 7.2-1: Evaluation of KI#2 related principles
+----------+----------+----------+----------+----------+----------+ | P | What it | Benefit, | System | Open | R | | rinciple | solves | drawback | impact | issues | eference | +==========+==========+==========+==========+==========+==========+ | N3IWF | Service | Benefit: | Based on | | Solution | | arch | co | | the | | #13, | | itecture | ntinuity | D | existing | | #14, | | | aspect. | rawback: | release | | #15, | | | | | 16 | | #17, | | | Simu | | archi | | #18, | | | ltaneous | | tecture, | | #46, | | | data | | No new | | #47, | | | service | | arch | | #48, | | | aspect. | | itecture | | #49, | | | | | impact | | #50, | | | | | | | #51, | | | | | | | #52 | +----------+----------+----------+----------+----------+----------+ | N3IWF | Same as | Benefit: | | | Solution | | arch | N3IWF | | | | #13, | | itecture | archi | D | | | #15, | | with | tecture. | rawback: | | | #48, | | dual | | | | | #50 | | radio | | | | | | | ca | | | | | | | pability | | | | | | | ( | | | | | | | 2RX/2TX) | | | | | | | UE | | | | | | | enha | | | | | | | ncement. | | | | | | +----------+----------+----------+----------+----------+----------+ | N3IWF | Same as | Benefit: | Solut | It is | Solution | | arch | N3IWF | | ion#48: | FFS | #48, | | itecture | arch | D | Network | r | #49 | | with | itecture | rawback: | t | egarding | | | app | | | riggered | which NF | | | lication | | | UE | and | | | layer | | | regi | which | | | service | | | stration | p | | | co | | | to | rocedure | | | ntinuity | | | target | is used | | | support | | | network | by the | | | | | | via | network | | | | | | N3IWF. | to | | | | | | | signal | | | | | | Solution | to the | | | | | | #49: | UE to | | | | | | The | active | | | | | | handover | non-3GPP | | | | | | or the | access | | | | | | deregi | in | | | | | | stration | another | | | | | | p | network. | | | | | | rocedure | | | | | | | is | It is | | | | | | t | FFS | | | | | | riggered | r | | | | | | by the | egarding | | | | | | AF; | how the | | | | | | | inf | | | | | | | ormation | | | | | | | is | | | | | | | obtained | | | | | | | by the | | | | | | | 3GPP | | | | | | | network | | | | | | | from the | | | | | | | app | | | | | | | lication | | | | | | | layer | | | | | | | r | | | | | | | egarding | | | | | | | the | | | | | | | mobility | | | | | | | d | | | | | | | ecision. | | +----------+----------+----------+----------+----------+----------+ | N3IWF | Paging | Benefit: | UE logic | | Solution | | arch | aspect. | | to keep | | #13, | | itecture | | D | one PDU | | #14, | | with | | rawback: | session | | #50 | | enh | | | in | | | | ancement | | | underlay | | | | to keep | | | network. | | | | UE in | | | | | | | CM-C | | | Existing | | | | onnected | | | liveness | | | | state in | | | check | | | | overlay | | | tool to | | | | network. | | | be used | | | | | | | over NWu | | | | | | | i | | | | | | | nterface | | | | | | | to keep | | | | | | | the NWu | | | | | | | co | | | | | | | nnection | | | | | | | open. | | | | | | | | | | | | | | Apply to | | | | | | | single | | | | | | | radio UE | | | +----------+----------+----------+----------+----------+----------+ | N3IWF | Paging | Benefit: | RAN and | Whether | Solution | | arch | aspect. | | CN | it is | #14 | | itecture | | D | impact | n | | | with | | rawback: | to keep | ecessary | | | enh | | | UE | to keep | | | ancement | | | always | UE in | | | to keep | | | in | CM-C | | | UE in | | | RRC- | onnected | | | CM-C | | | Inactive | in | | | onnected | | | in the | underlay | | | state in | | | underlay | network | | | both | | | network. | is FFS. | | | overlay | | | | | | | network | | | PDU | | | | and | | | session | | | | underlay | | | in | | | | network. | | | underlay | | | | | | | network | | | | | | | remains | | | | | | | active. | | | | | | | | | | | | | | Impact | | | | | | | to be | | | | | | | able to | | | | | | | select | | | | | | | certain | | | | | | | UE to be | | | | | | | released | | | | | | | to | | | | | | | RRC-I | | | | | | | nactive. | | | | | | | | | | | | | | Support | | | | | | | single | | | | | | | radio UE | | | +----------+----------+----------+----------+----------+----------+ | N3IWF | Paging | Benefit: | | IKEv2 | Solution | | arch | aspect. | | | impact | #17 | | itecture | | D | | is FFS. | | | with | | rawback: | | | | | enh | | | | How does | | | ancement | | | | the DL | | | to | | | | IPSec | | | i | | | | data | | | ntroduce | | | | reach UE | | | \"in | | | | when NAT | | | active\" | | | | timeout | | | mode on | | | | is FFS. | | | NWu | | | | | | | in | | | | | | | terface. | | | | | | +----------+----------+----------+----------+----------+----------+ | N3IWF | Simu | Benefit: | RAN | It will | Solution | | arch | ltaneous | | impact | be up to | #18 | | itecture | data | D | for | RAN WG2 | | | with | service | rawback: | uplink | and | | | enh | aspect. | | control | RAN WG3 | | | ancement | | | commu | to | | | to split | | | nication | evaluate | | | DL | | | with | and | | | traffic | | | single | decide | | | to Uu | | | Tx | what the | | | i | | | | RAN | | | nterface | | | UE/AMF | impact | | | and UL | | | impact | will be | | | traffic | | | to | or if | | | to NWu | | | support | reusing | | | i | | | split | the | | | nterface | | | ind | existing | | | for | | | ication. | RAN | | | 2RX/1TX | | | | m | | | UE. | | | | echanism | | | | | | | is | | | | | | | feasible | | +----------+----------+----------+----------+----------+----------+ | N3IWF | Simu | Benefit: | Solution | | Solution | | arch | ltaneous | | #46: | | #46, | | itecture | data | D | The USRP | | #47, | | with | service | rawback: | rule is | | #50 | | enh | aspect. | | extended | | | | ancement | | | or a new | | | | to | | | policy | | | | assist | | | is used | | | | UE to | | | for the | | | | choose | | | UE to | | | | either | | | select | | | | SNPN or | | | the | | | | PLMN to | | | subsc | | | | use Uu | | | ription. | | | | i | | | | | | | nterface | | | Solution | | | | for | | | #47: | | | | better | | | The | | | | QoS. | | | solution | | | | | | | provides | | | | | | | s | | | | | | | upported | | | | | | | PLMN | | | | | | | list to | | | | | | | the UE | | | | | | | to | | | | | | | decide | | | | | | | whether | | | | | | | to | | | | | | | access | | | | | | | SNPN | | | | | | | service | | | | | | | via SNPN | | | | | | | N3IWF | | | | | | | using | | | | | | | PLMN PDU | | | | | | | Session | | | +----------+----------+----------+----------+----------+----------+ | In | Service | Benefit: | To be | | Solution | | ter-PLMN | co | | c | | #1, | | like | ntinuity | D | oncluded | | #2, | | arch | aspect. | rawback: | from | | #50. | | itecture | | | KI#1 | | | | between | | | eva | | | | SNPN and | | | luation. | | | | PLMN. | | | | | | | | | | Only the | | | | | | | service | | | | | | | mobility | | | | | | | between | | | | | | | NPN and | | | | | | | PLMN | | | | | | | from the | | | | | | | outcome | | | | | | | of KI#1 | | | | | | | is | | | | | | | co | | | | | | | nsidered | | | | | | | by | | | | | | | KI#2. | | | +----------+----------+----------+----------+----------+----------+ | In | Simu | Benefit: | Network | The | Solution | | ter-PLMN | ltaneous | | impacts | impact | #50 | | like | data | D | for | of | | | arch | service | rawback: | control | s | | | itecture | aspect | | the | econdary | | | between | | | access | regi | | | SNPN and | | | to PLMN | stration | | | PLMN | | | services | at PLMN | | | with | | | using a | is FFS. | | | enha | | | HR PDU | | | | ncements | | | session | | | | to | | | or a | | | | enable | | | s | | | | SNPN | | | econdary | | | | operator | | | regi | | | | to | | | stration | | | | control | | | at PLMN. | | | | access | | | For | | | | to PLMN | | | s | | | | services | | | econdary | | | | | | | regi | | | | | | | stration | | | | | | | at PLMN, | | | | | | | the 5GC | | | | | | | can | | | | | | | indicate | | | | | | | to UE | | | | | | | whether | | | | | | | the | | | | | | | s | | | | | | | econdary | | | | | | | regi | | | | | | | stration | | | | | | | at PLMN | | | | | | | is | | | | | | | allowed | | | | | | | and | | | | | | | further | | | | | | | the PLMN | | | | | | | UDM will | | | | | | | d | | | | | | | etermine | | | | | | | whether | | | | | | | to | | | | | | | accept | | | | | | | UE\'s | | | | | | | s | | | | | | | econdary | | | | | | | regis | | | | | | | tration. | | | +----------+----------+----------+----------+----------+----------+ | N3IWF | Co | Benefit: | Solut | Solut | Solution | | arch | ncurrent | | ion#52: | ion#52, | #15, | | itecture | paging | D | Impact | it is | #50, | | with | and data | rawback: | due to | not | #52. | | MUSIM | service | | support | clear | | | like | for | | t | how the | | | implem | single | | emporary | backup | | | entation | radio | | leave. | UP is | | | | UE. | | | ma | | | | | | | intained | | | | | | | without | | | | | | | inte | | | | | | | rrupting | | | | | | | ongoing | | | | | | | service. | | +----------+----------+----------+----------+----------+----------+ | N3IWF | Because | Benefit: | UE to | | Solution | | arch | of the | | provide | | #51 | | itecture | traffic | D | overlay | | | | with QoS | charact | rawback: | network | | | | deg | eristics | | with | | | | radation | of VIAPA | | inf | | | | s | (e.g. | | ormation | | | | ubscript | High QoS | | about | | | | ion/noti | KPI, | | the | | | | fication | pot | | underlay | | | | between | entially | | network, | | | | overlay | bringing | | so the | | | | and | heavy | | overlay | | | | underlay | load to | | network | | | | network. | the | | could | | | | | n | | find the | | | | | etworks, | | underlay | | | | | etc) the | | network | | | | | overlay | | to make | | | | | network | | a QoS | | | | | need to | | deg | | | | | get QoS | | radation | | | | | noti | | subs | | | | | fication | | cription | | | | | from the | | request. | | | | | underlay | | | | | | | network | | | | | | | and | | | | | | | adjust | | | | | | | its QoS | | | | | | | acco | | | | | | | rdingly. | | | | | +----------+----------+----------+----------+----------+----------+ | N3IWF | Paging | Benefit: | UE, AMF, | How the | Solution | | arch | aspect | | SMF, NEF | NEF in | #55 | | itecture | | D | impacts | S | | | with | | rawback: | to | NPN/PLMN | | | paging/ | | | enable | finds | | | downlink | | | UE | the NEF | | | data | | | receive | in | | | event | | | the | P | | | s | | | paging | LMN/SNPN | | | ubscript | | | message | based on | | | ion/noti | | | from | PLMN | | | fication | | | another | ID/SNPN | | | between | | | network | ID is | | | overlay | | | | FFS. | | | and | | | | | | | underlay | | | | | | | network | | | | | | +----------+----------+----------+----------+----------+----------+
## 7.3 Key Issue #3: Support of IMS voice and emergency services for SNPN
Editor\'s note: This clause may provide a general evaluation and comparison of
the solutions per Key Issue #3.
## 7.4 Key Issue #4: UE Onboarding and remote provisioning
### 7.4.1 Evaluation for SNPN case
Table 7.4.1-1: Evaluation of UE onboarding related principles for SNPN case
+----------------------------------+----------------------------------+ | Principles UE onboarding | Solutions addressing the | | | principles for UE onboarding | +==================================+==================================+ | It should be possible to support | **Solution 5:** Supports both | | a registration procedure that | options i.e.: | | enables support for UE | | | onboarding using Default UE | > a) as part of the | | credentials and with an O-SNPN | > registration procedure the ON | | as the Onboarding Network (ON). | > together with the DCS | | | > authenticates the UE , | | | > | | | > b) ON does not perform | | | > primary authentication as part | | | > of the registration procedure, | | | > but during the configured PDU | | | > session establishment performs | | | > secondary authentication | | | > procedure. | | | | | | **Solution 27:** As part of the | | | registration procedure the ON | | | authenticates the UE with the | | | help of a DCS. The assumption in | | | the solution is that the , the | | | DCS should be provisioned with | | | an identity of the SNPN owning | | | the subscription. | | | | | | **Solution 31 clause 6.31.2.3:** | | | UE is assumed to provisioned | | | with default configuration i.e. | | | PLMN ID+NID, priority, | | | optionally Subscribed SO ID. The | | | AMF in the onboarding network | | | decides to trigger | | | authentication/security between | | | UE and DCS based on UE request | | | and local policy. AMF performs | | | the authentication between UE | | | and DCS using the default UE | | | credentials provided by the UE. | | | | | | **Solution 35:** Supports | | | scenarios with DCS and without | | | DCS deployed. For the case where | | | the device vendor maintains DCS, | | | it is assumed that SO\'s network | | | has an agreement with the DCS, | | | the solution involves DCS | | | connecting SO\'s network to | | | perform authentication. For the | | | case where the device vendor | | | does not maintain a DCS, the | | | solution assumes that SO holds | | | both UDM and PS. Since the SO | | | has ownership of on-boarding UE, | | | the solution assumes that the SO | | | could get the UE\'s default UE | | | credential and configures it in | | | the UDM. The UDM may reuse a | | | primary authentication based | | | default UE credential to | | | authorize the UE for | | | on-boarding. | | | | | | **Solution 37:** Solution | | | introduces a new network | | | function ONF (Onboarding and | | | Provisioning Function) which | | | stores both the default | | | configuration and provisioning | | | data for the UE. The UE is | | | preconfigured with the default | | | OPF address which is used by the | | | onboarding network to discover | | | the OPF which can provide O&P | | | service to the UE. The OPF can | | | provide onboarding | | | authentication and authorization | | | between UE and OPF. | | | | | | **Solution 40:** The solution | | | requires the UE to register with | | | an onboarding network to obtain | | | limited connectivity PDU session | | | allowing the UEs to access the | | | PS. DCS is in charge of primary | | | authentication. | +----------------------------------+----------------------------------+ | It should be possible that one | **Solution 5** : The ON may be | | SNPN can take the role of both | the same as SO-SNPN or not. | | Onboarding Network (ON) and SO | | | (Subscription Owner), and it | **Solution 27:** The ON may be | | should be possible that the ON | the same as SO-SNPN or not. | | and SO are different SNPNs i.e. | | | O-SNPN and SO-SNPN. | **Solution 31:** Though not | | | explicitly stated in the | | | solution, the solution | | | principles supports the ON may | | | be the same as SO-SNPN or not. | | | | | | **Solution 35:** The ON may be | | | the same as SO-SNPN or not. | | | | | | **Solution 37:** The ON may be | | | the same as SO-SNPN or not. | | | | | | **Solution 40** : Not stated in | | | the solution, but based on the | | | architecture described in the | | | solution the ON may be the same | | | as SO-SNPN or not. As for the UE | | | onboarding architecture, this | | | can be categorized as the 2nd | | | kind of potential mechanism for | | | DCS to authenticate the UE. PS | | | may play the role of SO-SNPN. UE | | | can connect to PS through a | | | limited PDU session without 3GPP | | | credentials. PS can forward the | | | attestation token to DCS for | | | authentication. This can allow | | | the UE, with no pre-configured | | | credentials, to get access to | | | the PS and DCS for | | | authentication and credential | | | acquisition. | +----------------------------------+----------------------------------+ | The SNPN, which directly | **Solution 5:** The onboarding | | interacts with DCS, determines | network discovers and connects | | the corresponding DCS identity | the DCS for the UE by checking | | or address/domain based on the | the realm part of the unique UE | | input from the UE. | identifier. | | | | | | **Solution 27:** The ON is | | | selects the DCS based on the | | | Onboarding SUPI presented by the | | | UE. | | | | | | **Solution 31:** The solution | | | states that the AMF decides to | | | trigger authentication/security | | | between UE and DCS based on UE | | | request and local policy, the | | | AMF may ask the UE to start EAA | | | procedure. However, it is not | | | clear how the AMF of the | | | Onboarding network determines | | | the DCS identity. | | | | | | **Solution 35** : The SUCI is | | | constructed by the UE based on | | | the onboarding information | | | broadcast by the onboarding | | | network i.e. includes PLMN ID, | | | NID of SO\'s network. | | | | | | (When DCS is deployed) The AUSF | | | in the onboarding network AUSF | | | finds DCS via AAA-P | | | (Solution#4) according to | | | domain part of device vendor in | | | SUCI. | | | | | | (When DCS is not deployed) The | | | AUSF finds a default UDM for | | | on-boarding if the UE does not | | | include domain part of device | | | vendor in SUCI or the AUSF | | | cannot find DCS according to the | | | domain part. | | | | | | **Solution 37:** The solution | | | does not support DCS and PS. OPF | | | is in the role of DCS plus PS, | | | and the default OPF address is | | | configured in the UE. The | | | solution requires two new | | | interfaces to be defined between | | | AMF of ON and OPF and also | | | between two OPFs. | | | | | | **Solution 40: After a | | | configured PDU session is | | | established to the PS, UE sends | | | attestation token to the | | | provisioning server by | | | application layer protocol. The | | | PS functions as a relay (IETF | | | Remote Attestation Procedures | | | Architecture), and forwards the | | | attestation token to the DCS. | | | The DCS verifies the attestation | | | token\'s signing using the | | | attestation key material.** | +----------------------------------+----------------------------------+ | The NG-RAN of the Onboarding | **Solution 5:** The NGRAN | | network includes information in | indicates \'support for | | the SIB so that the UE can | onboarding\' indicator in the | | discover and select an | SIB. The UE either manually or | | appropriate O-SNPN. | automatically discovers and | | | selects the O-SNPN network based | | | on the broadcasted information. | | | If multiple networks are | | | broadcasting the \"Support for | | | onboarding\" indication, then | | | the UE will select a network at | | | random. | | | | | | **Solution 29:** The NG-RAN is | | | configured and enabled to | | | broadcasts temporary Network | | | Identifier/Network readable name | | | for Onboarding in a given time | | | window and location within the | | | network. | | | | | | **Solution 27:** NG-RAN | | | broadcasts an indication of | | | support for Onboarding UE. | | | | | | **Solution 31** | | | **clause 6.31.2.3** : NG-RAN of | | | the Onboarding network | | | broadcasts PLMN ID + NID, an | | | indication of support for | | | Onboarding UE and optionally | | | supported SO-ID list. | | | | | | **Solution 35:** NG-RAN | | | broadcasts onboarding | | | information i.e. PLMN ID, NID of | | | SO\'s network. | | | | | | **Solution 37:** UE either | | | manually or automatically | | | discovers and selects the O-SNPN | | | network by some means, for | | | example based on the list of | | | onboarding SNPNs if available in | | | the default configuration. | | | | | | **Solution 40: The network | | | supports a UE to onboard without | | | a 3GPP credential, with the | | | addition of a SIB indication | | | meaning that \"access with no | | | credentials for a limited PDU | | | session\".** | +----------------------------------+----------------------------------+ | Using PLMN credentials for UE | **Solution 31 (clause 6.31.2.2 | | onboarding and PLMN as | case), Solution 33, Solution | | Onboarding Network (ON) is | 34** and **Solution 39** propose | | already possible and does not | using PLMN as an onboarding | | require any further | network and using default | | standardization work. | operator profile for the UE | | | onboarding and remote | | | provisioning purpose. | +----------------------------------+----------------------------------+ | Onboarding network should | **Solution 5:** During | | support functionality to | registration, the UE provides an | | restrict usage to only | RRC indication that is used by | | on-boarding service. | the NGRAN to select an AMF for | | | onboarding and an indication in | | | the Registration Request | | | indicating that the registration | | | is for restricted onboarding | | | service only. | | | | | | **Solution 27:** During the | | | initial registration for | | | Onboarding, the registration | | | type is set to \'Onboarding\'. | | | | | | **Solution 31:** The onboarding | | | 5G network allows the UE to | | | temporarily register for limited | | | service and setup a restricted | | | PDU Session for the purpose of | | | performing remote provisioning | | | based on local configuration or | | | received default operator | | | profile in the onboarding | | | network. | | | | | | **Solution 35:** After | | | successful authentication, the | | | UE establishes a configured PDU | | | session either to a well-known | | | or pre-configured S-NSSAI or | | | DNN, or the UE receives the URSP | | | including the S-NSSAI or DNN for | | | on-boarding, or the UE receives | | | the S-NSSAI by using the | | | indication that this is | | | registration for UE onboarding | | | provided by the UE, which is | | | used just for provisioning | | | purposes and has limited | | | connectivity capabilities. | | | | | | **Solution 37:** OPF in the role | | | of DCS plus PS. O-SNPN discovers | | | the default OPF that stores | | | UE\'s provisioning data, based | | | on the information provided by | | | UE, e.g. default OPF address. | | | O-SNPN discovers the target OPF | | | that stores UE\'s provisioning | | | data, based on the information | | | (e.g. target OPF address) | | | feedbacked from default OPF when | | | the O-SNPN queries the default | | | OPF. | | | | | | **Solution 39:** UE can attach | | | to the onboarding PLMN using the | | | default operator profile that is | | | used only for UE onboarding e.g. | | | contain a default Subscribed | | | S-NSSAI and a default DNN that | | | are appropriate to reach the PS. | | | | | | **Solution 40:** During the | | | Onboarding -- attestation step, | | | the registration type is set to | | | \'Onboarding\'. | +----------------------------------+----------------------------------+ | The UE shall initiate | **Solution 5:** Upon successful | | de-registration from the | provisioning, the UE releases | | on-boarding network after | the Configuration PDU Session | | finishing the remote | and deregisters from the O-SNPN. | | provisioning or the on-boarding | The UE will then perform SNPN | | network shall initiate the | selection and register to the | | de-registration after successful | SO-SNPN as per received | | completion of onboarding or | configuration during remote | | based on timer configured for | provisioning and general SNPN | | on-boarding registration. | selection procedures. | | | | | | The O-SNPN can monitor the time | | | duration of the Configuration | | | PDU Session or Onboarding | | | Registration in order to prevent | | | misuse. | | | | | | **Solution 27:** Once the UE has | | | been provisioned with NPN | | | credentials and additional data, | | | it deregisters from the network, | | | and it may perform a PLMN | | | selection and registration with | | | the new provisioned data. | | | | | | **Solution 31: Once the UE has | | | been provisioned with the SNPN | | | credentials, UE triggers the | | | UE-initiated de-registration or | | | when the temporary registration | | | is invalid, i.e. the valid | | | period expires, the AMF triggers | | | the network-initiated | | | de-registration.** | | | | | | **Solution 35:** Upon successful | | | provisioning, the UE releases | | | the configuration PDU session | | | and deregisters from the O-SNPN. | | | | | | **Solution 37:** The solution | | | allows for the UE to perform | | | re-registration or network | | | re-selection to access the | | | desired network service by using | | | the provisioned subscription | | | data. | | | | | | **Solution 39:** Upon a | | | successful provisioning, the UE | | | releases the PDU Session and | | | deregisters from the ON. | +----------------------------------+----------------------------------+
### 7.4.2 Evaluation for PNI-NPN case
Table 7.4.2-1: Evaluation of UE onboarding related principles for PNI-NPN case
+----------------------------------+----------------------------------+ | Principles UE onboarding | Solutions addressing the | | | principles for UE onboarding | +==================================+==================================+ | No enhancement for the UE | **Solution 7:** public | | onboarding (component 1 of | subscription/credentials are | | KI#4) with PLMN credentials | used by the UE and PLMN for | | used for primary authentication | onboarding and network | | and PLMN network selection are | selection. | | needed for the case of PNI-NPN | | | credentials provisioning | **Solution 28:** a PLMN | | | subscription without any content | | | related to NPN is used, can per | | | the current means the UE | | | performs onboarding and network | | | selection. | | | | | | **Solution 32:** A USIM is | | | provisioned with credential for | | | this PLMN. When the UE inserts | | | the USIM and switched on, the UE | | | performs PLMN selection and | | | registration as per | | | TS 23.122 [5] and | | | TS 23.502 [6]. | | | | | | **Solution 33:** The device has | | | a default PLMN operator profile | | | (i.e. default subscription). It | | | is assumed that through the | | | default PLMN operator profile, | | | the UE gains connectivity to the | | | PLMN. | | | | | | **Solution 34:** UE have | | | registered to the PLMN using | | | PLMN subscriptions/credentials. | | | | | | **Solution 38:** The UE has | | | subscription for the PLMN and | | | executes registration procedure | | | according to TS 23.502 [6]. | +----------------------------------+----------------------------------+ | At least network initiated | **Solution 7:** When the | | remote provisioning of | subscription data in UDM is | | credentials to allow access to | updated or activated by PS, the | | PNI-NPN services should be | UDM provides the subscription | | supported in Rel-17 | via UCU to UE. | | | | | | **Solution 28:** The 5GC | | | triggers PNI-NPN provisioning. | | | | | | **Solution 32:** According to | | | \"NPN credential changed\" | | | indication(s) the UDM sends the | | | credentials and the combined | | | S-NSSAIs or DNNs to the AMF. | | | Then the provisioned credentials | | | are provided along with other | | | subscription data using steering | | | of roaming mechanism. | | | | | | **Solution 33:** NA | | | | | | **Solution 34:** AMF is | | | triggered by Subscriber Data | | | Update Notification, which | | | include the On-boarding | | | information, from UDM and | | | perform UE Parameters Update | | | procedures to send the | | | Onboarding Information to the | | | UE. | | | | | | **Solution 38:** It is assumed | | | that the PLMN is aware about the | | | UEs which need provisioning | | | before the S-NSSAI or DNN used | | | for PNI-NPN is activated. The | | | UDM/UDR notifies the AF/E-PS | | | about the UE reachability. The | | | AF/E-PS initiates a C-plane | | | procedure to update/provision | | | the UE with identity and | | | security parameters for SAA: | | | | | | a) The C-plane communication is | | | used to trigger the UE to | | | perform U-plane provisioning: | | | the AF/E-PS can either initiate | | | Device Triggering procedure | | | towards the UE, or send an MT | | | SMS in order to trigger the | | | application in the UE to use IP | | | connectivity for provisioning of | | | the PNI-NPN identity and | | | credentials, or use Remote SIM | | | Provisioning (RSP) mechanism by | | | sending an SMS PUSH to enable | | | the U-plane provisioning of the | | | eUICC via HTTPS. | | | | | | b) The C-plane communication is | | | used to provision the PNI-NPN | | | identity and credentials to the | | | UE. | +----------------------------------+----------------------------------+ | Both procedures using Control | **Solution 7:** When the | | Plane and using User Plane | subscription data in UDM is | | protocols after establishing PDU | updated or activated by PS, the | | session shall be enabled for | UDM provides the subscription to | | remote provisioning the PNI-NPN | UE via UCU and the PS provides | | credentials used for NSSAA | the credentials to UE via user | | and/or PDU Session secondary | plane. | | authentication | | | | **Solution 28:** The 5GC | | | triggers the provisioning | | | procedure with the NPN via UP or | | | CP based methods. | | | | | | **Solution 32:** The UDM may or | | | may not receive the credentials | | | from PS before UE registration. | | | In case UDM stores the | | | credentials, UDM provides the | | | credentials to UE via CP along | | | with the combined S-NSSAI for | | | PNI-NPN. In case UDM doesn\'t | | | store the credentials, UDM | | | requests the credentials from | | | the PS on demand and provides | | | the credentials to UE via CP | | | along with the combined S-NSSAI. | | | | | | **Solution 33:** Each device | | | supports Bearer Independent | | | Protocol (BIP) required in GSMA | | | eSIM solution to enable the | | | eUICC to set up the | | | communication channel between | | | eUICC and the eUICC platform via | | | the IP connectivity of the UE on | | | top of the established PDU | | | Session to receive the | | | information. | | | | | | **Solution 34:** AMF is | | | triggered by Subscriber Data | | | Update Notification, which | | | include the On-boarding | | | information, from UDM and | | | perform UE Parameters Update | | | procedures to send the | | | Onboarding Information to the | | | UE. | | | | | | **Solution 38:** Provided by | | | AF/E-PS via CP or UP to UE. | +----------------------------------+----------------------------------+ | For User Plane remote | **Solution 7:** The UE may reuse | | provisioning: The protocol for | existing N3GPP credential | | provisioning of PNI-NPN | management protocol with the PS. | | credentials used for NSSAA | For example, to reuse CMPv2 | | and/or PDU Session secondary | protocol to ask CA for signing a | | authentication, i.e. how the UE | vertical\'s certificate. The | | download the NPN credential from | credential can be stored in | | the PS after PDU session | either ME or UICC. | | establishment in PNI-NPN, is out | | | of scope of SA WG2. | **Solution 28:** NA | | | | | | **Solution 32:** NA | | | | | | **Solution 33:** The underlying | | | protocol used for BIP is based | | | on TCP/IP which is one of the | | | options used for M2M device as | | | specified in eSIM solution GSMA | | | SGP.21 [24] and GSMA | | | SGP.22 [25]. When UE gets the | | | IP connectivity, the ME will | | | send the network attachment | | | event to the eUICC and then the | | | eUICC opens a BIP channel with | | | the relevant parameters to | | | address eUICC platform. | | | | | | **Solution 34:** NA | | | | | | **Solution 38:** The AF/E-PS can | | | either initiate Device | | | Triggering procedure towards the | | | UE, or send an MT SMS in order | | | to trigger the application in | | | the UE to use IP connectivity | | | for provisioning of the PNI-NPN | | | identity and credentials. | | | Alternatively, the AF/E-PS may | | | use Remote SIM Provisioning | | | (RSP) mechanism by sending an | | | SMS PUSH to enable the U-plane | | | provisioning of the eUICC via | | | HTTPS. | +----------------------------------+----------------------------------+ | For User Plane remote | **Solution 7:** The PLMN may be | | provisioning: The PS address and | pre-configured with | | DNN/NSSAI used to access PS may | **_Provisioning Server Routing | | be provided to the UE during or | Information_** including the | | after the Registration | allowed PS address list. When | | procedure. | the UE is requesting PNI-NPN\'s | | | Provisioning Server Routing | | | Information, the PLMN triggers | | | to initiate UPU procedure to | | | update Provisioning Server | | | Routing Information to the UE. | | | | | | **Solution 28:** The UE is | | | updated with the subscription | | | data for the NPN using existing | | | Rel-16 capabilities/procedures | | | e.g. Configured NSSAI, CAG | | | information, URSP rules for the | | | NPN, new SoR information. For | | | the UP based method, the 5GC | | | requests the UE to initiate the | | | NPN provisioning process by | | | establishing a PDU Session to | | | the onboarding DNN of the NPN. | | | | | | **Solution 32:** NA | | | | | | **Solution 33:** default PLMN | | | operator profile (i.e. default | | | subscription) stored in the | | | eUICC to allow the UE to | | | initially gain the IP | | | connectivity through PLMN | | | access. | | | | | | **Solution 34:** NA | | | | | | **Solution 38:** The AF may send | | | to the UE the external | | | provisioning server (E-PS) | | | address and Authentication Token | | | to allow the application in the | | | UE to trigger secure UP | | | communication with the PS. In | | | the UE, the security parameters | | | should be associated with a | | | service subscription identified | | | by service ID (e.g. application | | | ID, S-NSSAI, DNN) in order to | | | allow the UE to differentiate | | | among multiple sets of security | | | parameters. | +----------------------------------+----------------------------------+ | For User Plane remote | **Solution 7:** When the UE has | | provisioning: Upon successful | been successfully authenticated, | | remote provisioning of the UE, | the PLMN updates UE\'s | | the UE Subscription Data in the | subscription data according to | | UDM/UDR may be updated to enable | pre-configured static vertical | | the access to the PNI-NPN | subscriptions (DNN, S-NSSAI, CAG | | | subscription). | | | | | | **Solution 28:** The NPN | | | administrator uses APIs to | | | enable PLMN operator to update | | | the PLMN subscription in the 5GC | | | e.g. with NPN S-NSSAI, content | | | of the NPN DN to enable URSP | | | rules. This includes the request | | | of the NPN for the 5GC to | | | trigger an onboarding procedure | | | for the UE with the NPN. This | | | request includes information of | | | the NPN (e.g. NPN onboarding DNN | | | for the UP based onboarding | | | method) relevant for the NPN | | | onboarding procedure. | | | | | | **Solution 32:** NA | | | | | | **Solution 33:** NA | | | | | | **Solution 34:** NA | | | | | | **Solution 38:** After the UE is | | | updated via application-level | | | signalling via User Plane or via | | | Control Plane, the AF can | | | activate or deactivate the | | | service subscription in the | | | UDM/UDR. | +----------------------------------+----------------------------------+ | For Control Plane remote | **Solution 7:** It is assumed | | provisioning: It is assumed that | that the PS can behave as the AF | | the PS communicates with the 5GC | towards PLMN NEF and as AAA | | using 3GPP defined protocols. | towards PLMN SMF. | | | | | | **Solution 28:** It is assumed | | | that the PS can behave as the AF | | | towards PLMN OSS and as AAA | | | towards PLMN SMF. | | | | | | **Solution 32:** It is assumed | | | that the PS can behave as the AF | | | towards PLMN NEF. | | | | | | **Solution 33:** NA | | | | | | **Solution 34:** It is assumed | | | that the PS can behave as the AF | | | towards PLMN NEF and as AAA | | | towards PLMN SMF. | | | | | | **Solution 38:** The AF/E-PS | | | (external provisioning server) | | | can activate or provision the | | | network (e.g. UDM/UDR) via NEF | | | or OSS. | +----------------------------------+----------------------------------+
# 8 Conclusions
## 8.1 Key Issue #1: Enhancements to Support SNPN along with credentials owned
by an entity separate from the SNPN
### 8.1.1 Conclusions for scenario where the SNPN offers connectivity for
UE(s) with credentials owned by separate entity offering AAA Server
The scenario where the separate entity owning the credentials has only an AAA
Server is supported. It is proposed to adopt the following conclusion
principles:
\- The SNPN will host a function (e.g. enhanced AUSF or new NF) supporting
primary authentication and authorization of SNPN UEs that use credentials from
the AAA Server. Also re-authentication procedure is supported during a
specific RM, CM procedure e.g. Registration procedure, SR procedure.
NOTE 1: Whether to use a new NF or enhanced AUSF will be determined based on
feedback from SA WG3.
\- The function (see above) forwards EAP messages to the AAA server that is
acting as the EAP Server for the purpose of primary authentication and
authorization.
\- The user identity used to identify the UE during primary authentication and
authorization towards the AAA sever is the same SUPI as used within the 5GC
SNPN.
\- The AMF discovers and selects the AUSF as described in TS 23.501 [4] clause
6.3.4 using the Home Network Identifier and Routing Indicator present in the
SUCI provided by the UE.
\- The AUSF (e.g. enhanced AUSF or new NF) in SNPN selects the AAA hosted by
the external entity. The discovery and selection functionality (within the
AUSF) uses the domain name corresponds to the realm part (_specified in the
NAI format for SUPI in clauses 28.15.2 and 28.16.2)_ within Network specific
identifier that identifies the external entity to perform discovery and
selection of the AAA hosted by the external entity.
\- The UDM supports mobility management and session management subscription
information that is needed at the time of Registration and Session Management
procedure.
\- SNPN selection for UE(s) with credentials owned by separate entity offering
AAA Server is the same as the conclusion of SNPN selection for UE(s) with SNPN
subscription as described in clause 8.1.4.
\- After completing the primary authentication and authorization successfully,
the AMF or SMF can retrieve the SNPN UE subscription data (i.e. mobility
management and session management subscription) using SUPI from UDM.
NOTE 2: The interactions or interfaces between the existing/enhanced AUSF (or
new NF) and the AAA server can be defined by SA2 during normative phase e.g.
based on SA3\'s feedback.
### 8.1.2 Conclusions for mobility scenarios
The mobility procedures are based on:
\- In the case that there are common AMF and/or N14 interface between the
source network and target network, mechanism defined in TS 23.502 [6] clause
4.9.1 is re-used to address UE mobility.
\- In the case of idle mode mobility, the UE performs initial or mobility
registration as specified in clause 4.2.2.2.2 of TS 23.502 [6].
\- Support of authentication using credentials from an external entity is
homogenous throughout a SNPN i.e. the SIB information in clause 8.1.4 should
be set uniformly and no changes in mobility handling are needed to address
inhomogeneous support of the feature.
NOTE: Needed updates to find the correct source or target AMF and what are the
applicable UE identities in the registration message will be determined in
normative phase.
### 8.1.3 Conclusions for simultaneous data service from both V-SNPN and a
separate entity owning the credentials (PLMN or SNPN)
### 8.1.4 Conclusions on SNPN selection for UEs with an SNPN subscription
The following enhancements will be progressed in the normative phase:
\- Group ID as a specific case of SNPN ID reusing SNPN ID encoding in TS
23.003 [15], where:
\- Assignment mode 1 indicates self-managed Home SP Group ID values as the NID
Value is chosen independently at deployment time.
\- Assignment mode 0 indicates Home SP Group ID is globally unique as the NID
Value is globally unique. One possibility for ensuring uniqueness is to use
IANA PEN as in TS 23.003 [15].
\- SIB will be enhanced as follows, for SNPN only:
\- Indication that \"access using credentials from a separate entity is
supported\".
\- Optionally, supported Group IDs (GIDs).
\- Optionally, an indication whether the SNPN allows registration attempts
from UEs that are not explicitly configured to select the SNPN.
NOTE 1: This refers to UEs that do not have an entry in the user-controlled or
the separate entity-controlled lists of preferred SNPNs matching the SNPN\'s
network identity and that do not have an entry in the separate entity-
controlled prioritized list of Group IDs matching any of the Group IDs
supported by the SNPN.
NOTE 2: The number of supported Group IDs that can be broadcast will be
determined by RAN WG2.
\- UE configuration:
\- User-controlled prioritized list of preferred SNPNs.
\- Separate entity controlled prioritized list of preferred SNPNs.
\- Separate entity-controlled prioritized list of Group IDs (GIDs).
NOTE 3: The UE may also only be configured with the separate entity-controlled
prioritized list of preferred SNPNs or only the separate entity-controlled
prioritized list of Group IDs.
NOTE 4: If the UE has multiple subscriptions owned by different entities
separate from the SNPN it is assumed that the subscription to use is selected
by implementation specific means (e.g. based on user input) prior to network
selection.
\- For a UE configured to use SNPNs, automatic SNPN selection is performed in
the following order:
\- UE selects and attempts to register with the SNPN it was last registered
with (if available).
\- UE selects and attempts to register with the available SNPN identified by a
PLMN ID and NID for which the UE has SUPI and credentials (i.e. as in Rel-16).
\- UE selects an available and allowable SNPN, which broadcasts \"access using
credentials from a separate entity is supported\" indication and an SNPN ID
contained in the user-controlled list (if available).
\- UE selects an available and allowable SNPN which broadcasts \"access using
credentials from a separate entity is supported\" indication and an SNPN ID
contained in the separate entity-controlled list (if available).
\- UE selects an available and allowable SNPN which broadcasts \"access using
credentials from a separate entity is supported\" indication and a GID
contained in the separate entity-controlled list (if available).
\- If the UE has not found an available and allowable SNPN based on the above,
the UE selects an available and allowable SNPN which broadcasts an indication
that the SNPN allows registration attempts from UEs that are not explicitly
configured to select the SNPN:
\- If the UE detects a plurality of such SNPNs, the order in which the UE
selects and attempts a registration with an SNPN is implementation specific.
\- If the UE is unable to find a suitable cell of any available and allowable
SNPN based on the above, the UE attempts to camp on an acceptable cell of any
available SNPN supporting emergency calls (irrespective of SNPN ID) or of any
available PLMN (irrespective of PLMN ID), in limited service state.
\- The UE continues automatic SNPN selection based on the above until a
suitable cell is found or until the user stops the automatic selection
procedure (in which case the user may proceed with manual network selection).
NOTE 5: The details of how to prevent a UE from automatically repeatedly
selecting an SNPN that rejects the UE\'s registration (i.e. handling of
permanently and temporarily forbidden SNPNs) can be defined by CT1.
\- For manual SNPN selection the UE presents all available SNPNs, which
broadcast the \"access using credentials from a separate entity is supported\"
indication.
NOTE 6: The order in which available SNPNs are presented can be defined by
CT1.
### 8.1.5 Conclusions for UEs with a PLMN subscription
The following enhancements will be progressed in the normative phase on how to
perform SNPN access network authentication of a UE based on 3GPP identities
and credentials supplied by the PLMN:
\- SIB enhancements as described in clause 8.1.4.
\- UE configuration enhancements as described in clause 8.1.4.
\- PLMN controlled information for SNPN selection in the UE can be updated
using the UE Parameters Update via UDM Control Plane Procedure as defined in
TS 23.502 [6] clause 4.20.2 or Steering of Roaming (SoR) as defined in TS
23.122 [5] Annex C.
NOTE 1: Which of the two procedures to use will be determined during the
normative phase based on feedback from CT1 and SA3.
\- Network selection and registration.
\- To enable a UE with PLMN subscription to select an SNPN, the UE needs to
enter SNPN access mode.
NOTE 2: (De)activation of SNPN access mode is up to UE implementation.
\- Once the UE has entered SNPN access mode, SNPN selection is performed as
described in clause 8.1.4.
\- Once an SNPN has been selected the UE attempts registration using the PLMN
credentials.
### 8.1.6 Conclusions for scenario where the SNPN offers connectivity for
UE(s) with credentials owned by separate entity offering AUSF and UDM
The scenario where the separate entity hosts UDM, AUSF and owns the
subscription is supported. It is proposed to adopt the following conclusion
principles:
\- **Discovery of AUSF/UDM in the separate entity** can be supported by
**cross network service discovery and registration procedure as specified in**
_TS 23.502_[6] _clause 4.17.5 where Home PLMN is replaced by the separate
entity._ In order to facilitate selection of the separate entity owning the
subscription (i.e. AUSF, UDM in the Home SNPN), the SUPI/SUCI provided by the
UE contains a Home Network Identifier. When the SUPI type is an IMSI, the Home
Network Identifier should comprise of PLMN ID + NID that points to the
external entity; if SUPI is a Network Specific Identifier, the domain name
corresponds to the realm part and the realm should identify the external
entity.
\- It is recommended to enhance Nudm, Nausf, Namf and Nsmf services to support
access to an SNPN using credentials from a separate entity that has UDM and
AUSF, with the limitation that Session Management procedures are only
supported for PDU Sessions terminating in the SNPN.
### 8.1.7 Conclusions for update of Separate entity controlled prioritized
list of preferred SNPNs
The following conclusions are made for updating the separate entity controlled
prioritized list of preferred SNPNs over the control plane in the UE:
\- Separate entity controlled prioritized list of preferred SNPNs in the UE
can be updated using the UE Parameters Update (UPU) via UDM Control Plane
Procedure as defined in TS 23.502 [6] clause 4.20 or Steering of Roaming (SoR)
as defined in TS 23.122 [5], Annex C.
NOTE: Which of the two procedures to be used will be determined during the
normative phase based on feedback from CT1 and SA3.
\- An update of the Separate entity controlled prioritized list of preferred
SNPNs from the separate entity may trigger the UE to perform SNPN selection
again, e.g. to potentially select a higher prioritized SNPN.
## 8.2 Key Issue #2: NPN support for Video, Imaging and Audio for Professional
Applications (VIAPA)
When the NPN is deployed as PNI-NPN, the simultaneous data service from PLMN
and NPN and service continuity is fully supported by existing Rel-16
functions.
When UE only has single subscription, the data service from both V-SNPN and
Home SP (PLMN or SNPN), as well as service continuity is to be evaluated and
concluded by KI#1.
When UE have both subscriptions for SNPN and PLMN, following interim
agreements are adopted.
For the issue of service continuity for VIAPA,
\- It is concluded that the existing Rel-16 N3IWF-architecture is used as the
basis to address data service from both networks and session/service
continuity between the two networks.
\- For single radio UE, PDU session continuity can be realized by utilizing
the existing handover procedure between non-3GPP access and 3GPP access for
single access PDU session, where one network is acting as non-3GPP access of
the other network.
\- For dual radio UE the UE can use one radio operating in SNPN access mode
and the other operating the normal PLMN selection, in order to avoid SNPN
access mode switch. PDU Session continuity and service continuity may e.g. be
provided as follows:
\- UE registers to both SNPN and PLMN the procedure described in clause 4.9.2
in TS 23.502 [6] is followed as necessary.
\- Register to the same 5GC via both Uu and NWu interface and possibly
establish MA-PDU session. Upon mobility, UE and UPF could switch the user
plane resource to the corresponding access type.
Editor\'s note: Dual radio may have radio limitation when operated
simultaneous with two independent service providers. It is FFS whether is
further enhancements is needed.
For the issue of QoS support for VIAPA:
NOTE 1: The network does not assist the UE to select the proper network for Uu
in this Release.
\- After the UE selects the SNPN or PLMN, the UE obtains VIAPA service with or
without Rel-16 N3IWF architecture specified in clause D.3 of TS 23.501 [4].
\- It is proposed to add an informative guideline for mapping between
standardized 5QI/ARP and DSCP marking value in TS 23.501 [4], Annex D, so that
the PLMN and SNPN may use the same mapping values for UL and DL user plane
traffic within SNPN and PLMN.
To ensure appropriate latency to resume a service provided by the overlay
network, the NG-RAN uses existing information to transition UE to appropriate
RRC state.
To support UE to receive data services from one network (e.g. NPN), and paging
as well as data services from another network (e.g. PLMN) simultaneously, the
following principles will be progressed in the normative phase:
\- For single radio UE, keep overlay network connection always in CM-CONNECTED
by using mechanisms available in Rel-16.
NOTE 2: Mechanisms available such as the IKEv2 liveness check procedure
defined in clause 7.8 and clause 7.9 in TS 24.502 [10] allows to keep alive
the PDU session in underlay network avoiding the deregistration from the
overlay network. The timer in TIMEOUT_PERIOD_FOR_LIVENESS_CHECK attribute,
CM_IDLE timer and N3GPP UE Deregistration timer need to be configured properly
in order to efficiently reach the goal of increasing UE reachability and
reduce the lack of paging in PDU session carried over IKEv2. In case of IKEv2
liveness check failure, as long as the UE maintains a PDU session in underlay
network, existing mechanism defined in NOTE 3 in clause 5.5.2 in TS 23.501 [4]
enables the UE to transit to CM-CONNECTED state again.
\- When N3IWF based solution is used, the overlay network and its service AF
can use existing NEF notification procedures, such as of subscribing the \"QoS
monitoring\" or \"QoS sustainability\" via the interface between NEF and AF,
to subscribe and receive the notification from underlay network regarding the
connectivity QoS status or QoS mapping changes that are associated with the
IPsec of the overlay network. With the QoS update information from the
underlay network, the overlay network can adjust its connectivity QoS
accordingly. The opposite way is also applicable that the underlay network and
its service AF can use existing NEF notification procedures, such as of
subscribing the \"QoS monitoring\" or \"QoS sustainability\" via the interface
between NEF and AF, to subscribe and receive the notification from overlay
network regarding the connectivity QoS status or QoS mapping changes that are
associated with the IPsec of the overlay network. With the QoS update
information from the underlay network, the underlay network can adjust its
connectivity QoS accordingly. No need of new information for QoS notification
between PLMN and SNPN has been identified in this study. Informative guideline
on how to use existing QoS notification mechanism between SNPN and PLMN can be
provided during the normative phase as informative annex.
Concurrent access to very low latency VIAPA services and PLMN services can be
supported as follows:
\- The single radio UE may register on the SNPN and accesses VIAPA services
directly via the SNPN and accesses PLMN services via the SNPN and the PLMN\'s
N3IWF.
\- The single radio UE may register on the PLMN and accesses VIAPA services
directly via the PLMN (e.g. based on a local UPF and direct peering between
the PLMN and the venue\'s VIAPA services) and also accesses PLMN services
directly via the PLMN.
## 8.3 Key Issue #3: Support of IMS voice and emergency services for SNPN
The following principle is proposed to be part of interim conclusion for
further study and normative work:
\- The use of IMC shall be possible when USIM or ISIM is not available in UEs
accessing IMS via an SNPN according to Solution #21.
\- The reuse of USIM credentials for IMS AKA shall be possible when USIM is
available in UEs accessing IMS via an SNPN.
\- It is recommended for normative work to support voice services with SNPN
based on existing mechanisms as defined in TS 23.501 [4] clause 5.16.3. EPS
fallback and T-ADS are not supported.
\- Solution #23 is recommended for normative work to support emergency
services with SNPN.
\- Solution #56 is recommended for normative work to support SNPN selection
for \"voice centric\" UEs as the result of voice domain selection.
\- Support for the scenario for IMS network, (e.g. PLMN) providing services to
a UE connected in an SNPN having an interconnection SLA with the IMS network.
NOTE: The documentation of this scenario will be in an informative Annex in TS
23.228 [16].
\- No normative work will be done for the scenario when the separate entity
owning credentials per KI#1 supports IMS.
## 8.4 Key Issue #4: UE onboarding and remote provisioning
### 8.4.0 General
NOTE: Control Plane remote provisioning is network-triggered, PDU session
establishment for User Plane remote provisioning is UE-triggered
### 8.4.1 Conclusions for SNPN case
**UE onboarding for SNPN (Component 1 of KI#4)**
\- It should be possible to support a registration procedure that enables
support for UE onboarding using Default UE credentials and with an O-SNPN as
the Onboarding Network (ON).
Editor\'s note: In order to support UE onboarding using Default UE credentials
and O-SNPN as the Onboarding Network (ON) the distribution of security
functions when primary authentication is used should be decided by SA WG3,
e.g. whether and how to support the primary authentication based on default
credential in case DCS is deployed or not.
\- It should be possible that one SNPN can take the role of both Onboarding
Network (ON) and SO (Subscription Owner), and it should be possible that the
ON and SO are different SNPNs i.e. O-SNPN and SO-SNPN.
Editor\'s note: DCS is potentially introduced to authenticate a UE with
default UE credentials or provide means to another entity to do it. There are
two potential mechanisms for DCS to authenticate the UE.\ 1) DCS interacts
with O-SNPN and Network Function in SO-SNPN (Subscription Owner SNPN) is not
involved in the authentication procedure. As a result, the SO-SNPN is not
directly involved with the authentication procedure but gets informed of its
result and then performs remote provisioning.\ 2) DCS interacts with SO-SNPN
and Network Function in SO-SNPN (Subscription Owner SNPN) is involved in the
authentication procedure. As a result, the SO-SNPN is directly involved and
aware of the result of authentication procedure and performs remote
provisioning.\ SA WG3 needs to evaluate the two above mechanisms from security
perspective and provide feedback.
Editor\'s note: It is up to SA WG3, whether DCS can interact with PS after the
primary authentication for provisioning.
Editor\'s note: The decision on whether primary authentication is required
during initial access to the O-SNPN is dependent on SA WG3 feedback; until
this feedback is received, it is assumed that such authentication is required.
\- A network authentication mechanism that prevents the UE from performing the
UE onboarding procedure with a rogue network needs to be supported.
NOTE 1: How to perform authentication between UE and the network is discussed
in SA3.
\- During the onboarding registration procedure, the UE registers with its
Onboarding SUCI which is based on the Onboarding SUPI. Onboarding SUPI is
encoded as a network specific identifier taking the format of a NAI (i.e.
user\@realm). The SNPN, which interacts with DCS, may determine the
corresponding DCS identity or address/domain, based on the Onboarding SUCI
provided by the UE or when primary authentication is used based on information
(e.g. DCS address) locally provisioned at SNPN, using mechanisms similar to
those for AUSF and UDM discovery and selection described in TS 23.501 [4].
\- The DCS can be an entity external to the 5GC of O-SNPN.
\- The NG-RAN of the Onboarding network includes an indication for Onboarding
enabled in the SIB (per O-SNPN, considering that the NG-RAN can be shared) so
that the UE can discover and select an appropriate O-SNPN. The UE may or may
not be pre-configured with O-SNPN network selection information (e.g. O-SNPN
network identifiers or Group ID(s)). The O-SNPN network selection information
can assist the UE such that the UE either preferably or exclusively select an
O-SNPN corresponding to the O-SNPN network identifiers or Group ID(s).
NOTE 2: The format of the pre-configured information assisting the UE for
O-SNPN selection is not specified.
NOTE 3: The Group ID(s) in the SIB that UE can use for selecting an O-SNPN are
the same as the Group ID(s) in the SIB that the UE uses for SNPN selection as
part of KI#1.
NOTE 4: Whether the indication for Onboarding is sufficient or more SIB
information is needed can be further discussed in the normative phase.
\- Upon registration to an SNPN for Onboarding, the UE provides an indication
at RRC level that the RRC connectionis for onboarding. This information will
be specified only for SNPN and allows NG-RAN to select an appropriate AMF that
supports onboarding procedures.
NOTE 5: RAN WGs can work with SA2 to decide whether handling of RAN-level
congestion is feasible.
\- Upon registration to an SNPN for Onboarding, the UE provides an indication
at NAS level that the registration request is for onboarding to allow AMF to,
e.g. select an appropriate SMF and perform other onboarding-related
configuration. When UE performs initial Registration for onboarding, the UE
does not request to be registered over a network slice and as such the UE does
not include Requested NSSAI in either RRC or NAS; it is up to the network to
decide which network slice is used for the onboarding and provisioning
procedures.
\- Using PLMN credentials for UE onboarding and PLMN as Onboarding Network
(ON) is already possible.
\- Onboarding network should support functionality to restrict usage to only
on-boarding service.
\- When Onboarding network is O-SNPN, the information required to restrict the
usage to only onboarding service is locally configured in the AMF and SMF, and
the AMF and SMF restrict the usage when the UE indicates that the registration
is for Onboarding (e.g. onboarding registration type) or NG-RAN indicates that
the access is for Onboarding.
\- When Onboarding network is a PLMN, the functionality to restrict usage is
activated for the UE by AMF based on received operator subscription from the
UDM. How the subscription profile is defined, e.g. using DNN, S-NSSAI or other
information dedicated for onboarding, is up to operator\'s decision.
\- The UE shall initiate de-registration from the on-boarding network after
finishing the remote provisioning or the on-boarding network shall initiate
the de-registration after successful completion of onboarding or based on
timer configured for on-boarding service.
**Remote provisioning for SNPN credentials (Component 2 of KI#4)**
\- Usage of a PLMN as Onboarding Network for a UE equipped with a USIM shall
be possible. The SO-SNPN credentials can be transmitted to UE via UP
connectivity. The UE shall be configured with Default credentials in USIM to
register with a PLMN where the UE can register with the Default credentials in
order to communicate with the provisioning server;
\- The UE may support the Control Plane remote provisioning or the User Plane
remote provisioning.
Editor\'s Note: How the network instructs the UE whether to use control plane
or user plane provisioning is for FFS.
\- It is assumed that the UDM (or AAA) of SO-SNPN is provisioned with UE
credentials/subscription data when remote provisioning is successfully
performed. Existing mechanism for provisioning subscription in UDM/UDR can be
reused.
\- When User Plane is used for provisioning of SO-SNPN credentials:
\- The User plane remote provisioning protocol used and how the UE downloads
the SO-SNPN credential from the Provisioning Server (PS) after PDU session
establishment in the O-SNPN is out of scope of SA WG2;
\- For the provisioning of IMSI accompanied by AKA credentials, GSMA RSP is
used, Provisioning Server (PS) can provision the credential to UE over User
Plane (UP) connectivity;
\- For the provisioning of Non-AKA credentials, the credentials can be
provided to UE over UP connectivity;
\- A restricted PDU session is supported to be dedicated for the remote
provisioning. Upon successful establishment of restricted access PDU session,
if the UE still does not have a PS address via any of the methods listed
below, the device uses a well-known FQDN to perform PS discovery.
\- When Onboarding network is O-SNPN, the information required to restrict the
usage is locally configured in the SMF, and the SMF restricts the usage for
the UE registered for onboarding.
\- When Onboarding network is a PLMN, the functionality to restrict usage is
activated for the UE by SMF based on received existing subscription profile
from the UDM and on existing policies from PCF, or local configuration.
\- When user plane remote provisioning is used, it shall be possible to pre-
configure the Provisioning Server (PS) address, SO-SNPN identity on the UE,
and it shall also be possible that the O-SNPN provides the PS address to the
UE after successful authentication and authorization. The PS address from the
O-SNPN shall be integrity protected. The PS address for an SO-SNPN provided by
the network is prioritized, if any configured PS address for the SO-SNPN
stored in the UE. Provisioning of PS address to the UE can be supported using
one of the following methods:
a. SMF may deliver onboarding configuration data as part of extended Protocol
Configuration Options (PCO) in PDU Session Establishment Response to UE. This
is similar to use of PCO to configure Autoconfiguration server for UE in
Wireless and Wireline Convergence (TR 23.716 [28] clause 6.10).
b. Alternatively, onboarding configuration data may be configured in the UE
during Registration Procedure.
c. In addition, onboarding configuration data may be configured in the UE
using service specific policies subject to UE capabilities similar to what is
used for V2X communications as specified in TS 23.287 [29] clause 5.1.1 for
ways how parameters may be made available to the UE and TS 23.287 [29] clause
6.2.5 for AF-based service parameter provisioning and TS 24.587 [30] clause
5.2.4 for configuration parameters such as validity timer, server address and
geographical area.
\- When Control Plane is used for provisioning of SO-SNPN credentials:
\- Remote provisioning based on UE Parameters Update Procedure as defined in
TS 23.502 [6] can be used for provisioning of credentials and other
information to enable access to SO-SNPN. After Registration Complete, while
onboarding is still in progress, UPU is imminent, thus, the NAS signalling
connection shall not be released. It shall be possible that the SO-SNPN
credentials being provisioned are not accessible (e.g. by using an additional
credential in the UE) by the onboarding network;
Editor\'s note: SA WG3 feedback will need to be taken into account for
including of the CP based provisioning.
\- Control Plane remote provisioning procedure assumes a Provisioning Server
that communicates with the 5GC using 3GPP-defined protocols. The Provisioning
server has the trusted relationship with the entity owning the subscription
data of the UE.
NOTE 6: With control plane provisioning, UE does not make use of PS address.
NOTE 7: SA WG3 may evaluate these mechanisms and provide guidance on
appropriateness of use for SNPNs.
Editor\'s note: SA WG3 to determine whether and how Control Plane based
provisioning using UE Parameters Update (UPU) procedure and User Plane
provisioning can support devices without UICC i.e. how to secure the
provisioned credentials between the PS and an endpoint in ME.
### 8.4.2 Conclusions for PNI-NPN case
**UE Onboarding for PNI-NPN (Component 1 of KI#4)**
\- No enhancement for the UE onboarding (component 1 of KI#4) with PLMN
credentials used for primary authentication and PLMN network selection are
needed for the case of PNI-NPN credentials provisioning.
**Remote provisioning for PNI-NPN credentials (Component 2 of KI#4)**
\- At least network initiated remote provisioning of credentials to allow
access to PNI-NPN services should be supported in Rel-17;
\- Both procedures using Control Plane and using User Plane protocols after
establishing PDU session shall be enabled for remote provisioning the PNI-NPN
credentials used for NSSAA and/or PDU Session secondary authentication;
The UE may support the Control Plane remote provisioning or the User Plane
remote provisioning.
Editor\'s note: SA WG3 feedback for the suitability of the procedure will need
to be taken into account.
Editor\'s note: whether an extra security layer for protection of credentials
between PS and UE is needed should be decided by SA WG3.
\- For User Plane remote provisioning:
\- The protocol for provisioning of PNI-NPN credentials used for NSSAA and/or
PDU Session secondary authentication, i.e. how the UE download the NPN
credential from the PS after PDU session establishment in PNI-NPN, is out of
scope of SA WG2;
\- The PS address and DNN/NSSAI used to access PS may be provided to the UE
during or after the Registration procedure;
Editor\'s note: The vertical may verify the UE before PNI-NPN credential is
provisioned to UE, and how this is done should be decided by SA WG3.
\- Upon successful remote provisioning of the UE, the UE Subscription Data in
the UDM/UDR may be updated to enable the access to the PNI-NPN. The existing
procedures are used to update the UE configuration and UE context in the
network resulting from the updated UE Subscription Data
Editor\'s note: for PNI-NPN credentials remote provisioning, whether the 3GPP
operator could decide to update the UE Subscription Data (e.g. S-NSSAI, DNN,
CAG information) in the UDM/UDR used to access to the PNI-NPN based on the
input from the vertical which may be outside 3GPP operator domain should be
decided by SA WG3.
\- For Control Plane remote provisioning:
\- It is assumed that the PS communicates with the 5GC using 3GPP defined
protocols.
#
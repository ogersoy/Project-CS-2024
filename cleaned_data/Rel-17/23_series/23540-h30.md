# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
The present document defines the Stage 2 architecture, procedures and services
to support service based short message service (SMS) in 5G system (5GS).
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.040: \"Technical realization of the Short Message Service
(SMS)\".
[3] 3GPP TS 23.501: \"System architecture for the 5G System (5GS); Stage 2\".
[4] 3GPP TS 23.502: \"Procedures for the 5G System (5GS); Stage 2\".
[5] 3GPP TS 23.632: \"User data interworking, coexistence and migration; Stage
2\".
[6] 3GPP TS 29.540: \"5G System; SMS Services; Stage 3\".
[7] 3GPP TS 29.503: \"5G System; Unified Data Management Services; Stage 3\".
[8] 3GPP TS 24.011: \"Point-to-Point (PP) Short Message Service (SMS) support
on mobile radio interface\".
[9] 3GPP TS 29.573: \"5G System; Public Land Mobile Network (PLMN)
Interconnection; Stage 3\".
[10] 3GPP TS 29.510: \"5G System; Network Function Repository Services; Stage
3\".
[11] 3GPP TS 29.500: \"5G System; Technical Realization of Service Based
Architecture; Stage 3\".
[12] IETF RFC 6116: \"The E.164 to Uniform Resource Identifiers (URI) Dynamic
Delegation Discovery System (DDDS) Application (ENUM) \".
[13] IETF RFC 4002: \"IANA Registration for Enumservice \'web\' and \'ft\'\".
[14] IETF RFC 6118: \"Update of Legacy IANA Registrations of Enumservices\".
[15] 3GPP TS 23.204: \"Support of Short Message Service (SMS) over generic
3GPP Internet Protocol (IP) access; Stage 2\".
# 3 Definitions of terms and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in 3GPP TR 21.905
[1] and the following apply. A term defined in the present document takes
precedence over the definition of the same term, if any, in 3GPP TR 21.905
[1].
**alert‑SC:** service element provided by a GSM/UMTS/EPS/5GS PLMN to inform an
SC which has previously initiated unsuccessful short message delivery
attempt(s) to a specific MS/UE, that the MS/UE is now recognized by the PLMN
to have recovered operation.
**Gateway MSC For Short Message Service (SMS‑GMSC):** function of an MSC
capable of receiving a short message from an SC, interrogating an HLR/HSS/UDM
for routing information and SMS info, and delivering the short message to the
VMSC/SGSN/MME/SMSF of the recipient MS/UE.
**Interworking MSC For Short Message Service (SMS‑IWMSC):** function of an MSC
capable of receiving a short message from within the PLMN and submitting it to
the recipient SC.
**IP-Short-Message-Gateway (IP-SM-GW):** function responsible for protocol
interworking between the IP-based UE and the SC.
**Service Centre (SC):** function responsible for the relaying and store and
forwarding of a short message between an SME and an MS/UE.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
GPSI Generic Public Subscription Identifier
MNPF Mobile Number Portability Function
MO SMS Mobile Originated Short Message Service
MT SMS Mobile Terminated Short Message Service
NAS Non-Access-Stratum
NP Number Portability
NRF Network Repository Function
SBA Service Based Architecture
SBI Service Based Interface
SCP Service Communication Proxy
SMS Short Message Service
SM MO Short Message Mobile Originated
SM MT Short Message Mobile Terminated
SMSF Short Message Service Function
SMSoNAS SMS over NAS
UDM Unified Data Management
# 4 Architecture to support SBI-based SMS
## 4.1 Architecture to support SBI-based SMS
Figure 4.1-1 shows the non-roaming architecture to support SBI-based SMS.
Figure 4.1-1: Non-roaming System Architecture for SBI-based SMS
Figure 4.1-2a, Figure 4.1-2b Figure 4.1-2c and Figure 4.1-2d depict the non-
roaming architecture to support SBI-based SMS, using the reference point
representation showing how various network functions interact with each other
Figure 4.1-2a: Non-roaming System Architecture for SBI-based MT SMS in
reference point representation
Figure 4.1-2b: Non-roaming System Architecture for SBI-based MO SMS in
reference point representation
Figure 4.1-2c: Architecture for SBI-based MSISDN-less MO SMS in reference
point representation
Figure 4.1-2d: Architecture for NP staute Retrival from MNPF in reference
point representation
NOTE 1: The newly introduced reference points for SMS_SBI are marked in red,
and numbered from SM1 to SM14.
## 4.2 Reference point to support SBI-based SMS
Besides the reference point to support SMS over NAS described in clause
4.4.2.2 of TS 23.501 [3], the following reference points are needed to support
SBI-based SMS:
Reference point SM1**:** Reference point for routing information between SMS-
GMSC and UDM.
Reference point SM2**:** Reference point between SMS-IWMSC and UDM.
Reference point SM3**:** Reference point for routing information between IP-
SM-GW and UDM.
Reference point SM4**:** Reference point for routing information between SMS
Router and UDM.
Reference point SM5**:** Reference point for SMS message transfer between SMS-
GMSC and SMSF.
Reference point SM6**:** Reference point for SMS message transfer between SMS-
GMSC and SMS Router.
Reference point SM7**:** Reference point for SMS message transfer between SMSF
and SMS Router.
Reference point SM8**:** Reference point for SMS message transfer between SMS-
GMSC and IP-SM-GW.
Reference point SM9**:** Reference point for SMS message transfer between SMSF
and IP-SM-GW
Reference point SM10**:** Reference point for SMS message transfer between
SMS-IWMSC and SMSF.
Reference point SM11**:** Reference point for SMS message transfer between
SMS-SC and NEF.
Reference point SM12**:** Reference point for SMS message transfer between
SMS-GMSC and MNPF.
Reference point SM13**:** Reference point for SMS message transfer between SCP
and MNPF.
Reference point SM14**:** Reference point for SMS message transfer between NRF
and MNPF.
## 4.3 Service based interface to support SBI-based SMS
Besides the service based interfaces to support SMS over NAS described in
clause 4.4.2.3 of TS 23.501 [3], the following service based interfaces are
needed to support SBI-based SMS.
**Nudm:** Service-based interface exhibited by UDM
**Nnrf:** Service-based interface exhibited by NRF
**Ngmsc:** Service-based interface exhibited by SMS-GMSC
**Niwmsc:** Service-based interface exhibited by SMS-IWMSC
**Nipsmgw:** Service-based interface exhibited by IP-SM-GW
**Nrouter:** Service-based interface exhibited by SMS Router
**Nnef:** Service-based interface exhibited by NEF
**Nmnpf:** Service-based interface exhibited by MNPF
# 5 Procedures for SBI-based SMS
## 5.1 Procedure for SBI-based MT SMS
### 5.1.1 General
The procedure is used to support the Mobile Terminated short message transfer
for SBI-based interfaces as defined in clause 4.1, which is based on Short
message mobile terminated procedure defined in clause 10.1 of 3GPP TS 23.040
[2] and clauses 4.13.3.6, 4.13.3.7 and 4.13.3.8 of 3GPP TS 23.502 [4].
This new services introduced in this procedure can be registered in NRF, and
discovered by NF service consumers.
SMSF/SMS Router/IP-SM-GW should indicate whether it supports SMS_SBI or not.
For the case of SMSF/IP-SM-GW, \"SBI support indication\" should be brought
when SMSF/IP-SM-GW registers in UDM. For the case of SMS Router, \"SBI support
indication\" should be configured locally in UDM, together with the SMS Router
address. UDM stores the \"SBI support indication\" indication and provides it
to the SMS-GMSC during Routing Info retrieval. SMS-GMSC selects legacy or SBI
based protocol based on the indication received during Routing Info retrieval.
### 5.1.2 Successful Mobile Terminated short message transfer without SMS
Router/ IP-SM-GW
Figure 5.1.2-1: MT SMS over NAS without SMS Router/ IP-SM-GW
1\. MT SMS interaction between SC and SMS-GMSC follow the current procedure as
defined in 3GPP TS 23.040 [2].
2a-2b. The SMS-GMSC should query the NRF to find the UDM _instance(s),
supporting SMS SBI interfaces, and managing that manages the user
subscriptions of the GPSI. The_ SMS-GMSC may need to retrieve the PLMN ID of
the recipients GPSI before the discovery of the UDM _instance based on the_
GPSI-to-Subscription-Network resolution procedure defined in clause 5.1.7.
3\. SMS-GMSC invokes Nudm_UECM_SendRoutingInfoForSM (GPSI) to the UDM to get
the routing information of the nodes available for MT SMS delivery, in this
case the registered serving SMSF instances for all access types for the UE.
4\. The UDM shall check the registration/reachability flags to determine the
potential target nodes and responds to the SMS-GMSC by sending
Nudm_UECM_SendRoutingInfoForSM response, in this procedure the SMSF instance
Id and the indication for SMSF SMS_SBI support are included in the response
message. The UDM shall include the SMSF for 3GPP access and the SMSF for
non-3GPP access separately, if both the SMSFs are currently known to be valid
for the UE.
5\. The _SMS-GMSC_ forwards the SMS message to the SMSF. If the SMS-GMSC has
more than one SMSF address to use for SMS transport towards the UE, then the
SMS-GMSC chooses which SMSF address to use first, based on operator local
policy.
The _SMS-GMSC selects_ protocol based on the indication for SMSF SMS_SBI
support.
If SMSF indicates it supports SMS_SBI, SMS-GMSC forwards the SMS message to
the SMSF by invoking Nsmsf_SMService_MtForwardSm service operation.
If SMSF indicates that it does not support SMS_SBI, SMS-GMSC should forward
SMS message to SMSF by legacy MAP/Diameter protocol. And the following steps
follow the procedures for legacy MT SMS message transfer, as illustrated in
Figure 15a of TS23.040 [2].
6\. MT SMS over NAS procedure between SMSF, AMF and UE is same as the
definition in step 4a to 6b of Figure 4.13.3.6-1 of 3GPP TS 23.502 [4].
7\. The SMSF delivers the delivery report to SMS-GMSC by sending the
Nsmsf_SMService_MtForwardSm response to the SMS-GMSC.
8\. The SMS-GMSC updates the SM-Delivery Report Status to UDM by invoking
Nudm_SMReportStatus_Request.
9\. UDM responses Nudm_SMReportStatus_Request response to SMS-GMSC.
10\. The SMS-GMSC delivers the delivery report to SC as defined in TS 23.040
[2].
11\. MT SMS over NAS procedure between SMSF, AMF and UE is same as the
definition in step 6c to 6d of Figure 4.13.3.6-1 of 3GPP TS 23.502 [4].
### 5.1.3 Successful Mobile Terminated short message transfer via SMS Router
Figure 5.1.3-1: MT SMS over NAS via SMS Router
1\. MT SMS interaction between SC and SMS-GMSC follow the current procedure as
defined in 3GPP TS 23.040 [2].
2a-2b. The SMS-GMSC should query the NRF to find the UDM _instance(s),
supporting SMS SBI interfaces, and managing that manages the user
subscriptions of the GPSI. The_ SMS-GMSC may need to retrieve the PLMN ID of
the recipients GPSI before the discovery of the UDM _instance based on the_
GPSI-to-Subscription-Network resolution procedure defined in clause 5.1.7.
3\. SMS-GMSC invokes Nudm_UECM_SendRoutingInfoForSM (GPSI) to the UDM to get
the serving node information for all access types for the UE.
4\. The UDM shall check the registration/reachability flags to determine the
potential target nodes, e.g. SMSF. For MT SM transfer via SMS Router, the UDM
shall invoke the Nrouter_SMService_RoutingInfo to provide the SMSF Instance Id
to the SMS Router. The address of the SMS Router to be contacted by the UDM
may be configured locally.
5\. The SMS Router shall send Nrouter_SMService_RoutingInfo response to the
UDM.
6\. UDM responds to the SMS-GMSC by sending Nudm_UECM_SendRoutingInfoForSM
response, including SMS Router address, the indication for SMSF SMS_SBI
support and the indication for SMS Router SMS_SBI support.
7-8. The _SMS-GMSC_ forwards the SMS message to the SMS Router, and then SMS
Router forwards the SMS message to the SMSF. If the SMS Router has more than
one SMSF address to use for SMS transport towards the UE, then the SMS Router
chooses which SMSF address to use first, based on operator local policy.
The SMS-GMSC selects protocol based on the indications for SMSF SMS_SBI
support and SMS Router SMS_SBI support.
_If both SMSF and SMS Router indicate support for SMS_SBI, SMS-GMSC forwards
the SMS message to the SMS Router by invoking Nrouter_SMService_MtForwardSm
service operation. And then the SMS Router forwards the SMS message to the
SMSF by invoking Nsmsf_SMService_MtForwardSm service operation._
_If SMSF or SMS Router indicates that it does not support SMS_SBI, SMS-GMSC
should forward SMS message to SMS Router by legacy MAP/Diameter protocol. Then
SMS Router forwards the SMS message to the SMSF by legacy MAP/Diameter
protocol. The following steps follow the procedures for legacy MT SMS message
transfer, as illustrated in Figure 15aa of TS23.040._
9\. MT SMS over NAS procedure between SMSF, AMF and UE is same as the
definition in step 4a to 6b of Figure 4.13.3.6-1 in 3GPP TS 23.502 [4].
10\. The SMSF delivers the delivery report to SMS Router by sending the
Nsmsf_SMService_MtForwardSm response to the SMS Router.
11\. The SMS Router delivers the delivery report to SMS-GMSC by sending the
Nrouter_SMService_MtForwardSm response to the SMS-GMSC.
12-13. The SMS-GMSC may report the SM-Delivery Status to the UDM by invoking
Nudm_ReportSMDeliveryStatus_Request and UDM responses
Nudm_ReportSMDeliveryStatus_Request response to SMS-GMSC.
14\. The SMS-GMSC delivers the delivery report to SC as defined in 3GPP TS
23.040 [2].
15\. MT SMS over NAS procedure between SMSF, AMF and UE is same as the
definition in step 6c to 6d of Figure 4.13.3.6-1 in 3GPP TS 23.502 [4].
### 5.1.4 Successful Mobile Terminated short message transfer via IP-SM-GW
Figure 5.1.4-1: MT SMS over NAS via IP-SM-GW
1\. MT SMS interaction between SC and SMS-GMSC follow the current procedure as
defined in 3GPP TS 23.040 [2].
2a-2b. The SMS-GMSC should query the NRF to find the UDM _instance(s),
supporting SMS SBI interfaces, and managing that manages the user
subscriptions of the GPSI. The_ SMS-GMSC may need to retrieve the PLMN ID of
the recipients GPSI before the discovery of the UDM _instance based on the_
GPSI-to-Subscription-Network resolution procedure defined in clause 5.1.7.
3\. The SMS-GMSC invokes Nudm_UECM_SendRoutingInfoForSM (GPSI) to the UDM to
get the serving node information for all access types for the UE.
4\. The UDM shall check the registration/reachability flags to determine the
potential target nodes, e.g. SMSF. For MT SM transfer via IP-SM-GW, the UDM
shall invoke the Nipsmgw_SMService_RoutingInfo to provide the SMSF Instance Id
to the IP-SM-GW. The address of the IP-SM-GW to be contacted by the UDM may be
configured locally.
5\. The IP-SM-GW shall send Nipsmgw_SMService_RoutingInfo response to the UDM.
6\. The UDM responds to the _SMS-GMSC_ by sending
Nudm_UECM_SendRoutingInfoForSM response, _including_ IP-SM-GW address, the
indication for SMSF SMS_SBI support and the indication for IP-SM-GW SMS_SBI
support.
7-8. The _SMS-GMSC_ forwards the SMS message to the IP-SM-GW, and then IP-SM-
GW performs service authorization and domain selection to determine the domain
for delivery of the Short Message as defined in 3GPP TS 23.204 [15]. If the
SMSF is selected, the IP-SM-GW forwards the SMS message to the SMSF. If the
IP-SM-GW has more than one SMSF address to use for SMS transport towards the
UE, then the IP-SM-GW chooses which SMSF address to use first based on
operator local policy.
The SMS-GMSC selects protocol based on the indication for SMSF SMS_SBI support
and IP-SM-GW SBI support:
If both SMSF and IP-SM-GW indicate support for SMS_SBI, SMS-GMSC forwards the
SMS message to the IP-SM-GW by invoking Nipsmgw_SMService_MtForwardSm service
operation. And then the IP-SM-GW forwards the SMS message to the SMSF by
invoking Nsmsf_SMService_MtForwardSm service operation.
If SMSF or IP-SM-GW indicates that it does not support SMS_SBI, SMS-GMSC
should forward SMS message to IP-SM-GW by legacy MAP/Diameter protocol. Then
IP-SM-GW forwards the SMS message to the SMSF by legacy MAP/Diameter protocol.
The following steps follow the procedures for legacy MT SMS message transfer,
as illustrated in Figure 15aa of TS23.040 [2].
9\. The MT SMS over NAS procedure between SMSF, AMF and UE is the same as in
step 4a to 6b of Figure 4.13.3.6-1 of 3GPP TS 23.502 [4].
10\. The SMSF delivers the delivery report to the IP-SM-GW by sending the
Nsmsf_SMService_MtForwardSm response to the IP-SM-GW.
11\. The IP-SM-GW delivers the delivery report to the SMS-GMSC by sending the
Nipsmgw_SMService_MtForwardSm response to the SMS-GMSC.
12\. The IP-SM-GW may report the SM-Delivery Status to the UDM by invoking
Nudm_ReportSMDeliveryStatus_Request.
13\. The UDM responses with Nudm_ReportSMDeliveryStatus_Request response to
the IP-SM-GW.
14-15. The SMS-GMSC may report the SM-Delivery Status to the UDM by invoking
Nudm_ReportSMDeliveryStatus_Request and the UDM shall ignore the information
provided in this report.
16\. The SMS-GMSC delivers the delivery report to the SC as defined in 3GPP TS
23.040 [2].
17\. The MT SMS over NAS procedure between SMSF, AMF and UE is the same as in
step 6c to 6d of Figure 4.13.3.6-1 of 3GPP TS 23.502 [4].
### 5.1.5 Unsuccessful Mobile Terminated short message transfer without SMS
Router/IP-SM-GW
Figure 5.1.5-1: Unsuccessful MT SMS over NAS without SMS Router/ IP-SM-GW
1\. MT SMS interaction between SC and SMS-GMSC follow the current procedure as
defined in 3GPP TS 23.040 [2].
2a-2b. The SMS-GMSC should query the NRF to find the UDM _instance(s),
supporting SMS SBI interfaces, and managing that manages the user
subscriptions of the GPSI. If there is no available UDM returned from NRF, the
SMS-GMSC may send error response to the SC._
3\. SMS-GMSC invokes Nudm_UECM_SendRoutingInfoForSM (GPSI) to the UDM to get
the routing information of the nodes available for MT SMS delivery, in this
case the registered serving SMSF instance for all access types for UE.
4\. The UDM shall check the registration/reachability flags to determine the
potential target nodes. If the UDM is failed at this step, e.g. user not found
in the UDM, the UDM shall respond to the SMS-GMSC by sending
Nudm_UECM_SendRoutingInfoForSM response with error cause. If there is no
target node address registered in the UDM, a response with error case
indicating absent subscriber for SM is sent to the SMS-GMSC and the procedure
continues in step 11.
5\. If successful response is returned in step 4, the _SMS-GMSC_ forwards the
SMS message to the SMSF by invoking Nsmsf_SMService_MtForwardSm service
operation. If the SMS-GMSC has more than one SMSF address to use for SMS
transport towards the UE, then the SMS-GMSC chooses which SMSF address to use
first based on operator local policy.
6\. MT SMS over NAS procedure between SMSF, AMF and UE is same as the
definition in step 4a to 6b of Figure 4.13.3.6-1 of 3GPP TS 23.502 [4].
7\. If the AMF informs the SMSF that it cannot deliver the MT-SMS to the UE in
step 6, e.g. UE is not reachable, or the SMSF is failed at this step, e.g.
memory capacity exceeded, the SMSF shall send the Nsmsf_SMService_MtForwardSm
response with error cause to the SMS-GMSC.
If the SMS-GMSC has more than one SMSF address to use for SMS transport
towards the UE, then upon receiving MT-SMS failure report, the SMS-GMSC, based
on operator local policy, may re-attempt the MT-SMS delivery via the other
SMSF. If MT-SMS delivery also fails over the other SMSF, then the SMS-GMSC
continues with step 8.
8\. The SMS-GMSC may report the SM-Delivery Status (e.g. UE is not reachable
or memory capacity exceeded) to UDM by invoking
Nudm_ReportSMDeliveryStatus_Request.
9\. UDM responses Nudm_ReportSMDeliveryStatus_Request response to SMS-GMSC.
10\. The SMS-GMSC sends the failure report to SC as defined in TS 23.040 [2].
11\. The SMS-GMSC subscribes in UDM to be notified when the UE becomes
reachable for SMS (i.e. when the UE gets in radio contact with the AMF while
an SMSF is actually registered, or when an SMSF gets registered) by using the
Nudm_EventExposure_Subscribe service operation for Reachability for SMS event
as defined in 3GPP TS 23.502 [4].
12\. If applicable, the UDM subscribes to UE reachability notification in the
AMF(s) using the Namf_EventExposure service and sets the relevant reachability
flags. The UDM acknowledges the event subscription created by the SMS-GMSC.
### 5.1.6 Unsuccessful Mobile Terminated short message transfer via IP-SM-GW
Figure 5.1.6-1: Unsuccessful MT SMS over NAS via IP-SM-GW
1\. MT SMS interaction between SC and SMS-GMSC follow the current procedure as
defined in 3GPP TS 23.040 [2].
2a-2b. The SMS-GMSC should query the NRF to find the UDM _instance(s),
supporting SMS SBI interfaces, and managing that manages the user
subscriptions of the GPSI. If there is no available UDM returned from NRF, the
SMS-GMSC may send error response to the SC._
3\. SMS-GMSC invokes Nudm_UECM_SendRoutingInfoForSM (GPSI) to the UDM to get
the serving node information for UE.
4\. The UDM shall check the registration/reachability flags to determine the
potential target nodes, e.g. SMSF. For MT SM transfer via IP-SM-GW, the UDM
shall invoke the Nipsmgw_SMService_RoutingInfo to provide the SMSF Instance Id
to the IP-SM-GW. The address of the IP-SM-GW to be contacted by the UDM may be
configured locally.
5\. If any failure at this step, the IP-SM-GW shall send
Nipsmgw_SMService_RoutingInfo response with error cause to the UDM.
6\. If the UDM receives error response from IP-SM-GW in step 5 or UDM is
failed after step 3, e.g. user not found in the UDM, the UDM shall respond to
the SMS-GMSC by sending Nudm_UECM_SendRoutingInfoForSM response with error
cause. If there is no target node address registered in the UDM, a response
with error case indicating absent subscriber for SM is sent to the SMS-GMSC
and the procedure continues in step 14.
7\. If successful response is returned in step 6, the _SMS-GMSC_ forwards the
SMS message to the IP-SM-GW by invoking Nipsmgw_SMService_MtForwardSm service
operation.
8\. The IP-SM-GW performs service authorization and domain selection to
determine the domain for delivery of the Short Message as defined in 3GPP TS
23.204 [15]. If the SMSF is selected, the IP-SM-GW forwards the SMS message to
the SMSF by invoking Nsmsf_SMService_MtForwardSm service operation. If the IP-
SM-GW has more than one SMSF address to use for SMS transport towards the UE,
then the IP-SM-GW chooses which SMSF address to use first based on operator
local policy.
9\. MT SMS over NAS procedure between SMSF, AMF and UE is same as the
definition in step 4a to 6b of Figure 4.13.3.6-1 of 3GPP TS 23.502 [4].
10\. If the AMF informs the SMSF that it cannot deliver the MT-SMS to the UE
in step 9, e.g. UE is not reachable, or the SMSF is failed at this step, e.g.
memory capacity exceeded, the SMSF shall send the Nsmsf_SMService_MtForwardSm
response with error cause to the IP-SM-GW.
11\. If the IP-SM-GW receives error response from SMSF in step 10 and the IP-
SM-GW has tried all selectable domains and accesses or the IP-SM-GW is failed
after step 7, the IP-SM-GW shall send the Nipsmgw_SMService_MtForwardSm
response with error cause to the SMS-GMSC.
12-13. The IP-SM-GW may report the SM-Delivery Status (e.g. UE is not
reachable or memory capacity exceeded) to UDM by invoking
Nudm_ReportSMDeliveryStatus_Request.
14\. The IP-SM-GW subscribes in HSS to be notified when the UE becomes
reachable again, and subsequently the HSS subscribes in the UDM to UE
reachability for SMS over IP event, as defined in clause 5.5.6 of 3GPP TS
23.632 [5]. If applicable, the UDM subscribes to UE reachability notification
in the AMF(s) using the Namf_EventExposure service and sets the relevant
reachability flags.
15-16. The SMS-GMSC may report the SM-Delivery Status to UDM by invoking
Nudm_ReportSMDeliveryStatus_Request and the UDM shall ignore the information
provided in this report.
17\. If the SMS-GMSC receives error response from IP-SM-GW in step 6 or step
11, the SMS-GMSC sends the failure report to SC as defined in TS 23.040 [2].
### 5.1.7 GPSI-to-Subscription-Network resolution procedure
#### 5.1.7.1 General
MT SMS delivery procedure requires routing based on the GPSI of the SMS
recipient for interactions between the SMS-GMSC and the UDM, e.g., to retrieve
the SMS routing information (e.g., the SMSF address) or report delivery
status. In case that the SMS recipient belongs to a PLMN different from the
PLMN of the SMS sender, the signaling takes place across PLMN borders.
When using service-based interface between the SMS-GMSC and the UDM, if the
GPSI is the only known SMS recipient\'s identifier, the SMS-GMSC needs to
determine the target PLMN to be able to interact with the UDM in the home PLMN
of the SMS recipient. The SMS-GMSC can determine the target PLMN using one of
the following mechanisms:
\- GPSI-to-Subscription-Network resolution triggered by the NF consumer,
described in clause 5.1.7.2.
\- GPSI-to-Subscription-Network resolution using NRF, described in clause
5.1.7.4.
\- GPSI-to-Subscription-Network resolution delegated by SCP, described in
clause 5.1.7.3
It is assumed that the domain part in an External Identifier identifies the
home PLMN and hence it is not required to determine the target PLMN when the
GPSI is an External Identifier. The procedures described in the present clause
5.1.7 apply only when the GPSI is an MSISDN.
NOTE: While these mechanisms are defined to determine the target PLMN for
interactions between the SMS entities such as SMS-GMSC and the UDM requiring
routing based on the GPSI of the SMS recipient, it can be applicable to any
use case and procedure requiring selection of the target PLMN based on GPSI in
5GS.
When the recipient GPSI belongs to the same country as the originating network
and MNPF is not implemented in the country, the SMS-GMSC may skip the
procedure and may directly discover UDM profile for invoking UDM service
operation for routing information retrieval. In this case the SMS-GMSC
determines the target PLMN ID from the recipient\'s GPSI Prefix (e.g. CC+NDC)
while sending the discovery request to the NRF.
#### 5.1.7.2 GPSI-to-Subscription-Network resolution triggered by the SMS-GMSC
##### 5.1.7.2.1 General
Figure 5.1.7.2-1: GPSI-to-Subscription-Network resolution triggered by the
SMS-GMSC
1a-1b. The MNPF registers in the NRF with a new NF Type (e.g. MNPF).
2\. MT SMS interaction between SC and SMS-GMSC follow the current procedure as
defined in 3GPP TS 23.040 [2].
3a-3b. The SMS-GMSC should query the NRF to find the MNPF _instance that
manages the_ PLMN ID of the recipients GPSI\'s subscription network. The MNPF
may belong to the same PLMN with SMS-GMSC or belong to the number range holder
network which is different with the PLMN of SMS-GMSC. In latter case, the
local NRF forwards the discovery request to the NRF of the number range holder
PLMN.
4\. SMS-GMSC invokes Nmnpf_NPStatus_Get (GPSI) to the MNPF to get the target
PLMN ID of the GPSI.
5\. MNPF checks the portability status of the recipient GPSI and responds back
with the target PLMN ID.
After step 5, the Mobile Terminated short message transfer procedures defined
in clause 5.1 is performed from step 2a. The SMS-GMSC uses the target PLMN ID
to discover the UDM NF profile via NRF for sending the routing information
query to the UDM. If the target PLMN ID is not own network, the local NRF
forwards the discovery request to the NRF of the target PLMN.
##### 5.1.7.2.2 GPSI-to-Subscription-Network resolution triggered by the SMS-
GMSC for Direct routing
When MNP is implemented in a country or number portability domain with direct
routing mechanism, the originating network first does the number portability
query to identify the recipient GPSI\'s subscription PLMN before routing any
messages based on GPSI.
Figure 5.1.7.2.2-1 GPSI-to-Subscription-Network resolution triggered by the
SMS-GMSC (Direct Routing)
1\. If the MNPF is deployed, the MNPF registers in the NRF with a new NF Type
(e.g. MNPF).
2-3. The SMS-GMSC should query the NRF to find the MNPF _instance that manages
the_ PLMN ID of the recipients GPSI\'s subscription network.
4\. SMS-GMSC invokes Nmnpf_NPStatus_Get (GPSI) to the MNPF to get the target
PLMN ID of the GPSI.
5\. MNPF checks the portability status of the recipient GPSI and responds back
with the target PLMN ID.
NOTE: When the recipient GPSI belongs to the same country as the originating
network and MNPF is not implemented in the country, the steps 1-5 is skipped.
In this case the SMS-GMSC determines the target PLMN ID from the recipient\'s
GPSI Prefix (e.g. CC+NDC) based on local configuration.
6-7. SMS-GMSC shall query the NRF to find the UDM _instance serving the target
PLMN based on_ target PLMN ID _received in step 6. For step 7b-8b,_ if the
target PLMN ID is not the originating network, the local NRF forwards the
discovery request to the NRF of the target PLMN.
8-9. SMS-GMSC invokes Nudm_UECM_SendRoutingInfoForSM (GPSI) to the UDM of the
target PLMN to get the serving node instance for UE. The UDM shall check the
registration/reachability flags to determine the potential target nodes and
responds to the SMS-GMSC by sending Nudm_UECM_SendRoutingInfoForSM response,
in this procedure the SMSF instance Id is included in the response message.
##### 5.1.7.2.3 GPSI-to-Subscription-Network resolution triggered by the SMS-
GMSC for Indirect routing
When MNP is implemented in a country or number portability domain with
indirect routing mechanism, the signalling messages are always routed to the
number range holder network, the number range holder then performs a number
portability check and forwards the request to the subscription network if the
number is ported out. For the case of international SMS termination also
indirect routing is applied. In the case of international SMS termination, the
originating network is outside the number portability domain and may not have
any knowledge of whether number portability is implemented in the country of
the recipient GPSI.
Figure 5.1.7.2.3-1 GPSI-to-Subscription-Network resolution triggered by the
SMS-GMSC (Indirect Routing)
1\. If the MNPF is deployed in the Number Range Holder PLMN, the MNPF
registers in the NRF of the number range holder PLMN with a new NF Type (e.g.
MNPF).
2-3. The SMS-GMSC should query the local NRF to find the MNPF _instance that
manages the_ PLMN ID of the recipients GPSI\'s subscription network, the local
NRF forwards the discovery request to the NRF of the number range holder PLMN.
4\. SMS-GMSC invokes Nmnpf_NPStatus_Get (GPSI) to the MNPF to get the target
PLMN ID of the GPSI.
5\. MNPF checks the portability status of the recipient GPSI and responds back
with the target PLMN ID.
NOTE: When the recipient GPSI belongs to the same country as the number range
holder network and MNPF is not implemented in the country, the steps 1-5 is
skipped. In this case the SMS-GMSC determines the target PLMN ID from the
recipient\'s GPSI Prefix (e.g. CC+NDC) based on local configuration.
6-7. SMS-GMSC shall query the NRF to find the UDM _instance serving the target
PLMN based on_ target PLMN ID _received in step 6._
\- For step 7a-8a, if the target PLMN ID belongs to the number range holder
PLMN, the local NRF forwards the discovery request to the NRF of the number
range holder PLMN.
\- For step 7b-8b, if the target PLMN ID belongs to the Subscription PLMN, the
local NRF forwards the discovery request to the NRF of the Subscription PLMN.
8-9. SMS-GMSC invokes Nudm_UECM_SendRoutingInfoForSM (GPSI) to the UDM of the
target PLMN to get the serving node instance for UE. The UDM shall check the
registration/reachability flags to determine the potential target nodes and
responds to the SMS-GMSC by sending Nudm_UECM_SendRoutingInfoForSM response,
in this procedure the SMSF instance Id is included in the response message.
#### 5.1.7.3 SCP supports GPSI-to-Subscription-Network resolution procedure
##### 5.1.7.3.1 General
This procedure is used to retrieve the PLMN ID of the recipients GPSI for
further discovery of UDM NF profiles for invoking UDM service operation for
routing information retrieval. In indirect Communication with Delegated
Discovery, the SCP is the service consumer of the GPSI-to-Subscription-Network
resolution service in MNPF and routes an SBI message based on GPSI when MNPF
is implemented. The SCP shall use the discovery factors (see 3GPP TS 29.500
[11], clause 6.10) provided by the SMS-GMSC to determine when to invoke the
MNPF resolution, and to obtain the identity (GPSI) of the recipient.
The SMS-GMSC sends routing information retrieval request to the SCP and the
SCP uses the PLMN ID as the target PLMN ID in the discovery request towards
NRF to discover the UDM NF profiles in the subscription network of the SMS
recipient.
##### 5.1.7.3.2 SCP supports GPSI-to-Subscription-Network resolution with MNPF
Figure 5.1.7.3.2-1: SCP supports GPSI-to-Subscription-Network resolution with
MNPF
1a-1b. If the MNPF is deployed, the MNPF registers in the NRF with a new NF
Type (e.g. MNPF).
2\. MT SMS interaction between SC and SMS-GMSC follow the current procedure as
defined in 3GPP TS 23.040 [2].
3\. The SMS-GMSC sends Nudm_UECM_SendRoutingInfoForSM to the SCP to get the
serving node instance for UE from the UDM. As specified in the Indirect
Communication with Delegated Discovery model, the
Nudm_UECM_SendRoutingInfoForSMt shall contain the discovery factors containing
the GPSI (pointing to the Number Range Holder Network) and an indicator (i.e.
\"target-nw-resolution\") that Subscription Network resolution is delegated to
the SCP. The \"target-nw-resolution\" may also be sent by an SCP to the next
hop SCP. The SCP receives the \"target-nw-resolution\" shall query the NF
service consumer (MNPF) to obtain the PLMN ID of the recipient GPSI\'s
subscription network.
4a-4b. The SCP shall query the NRF to find the MNPF _instance that manages
the_ PLMN ID of the recipients GPSI\'s subscription network. The MNPF may
belong to the same PLMN with SMS-GMSC or belong to the number range holder
network which is different with the PLMN of SMS-GMSC. In latter case, the
local NRF forwards the discovery request to the NRF of the number range holder
PLMN.
5\. The SCP determines the target PLMN of the recipients GPSI\'s subscription
network using the SBI service of the MNPF i.e. the SCP invokes
Nmnpf_NPStatus_Get (GPSI) to the MNPF.
6\. MNPF checks the portability status of the recipient GPSI and responds back
with the target PLMN ID.
NOTE: If SCP is co-located with MNPF, steps between SCP and NRF to discover
the MNPF, and steps between SCP and MNPF can be skipped.
7a-7b. SCP shall query the NRF to find the UDM _instance serving the target
PLMN based on_ target PLMN ID _received in step 6._
8\. SCP invokes Nudm_UECM_SendRoutingInfoForSM (GPSI) to the UDM to get the
serving node instance for UE.
9\. The UDM shall check the registration/reachability flags to determine the
potential target nodes and responds to the SCP by sending
Nudm_UECM_SendRoutingInfoForSM response, in this procedure the SMSF instance
Id is included in the response message.
10\. SCP forward the responds to the _SMS-GMSC_ by sending
Nudm_UECM_SendRoutingInfoForSM response _(_ SMS Router address _)_.
##### 5.1.7.3.3 SCP supports GPSI-to-Subscription-Network resolution with NRF
Figure 5.1.7.3.3-1: SCP supports GPSI-to-Subscription-Network resolution with
NRF
1a-1b. If the MNPF is deployed, the MNPF registers in the NRF with a new NF
Type (e.g. MNPF).
2\. MT SMS interaction between SC and SMS-GMSC follow the current procedure as
defined in 3GPP TS 23.040 [2].
3\. The SMS-GMSC sends Nudm_UECM_SendRoutingInfoForSM to the SCP to get the
serving node instance for UE from the UDM. The Nudm_UECM_SendRoutingInfoForSM
contains the NF service discovery factors with the GPSI (pointing to the
Number Range Holder Network) and an indicator (i.e. \"target-nw-resolution\")
indicating that Subscription Network resolution is delegated to the SCP. The
\"target-nw-resolution\" may also be sent by an SCP to the next hop SCP.
4\. The SCP should query the NRF to find the UDM _instance that manages the
user subscriptions using the GPSI_. The NRF receives the \"target-nw-
resolution\" shall query the NF service consumer (MNPF) to obtain the PLMN ID
of the recipient GPSI\'s subscription network.
5\. The NRF determines the target PLMN of the recipients GPSI\'s subscription
network using the SBI service of the MNPF i.e. the NRF invokes
Nmnpf_NPStatus_Get (GPSI) to the MNPF. As an implementation choice the NRF may
determine the target PLMN by other means, e.g. local configuration of ENUM
query.
6\. MNPF checks the portability status of the recipient GPSI and responds back
with the target PLMN ID.
7\. NRF returns the UDM _instance related to the GPSI and target PLMN Id to
the_ SCP. For inter-PLMN discovery, the local NRF shall query the NRF in the
target PLMN to find the UDM _instance_. If there are not NF instances
available that can serve the request, the local NRF provides the discovery
response indicating the consumer NF to use a legacy interface for the next
operation request in the procedure.
8\. SCP invokes Nudm_UECM_SendRoutingInfoForSM (GPSI) to the UDM to get the
serving node instance for UE.
9\. The UDM shall check the registration/reachability flags to determine the
potential target nodes and responds to the SCP by sending
Nudm_UECM_SendRoutingInfoForSM response, in this procedure the SMSF instance
Id is included in the response message.
10\. SCP forward the responds to the _SMS-GMSC_ by sending
Nudm_UECM_SendRoutingInfoForSM response _(_ SMS Router address _)_.
##### 5.1.7.3.4 SCP supports GPSI-to-Subscription-Network resolution with MNPF
for Direct routing
Figure 5.1.7.3.4-1 shows the procedure for Direct Communication with Delegated
Discovery, the SCP is the service consumer of the GPSI-to-Subscription-Network
resolution service in MNPF and routes an SBI message based on GPSI when direct
routing of MNPF is implemented.
Figure 5.1.7.3.4-1 SCP supports the GPSI-to-Subscription-Network resolution
with MNPF for Direct Routing
1\. If the MNPF is deployed, the MNPF registers in the NRF with a new NF Type
(e.g. MNPF).
2\. The SMS-GMSC sends Nudm_UECM_SendRoutingInfoForSM to the SCP to get the
serving node instance for UE from the UDM. As specified in the Indirect
Communication with Delegated Discovery model, the
Nudm_UECM_SendRoutingInfoForSM shall contain the discovery factors containing
the GPSI (pointing to the Number Range Holder Network) and an indicator that
Subscription Network resolution is delegated to the SCP.
3-4. The SCP shall query the NRF to find the MNPF _instance that manages the_
PLMN ID of the recipients GPSI\'s subscription network.
5\. The SCP determines the target PLMN of the recipients GPSI\'s subscription
network using the SBI service of the MNPF i.e. the SCP invokes
Nmnpf_NPStatus_Get (GPSI) to the MNPF.
6\. MNPF checks the portability status of the recipient GPSI and responds back
with the target PLMN ID.
NOTE 1: If SCP is co-located with MNPF, steps between SCP and NRF to discover
the MNPF, and steps between SCP and MNPF can be skipped.
NOTE 2: When the recipient GPSI belongs to the same country as the originating
network and MNPF is not implemented in the country, steps between SCP and MNPF
can be skipped. In this case the SMS-GMSC or SCP determines the target PLMN ID
from the recipient\'s GPSI Prefix (e.g. CC+NDC) based on local configuration.
7-8. SCP shall query the NRF to find the UDM _instance serving the target PLMN
based on_ target PLMN ID _received in step 6. For step 7b-8b,_ if the target
PLMN ID is not the originating network, the local NRF forwards the discovery
request to the NRF of the target PLMN.
9-10. SCP invokes Nudm_UECM_SendRoutingInfoForSM (GPSI) to the UDM of the
target PLMN to get the serving node instance for UE. The UDM shall check the
registration/reachability flags to determine the potential target nodes and
responds to the SCP by sending Nudm_UECM_SendRoutingInfoForSM response, in
this procedure the SMSF instance Id is included in the response message.
11\. SCP forward the responds to the _SMS-GMSC_ by sending
Nudm_UECM_SendRoutingInfoForSM response _(_ SMS Router address _)_.
##### 5.1.7.3.5 SCP supports GPSI-to-Subscription-Network resolution with MNPF
for Indirect routing
Figure 5.1.7.3.5-1 shows the procedure for Indirect Communication with
Delegated Discovery, the SCP is the service consumer of the GPSI-to-
Subscription-Network resolution service in MNPF NF and routes an SBI message
based on GPSI when indirect routing of MNPF is implemented.
Figure 5.1.7.3.5-1 SCP supports GPSI-to-Subscription-Network resolution with
MNPF for Indirect routing
1\. If the MNPF is deployed in the Number Range Holder PLMN, the MNPF
registers in the NRF of the number range holder PLMN with a new NF Type (e.g.
MNPF).
2\. The SMS-GMSC sends Nudm_UECM_SendRoutingInfoForSM to the SCP to get the
serving node instance for UE from the UDM. As specified in the Indirect
Communication with Delegated Discovery model, the
Nudm_UECM_SendRoutingInfoForSM shall contain the discovery factors containing
the GPSI (pointing to the Number Range Holder Network) and an indicator that
Subscription Network resolution is delegated to the SCP.
3-4. The SCP shall query the local NRF to find the MNPF _instance that manages
the_ PLMN ID of the recipients GPSI\'s subscription network, the local NRF
forwards the discovery request to the NRF of the number range holder PLMN.
5\. The SCP determines the target PLMN of the recipients GPSI\'s subscription
network using the SBI service of the MNPF i.e. the SCP invokes
Nmnpf_NPStatus_Get (GPSI) to the MNPF.
6\. MNPF checks the portability status of the recipient GPSI and responds back
with the target PLMN ID.
NOTE 1: If SCP is co-located with MNPF, steps between SCP and NRF to discover
the MNPF, and steps between SCP and MNPF can be skipped.
NOTE 2: When the recipient GPSI belongs to the same country as the number
range holder network and MNPF is not implemented in the country, the steps
between SCP and MNPF can be skipped. In this case the SMS-GMSC or SCP
determines the target PLMN ID from the recipient\'s GPSI Prefix (e.g. CC+NDC)
based on local configuration.
7-8. SCP shall query the local NRF to find the UDM _instance serving the
target PLMN based on_ target PLMN ID _received in step 6._
\- For step 7a-8a, if the target PLMN ID belongs to the number range holder
PLMN, the local NRF forwards the discovery request to the NRF of the number
range holder PLMN.
\- For step 7b-8b, if the target PLMN ID belongs to the Subscription PLMN, the
local NRF forwards the discovery request to the NRF of the Subscription PLMN.
9-10. SCP invokes Nudm_UECM_SendRoutingInfoForSM (GPSI) to the UDM of the
target PLMN to get the serving node instance for UE. The UDM shall check the
registration/reachability flags to determine the potential target nodes and
responds to the SCP by sending Nudm_UECM_SendRoutingInfoForSM response, in
this procedure the SMSF instance Id is included in the response message.
11\. SCP forwards the responds to the _SMS-GMSC_ by sending
Nudm_UECM_SendRoutingInfoForSM response _(_ SMS Router address _)_.
#### 5.1.7.4 GPSI-to-Subscription-Network resolution using NRF
Figure 5.1.7.4-1 shows the procedure to determine the target PLMN based on the
GPSI using the discovery and selection framework via the NRF as defined in
3GPP TS 23.501 [3] and 3GPP TS 23.502 [4].
Figure 5.1.7.4-1: Determination of target PLMN based on GPSI using NRF
1\. The SMS-GMSC located in the PLMN of the SMS sender contacts the NRF in the
originating PLMN to perform NF/NF service discovery of the UDM instance(s).
The discovery request is based on the GPSI of the SMS recipient and includes
an indication for the NRF to determine the target PLMN and interface to be
used (SBI or legacy interface).
2\. Based on the indication to determine the target PLMN and interface to be
used included in the discovery request, if direct routing mechanism is used
the NRF in the originating PLMN retrieves the target PLMN ID from the MNPF in
the originating PLMN by consuming the SBI services of the MNPF described in
clause 6.7. The NRF performs an NP query to the MNPF using SBI for the GPSI of
the SMS recipient.
If indirect routing mechanism is used, steps 2-3 are skipped and the procedure
continues in step 4a.
3\. The MNPF provides in the response the target PLMN information
corresponding to the GPSI of the SMS recipient and the procedure continues in
step 4.
2a-3a. The NRF may, as an alternative implementation option to steps 2-3,
obtain the target PLMN information by other means, e.g., using DNS/ENUM
resolution, local configuration in the NRF or direct access to Number
Portability (NP) databases via non-SBI, if applicable.
> NOTE 1: NP applies to GPSIs representing E.164 addresses (i.e., MSISDN). NP
> is subject to regional and regulatory requirements and is accomplished
> through the retrieval of ported data from NP databases. Support of ENUM or
> direct access to NP via non-SBI interfaces and the exact means to make the
> number portability data available to the NRF is subject to and configured
> per operator policy.
The NRF may use the DNS/ENUM translation mechanism to resolve the GPSI of the
SMS recipient in E.164 format to a URI as specified in IETF RFC 6116 [12]. The
NRF performs an ENUM query for the GPSI of the SMS recipient in step 2a. The
output of the lookup process in the DNS/ENUM server is a URI that is provided
in the ENUM response and points to the originating PLMN or the NRF in the
target PLMN with which the originating PLMN has an interconnection agreement
using SBI, so that the NRF in the originating PLMN can send an inter-PLMN
service discovery request to the NRF in the target PLMN.
> NOTE 2: The DNS/ENUM server searches for an ENUM record matching the GPSI of
> the SMS recipient. An ENUM record for the individual GPSI or number series
> provisioned in the DNS/ENUM server can be used to indicate whether the user
> belongs to the same PLMN or another PLMN in the same or different country. A
> URI as a result of the lookup process in the DNS/ENUM server can be provided
> by provisioning an ENUM service using the http or https scheme URI as
> defined in IETF RFC 4002 [13] and IETF RFC 6118 [14].
4\. Based on the response from the MNPF, the NRF in the originating PLMN
determines the target PLMN where to search for UDM instances.
If the NRF has obtained the target PLMN information by other means in steps
2a-3a, the NRF determines the target PLMN based on the information from ENUM
response, NP databases via non-SBI and/or local configuration.
If the GPSI belongs to the originating PLMN (i.e. originating network is the
same as subscription network), the NRF searches for UDM instances matching the
discovery criteria that can serve the request in the originating PLMN using
SBI services and provides the discovery response in step 7.
If the GPSI belongs to a different PLMN, the NRF checks whether the
originating PLMN has an interconnection agreement using SBI with the
subscription PLMN and, in that case, sends an inter-PLMN discovery request
including the GPSI to the NRF in the subscription PLMN to retrieve the UDM
instances that can serve the SMS recipient, as defined in clause 4.17.5 of
3GPP TS 23.502 [4] and 3GPP TS 29.510 [10], and the procedure continues in
step 6.
4a. If indirect routing mechanism is used (i.e., no interaction as in steps
2-3 between NRF and MNPF in the originating PLMN), the NRF in the originating
PLMN determines the PLMN ID of the number range holder network (e.g. from the
recipient\'s GPSI prefix (CC+NDC) based on local configuration) and sends an
inter-PLMN discovery request of UDM instances to the NRF in the number range
holder network. In this case, the discovery request across PLMNs shall include
the GPSI of the SMS recipient and the indication to determine the target PLMN
and interface to be used.
5\. Based on the indication to determine the target PLMN and interface to be
used included in the discovery request from the NRF in the originating PLMN,
the NRF in the number range holder PLMN applies the behaviour described for
the NRF in steps 2-3 (or alternatively, steps 2a-3a) and step 4.
The NRF in the number range holder network may perform a query to the MNPF
using SBI if NP is required and NP information has not been retrieved
previously (e.g., if originating and number range holder PLMNs belong to
different countries or portability domains and NP is required in the country
of the recipient GPSI). The NRF in the number range holder network obtains the
PLMN ID of the subscription network in the response from the MNPF (or
alternatively by other means such as ENUM/NP) and, if applicable, sends an
inter-PLMN discovery request of UDM instances including the GPSI to the NRF in
the subscription network.
6\. The NRF in the subscription network provides the inter-PLMN discovery
response including UDM instance(s) matching the discovery criteria or no UDM
instance(s) found in the target PLMN, implying that SBI interactions should
not be used.
When using indirect routing, the NRF in the number range holder network
forwards the discovery response from the NRF in the subscription network to
the NRF in the originating network.
7\. If the NRF in the originating network finds UDM instances matching the
filter criteria in the originating PLMN or receives UDM instances in the
response to a discovery request across PLMNs in step 6, the NRF provides the
UDM instances in the discovery response to the SMS-GMSC.
If no UDM instances can serve the request using SBI, the NRF provides the
discovery response indicating the SMS-GMSC to use a non-SBI interface for the
next operation request in the procedure.
8a. If the discovery response includes UDM instances that can serve the SMS
recipient, the SMS-GMSC sends the operation request using SBI to e.g.,
retrieve the SMS routing information from the UDM, and the SBI-based MT SMS
procedure can be executed as described in clause 5.1.
8b. If no UDM instances are provided in the discovery response, the SMS-GMSC
sends the operation request via legacy interface using MAP/Diameter to e.g.,
retrieve the SMS routing information from the HLR/HSS/UDM.
### 5.1.8 Alert
Figure 5.1.8-1 depicts procedure for alert.
Figure 5.1.8-1: Procedure for alert
1 Unsuccessful Mobile Terminated short message transfer (without IP-SM-GW/SMS
Router) procedure, as defined in steps 1-10 in Figure 5.1.5-1.
2 UDM receives Namf_EventExposure_Notify or Nudm_UECM_Registration operation
from AMF or SMSF indicating that the UE is reachable for SMS delivery; or UDM
receives Nudm_UECM_Update operation from SMSF indicating that the UE has
memory capacity available.
3-4 The UDM notifies the \"UE_MEMORY_AVAILABLE_FOR_SMS\" or
\"UE_REACHABILITY_FOR_SMS\" event to the SMS-GMSC/IWMSC accordingly _. The UDM
updates the corresponding reachability flags and deletes the subscription to
UE reachability for SMS event created by the SMS-GMSC._
5 ServiceCentrealert as defined in Operation 13 of Figure 20 in TS 23.040 [2].
### 5.1.9 Unsuccessful Mobile Terminated short message transfer via SMS Router
Figure 5.1.9-1: Unsuccessful MT SMS over NAS via SMS Router
1\. MT SMS interaction between SC and SMS-GMSC follow the current procedure as
defined in 3GPP TS 23.040 [2].
2a-2b. The SMS-GMSC should query the NRF to find the UDM _instance that
manages the user subscriptions using the GPSI. If there is no available UDM
returned from NRF, the SMS-GMSC may send error response to the SC._
3\. SMS-GMSC invokes Nudm_UECM_SendRoutingInfoForSM (GPSI) to the UDM to get
the serving node information for all access types for the UE.
4\. The UDM shall check the registration/reachability flags to determine the
potential target nodes, e.g. SMSF. For MT SM transfer via SMS Router, the UDM
shall invoke the Nrouter_SMService_RoutingInfo to provide the SMSF Instance Id
to the SMS Router. The address of the SMS Router to be contacted by the UDM
may be configured locally.
5\. If any failure at this step, the SMS Router shall send
Nrouter_SMService_RoutingInfo response with error cause to the UDM.
6\. If the UDM receives error response from SMS Router in step 5 or UDM is
failed after step 3, e.g. user not found in the UDM, the UDM shall respond to
the SMS-GMSC by sending Nudm_UECM_SendRoutingInfoForSM response with error
cause. If there is no target node address registered in the UDM, a response
with error case indicating absent subscriber for SM is sent to the SMS-GMSC
and the procedure continues in step 15.
7\. If successful response is returned in step 6, the _SMS-GMSC_ forwards the
SMS message to the SMS Router by invoking Nrouter_SMService_MtForwardSm
service operation.
8\. The SMS Router forwards the SMS message to the SMSF by invoking
Nsmsf_SMService_MtForwardSm service operation.
9\. MT SMS over NAS procedure between SMSF, AMF and UE is same as the
definition in step 4a to 6b of Figure 4.13.3.6-1 of 3GPP TS 23.502 [4].
10\. If the AMF informs the SMSF that it cannot deliver the MT-SMS to the UE
in step 9, e.g. UE is not reachable, or the SMSF is failed at this step, e.g.
memory capacity exceeded, the SMSF shall send the Nsmsf_SMService_MtForwardSm
response with error cause to the SMS Router.
11\. If the SMS Router receives error response from SMSF in step 10 or the SMS
Router is failed after step 7, the SMS Router shall send the
Nrouter_SMService_MtForwardSm response with error cause to the SMS-GMSC.
12-13. The SMS-GMSC may report the SM-Delivery Status (e.g. UE is not
reachable or memory capacity exceeded) to UDM by invoking
Nudm_ReportSMDeliveryStatus_Request.
14\. If the SMS-GMSC receives error response from SMS Router in step 6 or step
11, the SMS-GMSC sends the failure report to SC as defined in TS 23.040 [2].
15\. The SMS-GMSC subscribes in UDM to be notified when the UE becomes
reachable for SMS (i.e. when the UE gets in radio contact with the AMF while
an SMSF is actually registered, or when an SMSF gets registered) by using the
Nudm_EventExposure_Subscribe service operation for Reachability for SMS event
as defined in 3GPP TS 23.502 [4].
16\. If applicable, the UDM subscribes to UE reachability notification in the
AMF(s) using the Namf_EventExposure service and sets the relevant reachability
flags. The UDM acknowledges the event subscription created by the SMS-GMSC.
## 5.2 Procedure for SBI-based MO SMS
### 5.2.1 General
The procedure for SBI-based MO SMS is showed in Figure 5.2.2-1, which is based
on MO SMS procedures in 3GPP TS 23.040 [2] clause 10.2. Compared to procedures
in 3GPP TS 23.040 [2], new services are introduced in, including:
\- _Niwmsc_SMService_ service provided by SMS-IWMSC.
This new service is registered in NRF, and can be invoked by service
consumers.
### 5.2.2 Procedure for Successful Mobile Originated short message transfer
Figure 5.2.2-1: Procedures for successful SBI-based SM MO message transfer
0 _SMS-IWMSC registers_ Niwmsc_SMService service _in the NRF, during the NF
registration procedure._
1 MO SM message transfer from UE to SMSF through AMF follows the current
procedure as defined in 3GPP TS 23.040 [2]
2a If SMSF knows from local configuration that the target SMS-IWMSC does not
support SBI, it shall quit the SBI-based procedure and fallback to legacy
(MAP/Diameter) protocol based procedures, as defined in TS 23.040 [2],
or SMSF invokes the Nnrf_NFDiscovery to discover and select serving SMS-IWMSC
with the parameters of SUPI and/or GPSI and/or location (e.g. TAIs, CGIs,
etc.) and/or E.164 address of the SC.
2b If no SMS-IWMSC could be discovered, the NRF shall feedback to SMSF, and
SMSF shall quit the SBI-based procedure and fallback to legacy (MAP/Diameter)
protocol based procedures, as defined in TS 23.040 [2].
If a SMS-IWMSC is discovered and selected, NRF returns the IP addresses or
FQDNs of the serving SMS-IWMSC to provide Niwmsc_SMService service to SMSF.
3 SMSF sends a Niwmsc_SMService_MoForwardSm service request to the URI of
serving SMS-IWMSC, which is obtained in step 2b. The payload body of the
request shall contain the SM record to be sent, the Service Centre address,
the callbackURI for MO SMS Delivery Report, the timer for waiting the MO SMS
Delivery Report, and optionally contains the Access Type.
4 MO SMS delivery _procedure between SMS-IWMSC and SC is the same as the
definition in step 4 of Figure 4.13.3.3-1 of 3GPP TS 23.502 [4]._
5 _SMS-IWMSC_ sends Niwmsc_SMService_MoForwardSm response to deliver the MO
SMS delivery report to the URI of serving SMSF, which is obtained in step 3
6 _MO SMS delivery report procedure between SMSF, AMF and UE is the same as
the 3GPP TS 23.502 [4]._
When no more SMS is to be sent, the procedure for CP-ack and SMS ack _is the
same as the 3GPP TS 23.502 [4]._
These procedures are defined in step 6a to 6d of Figure 4.13.3.3-1 of 3GPP TS
23.502 [4].
### 5.2.3 Unsuccessful Mobile Originated short message transfer
Figure 5.2.3-1 depicts procedure for unsuccessful SBI-based SM MO message
transfer
Figure 5.2.3-1: Procedures for unsuccessful SBI-based SM MO message transfer
0-3 _The same as the procedures in step 0-3 of Figure 5.2.2-1 in clause 5.2.2_
4 _SMS-IWMSC_ sends Niwmsc_SMService_MoForwardSm response with HTTP status
code for application errors as defined in Table 5.3.2-1.
5 _Failure report from SMSF to UE, with the error cause code as_ defined in
Table 5.3.2-2 _._
SMS-IWMSC indicates the different errors for MO SM transfer in MoForwardSm
response according to the different failure scenarios which happened during MO
SM transfer. The Application Errors used in Niwmsc_SMService_MoForwardSm
response are defined in Table 5.3.2-1 below
Table 5.3.2-1: Application errors
Application Error HTTP status code Description
* * *
UNKNOWN_SERVICE_CENTRE_ADDRESS 403 Forbidden The delivery of the MO short
message failed because SMS-SC was unknown. SERVICE_CENTRE_CONGESTION 403
Forbidden The delivery of the MO short message failed because SMS-SC was in
congestion. USER_NOT_SERVICE_CENTER 403 Forbidden The delivery of the short
message failed because the user didn\'t belongs to the SMS-SC.
FACILITY_NOT_SUPPORTED 403 Forbidden The delivery of the MO short message
failed because of facility not supported. INVALID_SME_ADDRESS 403 Forbidden
The delivery of the MO short message failed because the SME address is
invalid. UNREACHABLE_SMS_SC 504 Gateway Timeout The delivery of the MO short
message failed because the response is timeout.
If errors are indicated by the SMS-IWMSC, the SMSF shall send a failure report
(i.e. a RP-ERROR message) to the UE, with the error cause coded as following
map between errors indicated by SMS-IWMSC and error cause code in RP-ERROR
message:
Table 5.3.2-2: MAP of Application errors
+----------------------------------+----------------------------------+ | Return error from SMS-IWMSC | Cause value in the RP‑ERROR | | | message | +----------------------------------+----------------------------------+ | The Response from SMS-IWMSC is | 38 Network out of order | | timeout | | | | | | Unspecified 4xx/5xx error code | | +----------------------------------+----------------------------------+ | 403 Forbidden with | 69 Requested facility not | | FACILITY_NOT_SUPPORTED | implemented | +----------------------------------+----------------------------------+ | 403 Forbidden with | 1 Unassigned number | | U | | | NKNOWN_SERVICE_CENTRE_ADDRESS | | +----------------------------------+----------------------------------+ | 403 Forbidden with | 42 Congestion | | SERVICE_CENTRE__CONGESTION | | +----------------------------------+----------------------------------+ | 403 Forbidden with | 28 Unidentified subscriber | | USER_NOT_SERVICE_CENTER | | +----------------------------------+----------------------------------+ | 403 Forbidden with | 21 Short message transfer | | INVALID_SME_ADDRESS | rejected | +----------------------------------+----------------------------------+
NOTE: The coding and the use of the RP‑ERROR message is specified in 3GPP TS
24.011 [8].
### 5.2.4 MSISDN-less MO SMS message transfer
The procedure for SBI-based MSISDN-less MO SMS message transfer is depicted in
Figure 5.2.4-1,
**Figure 5.2.4-1: Procedures for MSISDN-less MO SMS message transfer**
> 0 NEF registers Nnef_SMService_MoForwardSm service and supporting long/short
> code ranges in NRF, _during the NF registration procedure_.
>
> 1 MO SMS transmit from UE to SMS-SC, as already defined in clause 5.2.2.
>
> 2a-2b SMS-SC provides destination SME address (long/short code of the AF) to
> NRF for NEF selection, and chooses Nnef_SMService_MoForwardSm service for
> MSISDN-less MO SMS submit.
>
> 3 SMS-SC forwards MO SM to NEF, by invoking Nnef_SMService_MoForwardSm
> service.
>
> 4-5 Nudm_SDM_Get and response between NEF and UDM, which refers to Step
> 3-Step 4 of Figure 4.13.7.2-1 in TS 23.502 [4].
>
> 6 The NEF provides a Nnef_MSISDN-less_MO_SMS Notify, which refers to Step 5
> of Figure 4.13.7.2-1 in TS 23.502 [4].
>
> 7 NEF sends Nnef_SMService_MoForwardSm response to SMS-SC, carrying a
> success or failure delivery indication to SMS-SC.
>
> 8 SMS-SC indicates success/failure back to UE using existing SBI-based SMS
> delivery report defined in clause 6.2.2.
# 6 Services for SBI-based SMS
## 6.1 General
This clause introduces the services for SBI-based SMS.
## 6.2 UDM services for SBI-based SMS
### 6.2.1 General
The following table illustrates the UDM services for SBI-based SMS.
Table 6.2.1-1: UDM Services for SBI-based SMS
+-------------+-------------+-------------+-------------+-------------+ | Service | Service | Operation | Service | Service | | Name | Operations | | Privider(s) | Consumer(s) | | | | Semantics | | | +=============+=============+=============+=============+=============+ | UE Context | SendRouti | request / | UDM | _SMS-GMSC_ | | Management | ngInfoForSM | response | | | | (UECM) | | | | | +-------------+-------------+-------------+-------------+-------------+ | ReportSMDel | Request | request / | _UDM_ | _SMS-GMSC,_ | | iveryStatus | | response | | IP-SM-GW, | +-------------+-------------+-------------+-------------+-------------+ | Ev | Subscribe | subscribe / | UDM | SMS-GMSC | | entExposure | | notify | | | +-------------+-------------+-------------+-------------+-------------+
### 6.2.2 Nudm_ReportSMDeliveryStatus service
#### 6.2.2.1 General
For the Nudm_ReportSMDeliveryStatus service the following service operations
are defined:
\- Request
#### 6.2.2.2 Nudm_ReportSMDeliveryStatus ___ Request service operation
**Service operation name:** Nudm_ReportSMDeliveryStatus_Request
**Description:** reports the SM-Delivery Status to UDM.
**Inputs, Required:** GPSI, SM-Delivery status
**Inputs, Optional:** None.
**Outputs, Required:** report SM-Delivery status result _._
**Outputs, Optional:** None.
### 6.2.3 Nudm_EventExposure service
**Service Description** : This service is defined in clause 5.2.3.5 of 3GPP TS
23.502 [4], in addition, this clause defines the enhancement of
Nudm__EventExposure_ for alert sc.
Except the existing events that are exposed by UDM, events
\"UE_MEMORY_AVAILABLE_FOR_SMS\" and \"UE_REACHABILITY_FOR_SMS\" should be
supported.
### 6.2.4 Nudm__UECM_ service
**Service Description** : This service is defined in clause 5.2.3.2 of 3GPP TS
23.502 [4], in addition, this clause defines the enhancement of Nudm_UECM
service.
The new service operation SendRoutingInfoForSM shall be supported to get the
target valid node(s) serving the UE from the UDM, which will be used by the
SMS-GMSC to deliver the MT SMS.
## 6.3 SMS-IWMSC services for SBI-based SMS
### 6.3.1 General
The following table illustrates the SMS-IWMSC services for SBI-based SMS.
Table 6.3.1-1: SMS-IWMSC Services for SBI-based SMS
+-------------+-------------+-------------+-------------+-------------+ | Service | Service | Operation | Service | Service | | Name | Operations | | Privider(s) | Consumer(s) | | | | Semantics | | | +=============+=============+=============+=============+=============+ | SMService | MoForwardSm | request / | SMS-IWMSC | SMSF | | | | response | | | +-------------+-------------+-------------+-------------+-------------+
### 6.3.2 Niwmsc_SMService service
#### 6.3.2.1 General
**Service Description** : This service can be used for SBI-based MO SM
transfer and Delivery Report through SMS-IWMSC.
#### 6.3.2.2 Niwmsc_SMService_MoForwardSm service operation
**Service operation name:** Niwmsc_SMService_MoForwardSm.
**Description:** Service request from consumer to SMS-IWMSC for MO SM
transmit.
**Inputs, Required:** the SM record to be sent, the Service Centre address,
the callbackURI for MO SMS Delivery Report, the timer for waiting MO SMS
Delivery Report.
**Inputs, Optional:** Access Type.
**Outputs, Required:** On success, Delivery Report should be returned.
On failure or redirection, the appropriate HTTP status code (e.g. \"403
Forbidden\", \"504 Gateway Timeout\") indicating the error shall be returned.
**Outputs, Optional:** None.
## 6.4 SMSF services for SBI-based SMS
### 6.4.1 General
The following table illustrates the SMSF services for SBI-based SMS.
Table 6.4.1-1: SMSF Services for SBI-based SMS
+-------------+-------------+-------------+-------------+-------------+ | Service | Service | Operation | Service | Service | | Name | Operations | | Privider(s) | Consumer(s) | | | | Semantics | | | +=============+=============+=============+=============+=============+ | SMService | MtForwardSm | request / | SMSF | _SMS-GMSC, | | | | response | | IP-SM-GW, | | | | | | SMS Router_ | +-------------+-------------+-------------+-------------+-------------+
### 6.4.2 Nsmsf_SMService service
#### 6.4.2.1 General
**Service Description** : This service can be used for SBI-based MT SM
transfer through SMSF.
#### 6.4.2.2 Nsmsf_SMService_MtForwardSm service operation
**Service operation name:** Nsmsf__SMService_ _MtForwardSm
**Description:** transfer downlink SMS message from consumer NF to SMSF.
**Inputs, Required:** GPSI, SMS payload
**Inputs, Optional:** None.
**Outputs, Required:** SMS message transmission result _._
**Outputs, Optional:** None.
## 6.5 IP-SM-GW services for SBI-based SMS
### 6.5.1 General
The following table illustrates the IP-SM-GW services for SBI-based SMS.
Table 6.5.1-1: IP-SM-GW Services for SBI-based SMS
+-------------+-------------+-------------+-------------+-------------+ | Service | Service | Operation | Service | Service | | Name | Operations | | Privider(s) | Consumer(s) | | | | Semantics | | | +=============+=============+=============+=============+=============+ | SMService | RoutingInfo | request / | IP-SM-GW | UDM | | | | response | | | +-------------+-------------+-------------+-------------+-------------+ | | MtForwardSm | request / | IP-SM-GW | _SMS-GMSC_ | | | | response | | | +-------------+-------------+-------------+-------------+-------------+
### 6.5.2 Nipsmgw_SMService service
#### 6.5.2.1 General
**Service Description** : This service can be used for SBI-based MT SM
transfer through IP-SM-GW.
#### 6.5.2.2 Nipsmgw_SMService_RoutingInfo service operation
**Service operation name:** Nipsmgw__SMService_ _RoutingInfo
**Description:** provides the SMSF Instance Id to the IP-SM-GW.
**Inputs, Required:** GPSI, SMSF Instance Id.
**Inputs, Optional:** None.
**Outputs, Required:** Result _._
**Outputs, Optional:** None.
#### 6.5.2.3 Nipsmgw_SMService_MtForwardSm service operation
**Service operation name:** Nipsmgw__SMService_ _MtForwardSm
**Description:** transfer downlink SMS message from consumer NF to IP-SM-GW
and return the MT SMS Delivery Report to the consumer NF.
**Inputs, Required:** GPSI, SMS payload
**Inputs, Optional:** None.
**Outputs, Required:** MT SMS Delivery Report _._
**Outputs, Optional:** None.
## 6.6 SMS Router services for SBI-based SMS
### 6.6.1 General
The following table illustrates the SMS Router services for SBI-based SMS.
Table 6.6.1-1: SMS Router Services for SBI-based SMS
+-------------+-------------+-------------+-------------+-------------+ | Service | Service | Operation | Service | Service | | Name | Operations | | Privider(s) | Consumer(s) | | | | Semantics | | | +=============+=============+=============+=============+=============+ | SMService | RoutingInfo | request / | SMS Router | UDM | | | | response | | | +-------------+-------------+-------------+-------------+-------------+ | | MtForwardSm | request / | SMS Router | _SMS-GMSC_ | | | | response | | | +-------------+-------------+-------------+-------------+-------------+
### 6.6.2 Nrouter_SMService service
#### 6.6.2.1 General
**Service Description** : This service can be used for SBI-based MT SM
transfer through SMS Router.
#### 6.6.2.2 Nrouter_SMService_RoutingInfo service operation
**Service operation name:** Nrouter__SMService_ _RoutingInfo
**Description:** provides the SMSF Instance Id to the SMS Router.
**Inputs, Required:** GPSI, SMSF Instance Id.
**Inputs, Optional:** None.
**Outputs, Required:** Result _._
**Outputs, Optional:** None.
#### 6.6.2.3 Nrouter_SMService_MtForwardSm service operation
**Service operation name:** Nrouter__SMService_ _MtForwardSm
**Description:** transfer downlink SMS message from consumer NF to SMS Router
and return the MT SMS Delivery Report to the consumer NF.
**Inputs, Required:** GPSI, SMS payload
**Inputs, Optional:** None.
**Outputs, Required:** MT SMS Delivery Report _._
**Outputs, Optional:** None.
## 6.7 MNPF services for SBI-based SMS
### 6.7.1 General
The following table illustrates the MNPF services for SBI-based SMS.
Table 6.7.1-1: MNPF Services for SBI-based SMS
+-------------+-------------+-------------+-------------+-------------+ | Service | Service | Operation | Service | Service | | Name | Operations | | Privider(s) | Consumer(s) | | | | Semantics | | | +=============+=============+=============+=============+=============+ | NPStatus | Get | request / | MNPF | SMS-GMSC, | | | | response | | SCP | +-------------+-------------+-------------+-------------+-------------+
### 6.7.2 Nmnpf_NPStatus service
#### 6.7.2.1 General
**Service Description** : This service can be used to retrieve the PLMN ID of
the Subscription Network of a GPSI.
#### 6.7.2.2 Nmnpf_NPStatus_Get service operation
**Service operation name:** Nmnpf__NPStatus__ Get
**Description:** retrieve the PLMN ID of the Subscription Network of a GPSI.
**Inputs, Required:** GPSI.
**Inputs, Optional:** None.
**Outputs, Required:** PLMN Id _._
**Outputs, Optional:** None.
## 6.8 NEF services for SBI-based SMS
### 6.8.1 General
The following table illustrates the NEF services for SBI-based SMS.
Table 6.8.1-1: NEF Services for SBI-based SMS
+-------------+-------------+-------------+-------------+-------------+ | Service | Service | Operation | Service | Service | | Name | Operations | | Privider(s) | Consumer(s) | | | | Semantics | | | +=============+=============+=============+=============+=============+ | SMService | MoForwardSm | request / | NEF | SMS-SC | | | | response | | | +-------------+-------------+-------------+-------------+-------------+
### 6.8.2 Nnef_SMService service
#### 6.8.2.1 General
This service can be used for SBI-based MO SM transfer through NEF for MSISDN-
less MO SMS.
#### 6.8.2.2 Nnef_SMService_MoForwardSm service operation
**Service operation name:** Nnef__SMService_ _MoForwardSm
**Description:** transmit MO SMS message from consumer NF to NEF.
**Inputs, Required:** SMS payload, Application port ID, SUPI, destination SME
address (long/short code of the AF).
**Inputs, Optional:** None.
**Outputs, Required:** SMS message transmission result _._
**Outputs, Optional:** None.
*\ *
#
# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
The present document specifies the Stage 2 of the Proximity based Services
(ProSe) features in 5GS. 5G ProSe features consist of: 5G ProSe Direct
Discovery, 5G ProSe Direct Communication and 5G ProSe UE-to-Network Relay.
5G ProSe Direct Discovery identifies that 5G ProSe-enabled UEs are in
proximity using NR.
5G ProSe Direct Communication enables establishment of communication paths
between two or more 5G ProSe-enabled UEs that are in direct communication
range using NR.
5G ProSe UE-to-Network Relay enables indirect communication between the 5G
network and UEs (e.g. for UEs that are out of coverage of the network).
Security aspects of ProSe in 5GS are defined in TS 33.503 [29].
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.287: \"Architecture enhancements for 5G System (5GS) to support
Vehicle-to-Everything (V2X) services\".
[3] 3GPP TS 23.303: \"Proximity-based services (ProSe); Stage 2\".
[4] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[5] 3GPP TS 23.502: \"Procedures for the 5G System (5GS); Stage 2\".
[6] 3GPP TS 22.261: \"Service requirements for next generation new services
and markets; Stage 1\".
[7] 3GPP TS 22.278: \"Service requirements for the Evolved Packet System
(EPS)\".
[8] 3GPP TS 23.288: \"Architecture enhancements for 5G System (5GS) to support
network data analytics services\".
[9] 3GPP TS 23.503: \"Policy and Charging Control Framework for the 5G
System\".
[10] Void.
[11] 3GPP TS 36.300: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and
Evolved Universal Terrestrial Radio Access Network (E-UTRAN); Overall
description; Stage 2\".
[12] 3GPP TS 38.300: \"NR; NR and NG-RAN Overall Description; Stage 2\".
[13] 3GPP TS 38.304: \"NR; User Equipment (UE) procedures in idle mode\".
[14] 3GPP TS 23.122: \"Non-Access-Stratum (NAS) functions related to Mobile
Station in idle mode\".
[15] 3GPP TS 36.331: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Radio Resource Control (RRC); Protocol specification\".
[16] 3GPP TS 38.331: \"NR; Radio Resource Control (RRC); Protocol
Specification\".
[17] IETF RFC 4862: \"IPv6 Stateless Address Autoconfiguration\".
[18] IETF RFC 3927: \"Dynamic Configuration of IPv4 Link-Local Addresses\".
[19] IETF RFC 826: \"An Ethernet Address Resolution Protocol\".
[20] Void.
[21] 3GPP TR 23.752: \"Study on system enhancement for Proximity based
Services (ProSe) in the 5G System (5GS)\".
[22] 3GPP TS 32.277: \"Proximity-based Services (ProSe) charging\".
[23] 3GPP TS 24.554: \"Proximity-services (ProSe) in 5G System (5GS) protocol
aspects; Stage 3\".
[24] IETF RFC 2131: \"Dynamic Host Configuration Protocol\".
[25] IETF RFC 4039: \"Rapid Commit Option for the Dynamic Host Configuration
Protocol version 4 (DHCPv4)\".
[26] IETF RFC 6603: \"Prefix Exclude Option for DHCPv6-based Prefix
Delegation\".
[27] IETF RFC 8415: \"Dynamic Host Configuration Protocol for IPv6 (DHCPv6)\".
[28] 3GPP TS 38.351: \"NR; Sidelink Adaptation Layer Protocol\".
[29] 3GPP TS 33.503: \"Security Aspects of Proximity based Services (ProSe) in
the 5G System (5GS)\".
[30] 3GPP TS 29.500: \"5G System; Technical Realization of Service Based
Architecture; Stage 3\".
# 3 Definitions of terms and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in TR 21.905 [1] and
the following apply. A term defined in the present document takes precedence
over the definition of the same term, if any, in TR 21.905 [1].
**5G ProSe-enabled UE:** A UE that supports 5G ProSe requirements and
associated procedures.
**5G ProSe Direct Discovery:** A procedure employed by a 5G ProSe-enabled UE
to discover other 5G ProSe-enabled UEs in its vicinity based on direct radio
transmissions between the two UEs with NR technology.
**5G ProSe Direct Communication:** A communication between two or more UEs in
proximity that are 5G ProSe-enabled, by means of user plane transmission using
NR technology via a path not traversing any network node.
**5G ProSe UE-to-Network Relay:** A 5G ProSe-enabled UE that provides
functionality to support connectivity to the network for 5G ProSe Remote
UE(s).
**5G ProSe Remote UE:** A 5G ProSe-enabled UE that communicates with a DN via
a 5G ProSe UE-to-Network Relay.
**Application Layer ID:** An identifier identifying a 5G ProSe-enabled UE
within the context of a specific application. The format of this identifier is
outside the scope of 3GPP.
**Direct Network Communication:** One mode of network communication, where
there is no 5G ProSe UE-to-Network Relay between a UE and the 5G network.
**Indirect Network Communication:** One mode of network communication, where
there is a 5G ProSe UE-to-Network Relay between a UE and the 5G network.
**Member ID:** An identifier uniquely identifying a member in the Application
Layer managed group and that is managed by the ProSe application layer.
**Mode of communication:** Mode of communication to be used by the 5G ProSe-
enabled UE over PC5 reference point, i.e. broadcast mode, groupcast mode or
unicast mode.
**Open ProSe Discovery** : ProSe Direct Discovery without explicit permission
from the 5G ProSe-enabled UE being discovered, according to TS 22.278 [7].
**ProSe identifier:** A globally unique identifier used to identify the ProSe
Application associated with the ProSe operation in 5G ProSe Direct Discovery
and 5G ProSe Direct Communication. In this Release, the \"Application ID\"
defined in TS 23.303 [3] can be used as the ProSe identifier in 5G ProSe
Direct Discovery and in a consequent 5G ProSe Direct Communication.
**Restricted ProSe Discovery** : ProSe Direct Discovery that only takes place
with explicit permission from the 5G ProSe-enabled UE being discovered,
according to TS 22.278 [7].
**User Info ID:** The User Info ID is configured for Model A or Model B Group
Member Discovery and 5G ProSe UE-to-Network Relay Discovery either for public
safety or commercial applications based on the policy of the HPLMN or via the
ProSe application server that allocates it. The definition of values of User
Info ID is out of scope of this specification.
For the purposes of the present document, the following term and definition
given in TS 23.303 [3] apply:
**Application Layer Group ID**
**Destination Layer-2 ID**
**Discovery Entry ID**
**Discovery Filter**
**Discovery Query Filter**
**Discovery Response Filter**
**Geographical Area**
**Local PLMN**
**Model A**
**Model B**
**Metadata Index Mask**
**ProSe Application ID**
**ProSe Application Code**
**ProSe Application Mask**
**ProSe Query Code**
**ProSe Response Code**
**ProSe Restricted Code**
**ProSe Restricted Code Prefix**
**ProSe Restricted Code Suffix**
**ProSe Discovery UE ID**
**ProSe Layer-2 Group ID**
**Restricted ProSe Application User ID**
**Source Layer-2 ID**
For the purposes of the present document, the following term and definition
given in TS 23.287 [2] apply:
**NR Tx Profile**
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
5G DDNMF 5G Direct Discovery Name Management Function
AS layer Access Stratum layer
NCGI NR Cell Global ID
PDUID ProSe Discovery UE ID
PFI PC5 QoS Flow Identifier
PQI PC5 5QI
ProSe Proximity based Services
RPAUID Restricted ProSe Application User ID
RSC Relay Service Code
RSD Rule Selection Descriptor
TAI Tracking Area Identity
# 4 Architecture model and concepts
## 4.1 General concept
Proximity based Services (ProSe) are services that can be provided by the 5GS
based on UEs being in proximity to each other.
The 5GS enablers for ProSe include the following functions:
\- 5G ProSe Direct Discovery;
\- 5G ProSe Direct Communication;
\- 5G ProSe UE-to-Network Relay.
## 4.2 Architectural reference model
### 4.2.1 Non-roaming reference architecture
Figure 4.2.1-1 shows the high-level view of the non-roaming 5G System
architecture for Proximity-based Services (ProSe) with service-based
interfaces within the Control Plane. In this figure, UE A and UE B use a
subscription of the same PLMN.
Figure 4.2.1-1: Non-roaming 5G System architecture for Proximity-based
Services
Figure 4.2.1-2 shows the high-level view of the non-roaming 5G System
architecture for Proximity-based Services (ProSe) in reference point
representation. In this figure, UE A and UE B use a subscription of the same
PLMN.
Figure 4.2.1-2: Non-roaming 5G System architecture for Proximity-based
Services in reference point representation
### 4.2.2 Roaming reference architecture
Figure 4.2.2-1 shows the high-level view of the roaming 5G System architecture
for Proximity-based Services (ProSe) with service-based interfaces within the
Control Plane. In the figure, UE A uses a subscription of HPLMN.
Figure 4.2.2-1: Roaming 5G System architecture for Proximity-based Services
### 4.2.3 Inter-PLMN reference architecture
The following figure 4.2.3-1 shows the high level view of the non-roaming
inter-PLMN architecture with service-based interfaces within the Control
Plane. In this figure, PLMN A is the HPLMN of UE A and PLMN B is the HPLMN of
UE B.
Figure 4.2.3-1: Non-roaming Inter-PLMN 5G System architecture for Proximity-
based Services
Figure 4.2.3-2 shows the high level view of the roaming architecture with
service-based interfaces within the Control Plane. In this figure, UE A uses a
subscription of PLMN A and UE B uses a subscription of PLMN B; UE A is roaming
in PLMN C while UE B is not roaming.
Figure 4.2.3-2: Roaming Inter-PLMN 5G System architecture for Proximity-based
Services
### 4.2.4 AF-based service parameter provisioning
The 5G System provides NEF services to enable communication between NFs in the
PLMN and a ProSe Application Server. Figure 4.2.4-1 shows the high level view
of AF-based service parameter provisioning for 5G ProSe communications. The
ProSe Application Server may provide ProSe service parameters to the PLMN via
NEF. The NEF stores the ProSe service parameters in the UDR.
Figure 4.2.4-1: 5G System architecture for AF-based service parameter
provisioning for 5G ProSe communications
### 4.2.5 Reference points
**PC1** : The reference point between the ProSe application in the UE and in
the ProSe Application Server. It is used to define application level
signalling requirements. This reference point is not specified in this release
of the specification.
**PC3a** : The reference point between the UE and the 5G DDNMF. PC3a relies on
5GC user plane for transport (i.e. an \"over IP\" reference point). It is used
to authorise 5G ProSe Direct Discovery request, and perform allocation of
ProSe Application Codes / ProSe Restricted Codes corresponding to ProSe
Application Identities used for 5G ProSe Direct Discovery.
**PC5** : The reference point between ProSe-enabled UEs used for control and
user plane for 5G ProSe Direct Discovery, 5G ProSe Direct Communication and 5G
ProSe UE-to-Network Relay.
**PC8:** The reference point between the UE and the 5G ProSe Key Management
Function (5G PKMF). The details are defined in TS 33.503 [29].
**Npc2** : The reference point between the ProSe Application Server and the 5G
DDNMF. It is used to define the interaction between ProSe Application Server
and 5G DDNMF for 5G ProSe Direct Discovery.
**Npc4** : The reference point between the UDM and 5G DDNMF. It is used to
provide subscription information in order to authorise 5G ProSe Direct
Discovery request.
**Npc6** : The reference point between the 5G DDNMF in the HPLMN and the 5G
DDNMF in a Local PLMN (5G ProSe Direct Discovery). This reference point is
used for HPLMN control of ProSe service authorization.
**Npc7** : The reference point between the 5G DDNMF in the HPLMN and the 5G
DDNMF in the VPLMN. It is used for HPLMN control of ProSe service
authorization.
**Npc8:** The reference point between the PCF and the 5G DDNMF. It is used to
define the interactions between the 5G DDNMF and the PCF to e.g. get a PDUID
from the PCF.
**Npc9:** The reference point between the 5G PKMF of the 5G ProSe Remote UE
and the 5G PKMF of the 5G ProSe UE-to-Network Relay. The details are defined
in TS 33.503 [29].
**Npc10:** The reference point between the 5G PKMF and UDM. The details are
specified in TS 33.503 [29].
**Npc11:** The reference point between the AUSF and Prose Anchor Function
(PAnF). The details are specified in TS 33.503 [29].
**Npc12:** The reference point between the PAnF and UDM. The details are
specified in TS 33.503 [29].
**Npc13:** The reference point between the SMF and PKMF. The details are
specified in TS 33.503 [29].
**Npc14:** The reference point between the SMF and PAnF. The details are
specified in TS 33.503 [29].
NOTE: Npc2, Npc4, Npc6, Npc7, Npc8, Npc9 Npc10, Npc11, Npc12, Npc13 and Npc14
show the interactions that exist between the NF services in the NFs. These
reference points are realised by corresponding NF service-based interfaces and
by specifying the identified consumer and producer NF service as well as their
interaction in order to realize a particular system procedure.
### 4.2.6 Service-based interfaces
**N5g-ddnmf:** Services provided by 5G DDNMF to manage inter-PLMN 5G ProSe
Direct Discovery operations.
**Npkmf** : Service provided by 5G PKMF to support inter-PLMN ProSe security
management. The function of Npkmf is defined in TS 33.503 [29].
In addition to the relevant services defined in TS 23.501 [4] for the
following service-based interfaces, in the case of ProSe Service, the services
can be provided by corresponding NF are as follows:
**Nudm** : Services provided by UDM are used to get 5G ProSe Service related
subscription information to the AMF during Initial Registration procedure or
UE Configuration Update (UCU) procedure to inform the AMF the subscription
information has changed, and to provide ProSe Service related subscription
information to 5G DDNMF for the authorisation of 5G ProSe Direct Discovery
requests. The subscription information is described in TS 23.502 [5]. Services
provided by UDM may also be used by the 5G PKMF for relay service
authorisation, see TS 33.503 [29].
**Npcf** : Services provided by H-PCF are used to provide 5G ProSe Service
related parameters to V-PCF for the UE and NG-RAN in the roaming case, and to
enable the 5G DDNMF to get a PDUID or be notified of PDUID change.
**Nudr** : Services provided by UDR are used to notify the PCF and the UDM of
the update of the 5G ProSe Service related information as described in TS
23.502 [5].
**Nnef** : Services provided by NEF are used by the ProSe Application Server
to update 5G ProSe Service related information of 5GC.
**Namf:** Services provided by AMF are consumed by PCF to provide the 5G ProSe
Service related parameters for the UE and the NG-RAN to the AMF, and to enable
the AMF create or update the UE context related to 5G ProSe service.
**Nnrf:** Services provided by NRF are used to discover the PCF that supports
5G ProSe service and for 5G DDNMF in HPLMN to discover other 5G DDNMFs in
VPLMN or local PLMN.
**Naf:** Services provided by AF are consumed by the DDNMF to request
authorization for Discovery Request. The AF may update the authorization
information to revoke the Restricted ProSe Direct Discovery permission.
### 4.2.7 5G ProSe UE-to-Network Relay reference architecture
#### 4.2.7.1 5G ProSe Layer-3 UE-to-Network Relay reference architecture
The following figure 4.2.7.1-1 shows the high level reference architecture for
5G ProSe Layer-3 UE-to-Network Relay. In this figure, the 5G ProSe Layer-3 UE-
to-Network Relay may be in the HPLMN or a VPLMN.
Figure 4.2.7.1-1: Reference architecture for 5G ProSe Layer-3 UE-to-Network
Relay
The following figure 4.2.7.1-2 shows the non-roaming reference architecture
for 5G ProSe Layer-3 UE-to-Network Relay when N3IWF is supported. In this
figure, the PLMN A and PLMN B may be the same or different. When the 5G ProSe
Layer-3 Remote UE may connect to NG-RAN directly to access PLMN B, and in that
case it would take the role of UE in the figure. The N3IWF may be connected to
Relay UE UPF via a Data Network.
Figure 4.2.7.1-2: Non-roaming architecture model for 5G ProSe Layer-3 UE-to-
Network Relay with N3IWF support
The following figure 4.2.7.1-3 shows the roaming reference architecture for 5G
ProSe Layer-3 UE-to-Network Relay. In this figure, the PLMN A and PLMN B may
be the same or different and/or the PLMN A and PLMN C may be the same or
different. The N3IWF may be connected to Relay UE UPF via a Data Network.
Figure 4.2.7.1-3: Roaming architecture model for 5G ProSe Layer-3 UE-to-
Network Relay with N3IWF support
#### 4.2.7.2 5G ProSe Layer-2 UE-to-Network Relay reference architecture
Figure 4.2.7.2-1 shows the 5G ProSe Layer-2 UE-to-Network Relay reference
architecture. The 5G ProSe Layer-2 Remote UE and 5G ProSe Layer-2 UE-to-
Network Relay may be served by the same or different PLMNs. If the serving
PLMNs of the 5G ProSe Layer-2 Remote UE and the 5G ProSe Layer-2UE-to-Network
Relay are different then NG-RAN is shared by the serving PLMNs, see the 5G
MOCN architecture in clause 5.18 of TS 23.501 [4].
Figure 4.2.7.2-1: 5G ProSe Layer-2 UE-to-Network Relay reference architecture
NOTE 1: Uu between the 5G ProSe Layer-2 Remote UE and NG-RAN consists of RRC,
SDAP and PDCP.
NOTE 2: The 5G ProSe Layer-2 Remote UE and 5G ProSe Layer-2 UE-to-Network
Relay are served by the same NG-RAN. The Core Network entities (e.g., AMF,
SMF, UPF) serving the 5G ProSe Layer-2 Remote UE and the 5G ProSe Layer-2 UE-
to-Network Relay can be the same or different.
## 4.3 Functional Entities
### 4.3.1 UE
Any 5G ProSe-enabled UE may support the following functions:
\- Exchange of information for 5G ProSe Direct Discovery between 5G ProSe-
enabled UE and the 5G DDNMF over PC3a reference point.
\- Procedures for 5G ProSe Direct Discovery of other 5G ProSe-enabled UEs over
PC5 reference point.
\- Procedures for 5G ProSe Direct Communication over PC5 reference point,
including Broadcast, Groupcast and Unicast mode 5G ProSe Direct Communication.
\- Procedures to act as a 5G ProSe Layer-2 UE-to-Network Relay.
\- Procedures to act as a 5G ProSe Layer-3 UE-to-Network Relay.
\- Procedures to act as a 5G ProSe Layer-2 Remote UE.
\- Procedures to act as a 5G ProSe Layer-3 Remote UE.
\- Indicating UE Policy Provisioning Request in UE Policy Container for UE
triggered 5G ProSe Policy provisioning, which requests one or multiple types
of policies/parameters as listed below:
\- Policy/parameters for 5G ProSe Direct Discovery;
\- Policy/parameters for 5G ProSe Direct Communication;
\- Policy/parameters for 5G ProSe Layer-2 Remote UE;
\- Policy/parameters for 5G ProSe Layer-3 Remote UE;
\- Policy/parameters for 5G ProSe Layer-2 UE-to-Network Relay;
\- Policy/parameters for 5G ProSe Layer-3 UE-to-Network Relay.
\- Receiving the 5G ProSe Policy from 5GC over N1 reference point.
\- Configuration of parameters for 5G ProSe Direct Discovery, 5G ProSe Direct
Communication and 5G ProSe UE-to-Network Relay (e.g. including IP addresses,
ProSe Layer-2 Group IDs, see clause 5.1). These parameters can be pre-
configured in the UE, or, if in coverage, provisioned or updated by signalling
over the N1 reference point from the PCF in the HPLMN or over PC1 reference
point from the ProSe Application Server.
\- Reporting the following capabilities to 5GC over the N1 reference point:
\- 5G ProSe Capability.
### 4.3.2 5G DDNMF
#### 4.3.2.1 General
The 5G DDNMF is the logical function handling network related actions required
for dynamic 5G ProSe Direct Discovery. In this version of the specification,
it is assumed that there is only one logical 5G DDNMF in each PLMN that
supports 5G ProSe Direct Discovery service.
NOTE: If multiple 5G DDNMFs are deployed within the same PLMN (e.g., for load
reasons), the method to locate the 5G DDNMF that has allocated a specific
ProSe Application Code or ProSe Restricted Code (e.g. through a database
lookup, etc.) is not defined in this version of the specification.
The 5G DDNMF interacts with the 5G ProSe-enabled UE using procedures over PC3a
reference point defined in clause 6.3.1 to allocate and resolve the mapping of
ProSe Applications IDs and ProSe Application Codes used in 5G ProSe Direct
Discovery. It uses ProSe related subscriber data stored in UDM for the
authorisation of each discovery request. It also provides the UE with the
necessary security material in order to protect discovery messages transmitted
over the air. In restricted 5G ProSe Direct Discovery, it also interacts with
the Application Server via Npc2 reference points or with other 5G DDNMFs via
Npc6/Npc7 reference points for the authorization of the discovery requests.
The 5G ProSe-enabled UE use procedure defined in clause 4.3.2.2 to discovery
the 5G DDNMF in the HPLMN. Based on the UE Local Configuration or URSP as
defined in TS 23.503 [9], an existing PDU session is selected or a new PDU
session is established, to carry the control signalling between the UE and the
5G DDNMF in the HPLMN.
The 5G DDNMF provides the necessary charging functionality or charging
information for the usage of 5G ProSe Direct Discovery and/or ProSe Direct
Communication to interact with CHF or for the provision to CEF.
The 5G DDNMF in the HPLMN may interact with the 5G DDNMF in a VPLMN or Local
PLMN in order to manage the 5G ProSe Direct Discovery service.
The 5G DDNMF gets the address of the PCF for the UE from the BSF.
The 5G DDNMF gets the PDUID from the PCF and subscribes to notifications on
Change of PDUID.
#### 4.3.2.2 5G DDNMF Discovery
The 5G DDNMF of HPLMN is discovered through interaction with the Domain Name
Service function. The UE may have the 5G DDNMF address in the Home PLMN
(either as a FQDN or an IP address) pre-configured or provisioned as specified
in clause 5.1.2.1. If it is not pre-configured or provisioned then the UE
self-constructs the FQDN for it using e.g. the PLMN ID of the HPLMN.
The 5G DDNMF in the HPLMN uses the NRF to discovery other 5G DDNMFs in a VPLMN
or local PLMN.
### 4.3.3 PCF
In addition to the functions defined in TS 23.501 [4] and TS 23.503 [9], the
PCF includes functions to provision the UE with necessary policies and
parameters to use 5G ProSe services, as part of the UE ProSe Policy
information as defined in TS 23.503 [9] clause 4.2.2:
\- PC5 usage reporting configuration.
\- Authorization policy and parameters for 5G ProSe Direct Discovery and
Communication.
\- Authorization policy and parameters for 5G ProSe UE-to-Network Relay
Discovery and Communication (i.e. as 5G ProSe Layer-2 Remote UE, as 5G ProSe
Layer-3 Remote UE, as 5G ProSe Layer-2 UE-to-Network Relay, as 5G ProSe
Layer-3 UE-to-Network Relay).
\- PDUID allocation with its validity timer.
The PCF may update the 5G ProSe policy and parameters to the UE under certain
conditions.
When receiving the 5G ProSe Capability in Npcf_UEPolicyControl_Create Request
from the AMF or when receiving the updated subscription data from UDR, the PCF
generates the PC5 QoS parameters used by NG-RAN corresponding to a UE as
defined in clause 5.4.2 of TS 23.287 [2].
### 4.3.4 AMF
In addition to the functions defined in TS 23.501 [4], the AMF performs the
following functions:
\- Select a PCF supporting 5G ProSe Policy/Parameter provisioning based on
indication of 5G ProSe Capability as part of the \"5GMM capability\" in the
Registration Request.
\- Store the 5G ProSe Capability.
\- Forward the 5G ProSe Capability to PCF in Npcf_UEPolicyControl_Create
Request.
\- Obtain from UDM the subscription information related to 5G ProSe and store
them as part of the UE context data.
\- Obtain PC5 QoS parameters from the PCF and store them as part of the UE
context data.
\- Provision the NG-RAN with indication about the UE authorization status
about 5G ProSe Direct Discovery and 5G ProSe Direct Communication (i.e. as 5G
ProSe-enabled UE for ProSe Direct Discovery, as 5G ProSe-enabled UE for ProSe
Direct Communication), 5G ProSe UE-to-Network Relay Discovery and
Communication (i.e. as 5G ProSe Layer-2 Remote UE, as 5G ProSe Layer-2 UE-to-
Network Relay, as 5G ProSe Layer-3 UE-to-Network Relay).
\- Provision the NG-RAN with PC5 QoS parameters related to 5G ProSe Direct
Communication.
\- Optionally support security procedures over Control Plane for 5G ProSe UE-
to-Network relaying as defined in TS 33.503 [29].
### 4.3.5 UDM
In addition to the functions defined in TS 23.501 [4], the UDM performs the
following functions:
\- Subscription management for 5G ProSe Direct Discovery and Communication.
\- Subscription management for 5G ProSe UE-to-Network Relay Discovery and
Communication.
### 4.3.6 UDR
In addition to the functions defined in TS 23.501 [4], the UDR performs the
following functions:
\- Stores a path preference for ProSe services provided by the AF.
\- Stores ProSe service parameters.
### 4.3.7 NRF
In addition to the functions defined in TS 23.501 [4], the NRF performs the
following functions:
\- PCF discovery by considering 5G ProSe Capability.
\- 5G DDNMF Discovery.
Similar procedure can be used for 5G DDNMF discovery across PLMNs as specified
in clause 4.17.5 of TS 23.502 [5] with the difference as below:
\- The serving PLMN is replaced by home PLMN and home PLMN is replaced by
local PLMN or serving PLMN.
### 4.3.8 ProSe Application Server
The ProSe Application Server supports the following functionalities.
For 5G ProSe Direct Discovery:
\- Maintains permission information for the restricted 5G ProSe Direct
Discovery using RPAUIDs;
\- Storage of ProSe Discovery UE IDs and metadata;
\- Mapping of RPAUID and PDUID for restricted 5G ProSe Direct Discovery;
\- Provisioning parameters for Group Member Discovery to UE.
\- Interaction with 5G DDNMF for 5G ProSe Direct Discovery, including:
\- Allocation of the ProSe Restricted Code Suffix pool, if restricted Direct
Discovery with application-controlled extension is used;
\- Allocation of the mask(s) for ProSe Restricted Code Suffix, if restricted
Direct Discovery with application-controlled extension is used.
For 5G ProSe Direct Communication:
\- Provisioning a path preference for 5G ProSe Services to UDR;
\- Provisioning parameters for 5G ProSe Direct Communication to UE.
For 5G ProSe UE-to-Network Relay service:
\- Provisioning parameters for 5G ProSe UE-to-Network Relay Discovery and 5G
ProSe UE-to-Network Relay Communication to UDR.
### 4.3.9 5G ProSe UE-to-Network Relay
#### 4.3.9.1 General
Both 5G ProSe Layer-2 and Layer-3 UE-to-Network Relay entity provides the
relaying functionality to support connectivity to the network for 5G ProSe
Remote UEs. It can be used for both public safety services and commercial
services (e.g. interactive service).
Both 5G ProSe Layer-2 and Layer-3 UE-to-Network Relay supports the following
functions to enable connectivity to the network:
\- 5G ProSe UE-to-Network Relay Discovery service as defined in clause
6.3.2.3, to allow discovery by the 5G ProSe Remote UE;
\- access the 5GS as a UE as defined in TS 23.501 [4] with the enhancements as
specified in clauses 6.2 and 6.6;
\- relays unicast traffic (uplink and downlink) between the 5G ProSe Remote UE
and the network, supporting IP, Ethernet or Unstructured traffic type.
NOTE: Relaying MBS traffic to a 5G ProSe Remote UE by a 5G ProSe UE-to-Network
Relay is not supported in this release of the specification.
#### 4.3.9.2 5G ProSe Layer-3 UE-to-Network Relay
In addition to the common 5G ProSe UE-to-Network Relay functions defined in
clause 4.3.9.1, 5G ProSe Layer-3 UE-to-Network Relay supports the following
functions to enable connectivity to the network:
\- 5G ProSe Direct Communication via 5G ProSe Layer-3 UE-to-Network Relay as
specified in clause 6.5.1, for the communication with the 5G ProSe Layer-3
Remote UEs for the relay operations;
\- end-to-end QoS treatment for the 5G ProSe Layer-3 Remote UE\'s traffic
without N3IWF as defined in clause 5.6.2.1 and when accessing via an N3IWF as
defined in clause 5.6.2.2;
\- IP address management for the 5G ProSe Layer-3 Remote UE as defined in
clause 5.5.1.3 in case the 5G ProSe Layer-3 Remote UE uses IP traffic type.
#### 4.3.9.3 5G ProSe Layer-2 UE-to-Network Relay
In addition to the common 5G ProSe UE-to-Network Relay functions defined in
clause 4.3.9.1, 5G ProSe Layer-2 UE-to-Network Relay supports the following
functions to enable connectivity to the network:
\- 5G ProSe Direct Communication via 5G ProSe Layer-2 UE-to-Network Relay as
specified in clause 6.5.2, for the communication with the 5G ProSe Layer-2
Remote UEs for the relay operations;
\- QoS handling for 5G ProSe Layer-2 UE-to-Network Relay and end-to-end QoS
treatment as defined in clause 5.6.2.3.
### 4.3.10 SMF
In addition to the functions defined in TS 23.501 [4], the SMF supports the
following function:
\- Receiving 5G ProSe Layer-3 Remote UE report and maintaining the information
of 5G ProSe Layer-3 Remote UE(s) handled by a 5G ProSe Layer-3 UE-to-Network
Relay in the 5G ProSe Layer-3 UE-to-Network Relay\'s SM context for the PDU
Session associated with the relay.
### 4.3.11 NEF
In addition to the functions defined in TS 23.501 [4], the NEF supports the
following:
\- To enable AFs to provide service specific information to the 3GPP network,
the NEF supports additional service parameters for ProSe policy as specified
in clause 6.2.5.
# 5 High level functionality and features
## 5.1 Authorization and Provisioning for ProSe service
### 5.1.1 General
In 5GS, the parameters for 5G ProSe Direct Discovery, 5G ProSe Direct
Communication, and 5G ProSe UE-to-Network Relay service may be made available
to the UE in following ways:
\- provisioned in the ME; or
\- configured in the UICC; or
\- provisioned in the ME and configured in the UICC; or
\- provided or updated by the ProSe Application Server via PCF and/or PC1
reference point; or
\- provided or updated by the PCF to the UE.
If the same parameters described in clauses 5.1.2.1, 5.1.3.1 and 5.1.4.1 are
provided by different sources, the UE shall consider them in the following
priority order:
\- provided or updated by the PCF (including parameters determined by the PCF
itself and parameters provided by the ProSe Application Server to the PCF as
specified in clause 6.2.5);
\- provided or updated by the ProSe Application Server via PC1 reference
point;
\- configured in the UICC;
\- provisioned in the ME.
The parameters provided or updated by the ProSe Application Server via PC1
reference point may need to be complemented with configuration data from other
sources listed above.
NOTE: The ProSe Application Server can provision the same ProSe parameters via
5GC as specified in clause 6.2.5 or directly to the UE via PC1 reference
point, and can revoke (e.g. delete) the ProSe parameters via 5GC as specified
in clause 6.2.5 in order for the provisioning via PC1 reference point to take
effect.
The basic principles of service authorization and provisioning for 5G ProSe
Direct Discovery, 5G ProSe Direct Communication, and 5G ProSe UE-to-Network
Relay service are as follows:
\- The PCF in the HPLMN may configure a list of PLMNs where the UE is
authorized to use 5G ProSe Direct Discovery.
\- The PCF in the HPLMN may configure a list of PLMNs where the UE is
authorised to use 5G ProSe Direct Communication.
\- The PCF in the HPLMN may configure a list of PLMNs where the UE is
authorised to act as 5G ProSe UE-to-Network Relay. Authorisation for 5G ProSe
Layer-2 UE-to-Network Relay and 5G ProSe Layer-3 UE-to-Network Relay are
independent of each other.
\- The PCF in the HPLMN may configure a list of PLMNs where the UE is
authorised to access 5GC via 5G ProSe UE-to-Network Relay (i.e. to act as 5G
ProSe Remote UE). Authorisation to access via 5G ProSe Layer-2 UE-to-Network
Relay and via 5G ProSe Layer-3 UE-to-Network Relay are independent of each
other.
\- The PCF in the HPLMN merges authorization information from home and other
PLMNs and provides the UE with the final authorization information.
\- The PCF in the VPLMN or HPLMN may revoke the authorization (via H-PCF when
roaming) at any time by using the UE Configuration Update procedure for
transparent UE Policy delivery procedure defined in clause 4.2.4.3 of TS
23.502 [5].
\- The ProSe Policy/parameters provisioning to UE is controlled by the PCF and
may be triggered by UE. The PCF provisions one or more of the following ProSe
Policy/parameters:
\- ProSe Policy/parameters for 5G ProSe Direct Discovery as specified in
clause 5.1.2.1;
\- ProSe Policy/parameters for 5G ProSe Direct Communications as specified in
clause 5.1.3.1;
\- ProSe Policy/parameters for 5G ProSe Layer-2 and/or Layer-3 UE-to-Network
Relay as specified in clause 5.1.4.1;
\- ProSe Policy/parameters for 5G ProSe Layer-2 and/or Layer-3 Remote UE as
specified in clause 5.1.4.1.
\- The PCF includes the 5G ProSe Policy/parameters in a Policy Section
identified by a Policy Section Identifier (PSI) as specified in clause
6.1.2.2.2 of TS 23.503 [9].
In addition to the above, ProSe usage reporting configuration and rules for
charging can be (pre)configured in the UE or provided by the PCF.
In addition to the above, the path selection policy can be (pre)configured in
the UE or provided by the PCF as defined in clause 5.11. A path preference for
ProSe Services can be provided by ProSe Application Server to UDR, and may be
used by PCF for path selection policy generation and update.
When a 5G ProSe Layer-3 Remote UE is using a 5G ProSe Layer-3 UE-to-Network
Relay without involving N3IWF, the PCF based provisioning and update of 5G
ProSe Policy/parameters to the 5G ProSe Layer-3 Remote UE are not supported.
### 5.1.2 Authorization and Provisioning for 5G ProSe Direct Discovery
#### 5.1.2.1 Policy/Parameter provisioning for 5G ProSe Direct Discovery
The following sets of information for 5G ProSe Direct Discovery over PC5
reference point is provisioned to the UE:
1) Authorization policy for 5G ProSe Direct Discovery:
\- When the UE is \"served by NG-RAN\":
\- For open 5G ProSe Direct Discovery:
a) open 5G ProSe Direct Discovery Model A monitoring authorization policy:
\- PLMNs in which the UE is authorised to perform 5G ProSe Direct Discovery
monitoring.
b) open 5G ProSe Direct Discovery Model A announcing authorization policy:
\- PLMNs in which the UE is authorized to perform announcing.
\- For restricted 5G ProSe Direct Discovery:
a) restricted 5G ProSe Direct Discovery Model A monitoring authorization
policy:
\- PLMNs in which the UE is authorised to perform restricted 5G ProSe Direct
Discovery Model A monitoring.
b) restricted 5G ProSe Direct Discovery Model A announcing authorization
policy:
\- PLMNs in which the UE is authorized to perform restricted 5G ProSe Direct
Discovery Model A announcing.
c) restricted 5G ProSe Direct Discovery Model B Discoverer operation
authorization policy:
\- PLMNs in which the UE is authorized to perform Model B Discoverer
operation.
d) restricted 5G ProSe Direct Discovery Model B Discoveree operation
authorization policy:
\- PLMNs in which the UE is authorized to perform Model B Discoveree
operation.
NOTE 1: In this specification, [When the UE is \"served by NG-RAN\"] and [When
the UE is \"not served by NG-RAN\"] have similar meaning as in \"served by
E-UTRAN\" and \"not served by E-UTRAN\" in TS 23.303 [3], but applied to 5G
ProSe Direct discovery/communications over NR PC5 reference point.
\- When the UE is \"not served by NG-RAN\":
\- Indicates whether the UE is authorized to perform 5G ProSe Direct Discovery
for Model A and Model B when \"not served by NG-RAN\".
NOTE 2: If both Model A and Model B are authorized for 5G ProSe Direct
Discovery, it is up to UE and application implementation to select a discovery
model or perform both models simultaneously.
2) Parameters used for 5G ProSe Direct Discovery:
\- The mapping of ProSe services (i.e. ProSe identifiers) to Destination
Layer-2 ID(s) for sending/receiving initial signalling of discovery messages.
NOTE 3: The same Destination Layer-2 ID for 5G ProSe Direct Discovery can be
mapped to more than one ProSe services.
NOTE 4: The values provisioned for the Destination Layer-2 ID(s) for 5G ProSe
Direct Discovery, for Destination Layer-2 ID(s) for 5G ProSe Direct
Communication, defined in clause 5.1.3.1 and for Destination Layer-2 ID(s) for
5G ProSe UE-to-Network Relay Discovery defined in clause 5.1.4.1, are
different from each other.
NOTE 5: A \"catch all\" entry with the lowest priority can be used for the
ProSe services that do not have explicit mapping to the Destination Layer-2
ID(s) for sending/receiving initial signalling of discovery messages.
\- Application identifiers to be used for 5G ProSe Direct Discovery over PC5
interface.
NOTE 6: The Security parameters for 5G ProSe Direct Discovery can be
provisioned by 5G DDNMF as defined in TS 33.503 [29].
3) Radio parameters when the UE is \"not served by NG-RAN\":
\- Includes the radio parameters per NR PC5 with Geographical Area(s) and an
indication of whether they are \"operator managed\" or \"non-operator
managed\". The UE uses the radio parameters to perform 5G ProSe Direct
Discovery over PC5 reference point when \"not served by NG-RAN\" only if the
UE can reliably locate itself in the corresponding Geographical Area.
Otherwise, the UE is not authorized to transmit.
NOTE 7: Whether a frequency band is \"operator managed\" or \"non-operator
managed\" in a given Geographical Area is defined by local regulations.
\- Default PC5 DRX configuration (see TS 38.331 [16]).
4) Restricted ProSe Discovery UE ID for Restricted Direct Discovery:
\- ProSe Discovery UE ID.
5) Group Member Discovery parameters:
\- For each discovery group that the UE belongs to include the following
parameters that enable the UE to perform Group Member Discovery when provided
by PCF or provisioned in the ME or configured in the UICC:
\- Application Layer Group ID: Identifies an application layer group or a
discovery group that the UE belongs to;
\- Layer-2 Group ID: layer-2 ID for Application Layer Group ID;
\- User Info ID: For Model A, this corresponds to the Announcer Info parameter
when the UE is acting as an announcing UE. For Model B, this corresponds to
the Discoverer Info in Solicitation messages and the Discoveree Info in
Response messages, when the UE is acting as a discoverer or discoveree UE
respectively.
NOTE 8: User Info ID is expected to be assigned uniquely to a user within the
discovery group.
6) Optionally, the 5G DDNMF address (either FQDN or IP address) in the Home
PLMN.
7) Validity timer indicating the expiration time of the Policy/Parameter for
5G ProSe Direct Discovery.
The above parameter sets bullet 2), bullet 3), bullet 5) and bullet 7) may be
provided or updated to the UE by the ProSe Application Server, except for the
Security parameters in bullet 2).
#### 5.1.2.2 Principles for applying parameters for 5G ProSe Direct Discovery
For 5G ProSe Direct Discovery over PC5 reference point, the operator may pre-
configure the UEs with the required provisioning parameters for 5G ProSe
Direct Discovery, without the need for the UEs to connect to the 5GC to get
this initial configuration. The following apply:
\- The provisioning parameters for 5G ProSe Direct Discovery could be from
different sources and their priorities are described in clause 5.1.1.
\- The ME provisioning parameters shall not be erased when a USIM is
deselected or replaced.
\- The UE shall use radio resources for 5G ProSe Direct Discovery as follows:
\- While a UE has a serving cell and is camped on a cell and the UE intends to
use for 5G ProSe the radio resources (i.e. carrier frequency) operated by this
cell, then the UE shall use the radio resource description indicated by this
cell the UE is camped on and ignore any radio resource description of the same
radio resource provisioned in the ME or the UICC. If the cell does not provide
radio resources for ProSe, the UE shall not perform ProSe message transmission
and reception on radio resources operated by this cell. The UE is allowed to
perform 5G ProSe Direct Discovery with another UE not served by the same PLMN;
\- If the UE intends to use \"operator-managed\" radio resources (i.e. carrier
frequency) for 5G ProSe that are not operated by the UE\'s serving cell, as
specified in clause 5.1.2.1, or if the UE is out of coverage, the UE shall
search for a cell in any PLMN that is operating the provisioned radio
resources (i.e. carrier frequency) as defined in TS 38.300 [12] and TS 38.304
[13]; and:
\- If the UE finds such a cell in the registered PLMN or a PLMN equivalent to
the registered PLMN, and authorization for 5G ProSe Direct Discovery to this
PLMN is confirmed, the UE shall use the radio resource description indicated
by that cell. If that cell does not provide radio resources for ProSe, the UE
shall not perform ProSe message transmission and reception on those radio
resources;
\- If the UE finds such a cell but not in the registered PLMN or a PLMN
equivalent to the registered PLMN, and that cell belongs to a PLMN authorized
for 5G ProSe Direct Discovery and provides radio resources for ProSe then the
UE shall perform PLMN selection triggered by 5G ProSe Direct Discovery as
defined in TS 23.122 [14];
\- If the UE finds such cell but not in a PLMN authorized for 5G ProSe Direct
Discovery the UE shall not use 5G ProSe Direct Discovery;
\- If the UE does not find any such cell in any PLMN, then the UE shall
consider itself \"not served by NG-RAN\" and use radio resources provisioned
in the ME or the UICC. If no such provision exists in the ME or the UICC or
the provision does not authorize 5G ProSe Direct Discovery, then the UE is not
authorized to transmit;
\- The UE is allowed to use \"operator-managed\" radio resources (i.e. carrier
frequency) provisioned in the ME or the UICC for 5G ProSe Direct Discovery if
the UICC indicates it is authorized;
\- If the UE intends to use \"non-operator-managed\" radio resources (i.e.
carrier frequency) for 5G ProSe, according to TS 36.331 [15] or TS 38.331 [16]
and as specified in clause 5.1.2.1, then the UE shall perform 5G ProSe Direct
Discovery using resource provisioned in the ME or the UICC. If no such
provision exists in the ME or the UICC or the provision does not authorize 5G
ProSe Direct Discovery, then the UE is not authorized to transmit;
NOTE 1: It is possible for operators to configure UEs (e.g. Public Safety UEs)
to use only \"operator-managed\" radio resources (i.e. carrier frequency) for
5G ProSe Direct Discovery when the UE is \"not served by NG-RAN\".
\- The UE provisioning shall support setting Geographical Areas;
NOTE 2: It is possible for a UE to use other radio resources for 5G ProSe
based on the Geographical Area instead of those operated by the serving NG-RAN
cell, when provisioned in the UE, even if the UE\'s serving cell offers normal
service and the SIBs for NR sidelink communication defined in TS 38.331 [16]
indicates that the service (5G ProSe Direct Discovery) is available. This is
to cover the scenario when e.g. the radio resources used for 5G ProSe Direct
Discovery are not owned by the serving network of the UE.
NOTE 3: When cross-carrier operation is supported, according to TS 36.331 [15]
or TS 38.331 [16], a UE can be instructed by its serving cell to perform 5G
ProSe Direct Discovery over a different carrier frequency. The UE is still
considered as \"served by NG-RAN\" in this case.
NOTE 4: The scenario that a cell is detected and the cell does not provide
support for 5G ProSe Direct Discovery when the UE attempts to use a carrier
frequency configured for 5G ProSe Direct Discovery, is considered a
configuration error. Therefore, the UE does not transmit on that frequency to
avoid interference to the network.
\- The 5G ProSe Direct Discovery is only specified for NR.
NOTE 5: It is out of scope of the present specification to define how the UE
can locate itself in a specific Geographical Area. When the UE is in coverage
of a 3GPP RAT, it can for example, use information derived from the serving
PLMN. When the UE is not in coverage of a 3GPP RAT, it can use other
techniques, e.g. Global Navigation Satellite System (GNSS). User provided
location is not a valid input.
### 5.1.3 Authorization and Provisioning for 5G ProSe Direct Communication
#### 5.1.3.1 Policy/Parameter provisioning for 5G ProSe Direct Communication
The following sets of information for 5G ProSe Direct Communications over PC5
reference point is provisioned to the UE:
1) Authorization policy:
\- When the UE is \"served by NG-RAN\":
\- PLMNs in which the UE is authorized to perform 5G ProSe Direct
Communications over PC5 reference point when \"served by NG-RAN\".
\- When the UE is \"not served by NG-RAN\":
\- Indicates whether the UE is authorized to perform 5G ProSe Direct
Communications over PC5 reference point when \"not served by NG-RAN\".
NOTE 1: In this specification, [When the UE is \"served by NG-RAN\"] and [When
the UE is \"not served by NG-RAN\"] are relevant to 5G ProSe Direct
Communications over NR PC5 reference point.
2) Groupcast mode 5G ProSe Direct Communication policy/parameters:
\- For each application layer group supported include the parameters that
enable the UE to perform Groupcast mode 5G ProSe Direct Communication when
provided by PCF or provisioned in the ME or configured in the UICC:
\- Application Layer Group ID: Identifies an application layer group that the
UE belongs to.
\- ProSe Layer-2 Group ID: Destination Layer-2 ID applicable only when the
Application Layer Group ID is provided by the application layer
\- ProSe Group IP multicast address
\- Indication whether the UE should use IPv4 or IPv6 for that group
\- For a specific Group configured to operate using IPv4, optionally an IPv4
address to be used by the UE as a source address. If none is provisioned, then
the UE shall use Dynamic Configuration of IPv4 Link-Local Addresses RFC 3927
[18] to obtain a link local address for the Group.
3) Radio parameters when the UE is \"not served by NG-RAN\":
\- Includes the radio parameters NR PC5 with Geographical Area(s) and an
indication of whether they are \"operator managed\" or \"non-operator
managed\". The UE uses the radio parameters to perform ProSe Direct
Communications over PC5 reference point when \"not served by NG-RAN\" only if
the UE can reliably locate itself in the corresponding Geographical Area.
Otherwise, the UE is not authorized to transmit.
NOTE 2: Whether a frequency band is \"operator managed\" or \"non-operator
managed\" in a given Geographical Area is defined by local regulations.
4) Policy/parameters related to privacy:
\- The list of ProSe services (i.e. ProSe identifiers) with Geographical
Area(s) that require privacy support.
\- A privacy timer value indicating the duration after which the UE shall
change each source Layer-2 ID self-assigned by the UE when privacy is
required.
5) Policy/parameters when NR PC5 is selected:
\- The mapping of ProSe services (i.e. ProSe identifiers) to radio frequencies
with Geographical Area(s).
\- The mapping of ProSe services (i.e. ProSe identifiers) to Destination
Layer-2 ID(s) for broadcast.
\- The mapping of ProSe services (i.e. ProSe identifiers) to Destination
Layer-2 ID(s) for groupcast.
\- The mapping of ProSe services (i.e. ProSe identifiers) to default
Destination Layer-2 ID(s) for initial signalling to establish unicast
connection.
NOTE 3: The same default Destination Layer-2 ID for unicast initial signalling
can be mapped to more than one ProSe service. In the case where different
ProSe services are mapped to distinct default Destination Layer-2 IDs, when
the UE intends to establish a single unicast link that can be used for more
than one ProSe service, the UE can select any of the default Destination
Layer-2 IDs to use for the initial signalling.
NOTE 4: Security policies for Unicast mode 5G ProSe Direct Communication can
be provisioned by PCF as defined in TS 33.503 [29].
\- The mapping of ProSe services (i.e. ProSe identifiers) to PC5 QoS
parameters defined in clause 5.6.1 (i.e. PQI and conditionally other
parameters such as MFBR/GFBR, etc.).
\- The mapping of ProSe services (i.e. ProSe identifiers) to the corresponding
NR Tx Profiles for broadcast and groupcast (see TS 38.300 [12] and TS 38.331
[16] for further information).
NOTE 5: A \"catch all\" entry with the lowest priority in each above mapping
can be used for the ProSe services that do not have explicit policy/parameters
mapping above.
\- AS layer configurations (see TS 38.331 [16]), i.e. the mapping of PC5 QoS
profile(s) to radio bearer(s), when the UE is \"not served by NG-RAN\".
\- The PC5 QoS profile contains PC5 QoS parameters described in clause 5.4.2
of TS 23.287 [2], and value for the QoS characteristics regarding Priority
Level, Averaging Window, Maximum Data Burst Volume if default value is not
used as defined in Table 5.4.4-1 of TS 23.287 [2] and in Table 5.6.1-1.
\- For broadcast, groupcast and initial signalling to establish unicast
connection, PC5 DRX configuration (see TS 38.331 [16]), e.g. the mapping of
PC5 QoS profile(s) to PC5 DRX cycle(s), default PC5 DRX configuration, when
the UE is \"not served by NG-RAN\".
6) Path selection policy:
\- The mapping of ProSe services (i.e. ProSe identifiers) to path preference
(i.e. PC5 preferred, Uu preferred, or no preference) as defined in clause
5.11.
NOTE 6: The path selection policy can be a one mapping for all ProSe services,
i.e. same path preference for all ProSe services.
7) Validity time indicating the expiration time of the Policy/Parameter for 5G
ProSe Direct Communication.
The above parameter sets from bullet 2) to 7) may be provided or updated to
the UE by the ProSe Application Server.
#### 5.1.3.2 Principles for applying parameters for 5G ProSe Direct
Communication
For 5G ProSe Direct Communication over PC5 reference point, the operator may
pre-configure the UEs with the required provisioning parameters for 5G ProSe
Direct Communication, without the need for the UEs to connect to the 5GC to
get this initial configuration. The following apply:
\- The provisioning parameters for 5G ProSe Direct Communication could be from
different sources and their priorities are described in clause 5.1.1.
\- The ME provisioning parameters shall not be erased when a USIM is
deselected or replaced.
\- The UE shall use radio resources for 5G ProSe Direct Communication as
follows:
\- While a UE has a serving cell and is camped on a cell and the UE intends to
use for 5G ProSe the radio resources (i.e. carrier frequency) operated by this
cell, then the UE shall use the radio resource description indicated by this
cell the UE is camped on and ignore any radio resource description of the same
radio resource provisioned in the ME or the UICC. If the cell does not provide
radio resources for 5G ProSe, the UE shall not perform ProSe message
transmission and reception on radio resources operated by this cell.
\- If the UE intends to use \"operator-managed\" radio resources (i.e. carrier
frequency) for ProSe that are not operated by the UE\'s serving cell, as
specified in clause 5.1.3.1, or if the UE is out of coverage, the UE shall
search for a cell in any PLMN that is operating the provisioned radio
resources (i.e. carrier frequency) as defined in TS 38.300 [12] and TS 38.304
[13], and:
\- If the UE finds such a cell in the registered PLMN or a PLMN equivalent to
the registered PLMN, and authorization for 5G ProSe Direct Communication to
this PLMN is confirmed, the UE shall use the radio resource description
indicated by that cell. If that cell does not provide radio resources for 5G
ProSe, the UE shall not perform 5G ProSe message transmission and reception on
those radio resources.
\- If the UE finds such a cell but not in the registered PLMN or a PLMN
equivalent to the registered PLMN, and that cell belongs to a PLMN authorized
for 5G ProSe Direct Communications and provides radio resources for 5G ProSe
then the UE shall perform PLMN selection triggered by 5G ProSe Direct
Communication as defined in TS 23.122 [14].
\- If the UE finds such cell but not in a PLMN authorized for 5G ProSe Direct
Communications the UE shall not use 5G ProSe Direct Communication.
\- If the UE does not find any such cell in any PLMN, then the UE shall
consider itself \"not served by NG-RAN\" and use radio resources provisioned
in the ME or the UICC. If no such provision exists in the ME or the UICC or
the provision does not authorize 5G ProSe Direct Communication, then the UE is
not authorized to transmit.
\- The UE is allowed to use \"operator-managed\" radio resources (i.e. carrier
frequency) provisioned in the ME or the UICC for 5G ProSe Direct Communication
if the UICC indicates it is authorized.
\- If the UE intends to use \"non-operator-managed\" radio resources (i.e.
carrier frequency) for 5G ProSe, according to TS 36.331 [15] or TS 38.331 [16]
and as specified in clause 5.1.3.1, then the UE shall perform 5G ProSe Direct
Communication using resource provisioned in the ME or the UICC. If no such
provision exists in the ME or the UICC or the provision does not authorize 5G
ProSe Direct Communications, then the UE is not authorized to transmit.
NOTE 1: It is possible for operators to configure UEs (e.g. Public Safety UEs)
to use only \"operator-managed\" radio resources (i.e. carrier frequency) for
5G ProSe Direct Communication when the UE is \"not served by NG-RAN.
\- The UE provisioning shall support setting Geographical Areas.
NOTE 2: It is possible for a UE to use other radio resources for 5G ProSe
based on the Geographical Area instead of those operated by the serving NG-RAN
cell, when provisioned in the UE, even if the UE\'s serving cell offers normal
service and the SIBs for NR sidelink communication defined in TS 38.331 [16]
indicates that the service (5G ProSe Direct Communication) is available. This
is to cover the scenario when e.g. the radio resources used for 5G ProSe
Direct Communication are not owned by the serving network of the UE.
NOTE 3: When cross-carrier operation is supported, according to TS 36.331 [15]
or TS 38.331 [16], a UE can be instructed by its serving cell to perform 5G
ProSe Direct Communication over a different carrier frequency. The UE is still
considered as \"served by NG-RAN\" in this case.
NOTE 4: The scenario that a cell is detected and the cell does not provide
support for 5G ProSe Direct Communication when the UE attempts to use a
carrier frequency configured for 5G ProSe Direct Communications, is considered
a configuration error. Therefore, the UE does not transmit on that frequency
to avoid interference to the network.
\- The 5G ProSe Direct Communication is only specified for NR.
NOTE 5: It is out of scope of the present specification to define how the UE
can locate itself in a specific Geographical Area. When the UE is in coverage
of a 3GPP RAT, it can for example, use information derived from the serving
PLMN. When the UE is not in coverage of a 3GPP RAT, it can use other
techniques, e.g. Global Navigation Satellite System (GNSS). User provided
location is not a valid input.
### 5.1.4 Authorization and Provisioning for 5G ProSe UE-to-Network Relay
#### 5.1.4.1 Policy/Parameter provisioning for 5G ProSe UE-to-Network Relay
The following information is provisioned in the UE in support of the UE
assuming the role of a 5G ProSe UE-to-Network Relay:
1) Authorisation policy for acting as a 5G ProSe Layer-3 and/or Layer-2 UE-to-
Network Relay when \"served by NG-RAN\":
\- PLMNs in which the UE is authorized to relay traffic for 5G ProSe Layer-3
and/or Layer-2 Remote UEs.
The authorisation for a UE to act as a 5G ProSe UE-to-Network Relay also
authorizes the use of 5G ProSe UE-to-Network Relay Discovery with Model A and
Model B.
NOTE 1: It is up to UE and application implementation to select a discovery
model or whether to perform both models simultaneously.
2) ProSe Relay Discovery policy/parameters for 5G ProSe UE-to-Network Relay:
\- Includes the parameters that enable the UE to perform 5G ProSe UE-to-
Network Relay Discovery when provided by PCF or provisioned in the ME or
configured in the UICC:
\- 5G ProSe UE-to-Network Relay Discovery parameters (User Info ID, Relay
Service Code(s), UE-to-Network Relay Layer Indicator per RSC, optional Control
Plane Security Indicator per RSC). The UE-to-Network Relay Layer Indicator
indicates whether the associated RSC is offering 5G ProSe Layer-2 or Layer-3
UE-to-Network Relay service. If the Control Plane Security Indicator is
provided for a RSC, then the Control Plane based security procedure as
described in clause 5.1.4.3.2 is performed for UE-to-Network Relay
Communication for that RSC, otherwise if it is not provided for a RSC, then
the User Plane based security procedure as described in clause 5.1.4.3.3 is
performed for that RSC.
\- Default Destination Layer-2 ID(s) for sending Relay Discovery Announcement
and Relay Discovery Additional Information messages and receiving Relay
Discovery Solicitation messages;
\- For 5G ProSe Layer-3 UE-to-Network Relay, the PDU Session parameters (PDU
Session type, DNN, SSC Mode, S-NSSAI, Access Type Preference) to be used for
the relayed traffic for each ProSe Relay Service Code;
\- Includes security related content for 5G ProSe UE-to-Network Relay, see TS
33.503 [29].
NOTE 2: 5G ProSe Relay Discovery policy/parameters can be provided from ProSe
Application Server to the 5G ProSe UE-to-Network Relay, except for the
Security parameters in bullet 2).
3) For 5G ProSe Layer-3 UE-to-Network Relay, QoS mapping(s):
\- Each QoS mapping entry includes:
\- a mapping between a 5QI value and a PQI value;
\- a PQI PDB adjustment factor, for the PC5 communication for the 5G ProSe
Layer-3 UE-to-Network Relay operation;
\- optional the Relay Service Code(s) associates with the QoS mapping entry.
4) For 5G ProSe Layer-3 UE-to-Network Relay to relay Ethernet or Unstructured
traffic from 5G ProSe Layer-3 Remote UE by using IP type PDU Session:
\- Mapping of ProSe Service(s) to ProSe Application Server address information
(consisting of IP address/FQDN and transport layer port number).
5) Validity time indicating the expiration time of the Policy/Parameter for 5G
ProSe UE-to-Network Relay discovery and communication.
The following information is provisioned in the UE in support of the UE
assuming the role of a 5G ProSe Remote UE and thereby enabling the use of a 5G
ProSe UE-to-Network Relay:
1) Authorisation policy for using a 5G ProSe Layer-3 and/or Layer-2 UE-to-
Network Relay:
\- For 5G ProSe Layer-3 Remote UE, indicates whether the UE is authorised to
use a 5G ProSe Layer-3 UE-to-Network Relay.
\- For 5G ProSe Layer-2 Remote UE, indicates the PLMNs in which the UE is
authorized to use a 5G ProSe Layer-2 UE-to-Network Relay.
The authorisation for a UE to act as a 5G ProSe Remote UE also authorizes the
use of 5G ProSe UE-to-Network Relay discovery with Model A and Model B.
NOTE 3: It is up to UE and application implementation to select a discovery
model or whether to perform both models simultaneously.
2) Policy/parameters for 5G ProSe UE-to-Network Relay Discovery:
\- Includes the parameters for 5G ProSe Relay Discovery and for enabling the
UE to connect to the 5G ProSe UE-to-Network Relay after discovery when
provided by PCF or provisioned in the ME or configured in the UICC:
\- 5G ProSe UE-to-Network Relay Discovery parameters (User Info ID, Relay
Service Code(s), UE-to-Network Relay Layer indicator per RSC, optional Control
Plane Security Indicator per RSC). The UE-to-Network Relay Layer Indicator
indicates whether the associated RSC is offering 5G ProSe Layer-2 or Layer-3
UE-to-Network Relay service. If the Control Plane Security Indicator is
provided for a RSC, then the Control Plane based security procedures as
described in clause 5.1.4.3.2 is performed for UE-to-Network Relay
Communication for that RSC, otherwise if it is not provided for a RSC, then
the User Plane based security procedures as described in clause 5.1.4.3.3 is
performed for that RSC.
\- Default Destination Layer-2 ID(s) for sending Relay Discovery Solicitation
messages and receiving Relay Discovery Announcement and Relay Discovery
Additional Information messages;
\- For 5G ProSe Layer-3 UE-to-Network Relay, the PDU Session parameters (PDU
Session type, DNN, SSC Mode, S-NSSAI, Access Type Preference) to be used for
the relayed traffic without using N3IWF access, or an indication of N3IWF
access, for each ProSe Relay Service Code;
\- For 5G ProSe Layer-3 UE-to-Network Relay, optionally the ProSe application
Traffic Descriptor(s) (as defined in TS 23.503 [9]) to be used for the relayed
traffic for each ProSe Relay Service Code;
\- Includes security related content for 5G ProSe UE-to-Network Relay, see TS
33.503 [29].
3) Policy/parameters for N3IWF selection for 5G ProSe Layer-3 Remote UE:
\- N3IWF identifier configuration for 5G ProSe Layer-3 Remote UE (either FQDN
or IP address) in the HPLMN.
\- 5G ProSe Layer-3 UE-to-Network Relay access node selection information - a
prioritized list of PLMNs for N3IWF selection. It also indicates if selection
of an N3IWF in a PLMN should be based on Tracking Area Identity FQDN or on
Operator Identifier FQDN.
NOTE 4: 5G ProSe Relay Discovery policy/parameters can be provided from ProSe
Application Server to the 5G ProSe Remote UE, except for the Security
parameters in bullet 2).
4) Validity time indicating the expiration time of the Policy/Parameter for 5G
ProSe UE-to-Network Relay discovery and communication.
The following information is provisioned in the UE in support of the UE
assuming the role of a 5G ProSe UE-to-Network Relay as well as in the UE in
support of the UE assuming the role of a 5G ProSe Remote UE and thereby
enabling the use of a 5G ProSe UE-to-Network Relay:
1) Radio parameters for 5G ProSe UE-to-Network Relay Discovery when the UE is
not \"served by NG-RAN\":
\- Includes the radio parameters NR PC5 with Geographical Area(s) and an
indication of whether they are \"operator managed\" or \"non-operator
managed\". The UE uses the radio parameters to perform 5G ProSe Direct
Discovery over PC5 reference point when \"not served by NG-RAN\" only if the
UE can reliably locate itself in the corresponding Geographical Area.
Otherwise, the UE is not authorized to transmit.
\- Default PC5 DRX configuration (see TS 38.331 [16]).
2) Radio parameters for 5G ProSe UE-to-Network Relay communication when the UE
is not \"served by NG-RAN\":
\- Includes the radio parameters NR PC5 with Geographical Area(s) and an
indication of whether they are \"operator managed\" or \"non-operator
managed\". The UE uses the radio parameters to perform 5G ProSe Direct
Communication over PC5 reference point when \"not served by NG-RAN\" only if
the UE can reliably locate itself in the corresponding Geographical Area.
Otherwise, the UE is not authorized to transmit.
NOTE 5: The validity time of these radio parameters is the same as the
validity time of the Policy/Parameter listed above for 5G ProSe UE-to-Network
Relay or 5G ProSe Remote UE.
3) Policy/parameters related to privacy:
\- A privacy timer value indicating the duration after which the UE shall
change each source Layer-2 ID self-assigned by the UE when privacy is
required.
#### 5.1.4.2 Principles for applying parameters for 5G ProSe UE-to-Network
Relay
##### 5.1.4.2.1 Principles for applying parameters for ProSe UE-to-Network
Relay discovery
For 5G ProSe UE-to-Network Relay discovery over PC5 reference point, the
operator may pre-configure the UEs with the required provisioning parameters
for 5G ProSe UE-to-Network Relay discovery, without the need for the UEs to
connect to the 5GC to get this initial configuration. The following applies:
\- The provisioning parameters for 5G ProSe UE-to-Network Relay discovery
could be from different sources and their priorities are described in clause
5.1.1.
\- The ME provisioning parameters shall not be erased when a USIM is
deselected or replaced.
The UE shall use radio resources for 5G ProSe UE-to-Network Relay discovery as
follows:
\- While a UE has a serving cell and is camped on a cell and the UE intends to
use for 5G ProSe UE-to-Network Relay discovery the radio resources (i.e.
carrier frequency) operated by this cell, then the UE shall use the radio
resource description indicated by this cell the UE is camped on and ignore any
radio resource description of the same radio resource provisioned in the ME or
the UICC. If the cell does not provide radio resources for 5G ProSe UE-to-
Network Relay discovery, the UE shall not perform 5G ProSe UE-to-Network Relay
discovery message transmission and reception on radio resources operated by
this cell;
\- If the UE intends to use \"operator-managed\" radio resources (i.e. carrier
frequency) for 5G ProSe UE-to-Network Relay discovery that are not operated by
the UE\'s serving cell, as specified in clause 5.1.4.1, or if the UE is out of
coverage, the UE shall search for a cell in any PLMN that is operating the
provisioned radio resources (i.e. carrier frequency) as defined in TS 38.300
[12] and TS 38.304 [13]; and:
\- If the UE finds such a cell in the registered PLMN or a PLMN equivalent to
the registered PLMN, and authorization for 5G ProSe UE-to-Network Relay
discovery to this PLMN is confirmed, the UE shall use the radio resource
description indicated by that cell. If that cell does not provide radio
resources for 5G ProSe UE-to-Network Relay discovery, the UE shall not perform
5G ProSe UE-to-Network Relay discovery message transmission and reception on
those radio resources;
\- If the UE finds such a cell but not in the registered PLMN or a PLMN
equivalent to the registered PLMN, and that cell belongs to a PLMN authorized
for 5G ProSe UE-to-Network Relay discovery and provides radio resources for 5G
ProSe UE-to-Network Relay discovery then the UE shall perform PLMN selection
triggered by 5G ProSe UE-to-Network Relay discovery as defined in TS 23.122
[14];
\- If the UE finds such cell but not in a PLMN authorized for 5G ProSe UE-to-
Network Relay discovery the UE shall not use 5G ProSe UE-to-Network Relay
discovery;
\- If the UE does not find any such cell in any PLMN, then the UE shall
consider itself \"not served by NG-RAN\" and use radio resources provisioned
in the ME or the UICC. If no such provision exists in the ME or the UICC or
the provision does not authorize 5G ProSe UE-to-Network Relay discovery, then
the UE is not authorized to transmit;
\- The UE is allowed to use \"operator-managed\" radio resources (i.e. carrier
frequency) provisioned in the ME or the UICC for 5G ProSe UE-to-Network Relay
discovery if the UICC indicates it is authorized;
\- If the UE intends to use \"non-operator-managed\" radio resources (i.e.
carrier frequency) for ProSe UE-to-Network Relay discovery, according to TS
38.331 [16] and as specified in clause 5.1.4.1, then the UE shall perform 5G
ProSe UE-to-Network Relay discovery using resource provisioned in the ME or
the UICC. If no such provision exists in the ME or the UICC or the provision
does not authorize 5G ProSe UE-to-Network Relay discovery, then the UE is not
authorized to transmit;
NOTE 1: It is possible for operators to configure UEs (e.g. Public Safety UEs)
to use only \"operator-managed\" radio resources (i.e. carrier frequency) for
5G ProSe UE-to-Network Relay discovery when the UE is \"not served by NG-
RAN\".
\- The UE provisioning shall support setting Geographical Areas;
NOTE 2: It is possible for a UE to use other radio resources for 5G ProSe UE-
to-Network Relay discovery based on the Geographical Area instead of those
operated by the serving NG-RAN cell, when provisioned in the UE, even if the
UE\'s serving cell offers normal service and the SIBs for NR sidelink
communication defined in TS 38.331 [16] indicates that the service (5G ProSe
UE-to-Network Relay discovery) is available. This is to cover the scenario
when e.g. the radio resources used for 5G ProSe UE-to-Network Relay discovery
are not owned by the serving network of the UE.
NOTE 3: When cross-carrier operation is supported, according to TS 38.331
[16], a UE can be instructed by its serving cell to perform 5G ProSe UE-to-
Network Relay discovery over a different carrier frequency. The UE is still
considered as \"served by NG-RAN\" in this case.
NOTE 4: The scenario that a cell is detected and the cell does not provide
support for 5G ProSe UE-to-Network Relay discovery when the UE attempts to use
a carrier frequency configured for 5G ProSe UE-to-Network Relay discovery, is
considered a configuration error. Therefore, the UE does not transmit on that
frequency to avoid interference to the network.
\- The 5G ProSe UE-to-Network Relay discovery is only specified for NR.
##### 5.1.4.2.2 Principles for applying parameters for 5G ProSe UE-to-Network
Relay communication
For 5G ProSe UE-to-Network Relay communication over PC5 reference point, the
operator may pre-configure the UEs with the required provisioning parameters
for 5G ProSe UE-to-Network Relay communication, without the need for the UEs
to connect to the 5GC to get this initial configuration. The following
applies:
\- The provisioning parameters for 5G ProSe UE-to-Network Relay communication
could be from different sources and their priorities are described in clause
5.1.1.
\- The ME provisioning parameters shall not be erased when a USIM is
deselected or replaced.
The UE shall use radio resources for 5G ProSe UE-to-Network Relay
communication as follows:
\- While a UE has a serving cell and is camped on a cell and the UE intends to
use for 5G ProSe UE-to-Network Relay communication the radio resources (i.e.
carrier frequency) operated by this cell, then the UE shall use the radio
resource description indicated by this cell the UE is camped on and ignore any
radio resource description of the same radio resource provisioned in the ME or
the UICC. If the cell does not provide radio resources for 5G ProSe UE-to-
Network Relay communication, the UE shall not perform 5G ProSe UE-to-Network
Relay communication message transmission and reception on radio resources
operated by this cell;
\- If the UE intends to use \"operator-managed\" radio resources (i.e. carrier
frequency) for 5G ProSe UE-to-Network Relay communication that are not
operated by the UE\'s serving cell, as specified in clause 5.1.4.1, or if the
UE is out of coverage, the UE shall search for a cell in any PLMN that is
operating the provisioned radio resources (i.e. carrier frequency) as defined
in TS 38.300 [12] and TS 38.304 [13]; and:
\- If the UE finds such a cell in the registered PLMN or a PLMN equivalent to
the registered PLMN, and authorization for 5G ProSe UE-to-Network Relay
communication to this PLMN is confirmed, the UE shall use the radio resource
description indicated by that cell. If that cell does not provide radio
resources for 5G ProSe UE-to-Network Relay communication, the UE shall not
perform 5G ProSe UE-to-Network Relay communication message transmission and
reception on those radio resources;
\- If the UE finds such a cell but not in the registered PLMN or a PLMN
equivalent to the registered PLMN, and that cell belongs to a PLMN authorized
for 5G ProSe UE-to-Network Relay communication and provides radio resources
for 5G ProSe UE-to-Network Relay communication then the UE shall perform PLMN
selection triggered by 5G ProSe UE-to-Network Relay communication as defined
in TS 23.122 [14];
\- If the UE finds such cell but not in a PLMN authorized for 5G ProSe UE-to-
Network Relay communication the UE shall not use 5G ProSe UE-to-Network Relay
communication;
\- If the UE does not find any such cell in any PLMN, then the UE shall
consider itself \"not served by NG-RAN\" and use radio resources provisioned
in the ME or the UICC. If no such provision exists in the ME or the UICC or
the provision does not authorize 5G ProSe UE-to-Network Relay communication,
then the UE is not authorized to transmit;
\- The UE is allowed to use \"operator-managed\" radio resources (i.e. carrier
frequency) provisioned in the ME or the UICC for 5G ProSe UE-to-Network Relay
communication if the UICC indicates it is authorized;
\- If the UE intends to use \"non-operator-managed\" radio resources (i.e.
carrier frequency) for 5G ProSe UE-to-Network Relay communication, according
to TS 38.331 [16] and as specified in clause 5.1.4.1, then the UE shall
perform 5G ProSe UE-to-Network Relay communication using resource provisioned
in the ME or the UICC. If no such provision exists in the ME or the UICC or
the provision does not authorize 5G ProSe UE-to-Network Relay communication,
then the UE is not authorized to transmit;
NOTE 1: It is possible for operators to configure UEs (e.g. Public Safety UEs)
to use only \"operator-managed\" radio resources (i.e. carrier frequency) for
5G ProSe UE-to-Network Relay communication when the UE is \"not served by NG-
RAN\".
\- The UE provisioning shall support setting Geographical Areas;
NOTE 2: It is possible for a UE to use other radio resources for 5G ProSe UE-
to-Network Relay communication based on the Geographical Area instead of those
operated by the serving NG-RAN cell, when provisioned in the UE, even if the
UE\'s serving cell offers normal service and the SIBs for NR sidelink
communication defined in TS 38.331 [16] indicates that the service (5G ProSe
UE-to-Network Relay communication) is available. This is to cover the scenario
when e.g. the radio resources used for 5G ProSe UE-to-Network Relay
communication are not owned by the serving network of the UE.
NOTE 3: When cross-carrier operation is supported, according to TS 38.331
[16], a UE can be instructed by its serving cell to perform 5G ProSe UE-to-
Network Relay communication over a different carrier frequency. The UE is
still considered as \"served by NG-RAN\" in this case.
NOTE 4: The scenario that a cell is detected and the cell does not provide
support for 5G ProSe UE-to-Network Relay communication when the UE attempts to
use a carrier frequency configured for 5G ProSe UE-to-Network Relay
communication, is considered a configuration error. Therefore, the UE does not
transmit on that frequency to avoid interference to the network.
\- The 5G ProSe UE-to-Network Relay communication is only specified for NR.
#### 5.1.4.3 Network controlled security procedures for 5G ProSe UE-to-Network
Relay
##### 5.1.4.3.1 General
Security procedures over Control Plane and User Plane are specified for 5G
ProSe UE-to-Network relaying in TS 33.503 [29].
##### 5.1.4.3.2 Control Plane based security procedures for 5G ProSe UE-to-
Network Relay
Control Plane-based security procedures for 5G ProSe UE-to-Network Relay call
flow and procedure are defined in TS 33.503 [29], characterised by the
following principles:
\- 5G ProSe UE-to-Network Relay\'s NAS signalling is used for the control
plane based security procedure to authenticate and authorize a 5G ProSe Remote
UE.
\- A UE assuming the role of 5G ProSe UE-to-Network Relay can be configured to
use a set of slices supporting Control Plane based security procedure. An AMF
supporting Control Plane based security procedure for a 5G ProSe UE-to-Network
Relay is selected as part of the slice. The 5G ProSe UE-to-Network Relay shall
include in discovery messages the RSCs with the Control Plane Security
Indicator set, as specified in clause 5.1.4.1, when the requested slice(s)
corresponds to Control Plane based security procedure is(are) accepted. In
addition, the 5G ProSe UE-to-Network Relay shall includes in discovery
messages the RSCs without Control Plane Security Indicator as specified in
clause 5.1.4.1.
\- A 5G ProSe-enabled UE shall use Control Plane based security procedures if
a RSC with Control Plane Security Indicator set is used by the Remote UE to
establish the connection. Otherwise, if a RSC without Control Plane Security
Indicator is used by the Remote UE to establish the connection, the 5G ProSe-
enabled UEs shall use User Plane based security procedures as specified in
clause 5.1.4.3.3.
\- The AMF serving the 5G ProSe UE-to-Network Relay selects AUSF as specified
in clause 6.3.4 of TS 23.501 [4] using the identification information the 5G
ProSe Remote UE provided as specified in clause 6.3.3.3.2 of TS 33.503 [29].
\- If the 5G ProSe Remote UE is configured by HPLMN to use control plane
security procedure, the 5G ProSe Remote UE\'s HPLMN AUSF shall support control
plane based security procedure.
\- If a network intends to use control plane security procedure then all the
AMFs or the all AMFs within the network slices that the 5G ProSe UE-to-Network
Relay uses shall support the control plane based security procedures.
NOTE: If the control plane security procedure is not supported, then the 5G
ProSe Remote UE can select another 5G ProSe UE-to-Network Relay or user plane
based security can be used.
##### 5.1.4.3.3 User Plane based security procedures
User Plane-based security procedures for 5G ProSe UE-to-Network Relay are
defined in TS 33.503 [29].
## 5.2 5G ProSe Direct Discovery
### 5.2.1 General
5G ProSe Direct Discovery is defined as the process that detects and
identifies another UE in proximity via NR PC5 reference point. As defined in
clause 5.3.3.1 in TS 23.303 [3], 5G ProSe Direct Discovery can be open or
restricted; it can be standalone or used for subsequent actions e.g. to
initiate 5G ProSe Direct Communication.
In the case of inter-PLMN ProSe discovery and communication over PC5 reference
point, the PC5 parameters need to be configured in a consistent way among the
UEs within a certain region. The architecture for the Inter-PLMN PC5 case is
defined in clause 4.2.3.
The UEs may use the PC5 DRX mechanism to perform 5G ProSe Direct Discovery and
5G ProSe UE-to-Network Relay Discovery over PC5 reference point as specified
in clause 5.13.
### 5.2.2 5G ProSe Direct Discovery Models
There are two models for 5G ProSe Direct Discovery: Model A and Model B which
are defined in clause 5.3.1.2 in TS 23.303 [3].
### 5.2.3 5G ProSe UE-to-Network Relay Discovery
For 5G ProSe UE-to-Network Relay discovery, both Model A and Model B discovery
are supported:
\- Model A uses a single discovery protocol message (Announcement).
\- Model B uses two discovery protocol messages (Solicitation and Response).
For Relay Discovery Additional Information, only Model A discovery is used.
The procedures for 5G ProSe UE-to-Network Relay discovery are defined in
clause 6.3.2.3.
### 5.2.4 5G ProSe Direct Discovery Characteristics
5G ProSe Direct Discovery over the PC5 reference point has the following
characteristics:
\- PC5 communication channel is used to carry the discovery message over PC5.
The discovery message over PC5 is differentiated with other PC5 messages by AS
layer.
\- ProSe layer shall indicate to AS layer whether the signalling is discovery
message or PC5-S signalling.
NOTE 1: The discovery message format is defined in stage 3.
Group discovery/management to support on demand-based group communication for
commercial services has the following characteristics:
\- The group discovery/formation/management can be carried out in the
Application layer in coordination with the Application Server.
\- Application layer signalling between the UE and the Application Server is
out of scope of this specification.
5G ProSe Direct Discovery with 5G DDNMF has the following characteristics:
\- 5G DDNMF in the 5GS is used for 5G ProSe Discovery Direct Code management
(including allocation and resolution). The 5G DDNMF gets the PDUID from the
PCF and subscribes to notifications on Change of PDUID.
\- 5G DDNMF is defined in clause 4.3.2 and the detail procedure for 5G ProSe
Direct Discovery with 5G DDNMF is defined in clause 6.3.
Group discovery/management to support public safety has the following
characteristics:
\- Pre-configured or provisioned information can be used for the 5G ProSe
Direct Discovery procedure as defined in clause 5.1.2.
The information elements included in the 5G ProSe Direct Discovery messages
are described in clause 5.8.1 and clause 6.3.2.
NOTE 2: Based on UE implementation, the application layer discovery messages
are exchanged either as user traffic over PC5 or alternatively as part of
metadata in PC5 Direct Discovery message as specified in clause 6.3.2.1 and
clause 6.4.2. In the latter case, the PC5 Direct Discovery message can contain
additional field carrying application layer metadata information, e.g., the
Application layer discovery messages for group discovery. The format and
contents of this additional field is out of scope of 3GPP. Performance of the
PC5 Direct Discovery message including the application layer information will
be affected if the resulted PC5 Direct Discovery message size is too big, e.g.
longer delay and lower reliability.
## 5.3 5G ProSe Direct Communication
### 5.3.1 General
5G ProSe Direct Communication over PC5 reference point is supported when the
UE is \"served by NG-RAN\" or when the UE is \"not served by NG-RAN\". A UE is
authorized to perform 5G ProSe Direct Communication when it has valid
authorization and configuration as specified in clause 5.1.3. 5G ProSe Direct
Communication supports both the cases of public safety and commercial service.
5G ProSe Direct Communication over NR based PC5 reference point supports
broadcast mode, groupcast mode, and unicast mode.
For broadcast and groupcast mode 5G ProSe Direct Communication, the following
data unit types are supported: IPv4, IPv6, Ethernet, Unstructured, and Address
Resolution Protocol (see RFC 826 [19]).
For unicast mode 5G ProSe Direct Communication, the following data unit types
are supported: IPv4, IPv6, Ethernet, and Unstructured.
The identifiers used in the 5G ProSe Direct Communication over PC5 reference
point are described in clause 5.8.2.
The QoS handling and procedures for the 5G ProSe Direct Communication over PC5
reference point are defined in clauses 5.6 and 6.4.
The UEs may use the PC5 DRX mechanism to perform 5G ProSe Direct Communication
over PC5 reference point as specified in clause 5.13.
### 5.3.2 Broadcast mode 5G ProSe Direct Communication
Broadcast mode of 5G ProSe direct communication is supported over NR based PC5
reference point. The transmitting UE in broadcast communication determines the
destination Layer-2 ID for broadcast as specified in clause 5.8.2 and assigns
itself a source Layer-2 ID. The receiving UE determines the destination
Layer-2 ID for broadcast reception as specified in clause 5.8.2. The
transmitting UE determines the PC5 QoS parameters for this broadcast as
specified in clause 5.6.1. The transmitting UE sends the service data using
the source Layer-2 ID and the destination Layer-2 ID.
For IP type 5G ProSe direct communication over PC5 reference point, the
mechanism for IP address allocation is described in clause 5.5.1.2.
### 5.3.3 Groupcast mode 5G ProSe Direct Communication
Groupcast mode of 5G ProSe direct communication is supported over NR based PC5
reference point. Group management is carried out by the application layer in
coordination with Application Server and is out of scope of this
specification. For commercial services, the Application Layer Group ID is
provided by Application Server; and for public safety services, the pre-
configured or provisioned Application Layer Group ID will be used for
groupcast communication. The group size and member ID information could be
used for groupcast control if it is provided by the application layer.
The transmitting UE in groupcast communication determines a source Layer-2 ID
and a destination Layer-2 ID and the receiving UE determines destination
Layer-2 ID, as specified in clause 5.8.2. The transmitting UE determines the
PC5 QoS parameters for this groupcast as specified in clause 5.6.1. The
transmitting UE sends the service data using the source Layer-2 ID and the
destination Layer-2 ID.
For IP type 5G ProSe direct communication over PC5 reference point, the
mechanism for IP address allocation is described in clause 5.5.1.2.
### 5.3.4 Unicast mode 5G ProSe Direct Communication
Unicast mode of 5G ProSe direct communication is supported over NR based PC5
reference point. A PC5 unicast link between two UEs is established for the 5G
ProSe direct communication; and the PC5 unicast link could be maintained,
modified, and released according to the application layer requests or
communication requirements.
For the PC5 unicast link of the 5G ProSe direct communication, the principal
for the PC5 unicast link of V2X communication described in TS 23.287 [2]
clause 5.2.1.4 is reused with the following differences:
\- V2X service is replaced by ProSe Application;
\- V2X service type is replaced by ProSe identifier;
\- New data unit types are supported (including IPv4, Ethernet and
Unstructured).
For IP type 5G ProSe direct communication over PC5 reference point, the
mechanism for IP address/prefix allocation is described in clause 5.5.1.1. The
PC5 QoS handling for the unicast mode 5G ProSe direct communication is
specified in clause 5.6.1.
## 5.4 5G ProSe UE-to-Network Relay
### 5.4.1 5G ProSe Layer-3 UE-to-Network Relay
#### 5.4.1.1 General
The 5G ProSe Layer-3 UE-to-Network Relay shall provide generic function that
can relay any IP, Ethernet or Unstructured traffic:
\- For IP traffic over PC5 reference point, the 5G ProSe Layer-3 UE-to-Network
Relay uses IP type PDU Session towards 5GC.
\- For Ethernet traffic over PC5 reference point, the 5G ProSe Layer-3 UE-to-
Network Relay can use Ethernet type PDU Session or IP type PDU Session towards
5GC.
\- For Unstructured traffic over PC5 reference point, the 5G ProSe Layer-3 UE-
to-Network Relay can use Unstructured type PDU Session or IP type PDU Session
(i.e. IP encapsulation/de-capsulation by 5G ProSe Layer-3 UE-to-Network Relay)
towards 5GC.
The type of traffic supported over PC5 reference point is indicated by the 5G
ProSe Layer-3 UE-to-Network Relay e.g. using the corresponding RSC. The 5G
ProSe Layer-3 UE-to-Network Relay determines the PDU Session Type based on
configuration of the mapping between PDU Session parameters and RSC, as
specified in clause 5.1.4.1.
IP type PDU Session and Ethernet type PDU Session can be used to support more
than one 5G ProSe Layer-3 Remote UEs while Unstructured type PDU Session can
be used to support only one 5G ProSe Layer-3 Remote UE.
NOTE: The maximum number of PDU Sessions can affect the maximum number of 5G
ProSe Layer-3 Remote UEs that the 5G ProSe UE-to-Network Relay can support.
The 5G ProSe Layer-3 UE-to-Network Relay provides the functionality to support
indirect connectivity to the 5GS for 5G ProSe Layer-3 Remote UEs. A 5G ProSe
Layer-3 Remote UE can be located within NG-RAN coverage or outside of NG-RAN
coverage.
The 5G ProSe Layer-3 Remote UE and 5G ProSe Layer-3 UE-to-Network Relay may
use the PC5 DRX mechanism to perform 5G ProSe UE-to-Network Relay
Communications over PC5 reference point as specified in clause 5.13.
#### 5.4.1.2 5G ProSe Layer-3 UE-to-Network Relay with N3IWF support
To support 5G ProSe Layer-3 Remote UE services with end-to-end confidentiality
and IP address preservation requirements, the 5G ProSe Layer-3 UE-to-Network
Relay with N3IWF shall provide access to the 5GC for the 5G ProSe Layer-3
Remote UE via N3IWF using the features defined in clause 4.2.8 of TS 23.501
[4].
5G ProSe Layer-3 UE-to-Network Relay is provisioned with RSC(s) and the
corresponding PDU session parameters (e.g. S-NSSAI) to support N3IWF access as
part of 5G ProSe Layer-3 UE-to-Network Relay Policy/parameters. When a 5G
ProSe Layer-3 Remote UE connects with the corresponding RSC, the 5G ProSe
Layer-3 UE-to-Network Relay determines the corresponding PDU session
parameters based on the requested RSC.
NOTE: The 5G ProSe Layer-3 UE-to-Network Relay only includes a RSC in
discovery message when the corresponding PDU session parameters (e.g. S-NSSAI)
are authorized to be used in the accessed network.
The 5G ProSe Layer-3 Remote UE selects N3IWF as specified in clause 6.5.1.2.2.
The selection of N3IWF follows the regulatory rules of the country where it is
located, and when required by the regulations the 5G ProSe Layer-3 Remote UE
only selects a N3IWF within the local country. QoS differentiation can be
provided on per-IPsec Child Security Association basis and the details are
provided in clause 5.6.2.2.
The 5GC to which the 5G ProSe Layer-3 UE-to-Network Relay registers and the
5GC to which the 5G ProSe Layer-3 Remote UE registers may be in the same PLMN
or different PLMN.
#### 5.4.1.3 Policy control and session binding to support 5G ProSe Layer-3
UE-to-Network Relay without N3IWF
To enable support for policy control for 5G ProSe Layer-3 Remote UEs accessing
5GC via a 5G ProSe Layer-3 UE-to-Network Relay without involving N3IWF, the
policy control functionality specified in TS 23.503 [9] is applied with the
following functionalities:
\- The 5G ProSe Layer-3 UE-to-Network Relay, the SMF and PCF shall be
configured with DNN(s) dedicated for UE-to-Network Relay connectivity, as
specified in clause 5.1.4.1.
NOTE 1: If Local Breakout configuration is supported for relay connectivity,
the dedicated DNN needs to be well-known DNN to allow seamless operation
across various operators\' networks.
\- The AF discovers the PCF serving the 5G ProSe Layer-3 UE-to-Network Relay
PDU Session as specified in clause 6.1.1.2 of TS 23.503 [9].
\- The PCF may validate any 5G ProSe Layer-3 Remote UE related service
information from the AF based on roaming agreement and the dedicated DNN for
UE-to-Network Relay functionality.
NOTE 2: For 5G ProSe Layer-3 UE-to-Network Relay connectivity, the UE identity
that the SMF has provided (i.e. 5G ProSe Layer-3 UE-to-Network Relay Identity)
and a UE identity provided by the AF (i.e. 5G ProSe Layer-3 Remote UE
Identity) can be different, while the Session binding with the PDU Session is
valid.
\- The 5G ProSe Layer-3 Remote UEs may be assigned a /64 IPv6 Prefix from a
shorter IPv6 prefix by the 5G ProSe Layer-3 UE-to-Network Relay.
\- For a PDU Session to the dedicated DNN for 5G ProSe Layer-3 UE-to-Network
Relay connectivity and using IPv6 prefix delegation (i.e. the assigned IPv6
network prefix is shorter than 64), the PCF shall perform session binding
based on the IPv6 network prefix only. A successful session binding occurs
whenever a longer prefix received from an AF matches the prefix value of the
PDU Session. PCF shall not use the UE Identity for session binding for this
PDU Session.
NOTE 3: Support for policy control of 5G ProSe Layer-3 Remote UEs behind a 5G
ProSe Layer-3 UE-Network Relay without N3IWF using IPv4 is not available.
### 5.4.2 5G ProSe Layer-2 UE-to-Network Relay
The 5G ProSe Layer-2 UE-to-Network Relay provides forwarding functionality
that can relay any type of traffic over the PC5 link.
The 5G ProSe Layer-2 UE-to-Network Relay provides the functionality to support
connectivity to the 5GS for 5G ProSe Layer-2 Remote UEs. A UE is considered to
be a 5G ProSe Layer-2 Remote UE if it has successfully established a PC5 link
to the 5G ProSe Layer-2 UE-to-Network Relay. A 5G ProSe Layer-2 Remote UE can
be located within NG-RAN coverage or outside of NG-RAN coverage.
For PLMN selection and relay selection in the 5G ProSe Layer-2 Remote UE:
\- The 5G ProSe Layer-2 Remote UE checks whether the PLMN(s) within the RRC
Container (see clause 5.8.3.3) obtained from the 5G ProSe Layer-2 UE-to-
Network Relay(s) during 5G ProSe UE-to-Network Relay Discovery in clause
6.3.2.3 are authorized to be connected to via a 5G ProSe Layer-2 UE-to-Network
Relay(s), and only the authorized PLMN(s) are then available PLMNs for NAS
PLMN selection;
\- The 5G ProSe Layer-2 Remote UE selects the 5G ProSe Layer-2 UE-to-Network
Relay considering the selected PLMN by NAS layer.
The 5G ProSe Layer-2 Remote UE and 5G ProSe Layer-2 UE-to-Network Relay may
use the PC5 DRX mechanism to perform 5G ProSe UE-to-Network Relay
Communications over PC5 reference point as specified in clause 5.13.
### 5.4.3 Mobility Restrictions for 5G ProSe UE-to-Network Relaying
The handling of Mobility Restrictions for 5G ProSe enabled UE follows the
principles as specified in clause 5.3.4.1 of TS 23.501 [4] with the following
additions and clarifications:
\- Forbidden Area:
\- In a Forbidden Area, a 5G ProSe enabled UE is not allowed to perform the
Relay operation. If the 5G ProSe UE-to-Network Relay operates in a Forbidden
Area of the 5G ProSe Remote UE, the 5G ProSe Remote UE is not allowed to
access the network via this 5G ProSe UE-to-Network Relay.
\- Service Area Restriction:
\- Service Area Restriction is not applicable to 5G ProSe Layer-3 Remote UE.
\- Service Area Restriction is not applicable to 5G ProSe enabled MCX-
subscribed UEs as defined in clause 5.3.4.1 of TS 23.501 [4].
NOTE 1: It is expected that all 5G ProSe enabled Public Safety UEs are MCX-
subscribed as defined in clause 5.16.6 of TS 23.501 [4].
\- In a Non-Allowed Area, a 5G ProSe enabled UE follows the principles of a UE
in limited service state as specified in clause 5.9. It cannot perform the
Relay operation as 5G ProSe Layer-2 UE-to-Network Relay or 5G ProSe Layer-3
UE-to-Network Relay based on the conditions described in clause 5.9.
\- In a Non-Allowed Area, a 5G ProSe Layer-2 Remote UE follows the principles
as specified in clause 5.3.4.1 of TS 23.501 [4], for communication with the
network via the 5G ProSe Layer-2 UE-to-Network Relay.
\- Core Network type restriction, RAT type restriction:
In these cases, a 5G ProSe enabled UE is not able to register in the network
and stays in limited service state, and the principles in clause 5.9 shall
apply.
NOTE 2: Closed Access Group information is not specified for 5G ProSe.
NOTE 3: Principles of operation for emergency services (incl. exceptions from
mobility restrictions) are not specified in Rel-17.
## 5.5 IP address allocation
### 5.5.1 General
#### 5.5.1.1 IP address allocation for unicast mode of 5G ProSe direct
communication
For unicast mode of 5G ProSe direct communication, the following mechanism for
IP address/prefix allocation may be used:
a) DHCP-based IPv4 address allocation with one of the two UEs acting as a DHCP
server.
b) IPv6 Stateless Address auto configuration specified in RFC 4862 [17] for
assignment of IPv6 prefix, with one of the two UEs acting as IPv6 default
router.
NOTE: Which UE acts as a DHCPv4 server or IPv6 default router is negotiated
during secure layer-2 link establishment by exchanging the IP Address
Configuration as described in clause 6.4.3.
c) IPv6 link-local addresses as defined in RFC 4862 [17] are formed by UEs
locally. The IPv6 link-local addresses are exchanged during the establishment
of a secure layer-2 link over PC5. The UEs shall disable duplicate address
detection after the layer-2 link is established.
#### 5.5.1.2 IP address allocation for broadcast and groupcast modes of 5G
ProSe direct communication
For broadcast and groupcast modes of 5G ProSe direct communication, the
following source IP address management applies:
a) the UE configures a link local IPv4 address to be used as the source IP
address, as defined in clause 4.5.3 of TS 23.303 [3]. If it is not configured
with an address, it uses Dynamic Configuration of IPv4 Link-Local Addresses
RFC 3927 [18].
b) the UE configures a link local IPv6 address to be used as the source IP
address, as defined in clause 4.5.3 of TS 23.303 [3]. The UE may use this IP
address for direct communication without sending Neighbour Solicitation and
Neighbour Advertisement message for Duplicate Address Detection.
NOTE: The destination IP address management for broadcast and groupcast modes
of ProSe direct communication is left to UE implementation.
#### 5.5.1.3 IP address allocation for communication with a 5G ProSe Layer-3
ProSe UE-to-Network Relay
For communication with a 5G ProSe Layer-3 UE-to-Network Relay, the following
mechanism for IP address/prefix allocation applies:
\- The PDU Session Type used for the relay traffic shall support the IP
version used by the 5G ProSe Layer-3 Remote UE. If the 5G ProSe Layer-3 Remote
UE initiates an allocation of IPv4 address or an IPv6 prefix when the
requested IP version is not supported in the corresponding PDU Session then IP
address/prefix allocation fails.
a) When the 5G ProSe Layer-3 Remote UE uses IPv4 to access the external DN:
a1) The IPv4 address allocation and IPv4 parameter configuration via DHCPv4
are performed according to RFC 2131 [24] and RFC 4039 [25] procedures. The
IPv4 address provided to the 5G ProSe Layer-3 Remote UE from the 5G ProSe
Layer-3 UE-to-Network Relay by DHCPv4 procedure shall correspond to a local
IPv4 address range configured in the 5G ProSe Layer-3 UE-to-Network Relay.
a2) The DHCPv4 request from the 5G ProSe Layer-3 Remote UE is always sent
subsequent to the establishment of the one-to-one 5G ProSe Direct
Communication between the 5G ProSe Layer-3 Remote UE and the 5G ProSe Layer-3
UE-to-Network Relay, see details for the IPv4 address allocation in clause
5.4.4.3 of TS 23.303 [3] with the following difference:
\- The ProSe Relay UE ID of the ProSe UE-to-Network Relay is replaced by the
source Layer-2 ID of the 5G ProSe UE-to-Network Relay for PC5 unicast
communication.
b) When the 5G ProSe Layer-3 Remote UE uses IPv6 to access the external DN:
b1) IPv6 network prefix allocation via IPv6 Stateless Address auto-
configuration. Router solicitation from the 5G ProSe Layer-3 Remote UE is
always sent subsequent to the establishment of the one-to-one ProSe Direct
Communication between the 5G ProSe Layer-3 Remote UE and the 5G ProSe Layer-3
UE-to-Network Relay, see details for IPv6 prefix allocation in clause 5.4.4.2
of TS 23.303 [3] with the following differences:
\- The 5G ProSe Layer-3 UE-to-Network Relay shall obtain the IPv6 prefix
assigned to the 5G ProSe Layer-3 Remote UE via prefix delegation function from
the network as defined in clause 5.5.2.
\- The ProSe Relay UE ID of the ProSe UE-to-Network Relay is replaced by the
source Layer-2 ID of the 5G ProSe UE-to-Network Relay for PC5 unicast
communication.
\- PDN connection is replaced by PDU Session.
b2) IPv6 parameter configuration via Stateless DHCPv6: The UE may use
stateless DHCPv6 for additional parameter configuration.
b3) The 5G ProSe Layer-3 UE-to-Network Relay assigns IPv6 prefixes from IPv6
prefix range that have been assigned to the PDU Session used for the relay
traffic via IPv6 prefix delegation.
### 5.5.2 IPv6 Prefix Delegation via DHCPv6 for 5G ProSe Layer-3 UE-to-Network
Relay
Optionally a single network prefix shorter than the default /64 prefix may be
assigned to a PDU Session. In this case, the /64 default prefix used for IPv6
stateless autoconfiguration will be allocated from this network prefix; the
remaining address space from the network prefix can be delegated to the PDU
Session using prefix delegation after the PDU Session establishment and IPv6
prefix allocation via IPv6 stateless address autoconfiguration as defined in
clause 5.8.2.2.3 of TS 23.501 [4]. When PLMN based parameter configuration is
used, the SMF provides the requested IPv6 prefix from a locally provisioned
pool. When external DN based IPv6 prefix allocation is used, the SMF obtains
the prefix from the external DN.
NOTE: Allocation of IPv6 prefixes with flexible prefix length can leverage
e.g. local configuration on the SMF or interaction with the AAA server.
The address space provided is maintained as an IPv6 address space pool
available to the PDU Session for DHCPv6 IPv6 prefix requests with the
exclusion of the IPv6 prefix that is allocated to the PDU Session during PDU
Session establishment as defined in clause 5.8.2.2.3 of TS 23.501 [4]. The
total IPv6 address space available for the PDU Session (UE PDU Session prefix
and UE PDU Session IPv6 address space pool) shall be possible to aggregate
into one IPv6 prefix that will represent all IPv6 addresses that the UE may
use. If the UE had indicated that it supports prefix exclusion and the prefix
to be delegated to the UE includes the /64 prefix that was allocated to the
PDU Session, the SMF shall utilise the prefix exclusion feature as specified
for DHCPv6 Prefix Delegation in RFC 6603 [26].
The UE uses DHCPv6 to request additional IPv6 prefixes (i.e. prefixes in
addition to the default prefix) from the SMF after completing stateless IPv6
address autoconfiguration procedures. The UE acts as a \"Requesting Router\"
as described in RFC 8415 [27] and inserts one or more IA_PD option(s) into a
DHCPv6 Solicit message sent from the UE to the SMF. The SMF acts as the DHCP
server and fulfils the role of a \"Delegating Router\" according to RFC 8415
[27]. The UE optionally includes the RAPID_COMMIT option in the DHCPv6 Solicit
message to trigger two-message DHCPv6 procedure instead of the four-message
DHCPv6 procedure. The UE shall include OPTION_PD_EXCLUDE option code in an
OPTION_ORO option to indicate support for prefix exclusion. In response to the
DHCPv6 Solicit message, the UE receives a DHCPv6 Reply message with one or
more IA_PD prefix(es) for every IA_PD option that it sent in the DHCPv6
Solicit message. The SMF delegates a prefix excluding the default prefix with
help of OPTION_PD_EXCLUDE. Prefix exclusion procedures shall follow RFC 6603
[26].
## 5.6 QoS handling
### 5.6.1 QoS handling for 5G ProSe Direct Communication
In order to support QoS handling for 5G ProSe Direct Communication, the
mechanism defined in clause 5.4 of TS 23.287 [2] is reused with the following
differences:
\- Only NR PC5 QoS model is used.
\- PC5 Packet Filter Set supports three types of packet filters, i.e. the
Prose IP Packet Filter Set, ProSe Ethernet Packet Filter Set, and the Prose
Packet Filter Set. Each PC5 QoS Rule additionally contains the ProSe
identifier when the ProSe identifier is not included in the PC5 Packet Filter
Set.
\- V2X IP Packet Filter Set is replaced by ProSe IP Packet Filter Set.
\- V2X Packet Filter Set is replaced by ProSe Packet Filter Set. ProSe Packet
Filter Set shall support Packet Filters based on at least any combination of:
\- ProSe identifier;
\- Source/Destination Layer-2 ID;
\- Application Layer ID.
\- ProSe Ethernet Packet Filter Set that has the same format as the Ethernet
Packet Filter Set defined in clause 5.7.6.3 of TS 23.501 [4] is additionally
defined.
\- V2X application layer is replaced by ProSe application layer.
\- V2X layer is replaced by ProSe layer.
\- V2X service type is replaced by ProSe identifier.
\- UE-PC5-AMBR is only applied for NR PC5.
\- The PQI values are additionally defined. The one-to-one mapping of
standardized PQI values that are additionally defined to PC5 QoS
characteristics is specified in table 5.6.1-1.
Table 5.6.1-1: Standardized PQI values that are additionally defined to QoS
characteristics mapping
+-------+-------+-------+-------+-------+-------+-------+-------+ | PQI | Res | De | P | P | De | De | Ex | | | ource | fault | acket | acket | fault | fault | ample | | Value | Type | Pri | Delay | Error | Ma | | Ser | | | | ority | B | | ximum | Aver | vices | | | | Level | udget | Rate | Data | aging | | | | | | | | Burst | W | | | | | | | | V | indow | | | | | | | | olume | | | +=======+=======+=======+=======+=======+=======+=======+=======+ | 24 | GBR | 1 | 150 | 1 | N/A | 2000 | Mi | | | | | ms | 0^-2^ | | ms | ssion | | | (NO | | | | | | Cri | | | TE 1) | | | | | | tical | | | | | | | | | user | | | | | | | | | plane | | | | | | | | | Push | | | | | | | | | To | | | | | | | | | Talk | | | | | | | | | voice | | | | | | | | | (e.g. | | | | | | | | | M | | | | | | | | | CPTT) | +-------+-------+-------+-------+-------+-------+-------+-------+ | 25 | | 2 | 200 | 1 | N/A | 2000 | Non-M | | | | | ms | 0^-2^ | | ms | issio | | | | | | | | | n-Cri | | | | | | | | | tical | | | | | | | | | user | | | | | | | | | plane | | | | | | | | | Push | | | | | | | | | To | | | | | | | | | Talk | | | | | | | | | voice | +-------+-------+-------+-------+-------+-------+-------+-------+ | 26 | | 2 | 200 | 1 | N/A | 2000 | Mi | | | | | ms | 0^-3^ | | ms | ssion | | | | | | | | | Cri | | | | | | | | | tical | | | | | | | | | Video | | | | | | | | | user | | | | | | | | | plane | +-------+-------+-------+-------+-------+-------+-------+-------+ | 60 | No | 1 | 120 | 1 | N/A | N/A | Mi | | | n-GBR | | ms | 0^-6^ | | | ssion | | | | | | | | | Cri | | | | | | | | | tical | | | | | | | | | delay | | | | | | | | | sens | | | | | | | | | itive | | | | | | | | | signa | | | | | | | | | lling | | | | | | | | | (e.g. | | | | | | | | | M | | | | | | | | | C-PTT | | | | | | | | | s | | | | | | | | | ignal | | | | | | | | | ling) | +-------+-------+-------+-------+-------+-------+-------+-------+ | 61 | | 6 | 400 | 1 | N/A | N/A | Mi | | | | | ms | 0^-6^ | | | ssion | | | | | | | | | Cri | | | | | | | | | tical | | | | | | | | | Data | | | | | | | | | (e.g. | | | | | | | | | ex | | | | | | | | | ample | | | | | | | | | ser | | | | | | | | | vices | | | | | | | | | are | | | | | | | | | the | | | | | | | | | same | | | | | | | | | as | | | | | | | | | 5QI | | | | | | | | | 6/8/9 | | | | | | | | | as | | | | | | | | | spec | | | | | | | | | ified | | | | | | | | | in | | | | | | | | | T | | | | | | | | | S 23. | | | | | | | | | 501 \ | | | | | | | | | [4]) | +-------+-------+-------+-------+-------+-------+-------+-------+ | 92 | Delay | 5 | 5ms | 1 | 20000 | 2000 | I | | | Cri | | | 0^-4^ | bytes | ms | ntera | | | tical | | | | | | ctive | | | GBR | | | | | | se | | | | | | | | | rvice | | | (NO | | | | | | - | | | TE 1) | | | | | | co | | | | | | | | | nsume | | | | | | | | | VR | | | | | | | | | co | | | | | | | | | ntent | | | | | | | | | with | | | | | | | | | high | | | | | | | | | c | | | | | | | | | ompre | | | | | | | | | ssion | | | | | | | | | rate | | | | | | | | | via | | | | | | | | | tet | | | | | | | | | hered | | | | | | | | | VR | | | | | | | | | he | | | | | | | | | adset | | | | | | | | | (See | | | | | | | | | T | | | | | | | | | S 22. | | | | | | | | | 261 \ | | | | | | | | | [6]) | +-------+-------+-------+-------+-------+-------+-------+-------+ | 93 | | 6 | 10ms | 1 | 20000 | 2000 | i | | | | | | 0^-4^ | bytes | ms | ntera | | | | | | | | | ctive | | | | | | | | | se | | | | | | | | | rvice | | | | | | | | | - | | | | | | | | | co | | | | | | | | | nsume | | | | | | | | | VR | | | | | | | | | co | | | | | | | | | ntent | | | | | | | | | with | | | | | | | | | low | | | | | | | | | c | | | | | | | | | ompre | | | | | | | | | ssion | | | | | | | | | rate | | | | | | | | | via | | | | | | | | | tet | | | | | | | | | hered | | | | | | | | | VR | | | | | | | | | hea | | | | | | | | | dset; | | | | | | | | | | | | | | | | | | G | | | | | | | | | aming | | | | | | | | | or | | | | | | | | | I | | | | | | | | | ntera | | | | | | | | | ctive | | | | | | | | | Data | | | | | | | | | Excha | | | | | | | | | nging | | | | | | | | | (See | | | | | | | | | T | | | | | | | | | S 22. | | | | | | | | | 261 \ | | | | | | | | | [6]) | +-------+-------+-------+-------+-------+-------+-------+-------+ | NO | | | | | | | | | TE 1: | | | | | | | | | GBR | | | | | | | | | and | | | | | | | | | Delay | | | | | | | | | Cri | | | | | | | | | tical | | | | | | | | | GBR | | | | | | | | | PQIs | | | | | | | | | can | | | | | | | | | only | | | | | | | | | be | | | | | | | | | used | | | | | | | | | for | | | | | | | | | un | | | | | | | | | icast | | | | | | | | | PC5 | | | | | | | | | commu | | | | | | | | | nicat | | | | | | | | | ions. | | | | | | | | +-------+-------+-------+-------+-------+-------+-------+-------+
### 5.6.2 QoS handling for 5G ProSe UE-to-Network Relay operations
#### 5.6.2.1 QoS handling for 5G ProSe Layer-3 UE-to-Network Relay without
N3IWF
For a 5G ProSe Layer-3 Remote UE accessing network via 5G ProSe Layer-3 UE-to-
Network Relay without N3IWF, the QoS requirement of the relay traffic between
5G ProSe Layer-3 Remote UE and UPF can be satisfied by the corresponding QoS
control for the PC5 link between 5G ProSe Layer-3 Remote UE and 5G ProSe
Layer-3 UE-to-Network Relay (PC5 QoS control) and the QoS control for the PDU
session established between 5G ProSe Layer-3 UE-to-Network Relay and UPF (i.e.
Uu QoS control). The PC5 QoS is controlled with PC5 QoS rules and PC5 QoS
parameters (e.g. PQI, GFBR, MFBR, PC5 LINK-AMBR) as specified in clause 5.4 of
TS 23.287 [2]. The QoS for the PDU session established between the 5G ProSe
Layer-3 UE-to-Network Relay and UPF (i.e. Uu QoS control) is controlled with
QoS rules and 5G QoS parameters (e.g. 5QI, GFBR, MFBR) as specified in clause
5.7 of TS 23.501 [4].
As shown in figure 5.6.2.1-1 below, the end-to-end QoS can be met only when
the QoS requirements are properly translated and satisfied over the two legs
respectively.
Figure 5.6.2.1-1: End-to-End QoS translation for 5G ProSe Layer-3 UE-to-
Network Relay operation
To achieve this, the QoS mapping can be pre-configured or provided to the 5G
ProSe Layer-3 UE-to-Network Relay by the PCF using Prose Policy as specified
in clause 5.1.4.1. The QoS mapping includes combinations of the 5QIs and PQIs
mapping as entries. The PQI shall have standardized values as defined in Table
5.6.1-1 and in Table 5.4.4-1 of TS 23.287 [2]. The 5QI shall have standardized
values as defined in TS 23.501 [4] clause 5.7.4. The QoS mapping also includes
an adjustment factor for the PQI\'s PDB, e.g. 1/5 of the standardized PDB
value in Table 5.6.1-1 and Table 5.4.4-1 of TS 23.287 [2].
If the QoS Flows setup are initiated by network, the SMF can base on the PCC
rules or its local configuration to generates the QoS rules and QoS Flow level
QoS parameters (e.g. 5QI, GFBR, MFBR) and signal to the 5G ProSe Layer-3 UE-
to-Network Relay using PDU Session Establishment/Modification procedure. For
the PDU sessions used for relaying, the SMF always provides the QoS Flow level
QoS parameters to the 5G ProSe Layer-3 UE-to-Network Relay when establishes a
QoS Flow. Then the 5G ProSe Layer-3 UE-to-Network Relay decides the PC5 QoS
parameters for the corresponding PC5 QoS Flow by determining the PQI based the
QoS mapping, and the GFBR and MFBR values for the PC5 GBR QoS Flow are set
equal to the GFBR and MFBR values for the GBR QoS Flow respectively. The PCF
differentiates the relay traffic based on either local configuration, e.g.by a
dedicated DNN or S-NSSAI used for relay traffic or by the traffic filters.
NOTE: Separate QoS mappings can be configured for different RSCs.
If the 5G ProSe Layer-3 Remote UE initiates PC5 QoS Flows setup or
modification during the Layer-2 link establishment or modification procedure,
the 5G ProSe Layer-3 Remote UE provides the QoS Info as described in clause
6.4.3.6 to the 5G ProSe Layer-3 UE-to-Network Relay. The received PC5 QoS
parameters of the QoS Info (i.e. PQI and conditionally other parameters such
as MFBR/GFBR, etc.) are interpreted as the end-to-end QoS requirements by the
5G ProSe Layer-3 UE-to-Network Relay for the traffic transmission between 5G
ProSe Layer-3 Remote UE and UPF. If the end-to-end QoS requirements can be
supported by an entry in QoS mapping, the 5G ProSe Layer-3 UE-to-Network Relay
uses the 5QI of the entry for the Uu QoS control, and uses the PQI of the
entry for the PC5 QoS control. If the end-to-end QoS requirements cannot be
supported by any entries in QoS mapping, the 5G ProSe Layer-3 UE-to-Network
Relay, based on its implementation, decides the 5QI for the Uu QoS control and
PQI for the PC5 QoS control. The 5G ProSe Layer-3 UE-to-Network Relay provides
the QoS Info (including PQI value chosen by the 5G ProSe Layer-3 UE-to-Network
Relay) as part of the Accept message to the 5G ProSe Layer-3 Remote UE. If the
5G ProSe Layer-3 Remote UE performs the Layer-2 link modification procedure to
add new PC5 QoS Flow(s) or modify the existing PC5 QoS Flow(s) for IP traffic
or Ethernet traffic over PC5 reference point, the 5G ProSe Layer-3 Remote UE
may also provide the PC5 QoS Rule(s) for the PC5 QoS Flow(s) to be added or
modified to the 5G ProSe Layer-3 UE-to-Network Relay. The 5G ProSe Layer-3 UE-
to-Network Relay may generate the Packet Filters used over Uu reference point
based on the received PC5 QoS Rule(s).
The 5G ProSe Layer-3 UE-to-Network Relay performs the UE requested PDU session
Modification as defined in TS 23.502 [5], clause 4.3.3 for authorizing the
requested QoS including the 5QI and the Packet Filters. If the PCF authorizes
the requested QoS with a different 5QI value, the 5G ProSe Layer-3 UE-to-
Network Relay may further update the PQI value based on the authorized 5QI
value, and the 5G ProSe Layer-3 UE-to-Network Relay performs the Layer-2 link
modification procedure as defined in clause 6.4.3.6 to update the
corresponding PC5 QoS Flow with the updated PQI value.
Alternatively, reflective QoS control over Uu as defined in TS 23.501 [4],
clause 5.6.5.3 can be leveraged for dynamic QoS handling of 5G ProSe Layer-3
Remote UE to save on signalling between SMF and 5G ProSe Layer-3 UE-to-Network
Relay. Upon reception of a DL packet with RQI on the Uu for the 5G ProSe
Layer-3 Remote UE, based on the indicated QFI, the 5G ProSe Layer-3 UE-to-
Network Relay creates a new derived QoS rule or updates existing derived QoS
rule corresponding to the remote UE, as defined in TS 23.501 [4]. The derived
QoS rule is for UL packets from the 5G ProSe Layer-3 Remote UE at Uu
interface.
Based on signalled QoS rules (via SMF) or derived QoS rules (Uplink Uu via
reflective QoS), the 5G ProSe Layer-3 UE-to-Network Relay may generate the
Packet Filters used over PC5 reference point and use the L2 Link Modification
procedures as defined in clause 6.4.3.6 to either update existing PC5 QoS
Flow(s) or to set up new PC5 QoS Flow(s) (when the QFI to PC5 QoS Flow mapping
does not exist). The 5G ProSe Layer-3 UE-to-Network Relay may also provide the
PC5 QoS Rule(s) for the PC5 QoS Flow(s) to be added or modified to the 5G
ProSe Layer-3 Remote UE.
When the 5G ProSe Layer-3 UE-to-Network relay deletes the derived QoS rule
e.g. after the RQ Timer expires, the 5G ProSe Layer-3 UE-to-Network Relay may
perform L2 Link Modification procedures defined in clause 6.4.3.6 accordingly
using the PQI mapped from the 5QI of the currently used QoS rule after the
deletion of the derived QoS rule(s).
#### 5.6.2.2 QoS handling for 5G ProSe Layer-3 UE-to-Network relay with N3IWF
When accessing 5GS via a 5G ProSe Layer-3 UE-to-Network Relay with N3IWF, the
5G ProSe Layer-3 Remote UE can request for PDU Session establishment or
handover an existing PDU session to the N3IWF using UE requested PDU Session
Establishment procedure defined in TS 23.502 [5] clause 4.12.5.
Figure 5.6.2.2-1: End-to-End QoS support via Layer-3 UE-to-Network Relay with
N3IWF
For the 5G ProSe Layer-3 Remote UE\'s PDU session(s) established via N3IWF,
QoS differentiation can be provided on per-IPsec Child Security Association
basis. N3IWF determines the IPsec child SAs as defined in TS 23.502 [5] clause
4.12. The N3IWF is preconfigured to allocate different IPsec child SAs for QoS
Flows with different QoS profiles.
Based on configuration, the N3IWF can use one of the options below for QoS
support in 5G ProSe Layer-3 UE-to-Network Relay UE\'s serving PLMN:
\- a static QoS mapping mechanism;
\- a dynamic QoS signalling based mechanism.
For the static QoS mapping mechanism, a SLA is established to govern the QoS
handling between the 5G ProSe Layer-3 Remote UE\'s 5GC and the 5G ProSe
Layer-3 UE-to-Network Relay UE\'s 5GC, e.g. when the RSC is configured. The
SLA can include the mapping between the DSCP markings for the IPsec child SAs
with the Remote UE and the corresponding QoS, and N3IWF IP address(es). The
non-alteration of the DSCP field between N3IWF and the 5G ProSe Layer-3 UE-to-
Network Relay UE\'s UPF is also assumed to be governed by an SLA and by
transport-level arrangements that are outside of 3GPP scope. The packet
detection filters at the 5G ProSe Layer-3 UE-to-Network Relay UE\'s UPF can be
based on the N3IWF IP address and the DSCP markings.
When the dynamic QoS signalling based mechanism is used by N3IWF, it works as
follows:
\- When the 5G ProSe Layer-3 Remote UE establishes or handovers a PDU session
via the N3IWF as described in clause 4.12.5 of TS 23.502 [5], the PCF serving
the PDU Session in the 5G ProSe Layer-3 Remote UE\'s 5GC detects need for
specific QoS and provides corresponding PCC rules to SMF in the 5G ProSe
Layer-3 Remote UE\'s 5GC. The resulted QoS information is provided to N3IWF in
step 2b of clause 4.12.5 of TS 23.502 [5]. The N3IWF determines the IPSec
Child SA(s) and signals to the 5G ProSe Layer-3 Remote UE, as in step 4 of
clause 4.12.5 of TS 23.502 [5] via IKE signalling including the PDU Session
ID, the QFI(s), optionally a DSCP value, and optionally the Additional QoS
Information specified in clause 4.12.5 of TS 23.502 [5]. The PDU Session
Establishment Accept message will be sent to the 5G ProSe Layer-3 Remote UE as
in step 5 of clause 4.12.5 of TS 23.502 [5].
\- Based on Additional QoS Information received from the N3IWF, the 5G ProSe
Layer-3 Remote UE determines whether it is necessary to request for QoS
session modification for the dedicated QoS Flows toward the 5G ProSe Layer-3
UE-to-Network Relay as described in clause 5.6.2.1. The 5G ProSe Layer-3
Remote UE also provides the N3IWF address, DSCP and the SPI as the traffic
filter to enable filtering and mapping of DL traffic towards the right PDU
Session/QoS Flow within the 5G ProSe Layer-3 UE-to-Network Relay UE\'s 5GC.
NOTE: This mechanism allows to communicate GBR related parameters such as GFBR
and MFBR from the PCF of the 5G ProSe Layer-3 Remote UE via the N3IWF and the
5G ProSe Layer-3 Remote UE to the 5G ProSe Layer-3 UE-to-Network Relay UE. The
5G ProSe Layer-3 UE-to-Network Relay UE would be able to request the GBR
resources from its serving network using UE requested PDU session modification
as in clause 4.3.3. of TS 23.502 [5].
\- If the 5G ProSe Layer-3 UE-to-Network Relay performs the PDU Session
Modification procedure, the PCF in the 5G ProSe Layer-3 UE-to-Network Relay
UE\'s 5GC authorizes the QoS parameters. If the PDU Session Modification
procedure authorized the requested QoS parameters, the 5G ProSe Layer-3 UE-to-
Network Relay acknowledges the 5G ProSe Layer-3 Remote UE over PC5. The 5G
ProSe Layer-3 UE-to-Network Relay also provides the traffic filter provided by
the 5G ProSe Layer-3 Remote UE to the SMF during the PDU Session Modification
procedure, and the SMF updates the PSA UPF with DL Packet Detection Rules.
\- The PSA UPF in the 5G ProSe Layer-3 UE-to-Network Relay UE\'s 5GC maps the
DL traffic from IPSec Child SA tunnel to appropriate PDU Session/QoS Flow
considering SPI and N3IWF address (filters provided by the 5G ProSe Layer-3
Remote UE).
\- The 5G ProSe Layer-3 Remote UE\'s or the 5G ProSe Layer-3 Remote UE\'s 5GC
may initiated PDU Session Modification procedures as specified in clause
4.12.6 of TS 23.502 [5]. When the 5G ProSe Layer-3 Remote UE received QoS
information from the N3IWF, the same interactions between the 5G ProSe Layer-3
Remote UE and 5G ProSe Layer-3 UE-to-Network Relay, and between the 5G ProSe
Layer-3 UE-to-Network Relay and its 5GC as described above apply.
#### 5.6.2.3 QoS handling for 5G ProSe Layer-2 UE-to-Network Relay
For a 5G ProSe Layer-2 Remote UE accessing network via 5G ProSe Layer-2 UE-to-
Network Relay, the existing 5G QoS control is reused between the 5G ProSe
Layer-2 Remote UE and the 5G ProSe Layer-2 Remote UE\'s core network. The 5G
ProSe Layer-2 Remote UE\'s SMF provides QoS profiles to NG-RAN, how NG-RAN
performs QoS enforcement for PC5 interface (between the 5G ProSe Layer-2
Remote UE and 5G ProSe Layer-2 UE-to-Network Relay) and Uu interface (between
the 5G ProSe Layer-2 UE-to-Network Relay and RAN) is specified in TS 38.300
[12].
## 5.7 Subscription to 5G ProSe
The subscription information in the UDM contains information to give the user
permission to use 5G ProSe.
At any time, the operator can amend or remove the ProSe UE subscription rights
from subscription information in the UDM, or to revoke the user\'s permission
to use 5G ProSe.
The following subscription information is defined for 5G ProSe:
\- subscription for open 5G ProSe Direct Discovery for NR PC5:
\- open 5G ProSe Direct Discovery Model A.
\- subscription for restricted 5G ProSe Direct Discovery for NR PC5:
\- restricted 5G ProSe Direct Discovery Model A;
\- restricted 5G ProSe Direct Discovery Model A with application-controlled
extension;
\- restricted 5G ProSe Direct Discovery Model A with \"on demand\" announcing;
\- restricted 5G ProSe Direct Discovery Model B.
\- subscription for Broadcast, Groupcast and Unicast mode 5G ProSe Direct
Communication for NR PC5.
\- subscription for 5G ProSe UE acting as 5G ProSe Layer-2 UE-to-Network
Relay.
\- subscription for 5G ProSe UE acting as 5G ProSe Layer-3 UE-to-Network
Relay.
\- subscription for 5G ProSe Layer-2 Remote UE access via 5G ProSe Layer-2 UE-
to-Network Relay
\- subscription for 5G ProSe Layer-3 Remote UE access via 5G ProSe Layer-3 UE-
to-Network Relay
\- UE-PC5-AMBR for NR PC5.
\- PC5 QoS parameters as defined in clause 5.6.1 used by NG-RAN.
\- the list of the PLMNs authorized for 5G ProSe services, including:
\- the list of the PLMNs where the UE is authorised for open 5G Direct
Discovery Model A, i.e. to announce or monitor or both.
\- the list of the PLMNs where the UE is authorised for restricted 5G ProSe
Direct Discovery Model A, i.e. to announce or monitor or both.
\- the list of the PLMNs where the UE is authorised for restricted 5G ProSe
Direct Discovery Model B, i.e. to perform Discoverer operation or Discoveree
operation or both.
\- the list of the PLMNs where the UE is authorised to perform Broadcast,
Groupcast and Unicast mode 5G ProSe Direct Communication for NR PC5.
\- the list of the PLMNs where the UE is authorised to act as a 5G ProSe
Layer-2 UE-to-Network Relay.
\- the list of the PLMNs where the UE is authorised to act as a 5G ProSe
Layer-3 UE-to-Network Relay.
\- the list of the PLMNs where the UE is authorised to act as a 5G ProSe
Layer-2 Remote UE.
## 5.8 Identifiers
### 5.8.1 Identifiers for 5G ProSe Direct Discovery
#### 5.8.1.0 General
NOTE: The 5G DDNMF takes the role of \"ProSe Function\" if it exists in the
following definitions in TS 23.303 [3].
#### 5.8.1.1 ProSe Application ID
ProSe Application ID is defined in TS 23.303 [3].
#### 5.8.1.2 Destination Layer-2 ID
Destination Layer-2 ID is defined in clause 5.6.1 of TS 23.287 [2].
The Destination Layer-2 ID for 5G ProSe Direct Discovery with Model A is
selected based on the configuration as described in clause 5.1.2.1. The
Destination Layer-2 ID for a Solicitation message for Model B is selected
based on the configuration as described in clause 5.1.2.1.
For Group member discovery:
\- If an Application Layer Group ID has a configured Layer-2 Group ID, which
is provisioned as specified in clause 5.1.2.1, the UE uses this Layer-2 Group
ID as the Destination Layer-2 ID,
\- otherwise, the UE converts the Application Layer Group ID into a
Destination Layer-2 ID.
NOTE: The mechanism for converting the application layer provided Application
Layer Group ID to the Destination Layer-2 ID is defined in Stage 3.
#### 5.8.1.3 Source Layer-2 ID
Source Layer-2 ID is defined in clause 5.6.1 of TS 23.287 [2].
The UE self-selects a Source Layer-2 ID for 5G ProSe Direct Discovery and
Group member discovery.
NOTE: The UE implementation needs to ensure that when the UE self-selects
Source Layer-2 IDs, the self-selected Source Layer-2 IDs are different between
5G ProSe Direct Discovery (including 5G ProSe UE-to-Network Relay Discovery)
in clause 6.3.2 and 5G ProSe Direct Communication (including 5G ProSe UE-to-
Network Relay Communication) in clause 6.4, and are different from any other
provisioned Destination Layer-2 IDs as described in clause 5.1 and any other
self-selected Source Layer-2 IDs used in a simultaneous 5G ProSe Direct
Discovery (including 5G ProSe UE-to-Network Relay Discovery) with a different
discovery model.
#### 5.8.1.4 ProSe Application Code
ProSe Application Code is defined in TS 23.303 [3].
#### 5.8.1.5 ProSe Restricted Code
ProSe Restricted Code is defined in TS 23.303 [3].
#### 5.8.1.6 ProSe Query Code
ProSe Query Code is defined in TS 23.303 [3].
#### 5.8.1.7 ProSe Response Code
ProSe Response Code is defined in TS 23.303 [3].
#### 5.8.1.8 User Info ID
User Info ID (including Announcer Info, Discoverer Info, Discoveree Info) is
defined in clause 3.1.
#### 5.8.1.9 ProSe Discovery UE ID
ProSe Discovery UE ID is defined in TS 23.303 [3].
#### 5.8.1.10 Restricted ProSe Application User ID
Restricted ProSe Application User ID is defined in TS 23.303 [3].
#### 5.8.1.11 Announcing PLMN ID
Announcing PLMN ID is defined in TS 32.277 [22].
#### 5.8.1.12 Announcer Info
Announcer Info is one of the uses of User Info ID as described in clause
5.8.1.8.
#### 5.8.1.13 Discoverer Info
Discoverer Info is one of the uses of User Info ID as described in clause
5.8.1.8.
#### 5.8.1.14 Target Info
Target Info provides information about the targeted discoveree in the Group
Member Discovery Solicitation message specified in clause 6.3.2.2.3 and in the
5G ProSe UE-to-Network Relay Discovery Solicitation message specified in
clause 6.3.2.3.3. The Target Info is the User Info ID of the discoveree.
#### 5.8.1.15 Discoveree Info
Discoveree Info is one of the uses of User Info ID as described in clause
5.8.1.8.
#### 5.8.1.16 **Application Layer Group ID**
Application Layer Group ID is defined in TS 23.303 [3].
### 5.8.2 Identifiers for 5G ProSe Direct Communication
#### 5.8.2.1 General
Each UE has one or more Layer-2 IDs for 5G ProSe direct communication over PC5
reference point, consisting of:
\- Source Layer-2 ID(s); and
\- Destination Layer-2 ID(s).
Source and Destination Layer-2 IDs are included in layer-2 frames sent on the
layer-2 link of the PC5 reference point identifying the layer-2 source and
destination of these frames. Source Layer-2 IDs are always self-assigned by
the UE originating the corresponding layer-2 frames.
The selection of the Source and Destination Layer-2 ID(s) by a UE depends on
the communication mode of 5G ProSe direct communication over PC5 reference
point for this layer-2 link, as described in clauses 5.8.2.2, 5.8.2.3, and
5.8.2.4. The Source Layer-2 IDs may differ between different communication
modes.
#### 5.8.2.2 Identifiers for broadcast mode 5G ProSe direct communication
For broadcast mode of 5G ProSe direct communication over PC5 reference point,
the UE is configured with the Destination Layer-2 ID(s) to be used for ProSe
applications. The Destination Layer-2 ID for a 5G ProSe direct communication
is selected based on the configuration as described in clause 5.1.3.1.
The UE self-selects a Source Layer-2 ID.
#### 5.8.2.3 Identifiers for groupcast mode 5G ProSe direct communication
For groupcast mode of 5G ProSe direct communication over PC5 reference point,
the application layer may provide Application Layer Group ID.
The UE determines a Destination Layer-2 ID as below:
\- When the Application Layer Group ID is provided by the application layer,
\- and when ProSe Layer-2 Group ID is configured for the Application Layer
Group ID provided by the application layer as specified in clause 5.1.3.1, the
UE uses the ProSe Layer-2 Group ID as the Destination Layer-2 ID; or
\- and when ProSe Layer-2 Group ID is not configured for the Application Layer
Group ID provided by the application layer, the UE converts the Application
Layer Group ID into a Destination Layer-2 ID.
\- When the Application Layer Group ID is not provided by the application
layer, the UE determines the Destination Layer-2 ID based on configuration of
the mapping between ProSe Identifier and Layer-2 ID, as specified in clause
5.1.3.1.
NOTE: The mechanism for converting the application layer provided Application
Layer Group ID to the Destination Layer-2 ID is defined in Stage 3.
The UE self-selects a Source Layer-2 ID.
#### 5.8.2.4 Identifiers for unicast mode 5G ProSe direct communication
For unicast mode of 5G ProSe direct communication over PC5 reference point,
the Destination Layer-2 ID used depends on the communication peer. The Layer-2
ID of the communication peer, identified by the peer\'s Application Layer ID,
may be discovered during the establishment of the PC5 unicast link, or known
to the UE via prior ProSe direct communications, e.g. existing or prior
unicast link to the same Application Layer ID, or obtained from 5G ProSe
direct discovery process. The initial signalling for the establishment of the
PC5 unicast link may use the known Layer-2 ID of the communication peer, or a
default destination Layer-2 ID associated with the ProSe service (i.e. ProSe
identifier) configured for PC5 unicast link establishment, as specified in
clause 5.1.3.1. During the PC5 unicast link establishment procedure, Layer-2
IDs are exchanged, and should be used for future communication between the two
UEs, as specified in clause 6.4.3.
The UE maintains a mapping between the Application Layer IDs and the source
Layer-2 IDs used for the PC5 unicast links, as the ProSe application layer
does not use the Layer-2 IDs. This allows the change of source Layer-2 ID
without interrupting the ProSe applications.
When Application Layer IDs change, the source Layer-2 ID(s) of the PC5 unicast
link(s) shall be changed if the link(s) was used for 5G ProSe communication
with the changed Application Layer IDs.
Based on privacy configuration as specified in clause 5.1.3.1, the update of
the new identifiers of a source UE to the peer UE for the established unicast
link may cause the peer UE to change its Layer-2 ID and optionally IP
address/prefix if IP communication is used as defined in clause 6.4.3.2.
### 5.8.3 Identifiers for 5G ProSe UE-to-Network Relay
#### 5.8.3.1 Common identifiers for 5G ProSe UE-to-Network Relay
The following parameters are used for the 5G ProSe UE-to-Network Relay
Discovery Announcement message (Model A), where Source Layer-2 ID and
Destination Layer-2 ID are used for sending and receiving the message, and
Announcer Info and Relay Service Code are contained in the message:
\- Source Layer-2 ID: the 5G ProSe UE-to-Network Relay self-selects a Source
Layer-2 ID for 5G ProSe UE-to-Network Relay Discovery.
\- Destination Layer-2 ID: the Destination Layer-2 ID for 5G ProSe UE-to-
Network Relay Discovery is selected based on the configuration as described in
clause 5.1.4.1.
\- Announcer Info: provides information (i.e. User Info ID) about the
announcing user.
\- Relay Service Code: parameter identifying a connectivity service the 5G
ProSe UE-to-Network Relay provides to a 5G ProSe Remote UE. The Relay Service
Codes are configured in a 5G ProSe UE-to-Network Relay for advertisement.
Additionally, the Relay Service Code may also identifies authorized users the
5G ProSe UE-to-Network Relay would offer service to, and may be used to select
the related security policies or information e.g. necessary for authentication
and authorization between the 5G ProSe Remote UE and the 5G ProSe UE-to-
Network Relay (e.g. a Relay Service Code for relays for police members only
would be different than a Relay Service Code for relays for Fire Fighters
only, even though potentially they provided connectivity to same DN e.g. to
support Internet Access).
The following parameters are used for the 5G ProSe UE-to-Network Relay
Discovery Solicitation message (Model B), where Source Layer-2 ID and
Destination Layer-2 ID are used for sending and receiving the message, and
Discoverer Info and Relay Service Code are contained in the message:
\- Source Layer-2 ID: the 5G ProSe Remote-UE self-selects a Source Layer-2 ID
for 5G ProSe UE-to-Network Relay Discovery.
\- Destination Layer-2 ID: the Destination Layer-2 ID for 5G ProSe UE-to-
Network Relay Discovery is selected based on the configuration as described in
clause 5.1.4.1.
\- Discoverer Info: provides information (i.e. User Info ID) about the
discoverer user.
\- Target Info: provides information (i.e. User Info ID) about the targeted
discoveree user.
\- Relay Service Code: information about connectivity that the discoverer UE
is interested in. The Relay Service Codes are configured in the 5G ProSe
Remote UEs interested in related connectivity services.
The following parameters are used in the 5G ProSe UE-to-Network Relay
Discovery Response message (Model B), where Source Layer-2 ID and Destination
Layer-2 ID are used for sending and receiving the message, and Discoveree Info
and Relay Service Code are contained in the message:
\- Source Layer-2 ID: the 5G ProSe UE-to-Network Relay self-selects a Source
Layer-2 ID for 5G ProSe UE-to-Network Relay Discovery.
\- Destination Layer-2 ID: set to the Source Layer-2 ID of the received 5G
ProSe UE-to-Network Relay Discovery Solicitation message.
\- Relay Service Code: identifies the connectivity service the 5G ProSe UE-to-
Network Relay provides to 5G ProSe Remote UEs that matches the Relay Service
Code from the corresponding Discovery Solicitation message.
\- Discoveree Info: provides information (i.e. User Info ID) about the
discoveree.
The following parameters may be used in the Relay Discovery Additional
Information message (for Model A) based on the procedure defined in clause
6.5.1.3 for 5G ProSe UE-to-Network Relay where Source Layer-2 ID and
Destination Layer-2 ID are used for sending and receiving the message, and the
other parameters are contained in the message:
\- Source Layer-2 ID: the 5G ProSe UE-to-Network Relay self-selects a Source
Layer-2 ID to send the Relay Discovery Additional Information message.
\- Destination Layer-2 ID: the Destination Layer-2 ID to send the Relay
Discovery Additional Information message is selected based on the
configuration as described in clause 5.1.4.1.
\- Relay Service Code: the Relay Service Code associated with the message. The
Relay Service Code is used to identify the security parameters needed by the
receiving UE to process the discovery message.
\- Announcer Info: provides information about the announcing user.
\- Additional parameters: the additional parameters for 5G ProSe Layer-3 UE-
to-Network Relay (when applicable) are defined in clause 5.8.3.2.
NOTE: The UE implementation needs to ensure that when the UE self-selects
Source Layer-2 IDs, the self-selected Source Layer-2 IDs are different between
5G ProSe Direct Discovery (including 5G ProSe UE-to-Network Relay Discovery)
in clause 6.3.2 and 5G ProSe Direct Communication (including 5G ProSe UE-to-
Network Relay Communication) in clause 6.4, and are different from any other
provisioned Destination Layer-2 IDs as described in clause 5.1 and any other
self-selected Source Layer-2 IDs used in a simultaneous 5G ProSe Direct
Discovery (including 5G ProSe UE-to-Network Relay Discovery) with a different
discovery model.
#### 5.8.3.2 Identifiers for 5G ProSe Layer-3 UE-to-Network Relay
For 5G ProSe Layer-3 UE-to-Network relay, a Relay Service Code in the
Announcement Message is associated with a set of PDU session parameters (e.g.
PDU Session type, DNN, SSC Mode, S-NSSAI, Access Type Preference). The Relay
Service Code may also represent if the relay UE can provide secure N3IWF
connection.
For 5G ProSe Layer-3 Remote UE discovering 5G ProSe Layer-3 UE-to-Network
relay, the Relay Service Code in the Solicitation Message represents the PDU
session parameters that a PDU session of the relay should be able to support.
The Relay Service Code may also represent if the remote UE requires secure
N3IWF connection.
The following additional parameters may be used in the Relay Discovery
Additional Information message (for Model A) for 5G ProSe Layer-3 UE-to-
Network Relay:
\- NCGI: indicates the NCGI of the serving cell of the 5G ProSe Layer-3 UE-to-
Network Relay. This parameter may be requested by application running on 5G
ProSe Layer-3 Remote UE.
\- TAI: indicates the Tracking Area Identity of the serving cell of the 5G
ProSe Layer-3 UE-to-Network Relay. This parameter may be used by 5G ProSe
Layer-3 Remote UE to select a N3IWF.
#### 5.8.3.3 Identifiers for 5G ProSe Layer-2 UE-to-Network Relay
The following parameters may be used in Announcement message (Model A) or
Response message (Model B) in addition to the parameters as specified in
clause 5.8.3.1:
\- NCGI: indicates the NCGI of the serving cell of the 5G ProSe Layer-2 UE-to-
Network Relay for 5G ProSe Layer-2 UE-to-Network Relay (re)selection.
\- RRC Container: An RRC container, as defined in TS 38.331 [16], which
includes the cell access related information for the serving cell of the 5G
ProSe Layer-2 UE-to-Network Relay.
## 5.9 Support for 5G ProSe for UEs in limited service state
For UE in limited service state, as defined in TS 23.122 [14], 5G ProSe can be
used over PC5 reference point with the following considerations.
UEs that are authorized to use 5G ProSe over PC5 reference point according to
clause 5.1 shall be able to use the corresponding services following the
principles defined in clause 5.1.2.2 for 5G ProSe Direct Discovery, clause
5.1.3.2 for 5G ProSe Direct Communication, and clause 5.1.4.2 for 5G ProSe UE-
to-Network Relay when the UE enters in limited service state in 5GS:
\- because UE cannot find a suitable cell of the selected PLMN as described in
TS 23.122 [14]; or
\- as the result of receiving one of the following reject reasons defined in
TS 23.122 [14]:
\- a \"PLMN not allowed\" response to a registration request or;
\- a \"5GS services not allowed\" response to a registration request or
service request.
A UE in limited service state shall only use the radio resources and procedure
available in CM-IDLE mode for ProSe over PC5 reference point, for details see
TS 36.300 [11] and TS 38.300 [12].
UEs shall not use 5G ProSe over PC5 reference point using the \"operator-
managed\" radio resources, as specified in clauses 5.1.2.1, 5.1.3.1 and
5.1.4.1, if the UE has entered in limited service state due to all other
situations (e.g. no SIM in the MS, an \"illegal MS\" or \"illegal ME\"
response to a registration request, or an \"IMSI unknown in HLR\" response to
a registration request) defined in TS 23.122 [14], where the UE is unable to
obtain normal service from a PLMN. The UEs may use ProSe over PC5 reference
point using the \"non-operator-managed\" radio resources, as specified in
clauses 5.1.2.1, 5.1.3.1 and 5.1.4.1, according to the corresponding
principles defined in clauses 5.1.2.2, 5.1.3.2 and 5.1.4.2.
## 5.10 PC5 operation in EPS for Public Safety UE
When the UE is in EPS, the UE shall use the valid ProSe policy and parameters
provisioned by the ProSe Function in EPC for ProSe Direct Discovery and Prose
Direct Communication. If the UE does not have valid ProSe policy and
parameters, the UE shall request the network to provision the ProSe policy and
parameters.
The UE that is authorized to perform ProSe Direct Discovery and/or ProSe
Direct Communication in EPS can perform the authorized PC5 operation in EPS as
specified in TS 23.303 [3].
## 5.11 Communication path selection between PC5 and Uu reference points
The \"communication path selection between PC5 and Uu reference points\"
refers to the procedure on how a UE selects a communication path between PC5
reference point and Uu reference point before it communicates with another UE.
The communication path over PC5 reference point means that the communication
with another UE is performed by using 5G ProSe Direct Communication only. The
communication path over Uu reference point means that the communication with
another UE is performed via the network.
NOTE 1: The communication via 5G ProSe UE-to-Network Relay (Layer-2 or
Layer-3) can be considered as the communication path over Uu reference point,
as it involves communication via the network.
Path selection policy is provided to the UE to indicate which path(s) is
preferred for all or specific ProSe services (i.e. PC5 preferred, Uu preferred
or no preference indicated) as specified in clause 5.1.3.1.
The ProSe Application Server can provide a path preference for ProSe Services
to UDR as specified in clause 6.2.5 and this may be used by PCF for path
selection policy generation and update as specified in clause 6.2.2.
NOTE 2: ProSe Application Server can use QoS Sustainability analytics defined
in TS 23.288 [8] to determine the path preference.
The UE may use the provisioned path selection policy to select the appropriate
communication path for all or specific ProSe services.
UE operation related to the path selection for ProSe service is as follows:
\- The UE evaluates the path selection policy in the policy and parameters for
ProSe Direct Communication applicable to the ProSe service and selects the
communication path as below:
\- If PC5 preferred is indicated, the UE should prefer to use the PC5 for
communication path for the ProSe service.
\- If Uu preferred is indicated, the UE should prefer to use the Uu for
communication path for the ProSe service.
\- If no preference is indicated or no path selection policy is provisioned,
the UE selects either a Uu or PC5 communication path based on its pre-
configuration or implementation for the ProSe service.
NOTE 3: When either PC5 preferred or Uu preferred is indicated, the UE can
still select the other non-preferred path, e.g. because the peer UE is not in
proximity.
## 5.12 NAS level congestion control for 5G ProSe UE-to-Network Relay
The 5G ProSe UE-to-Network Relay may be subject to NAS level congestion
control, as specified in clause 5.19.7 of TS 23.501 [4].
Both 5G ProSe Layer-2 UE-to-Network Relays and Layer-3 UE-to-Network Relays,
when NAS Mobility Management congestion control as specified in clause
5.19.7.2 of TS 23.501 [4] is activated, i.e. the 5G ProSe UE-to-Network Relay
receives a Mobility Management back-off timer from the AMF, the 5G ProSe UE-
to-Network Relay is not able to serve the 5G ProSe Remote UE after the 5G
ProSe UE-to-Network Relay enters CM_IDLE state. If the 5G ProSe UE-to-Network
Relay has a Mobility Management back-off timer when it enters CM_IDLE state
the 5G ProSe UE-to-Network Relay releases the PC5 connections with its 5G
ProSe Remote UEs indicating it is temporarily not available, so the Remote UE
can (re)select another 5G ProSe UE-to-Network Relay. The 5G ProSe UE-to-
Network Relay does not perform UE-to-Network Relay Discovery as described in
clause 6.3.2.3 and does not accept any PC5 connections for relaying until the
back-off timer expires if the 5G ProSe UE-to-Network Relay is in CM_IDLE
state.
A Remote UE may also be subject to NAS level congestion control as specified
in TS 23.501 [4].
NOTE: The form of the temporarily not available indication will be determined
by stage 3.
## 5.13 Support for PC5 DRX operations
### 5.13.1 General
PC5 DRX operations are supported to enable 5G ProSe-enabled UE power saving
for the following functions:
\- 5G ProSe Direct Discovery;
\- Unicast, groupcast and broadcast mode 5G ProSe Direct Communication;
\- 5G ProSe UE-to-Network Relay Discovery and 5G ProSe UE-to-Network Relay
Communication.
Support for PC5 DRX operations in the AS layer is specified in TS 38.300 [12].
### 5.13.2 PC5 DRX operations for 5G ProSe Direct Discovery and 5G ProSe UE-
to-Network Relay Discovery
For 5G ProSe Direct Discovery and 5G ProSe UE-to-Network Relay Discovery when
the UE is \"not served by NG-RAN\", the UE uses the provisioned default PC5
DRX configuration for PC5 DRX operation as specified in clause 5.1.2.1 and
clause 5.1.4.1, respectively.
### 5.13.3 PC5 DRX operations for 5G ProSe Direct Communication and 5G ProSe
UE-to-Network Relay Communication
The ProSe layer determines the respective ProSe services (i.e. ProSe
identifiers), and derives the corresponding PC5 QoS parameters based on either
the mapping of ProSe services (i.e. ProSe identifiers) to PC5 QoS parameters,
or the ProSe Application Requirements for the ProSe services (i.e. ProSe
identifiers) provided by the application layer. For broadcast and groupcast,
the ProSe layer also determines the NR Tx Profile based on the mapping of
ProSe services (i.e. ProSe identifiers) to NR Tx Profiles as described in
clause 5.1.3.1. The ProSe layer passes the PC5 QoS parameters and destination
Layer-2 ID to the AS layer as specified in clauses 6.4.1, 6.4.2 and 6.4.3. The
ProSe layer also passes the corresponding NR Tx Profile to the AS layer, if
the ProSe layer has determined the corresponding NR Tx Profile.
NOTE: For broadcast and groupcast, the AS layer needs PC5 QoS parameters as
well to determine the PC5 DRX parameter values for reception operation over
PC5 reference point. Therefore, the ProSe layer determines the interested
ProSe services (i.e. ProSe identifiers) and derives the PC5 QoS parameters
based on its reception needs besides the transmission needs. How to derive the
PC5 QoS parameters based on its reception needs (e.g. without establishing the
PC5 QoS Flows) depends on UE implementation.
For broadcast or groupcast, the ProSe layer maintains a list of all ProSe
services (i.e. ProSe identifiers), i.e. activated ProSe services and/or ProSe
services that the UE is interested for reception, for a given destination
Layer-2 ID and determines the NR Tx Profile to be mapped for the respective
ProSe service based on the configuration described in clause 5.1.3.1. Whenever
the list of the ProSe services for a given destination Layer-2 ID changes, the
ProSe layer updates the AS layer for the NR Tx Profiles information by
providing all the mapped NR Tx Profiles to the AS layer for the given
destination Layer-2 ID, e.g. when providing other information such as the
destination Layer-2 ID, PC5 QoS parameters.
For broadcast, the mapping from destination Layer-2 ID to NR Tx Profile is
configured in the NG-RAN. The NG-RAN may derive the NR Tx Profile from the
destination Layer-2 ID to perform the network scheduled operation mode,
alignment of Uu DRX and PC5 DRX, etc.
When the PC5 DRX operation is needed, the AS layer determines the PC5 DRX
parameter values for 5G ProSe Direct Communication or 5G ProSe UE-to-Network
Relay Communication over PC5 reference point, taking into account, e.g., PC5
QoS parameters and/or destination Layer-2 ID provided by the ProSe layer.
For broadcast and groupcast, the UE enables the PC5 DRX based on the NR Tx
Profile.
For unicast mode 5G ProSe Direct Communication and 5G ProSe UE-to-Network
Relay Communication, two UEs may negotiate the PC5 DRX configuration in the AS
layer, and the PC5 DRX parameter values can be configured per pair of source
and destination Layer-2 IDs in the AS layer. For transmitting and receiving
Direct Communication Request messages, a default PC5 DRX configuration may be
used (see TS 38.300 [12]).
For broadcast and groupcast when the UE is \"not served by NG-RAN\", the UE
uses the provisioned PC5 DRX configuration for PC5 DRX operation as specified
in clause 5.1.3.1.
# 6 Functional description and information flows
## 6.1 Control and user plane stacks
### 6.1.1 Control Plane
#### 6.1.1.1 General
The control plane stack consists of protocols for controlling:
\- 5G ProSe Direct Discovery, specified in clause 6.1.1.2.1, clause 6.1.1.3,
clause 6.1.1.4, clause 6.1.1.5 and clause 6.1.1.6;
\- 5G ProSe Direct Communication, specified in clause 6.1.1.2.2;
\- 5G ProSe UE-to-Network Relay, specified in clause 6.1.1.7.
#### 6.1.1.2 UE - UE
##### 6.1.1.2.1 Discovery plane PC5 interface
The PC5 communication channel is used to carry the discovery messages over PC5
which are differentiated from other PC5 messages by the AS layer.
Figure 6.1.1.2.1-1 depicts a discovery plane for NR PC5 reference point.
**Legend:**
\- **PC5-D:** The PDCP/RLC/MAC/PHY functionality is specified in TS 38.300
[12].
\- The \"ProSe Discovery protocol\" is used for handling ProSe Direct
Discovery as specified in clause 6.3.2.
Figure 6.1.1.2.1-1: Discovery Plane PC5 Interface
##### 6.1.1.2.2 PC5 Signalling Protocol
The PC5 Signalling Protocol stack specified in clause 6.1.2 of TS 23.287 [2]
is used. The protocol used for the control plane signalling over the PC5
reference point for the secure layer-2 link is specified in clauses 6.4.3,
6.5.1 and 6.5.2.
#### 6.1.1.3 UE - 5G DDNMF
**Legend:**
\- ProSe Control Signalling between UE and 5G DDNMF is carried over the user
plane and using the PC3a protocol as specified in TS 24.554 [23].
NOTE 1: PC3a may be realized with one or more protocols.
NOTE 2: If 5G DDNMF is integrated with ProSe Application Server, 5G DDNMF
provides PC3a interface towards UE and ProSe Application Server provides PC1
interface towards UE.
Figure 6.1.1.3-1 Control Plane for PC3a Interface
#### 6.1.1.4 5G DDNMF -- UDM
5G DDNMF uses Nudm interface defined in TS 23.501 [4] to obtain the UE\'s
subscription information for the authorization of the 5G ProSe Direct
Discovery requests.
#### 6.1.1.5 5G DDNMF -- 5G DDNMF
The control plane protocol(s) between 5G DDNMFs are defined in TS 29.500 [30].
The 5G DDNMFs uses N5g-ddnmf 5G DDNMF services defined in clause 7.1 to access
the services provided by the other 5G DDNMF(s). The 5G DDNMF in HPLMN uses NRF
to discover the 5G DDNMFs in VPLMN and Local PLMNs.
#### 6.1.1.6 5G DDNMF -- ProSe Application Server
The 5G System architecture supports the service based Npc2 interface between
5G DDNMF and ProSe Application Server and optionally supports PC2 interface
between 5G DDNMF and ProSe Application Server, to enable Proximity Services.
See TS 23.501 [4] and TS 23.303 [3].
NOTE: PC2 support between 5G DDNMF and ProSe Application Server is for
backwards compatibility for early deployments using Diameter. PC2 interface is
used for 5G ProSe Direct Discovery authorization.
#### 6.1.1.7 5G ProSe UE-to-Network Relay
##### 6.1.1.7.1 5G ProSe Layer-3 UE-to-Network Relay
The UE-UE protocol stacks for discovery and PC5 link management as defined in
clause 6.1.1.2 apply to 5G ProSe Remote UE and 5G ProSe Layer-3 UE-to-Network
Relay.
Additionally, when N3IWF is supported by the 5G ProSe Layer-3 UE-to-Network
Relay, the following control plane protocol stack apply.
**Legend:**
\- NAS, EAP-5G, and IKEv2 between the Remote UE and the N3IWF are defined in
clause 8.2.4 of TS 23.501 [4].
Figure 6.1.1.7.1-1: Control plane protocol stacks between 5G ProSe Layer-3
Remote UE and N3IWF over 5G ProSe Layer-3 UE-to-Network Relay before the
signalling IPSec SA is established
**Legend:**
\- NAS, TCP, and IPsec between the Remote UE and the N3IWF are defined in TS
23.501 [4] clause 8.2.4.
Figure 6.1.1.7.1-2: Control plane protocol stacks between 5G ProSe Layer-3
Remote UE and N3IWF over 5G ProSe Layer-3 UE-to-Network Relay after the
signalling IPSec SA is established
##### 6.1.1.7.2 5G ProSe Layer-2 UE-to-Network Relay
The UE-UE protocol stacks for discovery and PC5 signalling defined in clause
6.1.1.2 apply to 5G ProSe Remote UE and 5G ProSe Layer-2 UE-to-Network Relay.
Figure 6.1.1.7.2-1 illustrates the protocol stack of the NAS connection for
the 5G ProSe Layer-2 Remote UE for NAS-MM and NAS-SM. The NAS messages are
transparently transferred between the 5G ProSe Layer-2 Remote UE and NG-RAN
over the 5G ProSe Layer-2 UE-to-Network Relay using:
\- PDCP end-to-end connection between the 5G ProSe Layer-2 Remote UE and NG-
RAN, where the role of the 5G ProSe Layer-2 UE-to-Network Relay is to relay
the PDUs over the signalling radio bear without any modifications and using
the functionality of the adaptation layer as specified in TS 38.300 [12].
\- Connection between NG-RAN and AMF over N2.
\- Connection between AMF and SMF over N11.
Figure 6.1.1.7.2-1: End-to-End Control Plane for a Remote UE using Layer-2 UE-
to-Network Relay
The control plane protocol stack used by the 5G ProSe Layer-2 UE-to-Network
Relay is defined in clause 8.2.2 of TS 23.501 [4].
### 6.1.2 User Plane
#### 6.1.2.1 General
The user plane stack consists of protocols for data transmission via:
\- 5G ProSe Direct Communication, specified in clause 6.1.2.2;
\- 5G ProSe UE-to-Network Relay, specified in clause 6.1.2.3.
#### 6.1.2.2 UE - UE
Figure 6.1.2.2-1 depicts a user plane for NR PC5 reference point, i.e. PC5
User Plane Protocol stack.
**Legend:**
\- **PC5-U:** The SDAP/PDCP/RLC/MAC/PHY functionality is specified in TS
38.300 [12].
Figure 6.1.2.2-1: User Plane for NR PC5 reference point
PDCP SDU types of IP, Ethernet, Unstructured and Address Resolution Protocol
are supported. For IP PDCP SDU type, both IPv4 and IPv6 are supported.
NOTE: Address Resolution Protocol is only supported for broadcast and
groupcast mode 5G ProSe Direct Communication.
The packets from ProSe application layer are handled by the ProSe layer before
transmitting them to the AS layer, e.g. ProSe layer maps the IP, Ethernet and
Unstructured packets to PC5 QoS Flow and marks the corresponding PFI.
#### 6.1.2.3 5G ProSe UE-to-Network Relay
##### 6.1.2.3.1 5G ProSe Layer-3 UE-to-Network Relay
**Legend:**
\- GPRS Tunnelling Protocol for the user plane (GTPâ€‘U): This protocol tunnels
user data between NG-RAN node and UPF as well as between the UPFs in the
backbone network (not shown in the figure). GTP-U shall encapsulate all end
user PDU packets.
\- SMF controls the user plane tunnel establishment and establishes User Plane
Bearers between NG-RAN node and UPF.
\- UDP/IP: These are the backbone network protocols used for routing user data
and control signalling.
\- Uu: The NR Uu radio protocols of NG-RAN between the UE-to-Network Relay and
the NG-RAN node are specified in TS 38.300 [12].
\- PC5-U: The radio protocols between the UE and the UE-to-Network Relay are
specified in clause 6.1.2.2.
Figure 6.1.2.3.1-1: User plane protocol stack for Layer-3 UE-to-Network Relay
**Legend:**
\- IPSec, Inner IP, and GRE between the UE and the N3IWF are defined in TS
23.501 [4] clause 8.3.2.
Figure 6.1.2.3.1-2: User plane protocol stacks for Layer-3 UE-to-Network Relay
with N3IWF support
##### 6.1.2.3.2 5G ProSe Layer-2 UE-to-Network Relay
Figure 6.1.2.2.2-1 illustrates the protocol stack for the user plane
transport, related to a PDU Session, including a 5G ProSe Layer 2 UE-to-
Network Relay. The PDU layer corresponds to the PDU carried between the 5G
ProSe Layer-2 Remote UE and the Data Network (DN) over the PDU session. The
SDAP and PDCP protocols are specified in TS 38.300 [12]. PDCP end-to-end
connection is between the 5G ProSe Layer-2 Remote UE and NG-RAN. The
functionality of the adaptation layer is specified in TS 38.351 [28].
Figure 6.1.2.3.2-1: End-to-End User Plane Stack for a 5G ProSe Remote UE using
5G ProSe Layer-2 UE-to-Network Relay
## 6.2 Procedures for Service Authorization and Provisioning to UE
### 6.2.1 General
The procedures for service authorization and provisioning to UE may be
initiated by the PCF (as described in clause 6.2.2), by the UE (as described
in clause 6.2.4), or by the AF (as described in clause 6.2.5).
### 6.2.2 PCF based Service Authorization and Provisioning to UE
For PCF based Service Authorization and Provisioning to UE, the Registration
procedures as defined in clause 4.2.2.2 of TS 23.502 [5], UE Policy
Association Establishment procedure as defined in clause 4.16.11 of TS 23.502
[5] and UE Policy Association Modification procedure as defined in clause
4.16.12 of TS 23.502 [5] apply with the following additions:
\- If the UE indicates 5G ProSe Capability in the Registration Request message
and if the UE is authorized to use 5G ProSe service based on subscription
data, the AMF selects the PCF which supports 5G ProSe Policy/Parameter
provisioning as described in clause 6.2.3 and establishes a UE policy
association with the PCF for 5G ProSe Policy/Parameter delivery. The AMF
reports the authorized 5G ProSe Capability to the selected PCF, which may
determine the 5G ProSe Policy/Parameter based on the UE\'s authorized 5G ProSe
Capability.
The PCF may update the 5G ProSe Policy/parameters to the UE in following
conditions:
\- UE Mobility, e.g. UE moves from one PLMN to another PLMN. This is achieved
by using the procedure of UE Policy Association Modification initiated by the
AMF, as defined in clause 4.16.12.1 of TS 23.502 [5].
\- When there is a subscription change in the list of PLMNs where the UE is
authorized to perform 5G ProSe services. This is achieved by using UE Policy
Association Modification initiated by the PCF procedure as defined in clause
4.16.12.2 of TS 23.502 [5].
\- When there is a change of service specific parameter (including path
selection policy) as described in clause 6.2.5 (performing the procedure in
clause 4.15.6.7 of TS 23.502 [5]).
\- When the timer associated with some Policy/parameter expires.
\- When the UE determines that the ProSe Policy/parameter(s) is invalid and
performs UE triggered Policy Provisioning procedure to the PCF.
If the serving PLMN is removed from the list of PLMNs in the service
authorization parameters, the service authorization is revoked in the UE.
When the UE is roaming, the change of subscription resulting in updates of the
service authorization parameters are transferred to the UE by H-PCF via V-PCF.
The UE may perform UE triggered ProSe Policy Provisioning procedure to the
PCF, after Registration procedure has been completed, as specified in clause
6.2.4 when the UE determines the 5G ProSe Policy/Parameter is invalid (e.g.
Policy/Parameter is outdated, missing or invalid).
When the UE disables a ProSe capability, the PCF may stop updating the
corresponding ProSe Policy/parameter(s) and when the UE enables a ProSe
capability the PCF may need to provide or update the corresponding ProSe
Policy/parameter(s).
When a 5G ProSe Layer-3 Remote UE is accessing to 5GC via a 5G ProSe Layer-3
UE-to-Network Relay without involving N3IWF, the PCF based provisioning and
update of 5G ProSe Policy/parameters to the 5G ProSe Layer-3 Remote UE are not
supported.
### 6.2.3 PCF discovery
PCF discovery and selection mechanism defined in clause 6.3.7.1 of TS 23.501
[4] applies with the following addition to enable a PCF instance is selected
for 5G ProSe service and for UE:
\- Based on the indication from the UE and/or UE subscription data during the
Registration procedure as specified in clause 6.5.2, the AMF may include the
5G ProSe Capability indication in the Nnrf_NFDiscovery_Request message as the
optional input parameter. If provided, the NRF takes the information into
account for discovering the PCF instance.
### 6.2.4 Procedure for UE triggered ProSe Policy provisioning
The UE triggered Policy Provisioning procedure is initiated by the UE to
request ProSe Policy/Parameter from the PCF when UE determines the 5G ProSe
Policy/Parameter is invalid in the following cases:
\- if the validity timer indicated in the 5G ProSe Policy/Parameter expires;
\- if there are no valid parameters, e.g. for the 5G ProSe Identifier a UE
wants to use, for current area, or due to abnormal situation.
Figure 6.2.4-1: UE triggered 5G ProSe Policy provisioning procedure
1\. The UE sends the UL NAS TRANSPORT message carrying the UE Policy Container
(UE Policy Provisioning Request to request 5G ProSe policies) to the AMF.
2\. The AMF sends Namf_Communication_N1MessageNotify request to the PCF
including the UE Policy Container received from UE.
3\. The PCF receives UE Policy Container which indicates UE Policy
Provisioning Request to request 5G ProSe policies. If the 5G ProSe policies
are authorized based on AMF input, the PCF performs the UE Policy delivery
procedure as defined in clause 4.2.4.3 of TS 23.502 [5].
### 6.2.5 AF-based service parameter provisioning for ProSe over control plane
For 5G ProSe service parameter provisioning (i.e. creating, updating and
deleting), the procedure defined in clause 4.15.6.7 of TS 23.502 [5] is
performed with the following considerations:
\- The AF in TS 23.502 [5] is considered as ProSe Application Server in this
specification.
\- Service Description indicates 5G ProSe service domain information.
\- Service Parameters include parameters for 5G ProSe Direct Discovery and 5G
ProSe Direct Communications. The detailed information on the parameters is
described in clause 5.1.2.1 and clause 5.1.3.1.
\- Service Parameters for 5G ProSe UE-to-Network Relay Discovery and 5G ProSe
UE-to-Network Relay Communications. The detailed information on the parameters
is described in clause 5.1.4.1.
NOTE: It is assumed that the ProSe service domain information is set based on
the Service Level Agreement with the operator.
## 6.3 5G ProSe Direct Discovery
### 6.3.1 5G ProSe Direct Discovery with 5G DDNMF
#### 6.3.1.1 Overview
5G ProSe Direct Discovery is defined as the process that detects and
identifies another UE in proximity using NR radio signals. There are two types
of 5G ProSe Direct Discovery supported over PC3a reference point: open and
restricted, as defined in TS 23.303 [3]. 5G ProSe Direct Discovery can be a
standalone service or can be used for subsequent actions e.g. to initiate 5G
ProSe Direct Communication.
ProSe-enabled UEs which have obtained authorization to participate in 5G ProSe
Direct Discovery shall not continue in participating in 5G ProSe Direct
Discovery procedures over PC3a reference point defined in clause 6.3.1 when
they detect loss of NG-RAN coverage in the serving PLMN.
With 5G ProSe Direct Discovery, the UE can use inter-PLMN discovery
transmission based on the indication from the serving NG-RAN or the
provisioned radio resource on the UE. How the serving cell authorizes the UE
to use inter-PLMN radio resource is specified in TS 38.331 [16].
#### 6.3.1.2 Overall procedure for 5G ProSe Direct Discovery (Model A)
Figure 6.3.1.2-1: Overall procedure for Model A 5G ProSe Direct Discovery
This procedure is applied for open and restricted 5G ProSe Direct Discovery
when the ProSe enabled UE is served by NG-RAN.
1\. Service authorisation for 5G ProSe Direct Discovery services is performed
for as defined in clause 6.2.
If the UE is authorised to announce:
2a. When the UE is triggered to announce, then it sends a discovery request
for announcing to the 5G DDNMF in HPLMN as defined in clause 6.3.1.4. In
addition, for restricted 5G ProSe Direct Discovery, the 5G DDNMF further
interacts with the ProSe Application server for the authorization of the
discovery request.
3a. If the request is successful and is provided with ProSe Application
Code/ProSe Restricted Code, it starts announcing on PC5 interface.
For ProSe restricted discovery and UE requests \"on demand\" announcing, ProSe
Restricted Code may be provided to UE after this procedure. In this case, UE
waits for the ProSe Restricted Code allocation and starts to announce the
ProSe Restricted Code on PC5 after receiving it in Announcing Alert procedure
specified in clause 6.3.1.6.
NOTE 1: More details on the Access Stratum protocol of this step are provided
in RAN specifications.
If the UE is authorised to monitor:
2b. When the UE is triggered to monitor, it sends a discovery request for
monitoring to the 5G DDNMF as defined in clause 6.3.1.4. In addition, for
restricted 5G ProSe Direct Discovery, the 5G DDNMF further interacts with the
ProSe Application server for the authorization of the discovery request.
3b. If the request is successful and the UE is provided with a Discovery
Filter consisting of ProSe Application Code(s)/ProSe Restricted Code(s) and/or
ProSe Application Mask(s), it starts monitoring for these ProSe Application
Codes/ProSe Restricted Codes on the PC5 interface.
NOTE 2: More details on the Access Stratum protocol of this step are provided
in RAN specifications.
4b. When the UE detects that one or more ProSe Application Code(s)/ProSe
Restricted Code(s) that match the filter (see clause 5.8.1), it reports the
ProSe Application Code(s)/ProSe Restricted Code(s) to the 5G DDNMF as defined
in clause 6.3.1.5.
Non-roaming direct discovery procedures cover the case where both the
\"announcing UE\" and \"monitoring UE\" are served by their respective HPLMN.
Roaming direct discovery procedures cover the other cases.
#### 6.3.1.3 Overall procedure for 5G ProSe Direct Discovery (Model B)
Figure 6.3.1.3-1: Overall procedure for Model B 5G ProSe Direct Discovery
This procedure is applied for restricted 5G ProSe Direct Discovery when the
ProSe enabled UE is served by NG-RAN.
1\. Service authorisation for 5G ProSe Direct Discovery services is performed
as defined in clause 6.2.
If the UE is authorised to perform restricted 5G ProSe Direct Discovery, Model
B, as a Discoveree UE, the following steps take place:
2a. When the UE is triggered to perform restricted 5G ProSe Direct Discovery,
Model B, it sends a discovery request to the 5G DDNMF in the HPLMN to obtain a
ProSe Response Code as defined in clause 6.3.1.4. The 5G DDNMF further
interacts with ProSe Application Server for the authorization of the discovery
request.
3a. If the request is successful and the UE is provided with a ProSe Response
Code and an associated Discovery Query Filter(s), then the UE starts
monitoring for the ProSe Query Code on PC5 interface.
4a. If a received ProSe Query Code matches any of the Discovery Query
Filter(s), the UE announces the associated ProSe Response Code on the PC5
interface.
NOTE 1: More details on the Access Stratum protocol of this step are provided
in RAN specifications.
If the UE is authorised to perform restricted 5G ProSe Direct Discovery, Model
B, as a Discoverer UE, the following steps take place:
2b. When the UE is triggered to perform restricted 5G ProSe Direct Discovery,
Model B, it sends a discovery request to the 5G DDNMF in the HPLMN for a ProSe
Query Code as defined in clause 6.3.1.4. The 5G DDNMF further interacts with
ProSe Application Server for the authorization of the discovery request.
3b. If the request is successful and the UE is provided with a ProSe Query
Code and the Discovery Response Filter(s) consisting of ProSe Response Code(s)
and ProSe Application Mask(s), the UE announces the ProSe Query Code on the
PC5 interface.
4b. The UE starts to monitor on PC5 interface for any ProSe Response Code(s)
that might match the Discovery Response Filter(s).
NOTE 2: More details on the Access Stratum protocol of this step are provided
in RAN specifications.
5b. When the UE detects a match for one or more ProSe Response Code(s), it
reports the ProSe Response Code to the 5G DDNMF as defined in clause 6.3.1.5.
Non-roaming direct discovery procedures cover the case where both the
Discoveree UE and Discoverer UE are served by their respective HPLMN. Roaming
direct discovery procedures cover the other cases.
#### 6.3.1.4 Discovery Request procedures
The Discovery Request procedure can be used by the \"announcing UE\" or
\"monitoring UE\" in order to be authorised to access the discovery resources
and perform 5G ProSe Direct Discovery. The exact signalling procedures
involving the UE, the 5G DDNMFs, and the ProSe Application Server are
specified in TS 23.303 [3] clause 5.3.3, with the following modifications:
\- the 5G DDNMF takes the role of \"ProSe Function\" in the procedure;
\- Upon receiving a Discovery Request for restricted discovery from a UE, if
the 5G DDNMF does not have a valid PDUID for that UE, the 5G DDNMF searches
the PCF for the UE using Nbsf_Management_Subscribe Request and BSF provides
the address of the PCF for the UE in Nbsf_Management_Subscribe Response as
defined in the clause 5.2.13.2.6 in TS 23.502 [5]. The 5G DDNMF gets the PDUID
and subscribes to notifications on Change of PDUID using
Npcf_AMPolicyAuthorization_Subscribe from the PCF for the UE as defined in the
clause 5.2.5.8.6 in TS 23.502 [5], including the SUPI, Event ID set to
\"Change of PDUID\", and immediate reporting flag to indicate that the current
PDUID value should be provided to the consumer. The PCF provides the PDUID and
its validity timer.
NOTE: If the address of the PCF for the UE is changed, the BSF notifies the 5G
DDNMF of the changed PCF address in Nbsf_Management_Notify as defined in the
clause 5.2.13.2.8 in TS 23.502 [5].
\- At the time the PCF generates a new PDUID, if the subscription to \"Change
of PDUID\" is active it sends Npcf_AMPolicyAuthorization_Notify to the 5G
DDNMF to report a new PDUID and its validity timer.
\- the HSS is replaced by UDM;
\- the E-UTRAN is replaced by NG-RAN and E-UTRA is replaced with NR;
\- corresponding 5GS identifiers replace the EPS identifiers, e.g. use SUPI
instead of IMSI, and use GPSI instead of MSISDN;
\- PC5_tech parameter is omitted and the intended PC5 radio technology is NR.
The Discovery Request procedure can also be used by the Discoveree UE or the
Discoverer UE in order to be authorised to access the discovery resources and
perform 5G ProSe Direct Discovery, Model B. The exact signalling procedures
are defined in TS 23.303 [3] clause 5.3.3A, with the same modifications as in
the above list apply.
The events reported by the PCF, described in clause 6.1.3.18 in TS 23.503 [9]
are extended to report \"Change of PDUID\" to the 5G DDNMF.
#### 6.3.1.5 Discovery Reporting procedures
The Discovery Reporting procedure can be used by the \"monitoring UE\" (in
Model A) and Discoverer UE (in Model B) to request the 5G DDNMF to resolve a
matched ProSe Discovery Code(s) (ProSe Application Code for open discovery,
and ProSe Restricted Code for restricted discovery) and obtain the
corresponding ProSe Application ID(s) or RPAUID, and additional information,
e.g. metadata.
The signalling procedures for the \"monitoring UE\" (in Model A) is specified
in TS 23.303 [3] clause 5.3.4, and the signalling procedures for the
Discoverer UE (in Model B) is specified in TS 23.303 [3] clause 5.3.4A, with
the following modifications:
\- the 5G DDNMF takes the role of \"ProSe Function\" in the procedure;
\- the HSS is replaced by UDM;
\- corresponding 5GS identifiers replace the EPS identifiers, e.g. use SUPI
instead of IMSI, and use GPSI instead of MSISDN;
\- PC5_tech parameter is omitted and the intended PC5 radio technology is NR.
#### 6.3.1.6 Announcing Alert Procedures for restricted discovery
When supported by the 5G DDNMF and the UE, the Announcing Alert procedure
allows the 5G DDNMF to postpone the ProSe Restricted Code allocation, so that
the announcing UE would be only triggered by this procedure to announce when
the 5G DDNMF receives a Monitor Request from a UE in the vicinity of the
announcing UE. This procedure is an optional step of the Discovery Request
procedure defined in clause 6.3.1.4.
The signalling procedure of Announcing Alert Procedure is specified in TS
23.303 [3] clause 5.3.5, with the same modifications listed in clause 6.3.1.4.
#### 6.3.1.7 Direct Discovery Update Procedures
The 5G DDNMF can at any time update/revoke a previously allocated ProSe
Application Code, or Discovery Filters. The UE can decide at any time to stop
announcing a ProSe Application Code or monitoring set of Discovery Filter(s).
The Direct Discovery Update procedure as specified in TS 23.303 [3] clause
5.3.6A.1 allows both the 5G DDNMF and the UE to update or revoke the
previously authorized discovery. In the defined signalling procedures, the 5G
DDNMF(s) takes the role of the \"ProSe Function\".
A user may decide at any time to change the discovery permissions relating to
other users in a ProSe Application Server; then the corresponding ProSe
Application Server triggers the procedure as specified in clause 5.3.6A.2 of
TS 23.303 [3] towards the affected 5G DDNMF(s) to update/revoke the discovery
permissions. In the defined signalling procedures, the 5G DDNMF(s) takes the
role of the \"ProSe Function\".
### 6.3.2 5G ProSe Direct Discovery procedures over PC5 reference point
#### 6.3.2.1 General
A PC5 communication channel is used to carry the discovery message over PC5
and the discovery message over PC5 is differentiated from other PC5 messages
by AS layer.
Both Model A and Model B discovery as defined in TS 23.303 [3] are supported:
\- Model A uses a single discovery protocol message (Announcement).
\- Model B uses two discovery protocol messages (Solicitation and Response).
Depicted in figure 6.3.2.1-1 is the procedure for 5G ProSe Direct Discovery
with Model A.
Figure 6.3.2.1-1: 5G ProSe direct discovery with Model A
1\. The Announcing UE sends an Announcement message. The Announcement message
may include the Type of Discovery Message, ProSe Application Code or ProSe
Restricted Code, security protection element, [metadata information]. The
Application layer metadata information may be included as metadata in the
Announcement message.
The Destination Layer-2 ID and Source Layer-2 ID used to send the Announcement
message are specified in clause 5.8.1.2 and clause 5.8.1.3.
The Monitoring UE determines the Destination Layer-2 ID for signalling
reception. The Destination Layer-2 ID is configured with the UE(s) as
specified in clause 5.8.1.2.
Depicted in figure 6.3.2.1-2 is the procedure for 5G ProSe Direct Discovery
with Model B.
Figure 6.3.2.1-2: 5G ProSe direct discovery with Model B
1\. The Discoverer UE sends a Solicitation message. The Solicitation message
may include Type of Discovery Message, ProSe Query Code, security protection
element.
The Destination Layer-2 ID and Source Layer-2 ID used to send the Solicitation
message are specified in clause 5.8.1.2 and clause 5.8.1.3.
How the Discoveree UE determines the Destination Layer-2 ID for signalling
reception is specified in clause 5.8.1.2.
2\. The Discoveree UE that matches the solicitation message responds to the
Discoverer UE with the Response message. The Response message may include Type
of Discovery Message, ProSe Response Code, security protection element,
[metadata information]. The Application layer metadata information may be
included as metadata in the Response message.
The Source Layer-2 ID used to send the Response message is specified in clause
5.8.1.3. The Destination Layer-2 ID is set to the Source Layer-2 ID of the
received Solicitation message.
NOTE: Details of security protection element are specified in TS 33.503 [29].
#### 6.3.2.2 Group Member Discovery
##### 6.3.2.2.1 General
Group Member Discovery is applicable to public safety use and commercial
services. To perform Group Member Discovery, the UE is configured with the
related information as described in clause 5.2.
Group Member Discovery is a form of restricted discovery in that only users
that are affiliated with each other can discover each other (e.g. only users
sharing the same Application Layer Group ID).
In the case of Public Safety use, the ProSe Restricted Code is not used for
Group Member Discovery, and pre-configured or provisioned information for the
Discovery procedures as defined in clause 5.2 is used.
NOTE: The Group Member Discovery performed by Application Layer in
coordination with Application Server is out of scope of this specification.
Both Model A and Model B discovery are supported:
\- Model A uses a single discovery protocol message (Announcement).
\- Model B uses two discovery protocol messages (Solicitation and Response).
##### 6.3.2.2.2 Procedure for Group Member Discovery with Model A
Depicted in Figure 6.3.2.2.2-1 is the procedure for Group Member Discovery
with Model A.
Figure 6.3.2.2.2-1: Group Member Discovery with Model A
1\. The announcing UE sends a Group Member Discovery Announcement message. The
Group Member Discovery Announcement message includes the Type of Discovery
Message, Announcer Info and Application Layer Group ID (See clause 5.8.1).
The Destination Layer-2 ID and Source Layer-2 ID used to send the Group Member
Discovery Announcement message are specified in clause 5.8.1.2 and clause
5.8.1.3.
The Monitoring UE determines the Destination Layer-2 ID for signalling
reception as specified in clause 5.8.1.2.
NOTE: A UE may send multiple Group Member Discovery Announcement messages
(Model A) if the UE belongs to more than one discovery group.
##### 6.3.2.2.3 Procedure for Group Member Discovery with Model B
Depicted in Figure 6.3.2.2.3-1 is the procedure for Group Member Discovery
with Model B.
Figure 6.3.2.2.3-1: Group Member Discovery with Model B
1\. The discoverer UE sends a Group Member Discovery Solicitation message. The
Group Member Discovery Solicitation message includes the Type of Discovery
Message, Discoverer Info, Application Layer Group ID and optionally Target
Info (see clause 5.8.1).
The Destination Layer-2 ID and Source Layer-2 ID used to send the Group Member
Discovery Solicitation message are specified in clause 5.8.1.2 and clause
5.8.1.3.
How the Discoveree UE determines the Destination Layer-2 ID for signalling
reception is specified in clause 5.8.1.2.
2\. The discoveree UEs that match the values of the parameters (including
Application Layer Group ID and Target Info) contained in the solicitation
message, responds to the discoverer UE with a Group Member Discovery Response
message. The Group Member Discovery Response message includes the Type of
Discovery Message, Discoveree Info and Application Layer Group ID (see clause
5.8.1).
The Source Layer-2 ID used to send the Group Member Discovery Response message
is specified in clause 5.8.1.3. The Destination Layer-2 ID is set to the
Source Layer-2 ID of the received Group Member Discovery Solicitation message.
#### 6.3.2.3 5G ProSe UE-to-Network Relay Discovery
##### 6.3.2.3.1 General
5G ProSe UE-to-Network Relay Discovery is applicable to both 5G ProSe Layer-3
and Layer-2 UE-to-Network relay discovery for public safety use and commercial
services. To perform 5G ProSe UE-to-Network Relay Discovery, the 5G ProSe
Remote UE and the 5G ProSe UE-to-Network Relay are pre-configured or
provisioned with the related information as described in clause 5.1.
In 5G ProSe UE-to-Network Relay Discovery, the UEs use pre-configured or
provisioned information for the relay discovery procedures as defined in
clause 5.1.4.1.
The Relay Service Code (RSC) is used in the 5G ProSe UE-to-Network Relay
discovery, to indicate the connectivity service the 5G ProSe UE-to-Network
Relay provides to the 5G ProSe Remote UE. The RSCs are configured on the 5G
ProSe UE-to-Network Relay and the 5G ProSe Remote UE as defined in clause
5.1.4. The 5G ProSe UE-to-Network Relay and the 5G ProSe Remote UE are aware
of whether a RSC is offering 5G ProSe Layer-2 or Layer-3 UE-to-Network Relay
service based the policy as specified in clause 5.1.4. A 5G ProSe UE-to-
Network Relay supporting multiple RSCs can advertise the RSCs using multiple
discovery messages, with one RSC per discovery message.
Additional information not directly used for discovery can also be advertised
using the PC5-D protocol stack in single or separate discovery messages of
type \"Relay Discovery Additional Information\" as defined in clause 5.8.3.1.
##### 6.3.2.3.2 Procedure for 5G ProSe UE-to-Network Relay Discovery with
Model A
Depicted in Figure 6.3.2.3.2-1 is the procedure for 5G ProSe UE-to-Network
Discovery with Model A.
Figure 6.3.2.3.2-1: 5G ProSe UE-to-Network Relay Discovery with Model A
1\. The 5G ProSe UE-to-Network Relay sends a UE-to-Network Relay Discovery
Announcement message. The UE-to-Network Relay Discovery Announcement message
contains the Type of Discovery Message, Announcer Info and RSC, and is sent
using the Source Layer-2 ID and Destination Layer-2 ID as described in clause
5.8.3.
For 5G ProSe Layer-3 UE-to-Network Relay, the 5G ProSe Layer-3 UE-to-Network
Relay shall only include a RSC in the UE-to-Network Relay Discovery
Announcement when the S-NSSAI associated with that RSC belongs to the Allowed
NSSAI of the UE-to-Network Relay.
The 5G ProSe Remote UE (1 to 3) determines the Destination Layer-2 ID for
signalling reception. The Destination Layer-2 ID is configured with the UE(s)
as specified in clause 5.1.4.1.
5G ProSe Remote UE (1 to 3) monitors announcement messages with the 5G ProSe
UE-to-Network RSC corresponding to the desired services.
Optionally, the 5G ProSe UE-to-Network Relay may also send Relay Discovery
Additional Information messages as defined in clause 6.5.1.3. The parameters
contained in this message and the Source Layer-2 ID and Destination Layer-2 ID
used for sending and receiving the message are described in clause 5.8.3.
The 5G ProSe Remote UE selects the 5G ProSe UE-to-Network Relay based on the
information received in step 1.
NOTE: Access Stratum layer information used for 5G ProSe UE-to-Network Relay
selection is specified in RAN specifications.
##### 6.3.2.3.3 Procedure for 5G ProSe UE-to-Network Relay Discovery with
Model B
Depicted in Figure 6.3.2.3.3-1 is the procedure for 5G ProSe UE-to-Network
Relay Discovery with Model B.
Figure 6.3.2.3.3-1: 5G ProSe UE-to-Network Relay Discovery with Model B
1\. The 5G ProSe Remote UE sends a 5G ProSe UE-to-Network Relay Discovery
Solicitation message. The 5G ProSe UE-to-Network Discovery Solicitation
message contains the Type of Discovery Message, Discoverer Info, RSC and
optionally Target Info, and is send using the Source Layer-2 ID and
Destination Layer-2 ID as described in clause 5.8.3. The 5G ProSe Remote UE
discovering a 5G ProSe UE-to-Network Relay sends a solicitation message with
the RSC which is associated to the desired connectivity service. The RSC is
based on the Policy/Parameters specified in clause 5.1.4.1.
How the 5G ProSe UE-to-Network Relays (1 to 3) determine the Destination
Layer-2 ID for signalling reception is specified in clause 5.8.3. The
Destination Layer-2 ID is configured with the UE(s) as specified in clause
5.1.4.1.
2\. The 5G ProSe UE-to-Network Relays (1 and 2) that match the values of the
RSC contained and the Target Info, if any, in the solicitation message respond
to the 5G ProSe Remote UE with a UE-to-Network Relay Discovery Response
message. The 5G ProSe UE-to-Network Relay Discovery Response message contains
the Type of Discovery Message, Discoveree Info and RSC, and is sent using the
Source Layer-2 ID and Destination Layer-2 ID as described in clause 5.8.3.
For 5G ProSe Layer-3 UE-to-Network Relay, the 5G ProSe UE-to-Network Relay
shall only respond to a matching RSC in the UE-to-Network Relay Discovery
Solicitation message when the S-NSSAI associated with that RSC belongs to the
Allowed NSSAI of the 5G ProSe UE-to-Network Relay.
The 5G ProSe Remote UE selects the 5G ProSe UE-to-Network Relay based on the
information received in step 2.
## 6.4 5G ProSe Direct Communication
### 6.4.1 Broadcast mode 5G ProSe Direct Communication
To perform 5G ProSe direct communication over PC5 reference point in broadcast
mode operation, the UE is configured with the related information as described
in clause 5.1.3.
Figure 6.4.1-1 shows the procedure for broadcast mode of 5G ProSe direct
communication over PC5 reference point.
Figure 6.4.1-1: Procedure for Broadcast mode of 5G ProSe direct communication
over PC5 reference point
1\. The ProSe layer of receiving UE(s) determines the following for the
broadcast mode communication reception:
\- the destination Layer-2 ID for broadcast reception as specified in clause
5.8.2.2;
\- the PC5 QoS parameters for this broadcast ProSe service as specified in
clause 5.6.1; and
\- the NR Tx Profile based on the configuration as specified in clause
5.1.3.1.
The destination Layer-2 ID, the NR Tx Profile and the PC5 QoS parameters are
passed down to the AS layer of receiving UE(s) for the reception.
The AS layer of receiving UE(s) determines the PC5 DRX parameter values as
specified in clause 5.13.
2\. The transmitting UE ProSe application layer provides data unit and may
provide ProSe Application Requirements specified in clause 5.6.1 to ProSe
layer.
3\. The ProSe layer of transmitting UE determines the following for the
broadcast mode communication transmission:
\- the destination Layer-2 ID for broadcast as specified in clause 5.8.2.2;
\- the PC5 QoS parameters for this broadcast ProSe service as specified in
clauses 5.6.1; and
\- the NR Tx Profile based on the configuration as specified in clause
5.1.3.1.
The transmitting UE self-assigns the source Layer-2 ID as specified in clause
5.8.2.2.
The source Layer-2 ID, the destination Layer-2 ID, the NR Tx Profile and the
PC5 QoS parameters are passed down to the AS layer of transmitting UE for the
transmission.
The AS layer of transmitting UE determines the PC5 DRX parameter values as
specified in clause 5.13.
4\. The transmitting UE sends the ProSe data using the source Layer-2 ID and
the destination Layer-2 ID.
NOTE: In step 4, there is only one broadcast message from the transmitting UE.
### 6.4.2 Groupcast mode 5G ProSe Direct Communication
Figure 6.4.2-1 shows the procedure for groupcast mode of 5G ProSe Direct
Communication.
Figure 6.4.2-1: Procedure for groupcast mode 5G ProSe Direct communication
Steps 1 to 3 are optional, e.g. applicable for Application Layer managed
group. Groupcast mode ProSe Direct communication can be performed without
steps 1 to 3 based on the provisioned parameters as defined in clause 5.1.3.1.
1\. ProSe Group management is carried out at ProSe application layer. This may
be performed in coordination with ProSe Application Server.
Group Member Discovery parameters as specified in clause 5.1.2.1 can be
provisioned in ME from PCF or configured in UICC or provided from ProSe
Application Server to the UE.
2\. Each UE may perform a ProSe group member discovery (similar to the
procedures in clause 6.3.2.2) that is restricted only to users sharing the
same Application Layer Group ID obtained in step 1.
The Application layer discovery messages including the Application Layer Group
ID for Application Layer managed group may be exchanged between UEs to
discover each other sharing the same Application Layer Group ID. When the
group is formed, the Application layer discovery message including group size
and member ID may be provided by one UE to all other UEs. The Application
layer discovery messages may be included as metadata in a PC5 direct discovery
message.
3\. The ProSe Application layer may provide group identifier information (i.e.
the Application Layer Group ID discovered based on discovery messages
exchanged in step 2) as specified in clause 5.8.2.3.
The ProSe application layer may also provide ProSe Application Requirements
for this communication.
If the ProSe application layer does not provide ProSe Application
Requirements, the ProSe layer determines the PC5 QoS parameters based on the
mapping of ProSe service to PC5 QoS parameters as specified in clause 5.1.3.1.
The ProSe application layer may provide a group size and a member ID
(optionally based on discovery messages exchanged in step 2) as specified in
clause 5.3.3 for Application Layer managed group.
4\. The ProSe layer of transmitting UE self-assigns a source Layer-2 ID and
determines the following for the groupcast mode communication transmission:
\- a destination Layer-2 ID as specified in clauses 5.8.2.1 and 5.8.2.3.
\- The PC5 QoS parameters for this groupcast mode communication as specified
in clause 5.6.1.
\- the NR Tx Profile based on the configuration as specified in clause
5.1.3.1.
The source Layer-2 ID, destination Layer-2 ID, the NR Tx Profile and the PC5
QoS parameters are passed down to the AS layer of transmitting UE for the
groupcast mode communication transmission.
The ProSe layer of receiving UE(s) determines the following for the groupcast
mode communication reception:
\- destination Layer-2 ID as specified in clauses 5.8.2.1 and 5.8.2.3;
\- the PC5 QoS parameters for this groupcast mode communication as specified
in clause 5.6.1; and
\- the NR Tx Profile based on the configuration as specified in clause
5.1.3.1.
The destination Layer-2 ID, the NR Tx Profile and the PC5 QoS parameters are
passed down to the AS layer of receiving UE(s) for the reception.
If the group size and the member ID for Application Layer managed group are
provided by the ProSe application layer, the ProSe layer passes them to the AS
layer as described in clause 5.3.3.
The AS layer of transmitting UE and the AS layer of receiving UE(s) determine
the PC5 DRX parameter values as specified in clause 5.13.
5\. Transmitting UE sends the ProSe data using the source Layer-2 ID and the
destination Layer-2 ID.
NOTE: In step 5, there is only one groupcast message from the transmitting UE.
That is, all receiving UEs can receive the groupcast message directly from the
transmitting UE.
### 6.4.3 Unicast mode 5G ProSe Direct Communication
#### 6.4.3.1 Layer-2 link establishment over PC5 reference point
To perform unicast mode of ProSe Direct communication over PC5 reference
point, the UE is configured with the related information as described in
clause 5.1.3.
Figure 6.4.3.1-1 shows the layer-2 link establishment procedure for the
unicast mode of ProSe Direct communication over PC5 reference point.
Figure 6.4.3.1-1: Layer-2 link establishment procedure
1\. The UE(s) determine the destination Layer-2 ID for signalling reception
for PC5 unicast link establishment as specified in clause 5.8.2.4.
2\. The ProSe application layer in UE-1 provides application information for
PC5 unicast communication. The application information includes the ProSe
Service Info, UE\'s Application Layer ID. The target UE\'s Application Layer
ID may be included in the application information.
The ProSe application layer in UE-1 may provide ProSe Application Requirements
for this unicast communication. UE-1 determines the PC5 QoS parameters and PFI
as specified in clause 5.6.1.
If UE-1 decides to reuse the existing PC5 unicast link as specified in clause
5.3.4, the UE triggers the Layer-2 link modification procedure as specified in
clause 6.4.3.4.
3\. UE-1 sends a Direct Communication Request message to initiate the unicast
layer-2 link establishment procedure. The Direct Communication Request message
includes:
\- Source User Info: the initiating UE\'s Application Layer ID (i.e. UE-1\'s
Application Layer ID).
\- If the ProSe application layer provided the target UE\'s Application Layer
ID in step 2, the following information is included:
\- Target User Info: the target UE\'s Application Layer ID (i.e. UE-2\'s
Application Layer ID).
\- ProSe Service Info: the information about the ProSe identifier(s)
requesting Layer-2 link establishment.
\- Security Information: the information for the establishment of security.
NOTE 1: The Security Information and the necessary protection of the Source
User Info and Target User Info are defined in TS 33.503 [29].
The source Layer-2 ID and destination Layer-2 ID used to send the Direct
Communication Request message are determined as specified in clauses 5.8.2.1
and 5.8.2.4. The destination Layer-2 ID may be broadcast or unicast Layer-2
ID. When unicast Layer-2 ID is used, the Target User Info shall be included in
the Direct Communication Request message.
UE-1 sends the Direct Communication Request message via PC5 broadcast or
unicast using the source Layer-2 ID and the destination Layer-2 ID.
A default PC5 DRX configuration may be used for transmitting and receiving of
this message (see TS 38.300 [12]).
4\. Security with UE-1 is established as below:
4a. If the Target User Info is included in the Direct Communication Request
message, the target UE, i.e. UE-2, responds by establishing the security with
UE-1.
4b. If the Target User Info is not included in the Direct Communication
Request message, the UEs that are interested in using the announced ProSe
Service(s) over a PC5 unicast link with UE-1 responds by establishing the
security with UE-1.
NOTE 2: The signalling for the Security Procedure is defined in TS 33.503
[29].
When the security protection is enabled, UE-1 sends the following information
to the target UE:
\- If IP communication is used:
\- IP Address Configuration: For IP communication, IP address configuration is
required for this link and indicates one of the following values:
\- \"DHCPv4 server\" if only IPv4 address allocation mechanism is supported by
the initiating UE, i.e., acting as a DHCPv4 server; or
\- \"IPv6 Router\" if only IPv6 address allocation mechanism is supported by
the initiating UE, i.e., acting as an IPv6 Router; or
\- \"DHCPv4 server & IPv6 Router\" if both IPv4 and IPv6 address allocation
mechanism are supported by the initiating UE; or
\- \"address allocation not supported\" if neither IPv4 nor IPv6 address
allocation mechanism is supported by the initiating UE.
\- Link-Local IPv6 Address: a link-local IPv6 address formed locally based on
RFC 4862 [17] if UE-1 does not support the IPv6 IP address allocation
mechanism, i.e. the IP Address Configuration indicates\" address allocation
not supported\".
\- QoS Info: the information about PC5 QoS Flow(s). For each PC5 QoS Flow, the
PFI and the corresponding PC5 QoS parameters (i.e. PQI and conditionally other
parameters such as MFBR/GFBR, etc.) and optionally the associated ProSe
identifier(s).
\- Optional PC5 QoS Rule(s).
The source Layer-2 ID used for the security establishment procedure is
determined as specified in clauses 5.8.2.1 and 5.8.2.4. The destination
Layer-2 ID is set to the source Layer-2 ID of the received Direct
Communication Request message.
Upon receiving the security establishment procedure messages, UE-1 obtains the
peer UE\'s Layer-2 ID for future communication, for signalling and data
traffic for this unicast link.
5\. A Direct Communication Accept message is sent to UE-1 by the target UE(s)
that has successfully established security with UE-1:
5a. (UE oriented Layer-2 link establishment) If the Target User Info is
included in the Direct Communication Request message, the target UE, i.e. UE-2
responds with a Direct Communication Accept message if the Application Layer
ID for UE-2 matches.
5b. (ProSe Service oriented Layer-2 link establishment) If the Target User
Info is not included in the Direct Communication Request message, the UEs that
are interested in using the announced ProSe Service(s) respond to the request
by sending a Direct Communication Accept message (UE-2 and UE-4 in Figure
6.4.3.1-1).
The Direct Communication Accept message includes:
\- Source User Info: Application Layer ID of the UE sending the Direct
Communication Accept message.
\- QoS Info: the information about PC5 QoS Flow(s). For each PC5 QoS Flow, the
PFI and the corresponding PC5 QoS parameters requested by UE-1 (i.e. PQI and
conditionally other parameters such as MFBR/GFBR, etc.) and optionally the
associated ProSe identifiers(s).
\- Optional PC5 QoS Rule(s).
\- If IP communication is used:
\- IP Address Configuration: For IP communication, IP address configuration is
required for this link and indicates one of the following values:
\- \" DHCPv4 server \" if only IPv4 address allocation mechanism is supported
by the target UE, i.e., acting as a DHCPv4 server; or
\- \"IPv6 Router\" if only IPv6 address allocation mechanism is supported by
the target UE, i.e., acting as an IPv6 Router; or
\- \"DHCPv4 server & IPv6 Router\" if both IPv4 and IPv6 address allocation
mechanism are supported by the target UE; or
\- \"address allocation not supported\" if neither IPv4 nor IPv6 address
allocation mechanism is supported by the target UE.
\- Link-Local IPv6 Address: a link-local IPv6 address formed locally based on
RFC 4862 [17] if the target UE does not support the IPv6 IP address allocation
mechanism, i.e. the IP Address Configuration indicates \"address allocation
not supported\", and UE-1 included a link-local IPv6 address in the Direct
Communication Request message. The target UE shall include a non-conflicting
link-local IPv6 address.
If both UEs (i.e. the initiating UE and the target UE) are selected to use
link-local IPv6 address, they shall disable the duplicate address detection
defined in RFC 4862 [17].
NOTE 3: When either the initiating UE or the target UE indicates the support
of IPv6 routing, the corresponding address configuration procedure would be
carried out after the establishment of the layer 2 link, and the link-local
IPv6 addresses are ignored.
The ProSe layer of the UE that established PC5 unicast link passes the PC5
Link Identifier assigned for the unicast link and the PC5 unicast link related
information down to the AS layer. The PC5 unicast link related information
includes Layer-2 ID information (i.e. source Layer-2 ID and destination
Layer-2 ID). This enables the AS layer to maintain the PC5 Link Identifier
together with the PC5 unicast link related information.
Two UEs may negotiate the PC5 DRX configuration in the AS layer, and the PC5
DRX parameter values can be configured per pair of source and destination
Layer-2 IDs in the AS layer.
6\. ProSe data is transmitted over the established unicast link as below:
The PC5 Link Identifier and PFI are provided to the AS layer, together with
the ProSe data.
Optionally in addition, the Layer-2 ID information (i.e. source Layer-2 ID and
destination Layer-2 ID) is provided to the AS layer.
NOTE 4: It is up to UE implementation to provide the Layer-2 ID information to
the AS layer.
UE-1 sends the ProSe data using the source Layer-2 ID (i.e. UE-1\'s Layer-2 ID
for this unicast link) and the destination Layer-2 ID (i.e. the peer UE\'s
Layer-2 ID for this unicast link).
NOTE 5: PC5 unicast link is bi-directional, therefore the peer UE of UE-1 can
send the ProSe data to UE-1 over the unicast link with UE-1.
#### 6.4.3.2 Link identifier update for a unicast link
Figure 6.4.3.2-1 shows the link identifier update procedure for a unicast
link. When privacy requirements are configured for a ProSe Identifier
associated with the unicast link, identifiers used for the unicast mode of 5G
ProSe communication over PC5 reference point (e.g. Application Layer ID,
Source Layer-2 ID, and IP address/prefix) shall be changed over time as
specified in clauses 5.8.2.1 and 5.8.2.4. A UE may decide to change the
identifiers for other reasons, e.g. application layer requirement. This
procedure is used to update and exchange new identifiers between the source
and the peer UEs for a unicast link before using the new identifiers, to
prevent service interruptions. When there are privacy requirements as
indicated above, this procedure is executed over a security protected unicast
link.
If a UE has multiple unicast links using the same Application Layer IDs or
Layer-2 IDs, the UE needs to perform the link identifier update procedure over
each of the unicast links.
Figure 6.4.3.2-1: Link identifier update procedure
0\. UE-1 and UE-2 have a unicast link established as described in clause
6.4.3.1.
1\. UE-1 decides to change its identifier(s), e.g. due to the Application
Layer ID change or upon expiry of a timer. UE-1 generates its new Layer-2 ID
and sends a Link Identifier Update Request message to UE-2 using the old
identifiers.
The Link Identifier Update Request message includes the new identifier(s) to
use (including the new Layer-2 ID, Security Information, optionally the new
Application Layer ID, and optionally new IP address/prefix if IP communication
is used). The new identifier(s) shall be cyphered to protect privacy if
security is configured for the unicast link. After sending the Link Identifier
Update Request message, if the UE-1 has data to send, UE-1 keeps sending data
traffic to UE-2 with the old identifiers until UE-1 sends the Link Identifier
Update Ack message to UE-2.
NOTE 1: The timer is running on per Source Layer-2 ID.
NOTE 2: When one of the two UEs acts as IPv6 router as described in clause
5.5.1.1 and the IP address/prefix also needs to be changed, the corresponding
address configuration procedure would be carried out after the Link Identifier
update procedure.
2\. Upon reception of the Link Identifier Update Request message, UE-2 changes
its identifier(s). UE-2 responds with a Link Identifier Update Response
message which includes the new identifier(s) to use (including the new Layer-2
ID, Security Information, optionally the new Application Layer ID, and
optionally a new IP address/prefix if IP communication is used). The new
identifier(s) shall be cyphered to protect privacy if security is configured
for the unicast link. The Link Identifier Update Response message is sent
using the old identifiers. UE-2 continues to receive traffic with the old
Layer-2 ID from UE-1 until UE-2 receives traffic with the new Layer-2 ID from
UE-1. After sending the Link Identifier Update Response message, UE-2 keeps
sending data traffic to UE-1 with the old identifier, if UE-2 has data to
send, until UE-2 receives the Link Identifier Update Ack message from UE-1.
3\. Upon reception of the Link Identifier Update Response message, UE-1
responds with a Link Identifier Update Ack message. The Link Identifier Update
Ack message includes the new identifier(s) from UE-2, as received on the Link
Identifier Update Response message. The Link Identifier Update Ack message is
sent using the old identifiers. UE-1 continues to receive traffic with the old
Layer-2 ID from UE-2 until UE-1 receives traffic with the new Layer-2 ID from
UEâ€‘2.
4\. The ProSe layer of UE-1 passes the PC5 Link Identifier for the unicast
link and the updated Layer-2 IDs (i.e. new Layer-2 ID for UE-1 for the source
and new Layer-2 ID of UE-2 for the destination) down to the AS layer. This
enables the AS layer to update the provided Layer-2 IDs for the unicast link.
UE-1 starts using its new identifiers and UE-2\'s new identifiers for this
unicast link.
5\. Upon reception of the Link Identifier Update Ack message, the ProSe layer
of UE-2 passes the PC5 Link Identifier for the unicast link and the updated
Layer-2 IDs (i.e. new Layer-2 ID of UE-2 for the source and new Layer-2 ID for
UE-1 for the destination) down to the AS layer. This enables the AS layer to
update the provided Layer-2 IDs for the unicast link.
UE-2 starts using its new identifiers and UE-1\'s new identifiers for this
unicast link.
NOTE 3: The Security Information in the above messages also needs to be
updated at the same time as the Layer-2 IDs. This is defined in TS 33.503
[29].
#### 6.4.3.3 Layer-2 link release over PC5 reference point
Figure 6.4.3.3-1 shows the layer-2 link release procedure over PC5 reference
point.
Figure 6.4.3.3-1: Layer-2 link release procedure
0\. UE-1 and UE-2 have a unicast link established as described in clause
6.4.3.1.
1\. UE-1 sends a Disconnect Request message to UE-2 in order to release the
layer-2 link and deletes all context data associated with the layer-2 link.
The Disconnect Request message includes Security Information.
2\. Upon reception of the Disconnect Request message, UE-2 shall respond with
a Disconnect Response message and deletes all context data associated with the
layer-2 link. The Disconnect Response message includes Security Information.
The ProSe layer of each UE informs the AS layer that the unicast link has been
released. The ProSe layer uses PC5 Link Identifier to indicate the released
unicast link. This enables the AS layer to delete the context related to the
released unicast link.
NOTE: The Security Information in the above messages is defined in TS 33.503
[29].
#### 6.4.3.4 Layer-2 link modification for a unicast link
Figure 6.4.3.4-1 shows the layer-2 link modification procedure for a unicast
link. This procedure is used to:
\- add new PC5 QoS Flow(s) in the existing PC5 unicast link.
\- This covers the case for adding new PC5 QoS Flow(s) to the existing ProSe
service(s) as well as the case for adding new PC5 QoS Flow(s) to new ProSe
service(s).
\- modify existing PC5 QoS Flow(s) in the existing PC5 unicast link.
\- This covers the case for modifying the PC5 QoS parameters for existing PC5
QoS Flow(s).
\- This also covers the case for removing the associated ProSe service(s) from
existing PC5 QoS Flow(s) as well as the case for associating new ProSe
service(s) with existing PC5 QoS Flow(s).
\- remove existing PC5 QoS Flow(s) in the existing PC5 unicast link.
Figure 6.4.3.4-1: Layer-2 link modification procedure
0\. UE-1 and UE-2 have a unicast link established as described in clause
6.4.3.1.
1\. The ProSe application layer in UE-1 provides application information for
PC5 unicast communication. The application information includes the ProSe
Service Info and the initiating UE\'s Application Layer ID. The target UE\'s
Application Layer ID may be included in the application information. If UE-1
decides to reuse the existing PC5 unicast link as specified in clause 5.3.4,
so decides to modify the unicast link established with UE-2, UE-1 sends a Link
Modification Request to UE-2.
The Link Modification Request message includes:
a) To add new PC5 QoS Flow(s) in the existing PC5 unicast link:
\- QoS Info: the information about PC5 QoS Flow(s) to be added. For each PC5
QoS Flow, the PFI, the corresponding PC5 QoS parameters (i.e. PQI and
conditionally other parameters such as MFBR/GFBR, etc.) and optionally the
associated ProSe identifier(s).
\- Optional PC5 QoS Rule(s).
b) To modify PC5 QoS Flow(s) in the existing PC5 unicast link:
\- QoS Info: the information about PC5 QoS Flow(s) to be modified. For each
PC5 QoS Flow, the PFI, the corresponding PC5 QoS parameters (i.e. PQI and
conditionally other parameters such as MFBR/GFBR, etc.) and optionally the
associated ProSe identifier(s).
\- Optional PC5 QoS Rule(s).
c) To remove PC5 QoS Flow(s) in the existing PC5 unicast link:
\- PFIs.
2\. UE-2 responds with a Link Modification Accept message.
The Link Modification Accept message includes:
\- For case a) and case b) described in step 1:
\- QoS Info: the information about PC5 QoS Flow(s) requested by UE-1. For each
PC5 QoS Flow, the PFI, the corresponding PC5 QoS parameters (i.e. PQI and
conditionally other parameters such as MFBR/GFBR, etc.) and optionally the
associated ProSe identifier(s).
\- Optional PC5 QoS Rule(s).
The ProSe layer of each UE provides information about the unicast link
modification to the AS layer. This enables the AS layer to update the context
related to the modified unicast link.
#### 6.4.3.5 Layer-2 link maintenance over PC5 reference point
The PC5 Signalling Protocol shall support keep-alive functionality that is
used to detect if a particular PC5 unicast link is still valid. Either side of
the PC5 unicast link can initiate the layer-2 link maintenance procedure (i.e.
keep-alive procedure), based on for example triggers from the AS layer or
internal timers. The UEs shall minimize the keep-alive signalling, e.g. cancel
the procedure if data are successfully received over the PC5 unicast link.
Figure 6.4.3.5-1: Layer-2 link maintenance procedure
0\. UE-1 and UE-2 have a unicast link established as described in clause
6.4.3.1.
1\. Based on trigger conditions, UE-1 sends a Keep-alive message to UE-2 in
order to determine the status of the PC5 unicast link.
NOTE 1: It is left to Stage 3 to determine the exact triggers for the keep-
alive messages. For example, the trigger can be based on a timer associated
with the Layer-2 link. The timer can be reset with a successful reception
event defined by TS 38.300 [12].
2\. Upon reception of the Keep-alive message, UE-2 responds with a Keep-alive
Ack message.
The UE initiating the keep-alive procedure shall determine the follow-up
actions based on the result of the signalling, e.g. proceed with implicit
layer-2 link release.
NOTE 2: It is left to Stage 3 to determine the follow-up actions. For example,
a successful reception event can also cancel the layer-2 link release if
received in time.
#### 6.4.3.6 Layer-2 link management over PC5 reference point for 5G ProSe UE-
to-Network Relay
The Layer-2 link procedures over PC5 reference point for unicast mode 5G ProSe
Direct Communication as depicted from clause 6.4.3.1 to clause 6.4.3.5 can be
used for the PC5 reference point between 5G ProSe Remote UE and 5G ProSe UE-
to-Network Relay, with the following differences and clarifications:
\- The Layer-2 link modification procedure is applicable to ProSe
Communication via 5G ProSe Layer-3 UE-to-Network Relay, other procedures are
applicable to both ProSe Communication via 5G ProSe Layer-2 UE-to-Network
Relay and ProSe Communication via 5G ProSe Layer-3 UE-to-Network Relay.
\- The UE oriented Layer-2 link establishment is used with UE-1 representing
the 5G ProSe Remote UE and UE-2 representing the 5G ProSe UE-to-Network Relay.
For other procedures either UE-1 represents the 5G ProSe Remote UE and UE-2
represents the 5G ProSe UE-to-Network Relay, or UE-1 represents the 5G ProSe
UE-to-Network Relay and UE-2 represents the 5G ProSe Remote UE. I.e. the
Layer-2 link establishment is initiated by the 5G ProSe Remote UE, while other
procedures may be initiated either by the 5G ProSe Remote UE or by the 5G
ProSe UE-to-Network Relay.
For the UE oriented Layer-2 link establishment as described in the clause
6.4.3.1,
\- In step 1, the 5G ProSe Remote UE determines the destination Layer-2 ID for
PC5 unicast link establishment based on the unicast source Layer-2 ID of the
selected 5G ProSe UE-to-Network Relay (as specified in clause 5.8.3) during
UE-to-Network Relay discovery as specified in clause 6.3.2.3.
\- In step 2, 5G ProSe Remote UE (UE-1) determines the Relay Service Code to
be used. The Relay Service Code to be used is selected from the received Relay
Service Code(s) during UE-to-Network Relay discovery as specified in clause
6.3.2.3.
\- In step 3, 5G ProSe Remote UE (UE-1) sends a unicast Direct Communication
Request message to the selected 5G ProSe UE-to-Network Relay. The destination
Layer-2 ID used to send the Direct Communication Request message shall be
unicast Layer-2 ID as determined in step 1. The Direct Communication Request
message includes:
\- Source User Info: the identity of the Remote UE requesting relay operation
(i.e. User Info ID).
NOTE 1: The details of which additional identity/identities of the Remote UE
to be included during Layer-2 link establishment are specified in TS 33.503
[29].
\- Target User Info: the identity of the UE-to-Network Relay provided to the
5G ProSe Remote UE during UE-to-Network Relay Discovery procedure (i.e. User
Info ID).
\- Relay Service Code: indicates the connectivity service provided by the 5G
ProSe UE-to-Network Relay as requested by the 5G ProSe Remote UE.
\- Security Information: the information for the establishment of security.
\- In step 4 and step 5, step 4a and step 5a are performed if the 5G ProSe UE-
to-Network Relay\'s identity matches the Target User Info and the Relay
Service Code is one of the Relay Service Codes included during UE-to-Network
Relay discovery as specified in clause 6.3.2.3. The Source User Info in the
Direct Communication Accept message is the identity of the UE-to-Network Relay
(i.e. User Info ID). In the case of 5G ProSe Layer-2 UE-to-Network Relay, the
Remote UE does not send the IP Address Configuration, Link-Local IPv6 Address
and QoS Info to the 5G ProSe Layer-2 UE-to-Network Relay, and the Direct
Communication Accept message does not include IP Address Configuration, Link-
Local IPv6 Address and QoS Info. In the case of 5G ProSe Layer-3 UE-to-Network
Relay, the Direct Communication Accept message does not include the IP Address
Configuration indicating the value \"address allocation not supported\".
\- In the case of 5G ProSe Layer-2 UE-to-Network Relay, step 6 is not
performed.
For the link identifier update as described in the clause 6.4.3.2,
\- Application Layer ID is replaced by User Info ID.
\- In the case of 5G ProSe Layer-2 UE-to-Network Relay, the changed
identifiers do not include IP address/prefix.
For the Layer-2 link release as described in the clause 6.4.3.3,
\- In step1, if the Layer-2 link release procedure is initiated by the 5G
ProSe UE-to-Network Relay, the Disconnect Request message may indicate the 5G
ProSe UE-to-Network Relay is temporarily not available as described in clause
5.12.
NOTE 2: The form of the temporarily not available indication will be
determined by stage 3.
\- If the service authorization for acting as a 5G ProSe Remote UE or as a 5G
ProSe UE-to-Network Relay is revoked, the 5G ProSe Remote UE or the 5G ProSe
UE-to-Network Relay should initiate the release of the layer-2 link that the
revoked authorization affects.
\- A 5G ProSe Layer-2 Remote UE or a 5G ProSe Layer-2 UE-to-Network Relay
initiates the release of the layer-2 link upon receiving an indication from
its AS layer to trigger PC5 unicast link release as specified in TS 38.331
[16].
NOTE 3: The timing to initiates layer-2 link release is up to UE
implementation.
A 5G ProSe Remote UE and a 5G ProSe UE-to-Network Relay shall set up a
separate PC5 unicast links if an existing unicast link(s) was established with
a different Relay Service Code or without a Relay Service Code.
NOTE 4: A single PC5 unicast link is established between a 5G ProSe Layer-2
UE-to-Network Relay and a 5G ProSe Layer-2 Remote UE, as specified in TS
38.300 [12], for supporting PDU sessions of the 5G ProSe Layer-2 Remote UE.
Each PC5 unicast link for 5G ProSe UE-to-Network Relay is associated with a
Unicast Link Profile, which includes:
\- User Info ID and Layer-2 ID of 5G ProSe Remote UE; and
\- User Info ID and Layer-2 ID of 5G ProSe UE-to-Network Relay; and
\- Relay Service Code; and
\- In the case of 5G ProSe Layer-3 UE-to-Network Relay, the network layer
protocol and the information about PC5 QoS Flow(s).
The Unicast Link Profile shall be updated accordingly after a Layer-2 link
modification or Layer-2 link identifier update.
## 6.5 5G ProSe UE-to-Network Relay Communication
### 6.5.1 5G ProSe Communication via 5G ProSe Layer-3 UE-to-Network Relay
#### 6.5.1.1 5G ProSe Communication via 5G ProSe Layer-3 UE-to-Network Relay
without N3IWF
A 5G ProSe Layer-3 UE-to-Network Relay registers to the network (if not
already registered). 5G ProSe Layer-3 UE-to-Network Relay establishes a PDU
Session(s) or modifies an existing PDU Session(s) in order to provide relay
traffic towards 5G ProSe Layer-3 Remote UE(s). PDU Session(s) supporting 5G
ProSe Layer-3 UE-to-Network Relay shall only be used for 5G ProSe Layer-3
Remote UE(s) relay traffic.
The PLMN serving the 5G ProSe Layer-3 UE-to-Network Relay and the PLMN to
which the 5G ProSe Layer-3 Remote UE registers can be the same PLMN or two
different PLMNs.
Figure 6.5.1.1-1: 5G ProSe Communication via 5G ProSe Layer-3 UE-to-Network
Relay without N3IWF
1\. Service authorization and provisioning are performed for the 5G ProSe
Layer-3 UE-to-Network Relay (step 1a) and 5G ProSe Layer-3 Remote UE (step 1b)
as described in clause 6.2.
2\. The 5G ProSe Layer-3 UE-to-Network Relay may establish a PDU Session for
relaying. In the case of IPv6, the 5G ProSe Layer-3 UE-to-Network Relay
obtains the IPv6 prefix via prefix delegation function from the network as
defined in TS 23.501 [4].
NOTE 1: 5G ProSe Layer-3 UE-to-Network Relay can establish a PDU Session for
any Relay Service Code it supports before the connection is established with
the 5G ProSe Layer-3 Remote UE.
3\. The 5G ProSe Layer-3 Remote UE performs discovery of a 5G ProSe Layer-3
UE-to-Network Relay as described in clause 6.3.2.3. As part of the discovery
procedure the 5G ProSe Layer-3 Remote UE learns about the connectivity service
the 5G ProSe Layer-3 UE-to-Network Relay provides.
4\. The 5G ProSe Layer-3 Remote UE selects a 5G ProSe Layer-3 UE-to-Network
Relay and establishes a connection for unicast mode communication as described
in clause 6.4.3.6. If there is no PDU Session associated with the Relay
Service Code or a new PDU Session for relaying is needed, the 5G ProSe Layer-3
UE-to-Network Relay initiates a new PDU Session establishment procedure for
relaying before completing the PC5 connection establishment.
The network decides that the PDU session to be established is for relay
traffic, and then generates the QoS rules and QoS Flow level QoS parameters to
5G ProSe Layer-3 UE-to-Network Relay with relay consideration and can initiate
the setup of QoS flows as specified in clause 5.6.2.1. The Remote UE can also
initiate the setup of QoS flows by providing PC5 QoS info and (optionally) PC5
QoS rule(s) to the 5G ProSe Layer-3 UE-to-Network Relay during connection
setup, according to the procedure as specified in clause 5.6.2.1.
The 5G ProSe Layer-3 UE-to-Network Relay determines the PDU Session type for
relaying as specified in clause 5.4.1.1.
According to the PDU Session Type for relaying, the 5G ProSe Layer-3 UE-to-
Network Relay performs relaying function at the corresponding layer as
follows:
\- When the IP type PDU Session is used for IP traffic over PC5 reference
point, the 5G ProSe Layer-3 UE-to-Network Relay acts as an IP router. For
IPv4, the 5G ProSe Layer-3 UE-to-Network Relay performs IPv4 NAT between IPv4
addresses assigned to the 5G ProSe Layer-3 Remote UE and the IPv4 address
assigned to the PDU Session used for the relay traffic.
\- When the Ethernet type PDU Session is used for Ethernet traffic over PC5
reference point, the 5G ProSe Layer-3 UE-to-Network Relay acts as an Ethernet
switch.
\- When the Unstructured type PDU Session is used for Unstructured traffic
over PC5 reference point, the 5G ProSe Layer-3 UE-to-Network Relay performs
traffic relaying based on a mapping between the PC5 Link Identifier and the
PDU Session ID, and a mapping between PFI for PC5 Layer-2 link and the QFI for
the PDU Session. These mappings are created when the Unstructured type PDU
Session is established for the 5G ProSe Layer-3 Remote UE.
\- When the IP type PDU Session is used for Ethernet or Unstructured traffic
over PC5 reference point, the 5G ProSe Layer-3 UE-to-Network Relay uses IP
tunneling. For this IP tunnelling, the 5G ProSe Layer-3 UE-to-Network Relay
locally assigns an IP address/prefix for the 5G ProSe Layer-3 Remote UE and
uses it on the Uu reference point to encapsulate and decapsulate the uplink
and downlink traffic for the 5G ProSe Layer-3 Remote UE. The tunnelled traffic
over Uu reference point is transported over the PC5 reference point as
Ethernet or Unstructured traffic.
5\. For IP PDU Session Type and IP traffic over PC5 reference point, IPv6
prefix or IPv4 address (including NAT case) is allocated for the 5G ProSe
Layer-3 Remote UE as defined in clause 5.5.1.3.
6\. The 5G ProSe Layer-3 Remote UE may provide PC5 QoS Info and PC5 QoS
rule(s) to the 5G ProSe Layer-3 UE-to-Network Relay using Layer-2 link
modification procedure as specified in clause 6.4.3.4. The 5G ProSe Layer-3
UE-to-Network Relay generates the Packet Filters used over Uu interface based
on the received PC5 QoS Info and QoS Rule(s) as described in clause 5.6.2.1,
and may perform the UE requested PDU Session Modification as defined in TS
23.502 [5] clause 4.3.3 to setup a new QoS Flow or bind the traffic to an
existing QoS Flow.
From this point the uplink and downlink relaying can start. For downlink
traffic forwarding, the PC5 QoS Rule is used to map the downlink packet to the
PC5 QoS Flow. For uplink traffic forwarding, the 5G QoS Rule is used to map
the uplink packet to the Uu QoS Flow.
7\. The 5G ProSe Layer-3 UE-to-Network Relay shall send a Remote UE Report
(Remote User ID, Remote UE info) message to the SMF for the PDU Session
associated with the relay. The Remote User ID, as defined in TS 33.503 [29],
is an identity of the 5G ProSe Layer-3 Remote UE user that was successfully
connected in step 4. The Remote UE info is used to assist identifying the 5G
ProSe Layer-3 Remote UE in the 5GC. For IP PDU Session Type, the Remote UE
info is Remote UE IP info. For Ethernet PDU Session Type, the Remote UE info
is Remote UE MAC address which is detected by the 5G ProSe Layer-3 UE-to-
Network Relay. For Unstructured PDU Session Type, the Remote UE info is not
included. The SMF stores the Remote User IDs and the related Remote UE info in
the 5G ProSe Layer-3 UE-to-Network Relay\'s SM context for this PDU Session
associated with the relay.
The Remote UE Report is N1 SM NAS message sent with the PDU Session ID to the
AMF, in turn delivered to the SMF.
NOTE 2: The privacy protection for Remote User ID is specified in TS 33.503
[29].
For IP info the following principles apply:
\- for IPv4, the 5G ProSe Layer-3 UE-to-Network Relay shall report TCP/UDP
port ranges assigned to individual 5G ProSe Layer-3 Remote UE(s) (along with
the Remote User ID);
\- for IPv6, the 5G ProSe Layer-3 UE-to-Network Relay shall report IPv6
prefix(es) assigned to individual 5G ProSe Layer-3 Remote UE(s) (along with
the Remote User ID).
If the PDU Session for relaying is released by the UE-to-Network Relay or the
network as described in clause 4.3.4 of TS 23.502 [5], the UE-to-Network Relay
should initiate the release of the layer-2 links associated with the released
PDU Session using the procedure defined in clause 6.4.3.3.
The PDU Session(s) used for relaying should be released as described in clause
4.3.4 of TS 23.502 [5] (e.g. by 5G ProSe Layer-3 UE-to-Network Relay), if the
service authorization for acting as a 5G ProSe Layer-3 UE-to-Network Relay in
the serving PLMN is revoked.
The 5G ProSe Layer-3 UE-to-Network Relay shall send the Remote UE Report
message when the 5G ProSe Layer-3 Remote UE disconnects from the 5G ProSe
Layer-3 UE-to-Network Relay (e.g. upon explicit layer-2 link release or based
on the absence of keep alive messages over PC5) to inform the SMF that the 5G
ProSe Layer-3 Remote UE(s) have left.
NOTE 3: In order for the SMF to have the 5G ProSe Layer-3 Remote UE(s)
information, the HPLMN and the VPLMN where the 5G ProSe Layer-3 UE-to-Network
Relay is authorised to operate, needs to support the transfer of the 5G ProSe
Layer-3 Remote UE related parameters if the SMF is in the HPLMN.
It is up to 5G ProSe Layer-3 UE-to-Network Relay implementation how PDU
Session(s) used for relaying are released or QoS Flow(s) used for relaying are
removed by the 5G ProSe Layer-3 UE-to-Network Relay when 5G ProSe Layer-3
Remote UE(s) disconnect from the 5G ProSe Layer-3 UE-to-Network Relay.
#### 6.5.1.2 5G ProSe Communication via 5G ProSe Layer-3 UE-to-Network Relay
with N3IWF support
##### 6.5.1.2.1 Connection management via 5G ProSe Layer-3 UE-to-Network Relay
with N3IWF support
In order to relay 5G ProSe Layer-3 Remote UE\'s traffic via N3IWF, the 5G
ProSe Layer-3 UE-to-Network Relay needs suitable ProSe Policies configured for
establishing a PDU Session associated with a UPF that conveys the traffic
towards the N3IWF.5G ProSe Layer-3 UE-to-Network Relay registers to the
network as specified in clause 6.5.1.1. Based on configuration and
authorization, the 5G ProSe Layer-3 UE-to-Network Relay is provisioned with
PDU Session parameters in the ProSe Policy allowing the access to the N3IWF.
When the corresponding PDU Session is established, the 5GS, e.g. SMF, based on
the parameters (i.e. DNN, S-NSSAI) selects the UPF that ensures the connection
to the N3IWF. The UPF for the 5G ProSe UE-to-Network Relay and the N3IWF may
be collocated.
A 5G ProSe Layer-3 UE-to-Network Relay with a PDU Session providing access via
N3IWF may also have other PDU Sessions for supporting access from the 5G ProSe
Layer-3 Remote UE without going through a N3IWF.
NOTE 1: Whether a different PDU Sessions need to be established to serve
traffics for Layer-3 Remote UE with or without going through a N3IWF is
determined by Layer-3 Relay UE per TS 23.503 [9].
Figure 6.5.1.2.1-1: Connection establishment over 5G ProSe Layer-3 UE-to-
Network Relay with N3IWF support
1\. 5G ProSe Layer-3 UE-to-Network Relay performs Registration procedures and
obtains the ProSe Policy that corresponds to the operation supporting the
access to N3IWF. The ProSe Policy includes the RSC and PDU Session parameters
allowing the access to the N3IWF.
The 5G ProSe Layer-3 Remote UE is configured with the corresponding ProSe
Policy and URSP rules. The URSP policy indicates if a particular service needs
to be accessed within a PDU Session and thus should use a 5G ProSe Layer-3 UE-
to-Network Relay with N3IWF support as described in clause 6.5.4.
2-4. A 5G ProSe Layer-3 UE-to-Network Relay and 5G ProSe Layer-3 Remote UE
follow the procedures described in steps 3-5 in clause 6.5.1.1 using the RSC
configured for making the 5G ProSe Layer-3 Remote UE access to 5GC via N3IWF.
NOTE 2: The services requiring the access via N3IWF can be configured with the
RSC(s) that can be served by the same 5G ProSe UE-to-Network Relay.
5\. The 5G ProSe Layer-3 Remote UE that connects to a 5G ProSe Layer-3 UE-to-
Network Relay with N3IWF support selects an N3IWF and determines the N3IWF IP
address. The 5G ProSe Layer-3 Remote UE follows the N3IWF selection procedure
as described in clause 6.5.1.2.2.
6\. The 5G ProSe Layer-3 Remote UE establishes a signalling IPsec tunnel using
IKE procedures with a N3IWF and performs NAS Registration as shown in Figure
4.12.2.2-1 of TS 23.502 [5]. After the IPSec tunnel is established, the 5G
ProSe Layer-3 Remote UE can perform any of the NAS procedures (incl. PDU
Session establishment for the 5G ProSe Layer-3 UE-to-Network Relay PDU
Sessions) as specified in clause 4.12 of TS 23.502 [5].
7\. After the PDU session(s) and associated QoS Flows are established in the
5G ProSe Layer-3 Remote UE\'s 5GC, the N3IWF determines the number of IPsec
Child SA(s) that is needed and initiates the creation of the Child SA(s) as
specified in clause 4.12.5 of TS 23.502 [5]. Once the Child SA(s) has been
created the 5G ProSe Layerâ€‘3 Remote UE will have the mapping between the DSCP
markings for the IPsec Child SA(s), the corresponding QoS, and N3IWF IP
address(es) and provides this information, if needed, to the 5G ProSe Layer-3
UE-to-Network Relay as specified in clause 5.6.2.2. If needed, the 5G ProSe
Layer-3 UE-to-Network Relay performs the PDU Session Modification procedure to
request QoS flow(s) configuration that maps to the 5G ProSe Layer-3 Remote
UE\'s Child SA(s).
IKE keep alive(s) between the 5G ProSe Layer-3 Remote UE and the N3IWF are
used for detecting possible path failure. The 5G ProSe Layer-3 Remote UE may
change 5G ProSe Layer-3 UE-to-Network Relay(s) while maintain the session with
the N3IWF when the 5G ProSe Layer-3 Remote UE and the N3IWF support MOBIKE.
This is negotiated between the 5G ProSe Layer-3 Remote UE and the N3IWF as
specified in TS 23.502 [5], clause 4.12.2.2). When IKE keep alive(s) are used,
the 5G ProSe Layer-3 Remote UE needs to keep the PC5 connection and 5G ProSe
Layer-3 UE-to-Network Relay keeps the PDU Session.
When 5G ProSe Remote UE is in CM-CONNECTED state, the 5G ProSe Remote UE keeps
the PC5 link. When the 5G ProSe Remote UE is in CM-IDLE state, it may either
release the PC5 link for relaying or not.
##### 6.5.1.2.2 N3IWF selection for 5G ProSe Layer-3 Remote UE procedure
When the 5G ProSe Layer-3 Remote UE relays traffic over 5G ProSe Layer-3 UE-
to-Network Relay that supports N3IWF, the 5G ProSe Layer-3 Remote UE selects
the N3IWF using the N3IWF selection procedure that is specified in clause
6.3.6.2 of TS 23.501 [4] for untrusted non-3GPP access with the following
differences.
To support the N3IWF selection for 5G ProSe Layer-3 Remote UE, a 5G ProSe
Layer-3 Remote UE is configured by HPLMN with N3IWF identifier configuration
for 5G ProSe Layer-3 Remote UE and 5G ProSe Layer-3 UE-to-Network Relay access
node selection information as described in clause 5.1.4.1.
When the 5G ProSe Layer-3 Remote UE decides to select an N3IWF in the HPLMN,
the 5G ProSe Layer-3 Remote UE uses the N3IWF identifier configuration for 5G
ProSe Layer-3 Remote UE, if configured, to find the IP address of the N3IWF in
the HPLMN. Otherwise, 5G ProSe Layer-3 Remote UE constructs N3IWF FQDN based
on either the Tracking Area Identity FQDN or on Operator Identifier FQDN of
the 5G ProSe Layer-3 UE-to-Network Relay node selection information.
To assist the 5G ProSe Layer-3 Remote UE with N3IWF selection, the 5G ProSe
Layer-3 UE-to-Network Relay supporting N3IWF access advertises the 5GS TAI
corresponding to the serving cell, as defined in clause 5.8.3.2, in the 5G
ProSe UE-to-Network Relay Discovery procedure as defined in clause 6.3.2.3.
A 5G ProSe Layer-3 Remote UE constructs the FQDN using either Tracking Area
Identity FQDN or on Operator Identifier FQDN and selects the N3IWF using the
procedures of N3IWF selection in clause 6.3.6.2 of TS 23.501 [4].
##### 6.5.1.2.3 Mobility of 5G ProSe Layer-3 Remote UE between Direct and
Indirect Network communication path
When 5G ProSe Layer-3 Remote UE changes from Direct Network Communication to
Indirect Network Communication path, TS 23.502 [5] clause 4.9.2.2 applies
after the 5G ProSe Layer-3 Remote UE establishes PC5 connection to the 5G
Layer-3 UE-to-Network Relay.
When 5G ProSe Layer-3 Remote UE changes from Indirect Network Communication
path to Direct Network Communication, the 5G ProSe Layer-3 Remote UE follows
TS 23.502 [5] clause 4.9.2.1.
#### 6.5.1.3 Additional parameters announcement procedure
Additional parameters announcement procedure outlined in figure 6.5.1.3-1 is
used by a 5G ProSe Remote UE to request a 5G ProSe UE-to-Network Relay to
announce additional parameters (for model A) as defined in clause 5.8.3.
Figure 6.5.1.3-1: Additional parameters announcement procedure
1\. 5G ProSe Remote UE has discovered a 5G ProSe UE-to-Network Relay and
requires additional parameters.
2\. The 5G ProSe Remote UE sends to the 5G ProSe UE-to-Network Relay an
Additional Parameters Announcement Request to obtain additional parameters.
3\. The 5G ProSe UE-to-Network Relay acknowledges receipt of the request in
step 2 with an Additional Parameters Announcement Response
(Additional_Parameters_Announcement_Request_Refresh Timer). The
Additional_Parameters_Announcement_Request_Refresh Timer (configurable in the
5G ProSe UE-to-Network Relay), is provided to the 5G ProSe Remote UE so that
when this timer expires the 5G ProSe Remote UE repeats the Additional
Parameters Announcement Request procedure if it still needs to obtain the
additional parameters. If the 5G ProSe Remote UE does not initiate new
Additional Parameters Announcement Request procedure when this
Additional_Parameters_Announcement_Request_Refresh Timer expires and no other
UE request additional parameters announcement before the
Additional_Parameters_Announcement_Request_Refresh timer expires in the 5G
ProSe UE-to-Network Relay, then the relay shall stop announcing the addtional
parameters.
4\. The 5G ProSe UE-to-Network Relay announces the additional parameters by
sending Relay Discovery Additional Information message as defined in clause
5.8.3. This is repeated periodically with a configurable frequency (normally
higher than the one related to the
Additional_Parameters_Announcement_Request_Refresh Timer) until there is no UE
requesting to announce the additional parameters as determined by the
Additional_Parameters_Announcement_Request_Refresh Timer running in the 5G
ProSe UE-to-Network Relay.
NOTE: Based on UE implementation, the 5G ProSe UE-to-Network Relay can send
the Relay Discovery Additional Information message several times consecutively
in step 4 if there are other 5G ProSe Remote UE(s) that have connected to the
5G ProSe UE-to-Network Relay but not yet requested any additional parameters.
This ensures the other 5G ProSe Remote UE(s) obtain such additional parameters
without invoking any new request(s).
5\. The 5G ProSe UE-to-Network Relay detects new or updated additional
parameters.
6\. Detection of new or updated additional parameters in step 5 triggers the
5G ProSe UE-to-Network Relay to announce the additional parameters by sending
a Relay Discovery Additional Information Message immediately and to repeat it
periodically with a configurable frequency as in step 4 until there are no UEs
requesting to announce the additional parameters, i.e. until the
Additional_Parameters_Announcement_Request_Refresh Timer expires in the 5G
ProSe UE-to-Network Relay.
### 6.5.2 5G ProSe Communication via 5G ProSe Layer-2 UE-to-Network Relay
#### 6.5.2.1 Registration and Connection Management
##### 6.5.2.1.1 Registration Management
Registration Management for the 5G ProSe Layer-2 Remote UE and the 5G ProSe
Layer-2 UE-to-Network Relay follows the principles and procedures defined in
TS 23.501 [4] and TS 23.502 [5]. The 5G ProSe Layer-2 Remote UE and the 5G
ProSe Layer-2 UE-to-Network Relay may be served by the same AMF or different
AMFs.
##### 6.5.2.1.2 Connection Management
Connection Management for the 5G ProSe Layer-2 Remote UE and the 5G ProSe
Layer-2 UE-to-Network Relay follows the principles and procedures defined in
TS 23.501 [4] and TS 23.502 [5] with the following modifications.
The 5G ProSe Layer-2 UE-to-Network Relay may only relay data/signalling for
the 5G ProSe Layer-2 Remote UE(s) when the 5G ProSe Layer-2 UE-to-Network
Relay is in CM-CONNECTED state. If the 5G ProSe Layer-2 UE-to-Network Relay is
in CM_IDLE state and receives a connection request from the 5G ProSe Layer-2
Remote UE for relaying, the 5G ProSe Layer-2 UE-to-Network Relay shall trigger
Service Request procedure to enter CM_CONNECTED state before relaying the 5G
ProSe Layer-2 Remote UEs traffic.
The state of 5G ProSe UE-to-Network Relay is controlled by NG-RAN with the
following:
\- If any 5G ProSe Layer-2 Remote UE connected to the 5G ProSe Layer-2 UE-to-
Network Relay is in CM-CONNECTED with RRC Connected state, the 5G ProSe
Layer-2 UE-to-Network Relay shall remain CM-CONNECTED state with RRC Connected
state unless the network needs to release the connection.
\- If all 5G ProSe Layer-2 Remote UEs connected to the 5G ProSe Layer-2 UE-to-
Network Relay enter CM-IDLE or CM-CONNECTED with RRC Inactive state, the 5G
ProSe Layer-2 UE-to-Network Relay may enter CM-IDLE state or CM-CONNECTED with
RRC Inactive state, or may remain CM-CONNECTED with RRC Connected state.
When 5G ProSe Layer-2 Remote UE is in CM-CONNECTED state, the 5G ProSe Layer-2
UE-to-Network Relay and 5G ProSe Layer-2 Remote UE keep the PC5 link. When the
5G ProSe Remote UE is in CM-IDLE state, it may either release the PC5 link for
relaying or not.
For paging a 5G ProSe Layer-2 Remote UE, it follows the principles and
procedures defined in TS 23.501 [4] and TS 23.502 [5], and the paging message
delivery from NG-RAN to 5G ProSe Layer-2 Remote UE is specified in TS 38.300
[12].
#### 6.5.2.2 Connection establishment
Figure 6.5.2.2-1: Connection Establishment for 5G ProSe Layer-2 UE-to-Network
Relay
0\. If in coverage, the 5G ProSe Layer-2 Remote UE and 5G ProSe Layer-2 UE-to-
Network Relay may independently perform the initial registration to the
network according to registration procedures in TS 23.502 [5].
1\. If in coverage, the 5G ProSe Layer-2 Remote UE and 5G ProSe Layer-2 UE-to-
Network Relay independently get the service authorization for 5G ProSe Layer-2
UE-to-Network Relay operation from the network. Service authorization and
parameters provisioning for 5G ProSe Layer-2 UE-to-Network Relay operation are
performed for the 5G ProSe Layer-2 UE-to-Network Relay and 5G ProSe Layer-2
Remote UE as specified in clause 5.1.4.
If the 5G ProSe Layer-2 Remote UE is \"not served by NG-RAN\", the pre-
configured parameters are used, and the service authorization and parameters
may be updated after step 6.
If the 5G ProSe Layer-2 Remote UE has not performed Initial Registration, the
5G ProSe Layer-2 Remote UE may perform the Initial Registration in step 6.
2\. The 5G ProSe Layer-2 Remote UE and 5G ProSe Layer-2 UE-to-Network Relay
perform 5G ProSe UE-to-Network Relay Discovery and selection, as specified in
clause 6.3.2.3.
3\. The 5G ProSe Layer-2 Remote UE initiates a one-to-one communication
connection with the selected 5G ProSe Layer-2 UE-to-Network Relay over PC5
using the procedure as described in clause 6.4.3.
4\. The 5G ProSe Layer-2 Remote UE establishes an RRC Connection with the same
NG-RAN serving the selected 5G ProSe Layer-2 UE-to-Network Relay, specified in
TS 38.300 [12].
5\. During step 4, if the 5G ProSe Layer-2 UE-to-Network Relay is in CM_IDLE
state and receives a trigger from the AS layer to enter CM-CONNECTED state due
to Remote UE\'s AS layer connection set up with the NG-RAN, the 5G ProSe
Layer-2 UE-to-Network Relay performs Service Request procedure in the clause
4.2.3.2 of TS 23.502 [5].
6\. The 5G ProSe Layer-2 Remote UE sends a NAS message to the serving AMF. The
NAS message is encapsulated in an Uu RRC message that is sent over PC5 to the
5G ProSe Layer-2 UE-to-Network Relay, and the 5G ProSe Layer-2 UE-to-Network
Relay forwards the Uu RRC message to the NG-RAN specified in TS 38.300 [12].
NG-RAN selects the 5G ProSe Layer-2 Remote UE\'s serving AMF and forwards the
NAS message to this AMF.
If 5G ProSe Layer-2 Remote UE has not performed the initial registration, the
NAS message is an initial Registration message. Otherwise, the NAS message is
either a service request message, or a mobility or periodic Registration
message taking into account the TAI in the RRC container received from the 5G
ProSe Layer-2 UE-to-Network Relay during Relay Discovery (see clause 5.8.3.3)
or PC5-RRC message, as specified in TS 38.300 [12].
7\. The 5G ProSe Layer-2 Remote UE may trigger the PDU Session Establishment
procedure as defined in clause 4.3.2.2 of TS 23.502 [5].
8\. The data is transferred between the 5G ProSe Layer-2 Remote UE and UPF via
the 5G ProSe Layer-2 UE-to-Network Relay and NG-RAN. The 5G ProSe Layer-2 UE-
to-Network Relay forwards all the data messages between the 5G ProSe Layer-2
Remote UE and NG-RAN, as specified in TS 38.300 [12].
### 6.5.3 5G ProSe UE-to-Network Relay reselection
After being connected to the 5G ProSe UE-to-Network Relay, the 5G ProSe Remote
UE keeps performing the measurement of the signal strength of PC5 unicast link
with the 5G ProSe UE-to-Network Relay for relay reselection.
### 6.5.4 5G ProSe Remote UE traffic handling for 5G ProSe UE-to-Network Relay
support
For the 5G ProSe Remote UE to access the service via 5G ProSe UE-to-Network
Relay, the following apply:
\- The application traffic on the 5G ProSe Remote UE is managed by URSP rules
(with consideration of local configurations), following the procedure defined
in clauses 6.1.2.2.1 and 6.6.2.3 of TS 23.503 [9]. The URSP rules defined in
clause 6.6.2.1 of TS 23.503 [9] applies for the 5G ProSe Remote UE, with RSD
enhanced to include:
\- a new \"5G ProSe Layer-3 UE-to-Network Relay Offload indication\".
\- If an application or application traffic matches a URSP rule, corresponding
RSDs shall be used to evaluate the existing PDU sessions, or establish a new
PDU session, or determine to offload outside of a PDU session.
\- If the selected RSD contains \"5G ProSe Layer-3 UE-to-Network Relay Offload
indication\", the 5G ProSe Remote UE will route the traffic to the 5G ProSe
Layer-3 UE-to-Network Relay connection without establishing a PDU session,
when such connection is available.
This may trigger the 5G ProSe Remote UE to start 5G ProSe UE-to-Network Relay
discovery if it is not yet started. The discovery and establishment of the
connection with the 5G ProSe Layer-3 UE-to-Network Relay is controlled by the
ProSe Policy (pre-) configured on the 5G ProSe Remote UE.
\- If the matched URSP rule contains both a RSD with \'\'Non-Seamless Offload
indication\" and a RSD with \" 5G ProSe Layer-3 UE-to-Network Relay Offload
indication\", whether to offload the traffic to non-3GPP access or the 5G
ProSe Layer-3 UE-to-Network Relay connection depends on the priority of the
RSDs, and the availability of the connections, as specified in the clause
6.6.2.3 of TS 23.503 [9].
\- If the selected RSD does not contain the \"5G ProSe Layer-3 UE-to-Network
Relay Offload indication\" or, \"Non-Seamless Offload indication\", the 5G
ProSe Remote UE shall use a PDU session to route the corresponding application
traffic.
If configured in the ProSe Policy, the 5G ProSe Remote UE may attempt the
discovery of a Relay Service Code corresponding to a 5G ProSe Layer-3 UE-to-
Network Relay with N3IWF support in the discovery procedure, when the non-3GPP
access type is preferred in the selected RSD. The 5G ProSe Remote UE may
attempt the discovery of a Relay Service Code corresponding to a 5G ProSe
Layer-2 UE-to-Network Relay in the discovery procedure, when the 3GPP access
type is preferred in the selected RSD.
\- If the 5G ProSe Remote UE has an indirect connection via a 5G ProSe Layer-2
UE-to-Network Relay connection available, it will be treated as the \"3GPP\"
access type. If the 5G ProSe Remote UE has an indirect connection via a 5G
ProSe Layer-3 UE-to-Network Relay with N3IWF support available, it will be
treated as the \"non-3GPP\" access type. The URSP handling as defined in TS
23.503 [9] applies.
For the 5G ProSe Layer-3 UE-to-Network Relay and 5G ProSe Layer-2 UE-to-
Network Relay, the URSP handling does not apply to the relayed traffic from
the 5G ProSe Remote UE.
For the 5G ProSe Layer-3 UE-to-Network Relay, the PDU session established for
relaying the 5G ProSe Remote UE\'s traffic is controlled by the ProSe Policy.
## 6.6 Procedures for Service Authorization to NG-RAN
### 6.6.1 General
In order to support PC5 radio resource control in NG-RAN, ProSe service
Authorisation information and PC5 QoS parameters for ProSe need to be made
available in NG-RAN. This clause describes the corresponding procedures and
aspects.
### 6.6.2 Registration procedure
The Registration procedure for UE is performed as defined in TS 23.502 [5]
clause 4.2.2.2 with the following additions:
\- The UE includes the 5G ProSe Capability as part of the \"5GMM capability\"
in the Registration Request message. The AMF stores the 5G ProSe Capability
for 5G ProSe operation.
\- The 5G ProSe Capability indicates whether the UE supports one or more of
the following ProSe capabilities:
\- 5G ProSe Direct Discovery;
\- 5G ProSe Direct Communication;
\- 5G ProSe Layer-2 UE-to-Network Relay;
\- 5G ProSe Layer-3 UE-to-Network Relay;
\- 5G ProSe Layer-2 Remote UE; and
\- 5G ProSe Layer-3 Remote UE.
\- The AMF obtains the 5G ProSe subscription data as part of the user
subscription data from UDM during UE Registration procedure using Nudm_SDM
service as defined in clause 4.2.2.2.2 of TS 23.502 [5].
\- The AMF determines whether the UE is authorised to use 5G ProSe services
based on UE\'s 5G ProSe Capability and the ProSe Service Authorisation
included in the subscription data received from UDM as specified in clause
5.7. ProSe NR UE-PC5-AMBR is also provided to the AMF as part of the
subscription data for 5G ProSe services. The AMF stores the authorized 5G
ProSe Capability.
\- The AMF sends the authorized 5G ProSe Capability for 5G ProSe operation to
PCF. Based on the received 5G ProSe Capability from the AMF, the PCF provides
the PC5 QoS parameters for 5G ProSe to AMF. The AMF stores such information as
part of the UE context.
\- If the UE is authorised to use 5G ProSe services, then the AMF shall
include in a NGAP message sent to NG-RAN:
\- \"5G ProSe authorised\" information, including one or more of the
following:
\- whether the UE is authorized to use 5G ProSe Direct Discovery;
\- whether the UE is authorized to use 5G ProSe Direct Communication;
\- whether the UE is authorized to act as a 5G ProSe Layer-2 UE-to-Network
Relay;
\- whether the UE is authorized to act as a 5G ProSe Layer-3 UE-to-Network
Relay;
\- whether the UE is authorized to act as a 5G ProSe Layer-2 Remote UE.
\- ProSe NR UE-PC5-AMBR, used by NG-RAN for the resource management of UE\'s
PC5 transmission for 5G ProSe services in network scheduled mode.
\- the PC5 QoS parameters for 5G ProSe used by the NG-RAN for the resource
management of UE\'s PC5 transmission for ProSe services in network scheduled
mode.
\- If the UE is authorised to use 5G ProSe services, then the AMF should not
initiate the release of the signalling connection after the completion of the
Registration procedure. The release of the signalling connection relies on the
decision of NG-RAN, as specified in TS 23.502 [5].
### 6.6.3 Service Request procedure
The Service Request procedures for UE in CM-IDLE state are performed as
defined in TS 23.502 [5] clause 4.2.3.2 and clause 4.2.3.3 with the following
additions:
\- If the UE is authorised to use ProSe services, then the AMF shall include
\"ProSe authorised\" information in the NGAP message, indicating which of the
ProSe services the UE is authorised to use as described in clause 6.6.2.
\- The AMF includes the ProSe NR UE-PC5-AMBR in the NGAP message to the NG-RAN
as part of the UE context and NG-RAN may use in resource management of UE\'s
PC5 transmission for ProSe services in network scheduled mode.
\- The AMF sends the PC5 QoS parameters for ProSe to NG-RAN via N2 signalling.
The PC5 QoS parameters for ProSe may be stored in the UE context after the
registration procedure. If the UE is authorised to use ProSe services but AMF
does not have PC5 QoS parameters for ProSe available, the AMF fetches the PC5
QoS parameters for ProSe from the PCF.
### 6.6.4 N2 Handover procedure
The N2 based handover procedures for UE are performed as defined in TS 23.502
[5] clause 4.9.1.3 with the following additions:
\- If the UE is authorised to use ProSe services, then the target AMF shall
send the \"ProSe authorised\" information, ProSe NR UE-PC5-AMBR, and PC5 QoS
parameters for ProSe to the target NG-RAN in the NGAP Handover Request
message.
### 6.6.5 Xn Handover procedure
The Xn based handover procedures for UE are performed as defined in TS 23.502
[5] clause 4.9.1.2 with the following additions:
\- If the \"ProSe authorised\" information is included in the UE context, then
the source NG-RAN shall include a \"ProSe authorised\" information, ProSe NR
UE-PC5-AMBR and PC5 QoS parameters for ProSe in the XnAP Handover Request
message to the target NG-RAN.
\- If the \"ProSe authorised\" information is included in the UE context, then
the AMF shall send the \"ProSe authorised\" information, the ProSe NR UE-
PC5-AMBR, and PC5 QoS parameters for ProSe to the target NG-RAN in the Path
Switch Request Acknowledge message.
### 6.6.6 Subscriber Data Update Notification to AMF
The procedure of Subscriber Data Update Notification to AMF is performed as
defined in TS 23.502 [5] clause 4.5.1 with the following additions:
\- The Nudm_SDM_Notification service operation may contain the ProSe Service
Authorisation or the ProSe NR UE-PC5-AMBR or any combination.
\- The AMF updates the UE Context with the above new ProSe subscription data.
\- When the AMF updates UE context stored at NG-RAN, the UE context contains
the ProSe subscription data.
### 6.6.7 Delivery of PC5 QoS parameters for ProSe to NG-RAN
The UE Policy Association Establishment procedure and UE Policy Association
Modification procedure, as defined in TS 23.502 [5], is used to provide the
AMF with PC5 QoS parameters used by NG-RAN. When receiving the 5G ProSe
Capability in Npcf_UEPolicyControl_Create Request from the AMF or when
receiving the updated subscription data from UDR, the PCF generates the PC5
QoS parameters used by NG-RAN corresponding to a UE as defined in clause 5.4.2
of TS 23.287 [2].
The (V-)PCF provides the information to the AMF as follows:
\- In the roaming case, the H-PCF includes the PC5 QoS parameters used by NG-
RAN in the Npcf_UEPolicyControl_Create Response message or
Npcf_UEPolicyControl UpdateNotify Request message sent to V-PCF in an N2 PC5
policy container, and V-PCF relays this N2 PC5 policy container as the N2
container in the Namf_Communication_N1N2MessageTransfer message sent to AMF.
\- In the non-roaming case, the PCF includes the PC5 QoS parameters used by
NG-RAN in an N2 container in Namf_Communication_N1N2MessageTransfer message
sent to AMF.
When the AMF receives the N2 PC5 policy container from (V-)PCF, the AMF stores
such information as part of the UE context.
In the UE Configuration Update procedure triggered by UE Policy Association
Establishment or UE Policy Association Modification:
\- The AMF forwards the PC5 QoS parameters in the NGAP message to the NG-RAN
if a N2 PC5 policy container is received in the
Namf_Communication_N1N2MessageTransfer message.
NOTE 1: If the PC5 QoS parameters are provided to both NG-RAN and UE, both the
N2 PC5 Policy Container and the UE Policy Container are included in the
Namf_Communication_N1N2MessageTransfer message.
NOTE 2: Non-UE specific PC5 QoS parameters, e.g. default PC5 QoS parameters,
can also be locally configured in NG-RAN. How such configuration is performed
is out of scope of this specification.
# 7 Network Function Services
## 7.1 5G DDNMF Services
### 7.1.1 General
The following table illustrates the 5G DDNMF Services.
Table 7.1.1-1: Services provided by 5G DDNMF
Service Name Service Operations Operation Semantics Example Consumer(s)
* * *
N5g-ddnmf_Discovery AnnounceAuthorize Request/Response 5G DDNMF AnnounceUpdate
Request/Response 5G DDNMF MonitorAuthorize Request/Response 5G DDNMF
MonitorUpdate Request/Response 5G DDNMF MonitorUpdateResult Notify 5G DDNMF
DiscoveryAuthorize Request/Response 5G DDNMF MatchReport Request/Response 5G
DDNMF MatchInformation Notify 5G DDNMF
### 7.1.2 N5g-ddnmf_Discovery service
#### 7.1.2.1 General
**Service description:** This service enables a 5G DDNMF to manage inter-PLMN
ProSe Direct Discovery operations.
#### 7.1.2.2 N5g-ddnmf_Discovery_AnnounceAuthorize service operation
**Service operation name:** N5g-ddnmf_Discovery_AnnounceAuthorize
**Description:** The consumer NF obtains the authorization from the 5G DDNMF
for announcing in the PLMN.
**Input, Required:** Discovery type (\"open\" or \" restricted \") and
\- (for \"open\" discovery type:) ProSe Application ID, ProSe Application
Code, UE Identity, validity timer, Discovery Entry ID,
\- (for \"restricted\" discovery type:) RPAUID, Application ID, ProSe
Restricted Code/Prefix, UE Identity, Discovery Entry ID,
**Input, Optional:** metadata, Restricted Code Suffix pool.
**Output, Required:** authorization result.
**Output, Optional:** None.
#### 7.1.2.3 N5g-ddnmf_Discovery_AnnounceUpdate service operation
**Service operation name:** N5g-ddnmf_Discovery_AnnounceUpdate
**Description:** The consumer NF updates or revoke the authorization from the
5G DDNMF for announcing in the PLMN.
**Input, Required:** Discovery type = \"open\", UE Identity, validity timer,
Discovery Entry ID
**Input, Optional:** ProSe Application Code
**Output, Required:** result.
**Output, Optional:** None.
#### 7.1.2.4 N5g-ddnmf_Discovery_MonitorAuthorize service operation
**Service operation name:** N5g-ddnmf_Discovery_MonitorAuthorize
**Description:** The consumer NF obtains the authorization from the 5G DDNMF
for monitoring in the PLMN.
**Input, Required:** Discovery type (\"open\" or \" restricted \") and
\- (for \"open\" discovery type:) ProSe Application ID Name(s), UE Identity,
Discovery Entry ID;
\- (for \"restricted\" discovery type:) RPAUID, UE Identity, Target PDUID,
Application ID, Target RPAUID, Discovery Entry ID,
**Input, Optional:** None,
**Output, Required:** (for \"open\" discovery) ProSe Application
Code(s)/Prefix, ProSe Application Mask(s), TTL; or (for \"restricted\"
discovery) ProSe Restricted Code, validity timer
**Output, Optional:** None.
#### 7.1.2.5 N5g-ddnmf_Discovery_MonitorUpdate service operation
**Service operation name:** N5g-ddnmf_Discovery_MonitorUpdate
**Description:** The consumer NF updates or revoke the authorization for the
indicated UE to monitor in the PLMN.
**Input, Required:** Discovery type (\"open\" or \"restricted\"); and
\- (for \"open\" discovery type:) ProSe Application ID name, UE Identity, TTL,
Discovery Entry ID;
\- (for \"restricted\" discovery type:) ProSe Restricted Code, Application ID,
Banned RPAUID, Banned PDUID.
**Input, Optional:** None.
**Output, Required:** Result.
**Output, Optional:** None.
#### 7.1.2.6 N5g-ddnmf_Discovery_MonitorUpdateResult service operation
**Service operation name:** N5g-ddnmf_Discovery_MonitorUpdateResult
**Description:** The consumer NF informs the 5G DDNMF of the monitoring
revocation results.
**Input, Required:** Discovery type = \"restricted\", ProSe Restricted Code,
Application ID, Banned RPAUID, Banned PDUID, Result.
**Input, Optional:** None.
**Output, Required:** None.
**Output, Optional:** None.
#### 7.1.2.7 N5g-ddnmf_Discovery_DiscoveryAuthorize service operation
**Service operation name:** N5g-ddnmf_Discovery_DiscoveryAuthorize
**Description:** The consumer NF obtains the authorization from the 5G DDNMF
for a discoverer UE in the PLMN to operate Model B restricted discovery.
**Input, Required:** Discovery type = \"restricted\", Restricted ProSe App
User ID, UE Identity, Target PDUID, Application ID, Target RPAUID, Discovery
Entry ID.
**Input, Optional:** None.
**Output, Required:** ProSe Query Code(s), ProSe Response Code, validity
timer.
**Output, Optional:** None.
#### 7.1.2.8 N5g-ddnmf_Discovery_MatchReport service operation
**Service operation name:** N5g-ddnmf_Discovery_MatchReport
**Description:** The consumer NF obtains the information about the indicated
discovery code from the 5G DDNMF.
**Input, Required:** Discovery type = \"open\", ProSe Application Code(s), UE
identity, Monitored PLMN ID.
**Input, Optional:** None.
**Output, Required:** ProSe Application ID Name(s), validity timer(s).
**Output, Optional:** Metadata, Metadata Index Mask(s).
#### 7.1.2.9 N5g-ddnmf_Discovery_MatchInformation service operation
**Service operation name:** N5g-ddnmf_Discovery_MatchInformation
**Description:** The consumer NF receives from the 5G DDNMF of a matching
result, and the information can be used for charging purpose.
**Input, Required:** Discovery type (\"open\" or \"restricted\"); and
\- (for \"open\" type:) ProSe Application ID(s), UE Identity;
\- (for \"restricted\" type:) RPAUID, Target RPAUID, UE Identity, ProSe
Restricted Code.
**Input, Optional:** None.
**Output, Required:** None.
**Output, Optional:** None.
## 7.2 AF Services
### 7.2.1 General
This service enables consumer NF to request authorization for Discovery
Request. This service is also used by producer NF to update the authorization
of discovery request.
Table 7.2.1-1: Services provided by AF
Service Name Service Operations Operation Semantics Example Consumer(s)
* * *
Naf_ProSe DiscoveryAuthorization Request/Response 5G DDNMF
DiscoveryAuthorizationUpdateNotify Subscribe/Notify 5G DDNMF
DiscoveryAuthorizationResultUpdate Request/Response 5G DDNMF
### 7.2.2 Naf_ProSe service
#### 7.2.2.1 General
**Service description:** This service enables consumer NF to request
authorization for Discovery Request. The AF may update the authorization
information to revoke the Restricted ProSe Direct Discovery permission.
#### 7.2.2.2 Naf_ProSe_DiscoveryAuthorization service operation
**Service operation name:** Naf_ProSe_DiscoveryAuthorization
**Description:** Authorize Discovery Request from the consumer NF.
**Input, Required:** ProSe Application ID, Request Type.
**Input, Optional:** Application Level Container, Allowed number of suffixes,
RPAUID, ProSe Application ID, Target RPAUID.
**Output, Required:** ProSe Application Code Suffix pool, Response Type,
PDUID(s), Target PDUID.
**Output, Optional:** PDUID(s), Target PDUID, ProSe Application Code Suffix
pool, Mask(s) for the ProSe Application Code Suffix(es) corresponding to ProSe
Application ID, N sets of Target PDUID - Target RPAUID - Metadata Indicator,
Application Level Container.
#### 7.2.2.3 Naf_ProSe_DiscoveryAuthorizationUpdateNotify service operation
**Service operation name:** Naf_ProSe_DiscoveryAuthorizationUpdateNotify
**Description:** The AF update the authorization information to revoke
discovery permissions relating to some other users in the NF consumer.
**Input, Required:** Discovery type = \"restricted\", RPAUID, Banned RPAUID,
Banned PDUID.
**Input, Optional:** None.
**Output, Required:** Result.
**Output, Optional:** None.
#### 7.2.2.4 Naf_ProSe_DiscoveryAuthorizationResultUpdate service operation
**Service operation name:** Naf_ProSe_DiscoveryAuthorizationResultUpdate
**Description:** The NF consumer informs the AF of the revocation result
because of update in authorization information.
**Input, Required:** Discovery type = \"restricted\", RPAUID, Banned RPAUID,
Banned PDUID.
**Input, Optional:** None.
**Output, Required:** Result.
**Output, Optional:** None.
#
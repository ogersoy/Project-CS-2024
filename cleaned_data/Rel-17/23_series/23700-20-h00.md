# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
Study enhancements to the 5G System that would enable enhanced support of IEEE
TSN Time Sensitive Communication to support deterministic applications.
# 2 References {#references-1}
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.501: \"System Architecture for the 5G System (5GS); Stage 2\".
[3] 3GPP TS 23.502: \"Procedures for the 5G System; Stage 2\".
[4] 3GPP TS 22.104: \"Service requirements for cyber-physical control
applications in vertical domains\".
[5] 3GPP TS 22.263: \"Service requirements for Video, Imaging and Audio for
Professional Applications (VIAPA)\".
[6] IEEE 802.1Q-2018: \"IEEE Standard for Local and Metropolitan Area
Networks-Bridges and Bridged Networks\".
[7] IEEE 802.1Qcc: \"IEEE Standard for Local and Metropolitan Area Networks--
Bridges and Bridged Networks -- Amendment 31: Stream Reservation Protocol
(SRP) Enhancements and Performance Improvements\".
[8] IEEE 802.1Qbv: \"Forwarding and Queuing - Enhancements for Scheduled
Traffic\".
[9] IEEE Std 802.1CB-2017: \"Frame Replication and Elimination for
Reliability\".
[10] IEC/IEEE 61850-9-3:2016: \"Communication networks and systems for power
utility automation - Part 9-3: Precision time protocol profile for power
utility automation\".
[11] 3GPP TS 38.331: \"NR; Radio Resource Control (RRC); Protocol
specification\".
[12] 3GPP TS 23.503: \"Policy and charging control framework for the 5G System
(5GS); Stage 2\".
[13] IEEE 1588-2008: \"IEEE Standard for a Precision Clock Synchronization
Protocol for Networked Measurement and Control Systems\".
[14] 3GPP TS 23.288: \"Architecture enhancements for 5G System (5GS) to
support network data analytics services\".
[15] IETF RFC 3393: \"IP Packet Delay Variation Metric for IP Performance
Metrics (IPPM)\".
[16] IETF RFC 1889: \"RTP: A Transport Protocol for Real-Time Applications\".
[17] SMPTE ST 2059-2:2015: \"SMPTE Standard - SMPTE Profile for Use of
IEEE-1588 Precision Time Protocol in Professional Broadcast Applications\".
[18] IEEE 802.1AS: \"Standard for Local and Metropolitan Area Networks \-
Timing and Synchronization for Time-Sensitive Applications in Bridged Local
Area Networks\".
# 3 Definitions of terms and abbreviations
## 3.1 Terms
For the purposes of the present document, the terms given in TR 21.905 [1]
apply. A term defined in the present document takes precedence over the
definition of the same term, if any, in TR 21.905 [1].
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] apply. An abbreviation defined in the present document takes precedence
over the definition of the same abbreviation, if any, in TR 21.905 [1].
# 4 Architectural Assumptions and Requirements
## 4.1 Architectural Requirements
The following architectural requirements apply:
\- Solutions shall build on the 5G System architectural principles as in TS
23.501 [2], including flexibility and modularity for newly introduced
functionalities.
\- The 3GPP system shall support co-existence of TSN GM clock residing in the
network attached to DS-TT for some TSN domains and TSN GM clock residing in
network side for some other TSN domains.
# 5 Key Issues
## 5.1 Key Issue #1: Uplink Time Synchronization
### 5.1.1 Description
The objective of this Key Issue is to introduce support for Time
Synchronization with TSN GM in the TSN network attached to the device. The TSN
GM is assumed to be located in the network attached to the device.
For this Key Issue the following areas should be studied:
1\. Support for Time Synchronization with one or more TSN GM(s) in the TSN
network attached to the device:
a) Synchronizing TSN end stations behind 5G System (NW-TT) with the TSN GM in
the network attached to the device.
b) Synchronizing TSN end stations behind other UE(s) with the TSN GM in the
network attached to the device side via 5G System.
## 5.2 Key Issue #2: UE-UE TSC communication
### 5.2.1 Description
This Key issue aims to address UE-UE TSC communication if the network
determines that the two UE(s) (including two DS-TT(s) within the same UE) are
served by the same UPF.
Figure 5.1.1: UE-UE TSC communication
NOTE: In the above figure, the two UEs can be served by a single NG-AN node or
two different NG-AN nodes.
For this Key Issue the following areas should be studied:
1\. How the 5GS know the UE/DS-TT pairs which can perform UE-UE communication?
2\. 5G System bridge delay determination considering UE-UE communication via
same UPF.
a. How does the 5GS know whether to report the Bridge delay information for
the port pair of two DS-TTs.
b. How does the 5GS calculate and report the Bridge delay information for the
port pair of two DS-TTs.
3\. Configuration of Deterministic QoS for the QoS Flows of the two UEs served
by the same UPF.
a. The impact on the derivation and provision of QoS parameters and TSCAI in
this scenario, if any.
## 5.3 Key Issue #3: Exposure of TSC services
### 5.3.1 Description
The objective of this Key Issue is to allow wider and more flexible use of 5GS
TSC and URLLC through the 5GS Network Exposure Function framework.
The exposure framework can be used to expose network capabilities (i.e.
enabling operator to offer certain capabilities as services) and also allow
application to influence services offered by the network. This key issue is
about enhancing the NEF (exposure) framework towards AF so that NEF can expose
network capabilities to support Time Sensitive Communication.
### 5.3.2 Key Issue #3A: Exposure of deterministic QoS
Any AF that has knowledge of deterministic application requirements should be
able to request TSC services from the 5GS and as authorized, be notified of
pertinent network events. This key issue is intended to support in the 5GS,
requirements from TS 22.104 [4] where a TSN bridged network may not be needed
and requirements from TS 22.263 [5] for Video, Imaging and Audio for
Professional Applications (VIAPA). Applications provide those requirements to
5GS for any type of PDU Session.
This KI focuses on enhancing NEF framework.
For this Key Issue, the following areas should be studied:
a) Ability for AF to request absolute delay and jitter requirements, and
mechanisms to enable the PCF to determine the 5GS QoS parameters based on the
requirements received from AF.
b) Ability for AF to indicate periodicity, burst size, burst arrival time (as
defined in Rel-16 for TSC Assistance information) and Survival Time,
optionally burst spread (variation of burst arrival time for DL traffic
resulting from jitter on N6, if applicable) along with Time Domain (reference
for these parameters) associated with these parameters to the NEF.
c) How to enable an application and 5GS to agree on a TSC configuration that
addresses the applications needs and can be supported by 5GS.
### 5.3.3 Key Issue #3B: Exposure of Time Synchronization
Any AF that has knowledge of time synchronization requirements should be able
to learn 5GS capabilities to support time synchronization, the AF may request
time synchronization with specified requirements, and supply information that
can be used to optimize and configure time synchronization procedure for
connected devices.
This key issue is intended to support in the 5GS, requirements from TS 22.104
[4] where a TSN bridged network may not be needed and requirements from TS
22.263 [5] for Video, Imaging and Audio for Professional Applications (VIAPA).
Applications provide those requirements to 5GS for IP or Ethernet types of PDU
Sessions.
Four different time sources and methods for synchronization are foreseen:
1) assuming use of a gPTP client (IEEE 802.1 [18] Time Aware System) or PTP
client (IEEE 1588-2008 [13] and gPTP protocol which conveys the timing
information, e.g. located in the DN, and mapping to 5GS time in 5GC (time sync
methods as defined in Rel-16).
2) assuming use of the 5GS time source by 5GS and AF (e.g. it could also be
GPS time source used by both 5GS and AF); where UPF/NW-TT creates the time
sync methods conveyed in gPTP messages as defined in Rel-16 or in PTP messages
over UDP/IP as defined in IEEE 1588-2008 [13] for conveying the timing
information.
3) assuming use of the 5GS time source by 5GS and AF (e.g. it could also be
GPS time source used by both 5GS and AF); where the 5G-AN provides a 5GS
reference time to the UE via 3GPP radio layer and UE may provide it to the
applications or devices behind the UE by implementation specific means out of
scope of 3GPP.
4) assuming use of the 5GS time source by 5GS and AF (e.g. it could also be
GPS time source used by both 5GS and AF); where DS-TT creates the time sync
methods conveyed in gPTP messages or in PTP messages over UDP/IP as defined in
IEEE 1588-2008 [13] for conveying the timing information.
For these four methods, this key issue aims to support exposure for Time
Synchronization service offered by 5GS:
A) Exposure of the 5GS capability to activate Time Synchronization from the AF
for a TSN Domain GM or 5G GM (i.e. for VIAPA applications).
i. Ability for network to expose the support for synchronization and the
supported time synchronization method (i.e. method 1, 2, 3 or 4 as above) from
NEF towards AF.
ii. Ability for AF to request activation/deactivation of Time Synchronization
service targeting a UE or a group of UEs and indicate the clock domain (i.e.
IEEE TSN Domain GM or 5G GM) and clock accuracy (with an accuracy of e.g. 1
microsecond).
iii. Ability to support the time synchronization service for IP and Ethernet
types of PDU Sessions.
## 5.4 Key Issue #4: supporting the fully distributed configuration model for
TSN
### 5.4.1 Description
Fully distributed TSN model is defined in IEEE 802.1Qcc [7]. Unlike the fully
centralized model supported in Rel-16, there is neither a Centralized Network
Configuration (CNC) entity nor an entity that has the knowledge of the entire
TSN network in fully distributed TSN model. The configuration information for
stream resource registration is propagated along the paths from the Talker to
Listeners. The 5G CP (i.e. PCF) cannot get the TSN stream requirements and
configuration information from a TSN entity in control plane.
In order to support integration of 5GS with the TSN network deployed in fully
distributed model, the 5GS should be able to read the configuration
information carried in the TSN stream resource registration messages (e.g.
MSRP messages) and modify the messages as a TSN bridge based on the 5GS
capability. The 5G CN CP should also be able to retrieve the TSN stream
requirements from the messages transmitted in user plane. Therefore, the
enhancements needs to be studied for 5GS to support fully distributed TSN
model:
\- Which IEEE protocols need to be supported?
\- How the 5GS retrieves the TSN stream requirements?
\- How to enforce the TSN stream requirements using 3GPP QoS parameters?
\- Which entity, (e.g. the UE/DS-TT, UPF/NW-TT, SMF or PCF), is responsible
for read/modify the TSN stream resource registration messages, and how the 5GS
modifies the TSN stream resource registration message based on 5GS Bridge
capability and the configuration information carried in the message?
NOTE: This key issue is not addressed within Rel-17 timeframe.
## 5.5 Key issue #5: Use of Survival Time for Deterministic Applications in
5GS
### 5.5.1 Description
The objective of this Key Issue is to introduce Use of Survival Time for
Deterministic Applications in 5GS.
Periodic deterministic communication service performance requirements are
described in clause 5.2 of Rel-17 TS 22.104 [4]. Survival time is included in
the requirements.
This key issue aims at studying solutions on how to transfer the survival time
to RAN. In more detail:
\- how to deliver survival time to 5G system;
\- How 5GS acquires the additional assistance information reflecting survival
time, e.g. interworking with CNC and/or use of AF or NEF without interworking
with CNC or with CUC or other method.
NOTE: IEEE TSN does not provide survival time via CNC.
How and when to apply Survival Time assistance information is up to RAN WGs.
# 6 Solutions
## 6.0 Mapping of Solutions to Key Issues
Table 6.0-1: Mapping of Solutions to Key Issues
+---------+---------+---------+---------+---------+---------+---------+ | So | | | Key | | | | | lutions | | | Issues | | | | +=========+=========+=========+=========+=========+=========+=========+ | | #1 | #2 | #3A | #3B | #4 | #5 | | | Uplink | UE-UE | E | E | sup | | | | Time | TSC | xposure | xposure | porting | Use of | | | S | commun | of TSC | of TSC | the | S | | | ynchron | ication | se | s | fully | urvival | | | ization | | rvices: | ervices | dist | Time | | | | | | | ributed | for | | | | | E | E | config | Determ | | | | | xposure | xposure | uration | inistic | | | | | of | of Time | model | Appli | | | | | determ | S | for TSN | cations | | | | | inistic | ynchron | | in 5GS | | | | | QoS | ization | | | +---------+---------+---------+---------+---------+---------+---------+ | #1 | X | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | #2 | | X | | | | | +---------+---------+---------+---------+---------+---------+---------+ | #3 | | X | | | | | +---------+---------+---------+---------+---------+---------+---------+ | #4 | | X | | | | | +---------+---------+---------+---------+---------+---------+---------+ | #5 | | | X | | | | +---------+---------+---------+---------+---------+---------+---------+ | #6 | | | X | | | | +---------+---------+---------+---------+---------+---------+---------+ | #7 | | | | X | | | +---------+---------+---------+---------+---------+---------+---------+ | #8 | | | | X | | | +---------+---------+---------+---------+---------+---------+---------+ | #9 | | | | X | | | +---------+---------+---------+---------+---------+---------+---------+ | #10 | | X | | | | | +---------+---------+---------+---------+---------+---------+---------+ | #11 | | X | | | | | +---------+---------+---------+---------+---------+---------+---------+ | #12 | | X | | | | | +---------+---------+---------+---------+---------+---------+---------+ | #13 | | | X | | | | +---------+---------+---------+---------+---------+---------+---------+ | #14 | | | X | | | | +---------+---------+---------+---------+---------+---------+---------+ | #15 | | | | | | X | +---------+---------+---------+---------+---------+---------+---------+ | #16 | | | | | | X | +---------+---------+---------+---------+---------+---------+---------+ | #17 | X | | | | | | +---------+---------+---------+---------+---------+---------+---------+ | #18 | X | | | X | | | +---------+---------+---------+---------+---------+---------+---------+ | #19 | | X | | | | | +---------+---------+---------+---------+---------+---------+---------+ | #20 | | X | | | | | +---------+---------+---------+---------+---------+---------+---------+ | #21 | | | X | | | | +---------+---------+---------+---------+---------+---------+---------+ | #22 | | | X | | | | +---------+---------+---------+---------+---------+---------+---------+ | #23 | | | X | | | | +---------+---------+---------+---------+---------+---------+---------+ | #24 | | X | | | | | +---------+---------+---------+---------+---------+---------+---------+
## 6.1 Solution #1: Uplink Time Synchronization for TSN
### 6.1.1 Introduction {#introduction-1}
The solution is proposed to solve Key Issue #1: the UL Time Synchronization.
In this key issue, one or more TSN GM(s) are attached to the device side and
are used to synchronize the TSN end stations behind the 5GS (i.e. NW-TTs) and
behind the other UEs (i.e. DS-TTs). Based on clause 5.27.1 of TS 23.501 [2],
the following principles are also applied to or UL TSN Time Synchronization:
\- 5GS as a TSN bridge plays as a time-aware system.
\- Only TSN TTs at the edge of 5GS need to support the desired operations in
the IEEE 802.1AS [18].
\- Two separate distribution time mechanisms are used for 5GS internal clock
and TSN system clocks as defined in clause 5.27.1.2 of TS 23.501 [2].
\- All gPTP messages generated from TSN GM(s) are transmitted using user-plane
resources in 5GS.
\- All the gNBs, DS-TT/UEs, and UPF/NW-TTs in the 5GS are time synchronized to
the same 5GS GM.
Therefore, this solution proposes that similar operations defined for DL TSN
Time Synchronization can be re-used for the UL TSN Time Synchronization i.e.
for the TSN GM(s) attached to the device side.
Since UL TSN Time Synchronization will be distributed to the TSN end stations
attached to 5GS (i.e. NW-TTs) and attached to the other UEs (i.e. DS-TTs), TSN
GM(s) attached to the device will generate the UL gPTP messages and then DS-TT
can perform exactly the same operations for the received DL gPTP messages as
NW-TT performs for the DL gPTP messages defined in clause 5.27.1.2.2 of TS
23.501 [2]. Then, the modified UL gPTP messages will be further forwarded via
the user-plane established between the devices (i.e. UE) which has TSN GM(s)
attached to and the target UPFs.
After the NW-TT receives the modified gPTP messages for the case where
delivery to end stations behind the 5G system (NW-TT) is required, the NW-TT
can perform exactly the same operations as DS-TT performs for the received DL
gPTP messages defined in clause 5.27.1.2.2 of TS 23.501 [2]. Finally, NW-TT
can forward to the UL gPTP messages to the TSN end stations.
The main difference between the UL and DL Time Synchronization is that the UL
gPTP messages are also required by the TSN end stations behind the other UEs
(i.e. DS-TTs). For delivery of gPTP messages to TSN end stations behind other
UEs, the UPF will forward the UL gPTP messages transparently to other UEs but
not send it back to the source UEs. The DS-TT in the other UE can perform
exactly the same operations as defined in clause 5.27.1.2.2 of TS 23.501 [2].
Finally, DS-TT can forward to the gPTP messages to the TSN end stations as
described in the figure 6.1.2-1.
NOTE: The UPF forwards the gPTP message to the Ethernet connected to the N6
interface. This enables other devices on N6 and also other DS-TT/UE connected
to a different UPF to receive the gPTP message.
NOTE: The gPTP messages are multicast data packet. The UPF/NW-TT prevents the
occurrence of gPTP message loops.
### 6.1.2 Functional Description
Distributing the UL gPTP messages from TSN GM attached to the device to all
TSN end stations behind the UPFs (NW-TTs) and behind the other UEs (DS-TTs)
can be achieved by using the following steps (referred to Figure 6.1.2â€‘1)
\- DS-TT which is attached by one or more TSN GMs will perform exactly same
operations for UL gPTP messages as NW-TT perform the operations for the DL
gPTP messages as specified in clause 5.27.1.2.2 of TS 23.501 [2].
\- In the case of synchronizing TSN end stations behind 5G System (NW-TT), NW-
TT will perform exactly the same operations for UL gPTP messages as what DS-TT
performs for the DL gPTP messages as specified in clause 5.27.1.2.2 of TS
23.501 [2]. After NW-TT on the UPF side receives the UL gPTP messages, the NW-
TT forward the information to the TSN end stations, while adding 5GS residence
time to the correction field and removing TSi timestamp from the suffix field.
\- In the case of synchronizing TSN end stations behind other UE(s), the UPF
will forward the received UL gPTP message transparently to the other UEs to
distribute the gPTP messages further to the TSN end stations behind other UEs
(other DS-TTs) by applying the same forwarding principles as described in
clause 5.27.1.2.2 of TS 23.501 [2] except that the PDU session of the source
device connected to the corresponding DS-TT port is not included in the
forwarding.
NOTE: Normal Ethernet behaviour is that the frame is not sent back to the
source. So, sending back a frame on the incoming interface would be against
Ethernet principles and results in risking creation of forwarding loops.
In the case of synchronizing TSN end stations behind 5G System (NW-TT), all
gPTP messages are transmitted using the user-plane resources in 5GS and
follows the principle that one PDU session is established per DS-TT port for a
UPF. To support the multiple TSN working domains attached to the device, the
mechanism defined in clause 5.27.1.3 of TS 23.501 [2] can be re-used.
In the case of synchronizing TSN end stations behind other UE(s), all gPTP
messages are transmitted using the user-plane resources in 5GS and follow the
principle that two PDU sessions are used.
To support the multiple TSN working domains attached to the device, the
mechanism defined in clause 5.27.1.3 of TS 23.501 [2] can be re-used.
Figure 6.1.2-1: The distribution of UL Time Synchronization Information with
the same UPF
### 6.1.3 Procedures
#### 6.1.3.1 Synchronizing end stations behind NW-TT
The procedure for synchronizing TSN end stations behind 5G System (NW-TT) with
the TSN GM in the network attached to the device is described in Figure
6.1.3-1. It includes BMCA-related steps (step 1\~3) because after those steps,
the sync message forwarding tree is confirmed. In this case, TSN Node 0 should
send sync messages to 5GS TSN Bridge, and the 5GS TSN Bridge should send sync
messages to TSN Node 2. The remaining steps (step 4\~8) follow principles in
clause 5.27.1 of TS 23.501 [2], with the Ingress TT of DS-TT1 and the Egress
TT of NW-TT.
Figure 6.1.3.1-1: Procedure for synchronizing TSN end stations behind 5G
System (NW-TT) with the TSN GM in the network attached to the device side via
5G System
1\. PDU Session Establishment includes UE MAC / Port Info for updates to TSN
AF. After this step, TSN Node 0, 5GS logical bridge (DS-TT1/UE1, NW-TT/UPF)
and TSN Node 2 can exchange Ethernet frames.1a. [Optional] If the operator
decides to follow the recommendation to limit the bridge residence time to 10
ms, as defined in IEEE 802.1AS [18], clause B2.2 (stated as recommendation),
then TSN AF may subscribe for the BMCA result report from the NW-TT. The
subscription contains the conditions that need to be reported, e.g. the
current PTP port states and any changes to the current PTP port states.
2\. At BMCA step, TSN nodes exchange Announce messages and build the Sync
forwarding tree for TSN Sync messages. The Sync forwarding tree is per TSN
working clock domain. BMCA procedure (6.1.3.3 for gPTP) is performed when a
NW-TT port or a DS-TT port receives an Announce message.
3\. [Optional] If the operator decides to follow the recommendation to limit
the bridge residence time to 10 ms, as defined in IEEE 802.1AS [18], clause
B2.2 (stated as recommendation), then based on the 1 the BMCA result report
from the NW-TT the TSN AF may trigger QoS setup for the Sync frame delivery.
PDB1 which is the UL PDB for the QoS flow of PDU session for UE1, plus UE1-DS-
TT residence time, should be less than 10ms, as the residence time in a node
should be less than 10ms. This step can be skipped if step 1 satisfies the QoS
requirements.
NOTE 1: The PDB value for the case of dedicated synchronization communication
(i.e. a QoS flow dedicated for transmitting gPTP messages) can be pre-
configured by the operator at the PCF. In this case, the PCF sets up QoS
parameter (i.e. PDB) to fulfil DS-TT to UPF delay to be less than 5 ms, such
that the total limit is achieved, without the need for the PCF to learn if
this concerns a DS-TT/UE to NW-TT/UPF communication or a DS-TT/UE to DS-TT/UE
communication.
NOTE 2: As a result of steps 2 and 3, BMCA Announce messages are delivered in
a default QoS flow but only time synchronization event messages are delivered
in the new QoS flow.
4\. Sync message is delivered from the previous TSN node to DS-TT/UE1. It has
time stamp of TSN GM clock. It also includes correction and rateRatio fields.
The rateRatio is (GM clock frequency) / (local clock frequency).
5\. DS-TT/UE1 updates the Sync message. It adds the link delay between the DS-
TT/UE1 and the previous TSN node to the correction field. It also updates the
rateRatio field with the previous rateRatio multiplied by neighborRateRatio.
The neighborRateRatio = (local clock frequency of the previous TSN Node) /
(local clock frequency). It also attaches Ingress Timestamp based on 5G GM
clock to the Sync message.
6\. Sync message is delivered from DS-TT/UE1 towards NW-TT/UPF. It has time
stamp of TSN GM clock. It also includes correction, rateRatio and Ingress
Timestamp fields.
7\. NW-TT regenerates the Sync message. It calculates the residence time as
Egress 5G GM Time - Ingress 5G GM TS) * rateRatio in the sync message. It
updates the correction field as the previous correction field value + the
residence time. Then, it removes the Ingress timestamp.
8\. Sync message is delivered from the NW-TT to TSN Node 2. It has time stamp
of TSN GM clock. It also includes correction and rateRatio fields.
#### 6.1.3.2 Synchronizing end stations behind DS-TT
The procedure for synchronizing TSN end stations behind other UE(s) with the
TSN GM in the network attached to the device is described in Figure 6.1.3.2-2.
It also includes BMCA-related steps (step 1\~3). After those steps, the sync
message forwarding tree is confirmed. In this case, TSN Node 0 should send
sync messages to 5GS TSN Bridge, and the 5GS TSN Bridge should send sync
messages to TSN Node 3. The remaining steps (step 4\~8/8a) follow principles
in clause 5.27.1 of TS 23.501 [2], with the Ingress TT of DS-TT1 and the
Egress TT of DS-TT2.
Figure 6.1.3.2-1: Procedure for synchronizing TSN end stations behind other
UE(s) with the TSN GM in the network attached to the device side via 5G System
1\. PDU Session Establishment includes UE MAC / Port Info for updates to TSN
AF. After this step, TSN Node 0 and 5GS logical bridge (DS-TT1/UE1, NW-TT/UPF)
can exchange Ethernet frames.
1a. [Optional] If the operator decides to follow the recommendation to limit
the bridge residence time to 10 ms, as defined in IEEE 802.1AS [18], clause
B2.2 (stated as recommendation), then TSN AF may subscribe for the BMCA result
report from the NW-TT. The subscription contains the conditions that need to
be reported, e.g. the current PTP port states and any changes to the current
PTP port states.
1b.For UE-to-UE case, PDU Session Establishment includes UE MAC / Port Info
for updates to TSN AF. After this step, TSN Node 3 and 5GS logical bridge (DS-
TT2/UE2, NW-TT/UPF) can exchange Ethernet frames. Local switching at the UPF
is also enabled.
2\. At BMCA step, TSN nodes exchange Announce messages and build the Sync
forwarding tree for TSN Sync messages. The Sync forwarding tree is per TSN
working clock domain. BMCA procedure (6.1.3.3 for gPTP) is performed when a
NW-TT port or a DS-TT port receives an Announce message.
3\. [Optional] If the operator decides to follow the recommendation to limit
the bridge residence time to 10 ms, as defined in IEEE 802.1AS [18], clause
B2.2 (stated as recommendation), then Based on the BMCA result report from the
NW-TT the TSN AF may trigger QoS setup for the Sync message delivery. PDB1,
which is the UL PDB for the QoS flow of PDU session for UE1, should be less
than 10ms, as the residence time in a node should be less than 10ms.
3a. [Optional] If the operator decides to follow the recommendation to limit
the bridge residence time to 10 ms, as defined in IEEE 802.1AS [18], clause
B2.2 (stated as recommendation), then, Based on the BMCA result report from
the NW-TT , the TSN AF may trigger QoS setup. As the TSN AF can know DS-
TT1/UE1 forwards Sync messages to DS-TT2/UE2 via local switching at the UPF,
it sets the QoS should meet the sum of PDB1, UE1/DS-TT1 residence time, local
switching delay, UE2/DS-TT2 residence time and PDB2 should be less than 10ms.
PDB2 is the DL PDB for the QoS flow of PDU session for UE2. For this, the TSN
AF may trigger the QoS change for PDU session for UE1.
NOTE 1: Calculation of the UE-UE delay can be consistent with the UE-UE TSC
communication solution chosen.
NOTE 2: The PDB value for the case of dedicated synchronization communication
(i.e. a QoS flow dedicated for transmitting gPTP messages) can be pre-
configured by the operator at the PCF. In that case, the PCF sets up QoS
parameter (i.e. PDB) in all cases fulfilling DS-TT to UPF delay to be less
than 5 ms, such that the total limit is achieved.
NOTE 3: As a result of steps 2 and 3, BMCA Announce messages are delivered in
a default QoS flow but only time synchronization messages are delivered in the
new QoS flow.
4\. Sync message is delivered from the previous TSN node to DS-TT/UE1. It has
time stamp of TSN GM clock. It also includes correction and rateRatio fields.
The rateRatio is (GM clock frequency) / (local clock frequency).
5\. DS-TT/UE1 regenerates the Sync message. It adds the link delay between the
DS-TT/UE1 and the previous TSN node to the correction field. It also updates
the rateRatio field with the previous rateRatio multiplied by
neighborRateRatio. The neighborRateRatio = (local clock frequency of the
previous TSN Node) / (local clock frequency). It also attaches Ingress
Timestamp based on 5G GM clock to the Sync message.
6\. Sync message is delivered from DS-TT/UE1 towards NW-TT/UPF. It has time
stamp of TSN GM clock. It also includes correction, rateRatio and Ingress
Timestamp fields.
6a. For UE-to-UE case, the NW-TT/UPF performs local switching and forwarding
for the Sync message. Before local switching, the NW-TT/UPF can perform
multiplication if needed.
6b. For UE-to-UE case, Sync message is delivered from the NW-TT/UPF to DS-
TT/UE2. It has time stamp of TSN GM clock. It also includes correction,
rateRatio and Ingress Timestamp fields.
7a. For UE-to-UE case, DS-TT/UE2 updates the Sync message. It calculates the
residence time as Egress 5G GM Time - Ingress 5G GM TS) * rateRatio in the
sync message. It updates the correction field as (the previous correction
field value) + (the residence time). Then, it removes the Ingress timestamp.
8a. For UE-to-UE case, Sync message is delivered from the DS-TT/UE2 to TSN
Node 3. It has time stamp of TSN GM clock. It also includes correction and
rateRatio fields.
#### 6.1.3.3 BMCA procedure
One of the following alternative methods for the BMCA procedure may be
implemented. The BMCA state machines required in IEEE 802.1AS [18] clause
5.4.1, may run in different parts of the 5G system.
**Method 1:**
When a NW-TT port or a DS-TT port receives an Announce message, if the
Announce information is better than the current best master information it
knows about (per clock domain), the port reports the Announce information to
TSN AF using PMIC signalling. NW-TT and DS-TT also inform TSN AF if a
previously reported best clock is not available anymore (determined based on
lack of Announce or Time Sync messages from that clock). Based on the received
Announce information and local information of 5GS, the TSN AF runs the
PortStateSelection state machine and decides the BMCA port roles for the ports
in the 5GS bridge as described in IEEE 802.1AS-Rev [18] and configures each
port role (per clock domain) accordingly using PMIC signalling. The port that
is configured to Slave role, receives Sync and Announce messages from a node
outside 5GS and sends the Sync and Announce messages to other port(s) inside
5GS. The port that is configured to Master role, receives Announce messages
from the port with Slave role inside the 5GS bridge, increases the
stepsRemoved field of the Announce messages with one, replaces the value of
sourcePortIdentity field of Sync/Announce messages with its portIdentity, and
runs the PortAnnounceTransmit state machine to send Announce messages to a
node outside the 5GS. When DS-TT port configured to Passive role receives a
Sync message from outside of 5GS, it discards the message. Optionally, NW-TT
and DS-TT with port(s) with Master role(s) can generate Announce messages
based on information from TSN AF (e.g. DS-TT or NW-TT acts as a (g)PTP
grandmaster). In this case, Announce messages are not exchanged inside 5GS.
(Details of BMCA procedure implemented by TSN AF are described in Solution #18
in clause 6.18.)
NOTE 1: Depending on the solution to expose the time synchronization service,
the BMCA port roles can be assigned either by TSN AF or NEF.
**Method 2:**
In this alternative, NW-TT receives Announce messages from any NW-TT and DS-TT
ingress port (DS-TT forwards all Announce messages to NW-TT) and NW-TT runs
the PortStateSelection state machine and decides the BMCA port state.
The NW-TT maintains the PTP port state for each DS-TT port and NW-TT port. The
PTP port states may be either locally configured in NW-TT or evaluated by BMCA
procedure.
The TSN AF may configure the Sync receipt timeout and Announce receipt timeout
parameters to NW-TT via BMIC. The TSN AF configures the initial Announce
interval parameter to NW-TT via BMIC and to DS-TT(s) in MasterState via PMIC.
The TSN AF subscribes for the BMCA result report from the NW-TT via BMIC. The
subscription contains the conditions that need to be reported, i.e. . the
current PTP port states and any changes to the current PTP port states. The
TSN AF configures the PTP port state to DS-TT(s) (Master, Slave, Disabled).
When the PTP port states are locally configured in NW-TT, the following
applies:
\- The BMCA function in NW-TT is disabled. If the NW-TT receives an Announce
message from the DS-TT or NW-TT port, the NW-TT ignores the message.
\- When the TSN AF subscribes for the current PTP port states in the BMCA
result reports, the NW-TT reports the PTP port states as they are locally
configured in the NW-TT.
Upon completion of BMCA, if the TSN AF (or NEF) has subscribed for the BMCA
result reports, and if the NW-TT determines that the result of the BMCA has
changed NW-TT reports the BMCA result to TSN AF using BMIC signalling. Based
on this, TSN AF configures the port states in DS-TT(s) using PMIC signalling.
If TSN AF is not deployed then NEF terminates PMIC and BMIC signalling, i.e.
NEF receives the BMCA result from NW-TT and configures the port states in DS-
TT using PMIC signalling.
NOTE 2: NEF terminating BMIC/PMIC signalling does not have any impact on
PCF/SMF as existing Rel-16 functionality is reused for this.
Port states of NW-TT ports are configured locally by NW-TT based on the BCMA
result. When the NW-TT determines that the PTP port state in DS-TT becomes to
MasterState, the NW-TT generates an Announce message to the DS-TT. The NW-TT
does not generate Announce messages for this DS-TT until the content of the
Announce will change (e.g. the grandmaster identity has changed). When a DS-TT
configured to Master role receives Announce messages from the NW-TT via 5GS
user plane, it increases the stepsRemoved field of the Announce messages with
one, replaces the value of sourcePortIdentity field of Sync/Announce messages
with its portIdentity, and runs the PortAnnounceTransmit state machine to send
Announce messages in the frequency as configured by initial Announce interval
parameter to a node outside the 5GS. When DS-TT port configured to Passive
role receives a Sync message from outside of 5GS, it discards the message.
If the NW-TT time outs to receive Announce message from the Slave or passive
port in DS-TT or NW-TT the NW-TT re-evaluates the PTP port states of the DS-TT
and NW-TT ports and reports the updated port state(s) to TSN AF.
**Method 2b:**
Optionally, Method 2 can be optimized to filter the Announce messages in the
ingress port.
For BMCA, each TSN node sends Announce messages to its neighbours. When a TSN
node receives an Announce message, from its neighbour TSN node, it can locally
calculate the status of the receiving port based on the priority vector. A TSN
node with multiple ports, the status of each port and priority vector need to
be aggregated to make a centralized decision on the TSN node level. If the
aggregation is done via User Plane, for each port to send the received
Announce message to a central unit inside the TSN node may be a solution. On
the other hand, for each port to send the changed Announce message to the
central unit inside the TSN node will do the same effects in terms of the
central unit, because repeating the same Announce messages from a port to the
central unit does not make any differences. If a port detects a receipt
timeout event for an Announce message from its neighbour, it means the port
updates its local decision and the port priority vector. In that case, the
change needs to be delivered to the central unit of the TSN node. The port may
also send an Announce message that was expected to arrive with an additional
field to inform receipt timeout event.
**Method 3:**
Support BMCA via the interworking between the DS-TT and NW-TT:
\- When DS-TT received any announce messages from the nodes connecting to the
port(s) of the DS-TT, if the message Priority Vector of the announce message
is better than or equal to the Port Priority Vector of the received port, the
DS-TT sends the received announce messages to NW-TT via UE. The NW-TT is
responsible to detect the Announce reception timeouts over the Slave port and
runs the PortStateSelection state machine to update the BMCA port state. When
the DS-TT time outs to receive announce message from the PDU Session, it sends
the received announce messages over the Master port to the NW-TT, and then the
NW-TT runs the PortStateSelection state machine and decides whether to update
the BMCA port state.
\- The NW-TT knows the port role of the ports on the DS-TT. When the port role
of a DS-TT port is changed from Master to not Master (e.g. Slave), the DS-TT
cannot know the latest Port PV (Priority Vector) if no regenerated announce
message is sent from the NW-TT. However, since the latest Port PV on the NW-TT
is always better than or equal to the Port PV on the DS-TT, the received
announce message which is better than the latest Port Priority Vector on NW-TT
won\'t be incorrectly filtered out by the DS-TT. The DS-TT forwards to the NW-
TT the received announce message which is better than the Port PV on the DS-
TT. Upon reception of the announce message from DS-TT, the NW-TT can double
check the received announce message based on the latest port priority vector,
e.g. filter out the announce message which is worse than the latest port
priority vector.
\- The NW-TT/UPF learns the received port for the announce message based on
the port number associated with the PDU session sending the announce message.
The NW-TT determines the best grand master based on the received announce
messages, the port number of the received port on the DS-TT(S) and NW-TT, and
the System Priority Vector. If the determined grand master is updated, the NW-
TT decides the port state and the sent-out announce message for the nodes
outside the 5GS Bridge accordingly.
\- If the port state of a NW-TT port is master port, the NW-TT forwards the
determined sent-out announce message to the NW-TT port directly. For each DS-
TT port which is a Master port, the NW-TT/UPF runs the PortAnnounceTransmit
state machine to forward the sent-out announce messages towards the PDU
session associated with the DS-TT port. Upon receiving the announce message
the DS-TT forwards it to the port associated the PDU session receiving the
announce message and update the Port Priority Vector accordingly.
NOTE 3: The Port Priority Vector for the not Master port can also be updated
at the DS-TT according to the sent-out announce message from the NW-TT for the
Master port at the DS-TT.
**Method 4:**
The NW-TT maintains the PTP port state for each DS-TT port and NW-TT port. The
PTP port states may be either locally configured in NW-TT or evaluated by BMCA
procedure.
The TSN AF may configure the Sync receipt timeout and Announce receipt timeout
parameters to NW-TT via BMIC. The TSN AF configures the initial Announce
interval parameter to NW-TT via BMIC.
The TSN AF may subscribe for the BMCA result report from the NW-TT via BMIC.
The subscription contains the conditions that need to be reported, e.g. the
current PTP port states, any changes to the current PTP port states, better
Announce is received, or Sync or Announce receipt timeout expires.
When the PTP port states are locally configured in NW-TT, the following
applies:
\- The BMCA function in NW-TT is disabled. If the NW-TT receives an Announce
message from the DS-TT or NW-TT port, the NW-TT ignores the message.
\- If the TSN AF subscribes for the current PTP port states in the BMCA result
reports, the NW-TT reports the PTP port states as they are locally configured
in the NW-TT.
When the BMCA function in NW-TT is enabled, i.e. the 5GS Bridge PTP port
states are evaluated by BMCA procedure, the Announce messages are processed as
below (Details are described in Solution #17).
\- There is a BMCA function in the NW-TT. It runs the BMCA state machines and
keeps the PTP state of all the ports.
\- When the DS-TT port or NW-TT port receives an Announce message, it forwards
the message to BMCA function in NW-TT via U-plane.
\- The BMCA function runs the BMCA state machine to qualify the message,
determines the best grand master and determines the DS-TT port and NW-TT port
states.
\- If the BMCA function in NW-TT determines that the Announce receipt timeout
or Sync receipt timeout has expired for a SlavePort, the BMCA function re-
evaluates the DS-TT and NW-TT port states.
\- If the Announce message is received from a port for which the PTP state
after the BMCA evaluation is SlavePort, the BMCA function updates the Announce
message and generates an Announce message separately for each DS-TT and NW-TT
port which state is MasterPort.
\- If the Announce message is received from a DisabledPort, the BMCA function
discards this message.
\- Upon completion of BMCA, if the TSN AF (or NEF) has subscribed for the BMCA
result reports, and if the NW-TT determines that the BMCA report conditions
are met, the NW-TT reports the BMCA result to TSN AF (or NEF) using BMIC
signalling. Based on this, TSN AF may configure the QoS Flows for the PDU
Sessions correspondingly, or TSN AF may enable or disable the GM in DS-TT
using PMIC signalling. Solution #9 describes the details how to
activate/deactivate the grandmaster in DS-TT.
### 6.1.4 Impacts on services, entities and interfaces
For synchronizing TSN end stations behind 5G System (NW-TT) with the TSN GM in
the network attached to the device, the impacts on UE, SMF, PCF, TSN-AF and
UPF are like the following:
\- The Ingress TT is DS-TT.
\- The Egress TT is NW-TT.
For synchronizing TSN end stations behind other UE(s) with the TSN GM in the
network attached to the device side via 5G System, the impacts on UE, SMF,
PCF, TSN-AF and UPF are like the following:
\- The Ingress TT is DS-TT of a UE.
\- The Egress TT is DS-TT of the other UE.
\- [Optional] The TSN AF needs to trigger QoS setup procedures if the operator
decides to follow the recommendation to limit the bridge residence time to 10
ms.
\- The UPF needs to perform local switching for Sync messages without NW-TT
interaction.
**Method 1 of BMCA procedure:**
NW-TT port/DS-TT port:
\- Verifies the received Announce information is better than the current
Announce and if so, -reports the Announce information to TSN AF.
\- Reports the Announce and Sync receipt timeouts to TSN AF.
\- Generates and sends Announce messages based on the Announce information is
receives from TSN AF.
TSN AF:
\- Receives the Announce information reported by DS-TT/NW-TT port;
\- Upon reception of report for Announce information or Sync or Announce
timeout, executes BMCA to determine the port role and configure port role to
associated DS-TT/NW-TT port.
\- Sends Announce information to DS-TT and NW-TT ports in MasterState.
**Method 2 of BMCA procedure:**
NW-TT port/DS-TT port:
\- NW-TT/DS-TT port in MasterState runs the PortAnnounceTransmit state machine
to generate Announce messages in the interval as configured via initial
Announce interval parameter via BMIC/PMIC.
NW-TT:
\- Receives the Announce messages from DS-TT/NW-TT port;
\- Upon reception of Announce message or expiry of Sync or Announce timeout,
executes BMCA function to determine the PTP port state of each DS-TT and NW-TT
port. Reports the PTP port states to TSN AF.
TSN AF:
\- Configures the PTP port states to DS-TT ports via PMIC (Master, Slave
Passive) based on the BMCA result report from NW-TT.
**Method 4 of BMCA procedure:**
NW-TT port/DS-TT port:
\- No impact (Announce messages are forwarded as any other gPTP messages)
NW-TT:
\- Receives the Announce messages from DS-TT/NW-TT port;
\- Upon reception of Announce message or expiry of Sync or Announce timeout,
executes BMCA function to determine the PTP port state of each DS-TT and NW-TT
port.
\- Generates the Announce messages on behalf of the DS-TT and NW-TT ports in
MasterState.
## 6.2 Solution #2: Handling of UE to UE communication
### 6.2.1 Introduction {#introduction-2}
This solution addresses Key Issue #2: UE-UE TSC communication.
Figure 6.2.1-1: Two DS-TT connecting to different UE
Figure 6.2.1-2: Two DS-TT connecting to the same UE
NOTE: In Figure 6.2.1-1 and Figure 6.2.1-2, SMF1 and SMF2 can be same or not;
PCF1 and PCF2 can be same or not.
After that the PDU session for a DS-TT port is established to the UPF used for
the 5GS Bridge, the DS-TT port becomes one of the ports of the 5GS Bridge. As
shown in Figure 6.X.1-1 and Figure 6.X.1-2, 5GS Bridge include three ports:
Port_1 at DS-TT_1, Port_2 at DS-TT_2 and Port_3 at NW-TT. The possible port
pair could be [Port_1, Port_2], [Port_2, Port_3], and [Port_1, Port_3].
For centralized architecture, if End Station_1 generates a TSN service request
with the destination as End Station_2, it will negotiate with CUC and CUC will
negotiate with CNC. Based on the collected LLDP information from each port and
bridge capabilities (e.g. bridge delay for each port pair), CNC is aware of
End Station_1, End Station_2 can communicate with each other via [Port_1,
Port_2] of 5GS Bridge. The CNC will provide the following TSN information to
5GS Bridge:
\- TSN QoS and for egress port (i.e. Port_2).
\- PFSP information for ingress Port (i.e. Port_1).
The traffic forwarding in the UPF can be established in a number of different
ways:
\- Based on the general Ethernet forwarding principles using flooding and MAC
learning, as specified in 23.501 [2] clause 5.8.2.5.3.
\- Based on 5G VN, as specified in 23.501 [2] clause 5.8.2.13. This may
involve operator pre-configuration.
\- Based on CNC provided static filtering entries. In release 16 this is
specified for the uplink direction only; release 17 enhancements are needed to
extend CNC provided static filtering entry support for all directions.
Traffic forwarding setup takes place before the establishment of the TSN
stream. The traffic forwarding mechanisms are general and apply to both TSC
and non-TSC traffic.
5GS Bridge configures the QoS mapping and TSCAI for PDU Session_1 and PDU
Session _2 respectively, based on the received information.
### 6.2.2 Functional Description
Bride Delay and QoS mapping for two DS-TT ports are different from the port
pair of a DS-TT port and a NW-TT port.
\- For bridge delay, since two PDU Sessions\' SMF and PCF may be different, it
requires AF to derive the Bridge delay of port pair which is comprised of
Port_1 of DS-TT_1 and Port_2 of DS-TT_2:
\- In order to support AF to derive the Bridge delay of port pair [Port_1,
Port_2], the UE provide the DS-TT information of the DS-TT port together with
the port management information in the Port Management Container.
\- The Bridge Delay for the port pair [Port_1, Port_2] includes the delay in
the uplink and in the downlink direction.
Editor\'s note: The detailed calculation for the bridge delay is FFS, e.g.
Option1: as the sum of UE-DS-TT Residence Time for Port_1, PDB for PDU
Sesion_1, UE-DS-TT Residence Time for Port_2 and PDB for PDU Session_2;
Option2: as the sum of the delay for PDU Session 1, the delay for PDU Session
2 and the sum of the residence times for UE-DS-TT1, UE-DS-TT2 and UPF
residence time.
\- For QoS mapping, so far, the AF has the TSN information associated with the
egress port and PFSP information associated with ingress port. Thanks for
these information, the AF can associate PDU session1 and PDU session2. The AF
derives the TSC QoS parameters for PDU session1 and PDU session2 and transmit
them to PCF_1 and PCF-2 respectively. The QoS flow in PDU Session_1 is uplink
and the QoS flow in PDU Session_2 is downlink.
\- In order to minimize impacts on 5GS, it is also proposed SMF(s) to
calculate the TSCAI according to TSC Assistance Container from TSN AF which is
same with Rel-16 mechanism.
### 6.2.3 Procedures
#### 6.2.3.1 procedure for DS-TT information report
Figure 6.2.3.1-1: DS-TT information report procedure
The procedure is based on the UE requested PDU Session Establishment or
Modification procedure and SMF initiated SM Policy Association Modification
procedure in TS 23.502 [3].
1\. DS-TT indicates the port\'s DS-TT information in the Port Management
Container and UE forwards the received Port Management Container in the PDU
Session Modification Request. The Port Management Container is sent to AF via
AMF, SMF and PCF.
2\. AF based on the collected the detected port\'s DS-TT information, UE-DS-TT
residence time, PDB, AF calculate bridge delay for all port pairs as follows:
\- Deduce the 1st kind of port pair, comprised of a DS-TT port and a NW-TT
port.
\- Deduce the 2nd kind of port pair, comprised of a DS-TT port (Port_1) and
another DS-TT port (Port_2).
\- When applicable, the bridge delay for the 3rd kind of port pair, comprised
of two NW-TT ports, can also be calculated.
#### 6.2.3.2 procedure for TSCAI and QoS
Figure 6.2.3.2-1: as defined in Figure 4.16.5.2-1: PCF initiated SM Policy
Association Modification in TS 23.502 [3]
The procedure is based on PCF initiated SM Policy Association Modification
procedure in TS 23.502 [3], with following difference in the step 1a (AF sends
Application/Service Infor to the PCF):
1\. AF can determine the egress port and the ingress port based on the
combination of information provided by the CNC and local information such as
local configuration.
2\. AF can derive the TSN QoS requirement for egress port and ingress port,
based on the received TSN information (i.e. IEEE 802.1Qbv [8] and PFSP):
\- IEEE 802.1Qbv [8] for egress port (Port_2): e.g. Traffic class, priorities
of the traffic class.
\- PFSP for ingress port (Port_1): e.g. Stream Priority.
3\. AF can derive the TSC Assistance Container for UL and DL TSN flow based on
PFSP for ingress port (Port_1).
4\. AF provide PCF the TSN QoS information as follows:
\- AF provide to PCF_1 which is associated with PDU Session_1 the following
information:
(a) TSN QoS parameters for Port_1.
(b) TSN parameters used for UL TSCAI for the TSN flow.
\- AF provide to PCF_2 which is associated with PDU Session_2 the following
information:
(a) TSN QoS parameters for Port_2.
(b) TSN parameters used for DL TSCAI for the TSN flow.
### 6.2.4 Impacts on services, entities and interfaces
AF:
\- Based on the DS-TT information of the DS-TT port, deduce all the possible
port pairs. For port pair of the two DS-TT, comprised of Port_1 of DS-TT_1 and
Port_2 of DS-TT_2, and calculate the bridge delay.
\- Based on information from the CNC and local information, derive the ingress
and the egress ports:
(a) Derive TSN QoS parameters for PDU session1 related to Port_1 and TSN QoS
parameters for PDU session2 related to Port_2 respectively.
(b) Derive TSC Assistance Container used for downlink TSCAI and uplink TSCAI
respectively.
## 6.3 Solution #3 UE-UE TSC communication with VN group
### 6.3.1 Introduction {#introduction-3}
This solution address Key Issue #2 \"UE-UE TSC communication\", i.e. UE-UE TSC
communication between two UE(s) that are served by the same UPF.
VN group mechanism as defined in Rel-16 TS 23.501 [2] clause 5.29 or clause
5.8.2.13 is reused to achieve the UE-UE TSC communication.
The UE-UE TSC communication with VN group is applied for that both PDU
Sessions of UEs that served by the same UPF. In the case that the SMF could
determine the UE-UE DS-TT port pair that allows to communicate with each other
based on the 5G VN group data, then the same SMF is required as specified in
TS 23.501 [2] clause 5.29.3. In the case that the AF could determine the UE-UE
DS-TT port pair that allows to communicate with each other e.g. based on 5G VN
group configuration or local operator policy, and there is no N19 tunnel in
the 5G VN, then different SMFs can be used. The AF can divide the UE-UE stream
to each PDU sessions serving by the same or different SMFs, and instruct the
SMF/PCF to apply the local switch for UE-UE TSC communication as specified in
TS 23.501 [2] clause 5.8.2.13.
### 6.3.2 Functional Description
This solution is based on the following principles:
\- The 5GS knows the UE/DS-TT pairs which can perform the UE-UE TSC
communication under condition that UEs/DS-TT pairs belonging to the same 5G
VN.
\- The SMF and optionally AF can know the VN group information as defined in
TS 23.501 [2].
\- When the SMF knows the two UEs/DS-TTs are belonging to the same VN group
and served by the same (anchor) UPF, SMF will pair them and report the port
pair numbers to the TSN AF. Bridge delay of this UE-UE port pair is the sum of
the two PDU Sessions associated to this port pair and is calculated by the TSN
AF.
\- When the AF discovers a new UE/DS-TT port of a 5GS bridge, if the AF is
configured to determine the UE-UE DS-TT port pair that allows to communicate
with each other based on 5G VN group configuration, the AF can receive the UE
ID, i.e. GPSI from the SMF or PCF, then the AF could check the other UEs that
belong to the same VN group with the new UE using the 5G VN group
configuration, as well as connect to the same 5GS bridge with the new UE, and
then compose the UE-UE DS-TT port pair that allows to communicate with each
other.
\- When the AF discovers a new UE/DS-TT port of a 5GS bridge, if the AF is
configured to determine the UE-UE DS-TT port pair that allows to communicate
with each other based on local operator policy, the AF could check the other
UEs that connect to the same 5GS bridge with the new UE, and then compose the
UE-UE DS-TT port pair that allows to communicate with each other using local
operator policy.
\- When the TSN AF receives the PSFP configuration and if applicable, traffic
forwarding information (static filtering entries) from the CNC, it determines
whether frames described via destination MAC address and/or VLAN index (VID)
from PSFP, received on a specified ingress port and are to be forwarded
through a given 5GS Bridge egress port. The ingress port and/or egress port
are derived based on the local configuration or traffic forwarding information
that matches with frame described via the destination MAC address and/or VLAN
index from PSFP. Using the association between the MAC address used by the PDU
Session, 5GS Bridge ID and port number on DS-TT (maintained at TSN AF), TSN AF
further determines the flow for the UE-UE communication and divides the flow
into two PDU Sessions, one for UL and one for DL. UL and DL streams are
respectively triggered by the TSN AF to be established, and a UE-UE
communication indication, including involved PDU sessions and flow directions,
is provided by the TSN AF for the SMF to apply the local switch as specified
in TS 23.501 [2] clause 5.8.2.13. Additional, if the AF knows the source MAC
address of the stream, the source MAC address could be part of the Ethernet
packet filter.
NOTE 1: The destination MAC address can be a unicast address or a multicast
address.
NOTE 2: The AF determines ingress port of a stream based on PSFP and local
information (e.g. local configuration) as 5.28.2 and Annex I.1 defined in
23.501, and it determines egress port based on traffic forwarding information
or local configuration associated to destination MAC address of this stream.
This solution sets the forwarding only for TSN streams that are indicated by
PSFP to the TSN AF. Besides the usage of the traffic forwarding information
described in this solution, further usage of the traffic forwarding
information is possible.
\- When the SMF receives PCC rules with a UE-UE communication indication for
the UL or DL stream for a TSC PDU Session that supports 5GLAN, it determines
that the flow is for UE-UE communication according to the indication and
create the N4 rules (PDR, FAR, QER, URR) on the UPF to apply local switch as
defined in clause 5.8.2.13 in TS 23.501 [2]. If UE-UE communication indication
is not provided, the SMF determines N4 rule s (PDR, FAR) to handle packets
using Rel-16 mechanism, i.e. forwarding UL stream to NW-TT or detecting DL
stream from NW-TT.
NOTE 3: The SMF determines and derives N4 rules as defined in clauses 5.8 and
5.29.4 of TS 23.501 [2].
\- SMF should also be able to insert I-UPF as a result of mobility (and in
cases where there is no connectivity between NG-RAN and PSA UPF) within the
same 5GS Bridge.
\- TSCAI for UL and DL streams are respectively calculated by the SMF during
UL and DL streams establishment as defined in TS 23.501 [2].
### 6.3.3 Procedures
For the scenario generating TSC stream from UE1 to UE2, procedures for bridge
delay reporting and traffic detection and forwarding rule establishment is as
figure 6.3.3-1 illustrates.
Figure 6.3.3-1: Procedure for bridge delay reporting and traffic detection &
forwarding rule establishment
1\. PDU Session Establishment for UE1 as specified in clause 4.3.2.2.1 of TS
23.502 [3].
2\. Bridge Delay reporting for UE1 as specified in clause 4.16.5.1 of TS
23.502 [3].
3\. PDU Session Establishment for UE2 as specified in clause 4.3.2.2.1 of TS
23.502 [3]. Optionally the SMF indicates the port number of UE1 PDU Session as
part of port pair to the AF if the SMF determines the PDU Sessions of UE1 and
UE2 are in the same 5G VN Group.
4\. Bridge Delay reporting for UE2 as specified in clause 4.16.5.1 of TS
23.502 [3].
5\. The AF determines the port numbers associated to PDU Sessions of UE1 and
UE2 are port pairs based on 5G VN Group information, local operator policy or
optionally according to the port pair indication in step 3. Then the AF
calculates and reports the bridge delay between UE1 and UE2 to the TSN CP.
6\. The TSN CNC provides the AF the PSFP configuration and Traffic Forwarding
information (filtering database (FDB)), according to the TSN streams scheduled
by TSN system as specified in clause 5.28.2 of TS 23.501 [2].
7-8. The AF determines ingress port and egress port of the stream based on
PSFP configuration, local information, and Traffic Forwarding information.
Then the AF determines that it is UE-UE TSC by combining ingress port number,
egress port number with the information on association between the MAC address
used by the PDU Session, 5GS Bridge ID and port number on DS-TT, as maintained
at TSN AF. Then the AF triggers the 5GC to generate a UL stream for PDU
Session of UE1 and a DL stream for PDU Session of UE2 according to the PDU
Session Modification Procedure as specified in clause 4.3.3.2 of TS 23.502
[3]. AF calculates the TSN QoS BAT of DL stream for PDU Session of UE2 as the
sum of the TSN QoS BAT of UE-UE TSC and the bridge delay for PDU Session of
UE1.
During step 8 of PDU Session Modification procedure, the SMF configures the
UPF to handle the UL and DL stream via local switch as defined in clause
5.8.2.13 in TS 23.501 [2] since the PDU session supports 5GLAN and TSN AF
indicates that this is for UE-UE TSC communication.
If Port Management Container with scheduling information is provided to the
SMF in step 7 or step 8, the SMF will respectively calculate the TSCAI for the
UL and DL stream. The SMF needs to perform TSCAI calculation considering two
associated PDU sessions like the following.
\- TSCAI Burst arrival time for PDU session for UE1 for UL stream is
calculated the same as described in clause 5.27.2 of TS 23.501 [2].
\- TSCAI Burst arrival time for PDU session 2 for DL stream is calculated the
same as described in clause 5.27.2 of TS 23.501 [2].
NOTE: The 5GS Bridge delay calculation could be updated e.g. if UPF residence
time estimation is adopted.
### 6.3.4 Impacts on services, entities and interfaces
SMF:
\- If the AF does not maintain the 5G VN Group information, the SMF determines
the UE port pair base on 5G VN Group information.
AF:
\- If the AF maintains the 5G VN Group information, the AF determines the UE
port pair base on 5G VN Group information.
\- Need to perform TSCAI calculation considering two associated PDU sessions
and indicates the UE-UE TSC to 5GS.
Npcf_SMPolicyControl_Update request:
\- If the AF does not maintain the 5G VN Group information, the SMF indicates
PCF the (DS-TT, DS-TT) port pair.
Npcf_PolicyAuthorization_Notify:
\- If the AF does not maintain the VN Group information, the PCF indicates AF
the (DS-TT, DS-TT) port pair.
## 6.4 Solution #4: Deterministic QoS for UE-UE TSC communication
### 6.4.1 Introduction {#introduction-4}
The solution is proposed to solve Key Issue #2: UE-UE TSC communication. In
this Key Issue, more than one UE attached to the 5GS are communicating with
each other without involving the DN. The solution does not rely on 5G VN, but
it may co-exist with 5G VN when supported. Figure 6.4.1-1 illustrates the
target scenario a UE-UE pair that is assumed by this solution. In the figure,
user plane packets sent by the source UE are delivered to the destination
UE(s) through the UPF. It could be one or more SMFs controlling the UPF. In
the assumed scenario, the UEs can be served by a single NG-(R)AN node or
different NG-(R)AN nodes. Additionally, the serving SMFs may insert in the
data path of a PDU Session an I-UPF (Intermediate UPF) between the common PSA
UPF and the NG-RAN(s) to extend the service area of the common PSA UPF (e.g.
due to UE mobility). Based on TS 23.501 [2], a PDU session is the association
between the UE and a Data Network (DN) that provides a PDU connectivity
service
This solution works with TSC UEs that are part of a 5GS bridge integrating
into a TSN network, or with a standalone 5GS with IP or ETH PDU Session type.
When configuring the deterministic QoS for UE-UE TSC, the PCF and SMF need to
perform session management for two associated PDU Sessions considering the
information obtained from the AF (or TSN AF). The coordination of QoS
parameters for UE-UE communications operates the same for IP or ETH PDU
Session types.
Figure 6.4.1-1: UE-UE TSC communication scenario before UE2 mobility event
Figure 6.4.1-2: UE-UE TSC communication scenario after UE2 mobility event
### 6.4.2 Functional Description
This solution is based on the following principles:
\- The deterministic QoS requirements for the TSC communication are obtained
from the network administrator or AF, incl. TSN AF. The AF sends request
separately for the talker (uplink traffic) and each listeners (downlink
traffic).
\- The PCF determines QoS policies considering AF request(s) for the
individual PDU Sessions are established for the talker and the listeners.
\- To monitor UE peers in a PDU Session, the PCF can request the SMF to notify
when new UE destinations are detected in a PDU Session via Policy Control
Request Triggers (PCRT) within the Session Management. Then, the SMF can
configure via N4 rules (i.e. Packet Detection Rules and Usage Reporting Rule)
at the UPF to classify the traffic and report Session ID of the target UE
(alternatively, target UE\'s MAC@ or target UE\'s IP@) if the UPF determines
optimized UE-UE routing can be applied (i.e. local switching).
NOTE 1: the solution applies to unicast addresses only, for cases where the
traffic is switched at a single UPF (i.e. no N19).
\- Upon notification from UPF, the PCF and/or SMF can determine the associated
PDU Sessions. The PCF may trigger reconfiguration of deterministic QoS for the
PDU Sessions with UE-UE TSC communication under the same UPF.
\- The two PDU Sessions are established independently for UE-UE
communications. The PCF configures UE1\'s policies when the PDU Session for
UE1 is established. Later when the request for UE2 is received and the PDU
Session is being established for UE2, UE2\'s policies are determined and if
needed UE1\'s policies may be reconfigured.
\- To coordinate UE-UE TSC communication configuration, more than one SMF may
be involved (i.e. different SMF(s) being selected for the different PDU
Sessions). The PCF(s) are responsible of providing the policies to individual
SMF(s).
\- The SMF may insert an I-UPF on one leg of the UE-UE data path to extend the
service area of the common PSA UPF if UEs mobility triggers the change to a
NG-(R)AN node without connectivity to the common PSA UPF.
NOTE 2: The proposal of insertion of an I-UPF is not specific to UE to UE
communication.
\- Once the SMF determines UE-UE TSC traffic using the Session ID for the
target UE (alternatively, target UE\'s MAC@ or target UE\'s IP@) reported by
the UPF, it pairs the two DS-TT ports and reports back to the TSN AF after
completing PDU Session procedures via PCF.
\- TSN AF can compute the initial value for the 5GS Bridge delay for UE-UE TSC
communication with the UE-DS-TT residence time value(s), PDB for the two QoS
Flow(s). The 5GS Bridge Delay should be set as sum of UE-DS-TT-1 residence
time, PDB of QoS Flow-1, PDB of QoS Flow-2, and UE-DS-TT-2 residence time. The
bridge delay may be updated later based on QoS reconfiguration.
### 6.4.3 Procedures
#### 6.4.3.1 Procedure for AF providing UE-UE TSC QoS information
The procedure for the AF providing the configuration of deterministic QoS for
UE-UE TSC communication is described in Figure 6.4.3.1-1. The steps are
similar to the procedure defined in clause 4.3.6.2 of TS 23.502 [3].
Figure 6.4.3.1-1: Procedure for deterministic QoS coordination for UE-UE TSC
communication
1\. The AF sends TSC QoS request to the NEF (e.g. using solution #5)
independently for talkers and listeners.
2\. The NEF checks whether the AF is authorized to send the TSC QoS request
and forwards the request to the UDR.
3\. The UDR updates the impacted UE(s) SM subscription data.
4\. The UDR responds to the NEF.
5\. The NEF acknowledges the AF. To configure UE-UE TSC communications, steps
1-5 may be performed multiple times to configure the talker and the listeners.
6\. The PCF(s) that have subscribed to modifications of AF requests receive(s)
a Nudr_DM_Notify notification of data change from the UDR.
7\. If needed, the PCF updates the SMF with corresponding new PCC rule(s).
8\. When a PCC rule is received from the PCF, the SMF may take appropriate
actions to reconfigure the user plane.
#### 6.4.3.2 Procedure for UE triggered UE-UE TSC configuration
The procedure for configuring UE-UE TSC routing from UE requests and for TSN
deployments the reporting of DS-TT port pairs is described in Figure 6.4.3.2-1
when two UEs are assumed.
Figure 6.4.3.2-1: Procedure for UE-UE TSC routing reconfiguration and DS-TT
port pair reporting
1\. UE1 initiates PDU Session Establishment procedure.
2\. UE2 initiates PDU Session Establishment procedure.
3\. For TSN scenarios, the TSN AF can determine the DS-TT port pair based on
the collected DS-TT information for all UEs connected to the same TSN network.
4\. Based on previous AF\'s or UE\'s requests, the PCF determines the need to
monitor user plane traffic to identify UE-UE peers and dynamically adjust QoS
configuration for TSC traffic. The PCF requests SMF for notification (e.g. via
a PCRT).
5\. The SMF configures UPF\'s N4 Session to report target UE\'s session ID or
target UE\'s MAC@ or target UE\'s IP@ (to enable determination of UE-UE local
switching).
6\. Inspecting the user plane traffic, the UPF identifies the PDU sessions for
which optimized routing was employed based on MAC address learning (in the
case of Ethernet PDU Sessions) or IP address learning (in the case of IP PDU
Sessions).
7\. The UPF reports the UE-UE peers to the SMF via N4 Session signalling. The
UPF may report target UE\'s session ID, MAC@ or IP@.
8\. SMF stores UE-UE peers\' information and reports to the PCF via
SMPolicyControl service.
9\. PCF performs policy decision. For every UE, the PCF may determine a
different QoS configuration (e.g. 5QI) considering AF TSC QoS requests, the
E2E TSC requirement and UEs\' connectivity status.
10\. PCF may update PCC rules and trigger the SMF to reconfigure the QoS
requirements for the user considering the UEs policies and the requested PDU
Sessions and/or QoS Flows belonging to the UE-UE TSC communication.
NOTE: If multiple PCFs are applicable for the two UE(s), as described in TS
23.501 [2] clause 6.3.7.2, the PCFs can subscribe to receive the requests (via
UDR). Each PCF may be subscribed to the known UE peers (not being served by
itself) to receive notifications from the UDR when the QoS are configured for
another PCF. Therefore, every PCF configures the QoS considering only the
UE(s) it is serving and via UDR notifies the remain PCFs to check if the E2E
requirement can be satisfied (i.e. one PCF cannot determine UE\'s policies
including UEs it is not serving).
11\. SMF may determine the appropriate actions to reconfigure UE1\'s and/or
UE2\'s user plane (e.g. access specific QoS parameters).
12\. For TSN scenarios, the SMF can determine DS-TT port pair UPF provided DS-
TT port number during N4 Session establishment and UPF reported session ID for
the target DS-TT when UPF performs local switching. The SMF may report the
port pair to the TSN AF via PCF.
### 6.4.4 Impacts on services, entities and interfaces
PCF:
\- Recognition of UE-UE TSC communication based on the information received
from AF request(s), traffic description, targeted PDU Sessions attributes, or
UEs PDU Session procedure requests.
\- Conversion of the received TSC QoS requirements (end-to-end requirements)
to 5GS QoS parameters and applying it also in the case of UE-UE TSC
communication.
\- Consideration of the policies of more than UE when deriving the PCC rules
per UE.
\- Determination of UE-UE traffic monitoring.
SMF:
\- Recognition of UE-UE TSC QoS need based on the information received from
the PCF and UEs requests (e.g. traffic description and targeted PDU Sessions
attributes).
\- Reconfiguration of the user plane (e.g. N4 session) from more than one UE
considering the UEs policies and the requested PDU Sessions and/or QoS Flows
belonging to the UE-UE TSC communication.
\- Storage of UE-UE peers\' information and forwarding to PCF.
UPF:
\- Reporting of source UE- target UE peers (involved in local switching) to
the SMF based on UPF configured reporting rules (URR).
UDR:
\- Harmonizes the contexts for optimization between different PCF instances.
## 6.5 Solution #5: Deterministic QoS for Native 5GS
### 6.5.1 Introduction {#introduction-5}
For Key Issue #3A: Exposure of deterministic QoS, a solution is needed that
allows \"any AF that has knowledge of deterministic application requirements\"
to \"be able to request TSC services from the 5GS and as authorized, be
notified of pertinent network events.\" This solution provides a mechanism to
do that whereby the AF may learn 5GS capabilities to support TSC, request QoS
with specified requirements and supply information that can be used to derive
TSCAI for 5GS QoS flows. The solution is applicable for all PDU Session Types
(IP, Ethernet and unstructured), and is independent of DN TSN protocols (IEEE
802.1Qbv [8], IEEE 802.1Qci, IEEE 802.1Qcc [7]).
To enable the above capabilities, this solution proposes to enhance External
Exposure of Network Capability (see TS 23.501 [2], clause 5.20), specifically
for Provisioning and Monitoring capabilities, to notify for the support of the
capability to provide deterministic QoS. To reuse the \"Setting up an AF
session with required QoS\" procedure in TS 23.502 [3], clause 4.15.6.6 is
proposed for setting QoS for TSC.
To cover a wide range of possible QoS parameters for TSC applications, the QoS
Reference currently used in AF QoS requests is supplemented with requirements
for specific parameters. When a requirement for a specific parameter is
provided in the AF request, the PCF may, for the referenced QoS profile,
dynamically replace default values with values that meet the specific
requirement provided by the AF.
### 6.5.2 Functional Description
The following capabilities are proposed using QoS request from AF:
\- The AF requests TSC QoS and provides traffic pattern as assistance
parameters via procedure \"Setting up an AF session with required QoS
procedure\", supplying the NEF. with requirements for one or more of a 5GS
delay, jitter, Guaranteed Flow Bit Rate, Flow Direction, Burst Arrival Time at
UE (uplink) or UPF (downlink), Burst Size, Burst Periodicity, Survival Time,
and a Time Domain. The AF also provides a Traffic Description, Target UE PDU
session Identification, AF Identification, and a QoS Reference. AF may also
request subscription to events defined in Table 6.1.3.18-1, TS 23.503 [12].
Example of relevant events are Resource allocation outcome, QoS targets can no
longer (or can again) be fulfilled, QoS Monitoring parameters. Service Data
Flow deactivation (when the QoS flow is removed); and then the PCF may decide
to subscribe to PCRTs in the SMF example PCRTs that may be used as defined in,
Table 6.1.3.5-1, TS 23.503 [12] such as GFBR of the QoS Flow can no longer (or
can again) be guaranteed. Additional events and PCRTs may be considered in the
normative phase.
NOTE 1: GPSI may be applied to identify the individual UE in a manner similar
to that used for AF influence on Traffic Routing (see TS 23.501 [2], clause
5.6.7).
The NEF authorizes the AF request and forwards the request to the PCF. Then:
\- The PCF may, according to PCC rule authorization, choose a 5QI based on the
QoS Reference and dynamically set the PDB and/or MDBV according to the
received 5GS Delay and Burst Size requirements. As authorized, AF specified
parameter values are used to over-ride default values, for the 5QI. If an AF
request for a parameter value exceeds an authorization, the PCF may assign the
highest authorized value. The GFBR for QoS Flow is set according to the
Guaranteed Flow Bit Rate.
\- The 5GS may set the TSCAI Burst Arrival Time (BAT), Periodicity and
Survival Time according to the requested Periodicity, Burst Arrival Time and
Survival Time received from the AF.
\- If Time Domain information was supplied by the AF and the 5GS uses the same
Time Domain, then no adjustment is needed for deriving TSCAI information. If
the Time Domain provided by AF is different from 5GS Time Domain and the SMF
has clock drift information for that Time Domain (i.e. clock drift between 5G
timing and AF supplied Time Domain), then 5GS may adjust the TSCAI information
so that it reflects the 5GS Clock. If Time Domain information is not provided
or the SMF does not have synchronization information for a requested Time
Domain, then the TSCAI information will be used without adjustment.
\- If the AF provides burst spread, the 5GS will provide burst spread as part
of TSCAI to the NG-RAN.
\- When subscribed events are met the PCF reports them to the NEF, and NEF
will notify the AF. The subscribed event may be reported once the SMF reports
a PCRT to the PCF.
\- Following the procedure in clause 4.16.5.1, TS 23.502 [3] PCF reports the
events to the NEF, and NEF notifies the AF.
NOTE: The minimum and maximum 5GS delays are independent from packet-length
transmission time.
\- The 5GS provides the response to a request from an AF for TSC QoS.
Editor\'s note: Whether and how to apply Hold and forward buffers for Ethernet
PDU sessions if CNC is not present is FFS.
The following capabilities are proposed for TSC connectivity monitoring:
\- The AF sends request to NEF to monitor the status of TSC connectivity via a
set of events for a UE or group of UEs.
\- If the request is authorized, the NEF subscribes the required monitoring
events to suitable NFs (e.g. AMF, SMF).
\- When the NF detects the subscribed events occurs, the NF sends the event
notification to NEF. The NEF forwards to the AF the received reporting event.
To support notification, the additional events may be added to the list of
monitoring capabilities specified for the NEF in TS 23.502 [3] (see clause
4.15.3.1). Existing events in that list that are relevant for TSC and can be
subscribed to are : PDU Session Status (detected by SMF), Communication
failure (detected by AMF), and Loss of Connectivity (detected by AMF). The
jitter measurements as described in Solution 13 can also be reported via the
Nnef_AFsessionWithQoS service or Nnef_EventExposure services to support
subscription and notification of QoS Monitoring for URLLC (see TS 23.502 [3],
clause 4.2.6.9 and TS 23.503 [12], clause 6.1.3.18).
For supporting TSC communication, which may be beyond IEEE 802.1 TSN
applications, DS-TT and NW-TT in Rel-17 have similar functionalities as in
Rel-16 such as: handling of PTP messages similarly as gPTP messages are
handled in Rel-16, BMIC signalling for NW-TT and PMIC signalling for both DS-
TT and NW-TT.
#### 6.5.2.1 Hold and Forward support
One option is envisioned to support Hold and Forward Buffers in Rel-17:
1\. H&F buffers are configured according to Rel-16 IEEE 802.1Qbv [8]
parameters, only for Ethernet PDU Sessions. Since there is no CNC, it is the
responsibility of the AF/NEF to construct the IEEE 802.1Qbv [8] managed
objects which are transferred in the PMIC as in Rel-16. The Gate Control
managed objects are defined in TS 23.501 [2], Table 5.28.3.1-1, are reproduced
below.
Table 6.5.2.1-1: Gate Control Parameters in PMIC
* * *
_Port management information_ _Applicability (see NOTE 6)_ _Supported
operations_ _Reference_
* * *
                                          *DS-TT*                        *NW-TT*                  *by TSN AF\     
                                                                                                  (see NOTEÂ 1)*
_GateEnabled_ _X_ _X_ _RW_ _IEEE Std 802.1Q [98] Table 12-29_
_AdminBaseTime_ _X_ _X_ _RW_ _IEEE Std 802.1Q [98] Table 12-29_
_AdminControlList_ _X_ _X_ _RW_ _IEEE Std 802.1Q [98] Table 12-29_
_AdminCycleTime (see NOTE 3)_ _X_ _X_ _RW_ _IEEE Std 802.1Q [98] Table 12-29_
_AdminControlListLength (see NOTE 3)_ _X_ _X_ _RW_ _IEEE Std 802.1Q [98] Table
12-28_
_Tick granularity_ _X_ _X_ _R_ _IEEE Std 802.1Q [98] Table 12-29_
* * *
There are two sub-options when using IEEE 802.1Qbv [8] Managed Objects (MOs):
2\. IEEE 802.1Qbv [8] MOs are used to configure H&F buffers only for Ethernet
PDU Sessions.
A comparison of these options is given in the table below:
Table 6.5.2.1-2: Comparison of Options for Configuring H&F Buffers
                                                                                             IEEEÂ 802.1QbvÂ \[8\] for Ethernet PDU Sessions
* * *
Impacts UE/DS-TT and UPF/NW-TT No Impact AF/NEF needs to create Qbv parameters
Yes IEEE 802.1Qbv [8] parameters are used in the 5GS but not in the DN (no TSN
DN or CNC). Yes
### 6.5.3 Procedures
An overall procedure for Native 5GS deterministic QoS is illustrated in Figure
6.6.3-1:
Figure 6.5.3-1: Procedure for Exposure the deterministic QoS
1\. PDU Session Establishment for UE1 as specified in clause 4.3.2.2.1 of TS
23.502 [3]. If the AF is located inside the operator\'s domain, the PCF
exposes the UE-DS-TT residence time to the AF as defined in TS 23.502 [3] and
the AF is configured with the UE to UPF/NW-TT delay per Type of Service.
2\. If the AF is located outside the operator\'s domain, the NEF exposes
Deterministic QoS Capability to AF, as shown in Figure 6.5.3-2. If the NEF
learns the UE-DS-TT residence time from PCF and NEF is configured with the UE
to UPF/NW-TT delay per Type of Service.
3\. Setting up an AF session with required QoS procedure specified in the TS
23.502 [3] clause 4.15.6.6. is executed with the following modifications:
\- The parameters described in clause 6.5.2 \"Function Description\" may be
specified in the AF request to the NEF
\- The NEF may forward to the PCF the additional parameters received at the
NEF, and the PCF derives the 5QI and sets the PCC Rule accordingly. The PCF
includes the Time Domain to the PCC Rule.
\- The response from PCF to NEF, and NEF to AF contains additional information
on the TSC resources allocated for the request.
4\. The PCF creates the PCC rule and provides to SMF. The PCF also includes
the TSC traffic pattern information from NEF/AF.
5\. The SMF may calculate the TSCAI similar to TS 23.501 [2] clause 5.27.2,
with the following modifications:
The SMF assigns the TSCAI with the Time Domain as received from the PCF to a
QoS Flow. If the SMF receives clock drift information from UPF for that Time
Domain (i.e. clock drift between 5G timing and AF supplied Time Domain), then
SMF may adjust the TSCAI information of the QoS Flow so that it reflects the
5GS Clock.
6\. The SMF configures the U-plane and sends the N2 message with TSCAI to NG-
RAN. The SMF distributes the parameters for Hold and Forward Buffering to the
UE and UPF.
**AF requested TSC QoS:**
The following procedure is used to expose 5GS information to aid the AF in
formulating a request for TSC QoS (step 3 of Figure 6.5.3-1).
The information provided in the Capability Response can aid the AF in
formulating a request for TSC QoS by allowing the AF to:
1\. Requesting delay and jitter based on 5GS reported minimum and maximum
delay (between two UE(s) or UE and DN) for PDU Sessions.
2\. Specify in the request for QoS, the relevant MAC address, GPSI or IP
address.
NOTE: For Ethernet PDU sessions, \"UE MAC address\" is a required input
parameter for the Nnef_AFsessionWithQoS_Create service operation.
Figure 6.5.3-2: TSC Capability exposure towards external AF
The NEF obtains 5GS capability to support Determinists QoS for a PDU session
using the PCF provided information and the local configuration in NEF. The AF
receives 5GS bridge minimum and maximum delay information. Since the \"Minimum
5GS Delay supported\" and \"Maximum 5GS Delay supported\" are dependent on UE
residence time, this information is reported as part of the capability
exposure procedure:
Procedure for 5GS TSC Capability exposure towards AF:
1\. The AF requests the 5GS Capabilities to support Determinists QoS. The AF
includes one or more MAC addresses of devices, GPSIs or IP addresses in the
Nnef_TSC_Capability_Request, one or more MAC addresses of devices, GPSIs or IP
addresses. It also includes an Application Identifier. Note some of these MAC
addresses may belong to devices connected via a UE, and some to devices
connected via the DN as the AF may be unaware of network topology.
2\. The NEF finds the PCF (e.g.: by using the BSF) that serves the PDU session
and then NEF sends a request to the PCF.
3\. If the UE-DS-TT has reported a residence time and the PCF indicates TSC
QoS is supported for the Application Identifier, then the PCF provides the UE-
DS-TT Residence time and TSC QoS information for the AF Identifier to the NEF.
4\. For devices where UPF MAC learning has detected the AF requested MAC
address as a Source Address in an uplink frame (and hence the device is
connected via the associated PDU session), or where the IP address and GPSI is
associated with a UE (and hence the BSF found a PCF for the UE address/GPSI,
the NEF provides in the Nnef_TSC_Capability_Response:
a. The \"minimum 5GS delay supported\" and \"maximum 5GS delay supported\" for
the Application Identifier, taking into account UE Residence time and the
delay associated with a TSC 5QI.
For other devices (those whose MAC address has not been detected by the UPF as
a Source Address in an uplink frame), or where the IP address or GPSI is not
recognized, the NEF indicates in the Nnef_TSC_Capability_Response that the
device is not connected via a PDU Session.
NOTE 2: NEF aggregates UE-DS-TT residence time and per QoS configured UE to
UPF/NW-TT delay to determine the delay to be provided to the AF.
**TSC connectivity monitoring:**
Figure 6.5.3-3: Procedure for TSC connectivity monitoring
1\. The AF sends Nnef_EventExposure_Subscribe Request to NEF to monitor the
status of TSC connectivity via a set of events for a UE or group of UEs. The
events are those listed in clause 4.15.3.1 of TS 23.502 [3].
Event Reporting Information defines the type of reporting requested (e.g. one-
time reporting, periodic reporting or event-based reporting, for Monitoring
Events).
2\. If the reporting event subscription is authorized by the NEF, the NEF
sends the Subscribe Requests to the related NFs that detect the events, as
described in TS 23.502 [3] procedures for subscription to these events.
3\. The NEF sends Nnef_EventExposure_Subscribe Response to AF as described in
TS 23.502 [3] procedures for subscription to these events.
4\. The NFs detects the monitored event occurs and sends the event report to
the NEF as described in TS 23.502 [3] procedures for subscription to these
events.
5\. The NEF sends to the AF the notification of TSC communication monitoring
event changed as described in TS 23.502 [3] procedures for subscription to
these events.
### 6.5.4 Impacts on services, entities and interfaces
Impacts on existing entities and interfaces
The solution has the following impacts:
1\. An additional Nnef service is used to expose 5GS TSC capabilities to
support Deterministic QoS.
2\. Additional parameters are included in existing messages in the \"AF
session with required QoS procedure\" specified in the TS 23.502 [3] clause
4.15.6.6.
3\. The PCF uses the additional AF supplied parameters to calculate a PCC
rule.
4\. \"Burst Spread\" is sent from the PCF to the SMF, which uses it to
determine a Burst Spread TSCAI parameter.
5\. Time Domain is provided from PCF to the SMF, which is used by the SMF to
associate the QoS Flow to a Time Domain. The solution assumes that the 5GS can
be made aware of the timing in the AF supplied Time Domain, this can be
provided via Time Synchronization service as described in Solution #7.
NOTE: UE and UPF impacts are noted in the Addendum on Hold and Forward
Buffers.
AF:
\- Deliver TSC connectivity monitoring request message to NEF.
\- Deliver TSC QoS request with TSC QoS reference, TSC traffic pattern, and
subscription to events to the PCF.
### 6.5.5 Addendum: Hold and Forward Buffers for Deterministic QoS
#### 6.5.5.1 H&F Buffer Options
1\. H&F buffers are configured according to Rel-16 IEEE 802.1Qbv [8]
parameters, possibly only for Ethernet PDU Sessions. Since there is no CNC, it
is the responsibility of the AF/NEF to fabricate the IEEE 802.1Qbv [8] managed
objects which are transferred in the PMIC as in Rel-16. The Gate Control
managed objects are defined in TS 23.501 [2], Table 5.28.3.1-1, and are
reproduced below.
Table 6.5.5.1-1: Gate Control Parameters in PMIC
* * *
_Port management information_ _Applicability (see NOTE 6)_ _Supported
operations_ _Reference_
* * *
                                          *DS-TT*                        *NW-TT*                  *by TSN AF\     
                                                                                                  (see NOTEÂ 1)*
_GateEnabled_ _X_ _X_ _RW_ _IEEE Std 802.1Q [98] Table 12-29_
_AdminBaseTime_ _X_ _X_ _RW_ _IEEE Std 802.1Q [98] Table 12-29_
_AdminControlList_ _X_ _X_ _RW_ _IEEE Std 802.1Q [98] Table 12-29_
_AdminCycleTime (see NOTE 3)_ _X_ _X_ _RW_ _IEEE Std 802.1Q [98] Table 12-29_
_AdminControlListLength (see NOTE 3)_ _X_ _X_ _RW_ _IEEE Std 802.1Q [98] Table
12-28_
_Tick granularity_ _X_ _X_ _R_ _IEEE Std 802.1Q [98] Table 12-29_
* * *
2\. IEEE 802.1Qbv [8] MOs are used to configure H&F buffers only for Ethernet
PDU Sessions.
## 6.6 Solution #6 TSC communication without TSN network
This solution has been merged with Solution #5.
## 6.7 Solution #7: Exposure of Time Synchronization
### 6.7.1 Introduction {#introduction-6}
For Key Issue #3B: Exposure of time synchronization, a solution is needed that
allows \"any AF that has knowledge of deterministic application requirements\"
to \"be able to request TSC services from the 5GS and as authorized, be
notified of pertinent network events.\" This solution provides a mechanism to
do that whereby the AF may learn 5GS capabilities to support time
synchronization, request time synchronization with specified requirements, and
supply information that can be used to optimize and configure time
synchronization procedure for connected devices.
The solution is applicable for IP and Ethernet types of PDU Sessions. The
solution is applicable for non-TSN deployments, i.e. when the 5GS is not part
of an IEEE TSN network.
The solution is applicable for the following synchronization methods:
1) assuming use of a gPTP client (IEEE 802.1AS [18] Time Aware System) or PTP
client (IEEE 1588-2008 [13]), e.g. including leveraging the DS-TT and NW-TT
capabilities defined in Rel-16 with IEE802.1AS protocol support.
2) assuming use of a gPTP client (IEEE 802.1AS [18] Time Aware System) or PTP
client (IEEE 1588-2008 [13]) in UPF/NW-TT, where the time source is provided
by 5GS, and UPF/NW-TT is configured to create the (g)PTP message for acting as
grand master clock and conveying the timing information .
3) assuming use of the 5GS time source by 5GS; where the 5G-AN provides a 5GS
reference time to the UE via 3GPP radio layer and UE may provide it to the
applications or devices behind the UE by implementation specific means out of
scope of 3GPP.
4) assuming use of the 5GS time source by 5GS; where the 5G-AN provides a 5GS
reference time to the UE via 3GPP radio layer and DS-TT provides (g)PTP
messages for acting as grand master clock and conveying the timing information
to devices behind the UE.
This solution can be used together with e.g. Solution #1 for the time source
to locate in a TSN node behind the DS-TT/UE.
To enable the above capabilities, this solution proposes to enhance External
Exposure of Network Capability (see TS 23.501 [2], clause 5.20), specifically
for Provisioning and Monitoring capabilities.
To cover a wide range of possible time synchronization requirements for TSC
applications, the AF requests is supplemented with requirements for
synchronization. When a requirement for a specific synchronization parameter
is provided in the AF request, the PCF may dynamically replace default values
with values that meet the specific requirement provided by the AF.
### 6.7.2 Functional Description
The following capabilities are proposed:
\- The AF requests Time Synchronization service via External Parameter
Provisioning, supplying the NEF with requirements for one or more time
synchronization methods, and parameters such as supported (g)PTP versions,
Time Domain, grandmaster priorities, required PTP device type supported by the
5GS in the case of PTP for time synchronization method 1, and required
synchronization accuracy (both in terms of required (g)PTP message rate for
each port in the DN side, and number of connected (g)PTP slaves if 5GS
provides the Time Domain). The AF also provides Target UE(s) Identification or
Spatial Validity Condition (i.e. to target a geographical area), AF
Identification.
NOTE 1: GPSI may be applied to identify the individual UE in a manner like
that used for AF influence on Traffic Routing (see TS 23.501 [2], clause
5.6.7).
Then:
\- Time synchronization method 1 (the time source is located in the DN or
device side):
Time Domain is provided from the DN or Device Side and gPTP or PTP method is
applied. The PCF may, according to PCC rule authorization, choose a 5QI based
on the QoS Reference and dynamically set the PDB and/or MDBV according to
requirements for (g)PTP protocol (e.g. required number of synchronization
clients and gPTP message rate). For Ethernet type PDU sessions, both PTP over
UDP/IP and gPTP over Ethernet are applicable. For IP type PDU sessions, PTP
over UDP/IP is applicable. In this case, neither the NW-TT port or DS-TT port
is a (g)PTP grandmaster.
NOTE 2: It is assumed that 5G internal system clock is made available to all
user plane nodes in the 5G system (e.g. to UEs via SIB/RRC messages).
\- Time synchronization method 2 (the time source is provided by the UPF/NW-TT
in 5GS via gPTP or PTP):
Time Domain is to be provided from the 5GS (or the AF and the 5GS shares the
same Time Domain). The 5GS acts as a (g)PTP grandmaster and the (g)PTP
grandmaster resides in NW-TT.) The PCF may, according to PCC rule
authorization, choose a 5QI based on the QoS Reference and dynamically set the
PDB and/or MDBV according to requirements for (g)PTP protocol. Further, the
PCF may, according to PCC rule authorization, choose a (g)PTP message
generation rate for the UPF/NW-TT adaptively. If the AF does not provide a
required (g)PTP message rate (initial Sync interval, initial Announce
interval), the 5GS may determine a (g)PTP message rate based on 5GS
constraints. For Ethernet type PDU sessions, both PTP over UDP/IP and (g)PTP
over Ethernet are applicable. For IP type PDU sessions, PTP over UDP/IP is
applicable.
\- Time synchronization method 3 (the time source is provided by the 5GS and
5G-AN provides a 5GS reference time to the UE via 3GPP radio layer; UE
provides time information to attached devices using implementation specific
means):
Time Domain is not applicable. A PCC rule for time synchronization is not
required. The method is applicable for both IP type and Ethernet type PDU
sessions.
\- Time synchronization method 4 (the time source is provided by the DS-TT in
5GS via gPTP or PTP):
Time Domain is to be provided from the 5GS (or the AF and the 5GS shares the
same Time Domain). The 5GS acts as a (g)PTP grandmaster. For Ethernet type PDU
sessions, both PTP over UDP/IP and gPTP over Ethernet are applicable. For IP
type PDU sessions, PTP over UDP/IP is applicable. The (g)PTP grandmaster
resides in DS-TT. Solution #9: \"(g)PTP GM support by DS-TT\" describes the
details for the (g)PTP grandmaster in DS-TT. If the DS-TT cannot act as a GM,
then the GM is activated in NW-TT which is the method 2. NEF can be the
coordinator to activate/deactivate the PTP functionalities in DS-TT and NW-TT.
\- The NEF provides the grandmaster related parameters (e.g. grandmaster clock
identity, clock quality) to the UE/DS-TT as described in Solution #9.
\- The 5GS exposes the following to aid the AF in formulating a request for
Time Synchronization that will be acceptable to the 5GS:
1) 5GS Support for Time Synchronization to 5GS.
\- supported time synchronization methods (method 1, 5GS acting as GM).
\- For method 2 and 4, additional information is exposed, including
grandmaster clock accuracy and clock identity
2) supported (g)PTP versions:
\- IEEE 802.1AS [18] (i.e. gPTP), and/or
\- PTP over UDP/IPv4 according to IEEE 1588-2008 [13] Annex D, and/or
\- PTP over UDP over IPv6 according to IEEE 1588-2008 [13] Annex E.
3) Minimum Time Synchronization accuracy supported.
\- The NEF uses the PMIC and BMIC to obtain the DS-TT and NW-TT capabilities
for acting as (g)PTP GM, e.g. which PTP version(s) the DS-TT and NW-TT
supports.
\- Following are some parameters that need to be included as part of Time
Synchronization service activation:
1)- Requested synchronization accuracy for the air interface. If the AF does
not provide a required synchronization accuracy for the air interface, the 5GS
may determine a synchronization accuracy based on 5GS constraints.
2) The time window when the time synchronization service is valid in 5GS
3) (g)PTP version
4) Time Domain
5) grandmaster priority
6) required PTP device type for method 1 and PTP (transparent clock, boundary
clock)
7) (g)PTP message rate (initial Sync interval, initial Announce interval)
8) Target UE(s) Identification
9) Spatial Validity Condition
10) AF Identification.
.- The NEF uses the Time Synchronization service parameters received from the
AF to compose the Time Synchronization service policy that is stored in the
UDR, and composes the necessary (g)PTP parameters to activate and control the
service in DS-TT(s) and NW-TTs. The NEF uses the PMIC or BMIC to manage the
(g)PTP operation in the DS-TT or NW-TT, respectively, influenced by the AF
requested synchronization configuration:
\- The NEF may request the NW-TT or DS-TT(s) (if the DS-TT has indicated that
is capable of acting as a (g)PTP grandmaster) to generate (g)PTP Sync,
Follow_Up and Announce messages by providing (g)PTP grandmaster parameters
(incl. (g)PTP version, domain number(s), , initial sync interval, initial
Announce interval etc.)
\- The NEF may configure the Sync receipt timeout and Announce receipt timeout
parameters to NW-TT via BMIC.
\- Solution 9 describes the details how to activate grandmaster in DS-TT(s).
\- The NEF may request the NW-TT or DS-TT(s) to activate (g)PTP residence time
calculation for the method 1.
\- DS-TT and NW-TT used for IP type PDU Sessions need to support only the
parameters in PMIC and BMIC required for Time synchronization service. DS-TT
and NW-TT used for TSC service support the parameters in PMIC and BMIC as
described in TS 23.501 [2].
\- The AF is in control to activate and deactivate the service. If an AF
request for TimeSync service activation or modification is received for UE/DS-
TT for which PDU Session does not exists, then the NEF may store the
information in the UDR until the target UE establishes the PDU Session, or a
new AF request to deactivate TimeSync service is received. Also, the NEF may
store DS-TT/NW-TT capabilities for UE(s) with active PDU Sessions. If the
TimeSync service deactivation is received for an ongoing PDU Session(s), the
NEF indicates the deactivation to the DS-TT(s) and NW-TT via PCF/SMF. If the
TimeSync service deactivation is received for which the service activation was
previously stored in the UDR, the NEF revokes the TimeSync service information
from the UDR.
\- The AF may provide a temporal validity condition to the NEF when the AF
activates the TimeSync service. Temporal validity condition contains the
start-time and stop-time attributes that describe the time period when the
TimeSync service is active. If the AF request for TimeSync service activation
is for existing PDU session, and the start-time and/or the stop-time is in the
future, the NEF includes the temporal validity condition to the
Npcf_PolicyAuthorization_Create service operation it sends to the PCF. If the
start-time is in the past, the NEF treats the AF request as if the TimeSync
service was activated immediately. If the AF request for TimeSync service
activation is targeted for multiple UEs or for future PDU session(s), the NEF
stores the temporal validity condition to the UDR as part of the time
synchronization service information , and PCF(s) receive(s) the temporal
validity condition from the UDR. The PCF maintains the start-time and stop-
time for the TimeSync service for the PDU Session. When the PCF notices that
the start-time or stop-time is reached, the PCF notifies the NEF via
Npcf_PolicyAuthorization_Notify service operation for the event. In the PCF,
NEF or AF, the start-time and stop-time refer to its UTC based local system
time. Upon reception of the start-time or stop-time event, the NEF determines
which DS-TT and NW-TT associate to the time domain require to be configured
and sends PMIC/BMIC signalling to configure the (g)PTP functionality in DS-TT
and NW-TT accordingly. If multiple start-stop time periods are required, the
AF may repeat one start-stop time period requests.
NOTE 3: This is intended for a wide range of applications, ex. motion control
use-cases, VIAPA, smart grid applications where requirements for
synchronization accuracy and deployment scenario may be very diverse.
\- Considering the AF requested time synchronization service, NEF determines
the time distribution method to use to provide the service, the allowed time
synchronization requirements (e.g. clock synchronization requirement, time
domain, message rate), etc. Depending on the time synchronization service to
configure, time synchronization policies may be associated to a PDU Session
(for methods 1 and 2.
\- To cover all cases, the policy and charging framework enables time
synchronization service control to be applied on a PDU Session (i.e. time
synchronization parameters will determine the QoS requirements for the PDU
Session or QoS Flow) using PCC rules.
\- The NEF stores the time synchronization service parameters in the UDR.
\- The following subscription information is defined for time synchronization
services:
\- whether the UE is authorized to use time synchronization services and the
methods allowed.
\- the list of time synchronization parameters as defined in solution #7 and
solution #9.
\- Policy control and charging information.
To support notification, the additional events may be added to the list of
monitoring capabilities specified for the NEF in TS 23.502 [3] (see clause
4.15.3.1).
Solution #1 can be used with this solution to manage BMCA procedure for the
time domain.
### 6.7.3 Procedures
For IEEE TSN integration, i.e. if TSN AF is deployed, TSN AF controls the gPTP
functionality in DS-TT or NW-TT using existing PMIC or BMIC signalling,
respectively. Otherwise (i.e. for IP or Ethernet PDU Sessions not part of an
IEEE TSN network), the NEF terminates the PMIC signalling instead of TSN AF.
The following procedure is used to expose 5GS information to aid the AF in
formulating a request for Time Synchronization in 5GS.
Figure 6.7.3-1: Time Synchronization capability exposure towards AF
The following procedure is used by the AF to request
activation/deactivation/modification of the Time Synchronization service in
5GS.
Figure 6.7.3-2: Activate/Deactivate/Modify UE\'s Time Synchronization Service
0\. PDU session may be established between UE/DS-TT and UPF/NW-TT. . It could
also be established using device trigger procedure as defined in TS 23.501
[2], TS 23.502 [3].
1\. An AF sends a Time Sync Service Request indicating e.g. the target UE,
group of UEs, or DNN and S-NSSAI, and the clock domain to the PCF via NEF to
activate/deactivate/modify UE\'s time synchronization service. The activation
or modification request may contain a temporal validity condition.
If the request is target for multiple UEs or for future PDU session(s), the
NEF determines the time synchronization service policy based on the Time Sync
Service Request and stores the time synchronization service policy to UDR. The
PCF(s) receive(s) a Nudr_DM_Notify notification of data change from the UDR.
The time synchronization service policy may include time synchronization
method and allowed synchronization requirements (e.g. time synchronization
protocol), and the NEF address (a subscription for the PCF to send
notifications to this NEF address). The PCF subscribes the synchronization
service policy stored as DataSet \"Application Data\" and Data Subset
\"Service specific information\" with the specific S-NSSAI and DNN in the UDR.
2\. The NEF ensures the necessary authorization control and sends PMIC/BMIC
signalling to configure the (g)PTP functionality in DS-TT and NW-TT,
respectively. The NEF subscribes for the BMCA reports from the NW-TT using
BMIC. PCF derives QoS policies and forwards the PMIC/BMIC information to SMF.
3\. The PCF notifies the SMF via Npcf_SMPolicyControl_UpdateNotify message.
4\. The SMF triggers the SM Policy Association establishment/modification
procedure to create a QoS flow (or release the QoS flow) for transmitting the
clock domain\'s (g)PTP message.
5a. The SMF forwards BMIC to the UPF/NW-TT through the N4 session level
modification message, if needed.
5b. The SMF forwards PMIC to the UE/DS-TT.
6a. Upon reception of the notification in step 5, UPF/NW-TT performs
consequent behaviours to support time synchronization of corresponding GM, for
example if the time source for the Time Sync service requested to be activated
is in the UPF/NW-TT, then the UPF will start to create and distribute the
(g)PTP messages of the 5G GM to the UE.
6b. Upon reception of the notification in step 5, UE/DS-TT starts or stops to
handle the (g)PTP messages as indicated in the notification.
7\. If PCF receive Time Sync service request from NEF, the PCF responses the
NEF and the NEF responses the AF with the Time Sync service request result.
If the request in Step 1 is targeted for multiple UEs or for future PDU
Sessions and a PDU session is established, the PCF receives time
synchronization service policy from the UDR and notifies the NEF for the event
when a new PDU session is established. The NEF may then obtain the
capabilities from the DS-TT via PMIC, and send PMIC signalling to the DS-TT
(via PCF) to configure the (g)PTP functionality in the DS-TT.
### 6.7.4 Impacts on services, entities and interfaces
AF:
\- Provides the parameters to the NEF to configure the Time Synchronization
service.
\- Provides parameters required for the operation of the BMCA.
NOTE: The configuration of the BMCA parameters can be used to ensure that the
time source provided by 5GS (via DS-TT and/or NW-TT) is selected for the
devices outside 5GS (the 5GS is selected as the grandmaster).
NEF:
\- Exposes the 5GS capabilities to support Time Synchronization service.
Authorizes the Time Synchronization service request from the AF. Controls the
(g)PTP functionality in DS-TT and NW-TT via SMF.
\- Determines the time synchronization service policy and stores it to the
UDR.
\- Support for the BMCA result report from the NW-TT.
UE:
\- Distributes the 5G reference time to DS-TT and optionally to applications
or devices behind the UE (by mechanism out of scope of 3GPP), for IP and
Ethernet types of PDU Sessions.
DS-TT:
\- Indicates a support for PTP/UDP/IP residence time calculation in Port
Management Information container to the network.
\- When activated by NEF, calculates and adds the measured residence time
between the NW-TT and DS-TT into the Correction Field (CF) of the PTP time
synchronization messages conveyed over UDP/IP, applies to IP and Ethernet
types of PDU Sessions.
\- When activated by NEF, (if the time source is located behind the DS-TT as
in Solution #1): Inserts a timestamp to the PTP time synchronization messages
conveyed over UDP/IP, applies to IP and Ethernet types of PDU Sessions.
\- When activated by NEF, (if the time source is located in the DS-TT):
generates (g)PTP time sync messages (with the indicated PTP version, domain
number(s), sending rate, etc), applies to IP and Ethernet types of PDU
Sessions. Solution #9: \"(g)PTP GM support by DS-TT\" describes the details
for the (g)PTP grandmaster in DS-TT.
UPF/NW-TT:
\- When activated by NEF, (if the time source is located in the DN): Inserts a
timestamp to the PTP time synchronization messages conveyed over UDP/IP,
applies to IP and Ethernet types of PDU Sessions.
\- When activated by NEF, (if the time source is located in the NW-TT):
generates PTP time sync messages (with the indicated PTP version, domain
number(s), sending rate, etc), applies to IP and Ethernet types of PDU
Sessions.
\- Forwards the PTP time synchronization messages conveyed over UDP/IP in DL
direction to the PDU Sessions, applies to IP and Ethernet types of PDU
Sessions.
\- Support for the BMCA result report subscription from the NEF.
UDR:
\- Stores new data format (time synchronization service policy).
PCF:
\- Subscribes and receives the time synchronization service policy from the
UDR.
\- Policy and charging framework for time synchronization service independent
of any PDU Session.
## 6.8 Solution #8: AF Requested TSN Synchronization Activation and
Deactivation
### 6.8.1 Introduction {#introduction-7}
This solution addresses Key Issue #3B: AF requested TSN synchronization
Activation and Deactivation.
It is assumed that as below:
\- A TSN GM for TSN Domain 1 is attached to the DS-TT of a UE and a PDU
Session is established for this UE to deliver the UL gPTP/PTPoIP(PTP over
UDP/IP) message to the UPF/NW-TT.
\- A TSN GM for TSN Doman 2 in the NW-TT side can send DL gPTP/PTPoIP message
to all the UPFs attached to the same DN Ethernet network.
\- All the UPF/NW-TT in the 5GS can create gPTP/PTPoIP message for the 5GS
time domain and send the gPTP/PTPoIP message to the UE connected to this
UPF/NW-TT.
\- All the PDU Sessions for the TSN delivery for all the UEs with the same DN
TSN domain (except the 5GS domain) are controlled by the same SMF and the same
UPF.
### 6.8.2 Functional Description
#### 6.8.2.1 General
The AF request the UDM via the NEF to configure UEs SM Subscription with a
dedicated S-NSSAI and DNN for the TSN activation method by providing the
following information:
\- S-NSSAI and DNN for the TSN PDU Session.
\- TSN domain.
\- UL/DL TSN synchronization method.
\- Activation/Deactivation.
The similar function as defined in clause 4.25.3 NIDD Configuration of TS
23.502 [3] is reused.
#### 6.8.2.2 Functional Description for AF Requested TSN Synchronization
Activation
During the UE requested PDU Session Establishment for the TSN synchronization,
the UE provide the following information in the PDU Session Establishment
Request message:
\- S-NSSAI/DNN for the TSN PDU Session.
The same SMF and the same UPF of the UE/DS-TT attached with the TSN GM is
selected.
#### 6.8.2.3 Functional Description for AF Requested TSN Synchronization
Deactivation
After AF request the UDM via the NEF to cancel the configuration of the TSN
activation method by providing information as described in clause 6.8.2.1, the
UDM will update the UEs SM subscription with the dedicated S-NSSAI and DNN for
the TSN and sends the deactivation indication to all the registered SMFs of
the UEs and the SMF will initiate the PDU Session Release procedure.
### 6.8.3 Procedure
#### 6.8.3.1 procedure for AF Requested TSN Synchronization Activation
Figure 6.8.3.1-1: AF Requested TSN Synchronization Activation
0a. There is TSN GM attached to a DS-TT/UE to provide the UL gPTP/PTPoIP
message for the TSN Domain 1. This TSN GM DS-TT/UE PDU Session for the
S-NSSAI/DNN uses the SMF and UPF/NW-TT.
0b. There is TSN GM for TSN domain 2 located in the NW-TT side, and this TSN
GM sends the DL gPTP/PTPoIP message to all the UPF/NW-TT connected the same
ethernet network for S-NSSAI/DNN.
Steps 1 to 6 follow the similar function as defined in clause 4.25.3 NIDD
Configuration of TS 23.502 [3] as below:
1\. The AF sends the Nnef_TSNConfiguration_Create Request (S-NSSAI, DNN AF ID,
TSN Domain ID, UL/DL TSN synchronization method, TSN Activation Indication, UE
ID or External Group ID) to the NEF. The TSN Activation Indication will
indicate whether it is TSN Activation or Deactivation.
2\. The NEF checks whether the AF is authorized to send the request. If there
is UE ID or External Group ID, the NEF needs to map it the SUPI or internal
group ID.
3\. The NEF sends an Nudm_TSNAuthorisation_Get Request (S-NSSAI, DNN, AF ID,
TSN Domain ID, UL/DL TSN synchronization method, TSN Activation Indication,
SUPI or internal group ID) to the UDM to authorise the TSN synchronization
configuration request for the received S-NSSAI and DNN.
4\. The UDM examines the Nudm_TSNAuthorisation _Get Request message.
If TSN Activation Indication indicates TSN Activation and the authorisation is
successful and if an External Group Identifier was included in step 3, the UDM
updates the UEs SM subscription data of the dedicated S-NSAAI and DNN with TSN
synchronization method on the TSN Domain ID.
5\. The UDM sends an Nudm_TSNAuthorisation_Get Response (Result) message to
the NEF to acknowledge acceptance of the Nudm_TSNAuthorisation_Get Request.
6\. The NEF sends a Nnef_TSNConfiguration_Create Response (Cause) message to
the AF to acknowledge acceptance of the Nnef_TSNConfiguration_Create Request.
7\. UE initiates a PDU Session Establishment Request (S-NNSAI, DNN, etc.), the
UE Requested PDU Session establishment procedure and the SMF registered the
PDU Session ID to the UDM are defined in clause 4.3.2.2.1 in TS 23.502 [3] and
the same SMF and UPF are selected as described as in clause 6.X.2.
8a. If DL TSN synchronization for TSN domain 2 is activated, the UPF/NW_TT
will update the Correct Field and forward the updated DL gPTP/PTPoIP message
to the UE/DS-TT and to the TSN end station behind the UE/DS-TT as defined in
clause 5.27.1.2.2 of TS 23.501 [2]. The TSN end station time is updated and is
time synchronized with TSN domain 2 based on IEEE 802.1AS [18] for gPTP or
IEEE 1588-2008 [13] for PTPoIP.
8b. If DL TSN synchronization for 5GS domain is activated, the UPF/NW_TT will
generate the DL gPTP/PTPoIP message for the 5GS TSN domain and sets Correct
Field and forward the DL gPTP/PTPoIP message to the UE/DS-TT and to the TSN
end station behind the UE/DS-TT as defined in clause 5.27.1.2.2 of TS 23.501
[2]. The TSN end station time is updated and is time synchronized with 5GS
domain based on IEEE 802.1AS [18] for gPTP or IEEE 1588-2008 [13] for PTPoIP.
8c. If DL TSN synchronization for TSN domain 1 is activated, UPF/NW-TT locally
switches and forwards the UL gPTP/PTPoIP message of TSN domain 1 to the UE/DS-
TT and to the TSN end station behind the UE/DS-TT as defined in Solution#1.
The TSN end station time is updated and is time synchronized with TSN domain 1
based on IEEE 802.1AS [18] for gPTP or IEEE 1588-2008 [13] for PTPoIP.
#### 6.8.3.2 procedure for AF Requested TSN Synchronization Deactivation
Figure 6.8.3.2-1: AF Requested TSN Synchronization Deactivation
0a. There is TSN GM attached to a DS-TT/UE to provide the UL gPTP/PTPoIP
message for the TSN Domain 1. This TSN GM DS-TT/UE PDU Session for the
S-NSSAI/DNN uses the SMF and UPF/NW-TT. If UL TSN Synchronization is activated
to the UE connected to the UPF/NW-TT, the UL gPTP/PTPoIP message is forwarded
to the UE/DS-TT as described in clause 6.8.3.1.
0b. There is TSN GM for TSN domain 2 located in the NW-TT side, and this TSN
GM sends the DL gPTP/PTPoIP message to the UPF/NW-TT connected the same
ethernet network for S-NSSAI/DNN. The DL gPTP/PTPoIP message is forwarded from
the UPF/NW-TT and then to the UE/DS-TT as described in clause 6.8.3.1.
0c. If DL TSN Synchronization for the 5GS domain is activated to the UE/DS-TT
connected to the UPF/NW-TT, the DL gPTP/PTPoIP message is generated by the
UPF/NW-TT and is forwarded to the UE/DS-TT as described in clause 6.8.3.1.
1\. The AF initiates the TSN synchronization Deactivation procedure as defined
in steps 1 to 6 in clause 6.8.3.1 with the \"TSN Activation Indication\"
indicates TSN Deactivation. If TSN Activation Indication indicates TSN
Deactivation and the authorisation for the request is successful, the UDM
updates the UEs SM subscription data of the dedicated S-NSSAI and DNN with
cancelling the TSN synchronization on the TSN Domain ID and remove the
registered SMF IDs and PDU Session IDs associated with this SM subscription.
2\. The UDM sends the Nudm_UECM_DeregistrationNotification (SUPI, PDU Session
ID, Cause:TSN Synchronization Deactivation) to the registered SMF IDs.
3\. The SMF initiates the network requested PDU Session Release procedure as
defined in clause 4.3.4.3 of TS 23.502 [3], and the UPF/NW-TT deactivate the
function to forward the gPTP/PTPoIP message to the DS-TT/UE.
### 6.8.4 Impacts on services, entities and interfaces
AF:
\- Provide new configuration to UDM via the NEF to activate/deactivate the TSN
synchronization.
UDM:
\- Dynamical create or update the SM subscription data for TSN synchronization
similar as the defined in clause 4.25.3 NIDD Configuration of TS 23.502 [3].
AMF:
\- Select the same SMF for the PDU Sessions for UL TSN synchronization with
the same TSN domain.
NW-TT/DS-TT:
\- Support TSN time synchronization PTP messages over UDP/IP as defined in
IEEE 1588-2008 [13].
## 6.9 Solution #9: (g)PTP GM support by DS-TT
### 6.9.1 Introduction {#introduction-8}
Figure 6.9.1-1: DS-TT distributes 5GS time to devices attached to DS-TT using
(g)PTP
This solution addresses KI#3B. As illustrated in Figure 6.9.1-1, key idea of
this solution is that DS-TT acts as a (g)PTP grand master (GM) for devices
attached to DS-TT. The time information used in (g)PTP is based on the time
information received from the gNB as defined in TS 38.331 [11].
External network sees a single GM, even though inside the 5GS the GM is
distributed to multiple DS-TTs. This means the GMs in the DS-TTs use the same
(g)PTP clock identity, etc relevant GM attributes.
### 6.9.2 Functional Description
The solution is based on the following principles
\- The procedure to expose the 5GS capabilities for time synchronization
service to the AF, and the procedure for the AF to activate, deactivate, and
modify the time synchronization service in 5GS are described in Solution #7.
\- DS-TT indicates to the NEF (or TSN AF) inside a Port Management Information
Container (PMIC) whether DS-TT is capable of acting as (g)PTP GM and which
version(s) it supports
\- IEEE 802.1AS [18] (i.e. gPTP), and/or
\- PTP over UDP/IPv4 as per IEEE 1588-2008 [13] Annex D, and/or
\- PTP over UDP over IPv6 as per IEEE 1588-2008 [13] Annex E.
\- DS-TT indicates to NEF (or TSN AF) inside a PMIC whether it is capable of
acting as (g)PTP GM.
\- If DS-TT has indicated that it is capable of acting as (g)PTP GM, then the
NEF (or TSN AF) may request the DS-TT to generate (g)PTP Sync, Follow_Up and
Announce messages to devices attached to the UE by providing (g)PTP parameters
(incl. (g)PTP version, domain number(s), initial Sync interval, initial
Announce interval, grandmaster clock identity and clock quality, etc.) and an
instruction to start sending (g)PTP messages inside PMIC to the DS-TT. The NEF
(or TSN AF) may consider the clock quality of the 5G GM when it provides the
clock quality to the DS-TT(s).
\- The NEF (or TSN AF) may re-configure the above values to DS-TT(s) via PMIC
during an ongoing PDU Session.
NOTE: DS-TT can be configured to support different (g)PTP profiles, e.g. SMPTE
ST 2059-2 [17] or IEC/IEEE 61850-9-3 [10] by providing the (g)PTP parameters
defined for those profiles to DS-TT.
### 6.9.3 Procedures
For IEEE TSN integration, i.e. if TSN AF is deployed, TSN AF controls the gPTP
functionality in DS-TT using existing Port Management Information Container
(PMIC) signalling between DS-TT and TSN AF.
Otherwise (i.e. for IP or Ethernet PDU Sessions not part of an IEEE TSN
network), the NEF terminates the PMIC signalling instead of TSN AF. To achieve
this, NEF generates PMIC signalling to control the (g)PTP client in DS-TT
based on time synchronization API requests from an AF and sends PMIC to DS-TT
using existing Rel-16 PCF functionality. Similarly, NEF receives PMIC from PCF
using Rel-16 functionality.
It is assumed that a single NEF is handling all time synchronization API
requests for a given UE.
Existing Port Management Information Container (PMIC) signalling is reused
between DS-TT and the network.
The following figure illustrates an overview of the procedure to activate
(g)PTP grandmaster functionality in DS-TT.
Figure 6.9.3-1: Procedure for synchronizing (g)PTP clients attached to DS-TT
with the 5G clock
1\. The AF activates the time synchronization service as described in Solution
#7. Upon PDU Session establishment, the DS-TT indicates to the NEF (or TSN AF)
inside a Port Management Information Container (PMIC) whether DS-TT is capable
of acting as (g)PTP GM and which version(s) it supports. NEF receives PMIC
from PCF using Rel-16 functionality.
The NEF generates PMIC signalling to control the (g)PTP client in DS-TT based
on time synchronization API requests from an AF and sends PMIC to DS-TT using
existing Rel-16 PCF functionality. The NEF includes the GM attributes (e.g.
grandmaster identity, grandmaster clock quality) as described in IEEE 802.1AS
[18] or IEEE 1588-2008 [13] to the PMIC.
If the DS-TT(s) are capable of acting as a grandmaster, the NEF informs the
NW-TT in BMIC with the GM attributes (default dataset) that are sent by the
DS-TT(s) in the Announce messages when the grandmaster in DS-TT(s) is active.
The NEF subscribes for the BMCA result reports from the NW-TT using BMIC. The
NEF may request in the subscription that the NW-TT reports the event of a
better Announce is received (in this case the TSN AF may disable the GM in DS-
TT(s)) or Sync or Announce receipt timeout is detected in NW-TT (in this case
the TSN AF may activate the GM in DS-TT(s)).
If the TSN AF decides to activate or deactivate the GM in DS-TT(s), it informs
this to the NW-TT via BMIC.
2\. DS-TT/UE receives the time information from the gNB as defined in TS
38.331 [11].
3\. DS-TT generates the (g)PTP events based on the time information received
from the gNB, and based on the GM attributes received in the PMIC.
**BMCA procedure to activate or de-activate the GM in DS-TT(s):**
While the GM is active in the DS-TT, the DS-TT generates the Announce messages
to the Master port in this DS-TT as described in IEEE 802.1AS [18] or IEEE
1588-2008 [13]. The NW-TT generates the Announce messages to the Master ports
in NW-TT as described in Solution #1, using the grandmaster clock identity as
configured by the NEF (or TSN AF) via BMIC. Upon reception of Announce message
from a device behind the DS-TT, the DS-TT forwards the Announce message to the
NW-TT for the execution of the BMCA. If the NW-TT determines that due to the
result of the BMCA the (g)PTP grandmaster must be deactivated in DS-TT(s), the
NW-TT reports the BMCA result to NEF using BMIC signalling. The NEF generates
PMIC signalling to control the (g)PTP client in DS-TT(s) and disables the GM
in DS-TT(s). The 5GS starts to distribute the GM from the device outside 5GS
as described in Solution #1.
The details of the BMCA procedure while the GM in DS-TT(s) is not active is
described in Solution #1. If the NW-TT determines that due to the result of
the BMCA the (g)PTP grandmaster must be re-activated in DS-TT(s), the NW-TT
reports the BMCA result to NEF using BMIC signalling. The NEF generates PMIC
signalling to control the (g)PTP client in DS-TT(s) and enables the GM in DS-
TT(s).
### 6.9.4 Impacts on services, entities and interfaces
DS-TT:
\- Optionally send (g)PTP capabilities; receive (g)PTP parameters.
\- Optionally generate (g)PTP messages based on network request.
\- Generates and sends the Announce message according to the information
received from TSN AF/NEF.
TSN AF/NEF:
\- Support Rel-16 PMIC signalling via PCF.
\- Support for the BMCA result report as requested by NEF.
\- Provide (g)PTP parameters incl. (g)PTP version, domain number(s), sending
rate, initial Announce interval, etc. to DS-TT.
NW-TT:
\- Support for the BMCA result report subscription from the NEF.
## 6.10 Solution #10 Static forwarding rule to all directions
### 6.10.1 Introduction {#introduction-9}
This solution addresses the traffic forwarding aspect of Key Issue #2: UE-UE
TSC communication. From a 3GPP system perspective, UE-UE communication is a
special case as that requires the UPF to be able to forward traffic between
UEs without going through a NW-TT. From the TSN network perspective, however,
the UE-UE communication is not special; as the 5GS models a TSN bridge, it
just corresponds to communication between two ports. Currently, static
forwarding rules (i.e. filtering entries) can only be configured by the CNC
for the uplink direction in the UPF/NW-TT to select between the NW-TT ports.
However, centrally managed TSN networks require the capability of configuring
static forwarding rules in any direction so that the CNC can set up the TSN
streams according to the delay requirements. Note also that centrally
configured static forwarding rules are applicable also to non-TSN traffic.
The UPF/NW-TT realizes Ethernet forwarding functionality and makes use of the
static forwarding rules to any port as provided by the CNC. These forwarding
rules are applicable to all traffic irrespective of QoS. It is up to the
implementation how the UPF is structured internally; the Ethernet forwarding
function that realizes static filtering entries may be implemented inside or
outside the NW-TT. The PDU Sessions serving TSC or non-TSC traffic correspond
to 5GS bridge ports, as already specified for TSN feature in release 16. In
the case of downlink traffic, the Ethernet forwarding functionality in the UPF
determines which PDU Session to use using the CNC provided filtering entries.
N4 rules configured by the SMF are still required to use according to the
current specification, e.g. for QoS enforcement or usage reporting; i.e. the
CUPS mechanism remains as specified today. But as the bridge forwarding
mechanism inside the UPF already determines the PDU Session to use, there is
no need to set up N4 rules for selecting the downlink PDU Session. The
existing \"Ethernet PDU Session Information\" indication is sent from the SMF
to the UPF to indicate that the PDU Session is selected based on the
implementation specific Ethernet forwarding within the UPF. This is aligned
with the release 16 specification where the same indication can be used if the
UPF implements general Ethernet forwarding functions based on flooding and MAC
learning (TS 23.501 [2] clause 5.8.2.5.3) or when the UPF implements 1-1
relationship between a PDU Session and an N6 tunnel (TS 23.501 [2] clause
5.6.10.2). Also in these release 16 cases, the UPF implements a similar
implementation specific selection of the PDU sessions. Besides what Rel-16
defines, the Ethernet forwarding functionality in the UPF can also use the CNC
provided filtering entries to select the PDU session.
NOTE: The impact on PDU session lookup is up to UPF implementation.
This solution focuses only on the forwarding aspect, and hence it does not
address questions related to the delay model and QoS.
### 6.10.2 Functional Description
\- The CNC has the possibility to configure static forwarding rules (i.e.
static filtering entries) into the UPF/NW-TT. Static forwarding rules may be
configured for forwarding in any direction, including the possibility of
static forwarding between two DS-TT ports (UE to UE) or between two NW-TT
ports. The possibility of static forwarding rules makes the 5GS logical bridge
act similarly as TSN Ethernet bridge where centrally controlled forwarding
rules are mandatory. This allows the CNC to explicitly establish the traffic
forwarding path using the destination MAC address and VLAN combination of the
TSN stream.
NOTE: Configuring/updating static forwarding rules between two NW-TT ports in
a UPF using the Rel-16 BMIC mechanism, which is based on PDU-session related
signalling, is only supported as long as at least one PDU session for TSN is
established towards the related UPF. This solution focuses on the forwarding
aspect, and the mechanism used to convey the forwarding rules to the UPF is
out of scope of this solution.
\- For the purposes of static forwarding in the downlink in the NW-TT, the PDU
Sessions serving TSC or non-TSC traffic correspond to 5GS bridge ports. When
static forwarding dictates that a frame is to be forwarded on a given port,
the UPF/NW-TT sends the Ethernet frame on the corresponding PDU Session. It is
out of scope of 3GPP specification how the sending of the Ethernet frame on
the given PDU session is realized within the UPF implementation. The already
specified \"Ethernet PDU Session Information\" indication is sent to indicate
to the UPF to use the implementation specific selection of the PDU Session.
The UPF does not need to install additional filtering in the packet detection
rules (PDRs) to determine which PDU Session to select for the downlink traffic
once the port is already determined by the static forwarding rules. Therefore,
the PDRs may contain e.g. match-all filters or filters that correspond to the
appropriate QoS or other rules.
\- The solution assumes any two DS-TT ports are allowed to communicate, as
determined by the CNC/CUC.
\- The solution does not rely on 5G VN mechanism. The solution can co-exist
with some features of the 5G VN mechanism, such as group management and the
setup of N19 tunnelling. An N19 tunnel may be bound to a port of the bridge
forwarding function similarly as PDU sessions serving TSC or non-TSC traffic
are bound to a 5GS bridge port, using similar UPF internal mechanisms. As the
centrally managed TSN network use static forwarding rules provided by the CNC,
there is no need for using SMF provided PDRs for mapping downlink traffic to
PDU Sessions; instead the selection of the downlink PDU Session is performed
in the bridge forwarding function as described above.
### 6.10.3 Procedures
The following new or adjusted procedures are needed for the solution.
\- The scope of the possible static forwarding rules is extended as these are
currently specified for uplink traffic from the UEs to the NW-TT ports. This
solution allows static forwarding rules to be provided to any direction. As
already specified, the CNC may provide static forwarding rules to the TSN AF,
which includes the static forwarding rules in the Bridge Management
Information Container that is forwarded to the UPF/NW-TT that implements the
forwarding accordingly. When implementing the forwarding rules, the bridging
Ethernet forwarding function in the UPF/NW-TT selects the PDU Sessions
corresponding to the outgoing port of the forwarding rule and the existing
\"Ethernet PDU Session Information\" is provided.
### 6.10.4 Impacts on services, entities and interfaces
UPF/NW-TT:
\- The UPF/NW-TT implements static forwarding rules (i.e. filtering entries)
not only in the uplink direction from a UE to the NW-TT ports, but also
between any two ports. It is out of scope of 3GPP how the static filtering
entries inside the UPF are implemented.
\- In the case of downlink traffic, the Ethernet forwarding functionality in
the UPF determines which PDU Session to use using the CNC provided filtering
entries and the existing \"Ethernet PDU Session Information\" indication.
SMF:
\- None
TSN AF:
\- TSN AF provides the static forwarding rules to the UPF/NW-TT not only in
the uplink direction from a UE to the NW-TT ports, but also between any two
ports.
## 6.11 Solution #11: UPF triggered UE-UE TSC communication
### 6.11.1 Introduction {#introduction-10}
This solution addresses Key issue #2: UE-UE TSC communication.
### 6.11.2 High Level Description
\- During PDU establishment, UPF assigns port number for DS-TT of UE and the
corresponding NW-TT for the PDU sessions.
\- During a sequential approach, when UE1 initiates a PDU session it provides
source and destination address.
Editor\'s note: Whether it can be assumed that a UE1 knows the destination
address of other UEs (or devices attached to the UE) before-hand is FFS,
especially considering that UE1 may also provide Ethernet connectivity for
other devices attached to UE1.
\- If the UPF determines that the destination address happens to be a UE which
it had served in the past, the UPF could inform the SMF about the port-pair
optimisation without traversing N6.
\- UPF provides the port-pair recommendation to the TSN AF via UPFSMF PCF.
\- TSN AF calculates the Bridge delay information for the UE-UE TSC
communication.
\- Bridge delay information of UE-UE TSC communication = [UE1-DT-TT residence
time + PDB of PDU session (1)] + [UE2-DS-TT residence time + PDB of PDU
session (2)].
Editor\'s note: How 5GS calculates bridge delay between two UEs if UE1 has not
provided a MAC address that it will send traffic to before-hand) is FFS.
\- TSN AF provides the TSCAI and QoS configuration to the PCF. PCF creates
updated PCC rules and sends to the SMF.
\- SMF initiates PDU Session Modification Procedure for UE1 and UE2. After PDU
session modification is complete, the UPF routes the packets directly to UE2
without the involvement of the N6.
### 6.11.3 Procedures
#### 6.11.3.1 UPF triggered UE-UE TSC Communication
The procedure in Figure 6.11.3.1-1 shows a signalling flow in which the UPF
determines the eligible port-pair for UE-UE TSC communication:
Figure 6.11.3.1-1: Procedure for UPF determining the eligible port-pair for
UE-UE TSC communication
1a. UE1+DS-TT initiates a PDU session establishment Request to SMF. The
destination address of UE2 is included in the PDU Establishment Request. In
this case, the call flow continues to step 2.
1b. UE1+DS-TT initiates a PDU session establishment Request to SMF. UE1
includes the port-pair suggestion of UE2-DS-TT in the request. In this case,
the call flow continues to step 5.
NOTE 1: The call flow is also applicable to a UE with multiple DS-TT ports. In
this case UE1 and UE2 will be same, but DS-TT ports are different.
NOTE 2: UE1 could have knowledge of UE2-DS-TT based on previous connection or
if they belong to same network. Assuming a scenario when the two UE(s) were
performing a UE-UE communication and the connection was abruptly terminated at
UE1 due to any abnormality or UE issue (e.g. baseband crash, power failure,
etc.). In these conditions, it makes more time saving for UE1 to report the
port-pair directly in PDU Session Establishment Request to SMF.
Editor\'s note: Definition of port-pair suggestion is FFS. How it can be
determined that a previous port pair is still valid is FFS.
2\. SMF performs UPF selection and sends N4 establishment request to UPF for
providing the port numbers and 5GS Bridge ID.
3\. UPF determines that the destination port number could also be served by
the same 5GS Bridge and informs SMF about the port-pair details.
NOTE 3: UPF may determine that serving the destination address could be a port
pair based on various factors: VN network, historical PDU session
establishment with UE2, etc., among some examples.
NOTE 4: UPF may maintain the cache history of the MAC address until the
lifetime of the PDU session or a time-limit configured by SMF in the N4
Establishment Request.
4\. UPF reports the port-pair to SMF.
5\. UE1 completes the PDU Establishment procedure as defined in TS 23.502 [3],
clause 4.3.2.2.1, steps 10-14.
6\. Based on the paging, UE2+DS-TT establishes a PDU Session to SMF as defined
in TS 23.502 [3], clause 4.3.2.2.1.
Editor\'s note: Relation to paging is FFS.
7\. After the establishment of PDU Sessions of UE1 and UE2 DS-TTs, SMF
forwards the port-pair and the 5GS Bridge Information to the PCF/NEF. PCF/NEF
forwards the new 5GS bridge information to the TSN AF.
8\. AF calculates the Bridge delay information as follows:
\- Bridge delay information = UE1-DS-TT residence time + PDB of PDU session
(1) + UE2-DS-TT residence time + PDB of PDU session (2).
9\. AF evaluates the QoS for the UL and DL links for UE-UE communication and
shares to PCF along with the TSCAI. AF requests PCF to create corresponding
PCC rules for SMF to use for the PDU sessions via Npcf_Policy Authorization
service.
NOTE 5: AF could request CNC of TSN to provide the QoS or could be able to
provide the QoS and TSCAI based on the TSN configuration received from CNC
during the establishment of the PDU sessions at step 1 and step 2.
10\. PCF creates PCC rule for Uplink transmission and updates SMF of PDU
session (1) via Npcf_SMPolicyControl_UpdateNotify procedure.
11\. SMF modifies the PDU session of UE1-DS-TT with the updated QoS as defined
in TS 23.502 [3], clause 4.3.3.2.
12\. SMF modifies the PDU session of UE2-DS-TT with the updated QoS as defined
in TS 23.502 [3], clause 4.3.3.2.
Based on UPF determination, UE-UE TSN communication is setup successfully.
NOTE 6: Alternatively, PCF could use the existing TSC Configuration provided
by TSN AF during PDU Session Establishment procedure and provide the updated
PCC Rules and TSCAI to the SMF (for UE-UE Communication) via
Npcf_SMPolicyControl_UpdateNotify procedure.
### 6.11.4 Impacts on services, entities and interfaces
\- 5GS Bridge information should include port-pair information.
\- UPF should report the port-pair information to the SMF.
### 6.11.5 Evaluation
Editor\'s note: This clause provides an evaluation of the solution.
## 6.12 Solution #12: The bridge U-Plane model for UE-UE communication
### 6.12.1 Introduction {#introduction-11}
This solution is to Key Issue 2: UE-UE TSC communication. Specially, this
solution proposes a unified u-plane forwarding architecture. This solution
does not touch the port pair determination, 5GS bridge delay of the port pair
calculation and the configuration of deterministic QoS for the UE-UE TSC. It
can work with existing solution for Key issue#2, e.g. solution 2, 3 and 4.
### 6.12.2 Functional Description
In the figure 6.12.2-1, it introduces a FP (forwarding process) in the NW-TT.
All the downlink and uplink traffic are sent to the FP first, and then the FP
decides where the packet is forwarded to.
Figure 6.12.2-1: The forwarding process architecture
With this solution, the static filter entry is only sent to NW-TT in the BMIC
(Bridge management information container).
### 6.12.3 Procedures
There are two phase for the u-plane handling.
**Phase-1: receiving phase:**
Figure 6.12.3-1: receiving phase
As shown in the figure 6.12.3-1, when the downlink or uplink data is received,
it is forwarded to Forwarding process in the NW-TT.
\- When the UPF receives the uplink traffic from PDU session for TSC, it
forward to the FP/NW-TT.
\- When the NW-TT receives the downlink packet from N6/DN, it forward to FP.
**Phase-2: forwarding phase:**
Figure 6.12.3-2: Forwarding phase
As shown in the figure 6.12.3-2, the FP decides how to forward the packet
according to port map in the forward rule (i.e. static filter entry).
\- If the packet matches the port of NW-TT, the FP forwards the packet to the
Port of NW-TT;
\- Otherwise, the FP forwards the packet to the UPF. The UPF uses the N4
rules, e.g. PDR/FAR/QER/URR to handle the packet to the related PDU session.
Editor\'s note: It is FFS how to handle packets to unknown destinations, which
may need to be sent on the NW-TT ports as well.
Editor\'s note: It is FFS how a static filtering rule sent by the CNC is
handled when the filtering rule applies for packets in the downlink direction.
Editor\'s note: It is FFS how packet replication is achieved (i.e. for
broadcast, multicast or unknown unicast frames).
### 6.12.4 Impacts on services, entities and interfaces
Editor\'s note: This clause lists impacts to existing entities and interfaces
## 6.13 Solution #13: Mechanism for AF requesting 5G network jitter
### 6.13.1 Description
This solution is for key issue#3A, which addresses Exposure of deterministic
QoS including aspects related to:
\- Ability for AF to request absolute delay and jitter requirements, and
mechanisms to enable the PCF to determine the 5GS QoS parameters based on the
requirements received from AF.
\- Ability for AF to indicate periodicity, burst size and burst arrival time
(as defined in Rel-16 for TSC Assistance information), optionally burst spread
(variation of burst arrival time for DL traffic resulting from jitter on N6,
if applicable) along with Time Domain (reference for these parameters)
associated with these parameters to the NEF.
This solution proposes a mechanism for the AF to request jitter and the PCF is
required (via NEF if untrusted AF) to calculate an estimation of jitter based
on measured delay values obtained using QoS monitoring.
The main idea is that the AF provides request for jitter, and 5G system
calculate the jitter based on a group of E2E packet delay between UE and PSA
UPF. After PCF getting a group of E2E delay data in measurement period, the
PCF may use the IETF RFC 1889 [16] method to calculate the jitter and send the
jitter value to AF. Considering Rel-16 QoS monitoring mechanism, only average
packet delay measurement in RAN has been defined and that the PSA UPF
calculates the UL/DL packet delay between UE and PSA UPF based on the received
RAN part of UL/DL average packet delay result and the calculated UL/DL packet
delay between RAN and PSA UPF. In order to introduce the jitter calculation
mechanism in Rel-17, there is no enhancement for RAN and UPF, and the average
delay from RAN can be used to calculate an estimation of the jitter.
AF sends a request for jitter calculation by using
Nnef_AFsessionWithQoS_Create request message to NEF, the indication of jitter
requirement, jitter measurement period, sample frequency, reporting threshold
or reporting frequency (TS 23.503 [12] clause 6.1.3.21) may be included in the
request, and are sent to PCF via NEF.
When PCF accepts the jitter requirement, PCF generates the QoS Monitoring
policy for a service data flow, based on the request from AF. In the QoS
Monitoring PCC rule, the QoS monitoring period can be the same as jitter
measurement period. Then PCF provides the QoS Monitoring policy to the SMF.
When SMF gets the PCC rules for jitter calculation, the SMF sends the QoS
Monitoring request to the PSA UPF via N4 and NG-RAN via N2 signalling to
request the QoS monitoring between PSA UPF and NG-RAN, as described in TS
23.501 [2] clause 5.33.3.When the reporting trigger(s) is satisfied, e.g. the
reporting period expires, or the PDU Session is released, the UPF reports the
calculated packet delay value(s) to the SMF, and the SMF sends the reports to
the PCF. PCF may use the IETF RFC 1889 [16] method to calculate an estimation
of jitter based on some measured delay values, which are measured for sampled
packets using QoS monitoring, and then sends the estimated jitter value to AF.
The sample packet frequency for jitter calculation may comply with Poisson
sampling, because it ensures an unbiased and uniformly distributed sampling
during jitter measurement period. However, alternate sampling methodologies
are possible. For example, continuous sampling of a constant bit rate stream
(i.e. periodic packet transmission) is a possibility (IETF RFC 3393 [15]).
### 6.13.2 Procedures
The mechanism for AF requesting jitter requirements can be described in the
Figure 6.13.2-1.
Figure 6.13.2-1: AF requesting jitter requirements
0\. The PDU session has been established.
1\. The AF sends a QoS monitoring request to the NEF by
Nnef_AFsessionWithQoS_Create request message. The request message includes
indication of jitter, jitter measurement period, sample frequency.
2\. The NEF authorizes the AF request and sends the jitter calculation
parameter in the AF request message to the PCF through the
Npcf_PolicyAuthorization_Create request.
3\. PCF generates the authorized QoS Monitoring policy based on the AF
request, measurement period, sample frequency, and triggers SMF to initiate
PDU Session Modification procedure by sending
Npcf_SMPolicyControl_UpdateNotify request.
4a. SMF activates the end to end UL/DL packet delay measurement between UE and
PSA UPF for the QoS Flow or GTP-tunnel during the PDU Session Modification
procedure. SMF sends QoS Monitoring request to AMF by
Namf_Communication_N1N2MessageTransfer message, and AMF sends QoS monitoring
request to NG-RAN through N2 interface.
4b. The SMF sends a QoS Monitoring request to the PSA UPF via N4
5\. AMF sends QoS monitoring request to NG-RAN through N2 interface.
6\. The NG-RAN initiates the measurement of UL/DL average packet delay on Uu
interface based on the QoS Monitoring request from SMF, and NG-RAN performs
delay measurement based on the existing procedures in clause 5.33.3.2 of TS
23.501 [2] for QoS monitoring for URLLC.
7\. NG-RAN reports the UL/DL average packet delay result on Uu interface to
the UPF in the UL packet data as defined in TS 23.501 [2] clause 5.33.3.2.
8\. UPF calculates the end to end packet delay between NG-RAN and PSA UPF, as
described in TS 23.501 [2] clause 5.33.3, and reports the packet delay
value(s) to SMF.
9\. The SMF reports the obtained packet delay value(s) to the PCF by sending
an Npcf_SMPolicyControl_UpdateNotify response message.
10\. When PCF gets the packet delay value(s), it calculate delay jitter based
on packet delay value(s), jitter measurement period, sample frequency. Then
PCF replies the delay jitter value to NEF by using
Npcf_PolicyAuthorization_Notify message. The jitter value provided to the AF
is \"estimated jitter\".
11\. NEF sends jitter and other QoS monitoring data to AF through
Nnef_AFsessionWithQoS_Notify.
### 6.13.3 Impacts on services, entities and interfaces
PCF:
\- Receiving the AF jitter requirement indication.
\- Calculating the estimated jitter value based on QoS monitoring E2E latency
value(s).
There is no new functionality requirement for RAN and UPF.
## 6.14 Solution #14: Supporting Deterministic Communication
### 6.14.1 Introduction {#introduction-12}
This solution is for key issue #3A: Exposure of deterministic QoS.
The scope of this solution is to support deterministic communication to the
UEs operating applications. The main source of QoS related information for
applications is AF, and a UE could operate multiple applications
simultaneously. To take benefits of TSC supporting features, Rel-16 allows the
AF to provide a QoS reference that is mapped by the PCF into QoS parameters.
The fundamental mechanism of this solution is to utilize network analytics
from NWDAF. NWDAF can collect network data, and able to provide the analytics
about Observed Service Experience as defined in TS 23.288 [14]. PCF can decide
if QoS parameters fulfil the QoS requirements.
This solution proposes that a PCF, that responsible for deciding a PCC rule of
deterministic communication, consumes network analytics on Observed Service
Experience from NWDAF.
### 6.14.2 Functional Description
An AF provides QoS requirements, TSCAI related information, and survival time
to the PCF, and PCF decide QoS parameters for serving QoS flow of the
application. The below is the principles of the solution.
\- An AF provides QoS related parameters to PCF for the deterministic
communication such as GPSI, application ID, maximum/minimum delay, maximum
burst data volume, periodic indicator, periodic time, and survival time with
traffic description. The all parameters are not mandatory to be provided. For
untrusted AF case, NEF can be uses to deliver the parameters to PCF.
\- The PCF checks the received parameters maps then to a QoS value, TSCAI, and
survival time used in 5GS. If, the PCF may requests to NWDAF to monitor the
Observed Service Experience.
Editor\'s note: It is FFS whether this is need and how for PCF to distinguish
the AF request that needs PCF to derive the TSC related parameters and AF
request targeting to a non TSC QoS flow. The details of the derivation of TSC
Assistance Container, TSN QoS information are FFS. It is FFS whether there is
a need and how to apply the TT functionalities at DS-TT or NW-TT if the PCF
derives the TSC related parameters.
### 6.14.3 Procedures
For the procedure to utilize network analytics for the PCF to check if the
Service Experience is fulfilled, the procedure is depicted in figure 6.14.3-1.
Figure 6.14.3-1: procedure to utilize network analytics for the PCF
1\. An AF provides QoS related information for a target UE or application. The
deterministic communication can be targeted using the combination of GPSI,
S-NSSAI, DNN, and traffic descriptor. The QoS related information could
contain burst arrival time, burst data volume, periodicity indicator, period
time, and survival time.
2\. An UE request PDU session for a specific S-NSSAI and DNN.
3\. An SMF select a PCF could serve the requested S-NSSAI and DNN, and make a
SM policy association.
4\. The PCF check that the AF provided parameters map them to QoS parameter,
Burst Arrival Time, Periodicity, and survival time. the PCF request to monitor
the Observed Service Experience to NWDAF.
5\. The PCF derives QoS parameters, BAT, Periodicity, and survival time if
needed.
6\. The PCF deliver the derived information to SMF using PCC rule.
7\. The SMF derives TSCAI and establish/modify N4 session according to the PCC
rule.
8\. The SMF provides N2 messages to the (R)AN with TSCAI and survival time. If
needed, PDU session establishment accept message can be delivered to the UE.
### 6.14.4 Impacts on services, entities and interfaces
Editor\'s note: This clause is TBD.
## 6.15 Solution #15: Survival Time is pre-configured in the 5GS
### 6.15.1 Introduction {#introduction-13}
This solution is to Key Issue 5: Use of Survival Time for Deterministic
Applications in 5GS.
### 6.15.2 Functional Description
In the TS 22.104 [4], the survival time is equal to transfer interval or
several times the transfer interval in most of the use cases. (In some cases,
the survival time is equal to zero, see TS 22.104 [4] Table A.2.3.1-1).
This paper proposes that, the survival time for IEEE TSN based application can
be pre-configured in the TSN AF.
With this solution, the TSC Assistance Container defined in the Rel-16 can be
enhanced to carry the survival time from TSN AF to SMF. SMF can add the
survival time with the TSCAI according to the TSC Assistance Container and
send to NG-RAN.
If TSN AF does not include survival time in the TSCAI, then NG-RAN behaviour
is implementation specific.
NOTE: The NG-RAN e.g. based on combination of S-NSSAI and 5QI whether and
which survival time is applied.
### 6.15.3 Procedures
If the survival time is pre-configured in TSN AF, there is no change to
procedure, only TSC Assistance Container and TSCAI are enhanced to carry the
survival time.
### 6.15.4 Impacts on services, entities and interfaces
If the survival time is pre-configured in TSN AF:
TSN AF:
\- is pre-configured with survival time;
\- sends the survival time with the TSC Assistant Container to SMF via PCF.
SMF:
\- receives the survival time with the TSC Assistance Container from TSN AF
via PCF.
\- sends the survival time to NG-RAN in the TSCAI.
NG-RAN:
\- receives the survival time with the TSCAI.
If the survival time is not provided in the TSCAI, then NG-RAN behaviour is
implementation specific.
## 6.16 Solution #16: Survival Time for Deterministic Applications
### 6.16.1 Introduction {#introduction-14}
This contribution proposes a solution to Key Issue 5: Use of Survival Time for
Deterministic Applications in 5GS whereby mechanisms used to convey TSCAI are
extended to include a Survival Time parameter.
This solution is based on the following principles:
\- If a TSC traffic has Survival Time available, the SMF decides whether to
establish a dedicated TSC QoS Flow for the TSC traffic with an indicated
Survival Time based on configuration.
\- Survival Time can be provided by the AF.
\- Survival Time is transferred as a TSCAI parameter but the TSCAI may not
always comprise of Survival time.
\- Survival Time is included in the TSC Assistance Container and delivered to
PCF in an AF request.
\- The PCF provides the Survival Time to SMF in the TSC Assistance container.
\- The SMF determines TSCAI Survival Time and sends it to the NG-RAN together
with QoS profile without requiring AN or N1 specific signalling exchange with
the UE.
\- Survival Time is specified by the AF in units of \"time\" with the
timescale corresponding to burst periodicity or as the maximum number of
consecutive message transmission failures. It is conveyed together with TSCAI
Periodicity parameter (the time between periodic TSC bursts) and burst size
(e.g. MDBV).
### 6.16.2 Functional Description
It is proposed that the mechanism used to transfer TSCAI parameters from the
AF to the SMF as described in TS 23.501 [2] clause 5.27.2 is applied also for
Survival Time. The AF includes the Survival Time, if available, in the TSN AF
QoS Container passed to the PCF as currently specified in TS 23.503 [12],
clause 6.3.1. The PCF subsequently sends the Survival Time to the SMF together
with other TSCAI parameters. Any AF, including a TSN-AF or an AF supporting
Key Issue #3: Exposure of TSC services, may provide Survival Time to the PCF
directly or via the NEF.
The method the AF uses to acquire Survival Time is up to implementation. The
AF may acquire Survival Time values for an application via direct provisioning
on the AF, the AF may set the Survival time to a multiple of the TSCAI
Periodicity, or the AF may obtain Survival Time via other means out-of-scope
for 3GPP.
Survival Time is specified by the AF in units of \"time\" with the timescale
corresponding to burst periodicity or as the maximum number of consecutive
message transmission failures where a message is a single burst comprising a
single packet/frame or an aggregated set of packets/frames and a transmission
failure occurs when the Packet Delay Budget requirement corresponding to the
message is not satisfied. It is conveyed together with TSCAI Periodicity
parameter (the time between periodic TSC bursts) and burst size (e.g. MDBV).
To meet TS 22.104 [4] requirements, if it is described in units of \"time\"
with timescale, the minimum value should be zero, and a maximum of several
seconds, with sub-millisecond granularity , if it is described as maximum
number of consecutive message transmission failures, its value should be an
integer and the minimum value should be zero.
### 6.16.3 Procedures
Survival Time is an optional parameter as part of TSC Assistance container.
For the scenario that the service performance requirements include the
Survival Time, procedures to transfer the survival time from AF to RAN is
illustrated in figure 6.16.3-1.
Figure 6.16.3-1: Transferring Survival Time to RAN
0\. Survival Time is provisioned to the AF.
1\. The AF includes Survival Time in the TSC Assistance Container. Then an AF
session with required QoS procedure is triggered.
2\. The AF sends the TSN Assistance Container to the PCF. The procedure is
performed as defined in clause 4.3.6.2 of TS 23.502 [3].
3\. The PCF triggers Npcf_SMPolicyControl_UpdateNotify message to update the
PCC rule to the SMF and the TSC Assistance container is included in the PCC
rule.
4\. When SMF receives the message, it sets the TSCAI Survival Time as the
Survival Time included in the TSN Assistance Container. If the Survival Time
is described in units of \"time\" with the timescale, the SMF may correct the
value to 5G clock.
5\. The SMF triggers a PDU Session Modification to update the Survival Time
included in TSCAI sent to the NG-RAN without requiring AN or N1 specific
signalling exchange with the UE.
NOTE: How NG-RAN uses Survival Time for the QoS handling is up to RAN WG.
### 6.16.4 Impacts on services, entities and interfaces
AF:
\- Include the Survival Time in AF request, when available.
SMF:
\- Retrieves Survival Time from the TSC Assistance Container And it includes
Survival Time as part of TSCAI sent to the RAN.
PCF:
\- Forwards TSC Assistance container including Survival Time.
NG-RAN:
\- Ability to receive survival time.
## 6.17 Solution #17: U-plane BMCA solution for the key issue#1
### 6.17.1 Introduction {#introduction-15}
The solution is proposed to solve Key Issue #1: the UL Time Synchronization.
Specially, this solution resolves the BMAC part of UL Time Synchronization. It
can work with Solution#1.
In the IEEE 802.1AS [18], before the time synchronization is performed, the
time-synchronization spanning tree shall be established first for particular
TSN time domain. The spanning tree is to 1) avoid the message loop for time
synchronization and 2) determine the port state of the gPTP instance.
There are two methods to establish the time-synchronization spanning tree:
\- BMCA (best master clock algorithm).
\- The port states and grandmaster are configured.
To support the BMCA in the 5GS logical TSN Bridge, a centralized handling is
required.
### 6.17.2 Functional Description
In the figure 6.17.2-1, it introduces a BMCA function in the NW-TT. All the
BMCA related process is handled by BMCA function.
Figure 6.17.2-1: 5GS TNS bridge support BMCA
When the DS-TT port or NW-TT port receives the Announce message from outside
of 5GS, it forwards the message to BMCA function in U-plane.
The BMCA function runs the BMCA algorithm according to 802.1AS[18]. The BMCA
function:
\- determines the GrandMaster clock for a clock domain;
\- determines and maintains the port state of DS-TT port and NW-TT port of the
5GS TSN bridge;
\- runs a PortAnnounceTransmit state machine for each DS-TT port and NW-TT
port to re-generate the Announce message and send the Announce messages to DS-
TT and NW-TT port which is MasterPort role.
When the DS-TT or NW-TT port receives the Announce message from 5GS side, it
sends the message to the nodes outside the 5GS.
### 6.17.3 Procedures
The procedure for BMCA is described in Figure 6.17.3-1. It assumes there are 3
GM clock candidates. The clock-1 resides in the network connect to the DS-
TT1/UE1, the clock-2 resides in the network connect to the DS-TT2/UE2, and the
clock-3 resides in the network connect to the NW-TT.
Figure 6.17.3-1: Procedure for BMCA via 5G System
The NW-TT port is Port-N.
1\. The DS-TT1/UE1 establish the PDU Session for TSC which is specified in the
TS 23.502 [3]. The UPF/NW-TT allocates the Port-1 for the DS-TT1/UE1.
2\. The DS-TT2/UE2 establish the PDU Session for TSC which is specified in the
TS 23.502 [3]. The UPF/NW-TT allocates the Port-2 for the DS-TT2/UE2.
3\. The gPTP Announce message from clock-3 arrives the Port-N (i.e. NW-TT).
4\. The BMCA function in the UPF/NW-TT determine the clock 3 as GM clock for
the time domain. The BMCA function locally assigns the state of port which
receives the Announce message from clock 3 as SlavePort (i.e. Port-N), and
Port-1 and Port-2 as MasterPort.
5\. The BMCA function generates and forwards the Announce message(s),
separately for each DS-TT and NW-TT port, from GM clock (i.e. clock-3) to
MasterPort(s) based on the updated PortStates and AnnouceSendTimer of the
port.
6\. The gPTP Announce message from clock-2 arrives the Port-2 (i.e. DS-
TT2/UE2). The DS-TT2/UE2 forwards the message to UPF/NW-TT.
7\. The BMCA function in the UPF/NW-TT determine the clock 2 as GM clock for
the time domain. The BMCA function locally assign the state of port which
receives the Announce message from clock 2 as SlavePort (i.e. Port-2), and
Port-1 and Port-N as MasterPort.
8\. The BMCA function generates and forwards the Announce message(s),
separately for each DS-TT and NW-TT port, from GM clock (i.e. clock-2) to
MasterPort(s) based on the updated PortStates and AnnouceSendTimer of the
port.
9\. The gPTP Announce message from clock-1 arrives the Port-1 (i.e. DS-
TT1/UE1).The DS-TT1/UE1 forward the message to UPF/NW-TT.
10\. The BMCA function in the UPF/NW-TT determines the GM clock and Port state
are not changed. The BMCA function generates and forwards the Announce
message(s) from GM clock (i.e. clock-2) to MasterPort(s) based on the existing
PortStates according to AnnouceSendTimer of the port.
Upon completion of BMCA, if the TSN AF (or NEF) has subscribed for the BMCA
result reports, and if the NW-TT determines that due to the result of the BMCA
the gPTP grandmaster in 5GS (e.g. DS-TT) must be activated or deactivated, the
NW-TT reports the BMCA result to TSN AF (or NEF) using BMIC signalling. Based
on this, TSN AF (or NEF) enables or disables the GM in DS-TT(s) using PMIC
signalling. Solution #9 describes the details how to activate/deactivate the
grandmaster in DS-TT.
### 6.17.4 Impacts on services, entities and interfaces
NW-TT/UPF:
\- There is BMCA function inside the NW-TT/UPF.
\- The BMCA function run the BMCA algorithm according to 802.1AS[18]. It:
\- determines the GrandMaster clock for a clock domain;
\- determines and maintains the port state of DS-TT port and NW-TT port of the
5GS TSN bridge;
\- runs a PortAnnounceTransmit state machine for each DS-TT port and NW-TT
port to re-generate the Announce message and send the Announce messages to DS-
TT and NW-TT port which is MasterPort role.
## 6.18 Solution 18: Supporting BMCA by processing Announce message
### 6.18.1 Introduction {#introduction-16}
This solution is for key issue #1: Uplink Time Synchronization and #3B:
Exposure of Time Synchronization.
This solution is an option of method 1 of clause 6.1.3.3.
The objective of this solution is to enable BMCA for selecting and managing
Grand Master Clock via 5G TSN bridge. The TSN supporting feature defined
during rel-16, it only describes on how to process (g)PTP messages in the
aspect of residence time and RateRatio. It enables to deliver the time sync
frame, but it is hard to say working as a member of TSN domain because 5GS is
not supporting announce messages which is essential to maintain TSN topology
and master-slave hierarchy. This solution contains the method to process
Announce messages for enabling BMCA and Grand Master Clock management such as
building Master-Slave hierarchy among TSN nodes and their ports.
According to IEEE 802.1AS [18], it is required to support BMCA for exchanging
master clock information to maintain best grand master clock for a specific
TSN domain. The clock information exchange is done by means of Announce
message which containing the system identity of system and root clock for the
given TSN entity. The announce message contains the information of current
grandmaster which the TSN device currently referring such as grand master
priority, stepsRemoved, etc. If a bridges and end-stations received an
Announce message from the neighbour link, it confirms the liveness of
neighbourhood, and compares the best grand master clock. By exchanging the
announce messages, the TSN entities can determines the current grand master
for a specific gPTP domain and shares the sense of time by referring the same
grand master, and it also needed to build the spanning tree where the gPTP
messages propagate over the TSN.
The fundamental mechanism is to configure DS-TT/NW-TT for processing and
transmitting Announce messages correctly by TSN AF. To realize this solution,
it is needed that 1) DS-TT/NW-TT needed to receiving/sending Announce message
with neighbour TSN nodes, 2) PMIC/BMIC needed to extended to contain Port
Announce information, and 3) TSN AF needed to be extended to processing BMCA
and configure DS-TT/NT-TT to enable the processing of Announce messages.
### 6.18.2 Functional Description
An TSN AF process Announce messages instead of DS-TT/NW-TT, and configure DS-
TT/NW-TT for how to processing Announce message. When TSN AF detecting the
changes on the Grand Master Clock, it need to inform DS-TT/NW-TT for
triggering the transmit of Announce messages to neighbour TSN nodes. To
support Exposure of Time Synchronization, either TSN AF or NEF can configure
DT-TT/NW-TT port roles for processing Announce message based on the method 1
of the clause 6.1.3.3.
\- DS-TT and NW-TT has a capability to receiving and transmitting Announce
messages.
\- DS-TT and NW-TT could be configured to processing Announce messages. For
example, when a Port of DS-TT or NW-TT receiving Announce message, they need
to report the received Port Announce Information to TSN AF using PDU session
or N4 session modification procedure with PMIC.
\- TSN AF need to maintain the Master-Slave hierarchy per TSN domain based on
received Port Announce Information from DS-TT/NW-TT ports, and deliver the
Announce messages for each port to neighbourhoods. The Announce message will
be delivered to NW-TT/DS-TT using PMIC according to TS 23.501 [2] TSN related
procedure.
\- To reduce the signalling of Announce messages from all TSN ports of NW-TT
or DS-TT, a signalling optimization mechanism could be applied. For example,
only reports Port Announce Information to TSN AF when detecting new Grand
Master Clock or Announce message timeout. NW-TT/DS-TT need to maintain System
Identity and Grand Master Identity information locally per port.
### 6.18.3 Procedures
The procedure to enable BMCA using (g)PTP Announce message support by 5G TSN
bridge is depicted in the figure 6.18.3-1.
Figure 6.18.3-1: A procedure to support BMCA with (g)PTP Announce Message
Processing
1\. A Time Aware End Stand behind DS-TT send (g)PTP Announce Message
periodically or notify the change of previously notified information such as
Grand Master or Port Role has changed. This step can be applicable to NW-TT
ports when NW-TT received (g)PTP Announce Message from DN side Time aware
node.
2\. When the UE US-TT received (g)PTP Announce Message from the neighbour
link, it reports the received Port Announce Information to SMF using PDU
session modification procedure. If NW-TT case, UPF report the received Port
Announce Information to SMF using N4 session modification. This step follows
the PMIC delivery procedure defined in clause 5.28 of TS 23.501 [2].
Editor\'s note: It is FFS how to reduce the number of signalling for reporting
(g)PTP Announce messages such as optimization mechanism.
3\. The SMF reports the received PMIC to TSN AF via PCF. This step follows the
PMIC delivery procedure defined in clause 5.28 of TS 23.501 [2].
4\. The TSN AF collects the PMICs from NW-TT and DS-TT ports, and select the
role of each ports of 5G TSN bridge such as Master/Slave. The port role
selection algorithm may be the same defined in the IEEE 802.1AS [18]. In this
step, TSN AF can maintain own System Identify to compare the Port Priority
with the received port information from the previous step.
TSN AF can configure and maintain the bridge system identity the port role(s),
and the current selected Grand Master Clock Identity to each DS-TT/NW-TT per
TSN domain.
If TSN AF detect new Grand Master Clock or timeout of the Announce message
from the existing nodes, TSN AF can calculate new role(s) of each ports. In
this case, TSN AF need to notify the change to the neighbouring TSN nodes by
transmitting Announce message. TSN AF generate the (g)PTP Announce message for
each ports.
5\. TSN AF deliver PMIC information for each NW-TT/DS-TT ports. The PMIC may
contain port number, Port configuration information, and generated (g)PTP
Announce message to transmit. Port configuration information may contain port
role, system identity, and the current grand master clock identity.
6\. SMF distribute PMIC received from PCF to each NW-TT or DS-TT according to
the port number. For DS-TT, PDU session modification procedure can be used for
delivering PMIC. For NW-TT port, N4 session modification procedure can be
used.
7\. Each port of DS-TT or NW-TT locally configure with port configuration
information and transmit generated (g)PTP Announce message by TSN AF.
### 6.18.4 Impacts on Existing Nodes and Functionality
NW-TT/DS-TT:
\- Need to report Port Announce Information to TSN AF using PMIC.
TSN AF:
\- Need to maintain Master-Slave hierarchy based on Port Announce Information
reported from NW-TT/DS-TT ports.
\- Need to process BMCA including Port Configuration and Role Selection.
\- Need to generate and deliver to NW-TT/DS-TT Port Announce Information to be
transmitted to the neighbour TSN Nodes.
NEF:
\- Support Rel-16 PMIC signalling via PCF.
## 6.19 Solution #19: Delay model for UE-UE communication
### 6.19.1 Introduction {#introduction-17}
This solution addresses Key Issue #2: UE-UE TSC communication. The solution
proposes a delay model that addresses the shortcoming of the current delay
model which supports only communication between the UE and the data network.
That is because the current model assumes traffic to go via a NW-TT port,
while UE to UE traffic does not go via the NW-TT ports. Note that the proposed
delay model can be used as a standalone solution or it could be combined with
other solutions for the UE to UE key issue as well.
This solution generalizes the 5GS bridge delay model, so that it will support
TSC communication between any two ports pairs. That includes communication
between a DS-TT port and a NW-TT port, as already supported, but also extended
to include communication between two DS-TT ports (i.e. UE to UE
communication). Besides, the solution enables the communication between two
NW-TT ports since the model allows the TSN AF to calculate the delay between
NW-TT port pairs, even though that is not the main focus. The solution tries
to minimize the special 3GPP handling of these options and proposes a general
framework that is equally applicable to all cases.
The solution makes use of the concept of the UPF residence time, as
illustrated in the figure 6.19.1-1 below. The UPF residence time represents
the time it takes for packets from an ingress UPF port to an egress UPF port
within the UPF node.
Figure 6.19.1-1: UPF residence time calculation
The figure illustrates UPF ports D.1, D.2, D.3, corresponding to the device
side of the UPF node, and ports N.1, N.2 corresponding to the network side of
the UPF, i.e. NW-TT ports. The UPF residence time is shown for some example
port pairs, such as between two device side UPF ports, between two network
side UPF ports, and between a device and network side UPF port. The UPF
residence time can be interpreted between any port pair of the UPF. The model
takes a black box approach: the delay is represented by the time it takes from
the ingress UPF port to the egress UPF port, without taking any assumption
about the UPF implementation.
The UPF residence time is reported from the UPF to the TSN AF. The UPF may
provide different values for the UPF residence time depending on the type of
the ports in the port pair. Each UPF port has a type (such as \"device side
ports\" and \"network side UPF ports\"), and the delay is provided between all
possible combinations of port type pairs (for example between device and
device side ports, between device and network side ports, and between network
and network side ports). This allows the TSN AF to take into account the
differences in the UPF residence time between e.g. network-device side port
pairs and device-device side port pairs yet keep the delay reporting
complexity low.
Based on the UPF residence time, the enhanced model is illustrated in the
figure 6.19.1-2 below which can accommodate any traffic, including UE-network,
UE-UE, network-network.
NOTE 1: The necessity to support three types of UPF residence time will be
evaluated later.
NOTE 2: As is the case for the Release 16 delay model and for TSN in general,
the delay does not include the queueing delays in the case e.g. when a UE is
receiving streams from more than one UEs or devices in the DN.
Figure 6.19.1-2: UPF residence time for UE-network, UE-UE, network-network
The model uses the following three components:
\- UE-DS-TT residence time - as already specified - is reported by the UE to
the TSN AF to capture the delay within the device.
\- The UE-UPF delay is pre-configured in the TSN AF on a per traffic class
granularity. Compared to release-17, there is a change that instead of the UE-
NW-TT delay, the UE-UPF delay is pre-configured. Minimal and maximal values
can also be used.
\- The UPF residence time is reported by the UPF to the TSN AF to capture the
delay within the UPF. The UPF residence time can be reported separately for
different port type pair combinations, such as separately between a device-
device side port pair, device-network side port pair and network-network side
port pair. The reporting can be performed on a per traffic class granularity.
The TSN AF can also be pre-configured with a default UPF residence time
between any port pair, one a per traffic class granularity, if the UPF does
not report it.
Using these components, the delay can be calculated by the TSN AF for any
possible port pair of the 5GS as requested by the CNC. For example:
\- The delay between a DS-TT port and a NW-TT port is calculated as the sum of
the UE-DS-TT residence time, the UE-UPF delay and the UPF residence time
between the device-network side port pair.
\- The delay between a DS-TT port and another DS-TT port is calculated as the
sum of the UE-DS-TT residence time for UE1, the UE-UPF delay, UPF residence
time between device-device side port pair, UE-UPF delay, UE-DS-TT residence
time for UE2.
### 6.19.2 Functional Description
\- The release-16 delay model of the 5GS is refined as follows. The UE-NW-TT
delay is divided into two parts: the UE-UPF delay and the UPF residence time.
(The UE-DS-TT residence time is not changed. Also, the definition of the
Packet Delay Budget (PDB) is not affected).
\- The UE-UPF delay is pre-configured into the TSN AF on a per traffic class
granularity.
\- The UPF residence time can be pre-configured into the UPF and provided to
the TSN AF as part of the 5GS bridge configuration on a per traffic class
basis. Ports are grouped into port types, and the UPF residence time is
reported for all combinations of port type pairs. e.g. considering device side
and network side ports as port types, the delay is reported for device-
network, device-device and network-network port pair combinations.
\- If the UPF does not provide the residence time, the TSN AF can use a
default value that is pre-configured on a per traffic class granularity.
\- Between two DS-TT ports, the TSN AF calculates the bridge delay by adding
the UE-DS-TT residence time and the UE-UPF delay for the two UEs and adding
the UPF residence time for device-device. Between a DS-TT port and a NW-TT
port, the TSN AF calculates the bridge delay by adding the UE-DS-TT residence
time, the UE-UPF delay and the UPF residence time for device-network.
\- The CNC takes into account the delay between two DS-TT ports as reported by
the TSN AF when setting up TSN streams and sets the traffic classes and TSN
parameters accordingly, which is provided to the TSN AF. As already specified,
the TSN AF provides the TSN parameters to the PCF so that the PCF can map the
TSN traffic classes/parameters into 3GPP QoS parameters. The TSN AF determines
and provides the TSN parameters for the PDU Sessions separately.
\- The TSN AF provides nominal QoS parameters for each PDU Session for the
given traffic streams that correspond to the current definition of QoS
parameters between DS-TT and NW-TT ports. The PCF can perform the QoS mapping
based on the traffic classes/parameters that it receives for a given PDU
Session without having to know whether the traffic is UE to UE or not. The
nominal parameters for the delay and burst arrival time provided from the TSN
AF to the PCF correspond to the same traffic pattern over the PDU Session, as
if it was routed between the device and the NW-TT port so that the provided
parameters are in line with the current definition.
\- Specifically, the delay parameter corresponding to the PDB in the 3GPP
(measured up to the NW-TT port) can be calculated as:
\- Nominal delay for PDU Sessions = UE-UPF delay + UPF residence time (device-
network).
Other ways of calculation are not excluded.
\- The burst arrival time (BAT) for a PDU Session with uplink stream is
unchanged. The burst arrival time (BAT) for a PDU Session with downlink stream
can be calculated as follows.
\- Nominal BAT for PDU Session (DL) = BAT for PDU Session (UL) + UE-DS-TT
residence time for PDU Session (UL) + UE-UPF delay + UPF residence time
(device-device) - UPF residence time (network-device).
Other ways of calculation are not excluded.
### 6.19.3 Procedures
The following new or adjusted procedures are needed for the solution.
\- TSN AF is pre-configured with the UE-UPF delay per traffic class.
\- The TSN AF determines the necessary TSN parameters for both of the PDU
Sessions separately. The PCF can perform the QoS mapping based on the traffic
classes/parameters that it receives for a given PDU Session without having to
know whether the traffic is UE to UE or not.
\- The UPF is pre-configured with the UPF residence time between its port type
pairs per traffic class, and this information is provided from UPF to TSN AF
within the Bridge Management Information Container.
The solution can also be applied in the case of multiple TSN listeners, i.e.
when more than one UE receives the downlink stream.
The solution is backwards compatible to the release 16 solution and represents
an enhancement. The TSN AF may use pre-configured values for the UPF residence
time if the UPF does not provide it.
### 6.19.4 Impacts on existing services and interfaces
The solution addresses one aspect of UE to UE communication, and may be
combined with other solutions for the UE to UE key issue.
TSN AF:
\- Delay model is refined. The delay uses the separate UE-UPF delay (pre-
configured) and the UPF residence time (provided by the UPF as part of the
Bridge Management Information Container.) The TSN AF provides the TSN
parameters to the PCF separately for each PDU Session.
UPF:
\- UPF provides the UPF residence time as part of the Bridge Management
Information Container.
## 6.20 Solution #20: CNC controlled VLAN configuration
### 6.20.1 Introduction {#introduction-18}
The solution adds general support for CNC controlled VLAN configuration. This
can be also used to address UE to UE communication, Key Issue #2, in practical
deployments, e.g. for logical separation of one or multiple UE to UE TSN
streams, for easier management of flows or for easier setup for forwarding
paths. Note that the VLAN configuration support proposed here is general for
all communications, including TSN and non-TSN flows that are UE to UE as well
as other flows that are between UE and network, or between multiple network
ports.
It is proposed that the specification supports CNC controlled VLAN
configuration only by the existing interface via TSN AF already defined for
the fully centralized configuration model specified by IEEE Std 802.1Qcc [7];
therefore, MVRP is not supported or needed at DS-TT and NW-TT.
The existing release 16 specification supports Ethernet Packet Filters set by
the SMF in the PDRs. However, the release 16 specification is limited to SMF
controlled cases which assume that the SMF has full knowledge and control over
the Ethernet network, which is not the case in many deployments that serves
TSN and non TSN traffic in parallel. As another limitation, the release 16 SMF
provided rules apply to the N4 sessions corresponding to the PDU Sessions and
the associated DS-TT ports, while VLAN handling rules for NW-TT ports apply
according to static pre-configuration at NW-TT.
This solution allows the CNC to control the VLAN configuration of IEEE 802.1Q
[6] bridges in a unified way, and thereby allows the CNC to handle the VLAN
configuration for 5GS bridges in the same way as fixed bridges.
NOTE: CNC provided VLAN configuration co-exists with SMF provided PDR/FAR
rules that also act on the VLAN IDs in the Ethernet headers.
The VLAN configuration affects the configuration of bridge forwarding: the
forwarding rules may also include the VLAN IDs, and the VLAN configuration may
refer to a specific forwarding table. In common deployments, the use and the
implementation of the VLAN configuration and bridge forwarding is closely
coupled.
The VLAN configuration provided by the CNC is set on a per port granularity.
VLAN configuration may be set at any port, including DS-TT as well as NW-TT
ports.
VLAN configuration implies a set of functionality listed below based on IEEE
802.1Q [6].
Table 6.20.1-1
Configuration Reference in IEEE 802.1Q [6] clause Description
* * *
**Per Bridge VLAN Configuration**  
Read Bridge VLAN Configuration 12.10.1.1 To obtain general VLAN information
from a Bridge. PVID and VID Set values 12.10.1.2 Set the VID value to be added
to received untagged frames at a given port. Acceptable Frame Types parameters
12.10.1.3 Used to configure whether to admit only VLAN-tagged frames, only
untagged/priority tagged frames, or all frames. Enable Ingress Filtering
parameters 12.10.1.4 Whether to enable or disable ingress filtering. With
ingress filtering, only ports in the member set for the given VID can admit
traffic. Reset Bridge 12.10.1.5 To reset all statically configured VLAN-
related information in the Bridge to its default state. VID to FID allocation
12.10.3 Filtering identifier for a given VID, which determines whether
different VLANs use individual or shared forwarding tables. FID to MSTID
allocation 12.12.2 The FID to MSTID allocation is required to complete the VID
to FID to MSTID allocation. For TSN Streams, this is used to allocate their
VID to the TE-MSTID for central CNC controlled operation. (See clause
12.32.3.1 in IEEE Std 802.1Qcc [7] for further information). **Per VLAN
Configuration**  
The VLAN Configuration 12.10.2 For setting the VLAN name and reading VLAN
specific configuration. **Filtering Database Configuration**  
Static Filtering Entries 8.8.1 Defines forwarding rules based on the
combination of destination MAC address and VID. Note that the use of static
filtering entries is introduced and elaborated in other solutions as well,
which can be used in combination with this solution. Static VLAN Registration
Entries 8.8.2 Determines whether frames are to be VLAN-tagged or untagged when
transmitted; also defines member set for a VID that is used for ingress and
egress filtering. Dynamic Filtering Entries 8.8.3 Maintains the dynamically
learnt addresses respecting the VID to FID allocation as configured above,
i.e. whether shared or independent learning is applied among certain VLANs.
Default Group filtering behaviour 8.8.6 Specifies defaults for group-addressed
frames for each VID and outbound Port regarding forwarding/filtering.
The solution reuses the mechanisms defined in Rel-16 for the transfer of
bridge and port configuration between the UPF/NW-TT, DS-TT and the TSN AF.
using the already specified Management Information Container. Note that VLAN
processing functionality may be set up and used even before TSN streams are
established or for non-TSN traffic.
VLAN processing is a set of IEEE 802.1Q [6] defined functionalities for
Ethernet specific processing may also be realized usingN4 rules. The detailed
implementation of VLAN processing is not specified; the implementation is not
restricted as long as the externally observable behaviour is according to the
configuration.
VLAN configuration and processing is a general Ethernet functionality that is
not TSN specific; however, TSN deployments often make use of this
functionality. Even if there is a dependency between both, the CNC performs
the VLAN configuration independent of the TSN stream configuration. For the
VLAN configuration that is needed by the TSN streams, the CNC can provide the
VLAN configuration before the provision of TSN stream related configuration.
VLAN processing using N4 rules before TSN streams are established can be
provided based on SMF configuration.
The solution could be combined with other solutions.
### 6.20.2 Functional Description
The configuration for VLAN is exchanged between the CNC and the TSN AF as part
of the 5GS bridge configuration. The VLAN configuration is part of the Bridge
VLAN Configuration managed object according to IEEE specifications; there is a
single such managed object per Bridge, however the configuration is flexible
to support different VLANs for the different ports. The TSN AF provides the
information to the UPF inside the Bridge Management Information Container.
Configuration can also be read from the UPF to the TSN AF and CNC in the
reverse direction using the existing signalling path.
### 6.20.3 Procedures
\- CNC provides VLAN configuration to the TSN AF.
\- TSN AF provides the VLAN configuration inside the BMIC/PMIC using the
existing signalling path to the UPF/NW-TT concerned.
\- Based on the configuration, the UPF sets up the VLAN processing. The
implementation of VLAN processing is not specified.
\- The VLAN configuration can also be read from the UPF/NW-TT and provided to
the TSN AF and CNC.
### 6.20.4 Impacts on existing services and interfaces
TSN AF:
\- Forward VLAN configuration to/from the UPF NW-TT inside BMIC
UPF:
Editor\'s note: Support for VLAN processing for both network side and device
side ports is FFS.
## 6.21 Solution #21: TSN stream information provisioning from CNC to 5GS
### 6.21.1 Introduction {#introduction-19}
For key issue #3A.
Currently, there are no mechanisms standardized in IEEE to provide TSN stream
specific information from the CNC to TSN bridges, even if the information can
be available at the CNC. Existing specs are based on the PSFP mechanism, but
there is no guarantee that a CNC would actually use PSFP and set it for all
TSN streams. Even when the CNC uses PSFP, the traffic pattern information
obtained this way may not always be accurate. Additionally, ingress/egress
port info might not be possible to obtain based on PSFP information.
Therefore, this solution introduces a signalling mechanism that explicitly
provides the TSN stream specific information to the 5GS bridge. This gives us
a clean solution without the need to reverse-engineer other mechanisms meant
for different purposes. Explicitly providing the needed information from CNC
to TSN AF can simplify the system architecture as well as the implementation
and avoid interoperability issues. The solution does not impact the NEF and
proposes direct signalling between the TSN AF and CNC.
### 6.21.2 Functional Description
The TSN AF associated with a given bridge sends a subscription message to the
CNC to request that it be notified about TSN stream specific information for
streams that pass through the given bridge. Each time there is a new/updated
TSN stream that passes through a given bridge, the CNC sends a notification to
the TSN AF which includes the following.
\- Identification of the stream (for TSN as described in clause 6 of IEEE
802.1CB [9]).
\- Ingress port number.
\- Egress port number(s).
\- Periodicity.
\- Burst Arrival Time.
\- Burst Size.
\- Priority.
The solution may be extended with other parameters concerning TSN stream or
application characteristics.
### 6.21.3 Procedures
Editor\'s note: Whether a mechanism to provide stream information from CNC to
TSN AF (or Ethernet bridges in general) will be specified by 3GPP or IEEE is
FFS. The list of stream information provided from CNC to TSN AF is FFS and the
benefit of the additional stream information for 5GS is also FFS. Therefore
the details listed below are merely an example of how stream information could
be provided.
The solution involves the following additional steps.
1\. The TSN AF of a given bridge sends a STREAM-SUBSCRIBE message to the CNC
in order to request notifications about TSN stream specific information for
TSN streams that pass through the given bridge.
2\. The CNC sends a STREAM-NOTIFY message to the TSN AF containing information
about new/updated TSN streams. The CNC also sends a STREAM-NOTIFY message to
the TSN AF when a TSN stream is removed.
The TSN AF processes the information as already specified. The TSN AF does not
need to consider PSFP configuration information to obtain TSN stream specific
information to derive the ingress/egress port numbers and QoS information.
It could be possible to apply the solution to the non-TSN case as well where
the TSN AF is replaced by the AF.
### 6.21.4 Impacts on existing services and interfaces
TSN AF:
\- Support for sending a STREAM-SUBSCRIBE message indicating interest in
receiving TSN stream specific information notifications.
\- Support for STREAM-NOTIFY messages that provide TSN stream specific
information.
\- No longer needs to support obtaining the same parameters from PSFP
information.
CNC (non 3GPP defined entity):
\- Accept subscriptions from TSN bridges and provide notifications on TSN
stream specific information.
## 6.22 Solution #22: Detect the Burst spread at UPF
### 6.22.1 Introduction {#introduction-20}
The solutions addresses Key issue 3A:
b) Ability for AF to indicate periodicity, burst size, burst arrival time (as
defined in Rel-16 for TSC Assistance information) and Survival Time,
optionally burst spread (variation of burst arrival time for DL traffic
resulting from jitter on N6, if applicable) along with Timing Domain
(reference for these parameters) associated with these parameters to the NEF.
The burst spread is the variation of burst arrival time for DL traffic
resulting from jitter on N6, i.e. it was introduced by the jitter on the N6.
Before the application sends the data to the UE (causing the DL data to reach
N6), AF is not aware of burst spread. After the application starts sending the
data to the UE, the AF still cannot determine the burst spread by itself
directly. It may get burst spread by:
A) U-plane feedback mechanism, e.g. ACK packet to the DL data. This depends on
the U-plane protocol. This mechanism cannot accurately determine the burst
spread.
B) 5GS exposure method. The 5GS (i.e. PSA-UPF) detect the burst spread of DL
in N6, and notify the AF via NEF.
The option A is not accurate.
In order to send the burst spread to NG-RAN, the option B require more
signalling. (i.e. UPF->SMF->PCF->NEF->AF->NEF->PCF->SMF->AMF->NG-RAN).
Depending on the option B, this solution proposes, that the UPF/NW-TT detects
the burst spread of DL in N6, and reports to SMF. SMF update the TSCAI and
send to NG-RAN.
Editor\'s note: Whether the UPF/NW-TT detects the burst spread of DL in N6
with RFC 4689 or other mechanism is FFS.
### 6.22.2 Functional Description
When the SMF establishes a QoS flow, it may request the UPF/NW-TT to detect
the burst spread.
The UPF/NW-TT detects the burst spread of DL data for the particular stream
and reports the burst spread to SMF.
SMF sends the updated TSCAI which include the burst spread to NG-RAN.
NOTE: The Burst Spread is provided as a separate parameter to Burst Arrival
Time.
If deterministic transmission is supported on N3 interface, the UPF/NW-TT
could determine an ingress time window [start time, end time] to start
processing the packets of a burst in a cycle based on burst spread. The start
time indicates the earliest time to process the first packet of a burst in a
cycle while the end time indicates the latest time to process the first packet
of a burst in a cycle. Then early arrived packets in a cycle would be buffered
on the UPF until the start time. This would help to decrease the jitter
introduced by transmission on N6, and to decrease the delay on N3 for
transmitting TSC stream. The ingress time window could be provided to the SMF,
which determines egress time window [start time, end time] for DS-TT to send
out the burst. The SMF sends the egress time window to UE/DS-TT for
deterministic transmission.
If deterministic transmission is not supported on N3 interface, the RAN could
handle the packet starts at the time as indicated by TSCAI. The SMF could
determine egress time window based on spread time and burst arrival time in
TSCAI and provide the egress time window to UE/DS-TT for deterministic
transmission.
It is assumed that the AF may provide the egress time window to devices behind
the UE to determine its receiving time for a burst from UE, then the
determined egress time window may be provided to the AF to make application
aware of packet handling time.
### 6.22.3 Procedures
The procedure for synchronizing TSN end stations behind 5G System (NW-TT) with
the TSN GM in the network.
Figure 6.22.3-1: Procedure for providing the Burst spread to NG-RAN
1\. The AF provides the service information to PCF/NEF.
2\. The PCF initiates the SM policy Association Modification service operation
to provide the QoS rule to SMF.
3\. SMF sends the N4 request to UPF/NW-TT, which indicate the UPF/NW-TT detect
the burst spread of indicated stream.
4\. AF send the DL data to UE, which arrives the UPF/NW-TT.
5\. The UPF/NW-TT report the detected burst spread to SMF. If deterministic
transmission is supported on N3 interface, the UPF/NW-TT could determine an
ingress time window for handling the stream and provide the ingress time
window to the SMF.
6\. SMF sends the updated TSCAI to NG-RAN, which includes the burst spread.
The SMF also determines egress time window based on spread time or ingress
time window and sends the egress time window to the UE and the AF.
### 6.22.4 Impacts on services, entities and interfaces
SMF.
\- Indicate the UPF to detect the burst spread for particular stream.
\- sends the burst spread to NG-RAN after it receives it from UPF.
\- determines egress time window based on spread time or ingress time window
and sends the egress time window to the UE and the AF.
UPF
\- detect the burst spread and report to SMF.
\- determines an ingress time window for handling the stream based on spread
time and provides to the SMF.
## 6.23 Solution #23: Transmission Delay Measurement on N6
### 6.23.1 Description
This solution is for key issue#3A,which addresses exposure of deterministic
QoS aspects related to:
b) Ability for AF to indicate periodicity, burst size, burst arrival time (as
defined in Rel-16 for TSC Assistance information) and Survival Time,
optionally burst spread (variation of burst arrival time for DL traffic
resulting from jitter on N6, if applicable) along with Timing Domain
(reference for these parameters) associated with these parameters to the NEF.
In Rel-16 standardization, the UL/DL transmission delay in 5G system can be
measured based on QoS monitoring mechanism. The main idea is SMF activates the
end to end UL/DL packet delay measurement between UE and PSA UPF through
encapsulating time stamp in GTP-U header.
For unsynchronized scenario, the RTT/2 can be obtained based on sending QoS
Monitoring Packet, which is specifically used for UL/DL packet delay
measurement. But for N6 case, it is not suitable for asking application server
to create specific packet for delay measurement. For this IIoT scenario , it
is supposed that the equipment in N6 support deterministic transmission,
therefore the time synchronization is required.
This solution proposes a mechanism to measure the delay on N6 with the pre-
condition that the application server deployed in N6 supports for time
synchronization.
In this solution, the first step is to realize the time synchronization
between PSA UPF and the application server before or after the PDU session
establishment. Other solutions for key issue 3B can be considered to realize
this.
During the PDU session establishment, the SMF sends N4 rule to PSA UPF for N6
delay measurement. The rule may include traffic direction, IP 5 tuples, the
frequency of N6 delay measurement and observation period. For the UL data, the
N4 rule also includes construction of extension header for carrying N6 delay
measurement indication. For the DL data, the N4 rule also includes extracting
the timestamp from extension header and removing the extra header.
Then PSA UPF can insert the delay measurement indication in the UL data packet
when the UE sending the packet. If the packet supports IPv6 routing, the delay
measurement indication is carried on IPv6 extension header. While if the
packet supports IPv4, the delay measurement indication can be carried on e.g.
In-band Network Telemetry header which is referred to
https://p4.org/assets/INT-current-spec.pdf. The PSA UPF is responsible for
constructing IPv6 extension header or INT header. There is a pre-agreement
between 5GS and application server that what kind of packet header should be
selected.
The UE may use specific S-NSSAI/DNN for the PDU session establishment and the
SMF contacts the PCF to get PCC Rules that includes QoS monitoring parameters
with indication that N6 packet delay measurements are provided, then N4 rules
related with N6 delay measurement are sent by SMF during the PDU session
establishment procedure and specific UPF which can enable the N6 delay
measurement may be selected by SMF. Therefore, when UE sends specific packet
which intents for the target application server in the PDU session, the N6
delay measurement will be triggered by UPF, and the UE gets the target
application server IP address through application layer mechanism. The
application server IP address provided in the PCC Rule and the one used by the
UE needs to be the same one.
When the application server in N6 accepts the UL packet and identifies the
delay measurement indication, the application server should record this
packet\'s IP 5 tuples. When the application server sends the DL data which
matches the recording IP 5 tuples, the application server should insert the
sending timestamp in the corresponding IPv6 extension header or INT header.
PSA UPF extracts the sending timestamp and calculates the N6 transmission
delay.
Therefore 5GS can calculate the accurate packet burst arrival time of RAN side
by adding burst sending time provided by AF (already known by network in
current specifications), N6 transmission delay and CN PDB.
### 6.23.2 Procedures
The N6 transmission delay measurement procedure is described in Figure
6.23.2-1.
Figure 6.23.2-1 Procedure for N6 transmission delay measurement
1\. PSA UPF and application server supports IEEE 802.1AS [18], and can be
synchronized before or after the PDU session establishment.
2\. UE initiates PDU Session Establishment Request, SMF gets PCC Rules from
the PCF including QoS monitoring, sends N4 rule to UPF through N4 session
establishment request or N4 session modification request. The N4 rule may
include traffic direction, IP 5 tuples, the frequency of N6 delay measurement
and observation period. For the UL data, the N4 rule also includes
construction of IPv6 extension header or INT header for carrying N6 delay
measurement indication. For the DL data, the N4 rule also includes extracting
the timestamp in IPv6 extension header or INT header.
3\. UE sends a UL data packet.
NOTE: The UL data packet contains normal application data that the application
anyway sends; i.e. the UE does not create any special data packets.
4\. UPF detects that the destination address of the UL data packet is the
application server on the N6 port, UPF constructs the extension header and
inserts the N6 transmission delay measurement indication in the specified IPv6
extension header or INT header, and trigger the N6 transmission delay
measurement.
5\. The UL data packet is sent from PSA UPF to the application server.
6\. When the server receives the UL data packet, it recognizes the N6 delay
measurement indication in the extension header and decides to start the N6
delay measurement for the service flow. When the server sends DL data packets,
it will add a timestamp representing the sending time in the corresponding
place in the extension header.
7\. When PSA UPF receives the DL data packets, it extracts the timestamp from
the extension header and calculates the unidirectional downlink N6 delay
according to the packet receiving time and the timestamp. PSA UPF removes the
extension header.
8\. The DL data packet is sent from PSA UPF to UE.
9\. UPF reports the calculated N6 transmission delay to SMF through N4
Association Update Procedure.
10\. SMF calculates the Burst Arrival Time for RAN based on AF providing Burst
Arrival Time, N6 transmission delay and CN-PDB. Then SMF sends the updated
Burst Arrival Time to RAN.
### 6.23.3 Impacts on Existing Nodes and Functionality
Editor\'s note: This clause captures impacts on existing 3GPP nodes and
functional elements.
PCF:
\- QoS monitoring in the PCC Rule includes packet delay over N6.
SMFs:
\- Configure the UPF for N6 delay, and send the corresponding N4 rules to UPF.
\- Calculate the precise Burst Arrival time with considering N6 delay.
UPF:
\- Support the synchronization with application server.
\- Based on the N4 rules, the UPF can detect the corresponding data packets
and construct the IPv6 extension header or INT header for UL packet. The N6
delay indication can be carried on the extension header.
\- Extract the timestamp in DL packet and remove IPv6 extension header or INT
header.
\- Calculate the N6 transmission delay periodically and report to SMF.
# 7 Evaluation
## 7.1 Key Issue #1: Uplink Time Synchronization
Solution #1 is the only solution addressing KI#1 Uplink Time Synchronization.
The solution describes four alternative methods for BMCA procedure for gPTP:
Method 1:
\- Most of the BMCA logic is centralized to the TSN AF (or NEF for non-TSN
sessions), but also DS-TT and NW-TT participate to BMCA operation.
\- DS-TT/NW-TT ingress port sends the received Announce message to BMCA
function in TSN AF (or NEF) only if the received Announce is equal or better
than the current Announce the bridge is sending.
\- Ingress port detects the Announce and Sync reception timeouts and indicates
the timeout to TSN AF (or NEF).
\- DS-TT/NW-TT port is aware of the gPTP port state (Master, Slave, Passive).
\- Signalling consideration: since the received Announce messages are sent
from the ingress port to TNS AF (or NEF) for BMCA evaluation via PMIC/BMIC
(control plane), the solution is feasible only if the ingress port pre-screens
the received Announce message and sends the message only if it is better than
the current Announce known to the port. In this case no Announce messages need
to be sent to the TSN AF after the BMCA procedure has stabilized. Compared to
other methods, this one has more signalling between TSN AF and NW-TT/DS-TT,
and between NW-TT and DS-TT.
Method 4:
\- BMCA logic is centralized to the NW-TT. Ingress ports forward all Announce
messages to BMCA function in NW-TT.
\- Ingress ports forward all Sync messages to NW-TT.
\- NW-TT generates Announce messages on behalf of the egress ports.
\- NW-TT detects the Announce and Sync reception timeouts for each port.
\- DS-TT/NW-TT port is not aware of the gPTP port state.
\- Signalling consideration: since all received Announce messages are sent
from the ingress port to NW-TT for BMCA evaluation, and NW-TT generates the
Announce messages on behalf of the egress ports, the solution leads to more
amount of user plane traffic between ingress and egress ports, even after the
BMCA procedure has stabilized but not control plane signalling.
Method 2:
\- The same as Method 4, except that the Master port generates the Announce
messages based on the Announce information received from the NW-TT. The
Announce information is sent from the NW-TT to Master Port only if there is a
change compared to the previous Announce information.
\- The port must be aware whether it is Master or non-Master port. The port
learns this via UP from the NW-TT.
\- Signalling consideration: compared to Method 4, since the egress port
generates the Announce messages based on the Announce information from NW-TT,
and the Announce information is sent only if there is a change compared to the
previous Announce information, this Method can reduce the user plane traffic.
The trade-off is that the Master port must be aware of its port state in order
to generate Announce messages.
Method 3:
\- The same as Method 4, except that the ingress port sends the received
Announce message to BMCA function in NW-TT if the received Announce is equal
or better than the current Announce known to the port or if the ingress port
expired to receive announce message from the NW-TT.
\- The port stores the state of the most recent Announce it has sent for the
comparison with the received Announce.
\- Signalling consideration: compared to Method 4, since the ingress port
sends the received Announce message to BMCA function in NW-TT if the received
Announce is equal or better than the previous received Announce or if the
ingress port expired to receive announce message from the NW-TT, the Method is
not able to reduce any signalling after the BMCA procedure has stabilized. On
the other hand complexity is increased in the ingress ports to pre-screen the
received Announce messages.
To apply the Methods 2-4 with Solution #9 (i.e. GM resides in DS-TTs), the NEF
(or TSN AF) needs to subscribe for the BMCA result reports from the NW-TT. If
due to the BMCA result the GM needs to be activated or deactivated in the DS-
TTs, the NW-TT reports the BMCA result to NEF(or TSN AF) so that NEF(or TSN
AF) can activate or deactivate the GM in DS-TT.
## 7.2 Key Issue #3B: Exposure of Time Synchronization
Solution #7 supports the AF to be able to request Time Synchronization service
via External Parameter Provisioning. The exposure includes service
activation/deactivation/modification, it can interwork with IEEE TSN or TSC
use cases, and it can target a UE or a group of UEs. The exposure proposed for
time synchronization supports the 4 time synchronization methods listed in
KI#3B.
Solution #8 supports AF requesting TSN Synchronization activation and
deactivation providing new configuration to the UDM via NEF and triggering a
PDU Session establishment. The same SMF and UPF control all PDU Sessions
involved in the time synchronization service. The time synchronization service
is coupled to a TSN PDU Session.
Solution #9 supports the DS-TT acting as a (g)PTP grand master (GM) for
devices attached to the DS-TT. The DS-TT indicates to the network inside a
PMIC whether DS-TT is capable of acting as (g)PTP GM and which version(s) it
supports. The indicated capabilities can be used to support exposure for time
synchronization. Additionally, the time information used in (g)PTP at the DS-
TT is based on the time information received from the gNB using RRC/SIB
signalling.
## 7.3 Key Issue#5: Use of Survival Time for Deterministic Applications in 5GS
The basic principle of solution #15 and #16 for KI#5 are similar. The only
difference is on how AF (a TSN-AF or an AF as stated in key issue #3B)
acquires the survival time information. Solution #15 only considers the
survival time for IEEE TSN based applications and proposes the survival time
is pre-configured in the TSN AF. Solution #16 considers wider deterministic
applications and proposes the survival time can be received by any AF from an
application via direct provisioning or via other means out-of-scope for 3GPP.
Other than this aspect, the two solutions are complementary with each other.
## 7.4 Key Issue #3A: Exposure of deterministic QoS
Solution#5 supports following aspects:
1) AF provides traffic related description and deterministic QoS requirement:
\- a Traffic Description, Target UE PDU session Identification, AF
Identification, a 5GS delay, Guaranteed Flow Bit Rate, Flow Direction, Burst
Arrival Time at UE (uplink) or UPF (downlink), Burst Size, Burst Periodicity,
optionally Burst Spread (variation of burst arrival time for DL traffic
resulting from jitter on N6, if applicable), Survival Time and a Timing Domain
and a QoS Reference.
2) The 5GS exposes the Deterministic QoS Capability information to the AF:
\- Whether 5GS supports Deterministic QoS, the Minimum and maximum 5GS Delay
supported by 5GS if it supports deterministic QoS.
3) The 5GS sets the TSCAI according to the information provided by the AF.
4) The AF may provide Burst Spread to 5GS. The SMF provides it as part of
TSCAI to the NG-RAN.
5) The general procedure for exposure the deterministic QoS is defined and how
to report 5GS delay information is also defined.
6) The NEF provides TSC connectivity monitoring service to the AF.
The detailed procedure and service operation for exposure the deterministic
QoS requirement and reporting 5GS capability shall be further study in
normative phase. The normative work may take the description in this solution
for reference.
Solution#6 has been merged into Solution#5.
Solution#13 proposes a mechanism for AF requesting jitter measurement. The AF
provides requirement for jitter measurement. The PCF gets a group of E2E delay
data based on QoS monitoring mechanism, calculates the jitter and sends the
jitter value to AF. In the scenarios that deterministic QoS is required, e.g.
industrial manufacturing, jitter is an important parameter to show the
deterministic performance of 5G network. Therefore, jitter measurement is
recommended to be support in normative work.
Solution#14 proposes to utilize network analytics from NWDAF. PCF decides if
QoS parameters fulfil the QoS requirements based on the Observed Service
Experience analytics from NWDAF. The PCF acting as a consumer of Observed
Service Experience analytics has already been supported in Rel-16 as defined
in TS 23.288 [14]. The possible impacts on 5GC have not been identified. No
normative work is needed for this.
Solution#21 proposes that CNC is enhanced to provide TSN stream specific
information to the TSN AF. The necessary of providing these parameters is not
confirmed. The definition of CNC is out the scope of SA WG2.
Solution#22 proposes that the UPF/NW-TT detects the burst spread of DL data
for a stream and reports the burst spread to the SMF. The SMF updates the
TSCAI which includes the burst spread to NG-RAN. UPF supports detection of
Burst Spread shall be optional as the AF may also provide Burst Spread.
Solution#23 proposes that the UPF calculates the N6 transmission delay based
on coordination with the AS and reports to SMF. The SMF uses the N6 delay to
calculate the Burst Arrival Time in TSCAI. The N6 transmission delay
measurement is dependent on AS\'s capability and use of extension IPv4/IPv6
header, which are out the scope of SA WG2. Therefore, N6 transmission delay is
not recommended in normative work.
# 8 Conclusions
## 8.1 Key Issue #1: Uplink Time Synchronization
To enable support for Uplink Time Synchronization, following principles are
recommended for the basis of normative work:
\- The following principles are applied for transmission of the gPTP event
messages (carried within Sync message for one-step operation or Follow_up
message for two-step operation):
\- DS-TT which is attached by one or more TSN GMs will perform exactly the
same operations for UL gPTP messages as what the NW-TT performs for the DL
gPTP messages as specified in clause 5.27.1.2.2 of TS 23.501 [2].
\- The PDU session of DS-TT port receiving the source GM\'s gPTP messages is
used to forward the gPTP messages to the UPF/NW-TT:
\- the UPF/NW-TT forwards the gPTP messages to the NW-TT and DS-TT ports in
Master state.
\- If the egress port is in NW-TT, the NW-TT port performs exactly the same
operations for UL gPTP messages as what the DS-TT performs for the DL gPTP
messages as specified in clause 5.27.1.2.2 of TS 23.501 [2].
\- If the egress port is in other DS-TT, the other DS-TT(s) perform the
operation as specified in clause 5.27.1.2.2 of TS 23.501 [2].
\- As specified in TS 23.501 [2] already for Rel-16 Time Synchronization, 5GS
is required to guarantee delivery of gPTP message in less than 10ms as
recommended by IEEE 802.1AS [18] clause B2.2, if the operator decides to
follow such recommendation.
\- The following principles are applied for BMCA procedure:
\- The NW-TT maintains the PTP port state for each DS-TT port and NW-TT port.
The PTP port states may be either locally configured in NW-TT or evaluated by
BMCA procedure.
\- When the 5GS Bridge PTP port states are evaluated by BMCA procedure, the
NW-TT needs to process the received Announce messages (from NW-TT port(s) and
over user plane from the DS-TT(s)) for BMCA procedure, determine port states
within the 5GS, and maintain Master-Slave hierarchy.
\- When the 5GS Bridge PTP port states are locally configured in NW-TT, 5GS
behaviour specified as in TS 23.501 [2] clause H.3 applies, except the DS-TT
port may be configured in Slave state.
\- When the NW-TT is determined to be the grandmaster function for PTP ports
in DS-TT and NW-TT, the NW-TT (generates the Announce messages for the Master
ports on the NW-TT and DS-TT(s). The NW-TT/UPF forwards the generated Announce
messages to the PDU session(s) related to the Master ports on the DS-TT(s).
\- When the TSN GM is external to the 5GS, the NW-TT regenerates the Announce
messages based on the received Announce messages for the Master ports on the
NW-TT and DS-TT(s). The NW-TT/UPF forwards the regenerated Announce messages
to the PDU session(s) related to the Master ports on the DS-TT(s).
\- When the DS-TT(s) is determined to be the grandmaster function for PTP
ports in DS-TT and NW-TT, the DS-TT generates the Announce messages for the
Master port in this DS-TT and the NW-TT generates the Announce messages for
the Master ports in the NW-TT.
\- If the TSN AF has subscribed for the BMCA result reports, the NW-TT reports
BMCA result to the TSN AF via BMIC.
\- DS-TT forwards the received Announce messages to NW-TT over User plane.
## 8.2 Key Issue #2: UE-UE TSC communication
The following is taken as the basis for the normative work:
\- UE-UE TSC (for both IEEE TSN based applications and other applications)
communication (using local switching i.e. without routing via N6) is supported
for all the UE(s) connected to the same DNN/S-NSSAI, terminating on the same
UPF network instance.
\- TSN AF or any AF can determine UE-UE TSC stream(e.g. Flow Descriptions, QoS
requirements such as delay, burst size, periodicity, burst arrival time).
\- TSN AF or any AF determines the Deterministic QoS requirements of the TSC
stream for each UE (one for uplink traffic, one or more for downlink traffic),
and sends the request separately for talker (uplink traffic) and listeners
(downlink traffic).
\- For all traffic, including UE-UE communication (for all PDU Sessions,
including PDU Sessions other than PDU Sessions serving TSC), the existing
forwarding mechanisms defined in the TS 23.501 [2] clause 5.8.2.5.3 or clause
5.8.2.13 can be applied.
\- TSN AF or any AF calculates the Bridge delay for the port pair of two DS-
TTs using components specified in clause 5.27.5 of TS 23.501 [2].
NOTE: How the UPF uses the static filtering entry to achieve routing in all
direction is up to UPF implementation. The externally-observable behaviour of
5GS Bridge needs to comply with IEEE Std 802.1Q.
## 8.3 Key Issue #3B: Exposure of Time Synchronization
To enable Exposure of Time Synchronization, it is recommended to select
solutions 7 and 9 as the basis for normative work. Solutions 7 provide the
description to extend the exposure framework to support AF requesting time
synchronization. Solution 7 considers the exchange of information required
between the 5GS and the AF to support the 4 time synchronization methods of
KI#3B and the functionality required at the DS/NW-TTs for every method.
Solution 9 complements the solution 7 by adding the support for DS-TT acting
as (g)PTP grandmaster.
Following are principles for the basis for normative work:
\- Time Synchronization service, policy and charging control can be provided
for Ethernet PDU sessions and IP PDU sessions.
\- Four time synchronization methods are supported as described in Solution
#7.
\- Time synchronization service may support GM residing in DS-TT(s) as
described in Solution #9.
\- Temporal Validity Condition is needed to guarantee the Synchronization
service only for a duration. If AF provides validity period for the request,
5GS deactivates time delivery for all impacted UEs associated with that AF
request (which has provided the validity period) when the validity period
expires.
\- If the 5GS acts as a Boundary Clock, BMCA method(s) and configuration of
BMCA parameters shall follow the corresponding conclusion of KI#1, where
applicable.
NOTE 1: If 5GS acts as a Transparent Clock, the BMCA function is disabled. PTP
Ports on a Transparent Clock do not maintain PTP Port state, for example,
MASTER or SLAVE.
\- PTP over UDP/IP as described in IEEE 1588-2008 [13] may be used instead of
gPTP.
\- The NEF is used instead of TSN AF.
Time Synchronization service policy and charging control may be applied on a
PDU Session based on the UE\'s subscription or UE\'s capabilities.
For Ethernet PDU Sessions not part of an IEEE TSN network, the transmission of
the PTP messages (carried within Sync message for one-step operation or
Follow_up message for two-step operation) shall follow the corresponding
conclusion of KI#1, if 5GS acts as a Boundary Clock, where applicable:
\- PTP over UDP/IP as described in IEEE 1588-2008 [13] may be used instead of
gPTP;
\- the NEF is used instead of TSN AF.
The following principles are applied for IP type PDU Sessions for the
transmission of the GM time in PTP over UDP/IP messages (carried within Sync
message for one-step operation or Follow_up message for two-step operation) if
5GS acts as a Boundary Clock:
\- DS-TT which is attached by one or more GMs will perform exactly the same
operations for UL PTP messages as what the NW-TT performs for the DL gPTP
messages as specified in clause 5.27.1.2.2 of TS 23.501 [2].
\- The PDU session of DS-TT receiving the source GM\'s PTP messages is used to
forward the PTP messages to the UPF/NW-TT:
\- the UPF/NW-TT forwards the PTP messages to PTP ports in Master state in DS-
TTs and the NW-TT according to the BMCA result as described by conclusion for
KI#1.
\- If the PTP message is sent to N6 interface, the NW-TT performs exactly the
same operations for UL PTP messages as what the DS-TT performs for the DL gPTP
messages as specified in clause 5.27.1.2.2 of TS 23.501 [2].
\- If the PTP message is sent to DS-TT/UE via a PDU Session, the DS-TT(s)
perform the operation as specified in clause 5.27.1.2.2 of TS 23.501 [2].
NOTE 2: If 5GS acts as a transparent clock, the NW-TT or DS-TT needs not to
keep track of the TSC GM time. The 5GS does not maintain the PTP port states;
the ingress PTP messages received on a PTP Port are retransmitted on all other
PTP Ports of the Transparent Clock subject to the rules of the underlying
transport protocol.
NOTE 3: If 5GS acts as an end-to-end transparent clock, since the end-to-end
transparent clock does not support peer-to-peer delay mechanism, only the
residence time spent within the 5GS in 5G GM time is used to update the
correction field of the received PTP Sync or Follow_up message. The residence
time for the PTP message is considered as the difference between TSi and TSe
which are specified in clause 5.27.1.2.2 of TS 23.501 [2].
## 8.4 Key Issue #5: Use of Survival Time for Deterministic Applications in
5GS
Principles for the normative work:
\- Survival Time is transferred as part of the TSCAI parameter but the TSCAI
may not always comprise of Survival time.
\- Survival Time information is specified by the AF in units of \"time\" with
respect to burst periodicity or as the maximum number of consecutive message
transmission failures (i.e. whose loss can be tolerated).
NOTE 1: There is a single message per burst periodicity and the burst contains
the application message. It is conveyed together with TSCAI Periodicity
parameter (the time between periodic TSC bursts) and burst size (e.g. MDBV).
If the Survival Time information is specified by the AF in units of \"time\"
with respect to TSN working domain burst periodicity, Survival Time needs to
be mapped to the 5GS time domain by the SMF based on latest cumulative
rateRatio between the TSN time and 5G time.
When survival time information is provided for a TSC stream, then it should
not be aggregated with other TSC streams into a single QoS flow, or if they
are aggregated, then the survival time parameter shall not be provided .
\- Survival Time is included in the TSC Assistance Container and delivered to
PCF in an AF request by NEF or TSN AF.
\- The PCF provides the Survival Time information to SMF in the TSC Assistance
container.
\- The SMF determines Survival Time and sends it to the NG-RAN as part of
TSCAI without requiring AN or N1 specific signalling exchange with the UE. If
Survival Time information is the maximum number of consecutive message
transmission failures, SMF translates the maximum number of consecutive
message transmission failures to \"time\" unit based on TSCAI periodicity
parameter and determines Survival time.
\- Survival time specified in unit of \"time\" will be supported over NGAP.
## 8.5 Key Issue #3A: Exposure of deterministic QoS
The following is taken as the basis for the way forward:
Take solution#5 as basis for KI#3A:
\- The AF provides traffic related description and QoS requirement:
\- UE related Identification used to determine target UE PDU Session, AF
Identification, a Traffic Description, a 5GS delay, Bandwidth, which are used
to identify the target traffic and related QoS requirement.
\- Flow Direction, Burst Arrival Time at UE (uplink) or UPF (downlink), Burst
Size, Burst Periodicity, and a Timing Domain, which are used for efficient
scheduling in RAN for Ethernet and IP PDU sessions.
\- For ETH PDU Sessions, in order to reuse hold and forward functionality in
the DS-TT and NW-TT, Qbv parameters can be derived by NEF/PCF based on AF
request (with no impact to nodes other than NEF/PCF) and provided to NW-TT/DS-
TT. It is assumed that Rel-16 hold and forward functionality in DS-TT and NW-
TT is re-used.
Editor\'s note: Whether a requirement exists that hold and forward
functionality is needed for VIAPA services needs to be confirmed by SA WG1.
Editor\'s note: Need for Jitter measurement is FFS.
#
# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The scope of this document is to specify the support of NBIFOM (Network based
IP Flow Mobility) i.e. IP flow mobility based on network mobility protocols.
This feature supports PDN connections that are simultaneously connected over
3GPP access (i.e. S5/S8 connection to a PDN GW) and a WLAN access (i.e. S2a or
S2b connection to the same PDN GW).
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.402: \"Architecture enhancements for non-3GPP accesses\".
[3] 3GPP TS 23.203: \"Policy and Charging Control Architecture\".
[4] 3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for
Evolved Universal Terrestrial Radio Access Network(E-UTRAN) access\".
_[5] 3GPP TS 23.060: \"_**General Packet Radio Service (GPRS); Service
description; Stage 2\".**
_[6] 3GPP TS 33.402: \"3GPP System Architecture Evolution (SAE); Security
aspects of non-3GPP accesses_**\".**
[7] 3GPP TS 23.261: \"IP flow mobility and seamless Wireless Local Area
Network (WLAN) offload; Stage 2\".
[8] 3GPP TS 23.380: \"IMS Restoration Procedures\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
**Routing filter:** A set of packet flow IP header parameter values/ranges
used to identify IP flows for routing purposes.
**Routing access type** : Type of access network (e.g. 3GPP or WLAN) over
which to route a set of IP flows of a PDN connection.
**Routing Rule (RR):** A set of information enabling the association of a
routing filter with a routing access type.
**NBIFOM:** IP Flow Mobility based on network mobility protocols (GTP or
PMIP).
**UE-initiated NBIFOM:** IP Flow Mobility based on network mobility protocols
(GTP and PMIP) where the UE initiates the IP flow mobility.
**Network-initiated NBIFOM:** IP Flow Mobility based on network mobility
protocols (GTP and PMIP) where the network initiates the IP flow mobility.
**Multi-access PDN connection:** A PDN connection **whose traffic can be
routed** over **either a** 3GPP **access or** a WLAN access or both. **Each IP
flow is routed at any single time only over one access**.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
MCM Multi-connection mode (as defined in TS 23.402 [2] clause 16)
NBIFOM Network-based IP flow mobility
RCLWI RAN Controlled WLAN Interworking
RR Routing Rule
SCM Single-connection mode (as defined in TS 23.402 [2] clause 16)
TSCM Transparent Single-connection mode (as defined in TS 23.402 [2] clause
16)
# 4 Architecture model and concepts
## 4.1 General concepts
A PDN connection supporting NBIFOM provides simultaneous access to a single
PDN via different access networks: a 3GPP access network and a WLAN access
network. It is used by multi-radio (i.e. 3GPP and WLAN) capable UEs that are
able to simultaneously connect to a given PDN via different access systems
(3GPP and WLAN).
In order to enable NBIFOM, the UE can establish and maintain a PDN connection
over both 3GPP access and WLAN access simultaneously. This is supported for
both S2b and S2a connectivity. The UE can add an access to a PDN connection
even if traffic is not immediately routed over the added access. When a PDN
connection is established over both 3GPP access and WLAN access simultaneously
there is one default bearer for each access.
On a PDN connection established over both 3GPP access and WLAN access, it is
possible to move individual IP flows from one access network to another, when
policies determine that flows should be moved and the target access is
available for the UE.
The PDN GW performs IP flow routing of downlink traffic. The UE performs IP
flow routing of uplink traffic.
A mechanism is defined for the UE and the network to discover whether the
network and the UE respectively support NBIFOM and to decide whether NBIFOM
will be applied for a given PDN connection. This mechanism works on a per-PDN
connection basis.
The UE and the PDN GW shall always be aware of which access IP flows of the
PDN connection shall use.
For NBIFOM, the UE and the PDN GW exchange Routing Rules (RR). Routing Rules
(RR) describe the mapping between a set of IP flows (identified by a Routing
filter) and a Routing access type (e.g. 3GPP or WLAN) over which to route
these IP flows.
Routing rules are exchanged over control plane protocols (NAS over a 3GPP
access, WLCP / IKE over WLAN access, S2a/S2b/S5/S8 control protocol).
The following NBIFOM modes are supported:
\- UE-initiated NBIFOM: In the UE-initiated NBIFOM mode only the UE controls
the traffic routing within the multi-access PDN connection. The UE determines
the Routing rules and provides them to the PDN GW. The network may either
accept or reject the Routing Rules requested by the UE, but does not provide
Routing rules itself.
\- Network-initiated NBIFOM: In the Network-initiated NBIFOM mode, the network
controls the traffic routing within the multi-access PDN connection The PDN GW
determines the Routing rules and provides them to the UE. The UE may either
accept or reject the network\'s request for Routing rules (e.g. based on the
suitability of the WLAN link conditions), but does not provide Routing Rules
itself.
The NBIFOM mode that applies to a PDN connection is determined during the PDN
connection establishment.
Routing Rule installation is possible at any time during the lifetime of a PDN
connection. Routing Rules can be installed even if there is no IP flow
currently matching the routing filter in the Routing Rule.
For a UE with active flows on both 3GPP access and WLAN access, in case one of
the accesses is lost or no longer usable, a mechanism is provided to move the
IP Flows to the other (target) access in order to minimise service disruption.
When an access is recovered, a mechanism is provided to move over this
recovered access the IP Flows which are associated with policies giving
precedence to this access. For UE-initiated NBIFOM mode, the UE-initiated IP
flow mobility procedures described in clause 6.3.3 are used. For network-
initiated NBIFOM mode, the procedures described in clause 6.6 are used.
When PCC is deployed and supports NBIFOM, the PCRF provides the PDN GW with
Access information which is part of PCC rules. The Access information controls
the access over which the traffic that matches the Service data Flow template
of this PCC rule should be sent.
When PCC is not deployed or active for a PDN Connection, the PDN GW may apply
static NBIFOM related policies. The PCEF static policy and control
functionality is not based on subscription / user quota information.
The PDN GW translates Access information received in PCC rules into Routing
Rules to be used between the UE and the PDN GW. In case UE initiated NBIFOM is
applied and PCC is deployed for this PDN connection, the PDN GW provides, upon
subscription of the PCRF, the PCRF with notifications of UE requests for IP
flow mapping to an Access Type. In that case, the PCRF analyses the received
information (requested IP flow mapping to an Access Type), makes a policy
decision and provides PCC rules to the PDN GW with corresponding Access Type
values.
In a PLMN all MME(s), SGSN(s) and SGW(s) are assumed to have the same level of
support of NBIFOM. If the PDN GW detects a change in the support of NBIFOM on
the 3GPP access of a PDN connection, it removes the 3GPP access from the
multi-access PDN connection.
NOTE 1: This may happen in the case of inter PLMN mobility.
For S2a case, NBIFOM applies in both Multi-Connection Mode (MCM) and Single-
Connection Mode (SCM) modes but not in Transparent Single-Connection Mode
(TSCM). In SCM mode:
\- Routing Rules are exchanged only on the 3GPP access. Delivery of Routing
Rules delivery is further described in clause 5.3.
\- No dedicated bearers are supported on the S2a access of the PDN connection.
\- There is no way to indicate the loss of 3GPP access to the PGW in SCM.
There is no support for the indication of loss of 3GPP access in SCM.
NOTE 2: Following features are not supported in this release of the
specification:
\- The support of Routing rules referring to an Application Id,
\- The support of Network Based Mobility based on PMIP.
## 4.2 Architecture reference model
The same architecture than defined in TS 23.402 [2] clause 4.2 (S2b case) and
clause 16 (S2a case) applies. No new functional entity or reference point is
defined for NBIFOM.
More details on the NBIFOM impacts on the various network functions are
provided in clause 5.10.
# 5 NBIFOM High level functions
## 5.1 NBIFOM capability discovery/negotiation and change detection
During initial PDN connection establishment over the first access (or in the
corresponding EAP-AKA\' signalling in S2a/SCM case), the UE includes a NBIFOM
request. The intermediate nodes (e.g. MME, SGSN, TWAG, ePDG, etc.) indicate to
the PDN GW whether they support NBIFOM in the corresponding Create Session
Request. When PCC is deployed, the PDN GW communicates to the PCRF whether the
UE and network support NBIFOM. The PCRF then takes the decision on whether
NBIFOM may apply to a PDN connection and communicates this decision to the PDN
GW. If the network (i.e. all the EPC elements in the signalling chain from UE
to PDN GW) supports NBIFOM and is willing to accept NBIFOM for this PDN
connection, the PDN GW confirms the NBIFOM support in a \"NBIFOM accepted\"
indication sent back to the UE in the PDN connection establishment accept
message (or in the corresponding EAP-AKA\' signalling in S2a/SCM case).
NOTE: It is assumed that intermediate nodes (e.g. MME, SGSN, TWAG, ePDG, etc.)
do not need to know whether NBIFOM finally applies to the PDN connection.
The UE shall enforce that NBIFOM applies either to none or to all PDN
connections set by an UE on a given APN; this e.g. applies when the UE decides
whether to require NBIFOM at the activation of a PDN connection, or when the
UE decides whether adding or removing an access to or from a PDN connection.
During the inter PLMN mobility, the new MME, SGSN and S-GW also indicate to
the P-GW whether they support the NBIFOM. If the PDN GW detects a change in
the support of NBIFOM, the P-GW shall initiate the procedure to remove the
3GPP access from the multi-access PDN connection.
The UE sends also to the network the NBIFOM mode it has selected (as described
in clause 5.4) as part of the initial PDN connection establishment over the
first access.
## 5.2 Routing rules
A Routing Rule contains the following parameters:
\- Routing Filter.
\- Routing Access Information.
\- Routing Rule Priority.
\- Routing Rule identifier.
A Routing Filter consists of IP header parameter values/ranges used to
identify one or more IP flows as defined in clause 3.1.
The Routing Access Information identifies the access type where the IP flow
shall be routed.
For the purpose of matching user traffic against routing rules, the filters
are applied in the order of the Routing Rule Priority.
The Routing Rule identifier uniquely identifies a Routing Rule for one PDN
Connection. The Routing Rule identifier is allocated by the entity creating
the routing rule, i.e. by the UE in UE-initiated NBIFOM mode and by the PDN GW
in Network-initiated NBIFOM mode.
When NBIFOM applies to a PDN Connection, between UE and the PDN GW there is
always a default access via which packets not matching any specific routing
filter (of any Routing Rule) are routed. In the case of 3GPP access, MCM/S2a
and S2b, the UE and the network determine as follows the default access for a
PDN Connection during the procedure of addition of one access to a PDN
connection:
\- In UE-initiated NBIFOM mode, the UE proposes a default access to the
network. The network may accept the default access if it complies with the
subscription. The default access replied by the network may be different than
the default access requested by the UE.
\- In Network-initiated NBIFOM mode, the network decides the default access
and indicates it to the UE.
In the case of SCM/S2a, the UE and the network determine as follows the
default access for a PDN Connection during the first procedure of IP flow
mobility within a PDN connection:
\- In UE-initiated NBIFOM mode, the UE proposes a default access to the
network during the first UE-initiated IP flow mobility procedure via 3GPP. The
network may accept the default access if it complies with the subscription.
The default access replied by the network may be different than the default
access requested by the UE.
\- In Network-initiated NBIFOM mode, the network decides the default access
and indicates it to the UE during the first Network-initiated IP flow mobility
procedure via 3GPP.
NOTE: Whether the default access corresponds to an explicit parameter or to a
default Routing Rule is to be defined as part of Stage 3.
The default access for a PDN Connection only applies when it is active over
both 3GPP and WLAN access networks. When the connectivity over one access is
not active, the UE and the network shall ignore the default access.
The PCRF may learn about the accesses that support a PDN connection via event
triggers it sets on the PDN GW.
## 5.3 Delivery of routing rules and IP Flow mapping
Routing rules are exchanged between the UE and the PDN GW via control plane
signalling.
IP Flow mapping is used in Network-initiated NBIFOM mode when the UE wants to
request the network to apply specific IP mappings to IP flows to 3GPP/WLAN
access. The network provides Routing Rules to the UE for these IP flows unless
the request from the UE is not allowed by the subscription. IP Flow mapping is
sent via control plane signalling.
In the case of 3GPP access, MCM/S2a and S2b, a Routing Rule and IP Flow
mapping are sent on the destination access as indicated by the Routing Access
information in the Routing Rule or IP Flow mapping. In the case of SCM/S2a,
Routing Rules and IP Flow mapping are only sent on the 3GPP access.
For the UE-initiated NBIFOM procedure, the routing rules are provided from the
UE to the network as follows:
\- For untrusted WLAN access, via IKEv2 procedure from the UE to the ePDG.
\- For 3GPP access, via 3GPP NAS signalling from the UE to the MME/SGSN and
then over GTP-c to S-GW.
\- For trusted WLAN access in MCM mode, via WLCP procedure from the UE to the
TWAG.
And then:
\- via GTP-c signalling from the TWAG (MCM) / ePDG / SGW to the PDN GW.
\- via Gx procedure from the PDN GW to the PCRF.
The UE does not apply new routing rules until the PDN GW has acknowledged
them.
For the network-initiated NBIFOM procedure, the PCRF makes the decision on
when and what flows should be moved to which access. The PCRF learns about the
multiple accesses supporting a PDN connection via event triggers from the PDN
GW.
\- The PCRF triggers an update of routing rules by sending PCC rules to the
PDN GW via an IP-CAN Session Modification procedure. The PDN GW builds Routing
Rules corresponding to PCC rules received from the PCRF. The PDN GW does not
apply the new routing rules until the UE has acknowledged them.
\- The routing rules are sent by the PDN GW to S-GW / TWAG (for MCM mode) /
ePDG via GTP-c signalling.
\- The routing rules are then relayed:
\- from SGW to the MME/SGSN via GTP-C and further to the UE via the 3GPP
access specific signalling (i.e. NAS) defined in TS 23.401 [4].
\- from ePDG to the UE via IKE signalling over SWu.
\- from TWAG to the UE via WLCP signalling over trusted TWAN defined in TS
23.402 [2] clause 16.
If updated routing rules result in that no IP flow is left for a particular
access, the PDN GW should not release the PDN connection for that particular
access unless the PDN connection is explicitly torn down by the UE or by the
network as described in clause 6.5.
## 5.4 NBIFOM Modes of Operations
### 5.4.1 General
A multi-access PDN connection can operate either in UE-initiated NBIFOM mode
or in Network-initiated NBIFOM mode. This NBIFOM mode is selected when the PDN
connection is established and remains the same as long as the PDN connection
is active. The following clauses specify (a) what the functional
characteristics of each mode are and (b) how the operation mode is selected.
### 5.4.2 UE-initiated NBIFOM Mode
In the UE-initiated NBIFOM mode only the UE controls the traffic routing
within the multi-access PDN connection by applying its ANDSF for IFOM rules
and/or the user-configured routing rules. When ANDSF for IFOM rules are used,
the UE decides the Routing Rules for downlink traffic.
NOTE: If the UE has valid ANDSF rules for NSWO, for IARP and/or MAPCON, then
the UE can also control traffic routing outside the multi-access PDN
connection.
The UE can request to move selected IP flows from an old access to a new
access within the PDN connection by sending one or more routing rules to the
network. These routing rules specify the selected IP flows and the new access.
The network may reject IP flow mobility requests from UE due to subscription
(or quota) limitations. When the network rejects an IP flow mobility request,
the network shall provide to UE a certain cause value indicating why the
request was rejected. This cause value may be used by UE to determine when/if
this IP flow mobility operation can be requested again.
The network cannot request IP flow mobility. The IP flow mobility procedures
used in UE-initiated NBIFOM mode are described in clause 6.
### 5.4.3 Network-initiated NBIFOM mode
In the Network-initiated NBIFOM mode, the network controls the traffic routing
within the multi-access PDN connection.
NOTE: However, if the UE has valid ANDSF rules for NSWO, for IARP and/or
MAPCON, then the UE can still control traffic routing outside the multi-access
PDN connection.
The network can request to move selected IP flows from an old access to a new
access within the multi-access PDN connection by sending one or more routing
rules to the UE. These routing rules specify the selected IP flows and the new
access.
The UE may reject (e.g. due to Local Operating Environment information) an IP
flow mobility request from the network. When the UE rejects an IP flow
mobility request from the network, the UE shall provide a cause value
indicating why the request was rejected. This cause value may be used by the
network to determine when/if this IP flow mobility operation can be requested
again.
If the UE wants to request a mapping of IP flows to an access type, the UE
provides the requested mapping from to the network. This is however not
considered a routing rule provision as the network is the decision point for
Routing Rules in Network-initiated NBIFOM mode. The network then provides new
or updated routing rules to the UE based on the request received from the UE,
unless the request is against what is allowed by the subscription. IP Flow
mapping information contains the same parameters as the Routing Rule. When the
UE uses the IP flow mapping procedure to add a new Routing Filter, the Routing
Rule identifier is assigned by the network. When the UE uses the IP flow
mapping procedure to request the network to modify or delete an existing
Routing Rule, the UE includes the same Routing Rule identifier as the one
previously assigned by the network. The UE is not allowed to modify/remove a
Routing Filter that the network has previously added using network-initiated
IP flow mobility procedure. The corresponding call flows are provided in
clause 6.4.
The UE can indicate to the network when an access of a multi-access PDN
connection can or cannot be used for traffic routing. For example:
\- When the UE loses the WLAN signal and the UE has active IP flows over WLAN,
then the UE indicates to the network that WLAN cannot be used for traffic
routing. This triggers the network to stop sending downlink traffic for these
IP flows over WLAN access and provide updated routing rules to the UE. The UE
and the network re-route one or more of these IP flows to 3GPP access, if the
existing routing rules do not prevent them from using 3GPP access.
\- When the UE recovers the WLAN signal and the existing routing rules in the
UE require some active IP flows to be routed over WLAN, the UE indicates to
the network that WLAN can again be used for traffic routing within the PDN
connection. The network provides updated routing rules to the UE for the IP
flows that are moved to WLAN access. The UE and the network re-route these
active IP flows to WLAN access.
\- The UE uses its Local Operating Environment (as defined in TS 23.261 [7])
to decide when the above indications should be sent to the network.
The network may provide to UE a \"RAN rules / RCLWI handling\" parameter
during the PDN connection establishment procedure via 3GPP if the Network-
initiated mode is selected (as specified in clause 5.4.4). When this parameter
is set, it indicates that the UE shall use the \"move traffic to/from WLAN\"
indications from Access Stratum under the conditions specified in bullet (a)
below. When this parameter is not set or is not provided, it indicates that
the UE shall not use the \"move traffic to/from WLAN\" indications. The UE
uses the \"RAN rules / RCLWI handling\" parameter as specified below:
(a) If the \"RAN rules / RCLWI handling\" is set, the UE has no ISRP rule
valid in the registered PLMN and the UE supports RAN-assisted WLAN
interworking and/or and RCLWI, then the UE shall use the \"move traffic
to/from WLAN\" indications from Access Stratum as follows:
\- When Access Stratum indicates that traffic should be moved to 3GPP access,
the UE shall send a move-from-WLAN indication to the network. The network then
shall provide updated routing rules to the UE for traffic routing within the
multi-access PDN connection.
\- When Access Stratum indicates that traffic should be moved to WLAN access
and the Local Operating Environment Information in the UE does not contain
non-radio-related conditions that prohibit the use of WLAN access, the UE
shall send a move-to-WLAN indication to the network. The network then shall
provide updated routing rules to the UE for traffic routing within the multi-
access PDN connection.
\- The UE shall ignore the WLAN offloadability indication sent by MME.
(b) In all other cases, the UE shall not use the \"move traffic to/from WLAN\"
indications from the Access Stratum. The UE shall perform traffic routing
within a multi-access PDN connection by using the NBIFOM routing rules
provided by the network.
### 5.4.4 Mode Selection
A multi-access PDN connection can operate in one of the following modes:
\- UE-initiated mode;
\- Network-initiated mode.
The details of UE-initiated mode are specified in clause 5.4.2 and the details
of Network-initiated mode are specified in clause 5.4.3.
The NBIFOM mode is selected by the network (i.e. the PCRF, if PCC is deployed;
or the PGW, otherwise) with the following procedure:
When an NBIFOM-capable UE supports ANDSF and has an ISRP rule valid in the
registered PLMN then:
\- If the ISRP rule includes at least one \"ISRP for IFOM\" rule
(irrespectively of its validity), the UE requests UE-initiated mode;
\- in non-roaming scenario, the network selects the UE-initiated mode;
\- in roaming scenario:
\- If the visited network selects the NBIFOM mode according to description in
clause 5.5, the visited network shall select UE-initiated mode; otherwise
\- If the home PLMN has not provided the UE with \"ISRP for IFOM\" rules, the
home network makes the final decision of the NBIFOM mode, i.e., the home
network may select either UE-initiated or NW-initiated mode according to home
operator\'s policy;
\- otherwise, the network selects UE-initiated mode.
\- Otherwise, the UE requests Network-initiated mode and the network selects
Network-initiated mode.
When an NBIFOM-capable UE does not support ANDSF or supports ANDSF but does
not have an ISRP rule valid in the registered PLMN then:
\- The UE requests Network-initiated mode and the network selects Network-
initiated mode.
Figure 5.4.4-1 provides a schematic illustration of the NBIFOM mode selection
procedure as specified above. This figure assumes that the UE supports both
ANDSF procedures and RAN-assisted WLAN interworking.
Figure 5.4.4-1: NBIFOM Mode Selection
## 5.5 PCC Interactions
When PCC applies for NBIFOM support on a PDN connection:
\- The PCRF controls whether NBIFOM may apply to a PDN connection.
\- The PCRF selects the NBIFOM mode.
\- The PDN GW shall notify the PCRF when an access is added or removed for the
PDN connection.
\- The PDN GW shall notify the PCRF when an access becomes no more Usable or
Usable again. This allows the PCRF to be aware when the UE losses or recovers
connectivity on an access and to react accordingly in network-initiated NBIFOM
mode.
\- Multiple IP-CAN types (3GPP EPS and Non 3GPP EPS) may be simultaneously
associated with the same IP-CAN session.
\- The PCRF can send PCC rules including access type routing information per
PCC rule to the PDN GW.
\- For UE-initiated NBIFOM mode, the PDN GW may notify the PCRF about the
Routing Rules received from the UE. When the Routing Rules received from the
UE comply with the user subscription the PCRF installs / modifies PCC rules
based on these notifications.
\- For network-initiated NBIFOM mode, the PCRF determines the desired access
type routing information for a PCC rule and accordingly installs / modifies
PCC rules to the PDN GW. The PCRF request may be rejected by the UE due to
local radio conditions. In that case the PCRF gets notified that the PCC rule
cannot be fulfilled.
In following conditions the PCRF mentioned above is the Home PCRF:
\- The UE is served by its HPLMN, or
\- The PDN connection is served by a PGW in the Home PLMN (Home Routed
configuration), or
\- The PDN connection is served by a PGW in the V-PLMN (LBO configuration),
and S9 is deployed and the V-PCRF supports NBIFOM.
The PCRF mentioned above is the Visited PCRF in the case when, through roaming
agreement, the HPLMN operator allows the VPLMN operator to operate the V‑PCRF
without S9; this includes authorization of roamers to use NBIFOM. In that
case, policy control based on subscription policy information from the HPLMN
cannot apply.
NOTE: If the Home operator wants to enforce control by its own PCRF of the
NBIFOM functionality on a PDN connection, the Home operator should ensure that
the Home Routed roaming configuration applies to this PDN connection.
PCC impacts of NBIFOM are further described in TS 23.203 [3].
## 5.6 Addition of one access to a Multi-access PDN connection
During PDN connection establishment over an access, the UE may provide to the
network a Handover Indication and a NBIFOM indication (in the PCO in the case
of 3GPP access or TWAN access) in order to request that the PDN connection is
to be used for NBIFOM: in this case the PDN connection establishment
corresponds to the addition of an access to an already established PDN
connection.
NOTE 1: In case a Handover Indication and no NBIFOM indication in the PCO are
provided by the UE the PDN connection is handed over to the new access per the
procedures described in TS 23.402 [2]
NOTE 2: In case No Handover Indication is provided by the UE, the PDN
connection establishment corresponds to the set-up of a new PDN connection per
the procedures described in TS 23.402 [2]
Intermediate node (e.g. MME/SGSN, SGW, TWAG or ePDG) indicate in the Create
Session Request whether they support NBIFOM regardless of whether the Create
Session Request set-up carries a Handover Indication. In the case of 3GPP
access and WLAN access with S2a, NBIFOM is not supported by an intermediate
node (i.e. MME/SGSN, SGW, TWAG) while the UE requests to add an additional
access to a PDN connection, the network should reject the PDN connectivity
request with the appropriate cause value to indicate the failure of adding an
additional access for NBIFOM. However, the previously established PDN
connection shall be maintained on the first access.
NOTE 3: In the case of WLAN access with S2b, when NBIFOM is not supported by
an ePDG, the addition of WLAN access is treated by the PGW as handover
request. If the UE successfully connects with the ePDG but does not receive an
NBIFOM indication in IKEv2 signalling from the network, the UE determines that
its PDN connection over 3GPP access was handed over to WLAN.
When PCC applies, the PDN GW initiates an IP-CAN Modification Procedure to
inform the PCRF about the UE request to add an access to an already
established IP-CAN session and about the added RAT type and IP-CAN type. The
PDN GW confirms the NBIFOM support in a \"NBIFOM accepted\" indication sent
back to the UE in the PDN connection establishment accept message (or in the
corresponding EAP-AKA\' signalling in S2a/SCM case)
The Addition of one access to a Multi-access PDN connection is further
described in clause 6.2
## 5.7 IP flow mobility within a Multi-access PDN connection
In UE-initiated NBIFOM mode, the IP flow mobility within a Multi-access PDN
connection relies on the UE request to move selected IP flows from an old
access to a new access by sending one or more routing rules to the network.
This is further described in clauses 5.4.2 and 6.3.3
In Network-initiated NBIFOM mode, the IP flow mobility within a Multi-access
PDN connection relies on the network request to move selected IP flows from an
old access to a new access by sending one or more routing rules to the UE. The
procedures IP flow mobility in Network-initiated NBIFOM mode are further
described in clauses 5.4.3 and 6.3.2. The network decision for IP Flow
Mobility may be based on notifications received from the UE that an access has
become Unusable or has become Usable again as described in clauses 5.4.3, 6.6
and 6.7.
## 5.8 Removal of an access from a PDN connection
Both the UE and the network may initiate removal of an access procedure in
both UE-initiated NBIFOM mode and network-initiated NBIFOM mode. When an
access is removed from a multi-access PDN connection,
\- In the UE-initiated removal of an access procedure, the PCEF (in the PDN
GW) notifies the PCRF about the removal of an access. The PCRF determines the
affected PCC rules and replies with updated PCC Rules or informs about the PCC
Rules that are to be removed. The UE shall delete the Routing Rules locally
\- In the Network-initiated removal of an access procedure, the PCRF should
indicate the removed access to the PCEF by updating or removing all PCC rules
that are bound to this access. In UE-initiated NBIFOM mode, the UE shall
delete the Routing Rules locally.
The Removal of an access from a PDN connection is further described in clause
6.5.
## 5.8a Network-initiated release of NBIFOM PDN connection
The network may need to release a NB-IFOM PDN connection over both 3GPP and
WLAN accesses, e.g. for SIPTO as defined in TS 23.401 [4] or for P-CSCF
restoration as defined in TS 23.380 [8].
In this procedure, the network, after initiating the release of the PDN
connection over one access, also initiates the release of the PDN connection
over the other access thus avoiding the dependence on the UE-initiated PDN
connection disconnect procedure.
The network-initiated release of a NBIFOM PDN connection is further described
in clause 6.8.
## 5.9 Void
## 5.10 Functional entities
### 5.10.1 UE
To support NBIFOM the UE needs to be capable to:
\- Indicate support and request for NBIFOM for a PDN connection as well as to
request NBIFOM mode to the network.
\- Send a default access for NBIFOM to the network in UE-initiated NBIFOM
mode.
\- Receive from the network decisions about whether NBIFOM applies to a PDN
connection, about the NBIFOM mode and about the default access.
\- Provide handover indication and NBIFOM indication when an access is added
for a PDN connection.
\- Exchange routing rules with the network over control plane protocols.
\- Route IP flow(s) by using the default access for NBIFOM and routing access
information which is part of the routing rules.
\- Notify the network that an access becomes \"usable\" or \"unusable\" in
Network-initiated NBIFOM mode.
### 5.10.2 PDN GW
To support NBIFOM the PDN GW needs to be capable to:
\- Negotiate the support of NBIFOM and confirm the NBIFOM mode when the UE
requests PDN connectivity over the first access. This negotiation includes
receiving UE request for NBIFOM as well as receiving indication of support
from entities in the network (MME, ePDG, etc.)
\- Negotiate the support of NBIFOM and of the default access for NBIFOM when
the UE requests PDN connectivity over an additional access. This negotiation
includes receiving UE request for NBIFOM as well as indication of support from
entities in the network (MME, ePDG, etc.)
\- Support a PDN connection using multiple accesses.
\- Provide the Charging Id for the PDN Connection to the S-GW/TWAN/ePDG in a
separate information element.
\- Receive UE request on a default access for NBIFOM in UE-initiated NBIFOM
mode.
\- Route the IP flow(s) by using the default access and the routing access
information which is part of the routing rules.
\- Exchange routing rules with the UE over control plane protocols.
\- Receive UE notification that an access has become \"usable\" or
\"unusable\" in Network-initiated NBIFOM mode.
\- Support PCC interactions described in clause 5.5 and TS 23.203 [3] when PCC
is enabled for the PDN connection.
### 5.10.3 MME
To support NBIFOM, the MME needs to be capable to:
\- Provide an indication to the PDN GW for its support for NBIFOM during the
PDN connection establishment over the first access and over an additional
access.
\- Forward the routing rules between the network (S-GW) and the UE via NAS and
S11.
\- Forward over S11 notifications received over NAS from the UE that an access
has become \"usable\" or \"unusable\".
### 5.10.4 S-GW
To support NBIFOM, the S-GW needs to be capable to:
\- Provide an indication to the PDN GW for its support for NBIFOM and relays
the support indication from the MME/SGSN during the PDN connection
establishment (over the first access and over an additional access).
\- Forward the routing rules between the PDN GW and the MME/SGSN via S4/S11
and S5/S8.
\- Forward over S5/S8 notifications received over S4/S11 from the SGSN/MME
that an access has become \"usable\" or \"unusable\".
\- Maintain the Charging Id for the PDN Connection as an information element
independent from the Charging Id for a bearer.
### 5.10.5 ePDG
To support NBIFOM, the ePDG needs to be capable to:
\- Receive the UE indication to negotiate NBIFOM support and NBIFOM mode in
SWu during the initial and additional access and forward it over S2b;
\- Receive over S2b the negotiation result of NBIFOM support from the PDN GW
and forward it to the UE via SWu signalling;
\- Provide an indication to the PDN GW for its support for NBIFOM during the
PDN connection establishment (over the first and over an additional access);
\- Forward the routing rules between the PDN GW and the UE via SWu and S2b;
\- Forward over S2b notifications received over SWu from the UE that an access
has become \"usable\" or \"unusable\".
\- Handle the Charging Id for the PDN Connection as an information element
independent from the Charging Id for a bearer.
### 5.10.6 TWAN
To support NBIFOM, the TWAN needs to be capable to:
\- Provide an indication to the PDN GW for its support for NBIFOM, during the
PDN connection establishment over the first access and over an additional
access,
\- Provide indication to the PDN GW whether the PDN connection is being
established as SCM or MCM.
\- Handle the Charging Id for the PDN Connection as an information element
independent from the Charging Id for a bearer.
In the case of MCM, the TWAG:
\- Forwards the routing rules between the PDN GW and the UE via WLCP and S2a,
\- Forwards over S2a notifications received over WLCP from the UE that an
access has become \"usable\" or \"unusable\".
### 5.10.7 SGSN
To support NBIFOM, the SGSN needs to be capable to:
\- Provide an indication to the PDN GW for its support for NBIFOM, during the
PDN connection establishment over the first access and over an additional
access.
\- Forward the routing rules between the network (S-GW) and the UE via NAS and
S4.
\- Forwards over S4 notifications received over NAS from the UE that an access
has become \"usable\" or \"unusable\".
### 5.10.8 PCRF
PCC Enhancements are described in clause 5.5 and TS 23.203 [3].
# 6 NBIFOM Signalling Flows
## 6.1 Initial PDN connection establishment over first access
### 6.1.1 Initial PDN connection establishment over 3GPP access
Figure 6.1.1-1: PDN connection establishment over 3GPP access with GTP based
S5/S8
In the case of E-UTRAN, the UE performs the PDN connection establishment over
EUTRAN access as specified in TS 23.401 [4] clause 5.3.2.1 for Initial Attach,
and as specified in TS 23.401 [4] clause 5.10.2 for UE requested PDN
connectivity, with the following additions:
Step 1: In the case of initial attach, the UE includes an NBIFOM indication in
the PCO in the Attach Request. In the case of UE requested PDN connectivity,
the UE sends PDN Connectivity Request, including an NBIFOM indication in the
PCO.
\- In addition, UE requests the NBIFOM mode of this PDN connection in the PCO
according to the consideration based on clause 5.4.4 Mode Selection.
Step 2-3: In the Create Session Request, the MME and SGW notify PDN GW of
their support for NBIFOM.
Step 4: If dynamic PCC is applied for the PDN connection, during the IP-CAN
session establishment, the PDN GW informs the PCRF about the UE and network
support of NBIFOM capability, the requested NBIFOM mode, IP-CAN type and the
RAT type; and if the UE and the network support NBIFOM, the H-PCRF informs the
PDN GW about its decision on whether to allow NBIFOM for the PDN connection.
If PCC does not apply, the PDN GW takes the local decision on whether to allow
NBIFOM for the given PDN connection.
Step 5: The PDN GW indicates the NBIFOM support and the NBIFOM mode in the PCO
and includes the Charging Id for the PDN Connection in the Create Session
Response. The PCO is forwarded to the UE as described in TS 23.401 [4].
For UTRAN, the UE performs the initial PDN connection establishment over
GERAN/UTRAN access as specified in TS 23.060 [5] clause 9.2.2.1A (PDP context
activation using S4) and addition of a new PDN connection as specified in TS
23.060 [5] clause with the following additions:
Step 1: As described in TS 23.060 [5] clause 9.2.2.1, the UE sends Activate
PDP context Request, including an NBIFOM indication as well as the requested
NBIFOM mode in the PCO. UE requests the NBIFOM mode of this PDN connection in
the PCO according to the consideration based on clause 5.4.4 Mode Selection.
Step A-B: As described in TS 23.060 [5], clause 9.2.2.1A, the SGSN and S-GW
inform the PDN GW their support of NBIFOM:
\- If PCC applies, during the IP-CAN session establishment procedure, the PDN
GW informs the PCRF about the UE and network support of NBIFOM capability,
about the requested NBIFOM mode and about the IP-CAN type and RAT type; and if
the UE and network support NBIFOM, the H-PCRF informs the PDN GW about its
decision on whether to allow NBIFOM for the PDN Connection. If PCC does not
apply, the PDN GW takes a local decision on whether to allow NBIFOM for the
PDN Connection.
Step 9: As described in TS 23.060 [5] clause 9.2.2.1A, the PDN GW indicates
the NBIFOM support and the NBIFOM mode in the PCO and includes the Charging Id
for the PDN Connection in the Create Session Response. The PCO is forwarded to
the UE as described in TS 23.401 [4].
### 6.1.2 PDN connection establishment over S2a
This clause describes PDN connection establishment for S2a with single-
connection mode and S2a with multi-connection mode.
#### 6.1.2.1 Single-connection mode
This procedure is used to establish a PDN Connection over trusted WLAN access
in single-connection mode.
Figure 6.1.2.1-1: PDN connection establishment procedure over TWAN access for
SCM
For SCM, a new PDN connection is established as described in TS 23.402 [2]
clause 16.2 for Initial Attach, with the following additions:
\- During the EAP authentication, the UE negotiates single-connection mode and
requests EPC access. The UE also indicates NBIFOM support in the PCO provided
during the EAP authentication. The UE also provides the requested NBIFOM mode
in the PCO according to the conditions for NBIFOM mode selection in clause
5.4.4.
\- The TWAN includes an NBIFOM support indication in the Create Session
Request to the PDN GW.
\- If dynamic PCC is applied for the PDN Connection, the PDN GW initiates an
IP-CAN session establishment procedure. As part of this procedure the PDN GW
informs the PCRF about the UE and network support of NBIFOM capability, about
the requested NBIFOM mode and about the IP-CAN type. If the UE and network
support NBIFOM, the PCRF informs the PDN GW about its decision on whether to
allow NBIFOM for the PDN Connection. If dynamic PCC is not applied, the PDN GW
takes a local decision on whether to allow NBIFOM for the PDN Connection.
\- The PDN GW includes the Charging Id for the PDN Connection separately in
the Create Session Response to the TWAN. The PDN GW indicates the network
support of NBIFOM in the PCO in the Create Session Response. The PCO is
forwarded to the UE as described in clause 16.2, TS 23.402 [2].
#### 6.1.2.2 Multi-connection mode
This procedure is used to establish a PDN Connection over trusted WLAN access
in multi-connection mode.
Figure 6.1.2.2-1: PDN connection establishment procedure over TWAN access for
MCM
For MCM, the UE attaches to TWAN using the procedure described in steps 1-15
in clause 16.2.1 of TS 23.402 [2] and negotiates for multi-connection mode. If
multi-connection mode is authorized by the network, the UE performs the PDN
Connection establishment procedure in clause 16.8.1 of TS 23.402 [2] with the
following additions:
\- The UE indicates NBIFOM support in PCO in the WLCP PDN Connection Request
to the TWAN. The UE also provides the requested NBIFOM mode in PCO according
to the conditions for NBIFOM mode selection in clause 5.4.4.
\- The TWAN includes an NBIFOM support indication in the Create Session
Request sent to the PDN GW.
\- If dynamic PCC is applied for the PDN Connection, in the PDN GW initiates
an IP-CAN session establishment procedure. As part of this procedure the PDN
GW informs the PCRF about the UE and network support of NBIFOM capability,
about the requested NBIFOM mode and about the IP-CAN type. If the UE and
network support NBIFOM, the PCRF informs the PDN GW about its decision on
whether to allow NBIFOM for the PDN Connection. If dynamic PCC is not applied,
the PDN GW takes a local decision on whether to allow NBIFOM for the PDN
Connection.
\- The PDN GW includes the Charging Id for the PDN Connection separately in
the Create Session Response to the TWAN. The PDN GW indicates the NBIFOM
support in the PCO in the Create Session Response. The PCO is forwarded to the
UE as described in clause 16.2, TS 23.402 [2].
### 6.1.3 PDN connection establishment over S2b
This procedure is used to establish a PDN Connection over untrusted WLAN
access.
Figure 6.1.3-1: PDN connection establishment over WLAN access
The procedure is the same as described in clause 7.2.4 of TS 23.402 [2], with
the following additions:
\- The UE uses Configuration Payload in IKEv2 signalling to indicate its
support for NBIFOM. The UE also provides in the IKEv2 Configuration Payload
the requested NBIFOM mode for this PDN connection according to the conditions
on NBIFOM mode selection in clause 5.4.4.
\- If the ePDG supports NBIFOM, the ePDG shall indicate its NBIFOM capability
in the Create Session Request sent to the PDN GW. The ePDG also transfers the
UE support for NBIFOM and the UE request for the NBIFOM operation mode to the
PDN GW.
\- If dynamic PCC is applied for the PDN Connection, the PDN GW initiates an
IP-CAN session establishment procedure. As part of this procedure the PDN GW
informs the PCRF about the UE and network support of NBIFOM capability, about
the requested NBIFOM mode and about the IP-CAN type. If the UE and network
support NBIFOM, the PCRF informs the PDN GW about its decision on whether to
allow NBIFOM for the PDN Connection. If PCC is not applied, the PDN GW takes a
local decision on whether to allow NBIFOM for the PDN Connection.
\- The PDN GW includes the Charging Id for the PDN Connection separately in
the Create Session Response to the ePDG The PDN GW indicates the NBIFOM
support in the APCO in the Create Session Response.
\- The ePDG shall forward the negotiated result of NBIFOM support to the UE
via Configuration Payload in IKEv2 signalling.
## 6.2 Addition of one access to a PDN connection
### 6.2.1 General
This clause specifies the additional procedures for adding an access to an
existing PDN connection over a 3GPP access, a Trusted WLAN access or an
Untrusted WLAN when the NBIFOM is supported. In these flows it is assumed that
the UE has performed a PDN Connection establishment procedure through one
access as specified in clause 6.1. The procedure results in that the UE is
simultaneously connected via both accesses and a set of traffic flows can be
routed through one access while the remaining traffic flows are routed through
the other access.
Each of the accesses has its own default bearer where each bearer has its own
Charging Id. The Charging Id for the PDN connection will differ from the
Charging Id for the default bearer. The PDN GW shall provide the Charging Id
for the PDN connection separately to the SGW/TWAN/ePDG for both the default
and any dedicated bearer.
### 6.2.2 Addition of a 3GPP access
In the case of E-UTRAN, the UE has established a PDN connection over WLAN as
described in clause 6.1.2 or 6.1.3 above. Subsequently, the UE requests to
establish a PDN connection using the same APN on E-UTRAN, and attempts to use
both accesses for the same PDN connection simultaneously. For EUTRAN, the
procedure is the same as specified in TS 23.401 [4] clause 5.3.2.1 (Initial
attach procedure) and clause 5.10.2 (UE requested PDN Connectivity procedure)
with the following additions:
Step 1: The UE indicates handover and includes NBIFOM indication in the PCO in
Attach Request (Initial attach) or PDN Connectivity Request (UE requested PDN
Connectivity procedure) for the same APN as for the PDN connection established
over the Trusted or Untrusted WLAN access previously.
Step 2: Since the handover indication is provided by the UE, the MME selects
the same PDN GW that is already assigned for the UE and the PDN connection,
and indicates its NBIFOM capability in the Create Session Request to the
Serving GW.
Step 3: The Serving GW sends the Create Session Request to the PDN GW,
including its NBIFOM capability.
Step 4: When the PDN GW receives handover and NBIFOM indication, the PDN GW
does not remove the bearers over the WLAN access for the corresponding PDN
connection. The PDN GW initiates an IP-CAN Modification Procedure to notify
the PCRF about the additional of 3GPP access together with the RAT type of the
access, if dynamic PCC applies. The PCRF may reject the addition of the access
if the multi-access IP-CAN session would correspond to an invalid combination
of IP-CAN and RAT Types or is not allowed by the subscription.
\- The same IP address is allocated for the PDN connection as the one used in
WLAN.
\- If UE-initiated NBIFOM mode was selected at initial PDN Connection
establishment, the UE may include Routing Rules and indicates the default
access to the PCRF via PDN GW during this procedure. The PCRF takes a final
decision on the default access based on the subscription, and indicate the
default access for the PDN Connection to the PDN GW. The default access
replied by the network may be different than the default access requested by
the UE.
\- If network-initiated NBIFOM mode was selected at initial PDN connection
establishment, the network does not provide any Routing Rules to the UE during
this procedure. The PCRF shall indicate the default access to the PDN GW. The
PDN GW indicates the default access to the MME via SGW. The MME indicates the
default access to the UE in PDN Connectivity Accept message.
\- Appropriate 3GPP bearer setup or modification procedures are executed for
the resources associated with the flows that were moved onto the 3GPP access.
Step 5: If the MME, SGW and the PDN GW support NBIFOM and the addition of an
access is accepted by the PCRF, the PDN GW generates a Charging Id for the
Default Bearer and includes the Charging Ids for the PDN Connection and the
Default Bearer in the Create Session Response to the SGW. The PDN GW indicates
the support of NBIFOM in the PCO included in Attach Accept / PDN Connectivity
Accept to be sent to the UE.
In the case of GERAN/UTRAN, the UE performs the initial PDN connection
establishment over GERAN/UTRAN access and addition of a new PDN connection as
specified in TS 23.060 [5] clause 9.2.2.1A (PDP context activation using S4)
with the following additions:
Step 1: The UE sends Activate PDP context Request, including an NBIFOM
indication in the PCO and handover indication.
Step 2: Since the handover indication is provided by the UE, the SGSN selects
the same PDN GW that is already assigned for the UE and the PDN connection,
and indicates its NBIFOM capability in the Create Session Request to the
Serving GW. The SGSN and SGW inform the PDN GW their support of NBIFOM in
Create Session Request.
Step 3: The Serving GW sends the Create Session Request to the PDN GW,
including its NBIFOM capability.
Step 4: When the PDN GW receives handover and NBIFOM indication, the PDN GW
does not remove the bearers over the WLAN access for the corresponding PDN
connection. The PDN GW initiates an IP-CAN Modification Procedure to notify
the PCRF about the additional of 3GPP access together with the RAT type of the
access, if dynamic PCC applies. The PCRF may reject the addition of the access
if the multi-access IP-CAN session would correspond to an invalid combination
of IP-CAN and RAT Types or is not allowed by the subscription.
\- The same IP address is allocated for the PDN connection as the one used in
WLAN.
\- If UE-initiated NBIFOM mode was selected at initial PDN Connection
establishment, the UE may include Routing Rules and indicates the default
access to the PCRF via PDN GW during this procedure. The PCRF takes a final
decision on the default access based on the subscription, and indicate the
default access for the PDN Connection to the PDN GW. The default access
replied by the network may be different than the default access requested by
the UE.
\- If network-initiated NBIFOM mode was selected at initial PDN connection
establishment, the network does not provide any Routing Rules to the UE during
this procedure. The PCRF shall indicate the default access to the PDN GW. The
PDN GW indicates the default access to the MME via SGW. The MME indicates the
default access to the UE in PDN Connectivity Accept message.
\- Appropriate 3GPP bearer setup or modification procedures are executed for
the resources associated with the flows that were moved onto the 3GPP access.
Step 5: If the SGSN, SGW and the PDN GW support NBIFOM and the addition of an
access is accepted by the PCRF, the PDN GW generates a Charging Id for the
Default Bearer and includes the Charging Ids for the PDN Connection and the
Default Bearer in the Create Session Response to the SGW. The PDN GW indicates
the support of NBIFOM in the PCO included in Activate PDP context Accept to be
sent to the UE.
### 6.2.3 Addition of an access using S2a
#### 6.2.3.1 Single-connection mode
This procedure is used to add trusted WLAN access in single-connection mode to
an existing PDN Connection. The decision to use the single-connection mode is
made during authentication as described in clause 16.2.
Figure 6.2.3.1-1: Addition of trusted WLAN access with SCM and GTP S2a for
roaming, LBO and non-roaming scenarios
It is assumed that the UE has established a PDN connection over a 3GPP access
and has received from the network an indication that NBIFOM is supported to
this PDN connection. In order to use the TWAN access with SCM for the same PDN
connection simultaneously, the UE now performs the procedure TS 23.402 [2]
clause 16.2 (Initial Attach) with the following additions:
Step 2: During the EAP authentication, the UE negotiates single-connection
mode and requests EPC access. The UE indicates handover and the same APN as
for the PDN connection established over the 3GPP access. The UE also includes
an NBIFOM indication in the PCO that the procedure is for the addition of an
access to the PDN connection. The UE cannot include routing rule(s) during the
EAP authentication procedure in single-connection mode. If UE-initiated NBIFOM
mode was selected at initial PDN Connection establishment, the UE may include
an indication for default access for the PDN Connection.
Step 3: Since the handover indication is included, the TWAN selects the same
PDN GW as it is already allocated for the PDN connection. The TWAN includes an
NBIFOM capability indication in the Create Session Request.
Step 4: Instead of an IP-CAN Session Establishment procedure, the PDN GW
performs an IP-CAN Session Modification procedure. The PDN GW indicates to the
PCRF the addition of an access for the PDN connection and informs the PCRF
about the additional RAT type. The PCRF may reject the addition of the access
if the multi-access IP-CAN session would correspond to an invalid combination
of IP-CAN and RAT Types or is not allowed by the subscription.
Step 8: If the TWAN and the PDN GW support NBIFOM and the addition of an
access is accepted by the PCRF, the PDN GW generates a Charging Id for the
Default Bearer and includes the Charging Ids for the PDN Connection and the
Default Bearer in the Create Session Response to the TWAN. The PDN GW
indicates the support of NBIFOM in the PCO to be sent to the UE.
In network-initiated NBIFOM mode, the network does not provide any routing
rules to the UE during this procedure.
NOTE: The reason is that there would be no way for the UE to acknowledge the
network-provided Routing Rules during the addition of an access. Instead,
Routing Rules need to be provided from the network using a separate IP flow
mobility procedure.
NBIFOM is not supported for Transparent Single Connection Mode. Therefore only
scenario (A) in Figure 6.2.3.1-1 is applicable to NBIFOM.
#### 6.2.3.2 Multi-connection mode
This procedure is used to add trusted WLAN access in multi-connection mode to
an existing PDN Connection. The decision to use the multi-connection mode is
made during authentication as described in clause 16.2.
Figure 6.2.3.2-1: UE-Initiated Connectivity to PDN in WLAN on GTP S2a
It is assumed that the UE has established a PDN connection over a 3GPP access
and has received from the network an indication that NBIFOM is supported for
to this PDN connection.
It is also assumed that the UE has made initial attach in trusted WLAN access
and negotiated MCM during EAP authentication, as described in clause 16.2.1 in
TS 23.402 [2].
In order to use the TWAN access with MCM for the same PDN connection
simultaneously, the UE now performs the procedure TS 23.402 [2] clause 16.8.1
(PDN Connection establishment) with the following additions:
Step 1: In the WLCP PDN Connection Request, the UE indicates handover and the
same APN as for the PDN connection established over the 3GPP access. The UE
also includes an indication in the PCO that the procedure is for addition of
an access for the PDN connection.
If UE-initiated NBIFOM mode was selected at initial PDN Connection
establishment, the UE may include Routing Rules in the WLCP PDN Connection
Request, as well as an indication for default access for the PDN Connection.
Step 2: Since the handover indication is included, the TWAN selects the same
PDN GW as is already allocated for the PDN Connection. The TWAN includes an
NBIFOM capability indication in the Create Session Request. The TWAN also
includes Routing Rules(s) and the indication for default access if provided by
the UE in step 2.
When the PDN GW receives the Create Session Request indication, the PDN GW
does not remove the bearers over 3GPP access for the corresponding PDN
connection. The same IP address is allocated for the PDN connection as the one
used in 3GPP access network
Step 3: Instead of an IP-CAN Session Establishment procedure, the PDN GW
performs an IP-CAN Session Modification procedure. The PDN GW indicates to the
PCRF of addition of an access for the PDN connection and informs the PCRF
about the additional RAT type. The PCRF may reject the addition of the access
if the multi-access IP-CAN session would correspond to an invalid combination
of IP-CAN and RAT Types or is not allowed by the subscription.
If network-initiated NBIFOM mode was selected at initial PDN Connection
establishment, the PCRF shall indicate the default access for the PDN
Connection to the PDN GW.
If UE-initiated NBIFOM mode was selected at initial PDN Connection
establishment and the UE included an indication for default access for the PDN
Connection, the PDN GW provides the indication to the PCRF. The PCRF takes a
final decision on the default access based on the subscription, and indicate
the default access for the PDN Connection to the PDN GW. The default access
replied by the network may be different than the default access requested by
the UE.
Step 5: The PDN GW indicates the default access for the PDN Connection to the
TWAG via S2a.
Step 7: The TWAG indicates the new default access to the UE as part of the
WLCP PDN Connection Response. If the TWAN and the PDN GW support NBIFOM and
the addition of an access is accepted by the PCRF, the PDN GW generates a
Charging Id for the Default Bearer and includes the Charging Ids for the PDN
Connection and the Default Bearer in the Create Session Response to the TWAN.
The PDN GW indicates the support of NBIFOM in the PCO included in WLCP PDN
Connectivity Accept to be sent to the UE.
In network-initiated NBIFOM mode, the network does not provide any routing
rules to the UE during this procedure.
NOTE: The reason is that there would be no way for the UE to acknowledge the
network-provided Routing Rules during the addition of an access. Instead,
Routing Rules need to be provided from the network using a separate IP flow
mobility procedure.
Step 8: In UE-initiated NBIFOM mode, if the UE provided Routing Rules to the
network when adding trusted WLAN access to the PDN Connection, the PDN GW
executes appropriate 3GPP resource release procedures for the resources
associated with the flows that were moved away from the 3GPP source access,
based on the routing rules provided by the UE, as specified in TS 23.402 [2].
### 6.2.4 Addition of an access using S2b
#### 6.2.4.1 Addition of Untrusted WLAN access
This procedure is used to add untrusted WLAN access to an existing PDN
Connection.
Figure 6.2.4.1-1: Addition of WLAN access to the PDN connection
Figure 6.2.4.1-1 shows the particular case when the UE is first connected to a
3GPP access and then it requests addition of a WLAN access.
It is assumed that the UE has successfully attached to 3GPP access and
established a PDN connection over 3GPP access using GTP as described in clause
6.1.1 and that the UE has received from the network an indication that NBIFOM
is supported for this PDN connection.
Subsequently the UE performs the untrusted WLAN attachment, and requests to
establish a PDN connection using the same APN, and attempts to use both
accesses for the same PDN connection simultaneously.
1\. The UE discovers a WLAN and performs the authentication and authorization
procedure with 3GPP EPC via the WLAN access as specified in TS 23.402 [2]
clause 7.2.1 step 1.
2\. IKEv2 authentication and tunnel setup procedure are performed via the WLAN
access between the UE, ePDG and 3GPP AAA Server/HSS as specified in TS 33.402
[6]. For IP address preservation, the UE includes the same address (IPv4
address or IPv6 prefix/address or both) that was allocated during its
attachment to 3GPP access. A new access can be added to a multi-access PDN
connection without an associated routing rule.
If UE-initiated NBIFOM mode was selected at initial PDN Connection
establishment, the UE may include Routing Rules in this step, as well as an
indication for default access for the PDN Connection.
3\. Since the handover indication is included, the TWAN selects the same PDN
GW as is already allocated for the PDN Connection. The ePDG includes an NBIFOM
indication in the Create Session Request message to the PDN GW. The ePDG also
includes Routing Rules(s) and the indication for default access if provided by
the UE in step 2.
4\. When the PDN GW receives the Create Session Request with NBIFOM
indication, the PDN GW does not remove the bearers over 3GPP access for the
corresponding PDN connection. The same IP address is allocated for the PDN
connection as the one used in 3GPP access network. If dynamic PCC is applied,
the PDN GW initiates the IP-CAN Session Modification Procedure with the PCRF.
The PDN GW indicates to the PCRF the addition of an access for the PDN
connection and informs the PCRF about the additional RAT type. The PCRF may
reject the addition of the access if the multi-access IP-CAN session would
correspond to an invalid combination of IP-CAN and RAT Types or is not allowed
by the subscription.
If routing rules were received, the PDN GW provides the PCRF with notification
of the UE requested IP flow mapping to an Access Type. The PCRF may accept or
reject the routing rules. . If network-initiated NBIFOM mode was selected at
initial PDN Connection establishment, the PCRF shall indicate the default
access for the PDN Connection to the PDN GW.
If UE-initiated NBIFOM mode was selected at initial PDN Connection
establishment, the UE indicates the default access to the PCRF via PDN GW
during this procedure. The PCRF takes a final decision on the default access
based on the subscription, and indicate the default access for the PDN
Connection to the PDN GW. The default access replied by the network may be
different than the default access requested by the UE.
5\. The PDN GW sends a Create Session Response message to the ePDG that
includes the routing rules. The PDN GW generates a Charging Id for the Default
Bearer and includes the Charging Ids for the PDN Connection and the Default
Bearer in the Create Session Response to the ePDG. The PDN GW also indicates
the default access for the PDN Connection to the ePDG.
6\. The ePDG indicates to the UE that the authentication and authorization
with the external AAA server is successful.
7\. If routing rules were included in step 2 above, the ePDG notifies the UE
whether the routing rules were accepted or rejected. In network-initiated
NBIFOM procedure, the network does not provide any routing rules to the UE
during this procedure. The ePDG indicates the default access to the UE as part
of the IKEv2 signalling.
8\. IP connectivity from the UE to the PDN GW is now setup. Any packet in the
uplink direction complying with the routing rules is tunnelled to the ePDG by
the UE using the IPSec tunnel. The ePDG then tunnels the packet to the PDN GW.
From the PDN GW normal IP-based routing takes place. In the downlink
direction, the packet for UE arrives at the PDN GW. The PDN GW tunnels the
packet to the ePDG based on the routing rules. The ePDG then tunnels the
packet to the UE via the IPsec tunnel.
9\. If routing rules were included in step 2 above, the appropriate 3GPP
resource release procedures are executed for the resources associated with the
flows that were moved onto the WLAN access as specified in TS 23.402 [2].
## 6.3 IP flow mobility within a PDN connection
### 6.3.1 General
### 6.3.2 Network-initiated IP flow mobility
#### 6.3.2.1 Routing Rules signalled via 3GPP access
In the case of network-initiated NBIFOM mode, the following procedures are
applicable for S2a-SCM, S2a-MCM or S2b when target network is 3GPP access.
In the following signalling flow, the PDN GW moves one or more IP flow(s) by
providing a Routing Rule with access type 3GPP. The routing rule is sent via
E-UTRAN in this case.
Figure 6.3.2.1-1: Network-initiated IP flow mobility within a PDN connection
via E-UTRAN using GTP
1\. The UE is connected simultaneously to 3GPP and Trusted/Untrusted WLAN
access.
2\. When dynamic PCC is applied for the PDN connection, the H-PCRF determines
based on policy information and current UE state that session modification
should be initiated to move specific flows. The PCRF provides PCC Rules with
access type information to the PDN GW during an IP-CAN session modification
procedure. The PDN GW determines that new Routing Rules / Modified Routing
Rules need to be sent to the UE based on the received PCC Rules.
When dynamic PCC is not applied, the PDN GW may determine based on local
policies that new Routing Rules / Modified Routing Rules need to be sent to
the UE.
3\. The PDN GW sends the Created /Modified Routing Rules within
Create/Update/Delete Bearer Request to the Serving GW. If bearer resources
need to be established or modified due to the PCC rules received in step 2,
the bearer operations may be performed in this step
4\. The bearer modification,dedicated bearer activation or dedicated bearer
deactivation procedure between the MME and the UE is performed as described in
TS 23.401 [4]. The UE may accept or reject the Routing Rules. When the UE
rejects the Routing Rules, the UE provides a cause value indicating why the
request was rejected. This cause value may be used by the network to determine
when/if this IP flow mobility operation can be requested again. The UE applies
the accepted routing rules and acknowledges the applied rules in the message
sent to the MME.
5\. The MME sends Create/Update/Delete Bearer Response indicating the accepted
Routing Rules to the PDN GW via the Serving GW.
6\. The PDN GW indicates to the PCRF whether the PCC Rule could be enforced or
not. This corresponds to the completion of the PCEF-initiated IP‑CAN session
modification procedure as defined in TS 23.203 [3], proceeding after the
completion of IP‑CAN bearer signalling.
7\. Appropriate S2a/S2b resource release/modification procedures are executed
for the resources associated with the flows that were removed from the Trusted
or Untrusted WLAN access as described in TS 23.402 [2]. For S2a-SCM, dedicated
bearer over S2a is not supported when IP flow mobility is used.
Figure 6.3.2.1-2: Network-initiated IP flow mobility within a PDN connection
via GERAN/UTRAN using GTP
1\. The UE is connected simultaneously to GERAN/UTRAN and Trusted/Untrusted
WLAN access.
2\. When dynamic PCC is applied for the PDN connection, the H-PCRF determines
based on policy information and current UE state that session modification
should be initiated to move specific flows. The PCRF provides PCC Rules with
access type information to the PDN GW during an IP-CAN session modification
procedure. The PDN GW determines that new Routing Rules / Modified Routing
Rules need to be sent to the UE based on the received PCC Rules.
When dynamic PCC is not applied, the PDN GW may determine based on local
policies that new Routing Rules / Modified Routing Rules need to be sent to
the UE.
3\. The PDN GW sends the Created /Modified Routing Rules within
Create/Update/Delete Bearer Request to the Serving GW/SGSN. If bearer
resources need to be established or modified due to the PCC rules received in
step 2, the bearer operations may be performed in this step.
4\. The dedicated bearer activation or bearer modification or dedicated bearer
deactivation procedure between the MME and the UE is performed as described in
TS 23.060 [5]. The UE may accept or reject the Routing Rules. When the UE
rejects the Routing Rules, the UE provides a cause value indicating why the
request was rejected. This cause value may be used by the network to determine
when/if this IP flow mobility operation can be requested again. The UE applies
the accepted routing rules and acknowledges the applied rules in the message
sent to the SGSN.
5\. The SGSN sends Create/Update/Delete Bearer Response indicating the
accepted Routing Rules to the PDN GW via the Serving GW.
6\. The PDN GW indicates to the PCRF whether the PCC Rule could be enforced or
not. This corresponds to the completion of the PCEF-initiated IP‑CAN session
modification procedure as defined in TS 23.203 [3], proceeding after the
completion of IP‑CAN bearer signalling.
7\. Appropriate S2a/S2b resource release/modification procedures are executed
for the resources associated with the flows that were removed from the Trusted
or Untrusted WLAN access as described in TS 23.402 [2]. For S2a-SCM, dedicated
bearer over S2a is not supported when IP flow mobility is used.
#### 6.3.2.2 Routing Rules signalled via Trusted WLAN access
##### 6.3.2.2.1 Single-connection mode
In single-connection mode, the PDN GW sends the routing rules over 3GPP access
independent of access type, as described in clause 6.3.2.1.
##### 6.3.2.2.2 Multi-connection mode
In the following signalling flow, the PDN GW provides new or updated Routing
Rule(s) with access type WLAN via GTP and WLCP procedures. The routing rule is
sent via TWAN access in this case. This may result in that IP flows routed
over 3GPP access are now routed over WLAN, or vice versa.
Figure 6.3.2.2.2-1: Network-initiated IP flow mobility within a PDN connection
over TWAN access using GTP
1\. The PDN Connection is active simultaneously over 3GPP access and TWAN
access.
2\. If dynamic PCC is applied for the PDN Connection the PCRF determines based
on policy information and current UE state that session modification should be
initiated to move specific flows. The PCRF provides PCC Rules with access type
information to the PDN GW during an IP-CAN session modification procedure. The
PDN GW determines that new Routing Rules / Modified Routing Rules need to be
sent to the UE based on the received PCC Rules.
If dynamic PCC is not applied the PDN GW may determine based on local policies
that new Routing Rules / Modified Routing Rules need to be sent to the UE.
3\. The PDN GW sends the new or updated Routing Rules within
Create/Update/Delete Bearer Request to the TWAN. If bearer resources need to
be established or modified due to the PCC rules received in step 2, the bearer
operations may be performed in this step.
4\. The TWAN sends a WLCP PDN Connection Modification Request message to the
UE, including the Routing Rules.
5\. The UE may decide to accept or reject the Routing Rules. When the UE
rejects the Routing Rules the UE provides a cause value indicating why the
request was rejected. This cause value may be used by the network to determine
when/if this IP flow mobility operation can be requested again. The UE applies
the accepted routing rules and acknowledges the applied rules in a WLCP PDN
Connection Modification Response message to the TWAN.
6\. The TWAN sends Create/Update/Delete Bearer Response to the PDN GW.
7\. The PDN GW indicates to the PCRF whether the PCC Rules could be enforced
or not. This corresponds to the completion of the PCEF-initiated IP‑CAN
session modification procedure as defined in TS 23.203 [3].
8\. Appropriate 3GPP resource release/modification procedures are executed as
described in TS 23.401 [4] for the resources (bearers) associated with the
Routing Rules that were removed from 3GPP access.
#### 6.3.2.3 Routing Rules signalled via Untrusted WLAN access
In the following signalling flow, the PCRF identifies and moves specific flows
from 3GPP to WLAN.
Figure 6.3.2.3-1: IP flow mobility within a PDN connection with negotiation
via untrusted WLAN access
1\. The UE is connected simultaneously to 3GPP and WLAN accesses and
establishes multiple IP flows of the same PDN connection.
2\. If dynamic PCC is applied for the PDN Connection, the PCRF determines
based on policy information and current UE state that session modification
should be initiated to move specific flows. The PCRF provides PCC Rules with
access type information to the PDN GW during an IP-CAN session modification
procedure.
3\. The PDN GW determines that new or modified Routing Rules need to be sent
to the UE based on the received PCC Rules. The PDN GW sends the new or updated
Routing Rules within Create/Update/Delete Bearer Request to the TWAN. If
bearer resources need to be established or modified due to the PCC rules
received in step 2, the bearer operations may be performed in this step.
4\. The ePDG initiates an IKEv2 INFORMATIONAL request, which includes the
modified routing rule to indicate the updated routing rule to be used by the
UE. The UE may accept or reject the Routing Rules. When the UE rejects the
Routing Rules the UE provides a cause value indicating why the request was
rejected. This cause value may be used by the network to determine when/if
this IP flow mobility operation can be requested again.
5\. The UE responds with a IKEv2 INFORMATIONAL response, acknowledging the new
routing rules and applies the corresponding filters
6\. The ePDG sends a Create/Update/Delete Bearer Response to the PDN GW.
7\. The WLAN access specific resource release, setup or modification may be
performed based on the modified traffic selector in WLAN access network.
8\. The PDN GW indicates to the PCRF whether the Routing Rules could be
enforced or not.
9\. Appropriate 3GPP resource release/modification procedures are executed for
the resources associated with the new or updated PCC rules.
### 6.3.3 UE-initiated IP flow mobility
#### 6.3.3.1 Routing Rules signalled via 3GPP access
In the following signalling flows, they are applied to UE-initiated NBIFOM
mode. The UE moves one or more IP flow(s) by providing a Routing Rule with
access type 3GPP to update the routing rules via NAS and GTPv2 procedures. The
routing rule is sent via E-UTRAN in this case.
Figure 6.3.3.1-1: UE-initiated IP flow mobility within a PDN connection via
E-UTRAN using GTP
1\. The UE is connected simultaneously to 3GPP and WLAN accesses and
establishes multiple IP flows of the same PDN connection.
2\. The UE sends to the MME a Request Bearer Resource Modification message,
which includes the Routing Rules requested by the UE.
4-5. The MME forwards the Routing Rules to the PDN GW via the Serving GW.
6\. When dynamic PCC is applied for the PDN connection, the PDN GW initiates
an IP-CAN Modification procedure and provides the Routing Rules in a
notification to the PCRF. The PCRF may reject the IP flow mobility requests
from UE due to subscription limitations. When the network rejects an IP flow
mobility request, the network provides a certain cause value to the UE
indicating why the request was rejected. This cause value may be used by the
UE to determine when/if this IP flow mobility operation can be requested
again.
7\. The PDN GW performs the dedicated Bearer activation procedure or bearer
modification procedure as described in TS 23.401 [4], and indicates which the
Routing Rule has been accepted.
8\. Appropriate S2a/S2b resource release / modification procedures are
executed for the resources associated with the flows that were removed from
the Trusted or Un-trusted WLAN access as described in TS 23.402 [2]. For
S2a-SCM, dedicated bearer over S2a is not supported when IP flow mobility is
used.
In the following signalling flows, they are applied to UE-initiated NBIFOM
mode. The UE moves one or more IP flow(s) by providing a Routing Rule with
access type 3GPP to update the routing rules via PDP context and GTPv2
procedures. The routing rule is sent via GERAN/UTRAN in this case.
Figure 6.3.3.1-2: UE-initiated IP flow mobility within a PDN connection via
GERAN/UTRAN using GTP
This procedure is similar to 6.3.3.1-1 with the following differences:
2-3. The UE sends to the SGSN a Modify PDP Context Request message, which
includes the Routing Rules requested by the UE.
7\. The PDN GW performs the Secondary PDP context activation or PDP context
modification procedure as described in TS 23.060 [5], and indicates the
Routing Rule has been accepted.
#### 6.3.3.2 Routing Rules signalled via Trusted WLAN access
##### 6.3.3.2.1 Single-connection mode
In single-connection mode, the UE sends the routing rules over 3GPP access as
described in clause 6.3.3.1.
##### 6.3.3.2.2 Multi-connection mode
In the following signalling flow, the UE provides new or updated routing rules
with access type WLAN to the PDN GW via WLCP and GTPv2 procedures. The routing
rule is sent via TWAN access in this case.
Figure 6.3.3.2.2-1: UE-initiated IP flow mobility within a PDN connection from
3GPP access to TWAN access using GTP
1\. The PDN Connection is active simultaneously over 3GPP access and WLAN
accesses.
2\. The UE sends a WLCP PDN Modification Command message to the TWAN, which
includes the Routing Rules requested by the UE.
3\. The TWAN sends a Bearer Resource Command message to the PDN GW. The
message includes the Routing Rules.
4\. The PDN GW initiates the IP-CAN Session Modification Procedure with the
PCRF. In this request, the PDN GW provides the Routing Rules to the PCRF. The
PCRF analyses the received Routing Rules, makes a policy decision and provides
new or updated PCC rules to the PDN GW with corresponding access type
information. The PCRF may reject the IP flow mobility requests from UE. When
the network rejects an IP flow mobility request, the network provides a cause
value to the UE indicating why the request was rejected. The UE should be able
to determine, based on the cause value provided with the rejection, how to
handle the flow mapping, e.g. whether or not the request may be retried at a
later stage.
5\. The PDN GW sends to the TWAN an Update/Create Bearer Request which
acknowledge of the Routing Rules. If bearer resources need to be established
or modified due to the PCC rules received in step 4, the bearer operations may
be performed in this step.
5a. The TWAN sends a WLCP PDN Connection Modification Request to the UE which
acknowledge of the Routing Rules.
6 The UE sends a WLCP PDN Connection Modification Response to the TWAN.
7\. The TWAN sends an Update/Create Bearer Response to the PDN GW.
8\. A TWAN specific resource allocation/modification procedure may be executed
in this step. The details of this step are out of the scope of 3GPP.
9\. Appropriate 3GPP resource release / modification procedures are executed
for the resources associated with the flows that were removed in the 3GPP
access as described in TS 23.401 [4].
#### 6.3.3.3 Routing Rules signalled via Untrusted WLAN access
The UE can move one or more IP flow(s) from the 3GPP access to the WLAN
access. The UE should update the routing rules via the WLAN access.
Figure 6.3.3.3-1: IP flow mobility within a PDN connection initiated over WLAN
access
1\. The UE is connected simultaneously to 3GPP and WLAN accesses and
establishes multiple IP flows of the same PDN connection as described in
clauses 6.2.
2\. The UE sends the IKEv2 INFORMATIONAL request to the ePDG, which includes
the updated routing rules requested by the UE.
2a. The ePDG sends an IKEv2 INFORMATIONAL Response message to the UE.
3\. The ePDG sends a Bearer Resource Command message to the PDN GW. The
message includes the updated routing rules. The ePDG includes the default EPS
bearer ID (i.e. Linked Bearer ID) based on the mapping between the Security
Association and the PDN connection. The ePDG sends the updated routing rules
to the PDN GW.
4\. The PDN GW initiates the IP-CAN Session Modification Procedure with the
PCRF. In this request, the PDN GW provides the updated routing rules to the
PCRF. The PCRF may reject the IP flow mobility requests from UE. When the
network rejects an IP flow mobility request, the network provides a certain
cause value to the UE indicating why the request was rejected. The UE should
be able to determine, based on the cause value provided with the rejection,
how to handle the flow mapping, e.g. whether or not the request may be retried
at a later stage.
5\. The PDN GW sends an Update/Create Bearer Request message to the ePDG which
includes the accepted routing rules.
5a. The ePDG sends an IKEv2 INFORMATIONAL Request message to the UE which
includes the accepted routing rules.
6\. The UE sends the IKEv2INFORMATIONAL response to the ePDG.
7\. The ePDG sends an Update/Create Bearer Response message to the PDN GW.
8\. Appropriate 3GPP resource release/modification procedures are executed for
the resources associated with the flows that were modified or removed in the
3GPP access.
9\. The PDN GW indicates to the PCRF whether the PCC decision could be
enforced or not.
## 6.4 NBIFOM IP Flow Mapping
### 6.4.1 UE Requested IP Flow Mapping via 3GPP access
This procedure is only used in Network-initiated NBIFOM mode when the UE wants
to request the network to apply specific mappings of IP flows to 3GPP access.
The network provides Routing Rules to the UE for this IP flow unless the
request from the UE is not allowed by the subscription.
Figure 6.4.1-1: UE requested IP flow mapping via E-UTRAN
This procedure is similar to 6.3.3.1-1 with the following differences:
Step 2-5: The UE sends a Request Bearer Resource Modification message to the
network, which includes the mapping information of an IP flow to 3GPP access.
Step 6: When dynamic PCC is applied for the PDN connection, the PDN GW
initiates an IP-CAN Modification procedure and provides the Routing Rule(s)
for this IP flow according to the mapping information in a notification to the
PCRF. The PCRF may reject the IP flow mapping request from UE. When the
network rejects an IP flow mapping request, the network provides a certain
cause value to the UE indicating why the request was rejected. This cause
value may be used by the UE to determine when/if this IP flow mapping can be
requested again.
The PDN GW sends corresponding Routing rule(s) to the UE in Bearer
Modification response.
Figure 6.4.1-2: UE requested IP flow mapping via GERAN/UTRAN access
This procedure is similar to 6.3.3.1-2 with the following differences:
Step 2-5: The UE sends a Modify PDP Context Request message to the network,
which includes the mapping information of an IP flow to 3GPP access.
Step 5: When dynamic PCC is applied for the PDN connection, the PDN GW
initiates an IP-CAN Modification procedure and provides the Routing Rule(s)
for this IP flow according to the mapping information in a notification to the
PCRF. The PCRF may reject the IP flow mapping request from UE. When the
network rejects an IP flow mapping request, the network provides a certain
cause value to the UE indicating why the request was rejected. This cause
value may be used by the UE to determine when/if this IP flow mapping can be
requested again.
Step 6. The PDN GW initiates the Secondary PDP context activation or EPS
Bearer modification procedure as described in TS 23.060 [5], and including the
Routing Rule(s).
When the SGSN receives Create Bearer Request or Update Bearer Request message
from the SGW, the SGSN sends Request Secondary PDP Context Activation or
Modify PDP Context Request to the UE as described in TS 23.060 [5], including
the Routing Rules received from the SGW. The SGSN also sends a Modify PDP
Context Accept message to the UE in order to stop the timer which is set after
Step 2.
The UE may accept or reject the Routing Rules. When the UE rejects the Routing
Rules, the UE provides a cause value indicating why the request was rejected.
The UE applies the accepted routing rules and acknowledges the applied rules
in Activate Secondary PDP Context Request or Modify PDP Context Accept
message.
The PDN GW sends corresponding Routing rule(s) to the UE in Bearer
Modification response.
### 6.4.2 UE Requested IP Flow Mapping via Trusted WLAN access
#### 6.4.2.1 Single-connection mode
In single-connection mode, the UE sends the request for IP flow mapping over
3GPP access as described in clause 6.4.1.
#### 6.4.2.2 Multi-connection mode
This procedure is only used in NW-initiated NBIFOM mode when the UE wants to
request the NW to apply a specific mapping of an IP flow to TWAN access. The
NW provides Routing Rules to the UE for this IP flow.
Figure 6.4.2.2-1: UE Requested IP Flow Mapping via Trusted WLAN access using
GTP
1\. The PDN Connection is active simultaneously over 3GPP access and WLAN
accesses.
2\. The UE sends a WLCP PDN Modification Command message to the TWAN, which
includes the IP Flow mapping information requested by the UE.
3\. The TWAN sends a Bearer Resource Command message to the PDN GW. The
message includes the requested IP Flow mapping information.
4\. The PDN GW initiates the IP-CAN Session Modification Procedure with the
PCRF. In this request, the PDN GW provides the requested IP Flow mapping
information to the PCRF. The PCRF analyses the received Routing Rules, makes a
policy decision and provides new or updated PCC rules to the PDN GW with
corresponding access type information. The PCRF may reject the requests from
UE. When the network rejects a request, the network provides a cause value to
the UE indicating why the request was rejected. The UE should be able to
determine, based on the cause value provided with the rejection, how to handle
the flow mapping, e.g. whether or not the request may be retried at a later
stage.
5\. The PDN GW decides to update the Routing Rules based on the received PCC
Rules. This step is the same as steps 3-8 in Figure 6.3.2.2.2-1.
### 6.4.3 UE Requested IP Flow Mapping via Untrusted WLAN access
This procedure is only used in network-initiated mode when the UE wants to
request the network to apply a specific mapping of an IP flow to untrusted
WLAN access. The network provides Routing Rules to the UE for this IP flow.
Figure 6.4.3-1: UE Requested IP Flow Mapping via untrusted WLAN access using
GTP
1\. The PDN Connection is active simultaneously over 3GPP access and WLAN
accesses.
2\. The UE sends an IKEv2 INFORMATIONAL Request message to the ePDG, which
includes the IP Flow mapping information requested by the UE.
2a. The ePDG sends an IKEv2 INFORMATIONAL Response message to the UE.
3\. The ePDG sends a Bearer Resource Command message to the PDN GW. The
message includes the requested IP Flow mapping information.
4\. The PDN GW initiates the IP-CAN Session Modification Procedure with the
PCRF. In this request, the PDN GW provides the requested IP Flow mapping
information to the PCRF. The PCRF analyses the received Routing Rules, makes a
policy decision and provides new or updated PCC rules to the PDN GW with
corresponding access type information. The PCRF may reject the requests from
UE. When the network rejects a request, the network provides a cause value to
the UE indicating why the request was rejected. The UE should be able to
determine, based on the cause value provided with the rejection, how to handle
the flow mapping, e.g. whether or not the request may be retried at a later
stage.
5\. The PDN GW decides to update the Routing Rules based on the received PCC
Rules. This step is the same as steps 3-9 in Figure 6.3.2.3-1.
## 6.5 Removal of an access from a PDN connection
### 6.5.1 Removal of 3GPP access
#### 6.5.1.1 UE-initiated removal of 3GPP access from the PDN connection
In the case of E-UTRAN, when the UE removes the 3GPP access for the multi-
access PDN connection and the multiple-access PDN connection is not the last
PDN connection for 3GPP access, procedures as described in TS 23.401 [4]
clause 5.10.3 are referred with the following modifications.
Figure 6.5.1.1-1: UE-Initiated Removal of 3GPP access via E-UTRAN
Step 5: PDN GW shall indicate to the PCRF the removal of 3GPP access for the
multi-access PDN connection via IP-CAN Session Modification procedure, if
dynamic PCC is applied for the PDN connection.
In the case of E-UTRAN, when the UE removes the 3GPP access for the multi-
access PDN connection and the multiple-access PDN connection is the last PDN
connection for 3GPP access, procedures as described in TS 23.401 [4] clause
5.3.8.2.1 are referred with the following modifications.
Figure 6.5.1.1-2: UE-Initiated Removal of 3GPP access via E-UTRAN for last PDN
connection
Step 8: PDN GW shall indicate to the PCRF the removal of 3GPP access for the
multi-access PDN connection via IP-CAN Session Modification procedure, if
dynamic PCC is applied for the PDN connection.
In the case of GERAN/UTRAN, when the UE removes the 3GPP access for the multi-
access PDN connection, procedures as described in TS 23.060 [5] clause 9.2.4
are referred with the following modifications.
Figure 6.5.1.1-3: UE-Initiated Removal of 3GPP access via GERAN/UTRAN
Step-5: PDN GW shall indicate to the PCRF the removal of 3GPP access for the
multi-access PDN connection via IP-CAN Session Modification procedure, if
dynamic PCC is applied for the PDN connection.
#### 6.5.1.2 Network-initiated removal of 3GPP access from the PDN connection
In the case of E-UTRAN, when the network removes the 3GPP access for the
multi-access PDN connection, the following procedures are referred.
Figure 6.5.1.2-1: Network initiated removal of 3GPP access via E-UTRAN from
the PDN connection
1\. The PCRF shall indicate to the P-GW the removal of 3GPP access for the
multi-access PDN connection via IP-CAN Session Modification procedure by
updating or removing all PCC rules that are bound to this access.
2-9. The description of these steps is the same as for steps 2-9 in TS 23.401
[4], clause 5.4.4.1. The P-GW deactivates the default bearer of this access.
10\. The P-GW shall indicate to the PCRF the 3GPP access is removed from the
multi-access PDN connection.
11\. The description of these steps is the same as for steps 11 in TS 23.401
[4], clause 5.4.4.1.
The optional interaction steps between the PDN GW and the PCRF in the
procedures only occur if dynamic PCC is applied for the PDN connection.
In the case of GERAN/UTRAN, when the network removes the 3GPP access for the
multi-access PDN connection, the following procedures are referred.
Figure 6.5.1.2-2: Network initiated Removal of 3GPP access via GERAN/UTRAN
1\. The PCRF shall indicate to the P-GW the removal of 3GPP access for the
multi-access PDN connection via IP-CAN Session Modification procedure by
updating or removing all PCC rules that are bound to this access.
2-3. The description of these steps is the same as for steps A-B in TS 23.060
[5], clause 9.2.4.3A.
4-5. The description of these steps is the same as for steps 2 in TS 23.060
[5], clause 9.2.4.3.
6-7. The description of these steps is the same as for steps A-B in TS 23.060
[5], clause 9.2.4.3B.
8\. The description of these steps is the same as for steps 4-5 in TS 23.060
[5], clause 9.2.4.3.
9\. The P-GW shall indicate to the PCRF the 3GPP access is removed from the
multi-access PDN connection.
The optional interaction steps between the PDN GW and the PCRF in the
procedures only occur if dynamic PCC is applied for the PDN connection.
### 6.5.2 Removal of Trusted WLAN access
#### 6.5.2.1 UE-initiated removal of Trusted WLAN access from a PDN connection
When the UE removes the TWAN access for the multi-access PDN connection in
single-connection mode, procedures as described in TS 23.402 [2] clause
16.3.1.1 are referred with the following modification.
Figure 6.5.2.1-1: UE-initiated Removal of Trusted WLAN access from the PDN
connection for single-connection mode
Step 4: PDN GW shall indicate to the PCRF the removal of TWAN access for the
multi-access PDN connection via IP-CAN Session Modification procedures, if
dynamic PCC is applied for the PDN connection.
When the UE removes the TWAN access for the multi-access PDN connection for
multi-connection mode and the multi-access PDN connection is not the last PDN
connection in TWAN, procedures as described in TS 23.402 [2] clause 16.9.1 are
referred with the following modification.
Figure 6.5.2.1-2: UE-initiated Removal of Trusted WLAN access from the PDN
connection for multi-connection mode
Step 4: PDN GW shall indicate to the PCRF the removal of TWAN access for the
multi-access PDN connection via IP-CAN Session Modification procedures, if
dynamic PCC is applied for the PDN connection.
When the UE removes the TWAN access for the multi-access PDN connection for
multi-connectoin mode and the multi-access PDN connection is not the last PDN
connection in TWAN, procedures as described in TS 23.402 [2] clause 16.7.1.1
are referred with the following modification.
Figure 6.5.2.1-3: UE-initiated Removal of Trusted WLAN access from the last
PDN connection for multi-connection mode
Step 4: PDN GW shall indicate to the PCRF the removal of TWAN access for the
multi-access PDN connection via IP-CAN Session Modification procedures, if
dynamic PCC is applied for the PDN connection.
#### 6.5.2.2 Network-initiated removal of Trusted WLAN access from a PDN
connection
When the network removes the TWAN access for the multi-access PDN connection,
the following procedures shall be applied.
Figure 6.5.2.2-2: Network-initiated Removal of Trusted WLAN access from the
PDN connection
1\. The PCRF shall indicate to the P-GW the removal of WLAN access for the
multi-access PDN connection via IP-CAN Session Modification procedure by
updating or removing all PCC rules that are bound to this access.
2-7. The description of these steps is the same as for steps 2-7 in TS 23.402
[2], clause 16.4.1. The P-GW deactivates the default bearer of this access.
8\. The P-GW shall indicate to the PCRF the WLAN access is removed from the
multi-access PDN connection.
The optional interaction steps between the PDN GW and the PCRF in the
procedures only occur if dynamic PCC is applied for the PDN connection.
### 6.5.3 Removal of Untrusted WLAN access
#### 6.5.3.1 UE-initiated removal of Untrusted WLAN access from the PDN
connection
When the UE remove from the WLAN access for the multi-access PDN connection,
the following procedures shall be applied.
Figure 6.5.3.1-1: UE-initiated Removal of Untrusted WLAN access from the PDN
connection
1\. The description of these steps is the same as for steps 1 in TS 23.402
[2], clause 7.4.1.1.
2-3. The description of these steps is the same as for steps A.1-A.2 in TS
23.402 [2], clause 7.4.3.1.
4\. The P-GW indicates to the PCRF the WLAN access is removed from the multi-
access PDN connection, if dynamic PCC is applied for the PDN connection.
5\. The description of these steps is the same as for steps A.3 in TS 23.402
[2], clause 7.4.3.1.
6\. The description of these steps is the same as for steps 6 in TS 23.402
[2], clause 7.4.1.1.
#### 6.5.3.2 Network-initiated removal of Untrusted WLAN access from a PDN
Connection
When the Network removes the Untrusted WLAN access for the multi-access PDN
connection, the following procedures shall be applied.
Figure 6.5.3.2-1: Network-initiated Removal of Untrusted WLAN access from the
PDN connection
1\. The PCRF shall indicate to the P-GW the removal of WLAN access for the
multi-access PDN connection via IP-CAN Session Modification procedure by
updating or removing all PCC rules that are bound to this access.
2-5. The description of these steps is the same as for steps 2-5 in TS 23.402
[2], clause 7.9.2. The P-GW deactivates the default bearer of this access.
6\. The P-GW shall indicate to the PCRF the WLAN access is removed from the
multi-access PDN connection.
The optional interaction steps between the PDN GW and the PCRF in the
procedures only occur if dynamic PCC is applied for the PDN connection.
## 6.6 Access becomes Unusable and Usable
### 6.6.1 An access of a PDN connection becomes unusable
#### 6.6.1.1 3GPP access of the PDN connection becomes unusable in Trusted
WLAN access
When the UE detects that the 3GPP access becomes unusable, the UE shall report
this event to the network via WLAN access. The 3GPP access unusable procedure
is used when the UE determines that the 3GPP access is not usable anymore for
carrying the IP flows. The UE determines that the 3GPP link is not usable when
it detects loss of 3GPP coverage, or 3GPP radio quality preventing the usage
of this access based on UE implementation mechanism. This procedure is applied
in Network-initiated NBIFOM mode.
Figure 6.6.1.1-1: Procedure for 3GPP access becomes unusable for GTP S2a
1\. The UE is connected simultaneously to 3GPP and TWAN accesses and
establishes multiple IP flows of the same PDN connection.
2\. The UE detects that the 3GPP link is not usable.
3\. The UE sends the WLCP Modification Command message including a 3GPP
unusable indication.
4\. The TWAN sends the indication to the PDN GW within a Bearer Resource
Command.
5\. When the PCRF has subscribed to such notification, the PDN GW sends the
indication to the PCRF.
The PCRF may update the PCC rules, e.g. by changing the Routing Access Type of
PCC Rules and provide the updated PCC rules to the PDN GW. The PCRF does not
provide updated PCC rules for those IP flows which are forbidden to be routed
in the WLAN access.
6\. The PDN GW moves all the IP flows from 3GPP to WLAN except those IP flows
which are forbidden to be routed via WLAN.
The PDN GW provides updated Routing Rules to the UE based on the updated PCC
rules received from PCRF.
The PDN GW may initiate dedicated bearer activation and/or modification
procedure in WLAN according to if the IP flow shall be transported to new
dedicated bearer or to existing bearer. The PDN GW may release the resource in
the 3GPP access network for the IP flows which are moved to WLAN but does not
release the access from the multi-access PDN connection. Steps 3 to 8 as per
Figure 6.3.2.2.2-1 will be invoked.
#### 6.6.1.2 3GPP access of the PDN connection becomes unusable in Untrusted
WLAN access
When the UE detects that the 3GPP access becomes unusable, the UE shall report
this event to the network via WLAN access. The 3GPP access unusable procedure
is used when the UE determines that the 3GPP access is not usable anymore for
carrying the IP flows. The UE determines that the 3GPP link is not usable when
it detects loss of 3GPP coverage, or 3GPP radio quality preventing the usage
of this access based on UE implementation mechanism. This procedure is applied
in Network-initiated NBIFOM mode.
Figure 6.6.1.2-1: Procedure for 3GPP access becomes unusable for GTP S2b
1\. The UE is connected simultaneously to 3GPP and untrusted WLAN accesses and
establishes multiple IP flows of the same PDN connection.
2\. The UE detects that the 3GPP link is not usable.
3\. The UE sends the IKEv2 INFORMATIONAL Request message including a 3GPP
unusable indication.
3a. The ePDG sends an IKEv2 INFORMATIONAL Response message to the UE.
4\. The ePDG sends the indication to the PDN GW within a Bearer Resource
Command.
5\. When the PCRF has subscribed to such notification, the PDN GW sends the
indication to the PCRF..
The PCRF may update the PCC rules, e.g. by changing the Routing Access Type of
PCC Rules and provide the updated PCC rules to the PDN GW. The PCRF does not
provide updated PCC rules for those IP flows which are forbidden to be routed
in the WLAN access.
6\. The PDN GW moves all the IP flows from 3GPP to WLAN except those IP flows
which are forbidden to be routed via WLAN.
The PDN GW provides updated Routing Rules to the UE based on the updated PCC
rules received from PCRF.
The PDN GW may initiate dedicated bearer activation and/or modification
procedure in WLAN according to if the IP flow shall be transported to new
dedicated bearer or to existing bearer. The PDN GW may release the resource in
the 3GPP access network for the IP flows which are moved to WLAN but does not
release the access from the multi-access PDN connection. Step 3 to 9 as per
Figure 6.3.2.3-1 will be invoked.
#### 6.6.1.3 Trusted WLAN access becomes unusable
When the UE detects the TWAN access unusable, the UE shall report this event
to the network via 3GPP access. The TWAN access unusable procedure is used
when the UE determines that the TWAN access is not usable anymore for carrying
the IP flows. The UE determines that the TWAN link is not usable when it
detects loss of TWAN coverage, or TWAN radio quality preventing the usage of
this access based on UE implementation mechanism. This procedure is applied in
Network-initiated NBIFOM mode.
Figure 6.6.1.3-1: Procedure for Trusted WLAN becomes unusable access for GTP
S5/S8
1\. The UE is connected simultaneously to 3GPP and WLAN accesses and
establishes multiple IP flows of the same PDN connection.
2\. The UE detects that the WLAN link is not usable.
3\. The UE sends the Request Bearer Resource Modification message including a
WLAN unusable indication.
4-5. The MME sends the indication to the PDN GW via the SGW within a Bearer
Resource Command.
6\. When the PCRF has subscribed to such notification, the PDN GW sends the
indication to the PCRF. The PCRF may generate new Routing Rules later and
should not generate Routing Rules for WLAN.
The PCRF may update the PCC rules, e.g. by changing the Routing Access Type of
PCC Rules and provide the updated PCC rules to the PDN GW. The PCRF does not
provide updated PCC rules for those IP flows which are forbidden to be routed
in the 3GPP access.
7\. The PDN GW moves all the IP flows from WLAN to 3GPP except those IP flows
which are forbidden to be routed via 3GPP.
The PDN GW provides updated Routing Rules to the UE based on the updated PCC
rules received from PCRF.
The PDN GW may initiate dedicated bearer activation and/or modification
procedure in 3GPP according to if the IP flow shall be transported to new
dedicated bearer or to existing bearer. The PDN GW may release the resource in
the WLAN access network for the IP flows which are moved to 3GPP but does not
release the access from the multi-access PDN connection. Steps 3 to 7 as per
Figure 6.3.2.1-1 will be invoked.
#### 6.6.1.4 Untrusted WLAN access becomes unusable
When the UE detects the untrusted WLAN access unusable, the UE shall report
this event to the network via 3GPP access. The untrusted WLAN access unusable
procedure is used when the UE determines that the untrusted WLAN access is not
usable anymore for carrying the IP flows. The UE determines that the untrusted
WLAN link is not usable when it detects loss of untrusted WLAN coverage, or
untrusted WLAN radio quality preventing the usage of this access based on UE
implementation mechanism. This procedure is applied in Network-initiated
NBIFOM mode.
Figure 6.6.1.4-1: Procedure for Untrusted WLAN becomes unusable access for GTP
S5/S8
The procedure is the same as described in clause 6.6.1.3.
### 6.6.2 An access of a PDN connection becomes usable
#### 6.6.2.1 3GPP access for the PDN connection becomes usable
When the UE detects that the 3GPP access becomes usable, the UE shall report
this event to the network via 3GPP access. The UE determines that the 3GPP
link is usable again when it detects recovery of 3GPP coverage, or 3GPP radio
quality allowing the usage of this access based on UE implementation
mechanism. This procedure is applied in Network-initiated NBIFOM mode.
Figure 6.6.2.1-1: Procedure for 3GPP access becomes usable for GTP S5/S8
1\. The UE is connected simultaneously to 3GPP and WLAN accesses and the UE
has previously reported that the 3GPP access link is not usable for routing IP
flows.
2\. The UE detects that the 3GPP link becomes usable.
3\. The UE sends the Request Bearer Resource Modification message including a
3GPP usable indication.
4-5. The indication is sent to the PDN GW via the SGW within a Bearer Resource
Command.
6\. When the PCRF has subscribed to such notification, the PDN GW sends the
indication to the PCRF.
The PCRF updates the PCC rules, e.g. by changing the Routing Access Type of
PCC Rules and provides the updated PCC rules to the PDN GW. The PCRF does not
provide updated PCC rules for those IP flows which are forbidden to be routed
in the 3GPP access.
7\. The PDN GW provides updated Routing Rules to the UE based on the updated
PCC rules received from PCRF.
The PDN GW may initiate dedicated bearer activation and/or modification
procedure according to if the IP flow shall be transported to new dedicated
bearer or to existing bearer. In case IP flows are moved from WLAN access to
3GPP, the PDN GW may release the resource in the WLAN access network but do
not release the access from the multi-access PDN connection. Step 3 to 7 as
per Figure 6.3.2.1-1 will be invoked.
#### 6.6.2.2 Trusted WLAN access for the PDN connection becomes usable
##### 6.6.2.2.1 Single-connection mode
After the UE connects to WLAN access and SCM mode is used, the UE shall report
to the network, via 3GPP access, that TWAN is usable. This procedure is
applied in Network-initiated NBIFOM mode.
Figure 6.6.2.2.1-1: Procedure for Trusted WLAN access becomes usable for GTP
S5/S8 in SCM
The procedure is similar to 3GPP access becomes usable call flows in clause
6.6.2.1, with the following differences:
\- Step 2 the UE detects TWAN becomes usable.
\- Step 3 to Step 6, the TWAN usable indication is sent from the UE to the
PCRF instead of 3GPP usable indication.
##### 6.6.2.2.2 Multi-connection mode
After the UE connects to WLAN access and MCM mode is used, the UE shall report
to the network, via 3GPP access, that TWAN is usable. This procedure is
applied in Network-initiated NBIFOM mode.
Figure 6.6.2.2.2-1: Procedure for Trusted WLAN access becomes usable for GTP
S2a in MCM
1\. The UE is connected simultaneously to 3GPP and TWAN accesses and has
previously reported that the 3GPP access link is not usable for routing IP
flows.
2\. The UE detects that the WLAN link is again usable for carrying IP flows.
3\. The UE sends the WLCP PDN Modification Command message including a WLAN
usable indication.
4\. The indication is sent to the PDN GW within a Bearer Resource Command.
5\. When the PCRF has subscribed to such notification, the PDN GW sends the
indication to the PCRF.
The PCRF updates the PCC rules, e.g. by changing the Routing Access Type of
PCC Rules and provides the updated PCC rules to the PDN GW. The PCRF does not
provide updated PCC rules for those IP flows which are forbidden to be routed
in the TWAN access.
6\. The PDN GW provides updated Routing Rules to the UE based on the updated
PCC rules received from PCRF.
The PDN GW may initiate dedicated bearer activation and/or modification
procedure according to if the IP flow shall be transported to new dedicated
bearer or to existing bearer. In case IP flows are moved from 3GPP access to
WLAN, the PDN GW may release the resource in the 3GPP access network. Steps 3
to 8 as per Figure 6.3.2.2.2-1 will be invoked.
#### 6.6.2.3 Untrusted WLAN access for the PDN connection becomes usable
When the UE detects that the untrusted WLAN access becomes usable, the UE
shall report this event to the network via WLAN access. The UE determines that
the untrusted WLAN link is usable again when it detects recovery of untrusted
WLAN coverage, or untrusted WLAN radio quality allowing the usage of this
access based on UE implementation mechanism. This procedure is applied in
Network-initiated NBIFOM mode.
Figure 6.6.2.3-1: Procedure for Untrusted WLAN access becomes usable for GTP
S2b
1\. The UE is connected simultaneously to 3GPP and untrusted WLAN accesses and
has previously reported that the 3GPP access link is not usable for routing IP
flows.
2\. The UE detects that the WLAN link is again usable for carrying IP flows.
3\. The UE sends the IKEv2 INFORMATIONAL Request message to the ePDG including
a WLAN usable indication.
3a. The ePDG sends an IKEv2 INFORMATIONAL Response message to the UE.
4\. The WLAN usable indication is sent from the ePDG to the PDN GW within a
Bearer Resource Command.
5\. When the PCRF has subscribed to such notification, the PDN GW sends the
indication to the PCRF.
The PCRF updates the PCC rules, e.g. by changing the Routing Access Type of
PCC Rules and provides the updated PCC rules to the PDN GW.
6\. The PDN GW provides updated Routing Rules to the UE based on the updated
PCC rules received from PCRF.
The PDN GW may initiate dedicated bearer activation and/or modification
procedure according to if the IP flow shall be transported to new dedicated
bearer or to existing bearer. In case IP flows are moved from 3GPP access to
WLAN, the PDN GW may release the resource in the 3GPP access network. Steps 3
to 9 as per Figure 6.3.2.3-1 will be invoked.
## 6.7 IP flow mobility triggered by RAN WLAN interworking
### 6.7.1 IP flow mobility triggered by Access Stratum indication move-to-WLAN
in Trusted WLAN access
#### 6.7.1.0 General
The procedure is used in Network-initiated NBIFOM mode when the UE applies
RAN-assisted WLAN interworking (i.e. RAN Rules) or RCLWI and the Access
Stratum indicates that the UE shall move traffic to WLAN when the UE is
connected simultaneously to 3GPP and TWAN access.
#### 6.7.1.1 Single-connection mode
Figure 6.7.1.1-1: Procedure for Access Stratum indication move-to-WLAN via
E-UTRAN using GTP S2a in SCM
The procedure is similar to IP flow mobility triggered by indication move-
from-WLAN call flows in Figure 6.7.3-1, with the following differences:
\- Step 2 Access Stratum indicates move-to-WLAN.
\- Step 3 to Step 6, the move-to-WLAN indication is sent from the UE to the
PCRF instead of move-from-WLAN indication.
Figure 6.7.1.1-2: Procedure for Access Stratum indication move-to-WLAN via
UTRAN using GTP S5/S8 in SCM
The procedure is similar to IP flow mobility triggered by Access Stratum
indication move-from-WLAN call flows in Figure 6.7.3-2, with the following
differences:
\- Step 2 Access Stratum indicates move-to-WLAN.
\- Step 3 to Step 6, the move-to-WLAN indication is sent from the UE to the
PCRF instead of move-from-WLAN indication.
#### 6.7.1.2 Multi-connection mode
Figure 6.7.1.2-1: Procedure for Access Stratum indication move-to-WLAN for GTP
S2a in MCM
1\. The UE is connected simultaneously to 3GPP and TWAN accesses. If, based on
clause 5.4, the UE determines for non-radio related reasons that the WLAN
access cannot be used, steps 3 to 6 are not performed.
2\. Access Stratum indicates move-traffic-to-WLAN.
3\. The UE sends the WLCP PDN Modification Command message including a move-
to-WLAN indication.
4\. The indication is sent to the PDN GW within a Bearer Resource Command.
5\. When the PCRF has subscribed to such notification, the PDN GW sends the
indication to the PCRF.
The PCRF may update the PCC rules, e.g. by changing the Routing Access Type of
PCC Rules and provides the updated PCC rules to the PDN GW.
6\. The PDN GW provides updated Routing Rules to the UE based on the updated
PCC rules received from PCRF. The PDN GW may initiate dedicated bearer
activation and/or modification procedure as described in WLAN according to if
the IP flow shall be transported to new dedicated bearer or to existing
bearer. In case IP flows are moved from 3GPP access to WLAN, the PDN GW may
release the resource in the 3GPP access network. These procedures are
described as per Figure 6.3.2.2.2-1 from Steps 3 to 8.
### 6.7.2 IP flow mobility triggered by Access Stratum indication move-to-WLAN
in Untrusted WLAN access
The procedure is used in Network-initiated NBIFOM mode when the UE applies
RAN-assisted WLAN interworking (i.e. RAN Rules) or RCLWI, and the Access
Stratum indicates that the UE shall move traffic to WLAN when the UE is
connected simultaneously to 3GPP and untrusted WLAN access.
Figure 6.7.2-1: Procedure for Access Stratum indication move-to-WLAN for GTP
S2b
1\. The UE is connected simultaneously to 3GPP and untrusted WLAN accesses.
2\. Access Stratum indicates move-traffic-to-WLAN. If, based on clause 5.4,
the UE determines for non-radio related reasons that the WLAN access cannot be
used, steps 3 to 6 are not performed.
3\. The UE sends the IKEv2 INFORMATIONAL Request message including a move-to-
WLAN indication.
3a. The ePDG sends an IKEv2 INFORMATIONAL Response message to the UE.
4\. The ePDG sends the indication to the PDN GW within a Bearer Resource
Command.
5\. When the PCRF has subscribed to such notification, the PDN GW sends the
indication to the PCRF.
The PCRF may update the PCC rules, e.g. by changing the Routing Access Type of
PCC Rules and provides the updated PCC rules to the PDN GW.
6\. The PDN GW provides updated Routing Rules to the UE based on the updated
PCC rules received from PCRF. The PDN GW may initiate dedicated bearer
activation and/or modification procedure in untrusted WLAN access according to
if the IP flow shall be transported to new dedicated bearer or to existing
bearer. In case IP flows are moved from 3GPP access to WLAN, the PDN GW may
release the resource in the 3GPP access network. These procedures are
described as per Figure 6.3.2.3-1 from Steps 3 to 9.
### 6.7.3 IP flow mobility triggered by indication move-from-WLAN
The procedure is used in Network-initiated NBIFOM mode when the UE applies
RAN-assisted WLAN interworking (i.e. RAN Rules) or RCLWI, and the Access
Stratum indicates that the UE shall move traffic from WLAN.
Figure 6.7.3-1: Procedure for Access Stratum indication move-from-WLAN via
E-UTRAN using GTP S5/S8
1\. The UE is connected simultaneously to 3GPP and WLAN accesses.
2\. Access Stratum indicates move-traffic-from-WLAN.
3\. The UE sends the Request Bearer Resource Modification message including a
move-from-WLAN indication.
4\. The MME sends the indication the SGW within a Bearer Resource Command.
5\. The SGW transfers the indication to the PDN GW within a Bearer Resource
Command.
6\. The PDN GW sends the indication to the PCRF.
The PCRF may update the PCC rules, e.g. by changing the Routing Access Type of
PCC Rules and provides the updated PCC rules to the PDN GW.
7\. The PDN GW provides updated Routing Rules to the UE based on the updated
PCC rules received from PCRF. The PDN GW may initiate dedicated bearer
activation and/or modification procedure in WLAN access according to if the IP
flow shall be transported to new dedicated bearer or to existing bearer. In
case IP flows are moved from WLAN access to 3GPP, the PDN GW may release the
resource in the WLAN access network. These procedures are described as per
Figure 6.3.2.3-1 from Steps 3 to 7.
Figure 6.7.3-2: Procedure for Access Stratum indication move-from-WLAN via
UTRAN using GTP S5/S8
1\. The UE is connected simultaneously to 3GPP and WLAN accesses.
2\. Access Stratum indicates move-traffic-from-WLAN.
3\. The UE sends the Modify PDP Context Request message including a move-from-
WLAN indication.
4\. The SGSN sends the indication the SGW within a Bearer Resource Command.
5\. The SGW transfers the indication to the PDN GW within a Bearer Resource
Command.
6\. The PDN GW sends the indication to the PCRF.
The PCRF may update the PCC rules, e.g. by changing the Routing Access Type of
PCC Rules and provides the updated PCC rules to the PDN GW.
7\. The PDN GW provides updated Routing Rules to the UE based on the updated
PCC rules received from PCRF. The PDN GW may initiate dedicated bearer
activation and/or modification procedure in WLAN access according to if the IP
flow shall be transported to new dedicated bearer or to existing bearer. If IP
flows are moved from WLAN access to 3GPP, the PDN GW may release the resource
in the WLAN access network. These procedures are described according to Figure
6.3.2.1-2 from Steps 3 to 7.
## 6.8 Network-initiated release of NBIFOM PDN connection
### 6.8.1 General
The Network-initiated release of NBIFOM PDN connection procedure may be
triggered by SIPTO, as defined in TS 23.401 [4]. In this case, the PDN GW
initiates Bearer Deactivation procedure upon receiving a Release Over Any
Access indication from the MME.
The Network-initiated release of NBIFOM PDN connection procedure may also be
triggered due to P-CSCF Restoration, as defined in TS 23.380 [8]. In this
case,
\- The PDN GW initiates Bearer Deactivation procedure as described in clause
6.8.2 upon receiving a P-CSCF Restoration indication from the PCRF, the 3GPP
AAA server, or the MME/SGSN, or
\- The PDN GW initiates Bearer Deactivation procedure in WLAN upon receiving
the Release Over Any Access indication from the MME/SGSN as described in
clause 6.8.2.
\- The MME sends the Release Over Any Access indication during the MME
requested PDN disconnection procedure or MME-initiated Detach procedure upon
receiving a P-CSCF Restoration indication from the HSS. Or,
\- The SGSN sends the Release Over Any Access indication during the SGSN
Initiated PDN connection Deactivation Procedure using S4 upon receiving a
P-CSCF Restoration indication from the HSS.
### 6.8.2 PDN GW initiated procedures
#### 6.8.2.1 PDN GW initiated bearer deactivation procedure
The PDN GW initiated bearer deactivation procedure defined in TS 23.401 [4]
clause 5.4.4.1 shall be used with the following exceptions:
\- Step 2:
If the PDN GW has received a P-CSCF restoration indication from the PCRF, the
3GPP AAA server, or the MME/SGSN, it shall select one access supporting the
basic mechanism, based e.g. on whether the access supports the basic P-CSCF
restoration mechanism defined in TS 23.380 [8]. If the PDN GW has selected the
3GPP access, it shall include the Reactivation Requested indication in the
Delete Bearer Request to the MME. If the PDN GW has selected the WLAN access,
it shall include the cause \"local release\" in the Delete Bearer Request to
the MME.
\- Steps 4 to 7 are not performed if the Cause in the Delete Bearer Request
message is \"local release\".
#### 6.8.2.2 PDN GW initiated Resource Allocation Deactivation with GTP on S2b
procedure
For untrusted WLAN, the PDN GW initiated Resource Allocation Deactivation with
GTP on S2b procedure defined in TS 23.402 [2] clause 7.9.2 shall be used with
the following modifications:
\- Step 2 applies with the following addition:
\- If the PDN GW has received a P-CSCF restoration indication from the PCRF,
the 3GPP AAA server, or the MME/SGSN, it shall select one access supporting
the basic mechanism as defined in TS 23.380 [8]. If the PDN GW has selected
the untrusted WLAN access, it shall include the Reactivation Requested
indication in the Delete Bearer Request to the ePDG. If the PDN GW has
selected the 3GPP access, it shall include the cause \"local release\" in the
Delete Bearer Request to the ePDG.
\- If this procedure is triggered by a Release Over Any Access indication from
the MME, the PDN GW shall include the cause \"local release\" in the Delete
Bearer Request to the ePDG.
\- Step 3 is modified as follows: The IKEv2 tunnel release is triggered from
the ePDG to the UE if all bearers belonging to the PDN connection are released
and if the Cause in the Delete Bearer Request message is different from
\"local release\". If the Delete Bearer Request message contains the
Reactivation Requested indication, the ePDG includes the cause \"Reactivation
Requested\" in the IKEv2 message to the UE.
#### 6.8.2.3 PDN GW initiated Resource Allocation Deactivation in WLAN on GTP
S2a procedure
For trusted WLAN, the PDN GW initiated Resource Allocation Deactivation in
WLAN on GTP S2a procedure defined in TS 23.402 [2] clause 16.4.1 shall be used
with the following modifications:
\- Step 2 applies with the following addition:
\- If the PDN GW has received a P-CSCF restoration indication from the PCRF,
the 3GPP AAA server, or the MME/SGSN, it shall select one access supporting
the basic mechanism as defined in TS 23.380 [8]. If the IMS PDN connection is
established on both accesses with the single connection mode over the trusted
WLAN, the PGW shall select the 3GPP access. Otherwise,
\- If the PDN GW has selected the trusted WLAN access, it shall include the
Reactivation Requested indication in the Delete Bearer Request to the TWAN;
\- If the PDN GW has selected the 3GPP access, it shall include the cause
\"local release\" in the Delete Bearer Request to the TWAN.
\- If this procedure is triggered by a Release Over Any Access indication from
the MME, the PDN GW shall include the cause \"local release\" in the Delete
Bearer Request to the TWAN.
\- Step 3 is modified as follows:
In multi-connection mode, if all bearers belonging to a PDN connection are
released and if the Cause in the Delete Bearer Request message is different
from \"local release\", then the UE is informed of the PDN connection release
by means of a WLCP PDN Disconnection Request (PDN Connection ID). If the
Delete Bearer Request message contains the Reactivation Requested indication,
the TWAN includes the cause \"Reactivation Requested\" to the WLCP PDN
Disconnection Request message to the UE.
#### 6.8.2.4 PDN GW initiated Bearer Deactivation Procedure using S4
The PDN GW initiated bearer deactivation procedure using S4 defined in TS
23.060 [5] clause 9.2.4.3A shall be used with the following additions:
\- Step A:
If the PDN GW receives a P-CSCF Restoration indication from the PCRF, the 3GPP
AAA server, or the MME/SGSN, it shall select one access supporting the basic
mechanism as defined in TS 23.380 [8]. If the PDN GW has selected the 3GPP
access, it shall include the Reactivation Requested indication in the Delete
Bearer Request to the SGSN. If the PDN GW has selected the WLAN access, it
shall include the cause \"local release\" in the Delete Bearer Request to the
SGSN.
\- In addition, if the Cause in the Delete Bearer Request message is \"local
release\", the message Deactivate PDP Context Request in step 2 of figure 77
in clause 9.2.4.3 is not sent to the UE.
#
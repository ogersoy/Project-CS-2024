# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
In the present document, modal verbs have the following meanings:
**shall** indicates a mandatory requirement to do something
**shall not** indicates an interdiction (prohibition) to do something
The constructions \"shall\" and \"shall not\" are confined to the context of
normative provisions, and do not appear in Technical Reports.
The constructions \"must\" and \"must not\" are not used as substitutes for
\"shall\" and \"shall not\". Their use is avoided insofar as possible, and
they are not used in a normative context except in a direct citation from an
external, referenced, non-3GPP document, or so as to maintain continuity of
style when extending or modifying the provisions of such a referenced
document.
**should** indicates a recommendation to do something
**should not** indicates a recommendation not to do something
**may** indicates permission to do something
**need not** indicates permission not to do something
The construction \"may not\" is ambiguous and is not used in normative
elements. The unambiguous constructions \"might not\" or \"shall not\" are
used instead, depending upon the meaning intended.
**can** indicates that something is possible
**cannot** indicates that something is impossible
The constructions \"can\" and \"cannot\" are not substitutes for \"may\" and
\"need not\".
**will** indicates that something is certain or expected to happen as a result
of action taken by an agency the behaviour of which is outside the scope of
the present document
**will not** indicates that something is certain or expected not to happen as
a result of action taken by an agency the behaviour of which is outside the
scope of the present document
**might** indicates a likelihood that something will happen as a result of
action taken by some agency the behaviour of which is outside the scope of the
present document
**might not** indicates a likelihood that something will not happen as a
result of action taken by some agency the behaviour of which is outside the
scope of the present document
In addition:
**is** (or any other verb in the indicative mood) indicates a statement of
fact
**is not** (or any other negative verb in the indicative mood) indicates a
statement of fact
The constructions \"is\" and \"is not\" do not indicate requirements.
# 1 Scope
The objective of this Technical Report is to identify and evaluate
architecture enhancements of 5G System design needed to support proximity
based services based on SA WG1 requirements defined in TS 22.278 [2], TS
22.261 [3] and TS 22.115 [4] and determine which of the solutions can proceed
to normative specifications.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 22.278: \"Service requirements for the Evolved Packet System
(EPS); Stage 1\".
[3] 3GPP TS 22.261: \"Service requirements for next generation new services
and markets; Stage 1\".
[4] 3GPP TS 22.115: \"Service aspects; Charging and billing; Stage 1\".
[5] 3GPP TS 23.287: \"Architecture enhancements for 5G System (5GS) to support
Vehicle-to-Everything (V2X) services\".
[6] 3GPP TS 23.501: \"System Architecture for the 5G System; Stage 2\".
[7] 3GPP TR 22.842: \"Study on Network Controlled Interactive Service (NCIS)
in the 5G System (5GS); Stage 1\".
[8] 3GPP TS 23.502: \"Procedures for the 5G System (5GS); Stage 2\".
[9] 3GPP TS 23.303: \"Proximity-based services (ProSe); Stage 2\".
[10] IETF RFC 826: \"An Ethernet Address Resolution Protocol\".
[11] 3GPP TS 38.300: \"NR; NR and NG-RAN Overall Description; Stage 2\".
[12] 3GPP TS 29.343: \"Proximity-services (ProSe) function to ProSe
application server aspects (PC2); Stage 3\".
[13] 3GPP TS 32.277: \"Telecommunication management; Charging management;
Proximity-based Services (ProSe) charging\".
[14] 3GPP TR 23.713: \"Study on extended architecture support for proximity-
based services\".
[15] 3GPP TS 32.255: \"Telecommunication management; Charging management; 5G
data connectivity domain charging; Stage 2\".
[16] 3GPP TS 32.256: \"Charging management; 5G connection and mobility domain
charging; Stage 2\".
[17] 3GPP TS 32.291: \"Telecommunication management; Charging management; 5G
system, charging service; Stage 3\".
[18] 3GPP TS 23.503: \"Policy and charging control framework for the 5G System
(5GS); Stage 2\".
[19] 3GPP TS 22.186: \"Service requirements for enhanced V2X scenarios\".
[20] 3GPP TS 24.334: \" Proximity-services (ProSe) User Equipment (UE) to
ProSe function protocol aspects; Stage 3\".
[21] 3GPP TS 24.333: \" Proximity-services (ProSe) Management Objects (MO)\".
[22] 3GPP TS 32.290: \" Services, operations and procedures of charging using
Service Based Interface (SBI)\".
[23] 3GPP TS 38.331: \"NR; Radio Resource Control (RRC); Protocol
specification\".
[24] 3GPP TS 23.288: \"Architecture enhancements for 5G System (5GS) to
support network data analytics services\".
[25] 3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for
Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".
[26] 3GPP TR 23.733: \"Study on architecture enhancements to Proximity
Services (ProSe) UE-to-Network relay\".
[27] 3GPP TR 36.746: \"Study on further enhancements to LTE Device to Device
(D2D), UE to network relays for Internet of Things (IoT) and wearables\".
[28] 3GPP TS 24.526: \"User Equipment (UE) policies for 5G System (5GS); Stage
3\".
[29] 3GPP TS 23.280: \"Common functional architecture to support mission
critical services; Stage 2\".
[30] 3GPP TS 23.237: \"IP Multimedia Subsystem (IMS) Service Continuity; Stage
2\".
[31] 3GPP TS 33.501: \"Security architecture and procedures for 5G system\".
[32] 3GPP TR 38.836: \"Study on NR sidelink relay\".
[33] IETF RCF 4862: \"IPv6 Stateless Address Autoconfiguration\".
[34] 3GPP TS 33.303: \"Proximity-based Services (ProSe); Security aspects\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
**Open ProSe Discovery** : ProSe Discovery without explicit permission from
the ProSe-enabled UE being discovered, according to TS 22.278 [2].
**Restricted ProSe Discovery** : ProSe Discovery that only takes place with
explicit permission from the ProSe-enabled UE being discovered, according to
TS 22.278 [2].
**5G ProSe Direct Discovery:** A procedure employed by a ProSe-enabled UE to
discover other ProSe-enabled UEs in its vicinity by using only the
capabilities of the two UEs with NR technology.
**5G ProSe Direct Communication:** A communication between two or more UEs in
proximity that are ProSe-enabled, by means of user plane transmission using NR
technology via a path not traversing any network node.
**Direct Network Communication:** One mode of network communication, where
there is no UE-to-Network Relay UE between a UE and the 5G network.
**Indirect Network Communication:** One mode of network communication, where
there is a UE-to-Network Relay UE between a UE and the 5G network.
**5G ProSe UE-to-Network Relay:** A UE that provides functionality to support
connectivity to the network for Remote UE(s).
**5G ProSe UE-to-UE Relay:** A UE that provides functionality to support
connectivity between other UEs.
**Remote UE:** A 5G ProSe-enabled UE that communicates with a DN via a 5G
ProSe UE-to-Network Relay.
Editor\'s note: Terms \"Source UE\" and \"Target UE\" are used in key issues
and various solutions for UE-to-UE Relay. More accurate terminology needs to
be found if needed during conclusion or normative phase.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] apply. An abbreviation defined in the present document takes precedence
over the definition of the same abbreviation, if any, in TR 21.905 [1].
# 4 Architecture Requirements and Assumptions
## 4.1 Architecture Requirements
Solutions shall build on the 5G System architectural principles as in TS
23.501 [6], including flexibility and modularity for newly introduced
functionalities.
In order to satisfy the normative stage-1 general requirements in TS 22.278
[2] and TS 22.261 [3] and TS 22.115 [4], the system shall:
\- enable the direct discovery of the ProSe-enabled UE by other ProSe-enabled
UEs within the same PLMNs or different PLMNs, including in coverage and out of
coverage.
NOTE: This needs to be resolved by RAN.
\- enable the ProSe direct communication functionality.
\- enable the path selection functionality.
\- enable the service authorization and provisioning of the ProSe-enabled UEs.
\- enable QoS support on PC5.
\- enable the operators (HPLMN or VPLMN) charging for the utilization of the
ProSe functionality.
\- enable UE-to-Network relay functionality (including service continuity).
\- enable UE-to-UE relay functionality.
## 4.2 Architecture Assumptions
### 4.2.1 General
\- Architecture reference models defined in TS 23.287 [5] (i.e. PC5 based eV2X
architecture reference model) are used as reference architecture for
supporting ProSe in 5GS.
\- Architecture reference model defined in TS 23.501 [6] are used as basis
architecture for supporting ProSe in 5GS.
\- Group management is handled by application layer which is out of this
document.
\- NG-RAN is considered; non-3GPP AN is not considered in the release.
\- NR based PC5 is considered.
\- QoS handling for V2X communication over NR PC5 reference point defined in
clauses 5.4.1 to 5.4.4 of TS 23.287 [5] is used as basis for supporting PC5
direct communication.
\- The standardized PQI values defined for NR PC5 in TS 23.287 [5] can be used
to support performance requirements defined in clause 7.6.2 of TS 22.261 [3]
for interactive services if applicable.
\- Alternative QoS Profiles are not supported in UE-to-Network Relay
scenarios.
The Relay\'s AMF may interact with Remote UE\'s AMF and Relay UE\'s PCF for
authorization, and the details are in Solution #30.
1\. Source UE wants to establish unicast communication with target UE, it
decides the E2E QoS parameters between source UE and target UE based on the
application layer requirements. The Source UE sets up a PC5 QoS Flow with PFI.
Then Source UE provides the PFI, E2E QoS parameters, source and target user
info to UE-to-UE Relay. The process is similar to the unicast L2 link
establishment or modification procedure as defined in TS 23.287 [5] clause
6.3.3.
2\. Relay splits the E2E QoS parameters into two parts: one part is for the
PC5 interface between source UE and Relay (source side PC5 QoS parameters),
the other part is for the PC5 interface between Relay and the target UE
(target side PC5 QoS parameters).
3\. Relay provides the PFI received from source UE, target side PC5 QoS
parameters, source and target user info to target UE. The process is similar
to the unicast L2 link establishment or modification procedure as defined in
TS 23.287 [5] clause 6.3.3.
4\. Relay receives the Layer-2 link establishment/modification accept from
target UE.
5\. Relay provides the Layer-2 link establishment/modification accept to the
source UE with the PFI and the source side PC5 QoS parameters.
### 4.2.2 Reference Architecture Model
V2X architecture as defined in TS 23.287 [5] will be used as baseline.
# 5 Key Issues
## 5.1 Key Issue #1: ProSe Direct discovery
### 5.1.1 General description
The ProSe direct discovery procedure is used for a UE to discover or be
discovered by other UE(s) in proximity over the PC5 interface. The UE can
discover other UE(s) with interested application(s) and/or interested group(s)
using the ProSe direct discovery procedure. This solution for this key issue
should strive to achieve the common direct discovery procedure for discovering
a 5G Prose enabled UE, 5G Prose UE-to-Network Relay and a 5G Prose UE-to-UE
Relay.
Following issues need to be addressed in this key issue:
\- Discover (or discovered by) other UE(s) in interested group(s) over PC5
interface, the group information can come from application layer.
\- Discover (or discovered by) other UE(s) also supporting interested
application(s) over PC5 interface.
\- If the UE is out of coverage, discover (or discovered by) other UE(s) in
coverage or out of coverage.
\- Network is able to control the ProSe direct discovery procedure when the UE
is in coverage.
NOTE: The ProSe direct discovery procedure can be used to perform the ProSe
direct communication, e.g. one-to-many direct communication, one-to-one direct
communication.
## 5.2 Key Issue #2: Support for NR PC5 ProSe communication
### 5.2.1 General description
In TS 22.261 [3] and TS 22.278 [2], use cases and requirements for ProSe
services are described, including public safety and interactive services. NR
PC5 ProSe communication including unicast and groupcast needs to be supported
for the case of public safety and interactive service.
Following assumptions apply to this key issue:
\- For one-to-many direct communication and one-to-one direct communication
differences with what is documented in TS 23.287 [5] clause 5.2 will be
documented.
\- For QoS support differences with what is documented in TS 23.287 [5] clause
5.4 will be documented.
## 5.3 Key Issue #3: Support of UE-to-Network Relay
### 5.3.1 General description
According to TS 22.261 [3] and TS 22.278 [2], support for UE-to-Network Relay
needs to be studied. In addition, the Rel-16 5G architectural design (e.g.
flow-based QoS communication over PC5/Uu interface) shall be taken into
consideration as well.
The case that UE may be able to access to network via the direct network
communication or the indirect network communication illustrated in figure
5.3.1-1 needs to be considered, where path #1 is direct network communication
path that may not exist, as well as path #2 and path #3 are indirect network
communication paths via different UE-to-Network Relays.
Figure 5.3.1-1: Example scenario of direct or indirect network communication
path between UE and Network
Therefore, 5G ProSe needs to support UE-to-Network Relay. In particular, the
following aspects need to be studied:
\- How to authorize a UE to be a 5G UE-to-Network Relay and how to authorize a
UE to access 5GC via a 5G UE-to-Network Relay.
\- How to establish a connection between Remote UE and a UE-to-Network Relay
to support connectivity to the network for the Remote UE.
\- How to support end-to-end requirements between Remote UE and the network
via a UE-to-Network Relay, including QoS (such as data rate, reliability,
latency) and the handling of PDU Session related attributes (e.g. S-NSSAI,
DNN, PDU Session Type and SSC mode).
\- How the network allows and controls the QoS requirement for 5G ProSe UE-to-
NW relay.
\- How to transfer data between the Remote UE and the network over the UE-to-
Network Relay.
NOTE 1: Security and privacy aspects will be handled by SA WG3.
\- How to (re)select a UE-to-Network Relay for communication path selection
between two indirect network communication paths (i.e. path #2 and path #3 in
figure 5.3.1-1).
\- How to perform communication path selection between a direct network
communication path (i.e. path #1 in figure 5.3.1-1) and an indirect network
communication path (i.e. path #2 or path #3 in figure 5.3.1-1).
\- How to guarantee service continuity during these communication path switch
procedures for switching between a direct network communication path and an
indirect communication path, as well as for switching between two indirect
network communication paths.
NOTE 2: Support of non-unicast mode communication (i.e. one-to-many
communication/broadcast or multicast) between network and UE-to-Network Relay
UE and between UE-to-Network Relay and Remote UE(s) depends on the result of
FS_5MBS work.
Two cases can be considered regarding support of UE-to-Network Relay, i.e. UE-
to-Network Relay served by gNB as shown in Figure 5.3.1-2 and UE-to-Network
Relay served by ng-eNB as shown in Figure 5.3.1-3.
{width="6.284027777777778in" height="0.8201388888888889in"}
Figure 5.3.1-2: UE-to-Network Relay served by gNB
Figure 5.3.1-3: UE-to-Network Relay served by ng-eNB
NOTE 3: Whether to support the case that a UE-to-Network Relay is served by
ng-eNB depends on solution to be identified in this study and RAN decision.
NOTE 4: When UE-to-Network Relay moves to E-UTRAN, LTE PC5 based ProSe UE-to-
Network Relay can be supported as defined TS 23.303 [9] for Public Safety.
## 5.4 Key Issue #4: Support of UE-to-UE Relay
### 5.4.1 General description
This key issue intends to support for UE-to-UE Relay, including support for in
coverage and out of coverage operation.
At least the following aspects need to be considered in potential solutions:
\- How to (re)-select a UE-to-UE Relay UE in proximity?
\- Whether and how for the network can control the UE-to-UE Relay operation,
at least including how to:
\- Authorize the UE-to-UE Relay, e.g. authorize a UE as UE-to-UE Relay?
\- Authorize the Remote UE to access a UE-to-UE Relay?
\- Provide the visibility of source/target UE and the UE-to-UE Relay to the
network for the purpose of, e.g. charging?
\- How to establish the connection between the source UE and the target UEs
via UE-to-UE Relay?
\- How to provide end-to-end QoS framework to satisfy the QoS requirements
(such as data rate, reliability, latency)?
\- How to enhance the system architecture to provide the security protection
for relayed connection?
\- How to provide a mechanism for path changing in case of e.g. UE-to-UE Relay
changes?
NOTE 1: For the involvement of NG-RAN, coordination with RAN WGs is needed.
NOTE 2: For security aspects, coordination with SA WG3 is needed.
## 5.5 Key Issue #5: Support direct communication path selection between PC5
and Uu
### 5.5.1 General description
For 5GS, the proximity services are expected to be an important system wide
enabler to support various applications and services (both in commercial and
public safety domains). As an example, TR 22.842 [7] identified emerging
Network-controlled Interactive services (NCIS) that share some commonality of
requirements with public safety services and applications.
For either form of services, supporting the requirements for throughput,
latency, reliability or other service requirements calls for employing path
selection. To improve the support of proximity services, the appropriate
direct communication path (or interface) could be selected by the UE based on
some policy which may also be configured by the operator or assisted by the
network when available. Therefore, this key issue addresses how to enhance the
5GS to support direct path selection. When studying the above aspect, the
following needs to be considered:
\- How to enable path selection between a ProSe direct communication path and
a direct network communication path.
\- What functional entities and triggers are responsible for the above path
selection.
## 5.6 Key Issue #6: Support direct communication path switching between PC5
and Uu
### 5.6.1 General description
This key issue addresses how to enhance the 5GS to support direct
communication path switching (when needed) from 5GC Uu path to PC5 (ProSe)
path or vice versa for both commercial and public safety services.
When studying the above aspect, the following needs to be considered:
\- How to enable network-controlled/network-assisted direct communication path
switching between 5GC Uu path and PC5 path.
\- What functional entities and triggers are responsible for direct
communication path switching and their impact on the corresponding interfaces.
\- How service continuity could be preserved during direct communication path
switching, i.e. Uu to PC5 or PC5 to Uu.
\- What are the possible impacts of direct communication path switching on QoS
handling for ProSe Communication over PC5 path vs. over 5GC Uu path?
NOTE: This key issue is not addressed within Rel-17 timeframe.
## 5.7 Key Issue #7: Charging for PC5
### 5.7.1 General description
In order to fulfil the requirements in TS 22.115 [4] and TS 22.261 [3], this
key issue is proposed to study how to accommodate charging for PC5 for
commercial and public safety services based on the 5G service-based
architecture.
This Key Issue shall study:
\- Identify any architecture enhancements are needed to accommodate charging
for PC5 on the 5G architecture.
\- How to collect and report charging related data to accommodate charging for
PC5?
## 5.8 Key Issue #8: Support of PC5 Service Authorization and Policy/Parameter
Provisioning
### 5.8.1 General description
In order to enable PC5 service authorization and policy/parameter provisioning
following aspects need to be studied:
\- For the procedures related to PC5 service authorization and
policy/parameter provisioning to a UE, only necessary enhancement with what is
specified in TS 23.287 [5] clause 6.2 and TS 23.502 [8] clause 4.2.2.2
(Registration Procedure), 4.2.4.3 (UE Configuration Update procedure for
transparent UE Policy Delivery), 4.16.11 (UE Policy Association Establishment
procedure), 4.16.12 (UE Policy Association Modification procedure), will be
documented.
\- Identify necessary information for PC5 service authorization and
provisioning based on what is specified in TS 23.287 [5] clause 5.1.2.1.
Authorisation and Provisioning as documented in TS 23.287 [5] clause 5.1 will
be used as baseline for this key issue.
# 6 Solutions
## 6.0 Mapping of Solutions to Key Issues
Table 6.0-1: Mapping of Solutions to Key Issues
              Key Issues
* * *
Solutions 1 2 3 4 5 6 7 8 1 X X 2 X X 3 X  
4 X X  
5 X  
6 X  
7 X X 8 X  
9 X  
10 X  
11 X  
12 X  
13 X  
14 X  
15 X  
16 X 17 X 18 X X  
19 X X  
20 X  
21 X  
22 X X  
23 X  
24 X  
25 X  
26 X  
27 X  
28 X X  
29 X  
30 X  
31 X  
32 X  
33 X X  
34 X  
35 X X 36 X X 37 X  
38 X  
39 X  
40 X  
41 X  
42 X  
43 X  
44 X  
45 X  
46 X  
47 X  
48 X X  
49 X  
50 X  
51 X
## 6.1 Solution #1: Restricted direct discovery
### 6.1.1 Description
This solution provides the discovery procedure based on 5GC architecture,
including authorization and provision, announcing and monitoring procedures,
and protocol for discovery as detailed in clause 6.1.2.
In EPS, there are two types of ProSe Direct Discovery: open and restricted.
Open discovery is the case where there is no explicit permission that is
needed from the UE being discovered, whereas restricted discovery only takes
place with explicit permission from the UE that is being discovered. In this
solution, only restricted type is proposed.
Besides, there are two models for ProSe Direct Discovery exists in EPS: Model
A and Model B. These two models are re-proposed in this solution as the same
mechanism in EPS. And the definition for Model A and Model B is as defined in
clause 5.3.1.2 of TS 23.303 [9].
### 6.1.2 Procedures
#### 6.1.2.1 Procedure for authorization and provision
**1\. Authorization and provision to the UE**
For the direct discovery authorization and provision to the UE, it is expected
the AF can provide the groups and/or service information to the PCF via NEF
and the PCF provides the authorization to the UE according to the received
information from the AF. The authorization and provision procedures in clauses
6.2.2 and 6.2.5 of TS 23.287 [5] are reused to provide at least the following
configurations:
1) The AF request sent to the PCF (or via NEF) contains the information as
below:
\- The service information to be directly discovered over PC5 interface. The
service information can contain, e.g. Application identifier.
\- The group information (e.g. the external group identifier) to be directly
discovered over PC5 interface.
\- The information can per announcing and monitoring direction for Model A or
per discoverer UE and discoveree UE for Model B.
\- The area information, e.g. geographical information (longitude/latitude,
zip code, etc.).
\- The metadata information related to application being discovered.
NOTE 1: The metadata information may be configured directly by the AF (e.g.
ProSe Application Server) via the PC1 interface.
NOTE 2: Whether to configure the metadata information to the UE and to deliver
metadata in PC5 interface depends on the size of PC5-S message, and it can be
determined in normative work.
2) The provision to the UE from PCF, contains the following information based
on the information received from the AF and local policy:
\- The service information to be directly discovered over PC5 interface. The
service information can contain, e.g. Application identifier.
\- The group information (e.g. the external group identifier) to be directly
discovered over PC5 interface.
\- The area information used for direct discovery over PC5 interface; The area
information could be geographical TA list. It is expected PCF will map the
area information provided by AF to a list of TAs.
\- Security parameters used for direct discovery over PC5.
NOTE 3: Uu RAT restriction is not applied to PC5 operations for the UE. Uu RAT
information is not needed to be provisioned in the UE, e.g. to authorize the
UE to send or monitor direct discovery message only when the UE camps on NR.
**2\. Authorization and provision to NG-RAN**
If the AMF determines the UE is authorised to use direct discovery based on
the authorised area information, the AMF provides the UE is authorized to use
direct discovery over PC5 interface to corresponding NG-RAN during N2
establishment for the UE.
#### 6.1.2.2 Procedure for announcing and monitoring discovery message
Figure 6.1.2.2-1: Procedure for discovery procedure
0\. The user may obtain ProSe application user ID and ProSe application code
for ProSe direct discovery using application layer mechanisms. The application
layer in the UE provides application user ID and the application identifier to
the ProSe Application Function. The ProSe Application Function allocates a
ProSe application user ID and ProSe application code to the application layer
in the UE.
NOTE 1: Step 0 is out of this specification. And this step is only needed for
the applications for which there is privacy issue.
1\. The UE obtains the authorization and provision for announcing discovery
and/or for monitoring/ solicitation discovery as defined in clauses 6.2.2 and
6.2.5 of TS 23.287 [5]. The authorized parameters are shown in clause 6.1.2.1.
2a. When the announcing UE is triggered e.g. by an upper layer application to
announce availability for interested groups and/or for interested
applications, if the UE is authorised to perform the announcing UE procedure
for the interested groups and/or the interested applications in step 1, then
the UE shall generate a PC5 direct discovery message for announcement and
includes the following information in this message. The announcing UE computes
a security protection element (e.g. for integrity protection) and appends it
to the PC5 message:
1) ProSe UE ID e.g. ProSe application user ID, Layer 2 ID.
2) The group ID(s) provided by the application layer.
3) The application ID(s) or ProSe application code(s) provided the application
layer.
When the monitoring UE is triggered e.g. by an upper layer application or by
the user to monitor proximity of other UEs for the interested group(s) and/or
interested applications, and if the UE is authorised to perform the monitoring
procedure for the group(s) and/or applications, then the UE monitors the
discovery message. The monitoring UE verifies the security protection element
using the provisioned security parameters corresponding to the application. If
the verification of the security protection element succeeds, the service is
successfully discovered by the monitoring UE. The monitoring UE may then
notify the application layer using the result of the discovery.
2b. When the discoverer UE is triggered e.g. by an upper layer application or
by the user to discover other UEs for the interested group(s) and/or
interested applications, and if the UE is authorised to perform the discovery
solicitation procedure for the group(s) and/or applications in step 1, then
the UE sends solicitation message with the following information of
discoverer:
1) ProSe UE ID;
2) group ID(s);
3) application ID(s) or ProSe application code(s).
The discoverer UE computes a security protection element (e.g. for integrity
protection) and appends it to the PC5 message.
If the discoveree UE is able to and authorised to respond to the discovery
solicitation according to the received information in the solicitation
message, then it responds to the discovery message with the discoveree ProSe
UE ID, the supported application ID(s) or ProSe application code(s) and group
ID(s).
3a. If the monitoring UE/discoverer UE wants to request metadata corresponding
to the discovered service in step 2, the monitoring UE/discoverer UE may send
a unicast metadata request message to request discovery metadata. The
monitoring UE/discoverer UE may use the Layer 2 ID of announcing UE/discoveree
UE (received in step 2a or 2b) to send the Metadata Request message.
3b. The announcing UE/discoveree UE responds with the Metadata Response
message. The announcing UE/discoveree UE includes the metadata information in
the Metadata Response message.
NOTE 2: Whether and how the dynamic metadata is exchanged between the peer UEs
depends on the size of the PC5-S signalling, can be determined in normative
work.
### 6.1.3 Impacts on services, entities and interfaces
Impact on PCF:
\- Provide discovery related authorization and provision;
Impact on UE:
\- Support model A and model B procedure as described.
## 6.2 Solution #2: V2X based solution for ProSe direct discovery
### 6.2.1 Description
#### 6.2.1.1 General
This solution addresses Key Issue #1 (ProSe Direct discovery) and is mainly
used to support ProSe direct discovery followed by subsequent ProSe direct
communication (e.g. direct communication for playing a game together).
A UE may either listen for other UEs it is interested in, or it may broadcast
its interest e.g. unique UE identity or group identity. TS 23.287 [5] already
has the concept of implicit discovery, as defined in clause 6.3.3 for Unicast
mode link establishment. It is proposed to use PC5-S direct communication
procedure to implement the Direct Discovery.
The ProSe application layer, which in TS 23.287 [5] is the V2X application
layer may provide information which should be either looked for or broadcast
in the direct discovery procedure which includes application information, e.g.
an Application ID and a UE\'s ProSe Application Layer ID.
The Destination Layer-2 ID can be used to indicate if the message is unicast,
groupcast or broadcast. There may also be situations when a unique Destination
Layer-2-ID has been assigned to identify an application (e.g. as in TS 23.287
[5] a V2X service can be assigned a unique Destination Layer-2 ID), in such a
situation it would not be expected to receive Destination Layer 2-ID from the
application layer. In addition, a UE may be interested in only communicating
with another specific UE(s), in such situations a Destination Layer-2-ID may
not be sufficient and there might be a need to look for a specific UE that is
independent of the Destination Layer-2-ID. The procedure is flexible so that
ProSe Layer is provided a set of identities from the ProSe application layer
and from provisioned information the ProSe Layer then uses these identities to
do a match.
The Source Layer-2 ID and Frame type are as described in clause 6.3.1.
### 6.2.2 Procedures
#### 6.2.2.0 Policy/Parameter Description
##### 6.2.2.0.1 Identities
The following identities are required:
a) ProSe Application ID: An identity used by a UE to indicate a specific ProSe
application. The ProSe Application ID is assigned (provided) by the ProSe
application layer and can be used to identify e.g.:
\- An application e.g. Mission Critical Voice, Game A, Game B, Taxi
Communications company Y
b) Destination Layer-2 ID Indicate:
\- A specific target UE layer-2 ID or layer-2 ID for initial signalling.
c) Source Layer-2 ID that is set to a unicast identifier of the transmitter.
d) Source UE\'s ProSe Application Layer ID. An identity used to identify the
source ProSe UE at the application layer. It is provided by the ProSe
Application Layer to the ProSe Layer.
e) Target UE\'s ProSe Application Layer ID. An identity used to identify the
destination ProSe UE at the application layer. It is provided by the ProSe
Application Layer to the ProSe Layer.
f) ProSe Application Layer Group ID. An identity used to identify an
application layer group the UE belongs to.
g) Relay Service Code (for UE-to-Network Relay Discovery):
\- Relay Service Code as defined in TS 23.303 [9].
h) Discovery Group ID (for Group Member Discovery):
\- Discovery Group ID as defined in TS 23.303 [9].
All of the above identities can be either fixed over time or can be dynamic
depending on operator configuration. When an identity is dynamic it will have
a validity timer. Dynamic allocation of the identities by the ProSe
Application layer allows for privacy support.
##### 6.2.2.0.2 Policy/Parameter provisioning
The same concept as in TS 23.287 [5] clause 5.1.1 shall be used.
See TS 23.287 [5] clause 5.1.2. Replace:
\- V2X service by ProSe Application.
\- PISD and ITS-AID by Application ID.
Add the following new requirements:
1) Policy/parameters related to if ProSe application is allowed to use PC5
direct discovery:
\- The list of ProSe Applications that are allowed to use PC5 direct
discovery.
2) Policy/parameters related to Destination Layer-2-ID for or unicast
discovery:
\- The mapping of default Destination Layer-2 ID(s) for initial PC5 direct
discovery.
The parameters (e.g. Relay Service Code, Discovery Group ID) is provisioned by
PCF as defined in solutions for Key Issue #8.
#### 6.2.2.1 General
ProSe Direct Discovery consists of 2 components:
**Listening:** This procedure consists of the UE listening for broadcast data.
Depending on the ProSe Application ID that the UE is wanting to use, the UE
maybe required to listen for any or all of the following:
1 Destination Layer 2-ID;
2 ProSe Application ID;
3\. Source User Info (Source UE\'s ProSe Application Layer ID, ProSe
Application Layer Group ID);
NOTE 1: The Broadcasting UE is the Source UE.
4\. Target User Info (Target UE\'s ProSe Application Layer ID);
NOTE 2: The Target UE is the Listening UE.
5\. Relay Service Code (for UE-to-Network Relay Discovery);
6\. Discovery Group ID (for Group Member Discovery).
**Broadcasting:** This procedure consists of the UE broadcasting data that
other UEs will be listening for. Depending on the ProSe application that the
broadcasting UE is wanting to use, in addition to broadcasting the Origination
and Destination Layer-2-IDs, the broadcasting UE maybe required to also
broadcast any of the following:
1\. ProSe Application ID;
2\. Source User Info(Source UE\'s ProSe Application Layer ID, ProSe
Application Layer Group ID);
3\. Target User Info(Target UE\'s ProSe Application Layer ID);
4\. Relay Service Code;
5\. Discovery Group ID.
Clause 6.2.2.2 is based upon TS 23.287 [5] clause 6.3.3.
#### 6.2.2.2 Implementing ProSe Direct Discovery using the ProSe Direct
Communication Procedure
To perform ProSe Direct Discovery communication over PC5-S reference point,
the UE is configured with the related information as described in clause
6.2.2.0.2.
Figure 6.2.2.2-1 shows the procedure for implementing ProSe Direct Discovery
using the ProSe Direct Communication procedure over PC5 reference point as
defined in TS 23.287 [5] clause 6.3.3.1. It has been modified to align with
Figure 6.1.2.2-1 to show how a UE can obtain authorisation and provisioning
information.
Figure 6.2.2.2-1: ProSe Direct Discovery procedure
0 UEs need to obtain necessary ProSe application layer data to enable them to
participate in ProSe Direct Discovery procedure. This information could be
pre-provisioned or obtained from the ProSe application server similar to
functionality defined in clause 6.3.2.2.
1\. The UE(s) determine the destination Layer-2 ID for signalling reception
for PC5 unicast link establishment.
\- Target User Info (Target UE\'s ProSe Application Layer ID);
2\. The ProSe application layer in UE-1 provides to the ProSe layer for PC5-S
Direct Communication Request at any of the following:
\- ProSe Application ID;
\- Source User Info (Source UE\'s ProSe Application Layer ID, ProSe
Application Layer Group ID);
\- Target User Info (Target UE\'s ProSe Application Layer ID);
\- Destination Layer-2 ID.
NOTE: The content of the PC5-S Direct Communication Request dictates if the
UE-1 is performing Model A or Model B.
The Prose layer shall check to see if the Application ID received from the
ProSe application layer is allowed to use ProSe PC5 communications discovery
per the policy defined in clause 6.2.2.0.2.
a. If the ProSe Application ID is allowed per policy defined in clause
6.2.2.0.2 to use ProSe PC5 discovery, if the ProSe layer:
i. receives a Destination Layer-2-IDs from the ProSe application layer it
shall be used as the Destination Layer-2-ID in step 3; or
ii. did not receive a destination layer 2-ID from the ProSe application layer,
the ProSe layer shall determine if it has a provisioned Destination Layer-2-ID
for that ProSe Application ID as described in clause 6.2.2.0.2 If a
Destination Layer-2 ID:
\- has been provisioned it shall be used in step 3; or
\- has not been provisioned then the ProSe Layer shall determine if a
Destination Layer 2-ID has been provisioned for the type of Communication type
being requested by analysing the ProSe Device ID to determine if group
communication or unicast is being requested e.g. is there a Destination Layer
2-ID provisioned to identify Unicast, Broadcast or Groupcast.
b. If the ProSe Application ID is not allowed per policy defined in clause
6.2.2.0.2 to use ProSe PC5-S discovery then an error shall be indicated to the
ProSe Application Layer. The procedure shall be terminated.
3\. For the Broadcasting UE, UE-1, if the ProSe Layer received Location
information, the ProSe Layer will only send a Direct Communication request
message to announce itself in that location, else the ProSe Layer sends a
Direct Communication request message to announce itself anywhere. The Direct
Communication request message may include any of the following:
\- ProSe Application ID;
\- The Destination Layer-2-IDs as determined in step 2;
\- The Source Layer 2-ID set to self-assigned unicast identity;
\- Source User Info;
\- Target User Info;
\- Relay Service Code (for UE-to-Network Relay Discovery);
\- Discovery Group ID (for Group Member Discovery).
UE-1 sends the Direct Communication Request message via PC5 broadcast or
unicast using the source Layer-2 ID and the destination Layer-2 ID.
4\. Security with UE-1 is established as defined in TS 23.287 [5] clause
6.3.3.1 step 4.
5\. For the listening UE(s), UE-2 to UE-4, the ProSe Layer will listen for a
Direct Communication Request message. Upon receiving a Direct Communication
Request UE-2 will perform a match using the information received in step 1.
UE-2 responds to UE-1 with Direct Communication Accept message. The Direct
Communication Accept message may include any combinations of the parameters:
Application ID, Source User Info, Target User Info, Relay Service Code,
Discovery Group ID.
### 6.2.3 Impacts on services, entities and interfaces
New UE procedures for using Rel-16 V2X unicast mode communication to implement
ProSe Direct Discovery.
PCF needs to support the delivery of the ProSe 5G authorization and
provisioning information using the PCF based Service Authorization and
Provisioning mechanism defined in TS 23.287 [5] clause 6.2.2.
## 6.3 Solution #3: Solution for ProSe 5G Direct Discovery using PC5
communication channel
### 6.3.1 Description
ProSe 5G Direct Discovery using PC5 communication channel relies on signalling
messages that are carried within the same layer-2 frames as those used for V2X
direct communication over NR PC5 reference point defined in TS 23.287 [5],
clause 6.1.1 and 6.1.2.
Figure 6.3.1-1: Layer-2 frame format for ProSe 5G Direct Discovery
A simplified layer-2 frame format for ProSe Direct Discovery is shown in
Figure 6.3.1-1. In reference to the header fields the following applies:
NOTE 1: The exact frame format for the discovery messages will be specified
together with RAN WG2 and CT WG1.
\- The Destination Layer-2 ID that can be set to a unicast, groupcast or
broadcast identifier.
\- The Source Layer-2 ID that is always set to a self-assigned unicast
identifier of the transmitter.
\- Frame type indicates that it is a ProSe Direct Discovery message.
NOTE 2: Which protocol identifier in the Access Stratum the Frame Type field
corresponds to will be decided by RAN WG2. Otherwise, the Frame Type is
assumed to be transparent to Access Stratum.
\- The following ProSe Direct Discovery messages are needed:
\- Announcement message (for Model A discovery as defined in TS 23.303 [9]).
\- Solicitation message (for Model B discovery as defined in TS 23.303 [9]).
\- Response message (for Model B discovery as defined in TS 23.303 [9]).
The information contained in each discovery message is similar to what is
described in TS 23.303 [9] clause 4.6.4.
NOTE 3: Depending on the use cases to be supported in ProSe 5G, not all
information elements defined in TS 23.303 [9] need to be supported. For
example, if only restricted, UE-to-UE Relay Discovery and UE-to-Network Relay
Discovery need to be supported, there is no need for ProSe Application Code
that is only used for open discovery.
### 6.3.2 Procedures
#### 6.3.2.1 Procedures for Direct Discovery Model A and B
Depicted in Figure 6.3.2.1-1 is the procedure for ProSe Direct Discovery with
Model A.
Figure 6.3.2.1-1: ProSe Direct Discovery with Model A
Depicted in Figure 6.3.2.1-2 is the procedure for ProSe Direct Discovery with
Model B.
Figure 6.3.2.1-2: ProSe Direct Discovery with Model B
Editor\'s note: In order to reduce power consumption whether there is an
incentive to reduce the size of information carried in discovery messages and
potentially also define some \"longer\" DRX values compared to the equivalent
values that will be used for communication will be decided in RAN.
#### 6.3.2.2 Procedures for assignment of ProSe identifiers
Depending on the use cases of Direct Discovery e.g. commercial vs. public
safety, and restricted vs. open, etc. the related information in the ProSe
Direct Discovery message is either preconfigured in the UE or assigned
dynamically. For instance, for Group Member Discovery, the information needs
to be pre-configured in the UE in order to support \"out of coverage\"
operation for public safety use. For cases where information needs to be
assigned by the PLMN, the PC3 procedures defined in TS 23.303 [9] clause 5.3
between UE and a ProSe Function can be used, since PC3 is using user plane
(HTTPS) and therefore the procedures are access agnostic. Only the procedures
in clause 5.3 of TS 23.303 [9], i.e. the Direct Discovery Name Management
Function (DDNMF), needs be supported.
The Direct Provisioning Function (DPF) defined in TS 23.303 [9] is replaced by
PCF, based on the V2X architecture as defined in TS 23.287 [5], and is not
supported by the DDNMF. The architecture reference model as described in Annex
B.2 User Plane based architecture, with the following additional
considerations:
\- each PLMN deploys one logical 5G DDNMF;
\- the 5G DDNMF interacts with PCF for the authorization of the ProSe
discovery service;
\- the 5G DDNMF in the HPLMN of a UE may interact with 5G DDNMF of other PLMNs
(e.g. VPLMN/Local PLMN) to perform ProSe identifier allocation and management,
as defined in clause 5.2 of TS 23.303 [9];
\- the 5G DDNMF may interact with the ProSe Application Function for optional
suffixes management for the discovery service as specified in clause 5.3.3 of
TS 23.303 [9].
### 6.3.3 Impacts on services, entities and interfaces
New UE procedures for using ProSe Direct Discovery with NR PC5 communication
channel.
UE and 5G DDNMF need to support the PC3 procedures defined in TS 23.303 [9]
clause 5.3.
PCF needs to support the delivery of the ProSe 5G authorization and
provisioning information using the PCF based Service Authorization and
Provisioning mechanism defined in TS 23.287 [5] clause 6.2.2.
## 6.4 Solution #4: PC5 group communication for commercial services
### 6.4.1 Description
#### 6.4.1.1 General
This solution addresses Key Issue #1 (ProSe Direct discovery) and Key Issue #2
(Support for NR PC5 ProSe communication), and is mainly to support group
communication over PC5 reference point for commercial services, e.g.
interactive services.
Actually, this solution does not propose any new thing for PC5 ProSe
communication, instead focuses on group discovery, formation and management
for group communication.
The following steps describe an outline of the proposed solution:
1) USER#1 initiates to discover other users who are interested in APP#1 and in
proximity by using PC5 reference point. For example, USER#1 wants to play some
interactive game with other users by using group communication over PC5
reference point.
2) USER#1 gets a response from some users who want to play the interactive
game together.
3) A UE of USER#1 (i.e. initiating UE) checks with an Application Server
associated with APP#1 regarding which users among the responding users can
participate in the group communication.
The Application Server provides a list of authorized users, Application Layer
Group ID and if needed Destination IP address to the initiating UE.
4) The initiating UE provides the Application Layer Group ID, Destination
Layer-2 ID and Destination IP address to other member UEs that are authorized
to participate in the group communication by the Application Server.
5) All member UEs can perform the group communication.
As such, dynamic group communication can be achieved in a network controlled
manner.
The application/service performing group communication proposed in this
solution is operated with a group locally formed, that is, whose group member
UEs are in proximity each other. Therefore, any Application Server, e.g.
interactive game server, does not have to be involved to run the
application/service. The Application Server introduced in this solution
exchanges application layer signalling with UEs to support group communication
over PC5 reference point.
#### 6.4.1.2 Differences from groupcast mode of V2X communication over PC5
reference point
The proposed solution has the following main differences from groupcast mode
of V2X communication over PC5 reference point defined in TS 23.287 [5]:
\- Discovery of other UEs participating in group communication is performed by
using PC5 reference point.
NOTE: Whether 1) the messages for the discovery are exchanged by using PC5
direct communication same to V2X services (i.e. Application Layer discovery
messages are considered as user traffic); or 2) the messages for the discovery
are exchanged by using PC5 direct discovery including the transparent
container (i.e. PC5 discovery message format e.g. defined in Solution#3 is
used but only a transparent container IE is needed as IE in the discovery
message) will be decided during the normative phase.
\- Application Server is involved in group management.
\- Application Layer Group ID is provided by the Application Server.
### 6.4.2 Procedures
#### 6.4.2.0 General
NOTE : The application layer signalling messages exchanged between UE and
Application Server in the procedures described in this clause are for
information and out of scope of this study.
#### 6.4.2.1 PC5 group communication establishment for commercial services
The procedure is initiated when a UE wants to perform group communication over
PC5 reference point with other UE(s) for any application, e.g. interactive
game.
Figure 6.4.2.1-1: PC5 group communication establishment for commercial
services
Application Layer discovery messages are used for the messages exchanged over
PC5 reference point in this procedure (i.e. steps 1, 2, 4 and 6).
1\. UE-1 (An initiating UE) sends a Discovery Request message. The broadcasted
Discovery Request message includes:
\- Application ID: the application requesting group communication. This is
provided by the application layer.
\- Application Layer User ID: the initiating UE\'s Application Layer User ID
(i.e. UE-1\'s Application Layer User ID). This is provided by the application
layer.
2\. The UEs that are interested in performing group communication for the
requested application respond to the request by sending a Discovery Response
message (i.e. UE-2, UE-3 and UE-5 in Figure 6.4.2.1-1).
The Discovery Response message includes:
\- Application ID: the application whose group communication was requested.
\- Application Layer User ID: Application Layer User ID of the UE sending the
Discovery Response message (i.e. UE-2\'s Application Layer User ID in step 2a,
UE-3\'s Application Layer User ID in step 2b and UE-5\'s Application Layer
User ID in step 2c). This is provided by the application layer.
After sending the Discovery Request message in step 1, UE-1 collects the
Discovery Response message sent from other UE(s) during a configured time
interval.
More than one UEs send a Discovery Request message including same Application
ID almost simultaneously, so there may be the case that one UE receives
multiple Discovery Request messages including same Application ID. In this
case, the receiving UE responds to one of Discovery Request messages based on
UE implementation or user input.
If privacy support is needed, the Application ID and the Application Layer
User IDs used in step 1 and step 2 may be ones that were encoded, e.g. by the
Application Server. The UE can have its encoded Application Layer User ID
before this procedure.
3\. The application layer of UE-1 checks with an Application Server associated
with the application regarding which users among the responding users (i.e.
UE-2\'s user, UE-3\'s user and UE-5\'s user) can participate in the group
communication.
The Application Server provides a list of authorized users, Application Layer
Group ID and if needed Destination IP address to UE-1.
NOTE 1: UE-1 can continue group communication establishment although Discovery
Response message was received from only one UE in step 2.
4\. UE-1 sends a Discovery Accept message to each member UE that was
authorized to participate in the group communication by the Application Server
(to UE-2 and UE-3 in Figure 6.4.2.1-1).
The Discovery Accept message includes:
\- Application Layer Group ID: provided by the Application Server in step 3.
5\. The application layer of UE-2 and UE-3 may check with an Application
Server associated with the application regarding whether UE-1 is authorized
for the group communication.
6\. UE-2 and UE-3 sends a Discovery Complete message to UE-1 to acknowledge
the Discover Accept message.
The Discovery Complete message includes:
\- Application Layer Group ID: included in the Discovery Accept message.
Each member UE determines the PC5 QoS parameters for this groupcast. (Please
refer to TS 23.287 [5]).
Each member UE determines the Destination Layer-2 ID based on the Application
Layer Group ID.
The ProSe layer of each member UE passes groupcast related
information/parameters such as Layer-2 ID information (i.e. source Layer-2 ID
and destination Layer-2 ID), QoS related information, HARQ operation related
information to the AS layer. The HARQ operation related information (i.e.
Group Size and the UE\'s Member ID) is provided by the application layer of
the UE.
7\. The group formation is completed. UE-1 sends the service data using the
source Layer-2 ID/IP address and the destination Layer-2 ID/IP address by
using groupcast.
NOTE 2: UE-2 and UE-3 can also send the service data using the source Layer-2
ID/IP address and the destination Layer-2 ID/IP address and this is not
illustrated in Figure 6.4.2.1-1 for simplicity.
#### 6.4.2.2 PC5 group communication termination for commercial services
Figure 6.4.2.2-1: PC5 group communication termination for commercial services
1\. The group communication is over in the application layer. For example,
interactive game that UE-1, UE-2 and UE-3 play together ends.
2\. The application layer of UE-1 that initiated the group communication (i.e.
initiating UE) informs the Application Server of termination of the group
communication.
The ProSe layer of each member UE informs the AS layer that this groupcast has
been terminated.
#### 6.4.2.3 PC5 group communication update (group member leaving) for
commercial services
Figure 6.4.2.3-1: PC5 group communication update (group member leaving) for
commercial services
1\. The group communication established as described in clause 6.4.2.1 is
ongoing. For example, UE-1, UE-2, UE-3 and UE-4 are playing together
interactive game.
2\. UE-3 leaves the group communication and this group member leaving is
handled in the application layer, e.g. by exchanging some application layer
signalling messages between UEs.
The ProSe layer of each remaining member UE passes the updated Group Size and
Member ID provided by the application layer to the AS layer.
#### 6.4.2.4 PC5 group communication update (new member joining) for
commercial services
Figure 6.4.2.4-1: PC5 group communication update (new member joining) for
commercial services
1\. Same to step 1 of clause 6.4.2.3.
2\. UE-1 periodically sends broadcasted Discovery Request messages for the
ongoing group communication. If UE-5 attempts to join the group communication,
it will interacts with UE-1 and the Application Server according to the
procedures defined in clause 6.4.2.1. When UE-5 successfully joins the group
communication, the group information will be updated among the group members.
The ProSe layer of each member UE passes the updated Group Size and Member ID
provided by the application layer to the AS layer.
### 6.4.3 Impacts on services, entities and interfaces
**UE:**
\- Performs direct discovery regarding an interested application for group
communication by using PC5 reference point.
\- If 1) in the NOTE described in clause 6.4.1.2 is taken, no impact for
direct discovery.
\- If 2) in the NOTE described in clause 6.4.1.2 is taken, a \"Transparent
Container\" information element needs to be defined to include the Application
Layer discovery messages when defining the structures/formats of PC5 discovery
messages.
\- For a UE initiating the group communication (i.e. initiating UE), checks
the group members with the Application Server by using application layer
signalling and provides Application Layer Group ID assigned by the Application
Server to other member UEs by using PC5 discovery message.
**Application Server:**
\- Checks the group members that can participate in the group communication.
\- Provides Application Layer Group ID to the initiating UE.
## 6.5 Solution #5: ProSe communication based on V2X communication over PC5
### 6.5.1 Description
This solution addresses Key Issue #2 on ProSe communication. The solution
takes V2X communication over PC5 in TS 23.287 [5] as a baseline.
In order to support unicast, groupcast and broadcast communication, the
mechanism defined in TS 23.287 [5] clause 5.2 is reused with the following
differences:
\- Besides IPv6, IPv4 based ProSe communication over NR based PC5 reference
point are supported.
\- IPv4 address allocation for ProSe communication over NR based PC5 reference
point follows the mechanism is defined in TS 23.303 [9] clause 4.5.3.
\- Both Ethernet and Unstructured data unit types are supported by the 5G
ProSe-enabled UE.
### 6.5.2 Procedures
The \"Procedures for V2X communication over PC5 reference point\" defined in
TS 23.287 [5] clause 6.3 is reused to support ProSe communication over NR
based PC5 reference point, and the differences are highlighted as followings.
\- For broadcast and groupcast mode ProSe communication, the procedures as
defined in TS 23.287 [5] clauses 6.3.1 and 6.3.2 are applied with the
following differences are identified:
\- The following data unit types are supported: IP, non-IP, Ethernet,
Unstructured and Address Resolution Protocol (see RFC 826 [10]).
NOTE: Whether \"non-IP type\" is used for \"Unstructured type\" can be decided
in normative phase.
\- The ProSe Group IP multicast address for groupcast communication may be
provisioned by PCF and is used to send and receive IP data.
\- For unicast mode ProSe communication, the procedure as defined in TS 23.287
[5] clause 6.3.3 is applied with the following differences are identified:
\- DHCPv4 based IP address allocation is supported.
\- Both Ethernet and Unstructured data unit types are supported.
### 6.5.3 Impacts on services, entities and interfaces
UE impact:
\- UE is enhanced to support ProSe communication over NR based PC5 reference
point.
## 6.6 Solution #6: Layer-3 UE-to-Network Relay
### 6.6.1 Description
This is a solution for key issue #3, UE-to-Network Relay.
The ProSe 5G UE-to-Network Relay entity provides the functionality to support
connectivity to the network for Remote UEs (see figure 6.6.1-1). It can be
used for both public safety services and commercial services (e.g. interactive
service).
A UE is considered to be a Remote UE for a certain ProSe UE-to-Network relay
if it has successfully established a PC5 link to this ProSe 5G UE-to-Network
Relay. A Remote UE can be located within NG-RAN coverage or outside of NG-RAN
coverage.
Remote UE may perform communication path selection between direct Uu path and
indirect Uu path based on the link quality and the configured threshold (pre-
configured or provided by NG-RAN). For example, if Uu link quality exceeds
configured threshold, the direct Uu path is selected. Otherwise, the indirect
Uu path is selected by performing the UE-to-Network Relay discovery and
selection.
Figure 6.6.1-1: Architecture model using a ProSe 5G UE-to-Network Relay
The ProSe 5G UE-to-Network Relay shall relay unicast traffic (UL and DL)
between the Remote UE and the network. The ProSe UE-to-Network Relay shall
provide generic function that can relay any IP, Ethernet or Unstructured
traffic;
\- For IP traffic over PC5 reference point, the ProSe UE-to-Network Relay uses
IP type PDU Session towards 5GC.
\- For Ethernet traffic over PC5 reference point, the ProSe UE-to-Network
Relay can use Ethernet type PDU Session or IP type PDU Session towards 5GC.
\- For Unstructured traffic over PC5 reference point, the ProSe UE-to-Network
Relay can use Unstructured type PDU Session or IP type PDU Session (i.e. IP
encapsulation/de-capsulation by UE-to-Network Relay) towards 5GC.
The type of traffic supported over PC5 reference point is indicated by the
ProSe UE-to-Network Relay e.g. using the corresponding Relay Service Code. The
UE-to-Network Relay determines the PDU Session Type based on, e.g. ProSe
policy/parameters, URSP rule, Relay Service Code, etc.
NOTE: How the UE-to-NW relay determines PDU session type should be evaluated
independent from other part of this solution while considering other PDU
session parameters, e.g. DNN, SSC mode.
IP type PDU Session and Ethernet type PDU Session can be used to support more
than one Remote UEs while Unstructured type PDU Session can be used to support
only one Remote UE.
NOTE 2: The maximum number of PDU Sessions can affect the maximum number of
Remote UEs that the UE-to-Network Relay can support.
Editor\'s note: Support of non-unicast mode communication (i.e. one-to-many
communication/broadcast or multicast) between network and UE-to-Network Relay
UE and between UE-to-Network Relay and Remote UE(s) depends on the result of
FS_5MBS work.
One-to-one Direct Communication is used between Remote UEs and ProSe 5G UE-to-
Network Relays for unicast traffic as specified in solutions for Key Issue #2.
The protocol stack for Layer-3 UE-to-Network Relays is shown in Figure
6.6.1-2.
Figure 6.6.1-2: Protocol stack for ProSe 5G UE-to-Network Relay
Hop-by-hop security is supported in the PC5 link and Uu link. If there are
requirements beyond hop-by-hop security for protection of Remote UE\'s
traffic, security over PDU layer needs to be applied.
Further security details (integrity and privacy protection for remote UE-Nw
communication) will be specified in SA WG3.
According to the definition of service continuity in TS 22.261 [3] and TS
23.501 [6], it can be seen that \"service continuity\" is different from
\"session continuity\" by definition, and service continuity can be achieved
at application layer regardless of IP address preservation:
\- For Mission Critical Service in Public Safety, service continuity can be
achieved by the application layer mechanism, e.g. as described in Annex B in
TS 23.280 [29].
\- For commercial IMS use cases, service continuity can be achieved using
mechanisms described in TS 23.237 [30].
\- For commercial use cases with application layer out of 3GPP scope (e.g. non
IMS), service continuity can be achieved using similar way, e.g. QUIC.
It is noted that all of the above application layer mechanisms can be reused
for Layer-3 UE-to-Network Relay without any enhancements in this study item.
### 6.6.2 Procedures
A ProSe 5G UE-to-Network Relay capable UE may register to the network (if not
already registered) and establish a PDU session enabling the necessary relay
traffic, or it may need to connect to additional PDU session(s) or modify the
existing PDU session in order to provide relay traffic towards Remote UE(s).
PDU session(s) supporting UE-to-Network Relay shall only be used for Remote
ProSe UE(s) relay traffic.
Figure 6.6.2-1: ProSe 5G UE-to-Network Relay
0\. During the Registration procedure, Authorization and provisioning is
performed for the ProSe UE-to-NW relay(0a) and Remote UE(0b). Authorization
and provisioning procedure may be any solution for key issue #1 and #3.
1\. The ProSe 5G UE-to-Network Relay may establish a PDU session for relaying
with default PDU session parameters received in step 0 or pre-configured in
the UE-to-NW relay, e.g. S-NSSAI, DNN, SSC mode or PDU Session Type. In case
of IP PDU Session Type and IPv6, the ProSe UE-to-Network Relay obtains the
IPv6 prefix via prefix delegation function from the network as defined in TS
23.501 [6].
2\. Based on the Authorization and provisioning in step 0, the Remote UE
performs discovery of a ProSe 5G UE-to-Network Relay using any solution for
key issue #1 and #3. As part of the discovery procedure the Remote UE learns
about the connectivity service the ProSe UE-to-Network Relay provides.
3\. The Remote UE selects a ProSe 5G UE-to-Network Relay and establishes a
connection for One-to-one ProSe Direct Communication as described in TS 23.287
[5].
If there is no PDU session satisfying the requirements of the PC5 connection
with the remote UE, e.g. S-NSSAI, DNN, QoS, the ProSe 5G UE-to-Network Relay
initiates a new PDU session establishment or modification procedure for
relaying.
According to the PDU Session Type for relaying, the ProSe 5G UE-to-Network
Relay performs relaying function at the corresponding layer, e.g. acts as an
IP router when the traffic type is IP, acts as an Ethernet switch when the
traffic type is Ethernet, and performs generic forwarding for Unstructured
traffic.
When the ProSe 5G UE-to-Network Relay uses Unstructured PDU session type for
Unstructured traffic over PC5 reference point, it creates a mapping between
the PC5 Link Identifier and the PDU Session ID, and a mapping between PFI for
PC5 L2 link and the QFI for the PDU Session.
When the ProSe 5G UE-to-Network Relay uses IP PDU session type for Ethernet or
Unstructured traffic over PC5 reference point, it locally assigns an IP
address/prefix for the Remote UE and use that to encapsulate the data from the
Remote UE. For downlink traffic, the ProSe 5G UE-to-Network Relay decapsulates
the traffic from the IP headers and forwards to the corresponding Remote UE
via PC5 reference point.
The ProSe 5G UE-to-Network Relay\'s subscription, and if applicable the Remote
UE\'s subscription, can be considered for QoS decision. if the ProSe 5G UE-to-
Network Relay reports Remote UE\'s SUCI to network, as described in sol#47
step 3,5,7, Relay UE\'s AMF gets Remote UE\'s SUPI from Remote UE\'s AUSF.
Then Relay UE\'s AMF retrieves Remote UE\'s subscribed UE-AMBR from Remote
UE\'s UDM using Remote UE\'s SUPI. Relay UE\'s AMF could also provide Remote
UE\'s SUPI together with N1 SM container (PDU Session Establishment Request)
to Relay UE\'s SMF, then Relay UE\'s SMF retrieves Remote UE\'s subscribed QoS
profile and Subscribed Session-AMBR from Remote UE\'s UDM. Relay UE\'s AMF and
SMF then provides Remote UE\'s subscription to PCF for QoS decision.
The UE-to-Network Relay distinguishes and performs the rate limitation for the
traffic of a specific Remote UE, if the configuration from PCF supports to do
that.
Editor\'s note: How the ProSe UE-to-NW relay determine the requirement of PC5
Connection, e.g. S-NSSAI, DNN, QoS will be specified in other solutions for
KI#3.
Editor\'s note: How to support end-to-end QoS requirement of Remote UE,
including QoS enforcement for PC5 and PDU session for relaying is addressed in
other solutions.
4\. For IP PDU Session Type and IP traffic over PC5 reference point, IPv6
prefix or IPv4 address is allocated for the remote UE as it is defined in TS
23.303 [9] clauses 5.4.4.2 and 5.4.4.3.From this point the uplink and downlink
relaying can start. For downlink traffic forwarding, the PC5 QoS Rule is used
to map the downlink IP packet to the PC5 QoS Flow. For uplink traffic
forwarding, the 5G QoS Rule is used to map the uplink IP packet to the Uu QoS
Flow.
Editor\'s note: General functionality for IPv6 prefix delegation as defined in
TS 23.401 [25] clause 5.3.1.2.6 needs to be added in 5GS and reference to TS
23.501 [6] can be added above.
5\. The ProSe 5G UE-to-Network Relay sends a Remote UE Report (Remote User ID,
Remote UE info) message to the SMF for the PDU session associated with the
relay. The Remote User ID is an identity of the Remote UE user (provided via
User Info) that was successfully connected in step 3. The Remote UE info is
used to assist identifying the Remote UE in the 5GC. For IP PDU Session Type,
the Remote UE info is Remote UE IP info. For Ethernet PDU Session Type, the
Remote UE info is Remote UE MAC address which is detected by the UE-to-Network
Relay. For Unstructured PDU Session Type, the Remote UE info contains the PDU
session ID. The SMF stores the Remote User IDs and the related Remote UE info
(if available) in the ProSe 5G UE-to-Network Relay\'s SM context for this PDU
session associated with the relay.
For IP info the following principles apply:
\- for IPv4, the UE-to-network Relay shall report TCP/UDP port ranges assigned
to individual Remote UE(s) (along with the Remote User ID);
\- for IPv6, the UE-to-network Relay shall report IPv6 prefix(es) assigned to
individual Remote UE(s) (along with the Remote User ID).
Editor\'s note: The privacy protection for Remote User ID depends on SA WG3
design.
The Remote UE Report message shall be sent when the Remote UE disconnects from
the ProSe 5G UE-to-Network Relay (e.g. upon explicit layer-2 link release or
based on the absence of keep alive messages over PC5) to inform the SMF that
the Remote UE(s) have left.
In the case of Registration Update procedure involving SMF change the Remote
User IDs and related Remote UE info corresponding to the connected Remote UEs
are transferred to the new SMF as part of SM context transfer for the ProSe 5G
UE-to-Network Relay.
NOTE 1: In order for the SMF to have the Remote UE(s) information, the HPLMN
and the VPLMN where the ProSe 5G UE-to-Network Relay is authorised to operate,
needs to support the transfer of the Remote UE related parameters in case the
SMF is in the HPLMN.
NOTE 2: When Remote UE(s) disconnect from the ProSe UE-to-Network Relay, it is
up to implementation how relaying PDU sessions are cleared/disconnected by the
ProSe 5G UE-to-Network Relay.
After being connected to the ProSe 5G UE-to-Network Relay, the Remote UE keeps
performing the measurement of the signal strength of PC5 unicast link with the
ProSe 5G UE-to-Network Relay for relay reselection.
The solution can also work when the ProSe 5G UE-to-Network Relay UE connects
in EPS using LTE. In this case for the Remote UE report the procedures defined
in TS 23.303 [9] can be used.
### 6.6.3 Impacts on services, entities and interfaces
The solution has impacts in the following entities:
**SMF:**
\- Needs to support procedures for Remote UE report.
**UE:**
\- Needs to support procedures for Remote UE and ProSe 5G UE-to-Network Relay.
## 6.7 Solution #7: Indirect Communication via Layer 2 UE-to-Network Relay UE
### 6.7.1 Introduction
The solution addresses the following aspect highlighted in key issue #3
(Support UE-to-Network Relay UE):
\- How to transfer data between the Remote UE and the network over the UE-to-
Network Relay UE.
The solution proposes a protocol architecture to support a Layer 2 UE-to-
Network Relay UE (see Annex A).
This solution works only for NR/5GC network relays. It does not apply when the
UE-to-Network Relay UE is out of coverage of NR/5GC.
### 6.7.2 Functional Description
#### 6.7.2.1 General
In this clause, the protocol architecture supporting a L2 UE-to-Network Relay
UE is provided.
The L2 UE-to-Network Relay UE provides forwarding functionality that can relay
any type of traffic over the PC5 link.
The L2 UE-to-Network Relay UE provides the functionality to support
connectivity to the 5GS for Remote UEs. A UE is considered to be a Remote UE
if it has successfully established a PC5 link to the L2 UE-to-Network Relay
UE. A Remote UE can be located within NG-RAN coverage or outside of NG-RAN
coverage.
#### 6.7.2.2 Control and User Plane Protocols
The control and user plane protocols stacks are based on the architectural
reference model described in Annex A.
#### 6.7.2.3 Network Selection
Network selection comprises PLMN selection and access network selection.
Access network selection for a Remote UE comprises UE-to-Network relay
discovery and selection. The Remote UE performs PLMN selection in accordance
with the PLMN selected by the UE-to-Network Relay. The Relay UE provides
serving PLMN information and other PLMNs information (i.e. supported by the
same NG-RAN node serving the Relay UE in MOCN configuration) in System
Information to the Remote UE in order to perform PLMN selection during
discovery.
The Remote UE and UE-to-Network Relay UE are by definition served by the same
NG-RAN.
#### 6.7.2.4 Authorization and provisioning
In order to enable a (Remote) UE out of coverage to gain connectivity to the
network, it is important to allow such UE by means of (pre)configuration to
discover potential UE-to-Network Relay UEs through which it could gain access
to the 5GS. To do so:
Parameters for UE-to-Network Relay UE discovery and for communication over NR
PC5 may be made available to the Remote UE as follows:
\- Pre-configured in the ME and/or configured in the UICC;
\- Provided or updated by the PCF to the UE in the serving PLMN.
It is also important that a UE be authorized to operate as a UE-to-Network
Relay UE. A UE may only operate as a UE-to-Network Relay UE when served by the
network.
Parameters for a UE to operate as a UE-to-Network Relay UE, for discovery of
Remote UEs over NR PC5 and for communication over NR PC5 may be made available
to the UE as follows:
\- Pre-configured in the ME and/or configured in the UICC;
\- Provided or updated by the PCF to the UE in the serving PLMN.
It should be possible for the HPLMN PCF to provide authorization for a UE to
operate as a Remote UE or as a UE-to-Network Relay UE on a per PLMN basis. It
should also be possible for the Serving PLMN to provide/revoke such
authorization in which case it shall override any corresponding information
provided by the HPLMN.
PCF based service authorization and provisioning solution for Layer-2 UE-to-
Network Relay could reuse Solution #35.
#### 6.7.2.5 Registration and Connection Management
##### 6.7.2.5.1 Registration Management
Registration Management for the UE-to-Network Relay UE follows the principles
and procedures defined in TS 23.501 [6] and TS 23.502 [8]. The UE-to-Network
Relay is served by a first AMF.
Registration Management for the Remote UE follows the principles and
procedures defined in TS 23.501 [6] and TS 23.502 [8]. The Remote UE is served
by a second AMF that may or may not be the same as the first AMF.
NOTE: The UE is authorized to act as a UE-to-Network Relay only if the Network
(including RAN/CN) does not restrict it, e.g. authorization, Unified Access
Control, and Remote UE and UE-to-Network Relay are in the same rPLMN or ePLMN.
##### 6.7.2.5.2 Connection Management
Connection Management for the UE-to-Network Relay UE follows at least the
principles and procedures defined in TS 23.501 [6] and TS 23.502 [8].
Connection Management for the Remote UE follows the principles and procedures
defined in TS 23.501 [6] and TS 23.502 [8].
The UE-to-Network Relay may only relay data/signalling for the Remote UE(s)
when the UE-to-Network Relay is in CM-CONNECTED/RRC Connected states. If the
UE-to-Network Relay in CM_IDLE state receives the PC5 connection request from
the Remote UE for relay, the UE-to-Network Relay shall trigger Service Request
procedure to enter CM_CONNECTED state before relaying the signalling.
\- If any Remote UE connected to the UE-to-Network Relay UE is CM-CONNECTED,
the UE-to-Network Relay UE should remain CM-CONNECTED state.
\- If all Remote UEs connected to the UE-to-Network Relay UE enter CM-IDLE,
the UE-to-Network Relay UE may enter CM-IDLE state.
NOTE: The applied state needs to be coordinated and confirmed by RAN WG2.
Impact on RRC Inactive will also be studied by RAN WG2.
When Remote UE is CM-IDLE or CM-CONNECTED, Relay UE and Remote UE keeps the
PC5 link.
For paging Remote UE, the concluded solution in clause 6.6.2 of TR 23.733 [26]
can be reused with adaptations to 5G ProSe.
##### 6.7.2.5.3 NAS level Congestion Control
The UE-to-Network Relay may experience NAS level congestion control, as
specified in clause 5.19.7 of TS 23.501 [6].
When NAS Mobility Management congestion control is activated, i.e. the UE-to-
Network Relay receives Mobility Management back-off timer from the AMF, the
UE-to-Network Relay is not able to properly serve the Remote UE after the UE-
to-Network Relay enters CM_IDLE state. In that case, the UE-to-Network Relay
needs to inform the Remote UE that there is a Mobility Management back-off
timer running at the UE-to-Network Relay, so that the Remote UE is able to
(re)select to another UE-to-Network Relay.
The Remote UE may also subject to NAS level congestion control. The existing
behavior defined in TS 23.501 [6] shall apply.
#### 6.7.2.6 QoS
As shown in Annex A, the NAS endpoints between a Remote UE and the network are
as currently specified such that the operation via a UE-to-Network Relay UE
should be transparent to the network NAS, with the exception of
authorization/provisioning identified in clause 6.7.2.4.
This means that the 5GS flow-based QoS concept in particular should be reused
between the Remote UE and the network, with necessary adaptation over the
radio interface i.e. PC5 (for the Remote UE and UE-to-Network Relay UE) and Uu
(for the UE-to-Network Relay UE). RAN performs QoS enforcement for PC5
interface and Uu interfaces when it gets QoS profile from the CN. For example,
RAN performs QoS enforcement with AS layer configuration with necessary
adaptation over PC5 interface and Uu interface. In other words, QoS flows
established between the network and the Remote UE will be mapped to PC5
\"radio bearers\" seen by the Remote UE and to normal Uu radio bearers seen by
the network, whereby the UE-to-Network Relay UE performs the necessary
adaptation between Uu and PC5.
Editor\'s note: How to perform AS layer configuration for PC5 interface and Uu
interface depends on RAN.
#### 6.7.2.7 Mobility
##### 6.7.2.7.1 Mobility Restrictions
The Remote UE is expected to operate within the boundaries of the Mobility
Restrictions applicable to the UE to Network Relay UE.
Mobility restriction in CM-IDLE state is executed by the UE based on the
information received from the network. For the UE-to-Network Relay case, the
Remote UE may not obtain the mobility restrictions related information if
Remote UE is out of coverage. The Remote UE can get the mobility restrictions
related information, e.g. tracking area, from the Relay UE, and the Remote UE
itself performs network selection and access control in CM_IDLE state based on
the received information.
RAT Restriction:
\- If Remote UE is restricted to use some RAT in a PLMN, the Remote UE is not
allowed to access via UE-to-Network Relay using that RAT in that PLMN. If UE-
to-Network Relay is restricted to use some RAT in a PLMN, the UE-to-Network
Relay is not allowed to perform the Relay operation using that RAT in that
PLMN.
Forbidden Area:
\- If UE-to-Network Relay is in Forbidden Area, it is not allowed to perform
the Relay operation. If the UE-to-Network Relay operates in a Forbidden Area
of the Remote UE, the Remote UE is not allowed to access the network via this
UE-to-Network Relay.
\- A UE-to-Network Relay shall indicate to Remote UEs the Tracking Area of the
cell to which the UE-to-Network Relay is connected. The indication is provided
during discovery.
Service Area Restriction: Allowed Area, Non-Allowed Area:
\- Allowed Area applies as is for a UE-to-Network Relay and Remote UE. A UE-
to-Network Relay (resp. Remote UE) is allowed to initiate communication with
the network (resp. with the network via a UE-to-Network Relay) as allowed by
subscription.
\- A UE-to-Network Relay may only perform UE-to-Network Relay operation in an
Allowed Area.
\- Non-allowed Area applies as is for a UE-to-Network Relay and Remote UE. The
UE (UE-to-Network Relay or Remote UE) and the network are not allowed to
initiate Service Request or SM signalling to obtain user services (both in CM-
IDLE and in CM-CONNECTED states). RM procedures for non-3GPP access aspects
are not applicable for the Remote UE.
\- When the UE-to-Network Relay UE enters a non-allowed Area and the UE-to-
Network Relay cannot provide relay service, it may release the PC5 unicast
connection with a cause code informing the remote UE of UE-to-Network Relay in
Non-allowed area.
NOTE 1: The above bullet on Service Area Restriction changing due to UE-to-
Network Relay\'s mobility will be evaluated separately from other parts of
solution #7.
Core Network type restriction:
\- The CN type restriction applies as is to a UE-to-Network Relay and Remote
UE. A UE-to-Network Relay or Remote UE may only operate as such when not
restricted to use 5GC.
Closed Access Group information:
\- A UE permitted (resp. not permitted) to access a CAG cell is implicitly
permitted (resp. not permitted) to access this CAG cell as a Remote UE via a
UE-to-Network Relay. The Allowed CAG list and CAG-only indication of a UE
apply to this UE when it is a Remote UE.
\- A UE permitted (resp. not permitted) to access a CAG cell is implicitly
permitted (resp. not permitted) to access this CAG cell as a UE-to-Network
Relay. The Allowed CAG list and CAG-only indication of a UE apply to this UE
when it operates as a UE-to-Network Relay.
\- A UE-to-Network Relay shall indicate to Remote UEs the CAG identifiers of
the CAG the UE-to-Network Relay is permitted to access via the cell to which
it is connected. The indication is provided during discovery.
\- A UE-to-Network Relay shall provide its CAG-only indication to Remote UE if
the UE-to-Network Relay is only permitted to access a CAG cell. The CAG
identifiers and CAG-only indication are provided to Remote UEs for UE-to-
Network Relay selection during discovery procedure.
\- A UE-to-Network Relay may send an update of the CAG identifiers and CAG-
only indication to the remote UEs due to UE-to-Network Relay\'s mobility or
UE-to-Network Relay\'s configuration change, e.g. UE Configuration Update
procedure described in TS 23.502 [8] in clause 4.2.4.2. In this case, the
Remote UE may tear down the PC5 connection and re-select another UE-to-Network
Relay if the Remote UE determines that it is not allowed anymore to access the
network via the current UE-to-Network Relay or may re-select the same UE-to-
Network Relay if it is still allowed considering the new configuration.
NOTE 2: The above two bullets on CAG identifiers changing and CAG-only
indication will be evaluated separately from other part of solution 7.
##### 6.7.2.7.2 Other
Mobility of a Remote UE within an NG-RAN node will be handled by the NG-RAN
and the UE-to-Network Relay, allowing the Remote UE to maintain service when
changing from a direct network connection to an indirect network connection
(i.e. via L2 UE-to-Network Relay UE) and vice-versa without 5GC involvement.
Figure 6.7.2.6-1. Intra-NG-RAN mobility (no 5GC involvement)
Inter-NG-RAN mobility is depicted below. Mobility is expected to be possible
with no impact on NAS and most impact on lower layers i.e. RAN WG2.
Figure 6.7.2.6-2: Inter-NG-RAN mobility
#### 6.7.2.8 Security
Security (confidentiality and integrity protection) is enforced at the PDCP
layer between the endpoints at the Remote UE and the gNB. The PDCP traffic is
relayed securely over two links, one between the Remote UE and the UE-to-
Network Relay UE and the other between the UE-to-Network Relay UE to the gNB
without exposing any of the Remote UE\'s plaintext data to the UE-to-Network
Relay.
UP integrity protection is separated for direct PC5 communication and indirect
communication. For indirect communication, the NG-RAN and Remote UE are the
nodes that enforce the UP integrity protection for data transmission between
NG-RAN and Remote UE.
For direct PC5 communication, the UE-to-Network Relay UE and Remote UE are the
nodes that enforce the UP integrity protection for data transmission between
UE-to-Network Relay UE and Remote UE.
NOTE: Further analysis of security requirements will be done in SA WG3.
#### 6.7.2.9 UE-to-Network Relay Discovery and Selection
Model A and Model B can be applied for Layer-2 UE-to-Network Relay discovery.
The detailed UE-to-Network Relay discovery and selection solution for Layer-2
UE-to-Network Relay could reuse Solution #19, with the difference that slicing
and DNN information do not need to be considered. In addition, mobility
restrictions related information such as CAG cell and TA may to be included in
the discovery message.
Editor\'s note: How the Relay discovery can be performed with the PLMN
selection for the Remote UE will be addressed in separate solution for KI#3.
#### 6.7.2.10 Path Selection
For initial access, Remote UE may perform communication path selection between
direct Uu path and indirect Uu path based on the link quality and the
configured threshold (pre-configured or provided by NG-RAN). If the signal
strength of Uu interface is lower than one configured threshold, remote UE
performs discovery procedure to discover a Relay UE for indirect Uu path
selection.
For path switch case, NG-RAN may perform communication path selection based on
the signal level/quality of different paths, which may be based on the path
switch solution.
Editor\'s note: The final solution should be coordinated with RAN WG, and the
specific radio criteria and corresponding thresholds are subject to RAN WG
definition.
### 6.7.3 Procedures
Figure 6.7.3-1: Connection Establishment for Indirect Communication via UE-to-
Network Relay UE
0\. If in coverage, the Remote UE and UE-to-Network Relay UE may independently
perform the initial registration to the network according to registration
procedures in TS 23.502 [8]. The allocated 5G GUTI of the Remote UE is
maintained when later NAS signalling between Remote UE and Network is
exchanged via the UE-to-Network Relay UE.
NOTE 1: The current procedures shown here assume a single hop relay.
1\. If in coverage, the Remote UE and UE-to-Network Relay UE independently get
the service authorization for indirect communication from the network. Service
authorization and parameters provisioning for UE-to-Network Relay operation
are performed for the UE-to-Network Relay UE and Remote UE as specified in
clause 6.7.2.4.
If the Remote UE is not in coverage, the pre-configured information will be
used. If needed, the PCF could update the authorization information after step
7.
If Remote UE has not performed the Initial Registration, the Remote UE can
perform the Initial Registration via the Indirect Network Communication in
step 7.
2-3. The Remote UE and UE-to-Network Relay UE perform UE-to-Network Relay UE
discovery and selection. Relay UE can perform UE-to-Network Relay discovery in
both CM_IDLE and CM_CM-CONNECTED.
For details of UE-to-Network Relay discovery and selection for Layer-2 UE-to-
Network Relay see clause 6.7.2.9 and Solution #19, Solution #41.
4\. Remote UE initiates a one-to-one communication connection with the
selected UE-to-Network Relay UE over PC5 using the procedure as described in
TS 23.287 [5].
5\. If the UE-to-Network Relay UE is in CM_IDLE state, triggered by the
communication request received from the Remote UE, the UE-to-Network Relay UE
sends a Service Request message to its serving AMF.
The Relay\'s AMF may perform authentication of the UE-to-Network Relay UE
based on NAS message validation and if needed the AMF will check the
subscription data.
How to keep the Relay UE in CM_CONNECTED state is proposed in the clause
6.7.2.5.2.
6\. Remote UE sends AS messages to the NG-RAN via the UE-to-NW Relay UE, to
establish an AS Connection with the same NG-RAN serving the Relay UE.
7\. Remote UE sends a NAS message to the serving AMF. The NAS message is
encapsulated in an RRC message that is sent over PC5 to the UE-to-Network
Relay UE, and the UE-to-Network Relay UE forwards the message to the NG-RAN.
Relay UE forwards the Remote UE\'s RRC messages to the gNB using L2 relaying
configuration (i.e. bearer mapping between PC5 and Uu logic channels), and
adds necessary information in the header of the adaptation layer. The NG-RAN
derives Remote UE\'s serving AMF and forwards the NAS message to this AMF.
If Remote UE has not performed the initial registration to the network in step
0, the NAS message is initial registration message. Otherwise, the NAS message
is either a service request message, or a mobility or periodic Registration
message.
If the Remote UE performs initial registration via the UE-to-Network relay,
the Remote UE\'s serving AMF may perform authentication of the Remote UE based
on NAS message validation and if needed the Remote UE\'s AMF checks the
subscription data.
For service request case, User Plane connection for PDU Sessions can also be
activated. The other steps follow the clause 4.2.3.2 in TS 23.502 [8].
8\. Remote UE may trigger the PDU Session Establishment procedure as defined
in clause 4.3.2.2 of TS 23.502 [8]. Remote UE allowed PDU session related
attributes while operating via the UE-to-NW Relay UE are provided during the
registration procedure or through pre-configuration as described in step 0.
9\. The data is transmitted between Remote UE and UPF via UE-to-Network Relay
UE and NG-RAN. The UE-to-Network Relay UE forwards all the data messages
between the Remote UE and NG-RAN using RAN specified L2 relay method.
NOTE 2: If the UE-to-Network Relay disconnects, the NG-RAN will trigger the AN
release procedure of the Remote UE and the Remote UE goes to CM-IDLE.
### 6.7.4 Impacts on services, entities and interfaces
The solution has impacts in the following entities:
AMF:
\- Not initiate the release of the signalling connection based on
authorization of Relay UE.
RAN:
\- Needs to support L2 relay functionality for forwarding the signalling and
user data of the Remote UE.
\- (To support paging option 2 of TR 36.746 [27]), RAN needs to handle paging
request for Remote UE when the Relay UE is CM-CONNECTED.
UE-to-Network Relay UE:
\- Needs to support L2 relay functionality for forwarding the signalling and
user data between the Remote UE and RAN.
\- (To support paging option 2 of TR 36.746 [27]) Relay UE needs to monitor
multiple paging occasions for itself and the remote UEs.
## 6.8 Solution #8: UE-to-UE Relay Selection Without Relay Discovery
### 6.8.1 Description
When a source UE wants to communicate with a target UE, it will first try to
find the target UE by either sending a Direct Communication Request or a
Solicitation message with the target UE info. If the source UE cannot reach
the target UE directly, it will try to discover a UE-to-UE relay to reach the
target UE which may also trigger the relay to discover the target UE. To be
more efficient, this solution tries to integrate target UE discovery and UE-
to-UE relay discovery and selection together, including two alternatives:
\- Alternative 1: UE-to-UE relay discovery and selection can be integrated
into the unicast link establishment procedure as described in clause 6.3.3 of
TS 23.287 [5].
\- Alternative 2: UE-to-UE relay discovery and selection is integrated into
Model B direct discovery procedure.
A new field is proposed to be added in the Direct Communication Request or the
Solicitation message to indicate whether relays can be used in the
communication. The field can be called relay_indication. When a UE wants to
broadcast a Direct Communication Request or a Solicitation message, it
indicates in the message whether a UE-to-UE relay could be used. For Release
17, it is assumed that the value of the indication is restricted to single
hop.
When a UE-to-UE relay receives a Direct Communication Request or a
Solicitation message with the relay_indication set, then it shall decide
whether to forward the message (i.e. modify the message and broadcast it in
its proximity), according to e.g. Relay Service Code if there is any,
Application ID, authorization policy (e.g. relay for specific ProSe Service),
the current traffic load of the relay, the radio conditions between the source
UE and the relay UE, etc.
It may exist a situation where multiple UE-to-UE relays can be used to reach
the target UE or the target UE may also directly receive the Direct
Communication Request or Solicitation message from the source UE. The target
UE may choose which one to reply according to e.g. signal strength, local
policy (e.g. traffic load of the UE-to-UE relays), Relay Service Code if there
is any or operator policies (e.g. always prefer direct communication or only
use some specific UE-to-UE relays).
The source UE may receive the responses from multiple UE-to-UE relays and may
also from the target UE directly, the source UE chooses the communication path
according to e.g. signal strength or operator policies (e.g. always prefer
direct communication or only use some specific UE-to-UE relays).
### 6.8.2 Procedures
#### 6.8.2.1 UE-to-UE relay discovery and selection is integrated into the
unicast link establishment procedure (Alternative 1)
Figure 6.8.2.1-1 5G ProSe UE-to-UE relay selection (Alternative 1)
Figure 6.8.2.1-1 illustrates the procedure of the proposed method.
0\. UEs are authorized to use the service provided by the UE-to-UE relays. UE-
to-UE relays are authorized to provide service of relaying traffic among UEs.
The authorization and the parameter provisioning can use solutions for KI#8,
e.g. Sol#36. The authorization can be done when UEs/relays are registered to
the network. Security related parameters may be provisioned so that a UE and a
relay can verify the authorization with each other if needed.
1\. UE-1 wants to establish unicast communication with UE-2 and the
communication can be either through direct link with UE-2 or via a UE-to-UE
relay. Then UE-1 broadcasts Direct Communication Request with relay_indication
enabled. The message will be received by relay-1, relay-2. The message may
also be received by UE-2 if it is in the proximity of UE-1. UE-1 includes
source UE info, target UE info, Application ID, as well as Relay Service Code
if there is any. If UE-1 does not want relay to be involved in the
communication, then it will made relay_indication disabled.
NOTE 1: The data type of relay_indication can be determined in Stage 3.
Details of Direct Communication Request/Accept messages will be determined in
stage 3.
2\. Relay-1 and relay-2 decide to participate in the procedure. They broadcast
a new Direct Communication Request message in their proximity without
relay_indication enabled. If a relay receives this message, it will just drop
it. When a relay broadcasts the Direct Communication Request message, it
includes source UE info, target UE info and Relay UE info (e.g. Relay UE ID)
in the message and use Relay\'s L2 address as the source Layer-2 ID. The Relay
maintains association between the source UE information (e.g. source UE L2 ID)
and the new Direct Communication Request.
3\. UE-2 receives the Direct Communication Requests from relay-1 and relay-2.
UE-2 may also receive Direct Communication Request message directly from the
UE-1 if the UE-2 is in the communication range of UE-1.
4\. UE-2 chooses relay-1 and replies with Direct Communication Accept message.
If UE-2 directly receives the Direct Communication Request from UE-1, it may
choose to setup a direct communication link by sending the Direct
Communication Accept message directly to UE-1. After receiving Direct
Communication Accept, a UE-to-UE relay retrieves the source UE information
stored in step 2 and sends the Direct Communication Accept message to the
source UE with its Relay UE info added in the message.
After step 4, UE-1 and UE-2 have respectively setup the PC5 links with the
chosen UE-to-UE relay.
NOTE 2: The security establishment between the UE1 and Relay-1, and between
Relay-1 and UE-2 are performed before the Relay-1 and UE-2 send Direct
Communication Accept message. Details of the authentication/ security
establishment procedure are determined by SA WG3. The security establishment
procedure can be skipped if there already exists a PC5 link between the source
(or target) UE and the relay which can be used for relaying the traffic.
5\. UE-1 receives the Direct Communication Accept message from relay-1. UE-1
chooses path according to e.g. policies (e.g. always choose direct path if it
is possible), signal strength, etc. If UE-1 receives Direct Communication
Accept / Response message request accept directly from UE-2, it may choose to
setup a direct PC5 L2 link with UE-2 as described in clause 6.3.3 of TS 23.287
[5], then step 6 is skipped.
6a. For the L3 UE-to-UE Relay case, UE-1 and UE-2 finish setting up the
communication link via the chosen UE-to-UE relay. The link setup information
may vary depending on the type of relay, e.g. L2 or L3 relaying. Then UE-1 and
UE-2 can communicate via the relay. Regarding IP address allocation for the
source/remote UE, the addresses can be either assigned by the relay or by the
UE itself (e.g. link-local IP address) as defined in clause 6.3.3 of TS 23.287
[5].
6b. For the Layer 2 UE-to-UE Relay case, the source and target UE can setup an
end-to-end PC5 link via the relay. UE-1 sends a unicast E2E Direct
Communication Request message to UE-2 via the Relay-1, and UE-2 responds with
a unicast E2E Direct Communication Accept message to UE-1 via the Relay-1.
Relay-1 transfers the messages based on the identity information of UE-1/UE-2
in the Adaptation Layer.
NOTE 3: How Relay-1 can transfer the messages based on the identity
information of UE-1/UE-2 in the Adaptation Layer requires cooperation with
RAN2 during the normative phase.
NOTE 4: In order to make a relay or path selection, the source UE can setup a
timer after sending out the Direct Communication Request for collecting the
corresponding response messages before making a decision. Similarly, the
target UE can also setup a timer after receiving the first copy of the Direct
Communication Request / message for collecting multiple copies of the message
from different paths before making a decision.
NOTE 5: In the first time when a UE receives a message from a UE-to-UE relay,
the UE needs to verify if the relay is authorized be a UE-to-UE relay.
Similarly, the UE-to-UE relay may also need to verify if the UE is authorized
to use the relay service. The verification details and the how to secure the
communication between two UEs through a UE-to-UE relay is to be defined by SA
WG3.
#### 6.8.2.2 UE-to-UE relay discovery and selection is integrated into Model B
direct discovery procedure (Alternative 2)
Depicted in Figure 6.8.2.2-1 is the procedure for UE-UE Relay discovery Model
B, and the discovery/selection procedure is separated from hop by hop and end-
to-end link establishment.
Figure 6.8.2.2-1 5G ProSe UE-to-UE relay selection (Alternative 2)
1\. UE-1 broadcasts discovery solicitation message carrying UE-1 info, target
UE info (UE-2), Application ID, Relay Service Code if any, the UE-1 can also
indicate relay_indication enabled.
2\. On reception of discovery solicitation, the candidate Relay UE-R
broadcasts discovery solicitation carrying UE-1 info, UE-R info, Target UE
info. The Relay UE-R uses Relay\'s L2 address as the source Layer-2 ID.
3\. The target UE-2 responds the discovery message. If the UE-2 receives
discovery solicitation message in step 1, then UE-2 responds discovery
response in step 3b with UE-1 info, UE-2 info. If not and UE-2 receives
discovery solicitation in step 2, then UE-2 responds discovery response
message in step 3a with UE-1 info, UE-R info, UE-2 info.
4\. On reception of discovery response in step 3a, UE-R sends discovery
response with UE-1 info, UE-R info, UE-2 info. If more than one candidate
Relay UEs responding discovery response message, UE-1 can select one Relay UE
based on e.g. implementation or link qualification.
5\. The source and target UE may need to setup PC5 links with the relay before
communicating with each other. Step 5a can be skipped if there already exists
a PC5 link between the UE-1 and UE-R which can be used for relaying. Step 5b
can be skipped if there already exists a PC5 link between the UE-2 and UE-R
which can be used for relaying.
6a. Same as step 6a described in clause 6.8.2.1.
6b. For the Layer-2 UE-to-UE Relay, the E2E unicast Direct Communication
Request message is sent from UE1 to the selected Relay via the per-hop link
(established in steps 5a) and the Adaptation layer info identifying the peer
UE (UE3) as the destination. The UE-to-UE Relay transfers the E2E messages
based on the identity information of peer UE in the Adaptation Layer. The
initiator (UE1) knows the Adaptation layer info identifying the peer UE (UE3)
after a discovery procedure. UE3 responds with E2E unicast Direct
Communication Accept message in the same way.
NOTE 1: For the Layer 2 UE-to-UE Relay case, whether step5b is performed
before step 6b or triggered during step 6b will be decided at normative phase.
NOTE 2: How Relay-1 can transfer the messages based on the identity
information of UE-1/UE-2 in the Adaptation Layer requires cooperation with
RAN2 during the normative phase.
### 6.8.3 Impacts on services, entities and interfaces
UE impacts to support new Relay related functions.
## 6.9 Solution #9: Connection establishment via UE-to-UE Layer-2 Relay
### 6.9.1 Description
#### 6.9.1.1 General
Using the solution described in this clause, a UE-to-UE Relay enables the
discovery of a source UE by a target UE. A UE-to-UE Relay is authorized to
relay messages between two UEs over the PC5 interface via authorization and
provisioning, as defined in clause 6.36 Solution for Key Issue #4: UE-to-UE
Relay Authorization and Provisioning.
The source UE announces its supported applications or discovers a target UE
using a known discovery mechanism, e.g. using user-oriented or service-
oriented methods as defined in TS 23.287 [5].
The UE-to-UE Relay listens for ProSe applications advertisements (e.g. Direct
Discovery or Direct Communication Request messages) from surrounding UEs and
if a broadcasted application matches one of the applications from its
provisioned relay policy/parameters, the UE-to-UE Relay advertises it as a
relayed application by adding a relay indication to the message.
A target UE discovers a source UE via a UE-to-UE Relay. The target UE receives
a broadcast Direct Communication Request message with a relay indication.
A secured \"extended\" PC5 link is set up between the source UE and the target
UE via the UE-to-UE Relay. Source/Target UEs send messages to the UE-to-UE
Relay and receive messages through the UE-to-UE Relay. However, the security
association and the PC5 unicast link are established directly between the
source UE and target UE. The UE-to-UE Relay forwards the messages in opaque
mode, without the ability to read, modify their content or replay them, with
the exception of the Discovery messages and Direct Communication Request
message that are sent in cleartext (i.e. without security protection), visible
to the UE-to-UE Relay, and are modified to add the relay indication. The
source/target UEs detect that the link establishment is going through a UE-to-
UE Relay upon detecting a relay indication included in the received messages.
The UE-to-UE Relay maintains a management connection between the Relay UE and
each Source/Target UE, and also maintains 1 or more \"extended\" end-to-end
PC5 unicast links between a Source UE and Target UE(s). The UE-to-UE Relay
forwards messages between the Source UEs and Target UEs using an Adaption
Layer. The details of the identity information of Source UE and Target UE used
to forward or route messages in the Adaption Layer will be defined in
cooperation with RAN WGs during normative phase.
NOTE: Additional security-related parameters and procedures may be needed for
the protection of relay related messages. Their definitions need to be
coordinated with SA WG3.
Link management (i.e. keepalive, link modification, link identifier update and
link release) is supported over direct unicast links and needs to be supported
over extended PC5 links as well. Since the security association of extended
PC5 links is between the peer UEs, all messages sent over the extended PC5
link, including link management (i.e. PC5-S) messages, may only be processed
by those two UEs.
#### 6.9.1.2 Control and User Plane Protocol Stacks
The control and user plane protocols stacks are based on the architectural
reference model described in Annex A.
### 6.9.2 Procedures
#### 6.9.2.1 Connection establishment
Connection establishment for L2 UE-to-UE relay includes two cases:
\- Connection establishment integrating UE-to-UE relay discovery and
selection, and
\- Connection establishment after UE-to-UE relay discovery and selection
##### 6.9.2.1.1 Connection establishment integrating UE-to-UE relay discovery
and selection
The two methods defined in TS 23.287 [5], i.e. service-oriented and user-
oriented are supported using the procedure described in this clause.
Figure 6.9.2.1.1-1 shows the peer discovery and unicast link establishment
over PC5 reference point via a UE-to-UE Relay.
Figure 6.9.2.1.1-1: Connection establishment procedure integrating UE-to-UE
relay discovery and selection
0\. UE-to-UE Relay registers with the network and has provided its UE-to-UE
Relay capabilities. The authorization and the parameter provisioning can use
solutions for KI#8, and the UE-to-UE Relay is provisioned with relay policy
parameters.
NOTE 1: Step 0 is optional and the policy parameters may be pre-configured.
1\. The target UEs (i.e. UE2, UE3 and UE4) determine the destination Layer-2
ID for signalling reception for PC5 unicast link establishment as specified in
TS 23.287 [5] clause 5.6.1.4. The destination Layer-2 ID is configured with
the target UEs as specified in TS 23.287 [5] clause 5.1.2.1.
2\. On the source UE (i.e. UE1), the application layer provides information to
the ProSe layer for PC5 unicast communication (e.g. broadcast Layer-2 ID,
ProSe Application ID, UE\'s Application Layer ID, target UE\'s Application
Layer ID, relay applicable indication), as specified in TS 23.287 [5] clause
6.3.3.1.
ProSe layer triggers the peer UE discovery mechanism by sending an E2E
broadcast Direct Communication Request message. The message is sent using the
source Layer-2 ID and broadcast Layer-2 ID as destination, and includes other
parameters related to the application offered, as specified in TS 23.287 [5]
clause 6.3.3.1.
3\. The UE-to-UE Relay receives the broadcast Direct Communication Request
message and verifies if it\'s configured to relay this application, i.e. it
compares the announce ProSe Application ID with its provisioned relay
policy/parameters
The UE-to-UE Relay forwards the E2E broadcast Direct Communication Request
message by using its own Layer-2 ID as Source L2 ID, and additionally includes
the Relay UE\'s ID in the message and specifies info identifying UE1 in
Adaptation layer.
NOTE 2: The UE-to-UE Relay handles this E2E broadcast message in the ProSe
layer, and forwards any subsequent E2E PC5-S message based on adaptation layer
info.
NOTE 3: UEs, e.g. UE-3, may receive Direct Communication Request message
directly from UE1 (without adaptation layer info) or Direct Communication
Request message via UE-to-UE relay (with adaptation layer info).
4a. Target UE3 is interested in the announced application, it triggers the
per-hop link establishment with the UE-to-UE Relay if there is not existing
per-hop link between UE3 and UE-to-UE Relay. UE3 sends a per-hop link
establishment procedure message with its Layer-2 ID as the source and the
Layer-2 ID from the relay as the destination.
NOTE 4: Whether per-hop link update is performed if there is existing per-hop
link can be determined in normative phase.
4b. The per-hop link establishment procedure is performed between the UE-to-UE
relay and UE1, if there is not an existing per-hop link between the UE-to-UE
relay and UE1. UE1 puts its Layer-2 ID as the source and Relay Layer-2 ID as
the destination.
5\. If step 4a is successful, E2E Authentication and security establishment
messages are exchanged between UE1 and UE3 via the UE-to-UE Relay. including
the Adaptation layer identifying the source and/or destination UE. At the
reception of this first message from UE3 via the Relay, the per-hop link
establishment procedure is performed between the UE-to-UE relay and UE1, if
there is not an existing per-hop link between the UE-to-UE relay and UE1.
Editor\'s note: The Details of the authentication and security procedure will
be investigated by SA WG3 group.
NOTE 5: Step4b is triggered by step 5 when the UE-1 receives first security
message from UE-3.
6\. Once the end-to-end security is established between UE3 and UE1, UE3
completes the end-to-end link establishment between UE3 and UE1 by sending an
E2E unicast Direct Communication Accept message including the Adaptation layer
info identifying UE1.
7\. UE-to-UE Relay forwards the E2E unicast Direct Communication Accept
message, including the Adaptation layer info identifying UE3.
NOTE 6: The details of the Adaptation layer information identifying the Source
UE and Target UEs, and how to differentiate the E2E PC5-S message from the
per-hop PC5-S message will be defined in cooperation with RAN WGs during
normative phase.
8\. An \"extended\" unicast link has been established between UE1 and UE3, via
the UE-to-UE Relay. The extended link is secured end to end, i.e. a security
association has been created between UE1 and UE3. Confidentiality and/or
integrity/replay protected messages (i.e. data or PC5-S) may be exchanged
between UE1 and UE3. The UE-to-UE Relay is not involved in the security
association thus it cannot read nor modify the secured portion of the message
(which excludes the source and destination fields).
In addition, the UE-to-UE Layer-2 Relay operation is also supported with the
following principles:
\- UE-to-UE Relay selection.
It may be the situation where multiple UE-to-UE relays can be used to achieve
the indirect communication between the target UE and source UE. The selection
of the UE-to-UE Relay may be based on local configured rules on the UE, or
based on other UE-to-UE Relay selection solutions, e.g. \"UE-to-UE Relay
Selection Without Relay Discovery\" described in clause 6.8.
\- QoS handling.
During the process of the connection establishment between the Source UE1 and
the Target UE3, the Source UE1 negotiates the PC5 QoS parameters with Target
UE3 for fulfilling E2E QoS requirements. After the E2E QoS negotiations as
part of the E2E extended unicast link establishment/setup, as described in
Solution#31, PC5 QoS parameters for PC5 link between the Source UE and UE-to-
UE Relay UE and PC5 link between the UE-to-UE Relay UE and Target UE are
determined. AS layer configurations for PC5 QoS parameters in each PC5 link
can be achieved according to legacy mechanisms in Rel-16 V2X.
QoS flow concept in particular can be reused between the Source UE and the
Target UE, where the UE-to-UE Relay UE performs the necessary adaptation
between two PC5 interfaces, i.e. PC5 for the Source UE and UE-to-UE Relay UE
and PC5 for the UE-to-UE Relay UE and Target UE.
Editor\'s note: The details of the adaptation between two PC5 interfaces are
confirmed by RAN WG2.
\- Charging support.
The charging for Source UE and Target UE can be based on charging usage
information configuration and UE reporting usage information. Solution for
charging usage information configuration can reuse the PCF based solution,
i.e. Solution #14. Solution for UE reporting usage information can reuse SMF
based or AMF based solution, i.e. Solution #13 or Solution #15.
##### 6.9.2.1.2 Connection establishment after UE-to-UE relay discovery and
selection
Figure 6.9.2.1.2-1 shows the connection establishment procedure after UE-to-UE
relay discovery and selection. The UE-to-UE relay discovery can be Model A or
Model B. For the Model B, this procedure corresponds to the Alternative 2 in
Clause 6.8.2.2 of Solution #8, where the UE-to-UE relay discovery and
selection is integrated into Model B direct discovery procedure.
Figure 6.9.2.1.2-1: Connection establishment procedure after UE-to-UE relay
discovery and selection
The Step 0 and Step 1 are same as the steps described in clause 6.9.2.1.1.
2\. The standalone UE-to-UE relay discovery and relay selection is performed,
including the Model A or Model B.
3\. If there is not an existing per-hop link between the UE1 and the selected
Relay UE, UE1 establishes a new per-hop link with the selected Relay UE.
4\. The E2E unicast Direct Communication Request message is sent from UE1 to
the selected Relay via the per-hop link (established in steps 3) and the
Adaptation layer info identifying the peer UE (UE3) as the destination. The
UE-to-UE Relay transfers the E2E messages based on the identity information of
peer UE in the Adaptation Layer. The initiator (UE1) knows the Adaptation
layer info identifying the peer UE (UE3) after a discovery procedure. UE3
responds with E2E unicast Direct Communication Accept message in the same way.
If there is not existing per-hop link between the Relay and UE3, the UE3
establishes per-hop.
NOTE: Whether per-hop link establishment between the Relay and UE3 can be
triggered by UE3 or Relay will be determined in normative phase.
#### 6.9.2.2 Connection Management
##### 6.9.2.2.1 Link Identifier Update via a Management Link with the UE-to-UE
Relay
Figure 6.9.2.2-1 shows the link identifier update procedure when an extended
PC5 link is used. The procedure uses a management link established between UE1
and the UE-to-UE Relay serving this extended link and another management link
established between UE2 and the same UE-to-UE Relay.
NOTE: The details of the link identifier update procedure can be aligned
during normative phase.
Figure 6.9.2.2-1: Link Identifier Update procedure via a Management Link with
a UE-to-UE Relay
0) An \"extended\" unicast link is established between two peer UEs via a UE-
to-UE Relay, i.e. as described in clause 6.9.2.1 with end-to-end security
enabled.
1) UE1 receives a trigger (e.g. privacy timer expiry or Application Layer ID
change) to update its identifiers (i.e. Layer-2 ID, security information,
Application Layer ID or IP address/prefix) associated to the extended link
with UE2. The management link between UE1 and UE-to-UE Relay has already been
established.
2) UE1 updates its identifiers (i.e. Layer-2 ID, security information and
optionally Application Layer ID and IP address/prefix) and sends a Link
Identifier Update Request message to the UE-to-UE Relay via the management
link. The message includes UE1\'s new Layer-2 ID and an indication (e.g.
\"extended link\" indication) which specifies that the message is related to
an extended link, i.e. it does not apply to the management link per se. The
message also includes the UE-to-UE Relay\'s Layer-2 ID and UE1\'s Layer-2 ID
used to identify the extended link.
a. Other identifiers (i.e. security info, Application Layer ID and IP
address/prefix) are not included since they are not used by the UE-to-UE Relay
and should not be exposed to the UE-to-UE Relay.
3) UE-to-UE Relay saves UE1\'s new Layer-2 ID in its mapping table, while
preserving the current one, and updates its own Layer-2 ID to replace the
current UE-to-UE Relay L2 ID used on the extended link and known by UE2. It
replies with Link Identifier Update Response message including its new UE-to-
UE Relay Layer-2 ID and the \"extended link\" indication.
4) UE1 sends a Link Identifier Update Request message to UE2 including the new
UE-to-UE Relay L2 ID received at step 3, UE1\'s updated security information
and optionally new Application Layer ID and IP address/prefix.
a. The Link Identifier Update Request message is used as usual, except for the
new L2 ID parameter that carries the new UE-to-UE Relay L2 ID to be used by
UE2.
5) UE2 keeps track of the received parameters. The management link between UE2
and the UE-to-UE Relay has already been established.
6) As for UE1 in step 2, UE2 updates its identifiers associated to the
extended link with UE1 and sends a Link Identifier Update Request message to
UE-to-UE Relay via the management link. The Link Identifier Update Request
message includes the \"extended link\" indication, the current UE-to-UE
Relay\'s Layer-2 ID and UE2\'s Layer-2 ID (to identify the extended link) as
well as UE2\'s new Layer-2 ID associated to the extended link.
7) UE-to-UE Relay saves UE2\'s new Layer-2 ID in its mapping table, while
preserving the current one, and updates its own Layer-2 ID to replace the
current UE-to-UE Relay L2 ID used on the extended link and known by UE1. It
replies with Link Identifier Update Response message including its new UE-to-
UE Relay Layer-2 ID and the \"extended link\" indication.
8) UE2 sends a Link Identifier Update Response message to UE1 including the
new UE-to-UE Relay L2 ID received at step 7, UE2\'s updated security
information and optionally new Application Layer ID and IP address/prefix. UE2
also includes the parameters received on the Link Identifier Update Request
message at step 4.
9) UE1 keeps track of the received updated parameters from UE2 and sends a
Link Identifier Update Ack message to UE2, including the parameters received
on the Link Identifier Update Response message at step 8.
10) UE1 sends a Link Identifier Update Ack message to the UE-to-UE Relay,
including the new UE-to-UE Relay Layer-2 ID received at step 3 and the
\"extended link\" indication.
UE2 sends a Link Identifier Update Ack message to the UE-to-UE Relay,
including the new UE-to-UE Relay Layer-2 ID received at step 7 and the
\"extended link\" indication. All UEs (i.e. UE1, UE2 and UE-to-UE Relay) start
using the new Layer-2 IDs, new security information and optionally new
Application Layer ID and new IP address/prefix.
### 6.9.3 Impacts on services, entities and interfaces
The solution has impacts in the following entities:
UE:
\- Needs to support procedures for ProSe 5G UE-to-UE Relay and communications
via a ProSe 5G UE-to-UE Relay.
\- Needs to support procedures for extended communication management, via
communication with a ProSe 5G UE-to-UE Relay.
## 6.10 Solution #10: ProSe 5G Layer-3 UE-to-UE Relay based on IP routing
### 6.10.1 Description
In this solution, the ProSe 5G UE-to-UE Relay operations is supported with the
following principles:
\- Authorization and configuration:
\- Only the UE authorized by the service authorization configuration can act
as a ProSe 5G UE-to-UE Relay. These UEs will be configured according to the
service authorization and provisioning mechanism defined in TS 23.287 [5] to
operate in the UE-to-UE Relay mode.
\- ProSe 5G UE-to-UE Relay discovery:
\- The ProSe 5G UE-to-UE Relay sends out a Relay Discovery message
periodically, announcing its availability for serving other UEs in the area.
\- The ProSe 5G UE-to-UE Relay also supports the query and response mode for
discovery. The ProSe 5G UE-to-UE Relay listens on a configured Layer-2 ID for
the query, and would respond with its address and corresponding information to
enable to other UE to establish a unicast connection with it. This process is
similar to the unicast L2 link establishment procedure as defined in TS 23.287
[5] clause 6.3.3.1.
NOTE 1: The Layer-2 ID used for the discovery can be specific for UE-to-UE
Relay discovery, or shared with other discoveries, e.g. UE-to-Network Relay
discovery.
\- ProSe 5G UE-to-UE Relay operation:
\- Any UE that wants to make use of the ProSe 5G UE-to-UE Relay needs to
establish a unicast L2 link with the UE-to-UE Relay, with IP configuration.
The ProSe 5G UE-to-UE Relay allocates IP address/prefix to the other UEs.
\- As part of the unicast L2 link establishment procedure, the ProSe 5G UE-to-
UE Relay stores an association of the User Info of the peer UE of the unicast
link (or ProSe Service provided by the peer UE) and the IP address/prefix
allocated to the UE into its DNS entries. The ProSe 5G UE-to-UE Relay acts as
a DNS server to other UEs.
\- When a (source) UE needs to communicate with another (target) UE or needs
to discover a ProSe service via the ProSe 5G UE-to-UE Relay, it sends a DNS
query for the target UE (based on Target User Info) or for the ProSe Service
to the ProSe 5G UE-to-UE Relay over the unicast link, which will return the IP
address/prefix of the target UE or the IP address(es)/prefix(es) of UEs which
provide the ProSe Service.
If there are multiple UEs supporting the same ProSe Service, the (source) UE
can select a UE(s) based on UE implementation.
\- The source UE sends the IP data or non-IP data encapsulated in IP to the
target UE or to the selected UE(s) which provide(s) the ProSe Service via the
unicast L2 link to UE-to-UE Relay that returned the IP address/prefix of the
target UE or UE(s) which provide(s) the ProSe Service. The ProSe 5G UE-to-UE
Relay acts as an IP router, and forwards the packets to the corresponding
unicast L2 link towards the target UE or UE(s) which provide(s) the ProSe
Service. Each of the unicast L2 link is treated as an IP interface.
\- If there are multiple ProSe 5G UE-to-UE Relays in the proximity, UE can
choose either one or more ProSe 5G UE-to-UE Relays to establish the unicast L2
link based on UE implementation. For example, the UE sends a DNS query on each
of the unicast L2 link to the ProSe 5G UE-to-UE Relays. Then, the source UE
may choose to use the first ProSe 5G UE-to-UE Relay that returns a positive
DNS query for the target UE.
NOTE 2: The selection of the UE-to-UE Relay may be based on local configured
rules on the UE, or based on other discovery solutions, e.g. \"Stateful UE-to-
UE Relay\" described in clause 6.11.
\- QoS handling:
\- When the source UE establishes the unicast L2 link with the ProSe 5G UE-to-
UE Relay, it can establish corresponding PC5 QoS Flows according to procedure
defined in clause 6.3.3.1 of TS 23.287 [5]. It can also modify the PC5 QoS
Flows at any time using procedure defined in clause 6.3.3.4 of TS 23.287 [5].
\- Correspondingly, the ProSe 5G UE-to-UE Relay can also establish and modify
the PC5 QoS Flows using the above-mentioned procedures over the unicast L2
Link with the target UE based on PC5 Packet Filter received from the source UE
during the PC5 QoS flow establishment/modification procedure or destination IP
address of IP packet received from the source UE for the forwarding of source
UE\'s traffic. The ProSe 5G UE-to-UE Relay determines the PC5 QoS parameters
of PC5 QoS Flows with target UE based on corresponding PC5 QoS Flows with
target UE.
\- Security handling:
\- source UE and target UE can establish bearer level security with the UE-to-
UE Relay for the unicast L2 Link, using procedures defined in TS 23.287 [5].
\- If end-to-end security protection is required between source UE and target
UE, IPSec can be used.
NOTE 3: The security protection of the traffic of source UE and target UE will
be specified by SA WG3.
\- Charging Support:
\- ProSe 5G UE-to-UE Relay can follow the charging solution defined in TS
32.277 [13] to report the source and target UEs and corresponding traffic to
the charging function.
### 6.10.2 Procedures
Figure 6.10.2-1: 5G ProSe UE-to-UE Relay operation
Figure 6.10.2-1 provides an example operation for the 5G ProSe UE-to-UE Relay
operation based on standard IP operation.
### 6.10.3 Impacts on services, entities and interfaces
There is no impact to NG-RAN, as the solution is using the existing features
supported in Rel-16 NR V2X design.
UEs operate with existing IP operation, and the ProSe 5G UE-to-UE Relay
supports the IP router function (for IP address allocation and traffic
forwarding) and the functionality of a DNS server.
## 6.11 Solution #11: Stateful UE-to-UE Layer-2 or Layer-3 Relay for Public
Safety
### 6.11.1 Introduction
The solution applies to Key Issue #4 \"Support for UE-to-UE Relay\".
The procedure for discovery of UE-to-UE Relay in this solution is based on TR
23.713 [14] clause 6.1.2.4.
The communication via the stateful UE-to-UE Relay can be performed at either
Layer-3 (6.11.3.2.2) or at Layer-2 (refer to clause 6.11.3.2.3).
### 6.11.2 Functional Description
In reference to Figure 6.11.2-1, the UE-to-UE Relay (UE-R) is a logical
functionality that assists a UE (e.g. UE-1) to discover its group members
(e.g. UE-2) which may not be reachable directly over NR PC5, but each of which
is reachable via the UE-to-UE Relay. Once the UE discovers other group member
UEs that are reachable via the UE-to-UE Relay, it can engage in communication
with them, the UE-to-UE Relay acting as a Layer-3 relay.
Figure 6.11.2-1: Stateful UE-to-UE Relay
The UE-to-UE Relay performs the following functionality:
\- Group Member Discovery using Model A or Model B discovery as defined in TS
23.303 [9].
\- UE-to-UE Relay Discovery using the procedures defined in clause 6.11.3.1.
\- Acting as Layer-3 relay for communication between UEs using the procedures
defined in clause 6.11.3.2.
### 6.11.3 Procedures
#### 6.11.3.1 UE-to-UE Relay discovery
##### 6.11.3.1.1 Model A
Depicted in figure 6.11.3.1.1-1 is the procedure for UE-to-UE Relay discovery
Model A.
Figure 6.11.3.1.1-1: UE-to-UE Relay discovery with Model A
1\. UE-1 (\"this UE\") performs the Group Member Discovery procedure (either
Model A or Model B) as defined in TS 23.303 [9]. In the process UE-1 discovers
UE-R as its only neighbour.
2\. UE-R (\"the potential relay\") also performs the Group Member Discovery
procedure (either Model A or Model B). In the process UE-R discovers two UEs
in vicinity: UE-1 and UE-2.
NOTE 1: The execution of the Group Member Discovery procedure in steps 1 and 2
is a pre-requisite for the execution of the UE-to-UE Relay discovery procedure
proper that only starts at step 3. Each of the UEs periodically performs the
Group Member Discovery procedure in order to keep an up-to-date list of the
neighbouring UEs that are directly reachable via NR PC5.
3\. UE-R decides that it can act as a UE-to-UE Relay and announces this by
periodically transmitting an Announcement message including the following
parameters:
\- Type = Announcement.
\- Discovery Type = UE-to-UE Relay Discovery.
\- Announcer Info (i.e. an upper layer identifier for the UE-R user).
\- ProSe UE ID of UE-R (i.e. Layer-2 identifier of UE-R).
\- A list of \"Target User Info\" parameters (including users of UE-1 and
UE-2) that have been gathered during Group Member Discovery in step 2.
\"Target User Info\" is an upper layer parameter identifying the target user.
To support Layer-2 communication via the stateful UE-to-UE Relay, the \"Target
User Info\" also includes the Layer-2 identifier of the target user\'s UE.
4\. Based on the information received in the previous step, UE-1 decides to
establish a one-to-one communication link with UE-R and engage in
communication with UE-2 via UE-R, as described in clause 6.11.3.2.
##### 6.11.3.1.2 Model B
Depicted in figure 6.11.3.1.2-1 is the procedure for UE-UE Relay discovery
Model B.
Figure 6.11.3.1.2-1: UE-to-UE Relay discovery with Model B
1-2. These steps are identical to steps 1-2 in Figure 6.11.3.1.1-1.
NOTE: The execution of the Group Member Discovery procedure in steps 1 and 2
is a pre-requisite for the execution of the UE-to-UE Relay discovery procedure
proper that only starts at step 3. Each of the UEs periodically performs the
Group Member Discovery procedure in order to keep an up-to-date list of the
neighbouring UEs that are directly reachable via NR PC5.
3\. Having discovered its neighbours, UE-1 realises that the group member of
interest (\"target user\") is not within direct range over NR PC5. UE-1 then
(in the role of Discoverer) solicits potential UE-to-UE Relays by transmitting
the Solicitation message including the following parameters:
\- Type = Solicitation.
\- Discovery Type = UE-to-UE Relay Discovery.
\- Discoverer Info (i.e. an upper layer identifier for the UE-1 user).
\- ProSe UE ID of UE-1 (i.e. layer-2 identifier of UE-1).
\- A list of \"Target User Info\" parameters corresponding to the target
user(s) of interest (in this case it is the user of UE-2). \"Target User
Info\" is an upper layer parameter identifying the \"target user\" of
interest.
4\. Upon reception of the Solicitation message, UE-R (in the role of
Discoveree) realises that it can act as a UE-to-UE Relay and replies with a
Response message including the following parameters:
\- Type = Response.
\- Discovery Type = UE-to-UE Relay Discovery.
\- Discoveree Info (i.e. an upper layer identifier for the UE-R user).
\- ProSe UE ID of UE-R (i.e. layer-2 identifier of UE-R).
\- A list of \"Target User Info\" parameters corresponding to the target
user(s) of interest (in this case it is the user of UE-2). The latter have
been gathered during Group Member Discovery in step 2. To support Layer-2
communication via the stateful UE-to-UE Relay, the \"Target User Info\" also
includes the Layer-2 identifier of the target user\'s UE.
5\. Based on the information received in the previous step, UE-1 decides to
establish a one-to-one communication link with UE-R and engage in
communication with UE-2 via UE-R, as described in clause 6.11.3.2.
#### 6.11.3.2 Communication via the stateful UE-to-UE Relay
##### 6.11.3.2.1 General
The communication via the stateful UE-to-UE Relay can be performed at either
Layer-2 or Layer-3.
##### 6.11.3.2.2 Communication via stateful Layer-3 UE-to-UE Relay
When the communication via the stateful UE-to-UE Relay is performed at
layer-3, the simplified Layer-2 format for ProSe 5G communication is decpited
in Figure 6.11.3.2.2-1.
Figure 6.11.3.2.2-1: Layer-2 frame format for ProSe 5G communication via
Layer-3 UE-to-UE Relay
When UE1 sends a packet to UE2 via the Relay, in reference to Figure
6.11.3.2.2-1 the fields in the Layer-2 header are ste as follows:
\- Source Layer-2 ID: Identifies the sender of the data (UE-1).
\- Destination Layer-2 ID: Identifies the Relay (UE-R).
The final destination (i.e. UE-2) is identified via the Destination IP address
in the IP packet header.
NOTE: The Layer-2 frame in Figure 6.11.3.2.2-1 is a high-level illustration of
the required addressing functionality in Layer-2 header. The exact Layer-2
frame format is in the scope of RAN WGs.
The procedures for communication via the stateful UE-to-UE Layer-3 Relay are
performed at layer-3 as described in clause 6.10, the stateful UE-to-UE Relay
acting as an IP router.
##### 6.11.3.2.3 Communication via stateful Layer-2 UE-to-UE Relay
When the communication via the stateful UE-to-UE Relay is performed at
layer-2, the Layer-2 frame header is used as illustrated in Figure
6.11.3.2.2-1. In addition to the Source Layer-2 ID and Destination Layer-2 ID
fields, the header has in addition a \"Relay Layer-2 ID\" field and a
\"Direction\" field:
\- \"Relay Layer-2 ID\": identifies the UE-to-UE Relay.
\- \"Direction\" indicates whether the Layer-2 frame is being transmitted \"To
the Relay\" or \"From the Relay\".
Figure 6.11.3.2.3-1: Extended Layer-2 frame format for ProSe 5G communication
via Layer-2 UE-to-UE Relay
When UE-1 wishes to send data to UE-2 via UE-R, the addressing identifiers in
the Layer-2 frame are set as follows:
\- Source Layer-2 ID: identifies UE-1.
\- Destination Layer-2 ID: identifies UE-2.
\- Relay Layer-2 ID: identifies the Relay (UE-R).
\- Direction = \"To Relay\".
When UE-R forwards the Layer-2 frame to UE-2, the addressing identifiers in
the Layer-2 frame are set as follows:
\- Source Layer-2 ID: identifies UE-1.
\- Destination Layer-2 ID: identifies UE-2.
\- Relay Layer-2 ID: identifies UE-R.
\- Direction = \"From Relay\".
NOTE1: The Layer-2 frame in Figure 6.11.3.2.3-1 is a high-level illustration
of the required addressing functionality in Layer-2 header. The exact Layer-2
frame format is in the scope of RAN WGs.
NOTE2: The \"Direction\" field is used by the final receiver (UE-2) to
eliminate duplicate frames in case UE-2 enters in direct transmission range of
UE-1.
### 6.11.4 Impacts on services, entities and interfaces
**UE:**
\- New functionality related to UE-to-UE Relay discovery, as well as
communication via UE-to-UE Relay.
## 6.12 Solution #12: Policy based network-assisted Path Selection
### 6.12.1 Description
This solution addresses Key Issue #5 for the case without Relay. In this
solution, the UE, assisted by network provided policy rules, selects a path
for direct communication (either 5GC path via Uu or ProSe path via PC5).
In case that policy rules provided by the network indicate that a specific
path can be used (Uu path only or PC5 path only) then the UE shall select only
the path described in the policy rules for the corresponding traffic
descriptor (i.e. location type of Service etc.). In case the UE can select
between the PC5 path and the Uu path then the UE can use different type of
information that could be locally available or requested by the network side.
The path selection policy rules are determined by PCF based on AF request
(e.g. based on topology formation or changes observed [criteria outside of the
scope of SA WG2]) or any other relevant network data analytics as defined in
TS 23.288 [24] e.g. user data congestion analytics in clause 6.8 in TS 23.288
[24], QoS sustainability in clause 6.9 in TS 23.288 [24] and/or using existing
(R)AN notifications as defined in TS 23.501 [6] (e.g. on expected QoS targets
fulfilments).
For this solution, it is required that the UE has registered with the HPLMN
and acquired the policies from the PCF.
Specifically, the network can provide policy rules that could be used by the
UE to determine the direct communication path. The policy rules can indicate:
\- Path preference: indicates the preferred path (i.e. PC5 path or Uu path)
for the matching traffic
\- only the PC5 path shall be used;
\- only the Uu path shall be used (this does not apply to unlicensed
spectrum);
\- PC5 path preferred, where the UE can choose between the PC5 path or Uu
path;
\- Uu path preferred, where the UE can choose between the PC5 path or Uu path;
\- no preference.
For path selection policy rules, UE may follow the same priority order as
specified in clause 5.1.1, TS 23.287 [5] for V2X communications.
The policy rules that the network provides could associate the communication
path with:
\- Traffic descriptor that can consist of one or several of the following:
\- Application descriptors; or
\- the type of service; and/or
NOTE: The type of service can reuse the encoding proposed in TS 24.526, for
the UE policy part contents (i.e. Traffic descriptor component), including a
URSP rule. The list of type services can start with categories and types of
services/scenarios agreed in SA WG1 (TS 22.186 [19]).
\- the QoS class (e.g. 5QI, PQI) and/or QoS mapping rules; and/or
\- each PC5 QoS mapping rule may have service identifiers and application
requirements. PC5 QoS parameters can be re-used as specified in TS 23.287 [5]
clause 5.4.2.
\- the transmission mode (cast type).
\- (over Uu) List of one or more NSSAI(s) or DNN(s).
\- a policy validity timer, indicating the expiration time of the
policy/parameter;
\- Location information: the UE location where the policy rules are
applicable.
\- Radio parameters (if applicable) as specified in TS 23.287 [5] clause
5.1.2.1;
\- a signal threshold, which defines a minimum that is required to select PC5
interface. If PC5 interface has better signal than threshold, UE can select
PC5;
Different locations may have different rules (e.g. due to different network
capabilities at specific regions).
The generated policy rules can be modified by the network (e.g. based on AF
request).
### 6.12.2 Procedures
#### 6.12.2.1 Procedure for Direct Communication Path Selection
Figure 6.12.2.1-1: high-level procedure for direct communication path
selection
1\. Triggered by a ProSe AF request, the UE policy PCF composes ProSe policy
for the UE. The SM PCF may set the QoS Notification Control parameter in the
PCC rule as defined in TS 23.501 [6] clause 5.7.2.4. This information is about
how to detect expected QoS targets fulfilment status over the Uu path (e.g.
via leveraging QoS Notification Control from NG-RAN as defined in TS 23.501
[6] clause 5.7.2.4). The PCF provides the path selection Policy/parameters for
Proximity Services to the UE by using the procedure as defined in clause
4.2.4.3 in TS 23.502 [8].
NOTE 1: The QoS Flow(s) related to QNC needs to be added to the PDU Session
for the UE before step 1.
2a. The ProSe AF may subscribe to QNC from the SM PCF to receive notification
on QoS fulfilment Status. If the NG RAN detects all QoS requirements cannot be
fulfilled for one or more QoS Flows when requested by SMF for such
notification, it may generate a notification towards the SM PCF. The ProSe AF
will also be notified based on the subscription to the SM PCF.
2b. The ProSe AF can forward QNC Status update to the UE Policy PCF. The UE
Policy PCF may utilise the notification information in updating the UE policy
rules (incl. path selection policy/ parameters) composed in Step 1 for all
related UEs.
2c. The Prose AF may subscribe to NWDAF to receive analytics notification
(e.g. relevant to QoS sustainability for all UEs in an area of Interest as
defined in clause 6.9.1, TS 23.288 [24] or and network performance analytics
on the gNB status information and resource usage as defined in clause 6.6.1,
TS 23.288 [24]). In that case, the ProSe AF can forward such analytics
notification to the UE Policy PCF. The UE Policy PCF may utilise the
notification information in updating the UE policy rules (incl. path selection
policy/ parameters) composed in Step 1 for all related UEs.
In Steps 2b and 2c, ProSe AF may store QNC Status update (2b) and analytics
notification (2c) into a selected UDR instance. The UE Policy PCF is
configured to subscribe to receive either notifications from UDR.
If SM PCF and UE Policy PCF are the same, Steps 2a and 2b can be altered and
UE policy PCF may directly receive QNC notifications.
In Step 2c, for certain analytics types that are supported, the PCF may
directly subscribe to the NWDAF to receive analytics relevant to UE Policy
(incl. path selection policy/ parameters).
2d. For interactive group services, the ProSe AF may hold the group formation
information of the UE (e.g. as coordinated over PC1) [criteria outside of the
scope of SA WG2]. The ProSe AF may provision some requirements based on this
information to the UE policy PCF.
3\. The PCF can define and update path policy rules using as a triggering
event one or more of the options presented in step 2 that could be also
complementary used.
4\. The PCF provides the path selection Policy/parameters for Proximity
Services to the UE by using the procedure as defined in clause 4.2.4.3 \"UE
Configuration Update procedure for transparent UE Policy Delivery\" in TS
23.502 [8]. The UE policy delivery procedure could be initiated by the PCF (as
described in clause 6.2.2 in TS 23.287 [5]), by the UE (as described in clause
6.2.4 in TS 23.287 [5]), or by the AF (as described in clause 6.2.5 in TS
23.287 [5]).
NOTE 2: RAN QoS Notification Procedure towards PCF for Uu is as defined in TS
23.501 [6].
5\. The UE checks the received policy rules and selects the appropriate
communication path (PC5 or Uu).
The PCF decides if an update of a path selection policy rule is necessary
based on the triggering event of step 3. If the PCF decides to update the path
selection policy rules then this can involve any part of a policy rule (e.g.
Path preference, traffic descriptor, location information). PCF functionality
for path selection policy rules update should assure that the UE policy rules
are not updated too frequently to avoid triggering many reselection processes
at the UE side, leading to increase of signalling etc. To achieve this, PCF
may combine multiple sets of QNC Status update and / or analytics
notifications before inferring how to update ProSe Policy per UE.
### 6.12.3 Impacts on services, entities and interfaces
**UE:**
\- Support network-assisted path selection using the provided policy rules.
**PCF:**
\- Composition of path selection policy rules.
\- Update path selection policy rules, based on existing RAN notifications
and/ or NWDAF analytics or AF requirements (based on group formation
information).
\- Provisioning the path selection rules to the UE using the existing
provisioning process.
**AF:**
\- Receive and forward RAN notifications and/ or NWDAF analytics to the PCF.
\- Trigger a request to PCF for policy composition and/ or update.
**UDR**
\- Holds QNC reports from RAN and/ or analytics from NWDAF to notify to UE
policy PCF.
## 6.13 Solution #13: Charging reporting for PC5 Direct Communication
### 6.13.1 Description
In this solution, the PCF is responsible for generating a charging policy for
PC5 direct communication by interacting with the AF and the enforcement of the
policy decisions related to charging and applying the charging policy to the
UE. The SMF is responsible to interact with the CHF for PC5 direct
communication.
The PCF may generate the charging policy for PC5 by interacting with the AF as
well as following the operator\'s policy. In addition to the basic charging
data defined by TS 32.277 [13], the AF may provide charging related
application level information.
### 6.13.2 Procedures
Figure 6.13.2-1: Procedure for Charging for PC5 Direct Communication
1\. The ProSe service authorization has been successfully executed as per
described in TS 23.303 [9]. The HPLMN pre-configures the UE with the
authorization information for a list of PLMNs where a charging for PC5 Direct
Communcation is possible. If a VPLMN is not listed as a PLMN where a charing
for PC5 Direct Communication is possible and the service is not a Public
Safety service, it is up to the HPLMN to decide whether to authorize the UE to
perform ProSe Direct Discovery or ProSe Direct Communication or both and in
addition information regarding out-of-coverage operation at that VPLMN may be
provided or not.
NOTE: It is assumed that the SMFs and PCFs, which are associated with the
ProSe service, a DNN and/or an S-NSSAI in a PLMN, homogeneously support the
Charging for PC5 Direct Communication if that PLMN is considered as Charging
for PC5 Direct Communication capable by the HPLMN.
2\. The AF sends the PCF subscribed PC5 charging policy-related application
level information, as defined in Solution #14 for Key Issue 7
3\. The PCF delivers its PC5 charging related policies, which includes usage
reporting rule to UE, as defined in Solution #14 for Key Issue 7.
4\. Direct communication takes place over PC5.
5\. The UE creates the usage information report when the reporting criteria is
met. In the PC5 data usage reporting, information such as the roles (i.e.
remote UE or Relay UE) of the UEs, and the Remote UE ID in the case of UE-
Network Relay could be included.
Editor\'s note: It is FFS whether there is a privacy concern to store
permanent UE IDs (such as a Remote UE ID) of other UEs during PC5 usage
reporting in a UE.
6\. If there is an existing PDU session, the UE sends the SMF a NAS message
with PC5 usage information report using the PDU session that is associated
with the ProSe service based on the operator\'s policy. If there is no
existing PDU session, the UE initiates a PDU session establishment procedure
using a DNN and./or S-NSSAI pre-configured in the UE for the the ProSe
service, and then sends the SMF a NAS message with PC5 usage information
report.
7\. The SMF notifies the CHF to create a CDR. The CHF is selected as defined
in clause 5.1.8 of TS 32.255 [15]. As the SMF obtains a Uu usage infomration
report from an associated UPF, the SMF can report both Uu and PC5 related
usage reports to the CHF according to the PCC rules. The SMF may send Uu
related usage report and PC5 related usage report to the CHF independently or
may conbine both usage reports and sends them to the CHF togeter.
8\. The CHF creates a CDR. CDR is updated/terminated based on charging data
request from SMF.
9\. The CHF sends charging data response to the SMF.
### 6.13.3 Impacts on services, entities and interfaces
**PCF:**
\- Retrieves charging policy for PC5 related information from the AF and
configure the UE with the Charging Rule for PC5 Direct Communication.
**SMF:**
\- Receives PC5 related usage reports from the UE and forwards it to the CHF.
**CHF:**
\- Receives PC5 related usage reports from the SMF and generates a PC5 related
CDR.
**UE:**
\- Performs and reports usage related to PC5 direct communication to the SMF
based on usage reporting rule enforced by the PCF.
**Configuration in the HPLMN:**
\- The HPLMN configures the UE with the authorization information for a list
of PLMNs where a charging for PC5 Direct Communication is possible.
## 6.14 Solution #14: Charging Usage Information Configuration
### 6.14.1 Description
The PCF provides usage reporting rule to the UE for controlling how usage
reporting is performed. The PCF also provides reporting trigger events to the
UE for when to report usage information over PC5. The reporting trigger events
(e.g. triggers, threshold information etc.) is determined by the PCF. In
addition to the charging information defined in TS 32.277 [13], the AF may
provide additional charging information based on the assistance information
from the external AF.
The provisioning procedure can reuse the existing provisioning procedure
defined in clause 6.2.2 and clause 6.2.5 of TS 23.287 [5].
NOTE: The detailed usage reporting rule content is decided by SA WG5.
### 6.14.2 Procedures
Figure 6.14.2-1: Charging usage information provisioning
1\. The PCF may obtain charging assistance information (e.g. service
information, group information, UE to be charged information) from the AF.
2\. The PCF generates the charging usage reporting rule sends the charging
usage rule to the UE using the existing procedure as defined in clause 6.2.2
of TS 23.287 [5].
3\. UE stores the charging usage rule and if PC5 communication happens, and
the usage report is triggered as defined in charging usage rule configured in
step 2.
UE sends charging usage report to the network as defined in other solutions in
this TR.
### 6.14.3 Impacts on services, entities and interfaces
Impact on PCF:
\- Generate charging rule for PC5 communication, additionally based on
assistance information from AF.
\- Provision the charging rule to the UE using existing provisioning
procedure.
Impact on UE:
\- Store the charging rule and report the usage information as the charging
rule.
## 6.15 Solution #15: PC5 Direct Communication Reporting for Charging
### 6.15.1 Description
In this solution, the UE reports the usage information of PC5 to the AMF if
the reporting criteria is met when the UE gets access to the network, and the
AMF reports the usage information of PC5 to CHF using the existing interface.
NOTE: The reporting criteria in the UE is implementation specific.
### 6.15.2 Procedures
Figure 6.15.2-1: Reporting charging information for PC5 direct communication
In Figure 6.15.2-1, two UEs are shown as an example.
1\. UE 1 and UE 2 has communicated directly over PC5.
UE1 and UE2 are required to generate usage data reporting and provide the
information to the core network when the UE becomes connected to the 5GS via
Uu interface. In the PC5 data usage reporting, information such as the roles
(i.e. remote UE or Relay UE) of the UEs, and the Remote UE ID in the case of
UE-Network Relay could be included.
Editor\'s note: It is FFS whether there is a privacy concern to store
permanent UE IDs (such as a Remote UE ID) of other UEs during PC5 usage
reporting in a UE.
2\. [Optional] If UE1 is not registered yet when it has coverage again, UE1
performs registration as specified in clause 4.2.2.2.2 of TS 23.501 [6].
3\. If reporting criteria is met, UE 1 reports the usage information of PC5
Direct Communication to the AMF. The existing UL NAS TRANSPORT message is
reused by extending the definition of Payload container type.
4\. The AMF then forwards the usage reporting to the CHF for the purposes of
charging usage. The AMF discovers CHF as specified in clause 5.1.3 of TS
32.256 [16], and same service operations as specified in TS 32.291 [17] will
be reused.
5\. For UE2, same handling in steps 2 to 4 applies for reporting of its usage.
### 6.15.3 Impacts on services, entities and interfaces
**UE:**
\- Reports usage related to PC5 direct communication to the AMF.
**AMF:**
\- Receiving the usage reporting for PC5 direct communication from the UE over
NAS.
\- Reporting the usage reporting for PC5 direct communication from the UE to
the CHF using existing interface.
**CHF:**
\- Handling charging for PC5 direct communication.
NOTE: Impact on CHF and type of data collection is to be detailed by SA WG5.
LTE/EPC ProSe usage data reporting is assumed to be used as baseline
information.
## 6.16 Solution #16: Service Authorization and Provisioning for UE-to-Network
Relay
### 6.16.1 General
The procedures for service authorization and provisioning is based on the V2X
Procedures for Service Authorization and Provisioning as specified in clause
6.2 of TS 23.287 [5]. This solution is used for Layer-3 UE-to-Network Relay
and Layer-2 UE-to-Network Relay.
### 6.16.2 PCF based Service Authorization and Provisioning to the UE-to-
Network Relay
For PCF based Service Authorization and Provisioning to the UE-to-Network
Relay, the Registration procedures as defined in clause 4.2.2.2 of TS 23.502
[8], UE Policy Association Establishment procedure as defined in clause
4.16.11 of TS 23.502 [8] and UE Policy Association Modification procedure as
defined in clause 4.16.12 of TS 23.502 [8] apply with the following additions:
For UE-to-Network Relay:
\- The UE indicates UE-to-Network Relay capability in the Registration Request
message.
\- The PCF determines the UE-to-Network Relay parameters for the UE-to-Network
Relay and provides them to the UE-to-Network Relay as described in solution
#17.
For Remote UE:
\- The UE indicates UE-to-Network Relay Access capability in the Registration
Request message.
\- The PCF determines the parameters for the Remote UE to use a UE-to-Network
Relay and provides them to the Remote UE as described in solution #17.
### 6.16.3 Authorization and Provisioning Parameters for UE-to-Network Relay
The following UE-to-Network Relay parameters are provided to the UE-to-Network
Relay:
1) Authorisation policy for acting as a UE-to-Network Relay:
\- PLMNs in which the UE is authorized to relay traffic for Remote UEs.
2) UE-to-Network Relay Discovery policy/parameters:
\- UE-to-Network Relay Service Code or Service ID which identifies a
connectivity service that the UE-to-Network Relay provides.
\- The associated PDU session parameters (S-NSSAI, DNN, SSC mode, etc.) to be
used for relayed traffic for each UE-to-Network Relay Service Code or Service
ID (Only for Layer 3 UE-to-Network Relay).
NOTE 1: Whether the associated PDU session parameters is included depends on
the UE-to-Network Relay Discovery solutions. For example, if the associated
PDU session parameters can be broadcasted with Relay Service Code in PC5
interface, these parameters may not need for provisioning procedure.
NOTE 2: The UE-to-Network Relay\'s Configured NSSAI includes the S-NSSAIs
needed to support relaying traffic for the associated Service code or Service
ID.
\- Security related parameters for UE-to-Network Relay Discovery for each UE-
to-Network Relay Service Code or Service ID.
NOTE 3: Further details on security requirements will be specified in SA WG3.
The following UE-to-Network Relay parameters are provided to the Remote UE:
1) Authorisation policy for acting as a Remote UE:
\- Indicates whether the UE is authorised to use UE-to-Network Relay.
2) UE-to-Network Relay Discovery policy/parameters as provided to UE-to-
Network Relay;
\- Authorized UE-to-Network Relay Service Code/ID list.
\- The associated PDU session parameters (S-NSSAI, DNN, SSC mode, etc.) for
each UE-to-Network Relay Service Code or Service ID (Only for Layer 3 UE-to-
Network Relay).
NOTE 4: Whether the associated PDU session parameters is included depends on
the UE-to-Network Relay Discovery solutions. For example, if the associated
PDU session parameters can be broadcasted with Relay Service Code in PC5
interface, these parameters may not need for provisioning procedure.
\- UE-to-Network Relay selection policy.
Editor\'s note: Details of UE-to-Network Relay selection policy are FFS.
NOTE 5: In this clause, only UE-to-Network Relay service specific parameters
are specified. All other parameters used for general Authorization and
Provisioning parameters (e.g. Radio parameters for discovery or communication)
will be defined by solutions for KI 8.
NOTE 6: This solution does not support the case when the NW relay is out-of-
coverage or out-of-box operation required by public safety.
### 6.16.3 Impacts on services, entities and interfaces
**UE:**
\- Needs to support Authorization and Provisioning procedures for Remote UE
and UE-to-Network Relay.
**PCF:**
\- Needs to support Authorization and Provisioning procedures for Remote UE
and UE-to-Network Relay.
## 6.17 Solution #17: ProSe Authorization Policy and Parameter for Direct
Discovery and Communication
### 6.17.1 Description
This solution addresses KI#8: Support of PC5 Service Authorization and
Policy/Parameter Provisioning, two following major aspects are covered:
\- For the procedures related to PC5 service authorization and
policy/parameter provisioning to a UE, only necessary enhancement with what is
specified in TS 23.287 [5] clause 6.2 and TS 23.502 [8] clause 4.2.2.2
(Registration Procedure), clause 4.2.4.3 (UE Configuration Update procedure
for transparent UE Policy Delivery), clause 4.16.11 (UE Policy Association
Establishment procedure), clause 4.16.12 (UE Policy Association Modification
procedure), will be documented.
\- Identify necessary information for PC5 service authorization and
provisioning based on what is specified in TS 23.287 [5] clause 5.1.2.1.
The PCF based service authorization and provisioning as defined in TS 23.287
[5] are used as baseline for this solution.
The general description on the parameters for V2X communication over PC5 as
defined in clause 5.5.1 of TS 23.287 [5] is reused with the following
differences:
\- replace V2X communication over PC5 with ProSe Direct Discovery/ProSe Direct
Communication.
\- replace V2X Application Server with ProSe Application Server.
\- replace V1 reference point with PC1 reference point.
### 6.17.2 Procedures
#### 6.17.2.1 Procedure Enhancement for Information Provisioning to UE
For PCF based Service Authorization and Provisioning to 5G ProSe UE, the
Registration procedures as defined in clause 4.2.2.2 of TS 23.502 [8], UE
Policy Association Establishment procedure as defined in clause 4.16.11 of TS
23.502 [8] and UE Policy Association Modification procedure as defined in
clause 4.16.12 of TS 23.502 [8] apply with the following additions:
\- If the UE indicates its PC5 capability for 5G ProSe in the Registration
Request message and if the UE is authorized for 5G ProSe service, the AMF
selects the PCF which supports 5G ProSe information provisioning and
establishes a UE policy association with the PCF for 5G ProSe information
provisioning delivery.
\- If the UE supports PC5 capability for 5G ProSe and it does not have valid
5G ProSe authorization information, the UE includes the UE Policy Container
with indicating the 5G ProSe Policy and parameter Provisioning request during
registration procedure.
\- If the UE indicates the 5G ProSe Policy and parameter Provisioning request
in the UE Policy Container, the PCF determines whether to provision the 5G
ProSe Policy and parameter to the UE, as specified in clause 6.1.2.2.2 of TS
23.503 [18], and the PCF provides the 5G ProSe Policy and parameters to the UE
by using the procedure as defined in clause 4.2.4.3 \"UE Configuration Update
procedure for transparent UE Policy Delivery\" in TS 23.502 [8].
The PCF may update the 5G ProSe Policy and parameters to the UE in following
conditions:
\- UE Mobility, e.g. UE moves from one PLMN to another PLMN. This is achieved
by using the procedure of UE Policy Association Modification initiated by the
AMF, as defined in clause 4.16.12.1 of TS 23.502 [8].
\- When there is a subscription change in the list of PLMNs where the UE is
authorized to perform the 5G operation. This is achieved by using UE Policy
Association Modification initiated by the PCF procedure as defined in clause
4.16.12.2 of TS 23.502 [8].
\- When there is a change of service specific parameter as described in clause
4.15.6.7 of TS 23.502 [8].
The ProSe Application Server can provide parameters as described in clause
6.17.2.3 except 1) and 8) and clause 6.17.2.4 except 1) and 6) for ProSe
Direct Discovery and ProSe Direct Communication to UDR and these may be used
by PCF for the Policy/Parameter Provisioning.
If the serving PLMN is removed from the list of PLMNs in the service
authorization parameters, the service authorization is revoked in the UE.
When the UE is roaming, the change of subscription resulting in updates of the
service authorization parameters are transferred to the UE by H-PCF via V-PCF.
NOTE: The UE may perform UE triggered Policy Provisioning procedure to the PCF
as specified in clause 6.2.4 of TS 23.287 [5] when the UE determines the 5G
ProSe Policy and parameters are invalid (e.g. Policy/Parameter is outdated,
missing or invalid).
#### 6.17.2.2 Procedure Enhancement for Information Provisioning to NG-RAN
The Registration procedure for UE is performed as defined in TS 23.502 [8]
with the following additions:
\- The UE includes the PC5 Capability for ProSe (i.e. NR PC5) as part of the
\"5GMM capability\" in the Registration Request message. The AMF stores this
information for ProSe operation. The PC5 Capability for ProSe indicates
whether the UE is capable of supporting ProSe Direct Discovery and
communication over PC5 reference point.
\- The AMF determines whether the UE is authorized to use ProSe Direct
Discovery and communication over PC5 reference point based on UE\'s PC5
Capability for ProSe and the subscription data (i.e. \"ProSe services
authorized\" indication and NR UE-PC5-AMBR, and cross-RAT PC5 control
authorization if applicable) received from UDM, and stores the subscription
data as part of the UE context.
\- The PCF provides the PC5 QoS parameters to AMF. The AMF stores such
information as part of the UE context.
\- If the UE is PC5 capable for ProSe, and the UE is authorized to use ProSe
Direct Communication over PC5 reference point based on the subscription data,
then the AMF shall include in the NGAP message sent to NG-RAN:
\- a \"ProSe services authorized\" indication, indicating the UE is authorized
to use ProSe Direct Discovery and communication over PC5 reference point.
\- NR UE-PC5-AMBR and cross-RAT PC5 control authorization if applicable, used
by NG-RAN for the resource management of UE\'s PC5 transmission for ProSe
services in network scheduled mode.
\- the PC5 QoS parameters used by the NG-RAN for the resource management of
UE\'s PC5 transmission for ProSe services in network scheduled mode.
#### 6.17.2.3 The Policy/parameter for ProSe Direct Discovery
The following sets of information for ProSe Direct Discovery over PC5
reference point is provisioned to the UE:
1) Authorization policy for ProSe Direct Discovery:
\- When the UE is \"served by E-UTRA\" or \"served by NR\":
\- For open ProSe Direct Discovery:
a) open ProSe Direct Discovery Model A monitoring authorisation policy:
\- PLMNs in which the UE is authorised to perform ProSe Direct Discovery
monitoring.
b) open ProSe Direct Discovery Model A announcing authorisation policy:
\- PLMNs in which the UE is authorized to perform announcing.
\- Authorised discovery range for announcing per PLMN.
\- For restricted ProSe Direct Discovery:
a) restricted ProSe Direct Discovery Model A monitoring authorisation policy:
\- PLMNs in which the UE is authorised to perform restricted ProSe Direct
Discovery Model A monitoring.
b) restricted ProSe Direct Discovery Model A announcing authorisation policy:
\- PLMNs in which the UE is authorized to perform restricted ProSe Direct
Discovery Model A announcing;
\- Authorised discovery range for announcing per PLMN.
c) restricted ProSe Direct Discovery Model B Discoverer operation
authorization policy:
\- PLMNs in which the UE is authorized to perform Model B Discoverer
operation;
\- Authorised discovery range for announcing per PLMN.
d) restricted ProSe Direct Discovery Model B Discoveree operation
authorization policy:
\- PLMNs in which the UE is authorized to perform Model B Discoveree
operation.
\- Authorised discovery range for announcing per PLMN.
NOTE 1: In this TR, [When the UE is \"served by E-UTRA\" or \"served by NR\"]
and [When the UE is \"not served by E-UTRA\" and \"not served by NR\"] are
relevant to ProSe discovery/communications over PC5 reference point.
2) When the UE is \"not served by E-UTRA\" and \"not served by NR\":
\- Indicates whether the UE is authorised to perform ProSe Direct Discovery
for Model A and Model B when \"not served by NG-RAN\".
3) Radio parameters when the UE is \"not served by E-UTRA\" and \"not served
by NR\":
\- Includes the radio parameters per NR PC5 with Geographical Area(s) and an
indication of whether they are \"operator managed\" or \"non-operator
managed\". The UE uses the radio parameters to perform ProSe Direct Discovery
over PC5 reference point when \"not served by E-UTRA\" and \"not served by
NR\" only if the UE can reliably locate itself in the corresponding
Geographical Area. Otherwise, the UE is not authorized to transmit.
NOTE 2: Whether a frequency band is \"operator managed\" or \"non-operator
managed\" in a given Geographical Area is defined by local regulations.
4) Restricted ProSe Direct Discovery UE ID for Restricted Direct Discovery:
\- ProSe Direct Discovery UE ID.
5) Group Member Discovery parameters:
\- For each discovery group that the UE belongs to include the following
parameters that enable the UE to perform Group Member Discovery when
provisioned in ME from PCF or configured in UICC:
\- Application Layer Group ID: Identifies an application layer group that the
UE belongs to.
\- Layer-2 Group ID: layer-2 ID for Discovery Group ID.
\- User Info ID: For Model A, this corresponds to the Announcer Info parameter
when the UE is acting as an announcing UE. For Model B, this corresponds to
the Discoverer Info in Solicitation messages and the Discoveree Info in
Response messages, when the UE is acting as a discoverer or discoveree UE
respectively.
NOTE 3: User Info ID is expected to be assigned uniquely to a user within the
discovery group.
\- Discovery Group ID: identifier of a discovery group that the UE belongs to.
NOTE 4: Group Member Discovery parameters can be provided from ProSe
Application Server to the UE.
6) Application information for ProSe Direct Discovery:
\- Application identifiers to be used for direct discovery over PC5 interface.
7) Security parameters used for direct discovery over PC5.
Editor\'s note: Whether the security parameters can be provided by the PCF and
details of security parameters will be determined by SA WG3.
8) Validity timer indicating the expiration time of the Policy/Parameter for
ProSe Direct Discovery.
#### 6.17.2.4 The Policy/parameter for ProSe Direct Communication
The following sets of information for ProSe Direct Communications over PC5
reference point is provisioned to the UE:
1) Authorization policy:
\- When the UE is \"served by E-UTRA\" or \"served by NR\":
\- PLMNs in which the UE is authorized to perform 5G ProSe Direct
Communications over PC5 reference point when \"served by E-UTRA\" or \"served
by NR\".
\- When the UE is \"not served by E-UTRA\" and \"not served by NR\":
\- Indicates whether the UE is authorized to perform ProSe Direct
Communications over PC5 reference point when \"not served by E-UTRA\" and
\"not served by NR\".
2) Radio parameters when the UE is \"not served by E-UTRA\" and \"not served
by NR\":
\- Includes the radio parameters NR PC5 with Geographical Area(s) and an
indication of whether they are \"operator managed\" or \"non-operator
managed\". The UE uses the radio parameters to perform ProSe Direct
Communications over PC5 reference point when \"not served by E-UTRA\" and
\"not served by NR\" only if the UE can reliably locate itself in the
corresponding Geographical Area. Otherwise, the UE is not authorized to
transmit.
NOTE 1: Whether a frequency band is \"operator managed\" or \"non-operator
managed\" in a given Geographical Area is defined by local regulations.
3) Policy/parameters for PC5 RAT selection:
\- The mapping of ProSe service type to PC5 RAT.
NOTE 2: If Tx Profile for NR PC5 is defined in Rel-17 by RAN WGs, it needs to
be reflected to these Policy/parameters during the normative phase.
4) Policy/parameters related to privacy:
\- The list of ProSe service type with Geographical Area(s) that require
privacy support.
5) Policy/parameters when NR PC5 is selected:
\- The mapping of ProSe service (i.e. Application ID) to radio frequencies
with Geographical Area(s).
\- The mapping of ProSe service (i.e. Application ID) to Destination Layer-2
ID(s) for broadcast.
\- The mapping of ProSe service (i.e. Application ID) to Destination Layer-2
ID(s) for groupcast.
\- The mapping of ProSe service (i.e. Application ID) to default Destination
Layer-2 ID(s) for initial signalling to establish unicast connection.
NOTE 3: The same default Destination Layer-2 ID for unicast initial signalling
can be mapped to more than one ProSe service. In the case where different
ProSe services are mapped to distinct default Destination Layer-2 IDs, when
the UE intends to establish a single unicast link that can be used for more
than one ProSe service, the UE can select any of the default Destination
Layer-2 IDs to use for the initial signalling.
\- The mapping of ProSe service (i.e. Application ID) to PC5 QoS parameters
defined in clause 5.4.2 (i.e. PQI and conditionally other parameters such as
MFBR/GFBR, etc.).
\- SLRB configurations, i.e. the mapping of PC5 QoS profile(s) to SLRB(s),
when the UE is \"not served by E-UTRA\" and \"not served by NR\".
\- The PC5 QoS profile contains PC5 QoS parameters described in clause 5.4.2
of TS 23.287 [5], and value for the QoS characteristics regarding Priority
Level, Averaging Window, Maximum Data Burst Volume if default value is not
used as defined in Table 5.4.4-1 of TS 23.287 [5].
6) Validity timer indicating the expiration time of the Policy/Parameter for
ProSe Direct Communication.
NOTE 4: The Application ID is defined in TS 23.503 [18].
### 6.17.3 Impacts on services, entities and interfaces
**UE:**
\- Need to indicate its PC5 capability for 5G ProSe to AMF;
\- Need to include the UE Policy Container with indicating the 5G ProSe Policy
and parameter Provisioning request;
\- Receive and enforce the Policy and parameter for ProSe Direct Discovery and
Communication.
**NG-RAN:**
\- receive and store the UE\'s ProSe authorization information for network
scheduled mode operation.
**AMF:**
\- Determine whether UE is authorized for 5G ProSe service;
\- Select a PCF capable of authorization Policy and parameter for 5G ProSe
service;
\- Forward the UE\'s ProSe authorization information for network scheduled
mode to NG-RAN.
**PCF:**
\- Determine the UE\'s Authorization Policy and parameter for 5G ProSe and
send it to UE;
\- Send the according Authorization Policy and parameter to NG-RAN via AMF.
## 6.18 Solution #18: Control Plane based 5G DDNMF Deployment
### 6.18.1 Description
This solution addresses Key Issue#1 and provides the Open and Restricted ProSe
Discovery procedure based on the architecture described in Annex B, clause
B.3, which enables the 5G network to control the discovery procedure via
control plane.
This solution also addresses Key Issue#7 and supports event based charging for
ProSe Direct Discovery.
### 6.18.2 Procedures for ProSe Direct Discovery
#### 6.18.2.1 Policy/Parameter Description
The following identities are required for Open ProSe Direct Discovery:
a) Application ID: an identity used by a UE to indicate a specific ProSe
application. The Application ID is assigned (provided) by the ProSe
Application Server.
b) User identity:
\- ProSe Application ID: the same concept as defined in TS 23.303 [9], clause
4.6.4.1.
\- ProSe Discovery UE ID (PDUID): the same concept as defined in TS 23.303
[9], clause 4.6.4.7.
\- Restricted ProSe Application User ID (RPAUID): the same concept as defined
in TS 23.303 [9], clause 4.6.4.8.
c) Discovery Parameter:
\- Discovery Code for Model A:
\- ProSe Application Code: the same concept as defined in TS 23.303 [9],
clause 4.6.4.2.
\- ProSe Restricted Code: the same concept as defined in TS 23.303 [9], clause
4.6.4.6.
\- Discovery Code for Model B:
\- ProSe Query Code: the same concept as defined in TS 23.303 [9], clause
4.6.4.4.
\- ProSe Response Code: the same concept as defined in TS 23.303 [9], clause
4.6.4.5.
\- Discovery Filter: the same concept as defined in TS 23.303 [9], clause
4.6.4.2a.
d) Validity Timer: the same concept as defined in TS 23.303 [9], clause
4.6.4.2.
e) Announcer Info: provides information about the announcing user. The
Announcer Info can be set to the DNN that the UE is able to access, or the UE
capability such as VR/AR rendering index. This parameter is pre-configured in
the UE.
#### 6.18.2.2 Procedure for ProSe Discovery
The following procedure is used for both open and restricted Prose discovery
and supports both Model A and Model B discovery. The only difference is the
User identity carried in the Discovery request message sent by different UEs
(e.g. ProSe Application ID by Announcing UE, RPAUID by Discoveree UE) and the
ProSe Discovery parameters retrieved from 5G DDNMF.
Multiple 5G DDNMFs may be involved in the ProSe Discovery parameters
generation and provisioning, for example, when the Announcing UE is roaming or
the ProSe Application Code that Monitoring UE is interested to monitor
generated by a different PLMN. The detailed procedures and the interactions
between multiple 5G DDNMFs are shown in clause 6.18.2.3 and 6.18.2.4.
Figure6.18.2.2-1: Overall procedures for Open ProSe Discovery (Model A)
0a. During the Registration procedure, Authorization and Policy/Parameter
provisioning are performed for the ProSe-related services. Authorization and
provisioning procedure may be solution for key issue #8.
0b and 0c. UEs are pre-configured/pre-provisioned with the User identity (i.e.
ProSe Application ID and RPAUID) ProSe Application IDs. These steps are
performed using mechanisms that are out of scope of this specification.
1\. Announcing UE or Discoveree UE retrieves Discovery Parameter for
announcing Discovery Parameter from the 5GS. This step is specified in clause
6.18.2.3 and 6.18.2.4.
2\. Monitoring UE or Discoverer UE retrieves Discovery Parameter for
announcing or monitoring from the 5GS. This step is specified in clause
6.18.2.3 and 6.18.2.4.
3\. In Model A discovery, Announcing UE starts to announce the ProSe
Application Code on PC5 interface and monitoring UE starts to monitor the
ProSe Application Code on PC5 interface. In this step, Announcing UE may also
start to announce the Announcer Info and Monitoring UE starts to monitor the
Announcer Info on PC5 interface as described in clause 6.18.2.1.
\- The Destination Layer-2 ID that can be set to a unicast, groupcast or
broadcast identifier.
\- The Source Layer-2 ID that is always set to a self assigned unicast
identifier of the transmitter.
4\. In Model B discovery, Discoverer UE starts to announce the ProSe Query
Code on PC5 interface and Discoveree UE starts to monitor the ProSe Query Code
on PC5 interface. If a received ProSe Query Code matches any of the Discovery
Query Filter(s), the UE announces the associated ProSe Response Code on the
PC5 interface.
\- The Destination Layer-2 ID that can be set to a unicast, groupcast or
broadcast identifier.
\- The Source Layer-2 ID that is always set to a self assigned unicast
identifier of the transmitter.
5\. [Optionally]: If there is no stored relationship between ProSe Application
Code and ProSe Application ID on the monitoring UE, the monitoring UE will
report the matched code to the 5GS to fetch the corresponding ProSe
Application ID.
#### 6.18.2.3 Procedure for ProSe Discovery Parameter retrieval (non-
roaming/inter-PLMN transmission)
Figure 6.18.2.3-1 shows the procedure for ProSe Discovery Parameter retrieval
in non-roaming cases, which corresponds to the step 1 and Step 2 in clause
6.18.2.2.
Figure 6.18.2.3-1: Procedure for Discovery Parameter retrieval in non-roaming
or inter-PLMN transmission
1\. If the UE is authorised to announce or monitor, it can request the 5G
DDNMF for the ProSe Discovery Parameters defined in clause 16.8.2. when it is
triggered by an application identified by an Application ID to announce or
monitor other ProSe Discovery Parameter (s). Here, the UE can be Announcing UE
or Monitoring UE in Model A or Discoveree UE or Discoverer UE in Model B
discovery.The Request message can be transmitted within a Container via NAS
message to the AMF. The Request message within the Container includes:
\- User identity:
\- Model A discovery:
\- For Announcing UE: ProSe Application ID (open discovery) or RPAUID of
Announcing UE (restricted discovery);
\- For Monitoring UE: ProSe Application ID of Monitoring UE and ProSe
Application ID(s) which the Monitoring UE is interested to monitor (open
discovery) or RPAUID of Monitoring UE and RPAUID(s) which the Monitoring UE is
interested to monitor (restricted discovery);
\- Model B discovery:
\- For Discoveree UE: RPAUID of Discoveree UE;
\- For Discoverer UE: RPAUID of Discoverer UE and RPAUID(s) which the
Discoverer UE is interested to monitor (restricted discovery);
\- ProSe Application ID;
\- Application ID;
\- Discovery command: Announce or Monitor (Model A) and Response or Query
(Model B);
\- Discovery Type: Open or Restricted discovery;
\- Discovery Model: Model A or Model B.
If the discovery command is Announce, the Announcing type can be set to \"on
demand\" to indicate the \"on demand\" announcing is requested by UE for the
indicated application.
2\. AMF forwards the Container to the 5G DDNMF.
NOTE: It is assumed that there is only one 5G DDNMF in each PLMN.
3\. For Open discovery, 5G DDNMF generates the ProSe Discovery Application
Code or Discovery Filter according to the ProSe Application ID that is
contained in the request message (i.e. Container). For Restricted discovery,
the 5G DDNMF may interact with the ProSe AS to get the authorization for
restricted discovery and retrieve the PDUID corresponding to the RPAUID before
it generates the ProSe Discovery Code (ProSe Restricted Code for Model A and
ProSe Query Code and ProSe Response Code for Model B) corresponding to PDUID.
If needed, 5G DDNMF may interact with UDR to check whether the UE is
authorized to use the Application. Optionally, 5G DDNMF will assign a Validity
Timer indicating how long the ProSe Discovery Parameter is valid.
4\. If ProSe Direct Discovery with \"on demand\" announcing has been
requested, the DDNMF determines if \"on demand\" announcing is authorized and
enabled based on the Application ID and operator\'s policy. For inter-PLMN
Discovery Filter(s) retrieval, based on PLMN ID(s) indicated in the ProSe
Application ID(s) or PDUID(s), which the UE is interested to monitor, HPLMN 5G
DDNMF send ProSe Discovery Parameter Retrieval message to 5G DDNMF in the
corresponding PLMN(s) to retrieve ProSe Discovery Parameter. The ProSe
Discovery Parameter Retrieval message includes:
\- User identity:
\- Model A discovery:
\- For Announcing UE: ProSe Application ID (open discovery) or RPAUID of
Announcing UE (restricted discovery);
\- For Monitoring UE: ProSe Application ID of Monitoring UE and ProSe
Application ID(s) which the Monitoring UE is interested to monitor (open
discovery) or RPAUID of Monitoring UE and PDUID(s) which the Monitoring UE is
interested to monitor (restricted discovery);
\- Model B discovery:
\- For Discoveree UE: RPAUID of Discoveree UE;
\- For Discoverer UE: RPAUID of Discoverer UE and PDUID(s) which the
Discoverer UE is interested to monitor (restricted discovery);
\- Application ID;
\- Discovery Model:Model A or Model B;
\- Discovery Type: open or restricted.
\- Discovery command: Announce or Monitor (Model A) and Response or Query
(Model B);
If the 5G DDNMF of the other PLMN(s) stores valid Discovery Parameter
corresponding to the User identity, then the 5G DDNMF of the other PLMN(s)
returns the related Discovery Parameter and the corresponding Validity Time
for each User identity respectively.
5\. 5G DDNMF transmits the ProSe Discovery Parameter in the Container to the
AMF. Optionally, the Validity Timer is also included in the Container .
If the \"on demand\" announcing is authorized and enabled in step 3, then
DDNMF shall determine whether there is ongoing monitoring request. If not, the
DDNMF does not provide a ProSe Application Code to the UE and responds to the
UE with a Discovery Response (validity timer, Announcing Enabled indicator)
message.
6\. AMF sends the Discovery Parameter Response message including the Container
to the UE.
#### 6.18.2.4 Procedure for ProSe Discovery Parameter retrieval (roaming)
Figure 6.18.2.4-1: Procedure for ProSe Discovery Parameter retrieval in
roaming case
1\. Same as the step 1 in clause 6.18.2.3.
2\. AMF forwards the ProSe Container to 5G DDNMF with the SUPI/SUCI of
Announcing UE.
3\. Based on PLMN ID in the User identity of the UE, VPLMN 5G DDNMF forwards
the Discovery Parameter Request to the HPLMN 5G DDNMF.
4\. For Open discovery, HPLMN 5G DDNMF generates the ProSe
ApplicationDiscovery Code or Discovery Filter according to the ProSe
Application ID that is contained in the request message (i.e. Container). For
Restricted discovery, HPLMN 5G DDNMF may interact with the ProSe AS to get the
authorization for restricted discovery and retrieve the PDUID corresponding to
the RPAUID before it generates the ProSe Discovery Code (ProSe Restricted Code
for Model A and ProSe Query Code and ProSe Response Code for Model B)
corresponding to PDUID.
If needed, 5G DDNMF may interact with UDR to check whether the UE is
authorized to use the Application. Optionally, 5G DDNMF will assign a Validity
Timer indicating how long the ProSe Discovery Parameter is valid.
5\. Same as step 4 in clause 6.18.2.3.
6\. HPLMN 5G DDNMF transmits the ProSe Discovery Parameter to the VPLMN 5G
DDNMF.
7\. VPLMN 5G DDNMF transmits the ProSe Discovery Parameter in the Container to
the AMF. Optionally, the Validity Timer is also included in the Container.
8\. AMF sends the Discovery Parameter Response message including the Container
to the UE.
### 6.18.4 ProSe Direct Discovery Charging
5G DDNMF in HPLMN, VPLMN and local PLMNs are responsible for the ProSe Direct
Discovery functionality, i.e. allocating the ProSe code and managing the ProSe
UE\'s ProSe discovery context, thus the chargeable ProSe direct discovery
events can be collected and reported by the 5G DDNMFs to the corresponding CHF
in the same PLMN.
Upon detecting the occurrence of the chargeable events during the ProSe Direct
Discovery procedure, the 5G DDNMF shall further report the chargeable events
to the CHF, including the relevant information as defined in clause 5.1.2 in
clause TS 32.277 [13]. Detailed list of these chargeable events can be defined
on the basis of clause 5.2.1.2 in TS 32.277 [13].
NOTE: Other chargeable events needs to be added into the list will be
specified by SA WG5.
### 6.18.5 Impacts on services, entities and interfaces
#### 6.18.5.1 Impact on entities
UE:
\- Request to perform ProSe Direct Discovery to the 5GS via NAS message;
\- Announce or monitor the ProSe discovery code on PC5 interface;
\- Announce or monitor the Announce Info in PC5 interface.
AMF:
\- Transfer the ProSe Container between UE and 5G DDNMF.
UDR:
\- Store the ProSe specific UE subscription data.
5G DDNMF:
\- Support charging for Direct Discovery.
\- Transfer the charging data for Direct Discovery to CHF.
CHF
\- Receive the charging data for Direct Discovery to CHF.
#### 6.18.5.2 Impact on interface
\- A new service-based interface between 5G DDNMFs in different PLMN.
## 6.19 Solution #19: UE-to-Network Relay discovery and selection
### 6.19.1 Description
#### 6.19.1.1 UE-to-Network Relay discovery
This solution provides a mechanism for the Remote UE to discover a UE-to-
Network Relay and selects an appropriate UE-to-Network Relay.
The Model A and Model B procedure in solution #1 is applied for UE-to-Network
Relay discovery procedure. In Model A mechanism, the UE-to-Network Relay
announces the discovery message which includes relay related information. In
Model B mechanism, the Remote UE requests relay related information in
discovery solicitation message, the UE-to-Network Relay sends discovery
response message which matches the information in discovery solicitation
message.
In Model A, the UE-to-Network Relay includes at least the following
information in discovery announce message:
\- Service and application information that is enabled or authorised to be
relayed.
\- Group information the UE-to-Network Relay can provide the relay service.
\- Slicing information (e.g. Allowed NSSAI) the UE-to-Network Relay is enabled
or authorised to be relayed.
\- DNN information the UE-to-Network Relay is authorised to access.
\- The HPLMN or VPLMN for the UE-to-Network Relay.
In Model B, the Remote UE includes at least requested information for the
relay in discovery solicitation message, the information listed in discovery
announcement message of Model A can also be included in discovery solicitation
message. The UE-to-Network Relays receiving the discovery solicitation message
determines to send discovery response message if they can provide the relay
connection associated with the information in the discovery solicitation
message. And the UE-to-Network Relay includes the associated information in
discovery response message.
For Layer 2 UE-to-Network Relay discovery, slicing information DNN information
and other PDU Session information is not required in discovery announcement
message.
Editor\'s note: The privacy protection for S-NSSAI information and group
information in discovery message and the security of pre-configuring, storing
and exposing all this privacy sensitive information with the UE-to-Network
relay is FFS and in coordination with SA WG3.
Editor\'s note: How to reduce the overhead and possible truncation of the
discovery messages in case many different applications/services, groups and
slices are available is left to stage 3.
#### 6.19.1.2 UE-to-Network Relay selection
When the Remote UE selects UE-to-Network Relay, the Remote UE considers the
followings.
\- PC5 radio condition for UE-to-Network Relay subjected to RAN WG definition
\- the services that UE-to-Network Relay can relay.
\- the groups that UE-to-Network Relay can provide the relay service.
\- the possible DNNs/S-NSSAIs for the service relayed by UE-to-Network Relay.
\- the serving PLMN for UE-to-Network Relay.
\- the relay UE pre-configured in the remote UE.
Editor\'s note: The relay UE selection needs to be coordinated with RAN
working group.
For Layer 2 UE-to-Network Relay selection, the possible DNNs/S-NSSAIs for the
service\'s relayed are not required to be considered.
### 6.19.2 Procedures
Figure 6.19.2-1: UE-to-Network Relay discovery and selection
0\. The user may obtain ProSe application user ID and ProSe application code
for ProSe direct discovery using application layer mechanisms. The application
layer in the UE provides application user ID and the application identifier to
the ProSe Application Function. The ProSe Application Function allocates a
ProSe application user ID and ProSe application code to the application layer
in the UE.
NOTE: Step 0 is out of this specification. And this step is only needed for
the applications for which there is privacy issue.
1\. The UE obtains the authorization and provision to be a UE-to-Network Relay
and/or a Remote UE as defined for service authorization solutions. The
authorized parameters are shown in clause 6.19.1.1.
2a. (Model A) When a UE is triggered e.g. by an upper layer application or
triggered by the user or is configured to announce to be a UE-to-Network
Relay, the UE shall generate a PC5 direct discovery message for announcement
and includes the relay related information (service/application IDs, group
index(es), S-NSSAI(s), DNN(s), HPLMN or VPLMN) in this message. The UE-to-
Network Relay computes a security protection element (e.g. for integrity
protection) and appends it to the PC5 message.
When a UE is triggered e.g. by an upper layer application or by the user to
discover a UE-to-Network Relay, and the Remote UE monitors the discovery
message and try to select a UE-to-Network Relay. The Remote UE verifies the
security protection element using the provisioned security parameters
corresponding to the application. If the verification of the security
protection element succeeds, the service is successfully discovered by the
Remote UE.
2b. When a UE is triggered e.g. by an upper layer application or by the user
to discover a UE-to-Network Relay for relay related service, and if the UE is
authorised to be a Remote UE and perform the discovery solicitation procedure,
the Remote UE sends discovery solicitation message with the information of
discoverer ProSe UE ID, relay related information (service/application, group
index, S-NSSAI, DNN). The remote UE computes a security protection element
(e.g. for integrity protection) and appends it to the PC5 message.
If the UE-to-Network Relay is able to and authorised to respond to the
discovery solicitation according to the received information in the
solicitation message, then responds to the discovery message with the ProSe UE
ID, service/application, group index, S-NSSAI, DNN, HPLMN or VPLMN).
3\. Based on the discovered UE-to-Network Relay information, the Remote UE
selects an appropriate UE-to-Network Relay as descripted in clause 6.19.1.
### 6.19.3 Impacts on services, entities and interfaces
\- The UE is authorized to be a UE-to-Network Relay or a Remote UE.
\- The UE-to-Network Relay sends discovery announcement, including relay
related parameters.
\- The Remote UE is able to discover and select UE-to-Network Relay.
## 6.20 Solution #20: QoS handling for ProSe communication
### 6.20.1 Description
In order to support QoS handling for ProSe communication, the mechanism
defined in TS 23.287 [5] clause 5.4 is reused with the following differences:
\- V2X Packet Filter Set is replaced by ProSe Packet Filter Set.
Editor\'s note: It is FFS which filter combination the ProSe Packet Filter Set
is based on, e.g. Source/Destination Layer-2 ID, ProSe Application ID, etc.
For public safety services, considering the higher priority and higher
reliability, new PQI values needs to be defined. The one-to-one mapping of
standardized PQI values to PC5 QoS characteristics are defined as followings:
Table 6.20.1-1: Proposed Standardized PQIs to QoS characteristics mapping
(_changes with respect to TS 23.287 [5] Table 5.4.4-1 in Bold-Italic text_)
+-------+-------+-------+-------+-------+-------+-------+-------+ | PQI | Res | De | P | P | De | De | Ex | | | ource | fault | acket | acket | fault | fault | ample | | Value | Type | Pri | Delay | Error | Ma | | Ser | | | | ority | B | | ximum | Aver | vices | | | | Level | udget | Rate | Data | aging | | | | | | | | Burst | W | | | | | | | | V | indow | | | | | | | | olume | | | +=======+=======+=======+=======+=======+=======+=======+=======+ | New | GBR | 1 | 150 | 1 | N/A | 2000 | Mi | | val | | | ms | 0^-2^ | | ms | ssion | | ue#1 | | | | | | | Cri | | | | | | | | | tical | | | | | | | | | user | | | | | | | | | plane | | | | | | | | | Push | | | | | | | | | To | | | | | | | | | Talk | | | | | | | | | voice | | | | | | | | | (e.g. | | | | | | | | | M | | | | | | | | | CPTT) | +-------+-------+-------+-------+-------+-------+-------+-------+ | New | | 2 | 200 | 1 | N/A | 2000 | Non-M | | val | | | ms | 0^-2^ | | ms | issio | | ue#2 | | | | | | | n-Cri | | | | | | | | | tical | | | | | | | | | user | | | | | | | | | plane | | | | | | | | | Push | | | | | | | | | To | | | | | | | | | Talk | | | | | | | | | voice | +-------+-------+-------+-------+-------+-------+-------+-------+ | New | | 2 | 200 | 1 | N/A | 2000 | Mi | | val | | | ms | 0^-3^ | | ms | ssion | | ue#3 | | | | | | | Cri | | | | | | | | | tical | | | | | | | | | Video | | | | | | | | | user | | | | | | | | | plane | +-------+-------+-------+-------+-------+-------+-------+-------+ | New | No | 1 | 120 | 1 | N/A | N/A | Mi | | val | n-GBR | | ms | 0^-6^ | | | ssion | | ue#4 | | | | | | | Cri | | | | | | | | | tical | | | | | | | | | delay | | | | | | | | | sens | | | | | | | | | itive | | | | | | | | | signa | | | | | | | | | lling | | | | | | | | | (e.g. | | | | | | | | | M | | | | | | | | | C-PTT | | | | | | | | | s | | | | | | | | | ignal | | | | | | | | | ling) | +-------+-------+-------+-------+-------+-------+-------+-------+ | New | | 6 | 400 | 1 | N/A | N/A | Mi | | val | | | ms | 0^-6^ | | | ssion | | ue#5 | | | | | | | Cri | | | | | | | | | tical | | | | | | | | | Data | | | | | | | | | (e.g. | | | | | | | | | ex | | | | | | | | | ample | | | | | | | | | ser | | | | | | | | | vices | | | | | | | | | are | | | | | | | | | the | | | | | | | | | same | | | | | | | | | as | | | | | | | | | 5QI | | | | | | | | | 6 | | | | | | | | | /8/9) | +-------+-------+-------+-------+-------+-------+-------+-------+
Editor\'s note: Whether the new defined PQI values can be supported by RAN
needs to be checked with RAN WGs.
### 6.20.2 Procedures
The QoS handling defined in clauses 5.4.1.2 to 5.4.1.4 of TS 23.287 [5] is
used.
### 6.20.3 Impacts on services, entities and interfaces
UE impact:
\- UE is enhanced to support QoS handling for ProSe communication over NR
based PC5 reference point.
## 6.21 Solution #21: QoS Support for NR PC5 ProSe communication
### 6.21.1 Description
This solution addresses Key Issue #2 (Support for NR PC5 ProSe communication).
The QoS support differences with what is documented in TS 23.287 [5] clause
5.4 are analyzed and new PC5 5QI requirements are added.
### 6.21.2 Identify QoS Support Difference
According to the agreed KPI table in TS 22.261 [3] (See Table 7.6.1-1), the
_consume VR content via tethered VR headset_ _in the interactive service_ use
case identified a new requirement for PC5 communication, where end-to-end
latency is 5-10 ms and the required data rate requirement is 0.1-10 Gbps with
reliability 99.99%. The decoding capability in the VR headset and the
encoding/decoding complexity/time of the stream will set the required bit rate
and latency over the direct wireless link between the tethered VR headset and
its connected UE, i.e. 5 ms latency corresponds to 100 Mbps data rate and 10ms
latency corresponds to 10Gbps.
Some eV2X scenarios can be mapped to already existing Delay Critical GBR PQI
Values (see TS 23.287 [5], Table 5.4.4-1). The extended sensors scenario
(Sensor information sharing between UEs supporting V2X application) needs to
support up to 1Gbps data rate with 10 ms end-to-end latency (see TS 22.186
[19], Table 5.4-1), and support 50Mbps with 3ms end-to-end latency. That means
that the recent requirement in V2X cannot satisfy the requirement for
interactive service use case consume VR content via tethered VR headset.
Compared with the PQI table for V2X (see TS 23.287 [5]), to support the
_consume VR content via tethered VR headset in interactive service_ use case,
new PDBs are needed and the corresponding typical MDBV should be updated
according to the data rate requirement. Considering that the original Default
Priority Level defined in V2X is for safety related communication (e.g.
collision avoidance, or emergency trajectory alignment), for Interactive
Service, the value Priority Level should be set larger (i.e. lower priority)
than those for safety related issue. If the new PQI values are not added, the
requirement of the use case consume VR content via tethered VR headset will
not be able to find feasible PQI values to support.
### 6.21.3 Adding new PQI values for interactive service
Table 6.21.3-1: Standardized PQI to QoS characteristics mapping
+-------+-------+-------+-------+-------+-------+-------+-------+ | PQI | Res | De | P | P | De | De | Ex | | | ource | fault | acket | acket | fault | fault | ample | | Value | Type | Pri | Delay | Error | Ma | | Ser | | | | ority | B | | ximum | Aver | vices | | | | Level | udget | Rate | Data | aging | | | | | | | | Burst | W | | | | | | | | V | indow | | | | | | | | olume | | | +=======+=======+=======+=======+=======+=======+=======+=======+ | New | Delay | 5 | 5ms | 10-4 | 20000 | 2000 | I | | val | Cri | | | | bytes | ms | ntera | | ue#1 | tical | | | | | | ctive | | | GBR | | | | | | se | | | | | | | | | rvice | | | | | | | | | - | | | | | | | | | co | | | | | | | | | nsume | | | | | | | | | VR | | | | | | | | | co | | | | | | | | | ntent | | | | | | | | | with | | | | | | | | | high | | | | | | | | | c | | | | | | | | | ompre | | | | | | | | | ssion | | | | | | | | | rate | | | | | | | | | via | | | | | | | | | tet | | | | | | | | | hered | | | | | | | | | VR | | | | | | | | | he | | | | | | | | | adset | +-------+-------+-------+-------+-------+-------+-------+-------+ | New | | 6 | 10ms | 10-4 | 20000 | 2000 | i | | val | | | | | bytes | ms | ntera | | ue#2 | | | | | | | ctive | | | | | | | | | se | | | | | | | | | rvice | | | | | | | | | - | | | | | | | | | co | | | | | | | | | nsume | | | | | | | | | VR | | | | | | | | | co | | | | | | | | | ntent | | | | | | | | | with | | | | | | | | | low | | | | | | | | | c | | | | | | | | | ompre | | | | | | | | | ssion | | | | | | | | | rate | | | | | | | | | via | | | | | | | | | tet | | | | | | | | | hered | | | | | | | | | VR | | | | | | | | | hea | | | | | | | | | dset; | | | | | | | | | | | | | | | | | | G | | | | | | | | | aming | | | | | | | | | or | | | | | | | | | I | | | | | | | | | ntera | | | | | | | | | ctive | | | | | | | | | Data | | | | | | | | | E | | | | | | | | | xchan | | | | | | | | | ging; | +-------+-------+-------+-------+-------+-------+-------+-------+
MDBV values can be changed according to application requirements to override
the default MDBV values as described in TS 23.287 [5].
NOTE: To support required data rate of 10 Gbps, the max MBDV value set by the
application can be 12.5M byte.
The packet delay budgets are captured as 5 ms and 10 ms based on the end-to-
end delay captured in TS 22.261 [3].
Editor\'s note: Whether the new defined PQI values can be supported by RAN
needs to be checked with RAN WGs.
### 6.21.4 Impacts on services, entities and interfaces
UE impact:
\- UE is enhanced to support QoS requirements of new proposed PQI values and
corresponding QoS handling for NR PC5 ProSe communication.
## 6.22 Solution #22: V2X-based group communication for commercial services
### 6.22.1 Description
This solution addresses Key Issue #1 (ProSe Direct discovery) and Key Issue #2
(Support for NR PC5 ProSe communication) on the aspect of commercial services,
e.g. interactive services. The solution takes V2X-based group communication
over PC5 in TS 23.287 [5] as a baseline with following differences:
\- Before initiating V2X-based group communication, group discovery will be
performed.
\- Application server needs to perform the group management, such as member
matching and adding.
### 6.22.2 Procedures
NOTE: The support for out of coverage operation is not supported in this
solution.
#### 6.22.2.1 V2X-based group communication for commercial services
The following figure 6.22.2.1-1 demonstrates the procedure of V2X-based group
communication for commercial services, the procedure is initiated when a UE
wants to perform group communication over PC5 reference point with other UE(s)
for any application, e.g. interactive game.
Figure 6.22.2.1-1: V2X-based group communication for commercial services
NOTE 1: The application layer signalling messages in steps 1 and 3 exchanged
between UE and Application Server in the procedures described in this clause
are for information and are not specified by SA WG2.
1\. The application layer of UE-1 will perform the necessary application layer
procedures to create a group. An Application Layer Group ID is provided to
UE-1.
2\. After receiving the Application Layer Group ID, UE-1 broadcasts a Prose
Service Groupcast message to invite the group members. This message includes:
\- Application ID.
\- Application Layer User ID.
\- Application Layer Group ID provided in step 1.
\- The Source Layer-2 ID that is always set to a self-assigned unicast
identifier of the transmitter.
NOTE 2: The mechanism for converting the ProSe application layer provided
group identifier to the destination Layer-2 ID depends on the conclusion of
KI#8.
3\. The UEs (UE-2, UE-3 and UE-5 in Figure 6.22.2.1-1) that are interested in
the announced ProSe application decide to join this group, they will perform
the necessary application layer procedures to join the group.
4\. When UE-1 has been informed by the application layer that group
communications can take place, UE-1 sends the service data using V2X-based
group communication over PC5, as specified in clause 6.3.2 of TS 23.287 [5].
### 6.22.3 Impacts on services, entities and interfaces
UE:
\- Obtains the Application Layer Group ID for the group communication from the
Application Server by using application layer signalling.
\- Determines the Destination Layer-2 ID based on the Application Layer Group
ID.
Application Server:
\- Provides Application Layer Group ID to the UE.
\- Supports application layer group management functions and provides
necessary group information to member UE(s).
## 6.23 Solution #23: End-to-End security and IP address preservation for
Layer-3 UE-to-Network Relay using N3IWF
### 6.23.1 General Description
This is a solution to support end-to-end security for Remote UE traffic
transmitted using Layer-3 UE-to-Network Relay. It can be used for both public
safety services and commercial services (e.g. interactive service). The
solution is optional and complementary to base line Layer-3 UE-to-Network
Relay solutions, e.g. as described in clause 6.6. It can be used by the Remote
UE for the services that requires end-to-end traffic confidentiality and/or IP
address preservation.
To provide end-to-end security for the remote UE traffic, the design of
\"untrusted non-3GPP access to 5GC via N3IWF\" in clause 4.2.8 of TS 23.501
[6] or \"Access to PLMN services via stand-alone non-public networks\" in
clause 5.30.2.7 of TS 23.501 [6] is leveraged. Remote UE follows the
procedures defined in TS 23.502 [8] clause 4.12 to register to 5GC via N3IWF
and establish corresponding PDU sessions. The data traffic over the PDU
sessions are protected by IPSec between the Remote UE and N3IWF.
To provide IP address preservation, remote UE follows the procedure specified
in TS 23.502 [8] clause 4.9.2 (Handover of a PDU Session procedure between
3GPP and untrusted non-3GPP access) when UE moves between direct network
communication and indirect communication path.
The N3IWF provides NAS connectivity to the 5GC and end-to-end security for
Remote UEs (see figure 6.23.1-1) via UE-to-NW Relay Access. The N3IWF treats
the Remote UE as any N3GPP UE, i.e. there is no impact on N3IWF.
Remote UE supports the PC5 procedures as defined in solution #6 in clause 6.6
for obtaining UE-to-NW Relay access.
Figure 6.23.1-1: Non-roaming Architecture model using N3IWF with UE-to-NW
Relay Access
Since this solution is optional, not all UE-to-Network Relay provides the PDU
session to access to N3IWF.
As described in step 2-4 of clause 6.23.3, Relay Service Codes can be used to
determine whether UE-to-Network relay provides secure N3IWF access or
otherwise. The corresponding Relay Service Codes are provisioned to the
authorized Remote UE and UE-to-Network Relay.
For the UE-to-Network Relay provisioned with N3IWF supported Relay Service
Codes, the corresponding PDU session parameters (e.g. S-NSSAI) to support
N3IWF access are provisioned as part of ProSe UE-to-Network Relay
Policy/parameters for supporting L3 UE-to-Network Relay via N3IWF. When a
Remote UE connects for secure N3IWF access, as in step 3 of clause 6.23.3, the
UE-to-Network Relay determines the corresponding PDU session parameters based
on the requested N3IWF supported Relay Service Code. When a Remote UE connects
with a Relay Service Code not for N3IWF support, the UE-to-Network Relay
determines the corresponding PDU session parameters based on other solutions
in TR 23.752, e.g. Sol#28, Sol#38, Sol#42.NOTE: The UE-to-Network Relay only
includes N3IWF supported Relay Service Code in discovery message when the
corresponding PDU session parameters (e.g. S-NSSAI) are authorized to be use
in the accessed network. A UE-to-Network Relay may include both N3IWF
supported Relay Service Code and N3IWF not supported Relay Service Code in the
discovery message. Whether two Relay Service code are included in same
discovery message or two separate discovery messages is left for normative
work.
Also, as described in clause 6.26.2, \"Non-Seamless Offload indication\" field
is extended, or a new field included in the URSP rules is used to indicate
whether the connection via L3 UE-to-Network Relay with N3IWF is preferred. If
the Remote UE determines that N3IWF needs to be used, it will initiate the
signalling towards N3IWF when the connection with the UE-to-Network Relay is
successfully established.
UE selection of the N3IWF follows the regulatory rules of the country where it
is located, and when required by the regulations the Remote UE only selects a
N3IWF within the local country. QoS differentiation can be provided on per-
IPsec Child Security Association basis. N3IWF determines the IPsec child SAs
as defined in TS 23.502 [8] clause 4.12. The N3IWF is preconfigured to
allocate different IPsec child SAs for QoS Flows with different QoS profiles.
NOTE: In case the Remote UE and Relay UE registered to different PLMNs, there
need to be SLA established to govern the QoS handling, e.g. when the Relay
Service Code (RSC) is configured. The SLA can include the mapping between the
DSCP markings for the IPsec child SAs with the Remote UE and the corresponding
QoS, and N3IWF IP address(es). The non-alteration of the DSCP field between
N3IWF and the Relay UE\'s UPF is also assumed to be governed by an SLA and by
transport-level arrangements that are outside of 3GPP scope. The packet
detection filters at the Relay UE\'s UPF can be based on the N3IWF IP address
and the DSCP markings.
The 5GC to which the UE-to-Network Relay registers and the 5GC to which the
Remote UE registers may be the same or different. The solution does not
mandate the Remote UE to be served by the same PLMN as the Relay UE.
### 6.23.2 Protocol stacks
When access to N3IWF is used, the ProSe 5G UE-to-Network Relay shall be able
to relay both control plane (NAS) and user plane unicast traffic (UL and DL)
between the Remote UE and the network towards N3IWF. One-to-one Direct
Communication is used between Remote UEs and ProSe 5G UE-to-Network Relays for
unicast traffic as specified in solutions for Key Issue #2.
Remote UE and 5GC reuses the procedures defined in clause 4.12 of TS 23.502
[8] for supporting Registration and connection management from Remote UE to
the 5GC over 5G ProSe UE-to-NW Relay access. Remote UE establishes signalling
IPsec tunnel with the N3IWF over UE-to-NW relay access using the IKE
procedures. Also, similar to untrusted non-3GPP Access, subsequent NAS
messages between the UE and N3IWF are exchanged via the signalling IPsec SA
over TCP/IP. The control plane protocol stack before establishing IPSec tunnel
and after the setup of IPsec tunnel are same as the untrusted non-3GPP access
protocol stacks and are shown in Figure 6.23.2-2.
Figure 6.23.2-2: Control plane protocol stacks between Remote UE and N3IWF for
L3 UE-to-NW Relay Access
Remote UE supports NAS MM (after registration), SMS and PDU Session
establishment/modification/release procedures with the 5GC for the Remote UE
traffic by transporting the corresponding NAS signalling over the signalling
IPsec tunnel established with N3IWF.
Remote UE transmits/receives the UP traffic over the Relay\'s PDU session(s)
established for the Remote UE traffic over PC5 UE-to-NW Relay path via child
IPSec SA tunnel to the N3IWF. The PCF may provide corresponding URSP rules to
assist the Remote UE to identify the services that requires access to N3IWF.
In the deployment, the Relay UE\'s UPF and N3IWF may be collocated.
The user plane protocol stack for L3 UE-to-NW Relay access via N3IWF is same
as the user plane protocol stack for untrusted non-3GPP access and is shown in
Figure 6.23.2-3. The PDU Session type used between the Relay UE and Relay UE
UPF is IP, however the traffic transported in the PDU Layer between the Remote
UE and the UPF (PDU Session Anchor) can be IP, Ethernet or Unstructured.
Figure 6.23.2-3: User plane protocol stacks between Remote UE and N3IWF for L3
UE-to-NW Relay Access
The solution is transparent for NG-RAN and for the user plane protocol stacks
no impacts are identified to support them from the RAN WG2 perspective. The
NG-RAN (gNB) does not have any different treatment for the Remote UE\'s
traffic comparing to that in baseline Layer-3 UE-to-Network Relay solutions,
e.g. described in clause 6.6.
Editor\'s note: Whether there is potential impact from this solution, in terms
of the overhead introduced by N3IWF access and L3 IP relay over the radio
interface (esp. over PC5), should be evaluated by RAN WGs (at least in terms
of radio efficiency, latency and reliability).
Editor\'s note: It is FFS if there is RAN impact to support the related
control plane procedures.
Editor\'s note: It is FFS how mobility restrictions will be imposed and
enforced on the Remote UE.
### 6.23.3 Procedures
#### 6.23.3.1 Remote UE 5GC Registration over L3 UE-to-NW Relay access
A 5G ProSe UE-to-Network Relay capable of access to N3IWF may register to the
network (if not already registered) and establish a PDU session enabling the
necessary relay traffic to the N3IWF. The 5G ProSe UE-to-NW Relay may need to
connect to additional PDU session(s) or modify the existing PDU session in
order to provide relay traffic towards Remote UE(s).
As an option, the ProSe UE-to-NW Relay may use two different PDU sessions, one
for NAS traffic of Remote UE and other for UP traffic of the Remote UE via
N3IWF, if different handling, e.g. priority, is needed.
Figure 6.23.3-1: Remote UE 5GC Registration over L3 UE-to-NW Relay access
1 Remote UE and 5G ProSe UE-to-NW Relay when in-coverage may perform
Registration procedures and obtain the ProSe policy and URSP policy
information. The ProSe policy and URSP policy indicate whether Remote UE
should access 5GC via N3IWF for a particular service or service flow
(indicated by URSP). Authorization and provisioning procedure may be any
solution for key issue #1 and #3.
Remote UE that has to operate out-of-the-box will be pre-configured with the
ProSe policy and URSP policy information.
2-4. ProSe UE-to-NW Relay and Remote UE follow the procedures described in
steps 1-4 in clause 6.6.2 Procedures, of solution #6: Layer-3 UE-to-Network
Relay, with the below enhancements for N3IWF support:
\- the Remote UE and ProSe UE-to-Network Relay are configured (either via
provisioning or pre-configuration) of the specific Relay Service Codes.
NOTE: The services requiring the access via N3IWF may be configured with the
RSC(s) that can be served by the same Relay.
5\. Remote UE selects an N3IWF and determines the N3IWF IP address. Remote UE
follows the N3IWF selection procedure as described in clause 6.23.4.
6\. Remote UE establishes signalling IPsec tunnel using IKE procedures with
N3IWF and performs NAS Registration as shown in Figure 4.12.2.2-1 of TS 23.502
[8]. After the IPSec tunnel is established, Remote UE can perform any of the
NAS procedures (incl. PDU Session establishment for the Relay PDU sessions) as
specified in clause 4.12 of TS 23.502 [8].
IKE keep alive(s) between the Remote UE and the N3IWF are used for detecting
possible path failure. The Remote UE may change Relay UE(s) while maintain the
session with N3IWF when the Remote UE and N3IWF support MOBIKE. This is
negotiated between the Remote UE and the N3IWF as specified in TS 23.502 [8],
clause 4.12.2.2). When IKE keep alive(s) are used, the Remote UE needs to keep
the PC5 connection and Relay UE keeps the PDU Session.
#### 6.23.3.2 UE moves between direct network communication and indirect
communication path
When UE moves from direct network communication to indirect communication
path, clause TS 23.502 [8] clause 4.9.2.2 applies after the remote UE
establishes PC5 connection to the relay UE.
When UE moves from indirect communication path to direct network
communication, the UE follows TS 23.502 [8] clause 4.9.2.1.
### 6.23.4 N3IWF selection procedure
When the Remote UE selects a UE-to-Network Relay that supports N3IWF, Remote
UE supports the N3IWF selection procedures defined in clause 6.3.6 of TS
23.501 [6] for untrusted non-3GPP access with the below additional procedures.
To support the N3IWF selection, Remote UE is configured by HPLMN with
following information:
1\. N3IWF identifier configuration (either FQDN or IP address) in the HPLMN.
2\. PC5 path access node selection information - a prioritized list of PLMNs
for N3IWF selection. It also indicates if selection of an N3IWF in a PLMN
should be based on Tracking Area Identity FQDN or on Operator Identifier FQDN.
When the UE decides to select an N3IWF in the HPLMN, the Remote UE uses the
N3IWF identifier configuration, if configured, to find the IP address of the
N3IWF in the HPLMN. Otherwise, Remote UE constructs N3IWF FQDN based on either
the Tracking area Identity FQDN or on Operator Identifier FQDN of the PC5 path
access node selection information.
To assist the Remote UE with N3IWF selection, the Relay UE advertises the PLMN
ID and 5GS TAI corresponding to the serving cell in the PC5 UE-to-Network
discovery Announcement message (for Model A) or the UE-to-Network Relay
discovery Response message (for Model B) or in the Relay Discovery Additional
Information message.
Remote UE constructs the FQDN using either Tracking Area Identity FQDN or on
Operator Identifier FQDN and selects the N3IWF using the procedures of N3IWF
selection in clause 6.3.6 of TS 23.501 [6].
N3IWF identifier configuration and the PC5 path access node selection
information are provided to the Remote UE via ANDSP or extension to the ProSe
Policy. New fields can be added to ANDSP to indicate N3IWF selection
configuration over PC5 path.
### 6.23.5 Impacts on services, entities and interfaces
The solution has impacts in the following entities:
5GC entities (AMF, PCF, UPF):
\- Need to support the non-3GPP access via N3IWF as defined in TS 23.501 [6]
and TS 23.502 [8].
\- PCF provides new fields \"N3IWF identifier configuration\" and \"PC5 path
access node selection information\" in ANDSP policy of Remote UE.
\- PCF provides the corresponding PDU session parameters (e.g. S-NSSAI) for
N3IWF supported Relay Service Codes to the UE-to-Network Relay.
NG-RAN:
\- Function on the solution adopted for QoS handling.
N3IWF:
\- None.
Relay UE:
\- Configured to establish a PDU session for relaying (network configuration
ensures that this PDU Session provides access to N3IWF).
\- Advertises the PLMN ID and 5GS TAI corresponding to the serving cell in the
PC5 UE-to-NW discovery Announcement message (for Model A) or the UE-to-NW
Relay discovery Response message (for Model B) or in the Relay Discovery
Additional Information message.
Remote UE:
\- Remote UE needs to support running at least Rel-15 defined procedures for
untrusted non-3GPP access via N3IWF over L3 UE-to-NW Relay.
\- Remote UE constructs either Tracking Area Identity FQDN or on Operator
Identifier FQDN for N3IWF selection using Relay UE PLMN ID or 5GS TAI
## 6.24 Solution #24: End-to-End QoS support for Layer-3 UE-to-Network Relay
### 6.24.1 General Description
This solution addresses Key Issue#3 \" Support of UE-to-Network Relay \".
Specifically, this solution addresses the aspects on \" How to support end-to-
end requirements between Remote UE and the network via a UE-to-Network Relay,
including QoS (such as data rate, reliability, latency)\" and \" How the
network allows and controls the QoS requirement for 5G ProSe UE-to-NW relay\".
In Layer 3 UE-to-NW relay solution (Solution #6), the Remote UE\'s data flow
is served by the Relay UE\'s PDU Session. As the UE-to-Network relay path
comprises of two legs (PC5 and Uu) as shown in figure 6.24.1-1 below, the end-
to-end QoS can be met only when the QoS requirements are properly translated
and satisfied over the two legs respectively.
Figure 6.24.1-1: End-to-End QoS translation for Layer 3 UE-to-Network Relay
solution
The QoS requirements on the PC5 link are controlled with PC5 QoS rules and PC5
QoS parameters (PQI, GFBR, MFBR, PC5 LINK-AMBR, Range, etc) as specified in
clause 5.4 of TS 23.287 [5]. The QoS requirements on the Uu link are
controlled via with 5G QoS rules and 5G QoS parameters (5QI, GFBR, MFBR, etc)
as specified in clause 5.7 of TS 23.501 [6].
The Uu leg\'s QoS is associated with the PDU Session established by the UE-to-
Network Relay, and therefore the procedure as defined in TS 23.502 [8] clause
4.3.2 and 4.3.3 applies. The SMF of the UE-to-Network Relay would provide the
corresponding QoS rules and flow level QoS parameters to the UE-to-Network
Relay.
As explained above, the UE-to-Network Relay needs to translate the Uu QoS
information into the corresponding PC5 QoS parameters in order to achieve the
proper end-to-end QoS. Since the Remote UE and the UE-to-Network Relay uses
PC5 unicast communication mode, most of the flow level QoS parameters can be
directly reused. The only parameter that requires assistance in the
translation is the mapping of 5QIs and PQIs. It is therefore necessary that
the UE-to-Network Relay to be configured/provisioned with the proper mapping
information. The mapping of 5QIs and PQIs are configured/provisioned at UE-to-
Network Relay for a specific service or for a group of services. The 5QI for
Uu and PQI for PC5 are used together to support the end-to-end QoS
requirement.
Optionally, considering it has the possibility that the QoS info provided by
Remote UE to UE-to-Network relay is E2E QoS requirement instead of PC5 part
QoS requirement, so the proper mapping information to be
configured/provisioned for UE-to-Network relay may be a mapping of E2E QoS to
PC5 part QoS and Uu part QoS.
NOTE 1: The service or the group of services can be identified by Relay
Service Code, IP 3-tuple(s), etc.
In case the QoS Flows setup are initiated by network, PCF or SMF decides the
Uu part QoS parameters. Based on this information received from SMF, the UE-
to-Network Relay deduces the PC5 part QoS parameters and establishes
corresponding PC5 QoS Flows, using the procedure defined in TS 23.287 [5]
clause 6.3.3.4. For example, after receiving the QoS rules and flow level
parameters, the Relay UE determines the corresponding PC5 QoS Flows to
establish and the mapping between the Uu QoS Flows and the PC5 QoS Flows.
In case that the Remote UE requested dedicated PC5 QoS Flows when establishing
the L2 Link over PC5, the Remote UE gets the QoS mapping on the Relay UE via
PC5 and decides the PC5 part QoS parameters (i.e. PQI) by taking into account
the received QoS mapping information, the UE-to-Network relay can map the PC5
QoS requirements into Uu QoS requirements based on the provisioned QoS mapping
information or, if the mapping for the requested PC5 QoS parameter is not
configured, based on its implementation, and perform the UE requested PDU
session Modification as defined in TS 23.502 [8] clause 4.3.3.
In case that the QoS info provided by Remote UE to UE-to-Network relay is E2E
QoS requirement instead of PC5 part QoS requirement, the UE-to-Network relay
may perform the E2E QoS translation based on the configured/provisioned
mapping of E2E QoS to PC5 part QoS and Uu part QoS, and then establish
corresponding PC5 QoS flows and Uu QoS flows.
### 6.24.2 Enhancements to support dynamic QoS handling
As shown in figure 6.24.1-1, the end-to-end connection from the Remote UE to
the AS involves two over-the-air links, i.e. Uu and PC5. Therefore, to meet
the PDB for a particular service, the AN PDB utilized by the NG-RAN needs to
be reduced, in order to give some budgets for the PC5 link. Note that this is
independent of whether L2 or L3 Relay architecture is used.
One way to achieve this without affecting the NG-RAN is for the SMF to modify
the PDB signalled to the NG-RAN in the QoS Profile for the QoS Flows of the
Remote UE\'s traffic. SMF follows the PCC rules (if it is PCF determined) or
based on local configuration to deduct the PDB.
When dynamic PCC control is supported, the SMF can base on the PCC rules to
determine the PDB to use. Otherwise, SMF can base on pre-configuration, e.g.
using DNN and/or S-NSSAI, to determine if and how to modify the PDB.
When dynamic PCC control is supported, it is possible that the AF may be able
to request certain QoS handling of the traffic when the Remote UE initiated a
session. This can be achieved by using the feature as defined in TS 23.503
[18] clause 6.1.3.22. The AF is able to locate the UE-to-Network Relay\'s PCF
using the procedure as defined in TS 23.503 [18] clause 6.1.1.2, since the
Remote UE uses an address belonging to the UE-to-Network Relay\'s PDU session.
The PCF can decide the Uu part QoS parameters and generate corresponding PCC
rules, and the SMF in turn generate the QoS rules and flow level QoS
parameters and signal to the UE-to-Network Relay using PDU Session
Modification procedure. The UE-to-Network Relay then deduces the PC5 part QoS
parameters based on the QoS mapping between 5QIs and PQIs, and uses the L2
Link Modification procedure defined in TS 23.287 [5] clause 6.3.3.4 to set up
the related PC5 QoS flows.
NOTE: As UE-to-Network Relay uses the QoS mapping of 5QIs and PQIs to deduce
the PC5 part QoS parameters, the end-to-end QoS requirements provided by AF
which can\'t align with the QoS mapping between 5QIs and PQIs is not supported
in this solution.
In case of network scheduled operation mode for NR PC5 is used, procedures
defined in TS 23.287 [5] clause 5.4.1.4 is used to authorize the PC5 QoS
requests related to the relay operation.
The UE-to-Network Relay\'s subscription, and if applicable the Remote UE\'s
subscription, can be considered for QoS decision. NFs serving the UE-to-
Network Relay could retrieve Remote UE\'s subscription, if the UE-to-Network
Relay reports Remote UE\'s SUCI to network.
Alternatively, reflective QoS control over Uu as defined in TS 23.502 [8]
clause 5.7.3.5 can be leveraged for dynamic QoS handling of remote UE. This
can potentially save on signalling between SMF and UE-to-Network Relay UE to
frequently modify the relaying PDU session over Uu.
Upon reception of a DL packet with RQI on the Uu for the remote UE, based on
the indicated QFI, the UE-to-Network Relay derives or updates a QoS rule
corresponding to the remote UE, as defined in TS 23.501 [6]. The derived rule
is for UL packets from the remote UE at Uu interface. If the QFI to PC5 QoS
flow mapping already exist, the UE-to-Network Relay may use the L2 Link
Modification procedures as defined in TS 23.287 [5], clause 6.3.3.4 to move
the corresponding ProSe service(s) to the mapped existing PC5 QoS flow (based
on indicated QFI).
If the QFI to PC5 QoS flow mapping does not exist, , the UE-to-Network Relay
may determine the PQI based on the indicated 5QI (when the QFI is equivalent
to a standardized 5QI) , and sets up a new PC5 QoS Flow with the derived PQI
using L2 Link Modification procedures as defined in TS 23.287 [5], clause
6.3.3.4.
_When the UE-to-Network relay deletes the derived QoS rule e.g. after the_ RQ
Timer expires, _the UE-to-Network Relay resumes back to use the signalled QoS
rule and performs_ L2 Link Modification procedures defined in TS 23.287 [5]
clause 6.3.3.4 accordingly to use the PQI that corresponds to the 5QI of the
existing signalled QoS rule.
### 6.24.3 Procedures
Existing procedures defined in TS 23.502 [8] and TS 23.287 [5] can be used to
manage the QoS flows and PC5 QoS flows to serve the Remote UE.
### 6.24.4 Impacts on services, entities and interfaces
The solution has impacts in the following entities:
SMF:
\- SMF optionally supports modifying the PDB for a QoS Flow serving the Remote
UE based on either PCC rules or pre-configuration.
UE:
\- 5G ProSe UE-to-Network Relay supports the mapping of Uu flow level QoS
parameters to PC5 QoS parameters, including the mapping of 5QIs to PQIs, based
on configuration or, for a non-configured mapping of a requested QoS
parameter, based on its implementation.
\- 5G ProSe UE-to-Network Relay supports the mapping of E2E QoS to Uu flow
level QoS parameters and PC5 QoS parameters, including the mapping of E2E QoS
to 5QIs and PQIs, based on configuration.
\- Remote UE may decide the PC5 part QoS parameters (i.e. PQI) based on the
received QoS mapping from UE-to-Network Relay.
\- Remote UE gets the QoS mapping information from UE-to-Network Relay.
PCF:
\- supports to decide the Uu part QoS parameters and the PC5 part QoS
parameters based on the E2E QoS parameters.
## 6.25 Solution #25: QoS handling for Layer-3 UE-to-Network Relay
### 6.25.1 General Description
This is a solution for Key Issue #3, UE-to-Network Relay. especially it\'s
used for the QoS control of Layer-3 UE-to-Network Relay.
For a Remote UE accessing network via UE-to-Network Relay, the QoS control
between Remote UE and UPF includes two parts: one part is the QoS control for
the connection between remote UE and UE-to-Network Relay, the other part is
the QoS control for the connection between UE-to-Network Relay and UPF.
In case the QoS Flows setup are initiated by network, PCF is responsible to
set the QoS parameters between UE and UE-to-Network Relay, (we call it \"PC5
QoS parameters\"), and the QoS parameters between UE-to-Network Relay and UPF
(we call it \"Uu QoS parameters\") separately to support the QoS requirement
between Remote UE and UPF. The PC5 QoS parameters are provided to UE-to-
Network Relay together with the related QoS rule. Then UE-to-Network Relay
establishes the corresponding PC5 QoS Flows by the procedure defined in TS
23.287 [5] clause 6.3.3.4 using the received PC5 QoS parameters.
In case the Remote UE initiates PC5 QoS Flows setup, Remote UE provides the
end-to-end QoS requirements to the UE-to-Network Relay. There are two
alternatives proposed:
\- Option #1: the UE-to-Network Relay forwards the E2E QoS requirement
received from remote UE to PCF. then the PCF performs the E2E QoS split and
generates PCC rules and PC5 QoS parameters based on the remote UE provided E2E
QoS requirement.
\- Option #2: the UE-to-Network Relay splits the E2E QoS requirement (based on
its implementation or configured/provisioned QoS mapping information) to the
PC5 QoS parameters and the Uu QoS parameters. Then the UE-to-Network Relay
performs the UE requested PDU session Modification using the Uu QoS
parameters. If PCF changes the requested Uu QoS parameters, the UE-to-Network
Relay will accordingly update the PC5 QoS parameters to the Remote UE.
### 6.25.2 Support service(s) with preconfigured QoS parameters
The UE-to-Network Relay may be pre-configured with authorized service(s) and
the related PC5 QoS parameters and the related Uu QoS parameters. These can be
provided by PCF during provisioning procedure. The authorized service can be
identified by Relay Service Code or the IP 3-tuple(s) etc.
In case the QoS Flows setup are initiated by network, PCF sets the Uu QoS
parameters using the procedure as defined in TS 23.502 [8] clause 4.3.2 and
4.3.3. UE-to-Network Relay identifies the authorized service and establishes
the corresponding PC5 QoS Flows using the preconfigured PC5 QoS parameters.
In case the Remote UE initiates PC5 QoS Flows setup, Remote UE sets the PC5
QoS parameters by the procedure defined in TS 23.287 [5] clause 6.3.3.1 or
6.3.3.4, UE-to-Network Relay identifies the authorized service and perform the
UE requested PDU session Modification as defined in TS 23.502 [8] clause 4.3.3
using the preconfigured Uu QoS parameters.
### 6.25.3 Support service(s) with dynamic QoS handling, Network initiated QoS
Flow(s) setup
When a Remote UE want to use the service offered by an AF through 3GPP
network, it selects a UE-to-Network Relay and establishes a PC5 connection
between Remote UE and NW Relay, if the Remote UE doesn\'t have the PC5 QoS
parameters of the service, a default PC5 QoS Flow is setup using the default
PC5 QoS parameters in the provisioning information.
UE-to-Network Relay also setup a corresponding PDU session for relaying, e.g.
based on the S-NSSAI, DNN requested by remote UE. After the IP address/prefix
allocation, UE-to-Network Relay reports the IP info of remote UE to SMF, PCF
also receives the IP info of remote UE from SMF.
If the Remote UE doesn\'t have the PC5 QoS parameters of the service, After
the PC5 connection and the related PDU session setup, remote UE interacts with
AF for the application layer controlling messages required by the service, the
interaction is transferred through the default PC5 QoS Flow and the default
QoS Flow of the PDU session. Then AF provides the service requirement to PCF.
As PCF has received the remote UE report from SMF, PCF knows the target UE
requested by AF is a remote UE, PCF generates PCC rules (for QoS control on
Uu) and the PC5 QoS parameters (for QoS control on PC5), the PCF decision for
example could base on the received service requirements from AF and the
operator policies and the charging rate of Uu and PC5.
Figure 6.25.2-1: QoS control for L3 UE-to-Network Relay with AF involved
1\. When a Remote UE want to use the service offered by an AF through 3GPP
network, it selects a UE-to-Network Relay and establishes a PC5 connection
between Remote UE and NW Relay, it\'s same as the PC5 part of step 3 described
in clause 6.6.2. In this step, if the Remote UE doesn\'t have the PC5 QoS
parameters of the service, a default PC5 QoS Flow is setup using the default
PC5 QoS parameters in the provisioning information.
2\. UE-to-Network Relay sets up a corresponding PDU session or uses an
existing PDU session for relaying, e.g. based on the S-NSSAI, DNN requested by
remote UE.
3\. After the IP address/prefix allocation, UE-to-Network Relay reports the IP
info of remote UE to SMF, SMF also forwards the received report to PCF.
4\. If the Remote UE doesn\'t have the PC5 QoS parameters of the service,
Remote UE interacts with AF for the application layer controlling messages
required by the service, the interaction is transferred through the default
PC5 QoS Flow and the default QoS Flow of the PDU session.
5\. Since the address used by Remote UE belongs to the UE-to-Network Relay\'s
PDU session, AF is able to locate the UE-to-Network Relay\'s PCF and provides
the service requirement to PCF.
6\. PCF knows the target UE requested by AF is a remote UE, e.g. by the IP
info provided by AF and the IP info of remote UE received from SMF. PCF
generates PCC rules (for QoS control on Uu) and the PC5 QoS parameters (for
QoS control on PC5), the PCF decision for example could base on the received
service requirements from AF and the operator policies and the charging rate
of Uu and PC5. PCF provides PCC decision to SMF.
The UE-to-Network Relay\'s subscription, and if applicable the Remote UE\'s
subscription, can be considered for QoS decision. NFs serving the UE-to-
Network Relay could retrieve Remote UE\'s subscription, if the UE-to-Network
Relay reports Remote UE\'s SUCI to network.
7\. Based on the PCC rules received from PCF, SMF may decides to setup a new
QoS Flow or modify an existing QoS Flow for the PDU session. SMF generates QoS
rule to be enforced at UE-to-Network Relay and the QoS profile to be enforced
at RAN for the QoS control of Uu part. PDU session modification procedure is
performed. The PC5 QoS parameters is also provided to UE-to-Network Relay
together with the related QoS rule.
8\. UE-to-Network Relay uses the PC5 QoS parameters received from CN to
initiate the Layer-2 link modification procedure as described in TS 23.287
[5].
NOTE: In the case of network scheduled operation mode for NR PC5 is used,
procedures defined in TS 23.287 [5] clause 5.4.1.4 is used to authorize the
PC5 QoS requests related to the relay operation.
### 6.25.4 Support service(s) with dynamic QoS handling, Remote UE initiated
QoS Flow(s) setup
It\'s also possible that the Remote UE requests certain QoS handling of the
traffic. Remote UE knows the E2E QoS parameters based on the application layer
requirements. There are two alternatives to handle this scenario.
Option #1, the Remote UE can send the E2E QoS requirement to PCF via relay UE
over the PC5 message and NAS message without AF involved, and then the PCF
performs the E2E QoS split and generates PCC rules and PC5 QoS parameters
based on the remote UE provided E2E QoS requirement.
Figure 6.25.3-1: QoS control for L3 UE-to-Network Relay without AF involved
1\~3. Step1\~3 are same to the step1\~3 of clause 6.25.2.
4\. Remote UE sends the E2E QoS requirement info to UE-to-Network relay. The
E2E QoS requirement info may be the application requirement (e.g. priority
requirement, reliability requirement, delay requirement) or E2E QoS
parameters. The E2E QoS parameters may be derived from the application
requirement or based on the mapping of the ProSe service type to E2E QoS
parameters.
NOTE: It is expected that the Authorization and Provisioning for ProSe
communication contains the mapping of the ProSe service type to E2E QoS
parameters similar to V2X communication.
5\. UE-to-Network relay forwards the E2E QoS requirement info to the SMF via
the Remote UE report with the Remote UE info.
6\. SMF also forwards the E2E QoS requirement info to the SMF by the SM policy
association modification procedure.
7\. The PCF decides the PCC rules and PC5 QoS parameters based on E2E QoS
requirement info, operator policies and the charging rate of Uu and PC5. PCF
provides the PCC rules and PC5 QoS parameters to the SMF.
8\~9. The handling of step 8\~9 is same as the step 7\~8 of clause 6.25.2.
Option #2, Remote UE provides the end-to-end QoS requirements to the UE-to-
Network Relay by the procedure defined in TS 23.287 [5] clause 6.3.3.1 or
6.3.3.4. the UE-to-Network Relay splits the end-to-end QoS requirements (e.g.
based on provisioning policy) to the PC5 QoS parameters and the Uu QoS
parameters. Then the UE-to-Network Relay performs the UE requested PDU session
Modification as defined in TS 23.502 [8] clause 4.3.3 using the Uu QoS
parameters. If PCF changes the requested Uu QoS parameters, the UE-to-Network
Relay will accordingly update the PC5 QoS parameters to the Remote UE.
### 6.25.5 Impacts on services, entities and interfaces
PCF:
\- PCF generates PCC rules (for QoS control on Uu) and the PC5 QoS parameters
(for QoS control on PC5).
SMF:
\- Provides the PC5 QoS parameters to UE-to-Network Relay during PDU session
modification procedure.
\- Forwards IP info of Remote UE to PCF.
UE-to-Network Relay:
\- UE-to-Network Relay modify the Layer-2 link based on the PC5 QoS parameters
received from CN.
\- Forwards the E2E QoS requirement received from remote UE to CN or splits
the E2E QoS requirement received from remote UE into the corresponding PC5 QoS
parameters and Uu QoS parameters.
Remote UE:
\- Sends the E2E QoS requirement to UE-to-Network Relay.
## 6.26 Solution #26: URSP enhancements to support UE-to-Network Relay
operation
### 6.26.1 General Description
When a Remote UE has discovered a UE-to-Network Relay, it would have a choice
of different communications paths for an application/service, for example:
\- Via Uu directly to the base station and network (does not use the UE-to-
Network Relay);
\- Via a UE-to-Network Relay (in-direct network access) and access the service
via a UE-to-Network Relay\'s UPF (e.g. as described in Solution#6); or
\- Via a UE-to-Network Relay (in-direct network access) but access the service
via Remote UE\'s own UPF (e.g. as in Solution#7 or Solution #23 via N3IWF).
When the application traffic is routed along these different paths, different
QoS and security/privacy considerations apply. For example, due to the use of
Relay, and the additional PC5 link, the end-to-end PDB may be longer than the
direct access to the network. Therefore, some of the services may not be
suitable to be used over the Relay link. Additionally, if Remote UE uses the
UE-to-Network Relay\'s UPF to access the service, it cannot enjoy the benefit
provided by IP address preservation. The user experience would be similar to
using NSWO.
In this sense, the Remote UE needs to know if an application\'s traffic can be
routed via a certain path, so that the service requirements can be still met.
URSP rules as defined in TS 23.503 [18] provide the policy control information
to support this control at the Remote UE. In order to support the UE-to-
Network Relay operation, the URSP definition and interpretation needs to be
enhanced as following.
### 6.26.2 URSP enhancements to support UE-to-Network Relay operation
**Non-Seamless Offload indication**
In the current definition of URSP in TS 23.503 [18], the \"Non-Seamless
Offload indication\" only applies to non-3GPP access. However, in case of UE-
to-Network relay operation, when the Remote UE access the service via the
Layer 3 UE-to-Network Relay\'s UPF (i.e. solution#6), the traffic handling is
similar, i.e. sent outside of a Remote UE\'s PDU Session.
Thus, this _\"Non-Seamless Offload indication\"_ can be extended with some
value to indicate if the offloading is via non-3GPP access or a Layer 3 UE-to-
Network Relay.
Alternatively, a new similar indicator, e.g. \"ProSe Layer 3 UE-to-Network
Relay offload indication\", can be added to the Route selection components to
govern if the application traffic can be routed via a Layer 3 UE-to-Network
Relay path.
The Remote UE can use this indicator to determine the corresponding operations
when accessing a UE-to-Network Relay. For example, if any active application
matches a URSP rule that does not have this indicator, the Remote UE should
attempt to establish a PDU session based on the URSP rules, e.g. via the N3IWF
over the Layer 3 UE-to-Network Relay, or use a Layer 2 UE-to-Network Relay.
NOTE: For the N3IWF idenitifier and related URSP enhancements required, see
clause 6.23 (solution #23).
If, however, the application matches a URSP rule that has this indicator
present, the traffic can be routed via the Layer 3 UE-to-Network Relay
directly, and no PDU session is required.
**Access Type Preference**
The current Access Type preference defined in TS 23.503 [18] only includes
3GPP and/or non-3GPP when the UE establishes a PDU session for the matching
applications. However, when the UE-to-Network Relay is used, e.g. Layer 2 UE-
to-Network relay (Solution#7) or Layer 3 UE-to-Network relay with N3IWF
(Solution #23), the Remote UE supports the access to 5GC via the UE-to-Network
Relay path.
Therefore, it is preferable to extend the existing _\"Access Type preference\"
IE_ to include PC5 path, so that the Remote UE will be able to determine which
type of access should be used.
When accessing 5GC via a N3IWF is authorized for a Layer 3 Remote UE, the
N3IWF identifier shall be included in the 5G ProSe Remote UE
Policy/parameters.
### 6.26.3 Impacts on services, entities and interfaces
The solution has impacts in the following entities:
UE:
\- Remote UE needs to be able to interpret the URSP rules as defined above to
assist the path selection in case of accessing service via UE-to-Network
Relay.
## 6.27 Solution #27: Secondary Authentication for a Layer 3 Remote UE
### 6.27.1 Description
This is a solution for key issue #3, UE-to-Network Relay and based on Solution
#6: Layer-3 UE-to-Network Relay. This solution is only applicable for Layer 3
UE-to-Network Relay. When a subscription indicates that secondary
authentication is required, the Remote UE shall perform secondary
authentication. Because Application cannot differentiate whether a UE is
connected via UE-to-Network Relay or directly connected to the 5GC, if a UE
connects to the application server without performing Secondary
authentication, the application server may not provide service to the UE
because application server may regard the UE as an abnormal UE. So secondary
authentication should be supported even though a UE is connected via UE-to-
Network Relay.
### 6.27.2 Procedures
#### 6.27.2.1. Secondary Authentication after PC5 link setup
Figure 6.27.2-1: Secondary authentication procedure for a Remote UE (after PC5
link setup)
1\. Steps 0 \~ 4 in Figure 6.6.2-1.
2\. Step 5 in Figure 6.6.2-1. The ProSe 5G UE-to-Network Relay sends a Remote
UE Report (Remote User ID, IP info) message to the SMF for the PDU session
associated with the relay.
3\. When the SMF received Remote UE Report, based on local configuration of
the SMF, the SMF may retrieve subscription data of the Remote UE from the UDM
and may perform Secondary authentication/authorization for the Remote UE. The
SMF sends PDU Session Authentication Command message to the 5G ProSe UE-to-
Network Relay including Remote User ID.
4\. The 5G ProSe UE-to-Network Relay sends EAP message to the Remote UE via
PC5 signalling. The Remote UE sends EAP message to the 5G ProSe UE-to-Network
Relay via PC5 signalling.
5\. The 5G ProSe UE-to-Network Relay sends PDU Session Authentication Complete
message to the SMF including Remote User ID and EAP message received from the
Remote UE.
6\. The SMF sends EAP message to the DN-AAA.
7\. If the authentication/authorization success, the DN-AAA sends EAP-Success
to the SMF.
8\. If the authentication/authorization fails, the DN-AAA sends EAP-Failure to
the SMF. The SMF sends NAS message (e.g. PDU Session Modification, Remote UE
Release Command) to the 5G ProSe UE-to-Network Relay. The NAS message includes
Remote User ID to indicate the Remote UE and the 5G ProSe UE-to-Network Relay
releases the PC5 link with the Remote UE.
NOTE 1: It is possible to perform secondary authentication procedure in
parallel when multiple Remote UEs are connected to the 5G ProSe UE-to-Network
Relay almost at the same time.
NOTE 2: The DN-AAA does not know whether a UE is connected via 5G ProSe UE-to-
Network Relay or connected directly to the network.
Editor\'s note: Whether this solution can satisfy the security requirement
(e.g. EAP message forwarded by UE-to-Network Relay) will be investigated and
confirmed by SA WG3 group.
#### 6.27.2.2. Secondary Authentication before PC5 link setup
Figure 6.27.2-1: Secondary authentication procedure for a Remote UE (before
PC5 link setup)
1\. Steps 0 \~ 2 in Figure 6.6.2-1.
2\. Remote UE establishes PC5 connection towards the 5G ProSe UE-to-Network
Relay UE. When requesting UE-to-Network relaying over PC5, the Remote UE
provides its Remote User ID to the 5G ProSe UE-to-Network Relay UE.
3\. The 5G ProSe UE-to-Network Relay UE sends PDU Session Establishment or PDU
Session Modification Request to the SMF and provides the Remote UE ID of the
Remote UE.
4\. When the SMF received Remote User ID, based on local configuration of the
SMF, the SMF may retrieve subscription data of the Remote UE from the UDM and
may perform Secondary authentication/authorization for the Remote UE. The SMF
sends PDU Session Authentication Command message to the 5G ProSe UE-to-Network
Relay including Remote User ID.
5\. The 5G ProSe UE-to-Network Relay sends EAP message to the Remote UE via
PC5 signalling. The Remote UE sends EAP message to the 5G ProSe UE-to-Network
Relay via PC5 signalling.
6\. The 5G ProSe UE-to-Network Relay sends PDU Session Authentication Complete
message to the SMF including Remote User ID and EAP message received from the
Remote UE.
7\. The SMF sends EAP message to the DN-AAA.
8\. If the authentication/authorization success, the DN-AAA sends EAP-Success
to the SMF.
9\. The SMF sends PDU Session Establishment Accept or PDU Session Modification
Command to accept Remote UE\'s request.
10\. The 5G ProSe UE-to-Network Relay UE sends PC5 connection accept message
to the Remote UE.
11\. Step 5 in Figure 6.6.2-1.
12\. If the authentication/authorization fails, the DN-AAA sends EAP-Failure
to the SMF.
13\. The SMF sends PDU Session Establishment Reject or PDU Session
Modification Command to the 5G ProSe UE-to-Network Relay UE to reject Remote
UE\'s request.
14\. The 5G ProSe UE-to-Network Relay UE rejects PC5 connection establishment.
NOTE 1: It is possible to perform secondary authentication procedure in
parallel when multiple Remote UEs are connected to the 5G ProSe UE-to-Network
Relay almost at the same time.
NOTE 2: The DN-AAA does not know whether a UE is connected via 5G ProSe UE-to-
Network Relay or connected directly to the network.
### 6.27.3 Impacts on services, entities and interfaces
Remote UE:
\- send and receives EAP message via PC5 signalling;
\- execute secondary authentication with SMF.
UE-to-Network Relay UE:
\- includes Remote User ID in the PDU Session Authentication message and
relays EAP message between Remote UE and SMF.
\- send Remote User ID via PDU Session Establishment or Modification message
SMF:
\- decides whether to perform secondary authentication based on subscription
of Remote UE;
\- execute secondary authentication with Layer 3 Remote UE:
\- when SMF performs secondary authentication for a Remote UE, Remote User ID
is included in the PDU Session Authentication message;
\- if secondary authentication is failed, the SMF sends NAS message to release
PC5 link or to reject PC5 link establishment.
## 6.28 Solution #28: Layer-3 UE-to-Network Relay Discovery and Connection
Establishment
### 6.28.1 Description
This solution provides a mechanism for the Remote UE to discover a Layer-3 UE-
to-Network Relay and establish a PC5 unicast connection with a UE-to-Network
relay.
#### 6.28.1.1 UE-to-Network Relay discovery
Both Model A and Model B discovery mechanisms can be used for Layer-3 UE-to-
Network Relay discovery.
The Layer-3 UE-to-Network Relay acts as Announcing UE/Discoveree UE and the
Remote UE acts as Monitoring UE/Discoverer UE with following enhancements:
\- Model A: The Layer-3 UE-to-Network Relay announces UE-to-Network Relay
Service Code which is associated to dedicated network slicing information,
i.e. S-NSSAI. The associated S-NSSAI belongs to the Allowed NSSAI of the
Layer-3 UE-to-Network Relay. The Remote UE monitors announcement messages with
UE-to-Network Relay Service Code.
\- Model B: The Remote UE sends a solicitation message with the UE-to-Network
Relay Service Code which is associated to dedicated network slicing
information, i.e. S-NSSAI. If the Layer-3UE-to-Network Relay determines that
the associated S-NSSAI belongs to its Allowed NSSAI, it replies with a
response message which includes a UE-to-Network Relay Service Code.
The Layer-3 UE-to-Network Relay and the Remote UE receive the association
between UE-to-Network Relay Service Code and Slicing information during the
Service Authorization and Provisioning procedure in solution #16.
NOTE: The privacy aspects of preconfiguring slicing information in UE-to-
Network relays need to be coordinated with SA WG3.
The Remote UE shall consider the network slicing information associated with
the UE-to-Network Relay Service Code when selecting a UE-to-Network Relay.
#### 6.28.1.2 PC5 connection establishment
After UE-to-Network Relay discovery, the Remote UE may decide to establish a
PC5 connection with a UE-to-Network Relay. The PC5 connection establishment
reuses the Direct Communication procedure as described in clause 6.3.3 of TS
23.287 [5], with the following enhancements:
\- The Remote UE determines the PDU session requirements (e.g. S-NSSAI, DNN,
PDU Session Type, SSC mode) and includes the PDU session requirements in the
Direct Communication Request message during the PC5 connection establishment
procedure. How to determine the PDU session requirements is based on, e.g.
URSP rules (pre-configured or received from PCF during previous Remote UE
registration procedure as step 0 in Figure 6.6.2-1). The Remote UE only
provides standardized S-NSSAI (as specified in clause 5.15.2 of TS 23.501 [6])
in the Direct Communication Request when the Remote UE and the UE-to-Network
Relay belong to different HPLMNs.
NOTE 1: The privacy aspects of transporting PDU session parameters using an
unsecured PC5 Direct Communication Request message need to be coordinated with
SA WG3.
NOTE 2: The Remote UE doesn\'t need to provide all PDU session requirements.
When some PDU session requirements are not provided, the UE-to-Network Relay
can use the default PDU session parameters. The default parameters are
preconfigured or provisioned via URSP rules as specified in solution#38.
\- Upon receiving a Direct Communication Request message, the UE-to-Network
Relay may decide to establish a new PDU session or modify an existing one for
the traffic of the Remote UE, based on the PDU session requirements received
from the Remote UE. For example, if the UE-to-Network Relay receives PDU
session requirements (DNN-A) and there is an existing PDU session with DNN-A,
the UE-to-Network Relay may associate the Direct Communication Request to the
existing PDU session.
NOTE 3: It is up to implementation if the UE-to-Network Relay uses default PDU
session parameters or rejects the Direct Communication Request when the PDU
session requirements cannot be satisfied or understood.
### 6.28.3 Impacts on services, entities and interfaces
Remote UE:
\- Discover and select UE-to-Network Relay based on network slicing
information.
\- Provide PDU session requirements during PC5 connection establishment.
\- Keep association between UE-to-Network Relay Service Code and Slicing
information.
UE-to-Network Relay:
\- Keep association between UE-to-Network Relay Service Code and Slicing
information.
\- Handle PDU session based on PDU session requirements received from the
Remote UE.
## 6.29 Solution #29: Service continuity via L2 UE-to-Network Relay
### 6.29.1 Description
This solution, based on Solution 7, addresses Key Issue #3 and proposes a
Layer-2 based UE-to-Network relay solution to ensure the service continuity
between the remote UE and the network for the intra-NG-RAN case.
NOTE: This solution is documented for illustration purpose only. It will be
updated to highlight the SA WG2 impact if identified any, or will be removed
and replaced by referencing to RAN WG conclusion if any in this area.
### 6.29.2 Procedures
#### 6.29.2.1 From direct to indirect path under the same NG-RAN
Figure 6.29.2.1-1: Service continuity from direct to indirect under the same
NG-RAN
0\. It is assumed that the Remote-UE has been authorized to access to the
network via a UE-to-Network Relay.
1\. The Remote UE receives the measurement configuration via RRC message from
the NG-RAN. The access stratum procedure that the Remote UE, UE-to-Network
Relay and served NG-RAN node for handover is defined by RAN WG2.
2\. The NG-RAN may trigger the AN initiated PDU Session Modification as
specified in TS 23.502 [8].
#### 6.29.2.2 From indirect to direct path under the same NG-RAN
Figure 6.29.2.1-2: Service continuity from indirect to direct under the same
NG-RAN
1\. The Remote UE receives the measurement configuration via RRC message from
the NG-RAN as defined in TS 38.331 [23]. The access stratum procedure that the
Remote UE, UE-to-Network Relay and served NG-RAN node for handover is defined
by RAN WG2.
2\. The NG-RAN may trigger the AN initiated PDU Session Modification as
specified in TS 23.502 [8].
### 6.29.3 Impacts on services, entities and interfaces
This solution needs to use the RAN specified L2 relay functionality for
forwarding the signalling and user data between the Remote UE and the network.
Remote UE
\- Sends AS message(s) to UE-to-Network Relay to execute handover. The
procedure is decided by RAN.
NG-RAN
\- AS procedures for handover. The procedure is decided by RAN.
AMF/SMF
\- No impact.
## 6.30 Solution #30: Authorization of UE-to-Network Relay UE and Remote UE
### 6.30.1 Description
This solution applies to Key Issue 3 on authorization for Indirect 3GPP
Communication, specifically on how to authorize a UE to access 5GC via a 5G
UE-to-Network Relay. In this solution, the core network performs authorization
functions when a Remote UE is accessing to the network via a specific UE-to-
Network Relay UE. This solution is used for Layer 2 UE-to-Network Relay.
### 6.30.2 Procedures
0\. UE performs the Registration and gets the service authorization
parameters. This step can reuse step 0 and step 1 in Solution #7.
1\. Relay discovery and selection. This step can reuse step 2 and step 3 in
Solution #7 (see clause 6.7.2). Using restricted discovery with Relay Service
Code can achieve a certain level of authorization.
2\. The Remote UE sends communication request to the Relay UE. This step can
step 4 in Solution #7. The Remote UE provides its SUCI in the request message.
3\. The Relay UE, after receiving the communication request from the Remote
UE, sends an authorization request to its AMF. Relay UE may use NAS message,
such as service request message or registration message, to send the
authorization request. The SUCI of Remote UE is in the authorization request
message. If the relay service related information is used in step 1, then the
Relay UE may provide it in the request message.
4\. Based on the authorization information in step 0, the Relay UE\'s AMF
checks whether the Relay UE is authorized to provide the Relay service. If
authorized, the Relay UE\'s AMF performs the procedure of authentication of
the Remote UE. Otherwise, the Relay UE\'s AMF performs step 7 by responding to
the Relay UE with an authorization failure indication.
5\. If authorization is performed by the PCF, the Relay UE\'s AMF transfers
the authorization request to the AM PCF. The AM PCF will check if the Remote
UE is authorized to access 5GC via the Relay UE. The CN NF may check the
authorization based on subscription data of the Relay UE, such as list of
Remote UEs allowed to use this Relay UE\'s service. The Remote UE ID and the
Relay UE ID are included in the Relay authorization check request message. The
UE ID can be GPSI or SUPI.
6\. The Relay UE\'s PCF responds to the Relay UE\'s AMF with the authorization
result.
7\. The Relay UE\'s AMF responds to the Relay UE with the authorization
result.
8\. The Relay UE sends the communication response message to the Remote UE,
and may indicate the authorization result.
9\. Other steps are performed, including step 6-9 in the procedure of Solution
#7.
Figure 6.30.2-1: Authorization of UE-to-Network Relay UE and Remote UE
### 6.30.3 Impacts on services, entities and interfaces
The solution has impacts in the following entities:
**Relay UE:**
\- Needs to support procedures for authorization.
**AMF/PCF:**
\- Needs to support procedures for authorization.
## 6.31 Solution #31: QoS control for UE-to-UE Relay
### 6.31.1 Description
This is a solution for Key Issue #4, UE-to-UE Relay. This solution is
applicable for both Layer 2 UE-to-UE Relay and Layer 3 UE-to-UE Relay.
When a source UE wants to establish unicast communication with a target UE,
the source UE will decide the E2E QoS parameters between source UE and target
UE based on the application layer requirements. The E2E QoS parameters,
especially the PDB, needs to be split between the two PC5 interface. The PER
of the two PC5 interfaces also needs to be set properly to achieve the PER
target in the E2E QoS parameters.
Relay will split the E2E QoS parameters into two parts: one part is the QoS
parameters between source UE and Relay (we call it \"Source side PC5 QoS
parameters\"), the other part is the QoS parameters between Relay and the
target UE (we call it \"Target side PC5 QoS parameters\").
When standardized PQI is used, the Source side PC5 QoS parameters and the
Target side PC5 QoS parameters include PQI and other optional QoS parameters,
e.g. GFBR. When non-standardized PQI is used, the whole set of PC5 QoS
characteristics is also included.
Relay ensures the PDB and PER associated with the PQI in the Source side PC5
QoS parameters and the PDB and PER associated with the PQI in the Target side
PC5 QoS parameters supports the E2E PDB requirements between Remote UE and
target UE. Relay also ensures other QoS parameters/QoS characteristics in the
Source side PC5 QoS parameters and Target side PC5 QoS parameters are
compatible, e.g. have the same value. The Relay decision may be based on the
local policy or the low layer measurement.
Optionally, it\'s possible that the source UE is pre-configured with
authorized service(s) and the related Source side PC5 QoS parameters, the UE-
to-UE Relay is pre-configured with authorized service(s) and the related
Target side PC5 QoS parameters. These can be provided by PCF during
provisioning procedure. The authorized service can be identified by Relay
Service Code etc. With the preconfigured QoS parameters, the source UE
provides the Source side PC5 QoS parameters to the UE-to-UE Relay by the
procedure defined in TS 23.287 [5] clause 6.3.3.1 or 6.3.3.4, then the UE-to-
UE Relay identifies the authorized service and establishes the corresponding
PC5 QoS Flows with the Target UE using the preconfigured Target side PC5 QoS
parameters.
E2E QoS parameters splitting is common for both Layer 2 UE-to-UE Relay and
Layer 3 UE-to-UE Relay. The difference lies in the QoS flow. In the Layer 3
UE-to-UE Relay case, two QoS flows are setup, one QoS flow between Source UE
and UE-to-UE Relay UE, and another QoS flow between Source UE and UE-to-UE
Relay UE. In the Layer 2 UE-to-UE Relay case, the end-to-end QoS flow is setup
between the Source UE and the Target UE.
### 6.31.2 Procedures for Layer 3 UE-to-UE Relay
Figure 6.31.2-1: QoS control for Layer 3 UE-to-UE Relay
1\. Source UE wants to establish unicast communication with target UE, it
decides the E2E QoS parameters between source UE and target UE based on the
application layer requirements. The Source UE sets up a PC5 QoS Flow with
PFI=PFI_s. Then Source UE provides the PFI_s, E2E QoS parameters, source and
target user info to UE-to-UE Relay. The process is similar to the unicast L2
link establishment or modification procedure as defined in TS 23.287 [5]
clause 6.3.3.
2\. Relay splits the E2E QoS parameters into two parts: one part is for the
PC5 interface between source UE and Relay, the other part is for the PC5
interface between Relay and the target UE. Relay will setup a PC5 QoS Flow
with PFI=PFI_t using the target side PC5 QoS parameters between Relay and the
target UE.
3\. Relay provides the PFI_t, target side PC5 QoS parameters, source and
target user info to target UE. The process is similar to the unicast L2 link
establishment or modification procedure as defined in TS 23.287 [5] clause
6.3.3.
4\. Relay receives the Layer-2 link establishment/modification accept from
target UE.
5\. Relay provides the Layer-2 link establishment/modification accept to the
source UE with the PFI_s and the source side PC5 QoS parameters.
The data transfer on Layer 3 UE-to-UE Relay is according to traffic filter on
both hops.
### 6.31.3 Procedures for Layer 2 UE-to-UE Relay
Figure 6.31.3-1: QoS control for Layer 2 UE-to-UE Relay
0\. When the Source UE wants to communication with the target UE, it uses the
extended unicast link defined in Solution#9, and the Source UE decides the E2E
QoS parameters between Source UE and Target UE based on the application layer
requirements. The Source UE sets up a PC5 QoS Flow with PFI, similar to the
V2X mechanism defined in clause 6.3.3.1 of TS 23.287 [5], the Source UE
negotiates the information about PC5 QoS Flow, which includes the PFI, the
corresponding E2E PC5 QoS parameters and the associated application info, with
the Target UE in step 0a and step 0b. In this step, E2E PC5-S messages are
used for E2E QoS negotiation, and the UE-to-UE Relay just transfers the E2E
PC5-S messages using the RAN specified L2 relay method.
NOTE: The PC5-S messages used in step 0 are the E2E PC5-S messages transferred
between the Source UE and the Target UE and the PC5-S messages used in step 1
to step 5 are the per-hop PC5-S messages transferred between the Source UE or
the Target UE and the UE-to-UE Relay.
1\. After the E2E QoS parameter negotiation in step 0a and step 0b, the Source
UE provides the PFI, E2E QoS parameters, source and target user info to UE-to-
UE Relay. The process is similar to the unicast L2 link establishment or
modification procedure as defined in TS 23.287 [5] clause 6.3.3.
2\. Relay splits the E2E QoS parameters into two parts: one part is for the
PC5 interface between source UE and Relay (source side PC5 QoS parameters),
the other part is for the PC5 interface between Relay and the target UE
(target side PC5 QoS parameters).
3\. Relay provides the PFI received from source UE, target side PC5 QoS
parameters, source and target user info to target UE. The process is similar
to the unicast L2 link establishment or modification procedure as defined in
TS 23.287 [5] clause 6.3.3.
4\. Relay receives the Layer-2 link establishment/modification accept from
target UE.
5\. Relay provides the Layer-2 link establishment/modification accept to the
source UE with the PFI and the source side PC5 QoS parameters.
After the PC5 QoS parameters splitting for two PC5 links, the AS layer
configurations for PC5 QoS parameters in each of the PC5 links can be achieved
according to legacy mechanisms in Rel-16 V2X (TS 23.287 [5]). For the QoS
enforcement, the UE-to-UE Relay UE performs the necessary adaptation in the AS
layers of the two PC5 interfaces, and it transfers the received data based on
the adaptation in the AS layer.
Editor\'s note: How to ensure the PC5 QoS over the two PC5 links by the
Adaptation Layer, and the functionalities of the Adaptation Layer will be
confirmed by RAN WG2.
If the Source UE or Target UE wants to add, remove or modify a QoS flow on the
extended unicast link, the link modification procedure defined in clause
6.3.3.4 of TS 23.287 [5] can be used, where the Link Modification Request
message is the E2E PC5-S message.
### 6.31.4 Impacts on services, entities and interfaces
\- UE-to-UE Relay supports the E2E QoS parameters splitting between the two
PC5 interfaces.
## 6.32 Solution #32: Support Layer-3 UE-to-UE Relay Based on IPv6 link-local
addresses
### 6.32.1 Description
The basic idea of the solution is when a UE establishes a connection with a
UE-to-UE relay, it uses its link-local IPv6 address as its IPv6 address and
informs to the relay UE. The relay UE maintains a mapping between link-local
IPv6 addresses to UE IDs (e.g. Application Layer IDs), as well as mapping from
an Application User ID to a PC5 unicast link.
The solution is based on the following assumptions:
1\. A source UE establishes a unicast link to a relay UE for communicating
with target UEs which connects to that relay UE.
2\. For a specific source UE, the traffic to target UEs through the same relay
UE can share the same unicast link to that relay UE.
3\. When the relay UE receives a packet from a source or target UE, it
forwards the packet to an PC5 unicast link according to the destination IP
address in the packet.
### 6.32.2 Procedures
In this clause, UE-1 and UE-2 are the source and target UEs, respectively.
Relay-1 is a Layer-3 UE-to-UE relay.
#### 6.32.2.1 Relay path establishment procedure
Step 1. UE-1 and UE-2 do the relay selection. In this step, any solution for
UE-to-UE relay selection can be applied here, e.g. solution#8.
Step 2. UE-1 and UE-2 establish individual unicast link to Relay-1, if they do
not have unicast link with the relay for the UE-to-UE relaying communication
use case.
UE forms its own link-local IPv6 address based on IETF RFC 4862 [33] and
informs the IP address to the relay UE. Relay UE maintains a mapping between
the UE ID (e.g. Application Layer ID) and the link-local address.
NOTE: If the link-local IP address of UE-1 or UE-2 is conflicting with the
link-local IP address of another remote UE that has already connected to the
relay UE, the relay shall inform UE-1 or UE-2 to change its link-local IP
address, e.g. using the address duplicate detection procedure defined in IETF
RCF 4862 [33].
Step 3. If UE-1 does not know the IP address of UE-2, it sends a request to
the relay UE, asking the IP address of UE-2. The request includes the UE-2 ID,
e.g. the Application Layer ID. Relay-1 gives the link-local IP address of UE-2
to UE-1. UE-2 does the same procedure if it does not know the IP address of
UE-1.
Step 4. UE-1 and UE-2 can communicate with each other via Relay-1.
When the remote UEs change Layer-3 UE-to-UE relay, they can keep their link-
local IP addresses. The old UE-to-UE relay shall remove the mapping between
the link-local IP address and the remote UE.
Editor\'s note: Whether and how to support periodic change of the link-local
IP address due to privacy requirement is FFS and co-ordinated with SA WG3
group.
Figure 6.32.2.1-1 UE-1 communicates with UE-2 via Layer-3 UE-to-UE relay
#### 6.32.2.2 Path switch from one UE-to-UE relay to another UE-to-UE relay
The following procedure depicts the scenario that UE-1 and UE-2 changes the
UE-to-UE relay from Relay-1 to Relay-2.
Figure 6.32.2.2-1 UE-1 and UE-2 change the communication path from the path
via Relay-1 to the path via Relay-2
Step1. One of the remote UE detects the current UE-to-UE communication path is
not good enough or some other event triggers relay re-selection, so the relay
re-selection is executed.
NOTE 1: The reselection trigger for UE-2 can be based on, for example,
application layer trigger or based on current relay conditions.
Step2. Any UE-to-UE (re)selection solution for Layer-3 UE-to-UE relay can be
applied here, and Relay-2 is selected as the new relay by UE-1 and UE-2.Step3.
UE-1 and UE-2 establish unicast link individually to Relay-2. The UE-1 and
UE-2 keep their link-local addresses and inform the IP addresses to the
Relay-2. Relay-2 maintains a mapping between the UE IDs (e.g. Application
Layer IDs) and the link-local addresses.
This step can be skipped if the remote UE already has a unicast link with the
same link-local IPv6 address to Relay-2.
Step4. UE-1 and UE-2 send an end marker through the old path to each other,
indicating that they start sending traffic via the new path.
NOTE 2: The UEs can wait for a predetermined period until the end marker is
received from each other before switching to new path. Such details are to be
developed during stage 3 work.
Step5. UE-1 and UE-2 can communicate with each other via Relay-2.
### 6.32.3 Impacts on services, entities and interfaces
The solution impacts the relay UE to support IP packets forwarding between
remote UEs.
## 6.33 Solution #33: Network-Assisted UE-to-UE Relay Discovery and Selection
### 6.33.1 Description
For the dedicated application service, e.g. direct communication within a
factory plant, the UEs in the same group may communicate with each other via
direct PC5 link, such as the UE1, UE2, UE3 as shown in the graph below.
However due to UE mobility, UE2 may move out of PC5 coverage of UE1, then
there should be a UE3 to as a UE-to-UE relay to transfer the packets between
UE1 and UE2.
Assuming two 5G ProSe-enabled UEs commnicate with each other using ProSe
direct communication, due to the UE mobility, the communciation path may
exceed the direct communication range. In order to continue the communication,
a UE-to-UE relay is inserted to forward the traffic between the two UEs.
If 5G ProSe-enabled UEs are in coverage, 5G network can track the location of
the UE. When 5G network determines the direct communication path will not be
available, it may provide the UE-to-UE relay information to the 5G ProSe-
enabled UE.
The UE-to-UE relay information e.g. UE ID and UE location, is retrived by the
5G network from the ProSe application server. 5G network authorizes UE-to-UE
relay once provisioned by the ProSe application server. Besides of the UE-to-
UE relay information, ProSe application server also provides information of
the 5G ProSe-enabled UE using the ProSe direct communication, e.g. which two
UEs are using ProSe direct communication.
5G network tracks the 5G ProSe-enabled UE based on their cell information, and
in addition more accuracy location by LCS procedure.
If there is more than one candidate UE-to-UE relay, 5G network selects the
most suitable UE-to-UE relay, based on the location and capability of the UE-
to-UE relay.
When receiving the UE-to-UE relay information from the 5G network, 5G ProSe-
enabled UE establishes the PC5 link with UE-to-UE relay and sends packet to
the other 5G ProSe-enabled UE i.e. receiver UE, via the UE-to-UE relay.
Figure 6.33.1-1: Network-Assisted UE-to-UE relay Discovery and Selection
### 6.33.2 Procedure
Figure 6.33.2-1 shows the peer discovery and unicast link establishment over
PC5 reference point via a UE-to-UE Relay.
Figure 6.33.2-1: Network-Assisted Connection establishment procedure via a UE-
to-UE Relay
0\. UE-to-UE Relay registers with the network and specifies its UE-to-UE Relay
capabilities.
1-2. External AF may provide the UE trajectory information of UEs to network
via NEF. For example, network may determine that Target UE may move out of PC5
coverage of Remote UE based on the Target UE or Remote UE\'s trajectory, this
step is optional.
3\. UE-1 and UE-2 are communicating with each other via direct PC5 link.
4\. After establishing PC5 link, UE-1 and UE-2 notify 5GS that they are
communicating with each other via direct PC5, then 5GS may subscribe to (one
of the) UEs for the PC5 link status.
5\. Network locates the UE-1, UE-2, and UEs that have relay capability and are
authorized to use ProSe periodically via the 5GC-MT-LR Procedure specified in
clause 6.3.1 of TS 23.273, based on the AF request received in step 1.
6\. Based on the relative distance and PC5 link status between UE-1 and UE-2
obtained in step 4 and step 5, AMF(or other NF) determine UE-2 and UE-1 cannot
communicate with each other via direct PC5, and select a proper UE-R that
locates between UE-1 and UE-2 to as the UE-to-UE relay based on the relative
location information between each of them obtained in step 4.
7\. (Optional) 5GC informs the UE-R to as the relay to transfer the packets
between UE-1 and UE-2, this request includes the UE-1 identity, UE-1
Capability, UE-2 identity, UE-2 Capability.
8\. 5GC informs the UE-1 that UE-R will be the relay for its connection with
UE-2, this request includes the UE-R identity, UE-R Capability.
NOTE: It is up the UE-1 to establish the PC5 link with UE-R, using the
information provided by the 5GC. UE-1 may have other means to discover and
select a UE-R.
9\. UE-to-UE Relay receives the message from UE-1and transfer the message to
UE-2 according to the mapping entry relationship or the UE-2 destination
address provided by UE-1.
Editor\'s note: The details of protocol stack and PC5 link establishment is
FFS and need to be co-ordinated and confirmed by RAN WG2 group, and this
solution does not have constraint upon Layer-2 or Layer-3 relay.
### 6.33.3 Impacts on services, entities and interfaces
AMF:
\- Support for selecting a proper ProSe-enabled UE as the relay UE based on
the relative distance calculation.
## 6.34 Solution #34: Charging support for 5G ProSe over U-plane
### 6.34.1 Description
In TS 32.277 [13], a complete charging system was specified for ProSe based on
EPS system, including the support of charging support of ProSe Direct
Discovery, one-to-many Direct Communication, and one-to-one Direct
Communication including UE-to-Network Relay (for public safety use), and EPC
based discovery.
Specifically, for the ProSe Direct Communication, offline charging is
supported with the architecture in TS 32.277 [13] clause 4.2:
The PC3ch control protocol was defined in TS 24.334 [20], clause 10.3. The
PC3ch goes through user-plane to the Charging Trigger Function (CTF). Since
the Accounting Data Forwarding (ADF) function block of the CTF is a logical
function, it can be residing anywhere in the network, e.g. co-located with a
UPF. As specified in TS 24.334 [20], the UE can be configured with the IP
address of the ADF, within the configuration from ProSe Function as defined in
TS 24.333 [21].
When mapped to 5GS, the provisioning component of the ProSe Function is
replaced by PCF. Therefore, the corresponding usage reporting configuration
and rules, defined in TS 24.333 [21] clause 5.2, can be provisioned via PCF
using the UE Policy provisioning mechanism as defined in TS 23.502 [8].
The reporting channel, i.e. PC3ch, can be setup over a PDU session that is
established with the appropriate parameters. The URSP can be used to identify
the corresponding parameters for the PDU session to use for this reporting
purpose. For example, the reporting can be associated with a specific DNN and
S-NSSAI, or connectivity type, as that defined in the Traffic Descriptor of
URSP.
The interaction of the ADF (part of CTF) and CHF follows the model defined in
TS 32.290 [22] via the Nchf interface that supports converged charging or
offline only charging.
Editor\'s note: The support of 5G ProSe charging over the Nchf interface needs
to be specified by SA WG5.
### 6.34.2 Procedures
#### 6.34.2.1 UE Configuration for the ProSe usage reporting
Procedure defined in TS 23.502 [8] clause 4.2.4.3 UE Configuration Update
procedure for transparent UE Policy delivery is used for provisioning the UE
regarding the PC5 usage reporting to support ProSe charging.
The UsageInformationReprotingConfiguration as defined in clauses 5.2.58 to
5.2.66B of TS 24.333 [21] should be contained in the UE Policy container to
the UE, which contains the Server Address for the reporting of the usage over
PC5.
In order to support the use cases that requires out of coverage operation or
out of box operation, the configuration may be stored in the ME, UICC, or
both, similar to the handling of V2X policies in TS 23.287 [5].
#### 6.34.2.2 UE usage reporting
Based on the configuration described in clause 6.34.2.1, the UE will establish
a PDU session or use an existing PDU session, based on the URSP configuration,
for the usage reporting.
Figure 6.34.2.2-1: ProSe Direct Communication offline charging architecture
### 6.34.3 Impacts on services, entities and interfaces
For 5G ProSe UEs, the authorization and provisioning polices needs to be
extended to support the operation.
As for the network nodes, only the following need to be added:
\- PCF needs to be enhanced to support the provisioning of the ProSe usage
reporting configuration for charging support.
\- UE needs support the ProSe usage reporting to the ADF/CTF as configured by
PCF.
\- A new ADF/CTF node need to be added to the system, that should be able to
use Nchf interface to interact with CHF as defined in TS 32.290 [22].
## 6.35 Solution #35: Authorization for 5G ProSe UE-to-Network Relay Service
### 6.35.1 Description
This solution addresses KI#3 and 8 and applies to both Layer-2 and Layer-3 UE-
to-Network Relay.
For KI#3 (Support of UE-to-Network Relay), following aspect is covered:
\- How to authorize a UE to be a 5G UE-to-Network Relay and how to authorize a
UE to access 5GC via a 5G UE-to-Network Relay.
For KI#8 (Support of PC5 Service Authorization and Policy/Parameter
Provisioning), two following major aspects are covered:
\- For the procedures related to PC5 service authorization and
policy/parameter provisioning to a UE, only necessary enhancement with what is
specified in TS 23.287 [5] clause 6.2 and TS 23.502 [8] clause 4.2.2.2
(Registration Procedure), 4.2.4.3 (UE Configuration Update procedure for
transparent UE Policy Delivery), 4.16.11 (UE Policy Association Establishment
procedure), 4.16.12 (UE Policy Association Modification procedure), will be
documented.
\- Identify necessary information for PC5 service authorization and
provisioning based on what is specified in TS 23.287 [5] clause 5.1.2.1.
The PCF based service authorization and provisioning as defined in TS 23.287
[5] are used as baseline for this solution.
For both Layer 2 and Layer 3 Relay:
\- when the Remote UE is in coverage, the Remote UE can be provisioned with
authorization policy and parameters by 5GC directly with enhancement described
in clause 6.35.2.2.
\- when the Remote UE is out of coverage, the Remote UE can use its
preconfigured policy and parameter for PC5 discovery and communication to
establish PC5 connection with a UE-to-Network Relay first, then:
\- For Layer 2 Relay, the existing PCF based service authorization and
provisioning procedure can be used with enhancement described in clause
6.35.2.2, which applies to the communication between Remote UE and 5GC.
\- For Layer 3 Relay, the existing service authorization and provisioning
procedure can be used, if the Remote UE is configured to access 5GC via N3IWF,
as described in clause 6.23.
Editor\'s note: For Layer 3 Relay, how to provision and update the policy to a
Remote UE via Layer 3 Relay not using N3IWF is FFS.
### 6.35.2 Procedures
#### 6.35.2.1 Procedure Enhancement for Information Provisioning to a 5G ProSe
Remote UE/UE-to-Network Relay
For PCF based Service Authorization and Provisioning to 5G ProSe Remote UE/UE-
to-Network Relay, the Registration procedures as defined in clause 4.2.2.2 of
TS 23.502 [8], UE Policy Association Establishment procedure as defined in
clause 4.16.11 of TS 23.502 [8] and UE Policy Association Modification
procedure as defined in clause 4.16.12 of TS 23.502 [8] apply with the
following additions:
\- If the UE indicates 5G ProSe capability as a Remote UE/UE-to-Network Relay
in the Registration Request message and if the UE is authorized to be a 5G
ProSe Remote UE/UE-to-Network Relay based on subscription data, the AMF
selects the PCF which supports 5G ProSe information provisioning and
establishes a UE policy association with the PCF for 5G ProSe Remote UE/UE-to-
Network Relay information provisioning delivery.
\- If the AMF receives the 5G ProSe capability as a Remote UE/UE-to-Network
Relay in the Registration Request message from UE, the AMF further reports the
5G ProSe capability as a Remote UE/UE-to-Network Relay to the selected PCF.
The PCF determines the 5G ProSe Remote UE/UE-to-Network Relay information
based on the received 5G ProSe capability as a Remote UE/UE-to-Network Relay.
\- If the UE supports 5G ProSe capability as a Remote UE/UE-to-Network Relay
and it does not have valid 5G ProSe Remote UE/ UE-to-Network Relay
information, the UE includes the UE Policy Container with indicating the 5G
ProSe Remote UE/UE-to-Network Relay Information Provisioning request during
registration procedure.
\- If the UE indicates the 5G ProSe UE-to-Network Relay Information
Provisioning request in the UE Policy Container, the PCF determines whether to
provision the 5G ProSe Remote UE/UE-to-Network Relay Information to the UE, as
specified in clause 6.1.2.2.2 of TS 23.503, and the PCF provides the 5G ProSe
Remote UE/UE-to-Network Relay Information to the UE by using the procedure as
defined in clause 4.2.4.3 \"UE Configuration Update procedure for transparent
UE Policy Delivery\" in TS 23.502 [8].
The PCF may update the 5G ProSe Policy and parameters to the UE in following
conditions:
\- UE Mobility, e.g. UE moves from one PLMN to another PLMN. This is achieved
by using the procedure of UE Policy Association Modification initiated by the
AMF, as defined in clause 4.16.12.1 of TS 23.502 [8].
\- When there is a subscription change in the list of PLMNs where the UE is
authorized to perform the 5G operation. This is achieved by using UE Policy
Association Modification initiated by the PCF procedure as defined in clause
4.16.12.2 of TS 23.502 [8].
\- When there is a change of service specific parameter as described in clause
4.15.6.7 of TS 23.502 [8].
If the serving PLMN is removed from the list of PLMNs in the service
authorization parameters, the service authorization is revoked in the UE.
When the UE is roaming, the change of subscription resulting in updates of the
service authorization parameters are transferred to the UE by H-PCF via V-PCF.
The UE may perform UE triggered Policy Provisioning procedure to the PCF as
specified in clause 6.2.4 of TS 23.287 [5] when the UE determines the 5G ProSe
Policy and parameters are invalid (e.g. Policy/Parameter is outdated, missing
or invalid).
When a UE is accessing via a Layer 2 Relay as a Remote UE, the policy update
can be triggered by the Remote UE or the PCF.
Editor\'s note: How the policy update triggered by a Remote UE or PCF is
performed for Remote UE accessing via Layer 3 Relay is FFS.
#### 6.35.2.2 Procedure Enhancement for providing Relay Authorization
information to NG-RAN
Relay Authorization information consists of:
\- UE-to-Network Relay authorization indication: it indicates the UE is
authorized to be a 5G ProSe UE-to-Network Relay;
\- Layer 2 Remote UE authorization indication: in case of Layer 2 Relay, it
indicates that the UE is authorized to be a Layer 2 5G ProSe Remote UE (5G
ProSe Remote UE has to be registered to the same rPLMN or ePLMN with 5G ProSe
UE-to-Network Relay).
The Registration procedure for UE is performed as defined in TS 23.502 [8]
with the following additions:
\- The AMF determines whether the UE is authorized to be a 5G ProSe UE-to-
Network Relay or 5G ProSe Layer 2 Remote UE based on UE\'s 5G ProSe capability
and the subscription data related to relay service authorization from the UDM.
The AMF sends the Relay Authorization information to NG-RAN.
The Service Request procedure for UE in CM-IDLE state is performed as defined
in TS 23.502 [8] with the following additions:
\- The AMF sends the Relay Authorization information to NG-RAN.
The handover procedure for UE is performed as defined in TS 23.502 [8] with
the following additions:
\- The source NG-RAN sends the Relay Authorization information to target NG-
RAN.
#### 6.35.2.3 The Policy/parameter to a 5G ProSe UE-to-Network Relay
The following information is provisioned in the UE in support of the UE
assuming the role of a 5G ProSe UE-to-Network Relay:
1) Authorisation policy for acting as a 5G ProSe UE-to-Network Relay:
\- PLMNs in which the UE is authorized to relay traffic for 5G ProSe Remote
UEs.
2) 5G ProSe Relay Discovery policy/parameters for 5G ProSe UE-to-Network
Relay:
\- Includes the parameters that enable the UE to perform 5G ProSe Relay
Discovery as a UE-to-Network Relay when provisioned from the PCF in the ME or
configured in the UICC:
\- Indication to be a UE-to-Network Relay;
\- 5G ProSe UE-to-Network Relay Discovery parameters (User Info ID, Relay
Service Code(s)) as described in clause 6.35.2.5;
\- For Layer 3 Relay, the PDU Session parameters (PDU Session type, DNN, SSC
Mode, S-NSSAI, Access Type Preference) to be used for the relayed traffic for
each ProSe Relay Service Code;
NOTE 1: Whether the associated PDU session parameters are included as ProSe
policy/parameters or as USRP rules will be decided at normative phase.
\- Includes security related content for 5G ProSe Relay Discovery for each 5G
ProSe Relay Service Code.
3) QoS mapping rule for Layer 3 Relay.
\- Includes the rules that determine how the 5G ProSe UE-to-Network Relay maps
between the 5QI of a QoS Flow over NR Uu and a 5G ProSe PQI value over NR PC5.
\- Alternatively, includes the QoS mapping rule over PC5 for UE-to-Network
relay service.
NOTE 2: Which QoS mapping rule is provisioned depends on the concluded UE-to-
Network Relay QoS handling solution.
#### 6.35.2.4 The Policy/parameter to a Remote UE
The following information is provisioned in the UE in support of the UE
assuming the role of a Remote UE and thereby enabling the use of a 5G ProSe
UE-to-Network Relay:
1) Authorisation policy for acting as a Remote UE:
\- Indicates whether the UE is authorised to access 5GC via a 5G ProSe UE-to-
Network Relay.
2) Policy/parameters for 5G ProSe Relay Discovery and for enabling connection
to the 5G ProSe UE-to-Network Relay after discovery is performed when
provisioned from the PCF in the ME or configured in the UICC:
\- 5G ProSe UE-to-Network Relay Discovery parameters (User Info ID, Relay
Service Code(s)) as described in 6.35.2.5;
\- For Layer 3 Relay, the PDU Session parameters (PDU Session type, DNN, SSC
Mode, S-NSSAI, Access Type Preference) to be used for the relayed traffic for
each ProSe Relay Service Code;
NOTE 1: Whether the associated PDU session parameters are included depends on
the conclusion of UE-to-Network Relay Discovery solutions. For example, if the
associated PDU session parameters are negotiated between the Remote UE and the
UE-to-Network Relay during PC5 communication establishment phase, these
parameters are not needed.
\- Includes security related content for ProSe Relay Discovery for each ProSe
Relay Service Codes.
#### 6.35.2.5 5G ProSe UE-to-Network Relay Discovery parameters
5G ProSe UE-to-Network Relay Discovery parameters include:
\- User Info ID: For Model A, this corresponds to the Announcer Info parameter
when the UE is acting as an announcing UE. For Model B, this corresponds to
the Discoverer Info in Solicitation messages and the Discoveree Info in
Response messages, when the UE is acting as a discoverer or discoveree UE
respectively.
\- Relay Service Code(s): A Relay Service Code identifies a connectivity
service the ProSe UE-to-Network Relay provides to applications. The Relay
Service Codes are configured in the ProSe UE-to-Network Relays that provide
connectivity services to applications. The Relay Service Codes are configured
in the Remote UEs interested in related connectivity services.
### 6.35.3 Impacts on services, entities and interfaces
5G ProSe UE-to-Network Relay:
\- Indicates 5G ProSe capability as a UE-to-Network Relay in the Registration
Request message;
\- Includes the UE Policy Container with indicating the 5G ProSe UE-to-Network
Relay Information Provisioning request during registration procedure;
\- Receive and enforce the Policy and parameter as 5G ProSe UE-to-Network
Relay.
5G ProSe Remote UE:
\- Indicates 5G ProSe capability as a Remote UE in the Registration Request
message;
\- Includes the UE Policy Container with indicating the Remote UE Information
Provisioning request during registration procedure;
\- Receive and enforce the Policy and parameter as 5G ProSe Remote UE.
AMF:
\- Determine whether UE is authorized to be a 5G ProSe UE-to-Network Relay or
Remote UE;
\- Select a PCF capable of authorization Policy and parameter for 5G ProSe UE-
to-Network Relay;
\- Select a PCF capable of authorization Policy and parameter for 5G ProSe
Remote UE;
\- Forward UE\'s PC5 Capability for 5G ProSe UE-to-Network Relay to PCF;
\- Forward UE\'s PC5 Capability for 5G ProSe Remote UE to PCF.
\- Send the 5G ProSe Relay Authorization information to NG-RAN.
PCF:
\- Send the Authorization Policy and parameter to 5G ProSe UE-to-Network
Relay;
\- Send the Authorization Policy and parameter to 5G ProSe Remote UE.
NG-RAN:
\- The source NG-RAN needs to send the Relay Authorization information to
target NG-RAN.
## 6.36 Solution #36: Authorization for 5G ProSe UE-to-UE Relay Service
### 6.36.1 Description
This solution addresses KI#4 and 8 and applies to both Layer-2 and Layer-3 UE-
to-UE Relay.
For KI#4 (Support of UE-to-UE Relay), following aspects are covered:
\- Authorize the UE-to-UE Relay, e.g. authorize a UE as UE-to-UE Relay?
\- Authorize the Remote UE to access a UE-to-UE Relay?
For KI#8 (Support of PC5 Service Authorization and Policy/Parameter
Provisioning), two following major aspects are covered:
\- For the procedures related to PC5 service authorization and
policy/parameter provisioning to a UE, only necessary enhancement with what is
specified in TS 23.287 [5] clause 6.2 and TS 23.502 [8] clause 4.2.2.2
(Registration Procedure), clause 4.2.4.3 (UE Configuration Update procedure
for transparent UE Policy Delivery), clause 4.16.11 (UE Policy Association
Establishment procedure), clause 4.16.12 (UE Policy Association Modification
procedure), will be documented.
\- Identify necessary information for PC5 service authorization and
provisioning based on what is specified in TS 23.287 [5] clause 5.1.2.1.
The PCF based service authorization and provisioning as defined in TS 23.287
[5] are used as baseline for this solution.
NOTE: When the UE-to-UE Relay is out of coverage, it can act as a UE-to-UE
Relay based on the preconfigured policy and parameters.
### 6.36.2 Procedures
#### 6.36.2.1 Procedure Enhancement for Information Provisioning to a 5G ProSe
Remote UE/UE-to-UE Relay
For PCF based Service Authorization and Provisioning to 5G ProSe Remote UE/UE-
to-UE Relay, the Registration procedures as defined in clause 4.2.2.2 of TS
23.502 [8], UE Policy Association Establishment procedure as defined in clause
4.16.11 of TS 23.502 [8] and UE Policy Association Modification procedure as
defined in clause 4.16.12 of TS 23.502 [8] apply with the following additions:
\- If the UE indicates 5G ProSe capability as a Remote UE/UE-to-UE Relay in
the Registration Request message and if the UE is authorized to be a 5G ProSe
Remote UE/UE-to-UE Relay based on subscription data, the AMF selects the PCF
which supports 5G ProSe information provisioning and establishes a UE policy
association with the PCF for 5G ProSe Remote UE/UE-to-UE Relay information
provisioning delivery.
\- If the AMF receives the 5G ProSe capability as a Remote UE/UE-to-UE Relay
in the Registration Request message from UE, the AMF further reports the 5G
ProSe capability as a Remote UE/UE-to-UE Relay to the selected PCF. The PCF
determines the 5G ProSe Remote UE/UE-to-UE Relay information based on the
received 5G ProSe capability as a Remote UE/UE-to-UE Relay.
\- If the UE supports 5G ProSe capability as a Remote UE/UE-to-UE Relay and it
does not have valid 5G ProSe Remote UE/UE-to-UE Relay information, the UE
includes the UE Policy Container with indicating the 5G ProSe UE-to-UE Relay
Information Provisioning request during registration procedure.
\- If the UE indicates the 5G ProSe Remote UE/UE-to-UE Relay Information
Provisioning request in the UE Policy Container, the PCF determines whether to
provision the 5G ProSe Remote UE/UE-to-UE Relay Information to the UE, as
specified in clause 6.1.2.2.2 of TS 23.503, and the PCF provides the 5G ProSe
Remote UE/UE-to-UE Relay Information to the UE by using the procedure as
defined in clause 4.2.4.3 \"UE Configuration Update procedure for transparent
UE Policy Delivery\" in TS 23.502 [8].
The PCF may update the 5G ProSe Policy and parameters to the UE in following
conditions:
\- UE Mobility, e.g. UE moves from one PLMN to another PLMN. This is achieved
by using the procedure of UE Policy Association Modification initiated by the
AMF, as defined in clause 4.16.12.1 of TS 23.502 [8].
\- When there is a subscription change in the list of PLMNs where the UE is
authorized to perform the 5G operation. This is achieved by using UE Policy
Association Modification initiated by the PCF procedure as defined in clause
4.16.12.2 of TS 23.502 [8].
\- When there is a change of service specific parameter as described in clause
4.15.6.7 of TS 23.502 [8].
If the serving PLMN is removed from the list of PLMNs in the service
authorization parameters, the service authorization is revoked in the UE.
When the UE is roaming, the change of subscription resulting in updates of the
service authorization parameters are transferred to the UE by H-PCF via V-PCF.
The UE may perform UE triggered Policy Provisioning procedure to the PCF as
specified in clause 6.2.4 of TS 23.287 [5] when the UE determines the 5G ProSe
Policy and parameters are invalid (e.g. Policy/Parameter is outdated, missing
or invalid).
#### 6.36.2.2 The Policy/parameter to a 5G ProSe UE-to-UE Relay
The following information is provisioned in the UE in support of the UE
assuming the role of a 5G ProSe UE-to-UE Relay:
1) Authorisation policy for acting as a 5G ProSe UE-to-UE Relay:
\- when the UE is \"served by E-UTRA\" or \"served by NR:
\- PLMNs in which the UE is authorized to relay traffic for 5G Remote UE
accessing UE-to-UE Relays over PC5 reference point.
\- when the UE is \"not served by E-UTRA\" and \"not served by NR:
\- Indicates whether the UE is authorized to be a UE-to-UE Relay over PC5
reference point.
2) Radio parameters when the UE is \"not served by E-UTRA\" and \"not served
by NR\":
\- Includes the radio parameters with Geographical Area(s) that need to be
configured in the UE in order to be able perform ProSe Direct Discovery and
Communication procedures when acting as a 5G ProSe UE-to-UE Relay. These radio
parameters (e.g. frequency bands) are defined in TS 38.331 [23] and are common
for all types of 5G ProSe Direct Discovery (Group Member Discovery, ProSe UE-
to-UE Relay Discovery or ProSe UE-to-UE Relay Discovery Additional
Information). The UE uses the radio parameters only if the UE can locate
itself in the corresponding Geographical Area. Otherwise, the UE is not
authorised to transmit.
3) 5G ProSe Relay Discovery policy/parameters for 5G ProSe UE-to-UE Relay:
\- Includes the parameters that enable the UE to perform 5G ProSe Relay
Discovery as a UE-to-UE Relay when provisioned from the PCF in the ME or
configured in the UICC:
\- 5G ProSe UE-to-UE Relay Discovery parameters (User Info ID, Relay Service
Code(s)) as described in clause 6.36.2.4;
\- Security related content for 5G ProSe Relay Discovery for each 5G ProSe
Relay Service Code.
#### 6.36.2.3 The Policy/parameter to a 5G ProSe Remote UE
The following information is provisioned in the UE in support of the UE
assuming the role of a 5G ProSe Remote UE accessing a UE-to-UE Relay:
1) Authorisation policy for acting as a 5G ProSe Remote UE:
\- when the UE is \"served by E-UTRA\" or \"served by NR:
\- PLMNs in which the UE is authorized to access UE-to-UE Relays over PC5
reference point.
\- when the UE is \"not served by E-UTRA\" and \"not served by NR:
\- Indicates whether the UE is authorized to access a UE-to-UE Relay over PC5
reference point.
2) Radio parameters when the UE is \"not served by E-UTRA\" and \"not served
by NR\":
\- Includes the radio parameters with Geographical Area(s) that need to be
configured in the UE in order to be able perform ProSe Direct Discovery and
Communication procedures when acting as a 5G ProSe Remote UE accessing a UE-
to-UE Relay. These radio parameters (e.g. frequency bands) are defined in TS
38.331 [23] and are common for all types of 5G ProSe Direct Discovery (Group
Member Discovery, ProSe UE-to-UE Relay Discovery or ProSe UE-to-UE Relay
Discovery Additional Information). The UE uses the radio parameters only if
the UE can locate itself in the corresponding Geographical Area. Otherwise,
the UE is not authorised to transmit.
3) 5G ProSe Relay Discovery policy/parameters for 5G ProSe Remote UE:
\- Includes the parameters that enable the UE to perform 5G ProSe Relay
Discovery as a 5G ProSe Remote UE when provisioned from the PCF in the ME or
configured in the UICC:
\- 5G ProSe UE-to-UE Relay Discovery parameters (User Info ID, Relay Service
Code(s)) as described in clause 6.36.2.4;
\- Security related content for 5G ProSe Relay Discovery for each 5G ProSe
Relay Service Code.
#### 6.36.2.4 5G ProSe UE-to-UE Relay Discovery parameters
5G ProSe UE-to-UE Relay Discovery parameters include:
\- User Info ID: For Model A, this corresponds to the Announcer Info parameter
when the UE is acting as an announcing UE. For Model B, this corresponds to
the Discoverer Info in Solicitation messages and the Discoveree Info in
Response messages, when the UE is acting as a discoverer or discoveree UE
respectively.
\- Relay Service Code(s): A Relay Service Code identifies a connectivity
service the ProSe UE-to-UE Relay provides to applications. The Relay Service
Codes are configured in the ProSe UE-to-UE Relays that provide connectivity
services to applications. The Relay Service Codes are configured in the Remote
UEs interested in related connectivity services
### 6.36.3 Impacts on services, entities and interfaces
5G ProSe UE-to-UE Relay:
\- Indicates 5G ProSe capability as a UE-to-UE Relay in the Registration
Request message;
\- Includes the UE Policy Container with indicating the 5G ProSe UE-to-UE
Relay Information Provisioning request during registration procedure;
\- Receive and enforce the Policy and parameter as 5G ProSe UE-to-UE Relay.
\- Act as a 5G ProSe UE-to-UE Relay for direct discovery and communication.
5G ProSe Remote UE:
\- Indicates 5G ProSe capability as a Remote UE accessing UE-to-UE Relay in
the Registration Request message;
\- Includes the UE Policy Container with indicating the 5G ProSe Remote UE
accessing a UE-to-UE Relay Information Provisioning request during
registration procedure;
\- Receive and enforce the Policy and parameter as 5G ProSe Remote UE
accessing a UE-to-UE Relay.
\- Act as a 5G ProSe Remote UE for direct discovery and communication.
AMF:
\- Determine whether UE is authorized to be a 5G ProSe Remote UE/UE-to-UE
Relay;
\- Select a PCF capable of authorization Policy and parameter for 5G ProSe
Remote UE/UE-to-UE Relay;
\- Forward UE\'s PC5 Capability for 5G ProSe Remote UE/UE-to-UE Relay to PCF.
PCF:
\- Send the Authorization Policy and parameter to 5G ProSe Remote UE/UE-to-UE
Relay.
## 6.37 Solution #37: Groupcast mode communication for commercial services and
public safety
### 6.37.1 Description
This solution addresses Key Issue #1 (ProSe Direct discovery) and Key Issue #2
(Support for NR PC5 ProSe communication), and is applicable to both commercial
and public safety services.
### 6.37.2 Procedures
Figure 6.37.1-1 below describes the group management procedure, the ProSe
Direct Discovery and the NR PC5 groupcast mode communication at the PC5
reference point, as well as the group management procedures at the Application
Layer. The Figure extends Figure 6.3.2-1 in TS 23.287 [5] by:
\- adding the ProSe Direct Discovery (step 2 in Figure 6.37.1-1) which is not
included in TS 23.287 [5].
\- making it explicit that group management can be done either on demand or
using pre-provisioned parameters, and that this can optionally be based on
communication with an Application Server.
Each step in the procedure is described in more detail below.
Figure 6.37.1-1 also illustrates a strict separation between Application Layer
procedures on one hand (beyond the scope of this specification and shown with
dashed lines), and groupcast mode communication procedures at the PC5
reference point on the other hand (shown with solid lines).
The Application Layer procedures in step 1 and step 3 are beyond the scope of
this specification.
Below follows a description of each step in the procedure.
Figure 6.37.1-1: Groupcast mode communication for commercial services and
public safety over the PC5 reference point (the Application Layer procedures
are beyond the scope of this specification)
1\. A group is formed at the Application Layer.
In **alternative 1** , the group is formed on demand by communicating with an
Application Server across the PC1reference point similar to V1 reference point
in V2X (see the V2X system architecture specified in TS 23.287 [5]), e.g.
because a UE wants to perform ProSe group communication with other UEs in
proximity. This alternative supports e.g. commercial services. An Application
Layer Group ID is distributed to the group member UEs.
In **alternative 2** , group parameters, including an Application Layer Group
ID, are provisioned to the group member UEs e.g. in ME from PCF or configured
in UICC as defined in TS 23.303 [9], clause 4.5.1.1.2.3.3. This alternative
supports e.g. public safety.
2\. At the PC5 reference point, group member UE discovery is performed using
ProSe Direct Discovery based on Model A or Model B, see TS 23.303 [9] clause
5.3. Solution #37 is open to future ProSe Direct Discovery mechanisms for
commercial services and public safety. For commercial services, such a
mechanism may for example make use of DDNMF as described in TS 23.303 [9]
clause 4.4.1.1. In addition, to support public safety, Solution #37 is open to
usage of pre-configured or provisioned information for the ProSe Direct
Discovery procedure, for example as specified in TS 23.303 [9] clause 5.3.7.
Regarding the identifiers used in the ProSe Direct Discovery procedure, it is
up to the conclusion of KI#1.
3\. The completion of the group management procedure is confirmed at the
Application Layer, optionally with support of an Application Server. At this
stage, all parameters needed for groupcast mode communication should have been
set up in the group member UEs if they are not pre-configured, such as the
destination Layer-2 ID, and the QoS parameters as defined in TS 23.287 [5].
NOTE 1: The leading UE can provide the group size and group member ID to the
group members in order to support reliable groupcast, optionally with support
of the Application server which is up to the application.
4\. Groupcast communication can now begin using the PC5 reference point.
Depending on group policy configured at the Application Layer, all group
member UEs or a subset of them can send groupcast messages to the group.
NOTE 2: Some of the solutions in TR 23.752 skip step 1in the procedure
described above and only perform steps 2-4.
### 6.37.3 Impacts on services, entities and interfaces
UE needs to support Group Member Discovery as defined in TS 23.303 [9] clause
5.3.7 and Groupcast communication as defined in TS 23.287 [5] clause 6.3.2.
For Application Layer managed groups, the minimal assumptions about the
Application Layer in Solution #37 include the Application Layer passing group
size and group member ID to the AS layer as specified in clause 5.2.1.3 of TS
23.287 [5]. Also, the application layer may provide group identifier
information as specified in clause 5.6.1.3 of TS 23.287 [5].
## 6.38 Solution #38: Layer 3 UE-to-Network Relay UE PDU session parameters
### 6.38.1 Description
This is a solution for key issue #3: UE-to-Network Relay and only applicable
for Layer 3 UE-to-Network Relay.
When PDU Session is set up by the Relay UE for 5G ProSe relaying of Remote UE
data, the Relay UE must determine PDU Session parameters. This solution
documents the means to select pre-configured Route Selection Descriptor
parameters matching the Traffic Descriptor for the PDU session establishment.
Pre-requisite step of UE Route Selection Policy rule (URSP) provisioning to
the Relay UE by the PCF is assumed. PCF procedures for provisioning URSP rule
to UE are specified in TS 23.503 [18] and this solution re-uses those
procedures unchanged.
Traffic Descriptor part of the URSP rule already identifies specific services
\"ims\", \"mms\" and \"Internet\" to enable PCF configuration and UE detection
of the related Route Selection Descriptors.
This solution adds the detection of Relay UE\'s PDU session parameters in the
Route Selection Descriptor matching with the Traffic Descriptor for \"5G
prose\" traffic.
Editor\'s note: How to support different PDU session parameters for different
remote UEs is FFS.
### 6.38.2 Procedures
PCF configures URSP Rule to UE with Layer 3 UE-to-Network Relay capability.
The Traffic Descriptor part of the URSP rule is enhanced to allow the
identification of \"5G ProSe Layer 3 UE-to-Network\" Connection Capability.
This allows the configuration of the corresponding Route Selection Descriptor
for 5G ProSe UE-to-Network Relay to use for setting up PDU Session for Remote
UE traffic. The change needed in TS 23.503 [18] Table 6.6.2.1-2 in the URSP
rule Traffic Descriptor in the UE Route Selection Policy rule is shown in
Table 6.38.2-1.
Table 6.38.2-1: 5G ProSe enhancement to Traffic Descriptor
+-------------+-------------+------------+-------------+------------+ | Information | Description | Category | PCF | Scope | | name | | | permitted | | | | | | to modify | | | | | | in a UE | | | | | | context | | +=============+=============+============+=============+============+ | Rule | Determines | Mandatory\ | Yes | UE context | | Precedence | the order | (NOTE 1) | | | | | the URSP | | | | | | rule is | | | | | | enforced in | | | | | | the UE. | | | | +-------------+-------------+------------+-------------+------------+ | Traffic | This part | Mandatory\ | | | | descriptor | defines the | (NOTE 3) | | | | | Traffic | | | | | | descriptor | | | | | | components | | | | | | for the | | | | | | URSP rule. | | | | +-------------+-------------+------------+-------------+------------+ | Application | It consists | Optional | Yes | UE context | | descriptors | of OSId and | | | | | | OSAppId(s). | | | | | | (NOTE 2) | | | | +-------------+-------------+------------+-------------+------------+ | IP | Destination | Optional | Yes | UE context | | descriptors | IP 3 | | | | | | tuple(s) | | | | | (NOTE 5) | (IP address | | | | | | or IPv6 | | | | | | network | | | | | | prefix, | | | | | | port | | | | | | number, | | | | | | protocol ID | | | | | | of the | | | | | | protocol | | | | | | above IP). | | | | +-------------+-------------+------------+-------------+------------+ | Domain | Destination | Optional | Yes | UE context | | descriptors | FQDN(s) or | | | | | | a regular | | | | | | expression | | | | | | as a domain | | | | | | name | | | | | | matching | | | | | | criteria. | | | | +-------------+-------------+------------+-------------+------------+ | Non-IP | De | Optional | Yes | UE context | | descriptors | scriptor(s) | | | | | | for | | | | | (NOTE 5) | destination | | | | | | information | | | | | | of non-IP | | | | | | traffic | | | | +-------------+-------------+------------+-------------+------------+ | DNN | This is | Optional | Yes | UE context | | | matched | | | | | | against the | | | | | | DNN | | | | | | information | | | | | | provided by | | | | | | the | | | | | | a | | | | | | pplication. | | | | +-------------+-------------+------------+-------------+------------+ | Connection | This is | Optional | Yes | UE context | | C | matched | | | | | apabilities | against the | | | | | | information | | | | | | provided by | | | | | | a UE | | | | | | application | | | | | | when it | | | | | | requests a | | | | | | network | | | | | | connection | | | | | | with | | | | | | certain | | | | | | ca | | | | | | pabilities. | | | | | | (NOTE 4) | | | | +-------------+-------------+------------+-------------+------------+ | List of | A list of | Mandatory | | | | Route | Route | | | | | Selection | Selection | | | | | Descriptors | D | | | | | | escriptors. | | | | | | The | | | | | | components | | | | | | of a Route | | | | | | Selection | | | | | | Descriptor | | | | | | are | | | | | | described | | | | | | in table | | | | | | 6.6.2.1-3. | | | | +-------------+-------------+------------+-------------+------------+ | NOTE 1: | | | | | | Rules in a | | | | | | URSP shall | | | | | | have | | | | | | different | | | | | | precedence | | | | | | values. | | | | | | | | | | | | NOTE 2: The | | | | | | information | | | | | | is used to | | | | | | identify | | | | | | the | | | | | | App | | | | | | lication(s) | | | | | | that | | | | | | is(are) | | | | | | running on | | | | | | the UE\'s | | | | | | OS. The | | | | | | OSId does | | | | | | not include | | | | | | an OS | | | | | | version | | | | | | number. The | | | | | | OSAppId | | | | | | does not | | | | | | include a | | | | | | version | | | | | | number for | | | | | | the | | | | | | a | | | | | | pplication. | | | | | | | | | | | | NOTE 3: At | | | | | | least one | | | | | | of the | | | | | | Traffic | | | | | | descriptor | | | | | | components | | | | | | shall be | | | | | | present. | | | | | | | | | | | | NOTE 4: The | | | | | | format and | | | | | | some values | | | | | | of | | | | | | Connection | | | | | | Ca | | | | | | pabilities, | | | | | | e.g. | | | | | | \"ims\", | | | | | | \"mms\", | | | | | | \" | | | | | | internet\", | | | | | | \"5G ProSe | | | | | | Layer 3 | | | | | | UE | | | | | | -to-Network | | | | | | Relay\" | | | | | | etc., are | | | | | | defined in | | | | | | TS 24. | | | | | | 526 [28]. | | | | | | More than | | | | | | one | | | | | | connection | | | | | | c | | | | | | apabilities | | | | | | value can | | | | | | be | | | | | | provided. | | | | | | | | | | | | NOTE 5: A | | | | | | URSP rule | | | | | | cannot | | | | | | contain the | | | | | | combination | | | | | | of the | | | | | | Traffic | | | | | | descriptor | | | | | | components | | | | | | IP | | | | | | descriptors | | | | | | and Non-IP | | | | | | d | | | | | | escriptors. | | | | | +-------------+-------------+------------+-------------+------------+
Editor\'s note: Table 6.38.2-1 is intended as part of this solution even
though only the addition of \"5G prose\" code point in TS 23.502 [8], Table
6.6.2.1-2 is shown as revision.
If PDU Session establishment for 5G ProSe Relaying requires any additional 5G
ProSe specific parameters, those can be added as part of Route Selection
Descriptor part of the USRP rule in TS 23.503 [18], Table 6.6.2.1-3.
### 6.38.3 Impacts on services, entities and interfaces
This solution impacts the following system entities.
PCF:
\- Ability to identify ProSe Connection Capabilities and related Route
Selection Descriptor in URSP rule.
UE:
\- Ability to identify the Route Selection Descriptor for 5G ProSe Layer 3 UE-
to-Network Relay PDU Session establishment.
## 6.39 Solution #39: ProSe group discovery
### 6.39.1 Description
This solution addresses Key Issue #1 (ProSe Direct discovery) to support group
communication over PC5 reference point.
### 6.39.2 Procedures
#### 6.39.2.1 ProSe group discovery
Figure 6.39.2.1-1: ProSe group discovery
1\. Group management is carried out at application layer.
For public safety applications, the group identifiers (e.g. an application
layer group ID) are provisioned in ME from PCF or configured in UICC similar
to TS 23.303 [9], clause 4.5.1.1.2.3.3.
For commercial applications in addition to the above, dynamic group identifier
provisioning can be handled by the 5G ProSe Application Server. The
Application Server may also optionally assign a group lead UE.
2\. The ProSe Application layer may provide group identifiers received in step
1 to the ProSe Layer. The ProSe application layer may also provide ProSe
Application Requirements for this communication.
3\. Each UE may perform a ProSe direct group discovery, (similar to the
procedures in clause 5.3.7.1, TS 23.303 [9]) that is restricted only to users
sharing the same group identifiers (e.g. an application group ID) based on
steps 1 and 2.
4\. Each UE within the group self-assigns a source Layer-2 ID and determines a
destination Layer-2 ID based on group identifiers received in steps 1/2 from
ProSe Application Layer (similar to clause 5.6.1.1 and 5.6.1.3, TS 23.287
[5]).
Each UE within the group determines the PC5 QoS parameters for this groupcast
(similar to clause 5.4.1.1 and 5.4.1.3, TS 23.287 [5]). The ProSe layer of
each UE within the group passes groupcast related parameters to Access Stratum
(similar to clause 5.2.1.3, TS 23.287 [5]).
5\. ProSe Service for groupcast is established.
#### 6.39.2.2 Delegated group information update
Figure 6.39.2.2-1: Delegated Group Information Update
As part of dynamic group identifier provisioning (for group size and member ID
information), the Application Server may indicate to UEs within a group to use
delegated group information update over PC5. To support delegated group
information update, a source Layer-2 ID is self-assigned by each UE within the
group intending to use delegated group information update. A specific
destination Layer-2 ID for sharing delegated group identifier information
(i.e. group size and member ID information) is also determined. This is either
based on an interactive service to destination Layer-2 ID mapping provisioned
by the Application Server or provision of destination Layer-2 ID itself (e.g.
when a UE joins the group). This is different from the destination Layer-2 ID
used for groupcast communication. A message type field within the group
information update message indicates that the payload is related to delegated
group information update to distinguish it from other direct discovery
messages. This is to be identified at the ProSe application layer of the UE.
The message type field can be transparent to the Access Stratum.
1\. Group Communication is established and ongoing based on clause 6.39.2.1.
UE-4 (not shown in the figure) plans to join the group. UE-1 is assigned as
the group lead by the Application Server.
2\. UE-3 is notified by the Application Server to use delegated group
information update. UE-3 may groupcast a discovery message to reach the group
lead, i.e. UE-1. UE-3 may also periodically listen for delegated group
information update over PC5 on the specific Destination layer 2 ID for
delegated group information update (as outlined, determined based on
parameters already provisioned by the Application Server e.g. when UE-3 joined
the group).
3\. The Application Server may provide dynamic group identifier update (i.e.
new group size and member ID information) based on the new UE (UE-4) joining
the group to the group lead (e.g. over PC1) or any other UEs not configured
for delegated group information update (UE-2 in this example). It may also
indicate to the group lead to share this information (i.e. new group size and
member ID information) as a Delegated Group information Update to some or the
rest of UEs (UE-3 in this example).
4\. UE-1 as the group lead UE provides group information update as above over
PC5 to be collected by UE-3. In this example UE-2 is not configured for
delegated group discovery so may receive new group size and member ID
information from Application Server over PC1.
NOTE: As an alternative, in step 2, both UE-2 and UE-3 could be notified by
Application Server to use delegated group information update. If so in step 3
and step 4, the group lead could share delegated group information update with
both of them and no dynamic group identifier update was needed from
Application Server to UE-2 or UE-3 (e.g. over PC1) in step 3.
### 6.39.3 Impacts on services, entities and interfaces
**UE:**
\- Performs direct discovery for group communication.
\- (a group lead UE), optionally provides group identifiers update to other
member UEs by using PC5 discovery messages (based on the Application Server
request when delegated group information update is supported).
**Application Server (Commercial Applications):**
\- Performs group management.
\- Provides dynamic group identifiers to group members (e.g. over PC1 or
optionally via delegated group information update by the group lead UE over
PC5).
\- Optionally Assigns a group lead.
## 6.40 Solution #40: Network controlled Remote UE authorization for UE-to-
Network Relay
### 6.40.1 Description
This solution addresses the Key Issue #3 described in the current document.
This solution supports UE-to-Network Relay Layer 3 Model.
This contribution compared to the existing Layer 3 based UE-to-Network
solutions, it addressed two aspects.
1) Dedicated or shared PDU Session of UE-to-Network Relay UE.
2) Network controlled authorization of Remote UE.
For 1), this solution describes the two different UE-to-Network Relay PDU
Session models as follows:
A. Dedicated Relay Session Model
In this model, one PDU Session of the UE-to-Network Relay is supported for one
Remote UE as depicted in case A of the Figure 6.40.1-1. The UE-to-Network
Relay uses the PDU Session that is dedicated for only one Remote UE to relay
the traffic between the Remote UE and the Data Network through the UPF of UE-
to-Network Relay.
This dedicated relay session model is useful for the scenario where the
network operator wants to differentiate the UE-to-Network Relay\'s PDU Session
from charging and policy perspective and for the scenario where the network
operator wants to provide different slice or data network per Remote UE\'s
subscription.
B. Shared Relay Session Model
In this model, one PDU Session of UE-to-Network Relay is supported for
multiple Remote UE as depicted in case B of the Figure 6.40.1-1. The UE-to-
Network Relay uses the PDU Session that is shared among multiple Remote UE to
relay the traffic between the Remote UE(s) and the Data Network though the UPF
of the UE-to-Network Relay.
The shared relay session model is useful for the scenario where the UE-to-
Network Relay provides the internet connection to the multiple Remote UE(s).
It is noted that the solution described in clause 6 of this document is based
on this model.
The two relay session models are depicted as Figure 6.40.1-1.
Figure 6.40.1-1: UE-to-Network Relay PDU Session: Dedicated vs. Shared
Unstructured type PDU Session is only applicable for the dedicated Relay
Session Model.
PDU Session with IP and Ethernet type can be applicable for both dedicated and
shared relay session model.
For 2), in order for the network operator to authorize the remote UE to use
the UE-to-Network Relay\'s PDU Session, a network controlled mechanism is
used. In this solution, the 5GC can authorize the Remote UE based on the
information provided by the UE-to-Network Relay that is connected to Remote
UE. With this approach, the 5GC is able to authorize the Remote UE to use UE-
to-Network Relay\'s PDU Session by checking the Remote UE\'s profile stored in
UDM, PCF or DN-AAA in addition to UE-to-Network Relay\'s subscription
information.
This solution assumes that Remote UE belongs to the same PLMN as Relay UE.
### 6.40.2 Procedures
#### 6.40.2.1 Network Controlled Remote UE authorization for the
Dedicated/Shared Relay Session
This procedure describes the Remote UE authorization procedure.
Figure 6.40.2.1-1: Network Controlled Remote UE authorization
0\. Provisioning of Remote UE and UE-to-Network Relay. Provisioning of PC5
related information and URSP rules with ProSe extensions.
A. The Remote UE is provisioned with the information that can be used for
connecting the UE-to-Network Relay through the PC5 link associated with the
UE-to-Network Relay\'s PDU Session. The information includes the relay session
service code for this procedure. The relay session code can be encoded to
indicate dedicate or shared relay session model. In addition, the Remote UE
can be provisioned with the appropriate UE Route Selection Policy such as
ProSe UE-to-Network Offloading indicator with relay session model indicator as
Route Selection Component. The relay session model indicator can indicator
dedicated or shared relay session model. The information may include the
authorization information (e.g. authorization token) issued by PCF.
NOTE 1: Security related issue can be determined and coordinated with SA WG3.
B. The UE-to-Network Relay is provisioned with the information that can be
used for managing the PC5 reference points such as announcing the relay
service code (e.g. dedicated relay session service code or shared relay
session service code). The UE-to-Network may be provisioned with the network
controlled authorization for network to authorize the Remote UE to use the UE-
to-Network Relay\'s PDU Session.
In addition, the UE-to-Network Relay can be provisioned with the appropriate
UE Route Selection Policy such as the relay session service (e.g. the
dedicated relay session service or shared relay session service) or Remote UE
information as Traffic Descriptor.
C. Based on the provisioned information in the step B. the UE-to-Network Relay
may establish the PDU Session for shared relay session model. This step is
applicable only for shared relay session model.
1\. When performing the model A discovery procedure, the UE-to-Network relay
provides the relay service code (e.g. the dedicated relay session service code
or the shared relay session service code) to the Remote UE. For the model B
discovery procedure, the Remote UE may request the relay service code
provisioned in the step 0A.
2\. After the Remote UE discovers the UE-to-Network Relay, the Remote UE
initiates the establishment procedure of PC5 link associated with the
dedicated UE-to-Network Relay\'s PDU Session. This message includes the Remote
UE identification info such as the subscription identifier (such as SUCI or
GPSI) or Layer 2 ID, Relay Service Code (e.g. dedicated/shared relay session
service code), Remote UE authorization information and PDU Session related
parameters if provisioned in the step 0A. If the Relay UE identifies the
Remote UE belongs to the different PLMN than Relay UE, the Relay UE can
rejects the request.
3\. On receiving the Direct Communication Request from the Remote UE, the UE-
to-Network Relay may authorize the use of the UE-to-Network Relay\'s PDU
Session based on the provisioned information received in the step 0B. If the
network controlled UE-to-Network relay authorization indicator and the relay
session service code are provisioned in the step 0B, the UE-to-Network Relay
performs the PDU Session establishment procedure to authorize the Remote UE to
use the UE-to-Network Relay\'s PDU Session. In this scenario, the UE-to-
Network Relay sends the Remote UE authorization request and Remote UE
identification information (i.e. received from the Remote UE in the step 2 and
optional Remote UE authorization information) for the UE-to-Network Relay\'s
PDU Session.
NOTE 2: The information carried in the step 3 can be transferred via PDU
Session Establishment Request or PDU Session Modification Request with the
Remote UE authorization request indicator.
4\. On receiving the PDU Session request with the Remote UE authorization
request, the SMF retrieves the subscription data of UE-to-Network Relay from
the UDM, the subscription data includes the allowed list of Remote UE
identification including optional Remote UE authorization information via the
UE-to-Network Relay and their associated profiles for Remote UE(s). The
associated profile may include the authorization profile indicating whether
the secondary authentication or authorization token is required. To retrieve
the specific profile of the Remote UE, the SMF may explicitly include the
Remote UE identification information received in PDU Session Establishment
Request when requesting the subscription information. If the operator policy
requires the authorization token, but the Remote UE does not provide the
authorization token, the SMF considers the authorization failure.
5\. Based on the Remote UE authorization information if received from the
Relay UE in the step 3 and the authorization profile if retrieved in the step
4, the SMF may initiate the secondary authentication/authorization procedure
among the Remote UE, the SMF and DN-AAA. During this procedure, the UE-to-
Network Relay relays the authentication messages between the Remote UE and the
SMF.
6\. The SMF may create an additional SM Policy Association with the PCF (of
Remote UE) to authorize Remote UE\'s and Remote UE\'s profiles including PCC
rules and SM policy if needed in the step 6a/b. To retrieve the policy for the
Remote UE, the SMF sends the Remote UE\'s identification information including
Remote UE authorization information (e.g. authorization token issued by the
PCF) to the PCF.
The SMF retrieves policy and charging information for the UE-to-Network
Relay\'s PDU Session supporting Remote UE from the PCF in the step 6c/d. To
retrieve the policy for the Remote UE, the SMF sends the Remote UE\'s
identification information to the PCF. The PCF of the Relay UE provides the
policy and profile for the Remote UE associated with the UE-to-Network Relay.
NOTE 3: The information in the step 6 can be transferred via SM Policy
Association Establishment Request/Response or SM Policy Association
Modification Request/Response.
NOTE 4: The Remote UE profile index for PCC rules or QoS profiles
corresponding Remote UE is sent from the PCF (of the Remote UE) to the SMF.
The SMF may send the profile index with additional parameters received from
the PCF (of the Remote UE) to the PCF (of the Relay UE) to retrieve the PCC
rules or QoS profiles from the PCF (of the Relay UE).
7\. The SMF determines to authorize the use of the UE-to-Network Relay\'s PDU
Session for the Remote UE based on the subscription profile retrieved in the
step 4, authorization result received in the step 5 and policy /authorization
result of the Remote UE associated with UE-to-Network Relay retrieved in the
step 6. The SMF also authorizes the requested PDU Session parameters such as
S-NSSAI, DNN and PDU Session Type are supported by Remote UE\'s profile.
8\. If the authorization is successful, the UE-to-Network sends the Remote UE
Authorization Accept message with the authorization result. Otherwise the UE-
to-Network sends Remote UE Authorization Reject with failure result and an
appropriate cause.
NOTE 5: The information in the step 3 can be transferred via PDU Session
Establishment Accept/Reject if the step 3 is carried through PDU Session
Establishment Request with the Remote UE authorization request indicator.
9\. If the Remote UE authorization request for the dedicate or shared use of
UE-to-Network Relay is successful, the UE-to-Network Relay may determines the
successful setup of the PC5 link with appropriate parameters. Otherwise, the
UE-to-Network Relay rejects the establishment PC5 link due to failure of
authorization.
10\. For the case IP address allocation is performed with separate procedure
such as DHCP or IPv6 SLAAC, IP address allocation procedure may be performed.
11\. The UE-to-Network reports the Remote UE info to the SMF.
### 6.40.3 Impacts on services, entities and interfaces
The following noes and functionalities are impacted:
\- Remote UE supports the provisioning for the dedicated and shared relay
session model.
\- UE-to-Network Relay supports the provisioning for the dedicated and shared
relay session model and Remote UE authorization procedure.
\- SMF supports the dedicated and shared relay session model and Remote UE
authorization.
\- UDM supports the allowed Remote UE list and associated profile.
\- PCF (of Relay UE) supports the Remote UE\'s profile associated with the UE-
to-Network Relay\'s PDU Session.
\- PCF (of Remote UE) supports the issues and verification of the Remote UE\'s
authorization information and provides the pre-configured Remote UE profile.
## 6.41 Solution #41: Combination of Relay selection and PLMN selection for
Layer 2 based UE-to Network relay
### 6.41.1 Description
In Layer-2 based UE-to-Network relay solution proposed as solution #7, the
Remote UE is connected to the AN and CN via the Relay with end-to-end PDAP
layer. The solution can also support Remote UE and Relay UE is from different
PLMNs when RAN sharing is deployed, which is can be shown in the following
Figure 6.41.1-1, in which the redline means the Relay communicates with
5GC_relay and the blue redline means the Remote UE traffic routing. In order
to implement Layer-2 relay the UE-to Network Relay needs to initiate Service
Request procedure and establish relay bearer on Uu interface. This will
consume the Relay\'s CN resource and potential AN resource (AN resource should
be confirmed be RAN WG2). It is assumed whether the Remote\'s traffic can be
relayed by the Relay should be authorized according to the inter-PLMN
agreements.
Meanwhile, for Layer-2 based relay, the Remote UE NAS layer will perform PLMN
selection as usual and candidate PLMN for PLMN selection should be authorized
for performing Layer-2 based UE-to-Network Relay.
Figure 6.41.1-1: Inter-PLMN Layer-2 Relay in case RAN sharing
The key points of the solution is listed as following:
\- The Remote UE is authorized the PLMNs information which can be the relay
PLMNs.
\- It is assumed Model A and Model B discovery procedure is used to discover a
Relay.
\- The Relay indicates the serving PLMN information in discovery
announce/response message;
\- The Relay forwards the System Information information (including PLMN)
received from the system information of the cell.
Editor\'s note: It is assumed the Relay in CONNECTED needs to acquire the
latest System Information and this needs to be confirmed by RAN WG2.
\- The ProSe layer of the Remote UE checks whether the PLMN in the discovery
announce/response message is authorized to be the relay PLMN, if yes, the
ProSe layer further checks the authorized PLMNs in the System Information
message. The ProSe layer forwards the authorized PLMNs information to the NAS
layer; otherwise, the ProSe layer does not forward the PLMN information to the
NAS layer.
\- The NAS layer of the Remote UE performs PLMN selection, and indicates to
the ProSe layer the selected PLMN information.
\- The ProSe layer of the Remote UE selects the Relay which forwards the
System Information including the indicated PLMN information from NAS layer.
The illustrated procedure can be shown in Figure 6.41.1-2.
Figure 6.41.1-2: Illustration of PLMN selection and Relay selection
combination in Remote UE
Here is one example to further explain the procedure.
Step 0: The Remote UE is authorized the relay PLMN information: PLMN 1, 2, 3,
4, 5, 7, 8 (as yellow highlighted in Table 6.41.1-1) and PLMN 6 is not
authorized for relay.
Step 1: The Remote discovers Relay-1, Relay-2, Relay-3, the PLMN information
each Relay indicated in Discovery message and System Information as following
Table 6.41.1-1.
Table 6.41.1-1 : PLMN information in Discovery message and System information
Relay PLMN in Discovery message PLMN list in System Information
* * *
Relay-1 PLMN 1 PLMN 1, 2, 3, 4 Relay-2 PLMN 6 PLMN 5, 6, 7, 8 Relay-3 PLMN 5
PLMN 3, 4, 5, 6
Step 2: The ProSe layer of the Remote UE check the authorized PLMN information
for each Relay. Relay-1\' serving PLMN (PLMN 1) is authorized PLMN, Relay-2\'s
serving PLMN (PLMN 6) is not authorized PLMN, Relay-3\'s serving PLMN (PLMN 5)
is authorized PLMN, then the ProSe layer forwards PLMN 1, 2, 3, 4, 5 as
available PLMN to NAS layer.
Step 3: NAS layer of the Remote UE performs PLMN selection, selects PLMN 2,
indicates to ProSe layer.
Step 4: The ProSe layer of the Remote UE will select Relay-1 as the Relay.
NOTE: The Remote UE can further select a Relay according to other information
before or after PLMN determination in this solution.
### 6.41.2 Procedures
The Model A and Model B for KI #1 and authorization procedure for KI#8 is
reused.
### 6.41.3 Impacts on services, entities and interfaces
\- The Remote UE is authorized the PLMNs information for relay.
\- The Relay UE indicates the serving PLMN information in discovery message.
\- The Relay UE forwards the System Information of the camped cell including
the supported PLMNs.
\- The Remote UE checks whether the Relay\'s PLMN is authorized for relay, and
only the authorized PLMNs can be the available PLMNs for NAS PLMN selection.
\- The Remote UE selects the Relay based on the selected PLMN by NAS layer.
## 6.42 Solution #42: Relay PDU Session establishment for Layer-3 UE-to-
Network Relay
### 6.42.1 Description
This solution is on top of solution #6 and address the following EN:
Editor\'s note: How the ProSe UE-to-NW relay determine the requirement of PC5
Connection, e.g. S-NSSAI, DNN, QoS will be specified in other solutions for
KI#3.
In the existing Uu interface, the UE derives according to the traffic
descriptors in the configured URSP rule. In Layer-3 UE-to-Network Relay, the
traffic descriptor is for Remote UE, and the UE-to-Network does not get the
traffic descriptors information from application layer. In order to allow the
UE-to-Network Relay establish an appropriate PDU Session, the Remote UE needs
to transfer the traffic descriptor information to the UE-to-Network Relay
during PC5 connection establishment.
During the connection establishment, the Remote UE sends the traffic
descriptors of the service which is to be relayed to the ProSe 5G UE-to-
Network Relay. The ProSe 5G UE-to-Network Relay is configured with the URSP
from its HPLMN. The Relay identifies the URSP rules that matches the the
traffic descriptor information received from the Remote UE, and use the
corresponding RSD for establishing the PDU session for relaying the service
for the Remote UE. If the traffic descriptor information provided is not
supported by the Relay or not matched with any URSP rule (except the default
URSP rule with the \"match all\" Traffic descriptor), default URSP rule or UE
local configuration will be used at the Relay for determining the PDU session
parameters (e.g. S-NSSAI, DNN, access type, etc.). The Remote UE\'s traffic is
managed according to the Relay\'s rules applicable to its serving network, and
is decoupled from the Remote UE\'s own configuration.
NOTE 1: Given that the Relay\'s URSP format is unknow to the Remote UE, the
Remote UE should provide to the Relay any available information related to the
Traffic Descriptor defined in TS 23.503 [18].
NOTE 2: PDU session parameters derived by the UE-to-Network Relay based on its
local URSP rules may be different from PDU session parameters expected by the
Remote UE and the Remote UEs PDU Session requirements may not be met.
The content traffic descriptor transferred from the Remote UE to the Relay UE
is assumed to be same as defined in clause 6.6.2.1 of TS 23.503 [18].
### 6.42.2 Procedures
The procedure is the same as 6.6.2 with the following additional clarification
in step 3.
The Remote UE sends the traffic descriptors of the service which is to be
relayed to the ProSe 5G UE-to-Network Relay, the ProSe 5G UE-to-Network Relay
derives the relay relevant PDU Session parameters (e.g. S-NSSAI, DNN, Type)
for the relay data using the configured URSP rule and the received traffic
descriptors from the Remote UE. ProSe 5G UE-to-Network Relay establishes PDU
session for relay as existing PDU Session Establishment procedure.
NOTE: The privacy and security aspects of transporting traffic descriptor
information from the Remote UE to the UE-to-Network Relay during PC5 direct
connection setup need to be coordinated with SA WG3.
### 6.42.3 Impacts on services, entities and interfaces
Impact on Remote UE:
\- Transferring the traffic descriptors to the UE-to-Network Relay when
establishing PC5 connection.
Impact on UE-to-Network Relay:
\- Receiving the traffic descriptors from the Remote UE and derives PDU
Session parameters based on URSP.
## 6.43 Solution #43: PC5 connection establishment for Layer-3 UE-to-Network
Relay without Relay discovery
### 6.43.1 Description
This solution addresses Key Issue#3 and provides an alternative option on PC5
connection establishment without Relay discovery on top of solution#6.
Solution#6 in TR 23.752 shows the baseline Layer-3 UE-to-Network Relay
architecture and procedure, in which standalone Discovery procedure (step 2 of
clause 6.6.2) and one-to-one establishment procedure (step 3 of clause 6.6.2)
are used to establish the PC5 connection between Remote UE and UE-to-Network
Relay.
This solution proposes an alternative option to establish the PC5 connection
by reusing the Layer-2 link establishment procedure defined in TS 23.287 [5]
clause 6.3.3.1, in which standalone discovery procedure is not needed and
implicit UE-to-Network Relay discovery is embedded into the Direct
Communication procedure.
### 6.43.2 Procedures
The procedure of solution#6 in clause 6.6.2 is reused with the following
differences:
Figure 6.43.2-1: ProSe 5G UE-to-Network Relay
0\. This step is same as step 0 of clause 6.6.2.
1\. This step is same as step 1 of clause 6.6.2.
2\. Remote UE sends a Direct Communication Request message to initiate the
unicast layer-2 link establishment procedure with ProSe UE-to-Network Relay.
This step is same as step 3 of TS 23.287 [5] clause 6.3.3.1 with the following
differences:
\- V2X Service Info is replaced by Relay Service Code.
\- Source User Info is Remote UE\'s Application Layer ID, and Target User Info
is Relay UE\'s Application Layer ID.
3\. Security between Remote UE and UE-to-Network Relay is established. This
step is same as step 4 of TS 23.287 [5] clause 6.3.3.1 with the following
differences:
\- The UE-to-Network(s) that support the Relay Service Code responds by
establishing the security with Remote UE (step 3b).
NOTE 1: The signalling for the Security Procedure is to be defined by SA WG3.
NOTE 2: This solution does not preclude authorization procedure for Relay
operation with the core network.
4\. A Direct Communication Accept message is sent to Remote UE by the UE-to-
Network Relay UE(s) that has successfully established security with Remote UE.
This step is same as step 5 of TS 23.287 [5] clause 6.3.3.1 with the following
differences:
\- The UE-to-Network(s) that support the Relay Service Code responds the
request by sending a Direct Communication Accept message (step 4b).
5\. If Remote UE receives the Accept message from multiple UE-to-Network Relay
UEs in step 4, the Remote UE may decide to select one UE-to-Network Relay for
further communication and release the link with other UE-to-Network Relays,
which may trigger UE-to-Network to perform PDU session release or modification
procedure.
6\. The UE-to-Network Relay may establish new PDU session or modify existing
PDU session for relaying, this step is same as step 3 of clause 6.6.2.
7\. IPv6 prefix or IPv4 address is allocated for the Remote UE, this step is
same as step 4 of clause 6.6.2.
8\. This step is same as step 5 of clause 6.6.2.
Editor\'s note: Whether Layer-2 link establishment procedure can be initiated
by UE-to-Network Relay is FFS.
### 6.43.3 Impacts on Existing Nodes and Functionality
The solution has impacts in the following entities:
**SMF:**
\- Needs to support procedures for Remote UE report.
**UE:**
\- Needs to support procedures for Remote UE and UE-to-Network Relay.
## 6.44 Solution #44: QoS handling for layer-2 relay
### 6.44.1 Description
This is a solution for Key Issue #3 \" Support of UE-to-Network Relay \",
which is applied to Layer-2 UE-to- Network Relay QoS handling.
In Layer 2 UE-to-NW relay solution (Solution #7), the Remote UE\'s data flow
is served by its own PDU Session. RAN has the knowledge of that the PDU
session is for Layer 2 UE-to-NW relay. In order to fulfil the QoS parameters,
RAN needs to determine the suitable configurations over the PC5 leg and Uu
leg. To reduce the RAN impacts, SMF can provide some guidance to RAN. SMF
generates the Uu QoS profile and PC5 QoS profile and then provide them to RAN.
RAN will take these QoS profiles as the principles to determine the
configurations over PC5 leg and Uu leg. If the dynamic PCC control is
supported, SMF can base on the PCF provided PCC rules over Uu leg and PC5 leg
to generate the Uu QoS profile and PC5 QoS profile.
In this solution, it is assumed that the remote UE\'s core network has the
knowledge of remote UE is accessing via a UE-to-Network Relay.
NOTE: The details of how to determine the configurations over Uu and PC5 legs
are implemented by RAN.
### 6.44.2 Procedures
Figure 6.44.2-1 QoS handling for layer-2 relay
0\. It is assumed there is an indirect communication link for remote UE via a
UE-to-Network relay based on the Layer-2 relay.
1\. During the PDU session establishment or modification procedure, if the
dynamic PCC control is supported, the PCF generates the PCC rules over Uu leg
and PC5 leg based on the operator policies and the charging rate over Uu and
PC5, and then send them to SMF in the SM Policy Association Establishment or
SM Policy Association Modification procedure.
2\. SMF based on the received PCC rules over Uu leg and PC5 leg generates the
corresponding Uu QoS profile and PC5 QoS profile.
3\. SMF sends the corresponding Uu QoS profile and PC5 QoS profile to RAN.
4\. Based on the Uu QoS profile and PC5 QoS profile provided by the SMF, RAN
issues the configurations over PC5 leg to Remote UE and issues the
configurations over Uu leg and PC5 leg to UE-to-Network Relay.
### 6.44.3 Impacts on services, entities and interfaces
PCF:
\- Generates PCC rules over Uu and PC5 (for QoS control over Uu and PC5).
SMF:
\- Generates QoS profile over Uu and PC5 (for QoS control over Uu and PC5).
RAN:
\- Performs the configurations over Uu and PC5 based on the SMF provided QoS
profile.
## 6.45 Solution #45: QoS for L3 relaying
### 6.45.1 Description
The solution enables support for QoS that is appropriate for the services
offered to Remote UE even if it is accessing over 5G Prose Relay UE which is
served by a PLMN that is different from the PLMN serving the Remote UE. It is
proposed to introduce the ability for services offered to Remote UE to be
given appropriate QoS by the Relay UE and the 5GS (NG-RAN, 5GC) serving the
relay UE.
Protocol stack structure shown in clause 6.23, End-to-End security for Layer-3
UE-to-Network Relay using N3IWF is assumed.
As the result of Relay UE discovery and PC5 connection setup, the Relay UE
establishes a PDU session with default QoS, unless one is already available in
the Relay UE. This solution is compatibe with any other solution that allows
the the default QoS to be set up. Solution #38 or any other solution that
allows the Relay UE to set up PDU session for relaying with a pre-configured
or other default QoS can serve as the pre-requisite method of setting up the
connectivity for the Remote UE.
If the PLMN serving the Remote UE detects that the application running in the
Remote UE requires specific QoS (such as requested for a voice call or for
public Safety services), then the PLMN serving the Remote UE signals the
intended QoS parameters to the Remote UE. Remote UE uses these parameters to
request specific QoS from the Relay UE. If the Relay UE detects that the QoS
of the Relay PDU Session is not sufficient, then the Relay UE initiates PDU
Session Modification procedure to get Qos Flows that are suitable for the
Remote UE request.
The following QoS differentiation mechanisms are proposed:
1) **Mapping between DSCP marking and 5QI:** Consistent mapping between DSCP
marking value and 5QI in the PLMN for Remote UE and the PLMN for Relay UE to
ensure that the QoS is consistent for the end to end user plane path in both
UL and DL direction between Remote UE \ Relay UE \ Relay UE RPLMN \
Remote UE RPLMN. It is proposed to achieve interoperability by adding a
recommendation for mapping between 5QI/ARP and DSCP mapping in TS 23.501 [6]
annex so that the PLMNs use the same mapping values for UL and DL user plane
traffic.
2) **Use of SPI for mapping to QoS Flows:** It is proposed that the Remote
UE\'s PLMN identifies the appropriate QoS for the services offered using IKE
signalling as defined for Network Requested PDU Session Modification in step 4
of 23.502 [8] Figure 4.12.6-1: \"UE or Network Requested PDU Session
Modification via untrusted non-3GPP access\". Based on this, the remote UE
requests for appropriate QoS with the Relay UE (over PC5) including the N3IWF
address and SPI and the PC5 QoS parameters mapped from the QoS parameters
received over NAS message from the N3IWF. Then the Relay UE determines whether
the already existing QoS Flow for the PDU Session (used to relay traffic of
this Remote UE) fulfils the QoS needs of the remote UE or not. If the Relay UE
determines the need to request for modified QoS, it initiates PDU Session
modification procedure towards its own serving PLMN. As part of the PDU
Session modification procedure, the Relay UE will also include the N3IWF
address and SPI so that the network can use this for mapping the DL traffic
(identified by N3IWF address and SPI) to the appropriate QoS Flow. The call
flow is shown in Figure 6.45.2-1.
### 6.45.2 Procedures
Figure 6.45.2-1 shows the call flow for service specific QoS required by an
application running in the Remote UE. N3IWF, SMF and PCF are in the PLMN
serving the Remote UE and Relay UE is served by an Intermediate network. These
two networks need not be the same PLMN but obviously could be the same PLMN.
Figure 6.45.2-1: Service specific QoS establishment procedure
As pre-requisite condition, the Remote UE has been authenticated by its
serving PLMN via Relay UE and security association has been set up between
N3IWF and Remote UE.
0\. UE launches an application that requires specific QoS (e.g. IMS voice or
Public safety application).
1a. The PCF detects the need for specific QoS (possibly triggered by a P-CSCF
or a public Safety service entity) and issues corresponding PCC rules (that
may require a GFBR). This is as defined in TS 23.502 [8].
1b. SMF of the Remote UE invokes PDU Session Modification procedure as defined
in TS 23.502 [8] Figure 4.12.6-1 including the required specific QoS
parameters that are provided to the N3IWF.
2a. The N3IWF creates or updates Child SA with Remote UE as defined in TS
23.502 [8] using IKE signalling as defined for Network Requested PDU Session
Modification e.g. in step 4 of TS 23.502 [8] Figure 4.12.6-1.
For the case of a Child SA creation, TS 23.502 [8] specifies that the N3IWF
\"establishes a new Child SA by sending an IKE_CREATE_CHILD_SA request
message, which includes the SA [including IPSec SPI], the PDU Session ID, the
QFI(s), optionally a DSCP value, and optionally the Additional QoS Information
specified in TS 23.502 [8] clause 4.12a.5\" and that \"If the Additional QoS
Information is received, the UE may reserve non-3GPP access network resources
according to the Additional QoS Information\". For UE-to-Network relaying, the
UE reservation of Non-3GPP access network resources is done as shown in step 3
below.
2b. Remote UE responds on the Child SA.
2c. The N3IWF sends the PDU Session Modification Command to UE (if received in
step 1b) and receives the response message from UE. The QoS parameters are
included in the PDU Session Modification Command message.
3\. Remote UE derives PC5 QoS parameters for the PC5 link based on the
Additional QoS QoS parameters received in step 2c and the mapping between 5QI
and PQI provisioned by PCF .
Remote UE sends the Link Modification Request to the Relay UE and provides PC5
QoS parameters and the N3IWF address and SPI corresponding to the Child SA to
enable filtering and mapping of DL traffic towards the right PDU Session/QoS
Flow within the Intermediate Network.
4\. Relay UE derives the QoS parameters for Uu link based on the PC5 QoS
parameters received from step 3 and determines whether it is necessary to
request PDU session modification for the PDU Session used by the Relay UE to
exchange traffic on behalf of the Remote UE.
If the existing QoS between the Relay UE and the Intermediate Network is
already sufficient to meet the QoS requirement received in step 3, then no PDU
session modification towards the Intermediate Network is necessary, step 5 is
omitted.
Otherwise, the Relay UE continues in step 5a.
5a. Relay UE requests PDU Session Modification from the Intermediate Network
using the QoS parameters derived from PC5 QoS parameters received in step 3
and it also provides the N3IWF address and SPI received from the Remote UE to
enable filtering and mapping of DL traffic towards the right PDU Session/QoS
Flow within the PSA UPF of the Intermediate Network (PSA UPF of the PDU
Session of the Relay UE). The UPF will map the DL traffic from IKE Child SA
tunnel to appropriate PDU Session/QoS Flow considering the N3IWF address and
SPI (filters provided by Relay UE for DL traffic mapping).
5b. Intermediate Network performs the PDU Session Modification procedure. The
PCF authorize the QoS parameters received from the Relay UE based on local
policy.
5c. If the QoS parameters is authorized successful, Intermediate Network
acknowledges PDU Session Modification to Relay UE.
6\. Relay UE sends Link Modification Accept message with the PC5 QoS
parameters to Remote UE.
When the Remote UE or N3IWF triggers IKE SA rekeying procedure and
corresponding SPI is changed, the Remote UE notifies the updated changed SPI
to the Relay UE. The Relay UE triggers PDU Session Modification procedure to
report changed SPI to SMF. Based on the changed SPI, the SMF updates QoS rules
and N4 rules.
NOTE: During the transient period, the network cannot provide proper QoS.
### 6.45.3 Impacts on services, entities and interfaces
Remote UE:
\- Derives the PC5 QoS parameters based on the QoS parameters received from
SMF.
\- Request PC5 QoS parameters from the Relay UE based on specific PDU Session
QoS parameters received in NAS signalling.
\- Report the N3IWF address and (changed) SPI to the Relay UE via PC5
signalling.
Relay UE:
\- Derives the Uu QoS parameters based on the PC5 QoS parameters from Remote
UE.
\- Request PDU Session Modification to match the QoS parameters.
\- Report the N3IWF address and (changed) SPI to the network when it receives
N3IWF address and (changed) SPI from the Remote UE.
SMF:
\- Receive N3IWF address and SPI from Relay UE and include N3IWF address and
SPI in the PDR installed into UPF.
## 6.46 Solution #46: UE-to-Network Relay authorization
### 6.46.1 Description
This is a solution for key issue #3, UE-to-Network Relay.
The solution is intended to complement the baseline L3 UE to network Relay
solutions when relay authorisation is needed e.g. in solutions described in
clause 6.6 and Solution #23 \"End-to-End security for Layer-3 UE-to-Network
Relay using N3IWF\" described in clause 6.23. See also Figure 6.46.1-2 below.
A 5G ProSe UE-to-Network relay is called \"Relay UE\" in this solution.
Figure 6.46.1-1: Architecture model using 5G ProSe 5G UE-to-Network L3 Relay
solution (Generic case)
Figure 6.46.1-2: Architecture model for Layer-3 UE-to-Network Relay with
support of N3IWF
When the Relay UE and the Remote UE have a subscription to the same HPLMN, the
solution works as follows;
1\. The Relay UE registers with 5GS and obtains service for itself (as in
Rel-16 specification).
2\. The Remote UE tries to establish a PC5 connection to the Relay UE. During
the PC5 establishment, the Remote UE provides its SUCI to the Relay UE when it
requests UE-to-network relaying from the Relay UE over PC5.
3\. The Relay UE contacts its AMF and requests (NAS message) an authorization
for relaying the remote UE providing the SUCI of the remote UE.
NOTE 1: The stage 3 NAS message to use is to be defined by CT WG1.
4\. If AUSF corresponding to the Remote UE\'s target PLMN is not discovered
already, the AMF in Intermediate PLMN discovers AUSF as specified in TS 23.501
[6] clause 6.3.4 and sends a Request to AUSF for authorization, providing the
SUCI of the Remote UE.
The checking whether the Remote UE is authorised to use UE-to-Network relaying
may consider the following aspects:
a) UDM Subscription data for the Remote UE may contain information on which UE
(possibly any, members of an IMSI Group, a list of SUPI or GPSI) the Remote UE
accepts to use as a Relay UE.
b) HPLMN may have policies to fetch from a third-party AAA the information
whether the Remote UE (identified by its GPSI) accepts to be relayed by a
Relay UE identified by its GPSI.
During this step the HPLMN may control whether relaying via the Intermediate
PLMN serving the Relay UE is allowed.
NOTE 2: The Intermediate PLMN need not be the same as the Remote UE target
PLMN. If the PLMN identified by Remote UE SUCI differs from the MCC and MNC of
the Intermediate PLMN, then the AMF needs to discover AUSF in the target PLMN
of the Remote UE.
Similar operations apply towards the Relay UE HPLMN to authorise its
capability to act as a Relay UE.
5\. The AUSF authenticates the Remote UE via the AMF. The AUSF uses the SUCI
of the Remote UE to get the necessary credentials.
PC5 related security parameters are derived during the authentication
procedure. This may be useful in the generic configuration of Figure 6.46.1-2
where no secured (IPSec) tunnel protects the traffic over PC5
### 6.46.2 Procedures
The connection of a Remote UE via a Relay UE works according to high level
steps described in to Figure 6.46.2-1.
Figure 6.46.2-1: UE-to-Network Relay authorization when Relay UE and Remote UE
have subscription in different PLMN (s)
1\. The Relay UE registers (see TS 23.502 [8] clause 4.2.2.2).
2\. Remote UE establishes PC5 connection towards the Relay UE. When requesting
UE-to-Network relaying over PC5, the Remote UE provides its SUCI to the Relay
UE.
NOTE 1: How the remote UE discovers the Relay UE is independent of this
solution. Discovery can be based on methods defined in TS 23.287 [5] or in
other solutions of this TR.
3\. The Relay UE requests authorization for UE-to-Network relaying from its
serving AMF and provides the SUCI of the Remote UE and its own SUPI.
NOTE 2: It assumed that UE-to-Network relay authorisation is NAS signalling
and it is expected that CT groups specify the stage 3 messages.
4\. The AMF requests for authorisation for the Remote UE to use UE-to-Network
relaying via the Relay UE. The AMF includes the SUCI of the Remote UE and the
GPSI of the Relay UE.
5-6. The AUSF of the Remote UE may authenticate the Remote UE.
The authentication is signalled transparently via the Relay UE and the AMF
serving it.
Both the Remote UE and its AUSF derive security (e.g. ciphering) parameters
during the authentication of the Remote UE for later use for PC5 security.
7\. The Relay AMF requests authorisation for Remote UE communication via Relay
UE, providing Relay UE GPSI and Remote UE SUPI to the Remote AUSF.
8\. The AUSF of the Remote UE checks whether the Remote UE identified by
Remote UE SUPI is authorised to use UE-to-Network relaying via the Relay UE
identified by Relay UE GPSI. Two alternatives can be supported:
8a The AUSF can request the UDM to verify against Subscription data of the
Remote UE whether the Remote UE is authorised to use UE-to-Network relaying
over the Relay UE.
8b Based on HPLMN policy, the HPLMN can delegate it to a third party AAA
server (identified by the domain part of the GPSI of the Remote UE) to verify
whether the Remote UE (identified by its GPSI) is authorised to use UE-to-
Network relaying via Relay UE (identified by its GPSI).
If authorisation succeeds, the AUSF continues in step 8. Otherwise, the AUSF
indicates authorisation failure to the AMF, which rejects the UE-to-Network
relaying request based on the response it received from the AUSF.
9\. The AUSF responds to Relay authorisation Request and provides Result and
security (e.g. ciphering) parameters and the Remote UE GPSI for Relay AMF.
10\. The AMF requests for authorisation for the Relay UE to support UE-to-
Network relaying for the Remote UE. The AMF includes the Relay UE GPSI and the
Remote UE GPSI.
If the Relay UE is authorised to act as Relay UE for the Remote UE, the AMF
continues in step 11. Otherwise, the AMF rejects the UE-to-Network relaying
request.
11\. The AMF sends the relay authorisation including the authorisation result
and the security (e.g. ciphering) parameters.
### 6.46.3 Impacts on services, entities and interfaces
This solution impacts the following system entities.
Remote UE:
\- Capability to provide SUCI for UE-to-Network Relay UE for authorisation
\- Capability to support the authentication procedure via Relay UE
Relay UE:
\- Capability to request authorisation for Remote UE identified by SUCI
\- Capability to relay the authentication procedure towards the Remote UE
AMF:
\- Capability to request UE-to-Network relay authorisation from Remote PLMN
\- Capability to request UE-to-Network relay authorisation from Intermediate
PLMN
AUSF:
\- Capability to interact with third party AAA server if PLMN operator
delegates relay authorisation to third party.
## 6.47 Solution #47: Authorizing a UE to be a 5G UE-to-Network Relay and how
to authorize a UE to access 5GC via a 5G UE-to-Network Relay
### 6.47.1 Description
This is a solution for key issue #3, UE-to-Network Relay and it applies to L3
Relay. The principles are as follows:
\- During registration, the UE gets info if it is authorized to be a Relay.
The AMF gets info PLMNs whose UEs can relay data over this Relay UE.
\- During PC5 connection establishment, the Remote UE provides its UE ID to
the Relay UE which sends that info to the AMF to get authenticated and
authorization:
\- the Relay UE\'s AMF initiate authentication for the Remote UE towards the
Remote UE\'s AUSF;
\- After the remote UE is authenticated, the Relay UE\'s AMF initiates
authorization check towards the remote UE\'s UDM if the UE can act as Remote
UE and if it can be connected to the Relay UE.
\- Remote UE authorisation returns the Remote UE GPSI which allows relay
authorisation in the Relay network.
The need for functionality in step 5 and onwards depends on security
requirements of the application.
Editor\'s note: The authentication and authorization aspects depend also on
the study in SA WG3.
### 6.47.2 Procedures
The connection of a Remote UE via a Relay UE works according to high level
steps described in Figure 6.47.2-1. The proposed authorisation procedure can
be triggered in PC5 link establishment between the remote UE and the relay UE.
Figure 6.47.2-1: Authorizing a UE to access 5GC via a 5G UE-to-Network Relay
1\. The Relay UE registers (see TS 23.502 [8] clause 4.2.2.2).
The Relay AMF gets from the UDM the relay authorisation info for the Relay UE.
The UDM may also include a list of all PLMNs where there is at least one
allowed Remote UE for the Relay UE.
2\. Remote UE provides its SUCI in PC5 connection establishment phase. For
example, the Remote UE can provide its SUCI in PC5 Direct Communication
Request message to the Relay UE.
NOTE 1: How the remote UE discovers the Relay UE is independent of this
solution. Discovery can be based on methods defined in TS 23.287 [5] or in
other solutions of this TR.
3\. The Relay UE requests authorisation for UE-to-Network relaying from its
serving AMF and provides the SUCI of the Remote UE and Relay UE SUPI.
NOTE 2: It assumed that UE-to-Network relay authorisation is NAS signalling
and it is expected that CT groups specify the stage 3 messages.
4\. [Conditional] If information on PLMNs of allowed Remote UEs for relaying
was received in step 1, then based on this information, the Relay UE\'s AMF
checks if the there are any UEs in the PLMN identified by the Remote UE SUCI
for which the UE can act as a Relay UE. If not, the Relay UE\'s AMF informs
the relay UE and the PC5 connection is rejected. Otherwise the Relay AMF
continues the procedure.
Editor\'s note: Whether the list of PLMNs is provided to AMF at step 1 and AMF
performs verification prior to primary authentication is to be confirmed with
SA WG3.
NOTE 3: At this point, the Relay UE\'s AMF cannot know the GPSI of the Remote
UE, so it cannot authorise relaying before step 10.
5-7. Based on the relay authorisation info received in the step 1 or serving
PLMN\'s local policy, the Relay UE\'s AMF initiate authentication towards the
remote UE\'s AUSF using existing procedures as defined in TS 33.501 [31].
The authentication is signalled transparently via the Relay UE and the AMF
serving it. Part of the signalling may be encrypted and can be decrypted by
the Remote UE.
NOTE 4: Security related aspects need to be coordinated with by SA WG3.
As a result of the successful authentication of the remote UE, the Relay UE\'s
AMF receives the SUPI of the remote UE.
8\. After the remote UE is authenticated, the Relay UE\'s AMF initiates
authorisation check by providing both the Relay UE\'s ID (e.g. GPSI) and
Remote UE\'s SUPI to the UDM of the remote UE.
9\. Remote UE\'s UDM checks if the Remote UE is authorised to send its traffic
via Relay UE.
10\. Remote UE\'s UDM responds to the Relay UE\'s AMF, and includes the result
and the Remote UE\'s GPSI if authorisation is successful. If the authorisation
fails, the Relay UE\'s AMF informs the Relay UE and the PC5 connection is
rejected. Otherwise the Relay\'s UE\'s AMF continues the procedure.
NOTE 5: The service operation and the point of enforcement for the remote
UE\'s authorization check with the remote UE\'s UDM can be decided during
normative phase. For example, the Relay UE\'s AMF may enforce the
authorisation after receiving the authorisation information and/or Remote\'s
UE subscription data from the remote UE\'s UDM (via existing Nudm_SDM_Get
service operation).
11\. The Relay UE\'s AMF initiates authorisation check by providing both the
Remote UE GPSI and Relay UE GPSI to the Relay UDM.
12\. Relay UDM checks if the Relay UE is authorised to relay the traffic of
the Remote UE and responds with authorisation result.
13\. The Relay UE\'s AMF sends Authorisation result to the Relay UE. The Relay
UE may forward the authorisation result to the remote UE if required, e.g. via
the Discovery Response message or Direct Communication Accept message. If the
authorisation fails, the relay UE shall not respond to the discovery request
message or shall reject PC5 connection establishment if the authorisation
failed.
NOTE 6: Whether the authorisation result needs security protection, e.g. to
prevent the relay UE from modifying it, is expected to be addressed by SA WG3.
14\. Procedure continues depending on the L3 procedure, e.g. step 3 in clause
6.6.2 if the authorisation is successful.
### 6.47.3 Impacts on services, entities and interfaces
This solution impacts the following system entities.
Remote UE:
\- Capability to provide SUCI for Relay UE for authorisation.
\- Capability to support the authentication procedure via Relay UE.
Relay UE:
\- Capability to request authorisation for Remote UE identified by SUCI.
\- Capability to relay the authentication procedure towards the Remote UE.
AMF/UDM:
\- Support new service operation Nudm_Check_Authorization or using the
exsiting Nudm_SDM_Get. For a UE authorized to be a remote UE, the AMF checks
if another UE can act as its Relay for this particular UE.
\- Verification whether candidate Relay UE is allowed to act as Relay UE for
any other UE.
\- For a UE authorized to be Relay, AMF checks if another Remote UE can relay
its traffic via this Relay.
\- The UDM is provisioned with association between all authorised Remote UEs
and Relay UE to allow the AMF to decide whether the Remote UE is allowed to
access via the Relay UE.
## 6.48 Solution #48: Relay UE network information advertisement
### 6.48.1 General Description
This solution addresses Key Issue #1 (ProSe Direct discovery) and Key Issue #3
(UE-to-Network Relay).
Relay UE serving cell information, i.e. Cell ID, PLMN ID, TAI, can be useful
for the Remote UE for L3 UE-to-network relay solutions to support the below
operation:
\- An application may request for this information.
\- For N3IWF selection by the L3 remote UE.
### 6.48.2 Relay UE network information announcement procedure
Support the procedures in clause 5.4.4.5 of TS 23.303 [9], to advertise the
Cell ID of the Relay UE in below cases:
\- Remote UE request the Relay UE to announce Cell ID based on application
request, via Cell ID Announcement Request and Response messages.
\- Relay UE advertise its network information periodically to assist Remote
UEs with Relay connectivity, via Relay Discovery Additional Information
message.
In addition to the identifiers discussed in clause 4.6.4.10 of TS 23.303 [9],
except for information on TMGIs, support these identifiers in the Relay
discovery additional information message about Relay UE serving cell:
\- PLMN ID.
\- TAI.
### 6.48.3 Impacts on services, entities and interfaces
The solution has impacts in the following entities:
Relay UE:
\- support Cell ID announcement Request/Response procedure and Relay discovery
additional information procedure.
\- advertises the Cell ID, PLMN ID and 5GS TAI corresponding to the serving
cell.
Remote UE:
\- support Cell ID announcement Request/Response procedure and Relay discovery
additional information procedure.
## 6.49 Solution #49: Support Layer-3 UE-to-UE Relay to Handle Non-IP Traffic
### 6.49.1 Description
#### 6.49.1.1 General
The user plane protocol stack assumed in this contribution is illustrated by
Figure 6.49.1.1-1. Since there is no IP headers in the Non-IP packets, the UE-
to-UE relay cannot use destination IP addresses to forward the packets, In
this solution, the UE-to-UE relay uses the Layer-2 IDs in the incoming Layer-2
frames to find the correct outgoing PC5 links. Basically, the solution is
based on the following principles:
1\. For a specific source UE, it establishes a PC5 link for Non-IP traffic
with the UE-to-UE relay for each target UE it wants to communicate via that
relay. This principle means that the Non-IP traffic to different target UEs
from the same source UE cannot share the same PC5 link between the source UE
and the UE-to-UE relay.
2\. For each pair of source and target UEs, the UE-to-UE relay assigns itself
a Layer-2 ID, denoted as L2-ID_R, which is used in the Non-IP PC5 link to the
source UE and the Non-IP PC5 link to the target UE. The UE-to-UE relay
maintains a mapping between L2-ID_R and a pair of source and target UEs. The
source and target UEs store the mapping information when establishing relay
path between the source and target UEs via the UE-to-UE relay. When the source
and target UEs send Non-IP traffic to each other via the UE-to-UE relay, they
use L2-ID_R as the destination Layer-2 ID. When the UE-to-UE relay receives a
packet, according to the L2-ID_R and the source L2-ID it can forward the
packet to the correct PC5 link based on the mapping, it also changes the
destination L2-ID from L2-ID_R to the correct Layer2 ID of the target UE. The
source and target UEs identify the original UE when receiving packets from the
UE-to-UE relay according to the mapping information.
Figure 6.49.1.1-1: User plane protocol stack of PC5 when using Layer-3 UE-to-
UE relay to forward Non-IP traffic
#### 6.49.1.2 QoS handling
Regarding QoS handling, solution #31 is adopted to achieve end-to-end QoS
control via UE-to-UE relay. Basically, for a specific PC5 QoS flow, say PFI_s,
in the Non-IP PC5 link with the source UE, the UE-to-UE relay maps it to a
specific PC5 QoS flow, say PFI_t, in the Non-IP PC5 link with the target UE.
Incoming traffic from one of the flows is forwarded by the UE-to-UE relay to
the other flow.
#### 6.49.1.3 Security
For end-to-end security, IPsec cannot be used, since it is not IP traffic. It
is up to the application to implement end-to-end security for non-IP traffic.
Editor\'s note: How to handle end-to-end security for Non-IP traffic is FFS
and shall be co-ordinated with SA WG3 group.
### 6.49.2 Procedures
#### 6.49.2.1 Relay path establishment procedure
Figure 6.49.2.1-1 illustrates the procedure of path establishment procedure
for Non-IP traffic communication via a Layer-3 UE-to-UE relay.
0\. Source UE and target UE do the relay selection. In this step, any solution
for UE-to-UE relay selection can be applied here.
1\. Source UE wants to start Non-IP communication with the target UE. It
starts to establish a PC5 unicast link with the relay by sending a Direct
Communication Request to the relay as defined in clause 6.3.3.1 TS 23.287 [5].
In the request, the source UE indicates that the PC5 link is used for Non-IP
communication to the target UE.
Editor\'s note: It is FFS if traffic type, e.g. IP or Non-IP, can be derived
from the ProSe Application ID.
2\. The UE-to-UE relay assigns itself a Layer-2 ID, denoted as L2-ID_R, which
is used in the Non-IP PC5 link to the source UE and the Non-IP PC5 link to the
target UE. The UE-to-UE relay creates the mapping between the L2-ID_R and the
pair of UEs.
3\. UE-to-UE relay sends a Direct Communication Request to the target UE,
indicating that the link is used for Non-IP communication with the source UE.
It also provides the mapping information in the request.
4\. Target UE and the UE-to-UE relay setup security for the PC5 link.
NOTE: Whether L2-ID_R is provided in step 3 or step 4 is coordinated with SA
WG3.
5\. Target UE stores the mapping information, and sends Direct Communication
Accept.
6\. UE-to-UE relay and the source UE setup security for the PC5 link.
7\. UE-to-UE relay sends Direct Communication Accept with L2-ID_R and provides
the mapping information. The resource UE stores the mapping information.
8\. Non-IP communication between the source and the target UE via the relay.
When the source and target UEs send Non-IP traffic to each other via the UE-
to-UE relay, they use L2-ID_R as the destination L2-ID. When the UE-to-UE
relay receives a packet, according to the L2-ID_R and the original UE L2-ID it
can forward the packet to the correct PC5 link based on the mapping between
the L2-ID_R and the pair of UEs, it also changes the destination L2-ID from
L2-ID_R to the correct L2-ID of the destination UE. The source and target UEs
identify the original UE when receiving packets from the UE-to-UE relay
according to the local stored mapping information.
Figure 6.49.2.1-1 Path establishment procedure for Non-IP traffic
communication via a Layer-3 UE-to-UE relay
#### 6.49.2.2 Layer-2 ID update procedure
Figure 6.49.2.2-1 illustrates the procedure of Link Identifier Update.
Figure 6.49.2.2-1 Link identifier update procedure for Non-IP PC5 link with a
Layer-3 UE-to-UE relay
1\. The source UE decides to change its identifier(s), it sends Link
Identifier Update Request with its new Layer2-ID to the UE-to-UE relay as
defined in clause 6.3.3.2 TS 23.287 [5]. The source UE keeps sending data
traffic to the UE-to-UE relay with the old identifiers until it sends the Link
Identifier Update Ack to the relay.
2\. Upon receiving the Link Identifier Update Request message, the UE-to-UE
relay assigns a new L2-ID_R for the link with the source UE and the link with
the target UE.
3\. UE-to-UE relay sends Link Identifier Update Request to the target UE with
the new L2-ID_R and provides new source UE identifier. The UE-to-UE relay
keeps sending data traffic to the target UE with the old identifiers until it
sends the Link Identifier Update Ack to the target UE.
4\. Target UE sends Link Identifier Update Response with its new Layer2-ID.
The target UE continues to receive traffic with the old Layer-2 ID from UE-to-
UE relay until the target UE receives traffic with the new Layer-2 ID from the
relay. After sending the Link Identifier Update response, the target UE keeps
sending data traffic to the relay with the old identifier until it receives
the Link Identifier Update Ack message from the relay.
5\. UE-to-UE relay sends Link Identifier Update Response to the source UE with
the new L2-ID_R and provides new target UE identifier. The UE-to-UE relay
continues to receive traffic with the old L2-ID_R from the source and target
UE until it receives the traffic with new L2-ID_R from both the source and
target UEs. After sending the Link Identifier Update response, the UE-to-UE
relay keeps sending data traffic to the source UE with the old identifier
until it receives the Link Identifier Update Ack message from the source UE.
6\. The source UE sends the Link Identifier Update Ack to the UE-to-UE relay.
The source UE continues to receive traffic with the old Layer-2 ID from the
relay until the source UE receives traffic with the new Layer-2 ID from the
relay.
After step 5 and step 6, the UE-to-UE relay maintains a mapping between the
new L2-ID_R and the new identifiers of the source and target UEs. The UE-to-UE
relay keeps the mapping between the old L2-ID_R and the old identifiers of the
source and target UEs until the relay receives the traffic with the new
identifiers from both the source and target UEs.
7\. The UE-to-UE relay sends Link Identifier Update Ack to the target UE.
8\. The source and target UEs start using their new identifiers and the UE-to-
UE relay starts to use the new L2-ID_R. Based on the new mapping information,
the UE-to-UE relay transfers the packets accordingly, and the source and
target UEs identify the original UE when receiving packets from the UE-to-UE
relay.
### 6.49.3 Impacts on Existing Nodes and Functionality
The UE-to-UE relay needs to support the mapping between the L2-ID_R and the
pair of source and target UEs. Regarding QoS handling, the impact to the UE-
to-UE relay is the same as solution# 31.
The source and target UEs identify the original UE when receiving packets from
the UE-to-UE relay based on the mapping information.
## 6.50 Solution #50: Negotiated UE-to-UE Relay Reselection
### 6.50.1 Description
This solution provides a solution for UE-to-UE Relay reselection in Key Issue
#4. Since the solution is independent of how the relay forwards traffic
between Source UE and Target UE this solution is applicable to both Layer 2
UE-to-UE Relays and Layer 3 UE-to-UE Relays.
Solution#8 provides a solution for UE-to-UE Relay Selection, and this solution
is suitable for initial Relay selection and it could be extended for UE-to-UE
Relay reselection. However, it will cause the UE-to-UE Relay in proximity
broadcast the relay discovery message. Under some cases, these broadcast
messages can be avoided, by Source UE and Target UE negotiating the relay
reselection using the existing relay connection.
After the connection between Source UE and Target UE is setup, the Source UE
and Target UE may receive relay discovery messages from the other UE-to-UE
Relays. The Source UE or Target UE may find that the signal quality with other
UE-to-UE Relays is better than that with the currently used UE-to-UE Relay.
Alternatively if the Source UE or Target UE finds that the signal quality with
the selected UE-to-UE Relay is not good enough, it will initiate the discover
message to find the candidate UE-to-UE Relays which can provide a better
connection. After new candidate UE-to-UE Relays have been identified, the
Source UE or Target UE will initiate the relay reselection procedure and then
these two UEs can negotiate UE-to-UE Relay reselection using the existing
relay connection.
### 6.50.2 Procedures
Figure 6.50.2-1: UE-to-UE Relay Reselection Procedure
1\. Connection between Source UE and Target UE via Relay 1 is setup by using
the other solutions such as Solution #9 and Solution #10, and Relay 1 is
selected as UE-to-UE Relay, such as by using the Solution #8.
2\. The Source UE decides to perform UE-to-UE Relay reselection. This may be
triggered by receiving the relay discovery message from another UE-to-UE
Relay, and the signal quality with this UE-to-UE Relay is better than that
with Relay 1. Alternatively the Source UE will initiate the discover message
to find candidate UE-to-UE Relays which can provide a better connection, when
it finds that the signal quality with Relay 1 is not good enough.
3\. After the Source UE identifies the candidate UE-to-UE Relays, the Source
UE sends the UE-to-UE Relay reselection request to the Target UE using the
connection via Relay 1, and the request message includes the candidate UE-to-
UE Relay ID(s) ordered by the Source UE\'s preference based on e.g. the signal
quality of UE-to-UE Relays.
NOTE 1: Details of UE-to-UE Relay reselection request message and how the
message is forwarded by UE-to-UE Relay depends on the Layer 2 UE-to-UE Relays
and Layer 3 UE-to-UE Relays solution.
4\. The Target UE decides to change from Relay 1 to a new UE-to-UE Relay. The
new UE-to-UE Relay is chosen from the candidate UE-to-UE Relay ID(s) included
in the reselection request. This decision can be based on a new UE-to-UE Relay
providing the best signal quality, additionally based on the order of
candidate UE-to-UE Relay ID (s) received from the Source UE. If the Target UE
has not received a relay discovery message from a candidate UE-to-UE Relay or
does not connect to the candidate UE-to-UE Relay, the Target UE may perform
the UE-to-UE Relay discovery procedure with a candidate UE-to-UE Relay ID in
discovery message.
NOTE 2: Whether and how the signal quality information is used for candidate
UE-to-UE Relay selection needs to be coordinated with RAN WG.
5\. The Target UE sends a response to the Source UE via Relay 1 that includes
the new UE-to-UE Relay ID. If no new UE-to-UE Relay is chosen, the Target UE
may not respond to Source UE or send a response indicating Relay reselection
failure.
6\. [Optional] If the Target UE choses a new UE-to-UE Relay in step 5, the
Source UE initiates the connection setup procedure via the new UE-to-UE Relay,
and also releases the connection via Relay 1.
#### 6.50.2.1 Layer-2 based UE-to-UE Relay Re-selection
Figure 6.50.2.1-1 illustrates the procedure for UE-to-UE Relay re-selection
for Layer-2 based solution (as defined in Sol#9).
Figure 6.50.2.1-1: Layer-2 based UE-to-UE Relay Re-selection
1\. A PC5 unicast link is established between Source UE and Target UE via
Relay 1 (using Layer-2 based solution as described in sol#9).
2\. Traffic is exchanged between the Source UE and the Target UE over the PC5
unicast link, via Relay 1.
3\. Source UE detects a condition or receives a trigger to change the UE-to-UE
Relay. The Source UE may perform a discovery procedure to obtain a list of
candidate UE-to-UE Relay IDs (i.e. RIDs).
4\. Source UE sends a Link Modification Request message to Target UE (via
Relay 1) including a Relay re-selection indication, a list of candidate RIDs
and a source UE link ID, which is used on the Source UE, at steps 9 and/or 10,
to associate the existing PC5 unicast link via Relay 1 to the replacing PC5
unicast link with the selected Relay (e.g. Relay 2).
5\. Target UE selects a Relay from the received list of candidate RIDs (e.g.
Relay 2).
6\. Target UE sends a Link Modification Accept message to Source UE (via Relay
1) including the Relay re-selection indication, its Selected RID and a target
UE link ID, which is used on the Target UE, at step, 8 to associate the
existing PC5 unicast link via Relay 1 to the replacing PC5 unicast link with
the selected Relay (i.e. Relay 2).
7\. Source UE sends a broadcast Direct Communication Request (DCR) message
including the Target UE user info, and the Selected RID and the target UE link
ID received from Target UE during the Relay re-selection at step 6.
8\. Relay 2 receives the DCR message and verifies if the \"Selected RID\"
value matches its own RID and forwards the DCR message only if the \"Selected
RID\" value matches its own RID. The UE-to-UE Relay adds its RID to the
forwarded DCR message (as specified in Layer-3 based sol #9). Target UE
receives the DCR message and validates that the target UE link ID matches its
link ID as previously sent to Source UE (at step 6). Target UE also verifies
that the DCR message is received from its selected RID (i.e. RID2). Target UE
uses the target UE link ID to find the previous PC5 unicast link to be
replaced by the new PC5 unicast link. The association between the Application
Layer identifier and the PC5 unicast link via Relay 1 is updated with the new
PC5 unicast link via Relay 2 once the traffic is ready to be switched to the
new PC5 unicast link (via Relay 2) (i.e. at step 12).
9\. Target UE may trigger the security establishment procedure, via Relay 2,
and include the source UE link ID, as received on the Link Modification
Request at step 4. The security establishment procedure may be skipped if the
existing security context used with the previous PC5 unicast link is re-used
with the replacing PC5 unicast link, allowing a quicker link setup and path
switching. Source UE uses the source UE link ID to find the previous PC5
unicast link with Relay 1 to be replaced by the new PC5 unicast link being
established (i.e. via Relay 2). The association between the Application Layer
identifier and the PC5 unicast link via Relay 1 is updated with the new PC5
unicast link via Relay 2 once the traffic is ready to be switched to the new
PC5 unicast link (via Relay 2) (i.e. at step 12).
10\. Target UE sends a Direct Communication Accept message which may include
the source UE link ID from Source UE as received at step (4).
11\. A new PC5 unicast link is established between the Source UE and Target UE
via the Relay 2.
12\. Source UE and Target UE switch the data traffic to the new PC5 unicast
link via Relay 2. Source UE or Target UE may terminate the PC5 unicast link
via Relay 1.
#### 6.50.2.2 Layer-3 based UE-to-UE Relay Re-selection
Figure 6.50.2.2-1 illustrates the procedure for UE-to-UE Relay re-selection
for Layer-3 based solution (as defined in Sol#10).
Figure 6.50.2.2-1: Layer-3 based UE-to-UE Relay Re-selection
1\. Source UE has a PC5 unicast link established with Relay 1.
1a. Target UE has a PC5 unicast link established with Relay 1 and exchange IP
packets via Relay 1.
2\. Source UE has a PC5 unicast link established with Relay 2.
2a. Target UE has a PC5 unicast link established with Relay 2.
3\. Source UE and Target UE exchange IP packets via Relay 1.
4\. Source UE detects or receives a trigger to change the Relay.
5\. Source UE sends a PC5 Link Modification Request message for Target UE (via
the PC5 unicast link with Relay 1) which includes a Relay reselection
indication, a list of candidate Relay IDs (RIDs), Source UE and Target UE IP
addresses used to communicate via Relay 1. The IP addresses are specified
since the PC5 Link Modification message does not include these IP addresses
which are needed at the Relay to fetch the corresponding PC5 unicast link from
its mapping table toward the Target UE (as specified in sol#10).
The list of candidate RIDs is selected based on the PC5 unicast links already
established between Source UE and such Relays (RIDs). The IP address of
multiple Target UE s may be specified in the case where Source UE is
communicating with multiple Target UEs via Relay 1.
6\. Relay 1 determines that the message is destined to the Target UE based on
the \"Relay reselection indication\" and Target UE\'s IP address. Relay 1
sends a PC5 Link Modification Request message to Target UE\'s IP address (as
specified in the message); if multiple Target UEs are impacted, the Relay 1
sends a PC5 Link Modification Request to each of these Target UEs.
7\. Based on the relay reselection indication, Target UE knows that the
communication with Source UE needs to be handled via another Relay. Target UE
selects a RID from the list of candidate RIDs. Target UE may select a RID with
which a PC5 unicast link is already established or Target UE may establish a
new link with the selected RID.
8\. Target UE sends a Link Modification Accept message to Relay 1, which
includes a Relay reselection indication, Source UE and Target UE IP addresses
used via Relay 1, and Target UE\'s IP address used via Relay 2 and the
selected RID (e.g. RID2).
9\. Relay 1, based on the relay reselection indication, sends a PC5 Link
Modification Accept message to Source UE using the specified Source UE\'s IP
address.
10\. Source UE extracts the selected Relay ID (RID2) from the Link
Modification Accept message and sends a Link Modification Ack message which
includes its IP address associated to Relay 2.
11\. Relay 2 receives this message and forwards it to the Target UE since the
Relay reselection indication is specified. This Ack message is needed to
synchronise the switch of traffic between the Source UE and Target UE, via the
selected UE (Relay 2), at the same time.
12\. From this point on, Source UE and Target UE switch the IP traffic to the
new PC5 unicast link via Relay 2 (since Source UE and Target UE have exchanged
their respective IP address in above steps they can skip performing DNS query
steps with Relay 2).
### 6.50.3 Impacts on services, entities and interfaces
**Source UE:**
\- Identifies the candidate UE-to-UE Relays, and initiates Relay reselection
via the existing connection.
**Target UE:**
\- Decides the new UE-to-UE Relay.
**UE-to-UE Relay:**
\- Sends/receives discovery messages to/from the Source UE or the Target UE.
## 6.51 Solution #51: Provisioning policy based path selection between PC5 and
Uu
### 6.51.1 Description
This solution resolves Key Issue #5 about direct communication path selection
between PC5 and Uu.
The \"direct communication path selection between PC5 and Uu\" refers to the
procedure on how a UE selects a communication path between PC5 interface and
Uu interface before it establishes connection with the network or another UE.
This procedure should be performed once before the communication starts. The
UE may use the provisioned policy from the network to select the appropriate
communication path.
This solution provides two options for the PCF network provisioned path
selection policy:
\- Option 1: Path selection policy to the UE.
\- Option 2: URSP enhancements to support path selection.
### 6.51.2 Procedures
**Option 1: Path selection policy to the UE**
The different ProSe services may be bound to the different communication path,
e.g. an interactive gaming requiring cloud computing needs to be bound to the
Uu communication path while an chatting application used in a party is
suitable to select the PC5 communication path. There may also be the case that
all ProSe services are bound to the same path to simplify the UE operation.
The following policy for path selection between PC5 and Uu can be included in
the service authorization provisioning policy/parameter to the UE of solutions
(e.g. solution#17) for Key Issue #8:
\- The mapping of all or specific ProSe services to PC5 reference point or Uu
interface:
\- only the PC5 path shall be used;
\- only the Uu path shall be used (this does not apply to unlicensed
spectrum);
\- PC5 path preferred, where the UE can choose between the PC5 path or Uu
path;
\- Uu path preferred, where the UE can choose between the PC5 path or Uu path;
\- no preference.
NOTE: Which information is used to identify the ProSe service (e.g. Traffic
Descriptor as defined in TS 23.503 [18], Application ID) will be decided
during the normative phase.
UE operation related to the path selection policy is as follows:
\- If PC5 preferred is indicated in the path selection policy, the UE first
chooses to use PC5 interface by evaluating the authorized ProSe Communication
Policy and parameters for the selected ProSe service or all applications.
\- If Uu preferred is indicated in the path selection policy, the UE first
chooses to use Uu for communication for the selected ProSe service or all
applications by evaluating the Uu communication related Policy and parameters
(i.e. URSP, UE Local Configuration).
\- If no preference is indicated for a ProSe service or all applications in
the path selection policy or no path selection policy is provisioned, the UE
can decide to select Uu or PC5 based on its pre-configuration or
implementation.
The PCF based service authorization and provisioning procedure defined in TS
23.287 [5] can be reused to provide the above mapping information to the UE to
assist the path selection.
**Option 2: URSP enhancements to support path selection.**
**Non-Seamless Offload indication**
URSP as defined in TS 23.503 [18] is used by the UE to determine how to route
outgoing traffic, and it can be enhanced to support the communication path
selection between PC5 and Uu by considering the different service requirements
of the application traffic. For example, for the application traffic requiring
service continuity, the Uu communication path is more preferred.
According to the URSP definition in TS 23.503 [18] clause 6.6.2, the \"Non-
Seamless Offload indication\" is used to indicate if the traffic of the
matching application is to be offloaded to non-3GPP access outside of a PDU
Session. For the traffic communicated over PC5 communication path, the traffic
handling is similar to NSWO, i.e. sent outside of UE\'s PDU Session.
Thus, this \"Non-Seamless Offload indication\" can be extended with some value
to indicate if the offloading is via non-3GPP access or a PC5 communication
path. Alternatively, a new similar indicator, e.g. \"PC5 path offload
indication\", can be added to the Route selection components to govern if the
application traffic can be routed via a PC5 communication path.
The UE can use this indicator to determine the corresponding operations when
performing path selection between PC5 path and Uu path. For example, if any
active application matches a URSP rule that does not have this indicator, the
UE should attempt to establish a PDU session based on the URSP rules. If,
however, the application matches a URSP rule that has this indicator present,
the traffic can be routed via the PC5 communication path directly, and no PDU
session is required.
Editor\'s note: Whether and how Option 2 is applicable for direct path
selection between PC5 path and Uu path and also co-existence along solution
#26 is FFS.
**Access Type Preference**
The current Access Type preference defined in TS 23.503 [18] only includes
3GPP or non-3GPP when the UE establishes a PDU session for the matching
applications. However, when the PC5 communication path is used, the UE
supports the access via the PC5 link.
Therefore, it is preferable to extend the existing _\"Access Type preference\"
IE_ to include PC5 path, so that the UE will be able to determine which type
of access should be used.
Editor\'s note: Whether and how Option 2 is applicable for direct path
selection between PC5 path and Uu path and also co-existence along solution
#26 is FFS.
### 6.51.3 Impacts on Existing Nodes and Functionality
The solution has impacts in the following entities:
UE:
\- UE needs to be able to interpret the provisioned policy or URSP rules as
defined in clause 6.51.2 to assist the path selection between PC5
communication path and Uu communication path.
# 7 Overall Evaluation
Editor\'s note: This clause will provide evaluation of different solutions.
## 7.1 Key Issue #1: ProSe Direct discovery
The clause evaluates the solutions for KI#1 as following.
For PC5 direct discovery procedure:
\- Solution #1, #3, #18, #19 proposes to use model A procedure, besides,
solution #10 and #11 also mentions to use model A for UE-to-UE relay
discovery. Model A procedure can reduce the latency for discovery and then
reduce the latency for communication establishment. Model A procedure requires
the announcing UE periodically broadcast the direct discovery message, which
may consume more announcing UE power. Model A procedure is applicable to those
UEs which are not sensitive to power consumption. Model A can support
standalone discovery service and UE-to-Network Relay/UE-to-UE Relay discovery.
\- Model A and Model B procedure can support all of the discovery scenarios,
including standalone discovery service, discover an in-proximity UE for
communication, whether they will be used for UE-to-Network Relay discovery and
UE-to-UE Relay discovery can be evaluated in KI#3 and KI#4.
NOTE: Standalone discovery service means discovering an in-proximity UE is not
for PC5 communication or relay operation, e.g. discovering a shop or
discovering a certain person.
For content in PC5 discovery message:
\- Service-specific information (e.g. application ID/code), User-specific
information (e.g. User application ID), Group-specific information (e.g. Group
ID) needs to be included in the discovery message on PC5.
Others:
\- For transmission mechanism, only solution #3 proposes to transmit discovery
messages multiplexed with PC5 communication. According to RAN working group
agreements, SA WG2 assumes that discovery message are transmitted using PC5
communication channel.
\- Whether and how to transmit metadata in discovery message in solution #1
depends on the size content of the discovery message, it needs to be confirmed
by RAN WG. This issue can be left to normative work.
\- The proposal of 5GC selects the UE-to-UE Relay based on the location
information, and provides the Relay information to the Remote UE and the Relay
UE in solution #33 requires 5GC to trace each UE and to determine the UE-to-UE
Relay based on the relative distance and it brings large complexity for 5GC
implementation and system signalling overhead for each UE-to-UE Relay
discovery and selection. Hence, the method of selecting a UE-to-UE Relay based
on the UEs relative distance does not make sense.
For Key Issue #1 (ProSe Direct discovery), regarding group
discovery/management to support _on demand-based_ group communication for
commercial services:
\- The group for _on demand-based_ group communication for commercial services
is formed dynamically with the group member UEs that are interested in the
service (e.g. interactive game) and want to join the group for group
communication.
\- The following solutions include the aspect related to group
discovery/management to support _on demand-based_ group communication for
commercial services and propose that the group discovery/formation/management
can be carried out in the Application Layer:
\- Solution #4: PC5 group communication for commercial services.
\- Solution #22: V2X-based group communication for commercial services.
\- Solution #37: Groupcast mode communication for commercial services and
public safety (as alternative 1 in clause 6.37.2).
\- Solution #39: ProSe group discovery.
\- Application layer signalling between the UE and the Application Server is
out of scope of this study and does not have to be specified.
\- Solution #4 and Solution #39 describe that the following ways can be
considered regarding the Application layer discovery messages exchanged over
PC5 reference point between UEs:
1) The Application layer discovery messages are exchanged by using PC5 direct
communication same as V2X services (i.e. Application Layer discovery messages
are considered as user traffic); or
2) The Application layer discovery messages are exchanged by using PC5 direct
discovery including a transparent container (i.e. PC5 discovery message format
e.g. defined in Solution#3 is used but only a transparent container IE is
needed as IE in the discovery message).
Compared to 1), 2) might be more appropriate to transmit the Application layer
discovery messages if the protocol stack for PC5 direct discovery is to be
defined without the SDAP layer similar to that for PC5-S.
For ProSe code allocation:
\- Solution #18 proposes a control plane based solution based on the
architecture in Annex B.3. 5G DDNMF is introduced as a new NF/NF Service into
5G system to response the discovery request, i.e. take the responsibilities of
DDNMF as introduced in 4G and provide code and filters via control plane to
the 5G ProSe UEs.
\- Solution #3 proposes a user plane based solution based on the architecture
in Annex B.2. This solution proposes the procedure for the dynamic
control/management of the identifiers used in the discovery, by reusing the
user plane 5G DDNMF and the PC3 procedures defined in TS 23.303 [9].
\- The common aspect of the two solutions is to use a new 5G DDNMF entity to
manage the dynamic ProSe Direct Discovery. Functionalities of the 5G DDNMF and
the interactions with the UEs are similar to that of the DDNMF defined in TS
23.303 [9].
Following criteria are for comparison the pros and cons of the CP based or UP
based DDNMF architecture.
Table 7.1-1: Comparison of the CP based or UP based DDNMF architecture
+----------------------+----------------------+----------------------+ | | CP based solution | UP based solution | +======================+======================+======================+ | Complexity on | Does not require UE | User plane between | | solution in general | to establish user | UE and DDNMF is a | | | plane connection | need. | +----------------------+----------------------+----------------------+ | Compliant for 5GC | DDNMF is by function | DDNMF can be | | arch | an operator-control | operator-controlled | | | AF, it allows the | AF or 3rd party AF. | | | operator to allocate | It communicates with | | | network resources | UE via user plane. | | | and charge UE | | | | accordingly. | | | | | | | | DDNMF has interface | | | | with UDM, PCF, CHF | | +----------------------+----------------------+----------------------+ | Support for other KI | Solution 18 shows | The NF \"ADF\" used | | | how CP based arch | for charging support | | | work for charging | of UE usage | | | key issue. | reporting can be | | | | collocated with | | | | DDMNF on user plane. | +----------------------+----------------------+----------------------+
For key issue#1 \"ProSe Direct discovery\", for whether to use the user plane
signalling between UE and 5G DDNMF (as described in sol#3 and Annex B.2) or
control plane signalling between UE and 5G DDNMF (as described in sol#18 and
Annex B, clause B.3):
\- User plane based option can directly reuse the existing signalling protocol
over PC3 defined in TS 24.334 [20]. For control plane based option, it uses
the NAS message, and therefore requires a redesign of the protocol between UE
and the 5G DDNMF, since the XML based PC3 protocol in TS 24.334 [20] cannot be
directly used.
\- User plane 5G DDNMF option reuses the existing mechanism defined in 5GS to
establish a PDU session for the UE to access 5G DDNMF. It only requires proper
configuration of the parameter to the UE, e.g. the rules in the URSP. The
control plane option need AMF enhancement to support the operation, and also
the additional NAS layer protocols in both UE and control plane entity 5G
DDNMF.
\- Both options, the 5G DDNMF is owned by the MNO in case the discovery
service is offered by MNO, or it can be owned by the 3rd party if the
discovery service is offered by other collaborators, e.g. Public Safety
organizations, or OTT service providers.
\- User plane 5G DDNMF may and control plane 5G DDNMF can access the 5GC
services, given that the 5GC SBI and network exposure (NEF) allow them to
access the same services when operator authorizes. This applies to also the
charging support if needed.
\- As 5GS has better control of the data flows via URSP, the access to the 5G
DDNMF does not require additional configurations or ProSe Function Proxies.
The corresponding PDU sessions can be established based on the URSP control
and application differentiation.
\- User plane 5G DDNMF option allows the UE to communicate with 5G DDNMF in
the HPLMN directly, as the PC3 is protected with the design in TS 33.303 [34].
This does not expose the discovery signalling, e.g. when and what application
has requested discovery, to the VPLMN, as in the control plane 5G DDNMF
option.
## 7.2 Key Issue #2: Support for NR PC5 ProSe communication
For Key Issue #2, the following two categories of solutions are proposed:
\- ProSe communication (Solution #4, Solution #5, Solution #22 and Solution
#37).
\- ProSe QoS support (Solution #20 and Solution #21).
For ProSe communication:
\- Solution #4 focuses on PC5 group communication. It makes use of the
existing group communication mechanisms. The group managements are carried out
at application layer (e.g. using the application layer signalling with
Application Server) which is out of scope of this study item, and no changes
to the PC5 groupcast communication is needed (as indicated in clause 6.4.3).
\- Solution #5 proposes to reuse V2X communication over PC5 as baseline and
introduces a few new data unit types to be supported over the PC5 reference
points, e.g. IPv4, ARP, and Ethernet and Unstructured data types. These can be
added with proper PDCP SDU type definition. Such additions need to be
coordinated with RAN WG2.
\- Solution #22 is similar to solution #4 to optimize the group management
using application layer mechanism, and does not require changes to the PC5
communication aspects (as indicated in clause 6.22.3).
\- Solution #37 proposes that group management is performed at application
layer and proposes to reuse the Groupcast communication procedure as defined
in TS 23.287 [5] clause 6.3.2. It does not require changes to the PC5
communication.
For ProSe QoS support:
\- Solution #20 proposes to reuse QoS handling mechanism for V2X communication
over PC5 and introduces new PQI values for public safety services considering
the service requirements. The new PQI values need to be verified by RAN WGs.
\- Solution #21 proposes new PQI values for interactive services considering
latest service requirements. The new PQI values need to be verified by RAN
WGs.
## 7.3 Key Issue #3: Support of UE-to-Network Relay
For L3 UE-to-NW relay option of Key Issue #3: \"Support of UE-to-Network
Relay\", the following solutions are relevant: Sol#6, Sol#19, Sol#23, Sol#24,
Sol#25, Sol#26, Sol#27, Sol#28, Sol#35, Sol#38, Sol#40, Sol#42, Sol#43,
Sol#45, Sol#46, Sol#47, Sol#48. Among these solutions:
\- Sol#6 proposes the L3 solution for the support of UE-to-Network Relay. The
L3 Relay UE relays any IP, Ethernet, or Unstructured unicast traffic (UL and
DL) between the Remote UE and the network.
\- Sol#19, Sol#28, Sol #48 are focusing on the UE-to-Network Relay discovery.
The proposals are mainly on the information and identifiers to support the
relay discovery and the Remote UE relay selection criteria.
\- Sol#23 proposes to support end-to-end security and IP address preservation
for Remote UE traffic transmitted using Layer-3 UE-to-Network Relay using
N3IWF. The solution reuses the design of \"untrusted non-3GPP access to 5GC
via N3IWF\" in clause 4.2.8 of TS 23.501 [6] or \"Access to PLMN services via
stand-alone non-public networks\" in clause 5.30.2.7 of TS 23.501 [6]. The
Remote UE follows the handover of a PDU Session procedure between 3GPP and
untrusted non-3GPP access as defined in TS 23.502 [8] clause 4.9.2.1 and
clause 4.9.2.2 when the Remote UE moves between a direct network communication
and an indirect communication path.
\- Sol#24, 25, 45 focuses on the solutions to support end-to-end QoS for
Remote UE connected to network via L3 UE-to-NW relay with or without N3IWF.
Both static QoS mapping support and dynamic QoS handling solutions are
discussed in Sol#24 and Sol#25 for L3 UE-to-NW relay without N3IWF case. In
Sol#45, for QoS configuration for L3 UE-to-NW relay with N3IWF case, Remote UE
derives PC5 QoS parameters for the PC5 link based on the Additional QoS QoS
parameters from the N3IWF and the mapping between 5QI and PQI provisioned by
PCF, and Relay UE derives the QoS parameters for Uu link based on the PC5 QoS
parameters.
\- Sol#26 provides the URSP rules changes to provide the policy control
information to assist the Remote UE select a L3 route with or without N3IWF or
L2 route among the different communications paths for an application/service.
\- Sol#27 proposes to support secondary authentication of the Remote UE to let
the application server in DN to authorize Remote UE to access the services
using the PDU session of the L3 UE-to-NW relay via PC5 link.
\- Sol#28, Sol#38, Sol#42 discusses about the Relay PDU Session parameters
that the Remote UE includes in the PC5 Connection setup messages and the Relay
UE derive the Relay PDU Session parameters from URSP.
\- Sol#16, Sol#35 focuses on the procedures related to Relay service
authorization and policy/parameter provisioning to Remote UE and Relay UE and
the policy parameters required for relay operation.
\- Sol#40 proposes the provisioning of dedicated/shared relay session
indication to the Remote UE and Relay UE and the support of network controlled
Remote UE authorization for the Remote UE to use the PDU Session of Relay UE
for the Dedicated/Shared Relay PDU Session.
\- Sol#43 proposes an alternative option to Sol#6 to establish the PC5
connection by reusing the Layer-2 link establishment procedure defined in TS
23.287 [5] clause 6.3.3.1, in which standalone discovery procedure is not
needed and implicit UE-to-Network Relay discovery is embedded into the Direct
Communication procedure. Both UE oriented and Relay Service Code oriented
procedures are proposed in this solution.
\- Sol#46, 47 discuss about solutions to support network controlled Remote UE
and Relay UE authorization to allow the UE access 5GC via L3 relay
\- Solution #27 is based on Solution #6 and provides a mechanism to support
secondary authentication. If secondary authentication is not performed, the
application layer may not provide service to the UE because the application
layer behaviour should be the same regardless of whether a UE is connected via
ProSe 5G UE-to-Network Relay or directly connected to 5GC. Based on this
observation, Solution #27 needs to be supported on top of Solution #6.
Following are analysis of L2 Relay solution:
\- Sol#7 describes the L2 Relay, including registration and connection
management, path selection, mobility restrictions, connection establishment,
QoS handling, paging and security. The Remote UE accesses RAN via a UE-to-
Network Relay UE using RAN specified L2 relay method. The data of Remote UE is
protected by PDCP layer between the Remote UE and the RAN. QoS parameter
splitting for PC5 QoS parameter and Uu QoS parameter is performed by RAN, with
the knowledge of Uu and PC5 interface, and without any impact on CN. For
paging, it proposed the concluded solution in clause 6.6.2 of TR 23.733 [26]
can be reused.
\- Sol#29 describes path switch with high-level procedure and an AS related
procedure will be defined in RAN. Similar to handover, lossless service
continuity will be achieved by using the continuous PDCP SN.
\- Sol#19 proposes the procedure of Relay Discovery and Selection, including
Model A and Model B. A Remote UE performs relay selection based on the relay
related discovery parameters.
\- Sol#41 proposes Relay selection based on PLMN selection in the NAS layer of
the Remote UE. PLMN selection behaviour in the NAS layer of the Remote UE
follows the existing mechanism. The solution is only applicable for RAN
sharing case and assumes inter-PLMN agreements for Relay service. It is not
clear whether this solution can be used for general case, i.e. non-RAN sharing
case.
\- Sol#16 and Sol#35 proposes PCF based service authorization and
provisioning, similar to the V2X mechanism. Compared with Sol#16, Sol#35 also
provides the policy update mechanism and authorization information
provisioning to RAN from the AMF.
\- Sol#30 proposes the authorization of the UE-to-Network Relay UE and the
Remote UE. The core network, such as the PCF authorizes, whether the Remote UE
can access to the network via the specific Relay UE.
\- Sol#44 proposes QoS parameter splitting for PC5 QoS and Uu QoS parameters
in the CN. This will involve some impacts to the CN, since Remote UE\'s CN
such as Remote UE\'s SMF or PCF needs to know that the Remote UE accesses the
network via an indirect network connection. In Sol#7, QoS parameter splitting
is performed by RAN. Since RAN has the knowledge of Uu and PC5 interface
aspects, such as link quality and available resource, RAN can make more
informed and better QoS parameter splitting choices. So QoS parameter
splitting in RAN will be selected.
## 7.4 Key Issue #4: Support of UE-to-UE Relay
For Key Issue #4: \"Support of UE-to-UE Relay\", based on Table 6.0-1,
solutions that are relevant to Layer-3 UE-to-UE Relay include Solution#8, #10,
#11, #31, #32, #33, #36, #49, #50.
These solutions can be summarized and evaluated as the following:
\- Sol#8 proposes to an efficient way of UE-to-UE relay discovery and
selection. The solution proposes to use \"relay_indication\" to extend the
reachability of the Direct Communication Request or Solicitation message, thus
the source UE can discovery the target UE(s) via the relays. The proposed
method can be applied in either Model B discovery or PC5 unicast link
establishment procedure. The solution enables target UE to select relays and
source UE to select relay path or direct path, furthermore it does not require
the UEs and relays to maintain their neighbour lists.
\- Sol#10 proposes a Layer-3 UE-to-UE relay solution based on IP routing. In
the solution, a UE-to-UE relay is responsible for allocating IP addresses to
the UEs connected to it. The solution proposes Model A based relay discovery
that the relay announces itself to its proximity, the UEs need to setup PC5
links to all relays in proximity order to discovery other UEs or be discovered
via DNS queries. The solution proposes hop-by-hop based QoS handling to
achieve E2E QoS requirement, as well as IP encapsulation to handle Non-IP
traffic. The UEs should keep the PC5 link with the Relay UE in order to
discovery other UEs or be discovered. IPSec is used for end-to-end security
protection between source UE and target UE, and this shall be co-ordinated
with SA WG3.
\- Sol#11 tries to support both Layer-2 and Layer-3 UE-to-UE relaying for
Public Safety use case. The proposed discovery solution is based on clause
6.1.2.4 in TR 23.713 [14] which contains both Model A and Model B discovery.
The discovery solution requires the UEs and relays to periodically perform
group discovery to maintain their neighbour list. In Model A discovery, the
relay broadcast it neighbour list in the announcement message whereas in Model
B discovery the source UE sends Solicitation message to discover which relay
can reach the target UE.
\- Sol#31 focuses on the procedures to support end-to-end QoS for both L3 and
L2 UE-to-UE relay solutions. Whether the solution is applicable to Layer-2 UE-
to-UE relay needs to be confirmed by RAN WG2.
\- Sol#32 focus on IP based Layer-3 UE-to-UE relaying. It proposes to use
link-local IPv6 address as Remote UEs IP address for communicating via a L3
UE-to-UE relay. The relay UE maintains a mapping between link-local IPv6
addresses to UE IDs (e.g. Application Layer IDs), as well as mapping from an
IP address to a PC5 unicast link, for supporting relaying at L3. The solution
also supports IP session continuity for path switching between two UE-to-UE
relays.
\- Sol#33 proposes that the network can assist UEs for UE-to-UE relay
discovery and selection when the UEs are in coverage. The proposed solution
uses locations of UEs and relays to make decisions of relay selection and path
switching which makes its applicability debatable.
\- Sol#49 provides a solution to handle non-IP traffic by Layer-3 UE-to-UE
relay without IP encapsulation. As the IP headers are not present, the
solution proposes to generate and maintain a mapping between the relay L2-ID
and a pair of source and target UEs at the relay UE. For end-to-end security
for Non-IP traffic, IPsec cannot be used, and how to handle this shall be co-
ordinated with SA WG3.
\- Sol#50 focus on UE-to-UE relay reselection. It proposes that the Source UE
or Target UE can initiate the relay reselection procedure and then the two UEs
can negotiate UE-to-UE Relay reselection using the existing relay connection.
The following are analysis of the L2 UE-to-UE Relay solution:
\- Sol#9 proposes the procedures of connection establishment and connection
management, and the protocol stack for L2 UE-to-UE Relay. The UE-to-UE Relay
uses the identity information of UE in the Adaption Layer for data forwarding
between Source UE and Target UE. An extended unicast link is established
between Source UE and Target UE, with the end-to-end security in PDCP layer.
Both non-IP traffic and IP traffic are supported. Sol#9 has some dependency on
the design of RAN specified solution and may be updated based on the RAN2
agreement. For example, how the UE-to-UE Relay forwards the data message and
end-to-end PC5-S message between Source UE and Target UE depends on RAN
specified L2 relay method. How the Adaptation Layer is configured and
established on the UE-to-UE Relay needs to be established in cooperation with
RAN WGs.
\- Sol#8 proposes the procedure of Relay discovery and selection, where the
Relay discovery and selection are integrated into the PC5 unicast link
establishment procedure or performed during Model B discovery. The integrated
solution does not need the standalone discovery and is more efficient, by
following the R16 V2X mechanism. In Sol#8, the Source UE adds a relay
indication in the DCR message or Solicitation message to indicate whether a
UE-to-UE Relay may be used. Target UE performs the UE-to-UE Relay selection.
The Target UE may establish an indirect and a direct communication path with
the Source UE. Source UE performs the path selection between the direct path
and indirect path.
\- Sol#11 proposes the Relay discovery within the group members using Model A
and Model B. However, the solution is limited to the Relay discovery within
the group members. Sol#11 also proposes a new frame format, where the new
fields Relay Layer-2 ID and Direction are added. This new frame format has
significant impacts on Source/Target UEs and Relay UE, and the feasibility
should be evaluated by RAN WGs.
\- Sol#31 provides the QoS control mechanism with E2E QoS parameter division
by the UE-to-UE Relay. After the PC5 QoS parameters splitting for two PC5
links, the AS layer configurations for PC5 QoS parameters in each of the PC5
links can be achieved according to legacy mechanisms in Rel-16 V2X. How the
UE-to-UE Relay transfers the data to support the QoS enforcement depends on
RAN specified L2 relay method.
\- Sol#33 proposes Relay selection mechanisms. The core network assists Relay
discovery and selection based the relative location between the UEs. Sol#33
has the impact on both UE and core network, and does not apply to out of
coverage case.
\- Sol#36 proposes PCF based service authorization and provisioning for UE-to-
UE Relay Service. And it has been concluded in clause 8.8.
\- Sol#50 proposes the Relay reselection mechanism, by the negotiation between
Source UE and Target UE via the existing Relay connection. Source UE sends the
candidate Relay UEs to Target UE over the extended unicast link. Target UE
selects a new Relay UE from the candidate Relay UEs. A new extended unicast
link is established between the peer UEs via the new Relay UE. The radio
criteria on Relay reselection is decided by RAN2. Actually, Sol#8 could be
also used for UE-to-UE Relay reselection. However, it will cause the Relay UEs
in proximity to broadcast the relay discovery message or DCR message. Under
some cases, these broadcast messages can be avoided, by Source UE and Target
UE negotiating the relay reselection using the existing relay connection. For
example, Source UE and Target UE may receive relay discovery messages from the
other UE-to-UE Relays using Model A. Then Source UE or Target UE finds that
the new Relay UE can provide better signal quality than the old Relay UE.
Thus, Sol#50 and Sol#8 can be used for UE-to-UE Relay reselection under
different conditions. If Source UE or Target UE has the knowledge on some new
Relay UEs can provide better signal quality than the old Relay UE, then Sol#50
can be used. Otherwise, Sol#8 can be used.
## 7.5 Key Issue #5: Support direct communication path selection between PC5
and Uu
For Key Issue #5 (Support direct communication path selection between PC5 and
Uu):
\- Solution #12: \"Policy based network-assisted Path Selection\"
\- Solution #12 proposes that the path selection policy rules are determined
by PCF based on triggers:
\- by the PCF (as described in clause 6.2.2 in TS 23.287 [5])
\- by the UE (as described in clause 6.2.4 in TS 23.287 [5]),
\- by the AF (as described in clause 6.2.5 in TS 23.287 [5]).
\- Solution #12 also proposes policy rules update based on:
\- existing QNC notifications from RAN as defined in TS 23.501 [6]
\- or existing analytics information from NWDAF as defined e.g. in clauses
6.6, 6.8, 6.9 in TS 23.288 [24]
\- or AF request based on topology formation or changes observed (criteria
outside of the scope of SA WG2).
In this solution, AF can receive and forward RAN QNC notifications and/or
NWDAF analytics to the PCF.
\- To simplify the procedure, QNC Status update and analytics notification
(and similarly any group information update) can be stored into a selected UDR
instance. The UE Policy PCF can be configured to subscribe to receive either
notifications from UDR.
\- PCF may combine multiple sets of QNC Status update and/or analytics
notifications (or other updates from AF) before inferring how to update the
path selection policy per UE.
\- Solution #12 has impact on PCF, AF and UDR
\- Solution #51: \"Provisioning policy based path selection between PC5 and
Uu\" proposes two options for PCF to provide the path selection policy to the
UE.
\- Option 1 defines the mapping between ProSe service type/Application ID to
PC5 reference point or Uu interface and proposes this mapping is included in
the service authorization provisioning policy/parameter (e.g. Solution#17 for
KI#8) to the UE.
\- Option 2 proposes to enhance URSP rule by extending \"Non-Seamless Offload
indication\" indication or adding a new indication for PC5 reference point.
## 7.6 Key Issue #6: Support direct communication path switching between PC5
and Uu
This key issue is not addressed within Rel-17 timeframe.
## 7.7 Key Issue #7: Charging for PC5
Clause 6.0 identifies Solutions #13, #14, #15, #18 and #34 as charging
related. Candidate Solutions #13, #14, #15 and #34 rely on UE action to report
PC5 data transfer. Candidate Solution #18 provides network detected charging
information on ProSe discovery and ProSe Code but cannot report PC5 data
usage.
Solution #13 involves UE reporting Data transfer on PC5 to SMF over NAS. If
there is an existing PDU session, the UE sends the SMF a NAS message with PC5
usage information report using the PDU session that is associated with the
ProSe service based on the operator\'s policy. If there is no existing PDU
session, the UE initiates a PDU session establishment procedure using a DNN
and/or S-NSSAI pre-configured in the UE for the 5G ProSe service, and then
sends the SMF a NAS message with PC5 usage information report.
Solution #14 is incomplete as it only shows a very high-level principle by
which the Remote UE is responsible for collecting PC5 data transfer
information. The reporting of this data to the network refers to other
candidate solutions.
Solution #15 involves UE reporting Data transfer on PC5 to AMF over NAS (UL
NAS TRANSPORT). This solution leaves the PC5 data reporting criteria UE
implementation specific, which is not practical as the generation of charging
information should be predictable and thus strictly specified. Delivery of
charging policy to the UE is missing in this solution.
Regarding to the usage reporting from the UE, Solution #13 and #15 are control
plane based solutions, and the main difference is that the UE sends the SMF in
Solution #13 and the AMF in Solution #15 a NAS message with PC5 usage
information report.
Solution #18 involves event-based charging and relies on the Remote UE having
to obtain ProSe Code from the network. Discovery procedures can be charged,
but the UE-to-UE direct communication PC5 data usage cannot be obtained via
this Solution. The main part of Solution #18 is about Discovery procedures, so
the need and usability of this procedure depends on the conclusion on
discovery solution.
Solution #34 involves UE establishing PDU session for PC5 data usage reporting
using the parameters obtained from URSP. The PC5 Data Transfer is reported to
ADF/CTF over user plane, meaning PDU Session Establishment is pre-requisite to
reporting of charging information. This implies that ADF/CTF entity would be
exposed to UE. Solution #34 is a user plane based solution, which introduces a
new ADF/CTF node to the system.
Key issue#7 \"Charging for PC5\" has the following solution proposals: Sol#13,
Sol#14, Sol#15, Sol#18, Sol#34. Among Sol#13, Sol#14, Sol#18, Sol#34, it is
commonly proposed to use the PCF to provision the UE on the usage reporting
configurations.
**_Control Plane vs User Plane:_**
The main motivation of UP approach seems to be the possibly large size of the
PC5 usage data by referring to the charging fields in TS 32.277 [13].
Additionally, UP approach can reuse the protocol defined in TS 24.334 [20] for
PC3ch reference point.
The UP approach requires the UP entity ADF/CTF to be allowed to access CHF via
the service based interface Nchf.
NOTE: In some systems, the reporting interval can be set long, e.g. every 1h
(when the UE becomes in-coverage), if there is no requirement of timely report
. In addition, UE\'s PC5 usage can be designed to reduce some overlapping
information in subsequent reporting, if deemed suitable by SA WG5.
**_AMF vs SMF vs DDNMF:_**
For Sol#15 (AMF approach), AMF based charging is already event based, and
transferring UE reported PC5 charging data means one more event is to be
supported. AMF can pass in a container the info received from the UE as is to
the CHF, and the CHF can handle it e.g. using data type \"string\" as
specified in TS 32.291, but this should be left to SA WG5. Note also that AMF
approach does not require PDU Session setup.
For Sol#13 (SMF approach), UE reported PC5 charging requires support of event-
based charging. SMF approach requires separate PDU Session setup for the
purpose of reporting PC5 charging data but the charging data is still sent via
control plane.
However, for Sol#15 and Sol#13, either the AMF/SMF or the CHF needs to be
enhanced to process the usage report from the UE in order to generate the
charging event. Additionally, the signalling protocol over NAS to carry the
usage report from UE to the AMF/SMF or CHF needs to be redesigned as PC3ch
cannot be used directly.
For Sol#18 (DDNMF approach), DDNMF is intended for discovery purpose,
extending it for PC5 usage reporting handling requires additional
enhancements. The same impacts as introduced by Sol#15 and Sol#13 apply to the
5G DDNMF.
Charging support for direct discovery depends on conclusion on key issue #1.
Charging architecture is under SA WG5 control, so SA WG2 is expected to rely
on SA WG5 expertise before taking final conclusion on 5G ProSe charging.
## 7.8 Key Issue #8: Support of PC5 Service Authorization and Policy/Parameter
Provisioning
Key issue#8 \"Support of PC5 Service Authorization and Policy/Parameter
Provisioning\" has the following solution proposals: Sol#1, 2, 7, 16, 17, 30,
35 and 36, while solution #7, 16, 30, 35 and 36 are either UE-to-UE relay
related or UE-to-Network relay related, so the solutions for KI#8 not related
to relay aspects are: Sol#1, 2 and 17.
Following are analysis of the solutions for KI#8 not related to relay aspects:
\- Sol#1 (PCF based) only addresses a small set of 5G ProSe direct discovery
parameters, which are incomplete; and furthermore, the ProSe direct
communication related policy and parameters are not addressed.
\- Sol#2 (PCF based) claims that it reuses eV2XARC defined parameters in TS
23.287 [5] with replacing some terms, but the so-call addition (i.e. ProSe
Application) need to be further determined whether standardization of ProSe
Application is needed. But V2X didn\'t specify any policy and parameters
related to PC5 discovery aspect, the simple replacement of terms used in TS
23.287 [5] doesn\'t seem to work.
\- Sol#17 (PCF based) reuses the eV2XARC defined policy and parameters for PC5
communication and addresses the policy and parameters related to ProSe direct
discovery as well.
Based on the above analysis, it is clear that the common aspects among the
three solutions are PCF based and ProSe direct discovery parameters, while
solution #17 also covers the potential enhancement to PCF based procedures and
the ProSe direct communication related policy and parameters. Solution #17 is
complete from a solution addressing KI#8 non-relay aspects. Any missing
parameter in solution #17 can be added based on final conclusion of KI#1 and
KI#2.
Solution #7, 16, 30 and 35 are claimed to be UE-to-Network relay related,
following are analysis of the solutions for KI#8 on UE-to-Network Relay
aspects:
\- Sol#7 (PCF based) mainly focuses on overall Layer 2 UE-to-Network Relay
aspects and doesn\'t address 5G ProSe direct discovery and communication
related policy and parameters.
\- Sol#16 and 35 (PCF based) works for both Layer 2 and Layer 3 UE-to-Network
Relay, illustrates the enhancement to the PCF based UE Policy provisioning
procedures, defines the Policy and parameters provisioned to PCF. The two
solutions look similar, but solution #35 provides more detailed description on
the enhancement to the PCF provisioned policy procedure and addresses more
parameters (e.g. QoS mapping rules on UE-to-Network Relay UE). For the open
issue in Solution #35 on \"how to provision and update the policy to a Remote
UE via Layer 3 Relay not using N3IWF is FFS\", it depends on the final
conclusion of KI#3 for Layer 3 UE-to-Network Rely (e.g. whether the 5GC needs
to be aware whether the Remote is registered to which Relay UE), this aspect
can be further discussed and updated.
\- Sol#30 (PCF based) addresses the Layer 2 UE-to-Network Relay authentication
and authorization procedure, which is for KI#3 and not relevant to KI#8.
Based on the above analysis, it is clear that the common aspects among the
four solutions are PCF based, while solution #35 covers the potential
enhancement to PCF based procedures and describes the complete ProSe direct
discovery and communication related policy and parameters for enabling UE-to-
Network Relay, this solution works for both Layer 2 and Layer 3 UE-to-Network
Relay. Solution #35 is complete from a solution addressing KI#8 on UE-to-
Network Relay aspects. Any missing parameter in solution #35 can be added
based on final conclusion of KI#3.
Following is analysis of the solutions for KI#8 on UE-to-UE Relay aspect:
\- Sol#36 is the only solution for KI#8 on UE-to-UE Relay related aspect,
applies to both Layer 2 and Layer 3 UE-to-UE Relay and reuses the PCF based
Policy and parameters provisioning procedures with some necessary enhancement,
both Remote UE and UE-to-UE Relay are provisioned the authorization Policy and
parameters.
Based on above analysis, solution#36 is a complete solution for KI#8 on UE-to-
UE Relay aspect, further update on the solution#36 for Layer 2 and Layer 3
Relay aspects can be applied according to the conclusion on KI#4 for Layer 2
and/or Layer 3 relay mechanism.
# 8 Conclusions
Editor\'s note: This clause will list conclusions that have been agreed during
the course of the study item activities.
## 8.1 Key Issue #1: ProSe Direct discovery
For Key Issue #1 (ProSe Direct discovery), the following aspects are
concluded:
\- For discovery procedure over PC5 for commercial services and public safety,
both model A and model B as defined in TS 23.303 [9] are recommended to be
standardized.
NOTE 1: Mechanism for discovering a UE-to-Network Relay and UE-to-UE Relay can
be concluded in KI#3 and KI#4.
\- PC5 communication channel is used to carry the discovery message over PC5
and discovery message over PC5 is differentiated with other PC5 messages by AS
layer. The discovery message is taken as new signalling in ProSe layer
separately from PC5-S signalling. ProSe layer indicates to AS layer whether
the signalling is discovery message or PC5-S signalling.
\- Whether and how to transmit metadata in discovery message depends on the
size of the discovery message, it needs to be confirmed by RAN WG.
Regarding group discovery/management to support on demand-based group
communication for commercial services, the following conclusions are made:
\- The group discovery/formation/management can be carried out in the
Application Layer in coordination with Application Server.
\- Application layer signalling between the UE and the Application Server is
out of scope of this study and normative work is not needed.
\- Regarding how the Application layer discovery messages are exchanged over
PC5 reference point between UEs:
1) The Application layer discovery messages can be exchanged by using PC5
direct communication same as V2X services (i.e. Application Layer discovery
messages are considered as user traffic); or
2) The Application layer discovery messages can be exchanged by using PC5
direct discovery including a transparent container (i.e. PC5 discovery message
format e.g. defined in Solution#3 is used but only a transparent container IE
is needed as IE in the discovery message).
Which one between 1) and 2) is appropriate will be decided during the
normative phase based on the protocol stack and the message structures/formats
to be defined for PC5 direct discovery. If 1) is taken, no normative work is
needed while 2) is taken, a transparent container IE needs to be defined to
include the Application layer discovery message in the PC5 direct discovery
message in a transparent manner.
For dynamic ProSe Direct Discovery:
\- 5G DDNMF in the 5GS is used for ProSe Discovery Code management (including
allocation, and resolution).
\- Adopt the architecture of Annex B.2 option 1 as the reference architecture,
and reuse the PC3 procedures defined in TS 23.303 [9] clause 5.3 for UE and 5G
DDNMF interactions.
\- ProSe code management may additionally be done over the PC1 reference
point. The functionality of PC1 is not defined by SA WG2.
Regarding group discovery/management to support public safety, the following
conclusion is made:
\- Pre-configured or provisioned information can be used for the ProSe Direct
Discovery procedure as specified in TS 23.303 [9] clause 5.3.7 (Direct
Discovery for Public Safety use). However, usage of the PC5-D protocol stack
for direct discovery in clause 5.3.7 of TS 23.303 [9] is excluded as it is
concluded above to use the PC5 communication channel to carry the discovery
message over PC5 (Refer to NOTE 2). The pre-configured or provisioned
information are expected to be concluded in KI#3 and KI#8.
The following information elements are included in the discovery messages:
\- Type of Discovery Message (e.g. Model A Announcement, Model B Solicitation
or Response, Group member discovery, or Relay discovery) as defined in TS
23.303 [9];
NOTE 3: Encoding of the type information will be determined by stage 3 in CT
WG1.
\- Destination Layer 2 ID as defined in TS 23.303 [9];
\- Source Layer 2 ID as defined in TS 23.303 [9];
NOTE 4: Source L2 ID and Destination L2 ID are carried in the Access Stratum
headers as captured in RAN specification.
\- Discovery Group ID as defined in TS 23.303 [9];
\- ProSe Discovery Code (including ProSe Application Code, ProSe Restricted
Code, ProSe Query Code, ProSe Response Code) as defined in TS 23.303 [9];
\- ProSe Application ID: as defined in TS 23.303 [9];
\- User Info ID (including Announcer Info, Discoverer Info, Target Info,
Discoveree Info) as defined in TS 23.303 [9];
\- Security protection element;
NOTE 5: Details of Security protection element will be determined by SA WG3.
\- Relay Service Code(s).
NOTE 6: Relay Service Code can be provisioned in ME from PCF (DPF
functionality is covered by PCF) or configured in the UICC, as concluded in
KI#8, or provided by the application server. Whether the application server is
under authorization control of 5GC can be determined during normative phase.
NOTE 7: The definition of Relay Service Code will be determined during
normative phase.
The size of contents of the discovery messages and which ones of the above
information elements are optional or mandatory should be determined in
normative phase by stage-3 groups.
## 8.2 Key Issue #2: Support for NR PC5 ProSe communication
For Key Issue #2 (Support for NR PC5 ProSe communication):
\- Regarding ProSe direct communication, it is concluded to support the
mechanism defined in TS 23.287 [5] clause 5.2 with the following the new data
unit types (including IPv4, ARP, Ethernet and Unstructured) identified in
Solution#5 (clause 6.5) by coordinating with RAN WGs.
\- Regarding PC5 QoS support, it is concluded that Solution #20 in clause 6.20
and Solution #21 in clause 6.21 are taken as the baseline for normative work.
Whether the new defined PQI values can be supported needs to be confirmed by
RAN WGs.
\- The solution for ProSe direct communication described above supports both
the case of public safety and commercial service.
NOTE: Conclusions on the group discovery/management for group communication
can be found in clause 8.1.
## 8.3 Key Issue #3: Support of UE-to-Network Relay
For Key Issue #3 (Support of UE-to-Network Relay), the followings are taken as
interim conclusions:
\- UE-to-Network Relay conclusions are subject to confirmation from RAN WG2
and SA WG3 for normative work.
\- The final decision on whether or not to proceed with Layer-2 and/or Layer-3
into normative work will be made in cooperation with other WGs.
The following is taken as interim conclusions for the L3 UE-to-Network Relay
solution:
\- No showstopper has been identified by SA WG2 for L3 UE-to-Network solution.
SA WG2 recommends L3 UE-to-Network Relay proceed into normative work, subject
to RAN WG2 and SA WG3 conclusion.
\- Solution #6 is taken as baseline in case the UE-to-Network Relay is a
trusted entity by the Remote UE. Solution#23 is agreed to be used to provide
end-to-end security for the Remote UE in case the UE-to-Network Relay is not a
trusted entity by the Remote UE.
\- For L3 Relay discovery procedure, it is proposed to adopt the standalone
discovery procedure (i.e. Model A and Model B), and, the additional
information advertised by Relay UE as described in Sol#28 as the basis for
normative work.
\- For the L3 relay operation support, Remote UE uses URSP rules to route the
traffic on suitable communication path (as described in Sol#26).
\- For the PDU Session relaying the Remote UE\'s traffic, the Relay UE can
determine PDU session parameters based on RSC requested by the Remote UE
according to the association between RSC and PDU session parameters as
described in Sol#35. The Remote UE can select the Relay UE according to the
association between RSC and PDU session parameters as described in Sol#35.
NOTE 1: Whether the associations between PDU session parameters and ProSe
Relay Service Codes are provided to Relay UE and Remote UE as ProSe
policy/parameters or as USRP rules will be decided at normative phase. Whether
Remote UE provides other assistant info for handling PDU session parameters,
e.g. PDU session requirement or Traffic descriptors to Relay UE will be
decided at normative phase. The security and privacy aspects of this procedure
will be coordinated with SA WG3.
\- Security aspects require confirmation from SA WG3.
NOTE 2: The procedures to support authentication of Remote UE and Relay UE by
the network will be determined by SA WG3.
\- For the Remote UE to use the network resources (e.g. PDU Session and
Network Slice) of the Relay UE\'s serving network, the network-controlled
authentication and authorization procedures (e.g. as proposed in Solution #40
and Solution #47) will be determined in the normative phase with coordination
with SA WG3. The alignment with the associated security procedures to
authenticate the Remote UE and Relay UE will be carried out in normative phase
via coordination with SA WG3.
NOTE 3: No dedicated solution is documented in SA WG2 for the Network Slice
Specific Authentication and Authorization (NSSAA) for a Remote UE. Whether and
how to support of NSSAA for a Remote UE will be determined by SA WG3.
\- The secondary authentication for a Remote UE (e.g. as proposed in Solution
#27) will be determined by SA WG3. The alignment with the associated security
procedures for secondary authentication of the Remote UE will be carried out
in normative phase via coordination with SA WG3.
\- For QoS handling of L3 Relay Solution associated with Solution #6,
following aspects in Solution #24 and Option #2 of Solution #25 are selected
as basis for normative work:
\- L3 Relay can be configured with the 5QIs and PQIs mapping. Based on the
mapping or, in case of a non-configured mapping of a requested QoS parameter,
based on its implementation, the L3 relay translates the Uu QoS parameters to
PC5 QoS parameters and vice versa.
\- To support the dynamic QoS handling, relay UE determines the Uu QoS
parameters and PC5 QoS parameters by taking into account the end-to-end QoS
requirements provided by remote UE based on its configured QoS mapping
information or, in case of a non-configured mapping of a requested QoS
parameter, based on its implementation, and initiates PDU session modification
procedure and L2 link modification procedure to setup corresponding QoS Flows
over Uu and PC5.
\- The SMF of the L3 Relay provides the corresponding QoS rules and flow level
QoS parameters to the L3 Relay as part of the PDU session establishment or
modification procedures as defined in TS 23.502 [8], clause 4.3.2 and 4.3.3.
Alternatively, reflective QoS control over Uu as defined in TS 23.501 [6],
clause 5.7.5.3 can be leveraged for dynamic QoS handling of Remote UE to save
on signalling between SMF and L3 Relay.
\- Based on signalled QoS rules (via SMF) or derived QoS rules (Uplink Uu via
reflective QoS), the UE-to-Network Relay may use the L2 Link Modification
procedures as defined in TS 23.287 [5], clause 6.3.3.4 to either move the
corresponding ProSe service(s) to the mapped existing PC5 QoS flow or to set
up a new PC5 QoS flow.
Editor\'s note: The radio aspects of relay (re-)selection criteria and
procedures, and service continuity for L3 U2N Relay are still under discussion
in RAN WG2 in TR 38.836 [32] and will be determined by RAN WG2.
The followings are taken as interim conclusions for the L2 UE-to-Network Relay
solution:
\- No showstopper has been identified by SA WG2 for L2 UE-to-Network Relay
solution. SA WG2 recommends L2 UE-to-Network Relay solution proceed into
normative work, subject to RAN WG2 and SA WG3 conclusion.
\- Adopt Control and User Plane Protocols as described in Annex A, with
confirmation from RAN WGs.
\- The Remote UE has a NAS connection with 5GC and Remote UE Registration and
Connection establishment/management, the related procedure in solution #7 can
be taken as baseline.
\- For Relay discovery, the standalone discovery is used, and both Model A and
Model B are supported.
\- The PLMN selection and relay selection in the remote UE, following aspects
in Solution #41 are selected as basis for normative work:
\- The Remote UE checks whether the Relay\'s PLMN is authorized for relay, and
only the authorized PLMNs are the available PLMNs for NAS PLMN selection;
\- The Remote UE selects the relay based on the selected PLMN by NAS layer.
\- For paging the concluded solution in clause 6.6.2 of TR 23.733 [26] can be
reused based on the assumption captured in clause 4.5.5.2 of TR 38.836 [32]
adopted by RAN WG2.
\- For the Remote UE accessing to the network via a specific Relay UE, the
network-controlled authorisation procedures will be determined in the
normative phase with coordination with SA WG3.
NOTE 4: It is left to RAN WG2 and to decide how to support end-to-end QoS
between the Remote UE and RAN.
NOTE 5: It is left to RAN WG2 and SA WG3 to decide the details of how to
support end-to-end security between the Remote UE and RAN.
Editor\'s note: The radio aspects of relay (re-)selection criteria and
procedures, and service continuity for L2 U2N Relay are still under discussion
in RAN WG2 in TR 38.836 [32] and will be determined by RAN WG2.
Editor\'s note: For mobility issue, SA WG2 may need further study after RAN WG
progress.
## 8.4 Key Issue #4: Support of UE-to-UE Relay
For Key Issue #4 (Support of UE-to-UE Relay), the followings are taken as
interim conclusions:
\- UE-to-UE Relay conclusions are subject to confirmation from RAN WG2 and SA
WG3 for normative work.
\- The final decision on whether or not to proceed with Layer-2 and/or Layer-3
into normative work will be made in cooperation with other WGs.
The followings are taken as interim conclusion for Layer-3 UE-to-UE relay:
\- No showstopper has been identified by SA WG2 for L3 UE-to-UE solution. SA
WG2 recommends L3 UE-to-UE Relay proceed into normative work, subject to RAN2
and SA WG3 conclusion.
\- L3 UE-to-UE relay solution can support relaying of IP and non-IP traffic.
For IP traffic, the IP addresses of the UEs can be either assigned by the
relay (as described in sol#10) or self-assigned (as described in sol#32). For
Non-IP traffic, it can be either handled via IP encapsulation or without IP
encapsulation (as described in sol#49).
\- UE-to-UE Relay discovery and selection are supported by:
\- Model A discovery (as described in sol#11);
\- Model B discovery (as described in sol#8); and
\- Integrated PC5 unicast link establishment procedure (as described in
sol#8).
\- UE-to-UE relay reselection
The relay reselection can be viewed just like redoing the relay selection as
described in Sol#8 or be performed as described in Sol#50. The reselection
criteria are to be coordinated with RAN2 WG.
\- QoS support
End-to-end QoS support for Remote UE is provided by splitting the QoS between
the two PC5 links between the source UE and target UE. QoS splitting
configuration can be provided from PCF as part of policy to both Remote UE and
Relay UE or the QoS splitting can be managed by the Relay UE based on the end-
to-end QoS needs. For QoS handling, Sol#31 can be considered as the starting
point for the normative work.
The following are taken as interim conclusions for the L2 UE-to-UE Relay:
\- No showstopper has been identified by SA WG2 for L2 UE-to-UE solution. SA
WG2 recommends L2 UE-to-UE Relay proceed into normative work.
NOTE 1: The operation procedures for supporting the L2 UE-to-UE Relay need
coordination with RAN2 to decide how the UE-to-UE Relay performs the
data/signalling routing.
\- For UE-to-UE Relay discovery, both Model A and Model B are supported. It is
recommended that Relay discovery is integrated into the PC5 unicast link
establishment procedure.
\- For QoS handling, Sol#31 can be taken as baseline.
NOTE 2: It is left to RAN WG2 to support the QoS enforcement in AS layer.
\- For Relay reselection, the negotiated UE-to-UE Relay reselection in Sol#50
and the Relay selection in Sol#8 can be used under different conditions. Both
Sol#50 and Sol#8 can be taken as baseline.
NOTE 3: It is left to RAN WG2 to decide the radio criteria on Relay
reselection.
NOTE 4: It is left to RAN WG2 and SA WG3 to decide the details of how to
support end-to-end security between the Source UE and Target UE.
## 8.5 Key Issue #5: Support direct communication path selection between PC5
and Uu
For Key Issue #5 (Support direct communication path selection between PC5 and
Uu), the followings are taken as conclusion:
\- Path selection policy is provided to the UE to indicate which path(s) is
preferred for all or specific ProSe services (i.e. PC5 preferred, Uu preferred
or no preference indicated).
NOTE: Which information is used to identify the ProSe service (e.g. Traffic
Descriptor as defined in TS 23.503 [18], Application ID) will be decided
during the normative phase.
\- The path selection policy can be (pre)configured in the UE or provided by
the PCF.
\- A path preference for ProSe Services can be provided by AF to UDR, and may
be used by PCF for path selection policy generation/update.
\- Direct usage of NWDAF analytics and/ or QNC by PCF for path selection
policy generation/update is not specified in this release.
## 8.6 Key Issue #6: Support direct communication path switching between PC5
and Uu
This key issue is not addressed within Rel-17 timeframe.
## 8.7 Key Issue #7: Charging for PC5
For key issue#7 \"Charging for PC5\", it is concluded that:
\- The PCF is used to provision the UE on the PC5 usage reporting
configuration, reusing the provisioning procedures defined in clause 6.2.2 of
TS 23.287 [5].
\- The 5G DDNMF is used for ProSe Direct Discovery charging support, and may
interact with CHF or CEF which will be specified by SA WG5.
\- The 5G DDNMF is used for ProSe Direct Communication and Public Safety
Direct Discovery charging support by receiving PC5 usage reporting from the UE
via PC3ch reference point, and may interact with CHF or CEF which will be
specified by SA WG5.
## 8.8 Key Issue #8: Support of PC5 Service Authorization and Policy/Parameter
Provisioning
For key issue#8 \"Support of PC5 Service Authorization and Policy/Parameter
Provisioning\", it is concluded that:
\- the PCF is used to provision the policy and parameters for 5G ProSe direct
discovery and communication;
\- Group Member Discovery parameters (e.g. Application Layer Group ID) can be
provided from ProSe Application Server to UE.
\- The policy and parameters including Group Member Discovery parameters can
also be provisioned in the ME or configured in the UICC.
NOTE 1: If the same parameters except Group Member Discovery parameters are
provided by different sources, the UE shall take the priority order as
described in clause 5.1.1 of TS 23.287 [5] in which V2X Application Server is
replaced with ProSe Application Server, i.e. policy and parameters provided by
PCF takes higher priority than the one provided by ProSe Application Server or
other sources. For Group Member Discovery parameters, the parameters
provided/updated by ProSe Application Server shall take precedence (higher
priority) over the same parameters provided/updated by the PCF, provisioned in
the ME or configured in the UICC.
\- Solution #17 is selected for normative work for non-relay related aspects
and can be further updated based on the concluded solution for KI#1 and KI#2.
NOTE 2: Which Network Function (e.g. 5G DDNMF or PCF) is responsible for PDUID
generation and provisioning will be decided during normative phase.
\- Solution #35 is selected for normative work for UE-to-Network Relay aspect
and can be further updated based on the conclusion for KI#3.
NOTE 3: The PCF based provisioning and update of policy and parameters to a
Remote UE using a Layer-3 UE-to-Network Relay not via N3IWF is not supported.
\- Solution #36 is selected for normative work for UE-to-UE Relay related
aspect and can be further updated based on the conclusion for KI#4.
###### ### Annex A: Layer 2 Architecture Reference Model
## A.1 Introduction
The following clauses describe the control plane and user plane protocol
stacks for supporting Layer 2 UE-to-Network Relay UE in case of 3GPP access
and Layer 2 UE-to-UE Relay UE.
## A.2 Control and User Plane Protocols for Layer 2 UE-to-Network Relay
### A.2.1 User Plane Protocol Stack
Figure A.2.1-1, illustrates the protocol stack for the user plane transport,
related to a PDU Session, including a Layer 2 UE-to-Network Relay UE. The PDU
layer corresponds to the PDU carried between the Remote UE and the Data
Network (DN) over the PDU session. The PDU layer corresponds to the PDU
carried between the Remote UE and the Data Network (DN) over the PDU session.
The SDAP and PDCP protocols are as specified in TS 38.300 [11]. It is
important to note that the two endpoints of the PDCP link are the Remote UE
and the gNB. The relay function is performed below PDCP. This means that data
security is ensured between the Remote UE and the gNB without exposing raw
data at the UE-to-Network Relay UE.
Figure A.2.1-1: User Plane Stack for L2 UE-to-Network Relay UE
The adaptation layer within the UE-to-Network Relay UE and gNB can
differentiate signalling radio bearers (SRBs) and data radio bearers (DRBs)
for a particular Remote UE. The adaption layer is also responsible for mapping
PC5 traffic to one or more DRBs of the Uu. The definition of the adaptation
layer is under the responsibility of RAN WG2.
Editor\'s note: The details of the services provided by the adaption layer is
left to RAN WG2.
### A.2.2 Control Plane Protocol Stack
Figure A.2.2-1, illustrates the protocol stack of the NAS connection for the
Remote UE to the NAS-MM and NAS-SM components. The NAS messages are
transparently transferred between the Remote UE and gNB over the Layer 2 UE-
to-Network Relay UE using:
\- PDCP end-to-end connection where the role of the UE-to-Network Relay UE is
to relay the PDUs over the signalling radio bear without any modifications.
\- N2 connection between the gNB and AMF over N2.
\- N11 connection AMF and SMF over N11.
The role of the UE-to-Network Relay UE is to relay the PDUs from the
signalling radio bearer without any modifications.
Figure A.2.2-1: Control Plane for L2 UE-to-Network Relay UE
Editor\'s note: The Remote UE behaviour at the RRC layer is FFS in RAN WG2.
## A.3 Control and User Plane Protocols for Layer 2 UE-to-UE Relay
### A.3.1 User Plane Protocol Stack
Figure A.3.1-1 illustrates user plane protocol stacks using a UE-to-UE Layer-2
Relay. As for the user plane, the security is established end to end between
UE1 and UE2. Therefore, user data is never exposed at the relay node since the
relay function does not process/apply any security on the relayed packets.
Figure A.3.1-1: End-to-End User Plane protocol stacks using a Layer-2 UE-to-UE
Relay
Both IP traffic and Non-IP traffic are supported.
The SDAP and PDCP protocols above are as specified in TS 38.300 [11].
### A.3.2 Control Plane Protocol Stack
Figure A.3.2-1 illustrates control plane protocol stacks using a Layer-2 UE-
to-UE Relay. The security is established end to end between UE1 and UE2 as
shown by the PDCP layer terminating in UE1 and UE2. Therefore, the E2E PC5-S
message between UE1 and UE2 is never exposed at the relay node since the relay
function does not process/apply any security on the relayed E2E PC5-S
messages.
Figure A.3.2-1: End-to-End Control Plane protocol stacks using a Layer-2 UE-
to-UE Relay
NOTE 1: The definition and functionalities of the Adaptation Layer are defined
by RAN WG2.
NOTE 2: Only the End-to-End control plane protocol stack is shown in Figure
A.3.2-1. The control plane protocol stack of the unicast link between UE1/UE2
and UE-to-UE Relay can re-use the regular PC5-S protocol stack defined in
clause 6.1.2 in TS 23.287 [5].
NOTE 3: Both per-hop PC5-S message and E2E PC5-S message are supported. The
E2E PC5-S message is the message transferred between UE1 and UE2, and the per-
hop PC5-S message is the message transferred between UE1 and UE-to-UE Relay or
between UE-to-UE Relay and UE2. How to differentiate them depends on RAN
solution. Whether the same pair of source and destination Layer-2 IDs is used
for per-hop and E2E PC5-S messages is to be determine during SA WG2\'s
normative phase and it\'s feasibility is to be confirmed by RAN2.
###### ### Annex B: Architecture Reference Model for 5G ProSe Direct Discovery
## B.1 Introduction
The following clauses describe the control plane based and user plane based
architecture for supporting 5G ProSe Direct Discovery.
## B.2 User Plane based Architecture
### B.2.1 Description
This architecture proposes to adopt necessary function of ProSe Function as
defined in TS 23.303 [9] into 5G system architecture. According to TS 23.303
[9], Direct Discovery Name Management Function (DDNMF) and Direct Provisioning
Function (DPF) of ProSe Function are necessary to support ProSe in 5G system
architecture. DPF is used to provision the UE with necessary parameters in
order use 5G ProSe Direct Discovery and 5G Prose Direct Communication, which
can be replaced by PCF. DDNMF is used to provide following procedures over PC3
interface:
\- Discovery Request/Response Procedure: to provide IDs and filter for direct
discovery.
\- Match Report Procedure: to check direct discovery and provide mapping
information for direct discovery.
\- Announcing Alert Procedure: Support \'On-demand\' ProSe Direct Discovery in
case of ProSe restricted discovery model A.
\- Discovery Update Procedure: to update/revoke a previously allocated IDs,
filters.
5GS supports Service-Based Architecture, and DDNMF can be NF that is not only
able to interact with 5G NFs (e.g. to consume Nudm service operation) but also
connects with UE via user plane connectivity for support procedures over PC3
interface. In the architecture, it is proposed to introduce 5G DDNMF as shown
in below:
Figure B.2.1-1: The proposed 5G System Architecture for ProSe
5G DDNMF is managed by MNO.
PC1 interface between ProSe Application in UE and ProSe Application Server is
out of scope of SA WG2, and not shown in the Figure B.2.1-1.
5G DDNMF is able to consume service operation from other NFs in 5GC (e.g. Nudm
or Npcf).
Editor\'s note: Which NF\'s service operation should be used by 5G DDNMF will
be discussed with solution proposal.
PC3 interface supports Discovery Request/Response, Match Report Procedure,
Announcing Alert Procedure, and Discovery Update Procedure as following
baseline features defined in TS 23.303 [9].
NOTE: Which NSSAI or DNN to be used for user plane connectivity for PC3
interface is up to MNO\'s configuration (e.g. It can be controlled by URSP or
local configuration in the UE).
Editor\'s note: Any further enhancement or modification of PC3 procedure will
be discussed with solution proposal.
Editor\'s note: Inter PLMN or Roaming architecture is FFS (e.g. corresponding
to PC6 or PC7 in TS 23.303 [9]).
PC2 interface is used for authorization of discovery request by interaction
between 5G DDNMF and ProSe application server, as specified in TS 29.343 [12].
In the proposed architecture, there are two options to be supported as a
deployment option as following:
Option 1) 5G DDNMF as a standalone function: 5G DDNMF interacts with ProSe
Application Server via PC2 interface. Also, 5G DDNMF provides PC3 interface
towards UE. There can be multiple relationships with 3rd party application
service providers for ProSe, hence following relationship should be
considered.
Figure. B.2.1-2: Multiple relationship between 5G DDNMF and 3rd party ProSe
Application Servers
Option 2) 5G DDNMF integrated with ProSe Application Server: PC2 interface is
supported internally and the 5G DDNMF provides PC3 interface toward UE and
ProSe Application Server provides PC1 interface towards UE. 5G DDNMF is acting
as NF if it needs to consume service operation provided by other NFs in 5GS.
In this option, the PC3 interface can be replaced with application level
interactions via PC1.
## B.3 Control Plane based Architecture
### B.3.1 Description
The proposed architecture adopts the functionalities of DPF and DDNMF as
defined in TS 23.303 [9] for ProSe Function into 5G system. Similar with V2X,
PCF is proposed to take the role of DPF for policy/parameter provisioning
regarding the 5G ProSe Discovery and 5G ProSe Communication and provide/update
them via control plane. In order to align with the control plane based
parameter provisioning architecture as defined in TS 23.287 [5], 5G DDNMF is
introduced as a new NF/NF Service into 5G system to response the discovery
request, i.e. take the responsibilities of DDNMF as introduced in 4G and
provide code and filters via control plane to the 5G ProSe UEs.
The proposed architecture is as showed in Figure B.3.1-1.
Figure B.3.1-1: Control Plane based architecture
5G DDNMF is defined to support the following functionalities:
\- Support the ProSe Discovery features, e.g. ProSe Application Code
allocation, Discovery Filter(s) generation and discovery request related
parameters (e.g. Validity Timer) provisioning.
\- Inter DDNMF interaction.
\- Roaming.
\- Interface and interaction with ProSe Application Server.
\- Event based charging in ProSe Discovery.
#
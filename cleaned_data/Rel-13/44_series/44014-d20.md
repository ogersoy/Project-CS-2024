# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies for Mobile Stations (MS), for the digital
cellular communications system and Personal Communication Systems (PCS)
operating in the 900 MHz and 1800 MHz band (GSM900 and DCS1800), standardized
by 3^rd^ Generation Partnership Project (3GPP), those ME functions which are
required for conformance testing purposes only. However, except for the
Electrical Man Machine Interface (EMMI) and the Multi-slot TCH Loops, they are
required for every mobile station.
For conformance tests, functions are activated via the radio interface, test
SIM or dedicated pins. These functions must be capable of being activated when
a test SIM is present but must not function with any other (e.g. network) SIM
present except where otherwise stated within the present document. In this
state, the MS must be able to perform all functions specified in the present
document; in addition however, the special conformance testing functions must
be operational.
The special conformance testing functions of the ME are enabled by use of a
dedicated Subscriber Identity Module (test SIM, see 3GPP TS 51.010-1 Annex 4).
SIM, in general, is described in 3GPP TS 51.011. The ME recognizes the test
SIM by the Administrative Data Field.
The present document applies to the public land mobile radio service in the
GSM900 and DCS1800 systems, using constant envelope modulation and operating
on radio frequencies in the 900 and 1800 MHz bands respectively with a channel
separation of 200 kHz and carrying 8 full rate channels or 16 half rate
channels per carrier according to the TDMA principle.
The present document is part of the 3GPP TS series of technical
specifications. The present document neither replaces any of the other GSM
technical specifications or GSM related TS, nor is it created to provide full
understanding of (or parts of) the GSM900 and DCS1800 systems.
The present document applies to the unit which includes the hardware to
establish a connection across the radio interface.
## 1.1 Conventions
Unless explicitly stated otherwise, the following conventions apply:
\- \"EGPRS\" refers to \"EGPRS and EGPRS2\".
\- \"EGPRS2\" refers to \"EGPRS2-A and EGPRS2-B\".
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or non‑specific.
  * For a specific reference, subsequent revisions do not apply.
```{=html}
``` \- For a non-specific reference, the latest version applies. In the > case
of a reference to a 3GPP document (including a GSM document), > a non-specific
reference implicitly refers to the latest version > of that document _in the
same Release as the present document_.
[1] 3GPP TS 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 24.007: \"Mobile radio interface signalling layer 3; General
aspects\".
[3] 3GPP TS 44.018: \"Mobile radio interface layer 3 specification; Radio
Resource Control Protocol\".
[4] 3GPP TS 51.010: \"Mobile Station (MS) conformity specification\".
[5] 3GPP TS 51.011: \"Specification of the Subscriber Identity Module \-
Mobile Equipment (SIM - ME) interface\".
[6] (void).
[7] 3GPP TS 34.109: \"Logical Test Interface (FDD) Special conformance testing
functions\".
[8] 3GPP TS 22.101: \"UMTS Service principles\".
[9] 3GPP TS 45.010: \"Radio subsystem synchronization\".
[11] CCITT recommendation O.153 Fascicle IV.4, (Basic parameters for the
measurement of error performance at bit rates below the primary rate,
Melbourne 1988)
[12] 3GPP TS 43.064: \"Overall description of the GPRS radio interface; Stage
2\".
# 3 Definitions, conventions, and applicability
For abbreviations and acronyms, see 3GPP TS 21.905.
## 3.1 Mobile station definition and configurations
In the present document, a MS can be:
> \- a vehicle mounted station;
>
> \- a portable station;
>
> \- a handheld station;
>
> \- a vehicle mounted/portable station;
\- a vehicle mounted/handheld station.
For a more detailed description of MS-configurations, see 3GPP TS 22.101.
## 3.2 Applicability
The present document is applicable to all MSs.
# 4 Activation and deactivation of special test functions in the MS
The functions described in the present document can be activated and
deactivated from a SS by sending appropriate layer 3 commands to the MS. The
protocol discriminator to be used is defined in 3GPP TS 44.018, sub-clause
10.2.
The layer 3 commands are sent on the DCCH. On layer 2, SAPI 0 is used in
acknowledged mode.
Apart from sending the appropriate deactivation command to the MS the
functions can be deactivated by switching off the MS or removing the test SIM.
The following test functions can be activated (and deactivated):
\- TCH Loop;
\- TCH Burst-by-Burst Loop;
\- Multi-slot Loop;
\- Electrical MMI;
\- Test via DAI.
\- Reset MS Positioning Stored Information (activation only)
The TCH loops and the test via DAI are test functions which are mutually
exclusive.
# 5 Internal test loops
A number of internal test loops are required providing access to isolated
functions of the MS without introducing new physical interfaces just for the
reason of type approval testing. Fig 5-1 shows a functional block diagram of a
reference MS containing the different test loops.
NOTE: It should be emphasized that these test loops only describe the
functional behaviour of the MS with respect to its external interfaces;
physical implementation of the loops is completely left open to the
manufacturer.
A particular loop is activated in an MS by transmitting the appropriate
command message to the MS.
Figure 5: Test loops in the MS
## 5.1 Single-slot TCH loops
### 5.1.1 Purpose of Single-slot TCH loops
To establish a transparent loop for TCH blocks a TCH must be active between
the SS and MS. The TCH may be full or half rate, speech or data of any rate
specified in the GSM system.
Seven types of Single-slot TCH loop back are defined.
1: The first (A) includes the signalling of erased frames and is used to
determine Frame Erasure Ratio (FER) and Residual Bit Error Ratio (RBER) for
speech TCH and Bit Error Ratio (BER) for any data TCH.
In case of TCH/AFS, TCH/AHS, TCH/WFS, O-TCH/WFS and O-TCH/WHS, it also
includes the signalling of erased valid SID_UPDATE and RATSCCH frames and is
used to determine Erased Valid SID_UPDATE Frame Rate (EVSIDUR) and Erased
Valid RATSCCH Frame Rate (EVRFR).
2: The second type (B) is required to determine Class II bit error ratio for
the speech TCH.
3: With the third loop (C) the 114 information bits of each TCH burst
(excluding stealing flags) prior to applying benefit of the channel decoder,
but after decryption, shall be transmitted in an uplink burst. (Equivalent
error rate to TCH/FS Class II). All that is received shall be re-transmitted
regardless of the state of the received midamble. The midamble in the uplink
bursts shall be the normal midamble used by the MS. SACCH and idle bursts are
not looped back.
4: The fourth loop (D) includes the signalling of erased frames and unreliable
frames and is used to determine Unreliable Frame Ratio (UFR) and Residual Bit
Error Ratio (RBER) for TCH/HS.
5: The fifth loop (E) includes the signalling of erased SID frames and is used
to determine Erased SID Frame Rate (ESIDR) and Residual Bit Error Ratio (RBER)
for TCH/HS.
6: The sixth loop (F) includes the signalling of erased valid SID frames and
is used to determine Erased Valid SID Frame Rate (EVSIDR) and Residual Bit
Error Ratio (RBER) for TCH/HS.
7: The seventh loop (I) is required to determine frame error rate for the in-
band channel.:
  * TCH-AFS-INB FER
  * TCH-AHS-INB FER
  * TCH-WFS-INB FER
  * O-TCH/WFS-INB FER
  * O-TCH/WHS-INB FER
NOTE: Measurement of TCH/FS chip BER is approximately five times faster using
loop C rather than loop B.
### 5.1.2 TCH loop including signalling of erased frames (A)
#### 5.1.2.1 Procedure
The SS orders the MS to close its TCH loop by transmitting a
CLOSE_TCH_LOOP_CMD message, specifying the TCH to be looped and that erased
frames are to be signalled by the MS. The SS then starts timer TT01.
If no TCH is active, or any test loop is already closed, the MS shall ignore
any CLOSE_TCH_LOOP_CMD message.
If a TCH is active, the MS shall close its TCH loop for the TCH specified and
send back to the SS a CLOSE_TCH_LOOP_ACK message. Upon reception of that
message the SS stops timer TT01.
After the MS has closed its TCH loop, every good speech frame or any user data
frame received by the MS on the specified TCH (downlink) shall be taken from
the output of the channel decoder, input to the channel encoder and
transmitted on the same TCH (uplink).
In the case where TCH is TCH/FS, the MS shall loop back the 260 bits after
normal channel decoding.
In the case where TCH is TCH/EFS, the MS shall loop back the 244 bits after
normal and preliminary channel decoding.
In the case where TCH is TCH/HS, the MS shall loop back the 112 bits after
normal channel decoding.
In the case where a TCH/AFS, TCH/AHS, TCH/WFS, O-TCH/WFS or O-TCH/WHS is used,
the MS shall loop back the number of bits carried by the downlink speech
frame, after normal channel decoding.
If the channel decoder detects a bad speech frame, then this shall be
signalled to the SS by setting the input frame to the channel encoder to
zero\'s, and transmitting on the TCH (uplink).
For all TCH, except TCH/AFS, TCH/AHS, TCH/WFS, O-TCH/WFS or O-TCH/WHS, if the
MS decodes stealing flags as indicating an FACCH frame, then there is no
defined response for the MS to the channel encoder for transmission on the TCH
(uplink). The FACCH channel shall operate as normal.
The following requirements apply when TCH is TCH/AFS, TCH/AHS, TCH/WFS,
O-TCH/WFS or O-TCH/WHS:
\- The Active Codec Set (ACS) may contain between one and four codec modes.
\- When the ACS contains more than one codec mode then:
\- The MS shall ignore the downlink codec mode commands received from the SS.
\- The MS shall use for the uplink the codec mode used for the decoding of the
DL speech frame being looped back.
\- The MS shall not generate or send codec mode requests. All in band
signalling fields (Uplink CMI and CMR) shall be used to indicate the codec
mode of the looped back frame. In other words, all uplink in band signalling
codewords carry a codec mode indication.
\- The MS may change codec mode indication every uplink frame when consecutive
frames are not decoded with the same decoder, even if those frames were
associated with the same downlink CMI.
\- When looping back any of the following frame types: NO_DATA, RATSCCH,
SID_UPDATE, SID_UPDATE_INH, SID_FIRST, SID_FIRST_P1, SID_FIRST_P2 or
SID_FIRST_INH, the MS shall use the codec mode of the previous uplink frame.
\- The number of bits that the MS loops back depends on the codec mode used by
the MS to decode the downlink frame being looped back. The MS shall loop back
the bits from interface 1 (See TS 45.003 figure 1b) of the downlink channel
decoder to interface 1 of the uplink channel encoder, i.e. data delivered to
the encoding unit: d(k) for k = 0,1,...,Kd‑1. (See TS 45.003 sub-clause 2.2).
\- Frames in uplink are transmitted using TX_TYPE = SPEECH_GOOD, whatever
RX_TYPE decoded in downlink.
NOTE: The definitions of TX_TYPE and RX_TYPE are as per TS 26.093.
\- After the MS has closed its TCH loop, the parameters of every valid
SID_UPDATE frame (RX_TYPE = SID_UPDATE and BFI = 0) received by the MS on the
specified TCH (downlink), shall be taken from the output of the downlink
channel decoder, input to the uplink channel encoder, using TX_TYPE =
SPEECH_GOOD, and transmitted on the same TCH (uplink). The SID_UPDATE
parameters shall occupy the first 35 bits of the speech frame, all other bits
of the speech frame shall be set to 0.
\- For TCH/AHS or O-TCH/WHS, since a SID_UPDATE occupies two speech frames,
the expected uplink sequence shall be:
\- SPEECH (data as all zeros) followed by SPEECH (parameters from SID_UPDATE)
\- If the channel decoder detects an erased valid SID_UPDATE frame (RX_TYPE =
SID_BAD, BFI = 1), then this shall be signalled to the SS by setting the input
frame to the uplink channel encoder to zero\'s, using TX_TYPE = SPEECH_GOOD,
and transmitting on the TCH (uplink).
\- For TCH/AHS or O-TCH/WFS, each erased valid SID_UPDATE shall result in 2
SPEECH frames with all zero data sent on the uplink.
\- After the MS has closed its TCH loop, a RATSCCH message shall not be
interpreted by the MS. RATSCCH protocol shall be de-activated and the MS shall
not send any form of RATSCCH_ACKnowledgment.
\- RATSCCH data of every valid RATSCCH frame (RX_TYPE = NO_DATA (RATSCCH) and
BFI = 0) received by the MS on the specified TCH (downlink), shall be taken
from the output of the downlink channel decoder, input to the uplink channel
encoder, using TX_TYPE = SPEECH_GOOD (for TCH/AFS, TCH/AHS, TCH/WFS, O-TCH/WFS
or O-TCH/WHS), and transmitted on the same TCH (uplink). The bit content of
the RATSCCH message for TCH/AFS or TCH/WFS or O-TCH/WFS, or RATSCCH_DATA for
TCH/AHS or O-TCH/WHS shall occupy the first 35 bits of the speech frame, all
other bits of the speech frame shall be set to 0.
\- For TCH/AHS or O-TCH/WHS, since each RATSCCH_DATA must be preceded by
RATSCCH_MARKER, where 2 downlink frames are fully populated by the
RATSCCH_MARKER and RATSCCH_DATA, the expected uplink sequence shall be:
\- SPEECH (data as all zeros) followed by SPEECH (data from RATSCCH_DATA)
\- If the channel decoder detects an erased valid RATSCCH frame (RX_TYPE =
NO_DATA (RATSCCH) and BFI = 1), then this shall be signalled to the SS by
setting the input frame to the uplink channel encoder to zero\'s, using
TX_TYPE = SPEECH_GOOD (for TCH/AFS, TCH/AHS, TCH/WFS, O-TCH/WFS or O-TCH/WHS),
and transmitting on the TCH (uplink).
\- For TCH/AHS, each erased valid RASTCCH shall result in 2 SPEECH frames with
all zero data sent on the uplink.
\- If the channel decoder detects an ONSET frame (RX_TYPE = ONSET) or
SID_FIRST frame (for TCH/AFS or TCH/WFS or O-TCH/WFS only, RX_TYPE =
SID_FIRST) or a SID_FIRST_P1 frame (for TCH/AHS or O-TCH/WHS only, RX_TYPE =
SID_FIRST) or a NO_DATA frame (RX_TYPE = NO_DATA, not resulting from a
RATSCCH) then this shall be signalled to the SS by setting the input frame to
the uplink channel encoder to zero\'s, using TX_TYPE = SPEECH_GOOD (for
TCH/AFS, TCH/AHS, TCH/WFS, O-TCH/WFS or O-TCH/WHS) and transmitting on the TCH
(uplink).
\- For TCH/AHS or O-TCH/WHS, if the channel decoder detects a SID_FIRST_P2
frame or a SID_FIRST_INH or SID_UPDATE_INH frame then this shall be signalled
to the SS by setting the input frame to the uplink channel encoder to zero\'s,
using TX_TYPE = SPEECH_GOOD (for TCH/AFS, TCH/AHS, TCH/WFS, O-TCH/WFS or
O-TCH/WHS) and transmitting on the TCH (uplink).
### 5.1.3 Speech TCH loop without signalling of erased frames (B)
#### 5.1.3.1 Procedure
The SS orders the MS to close its TCH loop by transmitting a
CLOSE_TCH_LOOP_CMD message, specifying the TCH to be looped. The SS then
starts timer TT01.
If no TCH is active or any test loop is already closed, the MS shall ignore
any CLOSE_TCH_LOOP_CMD message.
If a TCH is active, the MS shall close its TCH loop for the TCH specified and
send back to the SS a CLOSE_TCH_LOOP_ACK. Upon reception of that message the
SS stops timer TT01.
After the MS has closed its TCH loop, any speech frame received by the MS on
the specified TCH (downlink) shall be taken from the output of the channel
decoder, input to the channel encoder, and transmitted on the same TCH
(uplink).
In the case where TCH is TCH/FS, the MS shall loop back the 260 bits after
normal channel decoding.
In the case where TCH is TCH/EFS, the MS shall loop back the 244 bits after
normal and preliminary channel decoding.
In the case where TCH is TCH/HS, the MS shall loop back the 112 bits after
normal channel decoding.
In the case where a TCH/AFS or TCH/AHS is used, the MS shall loop back the
number of bits carried by the downlink speech frame, after normal channel
decoding.
The SS should avoid using the FACCH downlink in this situation until the test
is complete.
All requirements defined for Loop A when TCH is TCH/AFS or TCH/AHS also apply
to Loop B, except that:
\- The content of bad speech frame is looped back and not set to all zeros
\- If the MS detects an erased valid SID_UPDATE frame (RX_TYPE = SID_BAD, BFI
= 1), on the specified TCH (downlink), the content of the received frame shall
be taken from the output of the downlink channel decoder, input to the uplink
channel encoder, using TX_TYPE = SPEECH_GOOD, and transmitted on the same TCH
(uplink). The SID_UPDATE parameters shall occupy the first 35 bits of the
speech frame, all other bits of the speech frame shall be set to 0.
\- For TCH/AHS, since a SID_UPDATE occupies two speech frames, the expected
uplink sequence shall be:
> \- SPEECH (data as all zeros) followed by SPEECH (parameters from
> SID_UPDATE)
\- If the MS detects an erased valid RATSCCH frame (RX_TYPE = NO_DATA
(RATSCCH) and BFI = 1) on the specified TCH (downlink), the content of the
received frame shall be taken from the output of the downlink channel decoder,
input to the uplink channel encoder, using TX_TYPE = SPEECH_GOOD (for TCH/AFS
and TCH/AHS), and transmitted on the same TCH (uplink). The bit content of the
RATSCCH message for TCH/AFS or RATSCCH_DATA for TCH/AHS shall occupy the first
35 bits of the speech frame, all other bits of the speech frame shall be set
to 0.
\- For TCH/AHS, since each RATSCCH_DATA must be preceded by RATSCCH_MARKER,
where 2 downlink frames are fully populated by the RATSCCH_MARKER and
RATSCCH_DATA, the expected uplink sequence shall be:
\- SPEECH (data as all zeros) followed by SPEECH (data from RATSCCH_DATA)
### 5.1.4 TCH burst-by-burst loop (C)
#### 5.1.4.1 Applicability
The test loop shall be implemented by all ME, supporting any TCH.
#### 5.1.4.2 Procedure
Establishment and clearing of the loop is performed at ideal radio conditions.
#### 5.1.4.3 Establishment
\- The establishment shall be commanded by transmitting a CLOSE_TCH_LOOP_CMD
message. The SS then starts timer TT01. This command shall be acknowledged by
the MS with a CLOSE_TCH_LOOP_ACK message. Upon receipt of that message the SS
stops timer TT01. The MS shall establish the loop within one reporting period
[SACCH-block = 104 frames] from the sending of the CLOSE_TCH_LOOP_ACK.
\- If no TCH is active or any test loop is already closed, the MS shall ignore
any CLOSE_TCH_LOOP_CMD message.
#### 5.1.4.4 Operation
The round trip delay (RTD), which is the number of TCH frames between the
reception of one burst at the MS, and the transmission of the same burst (on
the uplink) shall be less than 26 TDMA frames. The actual value shall be
declared for the implementation to be tested.
NOTE 1: The RTD can be as long as required to receive the number of
interleaved burst for the relevant TCH.
NOTE 2: Example of RTD = 5
* * *
TDMA Frame No. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 Downlink T1 T2 T3
T4 T5 T6 T7 T8 T9 T10 T11 T12 Sd ...  
Uplink ... T1 T2 T3 T4 T5 T6 T7 Su T8 T9 T10 T11 T12
* * *
Sd = Downlink SACCH frame, Su = Uplink SACCH frame, Tn = TCH frame
Note from the above that TCH frames looped back prior to the uplink SACCH (or
Idle) frame are delayed on the air interface by 5 TDMA frames, but the TCN
frames following the SACCH frame are delayed by 6 TDMA frames. The RTD is
therefore not to be confused with the TDMA frame delay for a TCH burst, which
varies depending on whether the TCH burst is before or after the uplink SACCH
frame. The reason for the variable TDMA time delay is to preserve the uplink
SACCH frame position in the multi-frame. Note also that the uplink SACCH data
is not a looped back version of the downlink SACCH data.
### 5.1.5 TCH loop including signalling of erased frames and unreliable frames
(D)
#### 5.1.5.1 Procedure
The SS orders the MS to close its TCH loop by transmitting a
CLOSE_TCH_LOOP_CMD message, specifying the TCH to be looped and that erased
frames and unreliable frames are to be signalled by the MS. The SS then starts
timer TT01.
If no TCH is active, or any test loop is already closed, the MS shall ignore
any CLOSE_TCH_LOOP_CMD message.
If a TCH different from a TCH/HS is active, the MS shall ignore a
CLOSE_TCH_LOOP_CMD message containing a request to close a Type D Loop.
If a TCH/HS is active, the MS shall close its TCH loop for the TCH specified
and send back to the SS a CLOSE_TCH_LOOP_ACK. Upon reception of that message
the SS stops timer TT01.
After the MS has closed its TCH loop, every reliable speech frame (UFI = 0)
received by the MS on the specified TCH/HS (downlink) shall be taken from the
output of the channel decoder, input to the channel encoder and transmitted on
the same TCH (uplink).
If the channel decoder detects a bad speech frame or an unreliable frame (BFI
= 1 or UFI = 1) or if the MS decodes the stealing flags as indicating an FACCH
frame, then this shall be signalled to the SS by setting the input frame to
the channel encoder to zero\'s, and transmitting on the TCH/HS (uplink).The
FACCH channel shall operate normally.
### 5.1.6 TCH loop including signalling of erased SID frames (E)
#### 5.1.6.1 Procedure
The SS orders the MS to close its TCH loop by transmitting a
CLOSE_TCH_LOOP_CMD message, specifying the TCH to be looped and that erased
SID frames are to be signalled by the MS. The SS then starts timer TT01.
If no TCH is active, or any test loop is already closed, the MS shall ignore
any CLOSE_TCH_LOOP_CMD message.
If a TCH different from a TCH/HS is active, the MS shall ignore a
CLOSE_TCH_LOOP_CMD message containing a request to close a Type E Loop.
If a TCH/HS is active, the MS shall close its TCH loop for the TCH specified
and send back to the SS a CLOSE_TCH_LOOP_ACK. Upon reception of that message
the SS stops timer TT01.
After the MS has closed its TCH loop, every valid SID frame (SID = 2) or
invalid SID frame (SID = 1) received by the MS on the specified TCH/HS
(downlink), shall be taken from the output of the channel decoder, input to
the channel encoder and transmitted on the same TCH/HS (uplink).
If the channel decoder detects an erased SID frame (SID = 0), then this shall
be signalled to the SS, by setting the input frame to the channel encoder to
zero\'s, and transmitting on the TCH/HS (uplink).
If the MS decodes the stealing flags as indicating an FACCH frame, then this
shall be signalled to the SS by setting the input frame to the channel encoder
to zero\'s, and transmitting on the TCH/HS (uplink).The FACCH channel shall
operate normally.
### 5.1.7 TCH loop including signalling of erased valid SID frames (F)
#### 5.1.7.1 Procedure
The SS orders the MS to close its TCH loop by transmitting a
CLOSE_TCH_LOOP_CMD message, specifying the TCH to be looped and that erased
valid SID frames are to be signalled by the MS. The SS then starts timer TT01.
If no TCH is active, or any test loop is already closed, the MS shall ignore
any CLOSE_TCH_LOOP_CMD message.
If a TCH different from a TCH/HS is active, the MS shall ignore a
CLOSE_TCH_LOOP_CMD message containing a request to close a Type F Loop.
If a TCH/HS is active, the MS shall close its TCH loop for the TCH specified
and send back to the SS a CLOSE_TCH_LOOP_ACK. Upon reception of that message
the SS stops timer TT01.
After the MS has closed its TCH loop, every valid SID frame (SID = 2 and BFI =
0) received by the MS on the specified TCH/HS (downlink), shall be taken from
the output of the channel decoder, input to the channel encoder and
transmitted on the same TCH/HS (uplink).
If the channel decoder detects an erased valid SID frame (SID = 1) or (SID =
0) or ((BFI or UFI) = 1)), then this shall be signalled to the SS by setting
the input frame to the channel encoder to zero\'s, and transmitting on the
TCH/HS (uplink).
If the MS decodes the stealing flags as indicating an FACCH frame, then this
shall be signalled to the SS by setting the input frame to the channel encoder
to zero\'s, and transmitting on the TCH/HS (uplink).The FACCH channel shall
operate normally.
### 5.1.7a TCH loop without signalling of erased frames for in-band channel
error rate (I)
#### 5.1.7a.1 Procedure
The SS orders the MS to close its TCH loop by transmitting a
CLOSE_TCH_LOOP_CMD message, specifying the TCH to be looped and that in-band
channel is to be signalled by the MS. The SS then starts timer TT01.
If no TCH is active, or any test loop is already closed, the MS shall ignore
any CLOSE_TCH_LOOP_CMD message.
If a TCH different from a TCH/AFS, TCH/AHS, TCH/WFS, O-TCH/WFS or O-TCH/WHS is
active, the MS shall ignore a CLOSE_TCH_LOOP_CMD message containing a request
to close a Type I Loop.
If a TCH/AFS, TCH/AHS, TCH/WFS, O-TCH/WFS or O-TCH/WHS is active, the MS shall
close its TCH loop for the TCH specified and send back to the SS a
CLOSE_TCH_LOOP_ACK. Upon reception of that message the SS stops timer TT01.
The Active Codec Set may contain between one and four codec modes.
Once the MS has closed its loop, it shall continuously transmit in uplink the
in-band bits that have been decoded in downlink. The decoded DL CMI shall be
looped as UL CMR (no downlink adaptation), and the decoded DL CMC shall be
looped as UL CMI.
NOTE: While a Loop I is active, it is expected that the SS transmit a valid
downlink signal including speech frames channel encoded according to the DL
CMI.
When the MS has closed its loop, it shall assume that the SS uses the default
transmission phase (\"odd\") for Codec Mode Indication/Codec Mode Command (see
TS 45.009), whatever the transmission phase before the loop was closed.
The MS shall always use in the uplink the codec mode resulting form the
decoding of the received Codec Mode Command. The MS shall always send a fixed
pattern of alternating 0 and 1 in the uplink direction (bits d(k) of TS 45.003
sub-clause 2.2), with the first bit of the pattern equal to a binary \"1\"
using TX_TYPE = SPEECH_GOOD, whatever RX_TYPE was decoded in the downlink.
NOTE: The definitions of TX_TYPE and RX_TYPE are as per TS 26.093.
The RATSCCH protocol shall be de-activated when Loop I is activated. The MS
shall not interpret the content of downlink RATSCCH messages. The MS shall not
send any form of RATSCCH_ACKnowledgment.
Loop I is only required to operate when Downlink DTX is not in used. There is
no requirement for in band signalling loop back when the MS decodes a
SID_FIRST, SID_FIRST_P1, SID_FIRST_P2, SID_FIRST_INH, SID_UPDATE,
SID_UPDATE_INH or ONSET frame.
Loop I is not designed to measure the performances of in-band signalling over
SID_UPDATE or RATSCCH messages.
The delays associated with Loop I remain constant for all of the following
circumstances:
\- For a given MS implementation.
\- For the duration of the MS being powered on.
\- For the duration of the activation of a TCH. The delays associated with a
full rate TCH and a half rate TCH may be different.
\- For the duration of the closure of Loop I.
If the MS decodes another type of non-speech frame (FACCH for example), it
shall send back an all zero pattern using the same codec mode as the previous
uplink frame. If the in band signalling field is supposed to carry the uplink
CMI, then this field shall indicate the uplink codec mode in use. If the in
band signalling field is supposed to carry the CMR, then this field shall be
equal to the previous uplink CMR.
The SS should avoid using the FACCH downlink in this situation until the test
is complete.
### 5.1.8 Additional non-mandatory operating characteristics for single-slot
loops
In order to optimise the speed and flexibility of mobile manufacturing and
repair, the following non-mandatory characteristics of the test loops are
suggested:
\- The normal FACCH downlink and uplink functions should ideally be maintained
when the test loop is closed. In particular, channel assignments or handovers,
and call termination from either the mobile or the base station simulator.
\- Following an assignment or handover, the loop should not open if it was
closed prior to the handover.
\- Following call dropping or deliberate call termination, the loop should be
re-opened.
\- The loopback functions should ideally operate with or without (i.e. no SIM)
the test SIM present, but should not operate with a network SIM present.
\- Audio muting should be enabled when the loop is closed.
## 5.2 Multi-slot TCH loops
### 5.2.1 Purpose of Multi-slot TCH loops
To establish a transparent loop for TCH blocks, from multiple slots, a TCH
must be active between the SS and MS.
Two types of Multi-slot TCH loop back are defined:
G: With the first loop (G) the 114 information bits of each multi-slot TCH
burst (excluding stealing flags) prior to applying benefit of the channel
decoder, but after decryption (see Figure 1), shall be transmitted in an
uplink burst. (Equivalent error rate to TCH/FS Class II). All that is received
shall be re-transmitted regardless of the state of the received midamble. The
midamble in the uplink bursts shall be the normal midamble used by the MS.
SACCH and idle bursts are not looped back.
H: The second loop (H) includes the signalling of erased frames and is used to
determine Frame Erasure Ratio (FER), Residual Bit Error Ratio (RBER) and Bit
Error Ratio (BER) for any multi-slot configuration TCH.
Each of the two loops shall support the following mechanisms:
\- The first (Multi-slot mechanism 1) is used to loop the TCH data of slot X
of the downlink onto the TCH of the main uplink slot (for HSCSD). This
mechanism is needed to cover the case where there are more downlink slots than
uplink slots.
\- The second (Multi-slot mechanism 2) is used to loop as many downlink slots
as possible to the corresponding uplink slots, based on the following rules
for HSCSD:
\- Loop back all bi-directional timeslots, and leave the unidirectional slots
not looped back. This maintains the logical association with bi-directional
timeslots.
It should be further noted:
\- The order of the data on the downlink shall be preserved on the uplink.
\- The OPEN_Multi-slot_LOOP_CMD message shall open all Multi-slot loops.
\- Assignment to a new multi-slot configuration shall be preceded by an
OPEN_Multi-slot_LOOP_CMD message to open all loops.
\- It is the responsibility of the System Simulator (SS) to ensure that the
correct configuration is enabled for the test. Test loops will be opened by
the receipt of a OPEN_Multi-slot_LOOP_CMD or by disconnecting the call. Other
behaviour, such as receiving a new TxLev or a channel assignment or handover
to a new ARFCN will not affect the test loops. The SS should ensure that a new
multislot configuration affecting an existing test loop is not included within
channel assignment, handover or configuration change commands.
\- If the Multi-slot mechanism 1 is used and a downlink slot that is not part
of the current multi-slot configuration is specified, the MS shall ignore the
command and send a negative acknowledgment. The loopback state should not
change.
\- Once a loop is closed, a further loopback command shall over-ride a
previous command - multiple CLOSE_Multi-slot_LOOP_CMD messages are not
additive.
\- Call disconnect for whatever reason shall open all loops. No OPEN_Multi-
slot_LOOP_ACK message shall be sent.
\- The multi-slot loopback is restricted to the TCH logical channel only. The
downlink and uplink FACCH and SACCH should work as if loopback did not exist.
\- The Multi-slot TCH loops are in **addition** to any Single-slot TCH loops
already specified for the type of MS.
Support of the Multi-slot loops is mandatory for any MS supporting HSCSD.
Any MS supporting the Multi-Slot loops shall activate the functions defined in
this sub-clause of the specification regardless of the presence or not of a
test SIM.
### 5.2.2 Multi-slot TCH burst-by-burst loop (G)
#### 5.2.2.1 Procedure
The establishment shall be commanded by transmitting a CLOSE_Multi-
slot_LOOP_CMD message. The SS then starts timer TT01. This command shall be
acknowledged by the MS with a CLOSE_Multi-slot_LOOP_ACK message. Upon receipt
of that message the SS stops timer TT01. The MS shall establish the loop
within one reporting period [SACCH-block = 104 frames] from the sending of the
CLOSE_Multi-slot_LOOP_ACK.
If no TCH is active or any test loop is already closed, the MS shall ignore
any CLOSE_Multi-slot_LOOP_CMD message
RTD is as the same as sub-clause 5.1.4.4.
### 5.2.3 Multi-slot TCH loop including signalling of erased frames (H)
#### 5.2.3.1 Procedure
The SS orders the MS to close its Multi-slot TCH loop by transmitting a
CLOSE_Multi-slot_LOOP_CMD message, specifying the TCH to be looped and that
erased frames are to be signalled by the MS. The SS then starts timer TT01.
If no TCH is active, or any test loop is already closed, the MS shall ignore
any CLOSE_Multi-slot_LOOP_CMD message.
If a TCH is active, the MS shall close its TCH loop for the TCH specified and
send back to the SS a CLOSE_Multi-slot_LOOP_ACK message. Upon reception of
that message the SS stops timer TT01.
After the MS has closed its TCH loop, every good speech frame or any user data
frame received by the MS on the specified TCH (downlink) shall be taken from
the output of the channel decoder, input to the channel encoder and
transmitted on the same TCH (uplink).
If the channel decoder detects a bad speech frame , then this shall be
signalled to the SS by setting the input frame to the channel encoder to
zero\'s, and transmitting on the TCH (uplink).
If the MS decodes stealing flags as indicating an FACCH frame, then there is
no defined response for the MS to the channel encoder for transmission on the
TCH (uplink). The FACCH channel shall operate as normal.
## 5.3 Deactivating loops
### 5.3.1 Deactivating Single-slot TCH loops
The SS orders the MS to open any Single-slot TCH loop by transmitting an
OPEN_LOOP_CMD message.
If no loop is closed the MS shall ignore any OPEN_LOOP_CMD message.
If a Single-slot TCH is looped, the MS shall open the loop.
If the loop opened was type C, the MS shall send an OPEN_LOOP_CMD message to
the SS with bit 0 of the optional acknowledgement element set to 1.
All channels shall be open for normal use again.
### 5.3.2 Deactivating Multi-slot TCH loops
The SS orders the MS to open any Multi-slot TCH loop by transmitting an
OPEN_Multi-slot_LOOP_CMD message.
If no loop is closed the MS shall ignore any OPEN_Multi-slot_LOOP_CMD message.
If a Multi-slot TCH is looped, the MS shall open the loop and send a
OPEN_Multi-slot_LOOP_ACK message to the SS.
All channels shall be open for normal use again.
## 5.4 Multi-slot test mode for GPRS & EGPRS
The following test mode applies to GPRS, EGPRS and EGPRS2
### 5.4.1 Initiation
#### 5.4.1.1 MS Declaration
The manufacturer shall declare the MS test mode capability before test mode
initiation. The possible declarations are as follows:
a) MS is capable of transmitting a pseudo-random data sequence in RLC data
blocks
b) MS is capable of transmitting looped-back RLC data blocks (Not applicable
to an MS in EC operation)
c) MS is capable of both a) and b).
The specifics of test mode initiation and operation depend on what capability
the MS has declared. In addition to options a), b) or c), an EGPRS MS shall
also support the EGPRS Radio Block Loopback Mode defined in sub-clause 5.5.
#### 5.4.1.2 Establishment of uplink TBF
The MS is assumed to be GPRS attached, in packet idle mode.
The SS establishes a downlink TBF on one timeslot, according to normal
procedures as defined in 3GPP TS 44.060.
The SS orders the MS into GPRS test mode by transmitting a GPRS_TEST_MODE_CMD
(Layer 3 message, SAPI 1) with parameter PDU Description set to define the
number of PDUs and number of octets within the PDUs that the MS is to transmit
in the uplink during the test. The SS then starts timer TT02.
If the MS has declared c) capability in sub-clause 5.4.1.1, then the M bit in
the GPRS_TEST_MODE_CMD message shall determine whether the MS operates the
test mode in mode a) or mode b).
This commands the MS to request the establishment of an uplink TBF, in RLC
unacknowledged mode, according to normal procedures as defined in 3GPP TS
44.060. Upon receipt of the MS request for uplink resources, the SS stops
timer TT02 and proceeds with the establishment of the uplink TBF, by assigning
a Dynamic Allocation uplink TBF or an Extended Dynamic Allocation uplink TBF.
If the MS is operating in mode a), the SS releases the downlink TBF according
to normal procedures as defined in 3GPP TS 44.060. If the MS is operating in
mode b), the downlink TBF continues throughout test mode operation.
An exception applies for an MS in EC operation (see 3GPP TS 43.064[12]) where
this commands the MS to request the establishment of an uplink TBF, in RLC
acknowledged mode, according to normal procedures as defined in 3GPP TS
44.060. Upon receipt of the MS request for uplink resources, the SS stops
timer TT02 and proceeds with the establishment of the uplink TBF, by assigning
a Fixed Uplink Allocation TBF. If the MS is operating in mode a), the SS
releases the downlink TBF according to normal procedures as defined in 3GPP TS
44.060.
The SS shall not send a new GPRS_TEST_MODE_CMD to the MS unless the currently
activated multi-slot test mode for GPRS is terminated.
When the MS has activated the multi-slot test mode for GPRS, the received RLC
data blocks (on the MS side) shall not be passed to LLC.
### 5.4.2 Operation
#### 5.4.2.1 MS Operating in mode a)
The SS sets the USF field in blocks transmitted on the downlink to address the
MS. The MS shall transmit RLC data blocks obeying USF, according to the normal
rules for transmission, as defined in 3GPP TS 44.060. An exception case is
where an MS has enabled EC operation (see 3GPP TS 43.064 [12]) in which case
the MS is not allocated resources by USF**.** In this case the SS shall
allocate resources through Fixed Uplink Allocation. The MS shall transmit RLC
data blocks obeying the Fixed Uplink Allocation(s), according to 3GPP TS
44.018, and 3GPP TS 44.060.
For the uplink the data payload of the RLC data blocks shall contain a
pseudorandom data sequence, as specified in sub-clause 5.4.4. The blocks shall
have valid MAC headers and may have valid RLC headers. The blocks shall be
processed by Layer1 in the normal manner.
Where multiple transmit timeslots are active, the same data as is carried in
the RLC data block in the first timeslot may be used in RLC data blocks
carried in subsequent time-slots. The blocks shall have valid MAC headers and
may have valid RLC headers. The blocks shall be processed by Layer 1 in the
normal manner.
#### 5.4.2.2 MS Operating in mode b)
The SS shall transmit RLC data blocks on the downlink TBF containing a
pseudorandom data sequence in the data payload of the block, as specified in
sub-clause 5.4.4. The blocks shall have valid MAC and RLC headers. The SS
shall apply the same channel coding scheme on the downlink data blocks as the
commanded coding scheme on the uplink. The blocks shall be processed by Layer
1 in the normal manner.
The SS sets the USF field in blocks transmitted on the downlink to address the
MS. The MS shall transmit RLC data blocks obeying USF, according to the normal
rules for transmission, as defined in 3GPP TS 44.060.
For the uplink, the data payload of the RLC data blocks shall contain the data
payload of the RLC data blocks transmitted on the downlink TBF. The blocks
shall have valid MAC headers and may have valid RLC headers. The countdown
procedure shall not be used for the uplink RLC data blocks (CV=15).
When RLC/MAC control blocks are received on the downlink, the MS may repeat on
the uplink the pseudorandom sequence carried in the previous uplink RLC data
blocks.
In the event where the USF field is correctly decoded but there is a CRC error
on the payload data the MS shall, if required by the USF, transmit the
received payload data.
When RLC/MAC control blocks are sent on the uplink, the MS may discard the
pseudorandom sequence that would otherwise have been transmitted at that
time.Where multiple transmit timeslots are active, and only one downlink
timeslot is active, the same data as is carried in the RLCdata block in the
first timeslot may be used in RLC data blocks carried in subsequent time-
slots. The blocks shall have valid MAC headers and may have valid RLC headers.
The blocks shall be processed by Layer 1 in the normal manner.
#### 5.4.2.3 Operational constraints applying to both modes
During test mode operation, the MS shall continue to receive RLC/MAC control
blocks sent on the downlink, and shall respond normally.
### 5.4.3 Termination
Termination of the test mode occurs for test mode operating in mode a), either
when the requested number of PDUs have been transmitted on the uplink TBF, or
when the SS initiates the TBF release. For test mode operating in mode b),
termination of test mode occurs when the SS terminates the downlink TBF, or
when the SS initiates PDCH release for the uplink TBF.
{width="4.499305555555556in" height="3.247916666666667in"}
Figure 5.4.3: Test mode termination
### 5.4.4 PN Sequence Definition
The data to be inserted into the data part of the RLC/MAC data blocks is
generated using any binary pseudorandom sequence generator with a cycle of
32,767 bits or greater (for example CCITT defined PN15, PN22 etc.).
Example test patterns may be found in CCITT recommendation O.153 Fascicle
IV.4, (Basic parameters for the measurement of error performance at bit rates
below the primary rate, Melbourne 1988).
### 5.4.5 Optional Multi-slot operation
To facilitate production tests and for other purposes, the MS may optionally
implement the following extension to this test mode.
If the downlink TBF is established on more than one timeslot, the MS shall
transmit in the second uplink timeslot (if present) RLC/MAC blocks received on
the second downlink timeslot, and shall transmit in the third uplink timeslot
(if present) RLC/MAC blocks received in the third downlink timeslot and so on.
If more transmit timeslots are present than receive timeslots, then the
contents of uplink timeslots that do not map to downlink timeslots shall be
the same as in the last timeslot that maps to downlink.
However, if the downlink TBF contains only a single timeslot the MS must fill
all uplink timeslots as defined in sub-clause 5.4.2 above.
In this description, downlink timeslots are counted from the \"Downlink
Timeslot Offset\" in the mode flag of the GPRS_TEST_MODE_CMD. For example, if
the \"Downlink Timeslot Offset\" is set to 3, TN3 shall be treated as the
first downlink timeslot if a TBF is established in TN3. If TN3 does not
support a TBF, the first active timeslot after TN3 shall be treated as the
first downlink timeslot. The counting sequence is continuous through TN7 and
TN0.
Uplink timeslots are always counted from TN0.
## 5.5 EGPRS Switched Radio Block Loopback Mode
The EGPRS Switched Radio Block Loopback mode must be supported by an EGPRS MS.
It is a Physical RF layer loopback performed before channel decoding designed
to support BER testing.
The following loopback path is used:
Figure 5.5: Loopback Mode
### 5.5.1 Initiation
The MS is assumed to be GPRS attached, in packet idle mode.
The SS establishes a downlink TBF on one timeslot, according to normal
procedures as defined in 3GPP TS 44.060.
The SS orders the MS into EGPRS Switched Radio Block Loopback Mode by
transmitting a EGPRS_START_RADIO_BLOCK_LOOPBACK_CMD (Layer 3 message, LLC SAPI
1). The SS then starts timer TT02.
This will force the MS to request the establishment of an uplink TBF, in RLC
unacknowledged mode, according to normal procedures as defined in 3GPP TS
44.060. Upon receipt of the MS request for uplink resources, the SS stops
timer TT02 and proceeds with the establishment of the uplink TBF, by assigning
a Dynamic Allocation uplink TBF or an Extended Dynamic Allocation uplink TBF.
The downlink and uplink TBF continue throughout test mode operation, as
described in 5.5.2.
After the MS has been assigned a Dynamic Allocation uplink TBF or an Extended
Dynamic Allocation uplink TBF, the SS shall start timer TT03. After this timer
expires the SS shall start to transmit radio blocks to the MS using the same
downlink resources as the existing downlink TBF. The radio blocks shall
contain a valid RLC/MAC header (addressing the MS) and an RLC data block (or
blocks) to be filled with pseudorandom data as specified in 5.4.4, or contain
an RLC/MAC control message.
When the MS has activated the EGPRS Switched Radio Block Loopback mode, any
received RLC data blocks (on the MS side) shall not be passed to LLC.
### 5.5.2 Operation
The downlink and uplink TBFs shall remain open throughout switched radio block
loopback mode operation. Timers T3180, T3182 and T3164 shall be disabled
throughout switched radio block loopback mode operation to prevent the uplink
TBF from expiring.
EGPRS Switched Radio Block Loopback mode defines two Sub-modes of operation -
Radio Block Loopback ON and Radio Block Loopback OFF. When the EGPRS Switched
Radio Block Loopback mode is initiated, the MS shall enter the Radio Block
Loopback ON sub-mode.
Figure 5.5.2: Loopback Sub-modes
Switching between the two Sub-modes is controlled by the use of the Payload
Type field in the MAC header of RLC/MAC control messages. During EGPRS
Switched Radio Block Loopback mode, the Payload Type field conveys two pieces
of information - whether or not the optional octets of the RLC/MAC control
header have been included (as for normal operation) and an instruction to
change between Radio Block Loopback Sub-modes. If in Radio Block Loopback Sub-
mode ON, an instruction to turn ON the Radio Block Loopback Sub-mode shall be
ignored, similarly an instruction to turn OFF the Radio Block Loopback Sub-
mode when in Radio Block Loopback Sub-mode OFF. The MS shall stay in EGPRS
Switched Radio Block Loopback Mode whether in Radio Block Loopback Sub-mode ON
or OFF until it is terminated by the procedure detailed in 5.5.3.
Table 5.5.2: Payload Type
* * *
bit\ Payload Type meaning during normal operation Payload Type meaning in
EGPRS Switched Radio Block Loopback Mode Loopback Sub-Mode Control 8 7
0 0 RLC/MAC block contains an RLC data block RLC/MAC block contains an RLC/MAC
control block that does not include the optional octets of the RLC/MAC control
header Loopback Sub Mode ON
0 1 RLC/MAC block contains an RLC/MAC control block that does not include the
optional octets of the RLC/MAC control header Loopback Sub Mode OFF
10 In the downlink direction, the RLC/MAC block contains an RLC/MAC control
block that includes the optional first octet of the RLC/MAC control header.\
In the downlink direction, the RLC/MAC block contains an RLC/MAC control block
that includes the optional first octet of the RLC/MAC control header.\
Loopback Sub-Mode ON In the uplink direction, this value is reserved. In the
uplink direction, this value is reserved
1 1 Reserved. In this version of the protocol, the mobile station shall ignore
all fields of the RLC/MAC block except for the USF field Loopback Sub-Mode OFF
* * *
If in Radio Block Loopback Sub-mode ON, the MS shall receive all radio blocks
and, before they pass through the decoding process (see figure in sub-clause
5.5), shall send them to the SS using the same uplink resources as the
existing uplink TBF. The radio blocks shall be resent on the very next block
period regardless of USF or TFI decoding.The radio blocks shall also pass
through the decoding process and if the RLC/MAC header is successfully decoded
shall be sent to RLC/MAC. When in Radio Block Loopback Sub-mode ON, the MS
should not send any control messages or data from RLC/MAC to its own Physical
Link layer for transmission.
If in Radio Block Loopback Sub-mode OFF, the MS shall not loopback any radio
blocks received. It can send control messages or data to be transmitted,
following the normal procedures in 3GPP TS 44.060 for a dynamic allocation.
Whether in Radio Block Loopback Sub-mode ON or OFF, the MS must obey any
RLC/MAC control messages referring to the uplink or downlink TBF.
### 5.5.3 Termination
The SS orders the MS to terminate EGPRS Switched Radio Block Loopback Mode by
transmitting a Packet TBF release, releasing the uplink and downlink TBFs. If
timer T3190 expires EGPRS Switched Radio Block Loopback Mode shall also be
terminated. If EGPRS test mode is terminated, the MS shall stop transmitting
on the uplink, discard any data associated with the uplink TBF and return to
packet idle mode.
### 5.5.4 Support of EGPRS MS without 8PSK modulation capability in uplink
EGPRS Switched Radio Block Loopback Mode makes provision for EGPRS MS without
8PSK modulation capability in uplink in the following manner. If the uplink
TBF was established using a GMSK modulation scheme, and the downlink is 8PSK
modulated, a radio block sent by the SS on a downlink timeslot using 8PSK
modulation should be followed by two radio blocks on the same timeslot where
the SS transmits GSM dummy bursts. The MS shall retransmit the received 8PSK
data over the following three radio blocks on the matching uplink timeslot.
The EGPRS MS without 8PSK modulation capability in uplink shall not retransmit
the last 16 encrypted bits received in an 8PSK radio block when retransmitting
it using GMSK modulation.
The stealing bits of the GMSK blocks shall be ignored by the SS.
The SS shall select this mode by setting bit 1 of the Mode Flag in the
EGPRS_START_RADIO_BLOCK_LOOPBACK_CMD message. See sub-clause 8.14.
### 5.5.5 Optional Multi-slot operation
To facilitate production tests and for other purposes, the MS may optionally
implement the following extension to this test mode.
If the downlink TBF is established on more than one timeslot, the MS shall
transmit in the second uplink timeslot (if present) radio blocks received on
the second downlink timeslot, and shall transmit in the third uplink timeslot
(if present) radio blocks received in the third downlink timeslot and so on.
If more transmit timeslots are present than receive timeslots, then the
contents of uplink timeslots that do not map to downlink timeslots shall be
the same as in the last timeslot that maps to downlink.
However, if the downlink TBF contains only a single timeslot the MS must fill
all uplink timeslots as defined in sub-clause 5.5.2 above.
In this description, downlink timeslots are counted from the \"Downlink
Timeslot Offset\" in the mode flag of the
EGPRS_START_RADIO_BLOCK_LOOPBACK_MODE_CMD. For example, if the \"Downlink
Timeslot Offset\" is set to 3, TN3 shall be treated as the first downlink
timeslot if a TBF is established in TN3. If TN3 does not support a TBF, the
first active timeslot after TN3 shall be treated as the first downlink
timeslot. The counting sequence is continuous through TN7 and TN0.
Uplink timeslots are always counted from TN0.
### 5.5.6 Support of EGPRS2-A MS
If the uplink TBF was established using 16QAM modulation scheme and the
downlink is 32QAM modulated, four radio blocks sent by the SS on a downlink
timeslot shall be followed by one radioblock with a GSM dummy burst. The MS
shall retransmit the received data over five consecutive radio blocks on the
matching uplink timeslot.
# 6 Activating and deactivating EMMI
Activating EMMI requires the presence of a test SIM. EMMI shall be activated
by any of the following:
\- switching on the MS;
\- inserting a test SIM;
\- layer 3 message on the radio interface (ACT_EMMI_CMD).
When the MS is ready to receive frames, it shall send one XON message.
EMMI shall be deactivated by any of the following:
\- switching off the MS;
\- removing the test SIM;
\- layer 3 message on the radio interface (DEACT_EMMI).
NOTE: No XOF shall be sent after deactivation.
The L3 message used on the radio interface to activate the EMMI is the
activation command ACT_EMMI_CMD (see sub-clause 8.4). This message has to be
acknowledged by the message ACT_EMMI_ACK on the radio interface sent by the MS
(see sub-clause 8.5).
For deactivation of the EMMI in the MS through the radio interface, the
message DEACT_EMMI is defined in sub-clause 8.6. An acknowledgement of this
message is not required.
# 7 Activating and deactivating DAI tests
Purpose: to determine the routing of speech data (DAI or internal, i.e. normal
mode) and which device is being tested (speech transcoder / DTX functions or
A/D & D/A).
Prerequisites: a dedicated channel must be established if the manufacturer has
stated that the DAI is activated by means of the layer 3 message.
Procedure: the SS sends a TEST_INTERFACE message if the manufacturer has
stated that the DAI is activated by means of the layer 3 message or applies
the appropriate control signal on the DAI if the manufacturer has declared
that the DAI is activated this way.
When the test mode is established i.e. speech data comes from test interface,
each new test function overrides the previous one.
# 8 Message definitions and contents
NOTE 1: A message received with skip indicator different from 0 will be
ignored.
NOTE 2: For definition of \"Presence\" and \"Format\", see 3GPP TS 24.007.
NOTE 3: GSM and UTRAN test messages use the same protocol discriminator value
(\"1111\"). Following message type value series are reserved for GSM testing
commands: 0000xxxx, 0001xxxx and 0010xxxx where x represent 0 or 1. For UTRAN
test commands, as specified by 3GPP TS 34.109, the message type value series
0100xxxx is reserved.
## 8.1 CLOSE_TCH_LOOP_CMD
This message is only sent in the direction SS to MS.
* * *
Information Element Reference Presence Format Length Protocol discriminator
3GPP TS 24.007 M V ½ Skip indicator 3GPP TS 24.007 M V ½ Message type M V 1
Sub-channel M V 1
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 bit no. 0 0 0 0 0 0 0 0 octet 1
* * *
and Sub-channel is:
+-------+-------+---+---+---+---+---+---+---------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | bit no. | +-------+-------+---+---+---+---+---+---+---------+ | 0 | 0 | C | B | A | Z | Y | X | octet 1 | | | | | | | | | | | | spare | spare | | | | | | | | +-------+-------+---+---+---+---+---+---+---------+
X = 0 If there is only one TCH active (so there is no choice) or if sub-
channel 0 of two half rate channels is to be looped.
X = 1 If sub-channel 1 of two half rate channels is to be used.
Other bits of the Sub-channel are given by the following table:
* * *
Test Loop Bits C to Y from Sub-channel  
C B A Z Y A 0 0 0 0 0 B 0 0 0 0 1 C 0 0 0 1 - D 0 0 1 - - E 0 1 0 - - F 0 1 1
- - I 1 1 1 - - Where \"-\" means that the value is disregarded.
* * *
## 8.2 CLOSE_TCH_LOOP_ACK
This message is only sent in the direction MS to SS.
* * *
Information Element Reference Presence Format Length Protocol discriminator
3GPP TS 24.007 M V ½ Skip indicator 3GPP TS 24.007 M V ½ Message type M V 1
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 bit no. 0 0 0 0 0 0 0 1 Octet 1
* * *
## 8.3 OPEN_LOOP_CMD
This message is only sent in the direction SS to MS
* * *
Information Element Reference Presence Format Length Protocol discriminator
3GPP TS 24.007 M V ½ Skip indicator 3GPP TS 24.007 M V ½ Message type M V 1
Acknowledge O TV 1
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 Bit no. 0 0 0 0 0 1 1 0 Octet 1
* * *
where Acknowledge Information Element Identifier is:
* * *
8 7 6 5 4 3 2 1 Bit no. 1 0 0 0 Octet 1
* * *
and the Acknowledge Information Element contents are:
+---+---+---+---+-------+-------+-------+---+---------+ | | | | | 4 | 3 | 2 | 1 | Bit no. | +---+---+---+---+-------+-------+-------+---+---------+ | | | | | 0 | 0 | 0 | 1 | Octet 1 | | | | | | | | | | | | | | | | spare | spare | spare | | | +---+---+---+---+-------+-------+-------+---+---------+
## 8.4 CLOSE_Multi-slot_LOOP_CMD
This message is only sent in the direction SS to MS.
* * *
Information Element Reference Presence Format Length Protocol discriminator
3GPP TS 24.007 M V ½ Skip indicator 3GPP TS 24.007 M V ½ Message type M V 1
Loop type M V 1
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 bit no. 0 0 1 0 0 0 0 0 octet 1
* * *
and Loop type is:
* * *
8 7 6 5 4 3 2 1 bit no. TN Loop mechanism CHC octet 1
* * *
CHC, Channel coding
00 = channel coding not needed. The Burst-by-Burst loop is activated, type G
01 = channel coding needed. Frame eraure is to be signalled, type H
All other values reserved
Loop mechanism
000 = Multi-slot mechanism 1
001 = Multi-slot mechanism 2
All other values reserved
TN, Timeslot number
Timeslot number used only if Loop mechanism indicates Multi-slot mechanism 1
The TN field is coded as the binary representation of the timeslot number as
defined in 3GPP TS 45.010.
Range: 0 to 7
## 8.5 CLOSE_Multi-slot_LOOP_ACK
This message is only sent in the direction MS to SS.
* * *
Information Element Reference Presence Format Length Protocol discriminator
3GPP TS 24.007 M V ½ Skip indicator 3GPP TS 24.007 M V ½ Message type M V 1
Result M V 1
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 bit no. 0 0 1 0 0 0 0 1 Octet 1
* * *
and Result is:
+-------+-------+-----+----------------+-----------+---------+---+---+---------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | bit no. | +-------+-------+-----+----------------+-----------+---------+---+---+---------+ | 0 | 0 | CHC | Loop mechanism | Error Ind | octet 1 | | | | | | | | | | | | | | | spare | spare | | | | | | | | +-------+-------+-----+----------------+-----------+---------+---+---+---------+
CHC, Channel coding
00 = channel coding not needed. The Burst-by-Burst loop is activated, type G
01 = channel coding needed. Frame eraure is to be signalled, type H
All other values reserved
Loop mechanism
000 = Multi-slot mechanism 1
001 = Multi-slot mechanism 2
All other values reserved
Error Ind, Error indication
0 = Multi-slot TCH loop was closed successfully
1 = Multi-slot TCH loop was not closed due to error
## 8.6 OPEN_Multi-slot_LOOP_CMD
This message is only sent in the direction SS to MS
* * *
Information Element Reference Presence Format Length Protocol discriminator
3GPP TS 24.007 M V ½ Skip indicator 3GPP TS 24.007 M V ½ Message type M V 1
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 Bit no. 0 0 1 0 0 0 1 0 Octet 1
* * *
## 8.7 OPEN_Multi-slot_LOOP_ACK
This message is only sent in the direction MS to SS
* * *
Information Element Reference Presence Format Length Protocol discriminator
3GPP TS 24.007 M V ½ Skip indicator 3GPP TS 24.007 M V ½ Message type M V 1
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 Bit no. 0 0 1 0 0 0 1 1 Octet 1
* * *
## 8.8 Command for the activation of the EMMI, ACT_EMMI_CMD
This message is only sent in the direction SS to MS.
* * *
Information Element Reference Presence Format Length Protocol discriminator
3GPP TS 24.007 M V ½ Skip indicator 3GPP TS 24.007 M V ½ Message type M V 1
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 Bit no. 0 0 0 0 1 1 0 0 Octet 1
* * *
## 8.9 Acknowledge of the activation of the EMMI, ACT_EMMI_ACK
This message is only sent in the direction MS to SS.
* * *
Information Element Reference Presence Format Length Protocol discriminator
3GPP TS 24.007 M V 1/2 Skip indicator 3GPP TS 24.007 M V 1/2 Message type M V
1
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 Bit no. 0 0 0 0 1 1 0 1 Octet 1
* * *
## 8.10 Deactivation of the EMMI, DEACT_EMMI
This message is only sent in the direction SS to MS.
* * *
Information Element Reference Presence Format Length Protocol discriminator
3GPP TS 24.007 M V 1/2 Skip indicator 3GPP TS 24.007 M V 1/2 Message type M V
1
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 Bit no. 0 0 0 1 0 0 0 0 Octet 1
* * *
## 8.11 Test_Interface
This message is only sent in the direction SS to MS.
* * *
Information Element Reference Presence Format Length Protocol discriminator
3GPP TS 24.007 M V 1/2 Skip indicator 3GPP TS 24.007 M V 1/2 Message type M V
1 Tested device M V 1
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 Bit no. 0 0 0 1 0 1 0 0 Octet 1
* * *
and Tested device is:
+-------+-------+-------+-------+-------+----------------+---------+---+---------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | Bit no. | +-------+-------+-------+-------+-------+----------------+---------+---+---------+ | 0 | 0 | 0 | 0 | 0 | Tested devices | Octet 1 | | | | | | | | | | | | | | spare | spare | spare | spare | spare | | | | | +-------+-------+-------+-------+-------+----------------+---------+---+---------+
Tested devices:
> 000 = normal operation (no tested device via DAI)
>
> 001 = test of speech decoder / DTX functions (downlink)
>
> 010 = test of speech encoder / DTX functions (uplink)
>
> 100 = test of acoustic devices and A/D & D/A.
>
> All other values are reserved.
## 8.12 Timer values
TT01: To be started when a CLOSE_TCH_LOOP_CMD or CLOSE_Multi-slot_LOOP_CMD is
sent. To be stopped when the corresponding CLOSE_TCH_LOOP_ACK or CLOSE_Multi-
slot_LOOP_ACK is received.
Recommended value: [2.5 seconds].
TT02: To be started when a GPRS_TEST_MODE_CMD is sent. To be stopped when the
MS requests uplink resources.
Recommended value: [2.5 seconds].
TT03: To be started when an MS has requested uplink resources following the
transmission of an EGPRS_START_RADIO_BLOCK_LOOPBACK_MODE_CMD.
Recommended value: [50 ms].
## 8.13 GPRS_TEST_MODE_CMD
This message is only sent in the direction SS to MS.
* * *
Information Element Reference Presence Format Length Protocol discriminator
3GPP TS 24.007 M V ½ Skip indicator 3GPP TS 24.007 M V ½ Message type M V 1
PDU description M V 2 Mode Flag M V 1
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 bit no. 0 0 1 0 0 1 0 0 Octet 1
* * *
PDU Description is:
+----+-------+-------+-------+-----+-----+----+----+---------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | bit no. | +----+-------+-------+-------+-----+-----+----+----+---------+ | L | 0 | 0 | 0 | d11 | d10 | d9 | d8 | Octet 1 | | | | | | | | | | | | | Spare | Spare | Spare | | | | | | +----+-------+-------+-------+-----+-----+----+----+---------+ | d7 | d6 | d5 | d4 | d3 | d2 | d1 | d0 | Octet 2 | +----+-------+-------+-------+-----+-----+----+----+---------+
PDU Description only applies if the MS is operating in mode a). The PDU
consists of the pseudorandom data sequence only, ie, it shall not contain any
header information or FCS field.
L = 1 PDUs of constant length from 140 up to 1560 octets shall be transferred.
The maximum length of the PDU is an implementation specific issue and shall be
declared for the implementation to be tested. The number of PDUs to be
transmitted is expressed by d11 - d0 as a binary representation. Range is 1 to
4095.
* * *
d11 d10 d9 d8 d7 d6 d5 d4 d3 d2 d1 d0  
0 0 0 0 0 0 0 0 0 0 0 0 = See Note 0 0 0 0 0 0 0 0 0 0 0 1 = 1 0 0 0 0 0 0 0 0
0 0 1 0 = 2 0 0 0 0 0 0 0 0 0 0 1 1 = 3 . . .  
1 1 1 1 1 1 1 1 1 1 1 1 = 4095
* * *
NOTE: When the number of PDUs is set to zero, it may optionally be interpreted
by the MS as meaning an infinite number of PDUs to be transmitted in the TBF.
Infinite duration TBFs are not supported through normal RLC/MAC operation.
Therefore, implementation of this feature is left as optional.
L = 0 Reserved
Mode Flag is:
+-------+-------+-------+-------+--------------------------+---+---------+---+---------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | bit no. | +-------+-------+-------+-------+--------------------------+---+---------+---+---------+ | 0 | 0 | 0 | 0 | Downlink Timeslot Offset | M | Octet 1 | | | | | | | | | | | | | | Spare | Spare | Spare | Spare | | | | | | +-------+-------+-------+-------+--------------------------+---+---------+---+---------+
M = 0 If the MS implements both looping the received data back to the
transmitter and internally generating the pseudorandom data, then if this bit
is set to \'0\' the MS shall itself generate the pseudorandom data. Otherwise
the MS may ignore this bit.
M = 1 If the MS implements both looping the received data back to the
transmitter and internally generating the pseudorandom data, then if this bit
is set to \'1\' the MS shall select the loop back option. Otherwise the MS may
ignore this bit.
Downlink Timeslot Offset -field shall be coded as binary representation of the
timeslot number as follows:
000 = TN0
001 = TN1
010 = TN2
011 = TN3
100 = TN4
101 = TN5
110 = TN6
111 = TN7
## 8.14 EGPRS_START_RADIO_BLOCK_LOOPBACK_CMD
This message is only sent in the direction SS to MS.
* * *
Information Element Reference Presence Format Length Protocol discriminator
3GPP TS 24.007 M V ½ Skip indicator 3GPP TS 24.007 M V ½ Message type M V 1
Mode Flag M V 1
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 bit no. 0 0 1 0 0 1 0 1 Octet 1
* * *
Mode Flag is:
+-------+-------+-------+-------+--------------------------+---+---------+---+---------+ | 8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | bit no. | +-------+-------+-------+-------+--------------------------+---+---------+---+---------+ | 0 | 0 | 0 | 0 | Downlink Timeslot Offset | M | Octet 1 | | | | | | | | | | | | | | Spare | Spare | Spare | Spare | | | | | | +-------+-------+-------+-------+--------------------------+---+---------+---+---------+
Downlink Timeslot Offset -field shall be coded as binary representation of the
timeslot number as follows:
000 = TN0
001 = TN1
010 = TN2
011 = TN3
100 = TN4
101 = TN5
110 = TN6
111 = TN7
M = 0 The MS loops back blocks on the uplink using either GMSK or 8-PSK
modulation following the detected received modulation.
M = 1 The MS loops back blocks on the uplink using GMSK modulation only.
Mobile stations capable of uplink 8PSK may ignore the contents of the M bit.
## 8.15 RESET MS POSITIONING STORED INFORMATION
This message is only sent in the direction SS to MS.
* * *
Information Element Reference Presence Format Length Protocol discriminator
3GPP TS 24.007 M V ½ Skip indicator 3GPP TS 24.007 M V ½ Message type M V 1 MS
Positioning Technology M V 1
* * *
where message type is:
* * *
8 7 6 5 4 3 2 1 bit no. 0 0 1 0 0 1 1 0 Octet 1
* * *
where MS Positioning Technology is a single octet IE:
* * *
8 7 6 5 4 3 2 1 bit no. MS Positioning Technology octet 1
* * *
MS Positioning Technology value
Bits\ **8 7 6 5 4 3 2 1** \ 0 0 0 0 0 0 0 0 AGPS\ 0 0 0 0 0 0 0 1 AGNSS
All other cause values are reserved for future use
# 9 Electrical Man Machine Interface (EMMI)
## 9.1 Use of the EMMI
Conformity tests of mobile stations are made using the system simulator
specified in Annex 4.
Test signals are sent on the Um interface, and actions of the MS are
registered. The Electrical Man Machine Interface (EMMI) is a half duplex
communication link between the SS and the MS by which it is possible to
automatically register the status, indications and performance of the MS.
It is also possible to simulate actions normally made by the user on the
keyboard of the MS.
## 9.2 Formal aspects
i) The EMMI is optional for the ME.
ii) The EMMI is mandatory for the SS.
iii) If the EMMI is to be used in conformance testing of an MS, it shall be
possible to connect the SS to a connector on the MS, or to an adapter
connected to the same MS. If an adapter is to be used, it shall be provided by
the manufacturer.
iv) If the MS fulfils the requirements performed with the use of an EMMI, the
MS is regarded as having passed that test.
v) If the MS is rejected in a test performed with EMMI, the test shall be
repeated on the same mobile with the device carrying the EMMI to the MS
removed. The MS shall be regarded as fulfilling the requirements, if it then
passes the test.
vi) When using the EMMI, the MS does not necessarily conform to the RF
requirements. Therefore, tests concerning Rx and Tx parameters on MS with
integral antenna and cabinet radiation tests for all types of MS will never be
performed with the use of the EMMI.
## 9.3 Layered structure of the interface
The definition of the EMMI is divided into three different layers. On layer 1
the use of a 25-pole socket with standard electrical characteristics for
serial communication is defined. On layer 2, an extremely simple frame
oriented protocol is defined. On layer 3, messages for control and
verification of functions and indications are defined. Each layer is defined
independently of surrounding layers, and is therefore easy to replace.
The EMMI protocol structure takes into account that the SS only sends and
receives layer 3 frames when the corresponding step within a test case is to
be performed.
## 9.4 Terminology
EMMI Electrical Man Machine Interface
MI Message Identifier
ME Mobile Equipment
MS Mobile Station
SS System Simulator
Frame Used on layer 2 to transfer messages to and from layer 3
Message Information on layer 3
## 9.5 Description of the EMMI
### 9.5.1 EMMI, Layer 1
#### 9.5.1.1 Mechanical and electrical characteristics
If implemented, the EMMI interface shall use the same connector as the Digital
Audio Interface (DAI), described in sub-clause 10.3.
The pin assignments for the EMMI shall be as follows:
* * *
Pin Function Source 2 Transmitted data SS 3 Received data MS 7 EMMI signal
ground
* * *
The electrical characteristics of the interface shall be as given in sub-
clause 10.3.2.
#### 9.5.1.2 Transmission and reception characteristics
The EMMI uses asynchronous serial data transmission with 1 start bit (S), 8
data bits (D1 to D8), no parity and 1 stop bit (E).
Table 3: Use of start and stop bits
* * *
S D1 D2 D3 D4 D5 D6 D7 D8 E
* * *
The conditions on start and stop characters are defined in REC CCITT V.1.
The transmission rates are: 600, 1200, 2400, 4800, 9600 bits per second. The
ME shall support at least one of these speeds.
The SS will adapt its rate (manually or by MMI) to this ME rate.
### 9.5.2 EMMI, layer 2
#### 9.5.2.1 General structure
On layer 2, frames are used to carry data from higher layers. Frames consist
of one or several octets. One frame with variable length is used to carry data
from higher layers, and four other frames with the length of one character is
used to control the flow of frames.
#### 9.5.2.2 Control frames
Special frames have been assigned to control the flow of frames on layer 2\.
They are only one octet long.
Table 4: Characters for flow control
* * *
Abbr. Meaning Dec.value Bit pattern ACK Acknowledge 06 0000 0110 NAK Not
Acknowledge 21 0001 0101 XON Resume sending data 17 0001 0001 XOF Stop sending
data 19 0001 0011
* * *
#### 9.5.2.3 Frame structure
Two octets, called characters, indicate start and stop of I-frames.
Table 5: Start and stop characters
* * *
Abbr. Meaning Dec.value Bit pattern STX Start of data 02 0000 0010 ETX End of
data 03 0000 0011
* * *
Information from higher layers are transferred in I-frames with the following
structure.
Table 6: Information structure in I-frames
+--------------+-------------+--------------+--------------+------+ | Field name | No of octet | Value | Start at | Note | | | | | octet no | | +--------------+-------------+--------------+--------------+------+ | Start | 1 | Character | 1 | - | | | | STX | | | +--------------+-------------+--------------+--------------+------+ | Length | 1 | Length of | 2 | a1) | | | | data | | | +--------------+-------------+--------------+--------------+------+ | Data | 0-255 | Content of | 3 | a2) | | | | data | | | +--------------+-------------+--------------+--------------+------+ | Check | 1 | Error | Length+2 | a3) | | | | detection | | | +--------------+-------------+--------------+--------------+------+ | End | 1 | Character | Length+3 | | | | | ETX | | | +--------------+-------------+--------------+--------------+------+ | NOTE a1) | | | | | | Length: The | | | | | | total number | | | | | | of data | | | | | | octets in | | | | | | the data | | | | | | field of the | | | | | | frame is | | | | | | calculated. | | | | | | The value | | | | | | shall be in | | | | | | the range of | | | | | | (0..255 | | | | | | decimal). | | | | | | The | | | | | | c | | | | | | orresponding | | | | | | binary value | | | | | | is put into | | | | | | the length | | | | | | field. | | | | | | | | | | | | NOTE a2) | | | | | | Data: Data | | | | | | to and from | | | | | | higher | | | | | | layers are | | | | | | in the form | | | | | | of octets | | | | | | (groups of 8 | | | | | | digital | | | | | | bits). | | | | | | | | | | | | NOTE a3) | | | | | | Check: | | | | | | Longitudinal | | | | | | checksum is | | | | | | created by | | | | | | exclusive OR | | | | | | on all | | | | | | characters | | | | | | starting | | | | | | with the | | | | | | Start field | | | | | | and ending | | | | | | with the | | | | | | last octet | | | | | | before the | | | | | | Check field. | | | | | | The value, | | | | | | one octet, | | | | | | is mapped | | | | | | into the | | | | | | Check field. | | | | | +--------------+-------------+--------------+--------------+------+
#### 9.5.2.4 Flow of I-frames on layer 2
##### 9.5.2.4.1 Transmission of frames
A multiple frame starts with the first octet being the character STX and stops
with the last octet with content ETX. The time between the start bits of two
consecutive octets shall not be longer than T22.
* * *
octet n octet n + 1 \
* * *
The time between two frames is measured from the start bit of the last octet
of the nth frame to the start bit of the first octet of the n+1st frame. The
time between two consecutive frames shall not be less than T23.
* * *
STX Frame n ETX STX frame n+1 ETX \
* * *
##### 9.5.2.4.2 Reception of frames
Start of a frame is defined as (more than T22*2 since previous reception of
octet) AND (reception of STX).
End of a frame is defined as (reception of ETX in octet number (length+2)) OR
(more than T22*2 since last reception of octet).
##### 9.5.2.4.3 Use of ACK and NAK on receiving side
ACK is used by the MS to acknowledge a frame on receiving side if all the
following conditions are fulfilled. Otherwise NAK is used.
1) The content of Start field is STX.
2) The content of Check field corresponds to the exclusive OR sum of previous
octets in the frame.
3) The content of the last octet is ETX.
NAK is used by the SS to request retransmission of a frame. Otherwise ACK is
used.
NOTE: NAK shall not be used for layer 3 errors, if the layer 2 frame is
correct. If the meaning of a layer 3 message is undefined or not performable,
then the problem is solved with layer 3 messages.
##### 9.5.2.4.4 Use of XON and XOF
XON and XOF are used for flow control of layer 2.
XOF is sent if the unit (MS or SS) due to internal processing is not capable
of receiving a following frame when a frame is being received.
XON is sent if XOF has been sent previously, but the reason for that XOF-
transmission no longer exists.
##### 9.5.2.4.5 Parameters on layer 2
Table 7: Timer values on layer 2
* * *
Bit rate Value of T22 Value of T23 600 25.0 ms 58.3 ms 1200 12.5 ms 29.2 ms
2400 6.3 ms 14.6 ms 4800 3.1 ms 7.3 ms 9600 1.6 ms 3.6 ms
* * *
### 9.5.3 EMMI, layer 3
#### 9.5.3.1 Message structure
Messages are used on layer 3. They are defined by Message Identifiers (MI) in
the range of (0..255). The message identifier is always the first, and often
the only, octet of the message.
Table 8: Use of message identifiers
* * *
**MI** **Use** 0-49 Not used. 50-179 General messages. All undefined values
reserved for further evolution of the EMMI. 180-209 ME-type dependent blocks,
may be used by the SS as a sender or receiver, if so requested by the
manufacturer. Undefined values available for the manufacturer. 210-239 ME-type
dependent blocks, never to be used by the SS in conformance testing. Undefined
values available for the manufacturer. 240-255 Reserved for L3 error handling.
All undefined values reserved for further evolution of the EMMI.
* * *
NOTE 1: Layer 2 is transparent, but to avoid unnecessary interference from
layer 3, MI with the same value as control frames on layer 2 are not used.
Most of the messages, especially in the direction SS - MS contain only one
octet, the message indicator. Some of the messages, especially in the
direction MS - SS are quite long.
NOTE 2: If the interface is limited only to the minimum required for automatic
conformity testing with the electrical man machine interface, then the
included L3 messages should be RQTI, KEYS, BEL1, BEL0, HOK1, HOK0, BCAP and
RSTI.
Table 9: Block types
* * *
**MI** **Source**  
**Value** **Abbr.** **Meaning** **MS** **SS** 051 VOL1 Increase volume (***) X
052 VOL0 Decrease volume (***) X 053 RQTS Request for table, status X 054 RQTI
Request for table, indication X 055 RQPL Request for power level X 056 RQBE
Request for bell status X 057 RQSM Request for short message X 058 KEYS
Perform keystroke sequence X 060 BEL1 Indication user alert on X  
061 BEL0 Indication user alert off X  
064 HOK1 Hook on X 065 HOK0 Hook off X 070 BCAP Selection of bearer capability
X 080 STPO Set power level X 091 RSTS Response table, status X  
092 RSTI Response table, indication X  
093 RSPO Response, power level X  
101 RXSM Received short message X  
102 RXSN No short message received X  
240 ER00 Internal malfunction detected X  
241 ER01 L3 message not recognized X X 242 ER02 L3 message not performable X  
255 RESE Perform hardware and software reset X
* * *
NOTE 3: Functioning of this should be verified, as the volume control in the
ME might be of another type (non-incremental).
#### 9.5.3.2 Definition of messages
Messages are defined in the order of the value of the message identifier.
##### 051 VOL1 Increase volume {#vol1-increase-volume .H6}
##### 052 VOL0 Decrease volume {#vol0-decrease-volume .H6}
Increase/decrease volume in the loudspeaker by one step.
* * *
8 7 6 5 4 3 2 1 Octet  
1 Message identifier
* * *
##### 053 RQTS Request for table, status {#rqts-request-for-table-status .H6}
##### 054 RQTI Request for table, indication {#rqti-request-for-table-
indication .H6}
##### 055 RQPL Request for power level {#rqpl-request-for-power-level .H6}
On receiving a request message RQxy, the corresponding table RSxy shall be
sent.
* * *
8 7 6 5 4 3 2 1 Octet  
1 Message identifier
* * *
##### 056 RQBE Request for bell status {#rqbe-request-for-bell-status .H6}
On receiving a request message RQBE, the internal user alert status (BEL1 or
BEL0) shall be sent. BEL1 and BEL0 will indicate whether the ringing or alert
procedure has been activated or not. (See also the definition of BEL1 and
BEL0).
* * *
8 7 6 5 4 3 2 1 Octet  
1 Message identifier
* * *
##### 057 RQSM Request for short message {#rqsm-request-for-short-message .H6}
In response to the RQSM request the MS shall send either the short message
type using the message RXSM or, in case of no short message received, the
message RXSN.
* * *
8 7 6 5 4 3 2 1 Octet  
1 Message identifier
* * *
##### 058 KEYS Perform keystroke sequence {#keys-perform-keystroke-sequence
.H6}
Perform the MS function related to the received keystroke sequence.
* * *
8 7 6 5 4 3 2 1 Octet  
1 Message identifier 2 First key ....  
N Key Number N-1
* * *
The possible keystroke sequences are based on the basic public man machine
interface as defined in 3GPP TS 22.030. There exists a minimum set of key
characters.
The codes associated with these characters are defined as follows:
* * *
Key Code (decimal) # 35 * 42 \+ 43 0 48 1 49 2 50 3 51 4 52 5 53 6 54 7 55 8
56 9 57 END (function) 18 SEND (function) 20 060 BEL1 Indication user alert on
061 BEL0 Indication user alert off
* * *
Indication user alert shall indicate, on request of the SS, the internal
status of the alert or ringing procedure. For this purpose, the SS shall send
the RQBE (request for bell status) message to the MS.
BEL1 shall indicate that the alert procedure is active.
BEL0 shall indicate that the alert procedure is not active.
* * *
8 7 6 5 4 3 2 1 Octet  
1 Message identifier
* * *
##### 064 HOK1 Hook on {#hok1-hook-on .H6}
##### 065 HOK0 Hook off {#hok0-hook-off .H6}
Control of the hook. The hook on/off command shall action the normal procedure
associated with physically lifting the handset and replacing it whatever that
maybe.
* * *
8 7 6 5 4 3 2 1 Octet  
1 Message identifier
* * *
##### 070 BCAP Selection of bearer capability {#bcap-selection-of-bearer-
capability .H6}
The EMMI BCAP message shall change the default bearer capability on all future
calls made via the EMMI \"perform keystroke sequence\" message. The new
default bearer capability shall be in effect until the ME is switched off or
until the ME receives another EMMI BCAP message.
* * *
8 7 6 5 4 3 2 1 Octet
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           1       Message identifier
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           2       Bearer capability\
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   (see note)
NOTE: The field \"bearer capability\" in the BCAP message is mandatory and is
coded bit for bit exactly as the \"bearer capability\" information element as
described in 3GPP TS 44.018, beginning with octet 2 (length of the bearer
capability contents). Because the \"bearer capability\" is mandatory, the
first byte of the field shall be the length of the bearer capability content
and not the bearer capability information element identifier.
* * *
##### 080 STPO Set power level {#stpo-set-power-level .H6}
Used to control the Tx power level of the ME.
* * *
8 7 6 5 4 3 2 1 Octet
                                                                                                                                              1       Message identifier
                                                                                                                                              2       Power level\
                                                                                                                                                      (see note)
NOTE: The power level is defined as the 2nd octet of the power command
information element in 3GPP TS 44.018.
* * *
##### 091 RSTS Response table, status {#rsts-response-table-status .H6}
Response table status is sent as an answer to the corresponding request.
8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | Octet |   
---|---|---|---|---|---|---|---|---|---  
|  |  |  |  |  |  |  | 1 | Message identifier  
|  | F1 |  |  | F2 |  |  | 2 | Statis fiels  
(see note)  
|  |  | F3 |  |  |  |  |  |   
NOTE: F1 0 0 0 0 Spare F2 (1=yes, 0=no) Bit 4 L2 link on SACCH established Bit 3 Speech connection on TCH establ Bit 2 Listening to BCCH Bit 1 SDCCH established F3 Bit 8 Frequency hopping (yes/no) Bit 7-1 ARFCN of BCCH of serving cell |  |  |  |  |  |  |  |  |   
##### 092 RSTI Response table, indication {#rsti-response-table-indication
.H6}
Response table indication send as an answer to the corresponding request.
8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | Octet |   
---|---|---|---|---|---|---|---|---|---  
|  |  |  |  |  |  |  | 1 | Message identifier  
|  |  | F1 |  |  |  | F2 | 2 | Indication field  
(see note)  
NOTE: F1 0000000 Spare F2 (yes=1, no=0) Bit 1 Service indication On (yes/no) |  |  |  |  |  |  |  |  |   
##### 093 RSPO Response, power level {#rspo-response-power-level .H6}
Response power level is sent as an answer to the corresponding request.
* * *
8 7 6 5 4 3 2 1 Octet
                                                                                                                                               1       Message identifier
                                                                                                                     F1           F2           2       Power Level\
                                                                                                                                                       (see note)
NOTE: The power level is defined as the 2nd octet of the power command
information element in 3GPP TS 44.018
* * *
##### 101 RXSM Received short message {#rxsm-received-short-message .H6}
The message RXSM has to be sent by the MS in response to the RQSM request if a
short message has been received.
8 | 7 | 6 | 5 | 4 | 3 | 2 | 1 | Octet |   
---|---|---|---|---|---|---|---|---|---  
|  |  |  |  |  |  |  | 1 | Message identifier  
|  |  |  |  |  |  |  | 2 | SM field octet 1  
(see note)  
|  |  |  |  |  |  |  | .... |   
|  |  |  |  |  |  |  | N | SM field octet N-1  
NOTE: The SM field is defined as the content of the data field short message storage defined in 3GPP TS 51.011, excluding byte 1, as follows: 1 byte NULL value 12 bytes TP Originating Address 12 bytes TS Service Centre Address 1 byte TP Protocol Identifier 1 byte TP Data Coding Scheme 7 bytes TP Service Centre Time Stamp 1 byte TP User Data Length up to 140 bytes TP User Data. If the length of the address for TP and for TS service centre is less than 12 bytes, the remaining bytes are filled with null values. |  |  |  |  |  |  |  |  |   
##### 102 RXSN No short message received {#rxsn-no-short-message-received .H6}
The message RXSN has to be sent by the MS in response to the RQSM request if
no short message has been received.
* * *
8 7 6 5 4 3 2 1 Octet  
1 Message identifier
* * *
##### 240 ER00 Internal malfunction detected {#er00-internal-malfunction-
detected .H6}
Used to indicate to the SS that the MS has discovered an internal error. This
error message is to be handled in the same manner as the layer 3 error
messages (only to be sent to the SS in response to a Layer 3 message received
at the MS).
* * *
8 7 6 5 4 3 2 1 Octet  
1 Message identifier 2 Error indication NOTE: The error indicator is defined
by the manufacturer of the ME.
* * *
##### 241 ER01 L3 message not recognized {#er01-l3-message-not-recognized .H6}
Used by the receiver to indicate to the sender that the message was correctly
received, but ignored due to the fact that it was not understandable (e.g. a
KEYS message with one or many values which are not part of the standard set of
keys for the MSE). The message to the MS implies a request for re-sending the
latest message sent.
* * *
8 7 6 5 4 3 2 1 Octet  
1 Message identifier
* * *
##### 242 ER02 L3 message not performable {#er02-l3-message-not-performable
.H6}
Used by the receiver to indicate to the sender that the message was
understood, but not performable due to intentional lack of functionality in
the MS (e.g. as answer to a CALL message containing a type of service which
the MS is not able to use) or to a message requesting a change to a state
already existent.
* * *
8 7 6 5 4 3 2 1 Octet  
1 Message identifier
* * *
##### 255 RESE Perform HW and SW reset {#rese-perform-hw-and-sw-reset .H6}
The MS shall perform a total reset. The MS shall behave as if it has been
switched \"off\" and \"on\".
* * *
8 7 6 5 4 3 2 1 Octet  
1 Message identifier
* * *
# 10 Digital audio interface
## 10.1 General
A special interface is required in order to perform the bit exact test of the
speech coder/decoder and to test the SLR/RLR performance of the analogue and
acoustic devices. It shall be possible to insert and extract speech data in
both the transmit and receive directions. The interruption of the normal
speech data paths can be commanded either by a layer 3 message over the air
interface or by special control lines in the test interface. The MS need react
to only one of these command methods. The manufacturer shall state which
method is to be used.
## 10.2 Formal aspects
It shall be possible to connect the SS to the ME or to an adapter connected to
the ME. If an adapter is to be used, it shall be provided by the manufacturer
of the ME.
When using the DAI, the MS does not necessarily conform to all RF
requirements.
When the DAI is connected the MS shall be able to correctly send and receive
on a TCH and associated channels under ideal radio conditions.
NOTE: Prior to tests of the speech coder, other functional entities involved
in the tests, such as the channel codec or RF units must have been verified
successfully.
## 10.3 Hardware aspect of the interface
The data exchanged on the interface are 13 bit linear PCM at 8000 samples per
second, which, in order to keep the pin count low, are transferred on a duplex
set of serial lines at 104 kbit/s.
One additional line resets the speech transcoder and the speech A/D and D/A
functions. Two lines control the data flow direction and working mode of the
interface, one mode being normal operation of the MS. These lines are
controlled by the SS. Another line, controlled by the MS, clocks the data as
required or available.
This is described in detail below.
### 10.3.1 Mechanical characteristics of the interface
The interface shall use a 25-pin DSUB socket, detailed in the ISO 2110
document. The ME shall use a female part.
The manufacturer may provide this interface on an external test \"adapter\".
The pin assignment of the connector shall be as follows:
* * *
Pin Use Function Source 1 Chassis ground ME 2-3 EMMI Signals  
4-6 Not used  
7 EMMI Signal ground  
8-10 Not used  
11 DAI Test control 1 SS 12 DAI Signal ground  
13 DAI Test control 2 SS 14-21 Not used  
22 DAI Reset SS 23 DAI Data ME 24 DAI Data clock (104 kHz) ME 25 DAI Data SS
* * *
NOTE: The EMMI interface is optional and is described in sub-clause 9.
### 10.3.2 Electrical characteristics of the interface
The state of a signal pin is defined by the voltage (V) between the pin and
its associated ground as follows:
* * *
Logical state Voltage v 0 or \"LOW\" or \"ON\" 0 V \ \+ 5 V
* * *
### 10.3.3 Timing characteristics of the interface
The following timing applies:
* * *
Parameter Value Clock frequency 104 kHz +/- 20 ppm Duty cycle 40 to 60 % Clock
rising edge time \= 4 millisecond
* * *
{width="6.572916666666667in" height="2.1354166666666665in"}
Figure 10.3.3: Timing characteristics
Data shall be stable during the period between 3 microseconds before and 1
microsecond after the rising edge of the clock (50% level).
## 10.4 Logical interface
The reset signal is active low.
The data consists of 13 bit words in two\'s complement format, with the most
significant bit transmitted first.
Data are read in by the MS or SS at the rising edge and are output by the SS
or MS at the falling edge of the clock, as defined in Figure 2.
The clock signal is high when inactive.
The two test control lines determine the routing of the speech data (DAI or
internal, i.e. normal mode) and which device is being tested (speech
transcoder/DTX functions or A/D & D/A) as follows:
* * *
Test control line Function  
1 2  
Low Low Normal operation Low High Test of speech decoder / DTX functions
(downlink) High Low Test of speech encoder / DTX functions (uplink) High High
Test of acoustic devices and A/D & D/A
* * *
The same test setup may be achieved by the layer 3 TEST_INTERFACE message (see
7 and 8.7).
## 10.5 Functionality of the DAI
To initiate a test, the SS shall apply the appropriate test control signals or
send the appropriate layer 3 messages and then, more than 1 second later,
apply a reset pulse.
Upon release of the reset pulse, the MS subsequently starts the test by
issuing clock pulses when data are required or are ready.
When testing uplink speech transcoding or DTX functions, the first falling
clock edge shall request from the SS the first bit of the speech samples to be
encoded, the transmission of which shall start at the next earliest possible
interleaved block TDMA frame (as defined in 3GPP TS 45.002) after the release
of the reset pulse.
When testing downlink speech transcoding or DTX functions, the first falling
clock edge shall output to the SS the first bit of the speech samples decoded
from the first interleaved block TDMA frames, the reception of which is
completed subsequently to the release of the reset pulse.
The MS speech transcoders shall be reset by the end of the reset pulse,
whenever it occurs, whilst the DAI is in one of the active states (Test of
speech decoder / DTX functions (downlink), Test of speech encoder / DTX
functions (uplink), Test of acoustic devices and A/D and D/A).
{width="4.972916666666666in" height="2.589583333333333in"}
Figure 10.5: DAI Timing
# 11 SIM/ME test interface
## 11.1 General
A special interface is required in order to perform the tests of the SIM/ME
interface.
## 11.2 Formal aspects
It shall be possible to connect the SIM simulator to the ME. If an adapter is
to be used, it shall be provided by the manufacturer of the ME.
When using the SIM simulator, the ME does not necessarily conform to all RF
requirements.
When the SIM simulator is connected the ME shall be able to correctly send and
receive on a TCH and associated channels under ideal radio conditions
(according to GC3 of Annex 1).
## 11.3 Hardware and logical aspects of the interface
The signals on this interface are specified in 3GPP TS 51.011.
## 11.4 Mechanical characteristics of the interface
The interface of the SIM-simulator offers two connection types :
i) a paddle which is inserted into the ME under test in place of an IC card
SIM, and connects with wires to the measuring equipment. The dimensions of the
full size paddle are shown in Figure 11.4a. The length of the plug in SIM
paddle shown in Figure 11.4b shall not exceed 12cm.
ii) a connector with leads of length 12cm, terminated directly at the
contacting elements inside the ME under test.
For ME where the paddle cannot be inserted due to constraints imposed by the
ME design, then the ME manufacturer shall, for the purpose of testing the
SIM/ME interface only, provide the ME with the connector of type ii) and the
leads attached directly to the contacting elements. This connector with the
flying leads shall be delivered by the test house.
{width="4.246527777777778in" height="6.903472222222222in"}
Figure 11.4a: Dimensions of full size paddle
{width="2.1180555555555554in" height="5.322916666666667in"}
Figure 11.4b Dimensions of plug in SIM adapter
# 12 Reset MS Positioning Stored Information
## 12.1 General
The SS uses the reset MS positioning stored information procedure to command
the MS to reset the already acquired MS POSITIONING information in preparation
for subsequent test procedures.
Figure 12: RESET MS POSITIONING STORED INFORMATION
## 12.2 Procedure
The SS requests the MS to reset the stored MS positioning information mode by
transmitting a RESET MS POSITIONING STORED INFORMATION message.
When MS receives RESET MS POSITIONING STORED INFORMATION message then the MS
shall:
\- if the IE \"MS Positioning Technology\" has the value 'AGPS': discard any
stored GPS reference time, reference position, and any other aiding data
obtained or derived previously (e.g. expected ranges and Doppler).
\- if the IE \"MS Positioning Technology\" has the value 'AGNSS':
> \- discard any stored GPS and GANSS reference time, reference position, and
> any other aiding data obtained or derived previously (e.g. expected ranges
> and Doppler);
>
> \- temporarily disable any sensor data (if applicable) that can aid the
> positioning for the duration of the subsequent positioning procedure.
\- otherwise: ignore the message.
# 13 GAN security certificate
## 13.1 General
When an MS uses the Generic Access Network, the use of IKEv2 with certificates
for authentication is mandated. In order to perform testing, the SS shall use
a SEGW certificate detailed in clause 80 of [4], and the MS must establish a
trusted relationship with the SS using a CA root certificate.
## 13.2 Formal aspects
Whilst a test SIM is present the MS shall establish a trusted relationship
with an SS utilising the test CA root certificate detailed in clause 80 of
[4].
Whilst a test SIM is present, the MS may choose to establish a trust
relationship with other CA root certificates.
When a test SIM is not present the MS shall never trust the test CA root
certificate detailed in [4].
#
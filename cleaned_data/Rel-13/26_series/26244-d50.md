# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
The 3GPP transparent end-to-end packet-switched streaming service (PSS)
specification consists of seven 3GPP TSs: 3GPP TS 22.233 [1], 3GPP TS 26.233
[2], 3GPP TS 26.234 [3], 3GPP TS 26.245 [4], 3GPP TS 26.246 [5], 3GPP TS
26.247 [49] and the present document.
The TS 22.233 contains the service requirements for the PSS. The TS 26.233
provides an overview of the PSS. The TS 26.234 provides the details of
protocol and codecs used by the PSS. The TS 26.245 defines the Timed text
format used by the PSS. The TS 26.246 defines the 3GPP SMIL language profile.
The 3GPP TS 26.247 defines Progressive Download and Dynamic Adaptive Streaming
over HTTP. The present document defines the 3GPP file format (3GP) used by the
PPS and MMS services.
The TS 26.244 (present document), TS 26.245 and TS 26.246 started with Release
6. Earlier releases of the 3GPP file format, the Timed text format and the
3GPP SMIL language profile can be found in TS 26.234. The 3GPP TS 26.247
started with Release-10. Earlier releases of the Adaptive HTTP Streaming can
be found in 3GPP TS 26.234.
# Introduction
A file format contains data in a structured way. The 3GPP file format can
contain timing, structure and media data for multimedia streams. It is used by
MMS, PSS and MBMS for timed visual and aural multimedia.
# 1 Scope
The present document defines the 3GPP file format (3GP) as an instance of the
ISO base media file format. The definition addresses 3GPP specific features
such as codec registration and conformance within the MMS, PSS and MBMS
services.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TS 22.233: \"Transparent End-to-End Packet-switched Streaming
Service; Stage 1\".
[2] 3GPP TS 26.233: \"Transparent end-to-end packet switched streaming service
(PSS); General description\".
[3] 3GPP TS 26.234: \"Transparent end-to-end packet switched streaming service
(PSS); Protocols and codecs\".
[4] 3GPP TS 26.245: \"Transparent end-to-end packet switched streaming service
(PSS); Timed text format\".
[5] 3GPP TS 26.246: \"Transparent end-to-end packet switched streaming service
(PSS); 3GPP SMIL Language Profile\".
[6] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[7] ISO/IEC 14496-12:2012 \| 15444-12:2012: \"Information technology - Coding
of audio-visual objects - Part 12: ISO base media file format\" \|
\"Information technology - JPEG 2000 image coding system - Part 12: ISO base
media file format\".
[8] 3GPP TS 26.140: \"Multimedia Messaging Service (MMS); Media formats and
codecs\".
[9] ITU-T Recommendation H.263 (01/05): \"Video coding for low bit rate
communication\".
[10] ISO/IEC 14496-2:2004: \"Information technology -- Coding of audio-visual
objects -- Part 2: Visual\".
[11] 3GPP TS 26.071: \"Mandatory Speech CODEC speech processing functions; AMR
Speech CODEC; General description\".
[12] 3GPP TS 26.171: \"AMR Wideband Speech Codec; General Description\".
[13] ISO/IEC 14496-3:2005: \"Information technology -- Coding of audio-visual
objects -- Part 3: Audio\".
[14] ISO/IEC 14496-14:2003: \"Information technology -- Coding of audio-visual
objects -- Part 14: MP4 file format\".
[15] IETF RFC 4867: \" RTP Payload Format and File Storage Format for the
Adaptive Multi-Rate (AMR) Adaptive Multi-Rate Wideband (AMR-WB) Audio
Codecs\", Sjoberg J. et al., April 2007.
[16] 3GPP TS 26.101: \"Mandatory Speech Codec speech processing functions;
Adaptive Multi-Rate (AMR) speech codec frame structure\".
[17] 3GPP TS 26.201: \"Speech Codec speech processing functions; AMR Wideband
Speech Codec; Frame Structure\".
[18] void
[19] IETF RFC 3711: \"The Secure Real-time Transport Protocol\", Baugher M. et
al., March 2004.
[20] ISO/IEC 14496-15: \"Information technology -- Coding of audio-visual
objects -- Part 15: Carriage of NAL unit structured video in the ISO base
media file format\".
[21] 3GPP TS 26.290: \"Extended AMR Wideband codec; Transcoding functions\".
[22] void
[23] 3GPP TS 26.401: \"General audio codec audio processing functions;
Enhanced aacPlus general audio codec; General description\".
[24] 3GPP TS 26.410: \"General audio codec audio processing functions;
Enhanced aacPlus general audio codec; Floating-point ANSI-C code\".
[25] 3GPP TS 26.411: \"General audio codec audio processing functions;
Enhanced aacPlus general audio codec; Fixed-point ANSI-C code\".
[26] void
[27] IETF RFC 3839: \"MIME Type Registrations for 3^rd^ Generation Partnership
Project (3GPP) Multimedia files\", Castagno R. and Singer D., July 2004.
[28] IETF RFC 4396: \"RTP Payload Format for 3rd Generation Partnership
Project (3GPP) Timed Text\", Rey J. and Matsui Y., February 2006.
[29] ITU-T Recommendation H.264 (04/2013): \"Advanced video coding for generic
audiovisual services\".
[30] IETF RFC 6184: \"RTP Payload Format for H.264 Video\", Wang Y.-K. et al,
May 2011.
[31] IETF RFC 4234: \"Augmented BNF for Syntax Specifications: ABNF\", Crocker
D. and Overell P., October 2005.
[32] MP4REG, MP4 Registration Authority, www.mp4ra.org.
[33] ID3v2, http://www.id3.org/.
[34] IETF RFC 6381: \"The \'Codecs\' and \'Profiles\' Parameters for
``Bucket´´ Media Types\", Gellens R., Singer D. and Frojdh P., August 2011.
[35] IETF RFC 4648: \"The Base16, Base32, and Base64 Data Encodings\",
Josefsson S., October 2006.
[36] 3GPP TS 26.142: \"Dynamic and Interactive Multimedia Scene\".
[37] Open Mobile Alliance: \"DRM Specification 2.0\".
[38] ISO/IEC 14496-12:2008/PDAM1: \"Part 12: ISO base media file
format/AMENDMENT 1: General improvements including hint tracks, metadata
support, and sample groups\".
[39] 3GPP TS 33.246: "Security of Multimedia Broadcast/Multicast Service
(MBMS)".
[40] 3GPP TS 26.346: "Multimedia Broadcast/Multicast Service (MBMS); Protocols
and codecs".
[41] void
[42] IETF RFC 4288: \"Media Type Specifications and Registration Procedures\",
Freed N. and Klensin J., December 2005.
[43] IETF RFC 5322: "Internet Message Format", Resnick, P. October 2008.
[44] IETF RFC 5234: "Augmented BNF for Syntax Specifications: ABNF", Crocker
D., Overell, P., January 2008.
[45] IETF RFC 2045: "Multipurpose Internet Mail Extensions, (MIME) Part One:
Format of Internet Message Bodies", Freed, N., Borenstein, N., November 1996.
[46] IETF RFC 3926: \"FLUTE - File Delivery over Unidirectional Transport\",
Paila T., Luby M., Lehtonen R., Roca V., and Walsh R., October 2004.
[47] void
[48] IETF RFC 2616: \"Hypertext Transfer Protocol -- HTTP/1.1\", Fielding R.
et al., June 1999.
[49] 3GPP TS 26.247: "Transparent end-to-end Packet-switched Streaming Service
(PSS); Progressive Download and Dynamic Adaptive Streaming over HTTP (3GP-
DASH)".
[50] 3GPP TS 26.114: \"IP Multimedia Subsystem (IMS); Multimedia telephony;
Media handling and interaction\".
[51] Recommendation ITU-T H.265 (12/2016): \"High efficiency video coding\" \|
ISO/IEC 23008-2:2015: \"High Efficiency Coding and Media Delivery in
Heterogeneous Environments -- Part 2: High Efficiency Video Coding\".
[52] IETF RFC 7798 (2016): \"RTP Payload Format for High Efficiency Video
Coding (HEVC)\", Y.-K. Wang, Y. Sanchez, T. Schierl, S. Wenger, M. M.
Hannuksela.
[53] ISO/IEC 23001-10:2015 \"Information technology -- MPEG systems
technologies -- Part 10: Carriage of Timed Metadata Metrics of Media in ISO
Base Media File Format\".
[54] 3GPP TR 26.938: "Packet-switched Streaming Service (PSS); Improved
support for dynamic adaptive streaming over HTTP in 3GPP".
[55] 3GPP TS 26.445: \"Codec for Enhanced Voice Services (EVS); Detailed
Algorithmic Description\".
[56] 3GPP TS 26.116: \"TV Video Profiles\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the following terms and definitions
apply:
**continuous media:** media with an inherent notion of time. In the present
document speech, audio, video, timed text and DIMS
**discrete media:** media that itself does not contain an element of time. In
the present document all media not defined as continuous media
**PSS client:** client for the 3GPP packet switched streaming service based on
the IETF RTSP/SDP and/or HTTP standards, with possible additional 3GPP
requirements according to [3]
**PSS server:** server for the 3GPP packet switched streaming service based on
the IETF RTSP/SDP and/or HTTP standards, with possible additional 3GPP
requirements according to [3]
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [6] and the following apply.
3GP 3GPP file format
AAC Advanced Audio Coding
> AMR Adaptive Multi-Rate Codec
>
> AMR-WB Adaptive Multi-Rate Wideband Codec
AMR-WB+ Extended Adaptive Multi-Rate Wideband Codec
AVC Advanced Video Coding
ADU Application Data Unit
BIFS Binary Format for Scenes
CVO Coordination of Video Orientation
DIMS Dynamic and Interactive Multimedia Scenes
Enhanced aacPlus MPEG-4 High Efficiency AAC plus MPEG-4 Parametric Stereo
> EVS Enhanced Voice Services
FLUTE File Delivery over Unidirectional Transport
HEVC High Efficiency Video Coding
HTTP HyperText Transport Protocol
ITU-T International Telecommunications Union -- Telecommunications
MIKEY Multimedia Internet KEYing
MIME Multipurpose Internet Mail Extensions
MMS Multimedia Messaging Service
MP4 MPEG-4 file format
MPD Media Presentation Description
PSS Packet-switched Streaming Service
RAP Random Access Point
RTP Real-time Transport Protocol
RTSP Real-Time Streaming Protocol
SDP Session Description Protocol
SRTP Secure Real-time Transport Protocol
URL Uniform Resource Locator
# 4 Overview
The 3GPP file format (3GP) is defined in this specification as an instance of
the ISO base media file format [7]. 3GP is mandated in [8] to be used for
continuous media along the entire delivery chain envisaged by the MMS,
independent of whether the final delivery is done by streaming or download,
thus enhancing interoperability.
In particular, the following stages are considered:
\- upload from the originating terminal to the MMS proxy;
\- file exchange between MMS servers;
\- transfer of the media content to the receiving terminal, either by file
download , by streaming or MBMS download delivery [40]. In the first and last
case the self-contained file is transferred, whereas in the second case, for
RTP streaming, the content is extracted from the file and streamed according
to open payload formats. In this case, no trace of the file format remains in
the content that goes on the wire/in the air. In segmented streaming over DASH
[49], the file is divided into segments for transfer.
For the PSS, the 3GPP file format is mandated in [3] to be used for timed text
and it should be supported by PSS servers; 3GP files with streaming-server
extensions should be used for storage in streaming servers and the \"hint
track\" mechanism should be used for the preparation for streaming. For
Adaptive HTTP Streaming, HTTP streaming extensions are defined.
# 5 Conformance
## 5.1 General
The 3GPP file format is structurally based on the ISO base media file format
defined in [7]. However, the conformance statement for 3GP files is defined
here by addressing constraints and extensions to the ISO base media file
format, registration of codecs, file identification (file extension, brand
identifier and MIME type) and profiles. If a 3GP file contains codecs or
functionalities not conforming to this specification they may be ignored, i.e.
a 3GP compliant file parser may ignore non-compliant boxes.
## 5.2 Definition
### 5.2.1 Limitations to the ISO base media file format
The following limitation to the ISO base media file format [7] shall apply to
a 3GP file:
\- compact sample sizes (\'stz2\') shall not be used for tracks containing
H.263, MPEG-4 video, AMR, AMR-WB, AAC or Timed text.
NOTE: The extended presentation format (see clause 11) is defined by using the
Meta box of the ISO base media file format [7] that was not present in the
first edition. Hence, extended presentations in 3GP files are explicitly
signalled via the Extended-presentation profile (see clause 5.4.6).
### 5.2.2 Registration of codecs
Code streams for H.263 video [9], MPEG-4 video [10], H.264 (AVC) video [29],
H.265 (HEVC) video [51], AMR narrow-band speech [11], AMR wide-band speech
[12], Extended AMR wide-band audio [21], EVS [55], Enhanced aacPlus audio [23,
24, 25], MPEG-4 AAC audio [13], and timed text [4] can be included in 3GP
files as described in clause 6 of the present document.
### 5.2.3 Extensions
The following extensions to the ISO base media file format [7] can be used in
a 3GP file:
\- streaming-server extensions (see clause 7);
\- asset information (see clause 8);
\- video-buffer information (see clause 9);
\- AVC file format (see clause 5 of [20]), for which the use of sample entry
types other than \'avc1\' is disallowed;
\- MVC file format (see clause 7 of [20]);
\- H.265 (HEVC) file format (see clause 8 of [20]);
\- RTP and RTCP reception hint tracks (see [38]);
\- SRTP and SRTCP reception hint tracks with key management information for
SRTP recordings (see [38] and clause 12);
\- Quality metrics timed metadata track (see clause 4 of [53] and clause 16 of
this specification).
If SDP information is included in a 3GP file, it shall be used as defined by
the streaming-server extensions.
### 5.2.4 MPEG-4 systems specific elements
For the storage of MPEG-4 media specific information in 3GP files, this
specification refers to MP4 [14], the AVC file format as specified in clause 5
of [20], and the H.265 (HEVC) file format as specified in clause 8 of [20],
which are also based on the ISO base media file format. However, tracks
relative to MPEG-4 system architectural elements (e.g. BIFS scene description
tracks or OD Object descriptors) are optional in 3GP files and shall be
ignored. The inclusion of MPEG-4 media does not imply the usage of MPEG-4
systems architecture. Terminals and servers are not required to implement any
of the specific MPEG-4 system architectural elements.
### 5.2.5 Template fields
The ISO base media file format [7] defines the concept of template fields that
may be used by derived file formats. The template field "alternate group" can
be used in 3GP files, as defined in clause 7.2. No other template fields are
used.
### 5.2.6 Interpretation of the 3GPP file format
All index numbers used in the 3GPP file format start with the value one rather
than zero, in particular "first-chunk" in Sample to chunk box, "sample-number"
in Sync sample box and "shadowed-sample-number", "sync-sample-number" in
Shadow sync sample box.
## 5.3 Identification
### 5.3.1 General
3GP files can be identified using several mechanisms: file extension, MIME
types and brands.
### 5.3.2 File extension
When stored in traditional computer file systems, 3GP files should be given
the file extension \'.3gp\'. Readers should allow mixed case for the
alphabetic characters.
### 5.3.3 MIME types
The MIME types \'video/3gpp\' (for visual or audio/visual content, where
visual includes both video and timed text) and \'audio/3gpp\' (for purely
audio content) shall be used as defined in [27].
### 5.3.4 Brands
This specification defines several brand identifiers corresponding to the
profiles defined in clause 5.4. Brands are indicated in a file-type box,
defined in [7], which shall be present in conforming files. The fields of the
file-type box shall be used as follows:
**\- Brand** : Identifies the 'best use' of the file and should match the file
extension. For files with extension \'.3gp\' and conforming to this
specification, the brand shall be one of the profile brands defined in clause
5.4.
**\- MinorVersion** : This identifies the minor version of the brand. For
files with brand \'3gLZ\', where L is a letter and Z a digit, and conforming
to version Z.x.y of this specification, this field takes the value x*256 + y.
**\- CompatibleBrands** : a list of brand identifiers (to the end of the box).
Any profile of a 3GP file is declared by including the corresponding brand
from clause 5.4 in this list.
The brand identifier (of one of the profiles) must occur in the compatible-
brands list, and may also be the primary brand. Conformance to more than one
profile is indicated by listing the corresponding brands in the compatible-
brands list. If the file is also conformant to earlier releases of this
specification, it is recommended that the corresponding brands (\'3gp4\',
\'3gp5\', \'3gp6\', \'3gp7\' and/or \'3gp8\') also occur in the compatible-
brands list. If, for instance, \'3gp4\' is not in the compatible-brands list,
then the file will not be processed by a Release 4 reader. Readers should
check the compatible-brands list for the identifiers they recognize, and not
rely on the file having a particular primary brand, for maximum compatibility.
Files may be compatible with more than one brand, and have a \'best use\'
other than this specification, yet still be compatible with this
specification.
## 5.4 Profiles
### 5.4.1 General
All 3GP files of this release shall conform to the general definitions in
clauses 5.1-5.3. Additional profile-specific constraints are listed below. A
3GP file must conform to at least one profile and may conform to several
profiles.
### 5.4.2 General profile
The 3GP General profile is branded '3gg9' and is a superset of all other
profiles. It is used to identify 3GP files conformant to this specification,
although they may not conform to any of the specific profiles listed below.
NOTE: The General profile of 3GP has fewer restrictions than other profiles
and is suitable for files not yet ready to be delivered by MMS or to be
streamed by a PSS server. A General 3GP file may for instance contain several
alternative tracks of media. After extracting a suitable set of tracks the
file may be ready for MMS and can be re-profiled as a Basic file.
Alternatively, by adding streaming-server extensions, it may be re-profiled as
a Streaming-server profile.
### 5.4.3 Basic profile
The 3GP Basic profile is branded '3gp9'.
The following constraints shall apply to a 3GP file conforming to Basic
profile:
\- there shall be no references to external media outside the file, i.e. a
file shall be self-contained;
\- the maximum number of tracks shall be one for video (or alternatively one
for scene description), one for audio and one for text;
\- the maximum number of sample entries shall be one per track for video and
audio (but unrestricted for text and scene description);
\- there shall be no references between tracks, e.g., a scene description
track shall not refer to a media track since all tracks are on equal footing
and played in parallel by a conforming player.
NOTE 1: The Basic profile of 3GP in Release 6 or higher corresponds to 3GP
files of earlier releases, which did not define profiles.
NOTE 2: In order to maintain backward compatibility with Release 4 and Release
5, it is not recommended to use movie fragments in 3GP files for MMS.
NOTE 3: For H.264 (AVC) or H.265 (HEVC) video in a Basic profile 3GP file, the
restriction on the number of video tracks implies in particular that there
shall be no alternative tracks (including switching tracks) and no separate
tracks for parameter sets.
NOTE 4: For DIMS scene description in a Basic profile 3GP file, the
restriction on the number of scene description tracks implies in particular
that there shall be no separate tracks for redundant DIMS units.
NOTE 5: The handler types for tracks with video, audio, text and scene
description are 'vide', 'soun', 'text', and 'sdsm', respectively.
### 5.4.4 Streaming-server profile
The 3GP Streaming-server profile is branded '3gs9' and is used in PSS.
Conformance to this profile will guarantee interoperability between content
creation tools and streaming servers, in particular for the selection of
alternative encodings of content and adaptation during streaming.
The following constraints shall apply to 3GP files conforming to Streaming-
server profile:
\- RTP hint tracks shall be included for all media tracks;
\- RTP hint tracks shall comply with streaming as specified by PSS [3];
\- SDP information shall be included, as specified in clause 7.5, where SDP
fragments shall be stored in the hint tracks with media-level control URLs
referring to (the same) hint tracks.
\- streaming-server extensions should be used for hint tracks, as defined in
chapter 7.
The following requirements shall apply to servers conforming to this profile.
A conforming server
\- shall understand and respect directions given in the streaming-server
extensions, as defined in chapter 7;
\- should understand hint tracks;
\- may override instructions in hint tracks.
NOTE 1: The instructions given in RTP hint tracks shall be consistent with the
PSS. In particular, sending times of RTP packets shall respect buffer
constraints and be consistent with parameters used in SDP.
NOTE 2: Earlier releases of the 3GPP file format did not define streaming-
server extensions or profiles. The usage of hint tracks was an internal
implementation matter for servers outside the scope of the PSS specification.
### 5.4.5 Progressive-download profile
The 3GP Progressive-download profile is branded '3gr9'. It is used to label
3GP files that are suitable for progressive download, i.e. a scenario where a
file may be played during download (with some delay).
The following constraints shall apply to 3GP files conforming to Progressive-
download profile:
\- the 'moov' box shall be placed right after the 'ftyp' box in the beginning
of the file;
\- all media tracks (if more than one) shall be interleaved with an
interleaving depth of one second or less.
NOTE 1: This profile functions as an aid and not a requirement for progressive
download, which has been an inherent feature of the 3GPP file format since the
first version in Release 4. By parsing a 3GP file, a client can always
determine whether a file can be progressively downloaded, and then calculate
the interleaving depth from the meta-data in the 'moov' box.
NOTE 2: The 'interleaving depth of one second or less' means that:
\- Each chunk contains one or more samples, with the total duration of the
samples being either: no greater than 1 second, or the duration of a single
sample if that sample's duration is greater than 1 second;
\- Within a track, chunks must be in decoding time order within the media-data
box 'mdat';
\- It is recommended that, in 'mdat', regardless of media type, the chunks for
all tracks are stored in ascending order by decoding time. However, this order
may be perturbed so that, when two chunks from different tracks overlap in
time, the chunk of one track (e.g. audio) is stored before the chunk of the
other track (e.g. video), even if the first sample in the second track has a
slightly earlier timestamp than the first sample in the first track.
### 5.4.6 Extended-presentation profile
The 3GP Extended-presentation profile is branded '3ge9'. It enables a 3GP file
to carry any kind of multimedia presentation composed of tracks, media files
and a scene description.
The following constraint shall apply to 3GP files conforming to Extended-
presentation profile:
\- there shall be an extended presentation as defined in clause 11.
The following requirement shall apply to a player conforming to this profile.
A conforming player
\- shall render the content of the 3GP file as prescribed by the contained
scene description (primary item).
NOTE: The scene description can address resources by using URLs as described
in clause 11.3. In particular, it can refer to media in tracks and items and
also to scene description updates in scene description tracks.
### 5.4.7 Media Stream Recording profile
The 3GP Media Stream Recording Profile is branded '3gt9'. It is used to label
3GP files that contain recordings of multimedia streams, e.g., from a PSS or
an MBMS session.
The following constraints apply to 3GP files conforming to the Media Stream
Recording Profile:
\- Non-protected media streams may be contained in RTP reception hint tracks
or in media tracks or in both as specified in [38]
\- One RTCP hint track per media stream may be contained as specified in [38].
\- Protected media data may be contained in SRTP reception hint tracks as
specified in [38].
\- Control information, i.e., SRTCP sender reports, necessary to render the
protected media in SRTP reception hint tracks shall be contained in one SRTCP
reception hint track per SRTP reception hint tracks specified in [38].
\- MIKEY MBMS Traffic Key messages [39] necessary to access the information
stored in SRTP and SRTCP reception hint tracks shall be contained in key
message tracks as described in clause 12.2.
\- Key management information necessary to render the content of the 3GP file
shall be contained as described in clause 12.2, provided that at least one
SRTP reception hint track is present.
\- SDP information shall be included as specified in clause 12.3.
The following requirements shall apply to 3GP players conforming to this
profile. A conforming player:
\- shall be able to reconstruct the received media stream from media tracks
and RTP/RTCP hint tracks.
\- shall be able to extract the unprotected content from the 3GP file,
provided that the player has access to required MBMS Service Keys or is able
to obtain these using the methods specified in [39].
### 5.4.8 File-delivery server profile
The File-delivery server profile is branded '3gf9'. Conformance to this
profile will guarantee interoperability between content creation tools and
file delivery servers.
The following constraints shall apply to 3GP files conforming to File-delivery
server profile:
\- File Delivery Hint Tracks and File Delivery Format Extensions, as specified
in [7], shall be used for files intended for transmission over FLUTE [42].
The following requirements shall apply to servers conforming to this profile.
\- A conforming server shall understand and respect Filed Delivery Hint Tracks
and File Delivery Format Extensions, as specified in [7].
### 5.4.9 Adaptive-Streaming profile
The 3GP Adaptive-Streaming profile is branded '3gh9'. It is used to label 3GP
files that are primarily suitable for adaptive file-based streaming.
The following constraints shall apply to 3GP files conforming to Adaptive-
Streaming profile:
\- the 'moov' box shall be placed in the beginning of the file right after the
'ftyp' box and a possibly present 'pdin' box;
\- all movie data shall be contained in Movie Fragments, i.e. the tracks in
the 'moov' box shall not contain any samples (i.e. the entry_count in the
"stts", "stsc", and "stco" boxes shall be set to 0).
\- the 'moov' box shall contain an 'mvex' box to indicate the presence of
movie fragments.
\- the 'moov' box shall be followed by one or more 'moof' and optionally
'mdat' box pairs.
\- each 'moof' box shall contain at least one track fragment.
\- The 'moof' boxes shall use movie-fragment relative addressing for media
data that does not use external data references and the flag 'default-base-is-
moof' shall also be set; absolute byte-offsets shall not be used for this
media data. In a movie fragment, the durations by which each track extends
should be as close to equal as practical. In particular, as movie fragments
are accumulated, the track durations should remain close to each other and
there should be no \'drift\'.
\- For any track, any \'tfad\' or any \'tfdt\' box, if present, shall
duplicate the operations of a possibly present \'elst\' box; when any \'tfad\'
or any \'tfdt\' is used, the \'elst\' box, if present, shall be ignored.
3GP files conforming to this profile may contain:
\- segment ('styp') type boxes as specified in clause 13.2,
\- track fragment adjustment ('tfad') boxes as specified in clause 13.3, and
\- segment index ('sidx') boxes as specified in clause 13.4,
\- track fragment decode time ('tfdt') as specified in clause 13.5.
If the 'meta' box is present and contains the Media Presentation Description
(MPD as defined in TS 26.234 [3]) then the 'meta' box shall be contained
within the 'moov' box. In this case the 'meta' box shall contain a \'hdlr\'
box with handler_type \'mpd \' followed by an \'xml \' box containing the MPD.
If the \'meta\' box is present and contains a link to the MPD, then the
\'meta\' box shall be contained within the \'moov\' box. In this case the
\'meta\' box shall contain a \'hdlr\' box with handler_type \'mpdl\' followed
by a \'dinf\' box. The \'dinf\' box shall contain a \'dref\' box with exactly
one entry, which is a \'url \' box containing the URL of the MPD.
### 5.4.10 Media Segment Profile
The 3GP Media Segment profile is branded '3gm9'. It is used to label segments
conforming to this release. Media Segments are defined in 3GPP TS 26.247 [49].
## 5.5 File-branding guidelines
The file-type brands defined in this specification are used to label 3GP files
belonging to this release and conforming to one or more profiles. 3GP files
may also conform to earlier Releases or even to other file formats, such as
MP4, which is also derived from the ISO base media file format [7].
Table 5.1 contains a non-exhaustive list of examples with 3GP files for
various purposes. Note, however, that it only gives typical or suggested uses.
Both writers and readers of files should exercise care when using brand
identifiers. It is worth repeating the general guidelines here, remembering
that a brand identifies a specification or a conformance point in a
specification; its presence in a file indicates both:
\- that the file conforms to the specification; it includes everything
required by, and nothing contrary to the specification (though there may be
other material);
\- that a reader implementing that specification (possibly only that
specification) is given permission to read and interpret the file.
All 3GP files of Release 5 or later shall contain the compatible brand 'isom'
indicating that they conform to the ISO base media file format, unless the
reader is required to interpret extensions specific to the AVC file format as
specified in clause 5 of [20], for which case the compatible brand 'avc1'
shall be used instead (see note 2), or extensions specific to extended
presentations (see clause 11), for which case the compatible brand 'iso2'
shall be used (see note 3). The major brand shall be included in the
compatible brands list as well. If a file contains more than one (3GPP) brand
in the compatible brands list, the major brand indicates the "best use" of the
file. For example, a Release-5 file with audio combined with Timed text is
best played by a Release-5 player, but may also be played by a Release-4
player that does not support timed text.
NOTE 1: Since movie fragments are not allowed in Release 4 and Release 5, a
fragmented 3GP file should not contain '3gp4' or '3gp5' as brand or compatible
brand. A player that does not support movie fragments will only be able to
play the first fragment of a fragmented file.
NOTE 2: Consider the brands 'isom' and 'avc1'. The first indicates conformance
to the base structure of the ISO base media file format [7]. The second
indicates conformance to the structures such as sample groups [7]. A file
labelled as 'isom' and 'avc1' conformant is indicating that either these
extensions are not present, or if present, they can be ignored (as an 'isom'
reader will not understand them). If the writer desires that only readers
supporting the extensions read a file, then the 'isom' brand would be omitted.
These extensions are all optional (i.e. none are required to be in a file,
though if they are, an 'avc1'-conformant reader must interpret them), and
therefore a file not using them is still 'avc1' conformant.
NOTE 3: The second version of the ISO base media file format defines the brand
'iso2' that in addition to 'isom' indicates conformance to extensions to the
first version.
Table 5.1: Examples of brand usage in 3GP files
* * *
Conformance Suffix Brand Compatible brands Example content MMS and download:
Files shall contain one or more of the brands 3gp4, 3gp5, 3gp6, 3gp7 and 3gp8.
It is good practice to include compatible brands of earlier releases to enable
legacy players to play the files.  
Release 4 .3gp 3gp4 3gp4 H.263 and AMR Release 5, 4 .3gp 3gp5 3gp5, 3gp4, isom
H.263 and AMR Release 6, 5, 4 .3gp 3gp6 3gp6, 3gp5, 3gp4, isom H.263 and AMR
Release 7, 6, 5, 4 .3gp 3gp7 3gp7, 3gp6, 3gp5, 3gp4, isom H.263 and AMR
Release 8, 7, 6, 5, 4 .3gp 3gp8 3gp8, 3gp7, 3gp6, 3gp5, 3gp4, isom H.263 and
AMR Release 6, 5, 4 .3gp 3gp6 3gp6, 3gp5, 3gp4, isom H.263, AMR and Timed text
Release 6, 5 .3gp 3gp6 3gp6, 3gp5, isom Timed text Release 6 .3gp 3gp6 3gp6,
isom H.264 (AVC) Baseline profile and AMR Release 6 .3gp 3gp6 3gp6, isom
fragmented H.263 and AMR Release 7 .3gp 3gp7 3gp7, isom DIMS and AMR
Progressive download and MMS  
Release 6, 5, 4 .3gp 3gr6 3gr6, 3gp6, 3gp5, 3gp4, isom H.263 Release 6, 5, 4
.3gp 3gr6 3gr6, 3gp6, 3gp5, 3gp4, isom interleaved H.263 and AMR Release 6
.3gp 3gr6 3gr6, 3gp6, isom fragmented and interleaved H.263 and AMR Release 6
.3gp 3gr6 3gr6, 3gp6, avc1 interleaved H.264 (AVC) Baseline profile and AMR
Streaming servers: Some files may in principle also be used for MMS or
download.  
Release 6 .3gp 3gs6 3gs6, isom AMR and hint track Release 6 .3gp 3gs6 3gs6,
isom 2 tracks H.263 and 2 hint tracks Release 6, 5, 4 .3gp 3gs6 3gs6, 3gp6,
3gp5, 3gp4, isom H.263, AMR and hint tracks
Extended presentations:  
Release 7, 6 .3gp 3ge7 3ge7, 3ge6, iso2 SMIL, AMR and JPEG images Release 7
.3gp 3ge7 3ge7, iso2 DIMS, AMR, H.264 (AVC) Baseline profile and JPEG images
General purpose: Files that are not yet suitable for MMS, download or PSS
streaming servers.  
Release 6 .3gp 3gg6 3gg6, isom 4 tracks H.263 (and no hint tracks) Release 6
.3gp 3gg6 3gg6, isom 2 tracks H.263, 3 tracks AMR
3GP file, also conforming to MP4  
Release 4, 5 and MP4 .3gp 3gp5 3gp5, 3gp4, mp42, isom MPEG-4 video
MP4 file, also conforming to 3GP  
Release 5 and MP4 .mp4 mp42 mp42, 3gp5, isom MPEG-4 video and AAC
Media Stream Recording file  
Release 8 .3gp 3gt8 3gt8, isom SRTP reception hint and key message tracks
Release 8 .3gp 3gt8 3gt8, isom H.264 (AVC) Baseline profile and corresponding
RTP reception hint track, reception hint track for AAC Release 9 .3gp 3gt9
3gt9, isom H.264 (AVC) High Profile and corresponding RTP reception hint
track, reception hint track for AAC Adaptive HTTP Streaming:  
Release 9 .3gp 3gh9 3gp6, 3gp7, 3gp8, 3ge7, isom 7 H.264 (AVC) tracks at
different bitrates in one alternate track group, 3 AAC tracks with different
languages in one alternate group, no hint tracks, movie fragments
* * *
# 6 Codec registration
## 6.1 General
The purpose of this clause is to define the necessary structure for
integration of the H.263, MPEG-4 Visual, AMR, AMR-WB, Extended AMR-WB (AMR-
WB+), EVS, Enhanced aacPlus and AAC media specific information in a 3GP file.
Clause 6.2 gives some background information about the Sample Description box
in the ISO base media file format [7] and clauses 6.3 and 6.4 about the
MP4VisualSampleEntry box and the MP4AudioSampleEntry box in the MPEG-4 file
format [14]. The definitions of the Sample Entry boxes for AMR, AMR-WB, AMR-
WB+ and H.263 are given in clauses 6.5 to 6.10. The definition of the Sample
Entry box for EVS is given in clause 6.14. The integration of timed text in a
3GP file is specified in [4], the integration of H.264 (AVC) is specified in
[20], the integration of H.265 (HEVC) is specified in clause 8 of [20], the
integration of Quality metrics timed metadata track is specified in clause 4
of [53] and clause 16 of this specification and the integration of DIMS is
specified in [36] and clauses 5.4.3, 5.4.6 and 11 of the present document.
Requirements for integrating video codecs in the context of the TV Video
Profile are documented in TS 26.116 [56].
AMR and AMR-WB data is stored in the stream according to the AMR and AMR-WB
storage format for single channel header of Annex E [15], without the AMR
magic numbers. The 3GPP file format is the native storage format for AMR-WB+.
The data stream, stored in samples of a 3GP file, shall be formatted according
to clause 8.3 of [21]. Each sample contains one or more AMR-WB+ storage units.
The number of storage units per sample may differ from sample to sample.
For EVS each sample of the media is one speech frame block as specified in
Annex A.2.6.2 of [55]. A speech frame block consists of N ToC entries and N
speech frames, where N is the value of channelcount in the EVSSampleEntry box
specified in clause 6.14 of the present document.
## 6.2 Sample Description box
In an ISO file, Sample Description Box gives detailed information about the
coding type used, and any initialisation information needed for that coding.
The Sample Description Box can be found in the ISO file format Box Structure
Hierarchy shown in figure 6.1.
Figure 6.1: ISO File Format Box Structure Hierarchy
The Sample Description Box can have one or more Sample Entries.
Valid Sample Entries already defined for ISO and MP4 include
MP4AudioSampleEntry, MP4VisualSampleEntry and HintSampleEntry. Other Sample
Entries shall be according to the following:
\- AMR, AMR-WB AMRSampleEntry
\- AMR-WB+ AMRWPSampleEntry
\- EVS EVSSampleEntry
\- H.263 H263SampleEntry
\- H.264(AVC) AVCSampleEntry
\- H.265(HEVC) HEVCSampleEntry
\- Timed text TextSampleEntry
\- DIMS DIMSSampleEntry
\- CVO timed metadata CVOSampleEntry
\- Location timed metadata LocationSampleEntry
\- Quality metrics timed metadata QualityMetricsSampleEntry
\- Orientation timed metadata OrientationSampleEntry
The format of SampleEntry and its fields are explained as follows:
**SampleEntry ::= MP4VisualSampleEntry \|\ MP4AudioSampleEntry \|\
AMRSampleEntry \|\ AMRWPSampleEntry \|**
**EVSSampleEntry \|\ H263SampleEntry \|\ AVCSampleEntry \|\ TextSampleEntry
\|\ DIMSSampleEntry \|\ HintSampleEntry \|\ CVOSampleEntry \|\ HEVCSampleEntry
\|\ LocationSampleEntry \|**
**QualityMetricsSampleEntry \|**
**OrientationSampleEntry**
Table 6.1: SampleEntry fields
* * *
Field Type Details Value MP4VisualSampleEntry Entry type for visual samples
defined in the MP4 specification.  
MP4AudioSampleEntry Entry type for audio samples defined in the MP4
specification.  
AMRSampleEntry Entry type for AMR and AMR-WB speech samples defined in clause
6.5 of the present document.  
AMRWPSampleEntry Entry type for AMR-WB+ audio samples defined in clause 6.9 of
the present document.  
EVSSampleEntry Entry type for EVS samples defined in clause 6.14 of the
present document.  
H263SampleEntry Entry type for H.263 visual samples defined in clause 6.6 of
the present document.  
AVCSampleEntry Entry type for H.264 (AVC) visual samples defined in the AVC
file format specification in clause 5 of [20].  
TextSampleEntry Entry type for timed text samples defined in the timed text
specification  
DIMSSampleEntry Entry type for DIMS scene description samples defined in the
DIMS specification.  
HintSampleEntry Entry type for hint track samples defined in the ISO
specification.  
CVOSampleEntry Entry type for CVO timed metadata track as defined in clause
6.11 of the present document  
HEVCSampleEntry Entry type for H.265 (HEVC) visual samples defined in the
H.265 (HEVC) file format specification in clause 8 of [20].  
LocationSampleEntry Entry type for Location timed metadata track as defined in
clause 6.12 of the present document  
QualityMetricsSampleEntry Entry type for Quality metrics timed metadata track
as defined in clause 4 of [53]  
OrientationSampleEntry Entry type for Orientation timed metadata track as
defined in clause 6.13 of the present document
* * *
From the Sample Entries in Table 6.1, only the MP4VisualSampleEntry,
MP4AudioSampleEntry, H263SampleEntry, AMRSampleEntry, AMRWPSampleEntry,
EVSSampleEntry, CVOSampleEntry, LocationSampleEntry and OrientationSampleEntry
are taken into consideration here. TextSampleEntry is defined in [4],
HintSampleEntry in [7], AVCSampleEntry in clause 5 of [20], HEVCSampleEntry in
clause 8 of [20], QualityMetricsSampleEntry in clause 4 of [53] and
DIMSSampleEntry in [36].
## 6.3 MP4VisualSampleEntry box
The MP4VisualSampleEntry Box is defined as follows:
**MP4VisualSampleEntry ::= BoxHeader** \ Reserved_6\ Data-reference-index\
Reserved_16\ Width\ Height\ Reserved_4\ Reserved_4\ Reserved_4\ Reserved_2\
Reserved_32\ Reserved_2\ Reserved_2\ **ESDBox**
Table 6.2: MP4VisualSampleEntry fields
+-----------------+-----------------+-----------------+------------+ | Field | Type | Details | Value | +-----------------+-----------------+-----------------+------------+ | **B | Unsigned | | | | oxHeader**.Size | int(32) | | | +-----------------+-----------------+-----------------+------------+ | **B | Unsigned | | \'mp4v\' | | oxHeader**.Type | int(32) | | | +-----------------+-----------------+-----------------+------------+ | Reserved_6 | Unsigned int(8) | | 0 | | | [6] | | | +-----------------+-----------------+-----------------+------------+ | Data- | Unsigned | Index to a data | | | reference-index | int(16) | reference that | | | | | to use to | | | | | retrieve the | | | | | sample data. | | | | | Data references | | | | | are stored in | | | | | data reference | | | | | boxes. | | +-----------------+-----------------+-----------------+------------+ | Reserved_16 | Const unsigned | | 0 | | | int(32) [4] | | | +-----------------+-----------------+-----------------+------------+ | Width | Unsigned | Maximum width, | | | | int(16) | in pixels of | | | | | the stream | | +-----------------+-----------------+-----------------+------------+ | Height | Unsigned | Maximum height, | | | | int(16) | in pixels of | | | | | the stream | | +-----------------+-----------------+-----------------+------------+ | Reserved_4 | Const unsigned | | 0x00480000 | | | int(32) | | | +-----------------+-----------------+-----------------+------------+ | Reserved_4 | Const unsigned | | 0x00480000 | | | int(32) | | | +-----------------+-----------------+-----------------+------------+ | Reserved_4 | Const unsigned | | 0 | | | int(32) | | | +-----------------+-----------------+-----------------+------------+ | Reserved_2 | Const unsigned | | 1 | | | int(16) | | | +-----------------+-----------------+-----------------+------------+ | Reserved_32 | Const unsigned | | 0 | | | | | | | | int(8) [32] | | | +-----------------+-----------------+-----------------+------------+ | Reserved_2 | Const unsigned | | 24 | | | int(16) | | | +-----------------+-----------------+-----------------+------------+ | Reserved_2 | Const int(16) | | -1 | +-----------------+-----------------+-----------------+------------+ | **ESDBox** | | Box containing | | | | | an elementary | | | | | stream | | | | | descriptor for | | | | | this stream. | | +-----------------+-----------------+-----------------+------------+
The stream type specific information is in the ESDBox structure, as defined in
[14].
This version of the MP4VisualSampleEntry, with explicit width and height,
shall be used for MPEG-4 video streams conformant to this specification.
NOTE: width and height parameters together may be used to allocate the
necessary memory in the playback device without need to analyse the video
stream.
## 6.4 MP4AudioSampleEntry box
MP4AudioSampleEntryBox is defined as follows:
**MP4AudioSampleEntry ::= BoxHeader** \ Reserved_6\ Data-reference-index\
Reserved_8\ Reserved_2\ Reserved_2\ Reserved_4\ TimeScale\ Reserved_2\
**ESDBox**
Table 6.3: MP4AudioSampleEntry fields
* * *
Field Type Details Value **BoxHeader**.Size Unsigned int(32)  
**BoxHeader**.Type Unsigned int(32) \'mp4a\' Reserved_6 Unsigned int(8) [6] 0
Data-reference-index Unsigned int(16) Index to a data reference that to use to
retrieve the sample data. Data references are stored in data reference boxes.  
Reserved_8 Const unsigned int(32) [2] 0 Reserved_2 Const unsigned int(16) 2
Reserved_2 Const unsigned int(16) 16 Reserved_4 Const unsigned int(32) 0
TimeScale Unsigned int(16) Copied from track  
Reserved_2 Const unsigned int(16) 0 **ESDBox** Box containing an elementary
stream descriptor for this stream.
* * *
The stream type specific information is in the ESDBox structure, as defined in
[14]. Enhanced aacPlus stored in .3GP files shall not use implicit signalling
(as defined in [13]).
## 6.5 AMRSampleEntry box
For narrow-band AMR, the box type of the AMRSampleEntry Box shall be \'samr\'.
For AMR wideband (AMR-WB), the box type of the AMRSampleEntry Box shall be
\'sawb\'.
The AMRSampleEntry Box is defined as follows:
**AMRSampleEntry ::= BoxHeader** \ Reserved_6\ Data-reference-index\
Reserved_8\ Reserved_2\ Reserved_2\ Reserved_4\ TimeScale\ Reserved_2\
**AMRSpecificBox**
Table 6.4: AMRSampleEntry fields
* * *
Field Type Details Value **BoxHeader**.Size Unsigned int(32)  
**BoxHeader**.Type Unsigned int(32) \'samr\' or 'sawb' Reserved_6 Unsigned
int(8) [6] 0 Data-reference-index Unsigned int(16) Index to a data reference
that to use to retrieve the sample data. Data references are stored in data
reference boxes.  
Reserved_8 Const unsigned int(32) [2] 0 Reserved_2 Const unsigned int(16) 2
Reserved_2 Const unsigned int(16) 16 Reserved_4 Const unsigned int(32) 0
TimeScale Unsigned int(16) Copied from media header box of this media  
Reserved_2 Const unsigned int(16) 0 **AMRSpecificBox** Information specific to
the decoder.
* * *
If one compares the MP4AudioSampleEntry Box - AMRSampleEntry Box the main
difference is in the replacement of the ESDBox, which is specific to MPEG-4
systems, with a box suitable for AMR and AMR-WB. The **AMRSpecificBox** field
structure is described in clause 6.7.
## 6.6 H263SampleEntry box
The box type of the H263SampleEntry Box shall be \'s263\'.
The H263SampleEntry Box is defined as follows:
**H263SampleEntry ::= BoxHeader\ ** Reserved_6\ Data-reference-index\
Reserved_16\ Width\ Height\ Reserved_4\ Reserved_4\ Reserved_4\ Reserved_2\
Reserved_32\ Reserved_2\ Reserved_2\** H263SpecificBox**
Table 6.5: H263SampleEntry fields
+-----------------+-----------------+-----------------+------------+ | Field | Type | Details | Value | +-----------------+-----------------+-----------------+------------+ | **B | Unsigned | | | | oxHeader**.Size | int(32) | | | +-----------------+-----------------+-----------------+------------+ | **B | Unsigned | | \'s263\' | | oxHeader**.Type | int(32) | | | +-----------------+-----------------+-----------------+------------+ | Reserved_6 | Unsigned int(8) | | 0 | | | [6] | | | +-----------------+-----------------+-----------------+------------+ | Data- | Unsigned | Index to a data | | | reference-index | int(16) | reference that | | | | | to use to | | | | | retrieve the | | | | | sample data. | | | | | Data references | | | | | are stored in | | | | | data reference | | | | | boxes. | | +-----------------+-----------------+-----------------+------------+ | Reserved_16 | Const unsigned | | 0 | | | int(32) [4] | | | +-----------------+-----------------+-----------------+------------+ | Width | Unsigned | Maximum width, | | | | int(16) | in pixels of | | | | | the stream | | +-----------------+-----------------+-----------------+------------+ | Height | Unsigned | Maximum height, | | | | int(16) | in pixels of | | | | | the stream | | +-----------------+-----------------+-----------------+------------+ | Reserved_4 | Const unsigned | | 0x00480000 | | | int(32) | | | +-----------------+-----------------+-----------------+------------+ | Reserved_4 | Const unsigned | | 0x00480000 | | | int(32) | | | +-----------------+-----------------+-----------------+------------+ | Reserved_4 | Const unsigned | | 0 | | | int(32) | | | +-----------------+-----------------+-----------------+------------+ | Reserved_2 | Const unsigned | | 1 | | | int(16) | | | +-----------------+-----------------+-----------------+------------+ | Reserved_32 | Const unsigned | | 0 | | | | | | | | int(8) [32] | | | +-----------------+-----------------+-----------------+------------+ | Reserved_2 | Const unsigned | | 24 | | | int(16) | | | +-----------------+-----------------+-----------------+------------+ | Reserved_2 | Const int(16) | | -1 | +-----------------+-----------------+-----------------+------------+ | **H2 | | Information | | | 63SpecificBox** | | specific to the | | | | | H.263 decoder. | | +-----------------+-----------------+-----------------+------------+
If one compares the MP4VisualSampleEntry -- H263SampleEntry Box the main
difference is in the replacement of the ESDBox, which is specific to MPEG-4
systems, with a box suitable for H.263. The **H263SpecificBox** field
structure for H.263 is described in clause 6.8.
## 6.7 AMRSpecificBox field for AMRSampleEntry box
The AMRSpecificBox fields for AMR and AMR-WB shall be as defined in table 6.6.
The AMRSpecificBox for the AMRSampleEntry Box shall always be included if the
3GP file contains AMR or AMR-WB media.
Table 6.6: The AMRSpecificBox fields for AMRSampleEntry
* * *
Field Type Details Value BoxHeader.Size Unsigned int(32)  
BoxHeader.Type Unsigned int(32) 'damr' DecSpecificInfo AMRDecSpecStruc
Structure which holds the AMR and AMR-WB Specific information
* * *
**BoxHeader Size and Type:** indicate the size and type of the AMR decoder-
specific box. The type must be 'damr'.
**DecSpecificInfo:** the structure where the AMR and AMR-WB stream specific
information resides.
The AMRDecSpecStruc is defined as follows:
_struct_ **AMRDecSpecStruc**{\ Unsigned int (32) **vendor** \ Unsigned int (8)
**decoder_version\ ** Unsigned int (16)** mode_set\ ** Unsigned int (8)
**mode_change_period\ ** Unsigned int (8)** frames_per_sample\ **}
The definitions of AMRDecSpecStruc members are as follows:
**vendor:** four character code of the manufacturer of the codec, e.g.
\'VXYZ\'. The vendor field gives information about the vendor whose codec is
used to create the encoded data. It is an informative field, which may be used
by the decoding end. If a manufacturer already has a four-character code, it
is recommended that it uses the same code in this field. Else, it is
recommended that the manufacturer creates a four character code which best
addresses the manufacturer's name. It can be safely ignored.
**decoder_version:** version of the vendor's decoder which can decode the
encoded stream in the best (i.e. optimal) way. This field is closely tied to
the vendor field. It may give advantage to the vendor which has optimal
encoder-decoder version pairs. The value is set to 0 if decoder version has no
importance for the vendor. It can be safely ignored.
**mode_set:** the active codec modes. Each bit of the mode_set parameter
corresponds to one mode. The bit index of the mode is calculated according to
the 4 bit FT field of the AMR or AMR-WB frame structure. The mode_set bit
structure is as follows: (B15xxxxxxB8B7xxxxxxB0) where B0 (Least Significant
Bit) corresponds to Mode 0, and B8 corresponds to Mode 8.
The mapping of existing AMR modes to FT is given in table 1.a in [16]. A value
of 0x81FF means all modes and comfort noise frames are possibly present in an
AMR stream.
The mapping of existing AMR-WB modes to FT is given in Table 1.a in TS 26.201
[17]. A value of 0x83FF means all modes and comfort noise frames are possibly
present in an AMR-WB stream.
As an example, if mode_set = 0000000110010101b, only Modes 0, 2, 4, 7 and 8
are present in the stream.
**mode_change_period:** defines a number N, which restricts the mode changes
only at a multiple of N frames. If no restriction is applied, this value
should be set to 0. If mode_change_period is not 0, the following restrictions
apply to it according to the frames_per_sample field:
_if (mode_change_period \  frames_per_sample)_
_mode_change_period = k x (frames_per_sample)_
_where k : integer [2, ...]_
If mode_change_period is equal to frames_per_sample, then the mode is the same
for all frames inside one sample.
**frames_per_sample:** defines the number of frames to be considered as \'one
sample\' inside the 3GP file. This number shall be greater than 0 and less
than 16. A value of 1 means each frame is treated as one sample. A value of 10
means that 10 frames (of duration 20 msec each) are put together and treated
as one sample. It must be noted that, in this case, one sample duration is 20
(msec/frame) x 10 (frame) = 200 msec. For the last sample of the stream, the
number of frames can be smaller than frames_per_sample, if the number of
remaining frames is smaller than frames_per_sample.
NOTE1: The \"hinter\", for the creation of the hint tracks, can use the
information given by the AMRDecSpecStruc members.
NOTE2: The following AMR MIME parameters are not relevant to PSS: {mode_set,
mode_change_period, mode_change_neighbor}. PSS servers should not send these
parameters in SDP, and PSS clients shall ignore these parameters if received.
## 6.8 H263SpecificBox field for H263SampleEntry box
The H263SpecificBox fields for H. 263 shall be as defined in table 6.7. The
H263SpecificBox for the H263SampleEntry Box shall always be included if the
3GP file contains H.263 media.
The H263SpecificBox for H263 is composed of the following fields.
Table 6.7: The H263SpecificBox fields H263SampleEntry
* * *
Field Type Details Value BoxHeader.Size Unsigned int(32)  
BoxHeader.Type Unsigned int(32) 'd263' DecSpecificInfo H263DecSpecStruc
Structure which holds the H.263 Specific information  
**BitrateBox** Specific bitrate information (optional)
* * *
**BoxHeader Size and Type:** indicate the size and type of the H.263 decoder-
specific box. The type must be 'd263'.
**DecSpecificInfo:** This is the structure where the H263 stream specific
information resides.
H263DecSpecStruc is defined as follows:
_struct_ **H263DecSpecStruc**{\ Unsigned int (32) **vendor\ ** Unsigned int
(8)** decoder_version\ ** Unsigned int (8) **H263_Level\ ** Unsigned int (8)**
H263_Profile**\ }
The definitions of H263DecSpecStruc members are as follows:
**vendor:** four character code of the manufacturer of the codec, e.g.
\'VXYZ\'. The vendor field gives information about the vendor whose codec is
used to create the encoded data. It is an informative field which may be used
by the decoding end. If a manufacturer already has a four-character code, it
is recommended that it uses the same code in this field. Else, it is
recommended that the manufacturer creates a four character code which best
addresses the manufacturer's name. It can be safely ignored.
**decoder_version:** version of the vendor's decoder which can decode the
encoded stream in the best (i.e. optimal) way. This field is closely tied to
the vendor field. It may give advantage to the vendor which has optimal
encoder-decoder version pairs. . The value is set to 0 if decoder version has
no importance for the vendor. It can be safely ignored.
**H263_Level and H263_Profile:** These two parameters define which H263
profile and level is used. These parameters are based on the MIME media type
video/H263-2000. The profile and level specifications can be found in [9].
EXAMPLE 1: H.263 Baseline = {H263_Level = 10, H263_Profile = 0}
EXAMPLE 2: H.263 Profile 3 @ Level 10 = {H263_Level = 10 , H263_Profile = 3}
NOTE: The \"hinter\", for the creation of the hint tracks, can use the
information given by the H263DecSpecStruc members.
The BitrateBox field shall be as defined in table 6.8. The BitrateBox may be
included if the 3GP file contains H.263 media.
The BitrateBox is composed of the following fields.
Table 6.8: The BitrateBox fields
* * *
Field Type Details Value BoxHeader.Size Unsigned int(32)  
BoxHeader.Type Unsigned int(32) 'bitr' DecBitrateInfo DecBitrStruc Structure
which holds the Bitrate information
* * *
**BoxHeader Size and Type:** indicate the size and type of the bitrate box.
The type must be 'bitr'.
**DecBitrateInfo:** This is the structure where the stream bitrate information
resides.
DecBitrStruc is defined as follows:
_struct_ **DecBitrStru** c{\ Unsigned int (32) **Avg_Bitrate** \ Unsigned int
(32) **Max_Bitrate** \ }
The definitions of DecBitrStruc members are as follows:
**Avg_Bitrate: the average bitrate in bits per second of this elementary
stream. For streams with variable bitrate this value shall be set to zero.**
**Max_Bitrate: the maximum bitrate in bits per second of this elementary
stream in any time window of one second duration.**
## 6.9 AMRWPSampleEntry box
The box type of the AMRWPSampleEntry Box shall be \'sawp\'.
The AMRWPSampleEntry Box is defined as follows:
**AMRWPSampleEntry ::= BoxHeader** \ Reserved_6\ Data-reference-index\
Reserved_8\ Reserved_2\ Reserved_2\ Reserved_4\ TimeScale\ Reserved_2\
**AMRWPSpecificBox**
Table 6.9: AMRWPSampleEntry fields
* * *
Field Type Details Value **BoxHeader**.Size Unsigned int(32)  
**BoxHeader**.Type Unsigned int(32) 'sawp' Reserved_6 Unsigned int(8) [6] 0
Data-reference-index Unsigned int(16) Index to a data reference that to use to
retrieve the sample data. Data references are stored in data reference boxes.  
Reserved_8 Const unsigned int(32) [2] 0 Reserved_2 Const unsigned int(16) 2
Reserved_2 Const unsigned int(16) 16 Reserved_4 Const unsigned int(32) 0
Sampling rate Unsigned int(16) See note 3.  
Reserved_2 Const unsigned int(16) 0 **AMRWPSpecificBox** Information specific
to the AMR-WB+ decoder.
* * *
If one compares the MP4AudioSampleEntry Box - AMRWPSampleEntry Box the main
difference is in the replacement of the ESDBox, which is specific to MPEG-4
systems, with a box suitable for AMR-WB+. The **AMRWPSpecificBox** field
structure is described in clause 6.10.
NOTE 1: In order to maintain backward compatibility with Release 4 and 5, the
AMRWPSampleEntry should not be used for AMR-WB+ streams that only contain AMR-
WB modes. Such streams should be stored as AMR-WB, i.e. by using the
AMRSampleEntry with box type \'sawb\', defined in clause 6.5, and the storage
format for single channel header of Annex E [15], without the AMR magic
numbers. This way file readers of previous releases will always be able to
read AMR-WB streams stored in 3GP files.
NOTE 2: In order to enhance interoperability in Release 6, file readers
capable of parsing tracks with AMR-WB+ should also be capable of parsing AMR-
WB tracks (see note 1).
NOTE 3: The timescale of AMR-WB+ is fixed to 72kHz to accommodate the internal
sampling rate which may vary over time. The sampling rate field of the
AMRWPSampleEntry is therefore not coupled to the timescale, but contains the
recommended playback sampling rate.
## 6.10 AMRWPSpecificBox field for AMRWPSampleEntry box
The AMRWPSpecificBox fields for AMR-WB+ shall be as defined in table 6.10. The
AMRWPSpecificBox for the AMRWPSampleEntry Box shall always be included if the
3GP file contains AMR-WB+ media.
Table 6.10: The AMRWPSpecificBox fields for AMRWPSampleEntry
* * *
Field Type Details Value BoxHeader.Size Unsigned int(32)  
BoxHeader.Type Unsigned int(32) 'dawp' DecSpecificInfo AMRWPDecSpecStruc
Structure which holds the AMR-WB+ Specific information
* * *
**BoxHeader Size and Type:** indicate the size and type of the AMR-WB+
decoder-specific box. The type must be 'dawp'.
**DecSpecificInfo:** the structure where the AMR-WB+ stream specific
information resides.
The AMRWPDecSpecStruc is defined as follows:
_struct_ **AMRWPDecSpecStruc**{\ Unsigned int (32) **vendor** \ Unsigned int
(8) **decoder_version\**}
The definitions of AMRWPDecSpecStruc members are as follows:
**vendor:** four character code of the manufacturer of the codec, e.g.
\'VXYZ\'. The vendor field gives information about the vendor whose codec is
used to create the encoded data. It is an informative field, which may be used
by the decoding end. If a manufacturer already has a four-character code, it
is recommended that it uses the same code in this field. Else, it is
recommended that the manufacturer creates a four character code which best
addresses the manufacturer's name. It can be safely ignored.
**decoder_version:** version of the vendor's decoder which can decode the
encoded stream in the best (i.e. optimal) way. This field is closely tied to
the vendor field. It may give advantage to the vendor which has optimal
encoder-decoder version pairs. The value is set to 0 if decoder version has no
importance for the vendor. It can be safely ignored.
NOTE: For AMR and AMR-WB the AMRSpecificBox defines the number of frames that
are stored in a sample. For AMR-WB+, however, the AMRWPSpecificBox does not
specify an overall sample structure, as the number of storage units per sample
may differ from sample to sample.
## 6.11 CVOSampleEntry box
The box type of the CVOSampleEntry Box shall be \'3gvo\'.
The CVOSampleEntry Box is defined as follows:
**CVOSampleEntry ::= BoxHeader** \ Reserved_6\ Data-reference-index\
Granularity
Table 6.11: CVOSampleEntry fields
* * *
Field Type Details Value **BoxHeader**.Size Unsigned int(32)  
**BoxHeader**.Type Unsigned int(32) '3gvo' Reserved_6 Unsigned int(8) [6] 0
Data-reference-index Unsigned int(16) Index to a data reference that to use to
retrieve the sample data. Data references are stored in data reference boxes.  
Granularity Unsigned int(8) Granularity used in CVO Rotation as defined in
26.114 [50] Takes value 2 for CVO and 6 for high granularity CVO as defined in
TS 26.114 [50].
* * *
## 6.12 LocationSampleEntry box
The box type of the LocationSampleEntry Box shall be \'3glo\'.
The LocationSampleEntry Box is defined as follows:
**LocationSampleEntry ::= BoxHeader** \ Reserved_6\ Data-reference-index
Table 6.12: LocationSampleEntry fields
* * *
**Field** **Type** **Details** **Value** **BoxHeader**.Size Unsigned int(32)  
**BoxHeader**.Type Unsigned int(32) '3glo' Reserved_6 Unsigned int(8) [6] 0
Data-reference-index Unsigned int(16) Index to a data reference used to
retrieve the sample data. Data references are stored in data reference boxes.
* * *
## 6.13 OrientationSampleEntry box
The box type of the OrientationSampleEntry Box shall be \'3gor\'.
The OrientationSampleEntry Box is defined as follows:
**OrientationSampleEntry := BoxHeader** \ Reserved_6\ Data-reference-index
Table 6.13: OrientationSampleEntry fields
* * *
**Field** **Type** **Details** **Value** **BoxHeader**.Size Unsigned int(32)  
**BoxHeader**.Type Unsigned int(32) '3gor' Reserved_6 Unsigned int(8) [6] 0
Data-reference-index Unsigned int(16) Index to a data reference used to
retrieve the sample data. Data references are stored in data reference boxes.
* * *
## 6.14 EVSSampleEntry box
The box type of the EVSSampleEntry Box shall be \'sevs\'.
The EVSSampleEntry Box is defined as follows:
**EVSSampleEntry ::= BoxHeader** \ Reserved_6\ Data-reference-index\
Reserved_8\ channelcount\ Reserved_2\ Reserved_4\ TimeScale\ Reserved_2
Table 6.4: EVSSampleEntry fields
* * *
**Field** **Type** **Details** **Value** **BoxHeader**.Size Unsigned int(32)  
**BoxHeader**.Type Unsigned int(32) \'sevs\' Reserved_6 Unsigned int(8) [6] 0
Data-reference-index Unsigned int(16) Index to a data reference that to use to
retrieve the sample data. Data references are stored in data reference boxes.  
Reserved_8 Const unsigned int(32) [2] 0 channelcount Const unsigned int(16)
Number of mono channels present in this media.  
Reserved_2 Const unsigned int(16) 16 Reserved_4 Const unsigned int(32) 0
TimeScale Unsigned int(16) Sample rate of the media according to the maximum
encoded bandwidth, e.g., 32000 for SWB. Set to 48000 if unknown. One of the
values: 8000, 16000, 32000, or 48000. Reserved_2 Const unsigned int(16) 0
* * *
# 7 Streaming-server extensions
## 7.1 General
This clause defines extensions to 3GP files to be used by streaming servers.
The extensions enable a PSS server to relate different tracks and use them for
selection and adaptation. In particular, they enable a PSS server to
\- generate SDP descriptions with alternatives, as specified in subclauses
5.3.3.3 - 5.3.3.4 of [3];
\- select and combine tracks with alternative encodings of media before a
presentation;
\- switch between tracks with alternative encodings during a streaming
session;
\- determine the decoding order, playout timestamp, and size for any ADU in an
RTP payload.
In addition, the streaming server extensions enable a PSS server to
\- use SRTP hint tracks for integrity protection.
The streaming-server extensions are intended to be used with hint tracks,
although they are not limited to be used with hint tracks. Hint tracks are
defined in the ISO base media file format [7] and provide (RTP) packetization
instructions for media stored in a file.
NOTE: The present document defines syntax and semantics for streaming-server
extensions in 3GP files. It does not define protocols for, e.g., how a PSS
server signals alternative encodings or switches between different bitrate
encodings. All protocols used by a PSS server are defined in [3].
## 7.2 Groupings of alternative tracks
By default all enabled tracks in a 3GP file are streamed (played)
simultaneously. However, the ISO base media file format [7] specifies that
tracks that are alternatives to each other can be grouped into an alternate
group. Tracks in an alternate group that can be used for switching can be
further grouped into a switch group, as defined here.
### 7.2.1 Alternate group
Alternate group is identified by an integer, alternate_group, in the Track
Header box of each track. If this integer is 0 (default value), there is no
information on possible relations to other tracks. If this integer is not 0,
it should be the same for tracks that contain alternate data for one another
and different for tracks belonging to different such groups. Only one track
within an alternate group should be streamed or played at any time and must be
distinguishable from other tracks in the group via attributes such as bitrate,
codec, language, packet size etc.
### 7.2.2 Switch group
Switch group is identified by an integer, switch_group, in the Track Selection
box of each track, as defined below. If this box is absent or if this integer
is 0 (default value), there is no information on whether the track can be used
for switching during streaming or playing. If this integer is not 0, it shall
be the same for tracks that can be used for switching between each other.
Tracks that belong to the same switch group shall belong to the same alternate
group.
## 7.3 Track Selection box
This subclause defines an optional box that aids the selection between tracks.
It is used to encode switch groups and the criteria that should be used to
differentiate tracks within alternate and switch groups.
The Track Selection box is defined in table 7.1. It is contained in the User
data box of the track it modifies.
Note that Track Selection box is also defined in [7], with a slightly
different set of defined attributes. One difference is that herein the
definition of the attribute \"Language\" identified by \'lang\' is included;
while in [7] the definition of the attribute \"Media language\" identified by
\'mela\' is included.
Table 7.1: Track Selection box fields
* * *
Field Type Details Value **BoxHeader**.Size Unsigned int(32)  
**BoxHeader**.Type Unsigned int(32) 'tsel' **BoxHeader**.Version Unsigned
int(8) 0 **BoxHeader**.Flags Bit(24) 0 SwitchGroup int(32) Switch group of
track. 0 (default) AttributeList Unsigned int(32) [N] List of N attributes to
the end of the box.
* * *
**BoxHeader Size, Type, Version and Flags:** indicate the size, type, version
and flags of the Track Selection box. The type shall be 'tsel' and the version
shall be 0. No flags are defined.
**SwitchGroup:** indicates switch group as defined in clause 7.2.2. It shall
be 0 if the track is not intended for switching.
**AttributeList:** is a list of attributes to the end of the box. The
attributes in this list should be used as differentiation criteria for tracks
in the same alternate or switch group. Each attribute is associated with a
pointer to the field or information that distinguishes the track. Attributes
and pointers are listed in table 7.2.
Table 7.2: Attributes for AttributeList of the Track Selection box
* * *
Name Attribute Pointer Language 'lang' Value of grouping type LANG of "alt-
group" attribute in session-level SDP (defined in clause 5.3.3.4 of [3])
Bandwidth 'bwas' Value of "b=AS" attribute in media-level SDP Codec 'cdec'
SampleEntry (in Sample Description box of media track) Screen size 'scsz'
Width and height fields of MP4VisualSampleEntry and H263SampleEntry (in media
track) Max packet size 'mpsz' Maxpacketsize field in RTPHintSampleEntry Media
type 'mtyp' Handlertype in Handler box (of media track)
* * *
## 7.4 Combining alternative tracks
Tracks from different alternate groups are streamed (played) simultaneously.
However, all combinations of tracks may not form suitable presentations. In
order to suggest suitable combinations of tracks and also to reduce the number
of possible combinations, a content provider can encode preferred combinations
of alternative tracks in a 3GP file. Such combinations are encoded by the
"alt-group" attribute in the session-level SDP fragment, as described in
clause 7.5.3.
If information on suitable combinations of tracks is missing, tracks with the
lowest track IDs of each alternate group should be streamed (played) by
default.
## 7.5 SDP
### 7.5.1 Session- and media-level SDP
Fragments that together constitute an SDP description shall be contained in a
3GP file with streaming-server extensions. Session-level SDP, i.e. all lines
before the first media-specific line ("m=" line), shall be stored as Movie SDP
information within the User Data box, as specified in [7]. Media-level SDP,
i.e. an "m=" line and the lines before the next "m=" line (or end of SDP)
shall be stored as Track SDP information within the User data box of the
corresponding track. Media-level SDP shall be contained in hint tracks (if
provided).
### 7.5.2 Stored versus generated SDP fields
The SDP information stored in a 3GP file should be as complete as possible,
although some fields must be generated or modified by the server when a
presentation is composed. Table 7.3 gives an overview of the SDP fields used
by PSS, c.f. Table A.1 in [3], and whether they are required to be included in
3GP files or whether the server is required to generate them.
Table 7.3: Overview of stored and generated fields in SDP
+-------------+-------------+-------------+-------------+-------------+ | Type | Description | Contained | Generated | | | | | in 3GP file | by PSS | | | | | | server | | +-------------+-------------+-------------+-------------+-------------+ | Session | | | | | | Description | | | | | +-------------+-------------+-------------+-------------+-------------+ | V | Protocol | R | O | | | | version | | | | +-------------+-------------+-------------+-------------+-------------+ | O | Ow | O | R | | | | ner/creator | | | | | | and session | | | | | | identifier | | | | +-------------+-------------+-------------+-------------+-------------+ | S | Session | R | O | | | | Name | | | | +-------------+-------------+-------------+-------------+-------------+ | I | Session | O | O | | | | information | | | | +-------------+-------------+-------------+-------------+-------------+ | U | URI of | O | O | | | | description | | | | +-------------+-------------+-------------+-------------+-------------+ | E | Email | O | O | | | | address | | | | +-------------+-------------+-------------+-------------+-------------+ | P | Phone | O | O | | | | number | | | | +-------------+-------------+-------------+-------------+-------------+ | C | Connection | O | R | | | | Information | | | | +-------------+-------------+-------------+-------------+-------------+ | B | Bandwidth | AS | O | O (see note | | | information | | | 7) | +-------------+-------------+-------------+-------------+-------------+ | | | RS | O | O | +-------------+-------------+-------------+-------------+-------------+ | | | RR | O | O | +-------------+-------------+-------------+-------------+-------------+ | | | TIAS | O | O | +-------------+-------------+-------------+-------------+-------------+ | One or more | | | | | | Time | | | | | | D | | | | | | escriptions | | | | | | (See below) | | | | | +-------------+-------------+-------------+-------------+-------------+ | Z | Time zone | O | O | | | | adjustments | | | | +-------------+-------------+-------------+-------------+-------------+ | K | Encryption | O | O | | | | key | | | | +-------------+-------------+-------------+-------------+-------------+ | A | Session | control | O | R | | | attributes | | | | +-------------+-------------+-------------+-------------+-------------+ | | | range | R | O | +-------------+-------------+-------------+-------------+-------------+ | | | alt-group | R (see note | O | | | | | 4) | | +-------------+-------------+-------------+-------------+-------------+ | | | QoE-Metrics | O | O | +-------------+-------------+-------------+-------------+-------------+ | | | 3GPP-Asset- | O | O | | | | Information | | | +-------------+-------------+-------------+-------------+-------------+ | | | 3GPP-In | N | R (see note | | | | tegrity-Key | | 6) | +-------------+-------------+-------------+-------------+-------------+ | | | 3G | N | R (see note | | | | PP-SDP-Auth | | 6) | +-------------+-------------+-------------+-------------+-------------+ | | | maxprate | O | O | +-------------+-------------+-------------+-------------+-------------+ | One or more | | | | | | Media | | | | | | D | | | | | | escriptions | | | | | | (See below) | | | | | +-------------+-------------+-------------+-------------+-------------+ | | | | | | +-------------+-------------+-------------+-------------+-------------+ | Time | | | | | | Description | | | | | +-------------+-------------+-------------+-------------+-------------+ | T | Time the | R | O | | | | session is | | | | | | active | | | | +-------------+-------------+-------------+-------------+-------------+ | | | | | | +-------------+-------------+-------------+-------------+-------------+ | R | Repeat | O | O | | | | times | | | | +-------------+-------------+-------------+-------------+-------------+ | | | | | | +-------------+-------------+-------------+-------------+-------------+ | Media | | | | | | Description | | | | | +-------------+-------------+-------------+-------------+-------------+ | M | Media name | R | O | | | | and | | | | | | transport | | | | | | address | | | | +-------------+-------------+-------------+-------------+-------------+ | I | Media title | O | O | | +-------------+-------------+-------------+-------------+-------------+ | C | Connection | O | R | | | | information | | | | +-------------+-------------+-------------+-------------+-------------+ | B | Bandwidth | AS | R | O (see note | | | information | | | 7) | +-------------+-------------+-------------+-------------+-------------+ | | | RS | O | R | +-------------+-------------+-------------+-------------+-------------+ | | | RR | O | R | +-------------+-------------+-------------+-------------+-------------+ | | | TIAS | R | O | +-------------+-------------+-------------+-------------+-------------+ | K | Encryption | O | O | | | | Key | | | | +-------------+-------------+-------------+-------------+-------------+ | A | Attribute | control | O | R | | | Lines | | | | +-------------+-------------+-------------+-------------+-------------+ | | | range | R | O | +-------------+-------------+-------------+-------------+-------------+ | | | fmtp | R | O | +-------------+-------------+-------------+-------------+-------------+ | | | rtpmap | R | O | +-------------+-------------+-------------+-------------+-------------+ | | | X-pr | R (see note | O | | | | edecbufsize | 5) | | +-------------+-------------+-------------+-------------+-------------+ | | | X-initpred | R (see note | O | | | | ecbufperiod | 5) | | +-------------+-------------+-------------+-------------+-------------+ | | | X-initpostd | R (see note | O | | | | ecbufperiod | 5) | | +-------------+-------------+-------------+-------------+-------------+ | | | X- | R (see note | O | | | | decbyterate | 5) | | +-------------+-------------+-------------+-------------+-------------+ | | | framesize | R | O | +-------------+-------------+-------------+-------------+-------------+ | | | alt | N | R | +-------------+-------------+-------------+-------------+-------------+ | | | alt | N | R | | | | -default-id | | | +-------------+-------------+-------------+-------------+-------------+ | | | 3 | N | O | | | | GPP-Adaptat | | | | | | ion-Support | | | +-------------+-------------+-------------+-------------+-------------+ | | | QoE-Metrics | O | O | +-------------+-------------+-------------+-------------+-------------+ | | | 3GPP-Asset- | O | O | | | | Information | | | +-------------+-------------+-------------+-------------+-------------+ | | | 3GPP- | N | R (see note | | | | SRTP-Config | | 6) | +-------------+-------------+-------------+-------------+-------------+ | | | rtcp-fb | N | R | +-------------+-------------+-------------+-------------+-------------+ | | | maxprate | R | O | +-------------+-------------+-------------+-------------+-------------+ | Note 1: | | | | | | Fields in | | | | | | 3GP files | | | | | | are | | | | | | Required | | | | | | (R), | | | | | | Optional | | | | | | (O), or Not | | | | | | allowed | | | | | | (N). | | | | | | | | | | | | Note 2: | | | | | | Servers are | | | | | | Required | | | | | | (R) to | | | | | | generate | | | | | | (possibly | | | | | | by copying | | | | | | or | | | | | | modifying | | | | | | from file), | | | | | | or have the | | | | | | Option (O) | | | | | | to | | | | | | generate/c | | | | | | opy/modify, | | | | | | or are Not | | | | | | allowed (N) | | | | | | to modify | | | | | | fields. If | | | | | | a field is | | | | | | present in | | | | | | a file, it | | | | | | shall be | | | | | | copied or | | | | | | modified, | | | | | | but not | | | | | | omitted, by | | | | | | the server. | | | | | | | | | | | | Note 3: | | | | | | Some types | | | | | | shall only | | | | | | be included | | | | | | under | | | | | | certain | | | | | | conditions, | | | | | | as | | | | | | specified | | | | | | by PSS | | | | | | [3]. | | | | | | | | | | | | Note 4: The | | | | | | "alt-group" | | | | | | attribute | | | | | | is required | | | | | | to be | | | | | | stored in | | | | | | 3GP files | | | | | | if it is | | | | | | used. | | | | | | | | | | | | Note 5: The | | | | | | \"X-\" | | | | | | attributes | | | | | | are | | | | | | required to | | | | | | be stored | | | | | | in 3GP | | | | | | files if | | | | | | they are | | | | | | used. They | | | | | | may either | | | | | | be | | | | | | specified | | | | | | in the PSS | | | | | | Annex G box | | | | | | \'3gag\' | | | | | | (see Clause | | | | | | 9) or in | | | | | | media-level | | | | | | SDP | | | | | | fragments. | | | | | | | | | | | | Note 6: The | | | | | | server is | | | | | | required to | | | | | | generate | | | | | | the | | | | | | \ | | | | | | "3GPP-Integ | | | | | | rity-Key\", | | | | | | \"3GPP- | | | | | | SDP-Auth\", | | | | | | and | | | | | | \"3GPP-SR | | | | | | TP-Config\" | | | | | | attributes | | | | | | if | | | | | | integrity | | | | | | protection | | | | | | is used. | | | | | | | | | | | | Note 7: The | | | | | | \"b=AS\" | | | | | | session | | | | | | bandwidth | | | | | | shall | | | | | | include | | | | | | UDP/IP | | | | | | overhead. | | | | | | The value | | | | | | shall be | | | | | | based on | | | | | | IPv4 when | | | | | | stored in a | | | | | | file, but | | | | | | may be | | | | | | modified by | | | | | | the server | | | | | | to | | | | | | accommodate | | | | | | for IPv6. | | | | | | The | | | | | | \ | | | | | | "maxprate\" | | | | | | attribute | | | | | | is useful | | | | | | for such a | | | | | | conversion. | | | | | +-------------+-------------+-------------+-------------+-------------+
### 7.5.3 SDP attributes for alternatives
Clauses 5.3.3.3 and 5.3.3.4 of [3] define SDP attributes that a server can use
for presenting options to a client. These attributes can be used to encode
suggested groupings of tracks, e.g. for selecting a certain language or target
bitrate.
Suggested groupings of tracks from different alternate groups, i.e. groupings
of tracks that should be streamed together, are encoded by using the "alt-
group" attribute in the session-level SDP. Note that a server may have to
prune options from such groupings if certain tracks are not presented to the
client.
Media-level SDP fragments shall not contain alternative-media attributes
("alt" and "alt-default-id") as they are difficult to pre-encode. When the
server combines several media-level SDP fragments from alternative tracks into
one media-level SDP, it must generate the appropriate "alt" and "alt-default-
id" attributes. This can be done by using the information provided in the
"alt-group" attributes in the session-level SDP.
NOTE 1: Track IDs given by the Track Header boxes shall be used for
alternative IDs ("alt-id") in attributes for SDP alternatives.
NOTE 2: Tracks with the lowest track IDs of each alternate group should be
used as default tracks, i.e. used with the "alt-default-id" attributes.
## 7.6 SRTP
Hinted content may require the use of SRTP [19] for streaming, e.g. for
integrity protection, by using the hint-track format for SRTP defined here. It
consists of a dedicated sample entry, which will be ignored by 3GP servers not
capable of handling SRTP.
SRTP hint tracks are formatted identically to RTP hint tracks defined in [7],
except that:
\- the sample entry name is changed from \'rtp \' to \'srtp\' to indicate to
the server that SRTP is required;
\- an extra box is added to the sample entry which can be used to instruct the
server in the nature of the on-the-fly encryption and integrity protection
that must be applied.
Samples of an SRTP hint track follow the same syntax for constructing RTP
packets as RTP hint tracks.
An SRTP Hint Sample Entry (\'srtp\') shall include an SRTP Process Box
(\'srpp\') that may instruct the server as to which SRTP algorithms should be
applied. It is defined in [7] and included in Table 7.4 for information.
Table 7.4: SRTPProcessBox
* * *
Field Type Details Value **BoxHeader**.Size Unsigned int(32)  
**BoxHeader**.Type Unsigned int(32) 'srpp' **BoxHeader**.Version Unsigned
int(8) 0 **BoxHeader**.Flags Bit(24) 0 EncryptionAlgorithmRTP Unsigned int(32)
4cc identifying the algorithm  
EncryptionAlgorithmRTCP Unsigned int(32) 4cc identifying the algorithm  
IntegrityAlgorithmRTP Unsigned int(32) 4cc identifying the algorithm  
IntegrityAlgorithmRTCP Unsigned int(32) 4cc identifying the algorithm  
**SchemeTypeBox** Box containing the protection scheme.  
**SchemeInformationBox** Box containing the scheme information.
* * *
The **SchemeTypeBox** and **SchemeInformationBox** have the syntax defined in
Tables 10.7 and 10.8, respectively. They serve to provide the parameters
required for applying SRTP. The Scheme Type Box is used to indicate the
necessary key management and security policy for the stream in extension to
the defined algorithmic pointers provided by the SRTP Process Box. The key
management functionality is also used to establish all the necessary SRTP
parameters. The key management functionality is also used to establish all the
necessary SRTP parameters as listed in section 8.2 of [19]. The exact
definition of protection schemes is out of the scope of the file format.
The algorithms for encryption and integrity protection are defined by SRTP.
Table 7.5 summarizes the format identifiers defined here. An entry of four
spaces (\$20\$20\$20\$20) may be used to indicate that a process outside the
file format decides the choice of algorithm for either encryption or integrity
protection.
Table 7.5: Algorithms for encryption and integrity protection
* * *
Format Algorithm \$20\$20\$20\$20 The choice of algorithm for either
encryption or integrity protection is decided by a process outside the file
format ACM1 Encryption using AES in Counter Mode with 128-bit key, as defined
in Section 4.1.1 of [19] AF81 Encryption using AES in F8-mode with 128-bit
key, as defined in Section 4.1.2 of [19] ENUL Encryption using the NULL-
algorithm as defined in Section 4.1.3 of [19] SHM2 Integrity protection using
HMAC-SHA-1 with 160-bit key, as defined in Section 4.2.1 of [19] ANUL
Integrity protection not applied to RTP (but still applied to RTCP). Note:
this is valid only for IntegrityAlgorithmRTP.
* * *
## 7.7 Aggregated RTP payloads
An application data unit (ADU), normally being the smallest independently
usable data unit, is specified as follows for coding formats and RTP payload
formats allowed in 3GP files:
\- For audio and speech, an ADU is specified as a coded frame intended for
transport.
\- For H.263 an ADU consists of an entire RTP payload.
\- For MPEG-4 Visual an ADU consists of a complete or partial VOP in the RTP
payload.
\- For H.264 (AVC) or H.265 (HEVC), an ADU is a Network Adaptation Layer Unit
(NALU).
\- For timed text, an ADU consists of any of the type 1-5 RTP payload units
[28].
For encrypted RTP payloads, the actual ADUs are hidden within the encrypted
payload. Some RTP payload formats allow aggregation of multiple ADUs into a
single RTP payload. When any hint sample in an RTP hint track defines a
payload including multiple ADUs, each hint sample in the hint track shall
comply with the following requirements:
\- The extra-flag in the RTPPacket class of the hint sample shall be set to 1.
This indicates that there is extra information before the RTP constructors in
the form of type-length-value sets.
\- The extra information in the hint sample shall include a '3gau' structure
as specified below.
class 3gppApplicationDataUnitInfoTLV extends Box('3gau') {\ unsigned int(16)
entrycount;\ for(i=1; i\
Note: It is possible to include a 3GP file with tracks as a media file
(addressed by filename) rather than using a top-level Movie box for tracks.
However, this way the included 3GP file will be "hidden" one layer and
interleaving between individual tracks and items less transparent.
## 11.4 Examples
### 11.4.1 SMIL presentation
The following example consists of a slide show in SMIL consisting of three
images shown with the duration of 3 seconds each and an AMR clip that is
played in parallel. The presentation is built from a number of separate files:
\- SMIL file: \"scene.smil\";
\- 3GP file with AMR: \"audioclip.3gp\";
\- Image files: \"pic1.jpg\", \"pic2.jpg\" and \"pic3.jpg\".
These files can be packaged into a single 3GP file \"presentation.3gp\" as an
extended presentation. The overall presentation is governed by the SMIL file
located as the primary item of \"presentation.3gp\":
> \\ \\
> \\ \\ \ id=\"pics\" left=\"0\" width=\"176\" height=\"144\"/>\ \\ \\
> \\ \\ \\ \\ \ region=\"pics\" src=\"pic1.jpg\" dur=\"3s\"/>\ \ src=\"pic2.jpg\" dur=\"3s\"/>\ \ dur=\"3s\"/>\ \\ \\ \\ \
The audio track resides in the Movie box and is referred to as \"#box=moov\",
whereas the images are included as media files in the Meta box.
### 11.4.2 DIMS presentation
The following example consists of a DIMS presentation that refers to images,
an AMR clip and scene updates. The presentation is contained in a single
Extended-presentation profile 3GP file containing:
\- DIMS scene description (SVG scene) stored as item 1 identified by a Primary
item box;
\- DIMS updates stored as a DIMS track (track ID 1);
\- AMR clip stored as an AMR track (track ID 2);
\- Image files: \"pic1.jpg\", \"pic2.jpg\" and \"pic3.jpg\" stored as items 2,
3 and 4.
All references to the DIMS and AMR tracks and the images are made by relative
URLs from the DIMS Unit in the primary item:
> \ baseProfile=\"tiny\"\ xmlns:xlink=http://www.w3.org/1999/xlink\
> width=\"320\" height=\"240\" viewBox=\"0 0 320 240\">\ \DIMS
> example\\ \ begin=\"10\"/>\ \ level=\"0.7\"\ type=\"audio/AMR\" begin=\"10\"/>\ \ width=\"100\" height=\"100\" xlink:href=\"pic1.jpg\">\ \ y=\"100\" width=\"100\" height=\"100\" xlink:href=\"pic2.jpg\">\ \ x=\"100\" y=\"0\" width=\"100\" height=\"100\" xlink:href=\"pic3.jpg\">\
> \
An Item information box specifies the MIME type of the scene description (SVG
scene) and the filenames and MIME types of the image files. An Item location
box specifies the locations of all items.
# 12 Media Stream Recording
## 12.1 Unprotected Stream Recording
Received RTP media streams may be stored in 3GP files conforming to the Media
Stream Recording profile. RTP packets may be stored in RTP reception hint
tracks. RTCP packets may be stored in RTCP reception hint tracks.
## 12.2 Protected Stream recording
SRTP protected media may be stored in 3GP files conforming to the 3GP Media
Stream Recording Profile. SRTP and corresponding SRTCP packets are stored in
SRTP reception hint tracks and SRTCP reception hint tracks, respectively, as
described in [38]. Corresponding MIKEY MBMS Traffic Key messages are stored in
OMA BCAST STKM tracks as described in clause 12.2.1. Additionally, SDP and
Protection Description information is stored as described in clauses 12.3 and
12.2.2.
### 12.2.1 Key message tracks
MIKEY MBMS Traffic Key messages as defined in [39] shall be stored in OMA
BCAST STKM tracks 'oksd' as defined in [37]. A 3GP file with SRTP recording
extensions shall contain at least one STKM track. Furthermore, all key
messages related a specific SRTP reception hint track shall be recorded in the
same STKM track. Track references of type 'cdsc' shall be used to link STKM
tracks to SRTP reception hint tracks as described in [37].
In the Sample Description Entry of the STKM track, the filed sample_version
shall be set to 0x00 and the field sample_type shall be set to 0xf7. The value
0xf7 indicates MIKEY MBMS Traffic Key messages.
Each Sample Entry of a STKM track shall contain exactly one MIKEY MBMS Traffic
Key messages in the STKM field. That is, the STKM field shall contain the
payload of the received MIKEY package (without IP and UDP headers) including
all MIKEY headers and all MIKEY payloads and the MIKEY MAC/Signature field.
### 12.2.2 Protection Description
The ServiceProtectionDescription box shall be defined as stated in table 12.1.
The ServiceProtectionDescription box shall be included for each Sample
Description Entry of a SRTP reception hint track as a sub box of the
SchmeInformationBox 'schi' in the SRTPProcessBox box 'srpp' as defined in [7].
Table 12.1: ServiceProtectionDescription box
* * *
Field Type Details Value **BoxHeader**.Size Unsigned int(32)  
**BoxHeader**.Type Unsigned int(32) 'spdb' **BoxHeader**.Version Unsigned
int(8) 0 **SecurityDescription** Unsigned int(8)[] Service Protection
Description Metadata Fragment
* * *
**BoxHeader Size, Type, Version:** indicate the size, type and version of the
ServiceProtectionDescription box. The type shall be 'spdb' and the version
shall be 0.
**SecurityDescription:**. This field shall contain the XML encoded Service
Protection Description Metadata Fragment as specified in [40] with the
restriction that only the mediaFlow element referring to the SRTP stream from
which this SRTP reception hint track was recorded is contained. That is, the
SecurityDescription shall contain exactly one mediaFlow element and this
element shall correspond to the stored SRTP packets described by the Sample
Description which also contains this SecurityDescription.
## 12.3 SDP
Fragments that together constitute an SDP description shall be contained in a
3GP file with Media Stream recording extensions. Session-level SDP, i.e. all
lines before the first media-specific line ("m=" line), shall be stored as
Movie SDP information within the User Data box, as specified in [7]. Media-
level SDP, i.e. an "m=" line and the lines before the next "m=" line (or end
of SDP) shall be stored as Track SDP information within the User data box of
the corresponding track. Media-level SDP shall be contained in each
corresponding reception hint track or media track.
# 13 HTTP streaming extensions
## 13.1 Introduction
This clause describes extensions to the 3GP file format related to Dynamic
Adaptive Streaming over HTTP as specified in 3GPP TS 26.247 [49] using HTTP
[48] as delivery protocol for segments.
## 13.2 Segment types
It is possible in HTTP streaming to form files from segments - or concatenated
segments - which would not necessarily form 3GP compliant files (e.g. they do
not contain a movie box). If such segments are stored in separate files (e.g.
on a standard HTTP server) it is recommended that these 'segment files' start
with a segment-type box, to enable identification of those files, and
declaration of the specifications with which they are compliant.
A segment type has the same format as an \'ftyp\' box [7], except that it
takes the box type \'styp\'. The brands within it should include the same
brands that were included in the \'ftyp\' box that preceded the 'moov' box,
and may also include additional brands to indicate the compatibility of this
segment with various specification(s) such as the 3GP Media Segment Profile
defined in clause 5.4.10 of this specification.
Valid segment type boxes shall be the first box in a segment. Segment type
boxes may be removed if segments are concatenated (e.g. to form a full 3GP
file), but this is not required. Segment type boxes that are not first in
their files may be ignored.
## 13.3 Track Fragment Adjustment Box
Track Fragment Adjustment Boxes describe the relative time difference of the
first samples of tracks within a movie fragment. When randomly accessing a 3GP
file or a Media Segment at a movie fragment that contains a Track Fragment
Adjustment Box, the Track Fragment Adjustment Box provides instructions on how
the timeline of one or more of the tracks may be modified to generate
synchronization between the tracks. For example, if, in the previous fragment,
one track ended later than another, the first sample of that track in this
fragment will need to be presented later also; an edit-list in the track
fragment adjustment box containing an empty edit, and then a media edit,
achieves that effect.
The syntax of a Track Fragment Adjustment Box as described below is identical
to that of edit-lists. However, unlike edit-lists, which must always be
applied, when present, to adjust the timelines of the containing tracks, a
Track Fragment Adjustment Box may only be applied when randomly accessing a
3GP file or a Media Segment at a movie fragment containing the Track Fragment
Adjustment Box. In continuous playback, wherein the track alignment is known
(e.g. from decoding the previous segment) and sync between tracks has been
achieved, Track Fragment Adjustment Box shall not be applied.
The container of the Track Fragment Adjustment Box is the Track Fragment Box.
If present, the Track Fragment Adjustment Box should be positioned after the
Track Fragment Header Box and before the first Track Fragment Run box. The
Track Fragment Adjustment Box is a container for the Track Fragment Media
Adjustment Boxes.
aligned(8) class TrackFragmentAdjustmentBox extends Box('tfad') {\ }
The Track Fragment Media Adjustment Box provides explicit time line offsets.
By indicating 'empty' time, or by defining a 'dwell', the offset can
advantageously delay the playback time of the media in the track so that media
in different tracks can be synchronized. Alternatively, the media_time value
may be used to discard part of the "earlier" tracks.
aligned(8) class TrackFragmentMediaAdjustmentBox extends FullBox('tfma',
version, 0) {\ unsigned int(32) entry_count;\ for (i=1; i \ NOTE: A media segment may be indexed by more than one "top-level" Segment
> Index box that are independent of each other, each of which indexes one
> track within the media segment. In segments containing multiple tracks the
> referenced bytes may contain media from multiple tracks, even though the
> Segment Index box provides timing information for only one track.
The anchor point for a Segment Index box is the first byte after that box.
Within the two constraints (a) that, in time, the subsegments are contiguous,
that is, each entry in the loop is consecutive from the immediately preceding
one and (b) within a given segment the referenced bytes are contiguous, there
are a number of possibilities, including:
1) a reference to a segment index box may include, in its byte count,
immediately following Segment Index boxes that document subsegments;
2) using the first_offset field, it is possible to separate Segment Index
boxes from the media that they refer to;
3) it is possible to locate Segment Index boxes for subsegments close to the
media they index.
The Segment Index box documents the presence of Stream Access Points (SAPs),
as specified in Annex G.6 of TS26.247 [49], in the referenced subsegments. The
annex specifies characteristics of SAPs, such as I~SAU~, I~SAP~ and T~SAP~, as
well as SAP types, which are all used in the semantics below. A subsegment
starts with a SAP when the subsegment contains a SAP, and for the first SAP,
I~SAU~ is the index of the first sample that follows I~SAP~, and I~SAP~ is
contained in the subsegment.
The container for \'sidx\' box is the file or segment directly.
aligned(8) class SegmentIndexBox extends FullBox('sidx', version, 0) {\
unsigned int(32) reference_ID;\ unsigned int(32) timescale;
if (version==0)
{
unsigned int(32) earliest_presentation_time;\ unsigned int(32) first_offset;
}
else
{
unsigned int(64) earliest_presentation_time;\ unsigned int(64) first_offset;
}\ unsigned int(16) reserved = 0;\ unsigned int(16) reference_count;\ for(i=1;
i \ Note: the decode timeline is a media timeline, established before any
> explicit or implied mapping of media time to presentation time, for example
> by an edit list or similar structure.
aligned(8) class TrackFragmentBaseMediaDecodeTimeBox\ extends FullBox('tfdt',
version, 0) {\ if (version==1) {\ unsigned int(64) baseMediaDecodeTime;\ }
else { // version==0\ unsigned int(32) baseMediaDecodeTime;\ }\ }
**version** is an integer that specifies the version of this box (0 or 1 in
this specification).
**baseMediaDecodeTime** is an integer equal to the sum of the decode durations
of all earlier samples in the media, expressed in the media\'s timescale. It
does not include the samples added in the enclosing track fragment.
# 14 Storage of CVO (Coordination of Video Orientation) data in the 3GPP File
Format
When CVO data is stored in the 3GPP File Fomat, a timed metadata track shall
be used with CVOSampleEntry box as described in clause 6.11. CVOSampleEntry
indicates that the metadata sample format is a single byte of CVO data as
defined in 26.114 [50]. Each metadata track containing CVO data should
reference the video track which it describes using the 'cdsc' track reference
as defined in the ISO base media file format [7].
# 15 Location timed metadata in the 3GPP File Format
When Location timed metadata is stored in the 3GPP File Fomat, a timed
metadata track shall be used with LocationSampleEntry box as described in
clause 6.12. The presence of LocationSampleEntry indicates that the metadata
sample format are the fields of the Location Information box in Table 8.10
starting from the Role field, i.e. as shown in the table below:
Table 15.1: Location timed metadata Sample Format
* * *
**Field** **Type** **Details** **Value** Role Unsigned int(8) Non-negative
value indicating role of location  
Longitude Unsigned int(32) Fixed-point value of the longitude  
Latitude Unsigned int(32) Fixed-point value of the latitude  
Altitude Unsigned int(32) Fixed-point value of the Altitude  
Astronomical_body String Text of astronomical body  
Additional_notes String Text of additional location-related information
* * *
For the definitions of these fields, see the definitions of the Location
Information box in clause 8.2.
# 16 Quality timed metadata in the 3GPP File Format
Quality metadata refers to video quality metrics based on associated
measurements of the media data, as described in clause 4 of [53] and clause
6.17 of [54]. When quality metadata data is stored in the 3GPP File Fomat, a
timed metadata track shall be used with QualityMetricsSampleEntry box as
described in clause 4 of [53].
# 17 Orientation timed metadata in the 3GPP File Format
WhenOrientation timed metadata is stored in the 3GPP File Fomat, a timed
metadata track shall be used with OrientationSampleEntry box as described in
clause 6.13. The presence of OrientationSampleEntry indicates that the
metadata sample format are the fields of the Orientation Information box in
Table 8.12d starting from the field Digital_zoom. Each metadata track
containing Orientation data should reference the video track which it
describes using the 'cdsc' track reference as defined in the ISO base media
file format [7]
###### ## Annex A (normative): MIME Type Registrations for 3GP files
# A.1 MIME Types
## A.1.1 General
This registration is an update and replacement of RFC 3839. It applies to all
files defined as using the \'3GP\' file format and identified with a suitable
brand in a 3GPP specification. The usual file suffix for all these files is
\".3gp\". The difference between the current registration and RFC 3839 is the
inclusion of two optional parameters.
## A.1.2 Files with audio but no visual content
The type \"audio/3gpp\" may be used for files containing audio but no visual
presentation (neither video nor timed text, for example).
Type name: audio
Subtype name: 3gpp
Required parameters: none
Optional parameters:
> codecs: is a single value or a comma-separated list that identifies the
> codec(s) needed for rendering the content contained (in tracks) of a file.
> The codecs parameter is defined in RFC 6381 [32]. The ISO file format name
> space and ISO syntax in clauses 3.3 and 3.4 of RFC 6381, respectively, shall
> be used together with additions defined in clause A.2.2 of the present
> document.
>
> types: is a single value or a comma-separated list that identifies the MIME
> media types of the content contained (in items) in a file. It is defined in
> clause A.2.3 of the present document.
Encoding considerations: files are binary and should be transmitted in a
suitable encoding without CR/LF conversion, 7-bit stripping etc.; base64 (RFC
4648 [35]) is a suitable encoding.
Security considerations: see the security considerations section in A.3 of the
present document.
Interoperability considerations: The 3GPP organization has defined the
specification, interoperability, and conformance. IMTC conducts
interoperability testing.
Published specification: 3GPP TS 26.234, Release 5; 3GPP TS 26.244, Release 6
or later. 3GPP specifications are publicly accessible at the 3GPP web site,
www.3gpp.org.
Applications which use this media type: Multi-media
Additional information: The type \"audio/3gpp\" may be used for files
containing audio but no visual presentation. Files served under this type must
not contain any visual material. (Note that timed text is visually presented
and is considered to be visual material).
Magic number(s): None. However, the file-type box must occur first in the
file, and must contain a 3GPP brand in its compatible brands list.
File extension(s): \'3gp\' and \'3gpp\' are both declared at
http://www.nist.gov/nics/; 3gp is preferred
Macintosh File Type Code(s): \'3gpp\'
Intended usage: COMMON
Restrictions on usage: Note that this MIME type is used only for files;
separate types are used for real-time transfer, such as for the RTP payload
format for AMR audio (RFC 4867 [15]).
Author:
3GPP TSG SA WG4
Change controller: 3GPP TSG SA
## A.1.3 Any files
The type \"video/3gpp\" is valid for all files. It is valid to serve an audio-
only file as \"video/3gpp\".
MIME media type name: video\ MIME subtype name: 3gpp
Required parameters: none
Optional parameters:
> codecs: is a single value or a comma-separated list that identifies the
> codec(s) needed for rendering the content contained (in tracks) of a file.
> The codecs parameter is defined in RFC 6381 [32]. The ISO file format name
> space and ISO syntax in clauses 3.3 and 3.4 of RFC 6381, respectively, shall
> be used together with additions defined in clause A.2.2 of the present
> document.
>
> types: is a single value or a comma-separated list that identifies the MIME
> media types of the content contained (in items) in a file. It is defined in
> clause A.2.3 of the present document.
Encoding considerations: files are binary and should be transmitted in a
suitable encoding without CR/LF conversion, 7-bit stripping etc.; base64 (RFC
4648 [35]) is a suitable encoding.
Security considerations: see the security considerations section in A.3 of the
present document.
Interoperability considerations: The 3GPP organization has defined the
specification, interoperability, and conformance. IMTC conducts
interoperability testing.
Published specification: 3GPP TS 26.234, Release 5; 3GPP TS 26.244, Release 6
or later. 3GPP specifications are publicly accessible at the 3GPP web site,
www.3gpp.org.
Applications which use this media type: Multi-media
Additional information:
Magic number(s): None. However, the file-type box must occur first in the
file, and must contain a 3GPP brand in its compatible brands list.
File extension(s): \'3gp\' and \'3gpp\' are both declared at
http://www.nist.gov/nics/; 3gp is preferred
Macintosh File Type Code(s): \'3gpp\'
Intended usage: COMMON
Restrictions on usage: Note that this MIME type is used only for files;
separate types are used for real-time transfer, such as for the RTP payload
format for AMR audio (RFC 4867 [15]).
Author:
3GPP TSG SA WG4
Change controller: 3GPP TSG SA
## A.1.4 video/vnd.3gpp.segment
Type name: video
Subtype name: vnd.3gpp.segment
Required parameters:
None.
Optional parameters:
> None.
Encoding considerations:
> Files are binary and should be transmitted in a suitable encoding without
> CR/LF conversion, 7-bit stripping etc.; base64 (RFC 4648 [35]) is a suitable
> encoding.
Security considerations:
See the security considerations section in A.3 of the present document.
Interoperability considerations:
None.
Published specification:
> 3GPP TS 26.244, Release 9.
Applications which use this media type:
Third Generation Partnership Project (3GPP) Adaptive HTTP Streaming.
Additional information:
Magic number(s):
None
File extension(s):
3gs
Person & email address to contact for further information:
John Meredith (john.meredith\@etsi.org)
Intended usage:
Common
Restrictions on usage:
Author:
3GPP TSG SA WG4
Change controller:
> 3GPP TSG SA
# A.2 Optional parameters
## A.2.1 General
Two optional parameters are defined here for the \"audio/3gpp\" and
\"video/3gpp\" media types. Additional parameters may be specified by updating
the media type registrations. Any unknown parameter shall be ignored.
## A.2.2 Codecs parameter
The codecs parameter is defined in RFC 6381. The ISO file format name space
and ISO syntax in clauses 3.3 and 3.4 of RFC 6381 [32] shall be used together
with extensions to the ISO syntax specified here.
The syntax in clause 3.4 of RFC 6381 defines the usage of the codecs parameter
for files based on the ISO base media file format and specifies that the first
element of a parameter value is a sample description entry four-character
code. It also includes specific definitions for MPEG audio (\'mp4a\') and MPEG
video (\'mp4v\') where each value in addition to the four-character code
includes two elements signalling Object Type Indications and Profile Level
Indications (video only). It also includes specific definitions for Advanced
Video Coding ('avc1') where each value in addition to the four-character code
includes a second element (referred to as 'avcoti' in the formal syntax),
which is the hexadecimal representation of the following three bytes in the
(subset) sequence parameter set Network Abstraction Layer (NAL) unit specified
in [29]: (1) profile_idc,(2) the byte containing the constraint_set flags
(currently constraint_set0_flag through constraint_set5_flag, and the
reserved_zero_2bits), and (3) level_idc. Note also that reserved_zero_2bits is
required to be equal to 0 in [29], but other values for it may be specified in
the future by ITU-T or ISO/IEC. These definitions apply to the MPEG codecs
used by the 3GP file format, such as H.264 (AVC) [29], MPEG-4 Visual [10],
MPEG-4 AAC [13] and Enhanced aacPlus [23, 24, 25]. Values for other codecs
used by the 3GP file format are specified below.
When the first element of a value is \'s263\', indicating H.263 video [9], the
second element is the decimal representation of the profile, e.g., 0 or 3, and
the third element is the decimal representation of the level, e.g. 10 or 45.
When the first element of a value is one of the following elements, no other
elements are defined for that value:
\- \'samr\', indicating AMR narrow-band speech [11];
\- \'sawb\', indicating AMR wide-band speech [12];
\- \'sawp\', indicating Extended AMR wide-band audio [21];
> \- \'sevs\', indicating EVS speech [55];
\- \'tx3g\', indicating timed text [4];
\- '3gvo', indicating CVO as defined in clauses 6.11 and 14.
The following syntax defines all values above in ABNF (RFC 4234 [31]) by
extending the definition in clause 3.4 of RFC 6381:
> id-iso = iso-gen / iso-mpega / iso-mpegv / iso-amr / iso-amr-wb / iso-amr-
> wbp / iso-evs / iso-tt / iso-h263; = iso-gen, iso-mepga, iso-mpegv, iso-avc
> as defined in RFC 6381
>
> iso-amr = %x73.61.6d.72 ; \'samr\'
>
> iso-amr-wb = %x73.61.77.62 ; \'sawb\'
>
> iso-amr-wbp = %x73.61.6d.70 ; \'sawp\'
>
> iso-evs = %x73.65.76.73 ; \'sevs\'
>
> iso-tt = %x74.78.33.67 ; \'tx3g\'
>
> iso-cvo = %x33.67.76.6f ; \'3gvo\'
>
> iso-h263 = s263 \".\" h263-profile \".\" h263-level
>
> s263 = %x73.32.36.33 ; \'s263\'
>
> h263-profile = 1*DIGIT
>
> h263-level = 1*DIGIT
The elements of the codecs parameter for H.265 (HEVC) are specified as below.
> NOTE: The following specification replaces that in clause E.3 of [20].
When the first element of a value is a code indicating a codec from the High
Efficiency Video Coding specification (ISO/IEC 23008-2), as documented in
clause 8 of [20] (such as \'hev1\' or \'hvc1\'), the elements following are a
series of values from the HEVC decoder configuration record, separated by
period characters ("."). In all numeric encodings, leading zeroes may be
omitted,
\- the general_profile_space, encoded as no character (general_profile_space
== 0), or 'A', 'B', 'C' for general_profile_space 1, 2, 3, followed by the
general_profile_idc encoded as a decimal number;
\- the 32 bits of the **general_profile_compatibility_flags, but in reverse
bit order, i.e. with general_profile_compatibility_flag[ 31 ] as the most
significant bit, followed by , general_profile_compatibility_flag[ 30 ], and
down to general_profile_compatibility_flag[ 0 ] as the least significant bit,
where general_profile_compatibility_flag[ i ] for i in the range of 0 to 31,
inclusive, are specified in** ISO/IEC 23008-2, encoded in hexadecimal (leading
zeroes may be omitted);
\- the general_tier_flag, encoded as 'L' (general_tier_flag==0) or 'H'
(general_tier_flag==1), followed by the general_level_idc, encoded as a
decimal number;
\- each of the 6 bytes of the constraint flags, starting from the byte
containing the general_progressive_source_flag, each encoded as a hexadecimal
number, and the encoding of each byte separated by a period; trailing bytes
that are zero may be omitted.
Examples:
> codecs=hev1.1.6.L93.B0
>
> a progressive, non-packed stream, Main Profile, Main Tier, Level 3.1. (Only
> one byte of the constraint flags is given here; The value after the second
> period is 6 instead of 2 because according to ISO/IEC 23008-2 a Main Profile
> bitstream should also be marked as compatible to the Main 10 Profile).
>
> codecs=hev1.A4.41.H120.B0.23
>
> a (mythical) progressive, non-packed stream in profile space 1, with
> general_profile_idc 4, some compatibility flags set, and in High tier at
> Level 4 and two bytes of constraint flags supplied.
For Quality metrics metadata track, the usage of the codecs parameter is
specified in [53].
## A.2.3 Types parameter
The types parameter is a single value or a comma-separated list that
identifies the MIME media types of the content contained (in items) of a 3GP
file. Each value consists of a type-subtype pair and corresponds to a value of
the content_type field provided for an item in the item information box.
If the types parameter is present, then it shall include all MIME types needed
for rendering the content contained (in items) of a file.
The types parameter is defined in ABNF (RFC 5234 [44]) below:
types = \"types\" \"=\" type-list
type-entry = type-name \"/\" subtype-name *( *WSP\";\" *WSP parameter )
parameter = attribute *WSP \"=\" *WSP value
attribute = token
value = token / quoted-string
token = 1*(%x21 / %x23-27 / %x2A-2B / %x2D-2E / %x30-39
/ %x41-5A / %x5E-7E)
; 1*\
type-list = DQUOTE type-entry *( \",\" type-entry ) DQUOTE
"type-name" and "subtype-name" are defined in RFC4288[42].
\"tspecials\" is defined in RFC2045[45]
"quoted-string" is defined in RFC5322[43].
\"CHAR\", \"CTL\", \"SP\", "WSP" and "DQUOTE" are defined in RFC 5234 [31].
NOTE: any \ character in \"type-entry\" needs to be escaped with \"\\\".
This is not shown in the above grammar.
# A.3 Security considerations
The 3GPP file format may contain audio, video, displayable text data, images,
graphics, scene descriptions, etc. Clearly it is possible to author malicious
files which attempt to call for an excessively large picture size, high
sampling-rate audio etc. However, clients can and usually do protect
themselves against this kind of attack. It should be noted that selected
metadata fields may encompass information partly intended to protect the media
against unauthorized use or distribution. In this case, the intention is that
alteration or removal of the data in the field would be treated as an offense
under national agreements based on World Intellectual Property Organization
(WIPO) treaties.
There is no current provision in the standards for signing or authentication
of these file formats.
#
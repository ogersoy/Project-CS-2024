# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document covers the minimum characteristics considered necessary
in order to provide compliance to TS 31.130 [2].
The present document describes the technical characteristics and methods of
test for testing the (U)SIM API for Java Card^TM^ (TS 31.130 [2]) implemented
in the (U)SIM. It specifies the following parts:
\- test applicability;
\- test environment description;
\- tests format;
\- test area reference;
\- conformance requirements;
\- test suite files;
\- test procedure;
\- test coverage; and
\- a description of the associated testing tools that shall be used.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or non‑specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
[1] ETSI TS 101 220: \"Integrated Circuit Cards (ICC); ETSI numbering system
for telecommunication; Application providers (AID)\".
[2] 3GPP TS 31 130 Release 6: \"(U)SIM API for Java Card™\"
[3] Void.
[4] 3GPP TS 31.102: \"Characteristics of the USIM Application\".
[5] 3GPP TS 51.011 Release 4: \"Specification of the Subscriber Identity
Module- Mobile Equipment (SIM -- ME) interface\".
[6] 3GPP TS 23.041: \"Technical realization of Cell Broadcast Service (CBS)\".
[7] Void.
[8] 3GPP TS 31.111: \"USIM Application Toolkit (USAT)\".
[9] Void.
[10] 3GPP TS 31.115: \"Secured packet structure for the (U)SIM Toolkit
applications\".
[11] 3GPP TS 23.040: \"Technical realization of the Short Message Service
(SMS)\".
[12] Sun Microsystems Java Card™ Specification: \"Java Card™ 2.2.1 Application
Programming Interface\".
[13] Sun Microsystems Java Card™ Specification: \"Java Card™ 2.2.1 Runtime
Environment (JCRE) Specification\".
[14] Sun Microsystems Java Card™ Specification: \"Java Card™ 2.2.1 Virtual
Machine Specification\".
SUN Java Card™ Specifications can be downloaded at
http://java.sun.com/products/javacard
[15] ETSI TS 102 268 V6.1.0: \"Test specification for UICC Application
Programming Interface for Java Card (TM) \".
[16] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [16] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[16].
**applet installation parameters:** values for applet installation parameters
**Conformance Requirement Reference (CRR):** description of the expected card
behaviour according to TS 31.130 [2]
**expected state:** state in which the (U)SIM is supposed to be after the
execution of the test procedure applied on the relevant initial conditions
**security parameters:** minimum security requirements defined for the applet
installation process
**test area:** set of Test Cases applicable to a specific part (class method,
CAT RE behaviour, etc) of the TS 31.130 [2].
**test case:** elementary test that checks for compliance with one or more
Conformance Requirement References
**test procedure:** sequence of actions/commands to perform all the test cases
defined in a test area
**test source file:** java file containing methods that will load and install
test applet in the card, execute and verify the test results, and restore the
Default Initial Conditions on the (U)SIM (when possible).
**test toolkit applet:** applet designed to test a specific functionality of
the USIM API (TS 31.130 [2])
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[16] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [16].
AID Application IDentifier
APDU Application Protocol Data Unit
API Application Programming Interface
CAT RE Card Application Toolkit Runtime Environment
CRR Conformance requirements Reference
CRRC Conformance requirement Reference Context Error
CRRN Conformance requirement Reference Normal
CRRP Conformance requirement Reference Parameter Error
FFS For Further Study
# 4 Test environment
This clause specifies requirements that shall be met and the testing rules
that shall be followed during the test procedure.
## 4.1 Applicability
The tests defined in the present document shall be performed taking into
account the services supported by the card as specified in the EF~SST~ file.
The test defined in the present document are applicable to cards implementing
TS 31.130 [2] unless otherwise stated.
The tests defined in the present document require that the card support the
concatenation process with 2 concatenated SMS.
## 4.2 Test environment description
The general architecture for the test environment is:
## 4.3 Tests format
### 4.3.1 Test area reference
Each test area is referenced as follows:
For API testing:
API Testing: \'API_[package name]_[classname]_[methodname]\' where
package name:
uicc.usim.access package: \'1\'
uicc.usim.toolkit package: \'2\'
class name:
yyy: 3 letters for each class.
See Annex A for full classes acronyms list.
method name:
zzzz[input parameters]:
See Annex A for full methods name acronyms list.
For Framework testing:
FWK: framework testing
Chapter name:
xxx: 3 letters for each chapter
See annex F for full chapter acronyms list
Subchapter name
yyyy: : 4 letters for each subchapter
See annex F for full subchapter acronyms list
#### 4.3.1.1 Conformance requirements
The conformance requirements are expressed in the following way:
\- Method prototype as listed in TS 31.130 [2].
\- Normal execution:
\- Contains normal execution and correct parameters limit values, each
referenced as a Conformance Requirement Reference Normal (CRRN).
\- Parameters error:
\- Contains parameter errors and incorrect parameter limit values, each
referenced as a Conformance Requirement Reference Parameter Error (CRRP).
\- Context error:
\- Contains errors due to the context the method is used in, each referenced
as a Conformance Requirement Reference Context Error (CRRC).
#### 4.3.1.2 Test area files
The files included in the Test Area use the following naming convention:
\- Test Source: Test_[Test Area Reference].java
\- Test Applet: [Test Area Reference]_[Test applet number].java
\- Cap File: [Test Area Reference].cap
The applet numbers start from \'1\'.
The test source shall use common interfaces defined in Annex D.
The Cap File format is described in Java Card™ Virtual Machine Specification
[4].
Test files can be run in any order.
All files from the same test area are located in the same subfolder.
#### 4.3.1.3 Test procedure
Each test procedure contains a table to indicate the expected responses form
the API and/or the APDU level as follows:
* * *
Test Case  
Id Description API/(U)SAT Framework Expectation APDU Expectation _Test Case
detailed description_ _API and/or (U)SAT Framework expected behaviour._
_Expected response at APDU level._
* * *
#### 4.3.1.4 Test coverage
The table above each test procedure indicates the correspondence between the
Conformance Requirements Reference (CRR) and the different test cases.
## 4.4 Initial conditions
The Initial Conditions are a set of general prerequisites for the (U)SIM prior
to the execution of testing. For each test procedure described in the present
document, the following rules apply to the Initial Conditions:
\- unless otherwise stated, the file system and the files\' content shall
fulfil the requirements described in annex B;
\- unless otherwise stated, before installing the applet(s) relevant to the
current test procedure, all packages specific to other test procedures shall
not be present.
When both statements apply, a test procedure is said to be in the \"Default
Initial Conditions\" state.
## 4.5 Package name
Java packages integrating this Test Suite shall follow this naming convention:
**uicc.usim.test.access.[Test Area Reference]:** Java Card packages containing
Test Area References for the TS 31.130 [2] uicc.access package.
**uicc.usim.test.toolkit.[Test Area Reference]:** Java Card packages
containing Test Area References for the TS 31.130 [2] uicc.toolkit package.
**uicc.usim.test.usatframework.[Test Area Reference]:** Java Card packages
containing Test Area References for the TS 31.130 [2] USAT Framework.
**uicc.usim.test.util:** for the Test util package defined in this Test Suite.
where the Test Area Reference is written in lower case.
EXAMPLE: The package _../uicc.usim.test.access.[Test Area Reference]_ creates
the following directory structure _../uiccusim//test/access/[Test Area
Reference]/Api_1_..._[1..n].*,_ where \'_Api_1_..._[1..n].*_ \' are the
different test applets Java source files used in _[Test Area Reference]_.
## 4.6 AID coding
The AID coding for the Test Packages, Applet classes and Applets shall be as
specified in ETSI TS 101 220 [5]. In addition, the following TAR and
Application Provider specific data values are defined for use within the
present document:
AID coding
* * *
Byte 1 Byte 12 Byte 13 Byte 14 Byte 15 Byte 16  
Application Provider specific data
                                                                                     TAR
                                                                                     Specified in ETSI TS 101 220 \[5\]
* * *
TAR coding (3 bytes/ 24 bits):
* * *
b1 b4 b5 b8 b9 b12 b13 b16 b17 b24  
Applet instance number Applet class number Package number RFU Test Part
Identifier
* * *
Applet instance number, Applet Class number, Package number:
For package AID, package number shall start from 0 and class and instance
numbers shall be 0.
For class AID, package number is the number of the class package, class number
shall start from 1 and instance shall be 0.
For instance AID, package and class number are the number of class and package
of which instance belongs, and instance number shall start from 1.
Test part Identifier (bits b1-b4):
\- 0000 reserved (as TAR= \'00.00.00\' is reserved for Issuer Security Domain)
\- 0010 API uicc.usim.toolkit
\- 0101 USAT Framework
\- 1110 USIM ADF
\- 1111 uicc.util
\- other values are RFU
Application Provider specific data (1 byte):
\- \'00\' for Package
\- \'01\' for Applet class
\- \'02\' for Applet Instance
EXAMPLE: The AID of Package uicc.usim.util is \'A0 00 00 00 87 10 05 FF FF FF
FF 89 F0 00 00 00\'.
## 4.7 Test equipment
These clauses recommend a minimum specification for each of the items of test
equipment referenced in the tests.
### 4.7.1 Test tool
This test tool shall meet the following requirements:
\- be able to send and receive APDU command to the USIM;
\- the result of I/O commands must be presented at the application layer;
\- be able to provide results of the tests;
\- shall send and/or compare all data specified in test file.
### 4.7.2 Interfaces and classes use
The USIM test tool extends the UICC test tool defined in ETSI TS 102 268 [15].
Then The USIM test tool cannot be run without having implemented the UICC test
tool.
The USIM test tool shall use some interfaces and classes, defined in Annex D.
They define the only allowed methods to write the test sources.
Interfaces and classes are defined as follow:
\- USimToolkitService defines methods to manage toolkit commands,
\- USimAPITestService defines methods to send envelopes defined in TS 31.111
[8],
\- USimAPITestCardService defines the static method to get a reference of the
class implementing all interfaces.
### 4.7.3 Util package
Annex D includes java source code of TestToolkitApplet abstract class of the
uicc.usim.util package. Each test applet shall extend this abstract class in
order to retrieve test results when selecting it.
### 4.7.4 Java Software Development kit version
Java software development kit (SDK) version supported by Java Card 2.2.1
specifications ([12], [13], [14]) is 1.4.1.
# 5 Test plan
The test plan is divided according to the (U)SIM API specification, that way
the tests will follow the class hierarchy for the uicc.usim.toolkit and
uicc.usim.access package; for the SIM Toolkit framework this test plan
describes the different points that will be tested with the present test
specification.
## 5.1 Package uicc.usim.access package
### 5.1.1 Interface SIMConstants
The constants in Java are resolved at compilation time, therefore a runtime
test is not useful. No test of constants will be performed.
### 5.1.2 Interface USIMConstants
The constants in Java are resolved at compilation time, therefore a runtime
test is not useful. No test of constants will be performed.
## 5.2 Package uicc.usim.toolkit package
### 5.2.1 Interface ToolkitConstants
The constants in Java are resolved at compilation time, therefore a runtime
test is not useful. No test of constants will be performed.
### 5.2.2 Interface USATEnvelopeHandler
#### 5.2.2.1 Method getSecuredDataLength
Test Area Reference: Api_2_Ueh_Gsdl
##### 5.2.2.1.1 Conformance requirement {#conformance-requirement .H6}
The method with following header shall be compliant to its definition in the
API.
public short getSecuredDataLength()
throws uicc.toolkit.ToolkitException
##### 5.2.2.1.1.1 Normal execution {#normal-execution .H6}
\- CRRN1: The method shall return the length of the Secured Data from the
Command Packet in the SMS TPDU (simple or concatenated) or Cell Broadcast Page
Comprehension TLV contained in the Envelope handler.
\- CRRN2: The length is from the first SMS TPDU TLV, USSD String TLV or Cell
Broadcast Page Comprehension TLV.
\- CRRN3: The length should not include padding bytes.
\- CRRN4: The method can be used if the event is EVENT_FORMATTED_SMS_PP_ENV
and if the SMS TP UD is formatted according to TS 31.115 [10] Single or
Concatenated Short Message.
\- CRRN5: The method can be used if the event is EVENT_FORMATTED_SMS_PP_UPD
and if the SMS TP UD is formatted according to TS 31.115 [10] Single or
Concatenated Short Message.
\- CRRN6: The method can be used if the event is EVENT_FORMATTED_SMS_CB and if
the Cell Broadcast Page is formatted according to TS 31.115 [10].
\- CRRN7: The method can be used if the event is EVENT_FORMATTED_USSD and if
the USSD String id is formatted according to TS31.115 [10]
\- CRRN8: If the method is successful and if the event is
EVENT_FORMATTED_SMS_PP_ENV, the selected TLV should be the SMS TPDU TLV.
\- CRRN9: If the method is successful and if the event is
EVENT_FORMATTED_SMS_PP_UPD, the selected TLV should be the SMS TPDU TLV.
\- CRRN10: If the method is successful and if the event is
EVENT_FORMATTED_SMS_CB, the selected TLV should be the Cell Broadcast Page
TLV.
\- CRRN11: If the method is successful and if the event is
EVENT_FORMATTED_USSD, the selected TLV should be the USSD String TLV.
##### 5.2.2.1.1.2 Parameter errors {#parameter-errors .H6}
No requirements.
##### 5.2.2.1.1.3 Context errors {#context-errors .H6}
\- CRRC1: The method shall throw ToolkitException.UNAVAILABLE_ELEMENT in case
of unavailable SMS TPDU TLV, USSD String TLV element or Cell Broadcast Page
Comprehension TLV.
\- CRRC2: The method shall throw ToolkitException.UNAVAILABLE_ELEMENT in case
of wrong data format.
##### 5.2.2.1.2 Test area files {#test-area-files-1 .H6}
Specific triggering:
\- FORMATTED SMS CB.
\- UNFORMATTED SMS CB.
\- FORMATTED SMS PP ENV.
\- UNFORMATED SMS PP ENV.
\- FORMATTED SMS PP UPD.
\- FORMATTED USSD ENV.
\- UNFORMATTED USSD ENV.
\- For Formatted triggering if CC/RC/DS is used, the security parameters are
the one defined in section "5.3.8 Framework Security Management".
Test Source: Test_Api_2_Ueh_Gsdl.java
Test Applet: Api_2_Ueh_Gsdl_1.java
Cap File: Api_2_Ueh_Gsdl.cap
##### 5.2.2.1.3 Test coverage {#test-coverage-1 .H6}
* * *
CRR number Test case number N1 1 to 42 N2 13, 30 N3 6, 7, 23, 24, 37, 38 N4 1
to 17 N5 18 to 34 N6 35 to 42 N7 43 to 56 N8 17 N9 34 N10 42 N11 56 C1 57 C2
58 C3 59
* * *
##### 5.2.2.1.4 Test procedure {#test-procedure-1 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | | **FORMATTED SMS PP | | | | | ENV Triggering** | | | +----+--------------------+--------------------+------------------+ | 1 | Test with | Returns 0x002A | | | | FORMA | | | | | TTED_SMS_PP_ENV | | | | | and TP-OA length | | | | | of 2 | | | +----+--------------------+--------------------+------------------+ | 2 | Test with TP-OA | Returns 0x002A | | | | length of 6 | | | +----+--------------------+--------------------+------------------+ | 3 | Test with TP-OA | Returns 0x002A | | | | length of 12 | | | +----+--------------------+--------------------+------------------+ | 4 | Test with RC/CC/DS | Returns 0x0010 | | | | length of 0 | | | +----+--------------------+--------------------+------------------+ | 5 | Test with RC/CC/DS | Returns 0x0010 | | | | length of 8 | | | +----+--------------------+--------------------+------------------+ | 6 | Test with PCNTR = | Returns 0x0010 | | | | 0 | | | +----+--------------------+--------------------+------------------+ | 7 | Test with PCNTR = | Returns 0x0003 | | | | 7 (ciphering shall | | | | | be used) | | | +----+--------------------+--------------------+------------------+ | 8 | Test with Secured | Returns 0x0000 | | | | Data Length = 00 | | | +----+--------------------+--------------------+------------------+ | 9 | Test with Secured | Returns 0x0033 | | | | Data Length = 0x33 | | | +----+--------------------+--------------------+------------------+ | 10 | Test with Secured | Returns 0x006C | | | | Data Length = 0x6C | | | | | (UDL = 0x7F) | | | +----+--------------------+--------------------+------------------+ | 11 | Test with Secured | Returns 0x006D | | | | Data Length = 0x6D | | | | | (UDL = 0x80) | | | +----+--------------------+--------------------+------------------+ | 12 | Test with Secured | Returns 0x0079 | | | | Data Length = | | | | | maximum length for | | | | | one envelope : | | | | | 0x79 (UDL = 0x8C) | | | +----+--------------------+--------------------+------------------+ | 13 | Verify it is the | Returns 0x0005 | | | | first TPDU TLV: | | | | | | | | | | Send a SMS PP with | | | | | 2 TPDU TLV and | | | | | inside two | | | | | different secured | | | | | data lengths: 5 | | | | | and 10 | | | +----+--------------------+--------------------+------------------+ | 14 | Test with secured | Returns 0x007F | | | | data length = 0x7F | | | | | (2 concatenated | | | | | envelopes are | | | | | needed) | | | +----+--------------------+--------------------+------------------+ | 15 | Test with secured | Returns 0x0080 | | | | data length = 0x80 | | | | | (2 concatenated | | | | | envelopes are | | | | | needed) | | | +----+--------------------+--------------------+------------------+ | 16 | Test with secured | Returns 0x00FA | | | | data length = | | | | | maximum length for | | | | | 2 concatenated | | | | | envelopes : 0xFA | | | +----+--------------------+--------------------+------------------+ | 17 | Test with | getValueByte | | | | FORMA | returns 0x0040 | | | | TTED_SMS_PP_ENV | | | | | | | | | | Verify after call | | | | | of the method the | | | | | current TLV is the | | | | | TPDU TLV: | | | | | | | | | | findTLV device | | | | | identities, | | | | | ge | | | | | tSecuredDataLength | | | | | and then | | | | | getValueByte to | | | | | verify that the | | | | | current TLV is the | | | | | TPDU TLV | | | +----+--------------------+--------------------+------------------+ | | **FORMATTED SMS PP | | | | | UPD Triggering** | | | +----+--------------------+--------------------+------------------+ | 18 | Same test as 1 but | Returns 0x002A | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 19 | Same test as 2 but | Returns 0x002A | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 20 | Same test as 3 but | Returns 0x002A | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 21 | Same test as 4 but | Returns 0x0010 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 22 | Same test as 5 but | Returns 0x0010 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 23 | Same test as 6 but | Returns 0x0010 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 24 | Same test as 7 but | Returns 0x0003 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 25 | Same test as 8 but | Returns 0x0000 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 26 | Same test as 9 but | Returns 0x0033 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 27 | Same test as 10 | Returns 0x006C | | | | but with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 28 | Same test as 11 | Returns 0x006D | | | | but with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 29 | Same test as 12 | Returns 0x0079 | | | | but with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 30 | Same test as 13 | Returns 0x0005 | | | | but with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 31 | Test with secured | Returns 0x007F | | | | data length = 0x7F | | | | | (2 concatenated | | | | | envelopes are | | | | | needed) | | | +----+--------------------+--------------------+------------------+ | 32 | Test with secured | Returns 0x0080 | | | | data length = 0x80 | | | | | (2 concatenated | | | | | envelopes are | | | | | needed) | | | +----+--------------------+--------------------+------------------+ | 33 | Test with secured | Returns 0x00FA | | | | data length = | | | | | maximum length for | | | | | 2 concatenated | | | | | envelopes : 0xFA | | | +----+--------------------+--------------------+------------------+ | 34 | Test with | getValueByte | | | | FORMA | returns 0x0040 | | | | TTED_SMS_PP_UPD | | | | | | | | | | Verify after call | | | | | of the method the | | | | | current TLV is the | | | | | TPDU TLV: | | | | | | | | | | findTLV device | | | | | identities, | | | | | ge | | | | | tSecuredDataLength | | | | | and then | | | | | getValueByte to | | | | | verify that the | | | | | current TLV is the | | | | | TPDU TLV | | | +----+--------------------+--------------------+------------------+ | | **FORMATTED SMS CB | | | | | Triggering** | | | +----+--------------------+--------------------+------------------+ | 35 | Same test as 4 but | Returns 0x0010 | | | | with | | | | | FORMATTED_SMS_CB | | | +----+--------------------+--------------------+------------------+ | 36 | Same test as 5 but | Returns 0x0010 | | | | with | | | | | FORMATTED_SMS_CB | | | +----+--------------------+--------------------+------------------+ | 37 | Same test as 6 but | Returns 0x0010 | | | | with | | | | | FORMATTED_SMS_CB | | | +----+--------------------+--------------------+------------------+ | 38 | Same test as 7 but | Returns 0x0003 | | | | with | | | | | FORMATTED_SMS_CB | | | +----+--------------------+--------------------+------------------+ | 39 | Same test as 8 but | Returns 0x0000 | | | | with | | | | | FORMATTED_SMS_CB | | | +----+--------------------+--------------------+------------------+ | 40 | Same test as 9 but | Returns 0x0033 | | | | with | | | | | FORMATTED_SMS_CB | | | +----+--------------------+--------------------+------------------+ | 41 | Same test as 12 | Returns 0x0042 | | | | but with maximum | | | | | secured data | | | | | length: 0x42, and | | | | | FORMATTED_SMS_CB | | | +----+--------------------+--------------------+------------------+ | 42 | Test with | getValueByte | | | | FORMATTED_SMS_CB | returns 0x00 | | | | | | | | | Verify after call | | | | | of the method the | | | | | current TLV is the | | | | | Cell Broadcast | | | | | Page TLV: | | | | | | | | | | findTLV device | | | | | identities, | | | | | ge | | | | | tSecuredDataLength | | | | | and then | | | | | getValueByte to | | | | | verify that the | | | | | current TLV is the | | | | | Cell Broadcast | | | | | Page TLV | | | +----+--------------------+--------------------+------------------+ | | **FORMATTED USSD | | | | | Triggering** | | | +----+--------------------+--------------------+------------------+ | 43 | Test with | Returns 0x0010 | | | | formatted USSD and | | | | | RC/CC/DS length of | | | | | 0 | | | +----+--------------------+--------------------+------------------+ | 44 | Test with RC/CC/DS | Returns 0x0010 | | | | length of 8 | | | +----+--------------------+--------------------+------------------+ | 45 | Test with PCNTR = | Returns 0x0010 | | | | 0 | | | +----+--------------------+--------------------+------------------+ | 46 | Test with PCNTR = | Returns 0x0003 | | | | 7 (ciphering shall | | | | | be used) | | | +----+--------------------+--------------------+------------------+ | 47 | Test with Secured | Returns 0x0000 | | | | Data Length = 00 | | | +----+--------------------+--------------------+------------------+ | 48 | Test with Secured | Returns 0x0033 | | | | Data Length = 0x33 | | | +----+--------------------+--------------------+------------------+ | 49 | Test with Secured | Returns 0x006C | | | | Data Length = 0x6C | | | | | (UDL = 0x7F) | | | +----+--------------------+--------------------+------------------+ | 50 | Test with Secured | Returns 0x006D | | | | Data Length = 0x6D | | | | | (UDL = 0x80) | | | +----+--------------------+--------------------+------------------+ | 51 | Test with Secured | Returns 0x0079 | | | | Data Length = | | | | | maximum length for | | | | | one envelope : | | | | | 0x79 (UDL = 0x8C) | | | +----+--------------------+--------------------+------------------+ | 52 | Verify it is the | Returns 0x0005 | | | | first String TLV: | | | | | | | | | | Send a USSD with 2 | | | | | USSD String TLV | | | | | and inside two | | | | | different secured | | | | | data lengths: 5 | | | | | and 10 | | | +----+--------------------+--------------------+------------------+ | 53 | Test with secured | Returns 0x007F | | | | data length = 0x7F | | | | | (2 concatenated | | | | | envelopes are | | | | | needed) | | | +----+--------------------+--------------------+------------------+ | 54 | Test with secured | Returns 0x0080 | | | | data length = 0x80 | | | | | (2 concatenated | | | | | envelopes are | | | | | needed) | | | +----+--------------------+--------------------+------------------+ | 55 | Test with secured | Returns 0x00FA | | | | data length = | | | | | maximum length for | | | | | 2 concatenated | | | | | envelopes : 0xFA | | | +----+--------------------+--------------------+------------------+ | 56 | Test with | getValueByte | | | | FORMATTED_USSD | returns 0x0040 | | | | | | | | | Verify after call | | | | | of the method the | | | | | current TLV is the | | | | | USSD String TLV: | | | | | | | | | | findTLV device | | | | | identities, | | | | | ge | | | | | tSecuredDataLength | | | | | and then | | | | | getValueByte to | | | | | verify that the | | | | | current TLV is the | | | | | USSD String TLV | | | +----+--------------------+--------------------+------------------+ | | **Error tests** | | | +----+--------------------+--------------------+------------------+ | 57 | Send an envelope | T | | | | SMS CB, | oolkitException.UN | | | | ge | AVAILABLE_ELEMENT | | | | tSecuredDataLength | | | +----+--------------------+--------------------+------------------+ | 58 | Send an envelope | T | | | | SMS PP unformatted | oolkitException.UN | | | | | AVAILABLE_ELEMENT | | +----+--------------------+--------------------+------------------+ | 59 | Send an envelope | T | | | | USSD unformatted | oolkitException.UN | | | | | AVAILABLE_ELEMENT | | +----+--------------------+--------------------+------------------+
#### 5.2.2.2 Method getSecuredDataOffset
Test Area Reference: Api_2_Ueh_Gsdo
##### 5.2.2.2.1 Conformance requirement {#conformance-requirement-1 .H6}
The method with following header shall be compliant to its definition in the
API.
public short getSecuredDataOffset()
throws uicc.toolkit.ToolkitException
##### 5.2.2.2.1.1 Normal execution {#normal-execution-1 .H6}
\- CRRN1: The method shall return the offset of the secured data first byte
contained in a SMS TPDU TLV or USSD String TLV.
\- CRRN2: The offset is from the first SMS TPDU TLV or USSD String TLV.
\- CRRN3: The method can be used if the event is EVENT_FORMATTED_SMS_PP_ENV
and if the SMS TP-UD is formatted according to TS 31.115 [10].
\- CRRN4: The method can be used if the event is EVENT_FORMATTED_SMS_PP_UPD
and if the SMS TP-UD is formatted according to TS 31.115 [10].
\- CRRN5: The method can be used if the event is EVENT_FORMATTED_SMS_CB and if
the Cell Broadcast Page is formatted according to TS 31.115 [10].
\- CRRN6: If the method is successful and if the event is
EVENT_FORMATTED_SMS_PP_ENV, the selected TLV should be the SMS TPDU TLV.
\- CRRN7: If the method is successful and if the event is
EVENT_FORMATTED_SMS_PP_UPD, the selected TLV should be the SMS TPDU TLV.
\- CRRN8: If the method is successful and if the event is
EVENT_FORMATTED_SMS_CB, the selected TLV should be the Cell Broadcast Page
TLV.
\- CRRN9: If the method is successful and if the event is
EVENT_FORMATTED_USSD, the selected TLV should be the USSD String TLV.
\- CRRN10: If the Secured Data length is zero the value returned shall be the
offset of the first byte following the TS 31.115 [10] Command Packet
structure.
##### 5.2.2.2.1.2 Parameter errors {#parameter-errors-1 .H6}
No requirements.
##### 5.2.2.2.1.3 Context errors {#context-errors-1 .H6}
\- CRRC1: The method shall throw ToolkitException.UNAVAILABLE_ELEMENT in case
of unavailable SMS TPDU TLV or USSD String TLV element.
\- CRRC2: The method shall throw ToolkitException.UNAVAILABLE_ELEMENT in case
of wrong data format.
##### 5.2.2.2.2 Test area files {#test-area-files-2 .H6}
Specific triggering:
\- FORMATTED SMS CB.
\- UNFORMATTED SMS CB.
\- FORMATTED SMS PP UPD.
\- FORMATTED SMS PP ENV.
\- UNFORMATED SMS PP ENV.
\- FORMATTED USSD ENV.
\- UNFORMATTED USSD ENV.
\- For Formatted triggering if CC/RC/DS is used, the security parameters are
the one defined in section "5.3.8 Framework Security Management".
Test Source: Test_Api_2_Ueh_Gsdo.java
Test Applet: Api_2_Ueh_Gsdo_1.java
Cap File: Api_2_Ueh_Gsdo.cap
##### 5.2.2.2.3 Test coverage {#test-coverage-2 .H6}
* * *
CRR number Test case number N1 1 to 20 N2 5, 13 N3 1 to 8 N4 9 to 16 N5 17,
18, 19, 20 N6 7 N7 15 N8 20 N9 21 to 25 N10 6, 14, 19 C1 26 C2 27
* * *
##### 5.2.2.2.4 Test procedure {#test-procedure-2 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | | **FORMATTED SMS PP | | | | | ENV triggering** | | | +----+--------------------+--------------------+------------------+ | 1 | Test with TP-OA | Returns 0x21 | | | | length of 2 and | | | | | RC/CC/DS length is | | | | | 0 | | | +----+--------------------+--------------------+------------------+ | 2 | Test with TP-OA | Returns 0x23 | | | | length of 6 and | | | | | RC/CC/DS length is | | | | | 0 | | | +----+--------------------+--------------------+------------------+ | 3 | Test with TP-OA | Returns 0x26 | | | | length of 12 and | | | | | RC/CC/DS length is | | | | | 0 | | | +----+--------------------+--------------------+------------------+ | 4 | Test with RC/CC/DS | Returns 0x29 | | | | length of 8 and | | | | | TP-OA length is 2 | | | +----+--------------------+--------------------+------------------+ | 5 | Send a SMS PP with | Returns 0x24 ( the | | | | 2 TPDU TLV and | first offset ) | | | | inside two | | | | | different secured | | | | | data offsets | | | +----+--------------------+--------------------+------------------+ | 6 | Same test as 1 but | Returns 0x21 | | | | without any | | | | | secured data | | | +----+--------------------+--------------------+------------------+ | 7 | Test with | Returns 0x40 | | | | FORMATTED_SMS_PP | | | | | ENV | | | | | | | | | | Verify after call | | | | | of the method the | | | | | current TLV is the | | | | | TPDU TLV: | | | | | | | | | | findTLV device | | | | | identities, | | | | | ge | | | | | tSecuredDataOffset | | | | | and then | | | | | getValueByte to | | | | | verify that the | | | | | current TLV is the | | | | | TPDU TLV | | | +----+--------------------+--------------------+------------------+ | 8 | Same test as 1, | Returns 0x21 | | | | but with a | | | | | concatenated SMS | | | | | (2 Short Messages | | | | | and maximum | | | | | Secured Data | | | | | Length = 0x00FA) | | | +----+--------------------+--------------------+------------------+ | | **FORMATTED SMS PP | | | | | UPR triggering** | | | +----+--------------------+--------------------+------------------+ | 9 | Same test as 1 but | Returns 0x21 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 10 | Same test as 2 but | Returns 0x23 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 11 | Same test as 3 but | Returns 0x26 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 12 | Same test as 4 but | Returns 0x29 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 13 | Same test as 5 but | Returns 0x24 ( the | | | | with | first offset ) | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 14 | Same test as 6 but | Returns 0x21 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 15 | Test with | Returns 0x40 | | | | FORMATTED_SMS_PP | | | | | UPD | | | | | | | | | | Verify after call | | | | | of the method the | | | | | current TLV is the | | | | | TPDU TLV: | | | | | | | | | | findTLV device | | | | | identities, | | | | | ge | | | | | tSecuredDataOffset | | | | | and then | | | | | getValueByte to | | | | | verify that the | | | | | current TLV is the | | | | | TPDU TLV | | | +----+--------------------+--------------------+------------------+ | 16 | Same test as 8, | Returns 0x21 | | | | but with a | | | | | concatenated SMS | | | | | (2 Short Messages | | | | | and maximum | | | | | Secured Data | | | | | Length = 0x00FA) | | | +----+--------------------+--------------------+------------------+ | | **FORMATTED SMS CB | | | | | triggering** | | | +----+--------------------+--------------------+------------------+ | 17 | Same test as 2 but | Returns 0x16 | | | | with | | | | | FORMATTED_SMS_CB | | | +----+--------------------+--------------------+------------------+ | 18 | Same test as 4 but | Returns 0x1E | | | | with | | | | | FORMATTED_SMS_CB | | | +----+--------------------+--------------------+------------------+ | 19 | Same test as 6 but | Returns 0x16 | | | | with | | | | | FORMATTED_SMS_CB | | | +----+--------------------+--------------------+------------------+ | 20 | Test with | Returns 0x00 | | | | FORMATTED_SMS_CB | | | | | | | | | | Verify after call | | | | | of the method the | | | | | current TLV is the | | | | | Cell Broadcast | | | | | Page TLV: | | | | | | | | | | findTLV device | | | | | identities, | | | | | ge | | | | | tSecuredDataOffset | | | | | and then | | | | | getValueByte to | | | | | verify that the | | | | | current TLV is the | | | | | Cell Broadcast | | | | | Page TLV | | | +----+--------------------+--------------------+------------------+ | | **FORMATTED USSD | | | | | triggering** | | | +----+--------------------+--------------------+------------------+ | 21 | Test with RC/CC/DS | Returns 0x29 | | | | length of 8 | | | +----+--------------------+--------------------+------------------+ | 22 | Send a USSD with 2 | Returns 0x24 ( the | | | | USSD StringTLV and | first offset ) | | | | inside two | | | | | different secured | | | | | data offsets | | | +----+--------------------+--------------------+------------------+ | 23 | Same test as 1 but | Returns 0x21 | | | | without any | | | | | secured data | | | +----+--------------------+--------------------+------------------+ | 24 | Test with | Returns 0x40 | | | | FORMATTED_USSD | | | | | | | | | | Verify after call | | | | | of the method the | | | | | current TLV is the | | | | | String TLV: | | | | | | | | | | findTLV device | | | | | identities, | | | | | ge | | | | | tSecuredDataOffset | | | | | and then | | | | | getValueByte to | | | | | verify that the | | | | | current TLV is the | | | | | StringTLV | | | +----+--------------------+--------------------+------------------+ | 25 | Same test as 1, | Returns 0x21 | | | | but with a | | | | | concatenated SMS | | | | | (2 USSD message | | | | | and maximum | | | | | Secured Data | | | | | Length = 0x00FA) | | | +----+--------------------+--------------------+------------------+ | | **UNFORMATTED | | | | | Triggering** | | | +----+--------------------+--------------------+------------------+ | 26 | Send an | T | | | | UNFORMATTED SMS CB | oolkitException.UN | | | | envelope, | AVAILABLE_ELEMENT | | | | ge | | | | | tSecuredDataOffset | | | +----+--------------------+--------------------+------------------+ | 27 | Send an | T | | | | UNFORMATTED SMS PP | oolkitException.UN | | | | envelope, | AVAILABLE_ELEMENT | | | | ge | | | | | tSecuredDataOffset | | | +----+--------------------+--------------------+------------------+ | 28 | Send an | T | | | | UNFORMATTED USSD | oolkitException.UN | | | | envelope, | AVAILABLE_ELEMENT | | | | ge | | | | | tSecuredDataOffset | | | +----+--------------------+--------------------+------------------+
#### 5.2.2.3 Method getShortMessageLength
Test Area Reference: Api_2_Ueh_Gsml
##### 5.2.2.3.1 Conformance requirement {#conformance-requirement-2 .H6}
The method with following header shall be compliant to its definition in the
API.
public short getShortMessageLength()
throws uicc.toolkit.ToolkitException
##### 5.2.2.3.1.1 Normal execution {#normal-execution-2 .H6}
\- CRRN1: The method shall return the length of the Short Message from the
User Data part in the SMS TPDU (simple or concatenated) or Cell Broadcast Page
Comprehension TLV contained in the USATEnvelopeHandler.
\- CRRN2: The length is from the first SMS TPDU TLV or Cell Broadcast Page
Comprehension TLV.
\- CRRN3: The length should not include padding bytes.
\- CRRN4: The length should not include the UDH if any.
\- CRRN5: The method can be used if the event is EVENT_FORMATTED_SMS_PP_ENV or
EVENT_UNFORMATTED_SMS_PP.
\- CRRN6: The method can be used if the event is EVENT_FORMATTED_SMS_PP_UPD or
EVENT_UNFORMATTED_SMS_UPD.
\- CRRN7: The method can be used if the event is EVENT_FORMATTED_SMS_CB or
EVENT_UNFORMATTED_SMS_CB.
\- CRRN8: If the method is successful and if the event is
EVENT_FORMATTED_SMS_PP_ENV or EVENT_UNFORMATTED_SMS_PP, the selected TLV
should be the SMS TPDU TLV.
\- CRRN9: If the method is successful and if the event is
EVENT_FORMATTED_SMS_PP_UPD or EVENT_UNFORMATTED_SMS_UPD, the selected TLV
should be the SMS TPDU TLV.
\- CRRN10: If the method is successful and if the event is
EVENT_FORMATTED_SMS_CB or EVENT_UNFORMATTED_SMS_CB, the selected TLV should be
the Cell Broadcast Page TLV.
\- CRRN11: If the Short Message Length is zero, no exception shall be thrown.
##### 5.2.2.3.1.2 Parameter errors {#parameter-errors-2 .H6}
No requirements.
##### 5.2.2.3.1.3 Context errors {#context-errors-2 .H6}
\- CRRC1: The method shall throw ToolkitException.UNAVAILABLE_ELEMENT in case
of unavailable SMS TPDU TLV element or Cell Broadcast Page Comprehension TLV.
\- CRRC2: The method shall throw ToolkitException.UNAVAILABLE_ELEMENT in case
of wrong data format.
##### 5.2.2.3.2 Test area files {#test-area-files-3 .H6}
Specific triggering:
\- FORMATTED SMS CB.
\- UNFORMATTED SMS CB.
\- FORMATTED SMS PP UPD.
\- UNFORMATTED SMS PP UPD.
\- FORMATTED SMS PP ENV.
\- UNFORMATTED SMS PP ENV.
\- UNRECOGNIZED_ENVELOPE.
\- For Formatted triggering if CC/RC/DS is used, the security parameters are
the one defined in section "5.3.8 Framework Security Management".
Test Source: Test_Api_2_Ueh_Gsml.java
Test Applet: Api_2_Ueh_Gsml_1.java
Cap File: Api_2_Ueh_Gsml.cap
##### 5.2.2.3.3 Test coverage {#test-coverage-3 .H6}
* * *
CRR number Test case number N1 1 to 46 N2 8, 18, 26, 34, 41, 45 N3 4, 14, 22
N4 1 to 27 N5 1 to 10 and 28 to 35 N6 11 to 20 and 36 to 43 N7 21 to 27 and 44
to 46 N8 9, 35 N9 19, 43 N10 27, 46 N11 6, 16, 24, 30, 38 C1 47 C2 Not
applicable
* * *
##### 5.2.2.3.4 Test procedure {#test-procedure-3 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | | FORMATTED SMS PP | | | | | ENV Triggering | | | +----+--------------------+--------------------+------------------+ | 1 | Test with | Returns 0x003A | | | | FORMA | | | | | TTED_SMS_PP_ENV | | | | | and TP-OA length | | | | | of 2 and secured | | | | | data length of | | | | | 0x2A with no | | | | | padding byte | | | | | (PCNTR = 0, no | | | | | RC/CC/DS) | | | +----+--------------------+--------------------+------------------+ | 2 | Test with TP-OA | Returns 0x003A | | | | length of 12 and | | | | | secured data | | | | | length of 0x2A | | | | | with no padding | | | | | byte (PCNTR = 0, | | | | | no RC/CC/DS) | | | +----+--------------------+--------------------+------------------+ | 3 | Test with PCNTR = | Returns 0x0020 | | | | 0, no RC/CC/DS and | | | | | data length of | | | | | 0x10 | | | +----+--------------------+--------------------+------------------+ | 4 | Test with PCNTR = | Returns 0x001A | | | | 7, no RC/CC/DS and | | | | | data length of | | | | | 0x03 (ciphering | | | | | shall be used) | | | +----+--------------------+--------------------+------------------+ | 5 | Test with PCNTR = | Returns 0x0028 | | | | 0, with RC/CC/DS | | | | | length of 8 and | | | | | secured data | | | | | length of 0x10 | | | +----+--------------------+--------------------+------------------+ | 6 | Test with PCNTR = | Returns 0x0010 | | | | 0, no RC/CC/DS and | | | | | SecuredDataLength | | | | | = 00 | | | +----+--------------------+--------------------+------------------+ | 7 | Test with PCNTR = | Returns 0x0089 | | | | 0, no RC/CC/DS and | | | | | UserDataLength = | | | | | maximum length | | | | | (0x8C) for a | | | | | single SMS | | | +----+--------------------+--------------------+------------------+ | 8 | Verify it is the | Returns 0x0015 | | | | first TPDU TLV: | | | | | | | | | | Send a SMS PP with | | | | | 2 TPDU TLV with | | | | | two different user | | | | | data lengths: 0x18 | | | | | and 0x23 (with | | | | | PCNTR = 0, no | | | | | RC/CC/DS) | | | +----+--------------------+--------------------+------------------+ | 9 | Send envelope | getValueByte() | | | | SMS-PP Formatted. | returns | | | | | 0x4 | | | | FindTLV() with | 0(TS 23.040 [11] | | | | TAG_D | first byte) | | | | EVICE_IDENTITIES. | | | | | getSh | | | | | ortMessageLength() | | | | | and then | | | | | getValueByte() | | | | | with offset 0 | | | +----+--------------------+--------------------+------------------+ | 10 | Test with | Returns 0x010A | | | | UserDataLength = | | | | | maximum length | | | | | (0x010D) with 2 | | | | | concatenated SMS | | | +----+--------------------+--------------------+------------------+ | | FORMATTED SMS PP | | | | | UPD Triggering | | | +----+--------------------+--------------------+------------------+ | 11 | Test with | Returns 0x003A | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | | | and TP-OA length | | | | | of 2 and secured | | | | | data length of | | | | | 0x2A with no | | | | | padding byte | | | | | (PCNTR = 0) | | | +----+--------------------+--------------------+------------------+ | 12 | Test with TP-OA | Returns 0x003A | | | | length of 12 and | | | | | secured data | | | | | length of 0x2A | | | | | with no padding | | | | | byte (PCNTR = 0) | | | +----+--------------------+--------------------+------------------+ | 13 | Test with PCNTR = | Returns 0x0020 | | | | 0, no RC/CC/DS and | | | | | data length of | | | | | 0x10 | | | +----+--------------------+--------------------+------------------+ | 14 | Test with PCNTR = | Returns 0x001A | | | | 7, no RC/CC/DS and | | | | | data length of | | | | | 0x03 (ciphering | | | | | shall be used) | | | +----+--------------------+--------------------+------------------+ | 15 | Test with PCNTR = | Returns 0x0028 | | | | 0, with RC/CC/DS | | | | | length of 8 and | | | | | secured data | | | | | length of 0x10 | | | +----+--------------------+--------------------+------------------+ | 16 | Test with PCNTR = | Returns 0x0010 | | | | 0, no RC/CC/DS and | | | | | SecuredDataLength | | | | | = 00 | | | +----+--------------------+--------------------+------------------+ | 17 | Test with PCNTR = | Returns 0x0089 | | | | 0, no RC/CC/DS and | | | | | UserDataLength = | | | | | maximum length | | | | | (0x8C) for a | | | | | single SMS | | | +----+--------------------+--------------------+------------------+ | 18 | Verify it is the | Returns 0x0015 | | | | first TPDU TLV: | | | | | | | | | | Send a SMS PP with | | | | | 2 TPDU TLV with | | | | | two different user | | | | | data lengths: 0x18 | | | | | and 0x23 (with | | | | | PCNTR = 0, no | | | | | RC/CC/DS) | | | +----+--------------------+--------------------+------------------+ | 19 | Send envelope | GetValueByte() | | | | SMS-PP Formatted. | returns | | | | | 0x4 | | | | FindTLV() with | 0(TS 23.040 [11] | | | | TAG_D | first byte) | | | | EVICE_IDENTITIES. | | | | | GetSh | | | | | ortMessageLength() | | | | | and then | | | | | getValueByte() | | | | | with offset 0 | | | +----+--------------------+--------------------+------------------+ | 20 | Test with | Returns 0x0010A | | | | UserDataLength = | | | | | maximum length | | | | | (0x010D) with 2 | | | | | concatenated SMS | | | +----+--------------------+--------------------+------------------+ | | FORMATTED SMS CB | | | | | Triggering | | | +----+--------------------+--------------------+------------------+ | 21 | Test with PCNTR = | Returns 0x0052 | | | | 0, no RC/CC/DS and | | | | | data length of | | | | | 0x10 | | | +----+--------------------+--------------------+------------------+ | 22 | Test with PCNTR = | Returns 0x0052 | | | | 7, no RC/CC/DS and | | | | | data length of | | | | | 0x03 (ciphering | | | | | shall be used) | | | +----+--------------------+--------------------+------------------+ | 23 | Test with PCNTR = | Returns 0x0052 | | | | 0, with RC/CC/DS | | | | | length of 8 and | | | | | secured data | | | | | length of 0x10 | | | +----+--------------------+--------------------+------------------+ | 24 | Test with PCNTR = | Returns 0x0052 | | | | 0, no RC/CC/DS and | | | | | SecuredDataLength | | | | | = 00 | | | +----+--------------------+--------------------+------------------+ | 25 | Test with PCNTR = | Returns 0x0052 | | | | 0, no RC/CC/DS and | | | | | UserDataLength = | | | | | maximum length | | | | | (0x58) for a | | | | | single SMS CB | | | +----+--------------------+--------------------+------------------+ | 26 | Verify it is the | Returns 0x0052 and | | | | first Cell | GetValueShort(6) | | | | Broadcast Page | returns 0x0016 | | | | TLV: | (UDL of first Page | | | | | TLV) | | | | Send a SMS CB with | | | | | 2 Cell Broadcast | | | | | Page TLV with two | | | | | different user | | | | | data lengths: 0x18 | | | | | and 0x23 (with | | | | | PCNTR = 0, no | | | | | RC/CC/DS) | | | +----+--------------------+--------------------+------------------+ | 27 | Send envelope | GetValueByte() | | | | SMS-CB Formatted. | returns 0x00 (TS | | | | | 23.041 first byte) | | | | FindTLV() with | | | | | TAG_D | | | | | EVICE_IDENTITIES. | | | | | GetSh | | | | | ortMessageLength() | | | | | and then | | | | | getValueByte() | | | | | with offset 0 | | | +----+--------------------+--------------------+------------------+ | | UNFORMATTED SMS PP | | | | | ENV Triggering | | | +----+--------------------+--------------------+------------------+ | 28 | Test with | Returns 0x003D | | | | UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | and TP-OA length | | | | | of 2, and user | | | | | data length of | | | | | 0x3D | | | +----+--------------------+--------------------+------------------+ | 29 | Test with TP-OA | Returns 0x003D | | | | length of 12, and | | | | | user data length | | | | | of 0x3D | | | +----+--------------------+--------------------+------------------+ | 30 | Test with | Returns 0x0000 | | | | UserDataLength = | with no exception | | | | 0x00 | | | +----+--------------------+--------------------+------------------+ | 31 | Test with | Returns 0x007F | | | | UserDataLength = | | | | | 0x7F | | | +----+--------------------+--------------------+------------------+ | 32 | Test with | Returns 0x0080 | | | | UserDataLength = | | | | | 0x80 | | | +----+--------------------+--------------------+------------------+ | 33 | Test with | Returns 0x008C | | | | UserDataLength = | | | | | maximum length: | | | | | 0x8C for a single | | | | | SMS | | | +----+--------------------+--------------------+------------------+ | 34 | Verify it is the | Returns 0x0018 | | | | first TPDU TLV: | | | | | | | | | | Send a SMS PP with | | | | | 2 TPDU TLV with | | | | | two different user | | | | | data lengths: 0x18 | | | | | and 0x23 | | | +----+--------------------+--------------------+------------------+ | 35 | Send envelope | GetValueByte() | | | | SMS-PP | returns 0x00 | | | | Unformatted. | | | | | | (TS 23.040 [11] | | | | FindTLV() with | first byte) | | | | TAG_D | | | | | EVICE_IDENTITIES. | | | | | getSh | | | | | ortMessageLength() | | | | | and then | | | | | getValueByte() | | | | | with offset 0 | | | | | (first user data = | | | | | 0x55) | | | +----+--------------------+--------------------+------------------+ | | UNFORMATTED SMS PP | | | | | UPD Triggering | | | +----+--------------------+--------------------+------------------+ | 36 | Test with | Returns 0x003D | | | | UNFORMA | | | | | TTED_SMS_PP_UPD | | | | | and TP-OA length | | | | | of 2, and user | | | | | data length of | | | | | 0x3D | | | +----+--------------------+--------------------+------------------+ | 37 | Test with TP-OA | Returns 0x003D | | | | length of 12, and | | | | | user data length | | | | | of 0x3D | | | +----+--------------------+--------------------+------------------+ | 38 | Test with | Returns 0x0000 | | | | UserDataLength = | with no exception | | | | 0x00 | | | +----+--------------------+--------------------+------------------+ | 39 | Test with | Returns 0x007F | | | | UserDataLength = | | | | | 0x7F | | | +----+--------------------+--------------------+------------------+ | 40 | Test with | Returns 0x0080 | | | | UserDataLength = | | | | | 0x80 | | | +----+--------------------+--------------------+------------------+ | 41 | Verify it is the | Returns 0x0018 | | | | first TPDU TLV: | | | | | | | | | | Send a SMS PP with | | | | | 2 TPDU TLV with | | | | | two different user | | | | | data lengths: 0x18 | | | | | and 0x23 | | | +----+--------------------+--------------------+------------------+ | 42 | Test with | Returns 0x008C | | | | UserDataLength = | | | | | maximum length: | | | | | 0x8C for a single | | | | | SMS | | | +----+--------------------+--------------------+------------------+ | 43 | Send envelope | GetValueByte() | | | | SMS-PP Formatted. | returns 0x00 | | | | | (TS 23.040 [11] | | | | FindTLV() with | first byte) | | | | TAG_D | | | | | EVICE_IDENTITIES. | | | | | GetSh | | | | | ortMessageLength() | | | | | and then | | | | | getValueByte() | | | | | with offset 0 | | | +----+--------------------+--------------------+------------------+ | | UNFORMATTED SMS CB | | | | | Triggering | | | +----+--------------------+--------------------+------------------+ | 44 | Test with | Returns 0x0052 | | | | UN | | | | | FORMATTED_SMS_CB | | | +----+--------------------+--------------------+------------------+ | 45 | Verify it is the | Returns 0x0052 | | | | first Cell | | | | | Broadcast Page | | | | | TLV: | | | | | | | | | | Send a SMS CB with | | | | | 2 Cell Broadcast | | | | | Page TLV with two | | | | | different user | | | | | data lengths: 0x58 | | | | | and 0x23 | | | +----+--------------------+--------------------+------------------+ | 46 | Send envelope | GetValueByte() | | | | SMS-CB Formatted. | returns 0x00 (TS | | | | | 23.041 first byte) | | | | FindTLV() with | | | | | TAG_D | | | | | EVICE_IDENTITIES. | | | | | GetSh | | | | | ortMessageLength() | | | | | and then | | | | | getValueByte() | | | | | with offset 0 | | | +----+--------------------+--------------------+------------------+ | | Unrecognized | | | | | Envelope | | | | | Triggering | | | +----+--------------------+--------------------+------------------+ | 47 | Send an | T | | | | Unrecognized | oolkitException.UN | | | | Envelope with | AVAILABLE_ELEMENT | | | | neither TPDU TLV | | | | | nor Cell Broadcast | | | | | Page TLV, then | | | | | call the method. | | | +----+--------------------+--------------------+------------------+
#### 5.2.2.4 Method getShortMessageOffset
Test Area Reference: Api_2_Ueh_Gsmo
##### 5.2.2.4.1 Conformance requirement {#conformance-requirement-3 .H6}
The method with following header shall be compliant to its definition in the
API.
public short getShortMessageOffset()
throws uicc.toolkit.ToolkitException
##### 5.2.2.4.1.1 Normal execution {#normal-execution-3 .H6}
\- CRRN1: The method shall return the offset of the Short Message first byte
contained in the User Data part of the SMS TPDU TLV contained in the
USATEnvelopeHandler.
\- CRRN2: The offset is from the first SMS TPDU TLV.
\- CRRN3: The method can be used if the event is EVENT_FORMATTED_SMS_PP_ENV or
EVENT_UNFORMATTED_SMS_PP_ENV.
\- CRRN4: The method can be used if the event is EVENT_FORMATTED_SMS_PP_UPD or
EVENT_UNFORMATTED_SMS_PP_UPD.
\- CRRN5: The method can be used if the event is EVENT_FORMATTED_SMS_CB or
EVENT_UNFORMATTED_SMS_CB.
\- CRRN6: If the method is successful and if the event is
EVENT_FORMATTED_SMS_PP_ENV or EVENT_UNFORMATTED_SMS_PP_ENV, the selected TLV
should be the SMS TPDU TLV.
\- CRRN7: If the method is successful and if the event is
EVENT_FORMATTED_SMS_PP_UPD or EVENT_UNFORMATTED_SMS_PP_UPD, the selected TLV
should be the SMS TPDU TLV.
\- CRRN8: If the method is successful and if the event is
EVENT_FORMATTED_SMS_CB or EVENT_UNFORMATTED_SMS_CB, the selected TLV should be
the Cell Broadcast Page TLV.
\- CRRN9: The method returns the offset of the first byte after the UDH, if
any.
##### 5.2.2.4.1.2 Parameter errors {#parameter-errors-3 .H6}
No requirements.
##### 5.2.2.4.1.3 Context errors {#context-errors-3 .H6}
\- CRRC1: The method shall throw ToolkitException.UNAVAILABLE_ELEMENT in case
of unavailable SMS TPDU TLV or Cell Broadcast Page Comprehension TLV element.
\- CRRC2: The method shall throw ToolkitException.UNAVAILABLE_ELEMENT in case
of wrong data format.
##### 5.2.2.4.2 Test area files {#test-area-files-4 .H6}
Specific triggering:
\- FORMATTED SMS CB.
\- UNFORMATTED SMS CB.
\- FORMATTED SMS PP UPD.
\- UNFORMATTED SMS PP UPD.
\- FORMATED SMS PP ENV.
\- UNFORMATED SMS PP ENV.
\- UNRECOGNIZED_ENVELOPE.
\- For Formatted triggering if CC/RC/DS is used, the security parameters are
the one defined in section "5.3.8 Framework Security Management".
Test Source: Test_Api_2_Ueh_Gsmo.java
Test Applet: Api_2_Ueh_Gsmo_1.java
Cap File: Api_2_Ueh_Gsmo.cap
##### 5.2.2.4.3 Test coverage {#test-coverage-4 .H6}
* * *
CRR number Test case number N1 1 to 30 N2 4, 11, 21, 26 N3 1 to 7 and 19 to 23
N4 8 to 14 and 24 to 28 N5 15 to 18, 29, 30 N6 6, 22 N7 13, 27 N8 18, 30 N9 1
to 18, 23, 28 C1 31 C2 Not applicable
* * *
##### 5.2.2.4.4 Test procedure {#test-procedure-4 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | | **FORMATTED SMS PP | | | | | ENV triggering** | | | +----+--------------------+--------------------+------------------+ | 1 | Test with TP-OA | Returns 0x11 | | | | length of 2 and | | | | | RC/CC/DS length is | | | | | 0 | | | +----+--------------------+--------------------+------------------+ | 2 | Test with TP-OA | Returns 0x16 | | | | length of 12 and | | | | | RC/CC/DS length is | | | | | 0 | | | +----+--------------------+--------------------+------------------+ | 3 | Test with RC/CC/DS | Returns 0x11 | | | | length of 8 and | | | | | TP-OA length is 2 | | | +----+--------------------+--------------------+------------------+ | 4 | Send a SMS PP with | Returns 0x14 ( the | | | | 2 TPDU TLV and | first offset ) | | | | inside two | | | | | different secured | | | | | data offsets | | | +----+--------------------+--------------------+------------------+ | 5 | Same test as 1 but | Returns 0x11 | | | | without any | | | | | secured data | | | +----+--------------------+--------------------+------------------+ | 6 | Test with | Returns 0x40 | | | | FORMATTED_SMS_PP | | | | | ENV | | | | | | | | | | Verify after call | | | | | of the method the | | | | | current TLV is the | | | | | TPDU TLV: | | | | | | | | | | findTLV device | | | | | identities, | | | | | ge | | | | | tSecuredDataOffset | | | | | and then | | | | | getValueByte to | | | | | verify that the | | | | | current TLV is the | | | | | TPDU TLV | | | +----+--------------------+--------------------+------------------+ | 7 | Same test as 1, | Returns 0x15 | | | | but with a | | | | | concatenated SMS | | | | | (2 Short Messages | | | | | and maximum | | | | | Secured Data | | | | | Length = 0x00FA) | | | +----+--------------------+--------------------+------------------+ | | **FORMATTED SMS PP | | | | | UPD triggering** | | | +----+--------------------+--------------------+------------------+ | 8 | Same test as 1 but | Returns 0x11 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 9 | Same test as 2 but | Returns 0x16 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 10 | Same test as 3 but | Returns 0x11 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 11 | Same test as 4 but | Returns0x14 ( the | | | | with | first offset ) | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 12 | Same test as 5 but | Returns 0x11 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 13 | Test with | Returns 0x40 | | | | FORMATTED_SMS_PP | | | | | UPD | | | | | | | | | | Verify after call | | | | | of the method the | | | | | current TLV is the | | | | | TPDU TLV: | | | | | | | | | | findTLV device | | | | | identities, | | | | | ge | | | | | tSecuredDataOffset | | | | | and then | | | | | getValueByte to | | | | | verify that the | | | | | current TLV is the | | | | | TPDU TLV | | | +----+--------------------+--------------------+------------------+ | 14 | Same test as 10, | Returns 0x21 | | | | but with a | | | | | concatenated SMS | | | | | (2 Short Messages | | | | | and maximum | | | | | Secured Data | | | | | Length = 0x00FA) | | | +----+--------------------+--------------------+------------------+ | | **FORMATTED SMS CB | | | | | triggering** | | | +----+--------------------+--------------------+------------------+ | 15 | Same test as 1 but | Returns 0x06 | | | | with | | | | | FORMATTED_SMS_CB | | | +----+--------------------+--------------------+------------------+ | 16 | Same test as 3 but | Returns 0x06 | | | | with | | | | | FORMATTED_SMS_CB | | | +----+--------------------+--------------------+------------------+ | 17 | Same test as 5 but | Returns 0x06 | | | | with | | | | | FORMATTED_SMS_CB | | | +----+--------------------+--------------------+------------------+ | 18 | Test with | Returns 0x00 | | | | FORMATTED_SMS_CB | | | | | | | | | | Verify after call | | | | | of the method the | | | | | current TLV is the | | | | | Cell Broadcast | | | | | Page TLV: | | | | | | | | | | FindTLV() device | | | | | identities, | | | | | getS | | | | | ecuredDataOffset() | | | | | and then | | | | | getValueByte() to | | | | | verify that the | | | | | current TLV is the | | | | | Cell Broadcast | | | | | Page TLV | | | +----+--------------------+--------------------+------------------+ | | **UNFORMATTED SMS | | | | | PP ENV | | | | | triggering** | | | +----+--------------------+--------------------+------------------+ | 19 | Test with TP-OA | Returns 0x0E | | | | length of 2 | | | +----+--------------------+--------------------+------------------+ | 20 | Test with TP-OA | Returns 0x13 | | | | length of 12 | | | +----+--------------------+--------------------+------------------+ | 21 | Send a SMS PP with | Returns 0x11 (the | | | | 2 TPDU TLV and | first offset) | | | | inside two | | | | | different UDL | | | | | offsets | | | +----+--------------------+--------------------+------------------+ | 22 | Test with | Returns 00 | | | | UN | | | | | FORMATTED_SMS_PP | | | | | ENV | | | | | | | | | | Verify after call | | | | | of the method the | | | | | current TLV is the | | | | | TPDU TLV: | | | | | | | | | | findTLV device | | | | | identities, | | | | | get | | | | | ShortMessageOffset | | | | | and then | | | | | getValueByte to | | | | | verify that the | | | | | current TLV is the | | | | | TPDU TLV | | | +----+--------------------+--------------------+------------------+ | 23 | Same test as 19, | Returns 0x0E or | | | | but with a | 0x0F (depending of | | | | concatenated SMS | UDHI | | | | (2 Short Messages | implementation) | | | | and maximum User | | | | | Data Length = | | | | | 0x0102) | | | +----+--------------------+--------------------+------------------+ | | **UNFORMATTED SMS | | | | | PP UPD | | | | | triggering** | | | +----+--------------------+--------------------+------------------+ | 24 | Same test as 19 | Returns 0x0E | | | | but with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 25 | Same test as 20 | Returns 0x13 | | | | but with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 26 | Same test as 21 | Returns 0x11 ( the | | | | but with | first offset ) | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 27 | Test with | Returns 0x11 | | | | F | | | | | ORMATTED_SMS_UPD | | | | | | | | | | Verify after call | | | | | of the method the | | | | | current TLV is the | | | | | TPDU TLV: | | | | | | | | | | findTLV device | | | | | identities, | | | | | get | | | | | ShortMessageOffset | | | | | and then | | | | | getValueByte to | | | | | verify that the | | | | | current TLV is the | | | | | TPDU TLV | | | +----+--------------------+--------------------+------------------+ | 28 | Same test as 25, | Returns 0x0E or | | | | but with a | 0x0F (depending of | | | | concatenated SMS | UDHI | | | | (2 Short Messages | implementation) | | | | and maximum | | | | | Secured Data | | | | | Length = 0x00FA) | | | +----+--------------------+--------------------+------------------+ | | UNFORMATTED SMS CB | | | | | Triggering | | | +----+--------------------+--------------------+------------------+ | 29 | Test with | Returns 0x06 | | | | UN | | | | | FORMATTED_SMS_CB | | | +----+--------------------+--------------------+------------------+ | 30 | Send envelope | GetValueByte() | | | | SMS-CB | returns 0x00 (TS | | | | Unformatted. | 23.041 first byte) | | | | | | | | | FindTLV() with | | | | | TAG_D | | | | | EVICE_IDENTITIES. | | | | | getSh | | | | | ortMessageOffset() | | | | | and then | | | | | getValueByte() | | | | | with offset 0 | | | +----+--------------------+--------------------+------------------+ | | Unrecognized | | | | | Envelope | | | | | Triggering | | | +----+--------------------+--------------------+------------------+ | 31 | Send an | T | | | | Unrecognized | oolkitException.UN | | | | Envelope with | AVAILABLE_ELEMENT | | | | neither TPDU TLV | | | | | nor Cell Broadcast | | | | | Page TLV, then | | | | | call the method. | | | +----+--------------------+--------------------+------------------+
#### 5.2.2.5 Method getTPUDLOffset
Test Area Reference: Api_2_Ueh_Gtpo
##### 5.2.2.5.1 Conformance requirement {#conformance-requirement-4 .H6}
The method with following header shall be compliant to its definition in the
API.
public short getTPUDLOffset()
throws uicc.toolkit.ToolkitException
##### 5.2.2.5.1.1 Normal execution {#normal-execution-4 .H6}
\- CRRN1: The method shall return the TPUDL offset in a SMS TPDU TLV.
\- CRRN2: The offset is from the first SMS TPDU TLV.
\- CRRN3: The method can be used if the event is EVENT_FORMATTED_SMS_PP_ENV.
\- CRRN4: The method can be used if the event is EVENT_FORMATTED_SMS_PP_UPD.
\- CRRN5: The method can be used if the event is EVENT_UNFORMATTED_SMS_PP_ENV.
\- CRRN6: The method can be used if the event is EVENT_UNFORMATTED_SMS_PP_UPD.
\- CRRN7: If the method is successful, the selected TLV should be the SMS TPDU
TLV.
##### 5.2.2.5.1.2 Parameter errors {#parameter-errors-4 .H6}
No requirements.
##### 5.2.2.5.1.3 Context errors {#context-errors-4 .H6}
\- CRRC1: The method shall throw ToolkitException.UNAVAILABLE_ELEMENT in case
of unavailable SMS TPDU TLV element.
\- CRRC2: The method shall throw ToolkitException.UNAVAILABLE_ELEMENT if the
TPUDL field does not exist.
##### 5.2.2.5.2 Test area files {#test-area-files-5 .H6}
Specific triggering:
\- FORMATTED SMS PP UPD.
\- UNFORMATTED SMS PP UPD.
\- UNFORMATTED SMS PP ENV.
\- FORMATTED SMS PP ENV.
\- UNFORMATTED SMS CB.
Test Source Test_Api_2_Ueh_Gtpo.java
Test Applet: Api_2_Ueh_Gtpo_1.java
Cap File: Api_2_Ueh_Gtpo.cap
##### 5.2.2.5.3 Test coverage {#test-coverage-5 .H6}
* * *
CRR number Test case number N1 1 to 21. N2 4, 10, 15, 20. N3 1, 2, 3, 4, 5, 6
N4 7, 8, 9, 10, 11 N5 12, 13, 14, 15, 16 N6 17, 18, 19, 20, 21 N7 6 C1 22 C2
Not testable
* * *
##### 5.2.2.5.4 Test procedure {#test-procedure-5 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | | **FORMATTED SMS PP | | | | | ENV triggering** | | | +----+--------------------+--------------------+------------------+ | 1 | Test with TP-OA | Returns 0x0D | | | | length of 2 | | | +----+--------------------+--------------------+------------------+ | 2 | Test with TP-OA | Returns 0x0F | | | | length of 6 | | | +----+--------------------+--------------------+------------------+ | 3 | Test with TP-OA | Returns 0x12 | | | | length of 12 | | | +----+--------------------+--------------------+------------------+ | 4 | Send a SMS PP with | Returns 0x10 (the | | | | 2 TPDU TLV and | first offset) | | | | inside two | | | | | different UDL | | | | | offsets | | | +----+--------------------+--------------------+------------------+ | 5 | Same test as 1, | Returns 0x0D | | | | but with a | | | | | concatenated SMS | | | | | (2 Short Messages | | | | | and maximum | | | | | Secured Data | | | | | Length = 0x00FA) | | | +----+--------------------+--------------------+------------------+ | 6 | Verify after call | Returns 0x40 | | | | of the method the | | | | | current TLV is the | | | | | TPDU TLV: | | | | | | | | | | findTLV device | | | | | identities, | | | | | getTPUDLOffset and | | | | | then getValueByte | | | | | to verify that the | | | | | current TLV is the | | | | | TPDU TLV | | | +----+--------------------+--------------------+------------------+ | | **FORMATTED SMS PP | | | | | UPD triggering** | | | +----+--------------------+--------------------+------------------+ | 7 | Same test as 1 but | Returns 0x0D | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 8 | Same test as 2 but | Returns 0x0F | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 9 | Same test as 3 but | Returns 0x12 | | | | with | | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 10 | Same test as 4 but | Returns 0x10 (the | | | | with | first offset) | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 11 | Same test as 7, | Returns 0x0D | | | | but with a | | | | | concatenated SMS | | | | | (2 Short Messages | | | | | and maximum | | | | | Secured Data | | | | | Length = 0x00FA) | | | +----+--------------------+--------------------+------------------+ | | **UNFORMATTED SMS | | | | | PP UPD | | | | | triggering** | | | +----+--------------------+--------------------+------------------+ | 12 | Same test as 1 but | Returns 0x0D | | | | with | | | | | UNFORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 13 | Same test as 2 but | Returns 0x0F | | | | with | | | | | UNFORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 14 | Same test as 3 but | Returns 0x12 | | | | with | | | | | UNFORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 15 | Same test as 4 but | Returns 0x12 (the | | | | with | first offset) | | | | UNFORMA | | | | | TTED_SMS_PP_UPD | | | +----+--------------------+--------------------+------------------+ | 16 | Same test as 12, | Returns 0x0D | | | | but with a | | | | | concatenated SMS | | | | | (2 Short Messages | | | | | and maximum User | | | | | Data Length = | | | | | 0x010C) | | | +----+--------------------+--------------------+------------------+ | | **UNFORMATTED SMS | | | | | PP ENV | | | | | triggering** | | | +----+--------------------+--------------------+------------------+ | 17 | Same test as 1 but | Returns 0x0D | | | | with | | | | | UNFORMA | | | | | TTED_SMS_PP_ENV | | | +----+--------------------+--------------------+------------------+ | 18 | Same test as 2 but | Returns 0x0F | | | | with | | | | | UNFORMA | | | | | TTED_SMS_PP_ENV | | | +----+--------------------+--------------------+------------------+ | 19 | Same test as 3 but | Returns 0x12 | | | | with | | | | | UNFORMA | | | | | TTED_SMS_PP_ENV | | | +----+--------------------+--------------------+------------------+ | 20 | Same test as 4 but | Returns 0x10 (the | | | | with | first offset) | | | | UNFORMA | | | | | TTED_SMS_PP_ENV | | | +----+--------------------+--------------------+------------------+ | 21 | Same test as 17, | Returns 0x0D | | | | but with a | | | | | concatenated SMS | | | | | (2 Short Messages | | | | | and maximum User | | | | | Data Length = | | | | | 0x010C) | | | +----+--------------------+--------------------+------------------+ | | **UNFORMATTED SMS | | | | | CB triggering** | | | +----+--------------------+--------------------+------------------+ | 22 | Send an envelope | T | | | | Unformatted SMS | oolkitException.UN | | | | CB, getTPUDLOffset | AVAILABLE_ELEMENT | | +----+--------------------+--------------------+------------------+
#### 5.2.2.6 Method getUserDataLength
Test Area Reference: Api_2_Ueh_Gudl
##### 5.2.2.6.1 Conformance requirement {#conformance-requirement-5 .H6}
The method with following header shall be compliant to its definition in the
API.
public short getUserDataLength()
throws uicc.toolkit.ToolkitException
##### 5.2.2.6.1.1 Normal execution {#normal-execution-5 .H6}
\- CRRN1: The method shall return the length of the User Data contained in the
SMS TPDU TLV element.
\- CRRN2: The length is from the first SMS TPDU TLV element.
\- CRRN3: If the SMS TPDU TLV element is available, it becomes the selected
TLV
\- CRRN4: The method can be used if the event is EVENT_FORMATTED_SMS_PP_ENV.
\- CRRN5: The method can be used if the event is EVENT_FORMATTED_SMS_PP_UPD.
\- CRRN6: The method can be used if the event is EVENT_UNFORMATED_SMS_PP_ENV.
\- CRRN7: The method can be used if the event is EVENT_UNFORMATTED_SMS_PP_UDP.
##### 5.2.2.6.1.2 Context errors {#context-errors-5 .H6}
\- CRRC1: The method shall throw UNAVAILABLE_ELEMENT in case of unavailable
TPDU TLV element.
\- CRRC2: The method shall throw UNAVAILABLE_ELEMENT in case of wrong data
format.
##### 5.2.2.6.2 Test area files {#test-area-files-6 .H6}
Specific triggering:
\- FORMATTED SMS PP UPD.
\- UNFORMATTED SMS PP UPD.
\- FORMATED SMS PP ENV.
\- UNFORMATED SMS PP ENV.
\- For Formatted triggering if CC/RC/DS is used, the security parameters are
the one defined in section \"5.3.8 Framework Security Management\".
Test Source: Test_Api_2_Ueh_Gudl.java
Test Applet: Api_2_Ueh_Gudl_1.java
Cap File: Api_2_Ueh_Gudl.cap
##### 5.2.2.6.3 Test coverage {#test-coverage-6 .H6}
+------------+--------------------------+ | CRR number | Test case number | +------------+--------------------------+ | N1 | All test cases excepted: | | | | | | 53 | +------------+--------------------------+ | N2 | 11, 26, 37, 45 | +------------+--------------------------+ | N3 | 12, 27, 38, 46 | +------------+--------------------------+ | N4 | 1 to 15 | +------------+--------------------------+ | N5 | 16 to 30 | +------------+--------------------------+ | N6 | 31 to 38 | +------------+--------------------------+ | N7 | 39 to 46 | +------------+--------------------------+ | C1 | 47 | +------------+--------------------------+ | C2 | Not applicable | +------------+--------------------------+
##### 5.2.2.6.4 Test procedure {#test-procedure-6 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | | FORMATTED SMS PP | | | | | ENV Triggering | | | +----+--------------------+--------------------+------------------+ | 1 | Test with | Returns 0x003D | | | | FORMA | | | | | TTED_SMS_PP_ENV | | | | | and TP-OA length | | | | | of 2 and user data | | | | | length of 0x3D | | | +----+--------------------+--------------------+------------------+ | 2 | Test with TP-OA | Returns 0x003D | | | | length of 12 and | | | | | user data length | | | | | of 0x3D | | | +----+--------------------+--------------------+------------------+ | 3 | Test with RC/CC/DS | Returns 0x0023 | | | | length of 0 and | | | | | secured data | | | | | length of 0x10 | | | +----+--------------------+--------------------+------------------+ | 4 | Test with RC/CC/DS | Returns 0x002B | | | | length of 8 and | | | | | secured data | | | | | length of 0x10 | | | +----+--------------------+--------------------+------------------+ | 5 | Test with PCNTR = | Returns 0x0023 | | | | 0, no RC/CC/DS and | | | | | data length of | | | | | 0x10 | | | +----+--------------------+--------------------+------------------+ | 6 | Test with PCNTR = | Returns 0x001D | | | | 7, no RC/CC/DS and | | | | | data length of | | | | | 0x03 (ciphering | | | | | shall be used) | | | +----+--------------------+--------------------+------------------+ | 7 | Test with | Returns 0x0013 | | | | SecuredDataLength | | | | | = 00 and no | | | | | RC/CC/DS | | | +----+--------------------+--------------------+------------------+ | 8 | Test with | Returns 0x007F | | | | UserDataLength = | | | | | 0x7F | | | +----+--------------------+--------------------+------------------+ | 9 | Test with | Returns 0x0080 | | | | UserDataLength = | | | | | 0x80 | | | +----+--------------------+--------------------+------------------+ | 10 | Test with | Returns 0x008C | | | | UserDataLength = | | | | | maximum length | | | | | (0x8C) for a | | | | | single SMS | | | +----+--------------------+--------------------+------------------+ | 11 | Verify it is the | Returns 0x0018 | | | | first TPDU TLV: | | | | | | | | | | Send a SMS PP with | | | | | 2 TPDU TLV with | | | | | two different user | | | | | data lengths: 0x18 | | | | | and 0x23 | | | +----+--------------------+--------------------+------------------+ | 12 | Send envelope | GetValueByte() | | | | SMS-PP Formatted. | returns | | | | | 0x4 | | | | FindTLV() with | 0(TS 23.040 [11] | | | | TAG_D | first byte) | | | | EVICE_IDENTITIES. | | | | | G | | | | | etUserDataLength() | | | | | and then | | | | | getValueByte() | | | | | with offset 0 | | | +----+--------------------+--------------------+------------------+ | 13 | Test with | Returns 0x00FF | | | | UserDataLength = | | | | | 0xFF with 2 | | | | | concatenated SMS | | | +----+--------------------+--------------------+------------------+ | 14 | Test with | Returns 0x0100 | | | | UserDataLength = | | | | | 0x100 with 2 | | | | | concatenated SMS | | | +----+--------------------+--------------------+------------------+ | 15 | Test with | Returns 0x010D | | | | UserDataLength = | | | | | maximum length | | | | | (0x010D) with 2 | | | | | concatenated SMS | | | +----+--------------------+--------------------+------------------+ | | FORMATTED SMS PP | | | | | UPD Triggering | | | +----+--------------------+--------------------+------------------+ | 16 | Test with | Returns 0x003D | | | | FORMA | | | | | TTED_SMS_PP_UPD | | | | | and TP-OA length | | | | | of 2 and user data | | | | | length of 0x3D | | | +----+--------------------+--------------------+------------------+ | 17 | Test with TP-OA | Returns 0x003D | | | | length of 12 and | | | | | user data length | | | | | of 0x3D | | | +----+--------------------+--------------------+------------------+ | 18 | Test with RC/CC/DS | Returns 0x0023 | | | | length of 0 and | | | | | secured data | | | | | length of 0x10 | | | +----+--------------------+--------------------+------------------+ | 19 | Test with RC/CC/DS | Returns 0x002B | | | | length of 8 and | | | | | secured data | | | | | length of 0x10 | | | +----+--------------------+--------------------+------------------+ | 20 | Test with PCNTR = | Returns 0x0023 | | | | 0, no RC/CC/DS and | | | | | data length of | | | | | 0x10 | | | +----+--------------------+--------------------+------------------+ | 21 | Test with PCNTR = | Returns 0x001D | | | | 7, no RC/CC/DS and | | | | | data length of | | | | | 0x03 (ciphering | | | | | shall be used) | | | +----+--------------------+--------------------+------------------+ | 22 | Test with | Returns 0x0013 | | | | SecuredDataLength | | | | | = 00 and no | | | | | RC/CC/DS | | | +----+--------------------+--------------------+------------------+ | 23 | Test with | Returns 0x007F | | | | UserDataLength = | | | | | 0x7F | | | +----+--------------------+--------------------+------------------+ | 24 | Test with | Returns 0x0080 | | | | UserDataLength = | | | | | 0x80 | | | +----+--------------------+--------------------+------------------+ | 25 | Test with | Returns 0x008C | | | | UserDataLength = | | | | | maximum | | | | | length(0x8C) for a | | | | | single SMS | | | +----+--------------------+--------------------+------------------+ | 26 | Verify it is the | Returns 0x0018 | | | | first TPDU TLV: | | | | | | | | | | Send a SMS PP with | | | | | 2 TPDU TLV with | | | | | two different user | | | | | data lengths: 0x18 | | | | | and 0x23 | | | +----+--------------------+--------------------+------------------+ | 27 | Send envelope | GetValueByte() | | | | SMS-PP Formatted. | returns | | | | | 0x4 | | | | FindTLV() with | 0(TS 23.040 [11] | | | | TAG_D | first byte) | | | | EVICE_IDENTITIES. | | | | | G | | | | | etUserDataLength() | | | | | and then | | | | | getValueByte() | | | | | with offset 0 | | | +----+--------------------+--------------------+------------------+ | 28 | Test with | Returns 0x00FF | | | | UserDataLength = | | | | | 0xFF with 2 | | | | | concatenated SMS | | | +----+--------------------+--------------------+------------------+ | 29 | Test with | Returns 0x0100 | | | | UserDataLength = | | | | | 0x100 with 2 | | | | | concatenated SMS | | | +----+--------------------+--------------------+------------------+ | 30 | Test with | Returns 0x010D | | | | UserDataLength = | | | | | maximum length | | | | | (0x010D) with 2 | | | | | concatenated SMS | | | +----+--------------------+--------------------+------------------+ | | UNFORMATTED SMS PP | | | | | ENV Triggering | | | +----+--------------------+--------------------+------------------+ | 31 | Test with | Returns 0x003D | | | | UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | and TP-OA length | | | | | of 2, and user | | | | | data length of | | | | | 0x3D | | | +----+--------------------+--------------------+------------------+ | 32 | Test with TP-OA | Returns 0x003D | | | | length of 12, and | | | | | user data length | | | | | of 0x3D | | | +----+--------------------+--------------------+------------------+ | 33 | Test with | Returns 0x0000 | | | | UserDataLength = | | | | | 0x00 | | | +----+--------------------+--------------------+------------------+ | 34 | Test with | Returns 0x007F | | | | UserDataLength = | | | | | 0x7F | | | +----+--------------------+--------------------+------------------+ | 35 | Test with | Returns 0x0080 | | | | UserDataLength = | | | | | 0x80 | | | +----+--------------------+--------------------+------------------+ | 36 | Test with | Returns 0x008C | | | | UserDataLength = | | | | | maximum length: | | | | | 0x8C for a single | | | | | SMS | | | +----+--------------------+--------------------+------------------+ | 37 | Verify it is the | Returns 0x0018 | | | | first TPDU TLV: | | | | | | | | | | Send a SMS PP with | | | | | 2 TPDU TLV with | | | | | two different user | | | | | data lengths: 0x18 | | | | | and 0x23 | | | +----+--------------------+--------------------+------------------+ | 38 | Send envelope | GetValueByte() | | | | SMS-PP | returns 0x00 | | | | Unformatted. | | | | | | (TS 23.040 [11] | | | | FindTLV() with | first byte) | | | | TAG_D | | | | | EVICE_IDENTITIES. | | | | | G | | | | | etUserDataLength() | | | | | and then | | | | | getValueByte() | | | | | with offset 0 | | | | | (first user data = | | | | | 0x55) | | | +----+--------------------+--------------------+------------------+ | | UNFORMATTED SMS PP | | | | | UPD Triggering | | | +----+--------------------+--------------------+------------------+ | 39 | Test with | Returns 0x003D | | | | UNFORMA | | | | | TTED_SMS_PP_UPD | | | | | and TP-OA length | | | | | of 2, and user | | | | | data length of | | | | | 0x3D | | | +----+--------------------+--------------------+------------------+ | 40 | Test with TP-OA | Returns 0x003D | | | | length of 12, and | | | | | user data length | | | | | of 0x3D | | | +----+--------------------+--------------------+------------------+ | 41 | Test with | Returns 0x0000 | | | | UserDataLength = | | | | | 0x00 | | | +----+--------------------+--------------------+------------------+ | 42 | Test with | Returns 0x007F | | | | UserDataLength = | | | | | 0x7F | | | +----+--------------------+--------------------+------------------+ | 43 | Test with | Returns 0x0080 | | | | UserDataLength = | | | | | 0x80 | | | +----+--------------------+--------------------+------------------+ | 44 | Test with | Returns 0x008C | | | | UserDataLength = | | | | | maximum length: | | | | | 0x8C for a single | | | | | SMS | | | +----+--------------------+--------------------+------------------+ | 45 | Verify it is the | Returns 0x0018 | | | | first TPDU TLV: | | | | | | | | | | Send a SMS PP with | | | | | 2 TPDU TLV with | | | | | two different user | | | | | data lengths: 0x18 | | | | | and 0x23 | | | +----+--------------------+--------------------+------------------+ | 46 | Send envelope | GetValueByte() | | | | SMS-PP | returns 0x00 | | | | Unformatted. | | | | | | (TS 23.040 [11] | | | | FindTLV() with | first byte) | | | | TAG_D | | | | | EVICE_IDENTITIES. | | | | | G | | | | | etUserDataLength() | | | | | and then | | | | | getValueByte() | | | | | with offset 0 | | | +----+--------------------+--------------------+------------------+ | | **UNRE | | | | | COGNIZED_ENVELOPE | | | | | Triggering** | | | +----+--------------------+--------------------+------------------+ | 47 | Test with an | T | | | | UNRE | oolkitException.UN | | | | COGNIZED_ENVELOPE | AVAILABLE_ELEMENT | | +----+--------------------+--------------------+------------------+
#### 5.2.2.7 Method getItemIdentifier
Test Area Reference: Api_2_Ueh_Giid
##### 5.2.2.7.1 Conformance requirement {#conformance-requirement-6 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte getItemIdentifier()
throws ToolkitException
##### 5.2.2.7.1.1 Normal execution {#normal-execution-6 .H6}
\- CRRN1:The method shall return the item identifier byte value.
\- CRRN2:The item identifier byte value returned shall be from the first Item
Identifier TLV element.
\- CRRN3: If the element is available it becomes the TLV selected.
\- CRRN4: The item identifier is available for all triggered toolkit applets
from the invocation to the termination of their processToolkit method if the
USATEnvelopeHandler is available.
##### 5.2.2.7.1.2 Parameter Errors {#parameter-errors-5 .H6}
No requirements.
##### 5.2.2.7.1.3 Context errors {#context-errors-6 .H6}
\- CRRC1: The method shall throw ToolkitException.UNAVAILABLE_ELEMENT if the
item identifier TLV is not present.
\- CRRC2: The method shall throw ToolkitException.OUT_OF_TLV_BOUNDARIES if the
item identifier byte is missing in the Item Identifier Comprehension TLV.
##### 5.2.2.7.2 Test area files {#test-area-files-7 .H6}
Test Source: Test_Api_2_Ueh_Giid.java
Test Applet: Api_2_Ueh_Giid_1.java
Cap File: Api_2_Ueh_Giid.cap
##### 5.2.2.7.3 Test coverage {#test-coverage-7 .H6}
* * *
CRR number Test case number N1 1, 2, 3 N2 2, 3 N3 4 N4 6 C1 5 C2 7
* * *
##### 5.2.2.7.4 Test procedure {#test-procedure-7 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | 1 | Send envelope | Returns 03 | | | | formatted SMS with | | | | | an item identifier | | | | | TLV and identifier | | | | | value of 03 | | | +----+--------------------+--------------------+------------------+ | 2 | Send envelope | Returns FF | | | | formatted SMS with | | | | | two item | | | | | identifier TLV | | | | | with first value | | | | | FF and second 44 | | | +----+--------------------+--------------------+------------------+ | 3 | Send envelope | Returns 81 | | | | formatted SMS with | | | | | two item | Returns 81 | | | | identifier TLV | | | | | with first value | | | | | 81 and second 44, | | | | | call twice the | | | | | method | | | | | g | | | | | etItemIdentifier() | | | +----+--------------------+--------------------+------------------+ | 4 | Send envelope | getItemIdentifie | | | | formatted SMS with | r()=getValueByte() | | | | item identifier | | | | | TLV and value of | | | | | 66. FindTLV() with | | | | | TAG 02. | | | | | g | | | | | etItemIdentifier() | | | | | and then | | | | | getValueByte() | | | | | with offset 0 | | | +----+--------------------+--------------------+------------------+ | 5 | Send envelope | T | | | | formatted SMS | oolkitException.UN | | | | without item | AVAILABLE_ELEMENT | | | | identifier TLV and | | | | | g | | | | | etItemIdentifier() | | | +----+--------------------+--------------------+------------------+ | 6 | Send envelope | Returns 66 | | | | formatted SMS with | | | | | item identifier | | | | | TLV (66), send | | | | | proactive command. | | | | | Then | | | | | g | | | | | etItemIdentifier() | | | +----+--------------------+--------------------+------------------+ | 7 | Send envelope | Toolk | | | | formatted SMS with | itException.OUT_O | | | | item identifier | F_TLV_BOUNDARIES | | | | TLV but without | | | | | item number | | | +----+--------------------+--------------------+------------------+
#### 5.2.2.8 Method getChannelIdentifier
Test Area Reference: Api_2_Ueh_Gcid
##### 5.2.2.8.1 Conformance requirement {#conformance-requirement-7 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte getChannelIdentifier()
throws ToolkitException
##### 5.2.2.8.1.1 Normal execution {#normal-execution-7 .H6}
\- CRRN1: The method shall return the channel identifier byte value.
\- CRRN2: The channel identifier byte value returned shall be from the first
Channel status TLV element.
\- CRRN3: If the element is available it becomes the currently selected TLV.
\- CRRN4: The channel identifier is available for all triggered toolkit
applets from the invocation to the termination of their processToolkit method
if the USATEnvelopeHandler is available.
##### 5.2.2.8.1.2 Context errors {#context-errors-7 .H6}
\- CRRC1: The method shall throw ToolkitException.UNAVAILABLE_ELEMENT if the
Channel status TLV is not present.
\- CRRC2: The method shall throw ToolkitException.OUT_OF_TLV_BOUNDARIES if the
Comprehension TLV Channel Status length is equal to 0.
##### 5.2.2.8.2 Test area files {#test-area-files-8 .H6}
Test Source: Test_Api_2_Ueh_Gcid.java
Test Applet: Api_2_Ueh_Gcid_1.java
Cap File: Api_2_Ueh_Gcid.cap
##### 5.2.2.8.3 Test coverage {#test-coverage-8 .H6}
* * *
CRR number Test case number N1 1, 2 N2 3 N3 3 N4 5 C1 4 C2 6
* * *
##### 5.2.2.8.4 Test procedure {#test-procedure-8 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+--------------------+ | 0 | 1- Applet1 is | | 2- OPEN CHANNEL | | | installed with | | proactive command | | | maximum number of | | is fetched | | | channel = 07. | | | | | | | TERMINAL RESPONSE | | | 2- Applet1 builds | | is issued with | | | proactive commands | | Channel Id from 01 | | | OPEN CHANNEL with | | to 07 | | | init() method in | | | | | order to open all | | | | | channels. | | | | | | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called. | | | +----+--------------------+--------------------+--------------------+ | 1 | **Successful | 1- Applet1 is | | | | Call** | triggered | | | | | | | | | 1- Send envelope | 2- Returns 0x01 | | | | Event Download | | | | | Channel Status | | | | | with channel | | | | | status TLV: | | | | | | | | | | channel status | | | | | value = 0x8100. | | | | | | | | | | 2- Call | | | | | USATEn | | | | | velopeHandler.getC | | | | | hannelIdentifier() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 2 | **Two channel | 2- Returns twice | | | | status elements** | 0x04 | | | | | | | | | 1- Send envelope | | | | | Event Download | | | | | Channel Status | | | | | with two channel | | | | | status TLV: | | | | | | | | | | first value = | | | | | 0x8400 | | | | | | | | | | second value = | | | | | 0x8500. | | | | | | | | | | 2- Call twice the | | | | | USATEn | | | | | velopeHandler.getC | | | | | hannelIdentifier() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 3 | **Verify current | 2- Returns 0x06 | | | | TLV** | | | | | | 3- | | | | 1- Send envelope | GetC | | | | Event Download | hannelIdentifier() | | | | Channel Status | =getValueByte(0) | | | | with channel | | | | | status TLV: | | | | | | | | | | Channel Status | | | | | value = 0x0605 | | | | | | | | | | Vie | | | | | wHandler.FindTLV() | | | | | with Device | | | | | Identity Tag. | | | | | | | | | | 2- Call | | | | | USATEn | | | | | velopeHandler.getC | | | | | hannelIdentifier() | | | | | method. | | | | | | | | | | 3- Compare | | | | | USATEn | | | | | velopeHandler.getC | | | | | hannelIdentifier() | | | | | and then | | | | | ViewHandle | | | | | r.getValueByte(0). | | | +----+--------------------+--------------------+--------------------+ | 4 | **UN | 2- A Toolkit | | | | AVAILABLE_ELEMENT | exception | | | | exception** | UN | | | | | AVAILABLE_ELEMENT | | | | 1- Send envelope | is thrown. | | | | Menu Selection | | | | | without Channel | | | | | Status TLV. | | | | | | | | | | 2- Call | | | | | USATEn | | | | | velopeHandler.getC | | | | | hannelIdentifier() | | | | | method. | | | +----+--------------------+--------------------+--------------------+ | 5 | **Successful | 1- Returns 0x06 | | | | Call** | | | | | | | | | | 1- Send Envelope | | | | | Event Download | | | | | Channel Status | | | | | with Channel | | | | | Status TLV: | | | | | | | | | | Channel status | | | | | value = 0x0600 | | | | | | | | | | 2- Call | | | | | USATEn | | | | | velopeHandler.getC | | | | | hannelIdentifier() | | | | | method. | | | +----+--------------------+--------------------+--------------------+ | 6 | **OUT_O | 2- A Toolkit | | | | F_TLV_BOUNDARIES | exception | | | | exception** | OUT_O | | | | | F_TLV_BOUNDARIES | | | | 1- Send | is thrown. | | | | unrecognized | | | | | envelope with a | | | | | Channel Status TLV | | | | | having a length | | | | | equal to 0. | | | | | | | | | | 2- Call | | | | | USATEn | | | | | velopeHandler.getC | | | | | hannelIdentifier() | | | | | method. | | | +----+--------------------+--------------------+--------------------+
#### 5.2.2.9 Method getChannelStatus
Test Area Reference: Api_2_Ueh_Gcst
##### 5.2.2.9.1 Conformance requirement {#conformance-requirement-8 .H6}
The method with following header shall be compliant to its definition in the
API.
public short getChannelStatus(byte channelIdentifier)
throws ToolkitException
##### 5.2.2.9.1.1 Normal execution {#normal-execution-8 .H6}
\- CRRN1: The method shall return the value of the first Channel Status TLV
element whose channel identifier is equal to the channelIdentifier parameter.
\- CRRN2: The Channel Status value returned shall be from the element whose
channel identifier is equal to the ChannelIdentifier parameter.
\- CRRN3: If the element is available it becomes the currently selected TLV.
\- CRRN4: The channel status is available for all triggered toolkit applets
from the invocation to the termination of their processToolkit method if the
USATEnvelopeHandler is available.
##### 5.2.2.9.1.2 Context errors {#context-errors-8 .H6}
\- CRRC1: The method shall throw ToolkitException.UNAVAILABLE_ELEMENT if no
Channel Status TLV element with the right identifier could be found.
\- CRRC2: The method shall throw ToolkitException.OUT_OF_TLV_BOUNDARIES if a
Channel Status TLV element with the right identifier could be found but its
value is less than 2 bytes long.
##### 5.2.2.9.2 Test area files {#test-area-files-9 .H6}
Test Source: Test_Api_2_Ueh_Gcst.java
Test Applet: Api_2_Ueh_Gcst_1.java
Cap File: Api_2_Ueh_Gcst.cap
##### 5.2.2.9.3 Test coverage {#test-coverage-9 .H6}
* * *
CRR number Test case number N1 6 N2 5, 7 N3 8 N4 9 C1 1, 2 C2 3, 4
* * *
##### 5.2.2.9.4 Test procedure {#test-procedure-9 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+--------------------+ | 0 | 1- Applet1 is | | 2- OPEN CHANNEL | | | installed with | | proactive command | | | maximum number of | | is fetched | | | channel = 01. | | | | | | | TERMINAL RESPONSE | | | 2- Applet1 builds | | is issued with | | | proactive commands | | channel status | | | OPEN CHANNEL with | | value = 0x8100 | | | init() method in | | | | | order to open a | | | | | channel. | | | | | | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called. | | | +----+--------------------+--------------------+--------------------+ | 1 | Channel status TLV | 2- | | | | is not present | UN | | | | | AVAILABLE_ELEMENT | | | | 1- Send envelope | ToolkitException | | | | unrecognized | is thrown | | | | | | | | | 2- Call | | | | | USATEn | | | | | velopeHandler.getC | | | | | hannelStatus(0x01) | | | | | method. | | | +----+--------------------+--------------------+--------------------+ | 2 | Channel status TLV | 2- | | | | with the | UN | | | | identifier is not | AVAILABLE_ELEMENT | | | | present | ToolkitException | | | | | is thrown | | | | 1- Send envelope | | | | | Event Download | | | | | Channel Status | | | | | with Channel | | | | | status Value = | | | | | 0x8100 | | | | | | | | | | 2- Call | | | | | USATEn | | | | | velopeHandler.getC | | | | | hannelStatus(0x02) | | | | | method. | | | +----+--------------------+--------------------+--------------------+ | 3 | **Channel status | 2- | | | | TLV with a length | UN | | | | equal to 0** | AVAILABLE_ELEMENT | | | | | ToolkitException | | | | 1- Send envelope | is thrown | | | | unrecognized with | | | | | Channel status TLV | | | | | with a length | | | | | equal to 0. | | | | | | | | | | 2- Call | | | | | USATEn | | | | | velopeHandler.getC | | | | | hannelStatus(0x01) | | | | | method. | | | +----+--------------------+--------------------+--------------------+ | 4 | **Channel status | 2- | | | | TLV with a length | OUT_O | | | | equal to 1** | F_TLV_BOUNDARIES | | | | | ToolkitException | | | | 1- - Send envelope | is thrown | | | | unrecognized with | | | | | Channel status TLV | | | | | with a length | | | | | equal to 1. | | | | | | | | | | 2- Call | | | | | USATEn | | | | | velopeHandler.getC | | | | | hannelStatus(0x01) | | | | | method. | | | +----+--------------------+--------------------+--------------------+ | 5 | **Get channel | 2- Returns 0x8100 | | | | status value** | | | | | | | | | | 1- Send envelope | | | | | Event Download | | | | | Channel Status | | | | | with Channel | | | | | status | | | | | value=0x8100. | | | | | | | | | | 2- Call | | | | | USATEn | | | | | velopeHandler.getC | | | | | hannelStatus(0x01) | | | | | method. | | | +----+--------------------+--------------------+--------------------+ | 6 | Get channel status | 2- Returns 0x8100 | | | | value with 2 TLV | | | | | | | | | | 1- Send envelope | | | | | Event Download | | | | | Channel Status | | | | | with 2 channel | | | | | status value: | | | | | 0x8100 and 0x8101. | | | | | | | | | | 2- Call | | | | | USATEn | | | | | velopeHandler.getC | | | | | hannelStatus(0x01) | | | | | method. | | | +----+--------------------+--------------------+--------------------+ | 7 | Get channel status | 2- Returns 0x8201 | | | | value with 2 TLV | | | | | | | | | | 1- Send envelope | | | | | Event Download | | | | | Channel Status | | | | | with 2 channel | | | | | status value: | | | | | 0x8100 and 0x8201. | | | | | | | | | | 2- Call | | | | | USATEn | | | | | velopeHandler.getC | | | | | hannelStatus(0x02) | | | | | method. | | | +----+--------------------+--------------------+--------------------+ | 8 | Channel status TLV | 2- Returns 0x8100 | | | | is currently | | | | | selected TLV | 3- Check | | | | | getChannelStatus() | | | | 1- Send envelope | =getValueShort(0) | | | | Event Download | | | | | Channel Status | | | | | with channel | | | | | status value | | | | | 0x8100. | | | | | | | | | | Call | | | | | Vie | | | | | wHandler.FindTLV() | | | | | method with Device | | | | | Identity Tag. | | | | | | | | | | 2- Call | | | | | USATEn | | | | | velopeHandler.getC | | | | | hannelStatus(0x01) | | | | | method. | | | | | | | | | | 3- Compare | | | | | USATEn | | | | | velopeHandler.getC | | | | | hannelStatus(0x01) | | | | | and | | | | | ViewHandle | | | | | r.getValueShort(0) | | | | | method results. | | | +----+--------------------+--------------------+--------------------+ | 9 | **Get channel | 2- Returns 0x8100 | 3- DISPLAY TEXT | | | status value after | | proactive command | | | a proactive | 4- Returns 0x8100 | is fetched | | | command** | | | | | | | TERMINAL RESPONSE | | | 1- Send envelope | | is issued | | | Event Download | | | | | Channel Status | | | | | with Channel | | | | | status | | | | | value=0x8100. | | | | | | | | | | 2- Call | | | | | USATEn | | | | | velopeHandler.getC | | | | | hannelStatus(0x01) | | | | | method. | | | | | | | | | | 3- Send a | | | | | proactive command | | | | | display text | | | | | | | | | | 4- Call | | | | | USATEn | | | | | velopeHandler.getC | | | | | hannelStatus(0x01) | | | | | method. | | | +----+--------------------+--------------------+--------------------+
#### 5.2.2.10 Method getSize
Test Area Reference: Api_2_Ueh_Gtsz
##### 5.2.2.10.1 Conformance requirement {#conformance-requirement-9 .H6}
The method with following header shall be compliant to its definition in the
API.
public short getSize()
##### 5.2.2.10.1.1 Normal execution {#normal-execution-9 .H6}
\- CRRN1: Returns the BER TLV size, this includes the tag and the length.
##### 5.2.2.10.1.2 Parameter errors {#parameter-errors-6 .H6}
No requirements
##### 5.2.2.10.1.3 Context errors {#context-errors-9 .H6}
No requirements
##### 5.2.2.10.2 Test area files {#test-area-files-10 .H6}
Specific triggering: Unrecognized Envelope
Test Source: Test_Api_2_Ueh_Gtsz.java
Test Applet: Api_2_Ueh_Gtsz_1.java
Cap File: Api_2_Ueh_Gtsz.cap
##### 5.2.2.10.3 Test coverage {#test-coverage-10 .H6}
* * *
CRR number Test case number 1 1, 2
* * *
##### 5.2.2.10.4 Test procedure {#test-procedure-10 .H6}
* * *
Id Description API/(U)SAT Framework Expectation APDU Expectation 0 Send an
unrecognized envelope of length 0x33 (including tag and length)  
1 Call getSize() method just after triggering of the application. Returns 0x33  
2 Call getSize() method after a proactive command. Returns 0x33
* * *
#### 5.2.2.11 Method getTag
Test Area Reference: Api_2_Ueh_Gttg
##### 5.2.2.11.1 Conformance requirement {#conformance-requirement-10 .H6}
The method with following header shall be compliant to its definition in the
API.
public short getTag()
##### 5.2.2.11.1.1 Normal execution {#normal-execution-10 .H6}
\- CRRN1: Returns the BER Tag of the BER TLV list.
##### 5.2.2.11.1.2 Parameter errors {#parameter-errors-7 .H6}
No requirements.
##### 5.2.2.11.1.3 Context errors {#context-errors-10 .H6}
No requirements.
##### 5.2.2.11.2 Test area files {#test-area-files-11 .H6}
Specific triggering: Unrecognized Envelope
Test Source: Test_Api_2_Ueh_Gttg.java
Test Applet: Api_2_Ueh_Gttg_1.java
Cap File: Api_2_Ueh_Gttg.cap
##### 5.2.2.11.3 Test coverage {#test-coverage-11 .H6}
* * *
CRR number Test case number 1 1, 2
* * *
##### 5.2.2.11.4 Test procedure {#test-procedure-11 .H6}
* * *
Id Description API/(U)SAT Framework Expectation APDU Expectation 0 Send an
unrecognized envelope  
1 Call getTag() method just after triggering of the application. Returns 0x01  
2 Call getTag() method after a proactive command. Returns 0x01
* * *
#### 5.2.2.12 Method compareValue
Test Area Reference: Api_2_Ueh_Cprv
##### 5.2.2.12.1 Conformance requirement {#conformance-requirement-11 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte compareValue(short valueOffset,
byte[] compareBuffer,
short compareOffset,
short compareLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 5.2.2.12.1.1 Normal execution {#normal-execution-11 .H6}
Compares the last found TLV element with a buffer:
\- CRRN1: returns 0 if identical.
\- CRRN2: returns -1 if the first miscomparing byte in Comprehension TLV List
is less than that in compareBuffer.
\- CRRN3: returns 1 if the first miscomparing byte in Comprehension TLV List
is greater than that in compareBuffer.
##### 5.2.2.12.1.2 Parameter errors {#parameter-errors-8 .H6}
\- CRRP1: if compareBuffer is null NullPointerException shall be thrown.
\- CRRP2: if compareOffset or compareLength or both would cause access outside
array bounds, or if compareLength is negative ArrayIndexOutOfBoundsException
shall be thrown.
\- CRRP3: if valueOffset, dstLength or both are out of the current TLV an
instance of ToolkitException shall be thrown. The reason code shall be
ToolkitException.OUT_OF_TLV_BOUNDARIES.
##### 5.2.2.12.1.3 Context errors {#context-errors-11 .H6}
\- CRRC1: if the handler is busy an instance of ToolkitException shall be
thrown. The reason code shall be ToolkitException.HANDLER_NOT_AVAILABLE.
\- CRRC2: in case of unavailable TLV element an instance of ToolkitException
shall be thrown. The reason code shall be
ToolkitException.UNAVAILABLE_ELEMENT.
##### 5.2.2.12.2 Test area files {#test-area-files-12 .H6}
Specific triggering: Unrecognized Envelope
Test Source: Test_Api_2_Ueh_Cprv.java
Test Applet: Api_2_Ueh_Cprv_1.java
Cap File: Api_2_Ueh_Cprv.cap
##### 5.2.2.12.3 Test coverage {#test-coverage-12 .H6}
* * *
CRR number Test case number N1 12, 15 N2 13, 16, 18 N3 14, 17 P1 1 P2 2, 3, 4,
5, 6 P3 7, 8, 9, 10 C1 Does not apply for USATEnvelopeHandler C2 11
* * *
##### 5.2.2.12.4 Test procedure {#test-procedure-12 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | 1 | Search TLV 02h | | | +----+--------------------+--------------------+------------------+ | | compareValue() | Nu | | | | with a null | llPointerException | | | | compareBuffer | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | Search TLV 0Bh | | | +----+--------------------+--------------------+------------------+ | | compareOffset ≥ | ArrayIndexOu | | | | co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | compareValue() | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | compareOffset = 5 | | | | | | | | | | compareLength = 1 | | | +----+--------------------+--------------------+------------------+ | 3 | compareOffset \co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | compareValue() | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 6 | | | +----+--------------------+--------------------+------------------+ | 5 | compareOffset + | ArrayIndexOu | | | | compareLength | tOfBoundsException | | | | >co | is thrown | | | | mpareBuffer.length | | | | | | | | | | compareValue() | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | compareOffset = 3 | | | | | | | | | | compareLength = 3 | | | +----+--------------------+--------------------+------------------+ | 6 | compareLength \ | Toolk | | | | TLV length | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | compareValue() | is thrown | | | | | | | | | valueOffset = 0 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 7 | | | +----+--------------------+--------------------+------------------+ | 10 | valueOffset + | Toolk | | | | compareLength > | itException.OUT_O | | | | TLV length | F_TLV_BOUNDARIES | | | | | is thrown | | | | compareValue() | | | | | | | | | | valueOffset = 2 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 5 | | | +----+--------------------+--------------------+------------------+ | 11 | Search TLV 01h | Result is | | | | | TLV_NOT_FOUND | | +----+--------------------+--------------------+------------------+ | | compareValue() | T | | | | | oolkitException.UN | | | | | AVAILABLE_ELEMENT | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 12 | Search TLV 06h | | | +----+--------------------+--------------------+------------------+ | | Initialize | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 81 11 22 33 44 F5 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is 00h | | | | | | | | | compareValue() | | | | | | | | | | valueOffset = 0 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 6 | | | +----+--------------------+--------------------+------------------+ | 13 | Initialize | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 7F 11 22 33 44 F5 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is -1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 14 | Initialize | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 83 11 22 33 44 F5 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is -1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 15 | Initialize | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 81 11 22 | | | | | 33 44 F5 | | | | | | | | | | 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is 00h | | | | | | | | | compareValue() | | | | | | | | | | valueOffset = 1 | | | | | | | | | | compareOffset = 4 | | | | | | | | | | compareLength = 5 | | | +----+--------------------+--------------------+------------------+ | 16 | Initialize | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 81 10 22 | | | | | 33 44 F5 | | | | | | | | | | 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is +1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 17 | Initialize | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 81 12 22 | | | | | 33 44 F5 | | | | | | | | | | 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is -1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 18 | **Successful call, | Result of | | | | compareValue() | compareValue() is | | | | with length=0** | 0 | | | | | | | | | Co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | CompareOffset = 15 | | | | | | | | | | CompareLength = 0 | | | +----+--------------------+--------------------+------------------+
#### 5.2.2.13 Method copy
Test Area Reference: Api_2_Ueh_Copy
##### 5.2.2.13.1 Conformance requirement {#conformance-requirement-12 .H6}
The method with following header shall be compliant to its definition in the
API.
public short copy(byte[] dstBuffer,
short dstOffset,
short dstLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 5.2.2.13.1.1 Normal execution {#normal-execution-12 .H6}
\- CRRN1: copies the Comprehension TLV list contained in the handler to the
destination byte array.
\- CRRN2: returns dstOffset + dstLength.
##### 5.2.2.13.1.2 Parameter errors {#parameter-errors-9 .H6}
\- CRRP1: if dstBuffer is null a NullPointerException is thrown.
\- CRRP2: if dstOffset or dstLength or both would cause access outside array
bounds, or if dstLength is negative, an ArrayIndexOutOfBoundsException is
thrown.
\- CRRP3: if dstLength is greater than the length of the Comprehension TLV
List, an instance of ToolkitException shall be thrown. The reason code shall
be ToolkitException. OUT_OF_TLV_BOUNDARIES.
##### 5.2.2.13.1.3 Context errors {#context-errors-12 .H6}
\- CRRC1: if the handler is busy an instance of ToolkitException shall be
thrown. The reason code shall be ToolkitException.HANDLER_NOT_AVAILABLE.
##### 5.2.2.13.2 Test area files {#test-area-files-13 .H6}
Specific triggering: Unrecognized Envelope
Test Source: Test_Api_2_Ueh_Copy.java
Test Applet: Api_2_Ueh_Copy_1.java
Cap File: Api_2_Ueh_Copy.cap
##### 5.2.2.13.3 Test coverage {#test-coverage-13 .H6}
* * *
CRR number Test case number N1 9, 11, 13, 15 N2 8, 10, 12, 14, 16 P1 1 P2 2,
3, 4, 5, 6 P3 7 C1 Does not apply for USATEnvelopeHandler
* * *
##### 5.2.2.13.4 Test procedure {#test-procedure-13 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | 1 | NULL as parameter | Nu | | | | to dstBuffer | llPointerException | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | dstOffset ≥ | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | copy() | | | | | | | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 5 | | | | | | | | | | dstLength = 1 | | | +----+--------------------+--------------------+------------------+ | 3 | dstOffset \ | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | copy() | | | | | | | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+------------------+ | 5 | DstOffset + | ArrayIndexOu | | | | dstLength > | tOfBoundsException | | | | dstBuffer.length | is thrown | | | | | | | | | copy() | | | | | | | | | | DstBuffer.length = | | | | | 5 | | | | | | | | | | DstOffset = 3 | | | | | | | | | | DstLength = 3 | | | +----+--------------------+--------------------+------------------+ | 6 | dstLength \ | Toolk | | | | length of the | itException.OUT_O | | | | Comprehension TLV | F_TLV_BOUNDARIES | | | | list | is thrown | | | | | | | | | copy() | | | | | | | | | | DstBuffer.length = | | | | | 48 | | | | | | | | | | DstOffset = 0 | | | | | | | | | | DstLength = 48 | | | +----+--------------------+--------------------+------------------+ | 8 | Successful call, | Result of copy() | | | | dstBuffer is the | is 0X0047 | | | | whole buffer | | | | | | | | | | copy() | | | | | | | | | | DstBuffer.length = | | | | | 47 | | | | | | | | | | DstOffset = 0 | | | | | | | | | | DstLength = 47 | | | +----+--------------------+--------------------+------------------+ | 9 | Compare the buffer | Result of | | | | | arrayCompare() is | | | | | 0 | | +----+--------------------+--------------------+------------------+ | 10 | Successful call, | Result of copy() | | | | dstBuffer is part | is 0X0032 | | | | of a buffer | | | | | | | | | | copy() | | | | | | | | | | DstBuffer.length = | | | | | 50 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 47 | | | +----+--------------------+--------------------+------------------+ | 11 | Compare the whole | Result of | | | | buffer | arrayCompare() is | | | | | 0 | | +----+--------------------+--------------------+------------------+ | 12 | Successful call, | Result of copy() | | | | dstBuffer is part | is 0X0009 | | | | of a buffer | | | | | | | | | | copy() | | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+------------------+ | 13 | Compare the whole | Result of | | | | buffer | arrayCompare() is | | | | | 0 | | +----+--------------------+--------------------+------------------+ | 14 | **Successful call, | Result of copy() | | | | dstBuffer is part | is 0X0104 | | | | of a buffer** | | | | | | | | | | copy() | | | | | | | | | | dstBuffer.length = | | | | | 260 | | | | | | | | | | dstOffset = 257 | | | | | | | | | | dstLength = 3 | | | +----+--------------------+--------------------+------------------+ | 15 | Compare the whole | Result of | | | | buffer | arrayCompare() is | | | | | 0 | | +----+--------------------+--------------------+------------------+ | 16 | Successful call, | Result of copy() | | | | copy() with length | is 0x104 | | | | =0 | | | | | | | | | | dstBuffer.length = | | | | | 260 | | | | | | | | | | dstOffset = 260 | | | | | | | | | | dstLength = 0 | | | +----+--------------------+--------------------+------------------+
#### 5.2.2.14 Method copyValue
Test Area Reference: Api_2_Ueh_Cpyv
##### 5.2.2.14.1 Conformance requirement {#conformance-requirement-13 .H6}
The method with following header shall be compliant with its definition in the
API.
public short copyValue(short valueOffset,
byte[] dstBuffer,
short dstOffset,
short dstLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 5.2.2.14.1.1 Normal execution {#normal-execution-13 .H6}
\- CRRN1: copies a part of the last TLV element which has been found, into a
destination. buffer.
\- CRRN2: returns dstOffset + dstLength.
##### 5.2.2.14.1.2 Parameter errors {#parameter-errors-10 .H6}
\- CRRP1: if dstBuffer is null NullPointerException is thrown.
\- CRRP2: if dstOffset or dstLength or both would cause access outside array
bounds, or if dstLength is negative ArrayIndexOutOfBoundsException is thrown.
\- CRRP3: if valueOffset, dstLength or both are out of the current TLV an
instance of ToolkitException shall be thrown. The reason code shall be
ToolkitException OUT_OF_TLV_BOUNDARIES.
##### 5.2.2.14.1.3 Context errors {#context-errors-13 .H6}
\- CRRC1: if the handler is busy an instance of ToolkitException shall be
thrown. The reason code shall be ToolkitException.HANDLER_NOT_AVAILABLE.
\- CRRC2: in case of unavailable TLV element an instance of ToolkitException
shall be thrown. The reason code shall be
ToolkitException.UNAVAILABLE_ELEMENT.
##### 5.2.2.14.2 Test area files {#test-area-files-14 .H6}
Specific triggering: Unrecognized Envelope
Test Source: Test_Api_2_Ueh_Cpyv.java
Test Applet: Api_2_Ueh_Cpyv_1.java
Cap File: Api_2_Ueh_Cpyv.cap
##### 5.2.2.14.3 Test coverage {#test-coverage-14 .H6}
* * *
CRR number Test case number N1 13, 15 N2 12, 14, 16 P1 1 P2 2, 3, 4, 5, 6 P3
7, 8, 9, 10 C1 Does not apply for USATEnvelopeHandler C2 11
* * *
##### 5.2.2.14.4 Test procedure {#test-procedure-14 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | 1 | Search TLV 02h | | | +----+--------------------+--------------------+------------------+ | | copyValue() with a | Nu | | | | null dstBuffer | llPointerException | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | Search TLV 0Bh | | | +----+--------------------+--------------------+------------------+ | | dstOffset ≥ | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | copyValue() | | | | | | | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 5 | | | | | | | | | | dstLength = 1 | | | +----+--------------------+--------------------+------------------+ | 3 | dstOffset \dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | copyValue() | | | | | | | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+------------------+ | 5 | dstOffset + | ArrayIndexOu | | | | dstLength | tOfBoundsException | | | | >dstBuffer.length | is thrown | | | | | | | | | copyValue() | | | | | | | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 3 | | | +----+--------------------+--------------------+------------------+ | 6 | dstLength \ TLV | Toolk | | | | length | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | copyValue() | is thrown | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 7 | | | +----+--------------------+--------------------+------------------+ | 10 | valueOffset + | Toolk | | | | dstLength > TLV | itException.OUT_O | | | | length | F_TLV_BOUNDARIES | | | | | is thrown | | | | copyValue() | | | | | | | | | | valueOffset = 2 | | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 5 | | | +----+--------------------+--------------------+------------------+ | 11 | Search TLV 01h | | | +----+--------------------+--------------------+------------------+ | | copyValue() | T | | | | | oolkitException.UN | | | | | AVAILABLE_ELEMENT | | | | | is thrown on the | | | | | copyValue() method | | | | | call. | | +----+--------------------+--------------------+------------------+ | 12 | Search TLV 06h | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result of | | | | | copyValue() is | | | | copyValue() | 0x0006 | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 6 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+------------------+ | 13 | Compare buffer | Result is 00h | | | | | | | | | buffer = 81 11 22 | | | | | 33 44 F5 | | | +----+--------------------+--------------------+------------------+ | 14 | initialize | | | | | dstBuffer | | | | | | | | | | dstBuffer = 55 55 | | | | | ... 55 | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result of | | | | | copyValue() is | | | | copyValue() | 0x0007 | | | | | | | | | valueOffset = 1 | | | | | | | | | | dstBuffer.length = | | | | | 20 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 4 | | | +----+--------------------+--------------------+------------------+ | 15 | Compare buffer | Result is 00h | | | | | | | | | buffer = | | | | | | | | | | 55 55 55 11 22 | | | | | | | | | | 33 44 55 55 55 | | | | | | | | | | 55 55 55 55 55 | | | | | | | | | | 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | 16 | Successful call, | Result of | | | | copy with length | copyValue() is 20 | | | | =0 | | | | | | | | | | dstBuffer.length = | | | | | 20 | | | | | | | | | | dstOffset = 20 | | | | | | | | | | dstLength = 0 | | | +----+--------------------+--------------------+------------------+
#### 5.2.2.15 Method findAndCompareValue(byte tag, byte[] compareBuffer, short
compareOffset)
Test Area Reference: Api_2_Ueh_Facrb_Bs
##### 5.2.2.15.1 Conformance requirement {#conformance-requirement-14 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte findAndCompareValue(byte tag,
byte[] compareBuffer,
short compareOffset)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 5.2.2.15.1.1 Normal execution {#normal-execution-14 .H6}
Looks for the first occurrence of a TLV element from beginning of a TLV list
and compare its value with a buffer:
\- CRRN1: if no TLV element is found, the UNAVAILABLE_ELEMENT exception is
thrown and the current TLV is no longer defined.
\- CRRN2: if the method is successful then the corresponding TLV becomes
current.
\- CRRN3: if identical returns 0.
\- CRRN4: if the first miscomparing byte in Comprehension TLV is less than
that in compareBuffer returns -1.
\- CRRN5: if the first miscomparing byte in Comprehension TLV is greater than
that in compareBuffer returns 1.
\- CRRN6: The search method is comprehension required flag independent.
##### 5.2.2.15.1.2 Parameter errors {#parameter-errors-11 .H6}
\- CRRP1: if compareBuffer is null NullPointerException shall be thrown.
\- CRRP2: if compareOffset would cause access outside array bounds
ArrayIndexOutOfBoundsException shall be thrown.
##### 5.2.2.15.1.3 Context errors {#context-errors-14 .H6}
\- CRRC1: if the handler is busy an instance of ToolkitException shall be
thrown. The reason code shall be ToolkitException.HANDLER_NOT_AVAILABLE.
##### 5.2.2.15.2 Test area files {#test-area-files-15 .H6}
Specific triggering: Unrecognized Envelope
Test Source: Test_Api_2_Ueh_Facrb_Bs.java
Test Applet: Api_2_Ueh_Facrb_Bs_1.java
Cap File: Api_2_Ueh_Facrb_Bs.cap
##### 5.2.2.15.3 Test coverage {#test-coverage-15 .H6}
* * *
CRR number Test case number N1 6,7 N2 9 N3 8, 12, 13 N4 10, 14 N5 11, 15 N6
16, 17 P1 1 P2 2, 3, 4, 5 C1 Does not apply for USATEnvelopeHandler
* * *
##### 5.2.2.15.4 Test procedure {#test-procedure-15 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | | Fill the | | | | | Unrecognized | | | | | Envelope with TLV: | | | | | Tag 02, Value 83 | | | | | 81, Tag 06, Value | | | | | 81 11 22 33 44 F5, | | | | | Tag 02 Value 22 44 | | | | | Tag 33, Length C4 | | | | | Value 01 02 ... | | | +----+--------------------+--------------------+------------------+ | 1 | fin | Nu | | | | dAndCompareValue() | llPointerException | | | | with a null | is thrown | | | | dstBuffer | | | +----+--------------------+--------------------+------------------+ | 2 | compareOffset ≥ | ArrayIndexOu | | | | co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | fin | | | | | dAndCompareValue() | | | | | | | | | | tag = 06h | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 12 | | | | | | | | | | compareOffset = 12 | | | +----+--------------------+--------------------+------------------+ | 3 | compareOffset \ | ArrayIndexOu | | | | co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | fin | | | | | dAndCompareValue() | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 05 | | | | | | | | | | compareOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 5 | compareOffset + | ArrayIndexOu | | | | length > | tOfBoundsException | | | | co | is thrown | | | | mpareBuffer.length | | | | | | | | | | fin | | | | | dAndCompareValue() | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 12 | | | | | | | | | | compareOffset = 7 | | | +----+--------------------+--------------------+------------------+ | 6 | Select a TLV (tag | | | | | 02h) | | | +----+--------------------+--------------------+------------------+ | | fin | T | | | | dAndCompareValue() | oolkitException.UN | | | | | AVAILABLE_ELEMENT | | | | tag = 03h | is thrown | | +----+--------------------+--------------------+------------------+ | 7 | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | is thrown. | | +----+--------------------+--------------------+------------------+ | 8 | Initialize | | | | | compareBuffer | | | | | | | | | | compareBuffer = 81 | | | | | 11 22 33 44 F5 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is 00h | | | | | | | | | fin | | | | | dAndCompareValue() | | | | | | | | | | tag = 06h | | | | | | | | | | compareOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 9 | Verify current TLV | Result is 06 | | | | | | | | | getValueLength() | | | +----+--------------------+--------------------+------------------+ | 10 | Initialize | | | | | compareBuffer | | | | | | | | | | compareBuffer = 81 | | | | | 11 22 33 44 F4 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is +1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 11 | Initialize | | | | | compareBuffer | | | | | | | | | | compareBuffer = 81 | | | | | 11 22 33 44 F6 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is -1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 12 | Initialize | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 81 11 22 33 | | | | | 44 F5 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is 00h | | | | | | | | | fin | | | | | dAndCompareValue() | | | | | | | | | | compareOffset = 2 | | | +----+--------------------+--------------------+------------------+ | 13 | Initialize | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 83 81 55 55 | | | | | 55 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is 00h | | | | | | | | | fin | | | | | dAndCompareValue() | | | | | | | | | | compareOffset = 2 | | | +----+--------------------+--------------------+------------------+ | 14 | Initialize | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 83 80 55 55 | | | | | 55 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is +1 | | | | | | | | | fin | | | | | dAndCompareValue() | | | | | | | | | | compareOffset = 2 | | | +----+--------------------+--------------------+------------------+ | 15 | Initialize | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 83 82 55 55 | | | | | 55 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is -1 | | | | | | | | | fin | | | | | dAndCompareValue() | | | | | | | | | | compareOffset = 2 | | | +----+--------------------+--------------------+------------------+ | 16 | Initialize | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 83 81 55 55 55 55 | | | | | 55 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result is 00h | | | | (with tag 02h) | | | | | | | | | | fin | | | | | dAndCompareValue() | | | | | | | | | | tag = 02h | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 12 | | | | | | | | | | compareOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 17 | Initialize | | | | | compareBuffer | | | | | | | | | | CompareBuffer = 01 | | | | | 02 ... C4 | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result is 00h | | | | (with tag B3h) | | | | | | | | | | fin | | | | | dAndCompareValue() | | | | | | | | | | Tag = B3h | | | | | | | | | | Co | | | | | mpareBuffer.length | | | | | = C4 | | | | | | | | | | CompareOffset = 0 | | | +----+--------------------+--------------------+------------------+
#### 5.2.2.16 Method findAndCompareValue(byte tag, byte occurrence, short
valueOffset, byte[] compareBuffer, short compareOffset, short compareLength)
Test Area Reference: Api_2_Ueh_Facrbbs_Bss
##### 5.2.2.16.1 Conformance requirement {#conformance-requirement-15 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte findAndCompareValue(byte tag,
byte occurrence,
short valueOffset,
byte[] compareBuffer,
short compareOffset,
short compareLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 5.2.2.16.1.1 Normal execution {#normal-execution-15 .H6}
Looks for the indicated occurrence of a TLV element from the beginning of a
TLV list and compare its value with a buffer:
\- CRRN1: if no TLV element is found, the UNAVAILABLE_ELEMENT exception is
thrown and the current TLV is no longer defined.
\- CRRN2: if the method is successful then the corresponding TLV becomes
current.
\- CRRN3: if identical 0 is returned.
\- CRRN4: if the first miscomparing byte in Comprehension TLV is less than
that in compareBuffer -1 is returned.
\- CRRN5: if the first miscomparing byte in Comprehension TLV is greater than
that in compareBuffer 1 is returned
\- CRRN6: The search method is comprehension required flag independent.
##### 5.2.2.16.1.2 Parameter errors {#parameter-errors-12 .H6}
\- CRRP1: if compareBuffer is null NullPointerException shall be thrown.
\- CRRP2: if compareOffset or compareLength or both would cause access outside
array bounds, or if compareLength is negative ArrayIndexOutOfBoundsException
shall be thrown.
\- CRRP3: if valueOffset, compareLength or both are out of the current TLV an
instance of ToolkitException shall be thrown. The reason code shall be
ToolkitException.OUT_OF_TLV_BOUNDARIES.
\- CRRP4: if an input parameter is not valid (e.g. occurrence = 0) an instance
of ToolkitException shall be thrown. The reason code shall be
ToolkitException.BAD_INPUT_PARAMETER.
##### 5.2.2.16.1.3 Context errors {#context-errors-15 .H6}
\- CRRC1: if the handler is busy an instance of ToolkitException shall be
thrown. The reason code shall be ToolkitException.HANDLER_NOT_AVAILABLE.
##### 5.2.2.16.2 Test area files {#test-area-files-16 .H6}
Specific triggering: Unrecognized Envelope
Test Source: Test_Api_2_Ueh_Facrbbs_Bss.java
Test Applet: Api_2_Ueh_Facrbbs_Bss_1.java
Cap File: Api_2_Ueh_Facrbbs_Bss.cap
##### 5.2.2.16.3 Test coverage {#test-coverage-16 .H6}
* * *
CRR number Test case number N1 12, 13 N2 15 N3 14, 18, 21, 22, 26 N4 16, 20 N5
17, 19, 23 N6 24, 25 P1 1 P2 2, 3, 4, 5, 6 P3 7, 8, 9, 10 P4 11 C1 Does not
apply for USATEnvelopeHandler
* * *
##### 5.2.2.16.4 Test procedure {#test-procedure-16 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | | Fill the | | | | | Unrecognized | | | | | Envelope with TLV: | | | | | Tag 02, Value 83 | | | | | 81, Tag 06, Value | | | | | 81 11 22 33 44 F5, | | | | | Tag 02 Value 22 44 | | | | | Tag 33, Length C4 | | | | | Value 01 02 ... | | | +----+--------------------+--------------------+------------------+ | 1 | fin | Nu | | | | dAndCompareValue() | llPointerException | | | | with a null | is thrown | | | | compareBuffer | | | +----+--------------------+--------------------+------------------+ | 2 | compareOffset ≥ | ArrayIndexOu | | | | co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | fin | | | | | dAndCompareValue() | | | | | | | | | | tag = 06h, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 6 | | | | | | | | | | compareOffset = 6 | | | | | | | | | | compareLength = 1 | | | +----+--------------------+--------------------+------------------+ | 3 | compareOffset \co | tOfBoundsException | | | | mpareBuffer.length | is thrown | | | | | | | | | fin | | | | | dAndCompareValue() | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 6 | | | +----+--------------------+--------------------+------------------+ | 5 | compareOffset + | ArrayIndexOu | | | | compareLength | tOfBoundsException | | | | >co | is thrown | | | | mpareBuffer.length | | | | | | | | | | fin | | | | | dAndCompareValue() | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 5 | | | | | | | | | | compareOffset = 3 | | | | | | | | | | compareLength = 3 | | | +----+--------------------+--------------------+------------------+ | 6 | compareLength \ | Toolk | | | | Value length | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | fin | is thrown | | | | dAndCompareValue() | | | | | | | | | | valueOffset = 0 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 7 | | | +----+--------------------+--------------------+------------------+ | 10 | valueOffset + | Toolk | | | | compareLength > | itException.OUT_O | | | | Value length | F_TLV_BOUNDARIES | | | | | is thrown | | | | fin | | | | | dAndCompareValue() | | | | | | | | | | valueOffset = 2 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 15 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 5 | | | +----+--------------------+--------------------+------------------+ | 11 | Invalid parameter | To | | | | | olkitException.BAD | | | | fin | _INPUT_PARAMETER | | | | dAndCompareValue() | is thrown | | | | | | | | | occurrence = 0 | | | +----+--------------------+--------------------+------------------+ | 12 | Select a TLV (tag | | | | | 02h) | | | +----+--------------------+--------------------+------------------+ | | fin | T | | | | dAndCompareValue() | oolkitException.UN | | | | | AVAILABLE_ELEMENT | | | | tag = 06h | is thrown | | | | | | | | | occurrence = 2 | | | +----+--------------------+--------------------+------------------+ | 13 | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | is thrown. | | +----+--------------------+--------------------+------------------+ | 14 | Initialize | | | | | compareBuffer | | | | | | | | | | compareBuffer = 81 | | | | | 11 22 33 44 F5 | | | +----+--------------------+--------------------+------------------+ | | fin | Result is 00h | | | | dAndCompareValue() | | | | | | | | | | tag = 06h, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 6 | | | +----+--------------------+--------------------+------------------+ | 15 | Verify current TLV | Result is 0006 | | | | | | | | | getValueLength() | | | +----+--------------------+--------------------+------------------+ | 16 | Initialize | | | | | compareBuffer | | | | | | | | | | compareBuffer = 81 | | | | | 11 22 33 44 F4 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is +1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 17 | Initialize | | | | | compareBuffer | | | | | | | | | | compareBuffer = 81 | | | | | 11 22 33 44 F6 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is -1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 18 | Initialize | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 22 33 44 | | | | | F5 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is 00h | | | | | | | | | fin | | | | | dAndCompareValue() | | | | | | | | | | valueOffset = 2 | | | | | | | | | | compareOffset = 3 | | | | | | | | | | compareLength = 4 | | | +----+--------------------+--------------------+------------------+ | 19 | Initialize | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 22 33 45 | | | | | F5 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is -1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 20 | Initialize | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 55 55 55 22 33 43 | | | | | F5 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Compare buffers | Result is +1 | | | | with same | | | | | parameters | | | +----+--------------------+--------------------+------------------+ | 21 | Initialize | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 83 81 55 55 55 55 | | | | | 55 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | fin | Result is 00h | | | | dAndCompareValue() | | | | | | | | | | tag = 02h, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 2 | | | +----+--------------------+--------------------+------------------+ | 22 | Initialize | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 22 44 55 55 55 55 | | | | | 55 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | fin | Result is 00h | | | | dAndCompareValue() | | | | | | | | | | tag = 02h, | | | | | occurrence = 2 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 2 | | | +----+--------------------+--------------------+------------------+ | 23 | Initialize | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 22 45 55 55 55 55 | | | | | 55 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | fin | Result is -1 | | | | dAndCompareValue() | | | | | | | | | | tag = 02h, | | | | | occurrence = 2 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 2 | | | +----+--------------------+--------------------+------------------+ | 24 | Initialize | | | | | compareBuffer | | | | | | | | | | compareBuffer = | | | | | | | | | | 83 81 55 55 55 55 | | | | | 55 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result is 00h | | | | (with tag 02h) | | | | | | | | | | fin | | | | | dAndCompareValue() | | | | | | | | | | tag = 02h, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 12 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = 2 | | | +----+--------------------+--------------------+------------------+ | 25 | Initialize | | | | | compareBuffer | | | | | | | | | | compareBuffer = 01 | | | | | 02 ... C4 | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result is 00h | | | | (with tag B3h) | | | | | | | | | | fin | | | | | dAndCompareValue() | | | | | | | | | | tag = B3h, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | co | | | | | mpareBuffer.length | | | | | = 00C4 | | | | | | | | | | compareOffset = 0 | | | | | | | | | | compareLength = | | | | | 00C4 | | | +----+--------------------+--------------------+------------------+ | 26 | Successful call, | Result of | | | | fin | fin | | | | dAndCompareValue() | dAndCompareValue() | | | | with length =0 | is 00h | | | | | | | | | DstBuffer.length = | | | | | C4 | | | | | | | | | | DstOffset = C4 | | | | | | | | | | DstLength = 0 | | | +----+--------------------+--------------------+------------------+
#### 5.2.2.17 Method findAndCopyValue(byte tag, byte[] dstBuffer, short
dstOffset)
Test Area Reference: Api_2_Ueh_Facyb_Bs
##### 5.2.2.17.1 Conformance requirement {#conformance-requirement-16 .H6}
The method with following header shall be compliant to its definition in the
API.
public short findAndCopyValue(byte tag,
byte[] dstBuffer,
short dstOffset)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 5.2.2.17.1.1 Normal execution {#normal-execution-16 .H6}
\- CRRN1: looks for the first occurrence of a TLV element from the beginning
of a TLV list and copy its value into a destination buffer.
\- CRRN2: if no TLV element is found, the UNAVAILABLE_ELEMENT exception is
thrown and the current TLV is no longer defined.
\- CRRN3: if the method is successful then the corresponding TLV becomes
current and dstOffset + length of the copied value is returned.
\- CRRN4: The search method is comprehension required flag independent.
##### 5.2.2.17.1.2 Parameter errors {#parameter-errors-13 .H6}
\- CRRP1: if dstBuffer is null NullPointerException shall be thrown.
\- CRRP2: if dstOffset would cause access outside array bounds
ArrayIndexOutOfBoundsException shall be thrown.
##### 5.2.2.17.1.3 Context errors {#context-errors-16 .H6}
\- CRRC1: if the handler is busy an instance of ToolkitException shall be
thrown. The reason code shall be ToolkitException.HANDLER_NOT_AVAILABLE.
##### 5.2.2.17.2 Test area files {#test-area-files-17 .H6}
Specific triggering: Unrecognized Envelope
Test Source: Test_Api_2_Ueh_Facyb_Bs.java
Test Applet: Api_2_Ueh_Facyb_Bs_1.java
Cap File: Api_2_Ueh_Facyb_Bs.cap
##### 5.2.2.17.3 Test coverage {#test-coverage-17 .H6}
* * *
CRR number Test case number N1 9, 11, 13 N2 6, 7 N3 8, 10, 12 N4 14, 15, 16,
17 P1 1 P2 2, 3, 4, 5 C1 Does not apply for USATEnvelopeHandler
* * *
##### 5.2.2.17.4 Test procedure {#test-procedure-17 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | | Fill the | | | | | Unrecognized | | | | | Envelope with TLV: | | | | | Tag 02, Value 83 | | | | | 81, Tag 06, Value | | | | | 81 11 22 33 44 F5, | | | | | Tag 02 Value 22 44 | | | | | Tag 33, Length C4 | | | | | Value 01 02 ... | | | +----+--------------------+--------------------+------------------+ | 1 | FindAndCopyValue() | Nu | | | | with a null | llPointerException | | | | dstBuffer | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | dstOffset ≥ | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | findAndCopyValue() | | | | | | | | | | tag = 06h | | | | | | | | | | dstBuffer.length = | | | | | 06 | | | | | | | | | | dstOffset = 06 | | | +----+--------------------+--------------------+------------------+ | 3 | dstOffset \ | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | findAndCopyValue() | | | | | | | | | | dstBuffer.length = | | | | | 05 | | | | | | | | | | dstOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 5 | DstOffset + length | ArrayIndexOu | | | | >dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | findAndCopyValue() | | | | | | | | | | DstBuffer.length = | | | | | 06 | | | | | | | | | | DstOffset = 1 | | | +----+--------------------+--------------------+------------------+ | 6 | Select a TLV (tag | | | | | 02h) | | | +----+--------------------+--------------------+------------------+ | | findAndCopyValue() | T | | | | | oolkitException.UN | | | | tag = 03h | AVAILABLE_ELEMENT | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 7 | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | is thrown. | | +----+--------------------+--------------------+------------------+ | 8 | Successful call | Result of | | | | | findAndCopyValue | | | | findAndCopyValue() | () is 0006 | | | | | | | | | Tag = 06h | | | | | | | | | | DstBuffer.length = | | | | | 06 | | | | | | | | | | DstOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 9 | Compare buffer | Result is 00h | | | | | | | | | buffer = 81 11 22 | | | | | 33 44 F5 | | | +----+--------------------+--------------------+------------------+ | 10 | Initialize | | | | | dstBuffer | | | | | | | | | | dstBuffer = 55 55 | | | | | ... 55 | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result of | | | | | findAndCopyValue | | | | findAndCopyValue() | () is 0008 | | | | | | | | | dstBuffer.length = | | | | | 12 | | | | | | | | | | dstOffset = 2 | | | +----+--------------------+--------------------+------------------+ | 11 | Compare buffer | Result is 00h | | | | | | | | | buffer = | | | | | | | | | | 55 55 81 11 22 33 | | | | | 44 F5 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | 12 | Successful call | Result of | | | | | findAndCopyValue | | | | findAndCopyValue() | () is 0002 | | | | | | | | | tag = 02h | | | | | | | | | | dstBuffer.length = | | | | | 2 | | | | | | | | | | dstOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 13 | Compare buffer | Result is 00h | | | | | | | | | buffer = 83 81 | | | +----+--------------------+--------------------+------------------+ | 14 | Successful call | Result of | | | | (with tag 82h) | findAndCopyValue | | | | | () is 0002 | | | | findAndCopyValue() | | | | | | | | | | tag = 82h | | | | | | | | | | dstBuffer.length = | | | | | 02 | | | | | | | | | | dstOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 15 | Compare buffer | Result is 00h | | | | | | | | | buffer = 83 81 | | | +----+--------------------+--------------------+------------------+ | 16 | Successful call | Result of | | | | (with tag B3h) | findAndCopyValue | | | | | () is 00C4 | | | | findAndCopyValue() | | | | | | | | | | tag = B3h | | | | | | | | | | dstBuffer.length = | | | | | C4 | | | | | | | | | | dstOffset = 0 | | | +----+--------------------+--------------------+------------------+ | 17 | Compare buffer | Result is 00h | | | | | | | | | buffer = 01 02 ... | | | | | C4 | | | +----+--------------------+--------------------+------------------+
#### 5.2.2.18 Method findAndCopyValue(byte tag, byte occurrence, short
valueOffset, byte[] dstBuffer, short dstOffset, short dstLength)
Test Area Reference: Api_2_Ueh_Facybbs_Bss
##### 5.2.2.18.1 Conformance requirement {#conformance-requirement-17 .H6}
The method with following header shall be compliant to its definition in the
API.
public short findAndCopyValue(byte tag,
byte occurrence,
short valueOffset,
byte[] dstBuffer,
short dstOffset,
short dstLength)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException
##### 5.2.2.18.1.1 Normal execution {#normal-execution-17 .H6}
\- CRRN1: looks for the indicated occurrence of a TLV element from the
beginning of a TLV list and copy its value into a destination buffer.
\- CRRN2: if no TLV element is found, the UNAVAILABLE_ELEMENT exception is
thrown and the current TLV is no longer defined.
\- CRRN3: if the method is successful then the corresponding TLV becomes
current and dstOffset + dstLength is returned.
\- CRRN4: The search method is comprehension required flag independent.
##### 5.2.2.18.1.2 Parameter errors {#parameter-errors-14 .H6}
\- CRRP1: if dstBuffer is null NullPointerException shall be thrown.
\- CRRP2: if dstOffset or dstLength or both would cause access outside array
bounds, or if dstLength is negative ArrayIndexOutOfBoundsException shall be
thrown.
\- CRRP3: if valueOffset, dstLength or both are out of the current TLV an
instance of ToolkitException shall be thrown. The reason code shall be
ToolkitException.OUT_OF_TLV_BOUNDARIES.
##### 5.2.2.18.1.3 Context errors {#context-errors-17 .H6}
\- CRRC1: if the handler is busy an instance of ToolkitException shall be
thrown. The reason code shall be ToolkitException.HANDLER_NOT_AVAILABLE.
##### 5.2.2.18.2 Test area files {#test-area-files-18 .H6}
Specific triggering: Unrecognized Envelope
Test Source: Test_Api_2_Ueh_Facybbs_Bss.java
Test Applet: Api_2_Ueh_Facybbs_Bss_1.java
Cap File: Api_2_Ueh_Facybbs_Bss.cap
##### 5.2.2.18.3 Test coverage {#test-coverage-18 .H6}
* * *
CRR number Test case number N1 14, 15, 17, 19, 20 N2 11, 12 N3 13, 15, 17, 19,
25 N4 21, 22, 23, 24 P1 1 P2 2, 3, 4, 5, 6 P3 7, 8, 9, 10 C1 Does not apply
for USATEnvelopeHandler
* * *
##### 5.2.2.18.4 Test procedure {#test-procedure-18 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | | Fill the | | | | | Unrecognized | | | | | Envelope with TLV: | | | | | Tag 02, Value 83 | | | | | 81, Tag 06, Value | | | | | 81 11 22 33 44 F5, | | | | | Tag 02 Value 22 44 | | | | | Tag 33, Length C4 | | | | | Value 01 02 ... | | | +----+--------------------+--------------------+------------------+ | 1 | findAndCopyValue() | Nu | | | | with a null | llPointerException | | | | dstBuffer | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | dstOffset ≥ | ArrayIndexOu | | | | dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | findAndCopyValue() | | | | | | | | | | tag = 06h, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 5 | | | | | | | | | | dstLength = 1 | | | +----+--------------------+--------------------+------------------+ | 3 | dstOffset \dstBuffer.length | tOfBoundsException | | | | | is thrown | | | | findAndCopyValue() | | | | | | | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 6 | | | +----+--------------------+--------------------+------------------+ | 5 | dstOffset + | ArrayIndexOu | | | | dstLength | tOfBoundsException | | | | >dstBuffer.length | is thrown | | | | | | | | | findAndCopyValue() | | | | | | | | | | dstBuffer.length = | | | | | 5 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 3 | | | +----+--------------------+--------------------+------------------+ | 6 | dstLength \ Value | Toolk | | | | length | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | findAndCopyValue() | is thrown | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 7 | | | +----+--------------------+--------------------+------------------+ | 10 | **valueOffset + | Toolk | | | | dstLength > Text | itException.OUT_O | | | | String length** | F_TLV_BOUNDARIES | | | | | is thrown | | | | findAndCopyValue() | | | | | | | | | | valueOffset = 2 | | | | | | | | | | dstBuffer.length = | | | | | 15 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 5 | | | +----+--------------------+--------------------+------------------+ | 11 | Select a TLV (tag | | | | | 02h) | | | +----+--------------------+--------------------+------------------+ | | findAndCopyValue() | T | | | | | oolkitException.UN | | | | tag = 06h | AVAILABLE_ELEMENT | | | | | is thrown | | | | occurrence = 2 | | | +----+--------------------+--------------------+------------------+ | 12 | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | is thrown. | | +----+--------------------+--------------------+------------------+ | 13 | Successful call | Result of | | | | | findAndCopyValue() | | | | findAndCopyValue() | is 6 | | | | | | | | | tag = 06h, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 06 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 06 | | | +----+--------------------+--------------------+------------------+ | 14 | Compare buffer | Result is 00h | | | | | | | | | buffer = 81 11 22 | | | | | 33 44 F5 | | | +----+--------------------+--------------------+------------------+ | 15 | Initialize | | | | | dstBuffer | | | | | | | | | | dstBuffer = 55 55 | | | | | ... 55 | | | +----+--------------------+--------------------+------------------+ | | Successful call | Result of | | | | | findAndCopyValue | | | | findAndCopyValue() | () is 0007 | | | | | | | | | tag = 06h, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 2 | | | | | | | | | | dstBuffer.length = | | | | | 12 | | | | | | | | | | dstOffset = 3 | | | | | | | | | | dstLength = 04 | | | +----+--------------------+--------------------+------------------+ | 16 | Compare buffer | Result is 00h | | | | | | | | | buffer = | | | | | | | | | | 55 55 55 22 33 44 | | | | | F5 55 55 55 55 55 | | | +----+--------------------+--------------------+------------------+ | 17 | Successful call | Result of | | | | | findAndCopyValue() | | | | findAndCopyValue() | is 0002 | | | | | | | | | tag = 02h, | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 12 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 2 | | | +----+--------------------+--------------------+------------------+ | 18 | Compare buffer | Result is 00h | | | | | | | | | buffer = 83 81 55 | | | | | ... 55 | | | +----+--------------------+--------------------+------------------+ | 19 | Successful call | Result of | | | | | findAndCopyValue() | | | | findAndCopyValue() | is 0002 | | | | | | | | | tag = 02h, | | | | | occurrence = 2 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 12 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 2 | | | +----+--------------------+--------------------+------------------+ | 20 | Compare buffer | Result is 00h | | | | | | | | | buffer = 22 44 55 | | | | | ... 55 | | | +----+--------------------+--------------------+------------------+ | 21 | Successful call | Result of | | | | (with tag 82h) | findAndCopyValue | | | | | () is 0002 | | | | findAndCopyValue() | | | | | | | | | | tag = 82h | | | | | | | | | | occurrence = 1 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 12 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 02 | | | +----+--------------------+--------------------+------------------+ | 22 | Compare buffer | Result is 00h | | | | | | | | | buffer = 83 81 55 | | | | | ... 55 | | | +----+--------------------+--------------------+------------------+ | 23 | Successful call | Result of | | | | (with tag 82h) | findAndCopyValue | | | | | () is 0002 | | | | findAndCopyValue() | | | | | | | | | | tag = 82h | | | | | | | | | | occurrence = 2 | | | | | | | | | | valueOffset = 0 | | | | | | | | | | dstBuffer.length = | | | | | 12 | | | | | | | | | | dstOffset = 0 | | | | | | | | | | dstLength = 02 | | | +----+--------------------+--------------------+------------------+ | 24 | Compare buffer | Result is 00h | | | | | | | | | Buffer = 22 44 55 | | | | | ... 55 | | | +----+--------------------+--------------------+------------------+ | 25 | Successful call, | Result of | | | | findAndCopyValue() | findAndCopyValue | | | | with length =0 | () is 12 | | | | | | | | | DstBuffer.length = | | | | | 12 | | | | | | | | | | dstOffset = 12 | | | | | | | | | | dstLength = 0 | | | +----+--------------------+--------------------+------------------+
#### 5.2.2.19 Method findTLV
Test Area Reference: Api_2_Ueh_Find
##### 5.2.2.19.1 Conformance requirement {#conformance-requirement-18 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte findTLV(byte tag,
byte occurrence)
throws ToolkitException
##### 5.2.2.19.1.1 Normal execution {#normal-execution-18 .H6}
Looks for the indicated occurrence of a TLV element from the beginning of the
TLV list (handler buffer):
\- CRRN1: the method is successful if the required occurrence exists then the
corresponding TLV becomes current.
\- CRRN2: if the method is successful then it returns TLV_FOUND_CR_SET when
Comprehension Required flag is set.
\- CRRN3: if the method is successful then it returns TLV_FOUND_CR_NOT_SET
when Comprehension Required flag is not set.
\- CRRN4: if the required occurrence of the TLV element does not exist, the
current TLV is no longer defined and TLV_NOT_FOUND is returned.
\- CRRN5: The search method is comprehension required flag independent.
##### 5.2.2.19.1.2 Parameter errors {#parameter-errors-15 .H6}
\- CRRP1: if an input parameter is not valid (e.g. occurrence = 0) an instance
of ToolkitException shall be thrown. The reason code shall be
ToolkitException.BAD_INPUT_PARAMETER.
##### 5.2.2.19.1.3 Context errors {#context-errors-18 .H6}
\- CRRC1: if the handler is busy an instance of ToolkitException shall be
thrown. The reason code shall be ToolkitException.HANDLER_NOT_AVAILABLE.
##### 5.2.2.19.2 Test area files {#test-area-files-19 .H6}
Specific triggering: Unrecognized Envelope
Test Source: Test_Api_2_Ueh_Find.java
Test Applet: Api_2_Ueh_Find_1.java
Cap File: Api_2_Ueh_Find.cap
##### 5.2.2.19.3 Test coverage {#test-coverage-19 .H6}
* * *
CRR number Test case number N1 3, 5 N2 2, 4 N3 10, 11 N4 6, 7, 8, 9 N5 12, 13
P1 1 C1 Does not apply for USATEnvelopeHandler
* * *
##### 5.2.2.19.4 Test procedure {#test-procedure-19 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | | Trigger the applet | | | | | with Unrecognized | | | | | Envelope | | | | | including: | | | | | | | | | | Tag 82, tag 86, | | | | | tag 8B, tag 02 and | | | | | tag 04 | | | +----+--------------------+--------------------+------------------+ | 1 | Invalid input | To | | | | parameter | olkitException.BAD | | | | | _INPUT_PARAMETER | | | | findTLV() | is thrown | | | | | | | | | Occurrence = 0 | | | +----+--------------------+--------------------+------------------+ | 2 | Search 1st TLV | Result is | | | | | T | | | | findTLV() | LV_FOUND_CR_SET | | | | | | | | | Tag = 02h | | | | | | | | | | Occurrence = 1 | | | +----+--------------------+--------------------+------------------+ | 3 | Call the | Result is 0x02 | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+------------------+ | 4 | Search 2nd TLV | Result is | | | | | T | | | | findTLV() | LV_FOUND_CR_SET | | | | | | | | | Tag = 06h | | | | | | | | | | Occurrence = 1 | | | +----+--------------------+--------------------+------------------+ | 5 | Call the | Result is 0x05h | | | | getValueLength() | | | | | method | | | +----+--------------------+--------------------+------------------+ | 6 | Select a TLV (tag | | | | | 02h) | | | +----+--------------------+--------------------+------------------+ | | Search a wrong tag | Result is | | | | | TLV_NOT_FOUND | | | | findTLV() | | | | | | | | | | Tag = 03h | | | | | | | | | | Occurrence = 1 | | | +----+--------------------+--------------------+------------------+ | 7 | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | is thrown. | | +----+--------------------+--------------------+------------------+ | 8 | Search a tag with | Result is | | | | wrong occurrence | TLV_NOT_FOUND | | | | | | | | | findTLV() | | | | | | | | | | Tag = 02h | | | | | | | | | | Occurrence = 3 | | | +----+--------------------+--------------------+------------------+ | 9 | Call the | T | | | | getValueLength() | oolkitException.UN | | | | method | AVAILABLE_ELEMENT | | | | | is thrown. | | +----+--------------------+--------------------+------------------+ | 10 | Search the TLV | Result is | | | | | TLV_F | | | | findTLV() | OUND_CR_NOT_SET | | | | | | | | | Tag = 02h | | | | | | | | | | Occurrence = 2 | | | +----+--------------------+--------------------+------------------+ | 11 | Search the TLV | Result is | | | | | TLV_F | | | | findTLV() | OUND_CR_NOT_SET | | | | | | | | | Tag = 04h | | | | | | | | | | Occurrence = 1 | | | +----+--------------------+--------------------+------------------+ | 12 | Search tag 86h | Result is | | | | | T | | | | findTLV() | LV_FOUND_CR_SET | | | | | | | | | Tag = 86h | | | | | | | | | | Occurrence = 1 | | | +----+--------------------+--------------------+------------------+ | 13 | Search tag 84h | Result is | | | | | TLV_F | | | | findTLV() | OUND_CR_NOT_SET | | | | | | | | | Tag = 84h | | | | | | | | | | Occurrence = 1 | | | +----+--------------------+--------------------+------------------+
#### 5.2.2.20 Method getCapacity
Test Area Reference: Api_2_Ueh_Gcap
##### 5.2.2.20.1 Conformance requirement {#conformance-requirement-19 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte getCapacity()
##### 5.2.2.20.1.1 Normal execution {#normal-execution-19 .H6}
\- CRRN1: The method shall return the maximum size of the Comprehension TLV
list managed by the handler.
##### 5.2.2.20.1.2 Parameter Errors {#parameter-errors-16 .H6}
No requirements
##### 5.2.2.20.1.3 Context errors {#context-errors-19 .H6}
No requirements
##### 5.2.2.20.2 Test area files {#test-area-files-20 .H6}
Test Source: Test_Api_2_Ueh_Gcap.java
Test Applet: Api_2_Ueh_Gcap_1.java
Cap File: Api_2_Ueh_Gcap.cap
##### 5.2.2.20.3 Test coverage {#test-coverage-20 .H6}
* * *
CRR number Test case number N1 1
* * *
##### 5.2.2.20.4 Test procedure {#test-procedure-20 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | 1 | **U | 1 - Applet is | | | | SATEnvelopeHandler | triggered | | | | available** | | | | | | 2 - No exception | | | | 1 - Send envelope | is thrown | | | | Menu Selection | | | | | | 3 - No exception | | | | 2 - The applet | is thrown; the | | | | calls the | capacity is | | | | getLength() method | greater than the | | | | | BER TLV Length | | | | 3 - The applet | | | | | calls the | | | | | getCapacity() | | | | | method | | | +----+--------------------+--------------------+------------------+
#### 5.2.2.21 Method getLength
Test Area Reference: Api_2_Ueh_Glen
##### 5.2.2.21.1 Conformance requirement {#conformance-requirement-20 .H6}
The method with following header shall be compliant to its definition in the
API.
public short getLength()
throws ToolkitException
##### 5.2.2.21.1.1 Normal execution {#normal-execution-20 .H6}
\- CRRN1: returns the length in bytes of the TLV list.
##### 5.2.2.21.1.2 Parameter Errors {#parameter-errors-17 .H6}
No requirements.
##### 5.2.2.21.1.3 Context errors {#context-errors-20 .H6}
\- CRRC1: if the handler is busy an instance of ToolkitException shall be
thrown. The reason code shall be ToolkitException.HANDLER_NOT_AVAILABLE.
##### 5.2.2.21.2 Test area files {#test-area-files-21 .H6}
Specific triggering: Unrecognized envelope
Test Source: Test_Api_2_Ueh_Glen.java
Test Applet: Api_2_Ueh_Glen_1.java
Cap File: Api_2_Ueh_Glen.cap
##### 5.2.2.21.3 Test coverage {#test-coverage-21 .H6}
* * *
CRR number Test case number N1 1, 2, 3, 4 C1 Does not apply for
USATEnvelopeHandler
* * *
##### 5.2.2.21.4 Test procedure {#test-procedure-21 .H6}
* * *
Id Description API/(U)SAT Framework Expectation APDU Expectation 1 Send an
Unrecognized Envelope with BER length of 0x31 Result of getLength() is 0x0031  
2 Send an Unrecognized Envelope with BER length of 0x7F Result of getLength()
is 0x007Fh  
3 Send an Unrecognized Envelope with BER length of 81 80 Result of getLength()
is 0x0080h  
4 Send an Unrecognized Envelope with BER length of 81 FC Result of getLength()
is 0x00FCh
* * *
#### 5.2.2.22 Method getValueByte
Test Area Reference: Api_2_Ueh_Gvby
##### 5.2.2.22.1 Conformance requirement {#conformance-requirement-21 .H6}
The method with following header shall be compliant to its definition in the
API.
public byte getValueByte(short valueOffset)
throws ToolkitException
##### 5.2.2.22.1.1 Normal execution {#normal-execution-21 .H6}
\- CRRN1: Gets a byte from the last TLV element which has been found in the
handler and returns its value (1 byte).
##### 5.2.2.22.1.2 Parameter errors {#parameter-errors-18 .H6}
\- CRRP1: if valueOffset is out of the current TLV an instance of
ToolkitException shall be thrown. The reason code shall be
ToolkitException.OUT_OF_TLV_BOUNDARIES.
##### 5.2.2.22.1.3 Context errors {#context-errors-21 .H6}
\- CRRC1: if the handler is busy an instance of ToolkitException shall be
thrown. The reason code shall be ToolkitException.HANDLER_NOT_AVAILABLE.
\- CRRC2: in case of unavailable TLV element an instance of ToolkitException
shall be thrown. The reason code shall be
ToolkitException.UNAVAILABLE_ELEMENT.
##### 5.2.2.22.2 Test area files {#test-area-files-22 .H6}
Specific triggering: Unrecognized Envelope
Test Source: Test_Api_2_Ueh_Gvby.java
Test Applet: Api_2_Ueh_Gvby_1.java
Cap File: Api_2_Ueh_Gvby.cap
##### 5.2.2.22.3 Test coverage {#test-coverage-22 .H6}
* * *
CRR number Test case number N1 3, 4, 5, 6, 7, 8 P1 2 C1 Does not apply for
USATEnvelopeHandler C2 1
* * *
##### 5.2.2.22.4 Test procedure {#test-procedure-22 .H6}
* * *
Id Description API/(U)SAT Framework Expectation APDU Expectation Fill the
Unrecognized envelope with TLV: Tag 02, length 02, value 83 81, Tag 06, length
06, Tag 0B, length 21, Tag 33, Length C8 Value 01 02 ...  
1 getValueByte(0) ToolkitException.UNAVAILABLE_ELEMENT is thrown  
2 Search TLV 02h  
getValueByte(2) ToolkitException.OUT_OF_TLV_BOUNDARIES is thrown  
3 Search TLV 02h  
getValueByte(1) Result is 0x81  
4 Search TLV 02h (Device Identities TLV)  
getValueByte(0) Result is 83h (Source)  
5 Search TLV 33h  
getValueByte(7E) Result is 0x7F  
6 Search TLV 33h  
getValueByte(80) Result is 0x81  
7 getValueByte(7F) Result is 0x80  
8 Search TLV B3h  
getValueByte(C7) Result is 0xC8
* * *
#### 5.2.2.23 Method getValueLength
Test Area Reference: Api_2_Ueh_Gvle
##### 5.2.2.23.1 Conformance requirement {#conformance-requirement-22 .H6}
The method with following header shall be compliant to its definition in the
API.
public short getValueLength()
throws ToolkitException
##### 5.2.2.23.1.1 Normal execution {#normal-execution-22 .H6}
\- CRRN1: gets and returns the binary length of the value field for the last
TLV element which has been found in the handler.
##### 5.2.2.23.1.2 Parameter errors {#parameter-errors-19 .H6}
No requirements.
##### 5.2.2.23.1.3 Context errors {#context-errors-22 .H6}
\- CRRC1: if the handler is busy an instance of ToolkitException shall be
thrown. The reason code shall be ToolkitException.HANDLER_NOT_AVAILABLE.
\- CRRC2: in case of unavailable TLV element an instance of ToolkitException
shall be thrown. The reason code shall be
ToolkitException.UNAVAILABLE_ELEMENT.
##### 5.2.2.23.2 Test area files {#test-area-files-23 .H6}
Specific triggering: Unrecognized Envelope
Test source: Test_Api_2_Ueh_Gvle.java
Test Applet: Api_2_Ueh_Gvle_1.java
Cap File: Api_2_Ueh_Gvle.cap
##### 5.2.2.23.3 Test coverage {#test-coverage-23 .H6}
* * *
CRR number Test case number N1 2, 3, 4 C1 Does not apply for
USATEnvelopeHandler C2 1
* * *
##### 5.2.2.23.4 Test procedure {#test-procedure-23 .H6}
* * *
Id Description API/(U)SAT Framework Expectation APDU Expectation Fill the
Unrecognized envelope with TLV: Tag 02, length 02, Tag 06, length 05, Tag 0B,
length 24, Tag 33, Length C8  
1 getValueLength() ToolkitException.UNAVAILABLE_ELEMENT is thrown  
2 Search TLV 02h  
getValueLength() Result is 0X0002  
3 Search TLV 0Bh  
getValueLength() Result is 0X0024  
4 Search TLV 33h  
getValueLength() Result is 0X00C8
* * *
#### 5.2.2.24 Method getValueShort
Test Area Reference: Api_2_Ueh_Gvsh
##### 5.2.2.24.1 Conformance requirement {#conformance-requirement-23 .H6}
The method with following header shall be compliant to its definition in the
API.
public short getValueShort(short valueOffset)
throws ToolkitException
##### 5.2.2.24.1.1 Normal execution {#normal-execution-23 .H6}
\- CRRN1: Gets a short from the last TLV element which has been found in the
handler and returns its value (1 short).
##### 5.2.2.24.1.2 Parameter errors {#parameter-errors-20 .H6}
\- CRRP1: if valueOffset is out of the current TLV an instance of
ToolkitException shall be thrown. The reason code shall be
ToolkitException.OUT_OF_TLV_BOUNDARIES.
##### 5.2.2.24.1.3 Context errors {#context-errors-23 .H6}
\- CRRC1: if the handler is busy an instance of ToolkitException shall be
thrown. The reason code shall be ToolkitException.HANDLER_NOT_AVAILABLE.
\- CRRC2: in case of unavailable TLV element an instance of ToolkitException
shall be thrown. The reason code shall be
ToolkitException.UNAVAILABLE_ELEMENT.
##### 5.2.2.24.2 Test area files {#test-area-files-24 .H6}
Specific triggering: Unrecognized Envelope
Test Source: Test_Api_2_Ueh_Gvsh.java
Test Applet: Api_2_Ueh_Gvsh_1.java
Cap File: Api_2_Ueh_Gvsh.cap
##### 5.2.2.24.3 Test coverage {#test-coverage-24 .H6}
* * *
CRR number Test case number N1 3, 4, 5, 6, 7, 8 P1 2 C1 Does not apply for
USATEnvelopeHandler C2 1
* * *
##### 5.2.2.24.4 Test procedure {#test-procedure-24 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | | Fill the | | | | | Unrecognized | | | | | envelope with | | | | | TLVs: | | | | | | | | | | Tag 02, Length 02 | | | | | Value 83 81 | | | | | | | | | | Tag 06, Length 06 | | | | | Value 81 11 22 33 | | | | | 44 F5 | | | | | | | | | | Tag 33, Length C9 | | | | | Value 01 02 ... | | | +----+--------------------+--------------------+------------------+ | 1 | getValueShort(0) | T | | | | | oolkitException.UN | | | | | AVAILABLE_ELEMENT | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 2 | Search TLV 02h | | | +----+--------------------+--------------------+------------------+ | | getValueShort(2) | Toolk | | | | | itException.OUT_O | | | | | F_TLV_BOUNDARIES | | | | | is thrown | | +----+--------------------+--------------------+------------------+ | 3 | Search TLV 02h | | | +----+--------------------+--------------------+------------------+ | | getValueShort(0) | Result is 0x83 | | | | | 0x81 | | +----+--------------------+--------------------+------------------+ | 4 | Search TLV 06h | | | +----+--------------------+--------------------+------------------+ | | getValueShort(1) | Result is 0x11 | | | | | 0x22 | | +----+--------------------+--------------------+------------------+ | 5 | Search TLV 33h | | | +----+--------------------+--------------------+------------------+ | | getValueShort(7E) | Result is 0x7F | | | | | 0x80 | | +----+--------------------+--------------------+------------------+ | 6 | Search TLV 33h | | | +----+--------------------+--------------------+------------------+ | | getValueShort(80) | Result is 0x81 | | | | | 0x82 | | +----+--------------------+--------------------+------------------+ | 7 | getValueShort(7F) | Result is 0x80 | | | | | 0x81 | | +----+--------------------+--------------------+------------------+ | 8 | Search TLV B3h | | | +----+--------------------+--------------------+------------------+ | | getValueShort(C7) | Result is 0xC8 | | | | | 0xC9 | | +----+--------------------+--------------------+------------------+
### 5.2.3 Interface USATTerminalProfile
The constants in Java are resolved at compilation time, therefore a runtime
test is not useful. No test of constants will be performed
### 5.2.4 Class USATEnvelopeHandlerSystem
#### 5.2.4.1 Method getTheHandler
Test Area Reference: Api_2_Ues_Gthd
##### 5.2.4.1.1 Conformance requirements {#conformance-requirements-1 .H6}
The method with following header shall be compliant to its definition in the
API.
public static USATEnvelopeHandler getTheHandler()
throws uicc.toolkit.ToolkitException
##### 5.2.4.1.1.1 Normal execution {#normal-execution-24 .H6}
\- CRRN1: The method shall return the single system instance of the class
implementing the USATEnvelopeHandler interface.
\- CRRN2: The USATEnvelopeHandler is a Temporary JCRE Entry Point Object (see
Java Card 2.2.1 Runtime Environment (JCRE) Specification [])
##### 5.2.4.1.1.2 Parameter Errors {#parameter-errors-21 .H6}
No requirements.
##### 5.2.4.1.1.3 Context errors {#context-errors-24 .H6}
\- CRRC1: The method shall throw ToolkitException.HANDLER_NOT_AVAILABLE if the
handler is busy.
##### 5.2.4.1.2 Test area files {#test-area-files-25 .H6}
Test Source: Test_Api_2_Ues_Gthd.java
Test Applet: Api_2_Ues_Gthd_1.java
Cap File: Api_2_Ues_Gthd.cap
##### 5.2.4.1.3 Test coverage {#test-coverage-25 .H6}
* * *
CRR number Test case number N1 1, 2, 3 N2 Tested in § 5.3.7.1, other parts
transferred to (U)SAT framework from API. C1 Tested in § 5.3.1.5, Minimum
Handler Availability on USATEnvelopeHandler.
* * *
##### 5.2.4.1.4 Test procedure {#test-procedure-25 .H6}
* * *
Id Description API/(U)SAT Framework Expectation APDU Expectation 1 Call
GetTheHandler() method twice The returned objects shall be the same  
2 Verify that getTheHandler() method returns an USATEnvelopeHandler The
reference returned shall be an object implementing the USATEnvelopeHandler
interface (check cast)  
3 Verify the returned value is not null The reference returned shall not be
null.
* * *
### 5.2.5 Interface ToolkitRegistry
#### 5.2.5.1 Method clearEvent
Test Area Reference: Api_2_Tkr_Cevt
##### 5.2.5.1.1 Conformance requirement: {#conformance-requirement-24 .H6}
The method with following header shall be compliant to its definition in the
API.
public void clearEvent(short event)
throws ToolkitException,
javacard.framework.TransactionException
##### 5.2.5.1.1.1 Normal execution {#normal-execution-25 .H6}
\- CRRN1: A call to isEventSet() method for a cleared event should return
false after a call to clearEvent.
\- CRRN2: The (U)SAT Framework shall not trigger the applet on the occurrence
of the cleared event anymore.
\- CRRN3: if event was EVENT_MO_SHORT_MESSAGE_CONTROL_BY_SIM and after the
call, no applet is registered to it, The (U)SAT Framework shall allow an
applet to register to this event.
\- CRRN4: if event was EVENT_MO_SHORT_MESSAGE_CONTROL_BY_SIM and one applet is
still registered to this event, The (U)SAT Framework shall not allow an applet
to register to this event.
##### 5.2.5.1.1.2 Parameter Errors {#parameter-errors-22 .H6}
No requirements.
##### 5.2.5.1.1.3 Context errors {#context-errors-25 .H6}
\- CRRC1: shall throw javacard.framework.TransactionException - if the
operation would cause the commit capacity to be exceeded.
##### 5.2.5.1.2 Test area files {#test-area-files-26 .H6}
Test Source: Test_Api_2_Tkr_Cevt.java
Test Applet: Api_2_Tkr_Cevt_1.java
Cap File: Api_2_Tkr_Cevt.cap
##### 5.2.5.1.3 Test coverage {#test-coverage-26 .H6}
* * *
CRR number Test case number N1 1 N2 2 N3 Framework N4 Framework C1 not
testable
* * *
##### 5.2.5.1.4 Test procedure {#test-procedure-26 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | 1 | Clear ALLOWED | 1- No exception is | | | | events | thrown each time. | | | | | | | | | Install Applet | 2- Shall return | | | | registered to | false each time. | | | | EVENT_FORMA | | | | | TTED_SMS_PP_ENV | | | | | event | | | | | | | | | | For events (2 to | | | | | 6, 10 and 24) | | | | | defined in | | | | | TS 31.130 [2]: | | | | | | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_ENV | | | | | | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_UPD | | | | | | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_UPD | | | | | | | | | | EVENT_UN | | | | | FORMATTED_SMS_CB | | | | | | | | | | EVENT_ | | | | | MO_SHORT_MESSAGE | | | | | _CONTROL_BY_SIM | | | | | | | | | | EVENT_ | | | | | FORMATTED_SMS_CB | | | | | | | | | | EVEN | | | | | T_FORMATTED_USSD | | | | | | | | | | EVENT\ | | | | | _UNFORMATTED_USSD | | | | | | | | | | EV | | | | | ENT_DOWNLOAD_IWL | | | | | AN_ACCESS_STATUS | | | | | | | | | | The applet calls: | | | | | | | | | | 1- Call | | | | | clearEvent() | | | | | method | | | | | | | | | | 2- Call | | | | | isEventSet() | | | | | method | | | +----+--------------------+--------------------+------------------+ | 2 | Checking applet | Applet is not | | | | isn\'t triggered | triggered by an | | | | by an | ENVE | | | | ENVE | LOPE(EVENT_FORMAT | | | | LOPE(EVENT_FORMAT | TED_SMS_PP_ENV) | | | | TED_SMS_PP_ENV) | command | | | | command | | | | | | | | | | 1 - reset and | | | | | initialize the | | | | | card | | | | | | | | | | 2 - An | | | | | ENVE | | | | | LOPE(EVENT_FORMAT | | | | | TED_SMS_PP_ENV) | | | | | is sent. | | | +----+--------------------+--------------------+------------------+
#### 5.2.5.2 Method isEventSet
Test Area Reference: Api_2_Tkr_Ievs
##### 5.2.5.2.1 Conformance requirement: {#conformance-requirement-25 .H6}
The method with following header shall be compliant to its definition in the
API.
public boolean isEventSet(short event)
##### 5.2.5.2.1.1 Normal execution {#normal-execution-26 .H6}
\- CRRN1: shall return true if the event is set in the Toolkit Registry for
the applet.
\- CRRN2: shall return false if the event is not set in the Toolkit Registry
for the applet.
##### 5.2.5.2.1.2 Parameter errors {#parameter-errors-23 .H6}
No requirements.
##### 5.2.5.2.1.3 Context errors {#context-errors-26 .H6}
No requirements.
##### 5.2.5.2.2 Test area files {#test-area-files-27 .H6}
Test Source: Test_Api_2_Tkr_Ievs.java
Test Applet: Api_2_Tkr_Ievs_1.java
Cap File: Api_2_Tkr_Ievs.cap
##### 5.2.5.2.3 Test coverage {#test-coverage-27 .H6}
* * *
CRR number Test case number N1 2 N2 1
* * *
##### 5.2.5.2.4 Test procedure {#test-procedure-27 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | 1 | Install Applet | Shall return false | | | | only registered to | each time. | | | | | | | | | EV | | | | | ENT_EVENT_DOWNLO | | | | | AD_USER_ACTIVITY | | | | | | | | | | Test that events | | | | | are not set | | | | | | | | | | Applet calls | | | | | isEventSet() | | | | | method for each | | | | | event ranging from | | | | | (2 to 6, 10 and | | | | | 24) | | | +----+--------------------+--------------------+------------------+ | 2 | Setting events | 1- No exception | | | | | shall be thrown. | | | | For the following | | | | | events defined in | 2- Shall return | | | | TS 31.130 [2] | true each time. | | | | for setEvent() | | | | | method: | | | | | | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_ENV | | | | | | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_UPD | | | | | | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_UPD | | | | | | | | | | EVENT_UN | | | | | FORMATTED_SMS_CB | | | | | | | | | | EVEN | | | | | T_FORMATTED_USSD | | | | | | | | | | EVENT\ | | | | | _UNFORMATTED_USSD | | | | | | | | | | EVENT_ | | | | | MO_SHORT_MESSAGE | | | | | _CONTROL_BY_SIM | | | | | | | | | | EVENT_ | | | | | FORMATTED_SMS_CB | | | | | | | | | | EV | | | | | ENT_DOWNLOAD_IWL | | | | | AN_ACCESS_STATUS | | | | | | | | | | applet calls: | | | | | | | | | | 1- Call setEvent() | | | | | method | | | | | | | | | | 2- Call | | | | | isEventSet() | | | | | method | | | +----+--------------------+--------------------+------------------+
#### 5.2.5.3 Method setEvent
Test Area Reference: Api_2_Tkr_Sevt
##### 5.2.5.3.1 Conformance requirement: {#conformance-requirement-26 .H6}
The method with following header shall be compliant to its definition in the
API.
public void setEvent(short id)
throws ToolkitException,
javacard.framework.TransactionException
##### 5.2.5.3.1.1 Normal execution {#normal-execution-27 .H6}
\- CRRN1: a following call to isEventSet() method with the same event id shall
answer true for the applet.
\- CRRN2: the (U)SAT Framework shall trigger the applet if an occurrence of
the set event happens.
##### 5.2.5.3.1.2 Parameter errors {#parameter-errors-24 .H6}
No requirements.
##### 5.2.5.3.1.3 Context errors {#context-errors-27 .H6}
\- CRRC1: shall throw a ToolkitException with EVENT_ALREADY_REGISTERED if
event is EVENT_MO_SHORT_MESSAGE_CONTROL_BY_SIM but another applet is already
registered to it.
\- CRRC2: shall throw a ToolkitException with EVENT_ALREADY_REGISTERED if
event is EVENT_MO_SHORT_MESSAGE_CONTROL_BY_SIM but another applet that it is
not in selectable state is already registered to it.
\- CRRC3: shall throw a ToolkitException with TAR_NOT_DEFINED if event is
FORMATTED_SMS_PP_ENV and the applet has no TAR defined.
\- CRRC4: shall throw a ToolkitException with TAR_NOT_DEFINED if event is
FORMATTED_SMS_PP_UPD and the applet has no TAR defined.
\- CRRC5: shall throw a ToolkitException with TAR_NOT_DEFINED if event is
FORMATTED_SMS_CB and the applet has no TAR defined.
\- CRRC6: shall throw a ToolkitExceptin TAR_NOT_DEFINED if event is
FORMATTED_USSD and the applet has no TAR defined.
##### 5.2.5.3.2 Test area files {#test-area-files-28 .H6}
Test Source: Test_Api_2_Tkr_Sevt.java
Test Applet: Api_2_Tkr_Sevt_1.java
Api_2_Tkr_Sevt_2.java
Api_2_Tkr_Sevt_3.java
The load script installs the 3 instances.
Cap File: Api_2_Tkr_Sevt.cap
##### 5.2.5.3.3 Test coverage {#test-coverage-28 .H6}
* * *
CRR number Test case number N1 1 N2 2, 3 C1 4 C2 5 C3 6 C4 6 C5 6 C6 6
* * *
##### 5.2.5.3.4 Test procedure {#test-procedure-28 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | 1 | Setting events | 1.1- No exception | | | | | shall be thrown. | | | | 1- For events (2 | | | | | to 6, 10 and 24) | 1.2- Shall return | | | | defined in | false. | | | | TS 31.130 [2]: | | | | | | 1.3- No exception | | | | EVENT_FORMA | shall be thrown. | | | | TTED_SMS_PP_ENV | | | | | | 1.4- Shall return | | | | EVENT_FORMA | true. | | | | TTED_SMS_PP_UPD | | | | | | 1.5- No exception | | | | EVENT_UNFORMA | shall be thrown. | | | | TTED_SMS_PP_ENV | | | | | | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_UPD | | | | | | | | | | EVENT_UN | | | | | FORMATTED_SMS_CB | | | | | | | | | | EVENT_ | | | | | MO_SHORT_MESSAGE | | | | | _CONTROL_BY_SIM | | | | | | | | | | EVENT_ | | | | | FORMATTED_SMS_CB | | | | | | | | | | EVEN | | | | | T_FORMATTED_USSD | | | | | | | | | | EVENT\ | | | | | _UNFORMATTED_USSD | | | | | | | | | | EVENT_IWL | | | | | AN_ACCESS_STATUS | | | | | | | | | | 1.1- Call | | | | | clearEvent(event) | | | | | | | | | | 1.2- Call | | | | | isEventSet(event) | | | | | | | | | | 1.3- Call | | | | | setEvent(event) | | | | | | | | | | 1.4- Call | | | | | isEventSet(event) | | | | | | | | | | 1.5- Call | | | | | clearEvent(event) | | | +----+--------------------+--------------------+------------------+ | 2 | Setting | No Exception shall | | | | EVENT_ | be thrown | | | | MO_SHORT_MESSAGE | | | | | _CONTROL_BY_SIM | | | | | | | | | | Call | | | | | setEvent(EVENT_M | | | | | O_SHORT_MESSAGE\ | | | | | _CONTROL_BY_SIM) | | | +----+--------------------+--------------------+------------------+ | 3 | Check applet is | Applet is | | | | triggered by an | triggered by an | | | | ENVELOPE | ENVELOPE | | | | (EVENT_M | (EVENT_M | | | | O_SHORT_MESSAGE\ | O_SHORT_MESSAGE\ | | | | _CONTROL_BY_SIM) | _CONTROL_BY_SIM) | | | | | | | | | Trigger the applet | | | +----+--------------------+--------------------+------------------+ | 4 | Applet2 registers | 2- Shall throw a | | | | to | ToolkitException | | | | EVENT_M | with | | | | O_SHORT_MESSAGE\ | EVENT_A | | | | _CONTROL_BY_SIM\ | LREADY_REGISTERED | | | | but it is already | reason code. | | | | assigned | | | | | | | | | | 1- Trigger Applet2 | | | | | by | | | | | ENVE | | | | | LOPE(EVENT_FORMAT | | | | | TED_SMS_PP_ENV) | | | | | | | | | | 2- Applet2 call | | | | | setEvent(EVENT_M | | | | | O_SHORT_MESSAGE\ | | | | | _CONTROL_BY_SIM) | | | +----+--------------------+--------------------+------------------+ | 5 | Applet2 registers | 2- Shall throw a | | | | to | ToolkitException | | | | EVENT_M | with | | | | O_SHORT_MESSAGE\ | EVENT_A | | | | _CONTROL_BY_SIM\ | LREADY_REGISTERED | | | | but it is already | reason code. | | | | assigned to | | | | | another applet in | | | | | not selectable | | | | | state | | | | | | | | | | 1- Set the Applet1 | | | | | in the lock state | | | | | | | | | | 2- Applet2 call | | | | | setEvent | | | | | (EVENT_M | | | | | O_SHORT_MESSAGE\ | | | | | _CONTROL_BY_SIM) | | | | | | | | | | 3- Set the Applet1 | | | | | in the make | | | | | selectable state | | | +----+--------------------+--------------------+------------------+ | 6 | Applet3 with no | 1- Applet3 shall | | | | TAR defined | be triggered | | | | registers to | | | | | EVENT_UN | 2- | | | | FORMATTED_SMS_CB | ToolkitException | | | | event | with reason code | | | | | TAR_NOT_DEFINED | | | | 1- send | shall be thrown | | | | unformatted | | | | | ENVEL | 3- | | | | OPE(CELL_BROADCAS | ToolkitException | | | | T_DATA_DOWNLOAD) | with reason code | | | | | TAR_NOT_DEFINED | | | | 2- | shall be thrown | | | | setE | | | | | vent(EVENT_FORMAT | 4- | | | | TED_SMS_PP_ENV) | ToolkitException | | | | | with reason code | | | | 3- | TAR_NOT_DEFINED | | | | setE | shall be thrown | | | | vent(EVENT_FORMAT | | | | | TED_SMS_PP_UPD) | 5- | | | | | ToolkitException | | | | 4- | with reason code | | | | setEvent(EVENT_F | | | | | ORMATTED_SMS_CB) | TAR_NOT_DEFINED | | | | | shall be thrown | | | | 5- | | | | | setEvent(EVENT | | | | | _FORMATTED_USSD) | | | +----+--------------------+--------------------+------------------+
#### 5.2.5.4 Method setEventList
Test Area Reference: Api_2_Tkr_Sevl
##### 5.2.5.4.1 Conformance requirement: {#conformance-requirement-27 .H6}
The method with following header shall be compliant to its definition in the
API.
public void setEventList(short[] eventList,
short offset,
short length)
throws java.lang.NullPointerException,
java.lang.ArrayIndexOutOfBoundsException,
ToolkitException,
javacard.framework.TransactionException
##### 5.2.5.4.1.1 Normal execution {#normal-execution-28 .H6}
\- CRRN1: for all events set successfully by this method, a call to
isEventSet() method should return true.
\- CRRN2: the (U)SAT Framework shall trigger the applet if an occurrence of
one of the successfully registered events happens.
##### 5.2.5.4.1.2 Parameter errors {#parameter-errors-25 .H6}
No requirements.
##### 5.2.5.4.1.3 Context errors {#context-errors-28 .H6}
\- CRRC1: shall throw a ToolkitException with EVENT_ALREADY_REGISTERED if
eventList contains EVENT_MO_SHORT_MESSAGE_CONTROL_BY_SIM but another applet is
already registered to it.
\- CRRC2: shall throw a ToolkitException with EVENT_ALREADY_REGISTERED if
event is EVENT_MO_SHORT_MESSAGE_CONTROL_BY_SIM but another applet that it is
not in selectable state is already registered to it.
\- CRRC3: shall throw a ToolkitException with TAR_NOT_DEFINED if event is
FORMATTED_SMS_PP_ENV and the applet has no TAR defined.
\- CRRC4: shall throw a ToolkitException with TAR_NOT_DEFINED if event is
FORMATTED_SMS_PP_UPD and the applet has no TAR defined.
\- CRRC5: shall throw a ToolkitException with TAR_NOT_DEFINED if event is
FORMATTED_SMS_CB and the applet has no TAR defined.
\- CRRC6: shall throw a ToolkitException with TAR_NOT_DEFINED if event is
FORMATTED_USSD and the applet has no TAR defined
##### 5.2.5.4.2 Test area files {#test-area-files-29 .H6}
Test Source: Test_Api_2_Tkr_Sevl.java
Test Applet: Api_2_Tkr_Sevl_1.java
Api_2_Tkr_Sevl_2.java
Cap File: Api_2_Tkr_Sevl.cap
##### 5.2.5.4.3 Test coverage {#test-coverage-29 .H6}
* * *
CRR number Test case number N1 1,2 N2 3, 4 C1 5 C2 6 C3 7 C4 7 C5 7 C6 7
* * *
##### 5.2.5.4.4 Test procedure {#test-procedure-29 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | 1 | Applet1 registers | 1- No exception | | | | all eventList | shall be thrown. | | | | buffer | | | | | | 2- No exception | | | | EventList = events | shall be thrown. | | | | (2 to 6, 10 and | | | | | 24) defined in | 3- Each time shall | | | | TS 31.130 [2]: | return true. | | | | | | | | | EVENT_FORMA | 4- No exception | | | | TTED_SMS_PP_ENV | shall be thrown. | | | | | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_UPD | | | | | | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_UPD | | | | | | | | | | EVENT_UN | | | | | FORMATTED_SMS_CB | | | | | | | | | | EVENT_ | | | | | MO_SHORT_MESSAGE | | | | | _CONTROL_BY_SIM | | | | | | | | | | EVENT_ | | | | | FORMATTED_SMS_CB | | | | | | | | | | EVEN | | | | | T_FORMATTED_USSD | | | | | | | | | | EVENT\ | | | | | _UNFORMATTED_USSD | | | | | | | | | | EV | | | | | ENT_DOWNLOAD_IWL | | | | | AN_ACCESS_STATUS | | | | | | | | | | 1- For each event | | | | | in EventList | | | | | clearEvent(event) | | | | | | | | | | 2- Call | | | | | setEv | | | | | entList(eventList) | | | | | | | | | | Offset = 0 | | | | | | | | | | Length = | | | | | eventList.length | | | | | | | | | | 3- For all events | | | | | in eventList | | | | | isEventSet(event) | | | | | | | | | | 4- For each event | | | | | in EventList | | | | | clearEvent(event) | | | +----+--------------------+--------------------+------------------+ | 2 | Registering part | 1- No exception | | | | of eventList | shall be thrown. | | | | buffer | | | | | | 2- No exception | | | | EventList = events | shall be thrown. | | | | (2 to 6, 10 and | | | | | 24) defined in | 3- Each time shall | | | | TS 31.130 [2]: | return true for | | | | | events ranging | | | | EVENT_FORMA | from offset to | | | | TTED_SMS_PP_ENV | offset+length else | | | | | shall return | | | | EVENT_FORMA | false. | | | | TTED_SMS_PP_UPD | | | | | | 4- No exception | | | | EVENT_UNFORMA | shall be thrown. | | | | TTED_SMS_PP_ENV | | | | | | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_UPD | | | | | | | | | | EVENT_UN | | | | | FORMATTED_SMS_CB | | | | | | | | | | EVENT_ | | | | | MO_SHORT_MESSAGE | | | | | _CONTROL_BY_SIM | | | | | | | | | | EVENT_ | | | | | FORMATTED_SMS_CB | | | | | | | | | | EVEN | | | | | T_FORMATTED_USSD | | | | | | | | | | EVENT\ | | | | | _UNFORMATTED_USSD | | | | | | | | | | EV | | | | | ENT_DOWNLOAD_IWL | | | | | AN_ACCESS_STATUS | | | | | | | | | | 1- For each event | | | | | in EventList | | | | | clearEvent(event) | | | | | | | | | | 2- | | | | | setEv | | | | | entList(eventList, | | | | | offset, length) | | | | | | | | | | Offset > 0 | | | | | | | | | | Length = | | | | | eventList.lentgh | | | | | -- offset | | | | | | | | | | 3- For all events | | | | | in eventList: | | | | | | | | | | > Call | | | | | > | | | | | isEventSet(event) | | | | | | | | | | 4- For each event | | | | | in EventList: | | | | | clearEvent(event) | | | +----+--------------------+--------------------+------------------+ | 3 | Setting | Shall not throw an | | | | EVENT_MO | exception | | | | _SHORT_MESSAGE_ | | | | | CONTROL_BY_SIM | | | | | | | | | | Call | | | | | setEventL | | | | | ist(MonoEventList, | | | | | 0, 1) with | | | | | MonoEventList | | | | | containing | | | | | | | | | | EVENT_ | | | | | MO_SHORT_MESSAGE | | | | | _CONTROL_BY_SIM | | | +----+--------------------+--------------------+------------------+ | 4 | Check applet1 is | Applet is | | | | triggered by an | triggered by an | | | | ENVELOPE | ENVELOPE | | | | (EVENT_MO | (EVENT_M | | | | _SHORT_MESSAGE_ | O_SHORT_MESSAGE\ | | | | CONTROL_BY_SIM) | _CONTROL_BY_SIM) | | | | | | | | | Reset and | | | | | initialize the | | | | | card | | | | | | | | | | Trigger the applet | | | +----+--------------------+--------------------+------------------+ | 5 | Applet 2 registers | Shall throw a | | | | to | ToolkitException | | | | EVENT_MO | with | | | | _SHORT_MESSAGE_ | EVENT_A | | | | CONTROL_BY_SIM\ | LREADY_REGISTERED | | | | but it is already | reason code. | | | | assigned | | | | | | | | | | Call | | | | | setEventList( | | | | | MonoEventList,0,1) | | | | | with MonoEventList | | | | | containing | | | | | EVENT_ | | | | | MO_SHORT_MESSAGE | | | | | _CONTROL_BY_SIM | | | +----+--------------------+--------------------+------------------+ | 6 | Applet2 registers | 2- Shall throw a | | | | to | ToolkitException | | | | EVENT_M | with | | | | O_SHORT_MESSAGE\ | EVENT_A | | | | _CONTROL_BY_SIM\ | LREADY_REGISTERED | | | | but it is already | reason code. | | | | assigned to | | | | | another applet in | | | | | not selectable | | | | | state | | | | | | | | | | 1- Set the Applet1 | | | | | in the lock state | | | | | | | | | | 2- Applet2 calls | | | | | setEventList( | | | | | MonoEventList,0,1) | | | | | with MonoEventList | | | | | containing | | | | | EVENT_ | | | | | MO_SHORT_MESSAGE | | | | | _CONTROL_BY_SIM | | | | | | | | | | 3- Set the Applet1 | | | | | in the make | | | | | selectable state | | | +----+--------------------+--------------------+------------------+ | 7 | Applet3 with no | 1- Applet3 shall | | | | TAR defined | be triggered | | | | registers to | | | | | EVENT_UN | 2- | | | | FORMATTED_SMS_CB | ToolkitException | | | | event | with reason code | | | | | TAR_NOT_DEFINED | | | | 1- send | shall be thrown | | | | unformatted | | | | | ENVEL | 3- | | | | OPE(CELL_BROADCAS | ToolkitException | | | | T_DATA_DOWNLOAD) | with reason code | | | | | TAR_NOT_DEFINED | | | | 2- | shall be thrown | | | | setEventL | | | | | ist(EventList,0,1) | 4- | | | | with EventList | ToolkitException | | | | containing | with reason code | | | | EVENT_FORMA | TAR_NOT_DEFINED | | | | TTED_SMS_PP_ENV | shall be thrown | | | | | | | | | 3- setEventList | 5- method shall | | | | (EventList,1,1) | return FALSE | | | | with EventList | | | | | containing | 6- method shall | | | | EVENT_FORMA | return FALSE | | | | TTED_SMS_PP_UPD | | | | | | 7- method shall | | | | 4- setEventList | return FALSE | | | | (EventList,2,1) | | | | | with EventList | 8- method shall | | | | containing | return FALSE | | | | EVENT_ | | | | | FORMATTED_SMS_CB | | | | | | | | | | 5- | | | | | isEven | | | | | tSet(EVENT_FORMAT | | | | | TED_SMS_PP_ENV) | | | | | | | | | | 6- | | | | | isEven | | | | | tSet(EVENT_FORMAT | | | | | TED_SMS_PP_UPD) | | | | | | | | | | 7- | | | | | i | | | | | sEventSet(EVENT_F | | | | | ORMATTED_SMS_CB) | | | | | | | | | | 8- | | | | | isEventSet(EVENT | | | | | _FORMATTED_USSD) | | | +----+--------------------+--------------------+------------------+
## 5.3 (U)SAT Framework
### 5.3.1 Minimum handler availability
#### 5.3.1.1 ProactiveHandler
Test Area Reference: Ufw_Mha_Pahd
##### 5.3.1.1.1 Conformance requirements {#conformance-requirements-2 .H6}
##### 5.3.1.1.1.1 Normal execution {#normal-execution-29 .H6}
\- CRRN1: If a proactive session is not ongoing the _ProactiveHandler_ is
available from the invocation to the termination of the _processToolkit()_
method for the following events:
EVENT_FORMATTED_SMS_PP_ENV
EVENT_FORMATTED_SMS_PP_UPD
EVENT_UNFORMATTED_SMS_PP_ENV
EVENT_UNFORMATTED_SMS_PP_UPD
EVENT_UNFORMATTED_SMS_CB
EVENT_MO_SHORT_MESSAGE_CONTROL_BY_SIM
EVENT_FORMATTED_SMS_CB
EVENT_FORMATTED_USSD
EVENT_UNFORMATTED_USSD
EVENT_DOWNLOAD_IWLAN_ACCESS_STATUS
\- CRRN2: A _ProactiveHandler_ is considered available when no
HANDLER_NOT_AVAILABLE _ToolkitException_ is thrown when the corresponding
_getTheHandler()_ method is called or a method of the handler is called.
\- CRRN3: When available the _ProactiveHandler_ shall remain available until
the termination of the _processToolkit()_ method.
\- CRRN4: If a proactive command is pending the _ProactiveHandler_ may not be
available.
##### 5.3.1.1.1.2 Parameter errors {#parameter-errors-26 .H6}
No requirements.
##### 5.3.1.1.1.3 Context errors {#context-errors-29 .H6}
\- CRRC1: The _ProactiveHandler_ shall not be available if the Terminal
Profile command has not yet been processed by the (U)SAT Framework.
##### 5.3.1.1.2 Test area files {#test-area-files-30 .H6}
Test Source: Test_Ufw_Mha_Pahd.java
Test Applet: Ufw_Mha_Pahd_1.java
Ufw_Mha_Pahd_2.java
Cap File: Ufw_Mha_Pahd.cap
##### 5.3.1.1.3 Test coverage {#test-coverage-30 .H6}
* * *
CRR Number Test Case Number N1 1 to 10 N2 11 to 20 N3 1 to 11 N4 Not testable
C1 12 to 17 and also tested in Test Cases 8 to 14 in Ufw_Mha_Prhd. Applicable
only if the applet is triggerred when no terminal profile has been previously
received.
* * *
##### 5.3.1.1.4 Test procedure {#test-procedure-30 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | 1 | ProactiveHandler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_FORMA | | | | | TTED_SMS_PP_ENV | 2- No exception is | | | | | thrown. | | | | 1- Envelope SMS-PP | | | | | Download formatted | Applet1 finalizes | | | | is sent to the | | | | | (U)SIM | | | | | | | | | | 2- Applet1 gets | | | | | the | | | | | ProactiveHandler | | | +----+--------------------+--------------------+------------------+ | 2 | ProactiveHandler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_FORMA | | | | | TTED_SMS_PP_UPD | 2- No exception is | | | | | thrown. | | | | 1- Update Record | | | | | EF~SMS~ | Applet1 finalizes | | | | instruction | | | | | formatted is sent | | | | | to the (U)SIM | | | | | | | | | | 2- Applet1 gets | | | | | the | | | | | ProactiveHandler | | | +----+--------------------+--------------------+------------------+ | 3 | ProactiveHandler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | 2- No exception is | | | | | thrown. | | | | 1- Envelope SMS-PP | | | | | Download | Applet1 finalizes | | | | unformatted is | | | | | sent to the (U)SIM | Applet2 is | | | | | triggered | | | | 2- Applet1 gets | | | | | the | 3- No exception is | | | | ProactiveHandler | thrown. | | | | | | | | | 3- Applet2 gets | | | | | the | | | | | ProactiveHandler | | | +----+--------------------+--------------------+------------------+ | 4 | ProactiveHandler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_UPD | 2- No exception is | | | | | thrown. | | | | 1- Update Record | | | | | EF~SMS~ | Applet1 finalizes | | | | instruction | | | | | unformatted is | 3- Applet2 is | | | | sent to the (U)SIM | triggered | | | | | | | | | 2- Applet1 gets | 4- No exception is | | | | the | thrown. | | | | ProactiveHandler | | | | | | | | | | 3- Applet2 gets | | | | | the | | | | | ProactiveHandler | | | +----+--------------------+--------------------+------------------+ | 5 | ProactiveHandler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_UN | | | | | FORMATTED_SMS_CB | 2- No exception is | | | | | thrown | | | | 1- Envelope Cell | | | | | Broadcast Download | Applet1 finalizes | | | | unformatted is | | | | | sent to the (U)SIM | Applet2 is | | | | | triggered | | | | 2- Applet1 gets | | | | | the | 3- No exception is | | | | ProactiveHandler | thrown | | | | | | | | | 3- Applet2 gets | | | | | the | | | | | ProactiveHandler | | | +----+--------------------+--------------------+------------------+ | 6 | ProactiveHandler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_ | | | | | MO_SHORT_MESSAGE | 2- No exception is | | | | _CONTROL_BY_SIM | thrown | | | | | | | | | 1- Envelope MO | | | | | short message | | | | | control by SIM is | | | | | sent to the (U)SIM | | | | | | | | | | 2- Applet1 gets | | | | | the | | | | | ProactiveHandler | | | +----+--------------------+--------------------+------------------+ | 7 | ProactiveHandler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_ | | | | | FORMATTED_SMS_CB | 2-No exception is | | | | | thrown | | | | 1- Envelope Cell | | | | | Broadcast Download | Applet1 finalizes | | | | formatted is sent | | | | | to the (U)SIM | | | | | | | | | | 2- Applet1 gets | | | | | the | | | | | ProactiveHandler | | | +----+--------------------+--------------------+------------------+ | 8 | ProactiveHandler | 1- Applet1 is | | | | availability with | triggered | | | | EVEN | | | | | T_FORMATTED_USSD | 2- No exception is | | | | | thrown. | | | | 1- Envelope USSD | | | | | formatted is sent | Applet1 finalizes | | | | to the (U)SIM | | | | | | | | | | 2- Applet1 gets | | | | | the | | | | | ProactiveHandler | | | +----+--------------------+--------------------+------------------+ | 9 | ProactiveHandler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT\ | | | | | _UNFORMATTED_USSD | 2- No exception is | | | | | thrown. | | | | 1- Envelope USSD | | | | | unformatted is | Applet1 finalizes | | | | sent to the (U)SIM | | | | | | Applet2 is | | | | 2- Applet1 gets | triggered | | | | the | | | | | ProactiveHandler | 3- No exception is | | | | | thrown. | | | | 3- Applet2 gets | | | | | the | | | | | ProactiveHandler | | | +----+--------------------+--------------------+------------------+ | 10 | ProactiveHandler | Applet1 is | | | | availability with | triggered | | | | EV | | | | | ENT_DOWNLOAD_IWL | 2- No exception is | | | | AN_ACCESS_STATUS | thrown. | | | | | | | | | 1- Envelope | Applet1 finalizes | | | | DOWNLOAD_IWL | | | | | AN_ACCESS_STATUS | Applet2 is | | | | is sent to the | triggered | | | | (U)SIM | | | | | | 3- No exception is | | | | 2- Applet1 gets | thrown. | | | | the | | | | | ProactiveHandler | | | | | | | | | | **3- Applet2 | | | | | gets** the | | | | | ** | | | | | ProactiveHandler** | | | +----+--------------------+--------------------+------------------+ | 11 | The | 2- Applet1 is | | | | ProactiveHandler | triggered | | | | is not available | | | | | before the | 3- A | | | | Terminal Profile | ToolkitException | | | | with | HANDL | | | | EVENT_FORMA | ER_NOT_AVAILABLE | | | | TTED_SMS_PP_ENV | is thrown | | | | | | | | | 1- Reset the card | Applet1 finalizes | | | | without sending | | | | | the Terminal | | | | | Profile | | | | | | | | | | 2- Envelope SMS-PP | | | | | Download formatted | | | | | is sent to the | | | | | (U)SIM | | | | | | | | | | 3- Applet1 gets | | | | | the | | | | | ProactiveHandler | | | +----+--------------------+--------------------+------------------+ | 12 | The | 1- Applet1 is | | | | ProactiveHandler | triggered | | | | is not available | | | | | before the | 2- A | | | | Terminal Profile | ToolkitException | | | | with | HANDL | | | | EVENT_FORMA | ER_NOT_AVAILABLE | | | | TTED_SMS_PP_UPD | is thrown | | | | | | | | | 1- Update Record | Applet1 finalizes | | | | EF~SMS~ | | | | | instruction | | | | | formatted is sent | | | | | to the (U)SIM | | | | | | | | | | 2- Applet1 gets | | | | | the | | | | | ProactiveHandler | | | +----+--------------------+--------------------+------------------+ | 13 | The | 1- Applet1 is | | | | ProactiveHandler | triggered | | | | is not available | | | | | before the | 2- A | | | | Terminal Profile | ToolkitException | | | | with | HANDL | | | | EVENT_UNFORMA | ER_NOT_AVAILABLE | | | | TTED_SMS_PP_ENV | is thrown | | | | | | | | | 1- Envelope SMS-PP | Applet1 finalizes | | | | Download | | | | | unformatted is | Applet2 is | | | | sent to the (U)SIM | triggered | | | | | | | | | 2- Applet1 gets | 3- A | | | | the | ToolkitException | | | | ProactiveHandler | HANDL | | | | | ER_NOT_AVAILABLE | | | | 3- Applet2 gets | is thrown | | | | the | | | | | ProactiveHandler | Applet2 finalizes | | +----+--------------------+--------------------+------------------+ | 14 | The | 1- Applet1 is | | | | ProactiveHandler | triggered | | | | is not available | | | | | before the | 2- A | | | | Terminal Profile | ToolkitException | | | | with | HANDL | | | | EVENT_UNFORMA | ER_NOT_AVAILABLE | | | | TTED_SMS_PP_UPD | is thrown | | | | | | | | | 1- Update Record | Applet1 finalizes | | | | EF~SMS~ | | | | | instruction | Applet2 is | | | | unformatted is | triggered | | | | sent to the (U)SIM | | | | | | 3- A | | | | 2- Applet1 gets | ToolkitException | | | | the | HANDL | | | | ProactiveHandler | ER_NOT_AVAILABLE | | | | | is thrown | | | | 3- Applet2 gets | | | | | the | Applet2 finalizes | | | | ProactiveHandler | | | +----+--------------------+--------------------+------------------+ | 15 | The | 1- Applet1 is | | | | ProactiveHandler | triggered | | | | is not available | | | | | before the | 2- A | | | | Terminal Profile | ToolkitException | | | | with | HANDL | | | | EVENT_UN | ER_NOT_AVAILABLE | | | | FORMATTED_SMS_CB | is thrown | | | | | | | | | 1- Envelope Cell | Applet1 finalizes | | | | Broadcast Download | | | | | unformatted is | Applet2 is | | | | sent to the (U)SIM | triggered | | | | | | | | | 2- Applet1 gets | 3- A | | | | the | ToolkitException | | | | ProactiveHandler | HANDL | | | | | ER_NOT_AVAILABLE | | | | 3- Applet2 gets | is thrown | | | | the | | | | | ProactiveHandler | Applet2 finalizes | | +----+--------------------+--------------------+------------------+ | 16 | The | 1- Applet1 is | | | | ProactiveHandler | triggered | | | | is not available | | | | | before the | 2- A | | | | Terminal Profile | ToolkitException | | | | with | HANDL | | | | EVENT_ | ER_NOT_AVAILABLE | | | | MO_SHORT_MESSAGE | is thrown | | | | _CONTROL_BY_SIM | | | | | | Applet1 finalizes | | | | 1- Envelope MO | | | | | short message | | | | | control by SIM is | | | | | sent to the (U)SIM | | | | | | | | | | 2- Applet1 gets | | | | | the | | | | | ProactiveHandler | | | +----+--------------------+--------------------+------------------+ | 17 | The | 1- Applet1 is | | | | ProactiveHandler | triggered | | | | is not available | | | | | before the | 2- A | | | | Terminal Profile | ToolkitException | | | | with | HANDL | | | | EVENT_ | ER_NOT_AVAILABLE | | | | FORMATTED_SMS_CB | is thrown | | | | | | | | | 1- Envelope Cell | Applet1 finalizes | | | | Broadcast Download | | | | | formatted is sent | | | | | to the (U)SIM | | | | | | | | | | 2- Applet1 gets | | | | | the | | | | | ProactiveHandler | | | +----+--------------------+--------------------+------------------+ | 18 | The | 1- Applet1 is | | | | ProactiveHandler | triggered | | | | is not available | | | | | before the | 2- A | | | | Terminal Profile | ToolkitException | | | | with | HANDL | | | | EVEN | ER_NOT_AVAILABLE | | | | T_FORMATTED_USSD | is thrown | | | | | | | | | 1- Envelpe USSD | Applet1 finalizes | | | | formatted is sent | | | | | to the (U)SIM | | | | | | | | | | 2- Applet gets the | | | | | ProactiveHandler | | | +----+--------------------+--------------------+------------------+ | 19 | The | 1- Applet1 is | | | | ProactiveHandler | triggered | | | | is not available | | | | | before the | 2- A | | | | Terminal Profile | ToolkitException | | | | with | HANDL | | | | EVENT\ | ER_NOT_AVAILABLE | | | | _UNFORMATTED_USSD | is thrown | | | | | | | | | 1- Envelope USSD | Applet1 finalizes | | | | unformatted is | | | | | sent to the (U)SIM | Applet2 is | | | | | triggered | | | | 2- Applet1 gets | | | | | the | 3- A | | | | ProactiveHandler | ToolkitException | | | | | HANDL | | | | 3- Applet2 gets | ER_NOT_AVAILABLE | | | | the | is thrown | | | | ProactiveHandler | | | | | | Applet2 finalizes | | +----+--------------------+--------------------+------------------+ | 20 | The | 1- Applet1 is | | | | ProactiveHandler | triggered | | | | is not available | | | | | befor the Terminal | 2- A | | | | Profile with | ToolkitException | | | | EV | HANDL | | | | ENT_DOWNLOAD_IWL | ER_NOT_AVAILABLE | | | | NA_ACCESS_STATUS | is thrown | | | | | | | | | 1- Envelope | Applet1 finalizes | | | | Download Iwlan | | | | | Access Status h n | Applet2 is | | | | is sent to the | triggered | | | | (U)SIM | | | | | | 3- A | | | | 2- Applet1 gets | ToolkitException | | | | the | HANDL | | | | ProactiveHandler | ER_NOT_AVAILABLE | | | | | is thrown | | | | 3- Applet2 gets | | | | | the | Applet2 finalizes | | | | ProactiveHandler | | | +----+--------------------+--------------------+------------------+
#### 5.3.1.2 ProactiveResponseHandler
Test Area Reference: Ufw_Mha_Prhd
##### 5.3.1.2.1 Conformance requirements {#conformance-requirements-3 .H6}
##### 5.3.1.2.1.1 Normal execution {#normal-execution-30 .H6}
\- CRRN1: The _ProactiveResponseHandler_ is available as soon as the
_ProactiveHandler_ is available and remains available until the termination of
the _processToolkit()_ method for the following events:
EVENT_FORMATTED_SMS_PP_ENV
EVENT_FORMATTED_SMS_PP_UPD
EVENT_UNFORMATTED_SMS_PP_ENV
EVENT_UNFORMATTED_SMS_PP_UPD
EVENT_UNFORMATTED_SMS_CB
EVENT_MO_SHORT_MESSAGE_CONTROL_BY_SIM
EVENT_FORMATTED_SMS_CB
EVENT_FORMATTED_USSD
EVENT_UNFORMATTED_USSD
EVENT_DOWNLOAD_IWLAN_ACCESS_STATUS
\- CRRN2: A _ProactiveResponseHandler_ is considered available when no
HANDLER_NOT_AVAILABLE ToolkitException is thrown when the corresponding
_getTheHandler()_ method is called or a method of the handler is called.
##### 5.3.1.2.1.2 Parameter errors {#parameter-errors-27 .H6}
No requirements.
##### 5.3.1.2.1.3 Context errors {#context-errors-30 .H6}
\- CRRC1: The _ProactiveResponseHandler_ shall not be available if the
_ProactiveHandler_ is not available.
##### 5.3.1.2.2 Test area files {#test-area-files-31 .H6}
Test Source: Test_Ufw_Mha_Prhd.java
Test Applet: Ufw_Mha_Prhd_1.java
Ufw_Mha_Prhd_2.java
Cap File: Ufw_Mha_Prhd.cap
##### 5.3.1.2.3 Test coverage {#test-coverage-31 .H6}
+------------+--------------------------------------------------------+ | CRR Number | Test Case Number | +------------+--------------------------------------------------------+ | N1 | 1 to 10 | +------------+--------------------------------------------------------+ | N2 | 1 to 20 | +------------+--------------------------------------------------------+ | C1 | 8 to 20. | | | | | | Applicable only if the applet is triggerred when no | | | terminal profile has been previously received. | +------------+--------------------------------------------------------+
##### 5.3.1.2.4 Test procedure {#test-procedure-31 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+--------------------+ | 1 | Proact | 1- Applet1 is | 2- A proactive | | | iveResponseHandler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EVENT_FORMA | 3- No exception is | | | | TTED_SMS_PP_ENV | thrown | TERMINAL RESPONSE | | | | | | | | 1- Envelope SMS-PP | | | | | Download formatted | | | | | is sent to the | | | | | (U)SIM | | | | | | | | | | Applet builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 2- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 2 | Proact | 1- Applet1 is | 2- A proactive | | | iveResponseHandler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EVENT_FORMA | 3- No exception is | | | | TTED_SMS_PP_UPD | thrown | TERMINAL RESPONSE | | | | | | | | 1- Update Record | | | | | EF~SMS~ | | | | | instruction | | | | | formatted is sent | | | | | to the (U)SIM | | | | | | | | | | Applet builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 2- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 3 | Proact | 1- Applet1 is | 2- A proactive | | | iveResponseHandler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EVENT_UNFORMA | 3- No exception is | | | | TTED_SMS_PP_ENV | thrown | TERMINAL RESPONSE | | | | | | | | 1- Envelope SMS-PP | Applet1 finalizes | 4- A proactive | | | Download | | command DISPLAY | | | unformatted is | Applet2 is | TEXT is fetched | | | sent to the (U)SIM | triggered | | | | | | TERMINAL RESPONSE | | | Applet1 builds a | 5- No exception is | | | | proactive command | thrown | | | | DISPLAY TEXT | | | | | | | | | | 2- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | Applet2 builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 4- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 5- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 4 | Proact | 1- Applet1 is | 2- A proactive | | | iveResponseHandler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EVENT_UNFORMA | 3- No exception is | | | | TTED_SMS_PP_UPD | thrown | TERMINAL RESPONSE | | | | | | | | 1- Update Record | Applet1 finalizes | 4- A proactive | | | EF~SMS~ | | command DISPLAY | | | instruction | Applet2 is | TEXT is fetched | | | unformatted is | triggered | | | | sent to the (U)SIM | | TERMINAL RESPONSE | | | | 5- No exception is | | | | Applet1 builds a | thrown | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 2- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | Applet2 builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 4- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 5- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 5 | Proact | 1- Applet1 is | 2- A proactive | | | iveResponseHandler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EVENT_UN | 3- No exception is | | | | FORMATTED_SMS_CB | thrown | TERMINAL RESPONSE | | | | | | | | 1- Envelope Cell | Applet1 finalizes | 4- A proactive | | | Broadcast Download | | command DISPLAY | | | unformatted is | Applet2 is | TEXT is fetched | | | sent to the (U)SIM | triggered | | | | | | TERMINAL RESPONSE | | | Applet1 builds a | 5- No exception is | | | | proactive command | thrown | | | | DISPLAY TEXT | | | | | | | | | | 2- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called. | | | | | | | | | | Applet2 builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 4- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 5- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 6 | Proact | 1- Applet1 is | 2- A proactive | | | iveResponseHandler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EVENT_ | 3- No exception is | | | | MO_SHORT_MESSAGE | thrown | TERMINAL RESPONSE | | | _CONTROL_BY_SIM | | | | | | | | | | 1- Envelope MO | | | | | short message | | | | | control by SIM is | | | | | sent to the (U)SIM | | | | | | | | | | Applet builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 2- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 7 | Proact | 1- Applet1 is | 2- A proactive | | | iveResponseHandler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EVENT_ | 3- No exception is | | | | FORMATTED_SMS_CB | thrown | TERMINAL RESPONSE | | | | | | | | 1- Envelope Cell | | | | | Broadcast Download | | | | | formatted is sent | | | | | to the (U)SIM | | | | | | | | | | Applet1 builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 2- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called. | | | +----+--------------------+--------------------+--------------------+ | 8 | Proact | 1- Applet1 is | 2- A proactive | | | iveResponseHandler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EVEN | 3- No exception is | | | | T_FORMATTED_USSD | thrown | TERMINAL RESPONSE | | | | | | | | 1- Envelope USSD | | | | | formatted is sent | | | | | to the (U)SIM | | | | | | | | | | Applet builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 2- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 9 | Proact | 1- Applet1 is | 2- A proactive | | | iveResponseHandler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | | 3- No exception is | | | | EVENT\ | thrown | TERMINAL RESPONSE | | | _UNFORMATTED_USSD | | | | | | Applet1 finalizes | 4- A proactive | | | 1- Envelope USSD | | command DISPLAY | | | unformatted is | Applet2 is | TEXT is fetched | | | sent to the (U)SIM | triggered | | | | | | TERMINA RESPONSE | | | Applet1 builds a | 5- No exception is | | | | proactive command | thrown | | | | DISPLAY TEXT | | | | | | | | | | 2- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 4- Applet2 builds | | | | | a proactive | | | | | command DISPLAY | | | | | TEXT | | | | | | | | | | 4- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 5- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 10 | Proact | 1- Applet1 is | 2- A proactive | | | iveResponseHandler | triggered | command DISPLAY | | | availability with | | TEXT is fetched | | | EV | 3- No exception is | | | | ENT_DOWNLOAD_IWL | thrown | TERMINAL RESPONSE | | | AN_ACCESS_STATUS | | | | | | Applet1 finalizes | 4- A proactive | | | 1- Envelope USSD | | command DISPLAY | | | unformatted is | Applet2 is | TEXT is fetched | | | sent to the (U)SIM | triggered | | | | | | TERMINAL RESPONSE | | | Applet1 builds a | | | | | proactive command | | | | | DISPLAY TEXT | | | | | | | | | | 2- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 3- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 4- Applet2 builds | | | | | a proactive | | | | | command DISPLAY | | | | | TEXT | | | | | | | | | | 4- | | | | | Proac | | | | | tiveHandler.send() | | | | | method is called | | | | | | | | | | 5- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | +----+--------------------+--------------------+--------------------+ | 11 | The | 2- Applet1 is | | | | ProactiveHandler | triggered | | | | is not available | | | | | before the | 3- A | | | | Terminal Profile | ToolkitException | | | | with | HANDL | | | | EVENT_FORMA | ER_NOT_AVAILABLE | | | | TTED_SMS_PP_ENV | is thrown | | | | | | | | | 1- Reset the card | 4- A | | | | without sending | ToolkitException | | | | the Terminal | HANDL | | | | Profile | ER_NOT_AVAILABLE | | | | | is thrown | | | | 2- Envelope SMS-PP | | | | | Download formatted | Applet1 finalizes | | | | is sent is sent to | | | | | the (U)SIM | | | | | | | | | | 3- Applet1 gets | | | | | the | | | | | ProactiveHandler | | | | | | | | | | 4- Applet1 gets | | | | | the | | | | | Proact | | | | | iveResponseHandler | | | +----+--------------------+--------------------+--------------------+ | 12 | The | 1- Applet1 is | | | | ProactiveHandler | triggered | | | | is not available | | | | | before the | 2- A | | | | Terminal Profile | ToolkitException | | | | with | HANDL | | | | EVENT_FORMA | ER_NOT_AVAILABLE | | | | TTED_SMS_PP_UPD | is thrown | | | | | | | | | 1- Update Record | 3- A | | | | EF~SMS~ | ToolkitException | | | | instruction | HANDL | | | | formatted is sent | ER_NOT_AVAILABLE | | | | to the (U)SIM | is thrown | | | | | | | | | 2- Applet1 gets | Applet1 finalizes | | | | the | | | | | ProactiveHandler | | | | | | | | | | 3- Applet1 gets | | | | | the | | | | | Proact | | | | | iveResponseHandler | | | +----+--------------------+--------------------+--------------------+ | 13 | The | 1- Applet1 is | | | | ProactiveHandler | triggered | | | | is not available | | | | | before the | 2- A | | | | Terminal Profile | ToolkitException | | | | with | HANDL | | | | EVENT_UNFORMA | ER_NOT_AVAILABLE | | | | TTED_SMS_PP_ENV | is thrown | | | | | | | | | 1- Envelope SMS-PP | 3- A | | | | Download | ToolkitException | | | | unformatted is | HANDL | | | | sent to the (U)SIM | ER_NOT_AVAILABLE | | | | | is thrown | | | | 2- Applet1 gets | | | | | the | Applet1 finalizes | | | | ProactiveHandler | | | | | | Applet2 is | | | | 3- Applet1 gets | triggered | | | | the | | | | | Proact | 4- A | | | | iveResponseHandler | ToolkitException | | | | | HANDL | | | | 4- Applet2 gets | ER_NOT_AVAILABLE | | | | the | is thrown | | | | ProactiveHandler | | | | | | 5- A | | | | 5- Applet2 gets | ToolkitException | | | | the | HANDL | | | | Proact | ER_NOT_AVAILABLE | | | | iveResponseHandler | is thrown | | | | | | | | | | Applet2 finalizes | | +----+--------------------+--------------------+--------------------+ | 14 | The | 1- Applet1 is | | | | ProactiveHandler | triggered | | | | is not available | | | | | before the | 2- A | | | | Terminal Profile | ToolkitException | | | | with | HANDL | | | | EVENT_UNFORMA | ER_NOT_AVAILABLE | | | | TTED_SMS_PP_UPD | is thrown | | | | | | | | | 1- Update Record | 3- A | | | | EF~SMS~ | ToolkitException | | | | instruction | HANDL | | | | unformatted is | ER_NOT_AVAILABLE | | | | sent to the (U)SIM | is thrown | | | | | | | | | 2- Applet1 gets | Applet1 finalizes | | | | the | | | | | ProactiveHandler | Applet2 is | | | | | triggered | | | | 3- Applet1 gets | | | | | the | 4- A | | | | Proact | ToolkitException | | | | iveResponseHandler | HANDL | | | | | ER_NOT_AVAILABLE | | | | 4- Applet2 gets | is thrown | | | | the | | | | | ProactiveHandler | 5- A | | | | | ToolkitException | | | | 5- Applet2 gets | HANDL | | | | the | ER_NOT_AVAILABLE | | | | Proact | is thrown | | | | iveResponseHandler | | | | | | Applet2 finalizes | | +----+--------------------+--------------------+--------------------+ | 15 | The | 1- Applet1 is | | | | ProactiveHandler | triggered | | | | is not available | | | | | before the | 2- A | | | | Terminal Profile | ToolkitException | | | | with | HANDL | | | | EVENT_UN | ER_NOT_AVAILABLE | | | | FORMATTED_SMS_CB | is thrown | | | | | | | | | 1- Envelope Cell | 3- A | | | | Broadcast Download | ToolkitException | | | | unformatted is | HANDL | | | | sent to the (U)SIM | ER_NOT_AVAILABLE | | | | | is thrown | | | | 2- Applet1 gets | | | | | the | Applet1 finalizes | | | | ProactiveHandler | | | | | | Applet2 is | | | | 3- Applet1 gets | triggered | | | | the | | | | | Proact | 4- A | | | | iveResponseHandler | ToolkitException | | | | | HANDL | | | | 4- Applet2 gets | ER_NOT_AVAILABLE | | | | the | is thrown | | | | ProactiveHandler | | | | | | 5- A | | | | 5- Applet2 gets | ToolkitException | | | | the | HANDL | | | | Proact | ER_NOT_AVAILABLE | | | | iveResponseHandler | is thrown | | | | | | | | | | Applet2 finalizes | | +----+--------------------+--------------------+--------------------+ | 16 | The | 1- Applet1 is | | | | ProactiveHandler | triggered | | | | is not available | | | | | before the | 2- A | | | | Terminal Profile | ToolkitException | | | | with | HANDL | | | | EVENT_ | ER_NOT_AVAILABLE | | | | MO_SHORT_MESSAGE | is thrown | | | | _CONTROL_BY_SIM | | | | | | 3- A | | | | 1- Envelope MO | ToolkitException | | | | short message | HANDL | | | | control by SIM is | ER_NOT_AVAILABLE | | | | sent to the (U)SIM | is thrown | | | | | | | | | 2- Applet1 gets | Applet1 finalizes | | | | the | | | | | ProactiveHandler | | | | | | | | | | 3- Applet1 gets | | | | | the | | | | | Proact | | | | | iveResponseHandler | | | +----+--------------------+--------------------+--------------------+ | 17 | The | 1- Applet1 is | | | | ProactiveHandler | triggered | | | | is not available | | | | | before the | 2- A | | | | Terminal Profile | ToolkitException | | | | with | HANDL | | | | EVENT_ | ER_NOT_AVAILABLE | | | | FORMATTED_SMS_CB | is thrown | | | | | | | | | 1- Envelope Cell | 3- A | | | | Broadcast Download | ToolkitException | | | | formatted is sent | HANDL | | | | to the (U)SIM | ER_NOT_AVAILABLE | | | | | is thrown | | | | 2- Applet1 gets | | | | | the | Applet1 finalizes | | | | ProactiveHandler | | | | | | | | | | 3- Applet1 gets | | | | | the | | | | | Proact | | | | | iveResponseHandler | | | +----+--------------------+--------------------+--------------------+ | 18 | The | 1- Applet1 is | | | | ProactiveHandler | triggered | | | | is not available | | | | | before the | 2- A | | | | Terminal Profile | ToolkitException | | | | with | HANDL | | | | EVEN | ER_NOT_AVAILABLE | | | | T_FORMATTED_USSD | is thrown | | | | | | | | | 1- Envelope USSD | 3- A | | | | formatted is sent | ToolkitException | | | | is sent to the | HANDL | | | | (U)SIM | ER_NOT_AVAILABLE | | | | | is thrown | | | | 2- Applet1 gets | | | | | the | Applet1 finalizes | | | | ProactiveHandler | | | | | | | | | | 3- Applet1 gets | | | | | the | | | | | Proact | | | | | iveResponseHandler | | | +----+--------------------+--------------------+--------------------+ | 19 | The | 1- Applet1 is | | | | ProactiveHandler | triggered | | | | is not available | | | | | before the | 2- A | | | | Terminal Profile | ToolkitException | | | | with | HANDL | | | | EVENT\ | ER_NOT_AVAILABLE | | | | _UNFORMATTED_USSD | is thrown | | | | | | | | | 1- Envelope USSD | 3- A | | | | unformatted is | ToolkitException | | | | sent to the (U)SIM | HANDL | | | | | ER_NOT_AVAILABLE | | | | 2- Applet1 gets | is thrown | | | | the | | | | | ProactiveHandler | Applet1 finalizes | | | | | | | | | 3- Applet1 gets | Applet2 is | | | | the | triggered | | | | Proact | | | | | iveResponseHandler | 4- A | | | | | ToolkitException | | | | 4- Applet2 gets | HANDL | | | | the | ER_NOT_AVAILABLE | | | | ProactiveHandler | is thrown | | | | | | | | | 5- Applet2 gets | 5- A | | | | the | ToolkitException | | | | Proact | HANDL | | | | iveResponseHandler | ER_NOT_AVAILABLE | | | | | is thrown | | | | | | | | | | Applet2 finalizes | | +----+--------------------+--------------------+--------------------+ | 20 | The | 1- Applet1 is | | | | ProactiveHandler | triggered | | | | is not available | | | | | before the | 2- A | | | | Terminal Profile | ToolkitException | | | | with | HANDL | | | | EV | ER_NOT_AVAILABLE | | | | ENT_DOWNLOAD_IWL | is thrown | | | | AN_ACCESS_STATUS | | | | | | 3- A | | | | 1- Envelope | ToolkitException | | | | Download Iwlan | HANDL | | | | Access Status is | ER_NOT_AVAILABLE | | | | sent to the (U)SIM | is thrown | | | | | | | | | 2- Applet1 gets | Applet1 finalizes | | | | the | | | | | ProactiveHandler | Applet2 is | | | | | triggered | | | | 3- Applet1 gets | | | | | the | 4- A | | | | Proact | ToolkitException | | | | iveResponseHandler | HANDL | | | | | ER_NOT_AVAILABLE | | | | 4- Applet2 gets | is thrown | | | | the | | | | | ProactiveHandler | 5- A | | | | | ToolkitException | | | | 5- Applet2 gets | HANDL | | | | the | ER_NOT_AVAILABLE | | | | Proact | is thrown | | | | iveResponseHandler | | | | | | Applet2 finalizes | | +----+--------------------+--------------------+--------------------+
#### 5.3.1.3 EnvelopeHandler
Test Area Reference: Ufw_Mha_Enhd
##### 5.3.1.3.1 Conformance requirements {#conformance-requirements-4 .H6}
##### 5.3.1.3.1.1 Normal execution {#normal-execution-31 .H6}
\- CRRN1: The _EnvelopeHandler_ and its content are available for all toolkit
applets triggered from the invocation to the termination of their
_processToolkit()_ method for the following events:
EVENT_FORMATTED_SMS_PP_ENV
EVENT_FORMATTED_SMS_PP_UPD
EVENT_UNFORMATTED_SMS_PP_ENV
EVENT_UNFORMATTED_SMS_PP_UPD
EVENT_UNFORMATTED_SMS_CB
EVENT_MO_SHORT_MESSAGE_CONTROL_BY_SIM
EVENT_FORMATTED_SMS_CB
EVENT_FORMATTED_USSD
EVENT_UNFORMATTED_USSD
EVENT_DOWNLOAD_IWLAN_ACCESS
\- CRRN2: An _EnvelopeHandler_ is considered available when no
HANLDER_NOT_AVAILABLE ToolkitException is thrown when the corresponding
_getTheHandler()_ method is called or a method of the handler is called.
##### 5.3.1.3.1.2 Parameter errors {#parameter-errors-28 .H6}
No requirements.
##### 5.3.1.3.1.3 Context Errors {#context-errors-31 .H6}
No requirements.
##### 5.3.1.3.2 Test area files {#test-area-files-32 .H6}
Test Source: Test_Ufw_Mha_Enhd.java
Test Applet: Ufw_Mha_Enhd_1.java
Ufw_Mha_Enhd_2.java
Cap File: Ufw_Mha_Enhd.cap
##### 5.3.1.3.3 Test coverage {#test-coverage-32 .H6}
* * *
CRR Number Test Case Number N1 1 to 10 N2 1 to 10
* * *
##### 5.3.1.3.4 Test procedure {#test-procedure-32 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | 1 | EnvelopeHandler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_FORMA | | | | | TTED_SMS_PP_ENV | 2- No exception is | | | | | thrown. | | | | 1- Envelope SMS-PP | | | | | Download formatted | | | | | is sent to the | | | | | (U)SIM | | | | | | | | | | 2- | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+------------------+ | 2 | EnvelopeHandler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_FORMA | | | | | TTED_SMS_PP_UPD | 2- No exception is | | | | | thrown. | | | | 1- Update Record | | | | | EF~SMS~ | | | | | instruction | | | | | formatted is sent | | | | | to the (U)SIM | | | | | | | | | | 2- | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+------------------+ | 3 | EnvelopeHandler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | 2- No exception is | | | | | thrown. | | | | 1- Envelope SMS-PP | | | | | Download | Applet1 finalizes | | | | unformatted is | | | | | sent to the (U)SIM | 3- Applet2 is | | | | | triggered | | | | 2- | | | | | EnvelopeHandl | 4- No exception is | | | | er.getTheHandler() | thrown. | | | | method is called | | | | | by Applet1 | | | | | | | | | | 3- | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2 | | | +----+--------------------+--------------------+------------------+ | 4 | EnvelopeHandler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_UPD | 2- No exception is | | | | | thrown. | | | | 1- Update Record | | | | | EF~SMS~ | Applet1 finalizes | | | | instruction | | | | | unformatted is | Applet2 is | | | | sent to the (U)SIM | triggered | | | | | | | | | 2- | 3- No exception is | | | | EnvelopeHandl | thrown. | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | | | | | | | | **3- | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2** | | | +----+--------------------+--------------------+------------------+ | 5 | EnvelopeHandler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_UN | | | | | FORMATTED_SMS_CB | 2- No exception is | | | | | thrown | | | | 1- Envelope Cell | | | | | Broadcast Download | Applet1 finalizes | | | | unformatted is | | | | | sent to the (U)SIM | 3- Applet2 is | | | | | triggered | | | | 2- | | | | | EnvelopeHandl | 4- No exception is | | | | er.getTheHandler() | thrown | | | | method is called | | | | | by Applet1 | | | | | | | | | | 3- | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2 | | | +----+--------------------+--------------------+------------------+ | 6 | EnvelopeHandler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_ | | | | | MO_SHORT_MESSAGE | 2- No exception is | | | | _CONTROL_BY_SIM | throw | | | | | | | | | 1- Envelope MO | | | | | short message | | | | | control by SIM is | | | | | sent to the (U)SIM | | | | | | | | | | 2- | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+------------------+ | 7 | EnvelopeHandler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT_ | | | | | FORMATTED_SMS_CB | 2-No exception is | | | | | thrown | | | | 1- Envelope Cell | | | | | Broadcast Download | | | | | formatted is sent | | | | | to the (U)SIM | | | | | | | | | | 2- | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+------------------+ | 8 | EnvelopeHandler | 1- Applet1 is | | | | availability with | triggered | | | | EVEN | | | | | T_FORMATTED_USSD | 2-No exception is | | | | | thrown | | | | 1- Envelope USSD | | | | | formatted is sent | | | | | to the (U)SIM | | | | | | | | | | 2- | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+------------------+ | 9 | EnvelopeHandler | 1- Applet1 is | | | | availability with | triggered | | | | EVENT\ | | | | | _UNFORMATTED_USSD | 2- No exception is | | | | | thrown. | | | | 1- Envelope USSD | | | | | unformatted is | Applet1 finalizes | | | | sent to the (U)SIM | | | | | | 3- Applet2 is | | | | 2- | triggered | | | | EnvelopeHandl | | | | | er.getTheHandler() | 4- No exception is | | | | method is called | thrown | | | | by Applet1 | | | | | | | | | | 3- | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2 | | | +----+--------------------+--------------------+------------------+ | 10 | EnvelopeHandler | 1- Applet1 is | | | | availability with | triggered | | | | DOWNLOAD_IWL | | | | | AN_ACCESS_STATUS | 2- No exception is | | | | | thrown. | | | | 1- Envelope | | | | | Download Iwlan | Applet1 finalizes | | | | Access Status is | | | | | sent to the (U)SIM | 3- Applet2 is | | | | | triggered | | | | 2- | | | | | EnvelopeHandl | 4- No exception is | | | | er.getTheHandler() | thrown | | | | method is called | | | | | by Applet1 | | | | | | | | | | 3- | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2 | | | +----+--------------------+--------------------+------------------+
#### 5.3.1.4 EnvelopeResponseHandler
Test Area Reference: Ufw_Mha_Erhd
##### 5.3.1.4.1 Conformance requirements {#conformance-requirements-5 .H6}
##### 5.3.1.4.1.1 Normal execution {#normal-execution-32 .H6}
\- CRRN1: The handler is available for all triggered toolkit applets from the
invocation of the _processToolkit()_ method of the toolkit applet until a
toolkit applet has posted an envelope response or the first invocation of the
_ProactiveHandler.send()_ method for the following events:
EVENT_FORMATTED_SMS_PP_ENV
EVENT_UNFORMATTED_SMS_PP_ENV
EVENT_MO_SHORT_MESSAGE_CONTROL_BY_SIM
EVENT_FORMATTED_USSD
EVENT_UNFORMATTED_USSD
\- CRRN2: An _EnvelopeResponseHandler_ is considered available when no
HANLDER_NOT_AVAILABLE ToolkitException is thrown when the corresponding
_getTheHandler()_ method is called or a method of the handler is called.
##### 5.3.1.4.1.2 Parameter errors {#parameter-errors-29 .H6}
No requirements.
##### 5.3.1.4.1.3 Context Errors {#context-errors-32 .H6}
\- CRRC1: The handler is not available for the following events:
EVENT_FORMATTED_SMS_PP_UPD
EVENT_UNFORMATTED_SMS_PP_UPD
EVENT_UNFORMATTED_SMS_CB
EVENT_FORMATTED_SMS_CB
EVENT_DOWNLOAD_IWLAN_ACCESS_STATUS
##### 5.3.1.4.2 Test area files {#test-area-files-33 .H6}
Test Source: Test_Ufw_Mha_Erhd.java
Test Applet: Ufw_Mha_Erhd_1.java
Ufw_Mha_Erhd_2.java
Cap File: Ufw_Mha_Erhd.cap
##### 5.3.1.4.3 Test coverage {#test-coverage-33 .H6}
* * *
CRR Number Test Case Number N1 5 to 10 N2 1 to 10 C1 1 to 11
* * *
##### 5.3.1.4.4 Test procedure {#test-procedure-33 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+--------------------+ | 1 | Envel | 1- The applet1 is | | | | opeResponseHandler | triggered. | | | | availability with | | | | | EVENT_FORMA | 2- A | | | | TTED_SMS_PP_UPD | ToolkitException | | | | | HANDL | | | | 1- Update Record | ER_NOT_AVAILABLE | | | | EF~SMS~ | is thrown | | | | instruction | | | | | formatted is sent | | | | | to the (U)SIM | | | | | | | | | | 2- | | | | | Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 2 | Envel | 1- Applet1 is | | | | opeResponseHandler | triggered. | | | | availability with | | | | | EVENT_UNFORMA | 2- A | | | | TTED_SMS_PP_UPD | ToolkitException | | | | | HANDL | | | | 1- Update Record | ER_NOT_AVAILABLE | | | | EF~SMS~ | is thrown | | | | instruction | | | | | unformatted is | | | | | sent to the (U)SIM | | | | | | | | | | 2- | | | | | Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 3 | Envel | 1- The applet1 is | | | | opeResponseHandler | triggered. | | | | availability with | | | | | EVENT_ | 2- A | | | | FORMATTED_SMS_CB | ToolkitException | | | | | HANDL | | | | 1- Envelope Cell | ER_NOT_AVAILABLE | | | | Broadcast Download | is thrown | | | | formatted is sent | | | | | to the SIM | | | | | | | | | | 2- | | | | | Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 4 | Envel | 1- Applet1 is | | | | opeResponseHandler | triggered. | | | | availability with | | | | | EVENT_UN | 2- A | | | | FORMATTED_SMS_CB | ToolkitException | | | | | HANDL | | | | 1- Envelope Cell | ER_NOT_AVAILABLE | | | | Broadcast Download | is thrown | | | | unformatted is | | | | | sent to the SIM | | | | | | | | | | 2- | | | | | Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 5 | Envel | 1- Applet1 is | 3- The response | | | opeResponseHandler | triggered | packet is sent | | | availability with | | | | | EVENT_FORMA | 2- No exception is | 7- The proactive | | | TTED_SMS_PP_ENV | thrown. | command is sent | | | | | | | | 1- Envelope SMS-PP | 4- A | | | | Download formatted | ToolkitException | | | | is sent to the | HANDL | | | | (U)SIM | ER_NOT_AVAILABLE | | | | | is thrown for each | | | | 2- | method | | | | Env | | | | | elopeResponseHandl | Applet1 finalizes | | | | er.getTheHandler() | | | | | method is called | 5- Applet1 is | | | | by Applet1 | triggered | | | | | | | | | 3- Applet1 builds | 6- No Exception is | | | | an additional | thrown | | | | information for | | | | | response packet | 8- | | | | and it calls the | ToolkitException | | | | post() method | HANDL | | | | | ER_NOT_AVAILABLE | | | | 4- Applet1 calls | is thrown for each | | | | all methods of the | method | | | | Envel | | | | | opeResponseHandler | | | | | (including | | | | | inherited methods) | | | | | | | | | | 5- A | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_ENV | | | | | envelope is sent | | | | | to the (U)SIM | | | | | | | | | | 6- | | | | | Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | | | | | | | | 7- Applet1 builds | | | | | a proactive | | | | | command and it | | | | | calls the send() | | | | | method | | | | | | | | | | 8- Applet1 calls | | | | | all methods of the | | | | | Envel | | | | | opeResponseHandler | | | | | (including | | | | | inherited methods) | | | +----+--------------------+--------------------+--------------------+ | 6 | Envel | 1- Applet1 is | 3- The envelope | | | opeResponseHandler | triggered | response is sent | | | availability with | | | | | EVENT_UNFORMA | 2- No exception is | 9- The proactive | | | TTED_SMS_PP_ENV | thrown. | command is fetched | | | | | and the Terminal | | | 1- Envelope SMS-PP | 4- A | response is | | | Download | ToolkitException | issued. | | | unformatted is | HANDL | | | | sent to the (U)SIM | ER_NOT_AVAILABLE | | | | | is thrown for each | | | | 2- | method | | | | Env | | | | | elopeResponseHandl | Applet1 finalizes | | | | er.getTheHandler() | | | | | method is called | 5- Applet2 is | | | | by Applet1 | triggered. | | | | | | | | | 3- Applet1 builds | A ToolkitException | | | | the envelope | HANDL | | | | response and it | ER_NOT_AVAILABLE | | | | calls the post() | is thrown. | | | | method | | | | | | Applet2 finalizes | | | | 4- Applet1 calls | | | | | all methods of the | 6- Applet1 is | | | | Envel | triggered. | | | | opeResponseHandler | | | | | (including | 7- No exception is | | | | inherited methods) | thrown. | | | | | | | | | 5- | 9- A | | | | Env | ToolkitException | | | | elopeResponseHandl | HANDL | | | | er.getTheHandler() | ER_NOT_AVAILABLE | | | | method is called | is thrown for each | | | | | method. | | | | 6- An unformatted | | | | | SMS PP envelope is | Applet1 finalizes | | | | sent to the (U)SIM | | | | | | 10- Applet2 is | | | | 7- | triggered. | | | | Env | | | | | elopeResponseHandl | A ToolkitException | | | | er.getTheHandler() | HANDL | | | | method is called. | ER_NOT_AVAILABLE | | | | | is thrown. | | | | 8- Applet1 builds | | | | | a proactive | | | | | command and it | | | | | calls the send() | | | | | method | | | | | | | | | | 9- Applet1 calls | | | | | all methods of the | | | | | Envel | | | | | opeResponseHandler | | | | | (including | | | | | inherited methods) | | | | | | | | | | 10- | | | | | Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2 | | | +----+--------------------+--------------------+--------------------+ | 7 | Envel | 1- Applet1 is | 3-The envelope | | | opeResponseHandler | triggered | response is sent | | | availability with | | | | | EVENT_ | 2- No exception is | 7- The proactive | | | MO_SHORT_MESSAGE | thrown. | command is fetched | | | _CONTROL_BY_SIM | | and the Terminal | | | | 4- A | Response is issued | | | 1- Envelope MO | ToolkitException | | | | short message | HANDL | | | | control by SIM is | ER_NOT_AVAILABLE | | | | sent to the (U)SIM | is thrown for each | | | | | method | | | | 2- | | | | | Env | Applet1 finalizes | | | | elopeResponseHandl | | | | | er.getTheHandler() | 5- Applet1 is | | | | method is called | triggered | | | | by Applet1 | | | | | | 6- No exception is | | | | 3- Applet1 builds | thrown | | | | the envelope | | | | | response and it | 8- A | | | | calls the | ToolkitException | | | | postAsBERTLV() | HANDL | | | | method | ER_NOT_AVAILABLE | | | | | is thrown for each | | | | 4- Applet1 calls | method | | | | all methods of the | | | | | Envel | | | | | opeResponseHandler | | | | | (including | | | | | inherited methods) | | | | | | | | | | 5- Envelope MO | | | | | short message | | | | | control by SIM is | | | | | sent to the (U)SIM | | | | | | | | | | 6- | | | | | Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | | | | | | | | 7- Applet1 builds | | | | | a proactive | | | | | command and it | | | | | calls the send | | | | | method | | | | | | | | | | 8- Applet1 calls | | | | | all methods of the | | | | | Envel | | | | | opeResponseHandler | | | | | (including | | | | | inherited methods) | | | +----+--------------------+--------------------+--------------------+ | 8 | Envel | 1- Applet1 is | 6- The response is | | | opeResponseHandler | triggered | checked. | | | availability with | | | | | EVENT_UNFORMA | 2- No exception is | | | | TTED_SMS_PP_ENV | thrown. | | | | in case of | | | | | multi-triggering | 3- Applet1 | | | | | finalizes | | | | 1- Envelope SMS-PP | | | | | Download | 4- Applet2 is | | | | unformatted is | triggered. | | | | sent to the (U)SIM | | | | | | 5- No Exception is | | | | 2- | thrown | | | | Env | | | | | elopeResponseHandl | Applet2 finalizes | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | | | | | | | | 5- | | | | | Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet 2 | | | | | | | | | | 6- Applet2 calls | | | | | the post() method | | | +----+--------------------+--------------------+--------------------+ | 9 | Envel | 1- Applet1 is | 3- The response | | | opeResponseHandler | triggered | packet is sent | | | availability with | | | | | EVEN | 2- No exception is | 7- The proactive | | | T_FORMATTED_USSD | thrown. | command is sent | | | | | | | | 1- Envelope USSD | 4- A | | | | formatted is sent | ToolkitException | | | | to the (U)SIM | HANDL | | | | | ER_NOT_AVAILABLE | | | | 2- | is thrown for each | | | | Env | method | | | | elopeResponseHandl | | | | | er.getTheHandler() | Applet1 finalizes | | | | method is called | | | | | by Applet1 | 5- Applet1 is | | | | | triggered | | | | 3- Applet1 builds | | | | | an additional | 6- No Exception is | | | | information for | thrown | | | | response packet | | | | | and it calls the | 8- | | | | post() method | ToolkitException | | | | | HANDL | | | | 4- Applet1 calls | ER_NOT_AVAILABLE | | | | all methods of the | is thrown for each | | | | Envel | method | | | | opeResponseHandler | | | | | (including | | | | | inherited methods) | | | | | | | | | | 5- | | | | | EVEN | | | | | T_FORMATTED_USSD | | | | | envelope is sent | | | | | to the (U)SIM | | | | | | | | | | 6- | | | | | Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | | | | | | | | 7- Applet1 builds | | | | | a proactive | | | | | command and it | | | | | calls the send() | | | | | method | | | | | | | | | | 8- Applet1 calls | | | | | all methods of the | | | | | Envel | | | | | opeResponseHandler | | | | | (including | | | | | inherited methods) | | | +----+--------------------+--------------------+--------------------+ | 10 | Envel | 1- Applet1 is | 6- The response is | | | opeResponseHandler | triggered | checked. | | | availability with | | | | | EVENT_UNFORMA | 2- No exception is | | | | TTED_SMS_PP_ENV | thrown. | | | | in case of | | | | | multi-triggering | 3- Applet1 | | | | | finalizes | | | | 1- Envelope USSD | | | | | unformatted is | 4- Applet2 is | | | | sent to the (U)SIM | triggered. | | | | | | | | | 2- | 5- No Exception is | | | | Env | thrown | | | | elopeResponseHandl | | | | | er.getTheHandler() | Applet2 finalizes | | | | method is called | | | | | by Applet1 | | | | | | | | | | 5- | | | | | Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet 2 | | | | | | | | | | 6- Applet2 calls | | | | | the post() method | | | +----+--------------------+--------------------+--------------------+ | 11 | Envel | 1- The applet1 is | | | | opeResponseHandler | triggered. | | | | availability with | | | | | EV | 2- A | | | | ENT_DOWNLOAD_IWL | ToolkitException | | | | AN_ACCESS_STATUS | HANDL | | | | | ER_NOT_AVAILABLE | | | | 1- Envelope | is thrown | | | | Download Iwlan | | | | | Access Status is | | | | | sent to the (U)SIM | | | | | | | | | | 2- | | | | | Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+
#### 5.3.1.5 USATEnvelopeHandler
Test Area Reference: Ufw_Mha_Uehd
##### 5.3.1.5.1 Conformance requirements {#conformance-requirements-6 .H6}
##### 5.3.1.5.1.1 Normal execution {#normal-execution-33 .H6}
\- CRRN1: The _UsatEnvelopeHandler_ and its content are available for all
toolkit applets triggered from the invocation to the termination of their
_processToolkit()_ method for the following events:
EVENT_FORMATTED_SMS_PP_ENV
EVENT_FORMATTED_SMS_PP_UPD
EVENT_UNFORMATTED_SMS_PP_ENV
EVENT_UNFORMATTED_SMS_PP_UPD
EVENT_UNFORMATTED_SMS_CB
EVENT_MO_SHORT_MESSAGE_CONTROL_BY_SIM
EVENT_FORMATTED_SMS_CB
EVENT_FORMATTED_USSD
EVENT_UNFORMATTED_USSD
EVENT_DOWNLOAD_IWLAN_ACCESS_STATUS
\- CRRN2: An _UsatEnvelopeHandler_ is considered available when no
HANLDER_NOT_AVAILABLE ToolkitException is thrown when the corresponding
_getTheHandler()_ method is called or a method of the handler is called.
##### 5.3.1.5.1.2 Parameter errors {#parameter-errors-30 .H6}
No requirements.
##### 5.3.1.5.1.3 Context Errors {#context-errors-33 .H6}
No requirements.
##### 5.3.1.5.2 Test area files {#test-area-files-34 .H6}
Test Source: Test_Ufw_Mha_Uehd.java
Test Applet: Ufw_Mha_Uehd_1.java
Ufw_Mha_Uehd_2.java
Cap File: Ufw_Mha_Uehd.cap
##### 5.3.1.5.3 Test coverage {#test-coverage-34 .H6}
* * *
CRR Number Test Case Number N1 1 to 10 N2 1 to 10
* * *
##### 5.3.1.5.4 Test procedure {#test-procedure-34 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | 1 | U | 1- Applet1 is | | | | SATEnvelopeHandler | triggered | | | | availability with | | | | | EVENT_FORMA | 2- No exception is | | | | TTED_SMS_PP_ENV | thrown. | | | | | | | | | 1- Envelope SMS-PP | | | | | Download formatted | | | | | is sent to the | | | | | (U)SIM | | | | | | | | | | 2- | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+------------------+ | 2 | U | 1- Applet1 is | | | | SATEnvelopeHandler | triggered | | | | availability with | | | | | EVENT_FORMA | 2- No exception is | | | | TTED_SMS_PP_UPD | thrown. | | | | | | | | | 1- Update Record | | | | | EF~SMS~ | | | | | instruction | | | | | formatted is sent | | | | | to the (U)SIM | | | | | | | | | | 2- | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+------------------+ | 3 | U | 1- Applet1 is | | | | SATEnvelopeHandler | triggered | | | | availability with | | | | | EVENT_UNFORMA | 2- No exception is | | | | TTED_SMS_PP_ENV | thrown. | | | | | | | | | 1- Envelope SMS-PP | Applet1 finalizes | | | | Download | | | | | unformatted is | 3- Applet2 is | | | | sent to the (U)SIM | triggered | | | | | | | | | 2- | 4- No exception is | | | | USATEnvelopeHandl | thrown. | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | | | | | | | | 3- | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2 | | | +----+--------------------+--------------------+------------------+ | 4 | U | 1- Applet1 is | | | | SATEnvelopeHandler | triggered | | | | availability with | | | | | EVENT_UNFORMA | 2- No exception is | | | | TTED_SMS_PP_UPD | thrown. | | | | | | | | | 1- Update Record | Applet1 finalizes | | | | EF~SMS~ | | | | | instruction | Applet2 is | | | | unformatted is | triggered | | | | sent to the (U)SIM | | | | | | 3- No exception is | | | | 2- | thrown. | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | | | | | | | | **3-** | | | | | U | | | | | SAT**EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2** | | | +----+--------------------+--------------------+------------------+ | 5 | U | 1- Applet1 is | | | | SATEnvelopeHandler | triggered | | | | availability with | | | | | EVENT_UN | 2- No exception is | | | | FORMATTED_SMS_CB | thrown | | | | | | | | | 1- Envelope Cell | Applet1 finalizes | | | | Broadcast Download | | | | | unformatted is | 3- Applet2 is | | | | sent to the (U)SIM | triggered | | | | | | | | | 2- | 4- No exception is | | | | USATEnvelopeHandl | thrown | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | | | | | | | | 3- | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2 | | | +----+--------------------+--------------------+------------------+ | 6 | U | 1- Applet1 is | | | | SATEnvelopeHandler | triggered | | | | availability with | | | | | EVENT_ | 2- No exception is | | | | MO_SHORT_MESSAGE | throw | | | | _CONTROL_BY_SIM | | | | | | | | | | 1- Envelope MO | | | | | short message | | | | | control by SIM is | | | | | sent to the (U)SIM | | | | | | | | | | 2- | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+------------------+ | 7 | U | 1- Applet1 is | | | | SATEnvelopeHandler | triggered | | | | availability with | | | | | EVENT_ | 2-No exception is | | | | FORMATTED_SMS_CB | thrown | | | | | | | | | 1- Envelope Cell | | | | | Broadcast Download | | | | | formatted is sent | | | | | to the (U)SIM | | | | | | | | | | 2- | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+------------------+ | 8 | U | 1- Applet1 is | | | | SATEnvelopeHandler | triggered | | | | availability with | | | | | EVEN | 2- No exception is | | | | T_FORMATTED_USSD | thrown. | | | | | | | | | 1- Envelope USSD | | | | | formatted is sent | | | | | to the (U)SIM | | | | | | | | | | 2- | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+------------------+ | 9 | U | 1- Applet1 is | | | | SATEnvelopeHandler | triggered | | | | availability with | | | | | EVENT\ | 2- No exception is | | | | _UNFORMATTED_USSD | thrown. | | | | | | | | | 1- Envelope USSD | Applet1 finalizes | | | | unformatted is | | | | | sent to the (U)SIM | 3- Applet2 is | | | | | triggered | | | | 2- | | | | | USATEnvelopeHandl | 4- No exception is | | | | er.getTheHandler() | thrown. | | | | method is called | | | | | by Applet1 | | | | | | | | | | 3- | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2 | | | +----+--------------------+--------------------+------------------+ | 10 | U | 1- Applet1 is | | | | SATEnvelopeHandler | triggered | | | | availability with | | | | | EV | 2- No exception is | | | | ENT_DOWNLOAD_IWL | thrown. | | | | AN_ACCESS_STATUS | | | | | | Applet1 finalizes | | | | 1- Envelope USSD | | | | | unformatted is | 3- Applet2 is | | | | sent to the (U)SIM | triggered | | | | | | | | | 2- | 4- No exception is | | | | USATEnvelopeHandl | thrown | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | | | | | | | | 3- | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet2 | | | +----+--------------------+--------------------+------------------+
#### 5.3.1.6 Applet triggering with ongoing proactive session
Test Area Reference: Ufw_Mha_Rent
##### 5.3.1.6.1 Conformance requirements {#conformance-requirements-7 .H6}
##### 5.3.1.6.1.1 Normal execution {#normal-execution-34 .H6}
\- CRRN1: _EnvelopeHandler_ and _USATEnvelopeHandler_ are available for all
events.
\- CRRN2: _EnvelopeResponseHandler_ is available for the following events:
EVENT_FORMATTED_SMS_PP_ENV
EVENT_UNFORMATTED_SMS_PP_ENV
EVENT_MO_SHORT_MESSAGE_CONTROL_BY_SIM
EVENT_FORMATTED_USSD
EVENT_UNFORMATTED_USSD
\- CRRN3: Reply busy is not allowed for following events:
EVENT_FORMATTED_SMS_PP_UPD
EVENT_UNFORMATTED_SMS_PP_UPD
EVENT_MO_SHORT_MESSAGE_CONTROL_BY_SIM
##### 5.3.1.6.1.2 Parameter errors {#parameter-errors-31 .H6}
No requirements.
##### 5.3.1.6.1.3 Context Errors {#context-errors-34 .H6}
\- CRRC1: EnvelopeResponseHandler is not available for the following events:
EVENT_FORMATTED_SMS_PP_UPD
EVENT_UNFORMATTED_SMS_PP_UPD
EVENT_UNFORMATTED_SMS_CB
EVENT_FORMATTED_SMS_CB
EVENT_DOWNLOAD_IWLAN_ACCESS_STATUS
##### 5.3.1.6.2 Test area files {#test-area-files-35 .H6}
Test Source: Test_Ufw_Mha_Rent.java
Test Applet: Ufw_Mha_Rent_1.java
Cap File: Ufw_Mha_Rent.cap
##### 5.3.1.6.3 Test coverage {#test-coverage-35 .H6}
* * *
CRR Number Test Case Number N1 1, 2, 3, 4, 5, 6, 7, 8 N2 3, 4, 5, 8, 9 N3 1,
2, 3 C1 1, 2, 6, 7, 10
* * *
##### 5.3.1.6.4 Test procedure {#test-procedure-35 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+--------------------+ | 1 | Handlers | 1- Applet1 is | 2- 91 XX | | | availability with | triggered | | | | EVENT_FORMA | | 6- The proactive | | | TTED_SMS_PP_UPD | 3- Applet1 is | command is fetched | | | | triggered again | and the Terminal | | | 1- Envelope | | Response is | | | unrecognized is | 4- No exception is | issued. | | | sent to the (U)SIM | thrown | | | | | | | | | 2- Applet1 builds | 5- A | | | | a proactive | ToolkitException | | | | command and calls | HANDL | | | | the send() method | ER_NOT_AVAILABLE | | | | | is thrown | | | | 3- Update Record | | | | | EF~SMS~ | Applet1 finalizes | | | | instruction | | | | | formatted is sent | | | | | to the (U)SIM | | | | | | | | | | 4- | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | and | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | methods are called | | | | | by Applet1 | | | | | | | | | | 5- | | | | | Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 2 | Handlers | 1- Applet1 is | 2- 91 XX | | | availability with | triggered | | | | EVENT_UNFORMA | | 6- The proactive | | | TTED_SMS_PP_UPD | 3- Applet1 is | command is fetched | | | | triggered again | and the Terminal | | | 1- Envelope | | Response is | | | unrecognized is | 4- No exception is | issued. | | | sent to the (U)SIM | thrown | | | | | | | | | 2- Applet1 builds | 5- A | | | | a proactive | ToolkitException | | | | command and calls | HANDL | | | | the send() method | ER_NOT_AVAILABLE | | | | | is thrown | | | | 3- Update Record | | | | | EF~SMS~ | Applet1 finalizes | | | | instruction | | | | | unformatted is | | | | | sent to the (U)SIM | | | | | | | | | | 4- | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | and | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | methods are called | | | | | by Applet1 | | | | | | | | | | 5- | | | | | Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 3 | Handlers | 1- Applet1 is | 2- 91 XX | | | availability with | triggered | | | | EVENT_ | | 6- The proactive | | | MO_SHORT_MESSAGE | 3- Applet1 is | command is fetched | | | _CONTROL_BY_SIM | triggered again | and the Terminal | | | | | Response is | | | 1- Envelope | 4- No exception is | issued. | | | unrecognized is | thrown | | | | sent to the (U)SIM | | | | | | 5- No exception is | | | | 2- Applet1 builds | thrown | | | | a proactive | | | | | command and calls | Applet1 finalizes | | | | the send() method | | | | | | | | | | 3- Envelope MO | | | | | short message | | | | | control by SIM is | | | | | sent to the (U)SIM | | | | | | | | | | 4- | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | and | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | methods are called | | | | | by Applet1 | | | | | | | | | | 5- | | | | | Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 4 | Handlers | 1- Applet1 is | 2- 91 XX | | | availability with | triggered | | | | EVENT_FORMA | | 6- The proactive | | | TTED_SMS_PP_ENV | 3- Applet1 is | command is fetched | | | | triggered again | and the Terminal | | | 1- Envelope | | Response is | | | unrecognized is | 4- No exception is | issued. | | | sent to the (U)SIM | thrown | | | | | | | | | 2- Applet1 builds | 5- No exception is | | | | a proactive | thrown | | | | command and calls | | | | | the send() method | Applet1 finalizes | | | | | | | | | 3- Envelope SMS-PP | | | | | Download formatted | | | | | is sent to the | | | | | (U)SIM | | | | | | | | | | 4- | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | and | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | methods are called | | | | | by Applet1 | | | | | | | | | | 5- | | | | | Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 5 | Handlers | 1- Applet1 is | 2- 91 XX | | | availability with | triggered | | | | EVENT_UNFORMA | | 6- The proactive | | | TTED_SMS_PP_ENV | 3- Applet1 is | command is fetched | | | | triggered again | and the Terminal | | | 1- Envelope | | Response is | | | unrecognized is | 4- No exception is | issued. | | | sent to the (U)SIM | thrown | | | | | | | | | 2- Applet1 builds | 5- No exception is | | | | a proactive | thrown | | | | command and calls | | | | | the send() method | Applet1 finalizes | | | | | | | | | 3- Envelope SMS-PP | | | | | Download | | | | | unformatted is | | | | | sent to the (U)SIM | | | | | | | | | | 4- | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | and | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | methods are called | | | | | by Applet1 | | | | | | | | | | 5- | | | | | Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 6 | Handlers | 1- Applet1 is | 2- 91 XX | | | availability with | triggered | | | | EVENT_ | | 6- The proactive | | | FORMATTED_SMS_CB | 3- Applet1 is | command is fetched | | | | triggered again | and the Terminal | | | 1- Envelope | | Response is | | | unrecognized is | 4- No exception is | issued. | | | sent to the (U)SIM | thrown | | | | | | | | | 2- Applet1 builds | 5- A | | | | a proactive | ToolkitException | | | | command and calls | HANDL | | | | the send() method | ER_NOT_AVAILABLE | | | | | is thrown | | | | 3- Envelope CB | | | | | Download formatted | Applet1 finalizes | | | | is sent to the | | | | | (U)SIM | | | | | | | | | | 4- | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | and | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | methods are called | | | | | by Applet1 | | | | | | | | | | 5- | | | | | Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 7 | Handlers | 1- Applet1 is | 2- 91 XX | | | availability with | triggered | | | | EVENT_UN | | 6- The proactive | | | FORMATTED_SMS_CB | 3- Applet1 is | command is fetched | | | | triggered again | and the Terminal | | | 1- Envelope | | Response is | | | unrecognized is | 4- No exception is | issued. | | | sent to the (U)SIM | thrown | | | | | | | | | 2- Applet1 builds | 5- A | | | | a proactive | ToolkitException | | | | command and calls | HANDL | | | | the send() method | ER_NOT_AVAILABLE | | | | | is thrown | | | | 3- Envelope CB | | | | | Download | Applet1 finalizes | | | | unformatted is | | | | | sent to the (U)SIM | | | | | | | | | | 4- | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | and | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | methods are called | | | | | by Applet1 | | | | | | | | | | 5- | | | | | Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 8 | Handlers | 1- Applet1 is | 2- 91 XX | | | availability with | triggered | | | | EVENT_FO | | 6- The proactive | | | RMATTED_SMS_USSD | 3- Applet1 is | command is fetched | | | | triggered again | and the Terminal | | | 1- Envelope | | Response is | | | unrecognized is | 4- No exception is | issued. | | | sent to the (U)SIM | thrown | | | | | | | | | 2- Applet1 builds | 5- No exception is | | | | a proactive | thrown | | | | command and calls | | | | | the send() method | Applet1 finalizes | | | | | | | | | 3- Envelope USSD | | | | | formatted is sent | | | | | to the (U)SIM | | | | | | | | | | 4- | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | and | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | methods are called | | | | | by Applet1 | | | | | | | | | | 5- | | | | | Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 9 | Handlers | 1- Applet1 is | 2- 91 XX | | | availability with | triggered | | | | EVENT\ | | 6- The proactive | | | _UNFORMATTED_USSD | 3- Applet1 is | command is fetched | | | | triggered again | and the Terminal | | | 1- Envelope | | Response is | | | unrecognized is | 4- No exception is | issued. | | | sent to the (U)SIM | thrown | | | | | | | | | 2- Applet1 builds | 5- No exception is | | | | a proactive | thrown | | | | command and calls | | | | | the send() method | Applet1 finalizes | | | | | | | | | 3- Envelope USSD | | | | | unformatted is | | | | | sent to the (U)SIM | | | | | | | | | | 4- | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | and | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | methods are called | | | | | by Applet1 | | | | | | | | | | 5- | | | | | Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+ | 10 | Handlers | 1- Applet1 is | 2- 91 XX | | | availability with | triggered | | | | EV | | 6- The proactive | | | ENT_DOWNLOAD_IWL | 3- Applet1 is | command is fetched | | | AN_ACCESS_STATUS | triggered again | and the Terminal | | | | | Response is | | | 1- Envelope | 4- No exception is | issued. | | | unrecognized is | thrown | | | | sent to the (U)SIM | | | | | | 5- A | | | | 2- Applet1 builds | ToolkitException | | | | a proactive | HANDL | | | | command and calls | ER_NOT_AVAILABLE | | | | the send() method | is thrown | | | | | | | | | 3- Envelope | Applet1 finalizes | | | | Download Iwlan | | | | | Access Status is | | | | | sent to the (U)SIM | | | | | | | | | | 4- | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | and | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | methods are called | | | | | by Applet1 | | | | | | | | | | 5- | | | | | Env | | | | | elopeResponseHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | by Applet1 | | | +----+--------------------+--------------------+--------------------+
### 5.3.2 Handler integrity
#### 5.3.2.1 ProactiveResponseHandler
Test Area Reference: Ufw_Hin_Prhd
##### 5.3.2.1.1 Conformance requirements {#conformance-requirements-8 .H6}
##### 5.3.2.1.1.1 Normal execution {#normal-execution-35 .H6}
\- CRRN1: The _ProactiveResponseHandler_ TLV list shall be empty before the
first call to the _ProactiveHandler.send()_ method.
##### 5.3.2.1.1.2 Parameter errors {#parameter-errors-32 .H6}
No requirements.
##### 5.3.2.1.1.3 Context Errors {#context-errors-35 .H6}
No requirements.
##### 5.3.2.1.2 Test area files {#test-area-files-36 .H6}
Test Source: Test_Ufw_Hin_Prhd.java
Test Applet: Ufw_Hin_Prhd_1.java
Cap File: Ufw_Hin_Prhd.cap
##### 5.3.2.1.3 Test coverage {#test-coverage-36 .H6}
* * *
CRR Number Test Case Number N1 1
* * *
##### 5.3.2.1.4 Test procedure {#test-procedure-36 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | 1 | Applet | 1- No exception is | | | | registration and | thrown | | | | Proact | | | | | iveResponseHandler | 2- Applet is | | | | obtaining | triggered. | | | | | | | | | 1- Applet is | 3- No exception is | | | | registered to all | thrown | | | | events defined in | | | | | TS 31.130 [2]. | 4- The return | | | | | value is 0 | | | | Using the method | | | | | setEventList() for | | | | | all the events. | | | | | | | | | | Terminal Profile | | | | | command is sent to | | | | | the (U)SIM without | | | | | the facilities of | | | | | SET_EVENT_LIST | | | | | ,SETUP\ | | | | | _IDLE_MODE_TEXT, | | | | | SETUP_MENU and | | | | | POLL_INTERVAL. | | | | | | | | | | 2- For each | | | | | event/triggering: | | | | | | | | | | 3- | | | | | Proa | | | | | ctiveResponseHandl | | | | | er.getTheHandler() | | | | | is called | | | | | | | | | | 4- | | | | | ProactiveResponseH | | | | | andler.getLength() | | | | | is called | | | +----+--------------------+--------------------+------------------+
#### 5.3.2.2 EnvelopeHandler
Test Area Reference: Ufw_Hin_Enhd
##### 5.3.2.2.1 Conformance requirements {#conformance-requirements-9 .H6}
##### 5.3.2.2.1.1 Normal execution {#normal-execution-36 .H6}
\- CRRN1: When available, the _EnvelopeHandler_ shall remain available and its
content shall remain unchanged from the invocation to the termination of the
_processToolkit()_ method.
\- CRRN2: The _EnvelopeHandler_ TLV list is filled with the Comprehension TLV
data objects of the ENVELOPE APDU command. The Comprehension TLV data objects
shall be provided in the order given in the ENVELOPE command data.
##### 5.3.2.2.1.2 Parameter errors {#parameter-errors-33 .H6}
No requirements.
##### 5.3.2.2.1.3 Context Errors {#context-errors-36 .H6}
No requirements.
##### 5.3.2.2.2 Test area files {#test-area-files-37 .H6}
Test Source: Test_Ufw_Hin_Enhd.java
Test Applet: Ufw_Hin_Enhd_1.java
Cap File: Ufw_Hin_Enhd.cap
##### 5.3.2.2.3 Test coverage {#test-coverage-37 .H6}
* * *
CRR Number Test Case Number N1 1 to 10 N2 1 to 10
* * *
##### 5.3.2.2.4 Test procedure {#test-procedure-37 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+--------------------+ | 1 | EnvelopeHandler | 1- Applet is | 4- 91 XX | | | integrity checks | triggered | | | | with | | Proactive command | | | EVENT_FORMA | 2- No exception is | Display Text is | | | TTED_SMS_PP_ENV | thrown. | fetched | | | | | | | | 1- A formatted SMS | 3- No exception is | The terminal | | | PP envelope is | thrown. | Response of | | | sent to the (U)SIM | | DISPLAY TEXT is | | | | 5- Applet is | sent to the (U)SIM | | | 2- | triggered | | | | EnvelopeHandl | | | | | er.getTheHandler() | 6- No exception is | | | | method is called | thrown and the | | | | | handler contains | | | | 3- Copy the | the envelope call | | | | content of the | control by SIM | | | | EnvelopeHandler in | | | | | buffer1 using | 7- The contents of | | | | Enve | the | | | | lopeHandler.copy() | EnvelopeHandler | | | | | shall be the same | | | | The | as stored in | | | | Envelop | buffer1 | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_SMS_TPDU | | | | | | | | | | 4- A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5- Envelope call | | | | | control by SIM is | | | | | sent to the (U)SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6- Check that | | | | | EnvelopeHandler | | | | | content is the | | | | | same as in the | | | | | envelope call | | | | | control using | | | | | Enve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | Check that the | | | | | TAG_SMS_TPDU is | | | | | the TLV selected | | | | | | | | | | 7- The content of | | | | | EnvelopeHandler is | | | | | compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 2 | EnvelopeHandler | 1- Applet is | 4- 91 XX | | | integrity checks | triggered | | | | with | | Proactive command | | | EVENT_FORMA | 2- No exception is | Display Text is | | | TTED_SMS_PP_UPD | thrown. | fetched | | | | | | | | 1- Update Record | 3- No exception is | The terminal | | | EF~SMS~ | thrown. | Response of | | | instruction single | | DISPLAY TEXT is | | | and formatted is | 5- Applet is | sent to the (U)SIM | | | sent to the (U)SIM | triggered | | | | | | | | | 2- | 6- No exception is | | | | EnvelopeHandl | thrown and the | | | | er.getTheHandler() | handler contains | | | | method is called | the envelope call | | | | | control by SIM | | | | 3- Copy the | | | | | content of the | 7- The contents of | | | | EnvelopeHandler in | the | | | | buffer1 using | EnvelopeHandler | | | | Enve | shall be the same | | | | lopeHandler.copy() | as stored in | | | | | buffer1 | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_SMS_TPDU | | | | | | | | | | 4- A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5- Envelope call | | | | | control by SIM is | | | | | sent to the (U)SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6- Checked that | | | | | EnvelopeHandler | | | | | content is the | | | | | same as in | | | | | envelope call | | | | | control using | | | | | Enve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_SMS_TPDU | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | Checked that the | | | | | TAG_SMS_TPDU is | | | | | the TLV selected | | | | | | | | | | 7- The content of | | | | | EnvelopeHandler is | | | | | compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 3 | EnvelopeHandler | 1- Applet is | 4- 91 XX | | | integrity checks | triggered | | | | with | | Proactive command | | | EVENT_UNFORMA | 2- No exception is | Display Text is | | | TTED_SMS_PP_ENV | thrown. | fetched | | | | | | | | 1- A unformatted | 3- No exception is | The terminal | | | SMS PP envelope is | thrown. | Response of | | | sent to the (U)SIM | | DISPLAY TEXT is | | | | 5- Applet is | sent to the (U)SIM | | | 2- | triggered | | | | EnvelopeHandl | | | | | er.getTheHandler() | 6- No exception is | | | | method is called | thrown and the | | | | | handler contains | | | | 3- Copy the | the envelope call | | | | content of the | control by SIM | | | | EnvelopeHandler in | | | | | buffer1 using | 7- The contents of | | | | Enve | the | | | | lopeHandler.copy() | EnvelopeHandler | | | | | shall be the same | | | | The | as stored in | | | | Envel | buffer1. | | | | opeHandler.findTLV | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | 4- A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5- Envelope call | | | | | control by SIM is | | | | | sent to the (U)SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6- Check that | | | | | EnvelopeHandler | | | | | content is the | | | | | same as in the | | | | | envelope call | | | | | control using | | | | | Enve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | Check that the | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The content of | | | | | EnvelopeHandler is | | | | | compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 4 | EnvelopeHandler | 1- Applet is | 4- 91 XX | | | integrity checks | triggered | | | | with | | Proactive command | | | EVENT_UNFORMA | 2- No exception is | Display Text is | | | TTED_SMS_PP_UPD | thrown. | fetched | | | | | | | | 1- Update Record | 3- No exception is | The terminal | | | EF~SMS~ | thrown. | Response of | | | instruction single | | DISPLAY TEXT is | | | and unformatted is | 5- Applet is | sent to the (U)SIM | | | sent to the (U)SIM | triggered | | | | | | | | | 2- | 6- No exception is | | | | EnvelopeHandl | thrown and the | | | | er.getTheHandler() | handler contains | | | | method is called | the envelope call | | | | | control by SIM | | | | 3- Copy the | | | | | content of the | 7- The contents of | | | | EnvelopeHandler in | the | | | | buffer1 using | EnvelopeHandler | | | | Enve | shall be the same | | | | lopeHandler.copy() | as stored in | | | | | buffer1. | | | | The | | | | | Envel | | | | | opeHandler.findTLV | | | | | method is called | | | | | with | | | | | TAG_SMS_TPDU | | | | | | | | | | 4- A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5- Envelope call | | | | | control by SIM is | | | | | sent to the (U)SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6- Check that | | | | | EnvelopeHandler | | | | | content is the | | | | | same as in | | | | | envelope call | | | | | control using | | | | | Enve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | Check that the | | | | | SMS_TPDU is the | | | | | TLV selected | | | | | | | | | | 7- The content of | | | | | EnvelopeHandler is | | | | | compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 5 | EnvelopeHandler | 1- Applet is | 4- 91 XX | | | integrity checks | triggered | | | | with | | Proactive command | | | EVENT_UN | 2- No exception is | Display Text is | | | FORMATTED_SMS_CB | thrown. | fetched | | | | | | | | 1- An unformatted | 3- No exception is | The terminal | | | cell broadcast | thrown. | Response of | | | envelope is sent | | DISPLAY TEXT is | | | to the (U)SIM | 5- Applet is | sent to the (U)SIM | | | | triggered | | | | 2- | | | | | EnvelopeHandl | 6- No exception is | | | | er.getTheHandler() | thrown and the | | | | method is called | handler contains | | | | | the envelope call | | | | 3- Copy the | control by SIM | | | | content of the | | | | | EnvelopeHandler in | 7- The contents of | | | | buffer1 using | the | | | | Enve | EnvelopeHandler | | | | lopeHandler.copy() | shall be the same | | | | | as stored in | | | | The | buffer1. | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_C | | | | | ELLBROADCAST_PAGE | | | | | | | | | | 4- A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5- Envelope call | | | | | control by SIM is | | | | | sent to the (U)SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6- Checked that | | | | | EnvelopeHandler | | | | | content is the | | | | | same as in | | | | | envelope call | | | | | control using | | | | | Enve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | Check that the | | | | | TAG_C | | | | | ELLBROADCAST_PAGE | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The content of | | | | | EnvelopeHandler is | | | | | compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 6 | EnvelopeHandler | 1- Applet is | 4- 91 XX | | | integrity checks | triggered | | | | with EVENT_ | | Proactive command | | | MO_SHORT_MESSAGE | 2- No exception is | Display Text is | | | _CONTROL_BY_SIM | thrown. | fetched | | | | | | | | 1- A MO short | 3- No exception is | The terminal | | | message control by | thrown. | Response of | | | SIM envelope is | | DISPLAY TEXT is | | | sent to the (U)SIM | 5- Applet is | sent to the (U)SIM | | | | triggered | | | | 2- | | | | | EnvelopeHandl | 6- No exception is | | | | er.getTheHandler() | thrown and the | | | | method is called | handler contains | | | | | the envelope call | | | | 3- Copy the | control by SIM | | | | content of the | | | | | EnvelopeHandler in | 7- The contents of | | | | buffer1 using | the | | | | Enve | EnvelopeHandler | | | | lopeHandler.copy() | shall be the same | | | | | as stored in | | | | The | buffer1. | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with TAG_ADDRESS | | | | | | | | | | 4- A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5- Envelope call | | | | | control by SIM is | | | | | sent to the (U)SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6- Checked that | | | | | EnvelopeHandler | | | | | content is the | | | | | same as in | | | | | envelope call | | | | | control using | | | | | Enve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | Check that the | | | | | TAG_ADDRESS is | | | | | the TLV selected | | | | | | | | | | 7- The content of | | | | | EnvelopeHandler is | | | | | compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 7 | EnvelopeHandler | 1- Applet is | 4- 91 XX | | | integrity checks | triggered | | | | with | | Proactive command | | | EVENT_ | 2- No exception is | Display Text is | | | FORMATTED_SMS_CB | thrown. | fetched | | | | | | | | 1- A formatted | 3- No exception is | The terminal | | | cell broadcast | thrown. | Response of | | | envelope is sent | | DISPLAY TEXT is | | | to the (U)SIM | 5- Applet is | sent to the (U)SIM | | | | triggered | | | | 2- | | | | | EnvelopeHandl | 6- No exception is | | | | er.getTheHandler() | thrown and the | | | | method is called | handler contains | | | | | the envelope call | | | | 3- Copy the | control by SIM | | | | content of the | | | | | EnvelopeHandler in | 7- The contents of | | | | buffer1 using | the | | | | Enve | EnvelopeHandler | | | | lopeHandler.copy() | shall be the same | | | | | as stored in | | | | The | buffer1. | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_C | | | | | ELLBROADCAST_PAGE | | | | | | | | | | 4- A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5- Envelope call | | | | | control by SIM is | | | | | sent to the (U)SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6- Checked that | | | | | EnvelopeHandler | | | | | content is the | | | | | same as in | | | | | envelope call | | | | | control using | | | | | Enve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | Check that the | | | | | TAG_C | | | | | ELLBROADCAST_PAGE | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The content of | | | | | EnvelopeHandler is | | | | | compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 8 | EnvelopeHandler | 1- Applet is | 4- 91 XX | | | integrity checks | triggered | | | | with | | Proactive command | | | EVEN | 2- No exception is | Display Text is | | | T_FORMATTED_USSD | thrown. | fetched | | | | | | | | 1- A formatted | 3- No exception is | The terminal | | | USSD envelope is | thrown. | Response of | | | sent to the (U)SIM | | DISPLAY TEXT is | | | | 5- Applet is | sent to the (U)SIM | | | 2- | triggered | | | | EnvelopeHandl | | | | | er.getTheHandler() | 6- No exception is | | | | method is called | thrown and the | | | | | handler contains | | | | 3- Copy the | the envelope call | | | | content of the | control by SIM | | | | EnvelopeHandler in | | | | | buffer1 using | 7- The contents of | | | | Enve | the | | | | lopeHandler.copy() | EnvelopeHandler | | | | | shall be the same | | | | The | as stored in | | | | Envelop | buffer1 | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_USSD_STRING | | | | | | | | | | 4- A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5- Envelope call | | | | | control by SIM is | | | | | sent to the (U)SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6- Check that | | | | | EnvelopeHandler | | | | | content is the | | | | | same as in the | | | | | envelope call | | | | | control using | | | | | Enve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | Check that the | | | | | TAG_USSD_STRING | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The content of | | | | | EnvelopeHandler is | | | | | compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 9 | EnvelopeHandler | 1- Applet is | 4- 91 XX | | | integrity checks | triggered | | | | with | | Proactive command | | | EVENT\ | 2- No exception is | Display Text is | | | _UNFORMATTED_USSD | thrown. | fetched | | | | | | | | 1- A unformatted | 3- No exception is | The terminal | | | USSD envelope is | thrown. | Response of | | | sent to the (U)SIM | | DISPLAY TEXT is | | | | 5- Applet is | sent to the (U)SIM | | | 2- | triggered | | | | EnvelopeHandl | | | | | er.getTheHandler() | 6- No exception is | | | | method is called | thrown and the | | | | | handler contains | | | | 3- Copy the | the envelope call | | | | content of the | control by SIM | | | | EnvelopeHandler in | | | | | buffer1 using | 7- The contents of | | | | Enve | the | | | | lopeHandler.copy() | EnvelopeHandler | | | | | shall be the same | | | | The | as stored in | | | | Envel | buffer1. | | | | opeHandler.findTLV | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | 4- A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5- Envelope call | | | | | control by SIM is | | | | | sent to the (U)SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6- Check that | | | | | EnvelopeHandler | | | | | content is the | | | | | same as in the | | | | | envelope call | | | | | control using | | | | | Enve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | Check that the | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The content of | | | | | EnvelopeHandler is | | | | | compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 10 | EnvelopeHandler | 1- Applet is | 4- 91 XX | | | integrity checks | triggered | | | | with | | Proactive command | | | EV | 2- No exception is | Display Text is | | | ENT_DOWNLOAD_IWL | thrown. | fetched | | | AN_ACCESS_STATUS | | | | | | 3- No exception is | The terminal | | | 1- An Download | thrown. | Response of | | | Iwlan Access | | DISPLAY TEXT is | | | Status envelope is | 5- Applet is | sent to the (U)SIM | | | sent to the (U)SIM | triggered | | | | | | | | | 2- | 6- No exception is | | | | EnvelopeHandl | thrown and the | | | | er.getTheHandler() | handler contains | | | | method is called | the envelope call | | | | | control by SIM | | | | 3- Copy the | | | | | content of the | 7- The contents of | | | | EnvelopeHandler in | the | | | | buffer1 using | EnvelopeHandler | | | | Enve | shall be the same | | | | lopeHandler.copy() | as stored in | | | | | buffer1. | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_WL | | | | | AN_ACCESS_STATUS | | | | | (0x4B) | | | | | | | | | | 4- A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5- Envelope call | | | | | control by SIM is | | | | | sent to the (U)SIM | | | | | | | | | | EnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6- Checked that | | | | | EnvelopeHandler | | | | | content is the | | | | | same as in | | | | | envelope call | | | | | control using | | | | | Enve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | Envelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | Check that the | | | | | TAG_WL | | | | | AN_ACCESS_STATUS | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The content of | | | | | EnvelopeHandler is | | | | | compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+
#### 5.3.2.3 USATEnvelopeHandler
Test Area Reference: Ufw_Hin_Uehd
##### 5.3.2.3.1 Conformance requirements {#conformance-requirements-10 .H6}
##### 5.3.2.3.1.1 Normal execution {#normal-execution-37 .H6}
\- CRRN1: When available, the _USATEnvelopeHandler_ shall remain available and
its content shall remain unchanged from the invocation to the termination of
the _processToolkit()_ method.
\- CRRN2: The _USATEnvelopeHandler_ TLV list is filled with the Comprehension
TLV data objects of the ENVELOPE APDU command. The Comprehension TLV data
objects shall be provided in the order given in the ENVELOPE command data.
\- CRRN3: The (U)SAT Framework shall convert the UPDATE RECORD EF~SMS~ APDU
into a COMPREHENSION TLV List containing Device Identities TLV, Address TLV,
SMS TPDU TLV and AID TLV (only if the EF~SMS~ file updated is under an ADF).
\- CRRN4: The _getEnvelopeTag()_ method shall return BTAG_SMS_PP_DOWNLOAD.
\- CRRN5: The _getLength()_ method shall return the Comprehension TLV list
length.
\- CRRN6: The Device Identity Simple TLV is used to store the information
about the absolute record number in the EF~SMS~ file and the value of the
EF~SMS~ record status byte.
##### 5.3.2.3.1.2 Parameter errors {#parameter-errors-34 .H6}
No requirements.
##### 5.3.2.3.1.3 Context Errors {#context-errors-37 .H6}
No requirements.
##### 5.3.2.3.2 Test area files {#test-area-files-38 .H6}
Test Source: Test_Ufw_Hin_Uehd.java
Test Applet: Ufw_Hin_Uehd_1.java
Cap File: Ufw_Hin_Uehd.cap
##### 5.3.2.3.3 Test coverage {#test-coverage-38 .H6}
* * *
CRR Number Test Case Number N1 1 to 7, 14, 15, 16 N2 1 to 7, 14, 15, 16 N3 8,
11 N4 10, 13 N5 9, 12 N6 8, 11
* * *
##### 5.3.2.3.4 Test procedure {#test-procedure-38 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+--------------------+ | 1 | U | 1- Applet is | 4- 91 XX | | | SATEnvelopeHandler | triggered | | | | integrity checks | | Proactive command | | | with | 2- No exception is | Display Text is | | | EVENT_FORMA | thrown. | fetched | | | TTED_SMS_PP_ENV | | | | | | 3- No exception is | The terminal | | | 1- A formatted SMS | thrown. | Response of | | | PP envelope is | | DISPLAY TEXT is | | | sent to the (U)SIM | 5- Applet is | sent to the (U)SIM | | | | triggered | | | | 2- | | | | | USATEnvelopeHandl | 6- No exception is | | | | er.getTheHandler() | thrown and the | | | | method is called | handler contains | | | | | the envelope call | | | | 3- Copy the | control by SIM | | | | content of the | | | | | EnvelopeHandler in | 7- The contents of | | | | buffer1 using | the | | | | USATEnve | EnvelopeHandler | | | | lopeHandler.copy() | shall be the same | | | | | as stored in | | | | The | buffer1 | | | | USATEnvelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_SMS_TPDU | | | | | | | | | | 4- A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5- Envelope call | | | | | control by SIM is | | | | | sent to the (U)SIM | | | | | | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6- Check that | | | | | EnvelopeHandler | | | | | content is the | | | | | same as in the | | | | | envelope call | | | | | control using | | | | | USATEnve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | USATEnvelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | Check that the | | | | | TAG_SMS_TPDU is | | | | | the TLV selected | | | | | | | | | | 7- The content of | | | | | U | | | | | SATEnvelopeHandler | | | | | is compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 2 | U | 1- Applet is | 4- 91 XX | | | SATEnvelopeHandler | triggered | | | | integrity checks | | Proactive command | | | with | 2- No exception is | Display Text is | | | EVENT_FORMA | thrown. | fetched | | | TTED_SMS_PP_UPD | | | | | | 3- No exception is | The terminal | | | 1- Update Record | thrown. | Response of | | | EF~SMS~ | | DISPLAY TEXT is | | | instruction single | 5- Applet is | sent to the (U)SIM | | | and formatted is | triggered | | | | sent to the (U)SIM | | | | | | 6- No exception is | | | | 2- | thrown and the | | | | USATEnvelopeHandl | handler contains | | | | er.getTheHandler() | the envelope call | | | | method is called | control by SIM | | | | | | | | | 3- Copy the | 7- The contents of | | | | content of the | the | | | | EnvelopeHandler in | EnvelopeHandler | | | | buffer1 using | shall be the same | | | | USATEnve | as stored in | | | | lopeHandler.copy() | buffer1 | | | | | | | | | The | | | | | USATEnvelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_SMS_TPDU | | | | | | | | | | 4- A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5- Envelope call | | | | | control by SIM is | | | | | sent to the (U)SIM | | | | | | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6- Checked that | | | | | EnvelopeHandler | | | | | content is the | | | | | same as in | | | | | envelope call | | | | | control using | | | | | USATEnve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | USATEnvelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_SMS_TPDU | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | Checked that the | | | | | TAG_SMS_TPDU is | | | | | the TLV selected | | | | | | | | | | 7- The content of | | | | | U | | | | | SATEnvelopeHandler | | | | | is compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 3 | U | 1- Applet is | 4- 91 XX | | | SATEnvelopeHandler | triggered | | | | integrity checks | | Proactive command | | | with | 2- No exception is | Display Text is | | | EVENT_UNFORMA | thrown. | fetched | | | TTED_SMS_PP_ENV | | | | | | 3- No exception is | The terminal | | | 1- A unformatted | thrown. | Response of | | | SMS PP envelope is | | DISPLAY TEXT is | | | sent to the (U)SIM | 5- Applet is | sent to the (U)SIM | | | | triggered | | | | 2- | | | | | USATEnvelopeHandl | 6- No exception is | | | | er.getTheHandler() | thrown and the | | | | method is called | handler contains | | | | | the envelope call | | | | 3- Copy the | control by SIM | | | | content of the | | | | | EnvelopeHandler in | 7- The contents of | | | | buffer1 using | the | | | | USATEnve | EnvelopeHandler | | | | lopeHandler.copy() | shall be the same | | | | | as stored in | | | | The | buffer1. | | | | USATEnvel | | | | | opeHandler.findTLV | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | 4- A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5- Envelope call | | | | | control by SIM is | | | | | sent to the (U)SIM | | | | | | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6- Check that | | | | | EnvelopeHandler | | | | | content is the | | | | | same as in the | | | | | envelope call | | | | | control using | | | | | USATEnve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | USATEnvelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | Check that the | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The content of | | | | | U | | | | | SATEnvelopeHandler | | | | | is compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 4 | U | 1- Applet is | 4- 91 XX | | | SATEnvelopeHandler | triggered | | | | integrity checks | | Proactive command | | | with | 2- No exception is | Display Text is | | | EVENT_UNFORMA | thrown. | fetched | | | TTED_SMS_PP_UPD | | | | | | 3- No exception is | The terminal | | | 1- Update Record | thrown. | Response of | | | EF~SMS~ | | DISPLAY TEXT is | | | instruction single | 5- Applet is | sent to the (U)SIM | | | and unformatted is | triggered | | | | sent to the (U)SIM | | | | | | 6- No exception is | | | | 2- | thrown and the | | | | USATEnvelopeHandl | handler contains | | | | er.getTheHandler() | the envelope call | | | | method is called | control by SIM | | | | | | | | | 3- Copy the | 7- The contents of | | | | content of the | the | | | | EnvelopeHandler in | EnvelopeHandler | | | | buffer1 using | shall be the same | | | | USATEnve | as stored in | | | | lopeHandler.copy() | buffer1. | | | | | | | | | The | | | | | USATEnvel | | | | | opeHandler.findTLV | | | | | method is called | | | | | with | | | | | TAG_SMS_TPDU | | | | | | | | | | 4- A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5- Envelope call | | | | | control by SIM is | | | | | sent to the (U)SIM | | | | | | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6- Check that | | | | | EnvelopeHandler | | | | | content is the | | | | | same as in | | | | | envelope call | | | | | control using | | | | | USATEnve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | USATEnvelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | Check that the | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The content of | | | | | U | | | | | SATEnvelopeHandler | | | | | is compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 5 | U | 1- Applet is | 4- 91 XX | | | SATEnvelopeHandler | triggered | | | | integrity checks | | Proactive command | | | with | 2- No exception is | Display Text is | | | EVENT_UN | thrown. | fetched | | | FORMATTED_SMS_CB | | | | | | 3- No exception is | The terminal | | | 1- An unformatted | thrown. | Response of | | | cell broadcast | | DISPLAY TEXT is | | | envelope is sent | 5- Applet is | sent to the (U)SIM | | | to the (U)SIM | triggered | | | | | | | | | 2- | 6- No exception is | | | | USATEnvelopeHandl | thrown and the | | | | er.getTheHandler() | handler contains | | | | method is called | the envelope call | | | | | control by SIM | | | | 3- Copy the | | | | | content of the | 7- The contents of | | | | EnvelopeHandler in | the | | | | buffer1 using | EnvelopeHandler | | | | USATEnve | shall be the same | | | | lopeHandler.copy() | as stored in | | | | | buffer1. | | | | The | | | | | USATEnvelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_C | | | | | ELLBROADCAST_PAGE | | | | | | | | | | 4- A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5- Envelope call | | | | | control by SIM is | | | | | sent to the (U)SIM | | | | | | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6- Checked that | | | | | EnvelopeHandler | | | | | content is the | | | | | same as in | | | | | envelope call | | | | | control using | | | | | USATEnve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | USATEnvelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | Check that the | | | | | TAG_C | | | | | ELLBROADCAST_PAGE | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The content of | | | | | U | | | | | SATEnvelopeHandler | | | | | is compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 6 | U | 1- Applet is | 4- 91 XX | | | SATEnvelopeHandler | triggered | | | | integrity checks | | Proactive command | | | with EVENT_ | 2- No exception is | Display Text is | | | MO_SHORT_MESSAGE | thrown. | fetched | | | _CONTROL_BY_SIM | | | | | | 3- No exception is | The terminal | | | 1- A MO short | thrown. | Response of | | | message control by | | DISPLAY TEXT is | | | SIM envelope is | 5- Applet is | sent to the (U)SIM | | | sent to the (U)SIM | triggered | | | | | | | | | 2- | 6- No exception is | | | | USATEnvelopeHandl | thrown and the | | | | er.getTheHandler() | handler contains | | | | method is called | the envelope call | | | | | control by SIM | | | | 3- Copy the | | | | | content of the | 7- The contents of | | | | EnvelopeHandler in | the | | | | buffer1 using | EnvelopeHandler | | | | USATEnve | shall be the same | | | | lopeHandler.copy() | as stored in | | | | | buffer1. | | | | The | | | | | USATEnvelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with TAG_ADDRESS | | | | | | | | | | 4- A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5- Envelope call | | | | | control by SIM is | | | | | sent to the (U)SIM | | | | | | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6- Checked that | | | | | EnvelopeHandler | | | | | content is the | | | | | same as in | | | | | envelope call | | | | | control using | | | | | USATEnve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | USATEnvelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | Check that the | | | | | TAG_ADDRESS is | | | | | the TLV selected | | | | | | | | | | 7- The content of | | | | | U | | | | | SATEnvelopeHandler | | | | | is compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 7 | U | 1- Applet is | 4- 91 XX | | | SATEnvelopeHandler | triggered | | | | integrity checks | | Proactive command | | | with | 2- No exception is | Display Text is | | | EVENT_ | thrown. | fetched | | | FORMATTED_SMS_CB | | | | | | 3- No exception is | The terminal | | | 1- A formatted | thrown. | Response of | | | cell broadcast | | DISPLAY TEXT is | | | envelope is sent | 5- Applet is | sent to the (U)SIM | | | to the (U)SIM | triggered | | | | | | | | | 2- | 6- No exception is | | | | USATEnvelopeHandl | thrown and the | | | | er.getTheHandler() | handler contains | | | | method is called | the envelope call | | | | | control by SIM | | | | 3- Copy the | | | | | content of the | 7- The contents of | | | | EnvelopeHandler in | the | | | | buffer1 using | EnvelopeHandler | | | | USATEnve | shall be the same | | | | lopeHandler.copy() | as stored in | | | | | buffer1. | | | | The | | | | | USATEnvelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_C | | | | | ELLBROADCAST_PAGE | | | | | | | | | | 4- A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5- Envelope call | | | | | control by SIM is | | | | | sent to the (U)SIM | | | | | | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6- Checked that | | | | | EnvelopeHandler | | | | | content is the | | | | | same as in | | | | | envelope call | | | | | control using | | | | | USATEnve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | USATEnvelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | Check that the | | | | | TAG_C | | | | | ELLBROADCAST_PAGE | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The content of | | | | | U | | | | | SATEnvelopeHandler | | | | | is compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 8 | Check the TLV list | 1- Applet is | | | | conversion for | triggered. | | | | EVENT_FORMA | | | | | TTED_SMS_PP_UPD | 2- No exception is | | | | | thrown. | | | | 1- An | | | | | EVENT_FORMA | 3- return the | | | | TTED_SMS_PP_UPD | absolute record. | | | | is sent to the | | | | | (U)SIM. | 4- return the | | | | | record status. | | | | 2- The findTLV(tag | | | | | == device | 5- No exception is | | | | identities Tag) | thrown. | | | | method is called. | | | | | | 7- No exception is | | | | 3- The | thrown. | | | | g | | | | | etValueByte(offset | | | | | == 0) method is | | | | | called. | | | | | | | | | | 4- The | | | | | g | | | | | etValueByte(offset | | | | | == 1) method is | | | | | called. | | | | | | | | | | 5- The findTLV(tag | | | | | == address Tag) | | | | | method is called. | | | | | | | | | | 6- Check the | | | | | content. | | | | | | | | | | 7- The findTLV(tag | | | | | == SMS TPDU Tag) | | | | | method is called. | | | | | | | | | | 8- Check the | | | | | content. | | | +----+--------------------+--------------------+--------------------+ | 9 | getLength() call | return the | | | | | Comprehension TLV | | | | Call getLength() | list length | | | | method | | | +----+--------------------+--------------------+--------------------+ | 10 | getEnvelopeTag() | return | | | | call | _BTAG_ | | | | | SMS_PP_DOWNLOAD_ | | | | Call getTag() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 11 | Check the TLV list | 1- Applet is | | | | conversion for | triggered. | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_UPD | 2- No exception is | | | | | thrown. | | | | 1- An | | | | | EVENT_UNFORMA | 3- return the | | | | TTED_SMS_PP_UPD | absolute record. | | | | is sent to the | | | | | (U)SIM. | 4- return the | | | | | record status. | | | | 2- The findTLV(tag | | | | | == device | 5- No exception is | | | | identities Tag) | thrown. | | | | method is called. | | | | | | 7- No exception is | | | | 3- The | thrown. | | | | g | | | | | etValueByte(offset | | | | | == 0) method is | | | | | called. | | | | | | | | | | 4- The | | | | | g | | | | | etValueByte(offset | | | | | == 1) method is | | | | | called. | | | | | | | | | | 5- The findTLV(tag | | | | | == address Tag) | | | | | method is called. | | | | | | | | | | 6- Check the | | | | | content. | | | | | | | | | | 7- The findTLV(tag | | | | | == SMS TPDU Tag) | | | | | method is called. | | | | | | | | | | 8- Check the | | | | | content. | | | +----+--------------------+--------------------+--------------------+ | 12 | getLength() call | return the | | | | | Comprehension TLV | | | | Call getLength() | list length | | | | method | | | +----+--------------------+--------------------+--------------------+ | 13 | getEnvelopeTag() | return | | | | call | BTAG\ | | | | | _SMS_PP_DOWNLOAD | | | | Call | | | | | getEnvelopeTag() | | | | | method | | | +----+--------------------+--------------------+--------------------+ | 14 | U | 1- Applet is | 4- 91 XX | | | SATEnvelopeHandler | triggered | | | | integrity checks | | Proactive command | | | with | 2- No exception is | Display Text is | | | EVEN | thrown. | fetched | | | T_FORMATTED_USSD | | | | | | 3- No exception is | The terminal | | | 1- A formatted | thrown. | Response of | | | USSD envelope is | | DISPLAY TEXT is | | | sent to the (U)SIM | 5- Applet is | sent to the (U)SIM | | | | triggered | | | | 2- | | | | | USATEnvelopeHandl | 6- No exception is | | | | er.getTheHandler() | thrown and the | | | | method is called | handler contains | | | | | the envelope call | | | | 3- Copy the | control by SIM | | | | content of the | | | | | EnvelopeHandler in | 7- The contents of | | | | buffer1 using | the | | | | USATEnve | EnvelopeHandler | | | | lopeHandler.copy() | shall be the same | | | | | as stored in | | | | The | buffer1 | | | | USATEnvelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_USSD_STRING | | | | | | | | | | 4- A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5- Envelope call | | | | | control by SIM is | | | | | sent to the (U)SIM | | | | | | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6- Check that | | | | | EnvelopeHandler | | | | | content is the | | | | | same as in the | | | | | envelope call | | | | | control using | | | | | USATEnve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | USATEnvelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | Check that the | | | | | TAG_USSD_STRING | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The content of | | | | | U | | | | | SATEnvelopeHandler | | | | | is compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 15 | U | 1- Applet is | 4- 91 XX | | | SATEnvelopeHandler | triggered | | | | integrity checks | | Proactive command | | | with | 2- No exception is | Display Text is | | | EVENT\ | thrown. | fetched | | | _UNFORMATTED_USSD | | | | | | 3- No exception is | The terminal | | | 1- A unformatted | thrown. | Response of | | | USSD envelope is | | DISPLAY TEXT is | | | sent to the (U)SIM | 5- Applet is | sent to the (U)SIM | | | | triggered | | | | 2- | | | | | USATEnvelopeHandl | 6- No exception is | | | | er.getTheHandler() | thrown and the | | | | method is called | handler contains | | | | | the envelope call | | | | 3- Copy the | control by SIM | | | | content of the | | | | | EnvelopeHandler in | 7- The contents of | | | | buffer1 using | the | | | | USATEnve | EnvelopeHandler | | | | lopeHandler.copy() | shall be the same | | | | | as stored in | | | | The | buffer1. | | | | USATEnvel | | | | | opeHandler.findTLV | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | 4- A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5- Envelope call | | | | | control by SIM is | | | | | sent to the (U)SIM | | | | | | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6- Check that | | | | | EnvelopeHandler | | | | | content is the | | | | | same as in the | | | | | envelope call | | | | | control using | | | | | USATEnve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | USATEnvelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | Check that the | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The content of | | | | | U | | | | | SATEnvelopeHandler | | | | | is compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+ | 16 | U | 1- Applet is | 4- 91 XX | | | SATEnvelopeHandler | triggered | | | | integrity checks | | Proactive command | | | with | 2- No exception is | Display Text is | | | EV | thrown. | fetched | | | ENT_DOWNLOAD_IWL | | | | | AN_ACCESS_STATUS | 3- No exception is | The terminal | | | | thrown. | Response of | | | 1- A Download | | DISPLAY TEXT is | | | Iwlan Access | 5- Applet is | sent to the (U)SIM | | | Status envelope is | triggered | | | | sent to the (U)SIM | | | | | | 6- No exception is | | | | 2- | thrown and the | | | | USATEnvelopeHandl | handler contains | | | | er.getTheHandler() | the envelope call | | | | method is called | control by SIM | | | | | | | | | 3- Copy the | 7- The contents of | | | | content of the | the | | | | EnvelopeHandler in | EnvelopeHandler | | | | buffer1 using | shall be the same | | | | USATEnve | as stored in | | | | lopeHandler.copy() | buffer1. | | | | | | | | | The | | | | | USATEnvel | | | | | opeHandler.findTLV | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | 4- A proactive | | | | | command DISPLAY | | | | | TEXT is sent | | | | | | | | | | 5- Envelope call | | | | | control by SIM is | | | | | sent to the (U)SIM | | | | | | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | method is called | | | | | | | | | | 6- Check that | | | | | EnvelopeHandler | | | | | content is the | | | | | same as in the | | | | | envelope call | | | | | control using | | | | | USATEnve | | | | | lopeHandler.copy() | | | | | and | | | | | U | | | | | til.arrayCompare() | | | | | methods | | | | | | | | | | The | | | | | USATEnvelop | | | | | eHandler.findTLV() | | | | | method is called | | | | | with | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | | | | | | Call Control | | | | | execution is | | | | | finished. | | | | | | | | | | Check that the | | | | | TAG_ | | | | | DEVICE_IDENTITIES | | | | | is the TLV | | | | | selected | | | | | | | | | | 7- The content of | | | | | U | | | | | SATEnvelopeHandler | | | | | is compared with | | | | | buffer1 using | | | | | U | | | | | til.arrayCompare() | | | +----+--------------------+--------------------+--------------------+
### 5.3.3 Exception handling
#### 5.3.3.1 General Behaviour
Test Area Reference: Ufw_Exh_Genb
##### 5.3.3.1.1 Conformance requirement {#conformance-requirement-28 .H6}
##### 5.3.3.1.1.1 Normal execution {#normal-execution-38 .H6}
\- CRRN1: If more than one Applet shall be triggered by the currently
processed event all Exceptions shall be caught by the USAT Framework and shall
not be sent to the terminal. The USAT Framework shall proceed with the
triggering.
\- CRRN2: If only one Applet shall be triggered by the currently processed
event and an ISOException with the reason code REPLY_BUSY is thrown, it shall
be sent to the terminal using the Status Word 0x9300.
\- CRRN3: If only one Applet shall be triggered by the currently processed
event other Exceptions than an ISOException with the reason code REPLY_BUSY
shall not be propagated to the terminal.
##### 5.3.3.1.1.2 Parameter errors {#parameter-errors-35 .H6}
No requirements.
##### 5.3.3.1.1.3 Context errors {#context-errors-38 .H6}
No requirements.
##### 5.3.3.1.2 Test area files {#test-area-files-39 .H6}
Test Source: Test_Ufw_Exh_Genb.java
Test Applet: Ufw_Exh_Genb_1.java
Ufw_Exh_Genb_2.java
Cap File: ufw_exh_genb.cap
##### 5.3.3.1.3 Test coverage {#test-coverage-39 .H6}
* * *
CRR Number Test Case Number CRRN1 1, 2, 3, 4
* * *
##### 5.3.3.1.4 Test procedure {#test-procedure-39 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | 0 | Applet1 is | | | | | installed and | | | | | registers to | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_ENV | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | | | | | | EVEN | | | | | T_FORMATTED_USSD | | | | | | | | | | and | | | | | | | | | | Applet2 is | | | | | installed and | | | | | registers to | | | | | | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | and | | | | | EVENT_UN | | | | | FORMATTED_SMS_CB | | | | | | | | | | EVENT\ | | | | | _UNFORMATTED_USSD | | | +----+--------------------+--------------------+------------------+ | 1 | ISOException | 1- Applet1 is | 3- SW = 90 00 | | | REPLY_BUSY is not | triggered | | | | sent to the | | 5- SW = 90 00 | | | terminal in multi | 2- Applet1 sends a | | | | triggering | ISOException with | | | | | the reason code | | | | 1- Send an | REPLY_BUSY then | | | | envelope Event | finalizes | | | | Unformatted SMS PP | | | | | ENV (multi | Applet2 is | | | | triggering event, | triggered, does | | | | multi registered | nothing and | | | | applets) | finalizes | | | | | | | | | 4- Send an | 4- Applet1 is | | | | envelope Event | triggered, does | | | | Unformatted SMS PP | nothing and | | | | ENV (multi | finalizes | | | | triggering event, | | | | | multi registered | Applet2 is | | | | applets) | triggered, sends a | | | | | ISOException with | | | | | the reason code | | | | | REPLY_BUSY then | | | | | finalizes | | +----+--------------------+--------------------+------------------+ | 2 | ISOException | 1- Applet1 is | 1- SW = 93 00 | | | REPLY_BUSY is | triggered, sends a | | | | sent to the | ISOException with | 2- SW = 93 00 | | | terminal in single | the reason code | | | | triggering SMS PP | REPLY_BUSY then | | | | | finalizes | | | | 1- Send an | | | | | envelope Event | 2- Applet2 is | | | | formatted SMS PP | triggered, sends a | | | | ENV to trigger | ISOException with | | | | Applet1 (single | the reason code | | | | triggering event) | REPLY_BUSY then | | | | | finalizes | | | | 2- Send an | | | | | envelope Event | | | | | Unformatted SMS CB | | | | | (multi triggering | | | | | event, single | | | | | registered applet) | | | +----+--------------------+--------------------+------------------+ | 3 | Other exception | 1- Applet1 is | 1- SW = 90 00 | | | than ISOException | triggered, sends a | | | | REPLY_BUSY are | ISOException with | 2- SW = 90 00 | | | not sent to the | reason code | | | | terminal | different to | | | | | REPLY_BUSY then | | | | 1- Send an | finalizes | | | | envelope Event | | | | | formatted SMS PP | 2- Applet1 is | | | | ENV to trigger | triggered, sends a | | | | Applet1 (single | ToolkitException | | | | triggering event) | then finalizes | | | | | | | | | 2- Send an | | | | | envelope Event | | | | | formatted SMS PP | | | | | ENV to trigger | | | | | Applet1 (single | | | | | triggering event) | | | +----+--------------------+--------------------+------------------+ | 4 | ISOException | 1- Applet1 is | 1- SW = 93 00 | | | REPLY_BUSY is | triggered, sends a | | | | sent to the | ISOException with | 2- SW = 93 00 | | | terminal in single | the reason code | | | | triggering USSD | REPLY_BUSY then | | | | | finalizes | | | | 1- Send an | | | | | envelope Event | 2- Applet2 is | | | | formatted USSD to | triggered, sends a | | | | trigger Applet1 | ISOException with | | | | (single triggering | the reason code | | | | event) | REPLY_BUSY then | | | | | finalizes | | | | 2- Send an | | | | | envelope Event | | | | | unformatted SMS CB | | | | | (multi triggering | | | | | event, single | | | | | registered applet) | | | +----+--------------------+--------------------+------------------+
#### 5.3.3.2 Interaction with Multiple Triggering
Test Area Reference: Ufw_Exh_Imtg
##### 5.3.3.2.1 Conformance requirement {#conformance-requirement-29 .H6}
##### 5.3.3.2.1.1 Normal execution: {#normal-execution-39 .H6}
\- CRRN1: An exception thrown by a toolkit applet, will not influence toolkit
applets registered to the same event.
##### 5.3.3.2.1.2 Parameter errors {#parameter-errors-36 .H6}
No requirements.
##### 5.3.3.2.1.3 Context errors {#context-errors-39 .H6}
No requirements.
##### 5.3.3.2.2 Test area files {#test-area-files-40 .H6}
Test Source: Test_Ufw_Exh_Imtg.java
Test Applet: Ufw_Exh_Imtg_1.java
Ufw_Exh_Imtg_2.java
Cap File: ufw_exh_imtg.cap
##### 5.3.3.2.3 Test coverage {#test-coverage-40 .H6}
* * *
CRR Number Test Case Number CRRN1 1, 2, 3, 4
* * *
##### 5.3.3.2.4 Test procedure {#test-procedure-40 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | 0 | Load/install 2 | | | | | toolkit applets | | | | | registered to | | | | | EVENT_UNFORMAT | | | | | TED_SMS_PP_ENV, | | | | | EVENT_UNFORMAT | | | | | TED_SMS_PP_UPD, | | | | | EVENT_UNF | | | | | ORMATTED_SMS_CB, | | | | | | | | | | EVENT\ | | | | | _UNFORMATTED_USSD | | | | | | | | | | Applet1: Priority= | | | | | 0x01, | | | | | | | | | | Applet2: Priority= | | | | | 0x02, | | | | | | | | | | (i.e. Applet1 is | | | | | triggered before | | | | | Applet2) | | | +----+--------------------+--------------------+------------------+ | 1 | UNFORMA | 1- Applet1 is | | | | TTED_SMS_PP_ENV | triggered | | | | is sent | | | | | | 2- | | | | | Nu | | | | | llPointerException | | | | | is thrown | | | | | | | | | | 3- Applet2 is | | | | | triggered | | +----+--------------------+--------------------+------------------+ | 2 | UNFORMA | 1- Applet1 is | | | | TTED_SMS_PP_UPD | triggered | | | | is sent | | | | | | 2- | | | | | Nu | | | | | llPointerException | | | | | is thrown | | | | | | | | | | 3- Applet2 is | | | | | triggered | | +----+--------------------+--------------------+------------------+ | 3 | UN | 1- Applet1 is | | | | FORMATTED_SMS_CB | triggered | | | | is sent | | | | | | 2- | | | | | Nu | | | | | llPointerException | | | | | is thrown | | | | | | | | | | 3- Applet2 is | | | | | triggered | | +----+--------------------+--------------------+------------------+ | 4 | UNFORMATTED_USSD | 1- Applet1 is | | | | is send | triggered | | | | | | | | | | 2- | | | | | Nu | | | | | llPointerException | | | | | is thrown | | | | | | | | | | 3- Applet2 is | | | | | triggered | | +----+--------------------+--------------------+------------------+
### 5.3.4 Applet triggering
#### 5.3.4.1 EVENT_FORMATTED_SMS_PP_ENV
Test Area Reference: Ufw_Apt_Efse
##### 5.3.4.1.1 Conformance requirement {#conformance-requirement-30 .H6}
##### 5.3.4.1.1.1 Normal execution {#normal-execution-40 .H6}
\- CRRN1: The applet is triggered by the EVENT_FORMATTED_SMS_PP_ENV once:
\- it has been registered to this event;
\- a Short Message Point to Point (Single or Concatenated) is received by
Envelope APDU(s) and is formatted according to TS 31.115 [10];
\- the toolkit applet to be triggered is registered with the corresponding TAR
in the SMS TPDU;
\- the security is verified.
\- CRRN2: The applet is not triggered by the EVENT_FORMATTED_SMS_PP_ENV once
it has deregistered from this event.
##### 5.3.4.1.1.2 Parameters error {#parameters-error .H6}
No requirements.
##### 5.3.4.1.1.3 Context Errors {#context-errors-40 .H6}
No requirements.
##### 5.3.4.1.2 Test area files {#test-area-files-41 .H6}
Test Source: Test_Ufw_Apt_Efse.java
Test Applet: Ufw_Apt_Efse_1.java
Cap File: ufw_apt_efse.cap
##### 5.3.4.1.3 Test coverage {#test-coverage-41 .H6}
* * *
CRR Number Test Case Number CRRN1 (See note) 1, 2 CRRN2 2
* * *
NOTE: The security checks are not relevant to the test designed in this test
area; they will be checked in the \"Framework Security Management\" section.
##### 5.3.4.1.4 Test procedure {#test-procedure-41 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | 1 | Applet | 1- Applet is | | | | registration to | triggered | | | | EVENT | | | | | FORMA | 2- Applet is | | | | TTED_SMS_PP_ENV | triggered | | | | and triggering | | | | | | | | | | Applet is | | | | | registered to | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_ENV | | | | | and | | | | | EVENT_UNRE | | | | | COGNIZED_ENVELOPE | | | | | | | | | | 1- A Single Short | | | | | Message SMS-PP | | | | | Formatted Data | | | | | Download is sent | | | | | to the USIM. | | | | | | | | | | 2- A Concatenated | | | | | Short Message | | | | | SMS-PP Formatted | | | | | Data Download is | | | | | sent to the USIM | | | | | (composed of 2 | | | | | Short Messages. | | | | | The UDL for the | | | | | first Short | | | | | Message is 70 and | | | | | for the second 70) | | | +----+--------------------+--------------------+------------------+ | 2 | Applet | 1- Applet is not | | | | deregistration | triggered | | | | | | | | | ToolkitReg | 2- Applet is not | | | | istry.clearEvent() | triggered | | | | method is called | | | | | for | 3- Applet is | | | | EVENT_FORMA | triggered | | | | TTED_SMS_PP_ENV | | | | | | 4- Applet is | | | | 1- A Single Short | triggered | | | | Message SMS-PP | | | | | Data Download is | | | | | sent to the USIM. | | | | | | | | | | 2- A Concatenated | | | | | Short Messages | | | | | SMS-PP Data | | | | | Download is sent | | | | | to the USIM | | | | | (composed of 2 | | | | | Short Messages. | | | | | The UDL for the | | | | | first Short | | | | | Message is 70 and | | | | | for the second | | | | | 70). | | | | | | | | | | An unrecognized | | | | | envelope is sent | | | | | to the USIM | | | | | | | | | | ToolkitR | | | | | egistry.setEvent() | | | | | method is called | | | | | for | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_ENV | | | | | | | | | | 3- A Single Short | | | | | Messages SMS-PP | | | | | Data Download is | | | | | sent to the USIM. | | | | | | | | | | 4- A Concatenated | | | | | Short Messages | | | | | SMS-PP Data | | | | | Download is sent | | | | | to the USIM | | | | | (composed of 2 | | | | | Short Messages. | | | | | The UDL for the | | | | | first Short | | | | | Message is 70 and | | | | | for the second | | | | | 70). | | | +----+--------------------+--------------------+------------------+
#### 5.3.4.2 EVENT_UNFORMATTED_SMS_PP_ENV
Test Area Reference: Ufw_Apt_Euse
##### 5.3.4.2.1 Conformance requirement {#conformance-requirement-31 .H6}
##### 5.3.4.2.1.1 Normal execution {#normal-execution-41 .H6}
\- CRRN1: The applets registers are triggered by the
EVENT_UNFORMATTED_SMS_PP_ENV once a Short Message Point to Point (Single or
Concatenated) is received by Envelope APDU(s) and is unformatted.
\- CRRN2: The applet is not triggered by the EVENT_UNFORMATTED_SMS_PP_ENV once
it has deregistered from this event.
##### 5.3.4.2.1.2 Parameters error {#parameters-error-1 .H6}
No requirements.
##### 5.3.4.2.1.3 Context Errors {#context-errors-41 .H6}
No requirements.
##### 5.3.4.2.2 Test area files {#test-area-files-42 .H6}
Test Source: Test_Ufw_Apt_Euse.java
Test Applet: Ufw_Apt_Euse_1.java
Cap File: ufw_apt_euse.cap
##### 5.3.4.2.3 Test coverage {#test-coverage-42 .H6}
* * *
CRR Number Test Case Number CRRN1 1, 2 CRRN2 2
* * *
##### 5.3.4.2.4 Test procedure {#test-procedure-42 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | 1 | Applet | 1- The method | | | | registration to | returns true | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | 2- Applet is | | | | and triggering | triggered | | | | | | | | | Applet is | 3- Applet is | | | | registered to the | triggered | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | and | | | | | EVENT_FORMAT | | | | | TED_SMS_PP_ENV. | | | | | | | | | | 1-ToolkitReg | | | | | istry.isEventSet() | | | | | method is called | | | | | for | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | | | | | | 2- A Single and | | | | | Unformatted SMS-PP | | | | | Data Download | | | | | Envelope is sent | | | | | to the USIM. | | | | | | | | | | 3- A Concatenated | | | | | and Unformatted | | | | | SMS-PP Data | | | | | Download Envelope | | | | | is sent to the | | | | | USIM (composed of | | | | | 2 Short Messages. | | | | | The UDL for the | | | | | first Short | | | | | Message is 70 and | | | | | for the second 70) | | | +----+--------------------+--------------------+------------------+ | 2 | Applet | 1- Applet isn\'t | | | | deregistration | triggered | | | | | | | | | ToolkitRegistry. | 2- Applet isn\'t | | | | clearEvent()method | triggered | | | | is called for | | | | | EVENT_UNFORMA | 3- Applet is | | | | TTED_SMS_PP_ENV | triggered | | | | | | | | | 1- A Single and | 4- Applet is | | | | Unformatted SMS-PP | triggered | | | | Data Download | | | | | Envelope is sent | | | | | to the USIM. | | | | | | | | | | 2- A Concatenated | | | | | and Unformatted | | | | | SMS-PP Data | | | | | Download Envelope | | | | | is sent to the | | | | | USIM (composed of | | | | | 2 Short Messages. | | | | | The UDL for the | | | | | first Short | | | | | Message is 70 and | | | | | for the second 70) | | | | | | | | | | An unrecognized | | | | | envelope is sent | | | | | to the USIM | | | | | | | | | | ToolkitR | | | | | egistry.setEvent() | | | | | method is called | | | | | for | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | | | | | | 3- A Single and | | | | | Unformatted SMS-PP | | | | | Data Download | | | | | Envelope is sent | | | | | to the USIM. | | | | | | | | | | 4- A Concatenated | | | | | and Unformatted | | | | | SMS-PP Data | | | | | Download Envelope | | | | | is sent to the | | | | | USIM (composed of | | | | | 2 Short Messages. | | | | | The UDL for the | | | | | first Short | | | | | Message is 70 and | | | | | for the second 70) | | | +----+--------------------+--------------------+------------------+
#### 5.3.4.3 EVENT_FORMATTED_SMS_PP_UPD
Test Area Reference: Ufw_Apt_Efsu
##### 5.3.4.3.1 Conformance requirement {#conformance-requirement-32 .H6}
##### 5.3.4.3.1.1 Normal execution {#normal-execution-42 .H6}
\- CRRN1: The applet is triggered by the EVENT_FORMATTED_SMS_PP_UPD once:
\- it has been registered to this event,
\- a Short Message Point to Point (Single or Concatenated) is received by
Update Record EF~SMS~ APDU(s) and is formatted according to TS 31.115[10],
\- the toolkit applet to be triggered is registered with the corresponding TAR
in the SMS TPDU,
\- CRRN2: The applets are not triggered by the EVENT_FORMATTED_SMS_PP_UPD once
it has deregistered from this event.
##### 5.3.4.3.2 Test area files {#test-area-files-43 .H6}
Test Source: Test_Ufw_Apt_Efsu.java
Test Applet: Ufw_Apt_Efsu_1.java
Cap File: ufw_apt_efsu.cap
##### 5.3.4.3.3 Test coverage {#test-coverage-43 .H6}
* * *
CRR Number Test Case Number CRRN1 (See note) 1,2 CRRN2 2
* * *
NOTE: The security checks are not relevant to the test designed in this test
area; they will be checked in the \"Framework Security Management\" section.
##### 5.3.4.3.4 Test procedure {#test-procedure-43 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | 1 | Applet | 1- The method | | | | registration to | returns true. | | | | EVENT | | | | | FORMA | 2- Applet is | | | | TTED_SMS_PP_UPD | triggered. | | | | and triggering | | | | | | 3- Applet is | | | | Applet is | triggered on | | | | registered to | reception of the | | | | EVENT_FORMA | last concatenated | | | | TTED_SMS_PP_UPD | SMS | | | | and | | | | | EVENT_UNRE | | | | | COGNIZED_ENVELOPE | | | | | | | | | | 1. | | | | | ToolkitReg | | | | | istry.isEventSet() | | | | | method is called | | | | | for | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_UPD | | | | | | | | | | 2. Short Message | | | | | Point to Point | | | | | Single and | | | | | Formatted is | | | | | received by Update | | | | | Record EF~SMS~ | | | | | APDU. | | | | | | | | | | 3. Short Message | | | | | Point to Point | | | | | Concatenated | | | | | Formatted is | | | | | received by Update | | | | | Record EF~SMS~ | | | | | APDU(s) (The | | | | | Concatenated | | | | | Message is | | | | | composed of 2 | | | | | Short Messages. | | | | | The UDL for the | | | | | first Short | | | | | Message is 70 and | | | | | for the second | | | | | 70). | | | +----+--------------------+--------------------+------------------+ | 2 | Applet | 1- Applet is not | | | | deregistration | triggered | | | | | | | | | ToolkitReg | 2- Applet is not | | | | istry.clearEvent() | triggered | | | | method is called | | | | | for | 3- Applet is | | | | EVENT_FORMA | triggered | | | | TTED_SMS_PP_UPD | | | | | | 4- Applet is | | | | 1. Short Message | triggered on | | | | Point to Point | reception of the | | | | Single and | last concatenated | | | | Formatted is | SMS. | | | | received by Update | | | | | Record EF~SMS~ | | | | | APDU. | | | | | | | | | | 2. Short Message | | | | | Point to Point | | | | | Concatenated and | | | | | Formatted is | | | | | received by Update | | | | | Record EF~SMS~ | | | | | APDU(s). (The | | | | | Concatenated | | | | | Message is | | | | | composed of 2 | | | | | Short Messages. | | | | | The UDL for the | | | | | first Short | | | | | Message is 70 and | | | | | for the second | | | | | 70). | | | | | | | | | | An unrecognized | | | | | envelope is sent | | | | | to the USIM | | | | | | | | | | ToolkitR | | | | | egistry.setEvent() | | | | | method is called | | | | | for | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_UPD | | | | | | | | | | 3. Short Message | | | | | Point to Point | | | | | Single and | | | | | Formatted is | | | | | received by Update | | | | | Record EF~SMS~ | | | | | APDU. | | | | | | | | | | 4. Short Message | | | | | Point to Point | | | | | Concatenated | | | | | Formatted is | | | | | received by Update | | | | | Record EF~SMS~ | | | | | APDU(s). (The | | | | | Concatenated | | | | | Message is | | | | | composed of 2 | | | | | Short Messages. | | | | | The UDL for the | | | | | first Short | | | | | Message is 70 and | | | | | for the second | | | | | 70). | | | +----+--------------------+--------------------+------------------+
#### 5.3.4.4 EVENT_UNFORMATTED_SMS_PP_UPD
Test Area Reference: Ufw_Apt_Eusu
##### 5.3.4.4.1 Conformance requirement {#conformance-requirement-33 .H6}
##### 5.3.4.4.1.1 Normal execution {#normal-execution-43 .H6}
\- CRRN1: The applets registers are triggered by the
EVENT_UNFORMATTED_SMS_PP_UPD once a Short Message Point to Point (Single or
Concatenated) is received by Update Record EF~SMS~ APDU(s) and is unformatted.
\- CRRN2: The applets are not triggered by the EVENT_UNFORMATTED_SMS_PP_UPD
once it has deregistered from this event.
##### 5.3.4.4.2 Test area files {#test-area-files-44 .H6}
Test Source: Test_Ufw_Apt_Eusu.java
Test Applet: Ufw_Apt_Eusu_1.java
Cap File: ufw_apt_eusu.cap
##### 5.3.4.4.3 Test coverage {#test-coverage-44 .H6}
* * *
CRR Number Test Case Number CRRN1 1,2 CRRN2 2
* * *
##### 5.3.4.4.4 Test procedure {#test-procedure-44 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | 1 | Applet | 1- Applet is not | | | | registration to | triggered | | | | EVENT | | | | | UNFORMA | 2- Applet is | | | | TTED_SMS_PP_UPD | triggered. | | | | and triggering | | | | | | 3- Applet is | | | | Applet is | triggered on | | | | registered to | reception of the | | | | EVENT_UNFORMA | last concatenated | | | | TTED_SMS_PP_UPD | SMS. | | | | and | | | | | EVENT_UNRE | | | | | COGNIZED_ENVELOPE | | | | | | | | | | 1. | | | | | ToolkitReg | | | | | istry.isEventSet() | | | | | method is called | | | | | for | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_UPD | | | | | | | | | | 2. Short Message | | | | | Point to Point | | | | | Single and | | | | | Unformatted is | | | | | received by Update | | | | | Record EF~SMS~ | | | | | APDU | | | | | | | | | | 3. Short Message | | | | | Point to Point | | | | | Concatenated and | | | | | Unformatted is | | | | | received by Update | | | | | Record EF~SMS~ | | | | | APDU (The | | | | | Concatenated | | | | | Message is | | | | | composed of 2 | | | | | Short Messages. | | | | | The UDL for the | | | | | first Short | | | | | Message is 70 and | | | | | for the second | | | | | 70). | | | +----+--------------------+--------------------+------------------+ | 2 | Applet | 1- Applet is not | | | | deregistration | triggered | | | | | | | | | ToolkitReg | 2- Applet is not | | | | istry.clearEvent() | triggered. | | | | method is called | | | | | for | 3- Applet is | | | | EVENT_UNFORMA | triggered | | | | TTED_SMS_PP_UPD | | | | | | 4- Applet is | | | | 1. Short Message | triggered on | | | | Point to Point | reception of the | | | | Single and | last concatenated | | | | Unformatted is | SMS | | | | received by Update | | | | | Record EF~SMS~ | | | | | APDU | | | | | | | | | | 2. Short Message | | | | | Point to Point | | | | | Concatenated and | | | | | Unformatted is | | | | | received by Update | | | | | Record EF~SMS~ | | | | | APDU(s) (The | | | | | Concatenated | | | | | Message is | | | | | composed of 2 | | | | | Short Messages. | | | | | The UDL for the | | | | | first Short | | | | | Message is 70 and | | | | | for the second | | | | | 70). | | | | | | | | | | An unrecognized | | | | | envelope is sent | | | | | to the USIM | | | | | | | | | | ToolkitR | | | | | egistry.setEvent() | | | | | method is called | | | | | for | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_UPD | | | | | | | | | | 3. Short Message | | | | | Point to Point | | | | | Single and | | | | | Unformatted is | | | | | received by Update | | | | | Record EF~SMS~ | | | | | APDU | | | | | | | | | | 4. Short Message | | | | | Point to Point | | | | | Concatenated and | | | | | Unformatted is | | | | | received by Update | | | | | Record EF~SMS~ | | | | | APDU(s) (The | | | | | Concatenated | | | | | Message is | | | | | composed of 2 | | | | | Short Messages. | | | | | The UDL for the | | | | | first Short | | | | | Message is 70 and | | | | | for the second | | | | | 70). | | | +----+--------------------+--------------------+------------------+
#### 5.3.4.5 EVENT_FORMATTED_SMS_CB
Test Area Reference: Ufw_Apt_Efcb
##### 5.3.4.5.1 Conformance requirement {#conformance-requirement-34 .H6}
##### 5.3.4.5.1.1 Normal execution {#normal-execution-44 .H6}
\- CRRN1: The applet is triggered by the EVENT_FORMATTED_SMS_CB once:
\- it has been registered to this event;
\- an envelope APDU carrying a Cell Broadcast Page, formatted according to TS
31.115[10] , is received;
\- the toolkit applet to be triggered is registered with the corresponding TAR
in the CB page;
\- the security is verified.
\- CRRN2: The applet is not triggered by the EVENT_FORMATTED_SMS_CB once it
has deregistered from this event.
##### 5.3.4.5.1.2 Parameters error {#parameters-error-2 .H6}
No requirements.
##### 5.3.4.5.1.3 Context Errors {#context-errors-42 .H6}
No requirements.
##### 5.3.4.5.2 Test area files {#test-area-files-45 .H6}
Test Source: Test_Ufw_Apt_Efcb.java
Test Applet: Ufw_Apt_Efcb_1.java
Cap File: ufw_apt_efcb.cap
##### 5.3.4.5.3 Test coverage {#test-coverage-45 .H6}
* * *
CR Number Test Case Number CRRN1 (See note) 1, 2 CRRN2 2 NOTE: The security
checks are not relevant to the test designed in this test area; they will be
checked in subclause 6.3.6.
* * *
##### 5.3.4.5.4 Test procedure {#test-procedure-45 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | 1 | Applet | 1-Applet is | | | | registration to | triggered | | | | EVENT_ | | | | | FORMATTED_SMS_CB | | | | | and triggering | | | | | | | | | | Applet is | | | | | registered to | | | | | EVENT_ | | | | | FORMATTED_SMS_CB | | | | | and | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_ENV | | | | | | | | | | 1-An Envelope | | | | | EVENT_ | | | | | FORMATTED_SMS_CB | | | | | is sent to the | | | | | USIM. | | | +----+--------------------+--------------------+------------------+ | 2 | Applet | 1- Applet is not | | | | deregistration | triggered | | | | | | | | | ToolkitReg | 2- Applet is | | | | istry.clearEvent() | triggered | | | | method is called | | | | | for | 3- Applet is | | | | EVENT_ | triggered | | | | FORMATTED_SMS_CB | | | | | | | | | | 1-A formatted SMS | | | | | CB envelope is | | | | | sent to the USIM. | | | | | | | | | | 2-An envelope | | | | | SMS-PP formatted | | | | | is sent to the | | | | | USIM | | | | | | | | | | ToolkitR | | | | | egistry.setEvent() | | | | | method is called | | | | | for | | | | | EVENT_ | | | | | FORMATTED_SMS_CB | | | | | | | | | | 3-An Envelope | | | | | FORMATTED_SMS_CB | | | | | is sent to the | | | | | USIM | | | +----+--------------------+--------------------+------------------+
#### 5.3.4.6 EVENT_UNFORMATTED_SMS_CB
Test Area Reference: Ufw_Apt_Eucb
##### 5.3.4.6.1 Conformance requirement {#conformance-requirement-35 .H6}
##### 5.3.4.6.1.1 Normal execution {#normal-execution-45 .H6}
\- CRRN1: The applet is triggered by the EVENT_UNFORMATTED_SMS_CB once it has
registered to this event and an Envelope Cell Broadcast Download is received.
\- CRRN2: The applet is not triggered by the EVENT_UNFORMATTED_SMS_CB once it
has deregistered from this event.
##### 5.3.4.6.1.2 Parameters error {#parameters-error-3 .H6}
No requirements.
##### 5.3.4.6.1.3 Context Errors {#context-errors-43 .H6}
No requirements.
##### 5.3.4.6.2 Test area files {#test-area-files-46 .H6}
Test Source: Test_Ufw_Apt_Eucb.java
Test Applet: Ufw_Apt_Eucb_1.java
Cap File: ufw_apt_eucb.cap
##### 5.3.4.5.3 Test coverage {#test-coverage-46 .H6}
* * *
CRR Number Test Case Number CRRN1 1, 2 CRRN2 2
* * *
##### 5.3.4.6.4 Test procedure {#test-procedure-46 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | 1 | Applet | 1- Method returns | | | | registration to | true. | | | | EVENT_UN | | | | | FORMATTED_SMS_CB | 2- Applet is | | | | and triggering | triggered | | | | | | | | | Applet is | | | | | registered to the | | | | | EVENT_UN | | | | | FORMATTED_SMS_CB | | | | | and | | | | | EVENT_FORMAT | | | | | TED_SMS_PP_ENV. | | | | | | | | | | event= | | | | | EVENT_UN | | | | | FORMATTED_SMS_CB | | | | | | | | | | 1-ToolkitReg | | | | | istry.isEventSet() | | | | | method is called. | | | | | | | | | | 2-An Envelope | | | | | UN | | | | | FORMATTED_SMS_CB | | | | | is sent to the | | | | | USIM. | | | +----+--------------------+--------------------+------------------+ | 2 | Applet | 1- Applet isn\'t | | | | deregistration | triggered | | | | | | | | | ToolkitRegistry. | 2- Applet is | | | | ClearEvent()method | triggered | | | | is called for | | | | | EVENT_UN | | | | | FORMATTED_SMS_CB | | | | | | | | | | 1-An Envelope | | | | | UN | | | | | FORMATTED_SMS_CB | | | | | is sent to the | | | | | USIM. | | | | | | | | | | An Envelope | | | | | formatted SMS pp | | | | | envelope is sent | | | | | to the USIM | | | | | | | | | | event= | | | | | EVENT_UN | | | | | FORMATTED_SMS_CB | | | | | | | | | | ToolkitR | | | | | egistry.setEvent() | | | | | method is called | | | | | for | | | | | EVENT_UN | | | | | FORMATTED_SMS_CB | | | | | | | | | | 2-An Envelope | | | | | UN | | | | | FORMATTED_SMS_CB | | | | | is sent to the | | | | | USIM. | | | +----+--------------------+--------------------+------------------+
#### 5.3.4.7 EVENT_FORMATTED_USSD
Test Area Reference: Ufw_Apt_Efud
##### 5.3.4.7.1 Conformance requirement {#conformance-requirement-36 .H6}
##### 5.3.4.7.1.1 Normal execution {#normal-execution-46 .H6}
\- CRRN1: The applet is triggered by the EVENT_FORMATTED_USSD once:
\- it has been registered to this event;
> \- formatted according to TS 31.115 [10] or an other protocol to identify
> explicitly the toolkit applet for which the message is sent;
\- the toolkit applet to be triggered is registered with the corresponding TAR
in the USSD String TLV;
\- the security is verified.
\- CRRN2: The applet is not triggered by the EVENT_FORMATTED_USSD once it has
deregistered from this event.
##### 5.3.4.7.1.2 Parameters error {#parameters-error-4 .H6}
No requirements.
##### 5.3.4.7.1.3 Context Errors {#context-errors-44 .H6}
No requirements.
##### 5.3.4.7.2 Test area files {#test-area-files-47 .H6}
Test Source: Test_Ufw_Apt_ Efud.java
Test Applet: Ufw_Apt_ Efud _1.java
Cap File: ufw_apt_ Efud.cap
##### 5.3.4.7.3 Test coverage {#test-coverage-47 .H6}
* * *
CRR Number Test Case Number CRRN1 1,2 CRRN2 2
* * *
NOTE: The security checks are not relevant to the test designed in this test
area; they will be checked in the \"Framework Security Management\" section.
##### 5.3.4.7.4 Test coverage {#test-coverage-48 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | 1 | Applet | 1- Applet is | | | | registration to | triggered | | | | EVENT | | | | | FORMATTED_USSD | 2- Applet is | | | | and triggering | triggered | | | | | | | | | Applet is | | | | | registered to | | | | | EVEN | | | | | T_FORMATTED_USSD | | | | | and | | | | | EVENT_UNRE | | | | | COGNIZED_ENVELOPE | | | | | | | | | | 1- A Single USSD | | | | | Formatted Envelope | | | | | is sent to the | | | | | USIM. | | | | | | | | | | 2- A Concatenated | | | | | USSD is sent to | | | | | the USIM (composed | | | | | of 2 USSD | | | | | messages. The UDL | | | | | for the first | | | | | Short Message is | | | | | 70 and for the | | | | | second 70) | | | +----+--------------------+--------------------+------------------+ | | Applet | 1- Applet is not | | | | deregistration | triggered | | | | | | | | | ToolkitReg | 2- Applet is not | | | | istry.clearEvent() | triggered | | | | method is called | | | | | for | 3- Applet is | | | | EVEN | triggered | | | | T_FORMATTED_USSD | | | | | | 4- Applet is | | | | 1- A formatted | triggered | | | | USSD message is | | | | | sent to the USIM. | | | | | | | | | | 2- A Concatenated | | | | | USSD message is | | | | | sent to the USIM | | | | | (composed of 2 | | | | | USSD Messages. The | | | | | UDL for the first | | | | | USSD message is 70 | | | | | and for the second | | | | | 70). | | | | | | | | | | An unrecognized | | | | | envelope is sent | | | | | to the USIM | | | | | | | | | | ToolkitR | | | | | egistry.setEvent() | | | | | method is called | | | | | for | | | | | EVEN | | | | | T_FORMATTED_USSD | | | | | | | | | | 3- A Single | | | | | formatted USSD is | | | | | sent to the USIM. | | | | | | | | | | 4- A Concatenated | | | | | USSD message is | | | | | sent to the USIM | | | | | (composed of 2 | | | | | Messages. The UDL | | | | | for the first USSD | | | | | message is 70 and | | | | | for the second | | | | | 70). | | | +----+--------------------+--------------------+------------------+
#### 5.3.4.8 EVENT_UNFORMATTED_USSD
Test Area Reference: Ufw_Apt_Euud
##### 5.3.4.8.1 Conformance requirement {#conformance-requirement-37 .H6}
##### 5.3.4.8.1.1 Normal execution {#normal-execution-47 .H6}
\- CRRN1: The applets registers are triggered by the EVENT_UNFORMATTED_USSD
once a unformatted USSDis received by Envelope APDU(s) and is unformatted.
\- CRRN2: The applet is not triggered by the EVENT_UNFORMATTED_USSD once it
has deregistered from this event.
##### 5.3.4.8.1.2 Parameters error {#parameters-error-5 .H6}
No requirements.
##### 5.3.4.8.1.3 Context Errors {#context-errors-45 .H6}
No requirements.
##### 5.3.4.8.2 Test area files {#test-area-files-48 .H6}
Test Source: Test_Ufw_Apt_Euud.java
Test Applet: Ufw_Apt_Euud_1.java
Cap File: ufw_apt_euud.cap
##### 5.3.4.8.3 Test coverage {#test-coverage-49 .H6}
* * *
CRR Number Test Case Number CRRN1 1,2 CRRN2 2
* * *
##### 5.3.4.8.4 Test procedure {#test-procedure-47 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | 1 | Applet | 1- The method | | | | registration to | returns true | | | | EVENT\ | | | | | _UNFORMATTED_USSD | 2- Applet is | | | | and triggering | triggered | | | | | | | | | Applet is | 3- Applet is | | | | registered to the | triggered | | | | EVENT\ | | | | | _UNFORMATTED_USSD | | | | | and | | | | | EVEN | | | | | T_FORMATTED_USSD | | | | | | | | | | 1-ToolkitReg | | | | | istry.isEventSet() | | | | | method is called | | | | | for | | | | | EVENT\ | | | | | _UNFORMATTED_USSD | | | | | | | | | | 2- A Single and | | | | | Unformatted USSD | | | | | message is sent to | | | | | the USIM. | | | | | | | | | | 3- A Concatenated | | | | | and Unformatted | | | | | USSD message is | | | | | sent to the USIM | | | | | (composed of 2 | | | | | USSD messages. The | | | | | UDL for the first | | | | | message is 70 and | | | | | for the second 70) | | | +----+--------------------+--------------------+------------------+ | | Applet | 1- Applet is not | | | | deregistration | triggered | | | | | | | | | ToolkitRegistry. | 2- Applet is not | | | | clearEvent()method | triggered | | | | is called for | | | | | EVENT\ | 3- Applet is | | | | _UNFORMATTED_USSD | triggered | | | | | | | | | 1- A Single and | 4- Applet is | | | | Unformatted USSD | triggered | | | | message is sent to | | | | | the USIM. | | | | | | | | | | 2- A Concatenated | | | | | and Unformatted | | | | | USSD message is | | | | | sent to the USIM | | | | | (composed of 2 | | | | | USSD messages. The | | | | | UDL for the first | | | | | Message is 70 and | | | | | for the second 70) | | | | | | | | | | An unrecognized | | | | | envelope is sent | | | | | to the USIM | | | | | | | | | | ToolkitR | | | | | egistry.setEvent() | | | | | method is called | | | | | for | | | | | EVENT\ | | | | | _UNFORMATTED_USSD | | | | | | | | | | 3- A Single and | | | | | Unformatted USSD | | | | | Envelope is sent | | | | | to the USIM. | | | | | | | | | | 4- A Concatenated | | | | | and Unformatted | | | | | USSD Envelope is | | | | | sent to the USIM | | | | | (composed of 2 | | | | | messages. The UDL | | | | | for the first | | | | | message is 70 and | | | | | for the second 70) | | | +----+--------------------+--------------------+------------------+
### 5.3.5 Envelope response posting
#### 5.3.5.1 EVENT_MO_SHORT_MESSAGE_CONTROL_BY_SIM
Test Area Reference: Ufw_Erp_Emcn
##### 5.3.5.1.1 Conformance requirement {#conformance-requirement-38 .H6}
##### 5.3.5.1.1.1 Normal execution {#normal-execution-48 .H6}
\- CRRN1: The (U)SAT Framework can\'t reply busy when an Envelope(MO-Short
Message Control) is sent to the (U)SAT.
##### 5.3.6.2.1.2 Parameter errors {#parameter-errors-37 .H6}
No requirements.
##### 5.3.6.2.1.3 Context errors {#context-errors-46 .H6}
No requirements.
##### 5.3.5.1.2 Test area files {#test-area-files-49 .H6}
Test Source: Test_Ufw_Erp_Emcn.scr
Test Applet: Ufw_Erp_Emcn_1.java
Ufw_Erp_Emcn_2.java
Ufw_Erp_Emcn_3.java
Cap File: Ufw_Erp_Emcn.cap
##### 5.3.5.1.3 Test coverage {#test-coverage-50 .H6}
* * *
CRR Number Test Case Number CRRN1 1, 2
* * *
##### 5.3.5.1.4 Test procedure {#test-procedure-48 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+--------------------+ | 1 | Applet1 is | 1- Applet2 is | 3- The U(SAT) | | | registered on the | suspended | answers 91xx to | | | EVENT_M | | the | | | O_SHORT_MESSAGE\ | 2- Applet1 is | Envelope(MO-Short | | | _CONTROL_BY_SIM; | triggered. | Message Control) | | | Applet2 is | | | | | registered and | 5- Applet2 | The new | | | triggered on the | execution shall | TP_De | | | EVENT | continue. | stination_Address | | | _MENU_SELECTION. | | and | | | | | RP_De | | | 1- Applet2 invokes | | stination_Address | | | the method send() | | are retrieved. | | | and no fetch is | | | | | performed | | | | | | | | | | 2- Envelope(MO-SM | | | | | control) is sent | | | | | to the (U)SAT | | | | | | | | | | 3- Applet1 calls | | | | | the method | | | | | En | | | | | velopeResponseHand | | | | | ler.postAsBERTLV() | | | | | to change any | | | | | incoming | | | | | TP_De | | | | | stination_Address | | | | | and any | | | | | RP_De | | | | | stination_Address | | | | | of the Service | | | | | Center into +11 22 | | | | | 33 44 | | | | | | | | | | 4- A Fetch command | | | | | is sent to the | | | | | (U)SAT | | | | | | | | | | 5- A Terminal | | | | | Response command | | | | | is sent to the | | | | | (U)SAT | | | | | | | | | | 6- Delete Applet1 | | | | | & Applet2 | | | | | | | | | | 7- Install Applet3 | | | +----+--------------------+--------------------+--------------------+ | 2 | Applet3 is | 1- Applet3 is | 3- The U(SAT) | | | registered on both | suspended on the | answers 91xx to | | | the events | send() method | the | | | EVENT_ | | Envelope(MO-Short | | | MO_SHORT_MESSAGE | 2- Applet3 is | Message Control) | | | _CONTROL_BY_SIM | triggered on the | | | | and | EVENT_M | The new | | | EVENT | O_SHORT_MESSAGE\ | TP_De | | | _MENU_SELECTION. | _CONTROL_BY_SIM. | stination_Address | | | | | and | | | 1- Applet3 invokes | 5- Applet3 | RP_De | | | the method | execution shall | stination_Address | | | send()and no fetch | continue. | are retrieved. | | | is performed | | | | | | | | | | 2- Envelope(MO-SM | | | | | control) is sent | | | | | to the (U)SAT | | | | | | | | | | 3- Applet3 calls | | | | | the method | | | | | En | | | | | velopeResponseHand | | | | | ler.postAsBERTLV() | | | | | to change any | | | | | incoming | | | | | TP_De | | | | | stination_Address | | | | | and any | | | | | RP_De | | | | | stination_Address | | | | | of the Service | | | | | Center into +11 22 | | | | | 33 44. | | | | | | | | | | 4- A Fetch command | | | | | is sent to the | | | | | (U)SAT | | | | | | | | | | 5- A Terminal | | | | | Response command | | | | | is sent to the | | | | | (U)SAT | | | +----+--------------------+--------------------+--------------------+
### 5.3.6 Toolkit installation
#### 5.3.6.1 Minimum security level
Test Area Reference: ufw_tin_msl
##### 5.3.6.1.1 Conformance requirements {#conformance-requirements-11 .H6}
##### 5.3.6.1.1.1 Normal execution {#normal-execution-49 .H6}
\- CRRN1: The Receiving Entity shall check the Minimum Security Level during
processing the security of the Command Packet.
\- CRRN2: The Receiving Entity shall reject the message if the MSL check
fails.
\- CRRN3: If the MSL check fails, a Response Packet with the \'Insufficient
Security Level\' Response Status Code shall be sent if required.
\- CRRN4: If the length of the Minimum Security Level field is greater than
zero, the Minimum Security Level is used to specify the minimum level to be
applied to Secured Packets. The first byte shall be the MSL Parameter, other
bytes shall be the MSL Data.
\- CRRN5: If the length of the Minimum Security Level field is zero, no
minimum security level check shall be performed by the receiving entity.
##### 5.3.6.1.2 Test area files {#test-area-files-50 .H6}
Test source: Test_Ufw_Tin_Msl_1.java
Test Applet: Ufw_Tin_Msl_1.java
Cap file: ufw_tin_msl.cap
##### 5.3.6.1.3 Test coverage {#test-coverage-51 .H6}
* * *
CRR number Test case number CRRN1 Not applicable CRRN2 2, 4 CRRN3 2, 4 CRRN4
2, 4 CRRN5 1, 4
* * *
##### 5.3.6.1.4 Test procedure {#test-procedure-49 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+--------------------+ | 1 | Installation with | 2- Applet is | 1- SW = 9000 | | | MSL length of 0 | triggered | | | | | | | | | FORMA | 3- Applet is | | | | TTED_SMS_PP_ENV | triggered | | | | | | | | | 1- Install | | | | | (install) applet | | | | | with a MSL length | | | | | = 0 | | | | | | | | | | 2- Send formatted | | | | | SMS PP ENV with no | | | | | RC/CC/DS, no | | | | | Ciphering and | | | | | counter mode 0 | | | | | (not checked) | | | | | | | | | | 3- Send a | | | | | formatted SMS PP | | | | | ENV with CC, | | | | | ciphering and | | | | | counter mode 1 | | | | | (counter available | | | | | and no checking) | | | | | | | | | | 4- Delete the | | | | | applet instance | | | +----+--------------------+--------------------+--------------------+ | 2 | Installation with | 2- Applet is not | 1- SW = 9000 | | | correct MSL value | triggered | | | | | | 4- SW = 62 00, | | | FORMA | 3- Applet is | Response status | | | TTED_SMS_PP_ENV | triggered | code shall be | | | | | \'0A\', | | | 1- Install | 4- Applet is not | insufficient | | | (install) applet | triggered | security level. | | | with MSL field set | | | | | to 02 (CC needed). | | | | | | | | | | 2- Send formatted | | | | | SMS PP ENV with no | | | | | RC/CC/DS, no | | | | | Ciphering and | | | | | counter mode 0 | | | | | (not checked) | | | | | | | | | | 3- Send a | | | | | formatted SMS PP | | | | | ENV with CC, no | | | | | ciphering and | | | | | counter mode 1 | | | | | counter available | | | | | and no checking) | | | | | | | | | | 4- Send a | | | | | formatted SMS PP | | | | | ENV with PoR | | | | | required and no | | | | | CC, ciphered with | | | | | DES and counter | | | | | mode 0 counter | | | | | available and no | | | | | checking) | | | | | | | | | | 5- Delete the | | | | | applet instance | | | +----+--------------------+--------------------+--------------------+ | 3 | Installation with | 2- Applet is not | 1- SW = 9000 | | | MSL length of 0 | triggered | | | | | | | | | FORMATTED_USSD | 3- Applet is | | | | | triggered | | | | 1- Install | | | | | (install) applet | 4- Applet is not | | | | with a MSL length | triggered | | | | = 0 | | | | | | | | | | 2- Send formatted | | | | | ÚSSD with no | | | | | RC/CC/DS, no | | | | | Ciphering and | | | | | counter mode 0 | | | | | (not checked) | | | | | | | | | | 3- Send a | | | | | formatted USSD | | | | | with CC, ciphering | | | | | and counter mode 1 | | | | | (counter available | | | | | and no checking) | | | | | | | | | | 4- Delete the | | | | | applet instance | | | +----+--------------------+--------------------+--------------------+ | 4 | Installation with | 2- Applet is not | 1- SW = 9000 | | | correct MSL value | triggered | | | | | | 4- SW = 62 00, | | | FORMATTED_USSD | 3- Applet is | Response status | | | | triggered | code shall be | | | 1- Install | | \'0A\', | | | (install) applet | 4- Applet is not | insufficient | | | with MSL field set | triggered | security level | | | to 02 (CC needed). | | | | | | | | | | 2- Send formatted | | | | | SMS PP ENV with no | | | | | RC/CC/DS, no | | | | | Ciphering and | | | | | counter mode 0 | | | | | (not checked) | | | | | | | | | | 3- Send a | | | | | formatted SMS PP | | | | | ENV with CC, no | | | | | ciphering and | | | | | counter mode 1 | | | | | counter available | | | | | and no checking) | | | | | | | | | | 4- Send a | | | | | formatted SMS PP | | | | | ENV with PoR | | | | | required and no | | | | | CC, ciphered with | | | | | DES and counter | | | | | mode 0 counter | | | | | available and no | | | | | checking) | | | | | | | | | | 5- Delete the | | | | | applet instance | | | +----+--------------------+--------------------+--------------------+
#### 5.3.6.2 TAR
Test Area Reference: ufw_tin_tar
##### 5.3.6.2.1 Conformance requirements {#conformance-requirements-12 .H6}
##### 5.3.6.2.1.1 Normal execution {#normal-execution-50 .H6}
\- CRRN1: It is possible to define several TAR values at the installation of
the Toolkit Application .
\- CRRN2: If the length of the TAR value is zero, the TAR may be taken out of
the AID if any.
\- CRRN3: If the length of the TAR value is greater than zero then the
application instance shall be installed with the TAR value field defined in
parameter and the TAR indicated in the AID if any shall be ignored.
\- CRRN4: If the TAR value(s) is already assigned on the card for the Toolkit
Application instance the card shall return the status word \'6A 80\',
incorrect parameter in data field.
\- CRRN5: If the length of the TAR value(s) field is incorrect, the card shall
return the status word \'6A 80\', incorrect parameter in data field.
##### 5.3.6.2.2 Test area files {#test-area-files-51 .H6}
Test source: Test_Ufw_Tin_Tar_1.scr
Test Applet: ufw_tin_tar_1.java
Cap file: ufw_tin_tar.cap
##### 5.3.6.2.3 Test Coverage {#test-coverage-52 .H6}
* * *
CRR number Test case number CRRN1 1 CRRN2 2 CRRN3 3 CRRN4 4 CRRN5 5
* * *
##### 5.3.6.2.4 Test procedure {#test-procedure-50 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | 1 | Installation with | 2- Applet is | 1- SW = 9000 | | | several TAR value | triggered | | | | | | | | | FORMA | 3- Applet is | | | | TTED_SMS_PP_ENV | triggered | | | | | | | | | 1- Install | | | | | (install) applet | | | | | with no TAR | | | | | defined in the AID | | | | | but TAR values set | | | | | to 11 11 11, 22 22 | | | | | 22 | | | | | | | | | | 2- Send formatted | | | | | SMS PP ENV with | | | | | TAR set to 11 11 | | | | | 11. | | | | | | | | | | 3- Send formatted | | | | | SMS PP ENV with | | | | | TAR set to 22 22 | | | | | 22. | | | | | | | | | | 4- Delete the | | | | | applet instance. | | | +----+--------------------+--------------------+------------------+ | 2 | Installation | 2- Applet is | 1- SW = 9000 | | | without TAR value | triggered | | | | in install | | | | | parameter | | | | | | | | | | FORMATT | | | | | ED ___ SMS_PP_ENV | | | | | | | | | | 1- Install | | | | | (install) applet | | | | | with TAR value | | | | | length set to 0 in | | | | | install | | | | | parameters. | | | | | | | | | | 2- Send formatted | | | | | SMS PP ENV with | | | | | the TAR value | | | | | defined in applet | | | | | AID. | | | | | | | | | | 3- Delete the | | | | | applet instance | | | +----+--------------------+--------------------+------------------+ | 3 | Installation with | 2- Applet is not | | | | TAR value within | triggered. | | | | AID different from | | | | | the one define in | 3- Applet is | | | | install parameters | triggered | | | | | | | | | FORMATT | | | | | ED ___ SMS_PP_ENV | | | | | | | | | | 1- Install | | | | | (install) applet | | | | | with applet AID | | | | | TAR set to XX YY | | | | | ZZ and TAR value | | | | | set to 11 11 11. | | | | | | | | | | 2- Send formatted | | | | | SMS PP ENV with | | | | | the TAR value set | | | | | to the one defined | | | | | in applet AID. | | | | | | | | | | 3- Send formatted | | | | | SMS PP ENV with | | | | | the TAR value set | | | | | to 11 11 11. | | | +----+--------------------+--------------------+------------------+ | 4 | Installation with | 1- Applet is not | 1- SW = 6A80 | | | TAR value already | installed | | | | assigned | | | | | | | | | | FORMATT | | | | | ED ___ SMS_PP_ENV | | | | | | | | | | 1- Install | | | | | (install) applet | | | | | with no TAR in | | | | | applet AID and TAR | | | | | value in install | | | | | parameters set to | | | | | 11 11 11. | | | +----+--------------------+--------------------+------------------+ | 5 | Installation with | 1- Applet is not | 1- SW = 6A80 | | | incorrect TAR | installed | | | | value length in | | | | | install parameters | 2- Applet is not | | | | | installed | | | | FORMATT | | | | | ED ___ SMS_PP_ENV | | | | | | | | | | 1- Install | | | | | (install) applet | | | | | with no TAR in | | | | | applet AID and TAR | | | | | value length set | | | | | to 02 and TAR | | | | | value set to 11 | | | | | 11. | | | | | | | | | | 2- Install | | | | | (install) applet | | | | | with no TAR in | | | | | applet AID and TAR | | | | | value length set | | | | | to 05 and TAR | | | | | value set to 11 11 | | | | | 11,22 22. | | | +----+--------------------+--------------------+------------------+ | 7 | Installation with | 2- Applet is | 1- SW = 9000 | | | several TAR value | triggered | | | | | | | | | FORMATTED_USSD | 3- Applet is | | | | | triggered | | | | 1- Install | | | | | (install) applet | | | | | with no TAR | | | | | defined in the AID | | | | | but TAR values set | | | | | to 33 33 33, 44 44 | | | | | 44 | | | | | | | | | | 2- Send formatted | | | | | USSD with TAR set | | | | | to 33 33 33. | | | | | | | | | | 3- Send formatted | | | | | USSD with TAR set | | | | | to 44 44 44. | | | | | | | | | | 4- Delete the | | | | | applet instance. | | | +----+--------------------+--------------------+------------------+ | 8 | Installation | 2- Applet is | 1- SW = 9000 | | | without TAR value | triggered | | | | in install | | | | | parameter | | | | | | | | | | FORMATTED_USSD | | | | | | | | | | 1- Install | | | | | (install) applet | | | | | with TAR value | | | | | length set to 0 in | | | | | install | | | | | parameters. | | | | | | | | | | 2- Send formatted | | | | | USSD with the TAR | | | | | value defined in | | | | | applet AID. | | | | | | | | | | 3- Delete the | | | | | applet instance | | | +----+--------------------+--------------------+------------------+ | 9 | Installation with | 2- Applet is not | | | | TAR value within | triggered. | | | | AID different from | | | | | the one defined in | 3- Applet is | | | | install parameters | triggered | | | | | | | | | FORMATTED_USSD | | | | | | | | | | 1- Install | | | | | (install) applet | | | | | with applet AID | | | | | TAR set to XX YY | | | | | ZZ and TAR value | | | | | set to 33 33 33. | | | | | | | | | | 2- Send formatted | | | | | USSD with the TAR | | | | | value set to the | | | | | one defined in | | | | | applet AID. | | | | | | | | | | 3- Send formatted | | | | | USSD with the TAR | | | | | value set to 33 33 | | | | | 33. | | | +----+--------------------+--------------------+------------------+ | 10 | Installation with | 1- Applet is not | 1- SW = 6A80 | | | TAR value already | installed | | | | assigned | | | | | | | | | | FORMATTED ___ USSD | | | | | | | | | | 1- Install | | | | | (install) applet | | | | | with no TAR in | | | | | applet AID and TAR | | | | | value in install | | | | | parameters set to | | | | | 33 33 33. | | | +----+--------------------+--------------------+------------------+ | 11 | Installation with | 1- Applet is not | 1- SW = 6A80 | | | incorrect TAR | installed | | | | value length in | | | | | install parameters | 2- Applet is not | | | | | installed | | | | FORMATTED ___ USSD | | | | | | | | | | 1- Install | | | | | (install) applet | | | | | with no TAR in | | | | | applet AID and TAR | | | | | value length set | | | | | to 02 and TAR | | | | | value set to 11 | | | | | 11. | | | | | | | | | | 2- Install | | | | | (install) applet | | | | | with no TAR in | | | | | applet AID and TAR | | | | | value length set | | | | | to 05 and TAR | | | | | value set to 11 11 | | | | | 11,22 22. | | | +----+--------------------+--------------------+------------------+
#### 5.3.6.3 Access domain
Test Area Reference: ufw_tin_acdo
##### 5.3.6.3.1 Conformance requirements {#conformance-requirements-13 .H6}
##### 5.3.6.3.1.1 Normal execution {#normal-execution-51 .H6}
\- CRRN1: The USAT framework shall grant files access to the application
instance according to the USAT Framework access parameters.
\- CRRN2:The access rights granted to an application and defined in the access
parameter shall be independent from the access rights granted at the USAT
Framework/Terminal interface level.
\- CRRN3: If an application with access domain parameter set to \'FF\' tries
to access a file, the USAT framework shall throw an exception.
\- CRRN4: An application with access domain parameter set to \'00\' can
perform all actions on files, except the ones with NEVER access conditions.
\- CRRN5: If a requested Access Domain is not supported, the card shall return
the Status word \'6A 80\' to the Install(install) command.
\- CRRN6: The card shall at least support the following Access Domain
Parameter values:
\- \'00\' : Full access to the file system
\- \'02\' : UICC access mechanism
\- \'FF\' : No access to the file system
##### 5.3.6.3.2 Test area files {#test-area-files-52 .H6}
Test source: Test_Ufw_Tin_Acdo_1.java
Test Applet: Ufw_Tin_Acdo_1.java
Cap file: ufw_tin_acdo.cap
##### 5.3.6.3.3 Test coverage {#test-coverage-53 .H6}
* * *
CRR number Test case number CRRN1 1,2,3 CRRN2 1 CRRN3 2 CRRN4 3 CRRN5 Not
testable CRRN6 1,2,3
* * *
##### 5.3.6.3.4 Test procedure {#test-procedure-51 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | 1 | The access granted | 3- no exception is | | | | to an application | thrown | | | | shall be | | | | | independent from | | | | | the USAT | | | | | Framework/Terminal | | | | | interface | | | | | | | | | | 1- Install | | | | | (install) applet | | | | | with Access domain | | | | | parameter set to | | | | | PIN1 | | | | | | | | | | 2- Block PIN1 by | | | | | sending | | | | | unsuccessful | | | | | verify pin | | | | | command. | | | | | | | | | | 3- Trigger the | | | | | installed applet | | | | | and try to | | | | | increase EF_CUAC | | | | | file with | | | | | uicc | | | | | .access.increase() | | | | | method. | | | | | | | | | | 4- Delete the | | | | | applet instance. | | | +----+--------------------+--------------------+------------------+ | 2 | Access domain | 2- UICCException. | | | | parameter set to | Security_stat | | | | \'FF\' | us_Not_satisfied | | | | | is thrown | | | | 1- Install | | | | | (install) applet | | | | | with access domain | | | | | parameter set to | | | | | \'FF\'. | | | | | | | | | | 2- Trigger the | | | | | installed applet | | | | | and try to access | | | | | EF_TARU file with | | | | | uicc.a | | | | | ccess.readBinary() | | | | | method. | | | | | | | | | | 3- Delete the | | | | | applet instance | | | +----+--------------------+--------------------+------------------+ | 3 | Access domain | 2- No exception is | | | | parameter set to | thrown. | | | | \'00\' | | | | | | 3- UICCException. | | | | 1- Install | Security_stat | | | | (install) applet | us_Not_satisfied | | | | with access domain | is thrown | | | | parameter set to | | | | | \'00\'. | | | | | | | | | | 2- Trigger the | | | | | installed applet | | | | | and try to access | | | | | EF_TARU file | | | | | using | | | | | uicc.a | | | | | ccess.readBinary() | | | | | method. | | | | | | | | | | 3- Trigger the | | | | | applet and try to | | | | | access the EF_TNU | | | | | file using | | | | | uicc.acc | | | | | ess.updateBinary() | | | | | method. | | | | | | | | | | 4- Delete the | | | | | applet instance | | | +----+--------------------+--------------------+------------------+
### 5.3.7 Other parts transferred to (U)SAT framework from API
#### 5.3.7.1 A handler is a temporary JCRE Entry Point object
Test Area Reference: Ufw_Api_Hepo
##### 5.3.7.1.1 Conformance requirement {#conformance-requirement-39 .H6}
##### 5.3.7.1.1.1 Normal execution {#normal-execution-52 .H6}
\- CRRN1: The _USATEnvelopeHandler_ is a Temporary JCRE Entry Point Object
(see Java Card 2.2.1 Runtime Environment (JCRE) Specification [13]).
##### 5.3.7.1.1.2 Parameter errors {#parameter-errors-38 .H6}
No requirements.
##### 5.3.7.1.1.3 Context errors {#context-errors-47 .H6}
No requirements.
##### 5.3.7.1.2 Test area files {#test-area-files-53 .H6}
Test Source: Test_Ufw_Api_Hepo.java
Test Applet: Ufw_Api_Hepo_1.java
Cap File: Ufw_Api_Hepo.cap
##### 5.3.7.1.3 Test coverage {#test-coverage-54 .H6}
* * *
CRR number Test case number CRRN1 1, 2
* * *
##### 5.3.7.1.4 Test procedure {#test-procedure-52 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | 1 | Storage in a | SecurityException | | | | static object | is thrown | | | | | | | | | Call | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | method and store | | | | | it in a static | | | | | field of the | | | | | toolkit applet | | | +----+--------------------+--------------------+------------------+ | 2 | Storage in a | SecurityException | | | | non-static object | is thrown | | | | | | | | | Call | | | | | USATEnvelopeHandl | | | | | er.getTheHandler() | | | | | method and store | | | | | it in a non-static | | | | | field of the | | | | | toolkit applet | | | +----+--------------------+--------------------+------------------+
### 5.3.8 Framework security management
Security parameters
The table that follows contains the security parameters that shall be used
when the TS 31.115[10] security is required in the test cases developed in the
current subclause.
* * *
Parameter Value in hexadecimal KIC Value as described in the TS 31.115 [10]
(recommended value: 15) KID Value as described in the TS 31.115 [10]
(recommended value: 15) CNTR 00 00 00 00 01 Key for ciphering Corresponding to
KIC (recommended value: 01 41 42 7F DA E8 91 A7 02 41 42 7F DA E8 91 A7) Key
for RC/CC/DS Corresponding to KID (recommended value: 01 23 45 67 89 AB CD EF
EF CD AB 89 67 45 23 01)
* * *
If a parameter is not listed explicitly in the above table, the default values
of Annex B apply.
#### 5.3.8.1 Input data
Test Area Reference: ufw_fws_inda
##### 5.3.8.1.1 Conformance requirements {#conformance-requirements-14 .H6}
##### 5.3.8.1.1.1 Normal execution {#normal-execution-53 .H6}
\- CRRN1: If the USAT Framework receives an envelope APDU containing a Short
Message Point to Point formatted according to TS 31.115 [10], it shall verify
the security of the SMS TPDU and trigger the applet registered with the
corresponding TAR.
\- CRRN2: The toolkit applet will only be triggered if the TAR is known and
the security verified.
\- CRRN3: If the USAT Framework receives an envelope APDU containing a Short
message Cell Broadcast formatted according to TS 31.115 [10], it shall verify
the security of the cell broadcast page and trigger the applet registered with
the corresponding TAR.
\- CRRN4: If the USAT Framework receives an Update Record EF~SMS~ instruction
formatted according to TS 31.115 [10], it shall verify the security of the SMS
and trigger the applet registered with the corresponding TAR.
\- CRRN5: The USAT Framework shall provide the input data deciphered.
##### 5.3.8.1.1.2 Parameter errors {#parameter-errors-39 .H6}
No requirements.
##### 5.3.8.1.1.3 Context errors {#context-errors-48 .H6}
No requirements.
##### 5.3.8.1.2 Test area files {#test-area-files-54 .H6}
Test source: Test_ufw_fws_inda_1.java
Test Applet: ufw_fws_inda_1.java
ufw_fws_inda_2.java
ufw_fws_inda_3.java
ufw_fws_inda_4.java
ufw_fws_inda_5.java
ufw_fws_inda_6.java
Cap file: ufw_fws_inda.cap
##### 5.3.8.1.3 Test coverage {#test-coverage-55 .H6}
* * *
CRR Number Test Case Number CRRN1 1, 2, 3 CRRN2 3,6,9 CRRN3 4, 5, 6 CRRN4
7,8,9 CRRN5 1,2,4,5,7,8
* * *
##### 5.3.8.1.4 Test procedure {#test-procedure-53 .H6}
+-----+-------------------+-------------------+-------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +-----+-------------------+-------------------+-------------------+ | 1 | Framework checks | 1- Applet1 is | 1- The USAT | | | the Cryptographic | triggered and the | Framework answers | | | checksum and | value integrity | to the Envelope | | | deciphers the | is checked. | with status words | | | data | | 9000 | | | | 2- Applet1 is | | | | SMS-PP | triggered and the | 2- The USAT | | | | value integrity | Framework answers | | | Applet1 is loaded | is checked | to the Envelope | | | and installed | | with status words | | | | | 9000 | | | 1 | | | | | -Envelope(SMS-PP) | | | | | single and | | | | | formatted is sent | | | | | to the USAT | | | | | Framework with | | | | | this features: | | | | | | | | | | Ciphering; | | | | | | | | | | Cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet1; | | | | | | | | | | Data = 01 | | | | | | | | | | 2- Short Message | | | | | concatenated and | | | | | formatted is sent | | | | | to the USAT | | | | | Framework by an | | | | | Envelope (SMS | | | | | PP)with these | | | | | features: | | | | | | | | | | Ciphering; | | | | | | | | | | Cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet1; | | | | | | | | | | Data length is | | | | | 150. | | | +-----+-------------------+-------------------+-------------------+ | > 2 | Triggering two | 1- Applet1 is | 1- The USAT | | | different applets | triggered and the | Framework answers | | | with different | value integrity | to the Envelope | | | security | is checked | with status words | | | | | 9000 | | | Applet2 is | 2- Applet1 is | | | | installed | triggered and the | 2- The USAT | | | | value integrity | Framework answers | | | 1 | is checked | to the Envelope | | | -Envelope(SMS-PP) | | with status words | | | single and | 3- Applet2 is | 9000 | | | formatted is sent | triggered and the | | | | to the USAT | value integrity | 3- The USAT | | | Framework with | is checked | Framework answers | | | this features: | | to the Envelope | | | | 4- Applet2 is | with status words | | | Ciphering; | triggered and the | 9000 | | | | value integrity | | | | Cryptographic | is checked | 4- The USAT | | | checksum; | | Framework answers | | | | | to the Envelope | | | No proof of | | with status words | | | receipt; | | 9000 | | | | | | | | TAR of Applet1 | | | | | | | | | | Data = 03 | | | | | | | | | | 2- Short Message | | | | | concatenated and | | | | | formatted is sent | | | | | to the USAT | | | | | Framework by an | | | | | Envelope (SMS | | | | | PP)with these | | | | | features: | | | | | | | | | | Ciphering; | | | | | | | | | | Cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet1 | | | | | | | | | | Data length = 150 | | | | | | | | | | 3 | | | | | -Envelope(SMS-PP) | | | | | single and | | | | | formatted is sent | | | | | to the USAT | | | | | Framework with | | | | | this features: | | | | | | | | | | No ciphering; | | | | | | | | | | No cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet2 | | | | | | | | | | Data = 05 | | | | | | | | | | 4- Short Message | | | | | concatenated and | | | | | formatted is sent | | | | | to the USAT | | | | | Framework by an | | | | | Envelope (SMS | | | | | PP)with these | | | | | features: | | | | | | | | | | No ciphering; | | | | | | | | | | No cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet2 | | | | | | | | | | Data length = | | | | | 150. | | | +-----+-------------------+-------------------+-------------------+ | 3 | Envelope(SMS-PP) | 1- No applet is | 1- The USAT | | | formatted with | triggered. | Framework answers | | | wrong | | to the Envelope | | | cryptographic | 2- No applet is | with status words | | | checksum | triggered. | 9000 | | | | | | | | 1-Envelope 03.48 | | | | | single and | | | | | formatted is sent | | | | | to the USAT | | | | | Framework with | | | | | this features: | | | | | | | | | | No ciphering; | | | | | | | | | | Wrong | | | | | cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet1 | | | | | | | | | | Data = 07 | | | | | | | | | | 2- Short Message | | | | | concatenated and | | | | | formatted is sent | | | | | to the USAT | | | | | Framework by an | | | | | Envelope (SMS | | | | | PP)with these | | | | | features: | | | | | | | | | | No ciphering; | | | | | | | | | | Wrong | | | | | cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet1 | | | | | | | | | | Data length = 150 | | | +-----+-------------------+-------------------+-------------------+ | 4 | **Framework | 1- Applet3 is | 1- The USAT | | | checks the | triggered and the | Framework answers | | | Cryptographic | value integrity | to the Envelope | | | checksum and | is checked | with status words | | | deciphers the | | 9000 | | | data** | | | | | | | | | | Applet3 is loaded | | | | | and installed | | | | | | | | | | 1 | | | | | -Envelope(SMS-CB) | | | | | formatted is sent | | | | | to the USAT | | | | | Framework with | | | | | this features: | | | | | | | | | | Ciphering; | | | | | | | | | | Cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | Data = 01 | | | +-----+-------------------+-------------------+-------------------+ | 5 | **Triggering two | 1- Applet3 is | 1- The USAT | | | different applets | triggered and the | Framework answers | | | with different | value integrity | to the Envelope | | | security on | is checked | with status words | | | Envelope(SMS-CB) | | 9000 | | | formatted** | 2- Applet4 is | | | | | triggered and the | 2- The USAT | | | Applet4 is | value integrity | Framework answers | | | installed | is checked | to the Envelope | | | | | with status words | | | 1 | | 9000 | | | -Envelope(SMS-CB) | | | | | formatted is sent | | | | | to the USAT | | | | | Framework with | | | | | this features: | | | | | | | | | | Ciphering; | | | | | | | | | | Cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet3 | | | | | | | | | | Data = 02 | | | | | | | | | | 2 | | | | | -Envelope(SMS-CB) | | | | | formatted is sent | | | | | to the USAT | | | | | Framework with | | | | | this features: | | | | | | | | | | No ciphering; | | | | | | | | | | No cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet4 | | | | | | | | | | Data = 03 | | | +-----+-------------------+-------------------+-------------------+ | 6 | Envelope(SMS-CB) | No applet is | 1- The USAT | | | formatted with | triggered | Framework answers | | | wrong | | to the Envelope | | | cryptographic | | with status words | | | checksum | | 9000 | | | | | | | | No ciphering; | | | | | | | | | | Wrong | | | | | Cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet3 | | | | | | | | | | Data = 04 | | | +-----+-------------------+-------------------+-------------------+ | 7 | Framework checks | 1- Applet5 is | 1- The USAT | | | the Cryptographic | triggered and the | Framework answers | | | checksum and | value integrity | to the Update | | | deciphers the | is checked. | Record EF~SMS~ | | | data | | instruction with | | | | 2- Applet5 is | status words 9000 | | | Applet5 is | triggered and the | | | | installed | value integrity | 2- The USAT | | | | is checked | Framework answers | | | 1- Short Message | | to the Update | | | single and | | Record EF~SMS~ | | | formatted is sent | | instruction with | | | to the USAT | | status words 9000 | | | Framework by | | | | | Update Record | | | | | EF~SMS~ | | | | | instruction with | | | | | these features: | | | | | | | | | | Ciphering; | | | | | | | | | | Cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet5; | | | | | | | | | | Data = 01 | | | | | | | | | | 2- Short Message | | | | | concatenated and | | | | | formatted is sent | | | | | to the USAT | | | | | Framework by | | | | | Update Record | | | | | EF~SMS~ | | | | | instruction with | | | | | these features: | | | | | | | | | | Ciphering; | | | | | | | | | | Cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet5; | | | | | | | | | | Data length = | | | | | 150. | | | +-----+-------------------+-------------------+-------------------+ | 8 | Triggering two | 1- Applet5 is | 1- The USAT | | | different applets | triggered and the | Framework answers | | | with different | value integrity | to the Update | | | security | is checked. | Record EF~SMS~ | | | | | instruction with | | | Applet6 is | 2- Applet5 is | status words 9000 | | | installed | triggered and the | | | | | value integrity | 2- The USAT | | | 1- Short Message | is checked. | Framework answers | | | single and | | to the Update | | | formatted is sent | 3- Applet6 is | Record EF~SMS~ | | | to the USAT | triggered and the | instruction with | | | Framework by | value integrity | status words 9000 | | | Update Record | is checked. | | | | EF~SMS~ | | 3- The USAT | | | instruction with | 4- Applet6 is | Framework answers | | | these features: | triggered and the | to the Update | | | | value integrity | Record EF~SMS~ | | | Ciphering; | is checked. | instruction with | | | | | status words 9000 | | | Cryptographic | | | | | checksum; | | 4- The USAT | | | | | Framework answers | | | No proof of | | to the Update | | | receipt; | | Record EF~SMS~ | | | | | instruction with | | | TAR of Applet5 | | status words 9000 | | | | | | | | Data = 03 | | | | | | | | | | 2- Short Message | | | | | concatenated and | | | | | formatted is sent | | | | | to the USAT | | | | | Framework by | | | | | Update Record | | | | | EF~SMS~ | | | | | instruction with | | | | | these features: | | | | | | | | | | Ciphering; | | | | | | | | | | Cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet5 | | | | | | | | | | Data length = | | | | | 150. | | | | | | | | | | 3- Short Message | | | | | single and | | | | | formatted is sent | | | | | to the USAT | | | | | Framework by | | | | | Update Record | | | | | EF~SMS~ | | | | | instruction with | | | | | these features: | | | | | | | | | | No ciphering; | | | | | | | | | | No cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet6; | | | | | | | | | | Data = 05 | | | | | | | | | | 4- Short Message | | | | | concatenated and | | | | | formatted is sent | | | | | to the USAT | | | | | Framework by | | | | | Update Record | | | | | EF~SMS~ | | | | | instruction with | | | | | these features: | | | | | | | | | | No ciphering; | | | | | | | | | | No cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet6; | | | | | | | | | | Data length = | | | | | 150. | | | +-----+-------------------+-------------------+-------------------+ | 9 | Update Record | 1- No applet is | 1- The USAT | | | EF~SMS~ | triggered. | Framework answers | | | instruction | | to the Update | | | formatted with | 2- No applet is | Record EF~SMS~ | | | wrong | triggered. | instruction with | | | cryptographic | | status words 9000 | | | checksum | | | | | | | 2- The USAT | | | 1- Short Message | | Framework answers | | | single and | | to the Update | | | formatted is sent | | Record EF~SMS~ | | | to the USAT | | instruction with | | | Framework by | | status words 9000 | | | Update Record | | | | | EF~SMS~ | | | | | instruction with | | | | | these features: | | | | | No ciphering; | | | | | | | | | | Wrong | | | | | Cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet5 | | | | | | | | | | Data = 07 | | | | | | | | | | 2- Short Message | | | | | concatenated and | | | | | formatted is sent | | | | | to the USAT | | | | | Framework by | | | | | Update Record | | | | | EF~SMS~ | | | | | instruction with | | | | | these features: | | | | | | | | | | No ciphering; | | | | | | | | | | Wrong | | | | | Cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet5 | | | | | | | | | | Data length = 150 | | | +-----+-------------------+-------------------+-------------------+ | 10 | Framework checks | 1- Applet1 is | 1- The USAT | | | the Cryptographic | triggered and the | Framework answers | | | checksum and | value integrity | to the Envelope | | | deciphers the | is checked. | with status words | | | data | | 9000 | | | | 2- Applet1 is | | | | USSD | triggered and the | 2- The USAT | | | | value integrity | Framework answers | | | Applet1 is loaded | is checked | to the Envelope | | | and installed | | with status words | | | | | 9000 | | | 1-Envelope(USSD) | | | | | single and | | | | | formatted is sent | | | | | to the USAT | | | | | Framework with | | | | | this features: | | | | | | | | | | Ciphering; | | | | | | | | | | Cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet1; | | | | | | | | | | Data = 01 | | | | | | | | | | 2- USSD Message | | | | | concatenated and | | | | | formatted is sent | | | | | to the USAT | | | | | Framework by an | | | | | Envelope | | | | | (USDD)with these | | | | | features: | | | | | | | | | | Ciphering; | | | | | | | | | | Cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet1; | | | | | | | | | | Data length is | | | | | 150. | | | +-----+-------------------+-------------------+-------------------+ | 11 | **Triggering two | 1- Applet1 is | 1- The USAT | | | different applets | triggered and the | Framework answers | | | with different | value integrity | to the Envelope | | | security** | is checked | with status words | | | | | 9000 | | | **USSD** | 2- Applet1 is | | | | | triggered and the | 2- The USAT | | | Applet2 is | value integrity | Framework answers | | | installed | is checked | to the Envelope | | | | | with status words | | | 1-Envelope(USSD) | 3- Applet2 is | 9000 | | | single and | triggered and the | | | | formatted is sent | value integrity | 3- The USAT | | | to the USAT | is checked | Framework answers | | | Framework with | | to the Envelope | | | this features: | 4- Applet2 is | with status words | | | | triggered and the | 9000 | | | Ciphering; | value integrity | | | | | is checked | 4- The USAT | | | Cryptographic | | Framework answers | | | checksum; | | to the Envelope | | | | | with status words | | | No proof of | | 9000 | | | receipt; | | | | | | | | | | TAR of Applet1 | | | | | | | | | | Data = 03 | | | | | | | | | | 2- Short Message | | | | | concatenated and | | | | | formatted is sent | | | | | to the USAT | | | | | Framework by an | | | | | Envelope | | | | | (USSD)with these | | | | | features: | | | | | | | | | | Ciphering; | | | | | | | | | | Cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet1 | | | | | | | | | | Data length = 150 | | | | | | | | | | 3-Envelope(USSD) | | | | | single and | | | | | formatted is sent | | | | | to the USAT | | | | | Framework with | | | | | this features: | | | | | | | | | | No ciphering; | | | | | | | | | | No cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet2 | | | | | | | | | | Data = 05 | | | | | | | | | | 4- Concatenated | | | | | and formatted | | | | | USSD is sent to | | | | | the USAT | | | | | Framework by an | | | | | Envelope | | | | | (USSD)with these | | | | | features: | | | | | | | | | | No ciphering; | | | | | | | | | | No cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet2 | | | | | | | | | | Data length = | | | | | 150. | | | +-----+-------------------+-------------------+-------------------+ | 12 | USSD formatted | 1- No applet is | 1- The USAT | | | with wrong | triggered. | Framework answers | | | cryptographic | | to the Envelope | | | checksum | 2- No applet is | with status words | | | | triggered. | 9000 | | | USSD | | | | | | | | | | 1-Formatted USSD | | | | | is sent to the | | | | | USAT Framework | | | | | with this | | | | | features: | | | | | | | | | | No ciphering; | | | | | | | | | | Wrong | | | | | cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet1 | | | | | | | | | | Data = 07 | | | | | | | | | | 2- USSD | | | | | concatenated and | | | | | formatted is sent | | | | | to the USAT | | | | | Framework by an | | | | | Envelope | | | | | (USSD)with these | | | | | features: | | | | | | | | | | No ciphering; | | | | | | | | | | Wrong | | | | | cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | TAR of Applet1 | | | | | | | | | | Data length = 150 | | | +-----+-------------------+-------------------+-------------------+ | 13 | **Framework | 1- Applet3 is | 1- The USAT | | | checks the | triggered and the | Framework answers | | | Cryptographic | value integrity | to the Envelope | | | checksum and | is checked | with status words | | | deciphers the | | 9000 | | | data** | | | | | | | | | | **USSD** | | | | | | | | | | Applet3 is loaded | | | | | and installed | | | | | | | | | | 1-USSD formatted | | | | | is sent to the | | | | | USAT Framework | | | | | with this | | | | | features: | | | | | | | | | | Ciphering; | | | | | | | | | | Cryptographic | | | | | checksum; | | | | | | | | | | No proof of | | | | | receipt; | | | | | | | | | | Data = 01 | | | +-----+-------------------+-------------------+-------------------+
#### 5.3.8.2 Output data
Test Area Reference: ufw_fws_ouda
##### 5.3.8.2.1 Conformance requirements {#conformance-requirements-15 .H6}
##### 5.3.8.2.1.1 Normal execution {#normal-execution-54 .H6}
\- CRRN1: The USAT Framework Toolkit Framework shall secure and send the
response packet.
##### 5.3.8.2.1.2 Parameters errors {#parameters-errors .H6}
No requirements.
##### 5.3.8.2.1.3 Context errors {#context-errors-49 .H6}
No requirements.
##### 5.3.8.2.2 Test Area Files {#test-area-files-55 .H6}
Test source: Test_Ufw_Fws_Ouda_1.java
Test Applet: Ufw_Fws_Ouda_1.java
Cap file: Ufw_Fws_Ouda.cap
##### 5.3.8.2.3 Test coverage {#test-coverage-56 .H6}
* * *
CRR Number Test Case Number CRRN1 1, 2, 3, 4
* * *
##### 5.3.8.2.4 Test procedure {#test-procedure-54 .H6}
+----+--------------------+--------------------+--------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+--------------------+ | 1 | Envelope(SMS-PP) | The applet is | The USAT Framework | | | formatted | triggered and | answers to the | | | | sends a \"Display | Envelope with a | | | Ciphering; | Text\" proactive | PoR which is | | | | command with the | retrieved and | | | Cryptographic | data received in | checked. | | | checksum; | the Envelope. | | | | | | The PoR has no | | | proof of receipt | | application data. | | | response shall be | | | | | sent using | | The USAT Framework | | | S | | answers with | | | MS-Deliver-Report; | | status words 91xx | | | | | to issue a Display | | | no security | | Text \"APPLET1\". | | | applied to proof | | | | | of receipt | | | | | | | | | | Data in plain text | | | | | = \"APPLET1\" | | | +----+--------------------+--------------------+--------------------+ | 2 | Envelope(SMS-PP) | The applet posts | The USAT Framework | | | formatted | application data. | answers to the | | | | It does not call | Envelope with a | | | Ciphering; | the | PoR which is | | | | Proac | retrieved and | | | Cryptographic | tiveHandler.send() | checked. | | | checksum; | method | | | | | | The PoR has the | | | proof of receipt | | application data | | | response shall be | | posted by the | | | sent using | | application. | | | S | | | | | MS-Deliver-Report; | | | | | | | | | | no security | | | | | applied to proof | | | | | of receipt | | | | | | | | | | Data in plain text | | | | | = \"APPLET1\" | | | +----+--------------------+--------------------+--------------------+ | 3 | Envelope(SMS-PP) | The applet posts | The USAT Framework | | | formatted | application data | answers to the | | | | and calls the | Envelope with a | | | Ciphering; | Proac | PoR which is | | | | tiveHandler.send() | retrieved and | | | Cryptographic | method to send a | checked. The PoR | | | checksum; | \"Display Text\" | has the | | | | proactive command | application data | | | proof of receipt | with the data | posted by the | | | response shall be | received in the | application. | | | sent using | Envelope. | | | | S | | The USAT Framework | | | MS-Deliver-Report; | | answers with | | | | | status words 91xx | | | no security | | to issue the | | | applied to proof | | Display Text | | | of receipt | | \"TEST\". | | | | | | | | Data in plain text | | | | | = \"TEST\" | | | +----+--------------------+--------------------+--------------------+ | 4 | Envelope(SMS-PP) | The applet posts | The USAT Framework | | | formatted | application data | answers to the | | | | and calls the | Envelope with a | | | Ciphering; | Proac | PoR which is | | | | tiveHandler.send() | retrieved and | | | Cryptographic | method to send a | checked. The PoR | | | checksum; | \"Display Text\" | has the | | | | proactive command | application data | | | proof of receipt | with the data | posted by the | | | response shall be | received in the | application. | | | sent using | Envelope. | | | | S | | The USAT Framework | | | MS-Deliver-Report; | | answers with | | | | | status words 91xx | | | proof of receipt | | to issue the | | | shall be ciphered | | Display Text | | | | | \"TEST\". | | | Data in plain text | | | | | = \"TEST\" | | | +----+--------------------+--------------------+--------------------+ | 5 | Envelope(USSD) | The applet is | The USAT Framework | | | formatted | triggered and | answers to the | | | | sends a \"Display | Envelope with a | | | Ciphering; | Text\" proactive | PoR which is | | | | command with the | retrieved and | | | Cryptographic | data received in | checked. | | | checksum; | the Envelope. | | | | | | The PoR has no | | | proof of receipt | | application data. | | | response shall be | | | | | sent and no | | The USAT Framework | | | security shall be | | answers with | | | applied | | status words 91xx | | | | | to issue a Display | | | Data in plain text | | Text \"APPLET1\". | | | = \"APPLET1\" | | | +----+--------------------+--------------------+--------------------+ | 6 | Envelope(USSD) | The applet posts | The USAT Framework | | | formatted | application data. | answers to the | | | | It does not call | Envelope with a | | | Ciphering; | the | PoR which is | | | | Proac | retrieved and | | | Cryptographic | tiveHandler.send() | checked. | | | checksum; | method | | | | | | The PoR has the | | | proof of receipt | | application data | | | response shall be | | posted by the | | | sent using | | application. | | | S | | | | | MS-Deliver-Report; | | | | | | | | | | no security | | | | | applied to proof | | | | | of receipt | | | | | | | | | | Data in plain text | | | | | = \"APPLET1\" | | | +----+--------------------+--------------------+--------------------+ | 7 | Envelope(USSD) | The applet posts | The USAT Framework | | | formatted | application data | answers to the | | | | and calls the | Envelope with a | | | Ciphering; | Proac | PoR which is | | | | tiveHandler.send() | retrieved and | | | Cryptographic | method to send a | checked. The PoR | | | checksum; | \"Display Text\" | has the | | | | proactive command | application data | | | proof of receipt | with the data | posted by the | | | response shall be | received in the | application. | | | sent and no | Envelope. | | | | security applied | | The USAT Framework | | | to proof of | | answers with | | | receipt | | status words 91xx | | | | | to issue the | | | Data in plain text | | Display Text | | | = \"TEST\" | | \"TEST\". | +----+--------------------+--------------------+--------------------+ | 8 | Envelope(USSD) | The applet posts | The USAT Framework | | | formatted | application data | answers to the | | | | and calls the | Envelope with a | | | Ciphering; | Proac | PoR which is | | | | tiveHandler.send() | retrieved and | | | Cryptographic | method to send a | checked. The PoR | | | checksum; | \"Display Text\" | has the | | | | proactive command | application data | | | proof of receipt | with the data | posted by the | | | response shall be | received in the | application. | | | sent and it shall | Envelope. | | | | be ciphered | | The USAT Framework | | | | | answers with | | | Data in plain text | | status words 91xx | | | = \"TEST\" | | to issue the | | | | | Display Text | | | | | \"TEST\". | +----+--------------------+--------------------+--------------------+
### 5.3.9 Concatenated SMS
#### 5.3.9.1 Concatenation processing
Test Area Reference: Ufw_Csm_Proc
##### 5.3.9.1.1 Conformance requirements: {#conformance-requirements-16 .H6}
##### 5.3.9.1.1.1 Normal execution {#normal-execution-55 .H6}
\- CRRN1: When a Short Message is received as a Concatenated Short Message as
defined in TS 23.040 [11], it is the responsibility of the (U)SAT Framework to
link single Short Messages to reassemble the original message before any
further processing.
\- CRRN2: The concatenation control headers, used to reassemble the short
messages in the correct order, shall not be present in the SMS TPDU.
\- CRRN3: The TP-elements of the SMS TPDU and the Address (TS-Service-Centre-
Address) shall correspond to the ones in the last received Short Message
(independently of the Sequence number of Information-Element-Data).
\- CRRN4: The original Short Message shall be placed in one SMS TPDU TLV (with
TP-UDL field coded on one octet) included in the USATEnvelopeHandler.
\- CRRN5: The (U)SAT Framework shall be able to process messages with the
following properties as a minimum requirement:
\- the Information Element Identifier is equal to the 8-bit reference number
\- it contains uncompressed 8 bit data or uncompressed UCS2 data
#### 5.3.9.2 Test area files
Test Source: Test_Ufw_Csm_Proc.java
Test Applet: Ufw_Csm_Proc_1.java
Cap File: ufw_csm_proc.cap
#### 5.3.9.3 Test coverage
* * *
CRR number Test case number N1 1,2, 3, 4, , 7, 8, 9,10, , 13, 14, 15, 18, 19,
21, 22 N2 5,17 N3 8,11, 20, 19 N4 5,17 N5 12,24
* * *
#### 5.3.9.4 Test procedure
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | | Applet | | | | | registration to | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_ENV | | | | | and triggering | | | | | | | | | | Applet is | | | | | registered to | | | | | EVENT_FORMA | | | | | TTED_SMS_PP_ENV | | | | | and | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | events | | | | | | | | | | A concatenated | | | | | formatted SMS_PP | | | | | is sent to the | | | | | (U)SIM (composed | | | | | of three | | | | | segments). | | | +----+--------------------+--------------------+------------------+ | 1 | The second segment | Applet is not | | | | of a concatenated | triggered. | | | | short message is | | | | | sent to the | | | | | (U)SIM. | | | +----+--------------------+--------------------+------------------+ | 2 | The first segment | Applet is not | | | | of the | triggered. | | | | concatenated short | | | | | message is sent to | | | | | the (U)SIM. | | | +----+--------------------+--------------------+------------------+ | 3 | The third segment | Applet is | | | | of the | triggered. | | | | concatenated short | | | | | message is send to | | | | | the (U)SIM | | | +----+--------------------+--------------------+------------------+ | 4 | Call | No exception is | | | | USATEn | thrown. | | | | velopeHandlerSyste | | | | | m.getTheHandler(). | | | +----+--------------------+--------------------+------------------+ | 5 | Call the | Check that the | | | | USATEnvelop | message has been | | | | eHandler.findTLV() | re-assembled in | | | | to select the Dev | the correct order. | | | | Id, the address | Check that TP-UDL | | | | and the TPDU TLV | field is coded in | | | | and the | one octet. Check | | | | USATEnvelopeHand | that the | | | | ler.compareValue() | concatenation | | | | to check each | control header is | | | | content. | not present in the | | | | | message. Check the | | | | | integrity of the | | | | | message. | | +----+--------------------+--------------------+------------------+ | 6 | A new concatenated | Applet is | | | | formatted short | triggered. | | | | message is sent to | | | | | the USIM composed | | | | | of three segments. | | | | | The Address fields | | | | | of the first, | | | | | second and the | | | | | third segment are | | | | | different. | | | +----+--------------------+--------------------+------------------+ | 7 | Call | No exception is | | | | USATEn | thrown. | | | | velopeHandlerSyste | | | | | m.getTheHandler(). | | | +----+--------------------+--------------------+------------------+ | 8 | Call | Check that the | | | | USATEnvelopeHandl | address field of | | | | erSystem.findTLV() | the message is | | | | to select the | equal to the | | | | address TLV and | address field of | | | | the | the third segment. | | | | USATEnvelopeHand | | | | | ler.compareValue() | | | | | to check its | | | | | content. | | | +----+--------------------+--------------------+------------------+ | 9 | A new concatenated | Applet is | | | | formatted short | triggered. | | | | message is sent to | | | | | the (U)SIM | | | | | composed of three | | | | | segments. Some TP | | | | | elements of the | | | | | TPDU of the first, | | | | | second and third | | | | | segment are | | | | | different among | | | | | themselves. | | | +----+--------------------+--------------------+------------------+ | 10 | Call | No exception is | | | | USATEn | thrown. | | | | velopeHandlerSyste | | | | | m.getTheHandler(). | | | +----+--------------------+--------------------+------------------+ | 11 | Call | Check that the TP | | | | USATEnvelop | elements of the | | | | eHandler.findTLV() | message are equal | | | | to select the | to the ones of the | | | | TP_DU TLV and | third segment. | | | | USATEnvelopeHand | | | | | ler.compareValue() | | | | | to check its TP | | | | | elements. | | | +----+--------------------+--------------------+------------------+ | 12 | Send a | Applet is | | | | concatenated | triggered. | | | | formatted short | | | | | message (composed | | | | | of 3 segments) | | | | | with uncompressed | | | | | 8 bit data. | | | +----+--------------------+--------------------+------------------+ | | Applet | | | | | registration to | | | | | EVENT_UNFORMA | | | | | TTED_SMS_PP_ENV | | | | | and triggering | | | | | | | | | | Same test as above | | | | | but with an | | | | | unformatted | | | | | SMS_PP envelope. | | | | | | | | | | A concatenated | | | | | unformatted | | | | | SMS_PP is sent to | | | | | the (U)SIM | | | | | (composed of three | | | | | segments). | | | +----+--------------------+--------------------+------------------+ | 13 | The second segment | Applet is not | | | | of a concatenated | triggered. | | | | short message is | | | | | sent to the | | | | | (U)SIM. | | | +----+--------------------+--------------------+------------------+ | 14 | The first segment | Applet is not | | | | of the | triggered. | | | | concatenated short | | | | | message is sent to | | | | | the (U)SIM. | | | +----+--------------------+--------------------+------------------+ | 15 | The third segment | Applet is | | | | of the | triggered. | | | | concatenated short | | | | | message is sent to | | | | | the (U)SIM. | | | +----+--------------------+--------------------+------------------+ | 16 | Call | No exception is | | | | USATE | thrown. | | | | nvelopeHanlderSyst | | | | | em.getTheHandler() | | | +----+--------------------+--------------------+------------------+ | 17 | Call | Check that the | | | | USATEnvelop | message has been | | | | eHandler.findTLV() | reassembled in the | | | | to select the Dev | correct order. | | | | Id, the address | Check that TP-UDL | | | | and the TPDU TLV | field is coded one | | | | and the | octet. Check that | | | | USATEnvelopeHand | the concatenation | | | | ler.compareValue() | control header is | | | | to check each | not present in the | | | | content. | message. Check the | | | | | integrity of the | | | | | message. | | +----+--------------------+--------------------+------------------+ | 18 | A new concatenated | Applet is | | | | formatted short | triggered. | | | | message is sent to | | | | | the (U)SIM | | | | | composed of three | | | | | segments. The | | | | | Address field of | | | | | the first segment | | | | | is different from | | | | | the address field | | | | | in the second | | | | | segment. | | | +----+--------------------+--------------------+------------------+ | 19 | Call | No exception is | | | | USATEn | thrown. | | | | velopeHandlerSyste | | | | | m.getTheHandler(). | | | +----+--------------------+--------------------+------------------+ | 20 | Call | Check that the | | | | USATEnvelop | address field of | | | | eHandler.findTLV() | the message is | | | | to select the | equal to the | | | | address TLV and | address field of | | | | the | the second | | | | USATEnvelopeHand | segment. | | | | ler.compareValue() | | | | | to check its | | | | | content. | | | +----+--------------------+--------------------+------------------+ | 21 | A new concatenated | Applet is | | | | unformatted short | triggered. | | | | message is sent to | | | | | the (U)SIM | | | | | composed of two | | | | | segments. Some | | | | | TP_elements of | | | | | the TPDU of the | | | | | first, second and | | | | | third segment are | | | | | different. | | | +----+--------------------+--------------------+------------------+ | 22 | Call | No exception is | | | | USATE | thrown. | | | | nvelopeHandlerSyst | | | | | em.getTheHandler() | | | +----+--------------------+--------------------+------------------+ | 23 | Call | Check that the TP | | | | USATEnvelopeH | elements of the | | | | andler.findTLV()to | message are equal | | | | select the TPDU | to the ones of the | | | | TLV and the | third segment. | | | | USATEnvelopeHand | | | | | ler.compareValue() | | | | | to check its TP | | | | | elements. | | | +----+--------------------+--------------------+------------------+ | 24 | Send a | Applet is | | | | concatenated | triggered. | | | | unformatted short | | | | | message (composed | | | | | of 3 segments) | | | | | with uncompressed | | | | | UCS2 data. | | | +----+--------------------+--------------------+------------------+
### 5.3.10 Cell Broadcast Service
#### 5.3.10.1 Multiple message reassembling
> Test Area Reference: Ufw_Cbs_Mmra
##### 5.3.10.1.1 Conformance requirements: {#conformance-requirements-17 .H6}
##### 5.3.10.1.1.1 Normal execution {#normal-execution-56 .H6}
\- CRRN1: When a Cell Broadcast Message is received as multiple pages as
defined in TS 23.041 [6], it is the responsibility of the (U)SAT Framework to
link single pages together to re- assemble the original message before any
further processing.
\- CRRN2: The original Cell Broadcast message shall be placed in one Cell
Broadcast page TLV included in the USATEnvelopeHandler.
\- CRRN3: The message parameters shall correspond to the ones in the last
received Cell Broadcast page (independently of the Page Parameter).
#### 5.3.10.2 Test area files
Test Source: Test_Ufw_Cbs_Mmra.java
Test Applet: Ufw_Cbs_Mmra_1.java
Cap File: Ufw_Cbs_Mmra.cap
#### 5.3.10.3 Test coverage
* * *
CRR number Test case number N1 1 -- 10 N2 5, 10 N3 5, 10
* * *
##### 5.3.10.4 Test procedure {#test-procedure-56 .H6}
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | | Applet | | | | | registration to | | | | | EVENT_ | | | | | FORMATTED_SMS_CB | | | | | and triggering | | | | | | | | | | Applet is | | | | | registered to | | | | | EVENT_FORMA | | | | | TTED_SMS_CB_ENV | | | | | and | | | | | EVENT_UNFORMA | | | | | TTED_SMS_CB_ENV | | | | | events | | | | | | | | | | A multi page | | | | | formatted SMS_CB | | | | | is sent to the | | | | | (U)SIM (composed | | | | | of three | | | | | segments). | | | +----+--------------------+--------------------+------------------+ | 1 | The first segment | Applet is not | | | | of a multi page | triggered. | | | | formatted CB short | | | | | message is sent to | | | | | the (U)SIM. | | | +----+--------------------+--------------------+------------------+ | 2 | The second segment | Applet is not | | | | of a multi page | triggered. | | | | formatted CB short | | | | | message is sent to | | | | | the USIM. | | | +----+--------------------+--------------------+------------------+ | 3 | The third segment | Applet is | | | | of the multi page | triggered. | | | | formatted CB short | | | | | message is sent to | | | | | the USIM. | | | +----+--------------------+--------------------+------------------+ | 4 | Call | No exception is | | | | USATEn | thrown. | | | | velopeHandlerSyste | | | | | m.getTheHandler(). | | | +----+--------------------+--------------------+------------------+ | 5 | Call | The message is re- | | | | USATEnvelopeHand | assembled in the | | | | ler.compareValue() | correct order with | | | | to check message | Message Parameter | | | | parameter, message | of the third | | | | integrity and | SMS_CB which was | | | | message content. | sent at last. | | +----+--------------------+--------------------+------------------+ | | Applet | | | | | registration to | | | | | EVENT_UN | | | | | FORMATTED_SMS_CB | | | | | and triggering | | | | | | | | | | A multi page | | | | | unformatted | | | | | SMS_CB is sent to | | | | | the (U)SIM | | | | | (composed of three | | | | | segments). | | | +----+--------------------+--------------------+------------------+ | 6 | The second segment | Applet is not | | | | of a multi page | triggered. | | | | unformatted | | | | | SMS_CB is sent to | | | | | the (U)SIM. | | | +----+--------------------+--------------------+------------------+ | 7 | The third segment | Applet is not | | | | of a multi page | triggered. | | | | unformatted | | | | | SMS_CB is sent to | | | | | the (U)SIM. | | | +----+--------------------+--------------------+------------------+ | 8 | The first segment | Applet is | | | | of a concatenated | triggered. | | | | unformatted | | | | | SMS_CB is sent to | | | | | the (U)SIM. | | | +----+--------------------+--------------------+------------------+ | 9 | Call | No exception is | | | | USATEn | thrown. | | | | velopeHandlerSyste | | | | | m.getTheHandler(). | | | +----+--------------------+--------------------+------------------+ | 10 | Call | The message is re- | | | | USATEnvelopeHand | assembled in the | | | | ler.compareValue() | correct order with | | | | to check message | Page Parameter of | | | | parameter, message | first SMS_CB | | | | integrity and | which was sent at | | | | message content. | last. | | +----+--------------------+--------------------+------------------+
### 5.3.11 Concatenated USSD
#### 5.3.11.1 Concatenation processing
Test Area Reference: Ufw_Fusd_Proc
##### 5.3.11.1.1 Conformance requirements: {#conformance-requirements-18 .H6}
##### 5.3.11.1.1.1 Normal execution {#normal-execution-57 .H6}
\- CRRN1: When a USSD Message is received as concatenated as defined in TS
31.115 [X], it is the responsibility of the (U)SAT Framework to link single
USSD Messages together to re‑assemble the original message before any further
processing.
\- CRRN2: The original USSD message shall be placed in one USSD String TLV
included in the USATEnvelopeHandle.
\- CRRN3: The USSD String parameters (DCS, PFI, CCF) shall correspond to the
ones in the last received USSD String (independently of the CCF Sequence
number).
\- CRRN4: The (U)SAT Framework shall be able to process messages with the
following properties as a minimum requirement:
\- the Information Element Identifier is equal to the 8-bit reference number
\- it contains uncompressed 8 bit data or uncompressed UCS2 data
#### 5.3.11.2 Test area files
Test Source: Test_Ufw_Fusd_Proc.java
Test Applet: Ufw Fusd Proc_1.java
Cap File: ufw fusd proc.cap
#### 5.3.11.3 Test coverage
* * *
CRR number Test case number N1 1 to 9, N2 1 to 9 N3 6, 10 to 18 N4 9,18
* * *
#### 5.3.11.4 Test procedure
+----+--------------------+--------------------+------------------+ | Id | Description | API/(U)SAT | APDU Expectation | | | | Framework | | | | | Expectation | | +----+--------------------+--------------------+------------------+ | | Applet | | | | | registration to | | | | | EVEN | | | | | T_FORMATTED_USSD | | | | | and triggering | | | | | | | | | | Applet is | | | | | registered to | | | | | EVEN | | | | | T_FORMATTED_USSD | | | | | and | | | | | EVENT\ | | | | | _UNFORMATTED_USSD | | | | | events | | | | | | | | | | A concatenated | | | | | formatted USSD is | | | | | sent to the (U)SIM | | | | | (composed of three | | | | | segments). | | | +----+--------------------+--------------------+------------------+ | 1 | The second segment | Applet is not | | | | of a concatenated | triggered. | | | | USSD is sent to | | | | | the (U)SIM. | | | +----+--------------------+--------------------+------------------+ | 2 | The first segment | Applet is not | | | | of the | triggered. | | | | concatenated USSD | | | | | is sent to the | | | | | (U)SIM. | | | +----+--------------------+--------------------+------------------+ | 3 | The third segment | Applet is | | | | of the | triggered. | | | | concatenated USSD | | | | | is send to the | | | | | (U)SIM | | | +----+--------------------+--------------------+------------------+ | 4 | Call | No exception is | | | | USATEn | thrown. | | | | velopeHandlerSyste | | | | | m.getTheHandler(). | | | +----+--------------------+--------------------+------------------+ | 5 | Call the | Check that the | | | | USATEnvelop | message has been | | | | eHandler.findTLV() | re-assembled in | | | | to select the Dev | the correct order. | | | | Id, the alpha id | Check that TP-UDL | | | | and the USSD | field is coded in | | | | String and the | one octet. Check | | | | USATEnvelopeHand | that the | | | | ler.compareValue() | concatenation | | | | to check each | control header is | | | | content. | not present in the | | | | | message. Check the | | | | | integrity of the | | | | | message. | | +----+--------------------+--------------------+------------------+ | 6 | A new concatenated | Applet is | | | | formatted USSD is | triggered. | | | | sent to the (U)SIM | | | | | composed of three | | | | | segments. DCS, | | | | | PFI, CCF of the of | | | | | the first, second | | | | | and third segment | | | | | are different | | | | | among themselves. | | | +----+--------------------+--------------------+------------------+ | 7 | Call | No exception is | | | | USATEn | thrown. | | | | velopeHandlerSyste | | | | | m.getTheHandler(). | | | +----+--------------------+--------------------+------------------+ | 8 | Call | Check that the TP | | | | USATEnvelop | elements of the | | | | eHandler.findTLV() | message are equal | | | | to select the | to the ones of the | | | | TP_DU TLV and | third segment. | | | | USATEnvelopeHand | | | | | ler.compareValue() | | | | | to check its TP | | | | | elements. | | | +----+--------------------+--------------------+------------------+ | 9 | Send a | Applet is | | | | concatenated USSD | triggered. | | | | (composed of 3 | | | | | segments) with | | | | | uncompressed 8 bit | | | | | data. | | | +----+--------------------+--------------------+------------------+ | | Applet | | | | | registration to | | | | | EVENT\ | | | | | _UNFORMATTED_USSD | | | | | and triggering | | | | | | | | | | Same test as above | | | | | but with an | | | | | unformatted USSD | | | | | | | | | | A concatenated | | | | | unformatted | | | | | SMS_PP is sent to | | | | | the (U)SIM | | | | | (composed of three | | | | | segments). | | | +----+--------------------+--------------------+------------------+ | 10 | The second segment | Applet is not | | | | of a concatenated | triggered. | | | | USSD message is | | | | | sent to the | | | | | (U)SIM. | | | +----+--------------------+--------------------+------------------+ | 11 | The first segment | Applet is not | | | | of the | triggered. | | | | concatenated USSD | | | | | message is sent to | | | | | the (U)SIM. | | | +----+--------------------+--------------------+------------------+ | 12 | The third segment | Applet is | | | | of the | triggered. | | | | concatenated USSD | | | | | message is sent to | | | | | the (U)SIM. | | | +----+--------------------+--------------------+------------------+ | 13 | Call | No exception is | | | | USATE | thrown. | | | | nvelopeHanlderSyst | | | | | em.getTheHandler() | | | +----+--------------------+--------------------+------------------+ | 14 | Call | Check that the | | | | USATEnvelop | message has been | | | | eHandler.findTLV() | reassembled in the | | | | to select the Dev | correct order. | | | | Id, USSD String | Check that TP-UDL | | | | TLV and the | field is coded one | | | | USATEnvelopeHand | octet. Check that | | | | ler.compareValue() | the concatenation | | | | to check each | control header is | | | | content. | not present in the | | | | | message. Check the | | | | | integrity of the | | | | | message. | | +----+--------------------+--------------------+------------------+ | 15 | A new concatenated | Applet is | | | | unformatted USSD | triggered. | | | | is sent to the | | | | | (U)SIM composed of | | | | | two segments. Some | | | | | TP_elements of | | | | | the TPDU of the | | | | | first, second and | | | | | third segment are | | | | | different. | | | +----+--------------------+--------------------+------------------+ | 16 | Call | No exception is | | | | USATE | thrown. | | | | nvelopeHandlerSyst | | | | | em.getTheHandler() | | | +----+--------------------+--------------------+------------------+ | 17 | Call | Check that the TP | | | | USATEnvelopeH | elements of the | | | | andler.findTLV()to | message are equal | | | | select the TPDU | to the ones of the | | | | TLV and the | third segment. | | | | USATEnvelopeHand | | | | | ler.compareValue() | | | | | to check its TP | | | | | elements. | | | +----+--------------------+--------------------+------------------+ | 18 | Send a | Applet is | | | | concatenated | triggered. | | | | unformatted USSD | | | | | (composed of 3 | | | | | segments) with | | | | | uncompressed UCS2 | | | | | data. | | | +----+--------------------+--------------------+------------------+
###### ## Annex A (normative): Class, methods and USATFramework tests acronyms
# A.1 Toolkit part
* * *
USATEnvelopeHandler Ueh USATEnvelopeHandlerSystem Ues ToolkitRegistry Tkr
* * *
## A.1.1 USATEnvelopeHandler interface
* * *
Method name Acronyms short getSecuredDataLength() Gsdl short
getSecuredDataOffset() Gsdo short getShortMessageLength() Gsml short
getShortMessageOffset() Gsmo short getTPUDLOffset() Gtpo short
getUserDataLength() Gudl
Inherited method name: EnvelopeHandler Acronyms byte getChannelIdentifier()
Gcid short getChannelStatus(byte channelIdentifier) Gcst byte
getItemIdentifier() Giid
Inherited method name: BERTLVViewHandler  
short getSize() Gtsz byte getTag() Gttg
Inherited method name: ViewHandler  
byte compareValue(short valueOffset, byte[] compareBuffer, short
compareOffset, short compareLength) Cprv short copy(byte[] dstBuffer, short
dstOffset, short dstLength) Copy short copyValue(short valueOffset, byte[]
dstBuffer, short dstOffset, short dstLength) Cpyv byte
findAndCompareValue(byte tag, byte[] compareBuffer, short compareOffset)
Facrb_Bs byte findAndCompareValue(byte tag, byte occurrence, short
valueOffset, byte[] compareBuffer, short compareOffset, short compareLength)
Facrbbs_Bss short findAndCopyValue(byte tag, byte[] dstBuffer, short
dstOffset) Facyb_Bs short findAndCopyValue(byte tag, byte occurrence, short
valueOffset, byte[] dstBuffer, short dstOffset, short dstLength) Facybbs_Bss
byte findTLV(byte tag, byte occurrence) Find short getCapacity() Gcap short
getLength() Glen byte getValueByte(short valueOffset) Gvby short
getValueLength() Gvle short getValueShort(short valueOffset) Gvsh
* * *
## A.1.2 USATEnvelopeHandlerSystem method
* * *
Method Name Acronyms public static USATEnvelopeHandler getTheHandler() Gthd
* * *
## A.1. 3 ToolkitRegistry methods
* * *
Method Name Acronyms void clearEvent(short event) Cevt boolean
isEventSet(short event) Ievs void setEvent(short event) Sevt void
setEventList(short[] eventList, short offset, short length) Sevl
* * *
# A.2 Acronyms for USATFramework tests
* * *
Minimum handler availability Mha Handler integrity Hin Applet triggering Apt
Exception handling Exh Envelope response posting Erp Toolkit installation Tin
Other parts transferred from API to CAT RE Api Framework Security Ufs
Concatenated SMS Csm Cell Broadcast Service Cbs
* * *
## A.2.1 Minimum handler availability
* * *
Test Area within the chapter Acronyms ProactiveHandler Pahd
ProactiveResponseHandler Prhd EnvelopeHandler Enhd EnvelopeResponseHandler
Erhd USATEnvelopeHandler Uehd Applet triggering with ongoing proactive session
Rent
* * *
## A.2.2 Handler integrity
* * *
Test Area within the chapter Acronyms ProactiveResponseHandler Prhd
EnvelopeHandler Enhd USATEnvelopeHandler Uehd
* * *
## A.2.3 Applet triggering
* * *
Test Area within the chapter Acronyms
* * *
## A.2.4 Exception handling
* * *
Method Name Acronyms General Behaviour Genb Interaction with Multiple
Triggering Imtg
* * *
## A.2.5 Envelope response posting
* * *
Method Name Acronyms EVENT_MO_SHORT_MESSAGE_CONTROL_BY_SIM Emcn
* * *
## A.2.6 Toolkit installation
* * *
Method Name Acronyms Access Domain Acdo Minimum Security Level Mslv TAR
Value(s) of the Toolkit Application instance Tarv
* * *
## A.2.7 Other parts transferred from API to CAT RE
* * *
Method Name Acronyms A handler is a temporary JCRE Entry Point object Hepo
* * *
## A.2.8 Framework security
* * *
Method Name Acronyms Input Data Inda Output Data Ouda
* * *
## A.2.9 Concatenated SMS
* * *
Method Name Acronyms Concatenation processing Proc
* * *
## A.2.10 Cell Broadcast Service
* * *
Method Name Acronyms Multiple message reassembling Mmra
* * *
###### ## Annex B (normative): Global prepersonalization
The file system used to pass the test suite is described in ETSI TS 102 268
[15] Annex B, with one exception for file EF~SMS~.
+----------+----------------+------------------+------------------+ | **Name** | **Identifier** | **Description** | **Special | | | | | Notes** | +----------+----------------+------------------+------------------+ | EF~SMS~ | 6F3C | 1^st^ record: 00 | The file EF~SMS~ | | | | FF ... FF(length | should be | | | | 176) | present under | | | | | both | | | | 2^nd^ record: 00 | MF/DF~TELECOM~ | | | | FF ... FF(length | and directly | | | | 176) | under ADF1. One | | | | | of these two | | | | 3^rd^ record: 00 | EF~SMS~ files | | | | FF ... FF(length | must be linked | | | | 176) | to the other | | | | | one. | +----------+----------------+------------------+------------------+
Additionally, the following values must be used:
* * *
Parameter Value in hexadecimal KIC Value as described in the TS 31.115 [10]
(recommended value: 15) KID Value as described in the TS 31.115 [10]
(recommended value: 15) CNTR 00 00 00 00 01 Key for ciphering Corresponding to
KIC (recommended value: 01 41 42 7F DA E8 91 A7 02 41 42 7F DA E8 91 A7) Key
for RC/CC/DS Corresponding to KID (recommended value: 01 23 45 67 89 AB CD EF
EF CD AB 89 67 45 23 01)
* * *
The value for Application PIN 1(Global PIN 1) shall be \"0x31 0x31 0x31 0x31
0xFF 0xFF 0xFF 0xFF\" and its state shall be \'disabled\' during test applets
execution.
The value for Application PIN 1 block shall be \"0x33 0x33 0x33 0x33 0x33 0x33
0x33 0x33\" and its state shall be \'disabled\' during test applets execution.
###### ## Annex C (normative): Test file description
Every test source is written in JAVA™ and shall use methods defined in Annex D
interfaces to communicate with the card, or to check status word or received
data.
In order to be more readable, data specified as method string parameters shall
be presented in 4 blocks of 4 bytes per line. Every block is separated by a
space character. Every string line is appended to previous one and shall be
aligned. An example is provided in Annex D.
Every test file shall start with a call to reset() method.
###### ## Annex D (normative): uicc.usim.test.util package, (U)SIM interfaces
and testing script example
See attached files:
\- Annex_D_UsimTestUtil.zip
\- Annex_D_UsimInterfaces.zip
\- Annex_D_Example.zip
###### ## Annex E (normative): Test Area files
See attached file:
\- Annex_E_SourceCode.zip
#
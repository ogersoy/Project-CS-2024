# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies the E-UTRA MAC protocol.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 36.213: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Physical Layer Procedures\".
[3] 3GPP TS 36.322: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Radio Link Control (RLC) protocol specification\".
[4] 3GPP TS 36.323: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Packet Data Convergence Protocol (PDCP) Specification\".
[5] 3GPP TS 36.212: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Multiplexing and channel coding\".
[6] 3GPP TS 36.214: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Physical layer; Measurements\".
[7] 3GPP TS 36.211: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Physical Channels and Modulation\".
[8] 3GPP TS 36.331: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Radio Resource Control (RRC); Protocol specification\".
[9] 3GPP TS 36.133: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Requirements for support of radio resource management\".
[10] 3GPP TS 36.101: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
User Equipment (UE) radio transmission and reception\".
[11] 3GPP TS 36.216: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Physical layer for relaying operation\".
[12] 3GPP TS 36.306: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
User Equipment (UE) radio access capabilities\".
[13] 3GPP TS 23.303: \"Proximity-based services (ProSe); Stage 2\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
**Active Time:** Time related to DRX operation, as defined in subclause 5.7,
during which the MAC entity monitors the PDCCH.
**_mac-ContentionResolutionTimer_** : Specifies the number of consecutive
subframe(s) during which the MAC entity shall monitor the PDCCH after Msg3 is
transmitted.
**DRX Cycle:** Specifies the periodic repetition of the On Duration followed
by a possible period of inactivity (see figure 3.1-1 below).
Figure 3.1-1: DRX Cycle
**_drx-InactivityTimer_** : Except for NB-IoT UEs, BL UEs or UEs in enhanced
coverage, it specifies the number of consecutive PDCCH-subframe(s) after the
subframe in which a PDCCH indicates an initial UL, DL or SL user data
transmission for this MAC entity. For NB-IoT UEs, it specifies the number of
consecutive PDCCH-subframe(s) after the subframe in which the HARQ RTT timer
or UL HARQ RTT timer expires. For BL UEs or UEs in enhanced coverage, it
specifies the number of consecutive PDCCH-subframe(s) following the subframe
containing the last repetition of the PDCCH reception that indicates an
initial UL or DL user data transmission for this MAC entity.
**_drx-RetransmissionTimer_** : Specifies the maximum number of consecutive
PDCCH-subframe(s) until a DL retransmission is received.
**_drxShortCycleTimer_** : Specifies the number of consecutive subframe(s) the
MAC entity shall follow the Short DRX cycle.
**_drxStartOffset_** : Specifies the subframe where the DRX Cycle starts.
**_drx-ULRetransmissionTimer_** : Specifies the maximum number of consecutive
PDCCH-subframe(s) until a grant for UL retransmission is received.
**HARQ information** : HARQ information for DL-SCH or for UL-SCH transmissions
consists of New Data Indicator (NDI), Transport Block (TB) size. For DL-SCH
transmissions and for asynchronous UL HARQ, the HARQ information also includes
HARQ process ID, except for UEs in NB-IoT for which this information is not
present. For UL-SCH transmission the HARQ information also includes Redundancy
Version (RV). In case of spatial multiplexing on DL-SCH the HARQ information
comprises a set of NDI and TB size for each transport block. HARQ information
for SL-SCH and SL-DCH transmissions consists of TB size only.
**HARQ RTT Timer** : This parameter specifies the minimum amount of
subframe(s) before a DL assignment for HARQ retransmission is expected by the
MAC entity.
**Msg3** : Message transmitted on UL-SCH containing a C-RNTI MAC CE or CCCH
SDU, submitted from upper layer and associated with the UE Contention
Resolution Identity, as part of a random access procedure.
**NB-IoT** : NB-IoT allows access to network services via E-UTRA with a
channel bandwidth limited to 200 kHz.
**NB-IoT UE** : A UE that uses NB-IoT.
**_onDurationTimer_** : Specifies the number of consecutive PDCCH-subframe(s)
at the beginning of a DRX Cycle.
**PDCCH:** Refers to the PDCCH [7], EPDCCH (in subframes when configured),
MPDCCH [2], for an RN with R-PDCCH configured and not suspended, to the
R-PDCCH or, for NB-IoT to the NPDCCH.
**PDCCH period (pp):** Refers to the interval between the start of two
consecutive PDCCH occasions and depends on the currently used PDCCH search
space [2]. A PDCCH occasion is the start of a search space and is defined by
subframe k0 as specified in section 16.6 of [2]. The calculation of number of
PDCCH-subframes for the timer configured in units of a PDCCH period is done by
multiplying the number of PDCCH periods with _npdcch-NumRepetitions-RA_ when
the UE uses the common search space or by _npdcch-NumRepetitions_ when the UE
uses the UE specific search space. The calculation of number of subframes for
the timer configured in units of a PDCCH period is done by multiplying the
number of PDCCH periods with duration between two consecutive PDCCH occasions.
**PDCCH-subframe:** Refers to a subframe with PDCCH. For a MAC entity not
configured with any TDD serving cell(s), this represents any subframe; for a
MAC entity configured with at least one TDD serving cell, if a MAC entity is
capable of simultaneous reception and transmission in the aggregated cells,
this represents the union over all serving cells of downlink subframes and
subframes including DwPTS of the TDD UL/DL configuration indicated by _tdd-
Config_ [8], except serving cells that are configured with _schedulingCellId_
[8]; otherwise, this represents the subframes where the SpCell is configured
with a downlink subframe or a subframe including DwPTS of the TDD UL/DL
configuration indicated by _tdd-Config_ [8].\ For RNs with an RN subframe
configuration configured and not suspended, in its communication with the
E-UTRAN, this represents all downlink subframes configured for RN
communication with the E-UTRAN.\ For SC-PTM reception on a FDD cell, this
represents any subframe of the cell except MBSFN subframes; for SC-PTM
reception on a TDD cell, this represents the downlink subframes and subframes
including DwPTS of the TDD UL/DL configuration indicated by _tdd-Config_ [8]
of the cell except MBSFN subframes.
**PDSCH: Refers to PDSCH or for NB-IoT to NPDSCH.**
**PRACH: Refers to PRACH or for NB-IoT to NPRACH.**
**PRACH Resource Index** : The index of a PRACH within a system frame [7]
**Primary Timing Advance Group:** Timing Advance Group containing the SpCell.
**PUCCH SCell:** An SCell configured with PUCCH.
**PUSCH: Refers to PUSCH or for NB-IoT to NPUSCH.**
**_ra-PRACH-MaskIndex_ :** Defines in which PRACHs within a system frame the
MAC entity can transmit a Random Access Preamble (see subclause 7.3).
**RA-RNTI:** The Random Access RNTI is used on the PDCCH when Random Access
Response messages are transmitted. It unambiguously identifies which time-
frequency resource was utilized by the MAC entity to transmit the Random
Access preamble.
**SC Period:** Sidelink Control period, the time period consisting of
transmission of SCI and its corresponding data.
**SCI:** The Sidelink Control Information contains the sidelink scheduling
information such as resource block assignment, modulation and coding scheme
and Group Destination ID [5].
**Secondary Timing Advance Group:** Timing Advance Group not containing the
SpCell. A Secondary Timing Advance Group contains at least one Serving Cell
with an UL configured.
**Serving Cell:** A Primary or a Secondary Cell [8].
**Sidelink:** UE to UE interface for sidelink communication and sidelink
discovery. The sidelink corresponds to the PC5 interface as defined in [13].
**Sidelink Discovery Gap for Reception:** Time period during which the UE does
not receive any channels in DL from any serving cell, except during random
access procedure.
**Sidelink Discovery Gap for Transmission:** Time period during which the UE
prioritizes transmission of sidelink discovery and associated procedures
**e.g.** re-tuning and synchronisation over transmission of channels in UL, if
they occur in the same subframe, except during random access procedure.
**Special Cell:** For Dual Connectivity operation the term Special Cell refers
to the PCell of the MCG or the PSCell of the SCG, otherwise the term Special
Cell refers to the PCell.
**Timing Advance Group:** A group of Serving Cells that is configured by RRC
and that, for the cells with an UL configured, using the same timing reference
cell and the same Timing Advance value.
**UL HARQ RTT Timer** : This parameter specifies the minimum amount of
subframe(s) before a UL HARQ retransmission grant is expected by the MAC
entity.
NOTE: A timer is running once it is started, until it is stopped or until it
expires; otherwise it is not running. A timer can be started if it is not
running or restarted if it is running. A Timer is always started or restarted
from its initial value.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
> BL Bandwidth reduced Low complexity
>
> BR Bandwidth Reduced
>
> BSR Buffer Status Report
>
> C-RNTI Cell RNTI
>
> CC-RNTI Common Control RNTI
>
> CQI Channel Quality Indicator
>
> CRI CSI-RS Resource Indicator
>
> eIMTA Enhanced Interference Management and Traffic Adaptation
>
> eIMTA-RNTI Enhanced Interference Management and Traffic Adaptation - RNTI
>
> E-UTRA Evolved UMTS Terrestrial Radio Access
>
> E-UTRAN Evolved UMTS Terrestrial Radio Access Network
>
> G-RNTI Group RNTI
>
> MAC Medium Access Control
>
> MCG Master Cell Group
>
> M-RNTI MBMS RNTI
>
> MPDCCH MTC Physical Downlink Control Channel
>
> LCG Logical Channel Group
>
> NB-IoT Narrow Band Internet of Things
>
> NPDCCH Narrowband Physical Downlink Control Channel
>
> NPDSCH Narrowband Physical Downlink Shared channel
>
> NPRACH Narrowband Physical Random Access Control Channel
>
> NPUSCH Narrowband Physical Uplink Shared channel
>
> PCell Primary Cell
>
> PSCell Primary Secondary Cell
>
> PHR Power Headroom Report
>
> PMI Precoding Matrix Index
>
> PPPP ProSe Per-Packet Priority
>
> P-RNTI Paging RNTI
>
> ProSe Proximity-based Services
>
> pTAG Primary Timing Advance Group
>
> PTI Precoding Type Indicator
>
> RA-RNTI Random Access RNTI
>
> RI Rank Indicator
>
> RN Relay Node
>
> RNTI Radio Network Temporary Identifier
>
> SCell Secondary Cell
>
> SC-FDM Single-Carrier Frequency Division Multiplexing
>
> SCG Secondary Cell Group
>
> SCI Sidelink Control Information
>
> SC-N-RNTI Single Cell Notification RNTI
>
> SC-PTM Single Cell Point to Multipoint
>
> SC-RNTI Single Cell RNTI
>
> SI-RNTI System Information RNTI
>
> SL Sidelink
>
> SL-RNTI Sidelink RNTI
>
> SR Scheduling Request
>
> SRS Sounding Reference Symbols
>
> SpCell Special Cell
>
> sTAG Secondary Timing Advance Group
>
> TAG Timing Advance Group
>
> TB Transport Block
>
> TPC-PUCCH-RNTI Transmit Power Control-Physical Uplink Control Channel-RNTI
>
> TPC-PUSCH-RNTI Transmit Power Control-Physical Uplink Shared Channel-RNTI
# 4 General
## 4.1 Introduction
The objective is to describe the MAC architecture and the MAC entity from a
functional point of view. Functionality specified for the UE equally applies
to the RN for functionality necessary for the RN. There is also functionality
which is only applicable to the RN, in which case the specification denotes
the RN instead of the UE. RN‑specific behaviour is not applicable to the UE.
For TDD operation, UE behaviour follows the TDD UL/DL configuration indicated
by _tdd-Config_ unless specified otherwise.
## 4.2 MAC architecture
The description in this sub clause is a model and does not specify or restrict
implementations.
RRC is in control of configuration of MAC.
### 4.2.1 MAC Entities
E-UTRA defines two MAC entities; one in the UE and one in the E-UTRAN. These
MAC entities handle the following transport channels:
\- Broadcast Channel (BCH);
\- Downlink Shared Channel(s) (DL-SCH);
\- Paging Channel (PCH);
\- Uplink Shared Channel(s) (UL-SCH);
\- Random Access Channel(s) (RACH);
\- Multicast Channel(s) (MCH);
\- Sidelink Broadcast Channel (SL-BCH);
\- Sidelink Discovery Channel (SL-DCH);
\- Sidelink Shared Channel (SL-SCH).
The exact functions performed by the MAC entities are different in the UE from
those performed in the E-UTRAN.
The RN includes both types of MAC entities; one type for communication with
UEs and one type for communication with the E-UTRAN.
In Dual Connectivity, two MAC entities are configured in the UE: one for the
MCG and one for the SCG. Each MAC entity is configured by RRC with a serving
cell supporting PUCCH transmission and contention based Random Access. In this
specification, the term SpCell refers to such cell, whereas the term SCell
refers to other serving cells. The term SpCell either refers to the PCell of
the MCG or the PSCell of the SCG depending on if the MAC entity is associated
to the MCG or the SCG, respectively. A Timing Advance Group containing the
SpCell of a MAC entity is referred to as pTAG, whereas the term sTAG refers to
other TAGs.
The functions of the different MAC entities in the UE operate independently if
not otherwise indicated. The timers and paramenters used in each MAC entity
are configured independently if not otherwise indicated. The Serving Cells,
C-RNTI, radio bearers, logical channels, upper and lower layer entities, LCGs,
and HARQ entities considered by each MAC entity refer to those mapped to that
MAC entity if not otherwise indicated.
If the MAC entity is configured with one or more SCells, there are multiple
DL-SCH and there may be multiple UL-SCH and RACH per MAC entity; one DL-SCH
and UL-SCH on the SpCell, one DL-SCH, zero or one UL-SCH and zero or one RACH
for each SCell.
Figure 4.2.1-1 illustrates one possible structure for the UE side MAC entity
when SCG is not configured, and it should not restrict implementation.
[]{.underline}
Figure 4.2.1-1: MAC structure overview, UE side
Figure 4.2.1-2 illustrates one possible structure for the UE side MAC entities
when MCG and SCG are configured, and it should not restrict implementation.
MBMS reception and SC-PTM reception are excluded from this figure for
simplicity.
Figure 4.2.1-2: MAC structure overview with two MAC entities, UE side
Figure 4.2.1-3 illustrates one possible structure for the UE side MAC entity
when sidelink is configured, and it should not restrict implementation.
Figure 4.2.1-3: MAC structure overview for sidelink, UE side
## 4.3 Services
### 4.3.1 Services provided to upper layers
This clause describes the different services provided by MAC sublayer to upper
layers.
\- data transfer
\- radio resource allocation
### 4.3.2 Services expected from physical layer
The physical layer provides the following services to MAC:
\- data transfer services;
\- signalling of HARQ feedback;
\- signalling of Scheduling Request;
\- measurements (e.g. Channel Quality Indication (CQI)).
The access to the data transfer services is through the use of transport
channels. The characteristics of a transport channel are defined by its
transport format (or format set), specifying the physical layer processing to
be applied to the transport channel in question, such as channel coding and
interleaving, and any service-specific rate matching as needed.
## 4.4 Functions
The following functions are supported by MAC sublayer:
\- mapping between logical channels and transport channels;
\- multiplexing of MAC SDUs from one or different logical channels onto
transport blocks (TB) to be delivered to the physical layer on transport
channels;
\- demultiplexing of MAC SDUs from one or different logical channels from
transport blocks (TB) delivered from the physical layer on transport channels;
\- scheduling information reporting;
\- error correction through HARQ;
\- priority handling between UEs by means of dynamic scheduling;
\- priority handling between logical channels of one MAC entity;
\- Logical Channel prioritisation;
\- transport format selection;
\- radio resource selection for SL.
The location of the different functions and their relevance for uplink and
downlink respectively is illustrated in Table 4.4-1.
Table 4.4-1: MAC function location and link direction association.
* * *
MAC function UE eNB Downlink Uplink Sidelink tx Sidelink rx Mapping between
logical channels and transport channels X X X X X X X X  
Multiplexing X X X  
X X  
Demultiplexing X X X X X  
Error correction through HARQ X X X X X X X X  
Transport Format Selection X X X  
X X X  
Priority handling between UEs X X X  
Priority handling between logical channels of one MAC entity X X X  
Logical Channel prioritisation X X X  
Scheduling information reporting X X  
Radio Resource Selection X X
* * *
## 4.5 Channel structure
The MAC sublayer operates on the channels defined below; transport channels
are SAPs between MAC and Layer 1, logical channels are SAPs between MAC and
RLC.
### 4.5.1 Transport Channels
The transport channels used by MAC are described in Table 4.5.1-1 below.
Table 4.5.1-1: Transport channels used by MAC
* * *
Transport channel name Acronym Downlink Uplink Sidelink tx Sidelink rx
Broadcast Channel BCH X  
Downlink Shared Channel DL-SCH X  
Paging Channel PCH X  
Multicast Channel MCH X  
Uplink Shared Channel UL-SCH X  
Random Access Channel RACH X  
Sidelink Broadcast Channel SL-BCH X X Sidelink Discovery Channel SL-DCH X X
Sidelink Shared Channel SL-SCH X X
* * *
### 4.5.2 Logical Channels
The MAC layer provides data transfer services on logical channels. A set of
logical channel types is defined for different kinds of data transfer services
as offered by MAC.
Each logical channel type is defined by what type of information is
transferred.
MAC provides the control and traffic channels listed in Table 4.5.2-1 below.
Table 4.5.2-1: Logical channels provided by MAC.
* * *
Logical channel name Acronym Control channel Traffic channel Broadcast Control
Channel BCCH X  
Bandwidth Reduced Broadcast Control Channel BR-BCCH X  
Paging Control Channel PCCH X  
Common Control Channel CCCH X  
Dedicated Control Channel DCCH X  
Multicast Control Channel MCCH X  
Single Cell Multicast Control Channel SC-MCCH X  
Dedicated Traffic Channel DTCH X Multicast Traffic Channel MTCH X Single-Cell
Multicast Traffic Channel SC-MTCH X Sidelink Traffic Channel STCH X Sidelink
Broadcast Control Channel SBCCH X
* * *
### 4.5.3 Mapping of Transport Channels to Logical Channels
The mapping of logical channels on transport channels depends on the
multiplexing that is configured by RRC.
#### 4.5.3.1 Uplink mapping
The MAC entity is responsible for mapping logical channels for the uplink onto
uplink transport channels. The uplink logical channels can be mapped as
described in Figure 4.5.3.1-1 and Table 4.5.3.1-1.
Figure 4.5.3.1-1
Table 4.5.3.1-1: Uplink channel mapping.
* * *
Transport channel\ UL-SCH RACH Logical channel
CCCH X
DCCH X
DTCH X
* * *
#### 4.5.3.2 Downlink mapping
The MAC entity is responsible for mapping the downlink logical channels to
downlink transport channels. The downlink logical channels can be mapped as
described in Figure 4.5.3.2-1 and Table 4.5.3.2-1.
Figure 4.5.3.2-1
Table 4.5.3.2-1: Downlink channel mapping.
* * *
Transport channel\ BCH PCH DL-SCH MCH Logical channel
BCCH X X
BR-BCCH X
PCCH X
CCCH X
DCCH X
DTCH X
MCCH X
MTCH X
SC-MCCH X
SC-MTCH X
* * *
#### 4.5.3.3 Sidelink mapping
The MAC entity is responsible for mapping the sidelink logical channels to
sidelink transport channels. The sidelink logical channels can be mapped as
described in Figure 4.5.3.3-1 and Table 4.5.3.3-1.
Figure 4.5.3.3-1
Table 4.5.3.3-1: Sidelink channel mapping.
* * *
Transport channel\ SL-SCH SL-BCH SL-DCH Logical channel
STCH X
SBCCH X
* * *
# 5 MAC procedures
## 5.1 Random Access procedure
### 5.1.1 Random Access Procedure initialization
The Random Access procedure described in this subclause is initiated by a
PDCCH order, by the MAC sublayer itself or by the RRC sublayer. Random Access
procedure on an SCell shall only be initiated by a PDCCH order. If a MAC
entity receives a PDCCH transmission consistent with a PDCCH order [5] masked
with its C-RNTI, and for a specific Serving Cell, the MAC entity shall
initiate a Random Access procedure on this Serving Cell. For Random Access on
the SpCell a PDCCH order or RRC optionally indicate the _ra-PreambleIndex_ and
the _ra-PRACH-MaskIndex, except for NB-IoT where the subcarrier index is
indicated; and for Random Access on an SCell, the PDCCH order indicates the
ra-PreambleIndex_ with a value different from 000000 and the _ra-PRACH-
MaskIndex_. For the pTAG preamble transmission on PRACH and reception of a
PDCCH order are only supported for SpCell. If the UE is an NB-IoT UE and is
configured with a non-anchor carrier, perform the Random Access procedure on
the anchor carrier.
Before the procedure can be initiated, the following information for related
Serving Cell is assumed to be available for UEs other than NB-IoT UEs, BL UEs
or UEs in enhanced coverage [8], unless explicitly stated otherwise:
\- the available set of PRACH resources for the transmission of the Random
Access Preamble, _prach-ConfigIndex_.
\- the groups of Random Access Preambles and the set of available Random
Access Preambles in each group (SpCell only):
The preambles that are contained in Random Access Preambles group A and Random
Access Preambles group B are calculated from the parameters _numberOfRA-
Preambles_ and _sizeOfRA-PreamblesGroupA_ :
If _sizeOfRA-PreamblesGroupA_ is equal to _numberOfRA-Preambles_ then there is
no Random Access Preambles group B. The preambles in Random Access Preamble
group A are the preambles 0 to _sizeOfRA-PreamblesGroupA_ \-- 1 and, if it
exists, the preambles in Random Access Preamble group B are the preambles
_sizeOfRA-PreamblesGroupA_ to _numberOfRA-Preambles_ \-- 1 from the set of 64
preambles as defined in [7].
\- if Random Access Preambles group B exists, the thresholds,
_messagePowerOffsetGroupB_ and _messageSizeGroupA_ , the configured UE
transmitted power of the Serving Cell performing the Random Access Procedure,
P~CMAX,\ c~ [10], and the offset between the preamble and Msg3,
_deltaPreambleMsg3_ , that are required for selecting one of the two groups of
Random Access Preambles (SpCell only).
\- the RA response window size _ra-ResponseWindowSize_.
\- the power-ramping factor _powerRampingStep_.
\- the maximum number of preamble transmission _preambleTransMax_.
\- the initial preamble power _preambleInitialReceivedTargetPower_.
\- the preamble format based offset DELTA_PREAMBLE (see subclause 7.6).
\- the maximum number of Msg3 HARQ transmissions _maxHARQ-Msg3Tx_ (SpCell
only).
\- the Contention Resolution Timer _mac-ContentionResolutionTimer_ (SpCell
only).
NOTE: The above parameters may be updated from upper layers before each Random
Access procedure is initiated.
The following information for related Serving Cell is assumed to be available
before the procedure can be initiated for NB-IoT UEs, BL UEs or UEs in
enhanced coverage [8]:
\- if the UE is a BL UE or a UE in enhanced coverage:
\- the available set of PRACH resources associated with each enhanced coverage
level supported in the Serving Cell for the transmission of the Random Access
Preamble, _prach-ConfigIndex_.
\- the groups of Random Access Preambles and the set of available Random
Access Preambles in each group(SpCell only):
\- If _sizeOfRA-PreamblesGroupA_ is not equal to _numberOfRA-Preambles_ :
\- Random Access Preambles group A and B exist and are calculated as above;
\- else:
\- the preambles that are contained in Random Access Preamble groups for each
enhanced coverage level, if it exists, are the preambles _firstPreamble_ to
_lastPreamble_.
NOTE: When a PRACH resource is shared for multiple enhanced coverage levels,
and enhanced coverage levels are differentiated by different preamble indices,
Group A and Group B is not used for this PRACH resource.
\- if the UE is a NB-IoT UE:
\- the available set of PRACH resources supported in the Serving Cell,
_nprach-ParametersList_.
\- for random access resource selection and preamble transmission:
> \- a PRACH resource is mapped into an enhanced coverage level.
\- each PRACH resource contains a set of _nprach-NumSubcarriers_ subcarriers
which can be partitioned into one or two groups for single/multi-tone Msg3
transmission by _nprach-SubcarrierMSG3-RangeStart_ and _nprach-NumCBRA-
StartSubcarriers_ as specified in TS 36.211 [7, 10.1.6.1]. Each group is
referred to as a Random Access Preamble group below in the procedure text.
\- a subcarrier is identified by the subcarrier index in the range:\ [_nprach-
SubcarrierOffset_ , _nprach-SubcarrierOffset_ \+ _nprach-NumSubcarriers_ -1]
\- each subcarrier of a Random Access Preamble group corresponds to a Random
Access Preamble.
\- when the subcarrier index is explicitly sent from the eNB as part of a
PDCCH order _ra-PreambleIndex_ shall be set to the signalled subcarrier index.
\- the mapping of the PRACH resources into enhanced coverage levels is
determined according to the following:
\- the number of enhanced coverage levels is equal to one plus the number of
RSRP thresholds present in _rsrp-ThresholdsPrachInfoList_.
\- each enhanced coverage level has one PRACH resource present in _nprach-
ParametersList_.
\- enhanced coverage levels are numbered from 0 and the mapping of PRACH
resources to enhanced coverage levels are done in increasing
_numRepetitionsPerPreambleAttempt_ order.
\- the criteria to select PRACH resources based on RSRP measurement per
enhanced coverage level supported in the Serving Cell _rsrp-
ThresholdsPrachInfoList_.
\- the maximum number of preamble transmission attempts per enhanced coverage
level supported in the Serving Cell _maxNumPreambleAttemptCE_.
\- the number of repetitions required for preamble transmission per attempt
for each enhanced coverage level supported in the Serving Cell
_numRepetitionPerPreambleAttempt_.
\- the configured UE transmitted power of the Serving Cell performing the
Random Access Procedure, P~CMAX,\ c~ [10].
\- the RA response window size _ra-ResponseWindowSize_ and the Contention
Resolution Timer _mac-ContentionResolutionTimer_ (SpCell only) per enhanced
coverage level supported in the Serving Cell.
\- the power-ramping factor _powerRampingStep_.
\- the maximum number of preamble transmission _preambleTransMax-CE_.
\- the initial preamble power _preambleInitialReceivedTargetPower_.
\- the preamble format based offset DELTA_PREAMBLE (see subclause 7.6). For
NB-IoT the DELTA_PREAMBLE is set to 0.
The Random Access procedure shall be performed as follows:
\- Flush the Msg3 buffer;
\- set the PREAMBLE_TRANSMISSION_COUNTER to 1;
\- if the UE is an NB-IoT UE, a BL UE or a UE in enhanced coverage:
\- set the PREAMBLE_TRANSMISSION_COUNTER_CE to 1;
\- if the starting enhanced coverage level, or for NB-IoT the starting number
of NPRACH repetitions, has been indicated in the PDCCH order which initiated
the Random Access procedure, or if the starting enhanced coverage level has
been provided by upper layers:
\- the MAC entity considers itself to be in that enhanced coverage level
regardless of the measured RSRP;
\- else:
\- if the RSRP threshold of enhanced coverage level 3 is configured by upper
layers in _rsrp-ThresholdsPrachInfoList_ and the measured RSRP is less than
the RSRP threshold of enhanced coverage level 3 and the UE is capable of
enhanced coverage level 3 then:
\- the MAC entity considers to be in enhanced coverage level 3;
\- else if the RSRP threshold of enhanced coverage level 2 configured by upper
layers in _rsrp-ThresholdsPrachInfoList_ and the measured RSRP is less than
the RSRP threshold of enhanced coverage level 2 and the UE is capable of
enhanced coverage level 2 then:
\- the MAC entity considers to be in enhanced coverage level 2;
\- else if the measured RSRP is less than the RSRP threshold of enhanced
coverage level 1 as configured by upper layers in _rsrp-
ThresholdsPrachInfoList_ then:
\- the MAC entity considers to be in enhanced coverage level 1;
\- else:
\- the MAC entity considers to be in enhanced coverage level 0;
\- set the backoff parameter value to 0 ms;
\- for the RN, suspend any RN subframe configuration;
\- proceed to the selection of the Random Access Resource (see subclause
5.1.2).
NOTE: There is only one Random Access procedure ongoing at any point in time
in a MAC entity. If the MAC entity receives a request for a new Random Access
procedure while another is already ongoing in the MAC entity, it is up to UE
implementation whether to continue with the ongoing procedure or start with
the new procedure.
### 5.1.2 Random Access Resource selection
The Random Access Resource selection procedure shall be performed as follows:
\- For BL UEs or UEs in enhanced coverage, select the PRACH resource set
corresponding to the selected enhanced coverage level.
\- If, except for NB-IoT, _ra-PreambleIndex_ (Random Access Preamble) and _ra-
PRACH-MaskIndex_ (PRACH Mask Index) have been explicitly signalled and _ra-
PreambleIndex_ is not 000000:
\- the Random Access Preamble and the PRACH Mask Index are those explicitly
signalled;
\- else, for NB-IoT, if _ra-PreambleIndex_ (Random Access Preamble) and PRACH
resource have been explicitly signalled:
\- the PRACH resource is that explicitly signalled;
\- if the _ra-PreambleIndex_ signalled is not 000000:
\- the Random Access Preamble is set to _nprach-SubcarrierOffset_ \+ (_ra-
PreambleIndex_ modulo _nprach-NumSubcarriers_), where _nprach-
SubcarrierOffset_ and _nprach-NumSubcarriers_ are parameters in the currently
used PRACH resource.
\- else:
\- select the Random Access Preamble group according to the PRACH resource and
the support for multi-tone Msg3 transmission. A UE supporting multi-tone Msg3
shall only select the single-tone Msg3 Random Access Preambles group if there
is no multi-tone Msg3 Random Access Preambles group.
\- randomly select a Random Access Preamble within the selected group.
\- else the Random Access Preamble shall be selected by the MAC entity as
follows:
\- For BL UEs or UEs in enhanced coverage, if Random Access Preamble group B
does not exist, select the Random Access Preambles group corresponding to the
selected enhanced coverage level.
\- For NB-IoT, select the PRACH resource corresponding to the selected
enhanced coverage level, and select the Random Access Preambles group
corresponding to the PRACH resource and the support for multi-tone Msg3
transmission. A UE supporting multi-tone Msg3 shall only select the single-
tone Msg3 Random Access Preambles group if there is no multi-tone Msg3 Random
Access Preambles group.
\- Except for BL UEs or UEs in enhanced coverage in case preamble group B does
not exist, or except for NB-IoT UEs, if Msg3 has not yet been transmitted, the
MAC entity shall:
\- if Random Access Preambles group B exists and any of the following events
occur:
\- the potential message size (UL data available for transmission plus MAC
header and, where required, MAC control elements) is greater than
_messageSizeGroupA_ and the pathloss is less than P~CMAX,c~ (of the Serving
Cell performing the Random Access Procedure) --
_preambleInitialReceivedTargetPower_ \-- _deltaPreambleMsg3_ \--
_messagePowerOffsetGroupB_ ;
\- the Random Access procedure was initiated for the CCCH logical channel and
the CCCH SDU size plus MAC header is greater than _messageSizeGroupA_ ;
\- select the Random Access Preambles group B;
\- else:
\- select the Random Access Preambles group A.
\- else, if Msg3 is being retransmitted, the MAC entity shall:
\- select the same group of Random Access Preambles as was used for the
preamble transmission attempt corresponding to the first transmission of Msg3.
\- randomly select a Random Access Preamble within the selected group. The
random function shall be such that each of the allowed selections can be
chosen with equal probability;
\- except for NB-IoT, set PRACH Mask Index to 0.
\- determine the next available subframe containing PRACH permitted by the
restrictions given by the _prach-ConfigIndex_ (except for NB-IoT)_,_ the PRACH
Mask Index (except for NB-IoT, see subclause 7.3), physical layer timing
requirements [2] and in case of NB-IoT, the subframes occupied by PRACH
resources related to a higher enhanced coverage level (a MAC entity may take
into account the possible occurrence of measurement gaps when determining the
next available PRACH subframe);
\- if the transmission mode is TDD and the PRACH Mask Index is equal to zero:
\- if _ra-PreambleIndex_ was explicitly signalled and it was not 000000 (i.e.,
not selected by MAC):
\- randomly select, with equal probability, one PRACH from the PRACHs
available in the determined subframe.
\- else:
\- randomly select, with equal probability, one PRACH from the PRACHs
available in the determined subframe and the next two consecutive subframes.
\- else:
\- determine a PRACH within the determined subframe in accordance with the
requirements of the PRACH Mask Index, if any.
\- for NB-IoT UEs, BL UEs or UEs in enhanced coverage, select the _ra-
ResponseWindowSize_ and _mac-ContentionResolutionTimer_ corresponding to the
selected enhanced coverage level and PRACH.
\- proceed to the transmission of the Random Access Preamble (see subclause
5.1.3).
### 5.1.3 Random Access Preamble transmission
The random-access procedure shall be performed as follows:
\- set PREAMBLE_RECEIVED_TARGET_POWER to _preambleInitialReceivedTargetPower_
\+ DELTA_PREAMBLE + (PREAMBLE_TRANSMISSION_COUNTER -- 1) * _powerRampingStep_
;
\- if the UE is a BL UE or a UE in enhanced coverage:
\- the PREAMBLE_RECEIVED_TARGET_POWER is set to:\
PREAMBLE_RECEIVED_TARGET_POWER - 10 *
log10(_numRepetitionPerPreambleAttempt_);
\- if NB-IoT:
\- for enhanced coverage level 0, the PREAMBLE_RECEIVED_TARGET_POWER is set
to:\ PREAMBLE_RECEIVED_TARGET_POWER - 10 *
log10(_numRepetitionPerPreambleAttempt_)
\- for other enhanced coverage levels, the PREAMBLE_RECEIVED_TARGET_POWER is
set corresponding to the max UE output power;
\- if the UE is an NB-IoT UE, a BL UE or a UE in enhanced coverage:
\- instruct the physical layer to transmit a preamble with the number of
repetitions required for preamble transmission corresponding to the selected
preamble group (i.e., _numRepetitionPerPreambleAttempt_) using the selected
PRACH corresponding to the selected enhanced coverage level, corresponding RA-
RNTI, preamble index or for NB-IoT subcarrier index, and
PREAMBLE_RECEIVED_TARGET_POWER.
\- else:
\- instruct the physical layer to transmit a preamble using the selected
PRACH, corresponding RA-RNTI, preamble index and
PREAMBLE_RECEIVED_TARGET_POWER.
### 5.1.4 Random Access Response reception
Once the Random Access Preamble is transmitted and regardless of the possible
occurrence of a measurement gap or a Sidelink Discovery Gap for Transmission
or a Sidelink Discovery Gap for Reception, the MAC entity shall monitor the
PDCCH of the SpCell for Random Access Response(s) identified by the RA-RNTI
defined below, in the RA Response window which starts at the subframe that
contains the end of the preamble transmission [7] plus three subframes and has
length _ra-ResponseWindowSize_. If the UE is a BL UE or a UE in enhanced
coverage, RA Response window starts at the subframe that contains the end of
the last preamble repetition plus three subframes and has length _ra-
ResponseWindowSize_ for the corresponding enhanced coverage level. If the UE
is an NB-IoT UE, in case the number of NPRACH repetitions is greater than or
equal to 64, RA Response window starts at the subframe that contains the end
of the last preamble repetition plus 41 subframes and has length _ra-
ResponseWindowSize_ for the corresponding enhanced coverage level, and in case
the number of NPRACH repetitions is less than 64, RA Response window starts at
the subframe that contains the end of the last preamble repetition plus 4
subframes and has length _ra-ResponseWindowSize_ for the corresponding
enhanced coverage level. The RA-RNTI associated with the PRACH in which the
Random Access Preamble is transmitted, is computed as:
RA-RNTI= 1 + t_id + 10*f_id
where t_id is the index of the first subframe of the specified PRACH (0≤ t_id
\ \- the MAC entity should update the Data Volume and Power Headroom Report
> MAC control element in the MAC PDU in the Msg3 buffer;
\- obtain the MAC PDU to transmit from the Msg3 buffer.
\- else:
\- obtain the MAC PDU to transmit from the \"Multiplexing and assembly\"
entity;
\- deliver the MAC PDU and the uplink grant and the HARQ information to the
identified HARQ process;
\- instruct the identified HARQ process to trigger a new transmission.
\- else:
\- deliver the uplink grant and the HARQ information (redundancy version) to
the identified HARQ process;
\- instruct the identified HARQ process to generate an adaptive
retransmission.
\- else, if the HARQ buffer of this HARQ process is not empty:
\- instruct the identified HARQ process to generate a non-adaptive
retransmission.
When determining if NDI has been toggled compared to the value in the previous
transmission the MAC entity shall ignore NDI received in all uplink grants on
PDCCH for its Temporary C-RNTI.
#### 5.4.2.2 HARQ process
Each HARQ process is associated with a HARQ buffer.
For synchronous HARQ, each HARQ process shall maintain a state variable
CURRENT_TX_NB, which indicates the number of transmissions that have taken
place for the MAC PDU currently in the buffer, and a state variable
HARQ_FEEDBACK, which indicates the HARQ feedback for the MAC PDU currently in
the buffer. When the HARQ process is established, CURRENT_TX_NB shall be
initialized to 0.
The sequence of redundancy versions is 0, 2, 3, 1. The variable CURRENT_IRV is
an index into the sequence of redundancy versions. This variable is up-dated
modulo 4. For BL UEs or UEs in enhanced coverage see subclause 8.6.1 in [2]
for the sequence of redundancy versions and redundancy version determination.
For NB-IoT UEs see subclause 16.5.1.2 in [2] for the sequence of redundancy
versions and redundancy version determination.
For NB-IoT UEs, BL UEs or UEs in enhanced coverage for UL_REPETITION_NUMBER
for Mode B operation, the same redundancy version is used multiple times
before cycling to the next redundancy version as specified in Subclause
16.5.1.2, 8.6.1 and 7.1.7.1 in [2].
New transmissions are performed on the resource and with the MCS indicated on
PDCCH or Random Access Response. Adaptive retransmissions are performed on the
resource and, if provided, with the MCS indicated on PDCCH. Non-adaptive
retransmission is performed on the same resource and with the same MCS as was
used for the last made transmission attempt.
For synchronous HARQ, the MAC entity is configured with a maximum number of
HARQ transmissions and a maximum number of Msg3 HARQ transmissions by RRC:
_maxHARQ-Tx_ and _maxHARQ-Msg3Tx_ respectively. For transmissions on all HARQ
processes and all logical channels except for transmission of a MAC PDU stored
in the Msg3 buffer, the maximum number of transmissions shall be set to
_maxHARQ-Tx_. For transmission of a MAC PDU stored in the Msg3 buffer, the
maximum number of transmissions shall be set to _maxHARQ-Msg3Tx_.
When the HARQ feedback is received for this TB, the HARQ process shall:
\- set HARQ_FEEDBACK to the received value.
If the HARQ entity requests a new transmission, the HARQ process shall:
\- if UL HARQ operation is synchronous:
\- set CURRENT_TX_NB to 0;
\- set HARQ_FEEDBACK to NACK;
\- set CURRENT_IRV to 0;
\- store the MAC PDU in the associated HARQ buffer;
\- store the uplink grant received from the HARQ entity;
\- generate a transmission as described below.
If the HARQ entity requests a retransmission, the HARQ process shall:
\- if UL HARQ operation is synchronous:
\- increment CURRENT_TX_NB by 1;
\- if the HARQ entity requests an adaptive retransmission:
\- store the uplink grant received from the HARQ entity;
\- set CURRENT_IRV to the index corresponding to the redundancy version value
provided in the HARQ information;
\- if UL HARQ operation is synchronous:
\- set HARQ_FEEDBACK to NACK;
\- generate a transmission as described below.
\- else if the HARQ entity requests a non-adaptive retransmission:
\- if UL HARQ operation is asynchronous or HARQ_FEEDBACK = NACK:
\- generate a transmission as described below.
NOTE: When receiving a HARQ ACK alone, the MAC entity keeps the data in the
HARQ buffer.
NOTE: When no UL-SCH transmission can be made due to the occurrence of a
measurement gap or a Sidelink Discovery Gap for Transmission, no HARQ feedback
can be received and a non-adaptive retransmission follows.
NOTE: For asynchronous HARQ operation, UL retransmissions are triggered only
by adaptive retransmission grants, except for retransmissions within a bundle.
To generate a transmission, the HARQ process shall:
\- if the MAC PDU was obtained from the Msg3 buffer; or
\- if Sidelink Discovery Gaps for Transmission are not configured by upper
layers, and there is no measurement gap at the time of the transmission and,
in case of retransmission, the retransmission does not collide with a
transmission for a MAC PDU obtained from the Msg3 buffer in this TTI; or
\- if Sidelink Discovery Gaps for Transmission are configured by upper layers,
and there is no measurement gap at the time of the transmission and, in case
of retransmission, the retransmission does not collide with a transmission for
a MAC PDU obtained from the Msg3 buffer, and there is no Sidelink Discovery
Gap for Transmission in this TTI; or
\- if Sidelink Discovery Gaps for Transmission are configured by upper layers,
and there is no measurement gap at the time of the transmission and, in case
of retransmission, the retransmission does not collide with a transmission for
a MAC PDU obtained from the Msg3 buffer, and there is a Sidelink Discovery Gap
for Transmission, and there is no configured grant for transmission on SL-DCH
in this TTI:
\- instruct the physical layer to generate a transmission according to the
stored uplink grant with the redundancy version corresponding to the
CURRENT_IRV value;
\- increment CURRENT_IRV by 1;
\- if UL HARQ operation is synchronous and there is a measurement gap or
Sidelink Discovery Gap for Reception at the time of the HARQ feedback
reception for this transmission and if the MAC PDU was not obtained from the
Msg3 buffer:
\- set HARQ_FEEDBACK to ACK at the time of the HARQ feedback reception for
this transmission.
After performing above actions, if UL HARQ operation is synchronous the HARQ
process then shall:
\- if CURRENT_TX_NB = maximum number of transmissions -- 1:
\- flush the HARQ buffer;
### 5.4.3 Multiplexing and assembly
#### 5.4.3.1 Logical channel prioritization
The Logical Channel Prioritization procedure is applied when a new
transmission is performed.
RRC controls the scheduling of uplink data by signalling for each logical
channel: _priority_ where an increasing _priority_ value indicates a lower
priority level, _prioritisedBitRate_ which sets the Prioritized Bit Rate
(PBR), _bucketSizeDuration_ which sets the Bucket Size Duration (BSD). For NB-
IoT, _prioritisedBitRate_ , _bucketSizeDuration_ and the corresponding steps
of the Logical Channel Prioritisation procedure (i.e., Step 1 and Step 2
below) are not applicable.
The MAC entity shall maintain a variable Bj for each logical channel j. Bj
shall be initialized to zero when the related logical channel is established,
and incremented by the product PBR × TTI duration for each TTI, where PBR is
Prioritized Bit Rate of logical channel j. However, the value of Bj can never
exceed the bucket size and if the value of Bj is larger than the bucket size
of logical channel j, it shall be set to the bucket size. The bucket size of a
logical channel is equal to PBR × BSD, where PBR and BSD are configured by
upper layers.
The MAC entity shall perform the following Logical Channel Prioritization
procedure when a new transmission is performed:
\- The MAC entity shall allocate resources to the logical channels in the
following steps:
\- Step 1: All the logical channels with Bj > 0 are allocated resources in a
decreasing priority order. If the PBR of a logical channel is set to
\"infinity\", the MAC entity shall allocate resources for all the data that is
available for transmission on the logical channel before meeting the PBR of
the lower priority logical channel(s);
\- Step 2: the MAC entity shall decrement Bj by the total size of MAC SDUs
served to logical channel j in Step 1;
NOTE: The value of Bj can be negative.
\- Step 3: if any resources remain, all the logical channels are served in a
strict decreasing priority order (regardless of the value of Bj) until either
the data for that logical channel or the UL grant is exhausted, whichever
comes first. Logical channels configured with equal priority should be served
equally.
\- The UE shall also follow the rules below during the scheduling procedures
above:
\- the UE should not segment an RLC SDU (or partially transmitted SDU or
retransmitted RLC PDU) if the whole SDU (or partially transmitted SDU or
retransmitted RLC PDU) fits into the remaining resources of the associated MAC
entity;
\- if the UE segments an RLC SDU from the logical channel, it shall maximize
the size of the segment to fill the grant of the associated MAC entity as much
as possible;
\- the UE should maximise the transmission of data.
\- if the MAC entity is given an UL grant size that is equal to or larger than
4 bytes while having data available for transmission, the MAC entity shall not
transmit only padding BSR and/or padding (unless the UL grant size is less
than 7 bytes and an AMD PDU segment needs to be transmitted).
The MAC entity shall not transmit data for a logical channel corresponding to
a radio bearer that is suspended (the conditions for when a radio bearer is
considered suspended are defined in [8]).
For the Logical Channel Prioritization procedure, the MAC entity shall take
into account the following relative priority in decreasing order:
\- MAC control element for C-RNTI or data from UL-CCCH;
\- MAC control element for DPR;
\- MAC control element for BSR, with exception of BSR included for padding;
\- MAC control element for PHR, Extended PHR, or Dual Connectivity PHR;
\- MAC control element for Sidelink BSR, with exception of Sidelink BSR
included for padding;
\- data from any Logical Channel, except data from UL-CCCH;
\- MAC control element for BSR included for padding;
\- MAC control element for Sidelink BSR included for padding.
NOTE: When the MAC entity is requested to transmit multiple MAC PDUs in one
TTI, steps 1 to 3 and the associated rules may be applied either to each grant
independently or to the sum of the capacities of the grants. Also the order in
which the grants are processed is left up to UE implementation. It is up to
the UE implementation to decide in which MAC PDU a MAC control element is
included when MAC entity is requested to transmit multiple MAC PDUs in one
TTI. When the UE is requested to generate MAC PDU(s) in two MAC entities in
one TTI, it is up to UE implementation in which order the grants are
processed.
#### 5.4.3.2 Multiplexing of MAC Control Elements and MAC SDUs
The MAC entity shall multiplex MAC control elements and MAC SDUs in a MAC PDU
according to subclauses 5.4.3.1 and 6.1.2.
### 5.4.4 Scheduling Request
The Scheduling Request (SR) is used for requesting UL-SCH resources for new
transmission.
When an SR is triggered, it shall be considered as pending until it is
cancelled. All pending SR(s) shall be cancelled and _sr-ProhibitTimer_ shall
be stopped when a MAC PDU is assembled and this PDU includes a BSR which
contains buffer status up to (and including) the last event that triggered a
BSR (see subclause 5.4.5), or, if all pending SR(s) are triggered by Sidelink
BSR, when a MAC PDU is assembled and this PDU includes a Sidelink BSR which
contains buffer status up to (and including) the last event that triggered a
Sidelink BSR (see subclause 5.14.1.4), or, if all pending SR(s) are triggered
by Sidelink BSR, when upper layers configure autonomous resource selection, or
when the UL grant(s) can accommodate all pending data available for
transmission.
If an SR is triggered and there is no other SR pending, the MAC entity shall
set the SR_COUNTER to 0.
As long as one SR is pending, the MAC entity shall for each TTI:
\- if no UL-SCH resources are available for a transmission in this TTI:
\- if the MAC entity has no valid PUCCH resource for SR configured in any TTI:
initiate a Random Access procedure (see subclause 5.1) on the SpCell and
cancel all pending SRs;
\- else if the MAC entity has at least one valid PUCCH resource for SR
configured for this TTI and if this TTI is not part of a measurement gap or
Sidelink Discovery Gap for Transmission and if _sr-ProhibitTimer_ is not
running:
\- if SR_COUNTER \ \- else:
\- set Subframe_Offset to 0.
\- consider sequentially that the N^th^ grant occurs in the subframe for
which:
\- (10 * SFN + subframe) = [(10 * SFN~start\ time~ + subframe~start\ time~) +
N * _semiPersistSchedIntervalUL_ \+ Subframe_Offset * (N modulo 2)] modulo
10240.
Where SFN~start\ time~ and subframe~start\ time~ are the SFN and subframe,
respectively, at the time the configured uplink grant were (re-)initialised.
The MAC entity shall clear the configured uplink grant immediately after
_implicitReleaseAfter_ [8] number of consecutive new MAC PDUs each containing
zero MAC SDUs have been provided by the Multiplexing and Assembly entity, on
the Semi-Persistent Scheduling resource.
NOTE: Retransmissions for Semi-Persistent Scheduling can continue after
clearing the configured uplink grant.
For BL UEs or UEs in enhanced coverage SFN~start\ time~ and subframe~start\
time~ refer to SFN and subframe of the first transmission of PUSCH where
configured uplink grant was (re-)initialized.
## 5.11 Handling of unknown, unforeseen and erroneous protocol data
When a MAC entity receives a MAC PDU for the MAC entity\'s C-RNTI or Semi-
Persistent Scheduling C-RNTI, or by the configured downlink assignment, or on
SL-SCH, containing reserved or invalid values, the MAC entity shall:
\- discard the received PDU.
When a MAC entity receives a MAC PDU on MCH containing reserved values, or on
DL-SCH containing reserved values for G-RNTI or SC-RNTI, the MAC entity shall:
\- ignore the MAC PDU subheaders containing reserved values and the
corresponding MAC SDUs;
\- in the MAC control elements, ignore the fields containing reserved values
and the fields associated with the fields containing reserved values.
## 5.12 MCH reception
MCH transmission may occur in subframes configured by upper layer for MCCH or
MTCH transmission. For each such subframe, upper layer indicates if
_signallingMCS_ or _dataMCS_ applies. The transmission of an MCH occurs in a
set of subframes defined by _PMCH-Config_. An MCH Scheduling Information MAC
control element is included in the first subframe allocated to the MCH within
the MCH scheduling period to indicate the position of each MTCH and unused
subframes on the MCH. If _pmch-InfoListExt_ is configured for an MCH, an
Extended MCH Scheduling Information MAC control element is included in the
first subframe allocated to the corresponding MCH within the MCH scheduling
period to indicate the position of each MTCH and unused subframes on the MCH,
and to indicate whether MTCH transmission is to be suspended. The MAC entity
shall assume that the first scheduled MTCH starts immediately after the MCCH
or the MCH Scheduling Information MAC control element or the Extended MCH
Scheduling Information MAC control element if the MCCH is not present, and the
other scheduled MTCH(s) start immediately after the previous MTCH, at the
earliest in the subframe where the previous MTCH stops. When the MAC entity
needs to receive MCH, the MAC entity shall:
\- attempt to decode the TB on the MCH;
\- if a TB on the MCH has been successfully decoded:
\- demultiplex the MAC PDU and deliver the MAC SDU(s) to upper layers.
When the MAC entity receives the Extended MCH Scheduling Information MAC
control element, the MAC entity shall indicate the MTCH(s) to be suspended to
the upper layers.
NOTE: The MAC entity should continue receiving MCH until the MTCH is removed
from the MCCH.
## 5.13 Activation/Deactivation of SCells
If the MAC entity is configured with one or more SCells, the network may
activate and deactivate the configured SCells. The SpCell is always activated.
The network activates and deactivates the SCell(s) by sending the
Activation/Deactivation MAC control element described in subclause 6.1.3.8.
Furthermore, the MAC entity maintains a _sCellDeactivationTimer_ timer per
configured SCell (except the SCell configured with PUCCH, if any) and
deactivates the associated SCell upon its expiry. The same initial timer value
applies to each instance of the _sCellDeactivationTimer_ and it is configured
by RRC. The configured SCells are initially deactivated upon addition and
after a handover. The configured SCG SCells are initially deactivated after a
SCG change.
The MAC entity shall for each TTI and for each configured SCell:
\- if the MAC entity receives an Activation/Deactivation MAC control element
in this TTI activating the SCell, the MAC entity shall in the TTI according to
the timing defined in [2]:
\- activate the SCell; i.e. apply normal SCell operation including:
\- SRS transmissions on the SCell;
\- CQI/PMI/RI/PTI/CRI reporting for the SCell;
\- PDCCH monitoring on the SCell;
\- PDCCH monitoring for the SCell;
\- PUCCH transmissions on the SCell, if configured.
\- start or restart the _sCellDeactivationTimer_ associated with the SCell;
\- trigger PHR according to subclause 5.4.6.
\- else, if the MAC entity receives an Activation/Deactivation MAC control
element in this TTI deactivating the SCell; or
\- if the _sCellDeactivationTimer_ associated with the activated SCell expires
in this TTI:
\- in the TTI according to the timing defined in [2]:
\- deactivate the SCell;
\- stop the _sCellDeactivationTimer_ associated with the SCell;
\- flush all HARQ buffers associated with the SCell.
\- if PDCCH on the activated SCell indicates an uplink grant or downlink
assignment; or
\- if PDCCH on the Serving Cell scheduling the activated SCell indicates an
uplink grant or a downlink assignment for the activated SCell:
\- restart the _sCellDeactivationTimer_ associated with the SCell;
\- if the SCell is deactivated:
\- not transmit SRS on the SCell;
\- not report CQI/PMI/RI/PTI/CRI for the SCell;
\- not transmit on UL-SCH on the SCell;
\- not transmit on RACH on the SCell;
\- not monitor the PDCCH on the SCell;
\- not monitor the PDCCH for the SCell;
\- not transmit PUCCH on the SCell.
HARQ feedback for the MAC PDU containing Activation/Deactivation MAC control
element shall not be impacted by PCell, PSCell and PUCCH SCell interruptions
due to SCell activation/deactivation [9].
NOTE: When SCell is deactivated, the ongoing Random Access procedure on the
SCell, if any, is aborted.
## 5.14 SL-SCH Data transfer
### 5.14.1 SL-SCH Data transmission
#### 5.14.1.1 SL Grant reception and SCI transmission
In order to transmit on the SL-SCH the MAC entity must have at least one
sidelink grant. Sidelink grants are selected as follows:
\- if the MAC entity is configured to receive a single sidelink grant
dynamically on the PDCCH and more data is available in STCH than can be
transmitted in the current SC period, the MAC entity shall:
\- using the received sidelink grant determine the set of subframes in which
transmission of SCI and transmission of first transport block occur according
to subclause 14.2.1 of [2];
\- consider the received sidelink grant to be a configured sidelink grant
occurring in those subframes starting at the beginning of the first available
SC Period which starts at least 4 subframes after the subframe in which the
sidelink grant was received, overwriting a previously configured sidelink
grant occurring in the same SC period, if available;
\- clear the configured sidelink grant at the end of the corresponding SC
Period;
\- else, if the MAC entity is configured by upper layers to receive multiple
sidelink grants dynamically on the PDCCH and more data is available in STCH
than can be transmitted in the current SC period, the MAC entity shall for
each received sidelink grant:
\- using the received sidelink grant determine the set of subframes in which
transmission of SCI and transmission of first transport block occur according
to subclause 14.2.1 of [2];
\- consider the received sidelink grant to be a configured sidelink grant
occurring in those subframes starting at the beginning of the first available
SC Period which starts at least 4 subframes after the subframe in which the
sidelink grant was received, overwriting a previously configured sidelink
grant received in the same subframe number but in a different radio frame as
this configured sidelink grant occurring in the same SC period, if available;
\- clear the configured sidelink grant at the end of the corresponding SC
Period;
\- else, if the MAC entity is configured by upper layers to transmit using one
or multiple pool(s) of resources as indicated in subclause 5.10.4 of [8] and
more data is available in STCH than can be transmitted in the current SC
period, the MAC entity shall for each sidelink grant to be selected:
\- if configured by upper layers to use a single pool of resources:
\- select that pool of resources for use;
\- else, if configured by upper layers to use multiple pools of resources:
\- select a pool of resources for use from the pools of resources configured
by upper layers whose associated priority list includes the priority of the
highest priority of the sidelink logical channel in the MAC PDU to be
transmitted;
NOTE: If more than one pool of resources has an associated priority list which
includes the priority of the sidelink logical channel with the highest
priority in the MAC PDU to be transmitted, it is left for UE implementation
which one of those pools of resources to select.
\- randomly select the time and frequency resources for SL-SCH and SCI of a
sidelink grant from the selected resource pool. The random function shall be
such that each of the allowed selections [2] can be chosen with equal
probability;
\- use the selected sidelink grant to determine the set of subframes in which
transmission of SCI and transmission of first transport block occur according
to subclause 14.2.1 of [2];
\- consider the selected sidelink grant to be a configured sidelink grant
occurring in those subframes starting at the beginning of the first available
SC Period which starts at least 4 subframes after the subframe in which the
sidelink grant was selected;
\- clear the configured sidelink grant at the end of the corresponding SC
Period;
NOTE: Retransmissions on SL-SCH cannot occur after the configured sidelink
grant has been cleared.
NOTE: If the MAC entity is configured by upper layers to transmit using one or
multiple pool(s) of resources as indicated in subclause 5.10.4 of [8], it is
left for UE implementation how many sidelink grants to select within one SC
period taking the number of sidelink processes into account.
The MAC entity shall for each subframe:
\- if the MAC entity has a configured sidelink grant occurring in this
subframe:
\- if the configured sidelink grant corresponds to transmission of SCI:
\- instruct the physical layer to transmit SCI corresponding to the configured
sidelink grant.
\- else if the configured sidelink grant corresponds to transmission of first
transport block:
\- deliver the configured sidelink grant and the associated HARQ information
to the Sidelink HARQ Entity for this subframe.
NOTE: If the MAC entity has multiple configured grants occurring in one
subframe and if not all of them can be processed due to the single-cluster SC-
FDM restriction, it is left for UE implementation which one of these to
process according to the procedure above.
#### 5.14.1.2 Sidelink HARQ operation
##### 5.14.1.2.1 Sidelink HARQ Entity
There is one Sidelink HARQ Entity at the MAC entity for transmission on SL-
SCH, which maintains a number of parallel Sidelink processes.
The number of transmitting Sidelink processes associated with the Sidelink
HARQ Entity is defined in [8].
A delivered and configured sidelink grant and its associated HARQ information
are associated with a Sidelink process.
For each subframe of the SL-SCH and each Sidelink process, the Sidelink HARQ
Entity shall:
\- if a sidelink grant has been indicated for this Sidelink process and there
is SL data, for sidelink logical channels of ProSe destination associated with
this sidelink grant, available for transmission:
\- obtain the MAC PDU from the \"Multiplexing and assembly\" entity;
\- deliver the MAC PDU and the sidelink grant and the HARQ information to this
Sidelink process;
\- instruct this Sidelink process to trigger a new transmission.
\- else, if this subframe corresponds to retransmission opportunity for this
Sidelink process:
\- instruct this Sidelink process to trigger a retransmission.
NOTE: The resources for retransmission opportunities are specified in
subclause 14.2.1 of [2].
##### 5.14.1.2.2 Sidelink process
The Sidelink process is associated with a HARQ buffer.
The sequence of redundancy versions is 0, 2, 3, 1. The variable CURRENT_IRV is
an index into the sequence of redundancy versions. This variable is updated
modulo 4.
New transmissions and retransmissions for a given SC period are performed on
the resource indicated in the sidelink grant and with the MCS configured by
upper layers (if configured).
If the Sidelink HARQ Entity requests a new transmission, the Sidelink process
shall:
\- set CURRENT_IRV to 0;
\- store the MAC PDU in the associated HARQ buffer;
\- store the sidelink grant received from the Sidelink HARQ Entity;
\- generate a transmission as described below.
If the Sidelink HARQ Entity requests a retransmission, the Sidelink process
shall:
\- generate a transmission as described below.
To generate a transmission, the Sidelink process shall:
\- if there is no uplink transmission or if the MAC entity is able to perform
uplink transmissions and transmissions on SL-SCH simultaneously at the time of
the transmission, and:
\- if there is no Sidelink Discovery Gap for Transmission or no transmission
on PSDCH at the time of the transmission:
\- instruct the physical layer to generate a transmission according to the
stored sidelink grant with the redundancy version corresponding to the
CURRENT_IRV value.
\- increment CURRENT_IRV by 1.
#### 5.14.1.3 Multiplexing and assembly
For PDU(s) associated with one SCI, MAC shall consider only logical channels
with the same Source Layer-2 ID-Destination Layer-2 ID pair.
Multiple transmissions within overlapping SC periods to different ProSe
Destinations are allowed subject to single-cluster SC-FDM constraint.
##### 5.14.1.3.1 Logical channel prioritization
The Logical Channel Prioritization procedure is applied when a new
transmission is performed. Each sidelink logical channel has an associated
priority which is the PPPP. Multiple sidelink logical channels may have the
same associated priority. The mapping between priority and LCID is left for UE
implementation.
The MAC entity shall perform the following Logical Channel Prioritization
procedure for each SCI transmitted in an SC period:
\- The MAC entity shall allocate resources to the sidelink logical channels in
the following steps:
\- Only consider sidelink logical channels not previously selected for this SC
period and the SC periods (if any) which are overlapping with this SC period,
to have data available for transmission.
\- Step 0: Select a ProSe Destination, having the sidelink logical channel
with the highest priority, among the sidelink logical channels having data
available for transmission;
\- For each MAC PDU associated to the SCI:
\- Step 1: Among the sidelink logical channels belonging to the selected ProSe
Destination and having data available for transmission, allocate resources to
the sidelink logical channel with the highest priority;
\- Step 2: if any resources remain, sidelink logical channels belonging to the
selected ProSe Destination are served in decreasing order of priority until
either the data for the sidelink logical channel(s) or the SL grant is
exhausted, whichever comes first. Sidelink logical channels configured with
equal priority should be served equally.
\- The UE shall also follow the rules below during the scheduling procedures
above:
\- the UE should not segment an RLC SDU (or partially transmitted SDU) if the
whole SDU (or partially transmitted SDU) fits into the remaining resources;
\- if the UE segments an RLC SDU from the sidelink logical channel, it shall
maximize the size of the segment to fill the grant as much as possible;
\- the UE should maximise the transmission of data;
\- if the MAC entity is given a sidelink grant size that is equal to or larger
than 10 bytes while having data available for transmission, the MAC entity
shall not transmit only padding.
##### 5.14.1.3.2 Multiplexing of MAC SDUs
The MAC entity shall multiplex MAC SDUs in a MAC PDU according to subclauses
5.14.1.3.1 and 6.1.6.
#### 5.14.1.4 Buffer Status Reporting
The sidelink Buffer Status reporting procedure is used to provide the serving
eNB with information about the amount of sidelink data available for
transmission in the SL buffers associated with the MAC entity. RRC controls
BSR reporting for the sidelink by configuring the two timers _periodic-BSR-
TimerSL_ and _retx-BSR-TimerSL_. Each sidelink logical channel belongs to a
ProSe Destination. Each sidelink logical channel is allocated to an LCG
depending on the priority of the sidelink logical channel and the mapping
between LCG ID and priority which is provided by upper layers in
_logicalChGroupInfoList_ [8]. LCG is defined per ProSe Destination.
A sidelink Buffer Status Report (BSR) shall be triggered if any of the
following events occur:
\- if the MAC entity has a configured SL-RNTI:
\- SL data, for a sidelink logical channel of a ProSe Destination, becomes
available for transmission in the RLC entity or in the PDCP entity (the
definition of what data shall be considered as available for transmission is
specified in [3] and [4] respectively) and either the data belongs to a
sidelink logical channel with higher priority than the priorities of the
sidelink logical channels which belong to any LCG belonging to the same ProSe
Destination and for which data is already available for transmission, or there
is currently no data available for transmission for any of the sidelink
logical channels belonging to the same ProSe Destination, in which case the
Sidelink BSR is referred below to as \"Regular Sidelink BSR\";
\- UL resources are allocated and number of padding bits remaining after a
Padding BSR has been triggered is equal to or larger than the size of the
Sidelink BSR MAC control element containing the buffer status for at least one
LCG of a ProSe Destination plus its subheader, in which case the Sidelink BSR
is referred below to as \"Padding Sidelink BSR\";
\- _retx-BSR-TimerSL_ expires and the MAC entity has data available for
transmission for any of the sidelink logical channels, in which case the
Sidelink BSR is referred below to as \"Regular Sidelink BSR\";
\- _periodic-BSR-TimerSL_ expires, in which case the Sidelink BSR is referred
below to as \"Periodic Sidelink BSR\";
\- else:
\- An SL-RNTI is configured by upper layers and SL data is available for
transmission in the RLC entity or in the PDCP entity (the definition of what
data shall be considered as available for transmission is specified in [3] and
[4] respectively), in which case the Sidelink BSR is referred below to as
\"Regular Sidelink BSR\".
For Regular and Periodic Sidelink BSR:
\- if the number of bits in the UL grant is equal to or larger than the size
of a Sidelink BSR containing buffer status for all LCGs having data available
for transmission plus its subheader:
\- report Sidelink BSR containing buffer status for all LCGs having data
available for transmission;
\- else report Truncated Sidelink BSR containing buffer status for as many
LCGs having data available for transmission as possible, taking the number of
bits in the UL grant into consideration.
For Padding Sidelink BSR:
\- if the number of padding bits remaining after a Padding BSR has been
triggered is equal to or larger than the size of a Sidelink BSR containing
buffer status for all LCGs having data available for transmission plus its
subheader:
\- report Sidelink BSR containing buffer status for all LCGs having data
available for transmission;
\- else report Truncated Sidelink BSR containing buffer status for as many
LCGs having data available for transmission as possible, taking the number of
bits in the UL grant into consideration.
If the Buffer Status reporting procedure determines that at least one Sidelink
BSR has been triggered and not cancelled:
\- if the MAC entity has UL resources allocated for new transmission for this
TTI and the allocated UL resources can accommodate a Sidelink BSR MAC control
element plus its subheader as a result of logical channel prioritization:
\- instruct the Multiplexing and Assembly procedure to generate the Sidelink
BSR MAC control element(s);
\- start or restart _periodic-BSR-TimerSL_ except when all the generated
Sidelink BSRs are Truncated Sidelink BSRs;
\- start or restart _retx-BSR-TimerSL_ ;
\- else if a Regular Sidelink BSR has been triggered:
\- if an uplink grant is not configured:
\- a Scheduling Request shall be triggered.
A MAC PDU shall contain at most one Sidelink BSR MAC control element, even
when multiple events trigger a Sidelink BSR by the time a Sidelink BSR can be
transmitted in which case the Regular Sidelink BSR and the Periodic Sidelink
BSR shall have precedence over the padding Sidelink BSR.
The MAC entity shall restart _retx-BSR-TimerSL_ upon reception of an SL grant.
All triggered regular Sidelink BSRs shall be cancelled in case the remaining
configured SL grant(s) valid for this SC Period can accommodate all pending
data available for transmission. All triggered Sidelink BSRs shall be
cancelled in case the MAC entity has no data available for transmission for
any of the sidelink logical channels. All triggered Sidelink BSRs shall be
cancelled when a Sidelink BSR (except for Truncated Sidelink BSR) is included
in a MAC PDU for transmission. All triggered Sidelink BSRs shall be cancelled,
and _retx-BSR-TimerSL_ and _periodic-BSR-TimerSL_ shall be stopped, when upper
layers configure autonomous resource selection.
The MAC entity shall transmit at most one Regular/Periodic Sidelink BSR in a
TTI. If the MAC entity is requested to transmit multiple MAC PDUs in a TTI, it
may include a padding Sidelink BSR in any of the MAC PDUs which do not contain
a Regular/Periodic Sidelink BSR.
All Sidelink BSRs transmitted in a TTI always reflect the buffer status after
all MAC PDUs have been built for this TTI. Each LCG shall report at the most
one buffer status value per TTI and this value shall be reported in all
Sidelink BSRs reporting buffer status for this LCG.
NOTE: A Padding Sidelink BSR is not allowed to cancel a triggered
Regular/Periodic Sidelink BSR. A Padding Sidelink BSR is triggered for a
specific MAC PDU only and the trigger is cancelled when this MAC PDU has been
built.
### 5.14.2 SL-SCH Data reception
#### 5.14.2.1 SCI reception
SCI transmitted on the PSCCH indicate if there is a transmission on SL-SCH and
provide the relevant HARQ information.
The MAC entity shall:
\- for each subframe during which the MAC entity monitors PSCCH:
\- if SCI for this subframe has been received on the PSCCH with a Group
Destination ID of interest to this MAC entity:
\- determine the set of subframes in which reception of the first transport
blocks occur according to subclause 14.2.2 of [2] using the received SCI;
\- store the SCI and associated HARQ information as SCI valid for the
subframes corresponding to first transmission of each transport block;
\- for each subframe for which the MAC entity has a valid SCI:
\- deliver the SCI and the associated HARQ information to the Sidelink HARQ
Entity.
#### 5.14.2.2 Sidelink HARQ operation
##### 5.14.2.2.1 Sidelink HARQ Entity
There is one Sidelink HARQ Entity at the MAC entity for reception of the SL-
SCH which maintains a number of parallel Sidelink processes. Each Sidelink
process is associated with SCI in which the MAC entity is interested as
determined by the Group Destination ID of the SCI. The Sidelink HARQ Entity
directs HARQ information and associated TBs received on the SL-SCH to the
corresponding Sidelink processes.
The number of Receiving Sidelink processes associated with the Sidelink HARQ
Entity is defined in [8].
For each subframe of the SL-SCH, the Sidelink HARQ Entity shall:
\- for each SCI valid in this subframe:
\- allocate the TB received from the physical layer and the associated HARQ
information to a Sidelink process, associate this Sidelink process with this
SCI and consider this transmission to be a new transmission.
\- for each Sidelink process:
\- if this subframe corresponds to retransmission opportunity for the Sidelink
process according to its associated SCI:
\- allocate the TB received from the physical layer and the associated HARQ
information to the Sidelink process and consider this transmission to be a
retransmission.
##### 5.14.2.2.2 Sidelink process
For each subframe where a transmission takes place for the Sidelink process,
one TB and the associated HARQ information is received from the Sidelink HARQ
Entity.
The sequence of redundancy versions is 0, 2, 3, 1. The variable CURRENT_IRV is
an index into the sequence of redundancy versions. This variable is updated
modulo 4.
For each received TB and associated HARQ information, the Sidelink process
shall:
\- if this is a new transmission:
\- set CURRENT_IRV to 0;
\- store the received data in the soft buffer and optionally attempt to decode
the received data according to CURRENT_IRV.
\- else if this is a retransmission:
\- if the data for this TB has not yet been successfully decoded:
\- increment CURRENT_IRV by 1;
\- combine the received data with the data currently in the soft buffer for
this TB and optionally attempt to decode the combined data according to the
CURRENT_IRV.
\- if the data which the MAC entity attempted to decode was successfully
decoded for this TB:
\- if this is the first successful decoding of the data for this TB:
\- if the DST field of the decoded MAC PDU subheader is equal to the 16 MSB of
any of the Destination Layer-2 ID(s) of the UE for which the 8 LSB are equal
to the Group Destination ID in the corresponding SCI:
\- deliver the decoded MAC PDU to the disassembly and demultiplexing entity.
#### 5.14.2.3 Disassembly and demultiplexing
The MAC entity shall disassemble and demultiplex a MAC PDU as defined in
subclause 6.1.6.
## 5.15 SL-DCH data transfer
### 5.15.1 SL-DCH data transmission
#### 5.15.1.1 Resource allocation
In order to transmit MAC PDU(s) on SL-DCH, the MAC entity shall for every
discovery period and each MAC PDU:
\- if the MAC entity is configured by upper layers with a specific grant as
specified in [8]:
\- using the specific grant determine the set of subframes in which a
transmission of new MAC PDU(s) occur according to subclause 14.3.1 of [2];
\- consider the determined set of subframes to be a configured grant for the
corresponding discovery period;
\- for every subframe, if the MAC entity has a configured grant occurring in
that subframe, deliver the configured grant and the MAC PDU to the Sidelink
HARQ Entity;
\- clear the configured grant at the end of the corresponding discovery
period.
NOTE: Mapping between grant and physical resources is specified in subclause
9.5.6 of [7].
\- else if the MAC entity is configured with a single pool of resources by
upper layers:
\- select a random value p1 in the range from 0 to 1, where the random
function shall be such that each of the allowed selections can be chosen with
equal probability;
\- if p1 is less than _txProbability_ :
\- select a random resource from the pool of resources (excluding any
resources which are overlapping with PRACH or resources belonging to the
subframes of resources already selected for transmissions on SL-DCH in this
discovery period), where the random function shall be such that each of the
allowed selections (see subclause 14.3.1 of [2]) can be chosen with equal
probability;
\- using the selected resource determine the set of subframes in which the
transmission of a MAC PDU can occur according to subclause 14.3.1 of [2]
\- consider the determined set of subframes to be a configured grant for the
corresponding discovery period;
\- for every subframe, if the MAC entity has a configured grant occurring in
that subframe, deliver the configured grant and the MAC PDU to the Sidelink
HARQ Entity;
\- clear the configured grant at the end of the corresponding discovery
period.
#### 5.15.1.2 Sidelink HARQ operation
##### 5.15.1.2.1 Sidelink HARQ Entity
There is one Sidelink HARQ Entity at the MAC entity for transmission on SL-
DCH, which maintains one Sidelink process for each MAC PDU.
For each subframe of the SL-DCH the Sidelink HARQ Entity shall:
\- if a grant and a MAC PDU has been delivered for this subframe to the
Sidelink HARQ Entity:
\- deliver the MAC PDU and the grant to the Sidelink process;
\- instruct the Sidelink process to trigger a new transmission.
\- else, if this subframe corresponds to retransmission opportunity for the
Sidelink process:
\- instruct the Sidelink process to trigger a retransmission.
##### 5.15.1.2.2 Sidelink process
The Sidelink process is associated with a HARQ buffer.
The Sidelink process shall maintain a state variable CURRENT_TX_NB, which
indicates the number of transmissions that have taken place for the MAC PDU
currently in the buffer. When the Sidelink process is established,
CURRENT_TX_NB shall be initialized to 0.
The sequence of redundancy versions is 0, 2, 3, 1. The variable CURRENT_IRV is
an index into the sequence of redundancy versions. This variable is up-dated
modulo 4.
The Sidelink process is configured with a maximum number of HARQ
retransmissions by RRC: _numRetx_.
If the Sidelink HARQ Entity requests a new transmission, the Sidelink process
shall:
\- set CURRENT_TX_NB to 0;
\- set CURRENT_IRV to 0;
\- store the MAC PDU in the associated HARQ buffer;
\- store the grant received from the Sidelink HARQ Entity;
\- generate a transmission as described below.
If the Sidelink HARQ Entity requests a retransmission, the Sidelink process
shall:
\- increment CURRENT_TX_NB by 1;
\- generate a transmission as described below.
To generate a transmission, the Sidelink process shall:
\- if there is no uplink transmission, no transmission or reception on PSCCH,
and no transmission or reception on PSSCH at the time of the transmission; or
\- if there is a Sidelink Discovery Gap for Transmission at the time of
transmission and if there is a MAC PDU to be transmitted in this TTI in
uplink, which is not obtained from the Msg3 buffer:
\- instruct the physical layer to generate a transmission according to the
grant with the redundancy version corresponding to the CURRENT_IRV value.
\- increment CURRENT_IRV by 1.
After performing above actions, the Sidelink process then shall:
\- if CURRENT_TX_NB = _numRetx_ :
\- flush the HARQ buffer.
### 5.15.2 SL-DCH data reception
#### 5.15.2.1 Sidelink HARQ operation
##### 5.15.2.1.1 Sidelink HARQ Entity
There is one Sidelink HARQ Entity at the MAC entity for reception on the SL-
DCH which maintains a number of parallel Sidelink processes. The Sidelink HARQ
Entity directs HARQ information and associated TBs received on the SL-DCH to
the corresponding Sidelink processes.
The number of receiving Sidelink processes per Sidelink HARQ Entity is
specified in [8].
For each subframe of the SL-DCH, the Sidelink HARQ Entity shall:
\- receive the TB and the associated HARQ information from the physical layer;
\- if this subframe corresponds to a new transmission opportunity:
\- allocate the received TB (if any) and the associated HARQ information to a
non-running Sidelink process and consider this transmission to be a new
transmission.
\- else, if this subframe corresponds to a retransmission opportunity:
\- allocate the received TB (if any) and the associated HARQ information to
its Sidelink process and consider this transmission to be a retransmission.
##### 5.15.2.1.2 Sidelink process
For each subframe where a transmission takes place for the Sidelink process,
one TB and the associated HARQ information is received from the Sidelink HARQ
Entity.
The sequence of redundancy versions is 0, 2, 3, 1. The variable CURRENT_IRV is
an index into the sequence of redundancy versions. This variable is updated
modulo 4.
The Sidelink process shall:
\- if this subframe corresponds to a new transmission opportunity:
\- set CURRENT_IRV to 0;
\- else, if this subframe corresponds to a retransmission opportunity:
\- increment CURRENT_IRV by 1.
\- if a TB was allocated to the Sidelink process:
\- if this is a new transmission:
\- optionally store the received data in the soft buffer and attempt to decode
the received data according to the CURRENT_IRV.
\- else if this is a retransmission:
\- if the data for this TB has not yet been successfully decoded:
\- optionally combine the received data with the data currently in the soft
buffer for this TB and attempt to decode the combined data according to the
CURRENT_IRV.
\- if the data which the MAC entity attempted to decode was successfully
decoded for this TB:
\- if this is the first successful decoding of the data for this TB:
\- deliver the decoded MAC PDU to upper layers.
## 5.16 SL-BCH data transfer
### 5.16.1 SL-BCH data transmission
When instructed to send SL-BCH, the MAC entity shall:
\- obtain the MAC PDU to transmit from SBCCH;
\- deliver the MAC PDU to the physical layer and instruct it to generate a
transmission.
### 5.16.2 SL-BCH data reception
When the MAC entity needs to receive SL-BCH, the MAC entity shall:
\- receive and attempt to decode the SL-BCH;
\- if a TB on the SL-BCH has been successfully decoded:
\- deliver the decoded MAC PDU to upper layers.
# 6 Protocol Data Units, formats and parameters
## 6.1 Protocol Data Units
### 6.1.1 General
A MAC PDU is a bit string that is byte aligned (i.e. multiple of 8 bits) in
length. In the figures in subclause 6.1, bit strings are represented by tables
in which the most significant bit is the leftmost bit of the first line of the
table, the least significant bit is the rightmost bit on the last line of the
table, and more generally the bit string is to be read from left to right and
then in the reading order of the lines. The bit order of each parameter field
within a MAC PDU is represented with the first and most significant bit in the
leftmost bit and the last and least significant bit in the rightmost bit.
MAC SDUs are bit strings that are byte aligned (i.e. multiple of 8 bits) in
length. An SDU is included into a MAC PDU from the first bit onward.
The MAC entity shall ignore the value of Reserved bits in downlink MAC PDUs.
### 6.1.2 MAC PDU (DL-SCH and UL-SCH except transparent MAC and Random Access
Response, MCH)
A MAC PDU consists of a MAC header, zero or more MAC Service Data Units (MAC
SDU), zero, or more MAC control elements, and optionally padding; as described
in Figure 6.1.2-3.
Both the MAC header and the MAC SDUs are of variable sizes.
A MAC PDU header consists of one or more MAC PDU subheaders; each subheader
corresponds to either a MAC SDU, a MAC control element or padding.
A MAC PDU subheader consists of the five or six header fields
R/F2/E/LCID/(F)/L but for the last subheader in the MAC PDU and for fixed
sized MAC control elements. The last subheader in the MAC PDU and subheaders
for fixed sized MAC control elements consist solely of the four header fields
R/F2/E/LCID. A MAC PDU subheader corresponding to padding consists of the four
header fields R/F2/E/LCID.
Figure 6.1.2-1: R/F2/E/LCID/F/L MAC subheader
Figure 6.1.2-1a: R/F2/E/LCID/L MAC subheader
Figure 6.1.2-2: R/F2/E/LCID MAC subheader
MAC PDU subheaders have the same order as the corresponding MAC SDUs, MAC
control elements and padding.
MAC control elements are always placed before any MAC SDU.
Padding occurs at the end of the MAC PDU, except when single-byte or two-byte
padding is required. Padding may have any value and the MAC entity shall
ignore it. When padding is performed at the end of the MAC PDU, zero or more
padding bytes are allowed.
When single-byte or two-byte padding is required, one or two MAC PDU
subheaders corresponding to padding are placed at the beginning of the MAC PDU
before any other MAC PDU subheader.
A maximum of one MAC PDU can be transmitted per TB per MAC entity. A maximum
of one MCH MAC PDU can be transmitted per TTI.
Figure 6.1.2-3: Example of MAC PDU consisting of MAC header, MAC control
elements, MAC SDUs and padding
### 6.1.3 MAC Control Elements
#### 6.1.3.1 Buffer Status Report MAC Control Elements
Buffer Status Report (BSR) MAC control elements consist of either:
\- Short BSR and Truncated BSR format: one LCG ID field and one corresponding
Buffer Size field (figure 6.1.3.1-1); or
\- Long BSR format: four Buffer Size fields, corresponding to LCG IDs #0
through #3 (figure 6.1.3.1-2).
The BSR formats are identified by MAC PDU subheaders with LCIDs as specified
in table 6.2.1-2.
The fields LCG ID and Buffer Size are defined as follow:
\- LCG ID: The Logical Channel Group ID field identifies the group of logical
channel(s) which buffer status is being reported. The length of the field is 2
bits. For NB-IoT, the LCG ID is set to #0.
\- Buffer Size: The Buffer Size field identifies the total amount of data
available across all logical channels of a logical channel group after all MAC
PDUs for the TTI have been built. The amount of data is indicated in number of
bytes. It shall include all data that is available for transmission in the RLC
layer and in the PDCP layer; the definition of what data shall be considered
as available for transmission is specified in [3] and [4] respectively. The
size of the RLC and MAC headers are not considered in the buffer size
computation. The length of this field is 6 bits. If _extendedBSR-Sizes_ is not
configured, the values taken by the Buffer Size field are shown in Table
6.1.3.1-1. If _extendedBSR-Sizes_ is configured, the values taken by the
Buffer Size field are shown in Table 6.1.3.1-2.
Figure 6.1.3.1-1: Short BSR and Truncated BSR MAC control element
Figure 6.1.3.1-2: Long BSR MAC control element
Table 6.1.3.1-1: Buffer size levels for BSR
* * *
**Index** **Buffer Size (BS) value [bytes]** **Index** **Buffer Size (BS)
value [bytes]** 0 BS = 0 32 1132 \ 150000
* * *
Table 6.1.3.1-2: Extended Buffer size levels for BSR
* * *
**Index** **Buffer Size (BS) value [bytes]** **Index** **Buffer Size (BS)
value [bytes]** 0 BS = 0 32 4940 \ 3000000
* * *
#### 6.1.3.1a Sidelink BSR MAC Control Elements
Sidelink BSR and Truncated Sidelink BSR MAC control elements consist of one
Destination Index field, one LCG ID field and one corresponding Buffer Size
field per reported target group.
The Sidelink BSR MAC control elements are identified by MAC PDU subheaders
with LCIDs as specified in table 6.2.1-2. They have variable sizes.
For each included group, the fields are defined as follows (figures 6.1.3.1a-1
and 6.1.3.1a-2):
\- Destination Index: The Destination Index field identifies the ProSe
Destination. The length of this field is 4 bits. The value is set to the index
of the destination reported in _destinationInfoList_ and if multiple such
lists are reported, the value is indexed sequentially across all the lists in
the same order as specified in [8];
\- LCG ID: The Logical Channel Group ID field identifies the group of logical
channel(s) which buffer status is being reported. The length of the field is 2
bits;
\- Buffer Size: The Buffer Size field identifies the total amount of data
available across all logical channels of a LCG of a ProSe Destination after
all MAC PDUs for the TTI have been built. The amount of data is indicated in
number of bytes. It shall include all data that is available for transmission
in the RLC layer and in the PDCP layer; the definition of what data shall be
considered as available for transmission is specified in [3] and [4]
respectively. The size of the RLC and MAC headers are not considered in the
buffer size computation. The length of this field is 6 bits. The values taken
by the Buffer Size field are shown in Table 6.1.3.1-1;
\- R: Reserved bit, set to \"0\".
Buffer Sizes of LCGs are included in decreasing order of the highest priority
of the sidelink logical channel belonging to the LCG irrespective of the value
of the Destination Index field.
Figure 6.1.3.1a-1: Sidelink BSR and Truncated Sidelink BSR MAC control element
for even N
Figure 6.1.3.1a-2: Sidelink BSR and Truncated Sidelink BSR MAC control element
for odd N
#### 6.1.3.2 C-RNTI MAC Control Element
The C-RNTI MAC control element is identified by MAC PDU subheader with LCID as
specified in table 6.2.1-2.
It has a fixed size and consists of a single field defined as follows (figure
6.1.3.2-1):
\- C-RNTI: This field contains the C-RNTI of the MAC entity. The length of the
field is 16 bits.
Figure 6.1.3.2-1: C-RNTI MAC control element
#### 6.1.3.3 DRX Command MAC Control Element
The DRX Command MAC control element is identified by a MAC PDU subheader with
LCID as specified in table 6.2.1-1.
It has a fixed size of zero bits.
#### 6.1.3.4 UE Contention Resolution Identity MAC Control Element
The UE Contention Resolution Identity MAC control element is identified by MAC
PDU subheader with LCID as specified in table 6.2.1-1. This control element
has a fixed 48-bit size and consists of a single field defined as follows
(figure 6.1.3.4-1)
\- UE Contention Resolution Identity: This field contains the uplink CCCH SDU
if the uplink CCCH SDU is 48 bits long. If the CCCH SDU is longer than 48
bits, this field contains the first 48 bits of the uplink CCCH SDU.
Figure 6.1.3.4-1: UE Contention Resolution Identity MAC control element
#### 6.1.3.5 Timing Advance Command MAC Control Element
The Timing Advance Command MAC control element is identified by MAC PDU
subheader with LCID as specified in table 6.2.1-1.
It has a fixed size and consists of a single octet defined as follows (figure
6.1.3.5-1):
\- TAG Identity (TAG Id): This field indicates the TAG Identity of the
addressed TAG. The TAG containing the SpCell has the TAG Identity 0. The
length of the field is 2 bits;
\- Timing Advance Command: This field indicates the index value _T~A~_ (0, 1,
2... 63) used to control the amount of timing adjustment that MAC entity has
to apply (see subclause 4.2.3 of [2]). The length of the field is 6 bits.
Figure 6.1.3.5-1: Timing Advance Command MAC control element
#### 6.1.3.6 Power Headroom Report MAC Control Element
The Power Headroom Report (PHR) MAC control element is identified by a MAC PDU
subheader with LCID as specified in table 6.2.1-2. It has a fixed size and
consists of a single octet defined as follows (figure 6.1.3.6-1):
\- R: reserved bit, set to \"0\";
\- Power Headroom (PH): this field indicates the power headroom level. The
length of the field is 6 bits. The reported PH and the corresponding power
headroom levels are shown in Table 6.1.3.6-1 below (the corresponding measured
values in dB can be found in subclause 9.1.8.4 of [9]).
Figure 6.1.3.6-1: PHR MAC control element
Table 6.1.3.6-1: Power Headroom levels for PHR
* * *
PH Power Headroom Level 0 POWER_HEADROOM_0 1 POWER_HEADROOM_1 2
POWER_HEADROOM_2 3 POWER_HEADROOM_3 ... ... 60 POWER_HEADROOM_60 61
POWER_HEADROOM_61 62 POWER_HEADROOM_62 63 POWER_HEADROOM_63
* * *
#### 6.1.3.6a Extended Power Headroom Report MAC Control Elements
For _extendedPHR_ , the Extended Power Headroom Report (PHR) MAC control
element is identified by a MAC PDU subheader with LCID as specified in table
6.2.1-2. It has a variable size and is defined in Figure 6.1.3.6a-2. When Type
2 PH is reported, the octet containing the Type 2 PH field is included first
after the octet indicating the presence of PH per SCell and followed by an
octet containing the associated P~CMAX,c~ field (if reported). Then follows in
ascending order based on the _ServCellIndex_ [8] an octet with the Type 1 PH
field and an octet with the associated P~CMAX,c~ field (if reported), for the
PCell and for each SCell indicated in the bitmap.
For _extendedPHR2_ , the Extended Power Headroom Report (PHR) MAC control
elements are identified by a MAC PDU subheader with LCID as specified in table
6.2.1-2. They have variable sizes and are defined in Figure 6.1.3.6a-3, Figure
6.1.3.6a-4 and Figure 6.1.3.6a-5. One octet with C fields is used for
indicating the presence of PH per SCell when the highest _SCellIndex_ of SCell
with configured uplink is less than 8, otherwise four octets are used. When
Type 2 PH is reported for the PCell, the octet containing the Type 2 PH field
is included first after the octet(s) indicating the presence of PH per SCell
and followed by an octet containing the associated P~CMAX,c~ field (if
reported). Then follows the Type 2 PH field for the PUCCH SCell (if PUCCH on
SCell is configured and Type 2 PH is reported for the PUCCH SCell), followed
by an octet containing the associated P~CMAX,c~ field (if reported). Then
follows in ascending order based on the _ServCellIndex_ [8] an octet with the
Type 1 PH field and an octet with the associated P~CMAX,c~ field (if
reported), for the PCell and for each SCell indicated in the bitmap.
The Extended PHR MAC Control Elements are defined as follows:
\- C~i~: this field indicates the presence of a PH field for the SCell with
_SCellIndex_ i as specified in [8]. The C~i~ field set to \"1\" indicates that
a PH field for the SCell with _SCellIndex_ i is reported. The C~i~ field set
to \"0\" indicates that a PH field for the SCell with _SCellIndex_ i is not
reported;
\- R: reserved bit, set to \"0\";
\- V: this field indicates if the PH value is based on a real transmission or
a reference format. For Type 1 PH, V=0 indicates real transmission on PUSCH
and V=1 indicates that a PUSCH reference format is used. For Type 2 PH, V=0
indicates real transmission on PUCCH and V=1 indicates that a PUCCH reference
format is used. Furthermore, for both Type 1 and Type 2 PH, V=0 indicates the
presence of the octet containing the associated P~CMAX,c~ field, and V=1
indicates that the octet containing the associated P~CMAX,c~ field is omitted;
\- Power Headroom (PH): this field indicates the power headroom level. The
length of the field is 6 bits. The reported PH and the corresponding power
headroom levels are shown in Table 6.1.3.6-1 (the corresponding measured
values in dB can be found in subclause 9.1.8.4 of [9]);
\- P: this field indicates whether the MAC entity applies power backoff due to
power management (as allowed by P-MPR~c~ [10]). The MAC entity shall set P=1
if the corresponding P~CMAX,c~ field would have had a different value if no
power backoff due to power management had been applied;
\- P~CMAX,c~: if present, this field indicates the P~CMAX,c~ or
${\overset{\sim}{P}}_{\text{CMAX},c}$[2] used for calculation of the preceding
PH field. The reported P~CMAX,c~ and the corresponding nominal UE transmit
power levels are shown in Table 6.1.3.6a-1 (the corresponding measured values
in dBm can be found in subclause 9.6.1 of [9]).
Figure 6.1.3.6a-1: Void
Figure 6.1.3.6a-2: Extended PHR MAC Control Element
Figure 6.1.3.6a1-3: Extended PHR MAC Control Element supporting PUCCH on SCell
Figure 6.1.3.6a2-4: Extended PHR MAC Control Element supporting 32 serving
cells with configured uplink
Figure 6.1.3.6a3-5: Extended PHR MAC Control Element supporting 32 serving
cells with configured uplink and PUCCH on SCell
Table 6.1.3.6a-1: Nominal UE transmit power level for Extended PHR and for
Dual Connectivity PHR
+-----------+---------------------------------+ | P~CMAX,c~ | Nominal UE transmit power level | +-----------+---------------------------------+ | 0 | > PCMAX_C_00 | +-----------+---------------------------------+ | 1 | > PCMAX_C_01 | +-----------+---------------------------------+ | 2 | > PCMAX_C_02 | +-----------+---------------------------------+ | ... | ... | +-----------+---------------------------------+ | 61 | > PCMAX_C_61 | +-----------+---------------------------------+ | 62 | > PCMAX_C_62 | +-----------+---------------------------------+ | 63 | > PCMAX_C_63 | +-----------+---------------------------------+
#### 6.1.3.6b Dual Connectivity Power Headroom Report MAC Control Element
The Dual Connectivity Power Headroom Report (PHR) MAC control element is
identified by a MAC PDU subheader with LCID as specified in table 6.2.1-2. It
has a variable size and is defined in Figure 6.1.3.6b-1 and Figure 6.1.3.6b-2.
One octet with C~i~ fields is used for indicating the presence of PH per SCell
when the highest _SCellIndex_ of SCell with configured uplink is less than 8,
otherwise four octets are used. When Type 2 PH is reported for the PCell, the
octet containing the Type 2 PH field is included first after the octet(s)
indicating the presence of PH per cell (PSCell and all SCells of all MAC
entities) and followed by an octet containing the associated P~CMAX,c~ field
(if reported). Then after that, when Type 2 PH is reported for the PSCell, the
octet containing the Type 2 PH field is included followed by an octet
containing the associated P~CMAX,c~ field (if reported). Then follows in
ascending order based on the _ServCellIndex_ [8] an octet with the Type 1 PH
field and an octet with the associated P~CMAX,c~ field (if reported), for the
PCell and for all other serving cells of all MAC entities indicated in the
bitmap.
The Dual Connectivity PHR MAC Control Element is defined as follows:
\- C~i~: this field indicates the presence of a PH field for the serving cell
of any MAC entity, except the PCell, with _SCellIndex_ i as specified in [8].
The C~i~ field set to \"1\" indicates that a PH field for the serving cell
with _SCellIndex_ i is reported. The C~i~ field set to \"0\" indicates that a
PH field for the serving cell with _SCellIndex_ i is not reported;
\- R: reserved bit, set to \"0\";
\- V: this field indicates if the PH value is based on a real transmission or
a reference format. For Type 1 PH, V=0 indicates real transmission on PUSCH
and V=1 indicates that a PUSCH reference format is used. For Type 2 PH, V=0
indicates real transmission on PUCCH and V=1 indicates that a PUCCH reference
format is used. Furthermore, for both Type 1 and Type 2 PH, V=0 indicates the
presence of the octet containing the associated P~CMAX,c~ field, and V=1
indicates that the octet containing the associated P~CMAX,c~ field is omitted;
\- Power Headroom (PH): this field indicates the power headroom level. The
length of the field is 6 bits. The reported PH and the corresponding power
headroom levels are shown in Table 6.1.3.6-1 (the corresponding measured
values in dB can be found in subclause 9.1.8.4 of [9]);
\- P: this field indicates whether power backoff due to power management is
applied (as allowed by P-MPR~c~ [10]). The MAC entity shall set P=1 if the
corresponding P~CMAX,c~ field would have had a different value if no power
backoff due to power management had been applied;
\- P~CMAX,c~: if present, this field indicates the P~CMAX,c~ or
${\overset{\sim}{P}}_{\text{CMAX},c}$[2] used for calculation of the preceding
PH field. The reported P~CMAX,c~ and the corresponding nominal UE transmit
power levels are shown in Table 6.1.3.6a-1 (the corresponding measured values
in dBm can be found in subclause 9.6.1 of [9]).
Figure 6.1.3.6b-1: Dual Connectivity PHR MAC Control Element
Figure 6.1.3.6b-2: Dual Connectivity PHR MAC Control Element supporting 32
serving cells with configured uplink
#### 6.1.3.7 MCH Scheduling Information MAC Control Element
The MCH Scheduling Information MAC Control Element illustrated in Figure
6.1.3.7-1 is identified by a MAC PDU subheader with LCID as specified in Table
6.2.1-4. This control element has a variable size. For each MTCH the fields
below are included:
\- LCID: this field indicates the Logical Channel ID of the MTCH. The length
of the field is 5 bits;
\- Stop MTCH: this field indicates the ordinal number of the subframe within
the MCH scheduling period, counting only the subframes allocated to the MCH,
where the corresponding MTCH stops. Value 0 corresponds to the first subframe.
The length of the field is 11 bits. The special Stop MTCH value 2047 indicates
that the corresponding MTCH is not scheduled. The value range 2043 to 2046 is
reserved.
Figure 6.1.3.7-1: MCH Scheduling Information MAC control element
#### 6.1.3.7a Extended MCH Scheduling Information MAC Control Element
The Extended MCH Scheduling Information MAC control element illustrated in
Figure 6.1.3.7-2 is identified by a MAC PDU subheader with LCID as specified
in Table 6.2.1-4. This control element has a variable size.
For each MTCH the fields below are included:
\- LCID: this field indicates the Logical Channel ID of the MTCH. The length
of the field is 5 bits;
\- Stop MTCH: this field indicates the ordinal number of the subframe within
the MCH scheduling period, counting only the subframes allocated to the MCH,
where the corresponding MTCH stops. Value 0 corresponds to the first subframe.
The length of the field is 11 bits. The special Stop MTCH value 2047 indicates
that the corresponding MTCH is not scheduled. The value range 2043 to 2046 is
reserved.
For each MTCH the fields below may be included:
\- LCID: this field indicates the Logical Channel ID of the MTCH. The length
of the field is 5 bits. LCIDs x...x+y shall be equal to or a subset of the
LCIDs 1...n;
\- S: this field indicates that the transmission of the corresponding MTCH is
to be suspended. The S field is set to 000. All other values are reserved.
Figure 6.1.3.7a-1: Extended MCH Scheduling Information MAC control element
#### 6.1.3.8 Activation/Deactivation MAC Control Elements
The Activation/Deactivation MAC control element of one octet is identified by
a MAC PDU subheader with LCID as specified in table 6.2.1-1. It has a fixed
size and consists of a single octet containing seven C-fields and one R-field.
The Activation/Deactivation MAC control element with one octet is defined as
follows (figure 6.1.3.8-1).
The Activation/Deactivation MAC control element of four octets is identified
by a MAC PDU subheader with LCID as specified in table 6.2.1-1. It has a fixed
size and consists of a four octets containing 31 C-fields and one R-field. The
Activation/Deactivation MAC control element of four octets is defined as
follows (figure 6.1.3.8-2).
For the case with no serving cell with a _ServCellIndex_ [8] larger than 7,
Activation/Deactivation MAC control element of one octet is applied, otherwise
Activation/Deactivation MAC control element of four octets is applied.
\- C~i~: if there is an SCell configured with _SCellIndex_ i as specified in
[8], this field indicates the activation/deactivation status of the SCell with
_SCellIndex_ i, else the MAC entity shall ignore the C~i~ field. The C~i~
field is set to \"1\" to indicate that the SCell with _SCellIndex_ i shall be
activated. The C~i~ field is set to \"0\" to indicate that the SCell with
_SCellIndex_ i shall be deactivated;
\- R: Reserved bit, set to \"0\".
Figure 6.1.3.8-1: Activation/Deactivation MAC control element of one octet
Figure 6.1.3.8-2: Activation/Deactivation MAC control element of four octets
#### 6.1.3.9 Long DRX Command MAC Control Element
The Long DRX Command MAC control element is identified by a MAC PDU subheader
with LCID as specified in table 6.2.1-1.
It has a fixed size of zero bits.
#### 6.1.3.10 Data Volume and Power Headroom Report MAC Control Element
The Data Volume and Power Headroom Report (DPR) MAC control element is
identified by the MAC PDU subheader used for the CCCH MAC SDU, as specified in
table 6.2.1-2. It does not add any additional subheader and is always placed
before the CCCH MAC SDU.
It has a fixed size and consists of a single octet defined as follows (figure
6.1.3.10-1):
\- Data Volume (DV): The Data Volume field identifies the total amount of data
available across all logical channels and of data not yet associated with a
logical channel after all MAC PDUs for the TTI have been built. The amount of
data is indicated in number of bytes. It shall include all data that is
available for transmission in the RLC layer, in the PDCP layer, and in the RRC
layer; the definition of what data shall be considered as available for
transmission is specified in [3], [4] and [8] respectively. The size of the
RLC and MAC headers are not considered in the buffer size computation. The
length of this field is 4 bits. The values taken by the Data Volume field are
shown in Table 6.1.3.10-1;
\- Power Headroom (PH): This field indicates the power headroom level. The
length of the field is 2 bits. The reported PH and the corresponding power
headroom levels are shown in Table 6.1.3.10-2 below (the corresponding
measured values in dB can be found in [9]);
\- R: reserved bit, set to \"0\".
Figure 6.1.3.10-1: Data Volume and Power Headroom Report MAC control element
Table 6.1.3.10-1: Data Volume levels for DV
* * *
**Index** **Data Volume (DV) value [bytes]** **Index** **Data Volume (DV)
value [bytes]** 0 DV = 0 8 67 \ 1500
* * *
Table 6.1.3.10-2: Power Headroom levels for PH
* * *
PH Power Headroom Level 0 POWER_HEADROOM_0 1 POWER_HEADROOM_1 2
POWER_HEADROOM_2 3 POWER_HEADROOM_3
* * *
### 6.1.4 MAC PDU (transparent MAC)
A MAC PDU consists solely of a MAC Service Data Unit (MAC SDU) whose size is
aligned to a TB; as described in figure 6.1.4-1. This MAC PDU is used for
transmissions on PCH, BCH, DL-SCH including BCCH, BR-BCCH, SL-DCH and SL-BCH.
Figure 6.1.4-1: Example of MAC PDU (transparent MAC)
### 6.1.5 MAC PDU (Random Access Response)
A MAC PDU consists of a MAC header and zero or more MAC Random Access
Responses (MAC RAR) and optionally padding as described in figure 6.1.5-4.
The MAC header is of variable size.
A MAC PDU header consists of one or more MAC PDU subheaders; each subheader
corresponding to a MAC RAR except for the Backoff Indicator subheader. If
included, the Backoff Indicator subheader is only included once and is the
first subheader included within the MAC PDU header.
A MAC PDU subheader consists of the three header fields E/T/RAPID (as
described in figure 6.1.5-1) but for the Backoff Indicator subheader which
consists of the five header field E/T/R/R/BI (as described in figure 6.1.5-2).
A MAC RAR consists of the four fields R/Timing Advance Command/UL
Grant/Temporary C-RNTI (as described in figures 6.1.5-3, 6.1.5-3a and
6.1.5-3b). For BL UEs and UEs in enhanced coverage in enhanced coverage level
2 or 3 (see subclause 6.2 in [2]) the MAC RAR in figure 6.1.5-3a is used, for
NB-IoT UEs (see subclause 16.3.3 in [2]) the MAC RAR in figure 6.1.5-3b is
used, otherwise the MAC RAR in figure 6.1.5-3 is used.
Padding may occur after the last MAC RAR. Presence and length of padding is
implicit based on TB size, size of MAC header and number of RARs.
Figure 6.1.5-1: E/T/RAPID MAC subheader
Figure 6.1.5-2: E/T/R/R/BI MAC subheader
Figure 6.1.5-3: MAC RAR
Figure 6.1.5-3a: MAC RAR for PRACH enhanced coverage level 2 or 3
Figure 6.1.5-3b: MAC RAR for NB-IoT UEs
Figure 6.1.5-4: Example of MAC PDU consisting of a MAC header and MAC RARs
### 6.1.6 MAC PDU (SL-SCH)
A MAC PDU consists of a MAC header, one or more MAC Service Data Units (MAC
SDU), and optionally padding; as described in Figure 6.1.6-4.
Both the MAC header and the MAC SDUs are of variable sizes.
A MAC PDU header consists of one SL-SCH subheader, one or more MAC PDU
subheaders; each subheader except SL-SCH subheader corresponds to either a MAC
SDU or padding.
The SL-SCH subheader consists of the seven header fields V/R/R/R/R/SRC/DST.
A MAC PDU subheader consists of the six header fields R/R/E/LCID/F/L but for
the last subheader in the MAC PDU. The last subheader in the MAC PDU consists
solely of the four header fields R/R/E/LCID. A MAC PDU subheader corresponding
to padding consists of the four header fields R/R/E/LCID.
Figure 6.1.6-1: R/R/E/LCID/F/L MAC subheader
Figure 6.1.6-2: R/R/E/LCID MAC subheader
Figure 6.1.6-3: SL-SCH MAC subheader
MAC PDU subheaders have the same order as the corresponding MAC SDUs and
padding.
Padding occurs at the end of the MAC PDU, except when single-byte or two-byte
padding is required. Padding may have any value and the MAC entity shall
ignore it. When padding is performed at the end of the MAC PDU, zero or more
padding bytes are allowed.
When single-byte or two-byte padding is required, one or two MAC PDU
subheaders corresponding to padding are placed after the SL-SCH subheader and
before any other MAC PDU subheader.
A maximum of one MAC PDU can be transmitted per TB.
Figure 6.1.6-4: Example of MAC PDU consisting of MAC header, MAC SDUs and
padding
## 6.2 Formats and parameters
### 6.2.1 MAC header for DL-SCH, UL-SCH and MCH
The MAC header is of variable size and consists of the following fields:
\- LCID: The Logical Channel ID field identifies the logical channel instance
of the corresponding MAC SDU or the type of the corresponding MAC control
element or padding as described in tables 6.2.1-1, 6.2.1-2 and 6.2.1-4 for the
DL-SCH, UL-SCH and MCH respectively. There is one LCID field for each MAC SDU,
MAC control element or padding included in the MAC PDU. In addition to that,
one or two additional LCID fields are included in the MAC PDU, when single-
byte or two-byte padding is required but cannot be achieved by padding at the
end of the MAC PDU. A UE of Category 0 [12] except when in enhanced coverage,
and _unicastFreqHoppingInd-r13_ is indicated in the BR version of SI message
carrying _SystemInformationBlockType2_ , and UE supports frequency hopping for
unicast [12] shall indicate CCCH using LCID \"01011\", a BL UE with support
for frequency hopping for unicast [12] and a UE in enhanced coverage with
support for frequency hopping for unicast [12] shall if
_unicastFreqHoppingInd-r13_ is indicated in the BR version of SI message
carrying _SystemInformationBlockType2_ indicate CCCH using LCID \"01100\",
otherwise the UE shall indicate CCCH using LCID \"00000\". The LCID field size
is 5 bits;
\- L: The Length field indicates the length of the corresponding MAC SDU or
variable-sized MAC control element in bytes. There is one L field per MAC PDU
subheader except for the last subheader and subheaders corresponding to fixed-
sized MAC control elements. The size of the L field is indicated by the F
field and F2 field;
\- F: The Format field indicates the size of the Length field as indicated in
table 6.2.1-3. There is one F field per MAC PDU subheader except for the last
subheader and subheaders corresponding to fixed-sized MAC control elements and
except for when F2 is set to 1. The size of the F field is 1 bit. If the F
field is included; if the size of the MAC SDU or variable-sized MAC control
element is less than 128 bytes, the value of the F field is set to 0,
otherwise it is set to 1;
\- F2: The Format2 field indicates the size of the Length field as indicated
in table 6.2.1-3. There is one F2 field per MAC PDU subheader. The size of the
F2 field is 1 bit. If the size of the MAC SDU or variable-sized MAC control
element is larger than 32767 bytes, and if the corresponding subheader is not
the last subheader, the value of the F2 field is set to 1, otherwise it is set
to 0.
\- E: The Extension field is a flag indicating if more fields are present in
the MAC header or not. The E field is set to \"1\" to indicate another set of
at least R/F2/E/LCID fields. The E field is set to \"0\" to indicate that
either a MAC SDU, a MAC control element or padding starts at the next byte;
\- R: Reserved bit, set to \"0\".
The MAC header and subheaders are octet aligned.
Table 6.2.1-1 Values of LCID for DL-SCH
* * *
Index LCID values 00000 CCCH 00001-01010 Identity of the logical channel
01011-10111 Reserved 11000 Activation/Deactivation (4 octets) 11001 SC-MCCH,
SC-MTCH (see note) 11010 Long DRX Command 11011 Activation/Deactivation (1
octet) 11100 UE Contention Resolution Identity 11101 Timing Advance Command
11110 DRX Command 11111 Padding NOTE: Both SC-MCCH and SC-MTCH cannot be
multiplexed with other logical channels in the same MAC PDU except for Padding
* * *
For NB-IoT only the following LCID values for DL-SCH are applicable: CCCH,
Identity of the logical channel, UE Contention Resolution Identity, Timing
Advance Command, DRX Command and Padding.
Table 6.2.1-2 Values of LCID for UL-SCH
* * *
Index LCID values 00000 CCCH 00001-01010 Identity of the logical channel 01011
CCCH 01100 CCCH 01101-10101 Reserved 10110 Truncated Sidelink BSR 10111
Sidelink BSR 11000 Dual Connectivity Power Headroom Report 11001 Extended
Power Headroom Report 11010 Power Headroom Report 11011 C-RNTI 11100 Truncated
BSR 11101 Short BSR 11110 Long BSR 11111 Padding
* * *
For NB-IoT only the following LCID values for UL-SCH are applicable: CCCH
(LCID \"00000\"), Identity of the logical channel, C-RNTI, Short BSR and
Padding.
Table 6.2.1-3 Values of F and F2 fields:
* * *
Index of F2 Index of F Size of Length field (in bits) 0 0 7 1 15 1 - 16
* * *
Table 6.2.1-4 Values of LCID for MCH
* * *
Index LCID values 00000 MCCH (see note) 00001-11100 MTCH 11101 Reserved 11110
MCH Scheduling Information or Extended MCH Scheduling Information 11111
Padding NOTE: If there is no MCCH on MCH, an MTCH could use this value.
* * *
### 6.2.2 MAC header for Random Access Response
The MAC header is of variable size and consists of the following fields:
\- E: The Extension field is a flag indicating if more fields are present in
the MAC header or not. The E field is set to \"1\" to indicate at least
another set of E/T/RAPID fields follows. The E field is set to \"0\" to
indicate that a MAC RAR or padding starts at the next byte;
\- T: The Type field is a flag indicating whether the MAC subheader contains a
Random Access ID or a Backoff Indicator. The T field is set to \"0\" to
indicate the presence of a Backoff Indicator field in the subheader (BI). The
T field is set to \"1\" to indicate the presence of a Random Access Preamble
ID field in the subheader (RAPID);
\- R: Reserved bit, set to \"0\";
\- BI: The Backoff Indicator field identifies the overload condition in the
cell. The size of the BI field is 4 bits;
\- RAPID: The Random Access Preamble IDentifier field identifies the
transmitted Random Access Preamble (see subclause 5.1.3). The size of the
RAPID field is 6 bits.
The MAC header and subheaders are octet aligned.
NOTE: For NB-IoT, the Random Access Preamble IDentifier field corresponds to
the start subcarrier index.
### 6.2.3 MAC payload for Random Access Response
The MAC RAR is of fixed size and consists of the following fields:
\- R: Reserved bit, set to \"0\";
\- Timing Advance Command: The Timing Advance Command field indicates the
index value _T~A~_ (0, 1, 2... 1282) used to control the amount of timing
adjustment that the MAC entity has to apply (see subclause 4.2.3 of [2]). The
size of the Timing Advance Command field is 11 bits;
\- UL Grant: The Uplink Grant field indicates the resources to be used on the
uplink (see subclause 6.2 of [2], or for NB-IoT UEs, see subclause 16.3.3 of
[2]). The size of the UL Grant field is 20 bits, except for NB-IoT UEs, where
the size of UL grant field is 15 bits, and except for BL UEs and UEs in
enhanced coverage in enhanced coverage level 2 or 3, where the size of the UL
grant field is 12 bits.
\- Temporary C-RNTI: The Temporary C-RNTI field indicates the temporary
identity that is used by the MAC entity during Random Access. The size of the
Temporary C-RNTI field is 16 bits.
The MAC RAR is octet aligned.
### 6.2.4 MAC header for SL-SCH
The MAC header is of variable size and consists of the following fields:
\- V: The MAC PDU format version number field indicates which version of the
SL-SCH subheader is used. In this version of the specification two format
versions are defined, and this field shall therefore be set to \"0001\" or
\"0010\". The V field size is 4 bits;
\- SRC: The Source Layer-2 ID field carries the identity of the source. It is
set to the ProSe UE ID. The SRC field size is 24 bits;
\- DST: The DST field carries the 16 most significant bits of the Destination
Layer-2 ID. The Destination Layer-2 ID is set to the ProSe Layer-2 Group ID or
Prose UE ID. If the V field is set to \"0001\", this identifier is a groupcast
identifier. If the V field is set to \"0010\", this identifier is a unicast
identifier;
\- LCID: The Logical Channel ID field uniquely identifies the logical channel
instance within the scope of one Source Layer-2 ID and Destination Layer-2 ID
pair of the corresponding MAC SDU or padding as described in table 6.2.4-1.
There is one LCID field for each MAC SDU or padding included in the MAC PDU.
In addition to that, one or two additional LCID fields are included in the MAC
PDU, when single-byte or two-byte padding is required but cannot be achieved
by padding at the end of the MAC PDU. The LCID field size is 5 bits;
\- L: The Length field indicates the length of the corresponding MAC SDU in
bytes. There is one L field per MAC PDU subheader except for the last
subheader. The size of the L field is indicated by the F field;
\- F: The Format field indicates the size of the Length field as indicated in
table 6.2.4-2. There is one F field per MAC PDU subheader except for the last
subheader. The size of the F field is 1 bit. If the size of the MAC SDU is
less than 128 bytes, the value of the F field is set to 0, otherwise it is set
to 1;
\- E: The Extension field is a flag indicating if more fields are present in
the MAC header or not. The E field is set to \"1\" to indicate another set of
at least R/R/E/LCID fields. The E field is set to \"0\" to indicate that
either a MAC SDU or padding starts at the next byte;
\- R: Reserved bit, set to \"0\".
The MAC header and subheaders are octet aligned.
Table 6.2.4-1 Values of LCID for SL-SCH
* * *
Index LCID values 00000 Reserved 00001-01010 Identity of the logical channel
01011-11011 Reserved 11100 PC5-S messages that are not protected 11101 PC5-S
messages \"Direct Security Mode Command\" and \"Direct Security Mode
Complete\" 11110 Other PC5-S messages that are protected 11111 Padding
* * *
Table 6.2.4-2 Values of F field:
* * *
Index Size of Length field (in bits) 0 7 1 15
* * *
# 7 Variables and constants
## 7.1 RNTI values
RNTI values are presented in Table 7.1-1 and their usage and associated
Transport Channels and Logical Channels are presented in Table 7.1-2.
Table 7.1-1: RNTI values.
* * *
Value (hexa-decimal) RNTI 0000 N/A 0001-0960 RA-RNTI, C-RNTI, Semi-Persistent
Scheduling C-RNTI, Temporary C-RNTI, eIMTA-RNTI, TPC-PUCCH-RNTI, TPC-PUSCH-
RNTI and SL-RNTI (see note), G-RNTI 0961-FFF3 C-RNTI, Semi-Persistent
Scheduling C-RNTI, eIMTA-RNTI, Temporary C-RNTI, TPC-PUCCH-RNTI, TPC-PUSCH-
RNTI and SL-RNTI, G-RNTI FFF4-FFF9 Reserved for future use FFFA SC-N-RNTI FFFB
SC-RNTI FFFC CC-RNTI FFFD M-RNTI FFFE P-RNTI FFFF SI-RNTI
* * *
NOTE: A MAC entity uses the same C-RNTI on all Serving Cells.
Table 7.1-2: RNTI usage.
+----------------+----------------+----------------+----------------+ | RNTI | Usage | Transport | Logical | | | | Channel | Channel | +----------------+----------------+----------------+----------------+ | P-RNTI | Paging and | PCH | PCCH | | | System | | | | | Information | | | | | change | | | | | notification | | | +----------------+----------------+----------------+----------------+ | SI-RNTI | Broadcast of | DL-SCH | BCCH, BR-BCCH | | | System | | | | | Information | | | +----------------+----------------+----------------+----------------+ | M-RNTI | MCCH | N/A | N/A | | | Information | | | | | change | | | | | notification | | | +----------------+----------------+----------------+----------------+ | RA-RNTI | Random Access | DL-SCH | N/A | | | Response | | | +----------------+----------------+----------------+----------------+ | eIMTA-RNTI | eIMTA TDD | N/A | N/A | | | UL/DL | | | | | configuration | | | | | notification | | | +----------------+----------------+----------------+----------------+ | Temporary | Contention | DL-SCH | CCCH, DCCH | | C-RNTI | Resolution\ | | | | | (when no valid | | | | | C-RNTI is | | | | | available) | | | +----------------+----------------+----------------+----------------+ | Temporary | Msg3 | UL-SCH | CCCH, DCCH, | | C-RNTI | transmission | | DTCH | +----------------+----------------+----------------+----------------+ | C-RNTI | Dynamically | UL-SCH | DCCH, DTCH | | | scheduled | | | | | unicast | | | | | transmission | | | +----------------+----------------+----------------+----------------+ | C-RNTI | Dynamically | DL-SCH | CCCH, DCCH, | | | scheduled | | DTCH | | | unicast | | | | | transmission | | | +----------------+----------------+----------------+----------------+ | C-RNTI | Triggering of | N/A | N/A | | | PDCCH ordered | | | | | random access | | | +----------------+----------------+----------------+----------------+ | S | Sem | DL-SCH, UL-SCH | DCCH, DTCH | | emi-Persistent | i-Persistently | | | | Scheduling | scheduled | | | | C-RNTI | unicast | | | | | transmission | | | | | | | | | | (activation, | | | | | reactivation | | | | | and | | | | | r | | | | | etransmission) | | | +----------------+----------------+----------------+----------------+ | S | Sem | N/A | N/A | | emi-Persistent | i-Persistently | | | | Scheduling | scheduled | | | | C-RNTI | unicast | | | | | transmission | | | | | | | | | | (deactivation) | | | +----------------+----------------+----------------+----------------+ | TPC-PUCCH-RNTI | Physical layer | N/A | N/A | | | Uplink power | | | | | control | | | +----------------+----------------+----------------+----------------+ | TPC-PUSCH-RNTI | Physical layer | N/A | N/A | | | Uplink power | | | | | control | | | +----------------+----------------+----------------+----------------+ | SL-RNTI | Dynamically | SL-SCH | STCH | | | scheduled | | | | | sidelink | | | | | transmission | | | +----------------+----------------+----------------+----------------+ | SC-RNTI | Dynamically | DL-SCH | SC-MCCH | | | scheduled | | | | | SC-PTM control | | | | | information | | | +----------------+----------------+----------------+----------------+ | G-RNTI | Dynamically | DL-SCH | SC-MTCH | | | scheduled | | | | | SC-PTM | | | | | transmission | | | +----------------+----------------+----------------+----------------+ | SC-N-RNTI | SC-MCCH | N/A | N/A | | | Information | | | | | change | | | | | notification | | | +----------------+----------------+----------------+----------------+ | CC-RNTI | Providing | N/A | N/A | | | common control | | | | | PDCCH | | | | | information | | | +----------------+----------------+----------------+----------------+
## 7.2 Backoff Parameter values
Backoff Parameter values are presented in Table 7.2-1 except for NB-IoT where
Table 7.2-2 shall be used.
Table 7.2-1: Backoff Parameter values.
* * *
Index Backoff Parameter value (ms) 0 0 1 10 2 20 3 30 4 40 5 60 6 80 7 120 8
160 9 240 10 320 11 480 12 960 13 Reserved 14 Reserved 15 Reserved
* * *
The reserved values of the backoff parameter if received by the current
release version UEs shall be taken as 960 ms.
Table 7.2-2: Backoff Parameter values for NB-IoT.
* * *
Index Backoff Parameter value (ms) 0 0 1 256 2 512 3 1024 4 2048 5 4096 6 8192
7 16384 8 32768 9 65536 10 131072 11 262144 12 524288 13 Reserved 14 Reserved
15 Reserved
* * *
The reserved values of the backoff parameter if received by the current
release version NB-IoT UEs shall be taken as 524288 ms.
## 7.3 PRACH Mask Index values
Table 7.3-1: PRACH Mask Index values
+------------------+------------------------+------------------------+ | PRACH Mask Index | Allowed PRACH (FDD) | Allowed PRACH (TDD) | +------------------+------------------------+------------------------+ | 0 | All | All | +------------------+------------------------+------------------------+ | 1 | PRACH Resource Index 0 | PRACH Resource Index 0 | +------------------+------------------------+------------------------+ | 2 | PRACH Resource Index 1 | PRACH Resource Index 1 | +------------------+------------------------+------------------------+ | 3 | PRACH Resource Index 2 | PRACH Resource Index 2 | +------------------+------------------------+------------------------+ | 4 | PRACH Resource Index 3 | PRACH Resource Index 3 | +------------------+------------------------+------------------------+ | 5 | PRACH Resource Index 4 | PRACH Resource Index 4 | +------------------+------------------------+------------------------+ | 6 | PRACH Resource Index 5 | PRACH Resource Index 5 | +------------------+------------------------+------------------------+ | 7 | PRACH Resource Index 6 | Reserved | +------------------+------------------------+------------------------+ | 8 | PRACH Resource Index 7 | Reserved | +------------------+------------------------+------------------------+ | 9 | PRACH Resource Index 8 | Reserved | +------------------+------------------------+------------------------+ | 10 | PRACH Resource Index 9 | Reserved | +------------------+------------------------+------------------------+ | 11 | Every, in the time | Every, in the time | | | domain, even PRACH | domain, even PRACH | | | opportunity | opportunity | | | | | | | 1^st^ PRACH Resource | 1^st^ PRACH Resource | | | Index in subframe | Index in subframe | +------------------+------------------------+------------------------+ | 12 | Every, in the time | Every, in the time | | | domain, odd PRACH | domain, odd PRACH | | | opportunity | opportunity | | | | | | | 1^st^ PRACH Resource | 1^st^ PRACH Resource | | | Index in subframe | Index in subframe | +------------------+------------------------+------------------------+ | 13 | Reserved | 1^st^ PRACH Resource | | | | Index in subframe | +------------------+------------------------+------------------------+ | 14 | Reserved | 2^nd^ PRACH Resource | | | | Index in subframe | +------------------+------------------------+------------------------+ | 15 | Reserved | 3^rd^ PRACH Resource | | | | Index in subframe | +------------------+------------------------+------------------------+
## 7.4 Subframe_Offset values
Subframe_Offset values are presented in Table 7.4-1.
Table 7.4-1: Subframe_Offset values
* * *
TDD UL/DL configuration Position of initial Semi-Persistent grant
Subframe_Offset value (ms) 0 N/A 0 1 Subframes 2 and 7 1 Subframes 3 and 8 -1
2 Subframe 2 5 Subframe 7 -5 3 Subframes 2 and 3 1 Subframe 4 -2 4 Subframe 2
1 Subframe 3 -1 5 N/A 0 6 N/A 0
* * *
## 7.5 TTI_BUNDLE_SIZE value
The parameter TTI_BUNDLE_SIZE is 4.
## 7.6 DELTA_PREAMBLE values
The DELTA_PREAMBLE preamble format based power offset values are presented in
Table 7.6-1.
Table 7.6-1: DELTA_PREAMBLE values.
* * *
Preamble Format DELTA_PREAMBLE value 0 0 dB 1 0 dB 2 -3 dB 3 -3 dB 4 8 dB
* * *
Where the Preamble Format is given by _prach-ConfigIndex_ [7].
## 7.7 HARQ RTT Timers
For each serving cell, in case of FDD configuration on the serving cell which
carries the HARQ feedback for this serving cell the HARQ RTT Timer is set to 8
subframes. For each serving cell, in case of TDD configuration on the serving
cell which carries the HARQ feedback for this serving cell the HARQ RTT Timer
is set to k + 4 subframes, where k is the interval between the downlink
transmission and the transmission of associated HARQ feedback, as indicated in
subclauses 10.1 and 10.2 of [2], and for an RN configured with _rn-
SubframeConfig_ [8] and not suspended, as indicated in Table 7.5.1-1 of [11].
For BL UEs and UEs in enhanced coverage, HARQ RTT Timer corresponds to 7 \+ N
where N is the used PUCCH repetition factor, where only valid (configured) UL
subframes as configured by upper layers in _fdd-UplinkSubframeBitmapBR_ are
counted. _In case of TDD, HARQ RTT Timer corresponds to 3 + k + N, where k is
the interval between the last repetition of downlink transmission and the
first repetition of the transmission of associated HARQ feedback, and N is the
used PUCCH repetition factor, where only valid UL subframes are counted as
indicated in subclauses 10.1 and 10.2 of [2]._
For NB-IoT the HARQ RTT Timer is set to k+3+N+deltaPDCCH subframes, where k is
the interval between the last subframe of the downlink transmission and the
first subframe of the associated HARQ feedback transmission and N is the
transmission duration in subframes of the associated HARQ feedback, and
deltaPDCCH is the interval from the last subframe of the associated HARQ
feedback transmission plus 3 subframes to the first subframe of the next PDCCH
occasion.
Except for NB-IoT, UL HARQ RTT Timer length is set to 4 subframes _for FDD,
and set to k~ULHARQRTT~ subframes for TDD, where k~ULHARQRTT~ equals to the
k~PHICH~ value indicated in Table 9.1.2-1 of [2]_.
For NB-IoT, the UL HARQ RTT timer length is set to 4+deltaPDCCH subframes,
where deltaPDCCH is the interval from the last subframe of the PUSCH
transmission plus 4 subframes to the first subframe of the next PDCCH
occasion.
## 7.8 DL_REPETITION_NUMBER value
The parameter DL_REPETITION_NUMBER value is received from lower layers and
corresponds to the repetition level as specified in [2].
## 7.9 UL_REPETITION_NUMBER value
The parameter UL_REPETITION_NUMBER value is received from lower layers and
corresponds to the repetition level as specified in [2].
###### ## Annex A (normative): Handling of measurement gaps
In this specification, the subframes which cannot be used for transmission
according to subclause 8.1.2.1 of [9] are also considered as part of
measurement gaps in uplink. Measurement gaps are defined in [9].
In a subframe that is part of a measurement gap, the UE shall not perform the
transmission of HARQ feedback and CQI/PMI/RI/PTI/CRI, and SRS shall not be
reported.
###### ## Annex B (normative): Contention resolution for RACH access
When checking whether contention resolution was successful a MAC entity
considers the MAC header structures shown below for the processing of a MAC
PDU containing a UE Contention Resolution Identity MAC control element.
NOTE: For Case 2 to Case 6, LCID of \'00001\' is applicable only when UE
supports the CIoT EPS User Plane optimisation.
###### ## Annex C (informative): Intended UE behaviour for DRX Timers
When a DRX timer is set to a value of _X_ , and _n_ denotes the subframe in
which the related event is triggered according to the subclause 5.7, the
intended behaviours of each DRX timer are presented in the Table C-1 below:
Table C-1: Intended UE behaviour for DRX timers
+----------------------------------+----------------------------------+ | DRX Timers | Intended UE behaviour\ | | | ([x, y] means including | | | subframe x and y) | +----------------------------------+----------------------------------+ | drx-InactivityTimer | The MAC entity monitors PDCCH in | | | PDCCH-subframes during the | | | subframes [n+1, n+m]. | | | | | | The MAC entity starts or | | | restarts drxShortCycleTimer, and | | | uses Short DRX Cycle in the | | | subframe n+m+1, if configured. | +----------------------------------+----------------------------------+ | drx-InactivityTimerSCPTM | The MAC entity monitors PDCCH in | | | PDCCH-subframes during the | | | subframes [n+1, n+m]. | +----------------------------------+----------------------------------+ | mac-ContentionResolutionTimer or | The MAC entity monitors PDCCH in | | mac-ContentionResolutionTimer | PDCCH-subframes during the | | for the corresponding enhanced | subframes [n+1, n+X]. | | coverage level, if it exists | | +----------------------------------+----------------------------------+ | drx-RetransmissionTimer or | The MAC entity monitors PDCCH in | | drx-ULRetransmissionTimer | PDCCH-subframes during the | | | subframes [n, n+m-1]. | +----------------------------------+----------------------------------+ | onDurationTimer or | The MAC entity monitors PDCCH in | | onDurationTimerSCPTM | PDCCH-subframes during the | | | subframes [n, n+m-1]. | +----------------------------------+----------------------------------+ | drxShortCycleTimer | The MAC entity uses the Short | | | DRX Cycle during the subframes | | | [n, n+X-1]. | | | | | | The MAC entity starts to use the | | | Long DRX Cycle in the subframe | | | n+X. | +----------------------------------+----------------------------------+ | HARQ RTT Timer | The MAC entity starts | | | drx-RetransmissionTimer in the | | | subframe n+X, if needed. | +----------------------------------+----------------------------------+ | UL HARQ RTT Timer | The MAC entity starts | | | drx-ULRetransmissionTimer in the | | | subframe n+X, if needed. | +----------------------------------+----------------------------------+ | NOTE: For FDD, m is equal to X; | | | for TDD, m is equal to the | | | minimum number of subframes so | | | that X PDCCH-subframes are | | | included during the subframes | | | [x, y]. | | | | | | NOTE: A MAC entity configured | | | with eIMTA monitors PDCCH in | | | some subframe(s) in addition to | | | PDCCH-subframes, as specified in | | | subclause 5.7. | | +----------------------------------+----------------------------------+
For _drx-InactivityTimerSCPTM, drx-InactivityTimer_ , _drx-RetransmissionTimer
and drx-ULRetransmissionTimer_ , if _X_ =0, the timer does not make the MAC
entity to monitor the PDCCH.
The intended UE behaviours in Table C-1 are not applicable for NB-IoT.
#
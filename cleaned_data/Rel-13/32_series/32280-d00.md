# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies the Advice of Charge (AoC) framework for
relevant events, sessions, and services. The 3GPP umbrella charging
architecture and principles are defined in TS 32.240 [1].
The AoC framework detailed herein provides for both offline and online
charging models. It specifies the following:
\- The AoC architecture.
\- The common principles that govern AoC.
\- The AoC function that enables the IMS AoC framework.
\- Exemplary message flows.
\- AoC interface data description.
All terms, definitions and abbreviations used in the present document, that
are common across 3GPP TSs, are defined in the 3GPP Vocabulary, TR 21.905
[100]. Those that are common across charging management in 3GPP network,
services or subsystems are provided in the umbrella document TS 32.240 [1] and
may be copied into clause 3 of the present document for ease of reading.
Finally, those items that are specific to the present document are defined
exclusively in the present document.
Requirements that govern the AoC work are specified in TS 22.115 [101].
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TS 32.240: \"Telecommunication management; Charging management;
Charging Architecture and Principles\".
[2] -- [19] Void
[20] 3GPP TS 32.260: \"Telecommunication management; Charging management; IP
Multimedia Subsystem (IMS) charging\".
[21] -- [49] Void
[50] 3GPP TS 32.299: \"Telecommunication management; Charging management;
Diameter charging application\".
[51] - [99] Void
[100] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[101] 3GPP TS 22.115: \"Service aspects; Charging and billing\".
[102] - [201] Void.
[202] 3GPP TS 22.173: \"IP Multimedia Core Network Subsystem (IMS) Multimedia
Telephony Service and supplementary services; Stage 1\".
[203] 3GPP TS 22.024: \"Description of Charge Advice Information (CAI)\".
[204] 3GPP TS 22.086: \"Advice of Charge (AoC) supplementary services; Stage
1\".
[205] 3GPP TS 23.086: \"Advice of Charge (AoC) supplementary services; Stage
2\".
[206] 3GPP TS 24.086: \"Advice of Charge (AoC) supplementary services; Stage
3\".
[207] 3GPP TS 23.078: \"Customised Applications for Mobile network Enhanced
Logic (CAMEL) Phase 4; Stage 2\".
[208] 3GPP TS 24.647: \"_Advice Of Charge (AOC)_ _using IP Multimedia (IM)
Core; Network (CN) subsystem_ \".
[209] 3GPP TS 29.658: \"_SIP Transfer of IP Multimedia Service Tariff
Information; Protocol specification_ \".
[210] 3GPP TS 24.229: \"_IP multimedia call control protocol based on Session
Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3_ \".
[211] 3GPP TS 29.364: \"IP Multimedia Subsystem (IMS) Application Server (AS)
service data descriptions for AS interoperability\".
[212] ETSI TS 182 012 (V2.1.4): \"Telecommunications and Internet converged
Services and Protocols for Advanced Networking (TISPAN); IMS-based PSTN/ISDN
Emulation Sub-system (PES); Functional architecture\".
[213] ETSI TS 183 043 (V2.3.1): \"Telecommunications and Internet converged
Services and Protocols for Advanced Networking (TISPAN); IMS-based PSTN/ISDN
Emulation; Stage 3 specification\".
[214] ETSI ES 201 296 (V1.3.1): \"Integrated Services Digital Network (ISDN);
Signalling System No.7 (SS7); ISDN User Part (ISUP); Signalling aspects of
charging\".
[215] 3GPP TS 22.078: \"Customised Applications for Mobile network Enhanced
Logic (CAMEL); Service description; Stage 1\".
[215] - [299] Void.
[300] - [399] Void.
[400] IETF RFC 2486 (1999): \"The Network Access Identifier\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [100] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in TR
21.905 [100].
**Add-on charge:** additional charge on top of the current tariff. An add-on
charge can either be metered in non-monetary units (e.g. meter pulse) or in
monetary-units (e.g. currency).
**Advice of Charge (AoC):** The Advice of Charge (AoC) supplementary service
provides AoC Information to the served user for information (AoCI) or for
charging (AoCC) related to a corresponding event, session or usage of a
service. The AoC service may be delivered prior to, during or after the
service delivery.
**AoC for Information (AoCI): An AoC supplementary service where the provided
information is non-binding. I.e. the provided information is an estimation of
the service cost and/or tariff. The provided information and the actual
charges may differ.**
**AoC for Charging (AoCC): An AoC supplementary service where the provided
information is binding. I.e. the provided information shall correspond to the
actual charges.**
**AoC at communication set-up time (AOC-S):** An AoC supplementary service
provided at communication establishment and/or at tariff switch time. The
provided information includes Tariff Information for the requested service.
**AoC during the communication (AOC-D):** An AoC supplementary service
provided during the communication at predefined triggering conditions. The
provided information includes accumulated Cost for the ongoing usage.
**AoC at the end of communication (AOC-E):** An AoC supplementary service
provided when the communication is released. The provided information includes
the total accumulated Cost.
**Auxiliary Advice of Charge Function (AACF):** An AACF provides Tariff and/or
Cost information for the requested service. The AACF resides outside of the
local AoC function and the charging domain.
NOTE: In this release, the AACF is considered as CDP for AoCI purpose. CDP is
defined in TS 29.658 [209]. The terms AACF and CDP may change in the future as
a result of possible addition of charging capabilities.
**Charge Advice information (CAI):** CAI elements as described in TS 22.024
[203].
**Charge Determination Point (CDP)** : Defined in ETSI ES 201.296 [214].
**IMS-based PSTN/ISDN Emulation Sub-system (PES):** Defined in ETSI TS 182 012
[212].
**Tariff:** set of parameters defining the applied charges for the use of a
particular bearer / session / service.
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
Symbol format
Bi Reference point for the CDR file transfer from the IMS CGF to the BD.
ISC ISC interface between the S-CSCF and the IMS-GWF
Rf Offline Charging Reference Point between an IMS Network Entity or an AS and
the CDF
Ro Online Charging Reference Point between an AS, MRFC or the IMS-GWF and the
OCS
\ Reference point between UE and P-CSCF as defined in TS 24.647 [208]
\ Reference point between IBCF/MGCF and the external network as
defined in TS 29.658 [209]
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[100] and the following apply.\ An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in TR 21.905 [100].
AACF Auxiliary AoC Function
ACF AoC Function
AGCF Access Gateway Control Function
AoC Advice of Charge
AoC-S AoC at communication Set-up time
AoC-D AoC During the communication
AoC-E AoC at the End of the communication
AoCI AoC for Information
AoCC AoC for Charging
CAI Charge Advice Information
CAMEL Customised Applications for Mobile network Enhanced Logic
CCA Credit-Control-Answer
CCF Charging Collection Function
CCR Credit-Control-Request
CDF Charging Data Function
CDP Charging Determination Point
CGF Charging Gateway Function
CPC Calling Party Category
CSCF Call Session Control Function (I-Interrogating; P-Proxy; and S-Serving)
ECUR Event Charging with Unit Reservation
HSS Home Subscriber Server
IBCF Interconnection Border Control Function
IEC Immediate Event Charging
IMS-GWF IMS Gateway Function
ISC IMS Service Control
MGCF Media Gateway Control Function
OCS Online Charging System
OFCS Offline Charging System
PES IMS-based PSTN/ISDN Emulation Sub-system
RTTI Realtime Transfer of Tariff Information
SCUR Session Charging with Unit Reservation
SIP _Session Initiation Protocol_
UE User Equipment
UNI User to Network Interface
VGW Voice over IP Gateway
# 4 Architecture considerations
## 4.1 High level AoC aspects
Advice of Charge (AoC) is a user-specific supplementary service which provides
AoC Information to the UE in real-time. It contains Cost and/or Tariff for the
requested service, which may be provided either in monetary format (e.g. 0,10
€) or non-monetary format (e.g. 10 charging units).
Depending on the AoC service obligatory type (AoCI or AoCC), the provided
information is either non-binding or binding. AoCI provides **an estimation of
the service Cost and/or Tariff which may deviate from the actual charges. In
contrast to AoCI, AoCC is** binding and shall **correspond to the actual
charges (e.g. corresponding bill position or amount which is deducted from the
prepaid account).**
The AoC service type depends on the following triggering events: AoC-S occurs
at communication establishment and/or at tariff switch time. AoC-D is sent to
the user during the communication, depending on predefined triggering
conditions (e.g. to provide accumulated Cost for the ongoing usage every 5
seconds). AoC-E provides the total accumulated Cost of the service when the
communication is released.
Any combination of the AoC service obligatory type and the service type may
co-exist.
Online charging and offline charging and AoC services are mutually independent
from the end user perspective.
The AoC Information may be based on Tariff Information from a local charging
system, e.g. from an Online Charging System (OCS). Additionally, Tariff or
Cost Information may be received from an external network or service provider
in real time according to the Realtime Transfer of Tariff Information (RTTI)
protocol defined in TS 29.658 [209]. This situation can occur in case of
interconnection scenarios or 3rd party services like Service 0900. Depending
on the local charging system indication, it may be decided whether external
Tariff Information is either rejected or processed to create the AoC
Information.
The selection of tariffs can be conditioned on any parameter defined in the
charging information requirements mentioned in TS 22.115 [101]. The selection
of tariffs may also be dependent upon and not limited to the Calling Party
Category (CPC) defined in TS 24.229 [210], the user balances, consumed
resource prior or within the session, discounts, benefits or any other
commercial agreement that the user is engaged with the service provider.
AoC-related subscription status and user profiles are stored in the HSS. The
AoC-related user profiles contain the following information:
\- AoC service obligatory type (AoCI or AoCC);
\- AoC service type (any combination of AoC-S, AoC-D, and AoC-E);
\- AoC configuration and preferences.
Details are described in clause 6.4.
## 4.2 AoC in GSM network architecture
The CAMEL feature (Customised Applications for Mobile network Enhanced Logic)
is described in TS 22.078 [215].
The Charge Advice Information (CAI) is described in TS 22.024 [203], TS 22.086
[204], TS 23.086 [205] and TS 24.086 [206].
## 4.3 AoC in IP Multimedia Subsystem (IMS) architecture
### 4.3.0 Introduction
The IMS Charging Architecture is described in TS 32.260 [20].\ Figure 4.3.0.1
shows the specific part of the IMS charging architecture that handles AoC.
{width="5.999305555555556in" height="5.533333333333333in"}
Figure 4.3.0.1: IMS AoC architecture
Figure 4.3.0.1 shows functional entities that are not directly involved in
AoC, but completes the picture with affected interfaces.\ TS 24.647 [208]
specifies the AoC Information transferred to the UE via involved IMS
functional entities.\ TS 29.658 [209] specifies the procedures for the real-
time transfer of charging information in interconnection scenarios.
AoC Function may reside in the same AS hosting the service for which the AoC
Service is to be provided, or in a separate AS (not shown in figure 4.3.0.1).
The AoC Function (ACF) requests the AoC-related subscription and formatting
parameters from the HSS via Sh. Additionally, filter criteria for ACF
triggering may also be retrieved from the HSS by a CSCF via Cx.
The AoC Function obtains tariff information from the charging domain via Ro or
the AoC function may have local Tariff information available (see clause
4.3.1.1). See the AoC interfaces for details.
NOTE: The AoC function may be unified with the IMS-GW function in online
charging.
### 4.3.1 AoC functional entities
#### 4.3.1.1 AoC Function
The AoC Function is a logical functional entity that provides AoC Information.
It includes the following functions:
\- Receive and or obtain Cost / Tariff data from various sources:
> \- Charging domain
>
> \- External tariff received from an AACF in real time (TS 29.658 [209])
>
> \- Locally configured data (valid only for AoCI service)
\- AoC data determination -- reworks and arbitrates how to combine the
incoming Tariff / Cost sources.
This shall be done through consultation with the charging domain in the AoCC
service and can be done locally at the ACF for AoCI service
\- Transform the AoC data into the corresponding output message format for
presentation.
NOTE 1: In this release, the ACF is considered as CGP for AoCI purpose. The
CGP is defined in TS 29.658 [209]. The terms ACF and CGP may change in the
future as a result of possible addition of charging capabilities.
NOTE 2: External tariff received in real time (according to TS 29.658 [209])
is not supported for AoCC service in this release.
### 4.3.2 AoC interfaces
AoC has the following interfaces:
> Sh -- for obtaining AoC-related subscription and formatting parameters from
> the HSS.
>
> ISC -- for receiving RTTI from Auxiliary AoC Function (AACF) and for
> providing the AoC Information to the UE.
>
> Ro / Re -- for obtaining Tariff and Cost Information; Ro shall be used for
> providing AoCC service and\ may be used for AoCI services.
AACF can be embodied in external nodes such as:
\- Application Server
\- Charging Determination Point (CDP) in a PSTN network
\- SIP node in another IMS domain
Figure 4.3.2.1 shows possible locations of AACF nodes interacting with IMS
ACF.
Figure 4.3.2.1: Logical AoC architecture with AACF
### 4.3.3 AoC interworking with other features
#### 4.3.3.1 AoC and offline charging
##### 4.3.3.1.1 Interworking for AoC service execution
For scenarios where the ACF is interworking with the offline charging feature
and the service obligatory type is AoCI estimating C**ost and/or Tariff**
Information may be performed using any of the following methods:
> \- Local determination using offline synchronization of tariff information -
> The ACF may synchronize out of band the tariff information from the charging
> domain. In this case, the ACFneeds to have an independent rating function.
>
> \- Interactively via the CDF through Ro - ACF may obtain the tariff
> information interactively from the CDF.
>
> \- Interactively via the OCS through Ro - Offline subscribers can be
> perceived as online subscribers with unlimited balance (or very high balance
> that practically implies that). This approach enables the ACF to have
> unified flow of messages for offline and online subscribers in providing AoC
> Information.
For scenarios where the ACF is interworking with the offline charging feature
and the service obligatory type is AoCC determining C**ost and/or Tariff**
Information shall be via the OCS through Ro.
##### 4.3.3.1.2 AoC invocation recording
When ACF is triggered on behalf of a service and results in the AoC
Information delivered to the UE, this ACF may also generate AoC related Rf
messages as described in clause 6.3.1.3.
#### 4.3.3.2 AoC and online charging
For scenarios where the ACF is interworking with the online charging feature
and the service obligatory type is AoCI estimating C**ost and/or Tariff**
Information may be performed using any of the following methods:
> \- Local determination using offline synchronization of tariff information -
> The ACF may synchronize out of band the tariff information from the charging
> domain. In this case, the ACF needs to have an independent rating function.
>
> \- Interactively via the OCS through Ro.
For scenarios where the ACF is interworking with the online charging feature
and the service obligatory type is AoCC, determining C**ost and/or Tariff**
Information shall be via the OCS through Ro.
NOTE 1: The OCS has a rating function, performs correlations and calculates
the costs.\ The OCS is responsible to determine the final cost of the service.
Hence the OCS results shall be used for AoCC service (obtained through Ro).
For calculating the actual Cost when the tariff / charge is determined by 3rd
party, the OCS needs to obtain the 3rd party tariff / add-on charge in real
time. The ACF is responsible for obtaining the tariff / charge information and
translating it into the appropriate Debit Units Request in the Ro. The OCS may
take further considerations as of the actual Cost (e.g. add on charges,
discounts).
NOTE 2: Therefore it is highly recommended that the ACF and the IMS-GW
functions is unified at least for the online subscriptions.
#### 4.3.3.3 AoC and RTTI
The AoC service shall receive the Tariff or Cost provided in real time by the
external network or service provider (e.g. interconnection scenarios or 3rd
party services), according to TS 29.658 [209]. The AoC Information, provided
to the UE, may take the provided information into consideration.
NOTE: This feature is valid only for AoCI service in this release.
# 5 AoC principles and flows
## 5.1 Common charge advice principles
AoC is a supplementary service which provides AoC Information to the UE in
real-time. It may contain Cost and/or Tariff Information for the requested
service and may be provided at the beginning, during or at the end of service
execution.
## 5.2 AoC in GSM networks (CAI description)
The Charge Advice Information (CAI) is described in TS 22.024 [203], TS 22.086
[204], TS 23.086 [205] and TS 24.086 [206].
## 5.3 AoC in IMS
### 5.3.1 Basic principles and definitions
AoC uses the Debit / Reserve Units operation that is specified in TS 32.299
[50].
AoC Information can be provided in two cases:
> \- AoC Enquiry -- An independent request with no Credit-Control
> implications;
>
> \- Debit Unit Request - In conjunction with the Debit / Reserve Units
> Requests IEC, ECUR, SCUR.
In the ECUR & SCUR, the Advise of charge is supported as part of the Debit
Units Request[Initial, Update, Terminate].
Both stage 2 and stage 3 mechanisms for the three cases for online charging
are detailed in TS 32.299 [50].
### 5.3.2 Message flows and types for offline charging
### 5.3.2.0 Introduction
The message flows in this clause are based on the signalling flows specified
in TS 24.647 [208].
The basic IMS session establishment for a user registered to AoC service(s) is
depicted in the annex B. This basic call-flow helps describing in the future
the message flows for AoC-S, AoC-D, AoC-E and also including cases where
information are received from RTTI messages.
Editor\'s Note: The detailed AoC call-flows are FFS.
#### 5.3.2.1 Successful session establishment: AoC-S with AoC Information in
reliable 1xx response (originating side)
Figure 5.3.2.1.1 shows the transactions for the successful delivery of the AoC
Information in 1xx response to the originating subscriber during session
establishment originated by a UE.
Figure 5.3.2.1.1: Message sequence chart for session establishment (1xx
Response) with AoC-S
\- Step 1: An initial SIP INVITE request is received in the S-CSCF. This
request is forwarded to the ACF.
\- Step 2: The ACF received the AoC Type = [AoC-S] and queries the OCS for
Tariff Information.
\- Step 3: The AoC-S information is included in SIP 183 response.
\- Step 4: The UE acknowledges the SIP 183 with PRACK.
\- Step 5: AoC Function responses with SIP 200 OK.
\- Step 6: The SIP INVITE request is received in the S-CSCF and forwards this
request.
\- Step 7: The S-CSCF receives the SIP 200 OK response and forwards this
response.
\- Step 8: The ACF queries the OCS and maps the Tariff Information into the
AoC Information for further proceeding.
\- Step 9: The ACF inserts the AoC-S and resulting \"AoC information XML
body\" as defined in TS 24.647 [208], in the SIP 200 OK response, and the
S-CSCF forwards it towards UE
\- Step 10: The ACF sends a Charging Data Request with AoC service type and
AoC Information indicating EVENT_RECORD to the CDF.
\- Step 11: The CDF generates the ACF-CDR to record the AoC service type and
AoC Information.
\- Step 12: The CDF acknowledges the reception of the Charging Data Response.
#### 5.3.2.2 Mid-session procedure: AoC-S with AoC Information in an SIP INFO
request
Figure 5.3.2.2.1 shows the transactions for the successful delivery of the AoC
Information to the originating subscriber when a tariff change is detected by
AoC Function.
NOTE: This case is relevant when AoC-S is activated.
Figure 5.3.2.2.1: Message sequence chart for mid-session procedure with AoC-S
\- Step 1: The ACF detects that tariff is changed and queries the OCS for
Tariff Information.
\- Step 2: SIP INFO request is send with AoC-S and resulting \"AoC information
XML body\" as defined in TS 24.647 [208].
\- Step 3: The ACF sends a Charging Data Request with AoC service type and AoC
Information indicating EVENT_RECORD to the CDF.
\- Step 4: SIP 200 OK is received.
\- Step 5: The CDF acknowledges the reception of the Charging Data Response
and generates the ACF-CDR.
#### 5.3.2.3 Session release: AoC-E -- originating party clears
Figure 5.3.2.3.1 shows the transactions for the successful delivery of the AoC
Information to the originating subscriber when session is released by
originating party.
NOTE: This case is relevant also when AoC-D is activated.
Figure 5.3.2.3.1: Message sequence chart for session release originating party
clears
\- Step 1: A SIP session is released by sending a SIP BYE message. The S-CSCF
forwards this message to the ACF and forwards this request.
\- Step 2: The ACF received the AoC Type = [AoC-E] and queries the OCS for
Tariff Information.
\- Step 3: The S-CSCF receives the SIP 200 OK response and forwards this
response.
\- Step 4: The ACF maps the Tariff Information into the AoC Information for
further proceeding.
\- Step 5: The ACF inserts the AoC-S and resulting \"AoC information XML
body\" as defined in\ TS 24.647 [208], in the SIP 200 OK response, and the
S-CSCF forwards it towards UE
\- Step 6: The ACF sends a Charging Data Request with AoC service type and AoC
Information indicating EVENT_RECORD to the CDF.
\- Step 7: The CDF generates the ACF-CDR to record the AoC service type and
AoC Information.
\- Step 8: The CDF acknowledges the reception of the Charging Data Response.
#### 5.3.2.4 Session release: AoC-E -- terminating party clears
Figure 5.3.2.4.1 shows the transactions for the successful delivery of the AoC
Information to the originating subscriber when session is released by
terminating party.
NOTE: This case is relevant also when AoC-D is activated.
Figure 5.3.2.4.1: Message Sequence Chart for Session Release Terminating Party
Clears
\- Step 1: A SIP session is released by sending a SIP BYE message. The S-CSCF
forwards this message to the AoC Function and forwards this request.
\- Step 2: The AoC Function queries the OCS and converts the Tariff
Information to AoC Information for AoC-E.
\- Step 3: The S-CSCF receives the SIP 200 OK response and forwards this
response.
\- Step 4: The AoC Function maps the Tariff Information into the AoC
Information for further proceeding
\- Step 5: The ACF inserts the AoC-E and resulting \"AoC information XML
body\" as defined in\ TS 24.647[208], in the SIP 200 OK response, and the
S-CSCF forwards it towards UE.
\- Step 6: The ACF sends a Charging Data Request with AoC service type and AoC
Information indicating EVENT_RECORD to the CDF.
\- Step 7: The CDF generates the ACF-CDR to record the AoC service type and
AoC Information.
\- Step 8: The CDF acknowledges the reception of the Charging Data Response.
#### 5.3.2.5 AoC Function co-located with same AS providing the service
##### 5.3.2.5.0 Introduction
The following flows show the transactions between an MMTel AS embedding the
AoC Function for providing AoC as a MMTel supplementary service as defined in
TS 22.173 [201].
##### 5.3.2.5.1 Successful session establishment: AoC-S (originating side)
Figure 5.3.2.5.1.1 shows the transactions for the successful delivery of the
AoC Information to the originating subscriber during session establishment for
MMTel service originated by a UE.
Figure 5.3.2.5.1.1: Message sequence chart for session establishment with
AoC-S for MMTel service.
\- Step 1: An initial SIP Invite Request is received in the S-CSCF. This
request is forwarded to the MMTel AS embedding also ACF.
\- Step 2: The ACF received the AoC Type = [AoC-S] and queries the OCS for
Tariff Information for MMTel service.
\- Step 3: The AoC-S \"AoC information XML body\" as defined in TS
24.647[208], is included in SIP 183 response.
\- Step 4: The UE acknowledges the SIP 183 with PRACK.
\- Step 5: AoC Function responses with SIP 200OK.
\- Step 6: The SIP Invite Request is received in the S-CSCF and forwards this
request.
\- Step 7: The S-CSCF receives the SIP 200 OK response and forwards this
response.
\- Step 8: The AoC Function queries the OCS for the Tariff Information for
MMTel service
\- Step 9: The ACF inserts the AoC-S and resulting \"AoC information XML
body\" as defined in TS 24.647 [208], in the SIP 200 OK response, and the
S-CSCF forwards it towards UE
\- Step 10: The MMTel AS sends a Charging Data Request indicating START to the
CDF, for the start of MMTel service, and includes AoC-S and AoC Information
supplementary service.
\- Step 11: The CDF generates the MMTel-CDR recording also the AoC-S and AoC
Information.
\- Step 12: The CDF acknowledges the reception of the Charging Data Response.
##### 5.3.2.5.2 AOC-D for serving party in SIP INFO request
The following figure 5.3.2.5.2.1 shows the transactions for AoC-D delivery to
the serving subscriber, when a tariff change is detected by ACF during MMTel
service.
Figure 5.3.2.5.2.1: Message sequence chart for AoC-D to serving party
\- Step 1: The ACF detects that tariff is changed for MMTel service and
queries the OCS for Tariff Information.
\- Step 2: SIP INFO request is send with AoC-S and resulting \"AoC information
XML body\" as defined in TS 24.647 [208].
\- Step 3: The MMTel AS sends a Charging Data Request indicating INTERIM
_RECORD to the CDF and includes AoC-D and AoC Information as supplementary
service.
\- Step 4: SIP 200OK is received.
\- Step 5: The CDF acknowledges the reception of the Charging Data Response
and updates the MMTel-CDR with AoC-D and AoC Information.
##### 5.3.2.5.3 Session release: AoC-E -- serving party clears
Figure 5.3.2.5.3.1 shows the transactions for delivery of the AoC-E to the
serving subscriber when it releases MMTel service.
Figure 5.3.2.5.3.1: Message sequence chart for AoC-E when serving party clears
\- Step 1: A SIP session is released by sending a SIP BYE message. The S-CSCF
forwards this message to the MMTel AS and forwards this request.
\- Step 2: The ACF queries the OCS for Tariff Information in order to perform
AoC-E for MMTel service.
\- Step 3: The S-CSCF receives the 200 OK response and forwards this response.
\- Step 4: The AoC Function maps the Tariff Information into the AoC
Information for further proceeding.
\- Step 5: The ACF inserts the AoC-S and resulting \"AoC information XML
body\" as defined in\ TS 24.647 [208], in the SIP 200 OK response, and the
S-CSCF forwards it towards UE
\- Step 6: The MMTel AS sends a Charging Data Request indicating STOP_RECORD
to the CDF and includes AoC-E and AoC Information as supplementary service.
\- Step 7: The CDF closes the MMTel-CDR with AoC-E and AoC Information
included.
\- Step 8: The CDF acknowledges the reception of the Charging Data Response.
## 5.4 AoC in Inter-connected
### 5.4.1 Principles
In case of interconnection scenarios or 3^rd^ Party Services, the AoC service
may be based on RTTI provided by the external network or service provider, as
described in clause 4.3.3.3.
### 5.4.2 Scenarios
AoC Use cases based on RTTI are described in Annex A.1.2 and A.1.3.
### 5.4.3 Message flows
RTTI related signalling flows are described in TS 29.658 [209].
## 5.5 AoC support for PSTN/ISDN Emulation
The IMS based PSTN/ISDN Emulation Sub-system (PES) as defined in ETSI TS 182
012 [212] supports the emulation of PSTN/ISDN services for analogue/ISDN
terminals connected to the NGN through residential gateways or access
gateways. The Voice over IP Gateway (VGW) is a SIP-based gateway device that
connects legacy equipment to the NGN. It plays the role of an IMS UE with
regards to the P-CSCF. The Access Gateway Control Function (AGCF) is a SIP-
based media gateway controller, which plays the combined role of an IMS UE and
a P-CSCF with regards to the\ S-CSCF.
NOTE: This paragraph provides background information for AoC support for PES.\
The normative definitions of PES are provided by ETSI TS 183 043 [213].
In order to support the emulation of AoC service for analogue terminals, the
AoC Information is transferred to a VGW or an AGCF according to the AoC
Extended XML schema defined in ETSI TS 183 043 [213].\ The AoC Extended XML
schema contains the following additional AoC Information elements**:
\'pes_aoc-s_phase_duration\'** and \'**pes transitioning behaviour\'**.
The decision which \"AOC information XML body\" is applicable depends on
signalling information. Further details, as well as general rules how to
populate the AoC Extended XML parameters are defined in ETSI TS 183 043 [213].
For ISDN terminals, the AoC emulation is based on TS 24.647 [208].
# 6 Definition of AoC Information
## 6.0 General
The following clauses describe an overall AoC Information model that enables
the modelling of the various data flowing to and from the AoC Function (ACF).
The model is followed by a data structure to be used in the Ro and the Rf
reference points. Suggested data mapping to the model is provided in the
informative Annex B.
## 6.1 AoC Information model principles
The AoC Information model is a logical representation of the AoC data internal
to the AoC Function (ACF).
The AoC Information model has to adhere to the following principles:
> \- CAI element mapping ability -- The model shall allow the mapping of CAI
> elements into AoC tariff (according to TS 22.024 [203]).
>
> \- UE AoC data mapping ability - The AoC Information model shall allow the
> mapping of AoC into UE format (according to TS 24.647 [208]) respectively
> ETSI TS 183 043 [213] according to Annex C2)
>
> \- NNI data mapping ability -- Be able to map incoming RTTI (according to TS
> 29.658 [209]) into the AoC Information model
>
> \- Protocol data mapping ability -- The ability to map Debit / Reserve Units
> Request and Response (in TS 32.299 [50]) to the AoC Information model. i.e.:
>
> \- Input: Service ID - The model shall allow the charging domain selecting
> tariffs based on the Service ID for offline and online charging.
>
> \- Input: Service Units -- The model shall allow representing tariffs based
> on all different unit types (monetary and non-monetary) of Requested
> Requested-Service-Units for online charging.
>
> \- Output: Cost Information -- The model shall allow representing determined
> charges by the charging Domain in Cost Information for offline and online
> charging.
>
> \- Output: Ro data mapping ability -- Be able to map information by the
> charging domain into the AoC Information model.
>
> \- Inter Operator Tariff schemes support -- The AoC Information model shall
> support inter operators tariffs (based on TS 22.115 [101]); i.e. absolute
> add on charges and relative add on charges.
>
> \- AoC types -- accommodate all AoC service types and AoC service obligatory
> type data.
## 6.2 AoC Information model
The AoC Information heading denotes the AoC obligatory type.
AoC Information comprises of two parts:
> \- the Cost Information e.g. AoC related accumulated and/or incremental
> cost;
>
> \- the Tariff Information for the requested service to be applied onward. A
> tariff switch time can occur.\ The tariff in effect after the switch time
> can be added to the model.
Figure 6.2.1 depicts the AoC Information model.
The Tariff Information contains the current Tariff and may optionally denote
the anticipated Tariff after a Tariff Switch Time.
The Tariff Information may be related to a tariff given by a 3^rd^ party
provider. The Tariff may add additional tariff, change currency or place a
mark-up (or discount) on top of the 3^rd^ party provider Tariff. Thus Tariff
Information can be chained numerous of times, based on the business value
chain.
Each Tariff defines a Currency Code for monetary tariffs or none when the
tariff is metered in non monetary units.
A Tariff may be defined by using multi dimensional rating elements. Each
dimension is identified through the Unit Type. Any combination of rating
elements can be provided. If a tariff is a mark-up on top of a 3^rd^ party
provider tariff no rating elements are provided in the tariff information
model.
Each rating element is comprized of the Unit Type that describes the units to
be measured, the number of units (Unit Value), what is the Cost (Cost Value)
associated of consuming this number of units and for how many units this rate
is applicable (Unit Threshold). Chaining rating elements of the same dimension
is possible, as long as a Unit Threshold is provided. The last rating element
in the chain may be provided without a Unit Threshold. A rating element
without a Unit Threshold denotes that the rate is applicable as long as the
Tariff is in effect.
Figure 6.2.1: AoC Information model
## 6.3 AoC data definition
### 6.3.1 Ro message contents
#### 6.3.1.1 Summary of AoC message formats
The AoC Service uses the Debit / Reserve Units Request and Debit / Reserve
Units Response messages defined in TS 32.299 [50]. AoC service can be used in
a request type price enquiry or complementary to regular Debit Units Request
as described in clause 5.3.1.
Table 6.3.1.1.1 describes the use of these messages for AoC.
Table 6.3.1.1.1: AoC messages reference table
* * *
Message Source Destination Debit / Reserve Units Request ACF OCS Debit /
Reserve Units Response OCS ACF
* * *
#### 6.3.1.2 Structure for the Debit / Reserve Units message formats
##### 6.3.1.2.0 General
This clause describes the information elements used in the Debit / Reserve
Units operation messages and the category in the tables are used according to
the charging data configuration defined in clause 5.4 of TS 32.240 [1].
##### 6.3.1.2.1 Debit / Reserve Units Request message
Table 6.3.1.2.1.1 illustrates the basic structure of a Debit / Reserve Units
Request message from the ACF as used for AoC service.
Table 6.3.1.2.1.1: Debit / Reserve Units Request message content
* * *
Information Element Category Description Session Identifier M Described in TS
32.299 [50] Originator Host M Described in TS 32.299 [50] Originator Domain M
Described in TS 32.299 [50] Destination Domain M Described in TS 32.299 [50]
Operation Identifier M Described in TS 32.299 [50] Operation Token M Described
in TS 32.299 [50] Operation Type M Described in TS 32.299 [50]. Operation
Number M Described in TS 32.299 [50] Destination Host O~C~ Described in TS
32.299 [50] User Name O~M~ The field contains the Private User Identity
described in IETF RFC 2486 [400] Origination State O~C~ Described in TS 32.299
[50] Origination Timestamp O~C~ Described in TS 32.299 [50] Subscriber
Identifier O~M~ This field contains the identification of the subscriber (i.e.
MSISDN or SIP-URI) that uses the requested service. Termination Cause O~C~
Described in TS 32.299 [50] Requested Action O~C~ Described in TS 32.299 [50]
AoC Request Type O~M~ This field denotes if AoC Information is requested and
what type of information is needed. Multiple Operation O~M~ Described in TS
32.299 [50], only used if AoC services is used together with an online
charging session. Multiple Unit Operation O~C~ Described in TS 32.299 [50],
only used if AoC services is used together with an online charging session.
Subscriber Equipment Number O~C~ Described in TS 32.299 [50] Route Information
O~C~ Described in TS 32.299 [50] Service Information O~M~ Described in clause
6.3.2
* * *
##### 6.3.1.2.2 Debit / Reserve Units Responsemessage
Table 6.3.1.2.2.1 illustrates the basic structure of a DCCA message as used
for the ACF. This message is always used by the OCS as specified below,
independent of the receiving ACF and the Debit / Reserve Units Request request
type that is being replied to. Service Information is used to send back the
AoC Information.
Table 6.3.1.2.2.1: Debit / Reserve Units Response message content
* * *
Information Element Category Description Session Identifier M Described in TS
32.299 [50] Operation Result M Described in TS 32.299 [50] Originator Host M
Described in TS 32.299 [50] Originator Domain M Described in TS 32.299 [50]
Operation Identifier M Described in TS 32.299 [50] Operation Type M Described
in TS 32.299 [50] Operation Number M Described in TS 32.299 [50] Operation
Failover O~C~ Described in TS 32.299 [50] Multiple Unit Operation O~C~
Described in TS 32.299 [50] Operation Failure Action O~C~ Described in TS
32.299 [50] Redirection Host O~C~ Described in TS 32.299 [50] Redirection Host
Usage O~C~ Described in TS 32.299 [50] Redirection Cache Time O~C~ Described
in TS 32.299 [50] Route Information O~C~ Described in TS 32.299 [50] Failed
parameter O~C~ Described in TS 32.299 [50] Service Information O~C~ Described
in TS 32.299 [50]
* * *
#### 6.3.1.3 Rf message content related to AoC service
##### 6.3.1.3.0 Introduction
The ACF generates charging data transferred to the CDF using the Charging Data
transfer operation, as described in the TS 32.299 [50] _and t_ he category in
the tables are used according to the charging data configuration defined in
clause 5.4 of TS 32.240 [1].
The _Charging Data Request_ and _Charging Data Response_ are used _for this
ACF_ _Charging data transfer._
##### 6.3.1.3.1 Charging Data Request message
Table 6.3.1.3.1.1 illustrates the basic structure of a _Charging Data Request_
message as used for ACF _Charging data transfer_.
Table 6.3.1.3.1.1: Charging Data Request message content
* * *
Information Element Category Description
Session Identifier M Described in 32.299 [50]
Originator Host M Described in 32.299 [50]
Originator Domain M Described in 32.299 [50]
Destination Domain M Described in 32.299 [50]
Operation Type M Described in 32.299 [50]
Operation Number M Described in 32.299 [50]
Operation Identifier O~M~ Described in 32.299 [50]
User Name O~C~ Described in 32.299 [50]
Destination Host O~C~ Described in 32.299 [50]
Operation Interval O~C~ Described in 32.299 [50]
Origination State O~C~ Described in 32.299 [50]
Origination Timestamp O~C~ This field contains the time when the operation is
requested.
Proxy Information O~C~ Described in 32.299 [50]
Route Information O~C~ Described in 32.299 [50]
Operation Token O~M~ Described in 32.299 [50]
Service Information O~M~ This field holds the 3GPP specific AoC Information
and\ is described in clause 6.3.2
* * *
##### 6.3.1.3.2 Charging Data Response message
Table 6.3.1.3.2.1 illustrates the basic structure of a _Charging Data
Response_ message as used for ACF _Charging data transfer_.
Table 6.3.1.3.2.1: Charging Data Response message content
* * *
Information Element Category Description Session Identifier M Described in
32.299 [50] Operation Result M Described in 32.299 [50] Originator Host M
Described in 32.299 [50] Originator Domain M Described in 32.299 [50]
Operation Type M Described in 32.299 [50] Operation Number M Described in
32.299 [50] Operation Identifier O~M~ Described in 32.299 [50] User Name O~C~
Described in 32.299 [50] Operation Interval O~C~ Described in 32.299 [50]
Origination State O~C~ Described in 32.299 [50] Origination Timestamp O~C~
Described in 32.299 [50] Proxy Information O~C~ Described in 32.299 [50]
* * *
### 6.3.2 Definition of Service Information
Table 6.3.2.1.1: Service Information structure
* * *
Information Element Category Description Service Information O~C~ This is a
structured field and holds the 3GPP specific parameter for AoC service. IMS
Information O~C~ Described in TS 32.260 [20] Inter Operator Identifier O~C~
Described in TS 32.260 [20] Originating IOI O~C~ Described in TS 32.260 [20]
Service ID O~C~ Used to identify the third party service AoC Information O~C~
Described in clause 6.3.3
* * *
### 6.3.3 Definition of AoC Information
#### 6.3.3.0 General
The AoC Information parameter used for AoC is provided in the Service
Information parameter.
#### 6.3.3.1 AoC Information assignment for Service Information
The components in the Service Information that are use for AoC can be found in
table 6.3.2.1.1.
Table 6.3.3.1.1: AoC Information structure
+----------------------------+----------+----------------------------+ | Information Element | Category | Description | +----------------------------+----------+----------------------------+ | AoC Information | O~C~ | This is a structured field | | | | and holds the 3GPP | | | | specific parameter for AoC | | | | service. | +----------------------------+----------+----------------------------+ | Tariff Information | O~C~ | This is a structured field | | | | and holds the Tariff | | | | specific parameters.\ | | | | The details are defined in | | | | clause 6.3.2.2. It can | | | | chain inter operator | | | | tariff. | +----------------------------+----------+----------------------------+ | AoC Cost Information | O~C~ | This is a structured field | | | | and holds the AoC cost | | | | specific parameters.\ | | | | The details are defined in | | | | clause 6.3.2.3. | +----------------------------+----------+----------------------------+ | AoC Subscription | O~C~ | Used by the AoC functions | | Information | | to inform the OCS about | | | | the AoC Subscription and | | | | Formatting parameters | | | | received from the HSS. | | | | | | | | When used by ACF for | | | | Charging data transfer as | | | | described in\ | | | | clause 6.3.1.3, only \"AoC | | | | service\" is present. | +----------------------------+----------+----------------------------+
#### 6.3.3.2 Definition of the Tariff Information
Tariff information is provided within the AoC Information.
The detailed structure of the Tariff Information can be found in the table
6.3.3.2.1.
Table 6.3.3.2.1: Tariff Information structure
* * *
**Information Element** **Category** **Description** Tariff Information O~C~
This is a grouped field with one of many tariffs Current Tariff M Tariff as
defined in table 6.3.2.2-2 for the current time period. Tariff Time Change
O~C~ The tariffs switch time. Next Tariff O~C~ Tariff as defined in table
6.3.2.2-2 for the next time period.
* * *
The detailed structure of a Tariff can be found in the table 6.3.3.2-2.
Table 6.3.3.2.2: Tariff structure
+--------------------------+--------------+--------------------------+ | **Information Element** | **Category** | **Description** | +--------------------------+--------------+--------------------------+ | Tariff | Oc | This is a grouped field | | | | with one of many tariffs | +--------------------------+--------------+--------------------------+ | > Currency_Code | Oc | Omitted if non-monetary | | | | units is used | +--------------------------+--------------+--------------------------+ | > Scale_Factor | Oc | A scaling factor on the | | | | whole calculation.\ | | | | Could be used for | | | | example between HPLMN | | | | and VPLMN. | +--------------------------+--------------+--------------------------+ | > Value_Digits | O~M~ | | +--------------------------+--------------+--------------------------+ | > Exponent | Oc | | +--------------------------+--------------+--------------------------+ | > Rate_Element | Oc | Group of Cost per unit | | | | values of unit type. | +--------------------------+--------------+--------------------------+ | > Charge Reason Code | Oc | Indicates a specific | | | | charge type e.g. Usage, | | | | AddOn Charge,\ | | | | Set-Up-Charge or | | | | Comm | | | | unication-Attempt-Charge | +--------------------------+--------------+--------------------------+ | > Unit_Type | O~M~ | The measuring unit; e.g. | | | | time, uplink volume, | | | | special service units | +--------------------------+--------------+--------------------------+ | > Unit_Value | O~M~ | The number of consumed | | | | units that incur the | | | | charge. | +--------------------------+--------------+--------------------------+ | > Value_Digits | O~M~ | | +--------------------------+--------------+--------------------------+ | > Exponent | Oc | | +--------------------------+--------------+--------------------------+ | > Unit_Cost | O~M~ | The associated Cost (in | | | | currency code) to be | | | | charged per Unit_value | +--------------------------+--------------+--------------------------+ | > Value Digits | O~M~ | | +--------------------------+--------------+--------------------------+ | > Exponent | Oc | | +--------------------------+--------------+--------------------------+ | > Unit_Quota_Threshold | Oc | An upper limit for | | | | consumed units where the | | | | rate is still valid | +--------------------------+--------------+--------------------------+
For example:
1\. A rate of 20c for each Megabyte (total volume) up to 10 Megabyte is
depicted as Unit type - TOTAL-OCTETS, Unit Value - 1,048,576, Cost -- 20 and
Unit threshold - 10,485,760.
2\. A rate of 30c per 60s : Cost_Value = 30, Unit_Value =60 assuming
appropriate settings for currency and unit_type.
#### 6.3.3.3 Definition of AoC Cost Information
Cost information is provided within the AoC Cost Information.\ The AoC Cost
Information is only used in CCA and Charging Data Request.
The detailed structure of the AoC Cost Information can be found in the table
6.3.3.3.1.
Table 6.3.3.3.1: Structure of AoC Cost Information
+-------------------------+--------------+--------------------------+ | **Information Element** | **Category** | **Description** | +-------------------------+--------------+--------------------------+ | Accumulated_Cost | Oc | The ammount charged | | | | since the beginning of | | | | the session | +-------------------------+--------------+--------------------------+ | > Value_Digits | O~M~ | | +-------------------------+--------------+--------------------------+ | > Exponent | Oc | | +-------------------------+--------------+--------------------------+ | Incremental_Cost | Oc | The ammount charged | | | | since the last report. | +-------------------------+--------------+--------------------------+ | > Value_Digits | O~M~ | | +-------------------------+--------------+--------------------------+ | > Exponent | Oc | | +-------------------------+--------------+--------------------------+ | Currency_Code | Oc | Ommited if the ammount | | | | is in non-monetary units | | | | units | +-------------------------+--------------+--------------------------+
## 6.4 AoC subscription and formatting parameters
AoC-related subscription and formatting parameters are stored in the HSS and
retrieved via Sh (see TS 29.364 [211]).
There are two sets of parameters retrieved from the HSS:
> \- Subscription based -- general parameters pertaining the service
> registered per subscriber
>
> \- Formatting based -- UE presentation preferences parameters
The subscription parameters are listed in table 6.4.1. The formatting
parameters are listed in table 6.4.2.
Table 6.4.1: AoC subscription parameters
+----------------------+----------------------+----------------------+ | Information Element | Description | Values | +----------------------+----------------------+----------------------+ | AoC Service | A paired list of AoC | | | | Service type and AoC | | | | Service obligatory | | | | type | | +----------------------+----------------------+----------------------+ | AoC service type | Defines the type of | AoC-S | | | AoC information to | | | | be provided to the | AoC-D | | | subscriber. | | | | | AoC-E | | | | | | | | None | +----------------------+----------------------+----------------------+ | AoC service | Defines whether AoC | AoC for Information | | obligatory type | information is | (AoCI) | | | binding or non | | | | binding. | AoC for Charging | | | | (AoCC) | +----------------------+----------------------+----------------------+ | Preferred AoC | Defines the currency | Currency | | currency | preferred by the | | | | subscriber | | +----------------------+----------------------+----------------------+
Table 6.4.2: AoC format parameter
+---------------------+----------------------+----------------------+ | Information Element | Description | Values | +---------------------+----------------------+----------------------+ | AoC format | Defines the format | Monetary charging | | | of the AoC | Information Element | | | information sent to | | | | the UE. | Non-monetary | | | | charging Information | | | | Element | | | | | | | | Charge Advice | | | | Information (CAI) | +---------------------+----------------------+----------------------+
**The following additional rules are applicable for AoC:**
> \- Any combination of AoC service obligatory types and the AoC service types
> may co-exist.
###### ## Annex A (informative): AoC use cases
# A.0 General
The following use cases detail a set of call scenarios that employ AoC
services. The AoC services used are of type AoC-S, AoC-D and AoC-E. The use
cases cover the AoC-S, AoC-D and AoC-E AoC service types and are applicable to
either AoCI or AoCC service obligatory types.
# A.1 Call scenarios with AoC Information provided at the beginning and/or
during and/or at the end of the call
## A.1.1 Outgoing call with Tariff provided by the charging domain at the
start of the call
+--------------------+------------------------------------------------+ | Actors: | Alan and Brendan are telecoms subscribers. | | | Alan is an IMS subscriber with AoC service(s). | +--------------------+------------------------------------------------+ | Description: | Tariff information is provided to Alan at the | | | start of the call. | +--------------------+------------------------------------------------+ | Preconditions: | AoC-related subscription status and user | | | profile for Alan are stored in the HSS. | +--------------------+------------------------------------------------+ | Post conditions: | Alan is ready to proceed with his call after | | | receiving the tariff information applicable to | | | the call. | +--------------------+------------------------------------------------+ | Normal Flow: | - Alan initiates an IMS session to call | | | Brendan | | | | | | - The tariff for the call is sent to Alan at | | | the beginning of the call | | | | | | - Alan receives the AoC Information on his | | | UE | +--------------------+------------------------------------------------+ | Alternative Flows: | | +--------------------+------------------------------------------------+ | Assumptions: | The charging domain (online or offline) has | | | the tariff for this call. | +--------------------+------------------------------------------------+ | Notes and Issues: | | +--------------------+------------------------------------------------+
## A.1.2 Outgoing call with Tariff provided by a remote network (PSTN or IMS)
or a 3^rd^ party service provider (AS) at the start of the call
+--------------------+------------------------------------------------+ | Actors: | Alan and Brendan are telecoms subscribers. | | | Alan is an IMS subscriber with AoC service(s). | +--------------------+------------------------------------------------+ | Description: | Tariff information is provided to Alan at the | | | start of the call. | +--------------------+------------------------------------------------+ | Preconditions: | AoC-related subscription status and user | | | profile for Alan are stored in the HSS. | +--------------------+------------------------------------------------+ | Post conditions: | Alan is ready to proceed with his call after | | | receiving the tariff information applicable\ | | | (from the remote network or 3^rd^ party | | | service provider ) to the call. | +--------------------+------------------------------------------------+ | Normal Flow: | - Alan initiates an IMS session to call | | | Brendan | | | | | | - The tariff for the call is sent to Alan at | | | the beginning of the call | | | | | | - Alan receives the AoC Information on his | | | UE | +--------------------+------------------------------------------------+ | Alternative Flows: | | +--------------------+------------------------------------------------+ | Assumptions: | The tariff for this call is not available in | | | the charging domain (online or offline).\ | | | Tariff information can be transferred in | | | real-time from the remote network or\ | | | 3^rd^ party service provider. | +--------------------+------------------------------------------------+ | Notes and Issues: | | +--------------------+------------------------------------------------+
## A.1.3 Outgoing call with Tariff provided by the charging domain in addition
to an add-on charge received from the remote network (PSTN or IMS) or from a
3^rd^ party service provider (AS)
+--------------------+------------------------------------------------+ | Actors: | Alan and Brendan are telecoms subscribers. | | | Alan is an IMS subscriber with AoC service(s). | +--------------------+------------------------------------------------+ | Description: | Tariff information incorporating an add-on | | | charge from an external source is provided to | | | Alan at the start/during of the call. | +--------------------+------------------------------------------------+ | Preconditions: | AoC-related subscription status and user | | | profile for Alan are stored in the HSS. | +--------------------+------------------------------------------------+ | Post conditions: | Alan is ready to proceed/continue with his | | | call after receiving the tariff information | | | applicable to the call. | +--------------------+------------------------------------------------+ | Normal Flow: | - Alan initiates an IMS session to call | | | Brendan | | | | | | - The tariff for the call is sent to Alan at | | | the beginning of the call | | | | | | - Alan receives the AoC Information on his | | | UE including the add-on charge from the | | | remote network (PSTN or IMS) or from a | | | 3^rd^ party service provider. | +--------------------+------------------------------------------------+ | Alternative Flows: | - An IMS session between Alan and Brendan is | | | proceeding | | | | | | - The tariff for the call is sent to Alan | | | during the call | | | | | | - Alan receives the AoC Information on his | | | UE including the add-on charge from the | | | remote network (PSTN or IMS) or from a | | | 3^rd^ party service provider. | +--------------------+------------------------------------------------+ | Assumptions: | The charging domain (online or offline) has | | | the tariff for this call. Add-on charges can | | | be transferred in real-time for the remote | | | network or 3^rd^ party service provider. | +--------------------+------------------------------------------------+ | Notes and Issues: | | +--------------------+------------------------------------------------+
## A.1.4 Outgoing call with Tariff change provided by the charging domain
during an on-going call
+--------------------+------------------------------------------------+ | Actors: | Alan and Brendan are telecoms subscribers. | | | Alan is an IMS subscriber with AoC service(s). | +--------------------+------------------------------------------------+ | Description: | Tariff information is provided to Alan when | | | there is a tariff switch during a call. | +--------------------+------------------------------------------------+ | Preconditions: | AoC-related subscription status and user | | | profile for Alan are stored in the HSS. | | | | | | There is an on-going call between Alan and | | | Brendan. | +--------------------+------------------------------------------------+ | Post conditions: | Alan is ready to continue his call with | | | Brendan after receiving the updated tariff | | | information that is now applicable to the | | | call. | +--------------------+------------------------------------------------+ | Normal Flow: | - Alan initiates an IMS session to call | | | Brendan. | | | | | | - A tariff switch relevant to this call | | | occurs. | | | | | | - The new tariff for the call is sent to | | | Alan. | | | | | | - Alan receives the updated tariff | | | information on his UE. | +--------------------+------------------------------------------------+ | Alternative Flows: | | +--------------------+------------------------------------------------+ | Assumptions: | The charging domain (online or offline) has | | | the tariff for this call. | +--------------------+------------------------------------------------+ | Notes and Issues: | | +--------------------+------------------------------------------------+
## A.1.5 Outgoing call with regular Cost updates provided by the charging
domain during an on-going call
+--------------------+------------------------------------------------+ | Actors: | Alan and Brendan are telecoms subscribers. | | | Alan is an IMS subscriber with AoC service(s). | +--------------------+------------------------------------------------+ | Description: | Cost information is provided to Alan at | | | regulated periods during a call. | +--------------------+------------------------------------------------+ | Preconditions: | AoC-related subscription status and user | | | profile for Alan are stored in the HSS. | | | | | | There is an on-going call between Alan and | | | Brendan. | +--------------------+------------------------------------------------+ | Post conditions: | Alan is ready to continue his call with | | | Brendan after receiving the accumulated cost | | | information that is now applicable to the | | | on-going call. | +--------------------+------------------------------------------------+ | Normal Flow: | - Alan initiates an IMS session to call | | | Brendan. | | | | | | - The duration of the call exceeds a | | | predefined marker. | | | | | | - The accumulated cost for the call to date | | | is sent to Alan. | | | | | | - Alan receives the updated cost information | | | on his UE. | +--------------------+------------------------------------------------+ | Alternative Flows: | | +--------------------+------------------------------------------------+ | Assumptions: | The charging domain can determine the | | | accumulated costs for this call in real-time. | +--------------------+------------------------------------------------+ | Notes and Issues: | | +--------------------+------------------------------------------------+
## A.1.6 Outgoing call with Cost summary provided at the end of the call
+--------------------+------------------------------------------------+ | Actors: | Alan and Brendan are telecoms subscribers. | | | Alan is an IMS subscriber with AoC service(s). | +--------------------+------------------------------------------------+ | Description: | Cost information is provided to Alan at the | | | end of a call. | +--------------------+------------------------------------------------+ | Preconditions: | AoC-related subscription status and user | | | profile for Alan are stored in the HSS. | | | | | | There is an on-going call between Alan and | | | Brendan. | +--------------------+------------------------------------------------+ | Post conditions: | Alan has completed his call with Brendan and | | | receives the accumulated cost information that | | | is now applicable to the preceding call. | +--------------------+------------------------------------------------+ | Normal Flow: | - Alan terminates an IMS session for a call | | | to Brendan. | | | | | | - The accumulated costs for the call are | | | sent to Alan. | | | | | | - Alan receives the cost information on his | | | UE. | +--------------------+------------------------------------------------+ | Alternative Flows: | | +--------------------+------------------------------------------------+ | Assumptions: | The charging domain can determine the | | | accumulated costs for this call in real-time. | +--------------------+------------------------------------------------+ | Notes and Issues: | | +--------------------+------------------------------------------------+
## A.1.7 Incoming call with Tariff provided by the charging domain at the
start of the call
+--------------------+------------------------------------------------+ | Actors: | Alan and Brendan are telecoms subscribers. | | | Brendan is an IMS subscriber with AoC | | | service(s). | +--------------------+------------------------------------------------+ | Description: | Tariff information is provided to Brendan at | | | the start of the call. | +--------------------+------------------------------------------------+ | Preconditions: | AoC-related subscription status and user | | | profile for Brendan are stored in the HSS. | +--------------------+------------------------------------------------+ | Post conditions: | Brendan is ready to proceed with his call from | | | Alan after receiving the tariff information | | | applicable to the call. | +--------------------+------------------------------------------------+ | Normal Flow: | - Alan initiates an IMS session to call | | | Brendan | | | | | | - The tariff for the call is sent to Brendan | | | at the beginning of the call | | | | | | - Brendan receives the AoC Information on | | | his UE | +--------------------+------------------------------------------------+ | Alternative Flows: | | +--------------------+------------------------------------------------+ | Assumptions: | The charging domain (online or offline) has | | | the tariff for this call. There are business | | | rules that determine that Brendan is the | | | charged party for this call. | +--------------------+------------------------------------------------+ | Notes and Issues: | | +--------------------+------------------------------------------------+
###### ## Annex B (informative): Message flow for basic IMS session
establishment and interaction with online charging
This annex describes the basic IMS session establishment for a user registered
for AoC service(s) and the interaction with online charging when an AS or the
IMS GWF handles Debit Units operation.
Figure B.1 shows a basic IMS session establishment when an AS or the IMS GWF
controls online charging.
Figure B.1: Basic IMS session establishment for a user registered to AoC
service(s)\ (online case controlled by AS / IMS GWF)
\- Step 1: An initial SIP INVITE message is received in the S-CSCF.
\- Step 2: The S-CSCF forwards this request to the AoC function.
\- Step 3: The AoC function needs to request the tariff and or cost for this
session. An AoC Enquiry is sent to the OCS in a Debit Units Request message.
\- Step 4: The OCS sends back to the AoC function the information requested
(tariff/cost).
\- Step 5: The AoC Information is included by the ACF in a SIP 183 response.
\- Step 6: UE acknowledgement of the 183 response is received at the ACF.
\- Step 7: The SIP INVITE is forwarded to the S-CSCF.
\- Step 8: The S-CSCF forwards the SIP INVITE message to the IMS GWF/AS to
perform the online charging.
\- Step 9: The IMS GWF/AS reserves a credit for the session. A Debit Units
Request message is sent to the OCS. This Debit Units Request message is
composed of a unit reservation request.
\- Step 10: The OCS sends back to the IMS-GWF/AS a credit for the session.
\- Step 11: The INVITE message is forwarded by the IMS GWF/AS to the S-CSCF.
\- Step 12: The S-CSCF forwards the SIP INVITE message to the terminating
party.
The service logic (AS/IMS GWF) and the AoC function may be unified. Thus,
instead of sending two Debit Units Request messages (Debit Units Request [RSU]
and Debit Units Request[AoC Enquiry] messages) towards the OCS, a grouped
Debit Units Request message may be sent for performance reasons.
Figure B.2: Basic IMS session establishment for a user registered to AoC
service(s)\ (online case controlled by unified (IMS GWF/AS) and ACF)
\- Step 1: An initial SIP INVITE message is received in the S-CSCF.
\- Step 2: The S-CSCF forwards this request to the AoC function.
\- Step 3: The unified (IMS GWF or AS) and ACF generates a Debit Units Request
message containing both a credit request and an AoC enquiry.
\- Step 4: The OCS sends back to the unified (IMS GWF or AS) and ACF a
response to the credit authorization and AoC enquiry.
\- Step 5: The AoC Information is included by the unified (IMS GWF or AS) and
ACF in a SIP 183 response.
\- Step 6: UE acknowledgement of the 183 response is received at the unified
(IMS GWF or AS) and ACF.
\- Step 7: The SIP INVITE is forwarded to the S-CSCF.
\- Step 8: The S-CSCF forwards the SIP INVITE message to the terminating
party.
###### ## Annex C (informative): AoC Information mapping
# C.0 General
This annex provides informative mapping concepts between the AoC Information
to surrounding protocol formats.
# C.1 AoC Information mapping to CAI element
Herby is a conceptual mapping of the CAI Element to the AoC Information.
The mapping is done by using 3 Rate Elements:
Rate Element 1 -- Depicts the initial cost in the AoC
Rate Element 2 -- Depicts the time related AoC
Rate Element 3 -- Depicts the volume related AoC
Table C.1.1:
* * *
CAI parameter Mapping guidance e1 - Units per interval Cost_Value in a Rate
Element(2) with Unit-Type = TIME; e2 - Seconds/time interval Unit_Value in
Rate Element(2) e3 - Scaling Factor Scale_Factor e4 - Unit increment
Cost_Value in a Rate Element(1) with Unit-Type = TIME e5 - Units per data
interval Cost_Value in a Rate Element(3) with Unit-Type = TOTAL-OCTETS; e6 -
Segments/data interval Unit_Value in Rate Element(3) e7 - Initial secs/t
interval Unit_Threshold in Rate Element(1)
* * *
When a service is known to be provided by CAMEL, the AoC function shall use a
mapable construct of the AoC Information.
# C.2 AoC Information mapping to charging Information Elements
Herby is a conceptual mapping advising how to populate the charging
Information Element provided to the UE (as described in TS 24.647 [208] and
ETSI TS 183 043 [213] as explicitly mentioned in the table C.2.1 below) out of
the AoC Information.
Table C.2.1: AoC Information mapping
+----------------------------------+----------------------------------+ | Information Element | Mapping guidance | +----------------------------------+----------------------------------+ | Expressing Charging Rates | | +----------------------------------+----------------------------------+ | - Price per time unit | When only one Rate Element with | | | Unit Type = TIME exists | +----------------------------------+----------------------------------+ | - Free of charge | When only one Rate Element with | | | Unit Type = MONEY and Unit Value | | | = 0 exists | +----------------------------------+----------------------------------+ | - Flat rate | When only one Rate Element with | | | Unit Type = MONEY and Unit Value | | | > 0 exists | +----------------------------------+----------------------------------+ | - Not available | No Rate Elements provided | +----------------------------------+----------------------------------+ | Charged Items | | +----------------------------------+----------------------------------+ | - Basic communication | When the Rate Element contains | | | Charge Reason Code = Usage or no | | | Charge Reason Code is available. | | | | | | NOTE: If no other Charged Items | | | are applicable, Basic | | | Communication shall be used as | | | default value | +----------------------------------+----------------------------------+ | - Communication attempt | This parameter may be populated | | | when the Rate Element contains | | | Charge Reason Code = | | | Communication Attempt Charge | | | | | | NOTE: Alternatively, this | | | information may be mapped into | | | \"Operation of service\" (see | | | below). | +----------------------------------+----------------------------------+ | - Communication setup | This parameter may be populated | | | when the Rate Element contains | | | Charge Reason Code= Set Up | | | Charge | | | | | | NOTE: Alternatively, this | | | information may be mapped into | | | \"Operation of service\" (see | | | below). | +----------------------------------+----------------------------------+ | - Operation of service | This parameter may be populated | | | depending on Service specific | | | Information or when the Rate | | | Element contains Charge Reason | | | Code \<> Usage. | | | | | | NOTE: If this parameter is | | | populated depending on the | | | Charge Reason Code, | | | Communication Attempt and | | | Communication setup shall not be | | | used. | +----------------------------------+----------------------------------+ | - pes_aoc-s_phase_duration | The value of | | | Unit_Quota_Threshold is mapped | | | into pes_aoc-s_phase_duration | | | when the AoC Extended XML schema | | | is needed (see ETSI TS 183 043 | | | [213]) | +----------------------------------+----------------------------------+ | Recorded Charges | Accumulated cost in AoC Cost | | | Information | +----------------------------------+----------------------------------+ | NOTE 1: Other legacy Charging | | | Information Elements (e.g. | | | Special charging code, Special | | | charging arrangement and Billing | | | Identification) are not | | | supported in IMS. | | | | | | NOTE 2: In the case when the UNI | | | interface can\'t transfer the | | | incremental cost, then the user | | | part can calculate it by | | | deducting the previous | | | accumulated cost information | | | from the current accumulated | | | cost information. | | +----------------------------------+----------------------------------+
\'Additionally, the parameters in table C.2.2 are not supported by the Ro
interface but locally configurable by operators.
Table C.2.2: AoC Information mapping -- not supported
* * *
**Type of Charging** This parameter is part of the AoC UNI XML information
described in TS 24.647 [208]. **Granularity** This parameter is part of the
AoC UNI XML information described in TS 24.647 [208]. **Pes-transitioning
behaviour** This parameter is part of the AoC Extended XML schema described in
ETSI TS 183 043 [213].
* * *
# C.3 AoC Information mapping to NNI charging information
Herby is a conceptual mapping advising how to populate the incoming real time
tariff information (as described in TS 29.658 [209]) to the AoC Information
model.
Mapping concepts:
> \- Pulse based tariffs -- Pulse based tariffs are translated to AoC Tariff
> with no Currency Code (i.e. non-monetary format).
>
> \- Sub Tariff -- Each sub tariff is mapped as a new Rate Element
>
> \- Delay Until Start -- The ACF shall buffer the message and wait for the
> \'start\' signal.
NOTE: The Delay Until Start parameter in TS 29.658 [209] is not supported in
this release.
> \- An Add-on charge provides single additional Cost Information which does
> not change the current tariff. When an Add-on charge is received via RTTI,
> the add-on charge shall be considered in the resulting Cost Information
Table C3.1: Data fields mapping
+---------------------------+-----------------------------------------+ | Information Element | Mapping guidance | +---------------------------+-----------------------------------------+ | Currency | Currency_Code | +---------------------------+-----------------------------------------+ | Call attempt charge | Rate-Element with Unit_Type = MONEY, | | | This parameter may be populated when | | | Charge Reason Code = | | | CONNECTION_ATTEMPT_CHARGE. | +---------------------------+-----------------------------------------+ | Call setup charge | Rate-Element with Unit_Type = MONEY, | | | This parameter may be populated when | | | Charge Reason Code = | | | CONNECTION_SETUP_CHARGE. | +---------------------------+-----------------------------------------+ | Add On charge | Rate-Element with Charge Reason Code = | | | ADDON_CHARGE. | +---------------------------+-----------------------------------------+ | Communication charge | Rate-Element with Unit_Type = TIME. | +---------------------------+-----------------------------------------+ | Currency factor scale | Cost_Value in a Rate-Element with | | | Unit_Type = TIME. | +---------------------------+-----------------------------------------+ | > Currency factor | - Value Digits | +---------------------------+-----------------------------------------+ | > Currency scale | - Exponent | +---------------------------+-----------------------------------------+ | Charge unit time interval | Unit-Value in a Rate-Element with | | | Unit_Type = TIME. | | | | | | NOTE 1: this field is only used for | | | non-monetary format. | | | | | | NOTE 2: A 50ms step support may not be | | | supported in this release. | +---------------------------+-----------------------------------------+ | Tariff duration | Unit_Threshold in the Rate-Element as | | | above | +---------------------------+-----------------------------------------+ | Sub tariff control | Periodic charge is mapped to | | | Rate-Element with no Unit_Threshold or | | | Unit_Threshold > Unit_Value. One | | | time charge is mapped to Rate-element | | | with Unit_Value = Unit_Threshold | +---------------------------+-----------------------------------------+ | Tariff switchover time | Tariff_Switch_Time | +---------------------------+-----------------------------------------+
###### ## Annex D (informative): Bibliography
**a) The 3GPP charging specifications**
\- 3GPP TS 32.250: \"Telecommunication management; Charging management;
Circuit Switched (CS) domain charging\".
\- 3GPP TS 32.251: \"Telecommunication management; Charging management; Packet
Switched (PS) domain charging\".
\- 3GPP TS 32.270: \"Telecommunication management; Charging management;
Multimedia Messaging Service (MMS) charging\".
\- 3GPP TS 32.271: \"Telecommunication management; Charging management;
Location Services (LCS) charging\".
\- 3GPP TS 32.272: \"Telecommunication management; Charging management; Push-
to-talk over Cellular (PoC) charging\".
\- 3GPP TS 32.273: \"Telecommunication management; Charging management;
Multimedia Broadcast and Multicast Service (MBMS) charging\".
\- 3GPP TS 32.274: \"Telecommunication management; Charging management; Short
Message Service (SMS) charging\".
\- 3GPP TS 32.275: \"Telecommunication management; Charging management;
MultiMedia Telephony (MMTel) charging\".
\- 3GPP TS 32.276: \"Telecommunication management; Charging management; Voice
Call Service Charging\".
\- 3GPP TS 32.298: \"Telecommunication management; Charging management;
Charging Data Record (CDR) parameter description\".
\- 3GPP TS 32.297: \"Telecommunication management; Charging management;
Charging Data Record (CDR) file format and transfer\".
\- 3GPP TS 32.296: \"Telecommunication management; Charging management; Online
Charging System (OCS) applications and interfaces\".
\- 3GPP TS 32.295: \"Telecommunication management; Charging management;
Charging Data Record (CDR) transfer\".
\- 3GPP TS 32.293: \"Telecommunication management; Charging management; Proxy
Function\".
**b) Common 3GPP specifications**
\- 3GPP TS 22.101: \"Service aspects; Service Principles\".
\- 3GPP TS 22.115: \"Service aspects; Charging and Billing\".
\- 3GPP TS 23.003: \"Numbering, addressing and identification\".
\- 3GPP TS 27.001: \"General on Terminal Adaptation Functions (TAF) for Mobile
Stations (MS)\".
**c) other Domain and Service specific 3GPP / ETSI specifications**
-
**d) Relevant ITU Recommendations**
\- ITU-T Recommendation D.93: \"Charging and accounting in the international
land mobile telephone service (provided via cellular radio systems)\".
\- ITU-T Recommendation E.164: \"The international public telecommunication
numbering plan\".
\- ITU-T Recommendation Q.767: \"Application of the ISDN user part of CCITT
signalling System No.7 for international ISDN interconnections\".
\- ITU-T Recommendation X.25: \"Interface between Data Terminal Equipment
(DTE) and Data Circuit-terminating Equipment (DCE) for terminals operating in
the packet mode and connected to public data networks by dedicated circuit\".
\- ITU-T Recommendation X.121: \"International numbering plan for public data
networks\".
**e) Relevant IETF RFCs**
\- IETF RFC 959 (1985): \"File Transfer Protocol\".
#
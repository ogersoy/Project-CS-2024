# Foreword
This Technical Report has been produced by the 3^rd^ Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The objective of this study item is to document missing elements and
information with regard to the roaming architecture for Voice over IMS with
Local Breakout.
The present document collects and evaluates end-to-end roaming scenarios under
different aspects of charging. The main scenarios presented will include
mobile originating calls with and without the use of the loopback mechanism
and mobile terminating call scenarios.
It will analyse operator requirements in consideration of the roaming
scenarios and the existing Charging specifications
The conclusions are presented in a further clause with assumptions made and
proposed further proceedings on that issues.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TS 32.240: \"Telecommunication management; Charging management;
Charging Architecture and Principles\".
[2] - [9] Void.
[10] 3GPP TS 32.250: \"Telecommunication management; Charging management;
Circuit Switched (CS) domain charging\".
[11] 3GPP TS 32.251: \"Telecommunication management; Charging management;
Packet Switched (PS) domain charging\".
[12] - [19] Void.
[20] 3GPP TS 32.260: \"Telecommunication management; Charging management; IP
Multimedia Subsystem (IMS) charging\".
[21] - [29] Void.
[30] 3GPP TS 32.270: \"Telecommunication management; Charging management;
Multimedia Messaging Service (MMS) charging\".
[31] - [49] Void.
[50] 3GPP TS 32.299: \"Telecommunication management; Charging management;
Diameter charging application\".
[51] 3GPP TS 32.298: \"Telecommunication management; Charging management;
Charging Data Record (CDR) parameter description\".
[52] - [99] Void.
[100] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[101] - [103] Void
[104] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[105] Void
[106] 3GPP TS 24.229: \"IP multimedia call control protocol based on Session
Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".
[107] 3GPP TS 23.228: \"IP multimedia subsystem; Stage 2\".
[108] - [212] Void.
[213] 3GPP TS 29.212: \"Policy and Charging Control (PCC); Reference points\".
[214] 3GPP TS 29.214: \"Policy and Charging Control over Rx reference point\".
[215] 3GPP TS 29.079: \"Optimal media routeing within the IP Multimedia
Subsystem (IMS); Stage 3\".
[216] 3GPP TS 29.165: \"Inter-IMS Network to Network Interface (NNI)\"
[217] 3GPP TR 29.949: \"Study on technical aspects on roaming end-to-end
scenarios with Voice over LTE (VoLTE) IP Multimedia Subsystem (IMS) and other
networks\".
[218] 3GPP TS 24.237: \"IP Multimedia (IM) Core Network (CN) subsystem IP
Multimedia Subsystem (IMS) service continuity; Stage 3\".
[219] - [399] Void.
[400] - [402] Void.
[403] IETF RFC 7315 (July 2014): \"Private Header (P-Header) Extensions to the
Session Initiation Protocol (SIP) for the 3rd-Generation Partnership Project
(3GPP)\".
[404] IETF RFC 3261 (June 2002): \"SIP: Session Initiation Protocol\".
[405] Void
[406] IETF RFC 3966: \"The tel URI for Telephone Numbers\".
[407] IETF RFC 3264: \"An Offer/Answer Model with Session Description Protocol
(SDP)\".
[408] Void
[409] draft-holmberg-dispatch-iotl-06.txt: \"3rd-Generation Partnership
Project (3GPP) SIP URI Inter Operator Traffic Leg parameter\".
[410] IETF RFC 3262 (June 2002): \"Reliability of provisional responses in
Session Initiation Protocol (SIP)\".
[411] IETF RFC 3312 (October 2002): \"Integration of resource management and
Session Initiation Protocol (SIP)\".
[412] - [499] Void.
[500] - [599] Void.
[600] GSMA PRD IR.65 -- IMS Roaming and Interworking Guidelines.
[601] GSMA TD.57 - TAP3.12 Format Specification.
[602] GSMA TD.58 - TAP3.12 Implementation Handbook.
[603] GSMA IR.88: \"LTE Roaming Guidelines\".
[604] GSMA IR.92: \"IMS Profile for Voice and SMS\".
[605] - [699] Void.
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [100] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in TR
21.905 [100].
**chargeable event:** activity utilizing telecommunication network resources
and related services for:
\- user to user communication (e.g. a single call, a data communication
session or a short message); or
\- user to network communication (e.g. service profile administration); or
\- inter-network communication (e.g. transferring calls, signalling, or short
messages); or
\- mobility (e.g. roaming or inter-system handover); and
\- that the network operator may want to charge for.
As a minimum, a chargeable event characterizes the resource / service usage
and indicates the identity of the involved end user(s).
**charged party:** user involved in a chargeable event who has to pay parts or
the whole charges of the chargeable event, or a third party paying the charges
caused by one or all users involved in the chargeable event, or a network
operator.
**charging:** function within the telecommunications network and the
associated OCS/BD components whereby information related to a chargeable event
is collected, formatted, transferred and evaluated in order to make it
possible to determine usage for which the charged party may be billed (offline
charging) or the subscriber\'s account balance may be debited (online
charging).
**charging event:** set of charging information forwarded by the CTF towards
the CDF (offline charging) or towards the OCS (online charging). Each charging
event matches exactly one chargeable event.
**charging function:** entity inside the core network domain, subsystem or
service that is involved in charging for that domain, subsystem or service.
**credit control:** mechanism which directly interacts in real-time with an
account and controls or monitors the charges, related to the service usage.
Credit control is a process of: checking if credit is available, credit
reservation, deduction of credit from the end user account when service is
completed and refunding of reserved credit not used.
**domain:** part of a communication network that provides network resources
using a certain bearer technology.
**\"middle tier\" (charging) TS:** term used for the 3GPP charging TSs that
specify the domain / subsystem / service specific, online and offline,
charging functionality. These are all the TSs in the numbering range from TS
32.250 to TS 32.279, e.g. TS 32.250 [10] for the CS domain, or TS 32.270 [30]
for the MMS service. Currently, there is only one \"tier 1\" TS in 3GPP, which
is TS 32.240 [1] that specifies the charging architecture and principles.
Finally, there are a number of top tier TSs in the 32.29x numbering range
([50] ff) that specify common charging aspects such as parameter definitions,
encoding rules, the common billing domain interface or common charging
applications.
**online charging:** charging mechanism where charging information **can**
affect, in real-time, the service rendered and therefore a direct interaction
of the charging mechanism with bearer/session/service control is required.
**Online Charging System:** the entity that performs real-time credit control.
Its functionality includes transaction handling, rating, online correlation
and management of subscriber account balances.
**real-time:** real-time charging and billing information is to be generated,
processed, and transported to a desired conclusion in less than 1 second.
**successful call:** connection that reaches the communication or data
transfer phase e.g. the \"answered\" state for speech connections. All other
connection attempts are regarded as unsuccessful.
**voice call:** any Circuit-switched call, whatever the teleservice used
(speech, 3.1 kHz audio, Fax, or CS data) except circuit-switched Video
Telephony calls (BS 37, 64 kbit/s unrestricted digital info mode). Voice over
LTE is not included in this definition.
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
kbit/s Kilobits per second. 1 kbit/s = 210 bits per second.
Mbit/s Megabits per second. 1 Mbit/s = 220 bits per second.
Ro Online charging reference point between a Proxy Function and the OCS.
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[100] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [100].
3G 3rd Generation
3GPP 3^rd^ Generation Partnership Project
CS Circuit Switched
CTF Charging Trigger Function
GSM Global System for Mobile communication
HPLMN Home PLMN
IMEI International Mobile Equipment Identity
IMSI International Mobile Subscriber Identity
IOTL Inter Operator Traffic Leg parameter
ISDN Integrated Services Digital Network
ITU-T International Telecommunication Union - Telecommunications
standardization sector
LCS LoCation Service
MCC Mobile Country Code (part of IMSI)
MNC Mobile Network Code (part of IMSI)
MO Mobile Originated
MOC Mobile Originated Call (attempt)
MS Mobile Station
MSC Mobile services Switching Centre
MSISDN Mobile Station ISDN number
MT Mobile Terminated
MTC Mobile Terminated Call (attempt)
NE Network Element
OCS Online Charging System
PLMN Public Land Mobile Network
PSTN Public Switched Telephony Network
SSF Service Switching Function
TAP Transferred Account Procedure
THIG Topology Hiding Inter-network Gateway
TrGW Transition Gateway
UMTS Universal Mobile Telecommunications System
VCC Voice Call Continuity
VoLTE Voice over LTE
VPLMN Visited PLMN
# 4 Overview
## 4.1 General
This clause describes the requirements for the charging of IMS (VoLTE)
subscribers which are roaming in foreign networks.
With introducing Roaming with loopback in 3GPP IMS the set of charging
specifications TS 32.260 [20], TS 32.298 [51] and TS 32.299 [50] was updated
to cover the additional requirements raised with that work.
Currently we have tool set describing where CDRs are generated to provide a
tool set to fulfil the requirements of the operators which are described in
sub clause 4.2.
Within the present document these requirements will be validated based on
specific roaming scenarios against the existing charging specifications if
they are completely fulfilled.
## 4.2 General Charging Concept
In general, it is assumed that the fundamental principles for charging and
accounting in case of a VoLTE subscriber roaming in foreign network shall be
identical to those that are currently used for GSM/3G roaming.
This is also required in GSMA document GSMA PDR IR.65 [600] indicate: That
\"The charging model for roaming used in CS domain shall be maintained in
VoIMS.\"
From operator\'s point of view, these principles for this include:
\- The roaming subscriber only has a contract with his home network operator
(HPLMN).
\- The roaming subscriber is only charged by his HPLMN operator.
\- \"zonal charging\" (i.e. charging dependent on the distance between call
origin and call destination, \"charge distance\") shall be supported.
\- In MTC scenarios, the called roaming subscriber may be charged for the
terminating leg from HPLMN to VPLMN.
\- Information given within CDRs should allow to calculate the accounting fees
between HPLMN and VPLMN.
\- Inter-connection fees between PLMNs and IC providers are dependent on the
direct interconnection (and on the remaining charge distance).
\- There are roaming charges which should be calculated by the information
given in the CDRs collected.
\- The VPLMN charges the HPLMN for the access of the user.
From operator\'s point of view there is the requirement to have a charging
solution where an optimal use of existing resources, best reliability and
stability is given.
## 4.3 Inter Operator Identifier
### 4.3.1 Type of IOI\'s
TS 32.240 [1] subclause 5.3.4.3 describes the \"Inter-network correlation\".
It introduces the Inter Operator Identification concept (IOI) to enable the
different operators involved in IMS sessions to identify each other.
The IOI concept in TS 32.240 [1] defines the requirement for the handling of
IOI\'s for charging purposes. For this study the following requirements are
important:
\- The IOI concept shall allow operators to uniquely identify each other for
the SIP based requests.
\- It shall be possible to apply the IOI concept on a peer to peer basis
between operators.
\- IOI identities shall be included within SIP signalling where TS 24.229
[106] is describing the signalling procedures for the inclusion of the IOI\'s:
\- When a SIP request is sent out of an IMS network the originating ioi is
included.
\- When a SIP response is returned from an IMS network the terminating ioi is
included.
\- In transit cases transit ioi\'s may be included per transit network. It
should be noted that transit operators can be selected independently for each
SIP method and direction of request.
TS 32.240 [1] defines three types of IOI\'s:
1) Type 1 IOI: between the Home PLMN and a Visited PLMN for an end user in
roaming situation (case when the P-CSCF is located in a visited network). The
network element providing the originating or the terminating Type 1 IOI,
change according to the type of end user and the signalling leg to be
considered.
\- When considering the originating end user, and the signalling leg between
its VPLMN and its HPLMN:
\- P-CSCF is generating the originating IOI;
\- S-CSCF is generating the terminating IOI;
\- enhanced MSC for ISC is generating the originating IOI;
\- When considering the originating end user, and the signalling loopback leg
between its HPLMN and its VPLMN
\- S-CSCF (or BGCF) is generating the originating IOI; and
NOTE 1: TS 24.229 [106] is defining the BGCF case while TS 32.240 [1] not.
\- TRF is generating the terminating IOI.
\- When considering the terminating end user, and the signalling leg between
its VPLMN and its HPLMN:
\- S-CSCF is generating the originating IOI;
\- P-CSCF is generating the terminating IOI;
\- enhanced MSC for ISC is generating the terminating IOI.
2) Type 2 IOI: between the IMS network operator which holds the subscription
of the originating end user and the IMS network operator which holds the
subscription of the terminating end user. For the roaming case with local
breakout Type 2 IOI are used between A\'s Visited PLMN and B\'s Home PLMN:
\- S-CSCF is generating the originating IOI between the originating home
S-CSCF and the terminating home S-CSCF;
\- between the S-CSCF s generating the terminating IOI and the MGCF when a
call/session is terminated at the PSTN/PLMN;
\- between the E-CSCF and the S-CSCF or the IBCF when receiving an emergency
request;
\- MGCF and the S-CSCF is generating the terminating IOI of the home
terminating network when a call/session is originated from the PSTN/PLMN;
NOTE 2: This includes all scenarios with a PSI AS when accessed across I-CSCF;
\- the TRF is generating the originating IOI towards the S-CSCF;
\- the S-CSCF is generating the terminating IOI towards the TRF;
\- MGCF is generating the originating;
\- E-CSCF is generating the originating IOI towards the MGCF or the IBCF where
the request is routed to a PSAP; and
3) Type 3 IOI: between the home IMS network operator and a service provider:
\- The S-CSCF or the I-CSCF is generating the originating IOI of the home
operator network towards any AS; and
\- the AS is generating the terminating IOI towards the S-CSCF and I-CSCF;
\- the AS is generating a originating IOI when initiating a request, and the
S-CSCF and I-CSCF generating the terminating IOI towards the AS;
\- LRF initiates a request to the E-CSCF, the LRF is responsible for
generating the originating IOI; and
\- E-CSCF to the LRF, the E-CSCF is responsible for generating the terminating
IOI;
\- E-CSCF forwards a request to the EATF or to the LRF, the E-CSCF is
responsible for generating the originating IOI;
\- EATF and LRF are responsible for generating the terminating IOI.
### 4.3.2 Format of IOI\'s
According to TS 32.240 [1] subclause 5.3.4.3 defines the requirements for
IOI\'s. The SIP entity generating type 1 and type 3 IOI values express the
\"orig-ioi\" and \"term-ioi\" header field parameters in the format of a
quoted string as specified in IETF draft-drage-sipping-rfc3455bis-13 [403]
with a specific string prefix being \"Type 1\" and \"Type 3\" respectively to
indicate the type of IOI. For the type 2 IOI, no string prefix is used. The
receiving SIP entity does not perform syntactic checking of the contents of
the IOI parameter (the IOI parameter is passed unmodified to charging
entities).
TS 32.240 [1]does not mandate the Type 1 and Type 2 prefixes to \"orig-ioi\"
and \"term-ioi\" header field parameters. The assumption is that also transit-
ioi will apply to these Types. A specific ruling is currently not defined.
Editor\'s note: The use of Type 1 and Type 2 for \"transit-ioi\" has to be
verified or corrected within TS 32.240 [1]. The above described procedure is
not really clear. The type definitions are only referring to originating and
terminating ioi.
The following table shows some examples how to format IOI\'s.
Table 4.3.2.1. Examples for the format of IOI\'s
* * *
Type of IOI Example Type 1 Type 1visited_A.net\" Type 2 \"home_A.net\" Type 3
\"Type 3home_A.net\"
* * *
### 4.3.3 Basic IMS roaming scenario without loopback
Within this basic approach 3 traversal scenarios exist which are shown in
table 4.3.3.1.
Table 4.3.3.1: Traversal scenarios for \"Basic IMS roaming scenario without
loopback\"
* * *
Traversal scenario Type of IOI Originating visited network -- Originating home
network Type 1 Originating home network -- Terminating home network Type 2
Terminating home network -- Terminating visited network Type 1
* * *
Figure 4.3.3.1: IOI information exchange for the \"Basic IMS\" roaming case
with home routing of media
In order to meet the requirements of TS 32.240 [1] there needs to be an IOI
exchange including originating IOI, transit IOIs, and terminating IOI for each
of the three signalling paths crossing network boundaries.
Table 4.3.3.2: Setting of Orig-IOI in a SIP request for basic IMS Roaming case
+-------------+-------------+-------------+-------------+-------------+ | Sending | Type of IOI | Request | Type of IOI | Request | | Entity | | | | | | | | receiving | | sending | +-------------+-------------+-------------+-------------+-------------+ | P-CSCF | | not | Type 1 | Type | | Visited A | | received | | 1visited-a | | | | from UE | | | +-------------+-------------+-------------+-------------+-------------+ | IPX Proxy | Type 1 | Type | Type 1 | Type | | (VA-HA) | | 1visited-a | | 1visited-a | +-------------+-------------+-------------+-------------+-------------+ | S-CSCF Home | Type 1 | Type | Type 2 | home-a | | A | | 1visited-a | | | +-------------+-------------+-------------+-------------+-------------+ | IPX Proxy | Type 2 | home-a | Type 2 | home-a | | (HA-HB) | | | | | +-------------+-------------+-------------+-------------+-------------+ | S-CSCF Home | Type 2 | home-a | Type 1 | Type | | B | | | | 1home-b | +-------------+-------------+-------------+-------------+-------------+ | IPX Proxy | Type 1 | Type | Type 1 | Type | | (HB-VB) | | 1home-b | | 1home-b | +-------------+-------------+-------------+-------------+-------------+ | P-CSCF | Type 1 | Type | | not sent to | | Visited B | | 1home-b | | UE | +-------------+-------------+-------------+-------------+-------------+
Table 4.3.3.3: Setting of Orig-IOI in a SIP response for basic IMS Roaming
case
+-------------+-------------+-------------+-------------+-------------+ | Sending | Type of IOI | Response | Type of IOI | Response | | Entity | | receiving | | | | | | | | sending | +-------------+-------------+-------------+-------------+-------------+ | P-CSCF | | not | Type 1 | Type | | Visited B | | received | | 1home-b | | | | from UE | | | | | | | | (received | | | | | | orig-ioi) | +-------------+-------------+-------------+-------------+-------------+ | IPX Proxy | Type 1 | Type | Type 1 | Type | | (VB-HB) | | 1home-b | | 1home-b | +-------------+-------------+-------------+-------------+-------------+ | S-CSCF Home | Type 1 | Type | Type 2 | home-a | | B | | 1home-b | | | | | | | | (stored and | | | | | | in INVITE | | | | | | received | | | | | | orig-ioi) | +-------------+-------------+-------------+-------------+-------------+ | IPX Proxy | Type 2 | home-a | Type 2 | home-a | | (HB-HA) | | | | | +-------------+-------------+-------------+-------------+-------------+ | S-CSCF Home | Type 2 | home-a | Type 1 | Type | | A | | | | 1visited-a | | | | | | | | | | | | (stored and | | | | | | in INVITE | | | | | | received | | | | | | orig-ioi) | +-------------+-------------+-------------+-------------+-------------+ | IPX Proxy | Type 1 | Type | Type 1 | Type | | (HA-VA) | | 1visited-a | | 1visited-a | +-------------+-------------+-------------+-------------+-------------+ | P-CSCF | Type 1 | Type | | not sent to | | Visited A | | 1visited-a | | UE | +-------------+-------------+-------------+-------------+-------------+
Table 4.3.3.4: Setting of Term-ioi in a SIP response for basic IMS Roaming
case
* * *
Sending Entity Type of IOI Response receiving Type of IOI Response sending
P-CSCF Visited B not received from UE Type 1 Type 1visited-b IPX Proxy (VB-HB)
Type 1 Type 1visited-b Type 1 Type 1visited-b S-CSCF Home B Type 1 Type
1visited-b Type 2 home-b IPX Proxy (HB-HA) Type 2 home-b Type 2 home-b S-CSCF
Home A Type 2 home-b Type 1 Type 1home-a IPX Proxy (HA-VA) Type 1 Type 1home-a
Type 1 Type 1home-a P-CSCF Visited A Type 1 Type 1home-a not sent to UE
* * *
Table 4.3.3.5: Setting of Transit-ioi in a SIP\ request for basic IMS Roaming
case
+-------------------+-----------+---------+ | Sending Entity | Request | Request | | | | | | | receiving | sending | +-------------------+-----------+---------+ | P-CSCF Visited A | N/A | N/A | +-------------------+-----------+---------+ | IPX Proxy (VA-HB) | N/A | IPXA | +-------------------+-----------+---------+ | S-CSCF Home A | IPXA | N/A | +-------------------+-----------+---------+ | IPX Proxy (HA-HB) | N/A | IPXAB | +-------------------+-----------+---------+ | S-CSCF Home B | IPXAB | N/A | +-------------------+-----------+---------+ | IPX Proxy (HB-VB) | N/A | IPXB | +-------------------+-----------+---------+ | P-CSCF Visited B | IPXB | N/A | +-------------------+-----------+---------+
Table 4.3.3.6: Setting of Transit-ioi in a SIP\ response for basic IMS Roaming
case
+-------------------+-----------+---------+ | Sending Entity | Request | Request | | | | | | | receiving | sending | +-------------------+-----------+---------+ | P-CSCF Visited B | N/A | N/A | +-------------------+-----------+---------+ | IPX Proxy (VB-HB) | N/A | IPXB | +-------------------+-----------+---------+ | S-CSCF Home B | IPXB | N/A | +-------------------+-----------+---------+ | IPX Proxy (HB-HA) | N/A | IPXAB | +-------------------+-----------+---------+ | S-CSCF Home A | IPXAB | N/A | +-------------------+-----------+---------+ | IPX Proxy (HA-VA) | N/A | IPXA | +-------------------+-----------+---------+ | P-CSCF Visited A | IPXA | N/A | +-------------------+-----------+---------+
### 4.3.4 VPLMN routing IMS roaming scenario with loopback
Within the loopback approach 4 traversal scenarios exist which are shown in
table 4.3.4.1.
Table 4.3.4.1: Traversal scenarios for \"VPLMN routing\ IMS roaming scenario
with loopback\"
* * *
Traversal scenario Type of IOI Originating visited network -- Originating home
network Type 1 Originating home network -- Originating visited network Type 1
Originating visited network -- Terminating home network Type 2 Terminating
home network -- Terminating visited network Type 1
* * *
For roaming with loopback the \"VPLMN routing\" introduces the case where the
SIP signalling and media is routed from the VPLMN to the destination and where
the SIP signalling is first routed to the HPLMN for service execution and then
back to the VPLM to allow the VPLMN to route both sip signalling and media to
the destination.
The complete sequence of IOI exchanges for the IMS roaming scenario with VPLMN
routing option is depicted in Figure 4.3.4.1.
Figure 4.3.4.1: IOI exchange for IMS roaming with VPLMN routing
In order to meet the requirements of TS 32.240 [1] there needs to be an IOI
exchange including originating IOI, transit IOIs, and terminating IOI there
are four signalling paths crossing network boundaries.
Table 4.3.4.2: Setting of Orig-IOI in a SIP request for VPLMN loopback
+-------------+-------------+-------------+-------------+-------------+ | Sending | Type of IOI | Request | Type of IOI | Request | | Entity | | | | | | | | receiving | | sending | +-------------+-------------+-------------+-------------+-------------+ | P-CSCF | | not | Type 1 | Type | | Visited A | | received | | 1visited-a | | | | from UE | | | +-------------+-------------+-------------+-------------+-------------+ | IPX Proxy | Type 1 | Type | Type 1 | Type | | (VA-HA) | | 1visited-a | | 1visited-a | +-------------+-------------+-------------+-------------+-------------+ | S-CSCF Home | Type 1 | Type | Type 1 | Type | | A | | 1visited-a | | 1home-a | +-------------+-------------+-------------+-------------+-------------+ | IPX Proxy | Type 1 | Type | Type 1 | Type | | (HA-VA) | | 1home-a | | 1home-a | +-------------+-------------+-------------+-------------+-------------+ | TRF Visited | Type 1 | Type | Type 2 | visited-a | | A | | 1home-a | | | +-------------+-------------+-------------+-------------+-------------+ | IPX Proxy | Type 2 | visited-a | Type 2 | visited-a | | (VA-HB) | | | | | +-------------+-------------+-------------+-------------+-------------+ | S-CSCF Home | Type 2 | visited-a | Type 1 | Type | | B | | | | 1home-b | +-------------+-------------+-------------+-------------+-------------+ | IPX Proxy | Type 1 | Type | Type 1 | Type | | (HB-VB) | | 1home-b | | 1home-b | +-------------+-------------+-------------+-------------+-------------+ | P-CSCF | Type 1 | Type | | not sent to | | Visited B | | 1home-b | | UE | +-------------+-------------+-------------+-------------+-------------+
Table 4.3.4.3: Setting of Orig-IOI in SIP response for VPLMN loopback
+-------------+-------------+-------------+-------------+-------------+ | Sending | Type of IOI | Response | Type of IOI | Response | | Entity | | receiving | | | | | | | | sending | +-------------+-------------+-------------+-------------+-------------+ | P-CSCF | | not | Type 1 | Type | | Visited B | | received | | 1home-b | | | | from UE | | (received | | | | | | orig-ioi) | +-------------+-------------+-------------+-------------+-------------+ | IPX Proxy | Type 1 | Type | Type 1 | Type | | (VB-HB) | | 1home-b | | 1home-b | +-------------+-------------+-------------+-------------+-------------+ | S-CSCF Home | Type 1 | Type | Type 2 | visited-a | | B | | 1home-b | | (stored and | | | | | | in INVITE | | | | | | received | | | | | | orig-ioi) | +-------------+-------------+-------------+-------------+-------------+ | IPX Proxy | Type 2 | visited-a | Type 2 | visited-a | | (HB-VA) | | | | | +-------------+-------------+-------------+-------------+-------------+ | TRF Visited | Type 2 | visited-a | Type 1 | Type | | A | | | | 1home-a | | | | | | (stored and | | | | | | in INVITE | | | | | | received | | | | | | orig-ioi) | +-------------+-------------+-------------+-------------+-------------+ | IPX Proxy | Type 1 | Type | Type 1 | Type | | (VA-HA) | | 1home-a | | 1home-a | +-------------+-------------+-------------+-------------+-------------+ | S-CSCF Home | Type 1 | Type | Type 1 | Type | | A | | 1home-a | | 1visited-a | | | | | | (stored and | | | | | | in INVITE | | | | | | received | | | | | | orig-ioi) | +-------------+-------------+-------------+-------------+-------------+ | IPX Proxy | Type 1 | Type | Type 1 | Type | | (HA-VA) | | 1visited-a | | 1visited-a | +-------------+-------------+-------------+-------------+-------------+ | P-CSCF | Type 1 | Type | | not sent to | | Visited A | | 1visited-a | | UE | +-------------+-------------+-------------+-------------+-------------+
Table 4.3.4.4: Setting of Term-IOI in a SIP response from for VPLMN loopback
* * *
Sending Entity Type of IOI Response receiving Type of IOI Response sending
P-CSCF Visited B not received from UE Type 1 Type 1visited-b IPX Proxy (VB-HB)
Type 1 Type 1visited-b Type 1 Type 1visited-b S-CSCF Home B Type 1 Type
1visited-b Type 2 home-b IPX Proxy (HB-VA) Type 2 home-b Type 2 home-b TRF
Visited A Type 2 home-b Type 1 Type 1visited-a IPX Proxy (VA-HA) Type 1 Type
1visited-a Type 1 Type 1visited-a S-CSCF Home A Type 1 Type 1visited-a Type 1
Type 1home-a IPX Proxy (HA-VA) Type 1 Type 1home-a Type 1 Type 1home-a P-CSCF
Visited A Type 1 Type 1home-a N/A not sent to UE
* * *
Table 4.3.4.5: Setting of Transit-IOI in a SIP request for VPLMN loopback
+-------------------+-----------+---------+ | Sending Entity | Request | Request | | | | | | | receiving | sending | +-------------------+-----------+---------+ | P-CSCF Visited A | N/A | N/A | +-------------------+-----------+---------+ | IPX Proxy (VA-HA) | N/A | IPXA | +-------------------+-----------+---------+ | S-CSCF Home A | IPXA | N/A | +-------------------+-----------+---------+ | IPX Proxy (HA-VA) | N/A | IPXAB | +-------------------+-----------+---------+ | TRF Visited A | N/A | IPXAB | +-------------------+-----------+---------+ | IPX Proxy (VA-HB) | N/A | IPXAB | +-------------------+-----------+---------+ | S-CSCF Home B | IPXAB | N/A | +-------------------+-----------+---------+ | IPX Proxy (HB-VB) | N/A | IPXB | +-------------------+-----------+---------+
Table 4.3.4.6: Setting of Transit-ioi in a SIP response for VPLMN loopback
+-------------------+-----------+---------+ | Sending Entity | Request | Request | | | | | | | receiving | sending | +-------------------+-----------+---------+ | P-CSCF Visited B | N/A | N/A | +-------------------+-----------+---------+ | IPX Proxy (VB-HB) | N/A | IPXB | +-------------------+-----------+---------+ | S-CSCF Home B | IPXB | N/A | +-------------------+-----------+---------+ | IPX Proxy (HB-VA) | N/A | IPXBA | +-------------------+-----------+---------+ | TRF Visited A | IPXBA | N/A | +-------------------+-----------+---------+ | IPX Proxy (VA-HB) | N/A | IPXAB | +-------------------+-----------+---------+ | S-CSCF Home A | IPXAB | N/A | +-------------------+-----------+---------+ | IPX Proxy (HA-VA) | N/A | IPXA | +-------------------+-----------+---------+ | P-CSCF Visited A | IPXA | N/A | +-------------------+-----------+---------+
### 4.3.5 Rules for Transit-IOI
TS 24.229 [106] describes that for transit networks based on local policy the
additional routeing function in the transit network adds in requests and in
responses the P-Charging-Vector header field a \"transit-ioi\" header field
parameter with an entry which identifies the operator network which the
request or response is transiting or with a void entry.
TS 32.260 [20] defines the Transit-IOI List which cold appear one or more
times within a CDR depending on the amount of transit networks passed.
When the index is calculated then \"void\" entries are taken into account.
Based on local policy the additional routeing function deletes or void in
requests and in responses in the P-Charging-Vector header field any received
\"transit-ioi\" header field parameter value.
Specific ruling may also apply to IBCF:
1\. IBCF acting as entry point:
\- Based on local policy, the IBCF acting as an entry point adds in requests
in the P-Charging-Vector header field a \"transit-ioi\" header field parameter
with an entry which identifies the operator network which the request is
transiting or with a void entry.
\- Based on local policy the IBCF deletes or void in requests in the
P-Charging-Vector header field any received \"transit-ioi\" header field
parameter value.
\- Only one \"transit-ioi\" header field parameter entry is added per transit
network.
2\. IBCF acting as exit point:
\- Based on local policy, the IBCF acting as an exit point adds in responses
in the P-Charging-Vector header field a \"transit-ioi\" header field parameter
with an entry which identifies the operator network which the response is
transiting or with a void entry.
\- Based on local policy the IBCF deletes or void in responses in the
P-Charging-Vector header field any received \"transit-ioi\" header field
parameter value.
The Transit-IOI will included in the Transit-IOI List as defined in TS 32.260
[20].
Considering figure 4.3.5.1 either the IBCF-entryA1 in combination with the
IBCF-exitA1 or the transit function (i.e. additional routing function as
defined within TS 24.229 [106]) can do the setting of the Transit-IOI. But
also due to TS 24.229 [106], subclause 4.5.4A, the transit function can
control if a transit-ioi will be deleted or voided.
Figure 4.3.5.1: IOI exchange for IMS roaming transit
> 1-2. The IBCF-entryA1 receives an SIP INVITE request containing the
> \"transit-ioi\" header field parameter in the P-Charging-Vector header field
> and sends the SIP INVITE request towards the transit function.
NOTE 1: If no \"transit-ioi\" header field parameter is included or if the
included \"transit-ioi\" header field parameter is missing a preceding
interconnection network and the preceding network is an interconnection
network, the IBCF-entryA1 can based on local policy, add the transit-ioi\"
header field parameter with an entry identifying the preceding interconnection
network.
> 3\. The transit function stores and removes the \"transit-ioi\" header field
> parameter from the P-Charging-Vector header field, adds the Relayed-Charge
> header field with the content received in the \"transit-ioi\" and forwards
> the SIP INVITE request to the AS.
>
> 4\. The AS stores the content of the Relayed-Charge header field and sends
> the SIP INVITE request to the transit function.
>
> 5\. The transit function removes the Relayed-Charge header field and
> includes the stored \"transit-ioi\" header field parameter in the
> P-Charging-Vector header field. The transit function also appends an entry
> in the \"transit-ioi\". Based on local policy, the appended entry can
> identify the interconnection network or be set to void. The SIP INVITE
> request is sent to the IBCF-exitT.
NOTE 2: Based on local policy, the transit function can also void entries in
the received \"transit-ioi\" header field parameter.
> 6\. The IBCF-exitA1forwards the INVITE to IBCF-entry B
>
> 7-8.. The final SIP Response 200 (OK) received from the IBCF-entry B with
> the P-Charging-Vector header field is forwarded by the IBCF-exitTto the
> transit function.
NOTE 3: If no \"transit-ioi\" header field parameter is included or if the
included \"transit-ioi\" header field parameter is missing a preceding
interconnection network and the preceding network is an interconnection
network, the IBCF-exitT can based on local policy, add the transit-ioi\"
header field parameter with an entry identifying the preceding interconnection
network.
> 9\. The transit function stores and removes the \"transit-ioi\" header field
> parameter from the P-Charging-Vector header field, adds the Relayed-Charge
> header field with the content received in the \"transit-ioi\" and forwards
> the SIP 200 (OK) response to the AS.
>
> 10\. The AS stores the content of the Relayed-Charge header field and sends
> the SIP 200 (OK) response to the transit function.
>
> 11..The transit function removes the Relayed-Charge header field and
> includes the stored \"transit-ioi\" header field parameter in the
> P-Charging-Vector header field. The transit function also appends an entry
> in the \"transit-ioi\". Based on local policy, the appended entry can
> identify the interconnection network or be set to void. The SIP 200 (OK)
> response is sent to the IBCF-entryT.
NOTE 4: Based on local policy, the transit function can also void entries in
the received \"transit-ioi\" header field parameter.
All elements may write CDR\'s as described within TS 32.260 [20]. The
\"Transit-IOI List\" will contain the values as described above. It the
transit network is the second in row. The transit-ioi will contain more than
one entry which is then reflected in the \"Transit-IOI List\".
## 4.4 Inter-level Charging Correlation
### 4.4.1 Definitions
As defined in TS 32.240 [1], inter-level charging correlation combines the
charging events belonging to the same service but generated by different CTFs,
e.g. for PS access control via IM Subsystem. Charging in the IMS domain is
identified by the IMS Charging Identifier (ICID). The ICID, defined as a
globally unique with the IMS network provides an association of the charging
information for the mobile subscriber\'s resource usage. Charging in the PS
domain is identified by the combination of the P-GW address and a Charging Id
that is unique within the P-GW.
For inter-level charging correlation to be possible, the PS domain Charging
Id\'s need to be available as part of the charging information in the IMS
domain and the ICID needs to be available as part of the charging information
in the PS domain.
### 4.4.2 Associating PS Domain Resources with an IMS Session
As per TS 29.214 [214], in order to correlate the associated application usage
of PS bearer level resources, an Application Function (AF), may provide an AF-
Charging-Identifier to the PCRF when authorizing PS domain resources. For IMS,
the AF is the P-CSCF and the identifier is the ICID.
As per TS 29.212 [213], when service identifier level reporting is performed
for a dynamic PCC rule initiated by an AF interaction, the PCRF includes the
AF-Charging-Identifier along with the flow identifiers (also provided by the
AF). The dynamic PCC rule may be installed for the default bearer, a
previously activated dedicated bearer, or a new dedicated bearer to be created
by the PCEF. When the AF provides flow descriptions requiring different QoS
levels, then dynamic PCC rules are generated that will be installed on
different bearers in order to provide the required QoS for each flow. In this
scenario, the same AF charging identifier will be present in multiple PCC
rules. In addition, when two (or more) different AF requests include flows
with the same QoS level, e.g., for call waiting, the associated dynamic PCC
rules will be installed on the same bearer. In this scenario, there will be
multiple AF charging identifiers associated with the shared bearer. If the PCC
rules include the same combination of rating group and service identity, the
reporting will combine the usage in the same information element. The AF
charging identifiers appear in association with the usage report. Note that
this usage report will also include measurement for matching rules with no AF
charging indenter specified.
In TS 32.251 [11], the PGW-CDR, defined for PS domain charging flow-based
charging, contains a list of service data containers. The service data
container, defined in TS 32.298 [51], contains the AF Charging Identifier
within the AF-Record-Information field. When unique Rating-Group and Service-
Identifier combinations are assigned for the bearer resources associated with
an IMS session, this definition provides the ability for the PS domain CDRs to
identify the specific bearer resource utilization associated with an IMS
session, identified by the ICID, by including the ICID information in the
service data containers along with the captured data volumes.
In TS 32.251 [11], the Multiple Unit Operation used for online charging and
bound to the Multiple-Services-Credit-Control AVP in TS 32.299 [50], also
contains the AF Charging Identifier within the AF-Correlation-Information AVP.
As for offline charging, when unique Rating-Group and Service-Identifier
combinations are assigned for the bearer resources associated with an IMS
session, this definition provides the ability for the P-GW to identify the
specific bearer resource utilization associated with an IMS session,
identified by the ICID, by including the ICID information in the Multiple-
Services-Credit-Control AVP along with the captured data volumes.
### 4.4.3 Associating IMS Session with PS Domain Charging
As per TS 29.214 [214], the AF may subscribe to notification about Access
Network Charging Information from the PCRF. This information will be provided
to the AF in either a direct response to the subscription when the charging
information is known or by a subsequent notification when the charging
information is received from the PCEF. The PCRF notifies the AF of the Access
Network Charging Information that applies to each authorized flow (e.g. audio
and video). The Access Network Charging Information consists of the Access-
Network-Charging-Identifier AVP(s) and may include the Access-Network-
Charging-Address AVP. For LTE, this would contain the EPC Charging Id for the
bearer and the P-GW Address.
As per TS 29.212 [213], when the Access Network Charging Identifier is not
known in the PCRF, the PCRF may request the PCEF to provide the information
associated with PCC dynamic rules. The charging identifier for each bearer
becomes known at the PCEF when the dynamic PCC rule is assigned to an existing
bearer or when the dynamic PCC rule initiates establishment of a new bearer
with a new charging identifier.
As per TS 32.260 [20], the IMS CDRs contain both the Access Correlation Id
containing the EPC charging identifier and the P-GW Address. This information
allows the billing domain to access the specific PS domain CDRs associated
with the IMS session.
NOTE 1: When Charging per IP-CAN session is active, a single PGW-CDR is
generated for the IP-CAN session accessed by the PDN Connection Charging Id
(i.e. for the default bearer). In TS 29.214 [214] and TS 29.212 [213], the PDN
Connection Charging Id is not available to the IMS domain.
As per TS 32.260 [20], the IMS information for online charging includes the
address of the P-GW and the SDP Media Component, which as per the
specification in TS 32.299 [50], includes the 3GPP-Charging-Id. This allows
the IMS nodes to provide the charging information required to access PS domain
charging information.
NOTE 2: When Charging per IP-CAN session is active, a single Gy session is
utilized for the IP-CAN session with the PDN Connection Charging Id (i.e. for
the default bearer) identified at the command level in the PS Information. In
TS 29.214 [214] and TS 29.212 [213], the PDN Connection Charging Id is not
available to the IMS domain.
### 4.5 Identifying the II-NNI traversal scenario
Dialog creating SIP request and standalone request can optionally contain an
\"iotl\" SIP URI parameter as specified in IETF draft-holmberg-dispatch-iotl
[409] and TS 24.229 [106] in a Request-URI or in a Route header field. The
\"iotl\" SIP URI parameter can be used to identify the II-NNI traversal
scenario. The \"iotl\" SIP URI parameter is appended to the URI that
represents the destination in CDRs.
One example on how the \"iotl\" SIP URI parameter is included in the Route
header field by the P-CSCF in an originating visited network when sending a
request towards the originating home network is shown below.
EXAMPLE: Route: \,\
If neither the Request-URI nor any of the Route header fields included in the
SIP request contains the \"iotl\" SIP URI parameter, the II-NNI traversal
scenario type can be determined by analysing the content of the SIP request or
using a default II-NNI traversal scenario type. The recommended II-NNI
traversal scenario type default value is \"homeA-homeB\".
NOTE: How the content of the SIP request can be used to determine the II-NNI
traversal scenario is implementation dependent and outside the scope of this
document.
The example use cases in this document assumes that the visited and home
network supports the use of the \"iotl\" SIP URI parameter and the \"iotl\"
SIP URI parameter are included in all coding examples.
The iotl values defined in IETF draft-holmberg-dispatch-iotl are:
  * \"homeA-homeB\"
  * \"homeB-visitedB\"
  * \"visitedA-homeA\"
  * \"homeA-visitedA\"
  * \"visitedA-homeB\"
### 4.6 Use of preconditions in IMS networks
An IMS UE can use preconditions based on local policy. The preconditions are
defined within IETF RFC 3312 [411]. To process the preconditions IETF RFC 3262
[410] is needed. This IETF RFC 3262 [410] is describing the reliability of
provisional responses which is needed to allow the reliable exchange of an SDP
offer and SDP answer.
All use cases in TR 29.949 [217] are assuming preconditions. The similar call
flows can appear without the preconditions mechanism.
While in the present document all use cases are showing the SDP within the 200
OK. Thus under charging consideration scenarios are not assuming the use of
preconditions while the call flows shows the possibilities where preconditions
may be used.
Since TS 24.229 [106] is stating that \"100rel\" option tag are used in
circumstances of the use of preconditions the SIP PRACK request /SIP 200 OK
response is not sent in non precondition cases. Also the UPDATE request /SIP
200 OK response is not sent since these messages are used to inform each other
about the met resource reservation.
The precondition mechanism has to be taken into consideration when collecting
the charging data relevant information since the reliable SDP answer will
appear within the SIP 200 (OK) response for the SIP UPDATE request which
indicated the fulfilment of the resource reservation.
The relevant information collected is covered with the \"List of Early SDP
Media Components\" and \"List of SDP Media Components\" as described in TS
32.260 [20]. With regard to TS 32.299 [50] the \"List of Early SDP Media
Components\" describes session, media parameters and timestamps related to
media components set to active according to SDP signalling exchanged during a
SIP session establishment and before the final successful or unsuccessful SIP
response to the initial SIP INVITE message is received. Once a media component
has been set to active, subsequent status changes shall also be registered.
The latest update of TS 24.229 allows also to activate the SDP with
precondition negotiation. i.e. attributes in SDP like \"sendonly\",
\"recvonly\" and \"sendrecv\" may be present and it is not clear if early
media is used or not. Thus an additional parameters likt the P-early-media
header fild should be taken into consideration. This issue will be discussed
in the conclusion section.
# 5 Description of Scenarios
## 5.1 Methodology for Entities description
### 5.1.1 Naming of URIs
#### 5.1.1.1 General
TS 23.003 [104] defines the principal purpose and the use of International
Mobile station Equipment Identities (IMEI) within the digital cellular
telecommunications system and the 3GPP system.
Within the TS 23.003 [104] clause 13 the numbering, addressing and
identification within the IP multimedia core network subsystem are described.
#### 5.1.1.2 Home Network Domain
The home network domain name is in the form of an internet domain name, e.g.
operator.com.
TS 23.003 [104] subclause 13.2 describes how to build the home network domain,
if there is no ISIM application.
EXAMPLE: A home network domain name is: IMSI in use with 234150999999999
results in home network domain = ims.mnc015.mcc234.3gppnetwork.org.
#### 5.1.1.3 Private user identity
TS 23.003 [104] subclause 13.3 describes the principles how to build a private
user identity.
The NAI as specified in IETF RFC 4282 [405] subclause 2.1 for 3GPP systems
with ISIM application the private user identity is derived from the IMSI.
EXAMPLE: If the IMSI is 234150999999999 (MCC = 234, MNC = 15), the private
user identity then takes the form
\"234150999999999\@ims.mnc015.mcc234.3gppnetwork.org\".
#### 5.1.1.4 Public user identity
TS 23.003 [104] subclause 13.4 describes the principles how to build a public
user identity.
The public user identity takes the form of either a SIP URI (see IETF RFC 3261
[404]) or a tel URI (see IETF RFC 3966 [406]).
According to TS 29.165 [216] a global number as defined in IETF RFC 3966 [406]
is used in a tel URI or in the user portion of a SIP URI with the
\"user=phone\" parameter when conveyed via a non-roaming II-NNI except when
agreement exists between the operators to also allow other kinds of numbers.
For a roaming IIâ€‘NNI no conventions are defined currently.
EXAMPLE 1: SIP URI: sip: +49892233445\@operator.com; user=phone
EXAMPLE 2: SIP URI: sip: +49892233445@ 192.0.2.4; user=phone
EXAMPLE 3: SIP URI: sip: bob\@operator.com
EXAMPLE 4: SIP: tel:+4687197378
#### 5.1.1.5 Instance-ID
TS 23.003 [104] subclause 13.8 describes the principles how to build an
instance-id.
When an IMEI is available, the instance-id takes the form of an IMEI URN. An
example of such an instance-id is as follows:
EXAMPLE 1: urn:gsma:imei:90420156-025763-0
If no IMEI is available, the instance-id takes the form of a string
representation of a UUID as a URN as defined in IETF RFC 4122 [408]. An
example of such an instance-id is as follows:
EXAMPLE 2: urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6
For more information on the instance-id and when it is used, see TS 24.229
[106].
### 5.1.2 Notation conventions
#### 5.1.2.1 Introduction
This subclause details the notation conventions used in the present document.
#### 5.1.2.2 User Identities and IP addresses
Table 5.1.2.2.1: The user identities and IP addresses used in message coding
examples
+----------------------+----------------------+----------------------+ | | IP address | Public user identity | +----------------------+----------------------+----------------------+ | UEâ€‘A | [555 | sip:userA_ | | | 5::aaa:bbb:ccc:ddd] | public1\@home-A.net\ | | | | tel:+1-237-555-1111 | | | | (NOTE 1) | +----------------------+----------------------+----------------------+ | Remote UE | [555 | sip:userB\ | | | 5::bbb:ccc:ddd:aaa] | _public1\@home-B.net | | | | | | | | tel:+4687197378 | +----------------------+----------------------+----------------------+ | SCC AS | N/A | sip:ps2c | | | | s\@sccas1.home-A.net | | | | (NOTE 2) | +----------------------+----------------------+----------------------+ | ATCF | N/A | tel:+12375553333 | | | | (NOTE 3) | +----------------------+----------------------+----------------------+ | NOTE 1: The [tel | | | | URI]{.underline} is | | | | also used as the | | | | C-MSISDN. | | | | | | | | NOTE 2: The SIP URI | | | | is used as the | | | | ATU-STI during PS to | | | | CS SRVCC access | | | | transfer. | | | | | | | | NOTE 3: The tel URI | | | | is used as the | | | | STN-SR during PS to | | | | CS SRVCC access | | | | transfer. | | | +----------------------+----------------------+----------------------+
### 5.1.3 Network Entities
#### 5.1.3.1 Served user UEâ€‘A\'s associated entities
Table 5.1.3.1.1: Domain name and FQDN used in message coding examples
* * *
Network Domain name Entity in the network FQDN UEâ€‘A\'s home network home-A.net
S-CSCF serving UE-A scscf-hA1.home-A.net I-CSCF(between proxy and S-CSCF)
icscf-hA1.home-A.net IBCF acting as an entry and exit point between the
UE-A\'s visited network and the UE-A\'s home network ibcf-hA1.home-A.net IBCF
acting as an exit point between the UE-A\'s home network and the remote UE\'s
home network ibcf-hA2.home-A.net AS providing supplementary services as-
hA1.home-A.net AS providing the access transfer service sccas-hA1.home-A.net
UE-A\'s visited network visited-A.net Pâ€‘CSCF serving UEâ€‘A pcscf-
vA1.visited-A.net IBCF acting as an entry and exit point between the UE-A\'s
visited network and the UE-A\'s home network ibcf-vA1.visited-A.net ATCF atcf-
vA1.visited-A.net MSC server msc-vA1.visited-A.net TRF trf-vA1.visited-A.net
* * *
#### 5.1.3.2 Remote user\'s associated entities
Table 5.1.3.2.1: Domain name and FQDN used in message coding examples
* * *
Network Domain name Entity in the network FQDN Remote UE\'s home network
home-R.net
* * *
#### 5.1.3.3 Interconnection networks associated entities
Table 5.1.3.3.1: Domain name and FQDN used in message coding examples
* * *
Network Domain name Entity in the network FQDN Interconnection network between
the visited network A and the home network A interconnection-A.net SIP proxy
ic-A1.interconnection-A.net Interconnection network between the visited
network A and the remote home network or between the home network A and the
remote home network R interconnection-T.net SIP proxy
ic-T1.interconnection-T.net
* * *
#### 5.1.3.4 IOI values
The IOI names used in the message coding examples are shown in table
5.1.3.4.1.
Table 5.1.3.4.1: The IOI values used in message coding examples
+----------------------------------+----------------------------------+ | Network | IOI name (NOTE 1, NOTE 2, | | | NOTE 3, NOTE 4) | +----------------------------------+----------------------------------+ | Originating visited network | visited-a | +----------------------------------+----------------------------------+ | Originating home network | home-a | +----------------------------------+----------------------------------+ | Terminating visited network | visited-a | +----------------------------------+----------------------------------+ | Terminating home network | home-a | +----------------------------------+----------------------------------+ | Remote UE\'s home network | home-r | +----------------------------------+----------------------------------+ | IC network A | ICa | +----------------------------------+----------------------------------+ | IC network T | ICt | +----------------------------------+----------------------------------+ | NOTE 1: The values for | | | \"orig-ioi\" and \"term-ioi\" | | | header field parameters are | | | encoded in the format of a | | | quoted string. | | | | | | NOTE 2: The value for an entry | | | in \"transit-ioi\" header field | | | parameter contains an indexed | | | value. | | | | | | NOTE 3: The type 1 and type 3 | | | IOIs are prefixed with specific | | | strings (i.e. \"Type1\" and | | | \"Type3\"). | | | | | | NOTE 4: Since the same UE is | | | used as the UE in originating | | | and terminating coding examples | | | the IOI name between the home | | | and visited network will have | | | the same value. | | +----------------------------------+----------------------------------+
## 5.2 Registration when roaming
### 5.2.1 General
This clause describes the registration process of a roaming user including the
traversal of transit network between the visited and the originating home
network.
### 5.2.2 Registration via IC SIP proxies
The registration procedure between the visited network and the home network
uses an IC network which provides SIP proxy nodes to relay SIP traffic between
these networks.
For the registration the UE addresses an FQDN in the home network domain which
reflects the registrar (i.e. the Sâ€‘CSCF of the home network). With this FQDN
the IBCF acting as an exit point in the visited network chooses an IC provider
and routes to a SIP proxy of the selected IC provider.
The SIP layer signalling is served by the IC provider\'s SIP proxy. The SIP
proxy decides on the next SIP proxy towards the home network and routes to the
next SIP proxy or to the IBCF acting as an entry point in the home network, if
no further SIP proxy is required.
NOTE 1: The call flows just show scenarios with a single IC network and a
single SIP proxy.
The user A at UE-A is roaming into a visited network vA. The user A is a
subscriber of operator hA.
TS 32.260 [20] points out that the initial registration, user-initiated re-
registration, and user-initiated de-registration chargeable events relate to
SIP REGISTER request to trigger Charging Data Request[Event] / Debit / Reserve
Units Requests, while network-initiated deregistration event relates to SIP
NOTIFY request to trigger Charging Data Request[Event] / Debit / Reserve Units
Requests provided that subscription to registration events has been applied
(see TS 24.229 [106]).
Thus for each SIP REGISTER request/SIP 200 (OK) response cycle a event based
CDR will be written.
Figure 5.2.2.1: Message flow for Registration via IC SIP proxy
**Call flow details:**
> **1\. SIP REGISTER request (UE-A to P-CSCF-vA1) - see example in table
> 5.2.2.1.**
>
> The user A at UE-A initiates registration. The UE-A sends an initial SIP
> REGISTER request to the P-CSCFâ€‘vA1 according to TS 24.229 [106].
Table 5.2.2.1: SIP REGISTER request (UE-A to P-CSCF-vA1)
SIP REGISTER request sip:home-A.net SIP/2.0
P-Access-Network-Info: 3GPP-E-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
From: \;tag=4fa3
To: \
Contact: \;reg-id=1;
+sip.instance=\"\\";expires=600000
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
CSeq: 1 SIP REGISTER request
Supported: path
Other SIP header fields are set according to TS 24.229 [106].
**Request-URI:** The Request-URI sip:home-A.net (the URI that follows the
method name, \"SIP REGISTER request\", in the first line) indicates the
destination domain of this SIP REGISTER request which is the home network.
**From: Set to the SIP URI that is the default public user identity of the
user A i.e. userA_public1\@home-A.net.**
**To: Set to the SIP URI that is the default public user identity of the user
A i.e. userA_public1\@home-A.net.**
**Supported: The UE-A inserts the Supported header field containing the
option-tag \"path\".**
> **2\. SIP REGISTER request (P-CSCF-vA1 to IBCF-vA1) - see example in table
> 5.2.2.2.**
When the P-CSCF-vA1 receives the initial SIP REGISTER request the Pâ€‘CSCF-vA1
adds the Pâ€‘Visitedâ€‘Networkâ€‘ID header field containing the identifier of the
P-CSCF network. This may be the visited network domain name or any other
identifier that identifies the visited network at the home network.
The P-CSCF-vA1 needs to be in the path for all terminating requests for this
user. To ensure this, the Pâ€‘CSCFâ€‘vA1 adds itself to the Path header field for
future requests.
The P-CSCF-vA1 selects an IBCF (IBCF-vA1) to be the IBCF acting as an exit
point towards the home network hA of the user A and sends the SIP REGISTER
request according to TS 24.229 [106] to IBCF-vA1.
Table 5.2.2.2: SIP REGISTER request (P-CSCF-vA1 to IBCF-vA1)
SIP REGISTER request sip:home-A.net SIP/2.0
P-Access-Network-Info:3GPP-E-UTRAN-TDD; utran-cell-
id-3gpp=234151D0FCE11;network-provided;local-time-zone=\"UTC+01:00\";daylight-
saving-time=\"01\"
From:
To:
Contact:
CSeq:
Supported:
Require: path
Path: \
Route: \
P-Visited-Network-ID: \"Visited Network Number A\"
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 1visited-a\"
Via:
...
Other SIP header fields are set according to TS 24.229 [106].
**Route: Pâ€‘CSCFâ€‘vA1 includes the selected IBCF-vA1 URI.**
**P-Access-Network-Info:** The P-CSCF-vA1 adds a network provided location,
time-zone and daylight saving time. If it does not indicate that it is a
network provided location, the P-Access-Network-Info header field containing
the location provided by the UE-A is kept in the INVITE request.
**Path:** This is the address of the P-CSCFâ€‘vA1 and is included to inform the
S-CSCF where to route terminating requests.
**Require:** The P-CSCF-vA adds the Require header field **containing the
option-tag \"path\"** to ensure that the recipient correctly handles the Path
header field. If the recipient does not support the Path header field, a SIP
response will be received with a status code of 420 and an Unsupported header
field indicating **the option-tag** \"path\". Such a response indicates a
wrong configuration of the routing tables and the request has been routed
outside the IM CN subsystem.
**P-Visited-Network-ID:** The P-CSCFâ€‘vA1 adds the Pâ€‘Visitedâ€‘Networkâ€‘ID header
field containing the identifier of the P-CSCF network. This may be the visited
network domain name or any other identifier that identifies the visited
network at the home network.
**P-Charging-Vector:** The P-CSCF-vA1 provides an ICID value and adds a type 1
\"orig-ioi\" header field parameter with the IOI value identifying the visited
network **(i.e. \"visitedâ€‘a\")**.
> **3.-6. SIP REGISTER request (IBCF-vA1 to S-CSCF-hA1)**
>
> Between IBCF-vA1 and S-CSCF only the Path, Route and Via will be
> manipulated.
>
> The based on the transit network traversed the entrypoint of the home
> network may manipulate the P-Charging vector header in adding a transit-ioi.
>
> Path, Route and Via header fields will be filled from each entity traversed
> with the regarding information as specified within TS 24.229 [106].
>
> Based on the use of topology hiding more or less entries will pass the
> complete path. Thus the CDR content based on Route header can vary.
>
> **7\. SIP 401 (****Unauthorized) response (S-CSCF-hA1 to I-CSCF-hA1) - see
> example in table 5.2.2.7.**
>
> As the SIP REGISTER request arrived without integrity protection to the
> P-CSCF, the S-CSCFâ€‘hA1 shall challenge the request. For this, the S-CSCFâ€‘hA1
> requires at least one authentication vector to be used in the challenge to
> the user. If a valid authentication vector is not available, then the
> S-CSCFâ€‘hA1 requests at least one authentication vector from the HSS.
Table 5.2.2.3: SIP 401 (Unauthorized) response (S-CSCF-hA1 to UEâ€‘A)
SIP/2.0 401 Unauthorized
Via:
From:
To: \;tag=5ef4
CSeq:
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 1visited-a\";term-ioi=\"Type 1home-a\"
Other SIP header fields are set according to TS 24.229 [106].
> **P-Charging-Vector:** The P-Charging-Vector header field containing the
> \"orig-ioi\" header field parameter, if received in the SIP REGISTER request
> and a type 1 \"term-ioi\" header field parameter. The Sâ€‘CSCFâ€‘hA1 shall set
> the type 1 \"term-ioi\" header field parameter to a value that identifies
> the sending network of the response and the \"orig-ioi\" header field
> parameter is set to the previously received value of \"orig-ioi\" header
> field parameter.\ **The \"icid-value\" header field parameter is set to the
> previously received value of \"icidâ€‘value\" header field parameter in the
> request.**
>
> Normal response routing procedure as described within 24.229 [106] applies.
> No specific roaming procedures apply.
>
> **8\. SIP REGISTER request (UE-A to S-CSCF-hA1).**
>
> The authentication challenge response is calculated by the UE-A and then put
> into the Authorization header field and sent back to the registrar in the
> SIP REGISTER request. Procedures are described within 24.229 [106].
UEâ€‘A SIP REGISTER requests a second time with an authentication response.
> With the exception of the Authorization header field, the CSeq header field
> value and the ICID value in the P**â€‘** Charging**â€‘** Vector header field,
> the SIP REGISTER request message will contain the same information.
>
> **9.-14. SIP 200 (OK) response (S-CSCF-hA1 to UEâ€‘A) - see example in table
> 5.2.2.19.**
>
> S-CSCFâ€‘hA1 confirms the registration as described within 24.229 [106]. There
> are no roaming specific procedures that apply in addition.
>
> The table 5.2.2.19 shows the content of the SIP 200 (OK) response when sent
> by S-CSCFâ€‘hA1.
Table 5.2.2.4: SIP 200 (OK) response (S-CSCF-hA1 to UEâ€‘A)
SIP/2.0 SIP 200 (OK) response
Via:
From:
Service-Route: \
To:
CSeq: 2 SIP REGISTER request
Contact:
P-Associated-URI: \,\
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 1visited-a\";term-ioi=\"Type 1home-a\"
Path: \,
\,
\,
\
Other SIP header fields are set according to TS 24.229 [106].
**Path:** List of Path header field received in the SIP REGISTER request will
be included. (IBCFâ€‘hA1, ICâ€‘A1, IBCF-vA1, P-CSCF-vA1).
**P-Associated-URI:** Containing the list of the SIP REGISTER request distinct
public user identity and its associated set of implicitly SIP REGISTER request
distinct public user identities. The first URI in the list of public user
identities supplied by the HSS to the S-CSCF will indicate the default public
user identity to be used by the S**â€‘** CSCF. This header has no direct
influence on the content of the CDR\'s written
**Service-Route:** Contains the SIP URI identifying the S-CSCF (S-CSCF-hA1)
containing an indication that subsequent requests routed via this service
route (i.e. from the P-CSCF to the Sâ€‘CSCF). This header has no influence on
the content of the CDR written.
**P-Charging-Vector:** The P-Charging-Vector header field containing the
\"orig-ioi\" header field parameter, if received in the SIP REGISTER request
and a type 1 \"term-ioi\" header field parameter. The Sâ€‘CSCFâ€‘hA1 shall set the
type 1 \"term-ioi\" header field parameter to a value that identifies the
sending network of the response and the \"orig-ioi\" header field parameter is
set to the previously received value of \"orig**â€‘** ioi\" header field
parameter.\ **The \"icid-value\" header field parameter is set to the
previously received value of \"icidâ€‘value\" header field parameter in the
request.**
After the completion of the procedure, the P-CSCF and S-CSCF sends Charging
Data Request[Event] to record transaction specific information in the
P-CSCF/S-CSCF CDR.
After the registration procedure, the addresses of the P-CSCF and possibly the
S-CSCF are known in UE(A).\ Furthermore, the P-CSCF has received (and stored
internally) the following information from the UE:
\- Home Network: SIP URI of the domain name of the home network used to
address the SIP REGISTER request of the served party.
\- IMPU: To/From header field of the SIP REGISTER request.
\- User Name (optional): Authorization Header (optional) within SIP REGISTER
request (IMPI)
\- Possible the address of the S-SCSF: **S-CSCF-hA1**.home-A.net. This is
depended on the concept used within the home network domain. Either the S-CSCF
address is put into the Service-Route header sent back to the visited network.
Or the entry point of the home network which does topology hiding.
\- InstanceID containing the served IMEI which is sent back in the contact
header.
\- The Path header field will include the entities to be passed for future Re-
SIP REGISTER requests. But has no relevance for charging.
The P-CSCF has received in addition:
\- The P-Charging-Vector header field containing the \"orig-ioi\" header field
parameter, if received in the SIP REGISTER request and a type 1 \"term-ioi\"
header field parameter. The Sâ€‘CSCFâ€‘h sets the type 1 \"term-ioi\" header field
parameter to a value that identifies the sending network of the response and
the \"orig-ioi\" header field parameter is set to the previously received
value of \"orig-ioi\" header field parameter which is also a Type 1 ioi.\ The
\"icid-value\" header field parameter is set to the previously received value
of \"icidâ€‘value\" header field parameter in the request.
Table 5.2.2.5: SIP REGISTER request/SIP 200OK Response P-CSCF-vA1 SIP Header
Field\ to Information Element
+----------------------+----------------------+----------------------+ | **Chargeable Event / |** Charging Event**| | | Information** | | | +----------------------+----------------------+----------------------+ | SIP Header Field | Example Content | Discussion and | | | | Information Element | +----------------------+----------------------+----------------------+ | Request-URI | home-A.net | IE: none | | | | | | | | the Request URI only | | | | holds the domain | | | | where the registrar | | | | is located | +----------------------+----------------------+----------------------+ | To | \ | Address | | | | | | | | this field holds the | | | | Public User ID under | | | | registration | +----------------------+----------------------+----------------------+ | From | \;tag=4fa3 | | +----------------------+----------------------+----------------------+ | Contact: | \ | | | | ;+sip.in | Other parts of the | | | stance=\"\\" | | +----------------------+----------------------+----------------------+ | Route: | Received: | IE: Route Header | | | | Received | | | \,\ | only the received | | |  | transmitted | | | | | | | transmitted: | | | | | | | | \,\ | | | |  | | +----------------------+----------------------+----------------------+ | P- | 3GPP-E-UTRAN-TDD\ | IE: Access Network | | Access-Network-Info: | tran-cell-id- | Information | | | 3gpp=234151D0FCE11;\ | | | | network-provided;\ | IE: Additional | | | local-time- | Access Network | | | zone=\"UTC+01:00\";\ | Information | | | dayligh | | | | t-saving-time=\"01\" | In case there are | | | | two header fields | | | | available then the | | | | information will be | | | | written into both. | | | | That will happen | | | | when a network | | | | provided and user | | | | provided information | | | | will appear. | +----------------------+----------------------+----------------------+ | Via: | SIP/2.0/UDP | IE: none | | | [5555 | | | | ::aaa:bbb:ccc:ddd]; | Via header is used | | | b | for SIP responses to | | | ranch=z9hG4bKnashds7 | follow the same way | | | | as the Request was | | | | sent. | | | | | | | | Information out of | | | | the Via header field | | | | will not be used. | +----------------------+----------------------+----------------------+ | P-Charging Vector | i | IE: | | Header | cid-value=\"AyretyU0 | IMS | | | dm+6O2IrT5tAFrbHLso= | -Charging-Identifier | | | 023551024\";\ | | | | orig-ioi=\"Type | IE: Inter Operator | | | 1visited-a\"\ | Identifiers | | | tra | | | | nsit-ioi_\"ICa.1\"\ | IE: Transit IOI List | | | term-ioi=\"Type | | | | 1home-a\" | he header includes | | | | so far the ICID, | | | | orig-ioi, term-ioi | | | | and transit-ioi | | | | which will be | | | | included into the \" | | | | IMS-C | | | | harging-Identifier\" | | | | and into the \"Inter | | | | Operator | | | | Identifiers\" | +----------------------+----------------------+----------------------+ | P | \"Visited Network | IE: IMS Visited | | -Visited-Network-ID: | Number A\" | Network Identifier | +----------------------+----------------------+----------------------+
Table 5.2.2.6: SIP REGISTER request/200OK Response S-CSCF-hA1 SIP Header
Field\ to Information Element
+----------------------+----------------------+----------------------+ | **Chargeable Event / |** Charging Event**| | | Information** | | | +----------------------+----------------------+----------------------+ | SIP Header Field | Example Content | Discussion and | | | | Information Element | +----------------------+----------------------+----------------------+ | Request-URI | see table 5.2.2.5: | see table 5.2.2.5: | +----------------------+----------------------+----------------------+ | To | see table 5.2.2.5: | see table 5.2.2.5: | +----------------------+----------------------+----------------------+ | From | see table 5.2.2.5: | see table 5.2.2.5: | +----------------------+----------------------+----------------------+ | Contact: | see table 5.2.2.5: | see table 5.2.2.5: | +----------------------+----------------------+----------------------+ | Route: | Received: | IE: Route Header | | | | Received | | | \,\ | IE: Route Header | | |  | | | | | The Route header | | | Transmitted: | field from the | | | | received SIP INVITE | | | \,\ | sent SIP INVITE will | | |  | | +----------------------+----------------------+----------------------+ | P- | see table 5.2.2.5: | see table 5.2.2.5: | | Access-Network-Info: | | | +----------------------+----------------------+----------------------+ | Via: | see table 5.2.2.5: | see table 5.2.2.5: | +----------------------+----------------------+----------------------+ | P-Charging Vector | see table 5.2.2.5: | see table 5.2.2.5: | | Header | | | +----------------------+----------------------+----------------------+ | P | see table 5.2.2.5: | see table 5.2.2.5: | | -Visited-Network-ID: | | | +----------------------+----------------------+----------------------+
### 5.2.3 Subscription to the registration-state event package
#### 5.2.3.1 General
After that the registration in clause 5.2.2 is successfully completed the UE
and the P-CSCF subscribes to the registration-state event package as described
in TS 24.229 [106].
The difference between the UE-A subscription and the P-CSCF-vA1 subscription
is that the UE-A sends the SIP SUBSCRIBE request using the registration path
while the P-CSCF-vA1 is using the NNI i.e. for the IC network A it will appear
as the SIP SUBSCRIBE request sent by the P-CSCF-vA1 is between two home
networks.
NOTE: The message flows in clause 5.2.3.2 and clause 5.2.3.3 are independent
and can be done in parallel.
#### 5.2.3.2 The UE subscribes to the registration-state event package
After that the registration in clause 5.2.2 is successfully completed the UE
subscribes to the registration-state event package as described in TS 24.229
[106] clause 5.1.1.3.
Figure 5.2.3.2.1 shows how the UE-A sends the SUBSCRIBE request using the
registration path.
Figure 5.2.3.2.1: Subscription to the registration-state event package by the
UE-A
The chargeable event based information is equivalent to that as for the SIP
REGISTER request.
The chargeable event / information and charging event can be seen in table
5.2.2.4 for the P-CSCF and in table 5.2.2.5 for the S-CSCF.
#### 5.2.3.3 The P-CSCF subscribes to the registration-state event package
After that the registration in clause 5.2.2 is successfully completed the
P-CSCF-vA1 subscribes to the registration-state event package as described in
TS 24.229 [106] clause 5.2.3.
The information received in the registration-state event package can be used
by the P-CSCF to determine if a registration is still valid.
Figure 5.2.3.3.1 shows how the P-CSCF-vA1 sends the SIP SUBSCRIBE request
without using the registration path hence it will appear as the SIP SUBSCRIBE
request is sent between two home networks.
Table 5.2.3.3.1: SIP SUBSCRIBE request/200OK Response P-CSCF-vA1 SIP Header
Field to Information Element
+----------------------+----------------------+----------------------+ | **Chargeable Event / | Charging Event | | | Information** | | | +----------------------+----------------------+----------------------+ | **SIP Header Field** | **Example Content** | Discussion and | | | | Information Element | +----------------------+----------------------+----------------------+ | Event | reg | IE: Event Type | | | | | | | | This field holds the | | | | SIP Method | | | | (SUBSCRIBE), the | | | | content of the SIP | | | | \"Event\" header | | | | (reg) and the | | | | content of the SIP | | | | \"expires\" header | | | | (600000) when | | | | present in the SIP | | | | request | +----------------------+----------------------+----------------------+ | Request-URI | \ | Address | | | | | | | | For a subscription | | | | procedure this field | | | | holds the address of | | | | the resource for | | | | which the originator | | | | wants to receive | | | | notifications of | | | | change of states | +----------------------+----------------------+----------------------+ | To | see table 5.2.2.5: | IE: none | +----------------------+----------------------+----------------------+ | From | see table 5.2.2.5: | see table 5.2.2.5: | +----------------------+----------------------+----------------------+ | Contact: | see table 5.2.2.5: | see table 5.2.2.5: | +----------------------+----------------------+----------------------+ | Route: | see table 5.2.2.5: | see table 5.2.2.5: | +----------------------+----------------------+----------------------+ | P- | see table 5.2.2.5: | see table 5.2.2.5: | | Access-Network-Info: | | | +----------------------+----------------------+----------------------+ | Via: | see table 5.2.2.5: | see table 5.2.2.5: | +----------------------+----------------------+----------------------+ | P-Charging Vector | see table 5.2.2.5: | see table 5.2.2.5: | | Header | | | +----------------------+----------------------+----------------------+ | P | see table 5.2.2.5: | see table 5.2.2.5: | | -Visited-Network-ID: | | | +----------------------+----------------------+----------------------+
Table 5.2.3.3.2: SIP SUBSCRIBE request/200OK Response S-CSCF-hA1 SIP Header
Field to Information Element
+----------------------+----------------------+----------------------+ | **Chargeable Event / | Charging Event | | | Information** | | | +----------------------+----------------------+----------------------+ | **SIP Header Field** | **Example Content** | **Discussion and | | | | Information | | | | Element** | +----------------------+----------------------+----------------------+ | Event | see table 5.2.3.3.1 | see table 5.2.3.3.1 | +----------------------+----------------------+----------------------+ | Request-URI | see table 5.2.3.3.1 | see table 5.2.3.3.1 | +----------------------+----------------------+----------------------+ | To | see table 5.2.2.5: | see table 5.2.2.5: | +----------------------+----------------------+----------------------+ | From | see table 5.2.2.5: | see table 5.2.2.5: | +----------------------+----------------------+----------------------+ | Contact: | see table 5.2.2.5: | see table 5.2.2.5: | +----------------------+----------------------+----------------------+ | Route: | Received: | IE: Route Header | | | | Received | | | \,\ | IE: Route Header | | |  | | | | | The Route header | | | Transmitted: | field from the | | | | received SIP INVITE | | | \,\ | sent SIP INVITE will | | |  | | +----------------------+----------------------+----------------------+ | P- | see table 5.2.2.5: | see table 5.2.2.5: | | Access-Network-Info: | | | +----------------------+----------------------+----------------------+ | Via: | see table 5.2.2.5: | see table 5.2.2.5: | +----------------------+----------------------+----------------------+ | P-Charging Vector | see table 5.2.2.5: | see table 5.2.2.5: | | Header | | | +----------------------+----------------------+----------------------+ | P | see table 5.2.2.5: | see table 5.2.2.5: | | -Visited-Network-ID: | | | +----------------------+----------------------+----------------------+
Table 5.2.3.3.3: SIP NOTIFY request/200OK Response P-CSCF-vA1 SIP Header Field
to Information Element
+----------------------+---------------------+----------------------+ | **Chargeable Event / | Charging Event | | | Information** | | | +----------------------+---------------------+----------------------+ | **SIP Header Field** | **Example Content** | Discussion and | | | | Information Element | +----------------------+---------------------+----------------------+ | Event | reg | IE: Event Type | | | | | | | | This field holds the | | | | SIP Method | | | | (SUBSCRIBE), the | | | | content of the SIP | | | | \"Event\" header | | | | (reg) and the | | | | content of the SIP | | | | \"expires\" header | | | | (600000) when | | | | present in the SIP | | | | request | +----------------------+---------------------+----------------------+
All other elements are equivalent filled as in table 5.2.3.3.1. the same
applies for the S-CSCF cargable event information.
Figure 5.2.3.3.1: Subscription to the registration-state event package by the
P-CSCF-vA1
The chargeable event based information is equivalent to that as for the SIP
REGISTER request.
The chargeable event / information and charging event can be seen in table
5.2.3.3.1 and table 5.2.3.3.3 for the P-CSCF and in table 5.2.3.3.2 for the
S-CSCF.
## 5.3 Mobile Originating Call without loopback
This clause describes the originating call setup from a mobile subscriber who
is roaming in a foreign network, with direct media home routing, i.e. without
support of OMR (the TRF is not involved in the call flow).
The complete SIP flow is shown in TR 29.949 [217]. This clause shows the
charging relevant messages and elements.
After the registration procedure, the addresses of the P-CSCF and possibly the
S-CSCF are known in UE (A).
Figure 5.3.1: MOC Roaming Call Flow, with direct media home routing
> **1\. SIP INVITE request (UE-A to P-CSCF-vA1) - see example in table
> 5.3.1.**
The user A at UE-A initiates a call. The UE-A sends an initial SIP INVITE
request to the P-CSCFâ€‘vA1 according to TS 24.229 [106].
(It is assumed that the UE will assign the home domain as shown in subclause
5.1.1.2 e.g. ims.mnc015.mcc234.3gppnetwork.org)
Table 5.3.1: SIP INVITE request (UE-A to P-CSCF-vA1)
INVITE sip: userB_public1\@home-A.net;user=phone SIP/2.0
To: \
From: \;tag=4fa3
P-Preferred-Identity: \
P-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
Contact: \
CSeq: 1 INVITE
Route: \,\
P-Access-Network-Info: 3GPP-E-UTRAN-TDD;utran-cell-id-3gpp=234151D0FCE11
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Content-Type: application/sdp
Content-Length: (...)
v=0
o=- 2987933615 2987933615 IN IP4 192.0.2.1
s=
t=0 0
c=IN IP4 192.0.2.1
m=audio 49170 RTP/AVP 96 97
a=curr:qos local none
a=curr:qos remote none
a=des:qos mandatory local sendrecv
a=des:qos optional remote sendrecv
a=rtpmap:97 AMR
a=fmtp:97 mode-set=0,2,5,7; mode-change-period=2
a=rtpmap:96 telephone-event
a=maxptime:20
Other SIP header fields and SDP according to TS 24.229 [106]
> Table 5.3.1.1 shows a typical SIP INVITE message sent out. The SDP is
> prepared to negotiate preconditions with the far end.
>
> No CDR written since this is the end device.
>
> **2\. SIP INVITE request (P-CSCF-vA1 to IBCF-vA1) - see example in table
> 5.3.2.**
When the P-CSCF-vA1 receives the initial SIP INVITE request and, since the
user A is a roaming user, based on local policy and roaming agreement the
P-CSCFâ€‘vA1 adds the Feature-Caps header field with the \"g.3gpp.trf\" header
field parameter with the address to the TRF. The Feature --Caps header will
not needed the P-CSCF CDR
The P-CSCF-vA1 selects an IBCF (IBCF-vA1) to be the exit IBCF towards the home
IMS network hA of the user A and sends the SIP INVITE request according to TS
24.229 [106] to IBCF-v1A.
The received list of URIs in the Route header field within the SIP INVITE will
be verified with the Route header field list constructed from the Service-
Route header field received during the last registration procedure.
Table 5.3.2: SIP INVITE request P-CSCF-vA1 SIP Header Field to Information
Element
+----------------------+----------------------+----------------------+ | **Chargeable Event / | Charging Event | | | Information** | | | +----------------------+----------------------+----------------------+ | **SIP Header Field** | **Example Content** | Discussion and | | | | Information Element | +----------------------+----------------------+----------------------+ | Request-URI | userB_public1\@h | IE: Called Party | | | ome-A.net;user=phone | Address | | | | | | | | In the context of an | | | | end-to-end SIP | | | | transaction this | | | | field holds the | | | | address of the party | | | | (Public User ID) to | | | | whom the SIP | | | | transaction is | | | | posted. For | | | | emergency calls, | | | | this parameter could | | | | contain an URN. | | | | | | | | The Called Party | | | | Address IE shall be | | | | populated with the | | | | SIP URI or TEL URI | | | | contained in the | | | | Request-URI of the | | | | outgoing request. | +----------------------+----------------------+----------------------+ | To | \ | IE: none | | | | | | | | This header does | | | | have no relevance | | | | for charging. | +----------------------+----------------------+----------------------+ | From | \;tag=4fa3 | The from Header | | | | field is not an | | | | asserted identity, | | | | i.e. not trusted. | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | \ | | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | tel:+1-237-555-1111 | \"Calling Party | | (Note) | | Address\" | +----------------------+----------------------+----------------------+ | P-Preferred-Service: | urn:urn-7:3gpp-se | IE: none | | | rvice.ims.icsi.mmtel | | | | | This is the | | | | requested service | | | | which will be | | | | notified by the | | | | S-CSCF and then | | | | changed to the | | | | P-Asserted Service. | | | | This header will not | | | | be included in an | | | | IE. | +----------------------+----------------------+----------------------+ | Contact: | \ | | | | ;+sip.in | Other parts of the | | | stance=\"\\" | | +----------------------+----------------------+----------------------+ | Route: | Received: | IE: Route Header | | | | Received | | | \,\ | IE: Route Header | | |  | | | | | The Route header | | | Transmitted: | field from the | | | | received SIP INVITE | | | \,\ | sent SIP INVITE will | | |  | | +----------------------+----------------------+----------------------+ | P- | 3GPP-E-UT | IE: Access Network | | Access-Network-Info: | RAN-TDD;utran-cell-i | Information | | | d-3gpp=234151D0FCE11 | | | | | IE: Additional | | | | Access Network | | | | Information | | | | | | | | In case there are | | | | two header fields | | | | available then the | | | | information will be | | | | written into both. | | | | That will happen | | | | when a network | | | | provided and user | | | | provided information | | | | will appear. | +----------------------+----------------------+----------------------+ | Via: | SIP/2.0/UDP | IE: none | | | [5555 | | | | ::aaa:bbb:ccc:ddd]; | Via header is used | | | b | for SIP responses to | | | ranch=z9hG4bKnashds7 | follow the same way | | | | as the Request was | | | | sent. | | | | | | | | Information out of | | | | the Via header field | | | | will not be used. | +----------------------+----------------------+----------------------+ | Feature-Caps | *;+g.3gpp. | IE: none | | | trf=\"\\" | The feature caps | | | | header includes the | | | | information about | | | | the TRF address. | | | | This information is | | | | currently not | | | | included in an IE. | +----------------------+----------------------+----------------------+ | P-Charging Vector | i | IE: | | Header | cid-value=\"AyretyU0 | IMS | | | dm+6O2IrT5tAFrbHLso= | -Charging-Identifier | | | 0235510 | | | | 24\";orig-ioi=\"Type | IE: Inter Operator | | | 1visited-a\" | Identifiers | | | | | | | | he header includes | | | | so far the ICID and | | | | orig-ioi which will | | | | be included into the | | | | \" | | | | IMS-C | | | | harging-Identifier\" | | | | and into the \"Inter | | | | Operator | | | | Identifiers\" | +----------------------+----------------------+----------------------+ | Stored in the P-CSCF | | IE: IMS Visited | | during Registration | | Network Identifier | +----------------------+----------------------+----------------------+ | Note: In some | | | | circumstances a | | | | second | | | | P-Asserted-Identity | | | | will be added. This | | | | is depended on the | | | | UE if it is a | | | | privileged user or | | | | the implicit | | | | registered public | | | | user identities or | | | | the call is an | | | | emergency call.\ | | | | in our use case it | | | | is assumed that the | | | | implicitly | | | | registered | | | | identities | | | | represents also a | | | | tel URI. | | | +----------------------+----------------------+----------------------+
Table 5.3.3: SDP portion of SIP INVITE request P-CSCF-vA1 Information Elements
+----------------------------------+----------------------------------+ | **SIP header field Content-Type |** Discussion and Charging Event | | set to application/sdp**| IE** | | | | | **Example of SDP Content** | | +----------------------------------+----------------------------------+ | v=0 | Initial offer contains the SDP | | | offer but will be finally | | o=- 2987933615 2987933615 IN IP4 | included into \"SDP Session | | \ (A_BGFvA1: | Description\" and \"SDP Media | | IMS Access Gateway assigned to | Component\" when the SDP was | | P-CSCF) | made reliable (i.e. with SIP 200 | | | OK) or an early session apply. | | s= | | | | | | t=0 0 | | | | | | c=IN IP4 \ | | | | | | m=audio \ | | | RTP/AVP 96 97 | | | | | | a=curr:qos local none | | | | | | a=curr:qos remote none | | | | | | a=des:qos mandatory local | | | sendrecv | | | | | | a=des:qos optional remote | | | sendrecv | | | | | | a=rtpmap:97 AMR | | | | | | a=fmtp:97 mode-set=0,2,5,7; | | | mode-change-period=2 | | | | | | a=rtpmap:96 telephone-event | | | | | | a=maxptime:20 | | +----------------------------------+----------------------------------+
NOTE: The principals of the IMS Access Gateway are described within TS 23.228
[107] Annex G
> **3\. SIP INVITE request (IBCF-vA1 to IC-A1).**
SIP INVITE is routed from the Ibcf-vA1.visited-A.net towards the HPLMN using a
VoIP IC provider. The IBCF prepares OMR handling and modifies the SIP INVITE
as follows:
Table 5.3.4: SIP INVITE request IBCF-vA1 SIP Header Field to Information
Element
+----------------------+----------------------+----------------------+ | **Chargeable Event / | Charging Event | | | Information** | | | +----------------------+----------------------+----------------------+ | **SIP Header Field** | **Example Content** | Discussion and | | | | Information Element | +----------------------+----------------------+----------------------+ | Request-URI | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | To | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | From | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | P-Preferred-Service: | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | Contact: | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | Route: | Received: | IE: Route Header | | | | Received | | | \,\ | only the received | | |  | transmitted | +----------------------+----------------------+----------------------+ | P- | see table 5.3.2 | see table 5.3.2 | | Access-Network-Info: | | | +----------------------+----------------------+----------------------+ | Via: | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | Feature-Caps | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | P-Charging Vector | see table 5.3.2 | see table 5.3.2 | | Header | | | +----------------------+----------------------+----------------------+
Table 5.3.5: SDP portion of SIP INVITE request IBCF-vA1 Information Elements
+----------------------------------+----------------------------------+ | **SIP header field Content-Type |** Discussion and Charging Event | | set to application/sdp**| IE** | | | | | **Example of SDP Content** | | +----------------------------------+----------------------------------+ | Additional Information due to | IE: none | | OMR will be added: | | | | Initial offer contains the SDP | | c= IN IP4 \ (TrGW: | offer but will be finally | | media GW assigned to outgoing | included into \"SDP Session | | IBCF) | Description\" and \"SDP Media | | | Component\" when the SDP was | | m= audio \ RTP/AVP | made reliable (i.e. with SIP 200 | | 96 (invalid port) | OK) or an early session apply. | | | | | a=visited-realm:1 \ IN | | | IP4 \ | | | \ | | | | | | a= visited-realm:2 \ IN | | | IP4 \ | | | \ | | | | | | (provides for VPLMN internal OMR | | | the media IP-address/port of the | | | TRGW controlled by | | | IBCF-vA1.visited-A.net serving | | | the calling UE A) | | +----------------------------------+----------------------------------+
> **4\. SIP INVITE request (** IC-A1 to IBCF-hA1**).**
>
> The IC-A1 may add a Route header field entry pointing to the entry point of
> home network hA. This is shown in example in table 5.3.2.4. IC-A1 collects
> data needed based on their local policy and SLA for the accounting between
> carriers. IC-A1 may also exist as an IP peering as shown within TR 29.949
> [217]. A Transit-IOI may be set by IC-A1. in case IC-A1 is a IMS network it
> will contain a TF.
>
> Some IC\'s does not record route. So each Request within one Dialog may take
> another route within the transit network. The exit point for VPLMN vA which
> is the IBCF-vA1 will include itself within the record route and the entry
> point of HPLMN hA which is the IBCF-hA1 will include itself within the
> record route is for messages exchanged within one Dialog are same. Following
> the SIP routeing rules the IBCF of the VPLMN and HPLMN are identified by the
> record route header passed by the transit network. Thus the entry and exit
> points will be the same for the whole Dialog.
Table 5.3.6: SIP INVITE request TF of IC-A1 TF SIP Header Field to Information
Element
+----------------------+----------------------+----------------------+ | **Chargeable Event / | Charging Event | | | Information** | | | +----------------------+----------------------+----------------------+ | **SIP Header Field** | **Example Content** | Discussion and | | | | Information Element | +----------------------+----------------------+----------------------+ | Request-URI | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | To | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | From | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | P-Preferred-Service: | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | Contact: | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | Route: | Received: | IE: Route Header | | | | Received | | | \,\ | only the received | | |  | transmitted | | | | | | | transmitted: | | | | | | | | \,\ | | | |  | | +----------------------+----------------------+----------------------+ | P- | see table 5.3.2 | see table 5.3.2 | | Access-Network-Info: | | | +----------------------+----------------------+----------------------+ | Via: | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | Feature-Caps | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | P-Charging Vector | t | IE: Transit-IOI List | | Header | ransit-ioi=\"ICa.1\" | | | | | This field may be | | | | set by the TF if | | | | IC-A1 is an IMS | | | | network. | +----------------------+----------------------+----------------------+
Table 5.3.7: SDP portion of SIP INVITE request TF of IC-A1 Information
Elements
+----------------------------------+----------------------------------+ | **SIP header field Content-Type |** Discussion and Charging Event | | set to application/sdp**| IE** | | | | | **Example of SDP Content** | | +----------------------------------+----------------------------------+ | Additional Information due to | IE: none | | OMR will be added: | | | | Initial offer contains the SDP | | c= IN IP4 \ (TrGW: | offer but will be finally | | media GW assigned to outgoing | included into \"SDP Session | | IBCF) | Description\" and \"SDP Media | | | Component\" when the SDP was | | m= audio \ RTP/AVP | made reliable (i.e. with SIP 200 | | 96 (invalid port) | OK) or an early session apply. | | | | | a=visited-realm:1 \ | | | IN IP4 \ | | | \ | | | | | | a= visited-realm:2 \ | | | IN IP4 \ | | | \ | | | | | | a=visited-realm:3 | | | \ IN IP4 | | | \ | | | \ | | | | | | (provides for IC-A1 the outgoing | | | media IP-address/port of the | | | TRGW controlled by IC-A1) | | +----------------------------------+----------------------------------+
> **5\. SIP INVITE request (IBCF-hA1 to S-CSCF-hA1).**
>
> When the IBCF-hA1 receives the initial SIP INVITE request containing the
> \"+g.3gpp.trf\" header field parameter in a Feature-Caps header field, the
> IBCF-hA1 updates the SDP as described in TS 29.079 [215].
Table 5.3.8: SIP INVITE request IBCF-hA1 SIP Header Field to Information
Element
+----------------------+----------------------+----------------------+ | Chargeable Event / | Charging Event | | | Information | | | +----------------------+----------------------+----------------------+ | SIP Header Field | Example Content | Discussion and | | | | Information Element | +----------------------+----------------------+----------------------+ | Request-URI | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | To | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | From | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | P-Preferred-Service: | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | Contact: | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | Route: | Received: | IE: Route Header | | | | Received | | | \,\ | only the received | | |  | transmitted | | | | | | | transmitted: | | | | | | | | \,\ | | | |  | | +----------------------+----------------------+----------------------+ | P- | see table 5.3.2 | see table 5.3.2 | | Access-Network-Info: | | | +----------------------+----------------------+----------------------+ | Via: | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | Feature-Caps | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | P-Charging Vector | t | IE: Transit-IOI List | | Header | ransit-ioi=\"ICa.1\" | | | | | This field is set by | | | | the IBCF in case it | | | | was not received. | +----------------------+----------------------+----------------------+
Table 5.3.9: SDP portion of SIP INVITE request IBCF-hA1 I-CSCF-hA1 Information
Elements
+----------------------------------+----------------------------------+ | **SIP header field Content-Type |** Discussion and Charging Event | | set to application/sdp**| IE** | | | | | **Example of SDP Content** | | +----------------------------------+----------------------------------+ | Additional Information due to | IE: none | | OMR will be added: | | | | Initial offer contains the SDP | | c= IN IP4 \ (TrGW: | offer but will be finally | | media GW assigned to outgoing | included into \"SDP Session | | IBCF) | Description\" and \"SDP Media | | | Component\" when the SDP was | | m= audio \ RTP/AVP | made reliable (i.e. with SIP 200 | | 96 (invalid port) | OK) or an early session apply. | | | | | a=visited-realm:1 \ | | | IN IP4 \ | | | \ | | | | | | a= visited-realm:2 \ | | | IN IP4 \ | | | \ | | | | | | a=visited-realm:3 | | | \ IN IP4 | | | \ | | | \ | | | | | | a=visited-realm:4 \ | | | IN IP4 \ | | | \ | | | | | | (provides for IBCF-hA1 TRG-W the | | | outgoing media IP-address/port | | | of the TRGW controlled by | | | IBCF-hA1) | | +----------------------------------+----------------------------------+
**Record-Route:** Changes but is not relevant for charging.
**Route:** Possibly changes due to local policy at the IBCF and will be
included needed for IBCF CDR in the field \"SIP Route header transmitted\". In
cases where only the IBCF is included then the S-CSCF will be used in the
route header.
**P-Charging-Vector:** The Transit-IOI either will be taken or set by the IBCF
and used for the charging.
**SDP:** Changes based on Feature-Caps header.
> **6\. SIP INVITE request (** S-CSCF-hA1 to AS-hA1**).**
>
> The S-CSCFâ€‘hA1 applies first filter criteria that is no specific procedures
> due to roaming.
>
> The S-CSCFâ€‘hA1 decides according to local policy that loopback routeing can
> be used and include a Featureâ€‘Caps header field according to RFC 6809 [21]
> with the \"+g.3gpp.home-visited\" header field parameter set to the
> identifier of the visited network received in the Pâ€‘Visitedâ€‘Networkâ€‘ID
> header field in the original registration request.
>
> The S-CSCF-hA1 replaces the received \"orig-ioi\" header field parameter
> value in the P-Charging-Vector header field with the type 3 \"orig-ioi\"
> header field parameter with a value identifying the home IMS network hA
> (i.e. \"homeâ€‘a\").
Table 5.3.10: SIP INVITE request S-CSCF-hA1 SIP Header Field to Information
Element
+----------------------+----------------------+----------------------+ | Chargeable Event / | Charging Event | | | Information | | | +----------------------+----------------------+----------------------+ | SIP Header Field | Example Content | Discussion and | | | | Information Element | +----------------------+----------------------+----------------------+ | Request-URI | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | To | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | From | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | P-Asserted-Service: | urn:urn-7:3gpp-se | IE: IMS | | | rvice.ims.icsi.mmtel | Communication | | | | Service ID | +----------------------+----------------------+----------------------+ | Contact: | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | Route: | Received: | IE: Route Header | | | | Received | | | sip:home-abc\@scscf | | | | -hA1.home-A.net;lr> | IE: Route Header | | | | Transmitted | | | transmitted: | | | | | Only the received | | | Route: | information will be | | | \, | case. The | | | \ | information is here | | | | not relevant | +----------------------+----------------------+----------------------+ | P- | see table 5.3.2 | see table 5.3.2 | | Access-Network-Info: | | | +----------------------+----------------------+----------------------+ | Via: | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | Feature-Caps | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | P-Charging Vector | orig-ioi=\"Type | IE: IE: Inter | | Header | 3home-a\" | Operator Identifiers | | | | | | | | This field is set by | | | | the S-CSCF when | | | | sending the request | | | | to the AS. | +----------------------+----------------------+----------------------+ | Stored in the S-CSCF | | IE: IMS Visited | | during Registration | | Network Identifier | +----------------------+----------------------+----------------------+
**Record-Route:** Changes but is not relevant for charging.
> **Route:** Possibly changes to address the AS and will be included needed
> for S-CSCF CDR in the field \"SIP Route header transmitted\".
**SDP: C** hanges based on Feature-Caps header. No change of visited realm
since S-CSCF is not media aware.
**P-Charging-Vector:** The orig-ioi will change it from Type 1 (visited-a) to
Type 3 (home-a) and be used for the charging.
**P-Asserted-Service:** This header is the asserted version of the
P-Preferred-Service and will be included needed for S-CSCF CDR.
> **7\. SIP INVITE request (** AS-hA1 to S-CSCF-hA1**).**
The AS sends an SIP INVITE message back towards the S-CSCF. The AS decides to
suppress loopback to the VPLMN, and, hence, removes the Feature-Caps header
field +g.3gpp.home-visited.
NOTE: Of course, the AS also has multiple other options to influence the
further call handling, including a\ potential modification of the final
destination of the call. This is not considered here.
Table 5.3.11: SIP INVITE request AS-hA1 SIP Header Field to Information
Element
+----------------------+----------------------+----------------------+ | Chargeable Event / | Charging Event | | | Information | | | +----------------------+----------------------+----------------------+ | SIP Header Field | Example Content | Discussion and | | | | Information Element | +----------------------+----------------------+----------------------+ | Request-URI | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | To | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | From | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | P-Asserted-Service: | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | Contact: | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | Route: | Received: | IE: none | | | | | | | Route: | no information will | | | \, | | | | \ | | | | | | | | transmitted: | | | | | | | | Route: | | | | \ | | +----------------------+----------------------+----------------------+ | P- | see table 5.3.2 | see table 5.3.2 | | Access-Network-Info: | | | +----------------------+----------------------+----------------------+ | Via: | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | Feature-Caps | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | P-Charging Vector | orig-ioi=\"Type | IE: Inter Operator | | Header | 3home-a\" | Identifiers | | | | | | | | This field is set by | | | | the AS when sending | | | | the request to the | | | | S-CSCF this depends | | | | on the domain of the | | | | AS. In this case the | | | | AS is in the same | | | | network home-a | +----------------------+----------------------+----------------------+
**Record-Route:** Changes but is not relevant for charging.
**Route:** Possibly changes to address the AS and will be included needed for
S-CSCF CDR in the field \"SIP Route header transmitted\".
**P-Charging-Vector:** Keeps orig-ioi Type 3 (home-a) and be used for the
charging.
**P-Asserted-Service:** This header is the asserted version of the
P-Preferred-Service and will be included needed for AS CDR.
> **8\. SIP INVITE request (S-CSCF-hA1 to IBCF-hA2).**
When the S-CSCFâ€‘hA1 receives the initial SIP INVITE request back from the
ASâ€‘hA1 and if no further services apply then the S-CSCFâ€‘hA1 decides according
to local policy if loopback routeing shall be used or not. In this use case
loopback will not apply. The S-CSCFâ€‘hA1 removes the Feature-Caps header field
\"*;+g.3gpp.trf\" from the SIP INVITE request.
Table 5.3.12: SIP INVITE request S-CSCF-hA1 SIP Header Field to Information
Element
+----------------------+----------------------+----------------------+ | Chargeable Event / | Charging Event | | | Information | | | +----------------------+----------------------+----------------------+ | SIP Header Field | Example Content | Discussion and | | | | Information Element | +----------------------+----------------------+----------------------+ | Request-URI | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | To | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | From | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | P-Asserted-Service: | urn:urn-7:3gpp-se | IE: IMS | | | rvice.ims.icsi.mmtel | Communication | | | | Service ID | +----------------------+----------------------+----------------------+ | Contact: | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | Route: | Received: | IE: Route Header | | | | Received | | | Route: | | | | \ | route header | | | | received by the AS. | | | transmitted: | For the S-CSCF the | | | | route header | | | \ | is relevant. | | | | | | | | IE: Route Header | | | | Transmitted | | | | | | | | This field is | | | | present for requests | | | | toward the served | | | | user and for | | | | requests from the | | | | served user when | | | | "VPLMN routing" is | | | | applied in a Roaming | | | | Architecture for | | | | Voice over IMS with | | | | Local breakout. | +----------------------+----------------------+----------------------+ | P- | see table 5.3.2 | see table 5.3.2 | | Access-Network-Info: | | | +----------------------+----------------------+----------------------+ | Via: | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | Feature-Caps | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | P-Charging Vector | orig-ioi=\"Type | IE: Inter Operator | | Header | 3home-a\" | Identifiers | | | | | | | | This field is set by | | | | the S-CSCF when | | | | sending the request | | | | to the AS. | +----------------------+----------------------+----------------------+ | Stored in the S-CSCF | | IE: IMS Visited | | during Registration | | Network Identifier | +----------------------+----------------------+----------------------+
Table 5.3.13: SDP portion of SIP 200 OK response P-CSCF-vA1 Information
Elements
+----------------------------------+----------------------------------+ | **SIP header field Content-Type |** Discussion and Charging Event | | set to application/sdp**| IE** | | | | | **Example of SDP Content** | | +----------------------------------+----------------------------------+ | v=0 | Final answer contains the SDP ut | | | will be finally included into | | o=- 2987933615 2987933615 IN IP4 | \"SDP Session Description\" and | | \ (A_BGFvA1: | \"SDP Media Component\" when the | | IMS Access Gateway assigned to | SDP was made reliable (i.e. with | | P-CSCF) | SIP 200 OK) or an early session | | | apply. | | s= | | | | | | t=0 0 | | | | | | c=IN IP4 \ | | | | | | m=audio \ | | | RTP/AVP 96 97 | | | | | | a=curr:qos local yes | | | | | | a=curr:qos remote yes | | | | | | a=des:qos mandatory local | | | sendrecv | | | | | | a=des:qos mandatory remote | | | sendrecv | | | | | | a=rtpmap:97 AMR | | | | | | a=fmtp:97 mode-set=0,2,5,7; | | | mode-change-period=2 | | | | | | a=rtpmap:96 telephone-event | | | | | | a=maxptime:20 | | +----------------------------------+----------------------------------+
**Record-Route:** Changes but is not relevant for charging.
**Route:** Points to the exit point which is the IBCF-hA2 and will be included
needed for S-CSCF CDR in the field \"SIP Route header transmitted\".
**P-Charging-Vector:** Keeps orig-ioi Type 3 (home-a) and be used for the
charging.
**P-Asserted-Service:** This header is the asserted version of the
P-Preferred-Service and will be included needed for AS CDR.
> **9- 29. SIP Other SIP signalling which is not relevant for charging see TR
> 29.949 [217]**
>
> Mainly the 100rel and preconditions will possibly apply when requested. In
> case where preconditions apply the final SDP Answer will be within the SIP
> 200 OK (UPDATE) response. This is charging relevant to verify if the already
> collected SDP is correct.
**29- 37. SIP 200 (OK) response to the SIP INVITE request (BGCF-hA to UE-A).**
When the IBCFâ€‘hA2 receives the SIP 200 (OK) response the IBCFâ€‘hA2 sends the
SIP 200 (OK) response according to TS 24.229 [106] towards the UEâ€‘A via the
S-CSCFâ€‘hA1, ASâ€‘hA1, IBCFâ€‘hA1, ICâ€‘A1, IBCFâ€‘vA1, P-CSCFâ€‘vA1 path as described
within TS 24.229 [106]. The SIP 200 (OK) will be routed accordingly the
content of the via header which is not relevant for charging.
Each entity will trigger the Charging Data Request[Start] and opens a CDR for
the related function.
Table 5.3.14: SIP 200 (OK) response S-CSCF-hA1 SIP\ Header Field to
Information Element in step 29
+----------------------+----------------------+----------------------+ | Chargeable Event / | Charging Event | | | Information | | | +----------------------+----------------------+----------------------+ | SIP Header Field | Example Content | Discussion and | | | | Information Element | +----------------------+----------------------+----------------------+ | Request-URI | no Request URI | no change | | | contained in | | | | Response | | +----------------------+----------------------+----------------------+ | To | contains a tag | IE: none | | | compared to the SIP | | | | SIP INVITE request | This header does | | | | have no relevance | | | | for charging. | | | | | | | | Editors Note: | | | | Question is if the | | | | tag is tracked since | | | | this is part of the | | | | SIP Dialog ID | | | | defined in | | | | RFC 3261 [404] (A | | | | dialog is identified | | | | at each UA with a | | | | dialog ID, which | | | | consists of | | | | | | | | A Call-ID value, a | | | | local tag and a | | | | remote tag.) | +----------------------+----------------------+----------------------+ | From | see table 5.3.2 | no change | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | see table 5.3.2 | see table 5.3.2 | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | userB\ | IE: Called Asserted | | | _public1\@home-B.net | Identity | +----------------------+----------------------+----------------------+ | P-Asserted-Service: | urn:urn-7:3gpp-se | no change | | | rvice.ims.icsi.mmtel | | +----------------------+----------------------+----------------------+ | Contact: | see table 5.3.2 | | +----------------------+----------------------+----------------------+ | Route: | no Route header | no change | | | included in the | | | | Response | | +----------------------+----------------------+----------------------+ | P- | not included | not included | | Access-Network-Info: | | | +----------------------+----------------------+----------------------+ | Via: | included and used | no change | | | for routeing back | | +----------------------+----------------------+----------------------+ | Feature-Caps | not included since | no change | | | no loopback | | +----------------------+----------------------+----------------------+ | P-Charging Vector | orig-ioi=\"home-a\"; | IE: Inter Operator | | Header | | Identifiers | | | transit-ioi | | | | =\"any-IC-network\"; | IE: Transit-IOI List | | | term-ioi=\"home-b\" | | | | | The Transit-IOI | | | | received and the | | | | term-ioi will be | | | | included now into | | | | the IE | +----------------------+----------------------+----------------------+
> **P-Charging-Vector: The settings of the ioi values are important and
> relevant for charging:**
**\- in** step **29 the \"term-ioi\"header field parameter includes a type-2
IOI value which identifies the home network of the terminating user. The
\"transit-ioi\" header field parameter includes one or more values identifying
the transit networks passed**. The \"orig-ioi\" is set to the same type-2 IOI
value that was included in the initial SIP INVITE request by the home network
A towards the terminating user;
Table 5.3.15: SIP 200 (OK) response content of ioi step 29
+----------------------+----------------------+----------------------+ | Chargeable Event / | Charging Event | | | Information | | | +----------------------+----------------------+----------------------+ | P-Charging Vector | orig-io | IE: Inter Operator | | Header | i=\"Type_3home-a\"; | Identifiers | | | | | | | term-i | IE: Transit-IOI List | | | oi=\"Type_3home-a\" | | | | | The Transit-IOI | | | | received and the | | | | term-ioi will be | | | | included now into | | | | the IE | +----------------------+----------------------+----------------------+
\- in step 30 the \"**term-ioi\" includes a type-3 IOI value (prefix \"Type
3\") which identifies the S-CSCF-hA1 network.** The \"orig-ioi\" is set to the
same type-3 IOI value that was included in the initial SIP INVITE request from
the AS-hA1 to the S-CSCF;
Table 5.3.16: SIP 200 (OK) response content of ioi step 31
+----------------------+----------------------+----------------------+ | Chargeable Event / | Charging Event | | | Information | | | +----------------------+----------------------+----------------------+ | P-Charging Vector | orig-io | IE: Inter Operator | | Header | i=\"Type_3home-a\"; | Identifiers | | | | | | | term-i | IE: Transit-IOI List | | | oi=\"Type_3home-a\" | | | | | The Transit-IOI | | | | received and the | | | | term-IOI will be | | | | included now into | | | | the IE | +----------------------+----------------------+----------------------+
\- in step 31 the \"term-ioi\" includes a type-3 IOI value (prefix \"Type 3\")
which identifies the AS-hA1 network. The \"orig-ioi\" is set to the same
type-3 IOI value that was included in the initial INVITE request from the
Sâ€‘CSCF to the AS-hA1; and
\- in steps 33-37 the \"term-ioi\" header field parameter includes a type-1
IOI value (prefix \"Type 1\") which identifies the home network A. The
\"transit-ioi\" header field parameter includes one or more values identifying
the transit networks passed. The \"orig-ioi\" is set to the same type-1 IOI
value that was included in the initial SIP INVITE request from the visited
network A towards the home network A.
Table 5.3.17: SIP 200 (OK) response content of ioi step 36
+----------------------+----------------------+----------------------+ | Chargeable Event / | Charging Event | | | Information | | | +----------------------+----------------------+----------------------+ | P-Charging Vector | orig-io | IE: Inter Operator | | Header | i=\"Type_1home-a\"; | Identifiers | | | | | | | transit-ioi=\" | IE: Transit-IOI List | | | ICa.1\"; | | | | | The Transit-IOI | | | term-ioi= | received and the | | | \"Type_1visited-a\" | term-IOI will be | | | | included now into | | | | the IE | +----------------------+----------------------+----------------------+
## 5.4 Mobile Originating Call with loopback
This clause reflects the originating call setup from a mobile subscriber who
is roaming in a foreign network, with loopback, i.e. including support of
Optimized Media Routeing (OMR).
OMR can be applied by entities in the IP Multimedia Subsystem (IMS) that
control media resources and are capable of manipulating the Session
Description Protocol (SDP).
OMR procedures relates to the handling of OMR-specific SDP attributes that are
documented in TS 24.229 [106]. The OMR procedures use SDP offer/answer related
procedures in RFC 3264 [407] and in TS 24.229 [106].
More detail of OMR is given in TS 29.079 [215]. The loopback use case is shown
in TS 29.079 [215] clause A.6.
The complete SIP flow is shown in TR 29.949 [217]. This clause shows the
charging relevant messages and elements.
Figure 5.4.1: MOC Roaming Call Flow, with loopback
After the registration procedure, the addresses of the P-CSCF and possibly the
S-CSCF are known in UE (A).\ Furthermore, the P-CSCF has received see
subclause 5.3.
In case of ISIM these parameters are taken from the relevant ISIM data fields.
(see also subclause 5.1)
In case of an USIM with AKA authentication, parameters will be set as follows:
\- Home Network: (from IMSI) see subclause 5.1.1.2 e.g.
ims.mnc015.mcc234.3gppnetwork.org
\- IMPU and user name (temporary IMPU from IMSI) e.g. 234150999999999@
ims.mnc015.mcc234.3gppnetwork.org
The IMPU(s) provided by the UE might be temporary. During the registration
procedure, the P-CSCF will receive one or several IMPUs assigned to the served
user from the HPLMN. Just one of these IMPUs assigned by the HPLMN can be used
as P-Asserted-Identity. The IMPU from P-Asserted-Identity is used for P-CSCF
CDRs as content for the \"Calling Party Number\" field.
The S-CSCF will return all the registered IMPU\'s within the P-Associated-URI
header which are belonging to the implicit registration set. The implicit
registration is set in the HSS configuration option where one or more IMPU\'s
can be bind together. i.e. on UA is reachable under different IMPUS.
In detail, the messages in the call flow depicted in Figure 5.1.1-1 contain
the following information:
> **1\. SIP INVITE request (UE-A to P-CSCF-vA1).**
>
> The session is initiated by sending a SIP:INVITE from UE A to the P-CSCF:\
> SIP INVITE for sip:userB_public1\@home-A.net\ (it is assumed that the UE
> will assign the home domain as shown in subclause 5.1.1.2 e.g.
> ims.mnc015.mcc234.3gppnetwork.org)
Table 5.4.1: SIP INVITE request (UE-A to P-CSCF-vA1)
INVITE tel:+4687197378 SIP/2.0 or sip: sip:userB_public1\@home-A.net
To: \ or sip: sip:userB_public1\@home-A.net
From: \;tag=4fa3
P-Preferred-Identity: \
P-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
Contact: \
CSeq: 1 INVITE
Route: \,\
P-Access-Network-Info: 3GPP-E-UTRAN-TDD;utran-cell-id-3gpp=234151D0FCE11
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Other SIP header fields and SDP according to TS 24.229 [106]
> **2.-7. SIP INVITE request (P-CSCF-vA1 to S-CSCF-hA1).**
The Call Flow and the data used for the charging relevant Information Elements
are the same as shown in clause 5.3.
SDP changes are also shown in clause 5.3 and apply accordingly.
Table 5.4.2: SIP INVITE request P-CSCF-vA1 SIP Header Field to Information
Element
+----------------------+----------------------+----------------------+ | Chargeable Event / | Charging Event | | | Information | | | +----------------------+----------------------+----------------------+ | SIP Header Field | Example Content | Discussion and | | | | Information Element | +----------------------+----------------------+----------------------+ | Request-URI | userB_public1\@h | IE: Called Party | | | ome-A.net;user=phone | Address | | | | | | | | In the context of an | | | | end-to-end SIP | | | | transaction this | | | | field holds the | | | | address of the party | | | | (Public User ID) to | | | | whom the SIP | | | | transaction is | | | | posted. For | | | | emergency calls, | | | | this parameter could | | | | contain an URN. | | | | | | | | The Called Party | | | | Address IE shall be | | | | populated with the | | | | SIP URI or TEL URI | | | | contained in the | | | | Request-URI of the | | | | outgoing request. | +----------------------+----------------------+----------------------+ | To | \ | This header does | | | | have no relevance | | | | for charging. | +----------------------+----------------------+----------------------+ | From | \;tag=4fa3 | The from header | | | | field is not an | | | | asserted identity, | | | | i.e. not trusted. | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | \ | Address\" | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | tel:+1-237-555-1111 | \"Calling Party | | (Note) | | Address\" | +----------------------+----------------------+----------------------+ | P-Preferred-Service: | urn:urn-7:3gpp-se | This is the | | | rvice.ims.icsi.mmtel | requested service | | | | which will be | | | | notified by the | | | | S-CSCF and then | | | | changed to the | | | | P-Asserted Service. | | | | This header will not | | | | be included in an | | | | IE. | +----------------------+----------------------+----------------------+ | Contact: | \ | | | | ;+sip.in | Other parts of the | | | stance=\"\\" | | +----------------------+----------------------+----------------------+ | Route: | Received: | IE: Route Header | | | | Received | | | \,\ | IE: Route Header | | |  | | | | | The Route header | | | Transmitted: | field from the | | | | received SIP INVITE | | | \,\ | sent SIP INVITE will | | |  | | +----------------------+----------------------+----------------------+ | P- | 3GPP-E-UT | IE: Access Network | | Access-Network-Info: | RAN-TDD;utran-cell-i | Information | | | d-3gpp=234151D0FCE11 | | | | | IE: Additional | | | | Access Network | | | | Information | | | | | | | | In case there are | | | | two header fields | | | | available then the | | | | information will be | | | | written into both. | | | | That will happen | | | | when a network | | | | provided and user | | | | provided information | | | | will appear. | +----------------------+----------------------+----------------------+ | Via: | SIP/2.0/UDP | Via header is used | | | [5555 | for SIP responses to | | | ::aaa:bbb:ccc:ddd]; | follow the same way | | | b | as the Request was | | | ranch=z9hG4bKnashds7 | sent. | | | | | | | | Information out of | | | | the Via header field | | | | will not be used. | +----------------------+----------------------+----------------------+ | Feature-Caps | *;+g.3gpp. | The feature caps | | | trf=\"\\" | information about | | | | the TRF address. | | | | This information is | | | | currently not | | | | included in an IE. | +----------------------+----------------------+----------------------+ | P-Charging Vector | i | IE: | | Header | cid-value=\"AyretyU0 | IMS | | | dm+6O2IrT5tAFrbHLso= | -Charging-Identifier | | | 0235510 | | | | 24\";orig-ioi=\"Type | IE: Inter Operator | | | 1visited-a\" | Identifiers | | | | | | | | he header includes | | | | so far the ICID and | | | | Orig-IOI which will | | | | be included into the | | | | \" | | | | IMS-C | | | | harging-Identifier\" | | | | and into the \"Inter | | | | Operator | | | | Identifiers\" | +----------------------+----------------------+----------------------+ | Dependend on the | | IE: Role of Node | | call direction. | | | | | | This will be filled | | | | with the value 0 | | | | which is the | | | | ORIGINATING_ROLE | +----------------------+----------------------+----------------------+ | Stored in the P-CSCF | | IE: IMS Visited | | during Registration | | Network Identifier | +----------------------+----------------------+----------------------+ | Note: In some | | | | circumstances a | | | | second | | | | P-Asserted-Identity | | | | will be added. This | | | | is dependent on the | | | | UE if it is a | | | | privileged user or | | | | the implicit | | | | registered public | | | | user identities or | | | | the call is an | | | | emergency call.\ | | | | in our use case it | | | | is assumed that the | | | | implicitly | | | | registered | | | | identities | | | | represents also a | | | | tel URI. | | | +----------------------+----------------------+----------------------+
Table 5.4.3: SDP portion of SIP INVITE request P-CSCF-vA1 mapping to
Information Elements
+----------------------------------+----------------------------------+ | SIP header field Content-Type | Discussion and Charging Event IE | | set to application/sdp | | | | | | Example of SDP Content | | +----------------------------------+----------------------------------+ | v=0 | IE: List of SDP Media Components | | | | | o=- 2987933615 2987933615 IN IP4 | Initial offer contains the SDP | | \ (A_BGFvA1: | offer but will be finally | | IMS Access Gateway assigned to | included into \"SDP Session | | P-CSCF) | Description\" and \"SDP Media | | | Component\" when the SDP was | | s= | made reliable (i.e. with 200 OK | | | or PRACK/200 OK when | | t=0 0 | preconditions apply). | | | | | c=IN IP4 \ | | | | | | m=audio \ | | | RTP/AVP 96 97 | | | | | | a=curr:qos local none | | | | | | a=curr:qos remote none | | | | | | a=des:qos mandatory local | | | sendrecv | | | | | | a=des:qos optional remote | | | sendrecv | | | | | | a=rtpmap:97 AMR | | | | | | a=fmtp:97 mode-set=0,2,5,7; | | | mode-change-period=2 | | | | | | a=rtpmap:96 telephone-event | | | | | | a=maxptime:20 | | +----------------------------------+----------------------------------+
Note 1: The principals of the IMS Access Gateway are described within TS
23.228 [107] Annex
> **8\. SIP INVITE request (S-CSCF-hA1 to IBCF-hA1).**
>
> When the S-CSCFâ€‘hA1 receives the initial SIP INVITE request and the
> \"g.3gpp.home-visited\" Feature-Caps header field parameter is still in the
> request, the S-CSCFâ€‘hA1 decides according to local policy that loopback
> routeing will be used.
>
> The S-CSCFâ€‘hA1 includes:
>
> \- the TRF URI included in the \"+g.3gpp.trf\" Feature-Caps header field
> parameter in the Route header field;
>
> \- a Feature-Caps header field with the \"+g.3gpp.loopback\" header field
> parameter to indicate that loopback routeing is ongoing. The
> \"+g.3gpp.loopback\" header field parameter can optionally contain the name
> of the home network; and
>
> \- the \"orig-ioi\" header field parameter within the P-Charging-Vector
> header field will be replaced by a type 1 IOI which reflects the home
> network of user A (i.e. \"home-a\"). Any \"transit-ioi\" header field
> parameter for the path P-CSCF-vA1 to S-CSCF-hA1 will not be maintained after
> this point.
>
> The S-CSCFâ€‘hA1 removes the \"+g.3gpp.home-visited\" Feature-Caps header
> field parameter.
NOTE: Number normalization and ENUM translation is deferred to the visited
network according to local policy.
The SIP INVITE request is sent according to TS 24.229 [106] to the IBCF-hA1.
Table 5.4.4: SIP INVITE request S-CSCF-hA1 SIP Header Field to Information
Element
+----------------------+----------------------+----------------------+ | Chargeable Event / | Charging Event | | | Information | | | +----------------------+----------------------+----------------------+ | SIP Header Field | Example Content | Discussion and | | | | Information Element | +----------------------+----------------------+----------------------+ | Request-URI | userB_public1\@h | IE: Called Party | | | ome-B.net;user=phone | Address | | | | | | | | In the context of an | | | | end-to-end SIP | | | | transaction this | | | | field holds the | | | | address of the party | | | | (Public User ID) to | | | | whom the SIP | | | | transaction is | | | | posted. For | | | | emergency calls, | | | | this parameter could | | | | contain an URN. | | | | | | | | The Called Party | | | | Address IE shall be | | | | populated with the | | | | SIP URI or TEL URI | | | | contained in the | | | | Request-URI of the | | | | outgoing request. | +----------------------+----------------------+----------------------+ | To | see table 5.4.2 | see table 5.4.2 | +----------------------+----------------------+----------------------+ | From | see table 5.4.2 | see table 5.4.2 | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | see table 5.4.2 | see table 5.4.2 | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | see table 5.4.2 | see table 5.4.2 | +----------------------+----------------------+----------------------+ | P-Preferred-Service: | see table 5.4.2 | see table 5.4.2 | +----------------------+----------------------+----------------------+ | Contact: | \ | | | | | Was included when | | | | the SIP INVITE was | | | | received. | +----------------------+----------------------+----------------------+ | Route: | | IE: Route Header | | | | Received | | | | | | | | IE: Route Header | | | | Transmitted | | | | | | | | The Route header | | | | field from the | | | | received SIP INVITE | | | | as well as from the | | | | sent SIP INVITE will | | | | be included. | +----------------------+----------------------+----------------------+ | P- | | IE: Access Network | | Access-Network-Info: | | Information | | | | | | | | IE: Additional | | | | Access Network | | | | Information | | | | | | | | Was included when | | | | the SIP INVITE was | | | | received. | +----------------------+----------------------+----------------------+ | Via: | see table 5.4.2 | see table 5.4.2 | +----------------------+----------------------+----------------------+ | Feature-Caps | *;+g.3gpp. | The feature caps | | | trf=\"\\" | information about | | | | the TRF address. | | | | This information is | | | | currently not | | | | included in an IE. | +----------------------+----------------------+----------------------+ | P-Charging Vector | i | IE: | | Header | cid-value=\"AyretyU0 | IMS | | | dm+6O2IrT5tAFrbHLso= | -Charging-Identifier | | | 023551024\" | | | | ;orig-ioi=\"home-a\" | IE: Inter Operator | | | | Identifiers | | | | | | | | the header includes | | | | so far the ICID and | | | | Orig-IOI which will | | | | be included into the | | | | \" | | | | IMS-C | | | | harging-Identifier\" | | | | and into the \"Inter | | | | Operator | | | | Identifiers\" | +----------------------+----------------------+----------------------+ | Dependend on the | | IE: Role of Node | | call direction. | | | | | | This will be filled | | | | with the value 0 | | | | which is the | | | | ORIGINATING_ROLE | +----------------------+----------------------+----------------------+
Table 5.4.5: SDP portion of SIP INVITE request S-CSCF-hA1 Information Elements
+----------------------------------+----------------------------------+ | SIP header field Content-Type | Discussion and Charging Event IE | | set to application/sdp | | | | | | Example of SDP Content | | +----------------------------------+----------------------------------+ | v=0 | Initial offer contains the SDP | | | offer but will be finally | | o=- 2987933615 2987933615 IN IP4 | included into \"SDP Session | | 192.0.2.1 | Description\" and \"SDP Media | | | Component\" when the SDP was | | s= | made reliable (i.e. with 200 OK) | | | or an early session apply. | | t=0 0 | | | | | | c= IN IP4 \ (TrGW: | | | media GW assigned to outgoing | | | IBCF) | | | | | | m=audio 49170 RTP/AVP 96 97 | | | | | | a=curr:qos local none | | | | | | a=curr:qos remote none | | | | | | a=des:qos mandatory local | | | sendrecv | | | | | | a=des:qos optional remote | | | sendrecv | | | | | | a=rtpmap:97 AMR | | | | | | a=fmtp:97 mode-set=0,2,5,7; | | | mode-change-period=2 | | | | | | a=rtpmap:96 telephone-event | | | | | | a=maxptime:20 | | | | | | m= audio \ RTP/AVP | | | 96 (invalid port) | | | | | | a=visited-realm:1 \ | | | IN IP4 \ | | | \ | | | | | | a=visited-realm:2 \ | | | IN IP4 \ | | | \ | | | | | | a=visited-realm:3 | | | \ IN IP4 | | | \ | | | \ | | | | | | a=visited-realm:4 \ | | | IN IP4 \ | | | \ | | +----------------------------------+----------------------------------+
> **9.-10. SIP INVITE request (IBCF-hA1 to IBCF-vA1).**
The SIP INVITE is sent via Ibcf-hA1.home-A.net and the VoIP IC network to the
Ibcf-vA1.visited-A.net of the VPLMN.
> When the IBCF-hA1 receives the initial SIP INVITE request containing the
> \"+g.3gpp.loopback\" header field parameter in a Feature-Caps header field,
> the IBCF-hA1 updates the SDP as defined within TS 29.079 [215].
>
> Since loopback apply within the SDP the visited realms are deleted. Thus to
> avoid the \"looped\" media routeing.
NOTE: The transit network in the loopback leg may be different compared to the
leg between VPLMN to HPLMN. This has no impact on the roaming itself since the
bilateral agreement has to reflect such possibilities. Technically neither
functional nor charging aspect differences are seen.
Table 5.4.6: SIP INVITE request IBCF-vA1 SIP Header Field to Information
Element
+----------------------+----------------------+----------------------+ | **Chargeable Event / | Charging Event | | | Information** | | | +----------------------+----------------------+----------------------+ | **SIP Header Field** | **Example Content** | Discussion and | | | | Information Element | +----------------------+----------------------+----------------------+ | Request-URI | see table 5.4.2 | see table 5.4.2 | +----------------------+----------------------+----------------------+ | To | see table 5.4.2 | see table 5.4.2 | +----------------------+----------------------+----------------------+ | From | see table 5.4.2 | see table 5.4.2 | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | see table 5.4.2 | see table 5.4.2 | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | see table 5.4.2 | see table 5.4.2 | +----------------------+----------------------+----------------------+ | P-Preferred-Service: | see table 5.4.2 | see table 5.4.2 | +----------------------+----------------------+----------------------+ | Contact: | see table 5.4.2 | see table 5.4.2 | +----------------------+----------------------+----------------------+ | Route: | Received: | IE: Route Header | | | | Received | | | \,\ | only the received | | |  | transmitted | +----------------------+----------------------+----------------------+ | P- | see table 5.4.2 | see table 5.4.2 | | Access-Network-Info: | | | +----------------------+----------------------+----------------------+ | Via: | see table 5.4.2 | see table 5.4.2 | +----------------------+----------------------+----------------------+ | Feature-Caps | see table 5.4.2 | see table 5.4.2 | +----------------------+----------------------+----------------------+ | P-Charging Vector | see table 5.4.2 | see table 5.4.2 | | Header | | | +----------------------+----------------------+----------------------+ | Dependend on the | | IE: Role of Node | | call direction. | | | | | | This will be filled | | | | with the value 0 | | | | which is the | | | | ORIGINATING_ROLE | +----------------------+----------------------+----------------------+
> The IE Role of Node will contain whether the IBCF is serving the Originating
> or the Terminating party. This field has now to be filled with the role of
> the originating party. It should be thought if a hint shall be given for the
> loopback case here.
Table 5.4.7: SDP portion of SIP INVITE request outgoing IBCF-vA1 Information
Elements
+----------------------------------+----------------------------------+ | **SIP header field Content-Type |** Discussion and Charging Event | | set to application/sdp**| IE** | | | | | **Example of SDP Content** | | +----------------------------------+----------------------------------+ | Additional Information due to | IE: none | | OMR will be added: | | | | Initial offer contains the SDP | | c= IN IP4 \ (TrGW: | offer but will be finally | | media GW assigned to outgoing | included into \"SDP Session | | IBCF) | Description\" and \"SDP Media | | | Component\" when the SDP was | | m= audio \ RTP/AVP | made reliable (i.e. with SIP 200 | | 96 (invalid port) | OK) or an early session apply. | | | | | a=visited-realm:1 \ | | | IN IP4 \ | | | \ | | | | | | a= visited-realm:2 \ | | | IN IP4 \ | | | \ | | +----------------------------------+----------------------------------+
> **11\. SIP INVITE request (IBCF-vA1 to TRF-vA1)**
>
> When the IBCF-vA1 receives the initial SIP INVITE request containing the
> \"+g.3gpp.loopback\" header field parameter in a Feature-Caps header field,
> the IBCF-vA1 searches for a possible optimal media path and detects that an
> optimal media path within the visited network is possible. The IBCFâ€‘vA1
> updates the SDP according to TS 29.079 [215].
>
> The IBCF-vA1 sends the SIP INVITE request according to TS 24.229 [106] to
> the TRF-vA1.
>
> The content of the Record-Route header field and the via header field will
> be based on local policy and updated accordingly.
Table 5.4.8: SDP portion of SIP INVITE request IBCF-hA1 I-CSCF-hA1 Information
Elements
+----------------------------------+----------------------------------+ | **SIP header field Content-Type |** Discussion and Charging Event | | set to application/sdp**| IE** | | | | | **Example of SDP Content** | | +----------------------------------+----------------------------------+ | Additional Information due to | IE: none | | OMR will be added: | | | | Initial offer contains the SDP | | c= IN IP4 \ | offer but will be finally | | (TrGW: media GW assigned to | included into \"SDP Session | | outgoing IBCF-hA1) | Description\" and \"SDP Media | | | Component\" when the SDP was | | m= audio \ RTP/AVP | made reliable (i.e. with SIP 200 | | 96 (invalid port) | OK) or an early session apply. | | | | | a=visited-realm:1 \ | | | IN IP4 \ | | | \ | | | | | | a= visited-realm:2 \ | | | IN IP4 \ | | | \ | | +----------------------------------+----------------------------------+
> **12.-13 SIP INVITE request (TRF-vA1 to IC-B1)**
The TRF detects that this is a \"loopback\" request from a roaming subscriber.
It decides on the routing towards the final destination of the call and
forwards the SIP INVITE to an appropriate network node.\ In the figure it is
assumed, that the destination is an IP connection outside the VPLMN, but other
options (CS connection, destination inside VPLMN) are also possible.
> When the TRFâ€‘vA1 receives the initial SIP INVITE request the TRFâ€‘vA1:
\- performs number normalization (if used by local policy) and ENUM
translation and possibly and updates the request-URI if necessary;
\- replaces an type 1 \"orig-ioi\" header field parameter value in the
P-Charging-Vector header field with a type 2 \"origâ€‘ioi\" header field
parameter value where the IOI value identifies the visited network;
\- possibly adds an additional Route header field pointing to the IBCFâ€‘vA1 and
also to the IC in cases where the IBCF-vA1 has no routeing decision to do;
\- removes the \"+g.3gpp.loopback\" header field parameter from the Feature-
Caps header field of the outgoing request; and
\- appends the \"iotl\" SIP URI parameter with the value \"visitedA-homeB\" to
the Request-URI.
> The TRFâ€‘vA1 selects an IBCF to act as an exit point and sends the SIP INVITE
> request according to TS 24.229 [106] to the IBCF-vA1 (which could be also
> another IBCF e.g. IBCFâ€‘vA2).
>
> The content of the Record-Route header field and the Via header field will
> be based on local policy and updated accordingly.
>
> The IE Role of Node will contain whether the TRF is serving the Originating
> or the Terminating party. This field has now to be filled with the role of
> the originating party. It should be thought if a hint shall be given for the
> loopback case here.
Table 5.4.9: SIP INVITE request TRF SIP Header Field to Information Element
+----------------------+----------------------+----------------------+ | Chargeable Event / | Charging Event | | | Information | | | +----------------------+----------------------+----------------------+ | SIP Header Field | Example Content | Discussion and | | | | Information Element | +----------------------+----------------------+----------------------+ | Request-URI | userB_public1\@h | IE: Called Party | | | ome-B.net;user=phone | Address | | | | | | | | In the context of an | | | | end-to-end SIP | | | | transaction this | | | | field holds the | | | | address of the party | | | | (Public User ID) to | | | | whom the SIP | | | | transaction is | | | | posted. For | | | | emergency calls, | | | | this parameter could | | | | contain an URN. | | | | | | | | The Called Party | | | | Address IE shall be | | | | populated with the | | | | SIP URI or TEL URI | | | | contained in the | | | | Request-URI of the | | | | outgoing request. | +----------------------+----------------------+----------------------+ | To | see table 5.4.2 | see table 5.4.2 | +----------------------+----------------------+----------------------+ | From | see table 5.4.2 | see table 5.4.2 | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | see table 5.4.2 | see table 5.4.2 | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | see table 5.4.2 | see table 5.4.2 | +----------------------+----------------------+----------------------+ | P-Preferred-Service: | see table 5.4.2 | see table 5.4.2 | +----------------------+----------------------+----------------------+ | Contact: | \ | | | | | Was included when | | | | the SIP INVITE was | | | | received. | +----------------------+----------------------+----------------------+ | Route: | | IE: Route Header | | | | Received | | | | | | | | IE: Route Header | | | | Transmitted | | | | | | | | The Route header | | | | field from the | | | | received SIP INVITE | | | | as well as from the | | | | sent SIP INVITE will | | | | be included. | +----------------------+----------------------+----------------------+ | P- | | IE: Access Network | | Access-Network-Info: | | Information | | | | | | | | IE: Additional | | | | Access Network | | | | Information | | | | | | | | Was included when | | | | the SIP INVITE was | | | | received. | +----------------------+----------------------+----------------------+ | Via: | see table 5.4.2 | see table 5.4.2 | +----------------------+----------------------+----------------------+ | Feature-Caps | *;+g.3gpp. | The feature caps | | | trf=\"\\" | information about | | | | the TRF address. | | | | This information is | | | | currently not | | | | included in an IE. | +----------------------+----------------------+----------------------+ | P-Charging Vector | i | IE: | | Header | cid-value=\"AyretyU0 | IMS | | | dm+6O2IrT5tAFrbHLso= | -Charging-Identifier | | | 023551024\" | | | | ;orig-ioi=\"home-a\" | IE: Inter Operator | | | | Identifiers | | | | | | | | the header includes | | | | so far the ICID and | | | | Orig-IOI which will | | | | be included into the | | | | \" | | | | IMS-C | | | | harging-Identifier\" | | | | and into the \"Inter | | | | Operator | | | | Identifiers\" | +----------------------+----------------------+----------------------+ | Dependend on the | | IE: Role of Node | | call direction. | | | | | | This will be filled | | | | with the value 0 | | | | which is the | | | | ORIGINATING_ROLE | +----------------------+----------------------+----------------------+
Table 5.4.10: SDP portion of SIP INVITE request outgoing TRF Information
Elements
+----------------------------------+----------------------------------+ | **SIP header field Content-Type |** Discussion and Charging Event | | set to application/sdp**| IE** | | | | | **Example of SDP Content** | | +----------------------------------+----------------------------------+ | Additional Information due to | IE: none | | OMR will be added: | | | | Initial offer contains the SDP | | c= IN IP4 \ (TrGW: media | offer but will be finally | | GW assigned to outgoing IBCF) | included into \"SDP Session | | | Description\" and \"SDP Media | | m= audio \ RTP/AVP | Component\" when the SDP was | | 96 (invalid port) | made reliable (i.e. with SIP 200 | | | OK) or an early session apply. | | a=visited-realm:1 \ | | | IN IP4 \ | | | \ | | +----------------------------------+----------------------------------+
> **14-30 provisional Responses and Preconditions (between UE A and B-Side)**
Provisional responses and possible precondition procedures are not shown.\
(provisional responses contains a Term-IOI field in the P-Charging-Vector for
further consideration steps 31-43 will give more information)
> **31-43. 200 (OK) response (IC-T1 to UEâ€‘A)**
>
> The media connection is established by sending the SIP 200 OK response back
> through all involved network nodes.
>
> When the IBCFâ€‘vV1 receives the SIP 200 (OK) response the IBCFâ€‘vA1 sends the
> 200 (OK) response according to TS 24.229 [106] towards the UEâ€‘A via the TRF,
> IBCF-vA1, IC-A1, IBCF-hA1, S-CSCFâ€‘hA1, ASâ€‘hA1, S-CSCFâ€‘hA1, IBCFâ€‘hA1, ICâ€‘A1,
> IBCFâ€‘vA1, P-CSCFâ€‘vA1 path as described within TS 24.229 [106].
**Table 5.4.11: SIP 200 (OK) response SIP Header Field to Information Element
in IBCF-vA1**
+----------------------+----------------------+----------------------+ | **Chargeable Event / |** Charging Event**| | | Information** | | | +----------------------+----------------------+----------------------+ | SIP Header Field | Example Content | **Discussion and | | | | Information | | | | Element** | +----------------------+----------------------+----------------------+ | Request-URI | no Request URI | no change | | | contained in | | | | Response | | +----------------------+----------------------+----------------------+ | To | contains a tag | This header does | | | compared to the SIP | have no relevance | | | INVITE request | for charging. | | | | | | | | Editors Note: | | | | Question is if the | | | | tag is tracked since | | | | this is part of the | | | | SIP Dialog ID | | | | defined in RFC3261 | | | | [404] (A dialog is | | | | identified at each | | | | UA with a dialog ID, | | | | which consists of | | | | | | | | A Call-ID value, a | | | | local tag and a | | | | remote tag.) | +----------------------+----------------------+----------------------+ | From | see table 5.4.2 | no change | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | userB\ | IE: Called Asserted | | | _public1\@home-B.net | Identity | +----------------------+----------------------+----------------------+ | P-Asserted-Service: | no Request URI | no change | | | contained in | | | | Response | | +----------------------+----------------------+----------------------+ | Contact: | | | +----------------------+----------------------+----------------------+ | Route: | no Route header | no change | | | included in the | | | | Response | | +----------------------+----------------------+----------------------+ | P- | not included | no change | | Access-Network-Info: | | | +----------------------+----------------------+----------------------+ | Via: | included and used | no change | | | for routeing bck | | +----------------------+----------------------+----------------------+ | Feature-Caps | not included since | no change | | | no loopback | | +----------------------+----------------------+----------------------+ | P-Charging Vector | ori | IE: Inter Operator | | Header | g-ioi=\"visited-a\"; | Identifiers | | | | | | | transit-ioi | IE: Transit-IOI List | | | =\"any-IC-network\"; | | | | term-ioi=\"home-b\" | The transit-ioi | | | | received and the | | | | Term-IOI will be | | | | included now into | | | | the IE | +----------------------+----------------------+----------------------+
> **P-Charging-Vector: The settings of the ioi values are important:**
>
> **\- 31. SIP 200 (OK) response (IC-T1 to IBCF-vA1) the \"term-ioi\" header
> field parameter includes a type-2 IOI value which identifies the home
> network of the terminating user. The \"transit-ioi\" header field parameter
> includes one or more values identifying the transit networks passed**. The
> \"orig-ioi\" is set to the same type-2 IOI value that was included in the
> initial SIP INVITE request by the home network A towards the terminating
> user.
Table 5.4.12: SIP 200 (OK) response content of IOI (**IC-T1 to IBCF-vA1**)
+----------------------+----------------------+----------------------+ | Chargeable Event / | Charging Event | | | Information | | | +----------------------+----------------------+----------------------+ | P-Charging Vector | ori | IE: Inter Operator | | Header | g-ioi=\"visited-a\"; | Identifiers | | | | | | | transit- | IE: Transit-IOI List | | | ioi=\"any-IC-network | | | | \"; | The Transit-IOI | | | | received and the | | | term-ioi=\"home-b\" | Term-IOI will be | | | | included now into | | | | the IE | +----------------------+----------------------+----------------------+
> \- 33-36. **SIP 200 (OK) response (IC-T1 to IBCF-vA1)** description what the
> TRF will include.
Table 5.4.13: SIP 200 (OK) response content of IOI **(TRF to IBCF-vA1)**
+----------------------+----------------------+----------------------+ | Chargeable Event / | Charging Event | | | Information | | | +----------------------+----------------------+----------------------+ | P-Charging Vector | orig-ioi=\"Type | IE: Inter Operator | | Header | 1home-a\"; | Identifiers | | | | | | | term-ioi=\" Type | IE: Transit-IOI List | | | 1visited-a\" | | | | | The Transit-IOI | | | | received and the | | | | Term-IOI will be | | | | included now into | | | | the IE | +----------------------+----------------------+----------------------+
Table 5.4.14: SIP 200 (OK) response content of IOI **(IBCF-hA1 to S-CSF-hA1)**
+----------------------+----------------------+----------------------+ | Chargeable Event / | Charging Event | | | Information | | | +----------------------+----------------------+----------------------+ | P-Charging Vector | orig-ioi=\"Type | IE: Inter Operator | | Header | 1home-a\"; | Identifiers | | | | | | | tr | IE: Transit-IOI List | | | ansit-ioi=\"IC-A1\"; | | | | | The Transit-IOI | | | term-ioi=\" Type | received and the | | | 1visited-a\" | Term-IOI will be | | | | included now into | | | | the IE | +----------------------+----------------------+----------------------+
\- 37. SIP 200 (OK) response (S-CSCF-hA1 to AS-hA1) the \"term-ioi\" includes
a type-3 IOI value (prefix \"Type 3\") which identifies the S-CSCF-hA1
network. The \"orig-ioi\" is set to the same type-3 IOI value that was
included in the initial SIP INVITE request from the AS-hA1 to the S-CSCF.
Table 5.4.15: SIP 200 (OK) response content of IOI **(S-CSCF-hA1 to AS-hA1)**
+----------------------+----------------------+----------------------+ | Chargeable Event / | Charging Event | | | Information | | | +----------------------+----------------------+----------------------+ | P-Charging Vector | orig-ioi=\"Type | IE: Inter Operator | | Header | 3AS-hA1\"; | Identifiers | | | | | | | term-ioi=\" Type 3 | IE: Transit-IOI List | | | home-a\" | | | | | The Transit-IOI | | | | received and the | | | | Term-IOI will be | | | | included now into | | | | the IE | +----------------------+----------------------+----------------------+
\- 38. **SIP 200 (OK) response (AS-hA1 to S-CSCF-hA1)** the \"term-ioi\"
includes a type-3 IOI value (prefix \"Type 3\") which identifies the AS-hA1
network. The \"orig-ioi\" is set to the same type-3 IOI value that was
included in the initial SIP INVITE request from the Sâ€‘CSCF to the AS-hA1; and
Table 5.4.16: SIP 200 (OK) response content of IOI **(AS-hA1 to S-CSCF-hA1)**
+----------------------+----------------------+----------------------+ | Chargeable Event / | Charging Event | | | Information | | | +----------------------+----------------------+----------------------+ | P-Charging Vector | orig-ioi=\"Type | IE: Inter Operator | | Header | 3home-a\"; | Identifiers | | | | | | | term-ioi=\" Type | IE: Transit-IOI List | | | 3AS-hA1 \" | | | | | The Transit-IOI | | | | received and the | | | | Term-IOI will be | | | | included now into | | | | the IE | +----------------------+----------------------+----------------------+
\- 39-42. **SIP 200 (OK) response (S-CSCF-hA1 to P-CCF-vA1)** the \"term-ioi\"
header field parameter includes a type-1 IOI value (prefix \"Type 1\") which
identifies the home network A. The \"transit-ioi\" header field parameter
includes one or more values identifying the transit networks passed. The
\"orig-ioi\" is set to the same type-1 IOI value that was included in the
initial SIP INVITE request from the visited network A towards the home network
A.
Table 5.4.17: SIP 200 (OK) response content of IOI **(IBCF-vA1 to P-CCF-vA1)**
+----------------------+----------------------+----------------------+ | Chargeable Event / | Charging Event | | | Information | | | +----------------------+----------------------+----------------------+ | P-Charging Vector | orig-ioi=\"Type | IE: Inter Operator | | Header | 1visited-a\"; | Identifiers | | | | | | | tr | IE: Transit-IOI List | | | ansit-ioi=\"IC-A1\"; | | | | | The Transit-IOI | | | term-ioi=\" Type | received and the | | | 1home-a\" | Term-IOI will be | | | | included now into | | | | the IE | +----------------------+----------------------+----------------------+
## 5.5 Routeing when the originating and terminating user reside in the same
home network
This clause describes routeing when the originating and terminating user
reside in the same home network.
This use case is a normal VoLTE IMS call without roaming. The originating and
terminating user are directly attached to the same home network. Thus a
consideration of roaming relevant charging issues is not needed.
## 5.6 Routeing from originating home to terminating home network
This clause describes routeing from the originating home network to the
terminating home network including transit network scenarios.
This use case is a normal IMS call between two home networks. The IC and
routing aspects of this use case do not differ from any other session set-up
between any two wire-line or mobile networks. The IC might be established via
CS-IC or PS-IC. Routing will be based on the destination given by the request
line (Called Party Number in case of CS-IC).
If originating and/or terminating user are directly or via roaming attached to
their home network does not change this scenario. There is no specific
signalling or roaming specific charging needed. It is a normal interconnection
between two networks. Thus a consideration of roaming relevant charging issues
is not needed.
## 5.7 Routeing from originating visited network to terminating home network
This clause describes routeing from the originating visited network to the
terminating home network including transit network scenarios.
The complete description of the scenario is shown in TR 29.949 [217] clause
5.7.
The scenario appears after the \"originating roaming without loopback\"
according to clause 5.3 or \"originating roaming with loopback\" according to
clause 5.4 has taken place. I.e. the call has already been set-up from the
P-CSCF in the originating visited network via IMS in the originating home
network back to the TRF in the originating visited network. This use case is
like a normal IMS call between two IMS networks from an IBCF acting as exit
point and an IBCF acting as entry point.
There is no specific signalling or roaming specific charging needed. It is a
normal interconnection between two networks. Thus a consideration of roaming
relevant charging issues is not needed.
## 5.8 Routeing in terminating home network when user resides in this network
This use case does not involve any interconnection network and is out of scope
of the present document.
## 5.9 Routeing from terminating home network to the terminating visited
network
This subclause describes routeing from the terminating home network to the
terminating visited network including the traversal of transit network between
the terminating home network and the terminating visited network.
Preconditions:
\- The UE-A is registered as described in subclause 5.2.
\- In the originating side the call can be routed either as a call without
loopback as described in subclause 5.3 or with loopback as described in
subclause 5.4.
\- The coding examples assume that the originating network, the
interconnection network and the terminating network are within the trust
domain.
Figure 5.9.1: Mobile terminating call from terminating home network to
terminating visited network
The steps of the flow are as follows:
> **1\. SIP INVITE request (IBCF-hA2 to I-CSCF-hA1) - see example in table
> 5.9.1.**
>
> An initial SIP INVITE request is received by the IBCF-hA2. Due to bilateral
> agreement all relevant SIP header fields are included. The IBCF-hA2 removes
> any received Route header field pointing to itself and forwards the call to
> the I-CSCFâ€‘hA1 according to TS 24.229 [106].
Table 5.9.1: SIP INVITE request (IBCF-hA2 to I-CSCF-hA1)
INVITE sip:+12375551111\@home-A.net;user=phone;iotl=homeA-homeB SIP/2.0
To: \
From: \;tag=4fa3
P-Asserted-Identity:
\,\;
P-Asserted-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
Contact: \
CSeq: 1 INVITE
Supported: 100rel,precondition
Route: \
Record-Route: \,\,\
P-Access-Network-Info: 3GPP-E-UTRAN-TDD;utran-cell-id-3gpp=234151D0FCE22,3GPP-
E-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE22;network-provided;local-time-
zone=\"UTC+01:00\";daylight-saving-time=\"01\"
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"home-r\";transit-ioi=\"ICt.1\"
Via: SIP/2.0/UDP ibcf-hA2.home-R.net;branch=z9hG4bK351g45.13
Via: SIP/2.0/UDP ic-T1.interconnection-T.net;branch=z9hG4bK351g45.12
Via: \
Other SIP header fields and SDP according to TS 24.229 [106]
> **Request-URI:** Contains the destination address for the SIP INVITE
> request. In this example a SIP URI with user=phone is used. It could be also
> a tel URI. The \"iotl\" SIP URI parameter indicates that this is call
> between two home networks and that the URI in the Request-URI is the
> destination. If the remote UE is roaming and loopback routeing is used, the
> \"iotl\" SIP URI parameter would be set to \"visitedAâ€‘homeB\".
>
> **P-Charging-Vector:** The P-Charging-Vector contains the type 2 \"orig-
> ioi\" of the call which is either the remote UE\'s home network or the
> remote UE\'s visited network when loopback applies. In this example the
> \"orig-ioi\" contains the remote UE\'s home network. Contains the \"transit-
> ioi\" header field parameter identifying the interconnection network.
>
> **Contact:** The Contact header field contains in this example the IP
> address of the remote UE. But due to network rules it could be also the IP
> address a downstream B2BUA.
>
> **Route:** The IBCF-hA2 adds a Route header field which points to I-CSCFâ€‘hA1
> in the home network hA.
>
> **Record-Route:** Depending on the policy of the intermediate network the
> content of the Record-Route header field can vary. The Record-Route header
> field includes all entries included in the received SIP INVITE request plus
> an entry of the incoming IBCF-hA2.
>
> **Via:** The Via header field includes all entries included in the received
> SIP INVITE request plus the entry of the incoming IBCF-hA2.
Table 5.9.2: SIP INVITE request IBCF-hA2 SIP Header Field to Information
Element
+----------------------+----------------------+----------------------+ | **Chargeable Event / | Charging Event | | | Information** | | | +----------------------+----------------------+----------------------+ | **SIP Header Field** | **Example Content** | Discussion and | | | | Information Element | +----------------------+----------------------+----------------------+ | Request-URI |  | | | | | In the context of an | | | | end-to-end SIP | | | | transaction this | | | | field holds the | | | | address of the party | | | | (Public User ID) to | | | | whom the SIP | | | | transaction is | | | | posted. For | | | | emergency calls, | | | | this parameter could | | | | contain an URN. | | | | | | | | The Called Party | | | | Address IE shall be | | | | populated with the | | | | SIP URI or TEL URI | | | | contained in the | | | | Request-URI of the | | | | outgoing request. | +----------------------+----------------------+----------------------+ | To | tel:+12375551111 | IE: none | | | | | | | | This header does | | | | have no relevance | | | | for charging. | +----------------------+----------------------+----------------------+ | From | tel:+4687197378 | IE: From Address | | | | | | | | The from Header | | | | field is not an | | | | asserted identity, | | | | i.e. not trusted. | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | sip:+4687197378\@h | \"Calling Party | | (Note) | ome-A.net;user=phone | Address\" | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | \,\ | | | | | Other parts of the | | | | contact are not | | | | used. | +----------------------+----------------------+----------------------+ | Route: | Received: | IE: Route Header | | | | Received | | | \ | Transmitted | | | | | | | Transmitted: | The Route header | | | | field from the | | | \ | as well as from the | | | | sent SIP INVITE will | | | | be included. | +----------------------+----------------------+----------------------+ | P- | 3GPP-E- | IE: Access Network | | Access-Network-Info: | UTRAN-TDD;utran-cell | Information | | | -id-3gpp=234151D0FCE | | | | 22,3GPP-E-UTRAN-TDD; | IE: Additional | | | utran-c | Access Network | | | ell-id-3gpp=234151D0 | Information | | | FCE22;network-provid | | | | ed;local-time-zone=\ | In case there are | | | "UTC+01:00\";dayligh | two header fields | | | t-saving-time=\"01\" | available then the | | | | information will be | | | | written into both. | | | | That will happen | | | | when a network | | | | provided and user | | | | provided information | | | | will appear. | +----------------------+----------------------+----------------------+ | Via: | Via: SIP/2.0/UDP | IE: none | | | ibc | | | | f-hA2.home-R.net;bra | Via header is used | | | nch=z9hG4bK351g45.13 | for SIP responses to | | | | follow the same way | | | Via: SIP/2.0/UDP | as the Request was | | | ic-T1.inter | sent. | | | connection-T.net;bra | | | | nch=z9hG4bK351g45.12 | Information out of | | | | the Via header field | | | Via: \ | | +----------------------+----------------------+----------------------+ | P-Charging Vector | icid-value=\"A | IE: | | Header | yretyU0dm+6O2IrT5tAF | IMS | | | rbHLso=023551024\";o | -Charging-Identifier | | | rig-ioi=\"home-r\";t | | | | ransit-ioi=\"ICt.1\" | IE: Inter Operator | | | | Identifiers | | | | | | | | he header includes | | | | so far the ICID and | | | | Orig-IOI which will | | | | be included into the | | | | \" | | | | IMS-C | | | | harging-Identifier\" | | | | and into the \"Inter | | | | Operator | | | | Identifiers\" | +----------------------+----------------------+----------------------+ | Stored in the P-CSCF | | IE: IMS Visited | | during Registration | | Network Identifier | +----------------------+----------------------+----------------------+ | Note: In some | | | | circumstances a | | | | second | | | | P-Asserted-Identity | | | | will be added. This | | | | is depended on the | | | | UE if it is a | | | | privileged user or | | | | the implicit | | | | registered public | | | | user identities or | | | | the call is an | | | | emergency call.\ | | | | in our use case it | | | | is assumed that the | | | | implicitly | | | | registered | | | | identities | | | | represents also a | | | | tel URI. | | | +----------------------+----------------------+----------------------+
Table 5.9.3: SDP portion of SIP INVITE request IBCF-hA2 Information Elements
+----------------------------------+----------------------------------+ | **SIP header field Content-Type |** Discussion and Charging Event | | set to application/sdp**| IE** | | | | | **Example of SDP Content** | | +----------------------------------+----------------------------------+ | v=0 | Initial offer contains the SDP | | | offer but will be finally | | o=- 2987933615 2987933615 IN IP4 | included into \"SDP Session | | 192.0.2.1 | Description\" and \"SDP Media | | | Component\" when the SDP was | | s= | made reliable (i.e. with SIP 200 | | | OK) or an early session apply. | | t=0 0 | | | | | | c=IN IP4 192.0.2.1 | | | | | | m=audio 49170 RTP/AVP 96 97 | | | | | | a=curr:qos local none | | | | | | a=curr:qos remote none | | | | | | a=des:qos mandatory local | | | sendrecv | | | | | | a=des:qos optional remote | | | sendrecv | | | | | | a=rtpmap:97 AMR | | | | | | a=fmtp:97 mode-set=0,2,5,7; | | | mode-change-period=2 | | | | | | a=rtpmap:96 telephone-event | | | | | | a=maxptime:20 | | +----------------------------------+----------------------------------+
> **2\. SIP INVITE request (I-CSCF-hA1 to S-CSCF-hA1)**
>
> When the I-CSCF-hA1 receives the initial SIP INVITE request it queries the
> SLF/HSS to identify the correct S**â€‘** CSCF where the call has to be routed
> to. Due to normal routing procedures the S-CSCF will be allocated by the HSS
> procedures as described in TS 24.229 [106].
>
> **Request-URI:** Contains the destination address for the SIP INVITE
> request. In this case the I-CSCF-hA1 changes the URI from a SIP URI
> user=phone to a tel URI as described in TS 24.229 [106].
>
> **Via:** The I-CSCFâ€‘hA1 adds a Via header field.
Table 5.9.4: SIP INVITE request I-CSCF-hA1 SIP Header Field to Information
Element
+----------------------+----------------------+----------------------+ | **Chargeable Event / | Charging Event | | | Information** | | | +----------------------+----------------------+----------------------+ | **SIP Header Field** | **Example Content** | Discussion and | | | | Information Element | +----------------------+----------------------+----------------------+ | Request-URI | see table 5.9.2 | see table 5.9.2 | +----------------------+----------------------+----------------------+ | To | see table 5.9.2 | see table 5.9.2 | +----------------------+----------------------+----------------------+ | From | see table 5.9.2 | see table 5.9.2 | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | see table 5.9.2 | see table 5.9.2 | +----------------------+----------------------+----------------------+ | P-Asserted-Identity | see table 5.9.2 | see table 5.9.2 | +----------------------+----------------------+----------------------+ | P-Preferred-Service: | see table 5.9.2 | see table 5.9.2 | +----------------------+----------------------+----------------------+ | Contact: | see table 5.9.2 | see table 5.9.2 | +----------------------+----------------------+----------------------+ | Route: | Received: | IE: Route Header | | | | Received | | |  | IE: Route Header | | | | Transmitted | | | Transmitted: | | | | | The Route header | | | \ | received SIP INVITE | | | | as well as from the | | | | sent SIP SIP INVITE | | | | will be included. | +----------------------+----------------------+----------------------+ | P- | see table 5.9.2 | see table 5.9.2 | | Access-Network-Info: | | | +----------------------+----------------------+----------------------+ | Via: | see table 5.9.2 | see table 5.9.2 | +----------------------+----------------------+----------------------+ | Feature-Caps | see table 5.9.2 | see table 5.9.2 | +----------------------+----------------------+----------------------+ | P-Charging Vector | see table 5.9.2 | see table 5.9.2 | | Header | | | +----------------------+----------------------+----------------------+
> **3.-4. SIP INVITE request (S-CSCF-hA1 to AS-hA1 to S-CSCF-hA1).**
>
> The S-CSCF applies the filter criteria to involve the AS for terminating
> services.
>
> **Record-Route:** The entries to this header field need to be added based on
> the related dip\'s to the AS. The AS could behave as B2BUA. In such case the
> AS could store the entries and setup a new Record**â€‘** Route header field
> only with the AS URI as an entry. Both the AS-hA1 and the S-CSCF-hA1 adds
> Record-Route header fields.
>
> **P-Charging-Vector:** Towards the ASâ€‘hA1 the P-Charging-Vector header field
> contains the type 3 \"orig-ioi\" identifying the network of the S-CSCF-hA1
> sending the request. Towards the Sâ€‘CSCFâ€‘hA1 the P-Charging-Vector header
> field contains the type 3 \"orig-ioi\" identifying the network of the ASâ€‘hA1
> sending the request.
>
> **Route:** The S-CSCF-hA1 adds a Route header field identifying the selected
> AS-hA1 and S**â€‘** CSCF**â€‘** hA1 for routing back.
>
> **Via:** Both the ASâ€‘hA1 and the S-CSCF-hA1 adds Via header fields.
>
> **5\. SIP INVITE request (S-CSCF-hA1 to IBCF-hA1)**
>
> Since the call is a terminating call no further specific information is
> needed for termination of the call.
>
> The S-CSCF-hA1 sends the SIP INVITE request according to TS 24.229 [106] to
> the IBCF-hA1.
>
> **Request-URI:** The Sâ€‘CSCFâ€‘hA1 replaces the received tel URI with the SIP
> URI received in the Contact header field from the UEâ€‘A during the
> registration.
>
> **Route:** The Sâ€‘CSCF includes a Route header field with the routeing
> information received in the Path header field during registration.
>
> **P-Charging-Vector:** The S-CSCF-hA1 replaces the received IOI type 3 value
> in the \"orig-ioi\" header field parameter with a IOI type 1 value
> identifying the home network of the UE-A.
>
> **Via:** The S-CSCF-hA1 adds a Via header field.
>
> **Record-Route:** The S-CSCF-hA1 adds a Record-Route header field.
>
> **6\. SIP INVITE request (IBCF-hA1 to IC-A1)**
>
> The IBCFâ€‘hA1 applies local policy which is dependent on the operator policy
> for roaming calls with that specific visited network and the intermediate
> transit network. Header fields can be deleted or anonymized.
>
> The IBCF-hA1 selects, based on the Route header field as shown table 5.9-5
> or in cases where the Path header field received during registration only
> points to the visited network, based on local policy, to route the SIP
> INVITE request via IC network A and sends the SIP INVITE request according
> to TS 24.229 [106] to the IC-A1.
>
> The IBCF-hA1 determines the next hop IP address from the URI in the first
> entry of the Route header field either by configured information or using a
> DNS query. If the subsequent interconnection network is SIP-aware, the
> determined IP address will belong to the SIP proxy IC-A1. Otherwise the
> determined IP address will point to IBCF-vA1 and step 7 is skipped (not
> reflected in message details below).
>
> The procedures apply to TS 24.229 [4].
>
> **Via:** The IBCF-hA1 adds a Via header field.
>
> **Record-Route:** The IBCF-hA1 adds a Record-Route header field.
>
> **7\. SIP INVITE request (IC-A1 to IBCF-vA1)**
NOTE 1: If the interconnection network is SIP-unaware, step 7 is skipped (not
reflected in message details below).
> Based on the Route header field, the IC-T1 selects an entry point (IBCF-vA1)
> of the visited IMS network vA and sends the SIP INVITE request according to
> TS 24.229 [106] to the IBCF-vA1.
>
> In our example the entry point of visited network vA is already included in
> the received Route header field. However, the IC- A1 can add a Route header
> field entry pointing to the entry point of the visited network vA if the
> entry point is missing.
>
> **P-Charging-Vector:** The IC-A1 adds the \"transit-ioi\" header field
> parameter identifying the interconnection network (i.e. ICa.1).
>
> **Via:** The IC-A1 adds a Via header field (i.e.
> ic-A1.interconnection-A.net).
>
> **Record-Route:** The IC-A1 adds a Record-Route header field (i.e.
> ic-A1.interconnection-A.net).
>
> **8\. SIP INVITE request (IBCF-vA1 to P-CSCF-vA1) - see example in table
> 5.9-8.**
>
> The IBCF-vA1 routes the call to the P-CSCF-vA1 as stated within the Route
> header field.
>
> IBCF-vA1 applies local policy based on trust relationship with the transit
> network and SLA between home network carrier and visited network carrier.
>
> If a \"transit-ioi\" header field parameter value exists within the
> P-Charging-Vector header field then the values can be forwarded or made
> void.
>
> In this example, the IBCF-vA1 does not add any \"transit-ioi\" header field
> parameter in the P-Charging-Vector header field. However, the IBCF-vA1 adds
> the \"transit-ioi\" header field parameter based on local policy, when the
> \"transit-ioi\" identifying the preceding interconnection network is not
> included in the received request (e.g. when the preceding interconnection
> network is not an IMS transit network).
>
> **Record-Route:** The IBCF-vA1 adds a Record-Route header field (i.e. IBCF-
> vA1).
>
> **Via:** The IBCFâ€‘vA1 adds a Via header field (i.e. IBCFâ€‘vA1).
>
> **9\. SIP INVITE request (P-CSCF-vA1 to UE-A)**
>
> The P-CSCF-vA1 routes the call to the UE-A as stated within Request-URI
> which contains the address of the UE-A.
>
> Based on privacy settings within the SIP INVITE request, the P-CSCFâ€‘vA1
> applies privacy according to IETF RFC 3323 [27] and IETF RFC 3325 [28].
>
> The P-CSCFâ€‘vA1 applies trust domain according to TS 24.229 [106] subclause
> 4.4. This will result in that some header fields will be removed. In our
> example the P-Charging-Vector header field and the P**â€‘** Access**â€‘**
> Network**â€‘** Info header field are removed from the outgoing SIP INVITE
> request.
>
> The P-CSCFâ€‘vA1 sends the SIP INVITE request according to TS 24.229 [106] to
> the UE-A.
>
> **Via:** The P-CSCF-vA1 adds a Via header field.
>
> **Record-Route:** The P-CSCF-vA1 adds a Record-Route header field.
>
> **10-18. 183 (Session Progress) response (UE-A to IBCF-hA2 via all
> intermediate nodes in the Via header fields)**
>
> The UE-A sends a 183 (Session Progress) response since 100rel and
> preconditions are supported by the remote UE.
>
> The routing towards the IBCF-hA2 is based on the Via header fields received
> by the UEâ€‘A in the initial SIP INVITE request.
>
> When the IBCFâ€‘hA2 receives the 183 (Session Progress) response, the IBCFâ€‘hA2
> sends the 183 (Session Progress) response according to TS 24.229 [106]
> towards the remote UE as described within subclause 5.3 or subclause 5.4 of
> the present document and regarding the rules defined in TS 24.229 [4].
>
> The table 5.9.4 shows the content of the 183 (Session Progress) response
> when sent by IBCF-hA1.
Table 5.9.5: SIP 183 (Session Progress) response (UE-A to IBCF-hA1) in step 14
SIP/2.0 183 Session Progress
To: \;tag=654a
From: \;tag=4fa3
P-Asserted-Identity: \
Contact: \
CSeq: 1 INVITE
Require:100rel,precondition
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.16
Via: SIP/2.0/UDP as-hA1.home-A.net;branch=z9hG4bK351g45.15
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.14
Via: SIP/2.0/UDP icscf-hA1.home-A.net;branch=z9hG4bK351g45.13a
Via: SIP/2.0/UDP ibcf-hA2.home-A.net;branch=z9hG4bK351g45.13
Via: SIP/2.0/UDP ic-T1.interconnection-T.net;branch=z9hG4bK351g45.12
Via: \
Record-Route: \,
\,\,
\,\,
\,\,
\,\,
\
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 1home-a\";transit-ioi=\"ICa.1\";term-ioi=\"Type 1visited-a\"
Other SIP header fields and SDP according to TS 24.229 [4].
**Require:** The UE-A inserts the Require header field containing the option-
tag \"100rel\" indicating reliable sending of the 183 (Session Progress)
response and the option-tag \"precondition\" indicating the usage of the
precondition mechanism.
**P-Charging-Vector:** The settings of the IOI values are important:
**\- SIP 183 (Session Progress) response (P-CSCF-vA1 to IBCF-vA1): The \"term-
ioi\" header field parameter includes a type 1 IOI value which identifies the
visited network of the terminating user** (i.e. **\"visitedâ€‘a\").** The
\"orig-ioi\" header field parameter is set to the same type 1 IOI value that
was included in the initial SIP INVITE request by the home network hA (i.e.
**\"homeâ€‘a\")** towards the terminating user.
\- **SIP 183 (Session Progress) response (IBCF-vA1 to IC-A1):** No change of
IOI values.
> \- **SIP 183 (Session Progress) response (IC-A1 to S-CSCF-hA1): The
> \"transit-ioi\" header field parameter includes one or more values
> identifying the transit networks passed between the visited network A and
> home network A** ; In our example only one value identifying the
> interconnect network A is included. If no \"transit-ioi\" header field
> parameter is included by the transit network (i.e. IC-A1) the IBCF-hA1 can
> include a \"transit-ioi\" header field parameter value identifying the
> preceding interconnect network.
>
> \- **SIP 183 (Session Progress) response (S-CSC-hA1 to S-CSCF-hA1):** The
> \"term-ioi\" header field parameter includes a type 3 IOI value (prefix
> \"Type 3\") which identifies the AS-hA1 network. The \"orig-ioi\" header
> field parameter is set to the same type 3 IOI value that was included in the
> initial SIP INVITE request from the Sâ€‘CSCFâ€‘hA1 to the AS-hA1, the \"transit-
> ioi\" is deleted by the S-CSCF based on the operator policy; and
\- **SIP 183 (Session Progress) response (S-CSCF-hA1 to IBCF-hA2):** The
\"term-ioi\" header field parameter includes a type 2 IOI value which
identifies the home network hA. The \"transit-ioi\" header field parameter is
not appearing. The S-CSCF removes received \"transit**â€‘** ioi\" values, the
IOI Type 1 or Type 3 in \"orig-ioi\" and \"term-ioi\" header field parameters.
The \"orig**â€‘** ioi\" header field parameter is set to the same type 2 IOI
value that was included in the initial SIP INVITE request from the remote home
network or, in case of loopback, from the remote visited network. The \"term-
ioi\" header field parameter is set to a Type 2 IOI value identifying the home
network A.
NOTE 2: If the interconnection network is SIP-unaware, step 13 is skipped.
> **19\. SIP PRACK request s (IBCF-hA2 to UEâ€‘A via all intermediate nodes) and
> SIP 200 (OK) response to the SIP PRACK request (UEâ€‘A to IBCF-hA2 via all
> intermediate nodes).**
The SIP PRACK request and the SIP 200 (OK) response to the SIP PRACK request
are sent without any SDP offer/SDP answer between the **IBCF-** hA2 **and the
UEâ€‘** A according to TS 24.229 [4]. The messages are sent via all intermediate
nodes with the exception of I**-** CSCF**-** hA1.
**20\. UPDATE requests (IBCF-hA2 to UE-A via all intermediate nodes) and SIP
200 (OK) response to the SIP UPDATE request (UE-A to IBCF-hA2 via all
intermediate nodes).**
When resources are reserved in the access network of the remote UE, the
IBCFâ€‘hA2 receives an UPDATE request from the remote network. The IBCF-hA2
forwards the request towards the UE-A. The messages are sent via all
intermediate nodes with the exception of I-CSCF-hA1.
**22-30. 180 (Ringing) response to the SIP INVITE request (UEâ€‘A to IBCF-hA2
via all intermediate nodes).**
NOTE 3: If the interconnection network is SIP-unaware, step 24 is skipped. The
messages are sent via all intermediate nodes including the I-CSCF-hA1.
**30\. SIP PRACK request s (IBCFâ€‘hA2 to UEâ€‘A via all intermediate nodes) and
SIP 200 (OK) response to the SIP PRACK request (UE-A to IBCF-hA2 via all
intermediate nodes).**
The SIP PRACK request and the SIP 200 (OK) response to the SIP PRACK request
are sent without any SDP offer/SDP answer between the UE-A and the IBCF-hA2
according to TS 24.229 [4]. The messages are sent via all intermediate nodes
with the exception of I-CSCF-hA1.
**31-39. SIP 200 (OK) response to the SIP INVITE request (UE-A to IBCF-hA2).**
NOTE 4: If the interconnection network is SIP-unaware, step 34 is skipped.
**\- SIP 200 (OK) response (P-CSCF-vA1 to IBCF-vA1) the \"term-ioi\" header
field parameter includes a type 1 IOI value which identifies the visited
network of the terminating user** (i.e. **\"visitedâ€‘a\").** The \"orig-ioi\"
header field parameter is set to the same type 1 IOI value that was included
in the initial INVITE request by the home network hA (i.e. **\"homeâ€‘a\")**
towards the terminating user;
Table 5.9.6: SIP 200 (OK) response content of IOI step 31-33
+----------------------+----------------------+----------------------+ | Chargeable Event / | Charging Event | | | Information | | | +----------------------+----------------------+----------------------+ | P-Charging Vector | orig-ioi=\" Type | IE: none | | Header | 1home-b\"; | | | | | IE: Transit-IOI List | | | term-ioi=\" Type | | | | 1visited-b\" | The Transit-IOI | | | | received and the | | | | Term-IOI will be | | | | included now into | | | | the IE | +----------------------+----------------------+----------------------+
NOTE 5: If the interconnection network is SIP-unaware, step 34 is skipped.
\- **SIP 200 (OK) response (IBCF-vA1 to IC-A1)** no change of IOI values;
> \- **SIP 200 (OK) response (IC-A1 to S-CSCF-hA1) the \"transit-ioi\" header
> field parameter includes one or more values identifying the transit networks
> passed between the visited network A and home network A** ; In our example
> only one value identifying the interconnect network A is included. If no
> \"transit-ioi\" header field parameter is included in step 34, the IBCF-hA1
> can include a \"transit-ioi\" header field parameter value identifying the
> preceding interconnect network.
Table 5.9.7: SIP 200 (OK) response content of IOI step 34-35
+----------------------+----------------------+----------------------+ | Chargeable Event / | Charging Event | | | Information | | | +----------------------+----------------------+----------------------+ | P-Charging Vector | orig-ioi=\" Type | IE: Inter Operator | | Header | 1home-b\"; | Identifiers | | | | | | | term-ioi=\" Type | IE: Transit-IOI List | | | 1visited-b\" | | | | | The Transit-IOI | | | t | received and the | | | ransit-ioi=\"ICa.1\" | Term-IOI will be | | | | included now into | | | | the IE | +----------------------+----------------------+----------------------+
> \- **SIP 200 (OK) response (S-CSCF-hA1 to AS to S-CSCF-hA1)** \"term-ioi\"
> header field parameter includes a type 3 IOI value (prefix \"Type 3\") which
> identifies the AS-hA1 network. The \"orig-ioi\" header field parameter is
> set to the same type 3 IOI value that was included in the initial INVITE
> request from the Sâ€‘CSCFâ€‘hA1 to the AS-hA1, the \"transit-ioi\" is deleted by
> the S-CSCF based on the operator policy; and
\- **SIP 200 (OK) response (S-CSCF-hA1 to IBCF-hA2)** the \"term-ioi\" header
field parameter includes a type 2 IOI value which identifies the home network
hA. The \"transit-ioi\" header field parameter is not appearing. The S-CSCF
removes received \"transit**â€‘** ioi\" values, the IOI Type 1 or Type 3 in
\"orig-ioi\" and \"term-ioi\" header field parameters. The \"orig**â€‘** ioi\"
header field parameter is set to the same type 2 IOI value that was included
in the initial INVITE request from the remote home network or, in case of
loopback, from the remote visited network. The \"term-ioi\" header field
parameter is set to a Type 2 IOI value identifying the home network A.
Table 5.9.8: SIP 200 (OK) response content of IOI step 38-39
+----------------------+----------------------+----------------------+ | Chargeable Event / | Charging Event | | | Information | | | +----------------------+----------------------+----------------------+ | P-Charging Vector | orig-ioi=\" | IE: Inter Operator | | Header | home-a\"; | Identifiers | | | | | | | term-ioi=\" home-b\" | IE: Transit-IOI List | | | | | | | | The Transit-IOI | | | | received and the | | | | Term-IOI will be | | | | included now into | | | | the IE | +----------------------+----------------------+----------------------+
**40-48. SIP ACK requests (IBCF-hA2 to UE-A via all intermediate nodes).**
> The IBCF-hA2 receives an SIP ACK request which acknowledges the SIP 200 (OK)
> final response, from the remote network. The IBCF-hA2 forwards the SIP ACK
> request to the UE-A according to TS 24.229 [4].
NOTE 6: If the interconnection network is SIP-unaware, step 46 is skipped.
## 5.10 Insertion of service related media in the originating home network
5.10.1 General
This clause describes insertion of a service related media in the originating
home network (i.e. invocation of MRFC/MRF).
TS 24.628 [218] describes how to include announcements into the path for IMS.
There are a couple of options which have to be considered for roaming.
The following clauses are showing some examples where service related media
can be included. The examples will not cover all possible scenarios defined
within 3GPP.
5.10.2 Insertion of service related media in the originating home network with
loopback
{width="6.6875in" height="7.756944444444445in"}
Figure 5.10.2.1: Announcement started during the establishment of a
communication
The calling party initiates a communication by means of an SIP INVITE request.
The SIP INVITE request is forwarded toward the called party.
Along the signalling path, created by the SIP INVITE request, some service
logic in an AS wants to send an announcement towards the calling party.
The flow is based on the assumptions that the Supported header field includes
the optionâ€‘tag \"100rel\".
For this case the information of loopback is very important to have a clear
statement that announcement was played by home network A and the media
interaction between UE-A and UE-B applies directly without involvement of home
network A.
The steps of the signalling flow are as follows:
**1.-5. SIP INVITE request (UEâ€‘A to S-CSCF-hA1 via P-CSCF-vA1, IBCF-vA1, IC-A1
and IBCF-hA1)**
> The SIP INVITE request is sent as described within clause 5.3.
NOTE 1: If the interconnection network is SIP-unaware, step 4 is skipped.
> For the consideration of Chargeable Event / Information for the INVITE
> request for the mapping to the Information Elements at the P-CSCF-vA1 table
> 5.3.2, at the IBCF-vA1 table 5.3.4, TF table 5.3.6, at the IBCF-hA1 table
> 5.3.8 and at the S-CSCF-hA1 table 5.3.10 apply.
>
> For the consideration of Chargeable Event / Information for the SDP portion
> of the SIP INVITE request for the mapping to the Information Elements at the
> P-CSCF-vA1 table 5.2.3, at the IBCF-vA1 table 5.3.5, at the TF table 5.3.7,
> at the IBCF-hA1 table 5.3.9 and at the S-CSCF-hA1 table 5.3.11 apply
**6\. Evaluation of initial filter criteria**
> The S-CSCF-hA1 validates the service profile of this subscriber and
> evaluates the initial filter criteria. For this example, assume an AS/MRFC
> involvement.
**7\. SIP INVITE request (S-CSCF-hA1 to ASâ€‘hA1 /MRFC)**
> The S-CSCF-hA1 applies the same procedure as in step 6 in clause 5.3.
>
> With regard to charging in addition the AS-Information about the use of the
> AS will be stored.
>
> There is no indication that the service will include an announcement. Only
> if it is a specific AS hosting announcement services like customized
> ringback tones.
>
> For the consideration of Chargeable Event / Information for the INVITE
> request at the AS-hA1 table 5.3.7 SIP INVITE request Header Field to
> Information Element apply.
>
> **8\. Service logic in ASâ€‘hA1 /MRFC**
>
> Service logic in the ASâ€‘hA1 decides to send an announcement to the calling
> party. In such a case the ASâ€‘hA1 acts as a B2BUA. Thus an early dialog for
> the announcement and two dialogs will be created in the final call state one
> from UE-A to the ASâ€‘hA1 and one from the ASâ€‘hA1 to the terminating UE which
> allows end-to-end communication.
>
> **9\. MRFC-MRFP interaction**
>
> The MRFC interacts with the MRFP in order to reserve resources for the
> announcement. As part of the interaction with MRFP the ASâ€‘hA1 receives the
> necessary media parameters e.g. IP address and port numbers and provide the
> IP address and port number for the calling party to the MRFP.
>
> **10.-15. SIP 183 (Session Progress) response (ASâ€‘hA1 to UEâ€‘A via S-CSCF-
> hA1, IBCF-hA1, IC-A1, IBCF-vA1 and P-CSCF-vA1)**
>
> The ASâ€‘hA1 sends a SIP 183 (Session progress) response to S-CSCFâ€‘hA1. The
> response includes:
a) an answer to the SDP received in the SIP INVITE request;
b) a P-Early-Media header field set to \"sendonly\" in case where only
announcement will be played. For invoking an interactive voice response system
a P-Early-Media header field is set to \"sendrecv\"; and
c) the Require header field set to \"100rel\".
> In this case the information within the SDP will have relevance for the
> information element Early Media Description and SDP session description. The
> IE will be finally filled when the SIP PRACK request/SIP 200 OK response
> cycle made the SIP 183response reliable.
NOTE 2: If the interconnection network is SIP-unaware, step 13 is skipped.
**16\. SIP PRACK request /SIP 200 (OK) response (UEâ€‘A to ASâ€‘hA1 / ASâ€‘hA1 to
UEâ€‘A)**
Table 5.10.2.1: SDP portion of SIP 200 OK (PRACK) response to Information
Elements
+---------------+-------------------------+-------------------------+ | **SDP** | **Example Content** | **Discussion and | | | | Charging Event IE** | +---------------+-------------------------+-------------------------+ | Content-Type: | Content-Type: | IE: Early Media | | | application/sdp | Description | | | | | | | Content-Length: (...) | IE: SDP Media Component | | | | | | | v=0 | Initial offer contains | | | | the SDP offer and was | | | o=- 2987933615 | answered in the SIP 183 | | | 2987933615 IN IP4 | Response. The \"Early | | | 192.0.2.1 | Media Description\" and | | | | \"SDP Media Component\" | | | s= | when the SDP was made | | | | reliable (i.e. with SIP | | | t=0 0 | PRACK request/ SIP 200 | | | | OK response). | | | c=IN IP4 192.0.2.1 | | | | | | | | m=audio 49170 RTP/AVP | | | | 96 97 | | | | | | | | a=curr:qos local none | | | | | | | | a=curr:qos remote none | | | | | | | | a=des:qos mandatory | | | | local sendrecv | | | | | | | | a=des:qos optional | | | | remote sendrecv | | | | | | | | a=rtpmap:97 AMR | | | | | | | | a=fmtp:97 | | | | mode-set=0,2,5,7; | | | | mode-change-period=2 | | | | | | | | a=rtpmap:96 | | | | telephone-event | | | | | | | | a=maxptime:20 | | +---------------+-------------------------+-------------------------+
> Since this SDP is made reliable the early media description needs to be
> recorded.
**17\. MRFC-MRFP interaction**
> The MRFC interacts with the MRFP in order to start the announcement.
**18\. MRFC-MRFP interaction**
> The MRFP sends the announcement towards the calling party.
**19\. MRFC-MRFP interaction**
> The complete announcement is sent and the MRFP interacts with the
> ASâ€‘hA1/MRFC in order to inform that the announcement is terminated.
**20\. MRFC-MRFP interaction**
> The MRFC interacts with the MRFP in order to release the resources used for
> the announcement.
**21-26. SIP 199 (Early Dialog Terminated) response (AS-hA1 to UE-A via
S-CSCF-hA1, IBCF-hA1, IC-A1, IBCF-vA1 and P-CSCF-vA1) (optional)**
> If the originating UEâ€‘A has indicated support of the SIP 199 (Early Dialog
> Terminated) response code, the ASâ€‘hA1 sends a SIP 199 (Early Dialog
> Terminated) provisional response towards the originating UEâ€‘A to terminate
> the early dialog between itself and the UEâ€‘A.
Since there is no change of SDP the IE Early Media Description nor IE: SDP
Media Component will be changed. Thus seen from time stamp the early media
will still continue till an other codec negotiation will take place.
The specifications TS 32.260 [20] nor TS 32.298 [51] does not describe how to
proceed with ending an early media with 199.
NOTE 3: If the interconnection network is SIP-unaware, step 24 is skipped.
**27\. SIP INVITE request (AS-hA1 to S-CSCFâ€‘hA1)**
> The ASâ€‘hA**1** sends the SIP INVITE request towards the S-CSCFâ€‘hA**1**. The
> SIP INVITE request contains the same information as the SIP INVITE request
> shown in table 5.4.2.7, see step 7 in clause 5.4.2.
>
> As in subsection 5.4 described that the AS sends an SIP INVITE message back
> towards the S-CSCF. The AS decides to suppress loopback to the VPLMN, and,
> hence, removes the Feature-Caps header field +g.3gpp.home-visited.
NOTE: Of course, the AS also has multiple other options to influence the
further call handling, including a\ potential modification of the final
destination of the call. This is not considered here.
> For early media itself such information may be valuable based on the use
> case but this is an operator depended issue
**28-33. SIP INVITE request (S-CSCFâ€‘hA1 to IC-B1 via IBCF-hA1, IC-A1, IBCF-
vA1, TRF-vA1 and IBCF-vA1)**
> The S-CSCFâ€‘hA1 decides to loopback the SIP INVITE request and forwards the
> call to the terminating home network via the originating visited network vA.
>
> The SDP contained within the SIP INVITE will be manipulated along the
> signalling path as shown in the example in TS 29.079 [215] clause A.6.
NOTE 4: If the interconnection network is SIP-unaware, step 30 is skipped and
step 33 is executed between IBCF-vA1 and IBCF-hB instead.
**34\. SIP 180 (Ringing) response (IC-B1 to UEâ€‘A via IBCF-vA1, TRF-vA1, IBCF-
vA1, IC-A1, IBCF-hA1, S-CSCF-hA1, AS-hA1, S-CSCF-hA1, IBCF-hA1, IC-A1, IBCF-
vA1 and P-CSCF-vA1)**
> When the UEâ€‘A of the calling party receives the SIP 200 (OK) response to the
> SIP INVITE request and optional steps 21- 26 were not performed, the UEâ€‘A
> can regard the early dialog created for the announcement between the UEâ€‘A
> and the ASâ€‘hA1 as terminated.
>
> The SIP 200 OK (SIP INVITE) will be handled equivalent to clause 5.4.
For this case the information of loopback would be very valuable to have a
clear statement that an announcement was played by home network A and the
media interaction between UE-A and UE-B applies directly without involvement
of home network A.
**35.-47 SIP 200 (OK) INVITE request**
> When the UEâ€‘A of the calling party receives the 200 (OK) response to the SIP
> INVITE request and optional steps 21- 26 were not performed, the UE can
> regard the early dialog created for the announcement between the UEâ€‘A and
> the ASâ€‘hA1 as terminated.
>
> The 200 OK (SIP INVITE) will be handled equivalent to clause 5.4.
>
> The entities not applying media relay do indicat that \"Local GW Not
> Inserted\" indication and with information on the roaming NNI
> interconnecting to the intermediate network for the loopback path.
>
> **48\. SIP ACK request**
### 5.10.3 Insertion of service related media in the originating home network
without loopback
Figure 5.10.3.1: Announcement started during the establishment of a
communication
The steps of the signalling flow are as follows:
**1-5. SIP INVITE request (UEâ€‘A to S-CSCF-hA1 via P-CSCF-vA1, IBCF-vA1, IC-A1
and IBCF-hA1)**
> The SIP INVITE request is sent as described within clause 5.3.2.
NOTE 1: If the interconnection network is SIP-unaware, step 4 is skipped.
For the consideration of Chargeable Event / IE for the INVITE request at the
P-CSCF-vA1 table 5.4.2: and at the S-CSCF-hA1 table 5.4.4 SIP INVITE request
Header Field to Information Element apply.
For the SDP portion at the request P-CSCF-vA1 table 5.4.3: and at the S-CSCF-
hA1 table 5.4.5 SDP portion of SIP INVITE request P-CSCF-vA1 mapping to
Information Elements apply.
**6\. Evaluation of initial filter criteria**
> The S-CSCF-hA1 validates the service profile of this subscriber and
> evaluates the initial filter criteria. For this example, assume an AS/MRFC
> involvement.
**7\. SIP INVITE request (S-CSCF-hA1 to ASâ€‘hA1 /MRFC) - see example in table
5.3.2-6**
> The S-CSCF-hA1 applies the same procedure as in step 6 in clause 5.3.2.
**8\. Service logic in ASâ€‘hA1 /MRFC**
> Service logic in the ASâ€‘hA1 decides to send an announcement to the calling
> party. In such a case the ASâ€‘hA1 acts as a B2BUA. Thus an early dialog for
> the announcement and two dialogs will be created in the final call state one
> from UE-A to the ASâ€‘hA1 and one from the ASâ€‘hA1 to the terminating UE which
> allows end-to-end communication.
>
> As in subsection 5.3 described that the AS sends an SIP INVITE message back
> towards the S-CSCF. The AS decides to suppress loopback to the VPLMN, and,
> hence, removes the Feature-Caps header field +g.3gpp.home-visited.
NOTE: Of course, the AS also has multiple other options to influence the
further call handling, including a\ potential modification of the final
destination of the call. This is not considered here.
> For early media itself such information may be valuable based on the use
> case but this is an operator depended issue
**9\. MRFC-MRFP interaction**
> The MRFC interacts with the MRFP in order to reserve resources for the
> announcement. As part of the interaction with MRFP the ASâ€‘hA1 receives the
> necessary media parameters e.g. IP address and port numbers and provide the
> IP address and port number for the calling party to the MRFP.
**10-15. SIP 183 (Session Progress) response (AS-hA1 to UE-A via S-CSCF-hA1,
IBCF-hA1, IC-A1, IBCF-vA1 and P-CSCF-vA1))**
> The ASâ€‘hA1 sends a SIP 183 (Session progress) response to the S-CSCFâ€‘hA1.
> The response includes:
a) an answer to the SDP received in the SIP INVITE request;
b) a P-Early-Media header field set to \"sendonly\" in case where only
announcement will be played. For invoking an interactive voice response system
a P-Early-Media header field is set to \"sendrecv\"; and
c) the Require header field set to \"100rel\".
NOTE 2: If the interconnection network is SIP-unaware, step 13 is skipped.
**16\. SIP PRACK request / 200 (OK) response (UEâ€‘A to ASâ€‘hA1 / AS-hA1 to
UE-A)**
Table 5.10.3.1:
+---------------+-------------------------+-------------------------+ | **SDP** | **Example Content** | **Discussion and | | | | Charging Event IE** | +---------------+-------------------------+-------------------------+ | Content-Type: | Content-Type: | IE: Early Media | | | application/sdp | Description | | | | | | | Content-Length: (...) | IE: SDP Media Component | | | | | | | v=0 | Initial offer contains | | | | the SDP offer and was | | | o=- 2987933615 | answered in the SIP 183 | | | 2987933615 IN IP4 | Response. The \" Early | | | 192.0.2.1 | Media Description \" | | | | and \"SDP Media | | | s= | Component\" when the | | | | SDP was made reliable | | | t=0 0 | (i.e. with SIP PRACK/ | | | | 200 OK). | | | c=IN IP4 192.0.2.1 | | | | | | | | m=audio 49170 RTP/AVP | | | | 96 97 | | | | | | | | a=curr:qos local none | | | | | | | | a=curr:qos remote none | | | | | | | | a=des:qos mandatory | | | | local sendrecv | | | | | | | | a=des:qos optional | | | | remote sendrecv | | | | | | | | a=rtpmap:97 AMR | | | | | | | | a=fmtp:97 | | | | mode-set=0,2,5,7; | | | | mode-change-period=2 | | | | | | | | a=rtpmap:96 | | | | telephone-event | | | | | | | | a=maxptime:20 | | +---------------+-------------------------+-------------------------+
> Since this SDP is made reliable the early media description needs to be
> recorded. The Early Media Description Charging event IE will be filled if
> the SDP of the played announcement
**17\. MRFC-MRFP interaction**
> The MRFC interacts with the MRFP in order to start the announcement.
**18\. MRFC-MRFP interaction**
> The MRFP sends the announcement towards the calling party.
**19\. MRFC-MRFP interaction**
> The complete announcement is sent and the MRFP interacts with the
> ASâ€‘hA1/MRFC in order to inform that the announcement is terminated.
**20\. MRFC-MRFP interaction**
> The MRFC interacts with the MRFP in order to release the resources used for
> the announcement.
**21-26. SIP 199 (Early Dialog Terminated) response (AS-hA1 to UE-A via
S-CSCF-hA1, IBCF-hA1, IC-A1, IBCF-vA1 and P-CSCF-vA1) (optional)**
> If the originating UEâ€‘A has indicated support of the SIP 199 (Early Dialog
> Terminated) response code, the ASâ€‘hA1 sends a SIP 199 (Early Dialog
> Terminated) provisional response towards the originating UEâ€‘A to terminate
> the early dialog between itself and the UEâ€‘A.
>
> Since there is no change of SDP the neither IE Early Media Description nor
> IE: SDP Media Component will be changed. Thus seen from time stamp the early
> media will still continue till another codec negotiation will take place.
>
> The specifications TS 32.260 [20] nor TS 32.298 [51] does not describe how
> to proceed with ending an early media with 199.
>
> For early media itself the information that a loopback apply may be
> interesting for the early media case but may be valuable based on the use
> case but this is an operator depended issue
NOTE 3: If the interconnection network is SIP-unaware, step 24 is skipped.
**27\. SIP INVITE request (AS-hA1 to S-CSCF-hA1)**
> The ASâ€‘hA1 sends the SIP INVITE request towards the S-CSCFâ€‘hA1. The SIP
> INVITE request contains the same information as the SIP INVITE request shown
> in table 5.3.2.-7, see step 7 in clause 5.3.2.
**28\. SIP INVITE request (S-CSCF-hA1 to IC-B1)**
> The S-CSCFâ€‘hA1 decides not to loopback the SIP INVITE request and forwards
> the call to the terminating home network.
NOTE 4: If the interconnection network is SIP-unaware, step 30 is skipped and
step 33 is executed between S-CSCF-hA and IBCF-hB instead.
**29\. SIP 18x response / SIP PRACK request, 200 (OK) response /SIP UPDATE
request and SIP 200 OK (UPDATE) response (IC-B1 to UE-A via S-CSCF-hA1, AS-
hA1, S-CSCF-hA1, IBCF-hA1, IC-A1, IBCF-vA1 and P-CSCF-vA1)**
> Resource reservation for Call including all SDP updates which will be
> charging relevant. The Early Media Description Charging event IE will be
> filled if the SDP will be set to active.
**30.-37. SIP 200 (OK) response (IC-B1 to UE-A via S-CSCF-hA1, AS-hA1, S-CSCF-
hA1, IBCF-hA1, IC-A1, IBCF-vA1 and P-CSCF-vA1)**
> When the UEâ€‘A of the calling party receives the 200 (OK) response to the SIP
> INVITE request and optional steps 21- 26 were not performed, the UE can
> regard the early dialog created for the announcement between the UEâ€‘A and
> the ASâ€‘hA1 as terminated.
>
> The 200 OK (SIP INVITE) will be handled equivalent to clause 5.3.
**38\. SIP ACK request (UE-A to IC-B1 P-CSCF-vA1, IBCF-vA1 IC-A1, IBCF-hA1,
S-CSCF-hA1, AS-hA1, and S-CSCF-hA1)**
## 5.11 PS to CS SRVCC access transfer scenarios
### 5.11.1 General
This clause describes PS to CS SRVCC access transfer scenarios including the
registration and the additional message flow due to PS to CS SRVCC.
For IMS roaming PS to CS SRVCC procedure with media anchoring in the ATGW of
the visited network and signalling anchored in the SCC AS of the home network
is used.
In case of PS to CS SRVCC the media path between the visited network and the
home network needs to be re-established since the SIP dialogue between the
ATCF in the visited network and the SCC AS in the home network is re-
established.
From viewpoint of the remote side the signalling anchors do not change due to
the PS to CS SRVCC. However, the media anchors changes due to the PS to CS
SRVCC in case of \"originating roaming to home network without loopback\" (see
clause 5.3) since the CS target access leg is created using a new IBCF.
Seen from charging point of view there will be no new information published to
the billing domain which needs to be considered in addition to identify the
roaming REVOLTE use case. The ATCF is a new network element within the path
which creates its own events and will be considered for CDR creation and
correlation within the billing domain. Thus the following call flows are shown
for completion.
### 5.11.2 PS to CS SRVCC information transfer during registration
This clause describes the PS to CS SRVCC access transfer specifics during
registration.
Preconditions to this flow are:
\- the conditions in clause 5.2.2 are fulfilled; and
\- both the visited network support PS to CS access transfer and MSC servers
in the network are enhanced to use SIP signalling towards the IMS.
As stated in clause 5.2.2 TS 32.260 [20] points out that the initial
registration, user-initiated re-registration, and user-initiated de-
registration chargeable events relate to SIP REGISTER request to trigger
Charging Data Request[Event] / Debit / Reserve Units Requests.
A SIP 200 OK response to a SIP MESSAGE request triggers also a Charging Data
Request [Event].
Figure 5.11.2.1 shows the message flow when a UE registers in IMS over PS
before SRVCC occurs as described in clause 5.11.3.
Figure 5.11.2.1: SRVCC information transfer during registration
The steps of the flow are as follows:
**1\. The UE-A registers in IMS and receives a 401 (Unauthorized) response.**
> The flow is the same as in clause 5.2.2 with the exception that the ATCF is
> included in the registration path.
**2.-3. SIP REGISTER request (UE-A to ATCF-vA1)**
> The UE-A sends a SIP REGISTER request again (now with an authentication
> challenge response included) and forwards it to the P-CSCF-vA1. The P-CSCF-
> vA1 forwards the SIP REGISTER request to an ATCFâ€‘vA1 according to local
> policy. The content of the SIP REGISTER request is not different from the
> content of the SIP REGISTER request in clause 5.2.2.
>
> No different aspect due to charging appear.
**4\. SIP REGISTER request (ATCF-vA1 to IBCF-vA1) - see example in table
5.11.2.1.**
> When the ATCF-vA1 receives the SIP REGISTER request, the ATCF-vA1 updates
> its database for registrations and selects an IBCF according to local policy
> for routeing the SIP REGISTER request towards the home network.
Table 5.11.2.1: SIP REGISTER request (ATCF-vA1 to IBCF-vA1)
SIP REGISTER request sip:home-A.net SIP/2.0
From:
To:
P-Access-Network-Info:
Supported:
Contact:
CSeq:
Require:
Route: \
Path: \,\
P-Visited-Network-ID:
P-Charging-Vector:
Feature-Caps:*;+g.3gpp.atcf=\"tel:+1-237-555-3333\";+g.3gpp.atcf-mgmt-
uri=\"\\";+g.3gpp.atcf-
path=\"sip:termabc\@atcf-vA1.visited-A.net\";+g.3gpp.mid-call;+g.3gpp.srvcc-
alerting;+g.3gpp.ps2cs-srvcc-orig-pre-alerting
Via:SIP/2.0/UDP atcf-vA1.visited-A.net:5060;branch=z9hG4bKaa3689b
Via:SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via:SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Other SIP header fields are set according to TS 24.229[106] and TS 24.237
[218].
**Feature-Caps: The ATCF-vA1 adds a number of feature-capability indicators in
the Feature-Caps header field.**
\- The g.3gpp.atcf capability-indicator includes the STN-SR that will be used
during PS to CS access transfer by the MSC server.
\- The g.3gpp.atcf-mgmt-uri feature-capability indicator includes the URI that
will be used by the SCC AS when sending the SIP MESSAGE request with the PS to
CS SRVCC information to the ATCF-vA1 The URI includes an \"iotl\" SIP URI
parameter.
\- The g.3gpp.atcf-path feature-capability indicator is used by ATCF to
identify the registration in its database for registrations and will be
included by SCC AS in the SIP MESSAGE request with the PS to CS SRVCC
information sent to the ATCF-vA1.
\- The g.3gpp.mid-call, g.3gpp.srvcc-alerting and g.3gpp.ps2cs-srvcc-orig-pre-
alerting feature-capability indicators are included to indicate which PS to CS
SRVCC features the visited network supports.
**5.â€‘8. SIP REGISTER request (IBCF-vA1 to S-CSCF-hA1 via IC-A1, IBCF-hA1 and
I-CSCF-hA1**
> When the IBCF-vA1 receives the SIP REGISTER request, the IBCF-vA1 forwards
> the SIP REGISTER request in the same way as in clause 5.2.2. There is no
> more SRVCC specific information added in the SIP REGISTER request.
**9.-16. SIP 200 (OK) response (S-CSCF-hA1 to UE-A).**
> The S-CSCFâ€‘hA1 acknowledges the SIP REGISTER request by means of a SIP 200
> (OK) response as described in clause 5.2.2. also no specific charging events
> appear beyond that described in clause 5.2.2.
**17\. SIP REGISTER request (S-CSCF-hA1 to SCC AS-hA1)**
> The S-CSCF-hA1 checks the iFC triggers and detects that the SCC AS-hA1 is
> interested in registrations from this user. The S-CSCF-hA1 sends a 3^rd^
> party SIP REGISTER request to the SCC AS-hA1. The Sâ€‘CSCFâ€‘hA1 includes in the
> 3^rd^ party SIP REGISTER request the contents of the initial SIP REGISTER
> request and the SIP 200 (OK) response to the initial SIP REGISTER request in
> \"sip\" message bodies.
>
> More detail about the message content is given in TR 29.949 [217].
**18\. SIP 200 (OK) response (SCC AS-hA1 to S-CSCF-hA1).**
> The SCC AS-hA1 acknowledges the SIP REGISTER request by means of a SIP 200
> (OK) response. There is no specific SRVCC access transfer information added
> by SCC AS-hA1 in the SIP 200 (OK) response.
**19\. The SCC ASâ€‘hA1 stores the STN-SR in HSS.**
> The SCC ASâ€‘hA1 stores the STN-SR ([tel:+1-237-555-3333]{.underline})
> received in the \"+g.3gpp.atcf\" Feature-Caps header field parameter in HSS.
> This information will later be transferred to the MSC server when a PS to CS
> SRVCC access transfer occurs as described in clause 5.11.3.
**20.-23. SIP MESSAGE request (SCC AS-hA1 to ATCF-vA1) - see example in table
5.11.2.2**
> In order to inform about PS to CS SRVCC access transfer parameters necessary
> for the ATCF-vA1 during PS to CS SRVCC access transfer, the SCC ASâ€‘hA1 sends
> a SIP MESSAGE request to the ATCF-vA1.
Table 5.11.2.2: SIP MESSAGE request (sent by the SCC AS-hA1)
SIP MESSAGE request sip:atcf-vA1.visited-A.net;iotl=homeB-visitedB SIP/2.0
From: \;tag=123e5
To: \
Cseq: 100 SIP MESSAGE request
P-Asserted-Identity: \
P-Charging-Vector: icid-value=\"BrtA76543y+403fg654tBf456fa=023551024\";orig-
ioi=\"Type 1home-a\"
Content-Length: (...)
Content-Type: application/vnd.3gpp.SRVCC-info+xml
Route: \
Via: SIP/2.0/UDP sccas-hA1.home-A.net:5060;branch=z9hG4bK78956a
\
\
\
\sip:sccas-hA1.home-A.net;iotl=visitedA-homeA\
\tel:+1-237-555-1111\
\
\
Other SIP header fields are set according to TS 24.229 [106] and TS 24.237
[218].
> **Request-URI/To: Contains the address received in the g.3gpp.atcf-mgmt-uri
> feature-capability indicator. including traffic leg information in an
> \"iotl\" SIP URI**.
**P-Asserted-Identity/From: Includes the SCC AS-hA1 address.**
> **P-Charging-Vector: The SCC AS-hA1 assigns a new ICID value and includes a
> type 1 IOI value in the \"origâ€‘ioi\"** header field parameter**. The type
> IOI value identifies the home network hA. Passing the** IBCF-vA1 acting as
> an entry point adds an IOI value in the \"transit-ioi\" header field
> parameter. The IOI value identifies the interconnect network from where the
> SIP MESSAGE request was received i.e. the interconnect network A.
>
> **Via: The SCC AS-hA1 adds a Via header field.**
**application/vnd.3gpp.SRVCC-info+xml:** Contains the PS to CS SRVCC specific
information that will be used by the ATCF-vA1 when SRVCC occurs as described
in clause 5.11.3.
\- The SRVCC-info ATCF-Path-URI identifies the registration in the ATCF-vA1.
\- The ATU-STI is the address of the SCC AS where the SIP INVITE request will
be sent to in the event of a PS to CS SRVCC access transfer. The ATU-STI
includes **traffic leg information in an \"iotl\" SIP URI parameter**.
\- C-MSISDN is the public user identity of the user that the ATCF-vA1 is using
to identify the user in the event of a PS to CS SRVCC access transfer.
Passing the network elements only the Route and Via header filed are
manipulated in adding/deleting information.
**24-27. SIP 200 (OK) response (ATCF-vA1 to SCC AS-hA1 via IBCF-vA1, IC-A1 and
IBCF-hA1) - see example in table 5.11.2.3.**
> The ATCF-vA1 acknowledges the receipt of the SIP MESSAGE request by means of
> a SIP 200 (OK) response according to TS 24.229 [106]. No SRVCC specific
> parameters are included in the SIP 200 (OK) response.
>
> The table 5.11.2.24 shows the content of the SIP 200 (OK) response when
> received in the SCC AS-hA1.
Table 5.11.2.3: SIP 200 (OK) response (ATCF-vA1 to SCC AS-hA1 via IBCF-vA1,
IC-A1 and IBCF-hA1)
SIP/2.0 200 OK
P-Charging-Vector: icid-value=\"BrtA76543y+403fg654tBf456fa=023551024\";orig-
ioi=\"Type 1home-a\";term-ioi=\"Type 1visited-a\"; transit-ioi=\"ICa.1\"
From: \;tag=123e5
To: \;tag=678f9
CSeq: 100 SIP MESSAGE request
Via: SIP/2.0/UDP sccas-hA1.home-A.net:5060;branch=z9hG4bK78956a
Other SIP header fields are set according to TS 24.229 [106] and TS 24.237
[218].
> **P-Charging-Vector: The ATCF-vA1 added a P-Charging-Vector** header field
> **with the same \"icid-value\" and the same \"origâ€‘ioi\"** header field
> parameter **value as received in the SIP MESSAGE request and a type 1 IOI
> value in a \"termâ€‘ioi\"** header field parameter **identifying the visited
> network vA.\ \ The IBCF-hA1 added the \"transit-ioi\" header field parameter
> with an IOI value identifying the transit network from where the SIP 200
> (OK) response was received i.e. the interconnect network A.**
### 5.11.3 PS to CS SRVCC access transfer for a call in the active phase
without loopback
This clause describes the PS to CS SRVCC access transfer of a call in the
active phase.
Preconditions to this call flow:
1\. a call is established between a UE-A and a remote UE as described in
clause 5.3. The UE-A is attached to a 4G radio access network (E-UTRAN);
2\. media is anchored in:
a. the P-CSCF-vA1, the ATCF-vA1 and IBCF-vA1 in the visited network vA;
b. the IC-A1 in the IC network A; and
c. the IBCF-hA1 and the IBCF-hA2 in the home network hA; and
3\. SIP signalling is anchored in SCC AS-hA1.
NOTE 1: The signalling flow is the same for PS to CS SRVCC access transfer for
a call in the active phase regardless if the UE-A or the remote UE initiated
the call.
Figure 5.11.3.1 shows the SIP message flow when PS to CS SRVCC access transfer
of a call in the active phase occurs.
NOTE: For clarity, the SIP 100 (Trying) messages are not shown in the
signalling flow.
Figure 5.11.3.1: SRVCC without loop back message flow
NOTE 2: If the interconnection network is SIP-unaware, or if IC-A1 is only a
SIP proxy rather than a SIP-ALG with attached SIP-AGW, IC-A1 is not in the
media path.
The steps of the flow are as follows:
**1\. A call is established as described in clause 5.3 between UE-A and a
remote UE.**
\- The remote UE can be a UE connected to IMS or an UE connected to CS and the
difference compared to the description in clause 5.3 and this PS to CS SRVCC
access transfer scenario is that an ATCF in the visited originated network
participated in the call establishment of the call and that the general AS-hA1
in figure 5.3.2.1 is replaced by the access transfer specific AS i.e. the SCC
AS-hA1.
\- The media path is UE-A -- P-CSCF-vA1 -- ATCF-vA1 -- IBCF-vA1 -- IC-A1 \--
IBCF-hA1 -- IBCF-hA2 -- remote network -- remote UE.
**2\. SRVCC handover occurs.**
> During the ongoing call the UE-A is performing measurements on signalling
> strength in neighbouring cells and sends continuously the measurement
> results to the core network. Due to decreasing signalling strength in the 4G
> radio access network the core network takes a decision that the UE shall be
> handed over to a 3G radio access network and sends a PS to CS SRVCC request
> to the MSC server-vA1.
**3\. SIP INVITE request due to STN-SR (MSC server-vA1 via P-CSCF-vA1 to ATCF-
vA1) - see example in table 5.11.3.3.**
\- When the MSC server-vA1 receives the PS to CS SRVCC request from the core
network in the visited network, the MSC server-vA1 sends an SIP INVITE request
to the ATCF-vA1. This SIP INVITE request is referred to as an \"SIP INVITE
request due to STN-SR\" in the TS 24.237 [218].
**4\. SIP 200 (OK) response (ATCF-vA1 to MSC server-vA1) -- see example in
table 5.11.3.4.**
> When the ATCF-vA1 receives the SIP INVITE request due to STN-SR the ATCF-vA1
> checks if there is a session that fulfils conditions for being transferred
> and detects that there is a call in an active phase ongoing between UE-A and
> a remote UE. To avoid speech gaps, the ATCF-vA1 returns a SIP 200 (OK)
> response towards the MSC serverâ€‘vA1 containing media parameters retrieved
> from the ATGW.
>
> The ATCF-vA1 also adds the \"related-icid\" header field parameter
> containing the \"icid-value\" header fields parameter used in the original
> call and can be used for charging correlation of generated CDR records in
> the visited network A **(i.e. \"visitedâ€‘a\")**.
Table 5.11.3.1: SIP 200 (OK) response (ATCF-vA1 to MSC server-vA1)
SIP/2.0 200 OK
From: \;tag=171828
To: \;tag=271818
Record-Route: \
P-Charging-Vector: icid-value=\"023551024\";icid-generated-at=\"msc-
vA1.visited-A.net\";orig-ioi=\"Type 1visited-a\";term-ioi=\"Type
1home-a\";related-icid=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
Feature-Caps:*;+g.3gpp.srvcc-alerting,*;+g.3gpp.mid-call,*;+ps2cs-srvss-orig-
pre-alerting
Contact: \
CSeq: 11 SIP INVITE request
P-Asserted-Identity:
\,\
Via: SIP/2.0/UDP msc-vA1.visited-A.net;branch=z9hG4bk7987fe
Other SIP header fields and SDP according to TS 24.229 [106] and TS 24.237
[218].
**Record-Route:** The ATCF adds its own address in the header field which will
be used by the MSC server-vA1 for subsequent SIP requests.
**P-Charging-Vector:** The P-Charging-Vector contains the parameters received
in the SIP INVITE request due to STN-SR and the related-icid header field
parameter containing the ICID value received in the session to be transferred.
**Step 5. SIP ACK request (MSC-vA1 to ATCF-vA1).**
> The MSC server-vA1 sends the ACK to the ATCF-vA1 according to TS 24.229
> [106]. The SIP ACK request does not contain any SRVCC specific information.
**6\. SIP INVITE request due to ATU-STI (ATCF-vA1 to IBCF-vA1) - see example
in table 5.11.3.6.**
> The ATCF-vA1 creates a new dialog towards SCC AS-hA1 by sending an SIP
> INVITE request due to ATU-STI. Everything except the Request line and the
> Via header field is copied from the received SIP INVITE request due to
> STNâ€‘SR.
Table 5.11.3.2: SIP INVITE request due to ATU-STI (ATCF-vA1 to IBCF-vA1)
SIP INVITE request sip:ps2cs\@sccas1.home-A.net;iotl=visitedA-homeA SIP/2.0
From: \;tag=171828
To: \
Route: \
P-Asserted-Identity: \
P-Access-Network-Info: 3GPP-UTRAN-TDD;utran-cell-
id-3gpp=151234D0EAF22;network-provided;
local-time-zone=\"UTC+01:10\";daylight-saving-time=\"01\"
P-Charging-Vector: icid-value=\"023551024\"; orig-ioi=\"Type 1visited-a\";
icid-generated-at=\"msc-vA1.visited-A.net\"
Record-Route: \
Contact: \;+g.3gpp.icsi-
ref=\"urn%3Aurn-7%3A3gpp-service.ims.icsi.mmtel\";+g.3gpp.srvcc-
alerting;+g.3gpp.mid-call;+ps2cs-srvss-orig-pre-alerting
CSeq: 11 SIP INVITE request
Accept: \"application/vnd.3gpp.state-and-event-info+xml\"
Recv-Info: g.3gpp.state-and-event
Target-Dialog: me03a0s09a2sdfgjkl491777; remote-tag=774321; local-tag=4fa3
Required: tdialog
Supported:norefersub
Via: SIP/2.0/UDP atcf-vA1.visited-A.net;branch=z9hG4bk731b87
Other SIP header fields and SDP according to TS 24.229 [106] and TS 24.237
[218].
> **Request-URI:** The SIP URI (referred to as ATU-STI) identifies the SCC AS-
> hA1. The ATU-STI is sent by SCC AS-hA1 to ATCF-vA1 during registration as
> described in clause 5.11.2. The Request-URI includes traffic information in
> an \"iotl\" SIP URI parameter.
>
> **Record-Route:** The address that the ATCF-vA1 wants to receive subsequent
> in-dialog requests from the SCC AS-hA1.
>
> **Target-Dialog:** The identity of the dialog selected by ATCF-vA1.
>
> **Required:** **The \"tdialog\" option tag indicates that the support for
> Target-Dialog header field is required**.
>
> **Via:** The ATCF-vA1 adds a Via header field.
**7\. SIP INVITE request due to ATU-STI (IBCF-vA1 to IC-A1) - see example in
table 5.11.3.7.**
> When the IBCF-vA1 receives the SIP INVITE request due to ATU-STI, the IBCF-
> vA1 updates the SDP as described within TS 29.079 [215].
>
> The IBCF-vA1 selects, based on local policy, to route the SIP INVITE request
> due to ATU-STI via interconnect network A and sends the request according to
> TS 24.229 [106] to the IC-A1. The IBCF-vA1 determines the next hop IP
> address from the SIP request URI, If the subsequent interconnection network
> is SIP-aware, the determined IP address will belong to the SIP proxy IC-A1.
> Otherwise the determined IP address will point to IBCF-vA1 and step 22 is
> skipped (not reflected in message details below).
Only Via and Record-Route header filed will be manipulated. This has no
charging relevant influence.
**8\. SIP INVITE request due to ATU-STI (IC-A1 to IBCF-hA1) - see example in
table 5.11.3.8.**
> When the IC-A1 receives the initial SIP INVITE request due to ATU-STI and
> since the IC-A1 according to local policy allows itself to be bypassed by
> media then the IC-A1 updates the SDP as described within TS 29.079 [215].
>
> The IC-A1 selects an entry point (IBCF-hA1) of the home IMS network hA and
> sends the SIP INVITE request according to TS 24.229 [106] to the IBCF-hA1.
NOTE 5: The IC-A1 can add a Route header field entry pointing to the entry
point of home network hA. However, since this is not necessary for routeing
the call it is not shown in table 5.11.3.8.
Only Via and Record-Route header filed will be manipulated. This has no
charging relevant influence.
**9\. SIP INVITE request due to ATU-STI (IBCF-hA1 to SCC AS-hA1 via I-CSCF) -
see example in table 5.11.3.9.**
> When the IBCF-hA1 receives the SIP INVITE request due to ATU-STI the IBCF-
> hA1 updates the SDP as described in TS 29.079 [215].
>
> Since there is no Route header field guiding the IBCF-hA1 where to route the
> call the IBCF-hA1 selects an Iâ€‘CSCF in the home network and sends the SIP
> INVITE request due to ATU-STI to the selected I-CSCF according to TS 24.229
> [106].
>
> The I-CSCF uses PSI routeing to route the call and sends the SIP INVITE
> request due to ATU-STI directly to SCC AS**â€‘** hA1.
>
> **P-Charging-Vector:** The IBCF-hA1 includes the \"transit-ioi\" header
> field parameter **with an IOI value identifying the transit network** from
> which the SIP INVITE request due to ATU-STI is received **i.e. the
> interconnect network A**.
Only Via and Record-Route header filed will be manipulated. This has no
charging relevant influence.
**10\. SIP INVITE request (SCC AS-hA1 to S-CSCF-hA1) - see example in table
5.11.3.10.**
> When the SCC AS-hA1 receives the SIP INVITE request due to ATU-STI the SCC
> AS-hA1 compares the received SDP with the SDP negotiated in the existing
> session. The conclusion is that it differs so the SCC AS-hA1 needs to send a
> re-SIP INVITE request towards the remote UE.
NOTE 6: The AS can either remove the OMR attributes in the SDP or keep them
depending on if the AS supports OMR and local policy. In this example the OMR
attributes are removed.
NOTE 7: When a user is roaming and media is anchored in IBCF the IP addresses
will be different in the SDP received in the SIP INVITE request due to ATU-STI
compared to those negotiated in the existing session towards the remote UE and
that will always result in that a re-SIP INVITE request is needed towards the
remote UE.
Table 5.11.3.3: SIP INVITE request (SCC AS-hA1 to S-CSCF-hA1)
SIP INVITE request sip:[5555::bbb:ccc:ddd:aaa] SIP/2.0
From: \;tag=4fa3
To: \;tag=987651
CSeq: 1000 SIP INVITE request
Route: \,\,\
Via: SIP/2.0/UDP sccas-hA1.home-A.net;branch=z9hG4bK3a4f92
Other SIP header fields and updated SDP according to TS 24.229 [106] and TS TS
24.237 [218].
**Request-URI: Set to the contact address of the remote UE.**
**From: Set to the SIP URI that is the default public user identity of the
user A i.e. userA_public1\@home-A.net.**
**To: Set to the public user identity of the remote UE.**
**Via: The SCC AS-hA1 adds a Via header field.**
**11\. SIP INVITE request (S-CSCF-hA1 to IBCF-hA2) - see example in table
5.11.3.4.**
> The S-CSCF-hA1 forwards the re-SIP INVITE request according to procedures in
> TS 24.229 [106].
Table 5.11.3.4: SIP INVITE request (S-CSCF-hA1 to IBCF-hA2)
SIP INVITE request sip:[5555::bbb:ccc:ddd:aaa] SIP/2.0
From:
To:
CSeq:
Route: \,\
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK354321
Via: SIP/2.0/UDP sccas-hA1.home-A.net;branch=z9hG4bK3a4f92
Other SIP header fields and updated SDP according to TS 24.229 [106] and TS TS
24.237 [20].
**Via:** The S-CSCF-hA1 adds a Via header field.
**12-13. SIP 200 (OK) response (IBCF-hA2 to SCC AS-hA1 via S-CSCF-hA1).**
> When the IBCF-hA2 receives the SIP 200 (OK) response to the re-SIP INVITE
> request sent towards the remote UE, the IBCF-hA2 forwards the SIP 200 (OK)
> response including the SDP answer to SCC AS-hA1 according to TS 24.229
> [106]. The SIP 200 (OK) response does not contain any SRVCC specific
> information**.**
**14-15. SIP ACK request (SCC AS-hA1 to IBCF-hA2 via S-CSCF-hA1).**
> The SCC AS-hA1 sends the ACK to the IBCF-hA2 according to TS 24.229 [106].
> The SIP ACK request does not contain any SRVCC specific information.
**16-19. SIP 200 (OK) response (SCC AS-hA1 to ATCF-vA1 via S-CSCF-hA1, IBCF-
hA1, IC-A1 and IBCF-vA1) - see example in table 5.11.3.16.**
> The SCC AS-hA1 uses the received SDP response and sends a 200 OK response to
> the SIP INVITE request due to ATU-STI towards the ATCF-vA1.
>
> The table 5.11.3.16 shows the content of the SIP 200 (OK) response when
> received in ATCF-vA1.
Table 5.11.3.5: SIP 200 (OK) response (SCC AS-hA1 to ATCF-vA1 via S-CSCF-hA1,\
IBCF-hA1, IC-A1 and IBCF-vA1)
SIP/2.0 200 OK
From: \;tag=171828
To: \;tag=828171
CSeq: 11 SIP INVITE request
Record-Route: \,\,
\,\
P-Charging-Vector: icid-value=\"023551024\";orig-ioi=\"Type 1visited-a\";icid-
generated-at=\"msc-vA1.visited-A.net\";term-ioi=\"Type 1home-a\";related-
icid=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
Via: SIP/2.0/UDP atcf-vA1.visited-A.net;branch=z9hG4bk7987fe
Other SIP header fields and SDP according to TS 24.229 [106].
**P-Charging-Vector:** The SCC AS added the P-Charging-Vector with the \"icid-
value\", the \"orig-ioi\" value and the \"icid-generated-at\" as received in
the SIP INVITE request due to ATU-STI. Additionally the SCC AS**â€‘** hA1 added
the \"related-icid\" header field parameter. The \"related-icid\" header field
parameter contains the \"icid-value\" header field parameter of the original
call and can be used for charging correlation of generated CDR records in the
interconnect network A.
**20-23. SIP ACK request (ATCF-vA1 to SCC AS-hA1 via IBCF-vA1, IC-A1, IBCF-hA1
and S-CSCFâ€‘hA1).**
> The ATCF-vA1 sends the ACK to the SCC AS-hA1 according to TS 24.229 [106].
> The SIP ACK request does not contain any SRVCC specific information.
### 5.11.4 PS to CS SRVCC access transfer for a call in the active phase with
loopback
This clause describes the PS to CS SRVCC access transfer of a call in the
active phase with loopback.
Preconditions to this call flow:
1\. A call is established between a UE-A and a remote UE as described in
clause 5.4. The UE-A is attached to a 4G radio access network (E-UTRAN);
NOTE 1: The signalling flow is the same for PS to CS SRVCC access transfer for
a call in the active phase regardless if the UE-A or the remote UE initiated
the call.
2\. The media is anchored in the P-CSCF-vA1, ATCF-vA1 and IBCFâ€‘vA1 in the
visited network vA); and
3\. SIP signalling is anchored in SCC ASâ€‘hA1.
Figure 5.11.4.1 shows the SIP message flow when PS to CS SRVCC access transfer
of a call in the active phase occurs.
NOTE: For clarity, the SIP 100 (Trying) messages are not shown in the
signalling flow.
Figure 5.11.4.1: SRVCC with loopback message flow
The steps of the flow are as follows:
**1\. A call is established between the UE-A and a remote UE as described in
clause 5.4.**
> The remote UE can be a UE connected to IMS or an UE connected to CS and the
> difference compared to the description in clause 5.4 and this PS to CS SRVCC
> access transfer scenario is that an ATCF in the visited originated network
> participated in the call establishment of the call and that the general AS-
> hA1 in figure 5.4.2.1 is replaced by the access transfer specific SCC AS-
> hA1.
>
> The media path is UE-A -- P-CSCF-vA1 -- ATCF-vA1 -- IBCF-vA1 -- IC-T1 \--
> terminating network -- remote UE.
**2\. SIP INVITE request due to STN-SR (MSC server-vA1 to ATCF-vA1).**
> See step 3 in clause 5.11.3.
**3\. SIP 200 (OK) response (ATCF-vA1 to MSC server-vA1).**
> See step 4 in clause 5.11.3.
**4\. SIP ACK request (MSC server-vA1 to ATCF-vA1).**
> The MSC server acknowledges the receipt of the SIP 200 (OK) response. No
> SRVCC specific information is added.
**5-8. SIP INVITE request due to ATU-STI (ATCF-vA1 to SCC AS-hA1 via IBCF-vA1,
IC-A1, IBCFâ€‘hA1/Iâ€‘CSCF and S-CSCFâ€‘hA1).**
> See steps 6-9 in clause 5.11.3.
NOTE 2: If the interconnection network is SIP-unaware, step 7 is skipped.
**9-15. SIP INVITE request (SCC AS-hA1 to IC-T1 via S-CSCF-hA1, IBCF-hA1,
IC-A1, IBCFâ€‘vA1, TRF and IBCFâ€‘vA1) - see example in table 5.11.4.1.**
> When the SCC AS-hA1 receives the SIP INVITE request due to ATU-STI the SCC
> AS-hA1 compares the received SDP with the SDP negotiated in the existing
> session. The conclusion is that it differs so the SCC AS-hA1 needs to send a
> re-SIP INVITE request towards the remote UE.
>
> The SCC AS-hA1 handles OMR attributes according to TS 24.237 [218] clause
> 6A.4.4.
NOTE 3: When a user is roaming and media is anchored in IBCF the IP addresses
will be different in the SDP received in the SIP INVITE request due to ATU-STI
compared to those negotiated in the existing session towards the remote UE and
that will always result in that a re-SIP INVITE request is needed towards the
remote UE.
> The table 5.11.4.1 shows the content of the SIP INVITE request when sent by
> SCC ASâ€‘hA1.
Table 5.11.4.1: SIP INVITE request (SCC AS-hA1 to IC-T1 via S-CSCF-hA1, IBCF-
hA1, IC-A1, IBCFâ€‘vA1, TRF and IBCFâ€‘vA1)
SIP INVITE request sip:[5555::bbb:ccc:ddd:aaa] SIP/2.0
From: \;tag=171828
To: \;tag=987651
CSeq: 111 SIP INVITE request
Route: \,\,
\
Via: SIP/2.0/UDP sccas-hA1.home-A.net;branch=z9hG4bK3a4f92
Other SIP header fields and updated SDP according to TS 24.229 [106], TS
24.237 [218] and TS 29.079 [215].
**Via:** Via header fields are added by SCC AS-hA1, S-CSCF-hA1, IBCF-hA1,
IC-A1, IBCFâ€‘vA1, TRF and IBCFâ€‘vA1.
NOTE 4: If the interconnection network is SIP-unaware, step 12 is skipped.
**16-22. SIP 200 (OK) response (IC-T1 to SCC AS-hA1 via IBCF-vA1, TRF, IBCF-
vA1, IC-A1, IBCF-hA1 and Sâ€‘CSCFâ€‘hA1).**
> When receiving a SIP 200 (OK) response to the re-SIP INVITE request from the
> remote UE the IC-T1 returns a SIP 200 (OK) response. No SRVCC specific
> information is added.
NOTE 5: If the interconnection network is SIP-unaware, step 20 is skipped.
**23-29. SIP ACK request (SCC AS-hA1 to IC-T1 via S-CSCF-hA1, IBCF-hA1, IC-A1,
IBCF-vA1, TRF and IBCFâ€‘vA1).**
> The SCC AS-hA1 acknowledges the receipt of the SIP 200 (OK) response. No
> SRVCC specific information is added.
NOTE 6: If the interconnection network is SIP-unaware, step 26 is skipped.
**30-33. SIP 200 (OK) response (SCC AS-hA1 to ATCF-vA1 via S-CSCFâ€‘hA1, IBCF-
hA1, ICâ€‘A1 and IBCF-vA1).**
> See steps 16-20 in clause 5.11.3.
**34-37. SIP ACK request (ATCF-vA1 to SCC AS-hA1 via IBCF-vA1, IC-A1, IBCF-
hA1/I-CSCF and Sâ€‘CSCFâ€‘hA1).**
> The ATCF-vA1 acknowledges the receipt of the SIP 200 (OK) response. No SRVCC
> specific information is added.
## 5.12 Invocation and configuration of services during roaming in a visited
network
This case describes how the user within a visited network invokes services via
the Ut interface.
GSMA IR.88 [603] describes that the home operator must provide an APN to be
used by the UE for XCAP/Ut. For the UE details see GSMA IR.92 [604].
The \"well-known\" IMS APN must not be used as APN for XCAP/Ut as defined in
of IR.88 [603] clause 6.3.2.
In addition GSMA IR.92 [604] describes that for XCAP requests, the UE must be
preconfigured or provisioned by the home operator with the APN to be used for
XCAP requests.
Since this connection is a direct connection between the UE and the related AS
to configure services by the user it is not seen any interactivity for
charging relevant issues as described within the VoLTE Charging framework.
(i.e. TS 32.260 [20]).
The connection is done via http and is only relevant for data volume used for
IP connectivity.
Figure 5.12.1: Service configuration example
## 6.1 Key Issue #1: Unnecessary correlation of CDRs when loopback is not
active
### 6.1.1 Description
Clause 4.2 describes a principle that an operator shall be able to use
information given within CDR to calculate the accounting fees between HPLMN
and VPLMN.
The Pâ€‘CSCF CDR is the primary source of information for the VPLMN to charge
the HPLMN for roaming users. In the VPLMN, when loopback is enabled for a
session, then additional information from the TRF CDR generated for the
session is relevant for such a calculation. Such information is also usable
for IBCF CDR correlation.
In cases where loopback applies for a roaming call, the originating Pâ€‘CSCF
does not get the information if loopback applies. When processing the Pâ€‘CSCF
CDR, the operator must attempt to locate a correlated TRF CDR even for the
non-loopback scenario when no CDR exists.
With regard to operation principles, it is seen that a big effort is needed to
correlate the CDRs given by the P-CSCF, IBCF and TRF within the visited
network to generate the TAP record incurring significant processing load in
the billing system.
In SRVCC use cases such information would be valuable for the ATCF too.
### 6.1.2 Assumptions
The S-CSCF receives a feature caps indicator (\"+g.3gpp.loopback\") in the
backward direction to indicate that loopback applies for an IMS session.
Within the S-CSCF this indication is deleted and not forwarded to the P-CSCF
within the visited network. Thus, the P-CSCF is not aware that loopback has
occurred.
### 6.1.3 Current Status
In cases when loopback applies for a roaming call, the originating P-CSCF does
not get the information that loopback has been applied leading to significant
unnecessary correlation activity in the billing domain.
### 6.1.4 Alternative Options
#### 6.1.4.1 Alternative 1 -- Loopback indication
To remove the need to attempt to locate TRF CDRs for IMS sessions for which no
loopback has occurred, this alternative proposes that an indication be
delivered via SIP to the Pâ€‘CSCF and ATCF for recording in the CDR. This
indication will let the operator know when to expect a corresponding TRF CDR
for this IMS session allowing for efficient processing in the billing system.
An example of such an indication is the feature caps indicator
(\"+g.3gpp.loopback\") that the S-CSCF receives in the backward direction to
indicate that loopback applies for the IMS session. If this indication is
delivered to the P-CSCF and recorded in the CDR, then, the operator billing
system will be aware of when there is a need to perform correlation with a TRF
CDR.
With regard to the information the NNI Information contains that loopback has
been applied. The IE NNI Information/IE NNI Type is sent by the CTF but
included neither within the P-CSCF CDR nor within the ATCF CDR.
### 6.1.5 Evaluation and Recommendation
It is recommended to include the NNI Information information within the P-CSCF
and ATCF CDR.
CT1 should be involved (Liaison) within the work for this solution. Important
for such solution is a indication that loopback is applied is received by the
VPLMN.
## 6.2 Key Issue #2: Identification of home network
### 6.2.1 Description
One of the charging principles in clause 4.2 is that the roaming subscriber
only has a contract with his home network operator (HPLMN).
TD.57 sets this as a mandatory element.
Table 6.2.1.1: TD.57 Excerpt
+-------------+-------------+----+---------+--------+-------------+ | **Charged | Information | 30 | Content | Severe | Mandatory | | Party Home | identifying | | | | item Home | | Ident | the home | 31 | Content | Severe | Id Type | | ification** | environment | | | | missing | | | of the | | | | within | | | Charged | | | | group. | | | Party. | | | | | | | | | | | Mandatory | | | The group | | | | item Home | | | when | | | | Identifier | | | present | | | | missing | | | must | | | | within | | | contain | | | | group. | | | items Home | | | | | | | Id Type and | | | | | | | Home | | | | | | | Identifier. | | | | | | | | | | | | | | This | | | | | | | information | | | | | | | is not | | | | | | | required | | | | | | | when the | | | | | | | Home and | | | | | | | Recipient | | | | | | | are the | | | | | | | same | | | | | | | entity. | | | | | | | | | | | | | | _Condi | | | | | | | tionality:_ | | | | | | | | | | | | | | One or more | | | | | | | occurrences | | | | | | | may be | | | | | | | present | | | | | | | within | | | | | | | group | | | | | | | Charged | | | | | | | Party | | | | | | | Information | | | | | | | where | | | | | | | available. | | | | | +-------------+-------------+----+---------+--------+-------------+
The home network name is required to identify the HPLMN to which the TAP CDR
will be sent.
To identify the \"charging distance\" for direct media home routing (i.e.
without loopback) the home network information is needed. This is reflected in
the charging principles in clause 4.2; \"zonal charging\" shall be supported.
### 6.2.2 Assumptions
Within the Call Scenarios given in Subclauses 5.1.1 and 5.1.2 for Mobile
originating call with and without loopback the home network operator is known
by the inclusion of the Route header field. The last element includes the
information about the home network. Thus the P-CSCF and the IBCF of the
visited network have the information now.
Since this information directly relates to the routing of the call, it can be
used for \"zonal charging\".
The TRF will get the Information within the INVITE which includes the feature
caps header in the format Feature-Caps:*;+g.3gpp.loopback=\"homenetwork_A\".
For terminating calls as described in clause 5.1.3, the IOI information
related to the home network within the INVITE may not be sufficient.
### 6.2.3 Current Status
With regard to TS 32.260 [20], the Home network is not an existing field while
the Route header is included within the CDR of the P-CSCF.
The P-CSCF includes the information identified in table 6.2.3.1.
Table 6.2.3.1: Charging Data of P-CSCF CDR
* * *
Field Category Description SIP Route header received O~C~ Contains the
information in the topmost route header in a received initial SIP INVITE or
non-session related SIP MESSAGE request. This field is used for SIP requests
toward the served user. SIP Route header transmitted O~C~ Contains the
information in the route header representing the destination in a transmitted
initial SIP INVITE or non-session related SIP MESSAGE request. This field is
used for SIP requests from the served user.
* * *
The SIP Route header received is only for terminating calls and will not have
any information of the home network
The SIP Route header transmitted will have the home network information within
the last entry.
The IBCF includes the information identified in table 6.2.3.2.
Table 6.2.3.2: Charging Data of IBCF CDR
* * *
Field Category Description SIP Route header received in an INVITE request O~C~
Contains the information in the topmost route header in a received initial SIP
INVITE and non-session related SIP MESSAGE request.
* * *
The SIP Route header received in an INVITE request contains the information in
the topmost route header of the received INVITE i.e. the IBCF address itself.
More information is not given within the CDR. In addition seen from the call
scenario it is also not clear what role the IBCF has in such a call either
entry or exit point.
Table 6.2.3.3: Charging Data of TRF CDR
* * *
Field Category Description SIP Route header received O~C~ Contains the
information in the topmost route header in a received initial SIP INVITE or
non-session related SIP MESSAGE request.
* * *
The SIP Route header received in an INVITE request contains the information in
the topmost route header of the received INVITE i.e. the TRF address itself
Looking on the data collected by the P-CSCF, IBCF and TRF only the P-CSCF
within the originating visited network will have the information of the home
network. The IBCF and TRF CDRs do not include the home network information.
### 6.2.4 Alternative Options
#### 6.2.4.1 Alternative 1 -- Home Network Information from Registration
Procedure
During the registration procedure, the P-CSCF stores the Service-Route header
fields (TS 24.229 [106], clause 5.2.2.1) and keeps them during the entire
registration period. The Service-Route header points to the S-CSCF which is
always located in the home network. Hence, information on the home network is
always available in a P-CSCF serving an inbound roamer and can easily be
included in the P-CSCF CDR, independent of call scenario (MOC and MTC), and
independent of the routing scenario (with or without loopback).
#### 6.2.4.2 Alternative 2 -- IOI sent in SIP INVITE Request and SIP 200 (OK)
response
The SIP INVITE request sent form the terminating home network towards the
terminating visited network will contain a Type 1 Orig-IOI set to the
terminating home network. This value can be taken by the P-CSCF to identify
the home network.
Each INVITE will be finally answered with SIP 200 (OK) response sent by the
UAS. The originating S-CSCF includes a Type 1 Term-IOI into the P-Charging-
Vector header field. This is received by the originating P-CSCF.
This information is only available when the P-Charging --Vector header field
is passed towards the originating visited network. In cases where calls will
be passed through a transit network which may not be trusted the P-Charging-
vector header field may be deleted.
#### 6.2.4.2 Alternative 3 -- Use of other SIP header fields
The use of other SIP header fields where the home network may be included
seems not to be workable.
The headers taken into consideration are the Via header field, the Route
header field and the Record-Route header field.
The SIP Via header field will contain all SIP entities passed in forward
direction. This header will be collected within the initial SIP request and
copied into the SIP response. This is needed that the response will pass all
elements needed.
The home network will be traced in form of the S-CSCF address. But the
mechanism will possibly not work when a B2BUA is in between the visited and
home network. If this B2BUA has a THIG functionality the B2BUA (e.G IBCF) will
store the received Via header field and send a new via header field with one
entry.
Record-Route header field will normally also not pass B2BUA (i.e. IBCF) thus
the same apply as for the via header field. The Record-Route header may be
used only for terminating calls where the S-CSCF or other anchor entity for
the home network is included. For originating calls the Route header field may
be used to identify the home network. Thus the last entity included will be
the home network.
Additionally the entries within the Sip header fields Via, Route and Record-
Rout includes physical entities which may not apply to the home network. This
would happen when an operator is reselling capacity to a service provider
selling its own brand for mobile communication.
### 6.2.5 Evaluation and Recommendation
Seen form availability both information will be available in normal call
scenarios. In cases when passing non trusted networks the P-Charging vector
header may be deleted. Such case can happen but assuming the ideal use case,
i.e. the operator is interconnecting only with trusted operators; the use of
IOI\'s should be secure.
The question operators have to ask is, if it can be guaranteed that the
P-Charging--Vector header will not be manipulated by transit networks. If not
the IOI value cannot be considered. But following this approach the question
is if the other information exchanged is also trustworthy, i.e. registration
information.
Thus both Alternatives will work in normal use cases.
To have a 100% secure solution a proposal for solution would be that the
Type_1 Term-IOI should be compared with the home network ID stored by the
P-CSCF. If the Term-IOI is not available or has another value than the stored
home network ID then the stored home network-id shall have precedence. For the
terminating case the same ruling with the Orig-IOI sent within the SIP INVITE
apply.
A recommendation is that TS 32.260 should improve the description of the use
of IOI values to identify the home network of the UE and additionally the
comparison procedure should be taken into consideration for a 100% proof
identification of the home network.
## 6.3 Key Issue #3: Media Plane Interconnection is not reflected in any CDR
### 6.3.1 Description
One IBCF (signalling plane interconnection) may control multiple TrGWs (media
plane interconnection). TrGWs controlled by one IBCF may be spatially
separated by long distances, and (in case of a multinational operator, i.e. a
company controlling multiple mobile networks in different countries) they may
even be located in different PLMNs.\ In this case, the address of the TrGW may
be more relevant for charging / accounting than the address of the IBCF.
Furthermore, a network node (e.g. an IBCF or a TrGW) may use multiple \"own\"
IP addresses to distinguish between different connections to neighbour nodes
(e.g. IP address \"A1\" for connections to operator B1, and IP address \"A2\"
for connections to operator B2). However, currently only one (own / IBCF)
\"Node Address\" and one \"Neighbour Node Address\" are included in the IBCF
CDR
An example is depicted in figure 6.3.1.1: a connection is set up from operator
A to a destination belonging to operator B. Operator B controls two networks
(PLMN B1 and PLMN B2) (e.g.) in two different countries. However, it uses only
one IBCF located in PLMN B1, whereas the destination of the call is located in
PLMN B2.
The outgoing TrGW (A) of operator A uses two different \"own\" IP addresses
for connections towards the different TrGWs: IP address A1 for connections
towards TrGW (B1) and IP address A2 for connections towards TrGW (B2). The
signalling plane connection is established between IBCF (A) and IBCF (B),
where IBCF (B) happens to be in PLMN B1. Since the destination is located in
PLMN B2, the media plane connection is established from TrGW (A) using IP
address A2 towards TrGW (B2) (thick red line). TrGW (A) would also support a
connection towards TrGW (B1) (grey dotted line; using IP address A1), but this
is not established here, because the destination is located in PLMN B2.
Figure 6.3.1.1: Example: Usage of LinkID
### 6.3.2 Assumptions
The field NNI Information only contains information on network nodes for the
signalling plane (IBCF addresses). However, for voice (or video) connections,
the media plane is relevant for charging / accounting. Hence, information
about the interconnection nodes of the media plane (e.g. TrGWs) should also be
included in the IBCF CDR.
A conversation table within an IMS network element must be built to correlate
the source and destination IP addresses with a specific LinkID this has to be
done within each IMS element. Problematic is that each IMS element will have
their own LinkID\'s because a correlation between the IMS element would need
more protocol and procedural work to be done. Or it has to be done via
configuration which needs even more effort.
Thus building a LinkID needs an automatic naming mechanism extracted of
available data within the node. I.e. using the transport IP addresses would be
the easiest approach but will not solve to bundle the different TrGW used by
the originating or terminating operator for a interconnection relation.
### 6.3.3 Current Status
Currently, the used connection between the two networks for the media plane is
not at all reflected in the IBCF CDR. Since the media plane is usually to be
charged, correct interconnection charging is not possible.
### 6.3.4 Alternative Options
#### 6.3.4.1 Alternative 1 -- LinkID
The introduction of a new field \"LinkID\" into the field NNI Information in
IBCF CDR is possible. This field is introduced as an equivalent to the
\"TrunkID\" that is currently used in CS networks. It shall contain a
(logical, operator specific) logical ID.
The LinkID shall unambiguously identify the IP connection towards the
neighbour TrGW node, which is used for the media plane of the current call.
(In the example figure: the \"red arrow\", identified by the IP address (and
port) A2 used at TrGW(A), and the IP address (and port) of TrGW(B2).)
An IBCF needs related tables which have to be configured to identify the
needed IP Address relations for one LinkID. Another aspect is that the IP
addresses of the destination may vary depended on the SDP answer coming from
the interconnection partner. To fix such aspects more bilateral negotiation is
needed and even that will not guarantee every time a correct interconnection
relation.
#### 6.3.4.2 Alternative 2 -- Connection Data within SDP
As an alternative to a \"logical\" ID, the pair of both IP address (and ports)
of both TrGWs used in the interconnection scenario may be included, however an
abstract \"logical\" ID to be sufficient and easier to implement. A logical ID
would also decouple the CDR post processing in IT billing systems from the
actual technical network IP configuration.
The information is given within the SDP lines:
o= (originator and session identifier)
> This address line contains the is the address of the machine from which the
> session was created. Thus this address is the UAC (i.e. UE or B2BUA)
> creating the session.
c=* (connection information -- not required if included in all media)
This line contains the IP address of the expected data source or data relay or
data sink as determined by additional attribute fields.
m= (media name and transport address)
This line contains the transport port to which the media stream shall be sent.
These Data will be sent within the offer which is normally contained within
the SIP INVITE request and the answer which is normally within one of the
received provisional or final responses.
The \"c\" line is within the SDP Media Description AVP and the \"m\" line is
within the SDP Media Name AVP included.
These AVP\'s will appear several times since within the offer and answer the
related IP addresses are different. Thus originating and designating IP
address will appear in different AVP\'s.
The information of the interconnection partner is given within the ioi values
and can be processed within the billing domain
### 6.1.5 Evaluation and Recommendation
Both possibilities are working. Alternative 1 has the advantage that the
LinkID is one identifier that allows an easy identification of the RTP
relation within the billing domain. But processing in the P-CSCF needs
additional effort for signaling procedures and configuration of data by the
operator.
The extraction of both IP addresses out of the \"c\" line and possibly the
\"m\" line as described in Alternative 2 in the billing domain is more complex
but no changes within the P-CSCF are needed. Also configuration of LinkID\'s
within the billing domain would be easier since it is centralized.
Alternative 2 is seen as the preferred solution since the billing domain can
needs only one centralized information about the interconnection relationship.
Thus such a linked can be built easy within the billing domain.
For specification within 3GPP no additional work needs to be done since the
functionality of the billing domain is negotiated between operator and vendor.
Thus if a LinkID is needed for billing purposes this needs to be indicated by
the operator to the vendor of the billing domain.
## 6.4 Other topics to be considered and recommendations
### 6.4.1 List of Early Media
The relevant information collected is covered with the \"List of Early SDP
Media Components\" and \"List of SDP Media Components\" as described in TS
32.260 [20]. With regard to TS 32.299 [50] the \"List of Early SDP Media
Components\" describes session, media parameters and timestamps related to
media components set to active according to SDP signalling exchanged during a
SIP session establishment and before the final successful or unsuccessful SIP
response to the initial SIP INVITE message is received. Once a media component
has been set to active, subsequent status changes shall also be registered.
The latest update of TS 24.229 [109] allows also to activate the SDP with
precondition negotiation. i.e. attributes in SDP like \"sendonly\",
\"recvonly\" and \"sendrecv\" may be present and it is not clear if early
media is used or not. Thus an additional parameters like the P-Early-Media
header field should be taken into consideration.
Thus a documentation extension with additional procedures within the TS 32.260
[20] and TS 32.229 [50] is recommended.
### 6.4.2 Inter Operator Traffic Leg parameter (iotl)
TS 24.229 [109] describes that within the IM CN subsystem, the signalling path
between a calling user and a called user can be divided into one or more
traffic legs, referred to as II-NNI traversal scenarios. Each II-NNI traversal
scenario can span networks belonging to different operators and will have its
own characteristics that can be different from other II-NNI traversal
scenarios in the same call.
Dialog creating SIP requests and standalone requests can contain an \"iotl\"
SIP URI parameter as specified in draft-holmberg-dispatch-iotl [409] in a
Request-URI or in one or more Route header fields. The \"iotl\" SIP URI
parameter can be used to identify the II-NNI traversal scenario.
If the \"iotl\" SIP URI parameter is not included in a dialog creating SIP
requests or a standalone request, the II-NNI traversal scenario type can be
determined by analysing the content of the SIP request or using a default II-
NNI traversal scenario type.
draft-holmberg-dispatch-iotl [409] defines the following iotl values:
  * homea-homeb
  * homeb-visitedb
  * visiteda-homea
  * homea-visiteda
  * visiteda-homeb
This information gives a higher granulatity of the NNI Type. Thus it is
proposed to extend the NNI Type.
### 6.4.3 Early media termination with SIP 199 response
Since there is no change of SDP the IE Early Media Description nor IE SDP
Media Component will be changes. Thus seen from time stamp the early media
will still continue till an other codec negotiation will take place.
The specifications TS 32.260 [20] nor TS 32.298 [51] does not describe how to
proceed with ending an early media with SIP 199 response.
For defining new procedures reflecting the SIP 199 e.g. define a \"STOP event
indication\" for early media, a new WID is needed. Even this functionality is
exsisting since Release 8 within the stage 3 documents.
# 7 Conclusions
During the study it was identified that several issues should be solved to
have a complete charging for roaming.
The 3 Key Issues have the most importance to be solved since they help to
identify the roaming use cases in a better way.
The following list is what SA5 has to do in recommendation for the RAVEL
issues:
Key Issue#1 proposing to include the loopback indication within the SIP
responses towards the P-CSCF and ATCF of the visited network will help and
avoid useless correlation of CDR\'s within the billing domain.
  * For this issue a Liaison will be sent to CT1 to ask for procedures to include the loopback indication within responses.
  * Based on the solution delivered b yCT1, SA5 has to adopt the needed procedures to include the NNI Information information within the P-CSCF and ATCF CDR.
Key Issue#2 proposing that the ioi values indicating the home network
delivered by the signalling should be correlated with the stored home network
id will help to secure the regarding information within the charging elements.
  * For this issue CR\'s needs to be provided to adopt the proposed changes within the SA5 documents. This needs activity by the participating delegates.
Key issue#3 proposing a LinkID will help to have a better correlation between
signalling and media plane and helps to have an easier correlation of CDR\'s
which are related to one traffic correlation.
  * since the proposed solution relates to the billing domain no activity is needed for SA5 to specify somthing. The solution the functionality is part of the billing domain and needs to be negotiated between operator and vendor within their own responsibility.
This is a list of observation where companies may provide proposals (CR\'s
and/or WID\'s):
The iotl defined in draft-holmberg-dispatch-iotl [409] value was developed in
parallel to our study which gives more information at the point of
interconnection in what scenario the call currently is.
  * Thus a documentation extension with additional procedures within is recommended. Therefore interested companies should bring up the regarding Work Item or CR\'s to work on this topic.
For media termination the SIP 199 response code should be considered in cases
where in specific cases where early media needs to be considered with regard
to billing and charging.
  * This functionality is existing since Release 8 within the CT documents. But it looked that this was never considered for charging. For introducing such procedures a new WID is needed.
  * And also new procedures for early media needs to be taken into consideration since TS 24.229 [109] changed the ruling for sending SDP within the SIP INVITE request which can be set to \"sendonly\", \"recvonly\" and \"sendrecv\".This is a change done in Release 13 so CR\'s are needed to reflect that change within SA5 Release 13 documents.
#
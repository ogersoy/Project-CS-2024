# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document is part of a series of documents that specify charging
functionality and charging management in GSM/UMTS networks. The GSM/UMTS core
network charging architecture and principles are specified in TS 32.240 [1],
which provides an umbrella for other charging management TSs that specify:
\- the content of the CDRs per domain / subsystem / service (offline
charging);
\- the content of real-time charging messages per domain / subsystem / service
(online charging);
\- the functionality of online and offline charging for those domains /
subsystems / services;
\- the interfaces that are used in the charging framework to transfer the
charging information (i.e. CDRs or charging events).
The complete document structure for these TSs is defined in TS 32.240 [1].
The present document specifies the offline and online charging description for
the Proximity-based Services (ProSe), based on the stage 2 description of
ProSe in TS 23.303 [238]. This charging description includes the offline and
online charging architecture and scenarios specific to the ProSe, as well as
the mapping of the common 3GPP charging architecture specified in TS 32.240
[1] onto the ProSe. It further specifies the structure and content of the CDRs
for offline charging, and the charging events for online charging. The present
document is related to other 3GPP charging TSs as follows:
\- The common 3GPP charging architecture is specified in TS 32.240 [1].
\- The parameters, abstract syntax and encoding rules for the CDRs are
specified in TS 32.298 [51].
\- A transaction based mechanism for the transfer of CDRs within the network
is specified in TS 32.295 [54].
\- The file based mechanism used to transfer the CDRs from the network to the
operator\'s billing domain (e.g. the billing system or a mediation device) is
specified in TS 32.297 [52].
\- The 3GPP Diameter application that is used for ProSe offline and online
charging is specified in TS 32.299 [50].
All references, abbreviations, definitions, descriptions, principles and
requirements, used in the present document, that are common across 3GPP TSs,
are defined in TR 21.905 [100]. Those that are common across charging
management in GSM/UMTS domains, services or subsystems are provided in the
umbrella TS 32.240 [1] and are copied into clause 3 of the present document
for ease of reading. Finally, those items that are specific to the present
document are defined exclusively in the present document.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TS 32.240: \"Telecommunication management; Charging management;
Charging Architecture and Principles\".
[2] - [9] Void.
[10] 3GPP TS 32.250: \"Telecommunication management; Charging management;
Circuit Switched (CS) domain charging\".
[11] 3GPP TS 32.251: \"Telecommunication management; Charging management;
Packet Switched (PS) domain charging\".
[12] - [19] Void.
[20] 3GPP TS 32.260: \"Telecommunication management; Charging management; IP
Multimedia Subsystem (IMS) charging\".
[21] - [29] Void.
[30] 3GPP TS 32.270: \"Telecommunication management; Charging management;
Multimedia Messaging Service (MMS) charging\".
[31] - [49] Void.
[50] 3GPP TS 32.299: \"Telecommunication management; Charging management;
Diameter charging applications\".
[51] 3GPP TS 32.298: \"Telecommunication management; Charging management;
Charging Data Record (CDR) parameter description\".
[52] 3GPP TS 32.297: \"Telecommunication management; Charging management;
Charging Data Record (CDR) file format and transfer\".
[53] Void.
[54] 3GPP TS 32.295: \"Telecommunication management; Charging management;
Charging Data Record (CDR) transfer\".
[55] - [99] Void.
[100] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[101] 3GPP TS 22.115: \"Service aspects; Charging and billing\".
[102] - [199] Void.
[200] - [236] Void.
[237] 3GPP TS 24.002: \"GSM - UMTS Public Land Mobile Network (PLMN) Access
Reference Configuration\".
[238] 3GPP TS 23.303: \"Proximity-based services (ProSe); Stage 2\".
[239] Void.
[240] 3GPP TS 33.303: \"Proximity-based Services (ProSe); Security aspects\".
[241] - [499] Void.
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [100] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in TR
21.905 [100].
**2G‑ / 3G‑:** prefixes 2G‑ and 3G‑ refer to functionality that supports only
GSM or UMTS, respectively, e.g. 2G‑SGSN refers only to the GSM functionality
of an SGSN. When the term/prefix is omitted, reference is made independently
from the GSM or UMTS functionality.
**accounting:** process of apportioning charges between the Home Environment,
Serving Network and Subscriber.
**billing:** function whereby CDRs generated by the charging function(s) are
transformed into bills requiring payment.
**Billing Domain:** part of the operator network, which is outside the
telecommunication network that receives and processes CDR files from the core
network charging functions. It includes functions that can provide billing
mediation and billing or other (e.g. statistical) end applications. It is only
applicable to offline charging (see \"Online Charging System\" for equivalent
functionality in online charging).
**chargeable event:** activity utilizing telecommunication network resources
and related services for:
\- user to user communication (e.g. a single call, a data communication
session or a short message); or
\- user to network communication (e.g. service profile administration); or
\- inter-network communication (e.g. transferring calls, signalling, or short
messages); or
\- mobility (e.g. roaming or inter-system handover); and
\- that the network operator may want to charge for.
As a minimum, a chargeable event characterises the resource / service usage
and indicates the identity of the involved end user(s).
**charged party:** user involved in a chargeable event who has to pay parts or
the whole charges of the chargeable event, or a third party paying the charges
caused by one or all users involved in the chargeable event, or a network
operator.
**charging:** function within the telecommunications network and the
associated OCS/BD components whereby information related to a chargeable event
is collected, formatted, transferred and evaluated in order to make it
possible to determine usage for which the charged party may be billed (offline
charging) or the subscriber\'s account balance may be debited (online
charging).
**Charging Data Record (CDR):** formatted collection of information about one
or more chargeable event(s) (e.g. time of call set-up, duration of the call,
amount of data transferred, etc) for use in billing and accounting. For each
party to be charged for parts of or all charges of the chargeable event(s) a
separate CDR should be generated, i.e. more than one CDR may be generated for
a single chargeable event, e.g. because of its long duration, or because more
than one charged party is to be charged.
**charging event:** set of charging information forwarded by the CTF towards
the CDF (offline charging) or towards the OCS (online charging). Each charging
event matches exactly one chargeable event.
**charging function:** entity inside the core network domain, subsystem or
service that is involved in charging for that domain, subsystem or service.
**Credit Control:** mechanism which directly interacts in real-time with an
account and controls or monitors the charges, related to the service usage.
Credit control is a process of: checking if credit is available, credit
reservation, deduction of credit from the end user account when service is
completed and refunding of reserved credit not used.
**domain:** part of a communication network that provides network resources
using a certain bearer technology.
**EPC-level ProSe Discovery:** A ProSe Discovery procedure by which the EPC
determines the proximity of two ProSe-enabled UEs and informs them of their
proximity.
**Fully Qualified Partial CDR (FQPC):** partial CDR that contains a complete
set of the fields specified in the present document. This includes all the
mandatory and conditional fields as well as those fields that the PLMN
operator has provisioned to be included in the CDR. The first Partial CDR
should be a Fully qualified Partial CDR.
**GTP\':** GPRS protocol used for CDR transport. It is derived from GTP with
enhancements to improve transport reliability necessary for CDRs.
NOTE: This protocol is not used for tunnelling.
**GSM only:** qualifier indicating that this clause or paragraph applies only
to a GSM system. For multi-system cases this is determined by the current
serving radio access network.
**in GSM,...:** qualifier indicating that this paragraph applies only to GSM
System.
**in UMTS,...:** qualifier indicating that this paragraph applies only to UMTS
System.
**inter-system change:** change of radio access between different radio access
technologies such as GSM and UMTS.
**Local PLMN** : A PLMN which is not the serving PLMN, and in whose radio
resources the monitoring UE is authorized by the HPLMN to engage in ProSe
Direct Discovery.
**middle tier TS:** term used for the 3GPP charging TSs that specify the
domain / subsystem / service specific, online and offline, charging
functionality. These are all the TSs in the numbering range from 3GPP TS
32.250 to 3GPP TS 32.279, e.g. 3GPP TS 32.250 [10] for the CS domain, or 3GPP
TS 32.270 [30] for the MMS service. Currently, there is only one \"tier 1\" TS
in 3GPP, which is 3GPP TS 32.240 [1] that specifies the charging architecture
and principles. Finally, there are a number of top tier TSs in the 32.29x
numbering range ([50] ff) that specify common charging aspects such as
parameter definitions, encoding rules, the common billing domain interface or
common charging applications.
**Model A:** involves one UE announcing \"I am here\"
**Model B:** involves one UE asking \"who is there\" and/or \"are you there\"
**offline charging:** charging mechanism where charging information **does
not** affect, in real-time, the service rendered.
**online charging:** charging mechanism where charging information **can**
affect, in real-time, the service rendered and therefore a direct interaction
of the charging mechanism with bearer/session/service control is required.
**Online Charging System (OCS):** the entity that performs real-time credit
control. Its functionality includes transaction handling, rating, online
correlation and management of subscriber account balances.
**partial CDR:** CDR that provides charging information on part of a
subscriber session. A long session may be covered by several partial CDRs. Two
formats are considered for Partial CDRs. One that contains all of the
provisioned fields (FQPC); the second has a reduced format (RPC).
**ProSe Direct Discovery:** A procedure employed by a ProSe-enabled UE to
discover other ProSe-enabled UEs in its vicinity by using only the
capabilities of the two UEs with E-UTRA technology.
**ProSe Discovery:** A process that identifies that a UE that is ProSe-enabled
is in proximity of another, using E-UTRA (with or without E-UTRAN) or EPC.
**ProSe-enabled Public Safety UE:** A UE that the HPLMN has configured to be
authorized for Public Safety use, and which is ProSe-enabled and supports
ProSe procedures and capabilities specific to Public Safety.
**ProSe Function:** The ProSe Function is the logical function that is used
for network related actions required for ProSe. The ProSe Function plays
different roles for each of the features of ProSe. In this version of the
specification it is assumed that there is only one logical ProSe Function in
each PLMN that supports Proximity Services.\ The ProSe Function contains three
main sub-functions: Direct Provisioning Function (DPF), Direct Discovery Name
Management Function, and EPC-level Discovery Function. The ProSe Function
provides the necessary charging functionality for usage of ProSe.
**real-time:** real-time charging and billing information is to be generated,
processed, and transported to a desired conclusion in less than 1 second.
**Reduced Partial CDR (RPC):** partial CDRs that only provide mandatory fields
and information regarding changes in the session parameters relative to the
previous CDR.
> EXAMPLE: Location information is not repeated in these CDRs if the
> subscriber did not change its location.
**settlement:** payment of amounts resulting from the accounting process.
**subscriber:** entity (associated with one or more users) that is engaged in
a subscription with a service provider. The subscriber is allowed to subscribe
and unsubscribe services, to register a user or a list of users authorized to
enjoy these services, and also to set the limits relative to the use that
associated users make of these services.
**user:** entity, not part of the 3GPP System, that uses network resources by
means of a subscription. The user may or may not be identical to the
subscriber holding that subscription.
**User Equipment (UE):** device allowing a user access to network services.
For the purpose of 3GPP specifications the interface between the UE and the
network is the radio interface. A User Equipment can be subdivided into a
number of domains, the domains being separated by reference points. Currently
defined domains are the USIM and ME Domains. The ME Domain can further be
subdivided into several components showing the connectivity between multiple
functional groups. These groups can be implemented in one or more hardware
devices. An example of such a connectivity is the TE -- MT interface. Further,
an occurrence of a User Equipment is an MS for GSM as defined in TS 24.002
[237].
## 3.2 Symbols
For the purposes of the present document, the following symbols apply:
Bpr Reference point for CDR file transfer between ProSe CGF and the BD.
Bx Reference point for CDR file transfer between any (generic) 3G domain,
subsystem or service CGF and the BD.
Ga Reference point for CDR transfer between a CDF and the CGF.
PC3 Reference point between UE and the ProSe Function.
PC3ch Subset of PC3 specific to usage information collection for charging
purposes.
Rf Offline charging reference point between a ProSe Function and the CDF.
Ro Online charging reference point between a ProSe Function and the OCS.
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[100] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [100].
3G 3rd Generation
3GPP 3^rd^ Generation Partnership Project
APN Access Point Name
AVP Attribute Value Pair
BD Billing Domain
CDF Charging Data Function
CDR Charging Data Record
CGF Charging Gateway Function
CTF Charging Trigger Function
ECUR Event Charging with Unit Reservation
E-UTRA Evolved Universal Terrestrial Radio Access
E-UTRAN Evolved Universal Terrestrial Radio Access Network
FQPC Fully Qualified Partial CDR
GTP GPRS Tunnelling Protocol
GTP The GPRS protocol used for CDR transport. It is derived from GTP with
enhancements to improve transport reliability necessary for CDRs.
HPLMN Home PLMN
HSS Home Subscriber Server
IE Information Element
IEC Immediate Event Charging
IMS IP Multimedia Subsystem
IMSI International Mobile Subscriber Identity
IP Internet Protocol
IPv4 Internet Protocol version 4
IPv6 Internet Protocol version 6
ISDN Integrated Services Digital Network
MCC Mobile Country Code (part of IMSI)
ME Mobile Equipment
MNC Mobile Network Code (part of IMSI)
MSISDN Mobile Station ISDN number
NE Network Element
OCS Online Charging System
PLMN Public Land Mobile Network
ProSe Proximity-based Services
PS Packet-Switched
QoS Quality of Service
RAN Radio Access Network
SCUR Session Charging with Unit Reservation
SIM Subscriber Identity Module
TR Technical Report
TS Technical Specification
UE User Equipment
UMTS Universal Mobile Telecommunications System
USIM User Service Identity Module
VPLMN Visited PLMN
WLAN Wireless LAN
# 4 Architecture considerations
## 4.1 High level ProSe architecture
Figure 4.1.1 shows the high level view of the non-roaming architecture for
ProSe that is defined in TS 23.303 [238].\ In this figure, UE A and UE B have
subscriptions from the same PLMN.
Figure 4.1.1: Non-roaming reference architecture
Figure 4.1.2 shows the high level view of non-roaming inter-PLMN architecture
for ProSe defined in TS 23.303 [238]. In this figure, PLMN A is the HPLMN of
UE A, and PLMN B is the HPLMN of UE B.
{width="6.695138888888889in" height="9.229166666666666in"}
Figure 4.1.2: Inter-PLMN reference architecture
Figure 4.1.3 shows the high level view of the roaming architecture for ProSe
as defined in TS 23.303 [238]. In this figure, UE A uses a subscription of
PLMN A and UE B uses a subscription of PLMN B; UE A is roaming in PLMN C while
UE B is not roaming.
Figure 4.1.3: Roaming reference architecture
> NOTE: For EPC-level ProSe discovery the roaming architecture is not
> specified in this release.
## 4.2 ProSe offline charging architecture
For ProSe Direct Discovery and EPC-level Discovery services, as described in
TS 32.240 [1], the CTF (an integrated component in each charging relevant
ProSe Function) generates charging events and forwards them to the CDF. The
CDF, in turn, generates CDRs which are then transferred to the CGF. Finally,
the CGF creates CDR files and forwards them to the Billing Domain.
If the ProSe Function generating the charging information has an integrated
CDF, then the ProSe Function can produce CDRs. The CGF may also be integrated
in the ProSe Function, or it may exist as a physically separate entity. If the
CGF is external to the ProSe Function, then the CDF forwards the CDRs to the
CGF across the Ga interface.\ In this case, the relationship between ProSe
Function/CDF and CGF is m:1. If the CGF is integrated in the ProSe Function,
then there is only an internal interface between the CDF and the CGF. In this
case, the relationship between ProSe Function/CDF and CGF is 1:1.
If the CDF is external to the ProSe Function, the charging events are
transferred from the ProSe Function to the CDF via the Rf interface specified
in TS 32.299 [50]. In this case, the relationship between ProSe Function and
CDF is m:1.
When an external CGF is used, this CGF may also be used by other, i.e. non-
ProSe, network elements, according to network design and operator decision. It
should be noted that the CGF may also be an integrated component of the BD --
in this case, the Bx interface does not exist and is replaced by a proprietary
solution internal to the BD.
Figure 4.2.1 depicts the architectural options described above.
Figure 4.2.1: ProSe offline charging architecture
For the ProSe Direction Communication Service, the CTF is divided into two
functional blocks as described in Annex D of TS 32.240 [1]. The Accounting
Metrics Collection (AMC) function block is in the UE. The AMC sends usage
information collected to the Accounting Data Forwarding (ADF) function block
of the CTF in the ProSe Function over the PC3 reference point defined in TS
23.303 [238]. The subset of PC3 specific to usage information collection for
charging purposes is denoted as PC3ch in figure 4.2.2.
Figure 4.2.2: ProSe Direct Communication offline charging architecture
The PC3 protocol shall allow the following deployment options for the ProSe
Function CTF (ADF) for ProSe Direct Communication depicted in figure 4.2.2:
\- The ProSe Function CTF (ADF) for ProSe Direct Communication may be deployed
in the same system as any combination of the ProSe Function components defined
in clause 4.4.1 of TS 23.303 [238] (i.e. Direct Provisioning Function, Direct
Discovery Name Management Function, EPC-level Discovery Function).
\- The ProSe Function CTF (ADF) for ProSe Direct Communication may be deployed
in a logically or physically separate system from the ProSe Function
components defined in clause 4.4.1 of TS 23.303 [238]. To support this
deployment scenario, the PC3ch subset of the protocol for usage information
report delivery shall not require interaction with any other ProSe Function
component for successful and complete processing.
The network ensures that the UE can have IP access to its HPLMN ProSe
Function, in non-roaming and roaming case, as defined in TS 23.303 [238].
When the UE is out of coverage, PC3 reference point is not available. UE will
store the logged information and upload to the ProSe Function once the PC3
becomes available and the reporting criteria are met. UE\'s reporting of usage
information is only visible to the ProSe Function.
It is mandatory to support at least one of the options Rf, Ga or Bx interfaces
from the ProSe Function as described in the specification.
## 4.3 ProSe online charging architecture
ProSe online charging is based on ProSe function utilizing Ro interface and
application towards the OCS as specified in TS 32.299 [50]. The Ro reference
point covers all online charging functionality required for ProSe.
Figure 4.3.1: ProSe online charging architecture
# 5 ProSe charging principles and scenarios
## 5.1 ProSe charging principles
### 5.1.1 Requirements
There are three types of ProSe services defined in TS 23.303 [238]:
\- ProSe Direct Discovery,
\- ProSe EPC-level Discovery, and
\- ProSe one-to-many Direct Communication for Public Safety Use.
The following are high-level charging requirements for ProSe services, derived
from the requirements in TS 22.115 [101], and TS 23.303 [238].
ProSe Function shall be able to collect charging information for UEs in HPLMN,
in online and offline charging for:
\- ProSe Open Direct Discovery Model A;
\- ProSe EPC-level Discovery.
ProSe Function shall be able to collect charging information for UEs in VPLMN
in offline charging for:
\- ProSe Open Direct Discovery for Announce.
ProSe Function shall be able to collect charging information for UEs in VPLMN
and Local PLMNS in offline charging for:
\- ProSe Open Direct Discovery for Monitor and Match.
ProSe Function shall be able to collect charging information from UEs in HPLMN
and VPLMN in offline charging for:
\- ProSe one-to-many Direct Communication for Public Safety Use.
For ProSe one-to-many Direct Communication for Public Safety Use, the
following requirements apply to the UE delivery of usage information to the
ProSe Function:
\- When the UE is in E-UTRAN coverage, if the usage information recorded for
the current collection period is not empty, it shall report the usage
information as configured when the earlier one of the following criteria are
met:
\- a configured collection period has elapsed; the end of an associated
configured reporting window has not been reached; and the UE temporarily
switches to RRC CONNECTED mode; or
\- a configured collection period has elapsed and the end of an associated
configured reporting window has been reached.
\- When the UE is out of E-UTRAN coverage, the UE shall generate reports from
the recorded usage information every collection period and store the non-empty
reports in a non-volatile memory, and send the reports once the UE returns to
coverage.
\- The storage of the usage information and the execution of the reporting
procedure shall be in a secure environment in the UE that is trusted by the
operator.
NOTE 1: The secured storage and execution of the reporting procedure do not
guarantee that the recording of the usage information is trusted.
NOTE 2: When the UE operates out of coverage for a long time, the stored
reports may reach the limit of the memory. The handling of such situation is
determined by UE implementation.
\- The UE shall upload the usage information to a location configured by the
ProSe Function securely over PC3ch using the mechanism defined in TS 33.303
[240].
\- If a replacement of USIM occurs when UE is out of coverage, the usage
information for a given IMSI shall remain stored on the UICC or ME as long as
the UE does not use the USIM associated with that IMSI.
\- The results of the collection and delivery of usage information reports
should not affect the UE\'s use of the ProSe Direct Communication service.
NOTE 3: For Public Safety use the UE is able to use ProSe Direct Communication
service even if there are errors in usage information collection or reporting.
ProSe Function shall be capable of handling the Charging Characteristics.
Charging Characteristics can be specific for a subscription or for subscribed
services. ProSe Function shall use the Charging Characteristics profile to
decide if online or offline charging is used for a user. The Charging
Characteristics is provided by the HSS to the ProSe Function as part of the
subscription information. Requirements of the use of Charging Characteristics
are provided in annex A.
### 5.1.2 Charging information
#### 5.1.2.1 Charging information for ProSe Direct Discovery
For ProSe Direct Discovery, the ProSe Function shall collect the following
charging information:
\- identity of the mobile subscriber using the ProSe functionality, e.g. IMSI;
\- identity of the PLMN where the ProSe functionality is used;
\- specific ProSe functionality used, e.g. Announcing, Monitoring, or Match
Report;
\- role of the UE in the ProSe, e.g. Announcing UE, Monitoring UE;
\- model of the Direct Discovery used by the UE, e.g. Model A, or Model B;
\- the validity period associated with ProSe Application Code allocated to an
Announcing UE;
\- the PLMN ID extracted from the set of Filters provided for a Monitoring UE
in a Monitor Request and the maximum validity period associated with the set
of Filters;
\- the PLMN ID extracted from the ProSe Application Code and the monitored
PLMN ID with the timestamp reported by a Monitoring UE in the Match Report
message, which is triggered by the Monitoring UE when the ProSe Application
Code that matches the Discovery Filters does not have ProSe Application ID
already locally stored that correspond to this ProSe Application Code;
\- ProSe Application ID used in the ProSe Direct Discovery;
\- Application ID related to the ProSe Direct Discovery.
The charging information shall be collected when a UE performs ProSe Direct
Discovery, including Announcing Request, Monitoring Request, and Match Report.
#### 5.1.2.2 Charging information for ProSe EPC-level Discovery
For ProSe EPC-level Discovery, the ProSe Function shall collect the following
charging information:
\- identity of the mobile subscriber using the EPC-level Discovery, e.g. IMSI;
\- timestamp of Proximity Request received from UE;
\- duration of the EPC-level Discovery services authorized for the UE;
\- discovery Range authorized for the UE, e.g. geographic limit;
\- timestamp when a Proximity Alert is triggered, and the associated location
information;
\- WLAN direct communication Assistance Information and associated timestamps,
when applicable.
#### 5.1.2.3 Charging information for ProSe one-to-many Direction
Communication for Public Safety Use
For the ProSe one-to-many Direct Communication for Public Safety Use, the UE
shall collect the following information, and be included in the usage
information report to the ProSe Function for charging purposes, if configured
by the network:
\- UE identity, e.g. IMSI;
\- For every collection period:
\- Sequence number of the report;
\- List of the locations of the UE when in coverage, e.g. ECGIs, and the
corresponding timestamps;
\- Configured Radio Parameters used for the ProSe Direct Communication, as
defined in TS 24.333 [241];
\- List of timestamps of when the UE goes in/out of E-UTRAN coverage;
\- For every ProSe Direct Communication Group (identified by ProSe L2 Group
ID):
\- Group Parameters used for the ProSe Direct Communication, as defined in TS
24.333 [241], e.g. ProSe L2 Group ID, IP Multicast Address, Source IP address,
etc.;
\- Timestamp of the first one-to-many communication transmission/reception;
\- Identities of the transmitters in the one-to-many communication session,
e.g. Source L2 ID and IP address;
\- List of non-zero amount of data transmitted by UE;
\- List of amount of data transmitted by UE when in E-UTRAN coverage at each
location, with ECGI and the corresponding timestamps, and indicator of which
radio resources used (i.e., operator-provided in coverage or configured) and
the radio frequency used;
\- List of amount of data transmitted by UE for each out of E-UTRAN coverage
period and the corresponding timestamps and the radio frequency used ;
\- List of non-zero amount of data received by UE;
\- List of amount of data received by UE when in E-UTRAN coverage at each
location, with ECGI and the corresponding timestamps, and indicator of which
radio resources used (i.e., operator-provided in coverage or configured) and
the radio frequency used;
\- List of amount of data received by UE for each out of E-UTRAN coverage
period and the corresponding timestamps and the radio frequency used;
\- Application specific data, e.g. application specific session floor control
information, Application layer User ID of group members in the communication.
The network shall be able to configure the UE with information to be included
in the usage information report as per following:
\- Whether the Group Parameters need to be reported;
\- Whether timestamps of the first transmission/reception need to be reported;
\- Whether the amount of data transmitted by UE needs to be reported, and
whether with location information;
\- Whether the amount of data received by UE needs to be reported, and whether
with location information;
\- Whether the list of locations of the UE when in E-UTRAN coverage needs to
be reported;
\- Whether the list of timestamps of when UE goes in/out of E-UTRAN coverage
need to be recorded.
\- Whether the indicator of radio resources used and radio frequency are to be
reported with the amount of data transmitted and received.
## 5.2 ProSe offline charging scenarios
### 5.2.1 Basic principles
#### 5.2.1.1 General
The ProSe Functions in HPLMN, VPLMN, and Local PLMNs shall be able to report
charging events for CDRs generation by CDF.
In ProSe EPC-level Discovery scenario, the ProSe EPC-level Discovery CDRs (PF-
ED-CDR) shall be opened, updated, and closed based on the following:
\- Charging data related to ProSe EPC-level Discovery Proximity Request;
\- Charging data related to ProSe EPC-level Discovery Proximity Alert;
\- Charging data related to ProSe EPC-level Discovery Proximity Request
Cancellation.
The contents and purpose of each charging event that triggers CDR creation,
information addition, or closure are described in the following clauses.
When the CDF is implemented as a separate entity (than the ProSe Function),
the Charging Events triggering and contents for CDRs handling by the CDF are
described in clause 5.2.2.
#### 5.2.1.2 ProSe Direct Discovery charging
The charging information on the use of ProSe Direct Discovery is collected by
the ProSe Functions in HPLMN, VPLMN, and local PLMNs. Inter-operator charging
is supported.
When a charging event is reported to the CDF, it includes relevant information
as listed in clause 5.1.2.
The following chargeable events are defined for ProSe Direct Discovery
charging:
\- Monitor Request received by the ProSe Function in the HPLMN of the
Monitoring UE. Upon this event, a PF-DD-CDR is generated.
\- Monitor Request received by the ProSe Function of the PLMN providing the
Discovery Filter. Upon this event, a PF-DD-CDR is generated.
\- Announce Request received by the HPLMN ProSe Function of the Announcing UE.
Upon this event, a PF-DD-CDR is generated.
\- Announce Request received by the ProSe Function in the VPLMN of the
Announcing UE when roaming. Upon this event, PF-DD-CDR is generated.
\- Match Report Request received by the ProSe Function in the HPLMN of the
Monitoring UE. Upon this event, a PF-DD-CDR is generated.
\- Match Report Request received by the ProSe Function in the HPLMN of the
Announcing UE. Upon this event, a PF-DD-CDR is generated.
\- Match Report Info received by the ProSe Function in the VPLMN of the
Announcing UE when roaming. Upon this event, a PF-DD-CDR is generated.
#### 5.2.1.3 ProSe EPC-level Discovery charging
When a charging event is reported to the CDF, it includes relevant information
as listed in clause 5.1.2.
The following chargeable events are defined for ProSe EPC-level Discovery
charging:
\- Proximity Request. Upon this event, a new PF-ED-CDR is opened, and the
corresponding EPUID, ALUIDs, Application ID, window, Range, and location of
the UE are captured.
\- Proximity Request Renewal. Upon this event, an already open PF-ED-CDR for
corresponding initial request is updated with new location of the UE, time
window and range class.
\- Proximity Request Reject. Upon this event, the corresponding PF-ED-CDR is
closed, and an indication of the cause for reject is captured.
\- Proximity Request Cancellation. Upon this event, the corresponding PF-ED-
CDR is closed, and an indication of whether Proximity Alert was sent is
captured.
When the CDF is implemented as a separate entity, all these ProSe EPC-level
Discovery related chargeable events triggers the CDRs to be constructed,
enriched, or closed by CDF, according to description in clause 5.2.2.
#### 5.2.1.4 ProSe Direct Communication charging
Based on the usage information reported by the UE, the ProSe Functions in
HPLMN produces CDRs or reports charging events for CDRs generation by CDF. The
CDRs or charging events are generated for the ProSe one-to-many Direct
Communication for Public Safety use (PF-DC-CDR).
When the CDF is implemented as a separate entity (than the ProSe Function),
the charging events triggering and handling are described in clause 5.2.2.3.
For ProSe one-to-many Direct Communication charging, either event based
charging or session based charging can be used, depending on configuration of
the ProSe Function and CDF.
NOTE: The charging session does not correspond to any ProSe one-to-many Direct
Communication session, as there is no session concept defined for the group
communication in TS 23.303 [238].
When a charging event is reported to the CDF, it includes relevant information
as listed in clause 5.1.2.
The following chargeable events are defined for ProSe one-to-many Direct
Communication charging:
\- Received Direct Communication Usage Report (for a group).
If event based charging is used, upon this event, a Charging Data
Request[Event] for a specific group is generated.
If session based charging is used, either a Charging Data Request[Start],
Charging Data Request[Interim], or Charging Data Request[Stop] for a specific
group is generated.
The triggering conditions for the corresponding charging events are defined in
clause 5.2.2.3.1.
### 5.2.2 Rf message flows
#### 5.2.2.1 Offline charging message flow for ProSe Direct Discovery
The following ProSe operation flows are based on the procedures defined in TS
23.303 [238]
##### 5.2.2.1.1 Triggers for charging events from ProSe Function for ProSe
Direct Discovery
When a charging event is reported to the CDF, it includes details such as
subscriber identifier (e.g. IMSI), PLMN ID, Specific ProSe Direct Discovery
Model (e.g. Model A, Model B), Specific ProSe UE\'s role used (e.g. Announcing
UE, Monitoring UE), Specific ProSe functionality used (e.g. Announcing,
Monitoring, Match), Allocation of a ProSe App Code to an Announcing UE and the
associated period , Allocation of a set of Filters for a Monitoring UE and the
associated period, Match of the ProSe App Code at a Monitoring UE and the
timestamp and ProSe App ID for ProSe Direct Discovery Announce Request and
Monitoring.
As stated above, the trigger conditions described in Table 5.2.2.1.1.1 are
applicable for charging information collection.
Charging Data Request[Event] is sent at successful response to different
Discovery Request and Discovery Report.
Table 5.2.2.1.1.1: Charging Data Request messages triggered by messages\ for
ProSe Function in ProSe Direct Discovery
+--------------------------------+------------------------------------+ | message | Triggering conditions | +--------------------------------+------------------------------------+ | Charging Data Request[Event] | Discovery Response to Direct | | | Discovery Request with command | | | (Announce, Monitor) | | | | | | Announce Auth Ack to Announce | | | Authorization message | | | | | | Monitor response to Monitor | | | Request message | | | | | | Match Report Ack to Match Report | | | message | +--------------------------------+------------------------------------+
##### 5.2.2.1.2 Message flow for ProSe Direct Discovery Announce Request
ProSe Direct Discovery Announce Request allows a ProSe-enabled UE to request a
set of ProSe App Code from the HPLMN ProSe Function, with associated validity
timer and security materials, to announce over the air. Charging Data
Request[Event] is triggered for Announcing UE after ProSe Function responds to
the Discovery Request or to the Announce Authorization message.
When the ProSe Application ID has a scope different from PLMN specific scope
(i.e. country-wide or global), the message flows are the same as those for the
case of PLMN specific ProSe Application ID provided by the HPLMN.
Figure 5.2.2.1.2.1: Message flow for ProSe Direct Discovery Announce Request
(non-roaming)
> 1-3. Announcing UE sends out Discovery Req message and receive Discovery
> Resp message. The detailed description is defined in TS 23.303 [238].
>
> 3a. After the ProSe Function responds with a Discovery Response (ProSe
> Application Code, validity timer) message, the ProSe Function triggers
> Charging Data Request[Event] to CDF in HPLMN where event represents
> Announce. The PF-DD-CDR is generated by CDF for Announcing UE.
>
> 3b. The CDF returns Charging Data Response corresponding to the received
> Charging Data Request[Event].
>
> 4\. The UE may start announcing the provided ProSe Application Code in
> HPLMN, using the radio resources authorized and configured by E-UTRAN to be
> used for ProSe as defined in RAN specifications.
Figure 5.2.2.1.2.2: Message flow for ProSe Direct Discovery Announce Request
(roaming)
The UE is only allowed to announce in the bands signalled from VPLMN.
0-4. If the UE is authorized to announce in VPLMN and is triggered to
announce, it shall establish a secure connection with the ProSe Function in
HPLMN and it shall then send a Discovery Request and then the ProSe Function
in VPLMN authorizes the UE to perform ProSe Direct Discovery Announce. The
detailed description is defined in TS23.303 [238].
4a. After the ProSe Function in VPLMN responds to the Announce Authorisation
message, the ProSe Function in VPLMN sends Charging Data Request[Event] to CDF
in VPLMN. The PF-DD-CDR for Announcing UE is generated by the CDF in VPLMN
where event represents Announce.
4b. The CDF in VPLMN returns Charging Data Response corresponding to the
received Charging Data Request[Event].
5\. The ProSe Function in HPLMN shall respond to the UE with a Discovery
Response (ProSe Application Code, validity timer) message. The UE will be
authorized to announce this ProSe Application Code for the duration of
validity timer and if it remains in the same PLMN.
5a. After the ProSe Function in HPLMN responds to the UE with a Discovery
Response, the ProSe Function sends Charging Data Request[Event] to CDF in
HPLMN. The PF-DD-CDR for Announcing UE is generated by the CDF in HPLMN where
event represents Announce.
5b. The CDF in HPLMN returns Charging Data Response corresponding to the
received Charging Data Request[Event].
6\. The UE may start announcing the provided ProSe Application Code in the
VPLMN, using the radio resources authorized and configured by E-UTRAN to be
used for ProSe as defined in RAN specifications.
##### 5.2.2.1.3 Message flow for ProSe Direct Discovery Monitor Request
ProSe Direct Discovery Monitor Request allows a ProSe-enabled UE to obtain a
set of filters from the HPLMN ProSe Function, which enables the UE to discover
Announcing UE of its interest. Charging Data Request[Event] is triggered for
Monitoring UE after ProSe Function responds to the Discovery Request or to the
Monitor Request message.
When the ProSe Application ID has a scope different from PLMN specific scope
(i.e. country-wide or global), the message flows are the same as those for the
case of PLMN specific ProSe Application ID provided by the HPLMN.
Figure 5.2.2.1.3.1: Message flow for ProSe Direct Discovery Monitor Request
(non-roaming)
0-2. Monitoring UE sends out Discovery Req message and if there is no
associated UE context, the ProSe Function shall check with HSS the
authorization for discovery and create a new context for this UE that contains
the subscription parameters for this UE for the duration the Discovery Filters
will be valid. The detailed description is defined in TS 23.303 [238].
If the Discovery Request is authorized, and the ProSe Application ID sent by
the UE in step 1 indicates another Local PLMN then steps 3-6 are executed,
otherwise (i.e. the ProSe Application ID indicates HPLMN) only steps 5-6 are
executed:
3\. The ProSe Function in HPLMN shall contact other Local PLMNs in order to
resolve the ProSe Application ID Name(s) to mask(s) that corresponds to this
ProSe Application ID Name. The request shall also include the UE identity
information e.g. IMSI or MSISDN in order to allow the ProSe Function in Local
PLMN to perform charging.
4\. If the ProSe Function of the Local PLMN stores valid ProSe Application
Code(s) corresponding to the requested ProSe Application ID Name(s), then the
ProSe Function of the Local PLMN returns the related mask(s) and the
corresponding TTL for each.
4a. After the ProSe Function of the Local PLMN responds to Monitor Request
from the ProSe Function of HPLMN, the ProSe Function of the Local PLMN sends
Charging Data Request[Event] to CDF in Local PLMN. The PF-DD-CDR is generated
for Monitoring UE where Event represents Monitor.
4b. The CDF in Local PLMN returns Charging Data Response corresponding to the
received Charging Data Request[Event].
NOTE 1: If the ProSe Function of the Local PLMN does not return any mask, than
the ProSe Function in the HPLMN notifies the UE that the Discovery Request has
been rejected.
5\. The ProSe Function in the HPLMN shall respond with a Discovery Response
(Discovery Filter(s), Filter ID) message.
5a. After the ProSe Function in the HPLMN responds with a Discovery Response,
the ProSe Function sends Charging Data Request[Event] to CDF in HPLMN. The PF-
DD-CDR is generated for Monitoring UE where Event represents Monitor.
5b. The CDF in HPLMN returns Charging Data Response corresponding to the
received Charging Data Request[Event].
6\. The UE may start monitoring using the Discovery Filter(s) in the radio
resources that are authorized and configured by the PLMN(s) to be used for
ProSe as defined in RAN specifications.
Figure 5.2.2.1.3.2: Message flow for ProSe Direct Discovery Monitor Request
(roaming)
0-2. Monitoring UE sends out Discovery Req message and if there is no
associated UE context, the ProSe Function shall check with HSS the
authorization for discovery and create a new context for this UE that contains
the subscription parameters for this UE for the duration the Discovery Filters
will be valid. The detailed description is defined in TS 23.303 [238].
If the Discovery Request is authorized, and the ProSe Application ID sent by
the UE in step 1 indicates another PLMN and not the HPLMN, then steps 3-6 are
executed, otherwise (i.e. the ProSe Application ID indicates HPLMN) only steps
5-6 are executed:
3\. The ProSe Function in HPLMN shall contact other PLMNs that are indicated
by the ProSe Application ID(s) sent by the UE, in order to resolve the
corresponding ProSe Application ID Name(s) to mask(s). The request shall also
include the UE identity information e.g. IMSI or MSISDN in order to allow the
ProSe Function in Local PLMN to perform charging.
4\. If the ProSe Function of the other PLMN stores valid ProSe Application
Code(s) corresponding to the requested ProSe Application ID Name(s), then the
ProSe Function of the Local PLMN returns the related ProSe Application mask(s)
and the corresponding TTL for each. It also includes the PLMN ID of the PLMN
that the Announcing UE is registered (if roaming).
4a. After the ProSe Function of the other PLMN responds to Monitor Request
from the ProSe Function of HPLMN, the ProSe Function of the other PLMN sends
Charging Data Request[Event] to CDF in other PLMN. The PF-DD-CDR is generated
for Monitoring UE where Event represents Monitor.
4b. The CDF in other PLMN returns Charging Data Response corresponding to the
received Charging Data Request[Event].
NOTE 2: If the ProSe Function of the other PLMN does not return any mask, than
the ProSe Function in the HPLMN notifies the UE that the Discovery Request has
been rejected.
5\. The ProSe Function in the HPLMN responds with a Discovery Response
(Discovery Filter(s), Filter ID) message. The Discovery Filter(s) consists of
the ProSe Application mask(s). The Discovery Filter(s) include the TTL. The
TTL(s) in the Discovery Filter(s) indicate for how long the Discovery
Filter(s) are going to be valid.
5a. After the ProSe Function in the HPLMN responds with a Discovery Response,
the ProSe Function sends Charging Data Request[Event] to CDF in HPLMN. The PF-
DD-CDR is generated for Monitoring UE where Event represents Monitor.
5b. The CDF in HPLMN returns Charging Data Response corresponding to the
received Charging Data Request[Event].
6\. The UE may start monitoring using the Discovery Filter(s) in the radio
resources that are authorized and configured by the PLMN(s) to be used for
ProSe as defined in RAN specifications.
##### 5.2.2.1.4 Message flow for ProSe Direct Discovery Match Report
ProSe Direct Discovery Match Report allows a ProSe-enabled UE to report a
match of the ProSe Application Code to the HPLMN ProSe Function, and obtain
the corresponding ProSe Application ID and metadata. Charging Data
Request[Event] is triggered for Monitoring UE after ProSe Function responds to
the Match Report message.
When the ProSe Application ID has a scope different from PLMN specific scope
(i.e. country-wide or global), the message flows are the same as those for the
case of PLMN specific ProSe Application ID.
Figure 5.2.2.1.4.1: Message flow for Match Report (non-roaming)
1\. If the UE finds ProSe Application Code(s) that matches the Discovery
Filters and does not have ProSe Application ID(s) already locally stored that
correspond to this ProSe Application Code(s), it shall (re)establish a secure
connection with the ProSe Function in HPLMN to which it shall then send a
Match Report message.
2\. The ProSe Function shall check the context for this UE that contains its
subscription parameters. The authorization information also contains the PLMN
that this UE is allowed to perform discovery.
3\. The ProSe Function analyses the ProSe Application Code received from the
UE.
If the PLMN ID that assigned the given ProSe Application Code is another Local
PLMN then steps 4-7 are executed, otherwise (i.e. the ProSe Application Code
was assigned by HPLMN) only step 7 is executed:
4\. The ProSe Function in HPLMN sends a Match Report (ProSe Application
Code(s), UE identity) to the ProSe Function of the PLMN that assigned the
ProSe Application Code. The UE identity information e.g. IMSI or MSISDN can be
used by the ProSe Function in Local PLMN to perform charging.
5\. The ProSe Function analyses the ProSe Application Code(s) received from
the UE.
6\. If the ProSe Application Code is confirmed then the ProSe Function in
Local PLMN shall send Match Report Acknowledgement (ProSe Application ID
Name(s), validity timer(s)). This message may also contain certain metadata
corresponding to the ProSe Application ID Name e.g. postal address, phone
number, URL etc.
6a. After the ProSe Function in Local PLMN sends Match Report Acknowledgement,
the ProSe Function in Local PLMN sends Charging Data Request[Event] to the CDF
in Local PLMN. The PF-DD-CDR is generated for Monitoring UE where Event
represents Match.
6b. The CDF in Local PLMN returns Charging Data Response corresponding to the
received Charging Data Request[Event].
7\. The ProSe Function in HPLMN shall respond to the UE with Match Report
Acknowledgment (ProSe Application ID(s), validity timer(s)). This message may
also contain certain metadata corresponding to the ProSe Application ID Name
e.g. postal address, phone number, URL etc. The validity timer(s) indicate for
how long the ProSe Application ID(s) provided are going to be valid. The UE
may store the mapping of ProSe Application Code(s) and corresponding ProSe
Application ID(s) for the duration of their validity timer.
7a. After the ProSe Function in HPLMN responds to the UE with Match Report
Acknowledgment, the ProSe Function in HPLMN sends Charging Data Request[Event]
to CDF in HPLMN. The PF-DD-CDR is generated for Monitoring UE where Event
represents Match.
7b. The CDF in Local PLMN returns Charging Data Response corresponding to the
received Charging Data Request[Event].
Figure 5.2.2.1.4.2: Message flow for Match Report (roaming)
1\. If the UE finds ProSe Application Code(s) that matches the Discovery
Filters and does not have ProSe Application ID(s) already locally stored that
correspond to this ProSe Application Code(s), it (re)establishes a secure
connection with the ProSe Function in HPLMN and sends a Match Report message.
2\. The ProSe Function shall check the context for this UE that contains its
subscription parameters for this UE. The authorization information also
contains the PLMN that this UE is allowed to perform discovery. The UE context
also contains the VPLMN ID where the UE is registered.
3\. The ProSe Function analyses the ProSe Application Code(s) received from
the UE.
If the PLMN ID that assigned the given ProSe Application Code is not the
HPLMN, then steps 4-8 are executed, otherwise (i.e. the HPLMN assigned the
ProSe Application Code) only steps are executed:
4\. The ProSe Function in HPLMN sends a Match Report (ProSe Application
Code(s), UE identity, monitored PLMN ID) to the ProSe Function of the PLMN
that assigned the ProSe Application Code (i.e. the ProSe Function of the HPLMN
of the Announcing UE).
5\. The ProSe Function ensures that the received ProSe Application Code is
authorized to be transmitted on the monitored PLMN. The ProSe Function
analyses the ProSe Application Code(s) received from the UE, and confirms the
ProSe Application Code(s).
6\. The ProSe Function shall send Match Report Acknowledgement (ProSe
Application ID Name(s), validity timer(s)). This message may also contain
certain metadata corresponding to the ProSe Application ID Name e.g. postal
address, phone number, URL, etc.
6a. After the ProSe Function in other PLMNs sends Match Report Acknowledgement
message, the ProSe Function in other PLMNs sends Charging Data Request[Event]
to the CDF in other PLMNs. The PF-DD-CDR is generated for the Monitoring UE
where Event represents Match.
6b. The CDF in other PLMNs returns Charging Data Response corresponding to the
received Charging Data Request[Event].
7\. The ProSe Function in HPLMN shall respond to the UE with Match Report
Acknowledgment (ProSe Application ID(s), validity timer(s)). This message may
also contain certain metadata corresponding to the ProSe Application ID Name
e.g. postal address, phone number, URL, etc. The validity timer(s) indicate
for how long the ProSe Application ID(s) provided are going to be valid. The
UE may store the mapping of ProSe Application Code(s) and corresponding ProSe
Application ID(s) for the duration of their validity timer.
7a. After the ProSe Function in HPLMN respond to the UE with Match Report
Acknowledgment message, the ProSe Function in HPLMN sends Charging Data
Request[Event] to the CDF in HPLMN. The PF-DD-CDR is generated for Monitoring
UE where Event represents Match.
7b. The CDF in HPLMNs returns Charging Data Response corresponding to the
received Charging Data Request[Event].
8\. If in step 4 it was indicated that the Announcing UE is roaming, the ProSe
Function in HPLMN may optionally send a Match Report Info (ProSe Application
ID(s), UE Identity) to the ProSe Function of the serving PLMN (i.e. VPLMN) of
the Announcing UE.
8a. When receiving a Match Report Info message, the ProSe Function in VPLMN of
the Announcing UE sends Charging Data Request[Event] to the CDF in VPLMN of
the Announcing UE. The PF-DD-CDR is generated for Announcing UE where Event
represents Match.
8b. The CDF in VPLMN of the Announcing UE returns Charging Data Response
corresponding to the received Charging Data Request[Event].
#### 5.2.2.2 Offline charging message flow for ProSe EPC-level Discovery
##### 5.2.2.2.1 Triggers for charging events
When a charging event is reported to the CDF, it includes details related to
the services provided, e.g. the EPUID, ALUID, Application ID, window, Range,
location of the UE, and the reasons for triggering the event, e.g. due to
Proximity Alert, or timeout of window, user request, etc.
The Proximity Request event is triggered when a ProSe Function responds to the
first Proximity Request from a UE or another ProSe Function, with the
Proximity Request Ack message. The Proximity Request event for a UE triggers a
Charging Data Request[Start] message towards the CDF, and the subsequent
Proximity Request for the same ALUID , i.e. Proximity Request Renewal event,
triggers a Charging Data Request[Interim] message to the CDF. A Proximity
Request Reject event, which is triggered by the ProSe Function responding a
Proximity Request Reject to a Proximity Request, shall trigger a Charging Data
Request[Stop] message to the CDF.
The Proximity Request Cancellation event is triggered when a ProSe Function
responds to a Cancel Proximity Request from a UE or another ProSe Function,
with the Proximity Request Cancellation or Cancel Proximity Request Ack
message, or a Proximity Request expires. Proximity Request Cancellation event
triggers a Charging Data Request[Stop] message to the CDF. It shall indicate
if a Proximity Alert has been triggered for the UE.
Table 5.2.2.2.1.1 presents a summary of the messages from the ProSe Function
and the triggering conditions.
Table 5.2.2.2.1.1: Triggers for charging events in ProSe EPC-level Discovery
+----------------------------------+----------------------------------+ | Message | Triggering conditions | +----------------------------------+----------------------------------+ | Charging Data Request [Start] | ProSe Function responded with | | | Proximity Request Ack to the | | | first Proximity Request for a | | | UE. | +----------------------------------+----------------------------------+ | Charging Data Request | ProSe Function responded with | | [Interim] | Proximity Request Ack to the | | | renewal Proximity Requests for a | | | UE. | +----------------------------------+----------------------------------+ | Charging Data Request [Stop] | ProSe Function responded with | | | Proximity Request Reject to the | | | Proximity Request for a UE; or | | | | | | ProSe Function responded with | | | Proximity Request Cancellation | | | or Cancel Proximity Request Ack | | | to the Cancel Proximity Request | | | for a UE, or a Proximity Request | | | expires. | +----------------------------------+----------------------------------+
##### 5.2.2.2.2 Message flow for ProSe EPC-level Discovery Proximity Request
ProSe EPC-level Discovery Proximity Request allows a ProSe-enabled UE A to
request the network to assist it detecting if UE B is in proximity using
architecture specified in Figure 4.1.2, where UE A and UE B are using
subscription from different networks. Upon this procedure, Charging Data
Request is triggered for UE A and UE B, after the respective ProSe Function
responded to the Proximity Request message.
Figure 5.2.2.2.2.1 depicts the message flow for ProSe EPC-level Discovery
Proximity Request.
Figure 5.2.2.2.2.1: Message flow for ProSe EPC-level Discovery Proximity
Request
1 - 7b. These steps are defined in TS 23.303 [238] clause 5.5.5.
7c. After the ProSe Function B responded to ProSe Function A, the ProSe
Function B triggers Charging Data Request[Start/Interim/Stop] according to the
conditions specified in clause 5.2.2.2.1 to the corresponding CDF B, where the
charging event represents Proximity Request.
7d. The ProSe EPC-level Discovery CDR (PF-ED-CDR) is opened/updated/closed for
UE B, according to the Charging Data Request.
7e. The CDF B returns Charging Data Response corresponding to the received
Charging Data Request.
8a - 8b. These steps are defined in TS 23.303 [238] clause 5.5.5.
8c. After the ProSe Function A responded to UE A, the ProSe Function A
triggers Charging Data Request[Start/Interim/Stop] according to the conditions
specified in 5.2.2.2.1 to the corresponding CDF A, where the charging event
represents Proximity Request.
8d. The ProSe EPC-level Discovery CDR (PF-ED-CDR) is opened/updated/closed for
UE A.
8e. The CDF A returns Charging Data Response corresponding to the received
Charging Data Request.
##### 5.2.2.2.3 Message flow for ProSe EPC-level Discovery Proximity Request
Cancellation
ProSe EPC-level Discovery Proximity Request cancellation is triggered by
either the UE or network. It is cancels the proximity detection for a
particular pair of UEs, e.g. UE A and UE B. Therefore, upon this procedure,
Charging Data Request[Stop] is triggered for UE A and UE B, after the
respective ProSe Function responded to the Cancel Proximity Request message.
Figure 5.2.2.2.3.1 depicts the message flow for ProSe EPC-level Discovery
Proximity Request Cancellation.
Figure 5.2.2.2.3.1: Message flow for ProSe EPC-level Discovery Proximity
Request Cancellation
1 - 5. These steps are defined in TS 23.303 [238] clause 5.5.9.
5a. After the ProSe Function B sends a Cancel Proximity Request Ack to the
ProSe Function A, the ProSe Function B triggers Charging Data Request[Stop] to
the corresponding CDF B, where the event represents Proximity Request
Cancellation. This shall also indicate if a Proximity Alert has been sent to
UE B.
5b. The corresponding ProSe EPC-level Discovery CDR (PF-ED-CDR) is closed for
UE B.
5c. The CDF B returns Charging Data Response corresponding to the received
Charging Data Request.
6\. This step is defined in TS 23.303 [238] clause 5.5.9.
6a. After the ProSe Function A sends a Proximity Request Cancellation to the
UE A, the ProSe Function A triggers Charging Data Request[Stop] to the
corresponding CDF A, where the charging event represents Proximity Request
Cancellation. This shall also indicate if a Proximity Alert has been sent to
UE A.
6b. The corresponding ProSe EPC-level Discovery CDR (PF-ED-CDR) is closed for
UE A.
6c. The CDF A returns Charging Data Response corresponding to the received
Charging Data Request.
#### 5.2.2.3 Offline charging message flow for ProSe Direct Communication
##### 5.2.2.3.1 Triggers for charging events at ProSe Function
###### 5.2.2.3.1.1 Triggers for charging events at ProSe Function for event
based charging
This reporting is achieved by sending Charging Data Request[event] from the
ProSe Function to the CDF.
The Received Direct Communication Usage Report event for a group is triggered
by the ProSe Function receiving a usage information report from the UE for the
group over PC3. The ProSe Function goes through the reported usage
information, and if it contains valid ProSe Direct Communication usage data
for a specific group, the ProSe Function sends the events to the CDF, which
triggers the generation of the PF-DC-CDR for a specific group. It is possible
that a single UE usage information report triggers multiple Received Direct
Communication Usage Report events, each for a particular group.
The ProSe charging operation flows in the following subclauses are based on
the above triggers and the procedures defined in TS 23.303 [238].
###### 5.2.2.3.1.2 Triggers for charging events at ProSe Function for session
based charging
The ProSe Function may be configured to use session based charging in order to
reduce the number of CDRs generated.
The Charging Data Request[Start] is sent when the ProSe Function receives a
Received Direct Communication Usage Report event, and there is no open
charging session for the group.
The Charging Data Request[Interim] is sent when the ProSe Function receives a
Received Direct Communication Usage Report event, and there is an open
charging session for the group.
The Charging Data Request[Stop] is sent when the ProSe Function decides one of
the following conditions is met:
\- operator configured maximum number of reports, or
\- operator configured maximum time limit.
##### 5.2.2.3.2 Message flow for ProSe one-to-many Direct Communication when
the UE is under coverage of E-UTRAN (event based)
Figure 5.2.2.3.2.1 depicts the message flow for ProSe one-to-many Direct
Communication for non-roaming and roaming case, when UE is under coverage of
E-UTRAN.
Figure 5.2.2.3.2.1: Offline Charging for ProSe one-to-many Direct
Communication
1\. The ProSe Function in HPLMN configures the UE on the usage information
collection and reporting using the Service authorization and provisioning
mechanism defined in TS 23.303 [238]. The configuration parameters are
delivered as defined in TS 24.333 [241].
> This step is optional, as the UE can be pre-configured with the
> corresponding information.
2-3. UE performs one-to-many Direct Communication as defined in TS 23.303
[238].
4\. When the UE decides that reporting criteria are met, according to the
configuration in step 1, and the connection to the ProSe Function is
available, the UE triggers the usage reporting procedure.
NOTE 1: The UE has a connection to the HPLMN ProSe Function when any PDN
Connection is available, as specified in TS 23.303 [238].
5\. UE sends the usage information report to the ProSe Function, according to
the configuration in step 1.
When the usage information report in step 5 includes information for multiple
groups, step 6 to 8 are repeated for each of the group.
6\. Upon reception of direct communication usage information report, the ProSe
Function triggers the Charging Data Request[Event] . The ProSe Function sends
the Charging Data Request[Event] to the corresponding CDF.
7\. The ProSe one-to-many Direct Communication for Public Safety use CDR (PF-
DC-CDR) for the group is generated by CDF for the UE.
8\. The CDF returns Charging Data Response corresponding to the received
Charging Data Request.
NOTE 2: The delivery of the charging data to the VPLMN in roaming case is
handled outside of 3GPP.
NOTE 3: The procedure applies to UE1 to UE3 independently, i.e. each of the UE
sends the respective usage information reports about the group communication
to the network using either the under coverage procedure or out of coverage
procedure.
##### 5.2.2.3.3 Message flow for ProSe one-to-many Direct Communication when
the UE is out of coverage of E-UTRAN (event based)
Figure 5.2.2.3.3.1 depicts the message flow for ProSe one-to-many Direct
Communication for non-roaming and roaming case, when UE is out of coverage of
E-UTRAN.
Figure 5.2.2.3.3.1: Offline Charging for ProSe one-to-many Direct
Communication (out of coverage)
1\. When the UE is out of coverage of the E-UTRAN, it makes use of the pre-
configured resources in USIM or ME for the ProSe one-to-many Direct
Communication for public safety use. The mechanism to decide on the resources
to use is defined in TS 23.303 [238].
2-3. UE performs one-to-many Direct Communication as defined in TS 23.303
[238].
4\. When the UE decides that reporting criteria are met, according to the pre-
configuration, the UE create the corresponding usage information report.
5\. The UE stores the usage information, when the UE is out of E-UTRAN
coverage and has no connection to the HPLMN ProSe Function.
NOTE 1: The usage information is stored in a secure environment in the UE.
6\. When the UE comes back to E-UTRAN coverage, it will trigger the reporting
of the usage information.
7\. UE sends the usage information report to the ProSe Function, according to
the pre-configuration or new configuration from the HPLMN ProSe Function.
When the usage information report in step 7 includes information for multiple
groups, step 8 to 10 are repeated for each of the group. When the usage
information report in step 7 includes multiple reports for a group, e.g. the
UE has been out of coverage for a long time, step 8 to 10 are repeated for
each of the report.
8\. Upon reception of direct communication usage information report, the ProSe
Function triggers the Charging Data Request[Event] for each of the group in
the report. The ProSe Function sends the Charging Data Request[Event] to the
corresponding CDF.
9\. The ProSe one-to-many Direct Communication for Public Safety use CDR (PF-
DC-CDR) for the group is generated by CDF for the UE.
10\. The CDF returns Charging Data Response corresponding to the received
Charging Data Request.
NOTE 2: The procedure applies to UE1 to UE3 independently, i.e. each of the UE
sends the respective usage information reports about the group communication
to the network using either the under coverage procedure or out of coverage
procedure.
##### 5.2.2.3.4 Message flow for ProSe one-to-many Direct Communication when
the UE is under coverage of E-UTRAN (session based)
Figure 5.2.2.3.4.1 depicts the message flow for session based charging for
ProSe one-to-many Direct Communication for non-roaming and roaming case, when
UE is under coverage of E-UTRAN.
Figure 5.2.2.3.4.1: Offline Charging for ProSe one-to-many Direct
Communication\ (under coverage, session based charging)
1\. The ProSe Function in HPLMN configures the UE on the usage information
collection and reporting using the Service authorization and provisioning
mechanism defined in TS 23.303 [238]. The configuration parameters are
delivered as defined in TS 24.333 [241].
> This step is optional, as the UE can be pre-configured with the
> corresponding information.
2-3. UE performs one-to-many Direct Communication as defined in TS 23.303
[238].
4\. When the UE decides that reporting criteria are met, according to the
configuration in step 1, and the connection to the ProSe Function is
available, the UE triggers the usage reporting procedure.
NOTE 1: The UE is provided a connection to the HPLMN ProSe Function as
specified in TS 23.303 [238].
5\. UE sends the usage information report to the ProSe Function, according to
the configuration in step 1.
When the usage information report in step 5 includes information for multiple
groups, step 6 to 8 are repeated for each of the group.
6\. If the ProSe Function is configured to use session based charging, upon
reception of direct communication usage information report for a group, the
ProSe Function triggers the Charging Data Request[Start] when there is no open
charging session for the group, according to 5.2.2.3.1.2. The ProSe Function
sends the Charging Data Request[Start] to the corresponding CDF, and starts a
charging session for the group.
7\. The ProSe one-to-many Direct Communication for Public Safety use CDR (PF-
DC-CDR) for the group is opened by CDF for the UE.
8\. The CDF returns Charging Data Response corresponding to the received
Charging Data Request.
9\. UE triggers the usage reporting procedure when the reporting criteria are
met.
10\. UE sends the usage information report to the ProSe Function.
When the usage information report in step 10 includes information for multiple
groups, step 11 to 13 are repeated for each of the group.
11\. If there is a charging session for the group, upon reception of direct
communication usage information report for the group, the ProSe Function
triggers the Charging Data Request[Interim], according to clause 5.2.2.3.1.2.
The ProSe Function sends the Charging Data Request[Interim] to the
corresponding CDF.
12\. The ProSe one-to-many Direct Communication for Public Safety use CDR (PF-
DC-CDR) for the group is updated by CDF for the UE.
13\. The CDF returns Charging Data Response corresponding to the received
Charging Data Request.
NOTE 2: Step 9 to 13 may happen multiple times before step 14.
14\. UE triggers the usage reporting procedure when the reporting criteria are
met.
15\. UE sends the usage information report to the ProSe Function.
When the usage information report in step 15 includes information for multiple
groups, step 16 to 18 are repeated for each of the group.
16\. The ProSe Function decides that the charging session should be closed,
according to clause 5.2.2.3.1.2, and triggers the Charging Data Request[Stop].
The ProSe Function sends the Charging Data Request[Stop] to the corresponding
CDF.
17\. The ProSe one-to-many Direct Communication for Public Safety use CDR (PF-
DC-CDR) for the group is closed by CDF for the UE.
18\. The CDF returns Charging Data Response corresponding to the received
Charging Data Request.
NOTE 3: The procedure applies to UE1 to UE3 independently, i.e. each of the UE
sends the respective usage information reports about the group communication
to the network using either the under coverage procedure or out of coverage
procedure.
##### 5.2.2.3.5 Message flow for ProSe one-to-many Direct Communication when
the UE is out of coverage of E-UTRAN (session based)
Figure 5.2.2.3.5.1 depicts the message flow for session based charging for
ProSe one-to-many Direct Communication for non-roaming and roaming case, when
UE is out of coverage of E-UTRAN.
Figure 5.2.2.3.5.1: Offline Charging for ProSe one-to-many Direct
Communication\ (out of coverage, session based)
1\. When the UE is out of coverage of the E-UTRAN, it makes use of the pre-
configured resources in USIM or ME for the ProSe one-to-many Direct
Communication for public safety use. The mechanism to decide on the resources
to use is defined in TS 23.303 [238].
2-3. UE performs one-to-many Direct Communication as defined in TS 23.303
[238].
4\. When the UE decides that reporting criteria are met, according to the pre-
configuration, the UE create the corresponding usage information report.
5\. The UE stores the usage information, when the UE is out of E-UTRAN
coverage and has no connection to the HPLMN ProSe Function.
NOTE 1: The usage information is stored in a secure environment in the UE.
6\. When the UE comes back to E-UTRAN coverage, it will trigger the reporting
of the usage information.
7\. UE sends the usage information report to the ProSe Function, according to
the pre-configuration or new configuration from the HPLMN ProSe Function.
When the usage information report in step 7 includes information for multiple
groups, step 8 to 10 are repeated for each of the group.
8\. If the ProSe Function is configured to use session based charging, upon
reception of direct communication usage information report for a group, the
ProSe Function triggers the Charging Data Request[Start] when there is no open
charging session for the group, according to clause 5.2.2.3.1.2. The ProSe
Function sends the Charging Data Request[Start] to the corresponding CDF, and
starts a charging session for the group.
9\. The ProSe one-to-many Direct Communication for Public Safety use CDR (PF-
DC-CDR) for the group is opened by CDF for the UE.
10\. The CDF returns Charging Data Response corresponding to the received
Charging Data Request.
When the usage information report in step 7 includes multiple reports for a
group, e.g. the UE has been out of coverage for a long time, step 12 to 14 and
16 to 18 may be triggered without step 11 or 15.
11\. UE sends the usage information report to the ProSe Function when the
reporting criteria are met.
When the usage information report in step 11 includes information for multiple
groups, step 12 to 14 are repeated for each of the group.
12\. If there is a charging session for the group, upon reception of direct
communication usage information report for the group, the ProSe Function
triggers the Charging Data Request[Interim], according to clause 5.2.2.3.1.2.
The ProSe Function sends the Charging Data Request[Interim] to the
corresponding CDF.
13\. The ProSe one-to-many Direct Communication for Public Safety use CDR (PF-
DC-CDR) for the group is updated by CDF for the UE.
14\. The CDF returns Charging Data Response corresponding to the received
Charging Data Request.
15\. UE sends the usage information report to the ProSe Function when the
reporting criteria are met.
When the usage information report in step 15 includes information for multiple
groups, step 16 to 18 are repeated for each of the group.
16\. The ProSe Function decides that the charging session should be closed,
according to clause 5.2.2.3.1.2, and triggers the Charging Data Request[Stop].
The ProSe Function sends the Charging Data Request[Stop] to the corresponding
CDF.
17\. The ProSe one-to-many Direct Communication for Public Safety use CDR (PF-
DC-CDR) for the group is closed by CDF for the UE.
18\. The CDF returns Charging Data Response corresponding to the received
Charging Data Request.
NOTE 2: The procedure applies to UE1 to UE3 independently, i.e. each of the UE
sends the respective usage information reports about the group communication
to the network using either the under coverage procedure or out of coverage
procedure.
### 5.2.3 CDR generation
#### 5.2.3.1 Triggers for PF-DC-CDR creation and closure
##### 5.2.3.1.1 General
A PF-DC-CDR is used to collect charging information related to the ProSe
Direct Communication for a specific group. Multiple containers can be included
in the PF-DC-CDR.
When a direct communication usage information report for a group is received
from the UE, a PF-DC-CDR shall be opened if no open PF-DC-CDR for this group
exists.
When event based charging is used, the corresponding containers are added, and
the PF-DC-CDR is closed upon receiving the direct communication usage report.
When session based charging is used, the PF-DC-CDR is closed as described in
clause 5.2.2.3.1.2.
##### 5.2.3.1.2 Triggers for PF-DC-CDR charging information addition
The \"List of Transmission/Reception Data\" attributes of the PF-DC-CDR
consists of a set of containers, which are added when specific trigger
conditions are met and if UE is configured to include this charging
information in the usage information report. Details of the container are
defined in clause 6.1.3.4. Table 5.2.3.1.2.1 identifies which conditions are
supported to trigger PF-DC-CDR charging information addition for \"List of
Transmission/Reception Data\" attributes.
Table 5.2.3.1.2.1: Triggers for PF-DC-CDR charging information addition \"List
of Transmission/Reception Data\"
* * *
Trigger Conditions Description/Behaviour Receipt of usage information report
On receipt of usage information report, \"List of Transmission/Reception
Data\" containers shall be added to the PF-DC-CDR for the groups with usage to
report.
* * *
The \"List of Coverage Info\" attribute of the PF-DC-CDR consists of a set of
containers including coverage status, time stamps and optionally list of
location changes (i.e., ECGI change) and timestamps when in coverage. These
containers are added when specific trigger conditions are met and if UE is
configured to include this charging information in the usage information
report. Table 5.2.3.1.2.2 identifies which conditions are supported to trigger
PF-DC-CDR charging information addition for \" List of Coverage Info\"
attribute.
Table 5.2.3.1.2.2: Triggers for PF-DC-CDR charging information addition \"List
of Coverage Info\"
* * *
Trigger Conditions Description/Behaviour Receipt of usage information report
On receipt of usage information report, \"List of Coverage Info\" containers
shall be added to all open group PF-DC-CDRs.
* * *
The \"List of Radio Parameter Set Info\" attribute of the PF-DC-CDR consists
of a list of radio parameter sets configured in the UE for direct
communication use and activation timestamps. A new set of radio parameters is
added to the list for all open group PF-DC-CDRs, when it becomes active on the
UE and then received by the ProSe Function in a usage information report.
The \"List of Application Specific Data\" attribute of the PF-DC-CDR is a list
of data blocks provided by the application in the UE. A new data block can be
added to the list for all open group PF-DC-CDRs, when the UE sends usage
information report(s) to the ProSe Function.
The \"List of Transmitters\" attribute of the PF-DC-CDR is a list of
transmitters detected for a group. A new transmitter is added to the list in
the PF-DC-CDR for the group with usage to report, when it is detected by the
UE and then received by the ProS e Function in a usage information report.
##### 5.2.3.1.3 Triggers for PF-DC-CDR closureThe PF-DC-CDR shall be closed on
encountering any of the following trigger conditions:
\- When event based charging is used, and the usage information report for the
group is received from UE.
\- When session based charging is used, and the charging session is closed as
described in clause 5.2.2.3.1.2. In this case, a further PF-DC-CDR is opened
when another usage information report for the group is received from the UE.
### 5.2.4 Ga record transfer flows
Details of the Ga protocol application are specified in TS 32.295 [54].
### 5.2.5 Bx CDR file transfer
Details of the Bx protocol application are specified in TS 32.297 [52].
## 5.3 ProSe online charging scenarios
### 5.3.1 Basic principles
#### 5.3.1.1 General
ProSe online charging uses the Debit / Reserve Units operation as specified in
TS 32.299 [50].
The charging functions specified for ProSe relate to:
\- ProSe Direct Discovery:
\- Announce Discovery Request;
\- Monitor Discovery Request;
\- Match report Discovery Reporting.
\- ProSe EPC-level Discovery:
\- Proximity Request.
ProSe charging may use the Immediate Event Charging (IEC) principle, the Event
Charging with Unit Reservation (ECUR) principle or the Session Charging with
Unit Reservation (SCUR) principle as specified in TS 32.299 [50].
#### 5.3.1.2 ProSe Direct Discovery charging
The ProSe Functions in HPLMN is responsible for sending Debit/Reserve
operation messages to OCS. ProSe charging may use the Immediate Event Charging
(IEC) principle or the Event Charging with Unit Reservation (ECUR) principle
as specified in TS 32.299 [50]. The Debit operation is performed after
discovery authorization of receiving Direct Discovery Request or Match Report
Message and the optional refund operation shall be considered if Announce,
Monitor and Match operation fails in IEC principle. The Reserve operation is
performed after discovery authorization of receiving Direct Discovery Request
or Match Report Message and the Debit operation is performed only when
Announce, Monitor and Match operation succeeds in ECUR principle.
#### 5.3.1.3 ProSe EPC-Level Discovery charging
Session Charging with Unit Reservation (SCUR) principle is applied to ProSe
EPC-Level Discovery online charging.
The following chargeable events are defined for ProSe EPC-level Discovery
online charging:
\- Proximity Request. Upon this event, a Debit/Reserve Units Request[Initial]
message is sent to OCS, and the corresponding EPUID, ALUIDs, Application ID,
window, Range, and location of the UE are captured.
\- Proximity Request Renewal. Upon this event, a Debit/Reserve Units
Request[Update] message is sent to OCS with new location of the UE and window.
\- Proximity Request Reject. Upon this event, a Debit/Reserve Units
Request[Terminate] message is sent to OCS, and an indication of the cause for
reject is captured.
\- Proximity Request Cancellation. Upon this event, a Debit/Reserve Units
Request[Terminate] message is sent to OCS, and an indication of whether
Proximity Alert was sent is captured.
### 5.3.2 Ro message flows
#### 5.3.2.1 Introduction
The flows described in the present document specify the exchange between the
ProSe Function and the OCS for ProSe Services for different charging
scenarios.
_Debit Units Request_ message and _Reserve Units Request_ message as defined
in TS 32.299 [50] are used by the ProSe Function to transfer the collected
charging information towards the OCS depending on which mode is used:
Immediate Event Charging (IEC) mode or Event Charging with Unit Reservation
(ECUR) respectively.
#### 5.3.2.2 ProSe Direct Discovery
##### 5.3.2.2.1 Triggers for online charging from ProSe Function for ProSe
Direct Discovery
Table 5.3.2.2.1.1: Debit Units Request messages triggered for ProSe Function\
in ProSe Direct Discovery
+------------------------------+--------------------------------------+ | message | Triggering conditions | +------------------------------+--------------------------------------+ | Debit Units Request[Event] | After discovery authorization of | | | receiving Direct Discovery Request\ | | | with command (Announce, Monitor) | | | | | | After discovery authorization of | | | receiving Match Report message | +------------------------------+--------------------------------------+
##### 5.3.2.2.2 Message flows for ProSe Direct Discovery Announce Request
Figures 5.3.2.2.2.1 to 5.3.2.2.2.3 define the transactions between ProSe
Function and OCS for the successful scenario where an Announcing UE sends a
Discovery request in IEC mode for non-roaming case and in IEC and ECUR modes
for roaming case.
When the ProSe Application ID has a scope different from PLMN specific scope
(i.e. country-wide or global), the message flows are the same as those for the
case of PLMN specific ProSe Application ID provided by the HPLMN.
Figure 5.3.2.2.2.1: Message flow for ProSe Direct Discovery Announce Request
(IEC for non-roaming)
0\. The UE is configured with the data structure of the ProSe Application IDs
corresponding to HPLMN. This step is performed using mechanisms that are out
of scope of 3GPP.
1\. If the UE is authorized to announce in HPLMN and is triggered to announce,
it shall establish a secure connection with the ProSe Function and it shall
send a Discovery Request (ProSe Application ID, UE Identity, announce command,
application identity) message for announcing.
2\. If there is no associated UE context, the ProSe Function shall check with
HSS the authorization for discovery and create a new context for this UE that
contains the subscription parameters for this UE for the duration of the
validity timer.
3\. ProSe function sends Debit Units Request[Event] indicating Announce to the
OCS.
4\. The OCS performs Debit Units Request operation for Announcing UE.
5\. The OCS returns the Debit Units Response to ProSe Function.
6\. If the Discovery Request is authorized, then the ProSe Function shall
respond with a Discovery Response (ProSe Application Code, validity timer)
message.
7\. The UE may start announcing the provided ProSe Application Code in HPLMN,
using the radio resources authorized and configured by E-UTRAN to be used for
ProSe as defined in RAN specifications.
Figure 5.3.2.2.2.2: Message flow for ProSe Direct Discovery Announce Request
(IEC for roaming)
0\. The UE is configured with the data structure of the ProSe Application IDs
corresponding to HPLMN. This step is performed using mechanisms that are out
of scope of 3GPP.
1\. The UE establishes a secure connection with the ProSe Function in HPLMN
and then sends a Discovery Request (ProSe Application ID, UE Identity,
announce command, application identity) message for announcing.
2\. If there is no associated UE context, the ProSe Function shall check with
HSS the authorization for discovery and, if necessary, create a new context
for this UE that contains the subscription parameters for this UE for the
duration of the validity timer.
3\. ProSe Function sends Debit Units Request[Event] indicating Announce to the
OCS.
4\. The OCS performs Debit Units Request operation for Announcing UE.
5\. The OCS returns the Debit Units Response to ProSe Function.
6\. If the Discovery Request is authorized then the HPLMN ProSe Function shall
request authorisation from the ProSe Function in VPLMN with the Announce
Authorisation (ProSe Application ID, ProSe Application Code, UE Identity)
message.
7\. The ProSe Function in VPLMN authorizes the UE to perform ProSe Direct
Discovery announcing.
If the Discovery Request is not authorized, the optional refund steps 8 to 10
are required:
8\. ProSe function sends Debit Units Request[Event] to the OCS for refund
purpose.
9\. The OCS performs Debit Units Request operation for refund.
10\. The OCS returns the Debit Units Response to ProSe Function.
11\. The ProSe Function in HPLMN shall respond to the UE with a Discovery
Response (ProSe Application Code, validity timer) message, when step 7 is
successful.
12\. The UE may start announcing the provided ProSe Application Code in the
VPLMN, using the radio resources authorized and configured by E-UTRAN to be
used for ProSe as defined in RAN specifications.
Figure 5.3.2.2.2.3: Message flow for ProSe Direct Discovery Announce Request
(ECUR for roaming)
0-2. same as figure 5.3.2.2.3.2 step 0-2
3\. ProSe Function sends Reserve Units Request[Initial, ProSe App ID, cmd =
Announce] to the OCS for requesting units.
4\. The OCS performs Reserve Units Request operation for Announcing UE.
5\. The OCS grants service units in the Reserve Units Response to ProSe
Function.
6-7. same as figure 5.3.2.2.3.2 step 6-7
8\. ProSe Function sends Debit Units Request[Terminate] to the OCS indicating
granted units are used. On unsuccessful Announce authorization, granted units
are returned.
9\. The OCS performs Debit Units operation.
10\. The OCS returns the Debit Units Response to ProSe Function.
11-12. same as figure 5.3.2.2.3.2 step 11-12.
##### 5.3.2.2.3 Message flows for ProSe Direct Discovery Monitor Request
Figures 5.3.2.2.3.1 to 5.3.2.2.3.4 describe the transactions between ProSe
Function and OCS for the successful scenario where a \"monitoring UE\" sends a
Discovery request and gets authorization to access the discovery resources.
When the ProSe Application ID has a scope different from PLMN specific scope
(i.e. country-wide or global), the message flows are the same as those for the
case of PLMN specific ProSe Application ID provided by the HPLMN.
Figure 5.3.2.2.3.1: ProSe Direct Discovery Monitor Request -- IEC (non-
roaming)
0\. The UE is configured with the data structure of the ProSe Application IDs
corresponding to PLMNs the UE is authorized to monitor.
1\. If the UE is authorized to monitor in at least one PLMN and is interested
to monitor certain ProSe Application ID(s), the UE sends a Discovery Request
(ProSe Application ID(s), UE Identity, monitor command, application identity)
message for monitoring to the ProSe Function.
2\. Interaction between ProSe Function and HSS for authorization process for
discovery: check if UE is authorized for ProSe discovery service and for this
Application ID, retrieval of PLMNs allowed for discovery. A new context for
this UE is created if no associated UE context exists.
3\. ProSe Function sends Debit Units Request[Event, ProSe App ID, cmd =
Monitor] to the OCS.
4\. The OCS performs the Debit Units operation for Discovery Monitor Request.
5\. The OCS returns the Debit Units Response to ProSe Function.
6\. When the ProSe Application ID has PLMN-specific scope, ProSe Function
sends Monitor Request to the PLMN indicated by the ProSe Application ID.
7\. In case a valid ProSe Application Code corresponding to the requested
ProSe Application ID Name, was stored by the ProSe Function of the Local PLMN,
it returns Monitor Response [ProSe Application Code and/or ProSe Application
Mask].
In case of unsuccessful scenario, the optional refund steps 8 to 10 are
required:
8\. ProSe function sends Debit Units Request[Event] to the OCS for refund
purpose.
9\. The OCS performs Debit Units Request operation for refund.
10\. The OCS returns the Debit Units Response to ProSe Function.
11\. The ProSe Function responds with a Discovery Response [Discovery Filter]
message, when step 7 is successful.. The ProSe Function may use the service
units granted in step 5 to determine the Time To Live value(s) of the
Discovery Filter.
12\. The UE may start monitoring using the Discovery Filter in the authorized
radio resources.
Figure 5.3.2.2.3.2: ProSe Direct Discovery Monitor Request -- ECUR (non-
roaming)
0-2. same as figure 5.3.2.2.3.1 step 0-2.
3\. ProSe Function sends Reserve Units Request[Initial, ProSe App ID, cmd =
Monitor] to the OCS for requesting units.
4\. The OCS performs Reserve Units Request operation for Discovery Monitor
Request.
5\. The OCS grants service units in the Reserve Units Response to ProSe
Function.
6-7. same as figure 5.3.2.2.3.1 step 6-7.
8\. ProSe Function sends Debit Units Request[Terminate] to the OCS indicating
granted units are used. On unsuccessful Monitor Response, granted units are
returned.
9\. The OCS performs the Debit Units operation.
10\. The OCS returns the Debit Units Response to ProSe Function.
11-12. same as figure 5.3.2.2.3.1 step 11-12.
Figure 5.3.2.2.3.3: ProSe Direct Discovery Monitor Request -- IEC (roaming)
0\. The UE is configured with the data structure of the ProSe Application IDs
corresponding to PLMNs the UE is authorized to monitor. This step is performed
using mechanisms out of scope of 3GPP.
1\. If the UE is authorized to monitor in at least one PLMN and is interested
to monitor certain ProSe Application ID(s), it shall establish a secure
connection with the ProSe Function in HPLMN and it shall send a Discovery
Request (ProSe Application ID(s), UE Identity, Monitor command, application
identity) message for monitoring.
2\. If there is no associated UE context, the ProSe Function shall check with
HSS the authorization for discovery and, if necessary, create a new context
for this UE that contains the subscription parameters for this UE for the
duration the Discovery Filters will be valid.
3\. ProSe Function sends Debit Units Request[Event,ProSe App ID, cmd =
Monitor] to the OCS.
4\. The OCS performs the Debit Units operation for Discovery Monitor Request.
5\. The OCS returns the Debit Units Response to ProSe Function.
6\. The ProSe Function in HPLMN shall contact other PLMNs that are indicated
by the ProSe Application ID(s) sent by the UE, in order to resolve the
corresponding ProSe Application ID Name(s) to mask(s).
7\. If the ProSe Function of the other PLMN stores valid ProSe Application
Code(s) corresponding to the requested ProSe Application ID Name(s), then the
ProSe Function of the Local PLMN returns the related ProSe Application mask(s)
and the corresponding TTL for each.
In case of unsuccessful scenario, the optional refund steps 8 to 10 are
required:
8\. ProSe function sends Debit Units Request[Event] to the OCS for refund
purpose.
9\. The OCS performs Debit Units Request operation for refund.
10\. The OCS returns the Debit Units Response to ProSe Function.
11\. The ProSe Function in the HPLMN responds with a Discovery Response
(Discovery Filter(s), Filter ID) message, in case step 7 is successful. The
Discovery Filter(s) consists of the ProSe Application mask(s), and associated
Time To Live value(s) which may be determined according to the service units
granted in step 5.
12\. The UE may start monitoring using the Discovery Filter(s) in the radio
resources that are authorized and configured by the PLMN(s) to be used for
ProSe as defined in RAN specifications.
Figure 5.3.2.2.3.4: ProSe Direct Discovery Monitor Request -- ECUR (roaming)
0-2. same as figure 5.3.2.2.3.3 step 0-2.
3\. ProSe Function sends Reserve Units Request[Initial, ProSe App ID, cmd =
Monitor] to the OCS for requesting units.
4\. The OCS grants service units in the Reserve Units Response to ProSe
Function.
5-6. same as figure 5.3.2.2.3.3 step 5-6.
7\. ProSe Function sends Debit Units Request[Terminate] to the OCS indicating
granted units are used. On unsuccessful Monitor Response, granted units are
returned.
8\. The OCS returns the Debit Units Response to ProSe Function.
9-10. same as Figure 5.3.2.2.3.3 step 11-12.
##### 5.3.2.2.4 Message flows for ProSe Direct Discovery Match Report Request
Figures 5.3.2.2.4.1 to 5.3.2.2.4.4 define the transactions between ProSe
Function and OCS for the successful scenario where a \"Monitoring UE\" sends a
Match report in non-roaming case and roaming case for IEC and ECUR modes.
When the ProSe Application ID has a scope different from PLMN specific scope
(i.e. country-wide or global), the message flows are the same as those for the
case of PLMN specific ProSe Application ID.
Figure 5.3.2.2.4.1: Message flow for ProSe Direct Discovery Match Report
Request (IEC for non-roaming)
1\. If the UE finds ProSe Application Code(s) that matches the Discovery
Filters and does not have ProSe Application ID(s) already locally stored that
correspond to this ProSe Application Code(s), it shall (re)establish a secure
connection with the ProSe Function in HPLMN to which it shall then send a
Match Report (ProSe Application Code(s), Discovery Filter ID(s), UE Identity)
message to the ProSe Function in HPLMN.
2\. The ProSe Function shall check the context for this UE that contains its
subscription parameters.\ The authorization information also contains the PLMN
that this UE is allowed to perform discovery.
3\. ProSe Function sends Debit Units Request[Event] indicating \"Match\" to
the OCS.
4\. The OCS performs the Debit Units operation for \"Match\".
5\. The OCS returns the Debit Units Response to ProSe Function.
6\. The ProSe Function analyses the ProSe Application Code received from the
UE.
If the PLMN ID that assigned the given ProSe Application Code is another Local
PLMN then steps 7-14 are executed, otherwise (i.e. the ProSe Application Code
was assigned by HPLMN) only step 14 is executed:
7\. The ProSe Function in HPLMN sends a Match Report (ProSe Application
Code(s), UE identity) to the ProSe Function of the PLMN that assigned the
ProSe Application Code.
8\. The ProSe Function analyses the ProSe Application Code(s) received from
the UE.
9\. If the ProSe Application Code is confirmed then the ProSe Function in
Local PLMN shall send Match Report Acknowledgement (ProSe Application ID
Name(s), validity timer(s)).
In case of unsuccessful scenario, the optional refund steps 10 to 12 are
required:
10\. ProSe function sends Debit Units Request[Event] to the OCS for refund
purpose.
11\. The OCS performs Debit Units Request operation for refund.
12\. The OCS returns the Debit Units Response to ProSe Function.
13\. If it was indicated that the announcing UE is roaming during the Monitor
Request process, the ProSe Function in HPLMN shall send a Match Report Info
(ProSe Application ID(s), UE Identity) to the ProSe Function of the serving
PLMN of the Announcing UE.
14\. The ProSe Function in HPLMN shall respond to the UE with Match Report
Acknowledgment (ProSe Application ID(s), validity timer(s)).
Figure 5.3.2.2.4.2: Message flow for ProSe Direct Discovery Match Report
Request\ (ECUR for non-roaming)
1-2. same as figure 5.3.2.2.4.1 step 1-2.
3\. ProSe Function sends Reserve Units Request[Initial, ProSe App ID, cmd =
Match] to the OCS for requesting units.
4\. The OCS performs the Debit Units operation for \"Match\".
5\. The OCS grants service units in the Reserve Units Response to ProSe
Function.
6-9. same as figure 5.3.2.2.4.1 step 6-9.
10\. ProSe Function sends Debit Units Request[Terminate] to the OCS with
granted units used. On unsuccessful Match Report, granted units are returned.
11\. The OCS performs the Debit Units operation for \"Match\".
12\. The OCS returns the Debit Units Response to ProSe Function.
13-14. same as figure 5.3.2.2.4.1 step 13-14.
Figure 5.3.2.2.4.3: Message flow for ProSe Direct Discovery Match Report
Request (IEC for roaming)
1\. If the UE finds ProSe Application Code(s) that matches the Discovery
Filters and does not have ProSe Application ID(s) already locally stored that
correspond to this ProSe Application Code(s), it (re)establishes a secure
connection with the ProSe Function in HPLMN and sends a Match Report (ProSe
Application Code(s), Discovery Filter ID(s), UE Identity, VPLMN ID, Monitored
PLMN ID) message to the ProSe Function in HPLMN.
2\. The ProSe Function shall check the context for this UE that contains its
subscription parameters for this UE. The authorization information also
contains the PLMN that this UE is allowed to perform discovery.
3\. ProSe Function sends Debit Units Request[Event] indicating \"Match\" to
the OCS.
4\. The OCS performs the Debit Units operation for \"Match\".
5\. The OCS returns the Debit Units Response to ProSe Function.
6\. The ProSe Function analyses the ProSe Application Code(s) received from
the UE.
If the PLMN ID that assigned the given ProSe Application Code is not the
HPLMN, then steps 7-14 are executed, otherwise (i.e. the HPLMN assigned the
ProSe Application Code) only steps 14 is executed:
7\. The ProSe Function in HPLMN sends a Match Report (ProSe Application
Code(s), UE identity, monitored PLMN ID) to the ProSe Function of the PLMN
that assigned the ProSe Application Code (i.e. the ProSe Function of the HPLMN
of the \"announcing UE\").
8\. The ProSe Function ensures that the received ProSe Application Code is
authorized to be transmitted on the monitored PLMN. The ProSe Function
analyses the ProSe Application Code(s) received from the UE, and confirms the
ProSe Application Code(s).
9\. The ProSe Function shall send Match Report Acknowledgement (ProSe
Application ID Name(s), validity timer(s)).
In case of unsuccessful scenario, the optional refund steps 10 to 12 are
required:
10\. ProSe function sends Debit Units Request[Event] to the OCS for refund
purpose.
11\. The OCS performs Debit Units Request operation for refund.
12\. The OCS returns the Debit Units Response to ProSe Function.
13\. If it was indicated that the Announcing UE is roaming during the Monitor
Request process, the ProSe Function in HPLMN shall send a Match Report Info
(ProSe Application ID(s), UE Identity) to the ProSe Function of the serving
PLMN of the Announcing UE.
14\. The ProSe Function in HPLMN shall respond to the UE with Match Report
Acknowledgment (ProSe Application ID(s), validity timer(s)).
Figure 5.3.2.2.4.4: Message flow for ProSe Direct Discovery Match Report
Request (ECUR for roaming)
1-2. same as figure 5.3.2.2.4.3 step 1-2.
3\. ProSe Function sends Reserve Units Request[Initial, ProSe App ID, cmd =
Match] to the OCS for requesting units.
4\. The OCS performs the Debit Units operation for \"Match\" Report Request.
5\. The OCS grants service units in the Reserve Units Response to ProSe
Function.
6-9. same as figure 5.3.2.2.4.3 step 6-9.
10\. ProSe Function sends Debit Units Request[Terminate] to the OCS with
granted units used. On unsuccessful Match Report, granted units are returned.
11\. The OCS performs the Debit Units operation for \"Match\".
12\. The OCS returns the Debit Units Response to ProSe Function.
13-14. same as figure 5.3.2.2.4.3 step 13-14.
#### 5.3.2.3 ProSe EPC-level Discovery
##### 5.3.2.3.1 Triggers for ProSe EPC-level Discovery online charging
ProSe EPC-level Discovery Proximity Request allows a ProSe-enabled UE A to
request the network to assist it detecting if UE B is in proximity.
Debit/Reserve Unit Request[Initial/Update] is triggered for UE A, when a
Proximity Request is received and the App Server provides the valid mapping
information. Debit/Reserve Unit Request[Initial] is triggered when there is no
active discovery session for the same pair of UE A and UE B identified by EPC
ProSe User ID A (EPUID_A) and EPC ProSe User ID B (EPUID_B). Debit/Reserve
Unit Request[Update] is triggered when there is an existing discovery session
for the same pair of UE A and UE B.
Debit/Reserve Unit Request[Terminate] is triggered for UE A, when a Proximity
Request Reject or Proximity Request Cancellation is sent.
Debit/Reserve Unit Request[Initial/Update] is triggered for UE B, when a
Proximity Request is received. Debit/Reserve Unit Request[Initial] is
triggered when there is no active discovery session for the same pair of UE A
and UE B identified by EPC ProSe User ID A (EPUID_A) and EPC ProSe User ID B
(EPUID_B). Debit/Reserve Unit Request[Update] is triggered when there is an
existing discovery session for the same pair of UE A and UE B.
Debit/Reserve Unit Request[Terminate] is triggered for UE B, when a Proximity
Request Reject or Proximity Request Cancellation is sent.
##### 5.3.2.3.2 Message flow for ProSe EPC-level Discovery Proximity Request
Figure 5.3.2.3.2.1 depicts the message flow for ProSe EPC-level Discovery
Proximity Request for UE A.
Figure 5.3.2.3.2.1: Message flow for ProSe EPC-level Discovery Proximity
Request (UE A)
1 - 3. These steps are defined in TS 23.303 [238] clause 5.5.5.
4a. ProSe Function A sends Debit/Reserve Units Request[Initial/Update]
according to the conditions specified in 5.3.2.3.1 to the corresponding OCS A.
4b. The OCS A performs Debit/Reserve Units operation for the UE.
4c. The OCS A returns the Debit Units Response to ProSe Function A.
5\. ProSe Functions A sends the Proximity Request to ProSe Function B if step
4c indicates success.
6\. ProSe Function B triggers the corresponding EPC-level discovery procedure
for UE B, as depicted in figure 5.3.2.3.2.2.
7a ProSe Function B rejects the Proximity Request with the Proximity Request
Reject (Cause) message.
If ProSe Function received Proximity Request Reject in step 7a, the following
step 7b to 7e will executed. Otherwise, step 8 to 9b will be executed.
7b. ProSe Function A sends the Proximty Request Reject (Cause) to UE A.
7c ProSe Function A sends Debit/Reserve Units Request[Terminate] the
corresponding OCS A.
7d. The OCS A performs Debit/Reserve Units operation for the UE.
7e. The OCS A returns the Debit Units Response to ProSe Function A.
8\. ProSe Function B sends Proxmity Request Ack message to ProSe Function A.
9a. ProSe Function A sends LCS Locaiton Reporting Request for UE A to SLP A.
9b. ProSe Function A sends Proximity Request Ack to UE A.
Figure 5.3.2.3.2.2 depicts the message flow for ProSe EPC-level Discovery
Proximity Request for UE B.
Figure 5.3.2.3.2.2: Message flow for ProSe EPC-level Discovery Proximity
Request (UE B)
1\. EPC-level discovery operation for UE A is executed, as depicted in step 1
to 4c in figure 5.3.2.3.2.2.
2\. ProSe Functions A sends the Proximity Request to ProSe Function B.
3a. ProSe Function B sends Debit/Reserve Units Request[Initial/Update]
according to the conditions specified in 5.3.2.3.1 to the corresponding OCS B.
3b. The OCS B performs Debit/Reserve Units operation for the UE.
3c. The OCS B returns the Debit Units Response to ProSe Function B.
4\. If step 3c indicates success, the ProSe Function B obtains from HSS the
last known location of UE B.
5\. ProSe Function B may reject the request based on the information obtained
in step 4, and send a Proximity Request Reject (Cause) message to ProSe
Function A.
6\. ProSe Function B validates the Proximity Request with UE B if it decides
to accept the Proximity Request.
7a. ProSe Function B sends LCS Location Reporting Request to SLP B for UE B.
7b. ProSe Function B sends Proximity Request Ack message to the ProSe Function
A.
The following step 8a to 8c are executed only when 5 is executed or step 6
validation fails.
8a. ProSe Function B sends Debit/Reserve Units Request[Terminate] the
corresponding OCS B.
8b. The OCS B performs Debit/Reserve Units operation for the UE.
8c. The OCS B returns the Debit Units Response to ProSe Function B.
9\. EPC-level discovery operation for UE A is executed, as depicted in step 7a
to 9b in figure 5.3.2.3.2.2.
##### 5.3.2.3.3 Message flow for ProSe EPC-level Discovery Proximity Request
Cancellation
ProSe EPC-level Discovery Proximity Request cancellation is triggered by
either the UE or network. It is cancels the proximity detection for a
particular pair of UEs, e.g. UE A and UE B. Therefore, upon this procedure,
Debit/Reserve Unit Request[Termiante] is triggered for UE A and UE B, after
the respective ProSe Function responded to the Cancel Proximity Request
message.
Figure 5.3.2.3.3.1 depicts the message flow for ProSe EPC-level Discovery
Proximity Request Cancellation.
Figure 5.3.2.3.3.1: Message flow for ProSe EPC-level Discovery Proximity
Request Cancellation
1 - 5. These steps are defined in TS 23.303 [238] clause 5.5.9.
5a. After the ProSe Function B sends a Cancel Proximity Request Ack to the
ProSe Function A, the ProSe Function B triggers Debit/Reserve Units
Request[Termiante] to the corresponding OCS B. This shall also indicate if a
Proximity Alert has been sent to UE B.
5b. OCS B perform the Debit/Reserve Unit operation for UE B.
5c. The OCS B returns Debit/Reserve Units Response.
6\. This step is defined in TS 23.303 [238] clause 5.5.9.
6a. After the ProSe Function A sends a Proximity Request Cancellation to the
UE A, the ProSe Function A triggers Debit/Reserve Units Request[Termiante] to
the corresponding OCS A. This shall also indicate if a Proximity Alert has
been sent to UE A.
6b. OCS A perform the Debit/Reserve Unit operation for UE A.
6c. The OCS A returns Debit/Reserve Units Response.
# 6 Definition of charging information
## 6.1 Data description for ProSe offline charging
### 6.1.1 Rf message contents
#### 6.1.1.1 General
The ProSe Offline Charging uses the Charging Data Transfer messages Charging
Data Request and Charging Data Response defined in TS 32.299 [50].
The Charging Data Request can be of type event and includes all charging
information. The Charging Data Response is an acknowledgement of the Charging
Data Request.
Table 6.1.1.1.1 describes the use of these messages for offline charging.
Table 6.1.1.1.1: Offline charging messages reference table
* * *
Message Source Destination Charging Data Request ProSe Function CDF Charging
Data Response CDF ProSe Function
* * *
This clause describes the different fields used in the Charging Data messages
and the category in the tables are used according to the charging data
configuration defined in clause 5.4 of TS 32.240 [1].
#### 6.1.1.2 Charging Data Request message
Table 6.1.1.2.1 illustrates the basic structure of a Charging Data Request
message from the ProSe Function as used for ProSe offline charging.
Table 6.1.1.2.1: Charging Data Request message contents
* * *
Information Element Category Description Session Identifier M Described in TS
32.299 [50] Originator Host M Described in TS 32.299 [50] Originator Domain M
Described in TS 32.299 [50] Destination Domain M Described in TS 32.299 [50]
Operation Type M Described in TS 32.299 [50] Operation Number M Described in
TS 32.299 [50] Operation Identifier O~C~ Described in TS 32.299 [50] User Name
O~C~ Described in TS 32.299 [50] Destination Host O~C~ Described in TS 32.299
[50] Operation Interval O~C~ Described in TS 32.299 [50] Origination State
O~C~ Described in TS 32.299 [50] Origination Timestamp O~C~ Described in TS
32.299 [50] Proxy Information O~C~ Described in TS 32.299 [50] Route
Information O~C~ Described in TS 32.299 [50] Operation Token O~M~ This field
identifies the Proximity-based Services. Service Information O~M~ This field
holds the ProSe specific information described in clause 6.3.
* * *
NOTE: Detailed descriptions of the information elements are provided in TS
32.299 [50].
#### 6.1.1.3 Charging Data Response message
Table 6.1.1.3.1 illustrates the basic structure of a Charging Data Response
message as used for the ProSe function.
Table 6.1.1.3.1: Charging Data Response message contents
* * *
Information Element Category Description Session Identifier M Described in TS
32.299 [50] Operation Result M Described in TS 32.299 [50] Originator Host M
Described in TS 32.299 [50] Originator Domain M Described in TS 32.299 [50]
Operation Type M Described in TS 32.299 [50] Operation Number O~C~ Described
in TS 32.299 [50] Operation Identifier O~C~ Described in TS 32.299 [50]
Operation Interval O~C~ Described in TS 32.299 [50] Error Reporting Host O~C~
Described in TS 32.299 [50] Origination State O~C~ Described in TS 32.299 [50]
Origination Timestamp O~C~ Described in TS 32.299 [50] Proxy Information O~C~
Described in TS 32.299 [50]
* * *
NOTE: Detailed descriptions of the information elements are provided in TS
32.299 [50].
### 6.1.2 Ga message contents
Refer to clause 5.2.4 for further information.
### 6.1.3 CDR description on the Bx interface
#### 6.1.3.1 General
The following standard CDR content and format are considered:
\- PF-DD-CDR generated based on ProSe Direct Discovery information from the
ProSe function;
\- PF-ED-CDR generated based on ProSe EPC-level Discovery from the ProSe
function.
\- PF-DC-CDR generated based on ProSe Direct Communication from the ProSe
function.
For each of the CDR types, a parameter table, which gives a short description
of the parameters, is provided. The category in the tables are used according
to the charging data configuration defined in clause 5.4 of TS 32.240 [1].
#### 6.1.3.2 Direct Discovery charging data in ProSe Function (PF-DD-CDR)
If the collection of CDR data is enabled then the charging data specified in
table 6.1.3.2.1 shall be available for direct discovery request.
Table 6.1.3.2.1: ProSe Function Direct Discovery data (PF-DD-CDR)
+----------------------------+----------+----------------------------+ | Field | Category | Description | +----------------------------+----------+----------------------------+ | Record Type | M | ProSe Direct Discovery | | | | record. | +----------------------------+----------+----------------------------+ | Retransmission | Oc | This parameter, when | | | | present, indicates that | | | | information from | | | | retransmitted Accounting | | | | Requests has been used in | | | | this CDR. | +----------------------------+----------+----------------------------+ | Served IMSI | C | IMSI of the served party. | +----------------------------+----------+----------------------------+ | Announcing UE HPLMN | OM | PLMN identity of | | Identifier | | Announcing UE HPLMN. | +----------------------------+----------+----------------------------+ | Announcing UE VPLMN | OC | PLMN identity of | | Identifier | | Announcing UE VPLMN. | +----------------------------+----------+----------------------------+ | Monitoring UE HPLMN | OC | PLMN identity of | | Identifier | | monitoring UE HPLMN. | +----------------------------+----------+----------------------------+ | Monitoring UE VPLMN | OC | PLMN identity of | | Identifier | | monitoring UE VPLMN. | +----------------------------+----------+----------------------------+ | Monitored PLMN Identifier | OC | Monitored PLMN ID in | | | | Match_Report request, as | | | | defined in TS23.303 | | | | [238] clause 5.3.4. It | | | | corresponds to the | | | | Announcing UE VPLMN | | | | Identifier when roaming | | | | and Announcing UE HPLMN | | | | Identifier when | | | | non-roaming. | +----------------------------+----------+----------------------------+ | Role of ProSe Function | OM | This field indicates the | | | | CDR resource ProSe | | | | Function resides in which | | | | PLMN, i.e. in HPLMN, VPLMN | | | | or local PLMN. | +----------------------------+----------+----------------------------+ | ProSe Application ID | Oc | The identities used for | | | | ProSe Direct Discovery, | | | | identifying application | | | | related information for | | | | the ProSe-enabled UE. | | | | | | | | (see note) | +----------------------------+----------+----------------------------+ | Application ID | Oc | A globally unique | | | | identifier identifying a | | | | specific 3rd party | | | | application. | +----------------------------+----------+----------------------------+ | ProSe Event Type | Oc | This IE holds the event | | | | which triggers the | | | | charging message delivery, | | | | e.g. Announcing, | | | | Monitoring, or Match | | | | Report. | +----------------------------+----------+----------------------------+ | Direct Discovery Model | Oc | model of the Direct | | | | Discovery used by the UE, | | | | e.g. Model A, or Model B. | +----------------------------+----------+----------------------------+ | Node ID | Oc | The identifier of the | | | | ProSe Function. | +----------------------------+----------+----------------------------+ | ProSe Function IP Address | Oc | The IP address of the | | | | ProSe Function. | +----------------------------+----------+----------------------------+ | ProSe Function ID | Oc | The FQDN that identifies | | | | the ProSe Function. | +----------------------------+----------+----------------------------+ | Validity Period | Oc | Time interval during which | | | | user is authorized for | | | | using ProSe Direct | | | | Discovery functionality | | | | (e.g. announcing, | | | | monitoring, match | | | | reporting). | +----------------------------+----------+----------------------------+ | Role of UE | Oc | Role of the UE using | | | | ProSe, e.g. Announcing UE, | | | | Monitoring UE. | +----------------------------+----------+----------------------------+ | ProSe Request Timestamp | Oc | The time when ProSe | | | | Request is received from | | | | UE. | +----------------------------+----------+----------------------------+ | PC3 Control Protocol Cause | Oc | This field holds the | | | | particular reason why a | | | | DISCOVERY_REQUEST or | | | | Match_Report messages | | | | from the UE have been | | | | rejected by the ProSe | | | | Function. | +----------------------------+----------+----------------------------+ | Monitoring UE Identifier | Oc | Identifier of the party | | | | who initiate monitor/match | | | | report, i.e. IMSI, which | | | | corresponds to UE | | | | Identifier parameter in | | | | monitor/match report | | | | request, as defined in TS | | | | 23.303 [238]. | +----------------------------+----------+----------------------------+ | Charging characteristics | M | The Charging | | | | Characteristics applied to | | | | the ProSe direct | | | | discovery. | +----------------------------+----------+----------------------------+ | Charging Characteristics | OM | Holds information about | | Selection Mode | | how Charging | | | | Characteristics were | | | | selected. | +----------------------------+----------+----------------------------+ | Record Extensions | Oc | A set of network | | | | operator/manufacturer | | | | specific extensions to the | | | | record. Conditioned upon | | | | the existence of an | | | | extension. | +----------------------------+----------+----------------------------+ | Note: For the CDR | | | | generated for announcing | | | | UE in match report event, | | | | it holds the ProSe | | | | application id name. | | | +----------------------------+----------+----------------------------+
#### 6.1.3.3 ProSe EPC-level Discovery charging data in ProSe Function (PF-ED-
CDR)
If enabled, a ProSe EPC-level Discovery record shall be produced for each EPC-
level discovery request for a specific user received from a ProSe enabled UE.
Renewal requests for a specific user are captured in the same CDR as the
initial request. The fields in the record are specified in table 6.1.3.3.1.
Table 6.1.3.3.1: ProSe Function EPC-level Discovery data (PF-ED-CDR)
* * *
Field Category Description Record Type M ProSe Function EPC-level Discovery
record. Retransmission Oc This parameter, when present, indicates that
information from retransmitted Accounting Requests has been used in this CDR.
Served IMSI C IMSI of the served party. ProSe Function PLMN Identifier OC PLMN
identity of ProSe function. Application ID Oc A globally unique identifier
identifying a specific 3rd party application. ProSe Function ID Oc The FQDN
that identifies a ProSe Function. ProSe Function IP Address Oc The IP address
of the ProSe Function. Role of UE Oc role of the UE using ProSe, e.g.
requestor UE, requested UE ProSe Request Timestamp Oc The time when ProSe
Request is received from UE. PC3 EPC Control Protocol Cause Oc This field
holds the particular reason why a Proximity request messages from the UE have
been rejected by the ProSe Function. Requestor Application Layer User ID Oc
The user identifier designated in 3rd party application for the user who
initiate EPC-level ProSe discovery request. WLAN Link Layer ID Oc This field
holds WLAN Link Layer ID. Requestor EPC ProSe User ID Oc The identifier
generated in ProSe Function for UE who initiate EPC-level ProSe discovery
request. Requested Application Layer User ID Oc The user identifier designated
in 3rd party application for the user who is targeted in proximity request.
Requested PLMN Identifier Oc The PLMN identifier of the user who is targeted
in proximity request. Time Window Oc The time interval in minutes during which
the first proximity request is valid. Range Class Oc A range class for the
first proximity request. UE Location Oc The UE location with the best known
accuracy (e.g. Cell ID or geo-location coordinates) at the time fo the first
proximity request.. Proximity Request Renewal Info Block List Oc This is a
list of information blocks that are added by each of the Proximity renewal
Request messages captured in the CDR. The information block contains
information of the renewal request, e.g. timestamp, time window, range class,
and UE location. The definition of the information block is in table
6.1.3.3.2. Proximity Alert Indication Oc Indication of whether proximity alert
has been sent before proximity request cancellation. Proximity Alert Timestamp
Oc The time stamp when proximity alert is sent, to indicate two UEs are in
proximity. Proximity Cancellation Timestamp Oc The time stamp when proximity
request cancellation is requested. Reason for Cancellation Oc The reason for
cancellation of an EPC-level discovery request i.e. proximity alerted, time
expired with no renewal, requestor cancellation. Charging characteristics M
The Charging Characteristics applied to the ProSe EPC-Level discovery.
Charging Characteristics Selection Mode OM Holds information about how
Charging Characteristics were selected. Cause for Record Closing M The reason
for the release of record from this ProSe Function. Record Extensions Oc A set
of network operator/manufacturer specific extensions to the record.
Conditioned upon the existence of an extension.
* * *
Table 6.1.3.3.2: ProSe Function EPC-level Discovery Proximity Request Renewal
Info Block
* * *
Field Category Description ProSe Request Timestamp Oc The time when the
proximity renewal request is received from UE. Time Window Oc The time
interval in minutes during which the proximity renewal request is valid. Range
Class Oc A range class for the proximity renewal request. UE Location Oc The
UE location with the best known accuracy (e.g. Cell ID or geo-location
coordinates) at the time fo the proximity renewal request.
* * *
#### 6.1.3.4 Direct communication charging data in ProSe Function (PF-DC-CDR)
If the collection of CDR data is enabled then the charging data specified in
table 6.1.3.4.1 shall be available for Direct Communication request.
Table 6.1.3.4.1: ProSe Function Direct Communication data (PF-DC-CDR)
* * *
Field Category Description Record Type M ProSe Direct Communication record.
Retransmission Oc This parameter, when present, indicates that information
from retransmitted Charging Data Request has been used in this CDR. Served
IMSI C IMSI of the served party. ProSe Function PLMN Identifier OM PLMN
identity of HPLMN ProSe function. Node ID Oc The identifier of the ProSe
Function. ProSe Function IP Address Oc The IP address of the ProSe Function.
ProSe Function ID Oc The FQDN that identifies the ProSe Function. Charging
characteristics M The Charging Characteristics applied to the ProSe group
communication. Charging Characteristics Selection Mode OM Holds information
about how Charging Characteristics were selected. Record Opening Time M Time
stamp when the CDR is open. Cause for Record Closing M The reason for the
closing of record from this ProSe Function. List of Coverage Info Oc A list of
coverage status changes with time stamps. When in coverage, additionally
includes list of location changes (i.e., ECGI change) and time stamps. List of
Radio Parameter Set Info Oc A list of radio parameter sets configured in the
UE for direct communication use. Each set has an associated time stamp of when
it became active. ProSe UE ID Oc A link layer identifier assigned by the EPS
that uniquely represents the UE in the context of ProSe Direct Communication.
Source IP address Oc The IP address UE used as source address for performing
ProSe Direct Communication. ProSe Layer-2 Group ID Oc The identifier of a
ProSe communication group, uniquely represents a specific one-to-many ProSe
Direct Communication and is included in CDRs for each participantes in the
specific group. ProSe Group IP multicast address Oc The IP multicast address
to be used for performing ProSe Direct Communication. Time of First
Transmission Oc Time when collection of transmission data is started for the
group in this CDR, i.e., the first one-to-many direct communication
transmission started. Time of First Reception Oc Time when collection of
reception data is started for the group in this CDR, i.e., the first one-to-
many direct communication reception started. List of Transmitters Oc A list of
transmitters detected for the group. The information stored consists of the
source IP address and the ProSe UE ID for each transmitter. List of
Transmission Data OM A list of changes in trigger conditions (e.g. change of
cell, go out of coverage, come back to coverage, etc.) for a specific ProSe
group communication. Each change is time stamped. Trigger condition is used to
categorize transmitted data volumes, such as per coverage status duration.
List of Reception Data Oc A list of changes in trigger conditions (e.g. change
of cell, go out of coverage, come back to coverage, etc.) for a specific ProSe
group communication. Each change is time stamped. Trigger condition is used to
categorize received data volumes, such as per coverage status duration. List
of Application Specific Data Oc A list of data blocks provided by the
application in the UE. The content of each block is application-specific. The
Application Specific Data is not related to any specific group. When received
from the UE, it shall be added to all open group CDRs. The content of the
Application Specific Data for a particular application should clearly identify
to which group(s) the information applies and uniquely identify chargeable
events in order for the billing domain to properly charge this information and
avoid duplicate charging. Record Extensions Oc A set of network
operator/manufacturer specific extensions to the record. Conditioned upon the
existence of an extension.
* * *
The components of the Direct Communication Transmission and Reception Data
Containers are defined in following table.
Table 6.1.3.4.2: Structure of the Direct Communication Transmission and
Reception Data Containers
* * *
Field Category Description Local Sequence Number Oc The sequence number of the
Direct Communication data container, which is increased by 1 for each
container closed Change Time Oc The time when the container is closed and
reported due to ProSe charging condition change. Coverage status Oc Whether UE
is served by E-UTRAN or not, i.e. in coverage, out of coverage. UE Location Oc
The location of the UE, e.g. ECGI Data Volume Transmitted Oc Amount of data
transmitted by UE, only applicable in the Transmission Data Container. Data
Volume Received Oc Amount of data received by UE, only applicable in the
Reception Data Container. Change Condition Oc ProSe specific reason for
closing the container, e.g. change of Cell, go out of coverage, come back to
coverage. VPLMN Identifier Oc Indentifier of PLMN which UE visits. Usage
information report sequence number Oc The sequence number of usage information
report, which is used to generate the container. Radio Resources Indicator Oc
Identifies whether the operator-provided radio resources or the configured
radio resources were used for ProSe direct communication. Radio Frequency Oc
Identifies the radio frequency used for ProSe direct communication.
* * *
## 6.2 Data description for ProSe online charging
### 6.2.1 Ro message contents
#### 6.2.1.1 General
The ProSe Online Charging uses the Debit / Reserve Units Request and Debit /
Reserve Units Response messages defined in TS 32.299 [50].
Table 6.2.1.1.1 describes the use of these messages for online charging.
Table 6.2.1.1.1: Online charging messages reference table
* * *
Message Source Destination Debit / Reserve Units Request ProSe Function OCS
Debit / Reserve Units Response OCS ProSe Function
* * *
The structure of the Debit / Reserve Units Request and Debit / Reserve Units
Reponse messages defined in the following clauses. The category in the tables
are used according to the charging data configuration defined in clause 5.4 of
TS 32.240 [1].
#### 6.2.1.2 Debit / Reserve Units Request message
Table 6.2.1.2.1 illustrates the basic structure of a Debit / Reserve Units
Request message from the ProSe Function as used for ProSe online charging.
Table 6.2.1.2.1: Debit / Reserve Units Request message contents
+----------------------------+----------+----------------------------+ | Information Element | Category | Description | +----------------------------+----------+----------------------------+ | Session Identifier | M | Described in TS 32.299 | | | | [50] | +----------------------------+----------+----------------------------+ | Originator Host | M | Described in TS 32.299 | | | | [50] | +----------------------------+----------+----------------------------+ | Originator Domain | M | Described in TS 32.299 | | | | [50] | +----------------------------+----------+----------------------------+ | Destination Domain | M | Described in TS 32.299 | | | | [50] | +----------------------------+----------+----------------------------+ | Operation Identifier | M | Described in TS 32.299 | | | | [50] | +----------------------------+----------+----------------------------+ | Operation Token | M | Described in TS 32.299 | | | | [50] | +----------------------------+----------+----------------------------+ | Operation Type | M | Described in TS 32.299 | | | | [50] | +----------------------------+----------+----------------------------+ | Operation Number | M | Described in TS 32.299 | | | | [50] | +----------------------------+----------+----------------------------+ | Destination Host | O~C~ | Described in TS 32.299 | | | | [50] | +----------------------------+----------+----------------------------+ | User Name | O~C~ | Described in TS 32.299 | | | | [50] | +----------------------------+----------+----------------------------+ | Origination State | O~C~ | Described in TS 32.299 | | | | [50] | +----------------------------+----------+----------------------------+ | Origination Timestamp | O~C~ | Described in TS 32.299 | | | | [50] | +----------------------------+----------+----------------------------+ | Subscriber Identifier | O~M~ | Described in TS 32.299 | | | | [50]. | | | | | | | | The IMSI and MSISDN shall | | | | be included, if available. | +----------------------------+----------+----------------------------+ | Termination Cause | O~C~ | Described in TS 32.299 | | | | [50] | +----------------------------+----------+----------------------------+ | Requested Action | O~C~ | Described in TS 32.299 | | | | [50] | +----------------------------+----------+----------------------------+ | Multiple Operation | O~M~ | Described in TS 32.299 | | | | [50] | +----------------------------+----------+----------------------------+ | Multiple Unit Operation | O~C~ | Described in TS 32.299 | | | | [50] | +----------------------------+----------+----------------------------+ | Operation Correlation | O~C~ | Described in TS 32.299 | | Identifier | | [50] | +----------------------------+----------+----------------------------+ | Subscriber Equipment | O~C~ | Described in TS 32.299 | | Number | | [50] | +----------------------------+----------+----------------------------+ | Proxy Information | O~C~ | Described in TS 32.299 | | | | [50] | +----------------------------+----------+----------------------------+ | Route Information | O~C~ | Described in TS 32.299 | | | | [50] | +----------------------------+----------+----------------------------+ | Service Information | O~M~ | This field holds the ProSe | | | | specific information | | | | described in clause 6.3 | +----------------------------+----------+----------------------------+
NOTE: Detailed descriptions of the information elements are provided in TS
32.299 [50].
#### 6.2.1.3 Debit / Reserve Units Response message
Table 6.2.1.3.1 illustrates the basic structure of a Debit / Reserve Units
Response message as used for the ProSe function.
Table 6.2.1.3.1: Debit / Reserve Units Response message contents
* * *
Information Element Category Description Session Identifier M Described in TS
32.299 [50] Operation Result M Described in TS 32.299 [50] Originator Host M
Described in TS 32.299 [50] Originator Domain M Described in TS 32.299 [50]
Operation Identifier M Described in TS 32.299 [50] Operation Type M Described
in TS 32.299 [50] Operation Number M Described in TS 32.299 [50] Operation
Failover O~C~ Described in TS 32.299 [50] Multiple Unit Operation O~M~
Described in TS 32.299 [50] Cost Information O~C~ Described in TS 32.299 [50]
Low Balance Indication O~C~ Described in TS 32.299 [50] Remaining Balance O~C~
Described in TS 32.299 [50] Operation Failure Action O~C~ Described in TS
32.299 [50] Operation Event Failure Action O~C~ Described in TS 32.299 [50]
Redirection Host O~C~ Described in TS 32.299 [50] Redirection Host Usage O~C~
Described in TS 32.299 [50] Redirection Cache Time O~C~ Described in TS 32.299
[50] Proxy Information O~C~ Described in TS 32.299 [50] Route Information O~C~
Described in TS 32.299 [50] Failed Parameter O~C~ Described in TS 32.299 [50]
Service Information O~C~ Described in TS 32.299 [50]
* * *
NOTE: Detailed descriptions of the information elements are provided in TS
32.299 [50].
## 6.3 ProSe charging specific parameters
### 6.3.1 Definition of ProSe charging information
#### 6.3.1.1 ProSe charging information assignment for Service Information
The components in the Service Information that are used for ProSe charging can
be found in table 6.3.1.1.1.
Table 6.3.1.1.1: Service Information used for ProSe charging
+----------------------------+----------+----------------------------+ | Information Element | Category | Description | +----------------------------+----------+----------------------------+ | Service Information | O~M~ | This is a structured IE | | | | and holds the 3GPP | | | | specific parameter as | | | | defined in TS 32.299 | | | | [50]. | +----------------------------+----------+----------------------------+ | > Subscriber Identifier | O~C~ | This IE contains the | | | | identification of the user | | | | (e.g. IMSI), for offline | | | | charging only. | +----------------------------+----------+----------------------------+ | > PS Information | Oc | This is a structured IE | | | | and hold PS specification | | | | parameters.\ | | | | The complete structure is | | | | defined in TS | | | | 32.251 [11]. | +----------------------------+----------+----------------------------+ | > Node Id | Oc | This IE holds the name of | | | | the Node. | +----------------------------+----------+----------------------------+ | > User Location Info | Oc | This IE indicates details | | | | of where the UE is | | | | currently located (e.g. | | | | SAI, TAI, RAI, CGI, ECGI | | | | or access-specific user | | | | location information). | +----------------------------+----------+----------------------------+ | > Change Condition | Oc | This field holds the | | | | reason for sending | | | | Charging Data Request from | | | | the ProSe Function. | +----------------------------+----------+----------------------------+ | > Charging Characteristics | Oc | The Charging | | | | Characteristics applied to | | | | the ProSe service. | +----------------------------+----------+----------------------------+ | > Charging Characteristics | Oc | Holds information about | | > Selection Mode | | how Charging | | | | Characteristics were | | | | selected. | +----------------------------+----------+----------------------------+ | ProSe Information | O~M~ | This is a structured IE | | | | and holds the ProSe | | | | specific parameters.\ | | | | The details are defined in | | | | clause 6.3.1.2. | +----------------------------+----------+----------------------------+
#### 6.3.1.2 Definition of the ProSe Information
ProSe specific charging information is provided within the ProSe Information.
The fields of the ProSe Information are indicated with the node (ProSe
Function) from which the information is sent.
The detailed structure of the ProSe Information can be found in table
6.3.1.2.1.
Table 6.3.1.2.1: Structure of the ProSe Information
+----------------------------+----------+----------------------------+ | Information Element | Category | Description | +----------------------------+----------+----------------------------+ | Announcing UE HPLMN | OM | PLMN identity of HPLMN for | | Identifier | | announcing UE. This field | | | | holdes PLMN identity of | | | | HPLMN for UE requested to | | | | be monitored in | | | | monitor/match report | | | | procedure. | +----------------------------+----------+----------------------------+ | Announcing UE VPLMN | OC | PLMN identity of VPLMN for | | Identifier | | announcing UE. This field | | | | correspondes to Monitored | | | | PLMN ID in match report | | | | request, as defined in | | | | TS23.303 [238] clause | | | | 5.3.4. In this case it's | | | | the same with announcing | | | | UE HPLMN Identifier when | | | | non-roaming | +----------------------------+----------+----------------------------+ | Monitoring UE HPLMN | OC | PLMN identity of HPLMN for | | Identifier | | monitoring UE. | +----------------------------+----------+----------------------------+ | Monitoring UE VPLMN | OC | PLMN identity of VPLMN for | | Identifier | | monitoring UE. | +----------------------------+----------+----------------------------+ | Monitored PLMN Identifier | OC | Monitored PLMN ID in | | | | Match_Report request, as | | | | defined in TS23.303 | | | | [238] clause 5.3.4. It | | | | corresponds to the | | | | Announcing UE VPLMN | | | | Identifier when roaming | | | | and Announcing UE HPLMN | | | | Identifier when | | | | non-roaming. | +----------------------------+----------+----------------------------+ | Role of ProSe Function | OM | This IE indicates the CDR | | | | resource ProSe Function | | | | resides in which PLMN, | | | | i.e. in HPLMN, VPLMN or | | | | local PLMN. | +----------------------------+----------+----------------------------+ | ProSe Application ID | Oc | The identities used for | | | | ProSe Direct Discovery, | | | | identifying application | | | | related information for | | | | the ProSe-enabled UE. | | | | | | | | Note: For the CDR | | | | generated for announcing | | | | UE in match report event, | | | | it holds the ProSe | | | | application id name. | +----------------------------+----------+----------------------------+ | Application ID | Oc | A globally unique | | | | identifier identifying a | | | | specific 3rd party | | | | application. | +----------------------------+----------+----------------------------+ | Application Specific Data | Oc | This IE contains a data | | | | block provided by the | | | | application in the UE. The | | | | content of each block is | | | | application-specific. | +----------------------------+----------+----------------------------+ | ProSe functionality | Oc | This IE holds the ProSe | | | | functionality UE is | | | | requesting, e.g. direct | | | | discovery, EPC-level | | | | discovery, group | | | | communication. | +----------------------------+----------+----------------------------+ | ProSe Event Type | Oc | This IE holds the event | | | | which triggers the | | | | charging message delivery, | | | | e.g. Announcing, | | | | Monitoring, or Match | | | | Report. | +----------------------------+----------+----------------------------+ | Direct Discovery Model | Oc | model of the Direct | | | | Discovery used by the UE, | | | | e.g. Model A, or Model B. | +----------------------------+----------+----------------------------+ | ProSe Function IP Address | Oc | The IP address of the | | | | ProSe Function. | +----------------------------+----------+----------------------------+ | ProSe Function ID | Oc | The FQDN that identifies a | | | | ProSe Function. | +----------------------------+----------+----------------------------+ | Validity Period | Oc | Time interval during which | | | | user is authorized for | | | | using ProSe Direct | | | | Discovery functionality | | | | (e.g. announcing, | | | | monitoring, match | | | | reporting). | +----------------------------+----------+----------------------------+ | Role of UE | Oc | Role of the UE using ProSe | | | | served by the ProSe | | | | Function, e.g. Announcing | | | | UE, Monitoring UE, | | | | requestor UE, requested | | | | UE. | +----------------------------+----------+----------------------------+ | ProSe Request Timestamp | Oc | The time when ProSe | | | | Request is received from | | | | UE. | +----------------------------+----------+----------------------------+ | PC3 Protocol Cause | Oc | This IE holds the | | | | particular reason why a | | | | DISCOVERY_REQUEST or | | | | Match_Report messages | | | | from the UE have been | | | | rejected by the ProSe | | | | Function in PC3 interface. | +----------------------------+----------+----------------------------+ | Monitoring UE Identifier | Oc | Identifier of the party | | | | who initiate monitor/match | | | | report, i.e. IMSI, which | | | | corresponds to UE | | | | Identifier parameter in | | | | monitor/match report | | | | request, as defined in TS | | | | 23.303 [238]. | +----------------------------+----------+----------------------------+ | ProSe Function PLMN | OC | PLMN identity of ProSe | | Identifier | | function. | +----------------------------+----------+----------------------------+ | Requestor PLMN Identifier | OC | The PLMN identifier of the | | | | user who initiate | | | | proximity request. | +----------------------------+----------+----------------------------+ | Requestor Application | Oc | The user identifier | | Layer User ID | | designated in 3rd party | | | | application for the user | | | | who initiate EPC-level | | | | ProSe discovery request. | +----------------------------+----------+----------------------------+ | WLAN Link Layer ID | Oc | This IE holds WLAN Link | | | | Layer ID. | +----------------------------+----------+----------------------------+ | Requestor EPC ProSe User | Oc | The identifier generated | | ID | | in ProSe Function for UE | | | | who initiate EPC-level | | | | ProSe discovery request. | +----------------------------+----------+----------------------------+ | Requested Application | Oc | The user identifier | | Layer User ID | | designated in 3rd party | | | | application for the user | | | | who is targeted in | | | | proximity request. | +----------------------------+----------+----------------------------+ | Requested PLMN Identifier | Oc | The PLMN identifier of the | | | | user who is targeted in | | | | proximity request. | +----------------------------+----------+----------------------------+ | Time Window | Oc | The time interval in | | | | minutes during which a | | | | proximity request is | | | | valid. | +----------------------------+----------+----------------------------+ | Range Class | Oc | A range class for a | | | | specific proximity | | | | request. | +----------------------------+----------+----------------------------+ | Proximity Alert Indication | Oc | Indication of whether | | | | proximity alert has been | | | | sent before proximity | | | | request cancellation. | +----------------------------+----------+----------------------------+ | Proximity Alert Timestamp | Oc | The time stamp when | | | | proximity alert is sent, | | | | to indicate two UEs are in | | | | proximity. | +----------------------------+----------+----------------------------+ | Proximity Cancellation | Oc | The time stamp when | | Timestamp | | proximity request | | | | cancellation is requested. | +----------------------------+----------+----------------------------+ | Reason for Cancellation | Oc | The reason for | | | | cancellation of an | | | | EPC-level discovery | | | | request i.e. proximity | | | | alerted, time expired with | | | | no renewal, requestor | | | | cancellation. | +----------------------------+----------+----------------------------+ | PC3 EPC Control Protocol | Oc | This field holds the | | Cause | | particular reason why a | | | | Proximity request messages | | | | from the UE have been | | | | rejected by the ProSe | | | | Function. | +----------------------------+----------+----------------------------+ | ProSe UE ID | Oc | A link layer identifier | | | | assigned by the EPS that | | | | uniquely represents the UE | | | | in the context of ProSe | | | | Direct Communication. | +----------------------------+----------+----------------------------+ | Source IP address | Oc | The IP address UE used as | | | | source address for | | | | performing ProSe direct | | | | communication. | +----------------------------+----------+----------------------------+ | ProSe Layer-2 Group ID | Oc | The identifier of a ProSe | | | | communication group, | | | | uniquely represents a | | | | specific one-to-many ProSe | | | | Direct Communication and | | | | is included in CDRs for | | | | each participantes in the | | | | specific group. | +----------------------------+----------+----------------------------+ | ProSe Group IP multicast | Oc | The IP multicast address | | address | | to be used for performing | | | | ProSe direct | | | | communication. | +----------------------------+----------+----------------------------+ | Coverage Info | Oc | This IE provides | | | | information on the | | | | coverage status (i.e., | | | | whether the UE is served | | | | by E-UTRAN or not) and the | | | | time when the coverage | | | | status changed to its | | | | current state. When in | | | | E-UTRAN coverage, | | | | additionally includes a | | | | list of location changes | | | | (i.e., ECGI change) and | | | | associated time for each | | | | change. | +----------------------------+----------+----------------------------+ | Radio Parameter Set Info | Oc | This IE provides | | | | information on a radio | | | | parameter set configured | | | | in the UE for direct | | | | communication use. Each | | | | set has an associated time | | | | stamp of when it became | | | | active. | +----------------------------+----------+----------------------------+ | Transmitter Info | Oc | This IE provides | | | | information on a | | | | transmitter detected for | | | | direct communication. Each | | | | transmitter is identified | | | | by a source IP address and | | | | ProSe UE ID. | +----------------------------+----------+----------------------------+ | Time of First Transmission | Oc | This IE holds the time in | | | | UTC format for the first | | | | IP packet transmitted. | +----------------------------+----------+----------------------------+ | Time of First Reception | Oc | This IE holds the time in | | | | UTC format for the first | | | | IP packet received. | +----------------------------+----------+----------------------------+ | Transmission Data | OC | This field holds the | | Container | | container associated to a | | | | trigger conditions (e.g. | | | | change of Cell, go out of | | | | coverage, come back to | | | | coverage, etc.) on a | | | | specific ProSe | | | | transmission of group | | | | communication. | +----------------------------+----------+----------------------------+ | > Local Sequence Number | Oc | The sequence number of the | | | | Direct Communication data | | | | container, which is | | | | increased by 1 for each | | | | container closed | +----------------------------+----------+----------------------------+ | > Change Time | Oc | The time when the | | | | container is closed and | | | | reported due to ProSe | | | | charging condition change. | +----------------------------+----------+----------------------------+ | > Coverage status | Oc | Whether UE is served by | | | | E-UTRAN or not, i.e. in | | | | coverage, out of coverage. | +----------------------------+----------+----------------------------+ | > User Location | Oc | The location of the UE, | | > Information | | e.g. ECGI | +----------------------------+----------+----------------------------+ | > Data Volume Transmitted | Oc | Amount of data transmitted | | | | by UE. | +----------------------------+----------+----------------------------+ | > Change Condition | Oc | ProSe specific reason for | | | | closing the container, | | | | e.g. change of Cell, go | | | | out of coverage, come back | | | | to coverage. | +----------------------------+----------+----------------------------+ | > VPLMN Identifier | Oc | Indentifier of PLMN which | | | | UE visits. | +----------------------------+----------+----------------------------+ | > Usage information report | Oc | The sequence number of | | > sequence number | | usage information report, | | | | which is used to generate | | | | the container. | +----------------------------+----------+----------------------------+ | > Radio Resources | Oc | This IE identifies whether | | > indicator | | the operator-provided | | | | radio resources or the | | | | configured radio resources | | | | were used for ProSe direct | | | | communication. | +----------------------------+----------+----------------------------+ | > Radio Frequency | Oc | This IE identifies the | | | | radio frequency used for | | | | ProSe direct | | | | communication. | +----------------------------+----------+----------------------------+ | Reception Data Container | Oc | This field holds the | | | | container associated to a | | | | trigger conditions (e.g. | | | | change of Cell, go out of | | | | coverage, come back to | | | | coverage, etc.) on a | | | | specific ProSe reception | | | | of group communication. | +----------------------------+----------+----------------------------+ | > Local Sequence Number | Oc | The sequence number of the | | | | Direct Communication data | | | | container, which is | | | | increased by 1 for each | | | | container closed | +----------------------------+----------+----------------------------+ | > Change Time | Oc | The time when the | | | | container is closed and | | | | reported due to ProSe | | | | charging condition change. | +----------------------------+----------+----------------------------+ | > Coverage status | Oc | Whether UE is served by | | | | E-UTRAN or not, i.e. in | | | | coverage, out of coverage. | +----------------------------+----------+----------------------------+ | > User Location | Oc | The location of the UE, | | > Information | | e.g. ECGI | +----------------------------+----------+----------------------------+ | > Data Volume Received | Oc | Amount of data received by | | | | UE. | +----------------------------+----------+----------------------------+ | > Change Condition | Oc | ProSe specific reason for | | | | closing the container, | | | | e.g. change of Cell, go | | | | out of coverage, come back | | | | to coverage. | +----------------------------+----------+----------------------------+ | > VPLMN Identifier | Oc | Indentifier of PLMN which | | | | UE visits. | +----------------------------+----------+----------------------------+ | > Usage information report | Oc | The sequence number of | | > sequence number | | usage information report, | | | | which is used to generate | | | | the container. | +----------------------------+----------+----------------------------+ | > Radio Resources | Oc | This IE identifies whether | | > indicator | | the operator-provided | | | | radio resources or the | | | | configured radio resources | | | | were used for ProSe direct | | | | communication. | +----------------------------+----------+----------------------------+ | > Radio Frequency | Oc | This IE identifies the | | | | radio frequency used for | | | | ProSe direct | | | | communication. | +----------------------------+----------+----------------------------+
### 6.3.2 Formal ProSe charging parameter description
#### 6.3.2.1 ProSe CDR parameters
The detailed definitions, abstract syntax and encoding of the ProSe CDR
parameters are specified in TS 32.298 [51].
#### 6.3.2.2 ProSe AVPs
The detailed definitions of ProSe AVPs are specified in TS 32.299 [50].
### 6.3.3 Detailed message format for offline charging
The following clause specifies per Operation Type the charging data that are
sent by ProSe Function for different functionality, i.e. Direct Discovery,
EPC_Level Discovery and Direct Communication.
The Operation Types are listed in the following order: S (Start)/I (Interim)/S
(Stop)/E (Event). Therefore, when all Operation Types are possible it is
marked as SISE. If only some Operation Types are allowed for a node, only the
appropriate letters are used (i.e. SIS or E) as indicated in the table
heading. The omission of an Operation Type for a particular field is marked
with \"-\" (i.e. SI-E). Also, when an entire field is not allowed in a node
the entire cell is marked as \"-\".
Table 6.3.3.1 illustrates the basic structure of the supported fields in the
_Charging Data_ Request message for ProSe offline charging.
Table 6.3.3.1: Supported fields in _Charging Data Request message_
+-------------+-------------+-------------+------------+-------------+ | Information | Service | Direct | EPC_Level | Direct | | Element | Type | Discovery | | | | | | | Discovery | Co | | | | | | mmunication | +-------------+-------------+-------------+------------+-------------+ | | Supported | S/I/S/E | S/I/S/E | S/I/S/E | | | Operation | | | | | | Types | | | | +-------------+-------------+-------------+------------+-------------+ | Session | ---E | SIS- | SISE | | | Identifier | | | | | +-------------+-------------+-------------+------------+-------------+ | Originator | ---E | SIS- | SISE | | | Host | | | | | +-------------+-------------+-------------+------------+-------------+ | Originator | ---E | SIS- | SISE | | | Domain | | | | | +-------------+-------------+-------------+------------+-------------+ | Destination | ---E | SIS- | SISE | | | Domain | | | | | +-------------+-------------+-------------+------------+-------------+ | Operation | ---E | SIS- | SISE | | | Type | | | | | +-------------+-------------+-------------+------------+-------------+ | Operation | ---E | SIS- | SISE | | | Number | | | | | +-------------+-------------+-------------+------------+-------------+ | Operation | ---E | SIS- | SISE | | | Identifier | | | | | +-------------+-------------+-------------+------------+-------------+ | User Name | ---E | SIS- | SISE | | +-------------+-------------+-------------+------------+-------------+ | Destination | ---E | SIS- | SISE | | | Host | | | | | +-------------+-------------+-------------+------------+-------------+ | Operation | ---E | SIS- | SISE | | | Interval | | | | | +-------------+-------------+-------------+------------+-------------+ | Origination | ---E | SIS- | SISE | | | State | | | | | +-------------+-------------+-------------+------------+-------------+ | Origination | ---E | SIS- | SISE | | | Timestamp | | | | | +-------------+-------------+-------------+------------+-------------+ | Proxy | ---E | SIS- | SISE | | | Information | | | | | +-------------+-------------+-------------+------------+-------------+ | Route | ---E | SIS- | SISE | | | Information | | | | | +-------------+-------------+-------------+------------+-------------+ | Operation | ---E | SIS- | SISE | | | Token | | | | | +-------------+-------------+-------------+------------+-------------+ | **Service | | | | | | Information | | | | | | with PS and | | | | | | ProSe | | | | | | In | | | | | | formation** | | | | | +-------------+-------------+-------------+------------+-------------+ | Subscriber | ---E | SIS- | SISE | | | Identifier | | | | | +-------------+-------------+-------------+------------+-------------+ | Node Id | ---E | SIS- | SISE | | +-------------+-------------+-------------+------------+-------------+ | Announcing | ---E | - | - | | | UE HPLMN | | | | | | Identifier | | | | | +-------------+-------------+-------------+------------+-------------+ | Announcing | ---E | - | - | | | UE VPLMN | | | | | | Identifier | | | | | +-------------+-------------+-------------+------------+-------------+ | Monitoring | ---E | - | - | | | UE HPLMN | | | | | | Identifier | | | | | +-------------+-------------+-------------+------------+-------------+ | Monitoring | ---E | - | - | | | UE VPLMN | | | | | | Identifier | | | | | +-------------+-------------+-------------+------------+-------------+ | Role of | ---E | - | - | | | ProSe | | | | | | Function | | | | | +-------------+-------------+-------------+------------+-------------+ | ProSe | ---E | - | - | | | Application | | | | | | ID | | | | | +-------------+-------------+-------------+------------+-------------+ | Application | ---E | SIS- | - | | | ID | | | | | +-------------+-------------+-------------+------------+-------------+ | Application | - | - | SISE | | | Specific | | | | | | Data | | | | | +-------------+-------------+-------------+------------+-------------+ | ProSe | ---E | SIS - | SISE | | | fu | | | | | | nctionality | | | | | +-------------+-------------+-------------+------------+-------------+ | ProSe Event | ---E | - | - | | | Type | | | | | +-------------+-------------+-------------+------------+-------------+ | Direct | ---E | - | - | | | Discovery | | | | | | Model | | | | | +-------------+-------------+-------------+------------+-------------+ | ProSe | ---E | SIS- | SISE | | | Function IP | | | | | | Address | | | | | +-------------+-------------+-------------+------------+-------------+ | ProSe | ---E | SIS- | SISE | | | Function ID | | | | | +-------------+-------------+-------------+------------+-------------+ | ProSe | ---E | SIS- | SISE | | | Function | | | | | | PLMN | | | | | | Identifier | | | | | +-------------+-------------+-------------+------------+-------------+ | Validity | ---E | - | - | | | Period | | | | | +-------------+-------------+-------------+------------+-------------+ | Role of UE | ---E | SIS- | - | | +-------------+-------------+-------------+------------+-------------+ | ProSe | ---E | SIS- | - | | | Request | | | | | | Timestamp | | | | | +-------------+-------------+-------------+------------+-------------+ | PC3 Control | ---E | - | - | | | Protocol | | | | | | Cause | | | | | +-------------+-------------+-------------+------------+-------------+ | Monitoring | ---E | - | - | | | UE | | | | | | Identifier | | | | | +-------------+-------------+-------------+------------+-------------+ | Monitored | ---E | - | - | | | PLMN | | | | | | Identifier | | | | | +-------------+-------------+-------------+------------+-------------+ | Requestor | - | SIS- | - | | | PLMN | | | | | | Identifier | | | | | +-------------+-------------+-------------+------------+-------------+ | Requestor | ---E | SIS- | - | | | Application | | | | | | Layer User | | | | | | ID | | | | | +-------------+-------------+-------------+------------+-------------+ | WLAN Link | ---E | SIS- | - | | | Layer ID | | | | | +-------------+-------------+-------------+------------+-------------+ | Requestor | ---E | SIS- | - | | | EPC ProSe | | | | | | User ID | | | | | +-------------+-------------+-------------+------------+-------------+ | Requested | ---E | SIS- | - | | | Application | | | | | | Layer User | | | | | | ID | | | | | +-------------+-------------+-------------+------------+-------------+ | Requested | ---E | SIS- | - | | | PLMN | | | | | | Identifier | | | | | +-------------+-------------+-------------+------------+-------------+ | Time Window | ---E | SI-- | - | | +-------------+-------------+-------------+------------+-------------+ | Range Class | ---E | SI-- | - | | +-------------+-------------+-------------+------------+-------------+ | User | ---E | SI-- | - | | | Location | | | | | | Info | | | | | +-------------+-------------+-------------+------------+-------------+ | Proximity | ---E | --S- | - | | | Alert | | | | | | Indication | | | | | +-------------+-------------+-------------+------------+-------------+ | Proximity | ---E | --S- | - | | | Alert | | | | | | Timestamp | | | | | +-------------+-------------+-------------+------------+-------------+ | Proximity | ---E | SIS- | - | | | C | | | | | | ancellation | | | | | | Timestamp | | | | | +-------------+-------------+-------------+------------+-------------+ | Reason for | ---E | SIS- | - | | | C | | | | | | ancellation | | | | | +-------------+-------------+-------------+------------+-------------+ | PC3 EPC | - | --S- | - | | | Control | | | | | | Protocol | | | | | | Cause | | | | | +-------------+-------------+-------------+------------+-------------+ | Charging | ---E | SIS- | SISE | | | Char | | | | | | acteristics | | | | | +-------------+-------------+-------------+------------+-------------+ | Charging | ---E | SIS- | SISE | | | Char | | | | | | acteristics | | | | | | Selection | | | | | | Mode | | | | | +-------------+-------------+-------------+------------+-------------+ | Change | - | SIS- | --SE | | | Condition | | | | | +-------------+-------------+-------------+------------+-------------+ | ProSe UE ID | - | - | SISE | | +-------------+-------------+-------------+------------+-------------+ | Source IP | - | - | SISE | | | address | | | | | +-------------+-------------+-------------+------------+-------------+ | ProSe | - | - | SISE | | | Layer-2 | | | | | | Group ID | | | | | +-------------+-------------+-------------+------------+-------------+ | ProSe Group | - | - | SISE | | | IP | | | | | | multicast | | | | | | address | | | | | +-------------+-------------+-------------+------------+-------------+ | Coverage | - | - | SISE | | | Info | | | | | +-------------+-------------+-------------+------------+-------------+ | Radio | - | - | SISE | | | Parameter | | | | | | Set Info | | | | | +-------------+-------------+-------------+------------+-------------+ | Reception | - | - | SISE | | | Data | | | | | | Container | | | | | +-------------+-------------+-------------+------------+-------------+ | Time of | - | - | SISE | | | First | | | | | | Reception | | | | | +-------------+-------------+-------------+------------+-------------+ | Time of | - | - | SISE | | | First | | | | | | T | | | | | | ransmission | | | | | +-------------+-------------+-------------+------------+-------------+ | T | - | - | SISE | | | ransmission | | | | | | Data | | | | | | Container | | | | | +-------------+-------------+-------------+------------+-------------+ | Transmitter | - | - | SISE | | | Info | | | | | +-------------+-------------+-------------+------------+-------------+
Table 6.3.3.2 illustrates the basic structure of the supported fields in the
_Charging Data_ Responsemessage for ProSe offline charging.
Table 6.3.3.2: Supported fields in _Charging Data_ Response message
+--------------+--------------+-----------+------------+--------------+ | Information | **Service | Direct | EPC_Level | Direct | | Element | Type** | | | | | | | Discovery | Discovery | C | | | | | | ommunication | +--------------+--------------+-----------+------------+--------------+ | | Supported | S/I/S/E | S/I/S/E | S/I/S/E | | | Operation | | | | | | Types | | | | +--------------+--------------+-----------+------------+--------------+ | Session | ---E | SIS- | SISE | | | Identifier | | | | | +--------------+--------------+-----------+------------+--------------+ | Operation | ---E | SIS- | SISE | | | Result | | | | | +--------------+--------------+-----------+------------+--------------+ | Originator | ---E | SIS- | SISE | | | Host | | | | | +--------------+--------------+-----------+------------+--------------+ | Originator | ---E | SIS- | SISE | | | Domain | | | | | +--------------+--------------+-----------+------------+--------------+ | Operation | ---E | SIS- | SISE | | | Type | | | | | +--------------+--------------+-----------+------------+--------------+ | Operation | ---E | SIS- | SISE | | | Number | | | | | +--------------+--------------+-----------+------------+--------------+ | Operation | ---E | SIS- | SISE | | | Identifier | | | | | +--------------+--------------+-----------+------------+--------------+ | Operation | ---E | SIS- | SISE | | | Interval | | | | | +--------------+--------------+-----------+------------+--------------+ | Error | ---E | SIS- | SISE | | | Reporting | | | | | | Host | | | | | +--------------+--------------+-----------+------------+--------------+ | Origination | ---E | SIS- | SISE | | | State | | | | | +--------------+--------------+-----------+------------+--------------+ | Origination | ---E | SIS- | SISE | | | Timestamp | | | | | +--------------+--------------+-----------+------------+--------------+ | Proxy | ---E | SIS- | SISE | | | Information | | | | | +--------------+--------------+-----------+------------+--------------+ | Route | ---E | SIS- | SISE | | | Information | | | | | +--------------+--------------+-----------+------------+--------------+
### 6.3.4 Detailed Message Format for online charging
The following table specifies per Operation type the charging data that are
sent ProSe Function network element for:
The Operation types are listed in the following order: I [initial]/U
[update]/T [terminate]/E [event]. Therefore, when all Operation types are
possible it is marked as IUTE. If only some Operation types are allowed for a
node, only the appropriate letters are used (i.e. IUT or E) as indicated in
the table heading. The omission of an Operation type for a particular field is
marked with \"-\" (i.e. IU-E). Also, when an entire filed is not allowed in a
node the entire cell is marked as \"-\".
Note that not for all structured fields the individual field members are
listed in the table. Detailed descriptions of the fields are provided in TS
32.299 [50].
Table 6.3.4.1 illustrates the basic structure of the supported fields in the
Debit / Reserve Units Request for ProSe online charging.
Table 6.3.4.1: Supported fields in _Debit / Reserve Units Request_ message
+--------------------+--------------------+-----------+------------+ | Information | Sevice Type | Direct | EPC_Level | | Element | | | | | | | Discovery | Discovery | +--------------------+--------------------+-----------+------------+ | | Supported | I/U/T/E | I/U/T/E | | | Operation Types | | | +--------------------+--------------------+-----------+------------+ | Session Identifier | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | Originator Host | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | Originator Domain | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | Destination Domain | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | Operation | IUTE | IUT- | | | Identifier | | | | +--------------------+--------------------+-----------+------------+ | Operation Token | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | Operation Type | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | Operation Number | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | Destination Host | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | User Name | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | Origination State | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | Origination | IUTE | IUT- | | | Timestamp | | | | +--------------------+--------------------+-----------+------------+ | Subscriber | IUTE | IUT- | | | Identifier | | | | +--------------------+--------------------+-----------+------------+ | Termination Cause | --TE | --T- | | +--------------------+--------------------+-----------+------------+ | Requested Action | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | Multiple Operation | IU-E | IU-- | | +--------------------+--------------------+-----------+------------+ | Multiple Unit | IUTE | IUT- | | | Operation | | | | +--------------------+--------------------+-----------+------------+ | Operation | IUTE | IUT- | | | Correlation | | | | | Identifier | | | | +--------------------+--------------------+-----------+------------+ | Subscriber | IUTE | IUT- | | | Equipment Number | | | | +--------------------+--------------------+-----------+------------+ | Proxy Information | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | Route Information | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | Service | IUTE | IUT- | | | Information | | | | +--------------------+--------------------+-----------+------------+ | **Service | | | | | Information with | | | | | PS and ProSe | | | | | Information** | | | | +--------------------+--------------------+-----------+------------+ | Subscriber | - | - | | | Identifier | | | | +--------------------+--------------------+-----------+------------+ | Node Id | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | Announcing UE | IUTE | - | | | HPLMN Identifier | | | | +--------------------+--------------------+-----------+------------+ | Announcing UE | IUTE | - | | | VPLMN Identifier | | | | +--------------------+--------------------+-----------+------------+ | Monitoring UE | IUTE | - | | | HPLMN Identifier | | | | +--------------------+--------------------+-----------+------------+ | Monitoring UE | IUTE | - | | | VPLMN Identifier | | | | +--------------------+--------------------+-----------+------------+ | Role of ProSe | IUTE | - | | | Function | | | | +--------------------+--------------------+-----------+------------+ | ProSe Application | IUTE | | | | ID | | | | +--------------------+--------------------+-----------+------------+ | Application ID | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | ProSe | IUTE | - | | | functionality | | | | +--------------------+--------------------+-----------+------------+ | ProSe Event Type | IUTE | - | | +--------------------+--------------------+-----------+------------+ | Direct Discovery | IUTE | - | | | Model | | | | +--------------------+--------------------+-----------+------------+ | ProSe Function IP | IUTE | IUT- | | | Address | | | | +--------------------+--------------------+-----------+------------+ | ProSe Function ID | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | Validity Period | IUTE | - | | +--------------------+--------------------+-----------+------------+ | Role of UE | | IUT- | | +--------------------+--------------------+-----------+------------+ | ProSe Request | IUTE | IUT- | | | Timestamp | | | | +--------------------+--------------------+-----------+------------+ | PC3 Control | --TE | - | | | Protocol Cause | | | | +--------------------+--------------------+-----------+------------+ | Monitoring UE | IUTE | IUT- | | | Identifier | | | | +--------------------+--------------------+-----------+------------+ | Monitored PLMN | IUTE | - | | | Identifier | | | | +--------------------+--------------------+-----------+------------+ | Requestor PLMN | - | IUT- | | | Identifier | | | | +--------------------+--------------------+-----------+------------+ | Requestor | - | IUT- | | | Application Layer | | | | | User ID | | | | +--------------------+--------------------+-----------+------------+ | WLAN Link Layer ID | - | IUT- | | +--------------------+--------------------+-----------+------------+ | Requestor EPC | - | IUT- | | | ProSe User ID | | | | +--------------------+--------------------+-----------+------------+ | Requested | - | IUT- | | | Application Layer | | | | | User ID | | | | +--------------------+--------------------+-----------+------------+ | Requested PLMN | - | IUT- | | | Identifier | | | | +--------------------+--------------------+-----------+------------+ | Time Window | - | IU-- | | +--------------------+--------------------+-----------+------------+ | Range Class | - | IU-- | | +--------------------+--------------------+-----------+------------+ | User Location Info | - | IU-- | | +--------------------+--------------------+-----------+------------+ | Proximity Alert | - | --T- | | | Indication | | | | +--------------------+--------------------+-----------+------------+ | Proximity Alert | - | --T- | | | Timestamp | | | | +--------------------+--------------------+-----------+------------+ | Proximity | - | --T- | | | Cancellation | | | | | Timestamp | | | | +--------------------+--------------------+-----------+------------+ | Reason for | - | --T- | | | Cancellation | | | | +--------------------+--------------------+-----------+------------+ | PC3 EPC Control | - | --T- | | | Protocol Cause | | | | +--------------------+--------------------+-----------+------------+ | Charging | IUTE | IUT- | | | characteristics | | | | +--------------------+--------------------+-----------+------------+ | Charging | IUTE | IUT- | | | Characteristics | | | | | Selection Mode | | | | +--------------------+--------------------+-----------+------------+ | Change Condition | - | - | | +--------------------+--------------------+-----------+------------+ | ProSe UE ID | - | - | | +--------------------+--------------------+-----------+------------+ | Source IP address | - | - | | +--------------------+--------------------+-----------+------------+ | ProSe Layer-2 | - | - | | | Group ID | | | | +--------------------+--------------------+-----------+------------+ | ProSe Group IP | - | - | | | multicast address | | | | +--------------------+--------------------+-----------+------------+ | Application | - | - | | | Specific Data | | | | +--------------------+--------------------+-----------+------------+ | Coverage Info | - | - | | +--------------------+--------------------+-----------+------------+ | ProSe Function | - | - | | | PLMN Identifier | | | | +--------------------+--------------------+-----------+------------+ | Radio Parameter | - | - | | | Set Info | | | | +--------------------+--------------------+-----------+------------+ | Reception Data | - | - | | | Container | | | | +--------------------+--------------------+-----------+------------+ | Time of First | - | - | | | Reception | | | | +--------------------+--------------------+-----------+------------+ | Time of First | - | - | | | Transmission | | | | +--------------------+--------------------+-----------+------------+ | Transmission Data | - | - | | | Container | | | | +--------------------+--------------------+-----------+------------+ | Transmitter Info | - | - | | +--------------------+--------------------+-----------+------------+
Table 6.3.4.2 illustrates the basic structure of the supported fields in the
Debit / Reserve Units Response for ProSe online charging.
Table 6.3.4.2: Supported fields in _Debit / Reserve Units Response_ Message
+--------------------+--------------------+-----------+------------+ | Information | Sevice Type | Direct | EPC_Level | | Element | | | | | | | Discovery | Discovery | +--------------------+--------------------+-----------+------------+ | | Supported | I/U/T/E | I/U/T/E | | | Operation Types | | | +--------------------+--------------------+-----------+------------+ | Session Identifier | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | Operation Result | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | Originator Host | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | Originator Domain | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | Operation | IUTE | IUT- | | | Identifier | | | | +--------------------+--------------------+-----------+------------+ | Operation Type | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | Operation Number | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | Operation Failover | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | Multiple Unit | IUTE | IUT- | | | Operation | | | | +--------------------+--------------------+-----------+------------+ | Cost Information | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | Low Balance | IUTE | IUT- | | | Indication | | | | +--------------------+--------------------+-----------+------------+ | Remaining Balance | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | Operation Failure | IUTE | IUT- | | | Action | | | | +--------------------+--------------------+-----------+------------+ | Operation Event | IUTE | IUT- | | | Failure Action | | | | +--------------------+--------------------+-----------+------------+ | Redirection Host | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | Redirection Host | IUTE | IUT- | | | Usage | | | | +--------------------+--------------------+-----------+------------+ | Redirection Cache | IUTE | IUT- | | | Time | | | | +--------------------+--------------------+-----------+------------+ | Proxy Information | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | Route Information | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | Failed parameter | IUTE | IUT- | | +--------------------+--------------------+-----------+------------+ | Service | IUTE | IUT- | | | Information | | | | +--------------------+--------------------+-----------+------------+
## 6.4 Bindings for ProSe offline charging
This clause aims to describe the mapping between the Diameter Accounting AVPs,
IEs and CDR parameters for ProSe offline charging.
Table 6.4.1 describes the mapping of the Diameter Accounting AVPs, IEs, and
CDR parameters of PF-DD-CDR, PF-ED-CDR and PF-DC-CDR in ProSe offline
charging.
Table 6.4.1: Bindings of CDR Parameters, Information Elements and AVPs
+----------------------+----------------------+----------------------+ | CDR Parameter | Information Element | AVP | +----------------------+----------------------+----------------------+ | | **Service |** S | | | Information**| ervice-Information** | +----------------------+----------------------+----------------------+ | Served IMSI | Subscriber | Subscription-Id | | | Identifier | | +----------------------+----------------------+----------------------+ | | **ProSe | * | | | Information** | _ProSe-Information_ _| +----------------------+----------------------+----------------------+ | Announcing UE HPLMN | Announcing UE HPLMN | Announcing | | Identifier | Identifier | -UE-HPLMN-Identifier | +----------------------+----------------------+----------------------+ | Announcing UE VPLMN | Announcing UE VPLMN | Announcing | | Identifier | Identifier | -UE-VPLMN-Identifier | +----------------------+----------------------+----------------------+ | Application ID | Application ID | ProSe-3rd- | | | | Party-Application-ID | +----------------------+----------------------+----------------------+ | Application Specific | Application Specific | Appli | | Data | Data | cation-Specific-Data | +----------------------+----------------------+----------------------+ | Coverage Info | Coverage Info | Coverage-Info | +----------------------+----------------------+----------------------+ | Direct Discovery | Direct Discovery | ProSe-Di | | Model | Model | rect-Discovery-Model | +----------------------+----------------------+----------------------+ | Monitoring UE | Monitoring UE | Moni | | Identifier | Identifier | toring-UE-Identifier | +----------------------+----------------------+----------------------+ | Monitoring UE HPLMN | Monitoring UE HPLMN | Monitoring | | Identifier | Identifier | -UE-HPLMN-Identifier | +----------------------+----------------------+----------------------+ | Monitoring UE VPLMN | Monitoring UE VPLMN | Monitoring | | Identifier | Identifier | -UE-VPLMN-Identifier | +----------------------+----------------------+----------------------+ | Monitored PLMN | Monitored PLMN | Monit | | Identifier | Identifier | ored-PLMN-Identifier | +----------------------+----------------------+----------------------+ | PC3 Control Protocol | PC3 Control Protocol | PC3-Co | | Cause | Cause | ntrol-Protocol-Cause | +----------------------+----------------------+----------------------+ | PC3 EPC Control | PC3 EPC Control | PC3-EPC-Co | | Protocol Cause | Protocol Cause | ntrol-Protocol-Cause | +----------------------+----------------------+----------------------+ | ProSe Application ID | ProSe Application ID | ProSe-App-Id | +----------------------+----------------------+----------------------+ | ProSe Event Type | ProSe Event Type | ProSe-Event-Type | +----------------------+----------------------+----------------------+ | ProSe Function ID | ProSe Function ID | ProSe-Function-ID | +----------------------+----------------------+----------------------+ | ProSe Function IP | ProSe Function IP | ProSe | | Address | Address | -Function-IP-Address | +----------------------+----------------------+----------------------+ | ProSe Function PLMN | ProSe Function PLMN | ProSe-Func | | Identifier | Identifier | tion-PLMN-Identifier | +----------------------+----------------------+----------------------+ | Record Type | ProSe Functionality | Prose-Functionality | +----------------------+----------------------+----------------------+ | ProSe Group IP | ProSe Group IP | ProSe-Group- | | multicast address | multicast address | IP-multicast-address | +----------------------+----------------------+----------------------+ | ProSe Layer-2 Group | ProSe Layer-2 Group | Layer-2-Group-ID | | ID | ID | | +----------------------+----------------------+----------------------+ | ProSe Request | ProSe Request | Pro | | Timestamp | Timestamp | Se-Request-Timestamp | +----------------------+----------------------+----------------------+ | ProSe UE ID | ProSe UE ID | ProSe-UE-ID | +----------------------+----------------------+----------------------+ | Proximity Alert | Proximity Alert | Proxim | | Indication | Indication | ity-Alert-Indication | +----------------------+----------------------+----------------------+ | Proximity Alert | Proximity Alert | Proxi | | Timestamp | Timestamp | mity-Alert-Timestamp | +----------------------+----------------------+----------------------+ | Proximity | Proximity | Proximity-Ca | | Cancellation | Cancellation | ncellation-Timestamp | | Timestamp | Timestamp | | +----------------------+----------------------+----------------------+ | Proximity Request | Proximity Request | - | | Renewal Info Block | Renewal Info Block | | | List | List | | +----------------------+----------------------+----------------------+ | > ProSe Request | > ProSe Request | Pro | | > Timestamp | > Timestamp | Se-Request-Timestamp | +----------------------+----------------------+----------------------+ | > Range Class | > Range Class | ProSe-Range-Class | +----------------------+----------------------+----------------------+ | > Time Window | > Time Window | Time-Window | +----------------------+----------------------+----------------------+ | > UE Location | > User Location Info | 3GP | | | | P-User-Location-Info | +----------------------+----------------------+----------------------+ | Radio Parameter Set | Radio Parameter Set | Radi | | Info | Info | o-Parameter-Set-Info | +----------------------+----------------------+----------------------+ | Range Class | Range Class | ProSe-Range-Class | +----------------------+----------------------+----------------------+ | Reason for | Reason for | ProSe-Rea | | Cancellation | Cancellation | son-for-Cancellation | +----------------------+----------------------+----------------------+ | Reception Data | Reception Data | ProSe-Direc | | Container | Container | t-Communication-Rece | | | | ption-Data-Container | +----------------------+----------------------+----------------------+ | > Change Time | > Change Time | > Change-Time | +----------------------+----------------------+----------------------+ | > Coverage status | > Coverage status | > Coverage-status | +----------------------+----------------------+----------------------+ | > Data Volume | > Data Volume | > Acc | | > Received | > Transmitted | ounting-Input-Octets | +----------------------+----------------------+----------------------+ | > Local Sequence | > Local Sequence | > L | | > Number | > Number | ocal-Sequence-Number | +----------------------+----------------------+----------------------+ | > Change Condition | > Change Condition | > Change-Condition | +----------------------+----------------------+----------------------+ | > Usage information | > Usage information | > Usage-informat | | > report sequence | > report sequence | ion-report-sequence- | | > number | > number | > number | +----------------------+----------------------+----------------------+ | > UE Location | > User Location Info | > 3GP | | | | P-User-Location-Info | +----------------------+----------------------+----------------------+ | > VPLMN Identifier | > VPLMN Identifier | > Visited-PLMN-Id | +----------------------+----------------------+----------------------+ | > Radio Resources | > Radio Resources | > Radio | | > Indicator | > Indicator | -Resources-Indicator | +----------------------+----------------------+----------------------+ | > Radio Frequency | > Radio Frequency | > Radio-Frequency | +----------------------+----------------------+----------------------+ | Requested | Requested | Targ | | Application Layer | Application Layer | et-App-Layer-User-Id | | User ID | User ID | | +----------------------+----------------------+----------------------+ | Requested PLMN | Requested PLMN | Reque | | Identifier | Identifier | sted-PLMN-Identifier | +----------------------+----------------------+----------------------+ | Requestor | Requestor | Orig | | Application Layer | Application Layer | in-App-Layer-User-Id | | User ID | User ID | | +----------------------+----------------------+----------------------+ | Requestor EPC ProSe | Requestor EPC ProSe | Requesting-EPUID | | User ID | User ID | | +----------------------+----------------------+----------------------+ | Requestor PLMN | Requestor PLMN | Reque | | Identifier | Identifier | stor-PLMN-Identifier | +----------------------+----------------------+----------------------+ | Role of ProSe | Role of ProSe | Ro | | Function | Function | le-Of-ProSe-Function | +----------------------+----------------------+----------------------+ | Role of UE | Role of UE | ProSe-Role-Of-UE | +----------------------+----------------------+----------------------+ | Source IP address | Source IP address | Pro | | | | Se-Source-IP-Address | +----------------------+----------------------+----------------------+ | Time of First | Time of First | Tim | | Transmission | Transmission | e-First-Transmission | +----------------------+----------------------+----------------------+ | Time of First | Time of First | Time-First-Reception | | Reception | Reception | | +----------------------+----------------------+----------------------+ | Time Window | Time Window | Time-Window | +----------------------+----------------------+----------------------+ | Transmission Data | Transmission Data | ProSe-Direct-C | | Container | Container | ommunication-Transmi | | | | ssion-Data-Container | +----------------------+----------------------+----------------------+ | > Change Time | > Change Time | > Change-Time | +----------------------+----------------------+----------------------+ | > Coverage status | > Coverage status | > Coverage-status | +----------------------+----------------------+----------------------+ | > Data Volume | > Data Volume | > Acco | | > Transmitted | > Transmitted | unting-Output-Octets | +----------------------+----------------------+----------------------+ | > Local Sequence | > Local Sequence | > L | | > Number | > Number | ocal-Sequence-Number | +----------------------+----------------------+----------------------+ | > Change Condition | > Change Condition | > Change-Condition | +----------------------+----------------------+----------------------+ | > Usage information | > Usage information | > Usage-informat | | > report sequence | > report sequence | ion-report-sequence- | | > number | > number | > number | +----------------------+----------------------+----------------------+ | > UE Location | > User Location Info | > 3GP | | | | P-User-Location-Info | +----------------------+----------------------+----------------------+ | > VPLMN Identifier | > VPLMN Identifier | > Visited-PLMN-Id | +----------------------+----------------------+----------------------+ | > Radio Resources | > Radio Resources | > Radio | | > Indicator | > Indicator | -Resources-Indicator | +----------------------+----------------------+----------------------+ | > Radio Frequency | > Radio Frequency | > Radio-Frequency | +----------------------+----------------------+----------------------+ | Transmitter Info | Transmitter Info | Pro | | | | Se-Direct-Communicat | | | | ion-Transmitter-Info | +----------------------+----------------------+----------------------+ | Validity Period | Validity Period | ProSe-Validity-Timer | +----------------------+----------------------+----------------------+ | WLAN Link Layer ID | WLAN Link Layer ID | WLAN-Link-Layer-Id | +----------------------+----------------------+----------------------+ | | __PS Information_ _|__PS-Information_ * | +----------------------+----------------------+----------------------+ | Cause for Record | Change Condition | Change-Condition | | Closing | | | +----------------------+----------------------+----------------------+ | Charging | Charging | 3GPP-Char | | characteristics | characteristics | ging-Characteristics | +----------------------+----------------------+----------------------+ | Charging | Charging | Charging-Characteri | | Characteristics | Characteristics | stics-Selection-Mode | | Selection Mode | Selection Mode | | +----------------------+----------------------+----------------------+ | Node Id | Node Id | Node-ID | +----------------------+----------------------+----------------------+ | UE Location | User Location Info | 3GP | | | | P-User-Location-Info | +----------------------+----------------------+----------------------+
###### ## Annex A (normative): Charging Characteristics
# A.1 General
Charging Characteristics can be supplied by the HSS to the HPLMN ProSe
Function of a UE as part of the subscription information. The VPLMN ProSe
Function or Local PLMN ProSe Function does not need the Charging
Characteristics, as they only support offline charging for the UE.
Refer to TS 32.251 [11] Annex A for charging characteristic examples.
The ProSe Function applies a pre-configured default if no Charging
Characteristics are supplied by the HSS. The ProSe Function shall support the
following Charging Characteristics default configurations:
\- the home default behaviour for subscribers of the ProSe Function\'s PLMN,
and uses ProSe in the HPLMN;
\- the roaming default behaviour for subscribers of the ProSe Function\'s
PLMN, but uses ProSe in a different PLMN.
It is possible that different parameters are configured for different ProSe
services.
#
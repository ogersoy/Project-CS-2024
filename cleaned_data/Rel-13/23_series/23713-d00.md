# Foreword
This Technical Report has been produced by the 3^rd^ Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The scope of this Technical Report is to study and evaluate the possible
architecture enhancements to the Proximity-based Services (ProSe) system
defined in TS 23.303 [3], based on the relevant Stage 1 requirements defined
in TS 22.278 [4] and TS 22.115 [5].
The present Technical Report documents the analysis and general principles
agreed regarding these objectives, and collects the solution details developed
based on these agreements, in order to progress them to the relevant
specifications.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] Void.
[3] 3GPP TS 23.303: \"Proximity-based Services (ProSe); Stage 2\".
[4] 3GPP TS 22.278: \"Service requirements for the Evolved Packet System
(EPS)\".
[5] 3GPP TS 22.115: \"Service aspects; Charging and billing\".
[6] IETF RFC 4862: \"IPv6 Stateless Address Autoconfiguration\".
[7] 3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for
Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".
[8] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[9] 3GPP TS 23.221: \"Architectural requirements\".
[10] IETF RFC 4039: \"Rapid Commit Option for the Dynamic Host Configuration
Protocol version 4 (DHCPv4)\".
[11] 3GPP TS 33.303: \"Proximity-based Services (ProSe); Security aspects\".
[12] IETF RFC 4605: \" Internet Group Management Protocol (IGMP) / Multicast
Listener Discovery (MLD)-Based Multicast Forwarding (\"IGMP/MLD Proxying\")\".
[13] IETF RFC 5135: \" IP Multicast Requirements for a Network Address
Translator (NAT) and a Network Address Port Translator (NAPT)\".
[14] 3GPP TS 36.331: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Radio Resource Control (RRC); Protocol specification\".
[15] 3GPP TS 23.468: \"Group Communication System Enablers for LTE (GCSE_LTE);
Stage 2\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] apply.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply.\ An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
ProSe Proximity-based Services
# 4 Assumptions and Architectural Requirements
## 4.1 Assumptions
Editor\'s note: This clause will define the underlying assumptions of the
work.
## 4.2 Architectural Requirements
Editor\'s note: This clause will define the architectural requirements based
on the normative Stage 1 requirements defined in TS 22.278 [4] and TS 22.115
[5].
# 5 Restricted ProSe Direct Discovery (non-public safety use)
Editor\'s note: This clause is intended to document the agreed architecture
solution for restricted discovery (non-public safety use).
## 5.1 Solution for restricted ProSe Direct Discovery
### 5.1.1 Functional Description
Editor\'s note: General description, assumptions, and principles of the
solution.
TS 22.278 [4] specified the requirements for the Restricted ProSe Discovery as
\"Subject to user and operator settings, a ProSe-enabled UE shall be able to
be discoverable only by other ProSe-enabled UEs in proximity that are
explicitly permitted by the discoverable ProSe-enabled UE.
The solution for Restricted ProSe Direct Discovery follows the following
principles:
\- The Restricted ProSe Direct Discovery allows permission defined at
application layer by Announcing/Discoveree UE to determine the capability of
the Monitoring/Discoverer UE to discover the Announcing/Discoveree UE.
\- The Restricted ProSe Direct Discovery solution should be developed based on
existing ProSe architecture in TS 23.303 [3].
\- In the Service authorization procedure, if there is no associated UE
context the ProSe Function shall create a new UE context, which stores the
assigned ProSe Discovery UE ID and the associated validity timer.
> \- If the ProSe function needs to update the ProSe Discovery UE ID before
> the validity timer expires, the ProSe function uses the ProSe Service
> Notification message defined in clause 5.2.2 of TS 23.303 [3]. UE sends the
> updated ProSe Discovery UE ID to the ProSe Application Server via PC1
> interface.
\- The permission information for the Restricted Direct Discovery is
maintained by the ProSe Application Server.
\- The application layer user identity is concealed from 3GPP network by ProSe
Application Server obfuscating the user identities. The mapping of the
obfuscated user identity (Restricted ProSe App User ID) and actual application
layer identity is maintained by the ProSe Application Server.
\- The 3GPP layer identity of the UE is concealed from application layer by
ProSe Function creating a ProSe Discovery UE Identity. The mapping of the
ProSe Discovery UE ID and the 3GPP layer UE ID is maintained by the ProSe
Function.
\- The binding of Restricted ProSe App User ID and ProSe Discovery UE ID is
maintained by the ProSe Application Server, via a mechanism out of scope of
3GPP. This binding information is exchanged over reference point PC2.
\- It is up to the policy in the ProSe Function whether to allocate the same
ProSe Code for all Restricted ProSe App User IDs or different ProSe Codes for
different Restricted ProSe App User IDs.
\- The Restricted ProSe Direct Discovery solution shall allow for part of the
ProSe Code to be reserved for the ProSe application and it may allow for a
number of mobile services, e.g. group discovery, dating, advertising, etc. The
use of this part of the ProSe Code is out of scope of 3GPP.
\- The Restricted ProSe Direct Discovery solution shall allow partial matching
of a ProSe Code. For this purpose, the Restricted ProSe Application User ID
may be configured by the application in a tiered format. The ProSe Function
generates the ProSe Code corresponding to the tiered format of the Restricted
ProSe Application User ID.
\- The metadata is associated with a Restricted ProSe App User ID and
Application ID, and contains service-layer information that is outside the
scope of 3GPP. The announcing UE first uploads the metadata to the
corresponding ProSe Application Server. The ProSe Function may obtain the
metadata associated with a given Restricted ProSe Application ID from the
ProSe Application Server as triggered by a Match Report procedure.
\- The Announce Request procedure defined for Open Direct Discovery can be
reused for Restricted Direct Discovery. The extensions required are:
\- the indication of the Restricted Discovery type;
\- the addition of the verification of the ownership of the requested
Restricted ProSe App User ID, using information provided over PC2 reference
point.
\- The Monitor Request procedure defined for Open Direct Discovery can be
reused for Restricted Direct Discovery. The extension required are:
\- the indication of the Restricted Discovery type;
\- the inclusion of the Restricted ProSe App User ID of monitoring UE and of
an Application Transparent Container that contains the Target Restricted ProSe
App User IDs indicating what the UE is interested to monitor;
\- the verification of the permission to monitor a given Target Restricted
ProSe App User ID, using information provided over PC2 reference point.
\- The ProSe Function can configure the UE whether the Match Report procedure
is required.
\- The Match Report procedure defined for Open Direct Discovery can be reused
for Restricted Direct Discovery. The extensions required are:
\- the indication of the Restricted Discovery type, and the inclusion of the
Restricted ProSe App User ID of monitoring UE;
\- the optional verification step of the permission to discover a given Target
Restricted ProSe App User ID, using information provided over PC2 reference
point.
\- For Restricted ProSe Direct Discovery of a given UE, the UE may wait for a
trigger from the network before starting to announce a ProSe Code. The network
shall be able to trigger a UE when to start announcing.
### 5.1.2 Procedures
Editor\'s note: Describes the high-level operation, procedures and information
flows for the solution.
#### 5.1.2.1 Identifier definitions for Restricted Direct Discovery
For the Restricted Direct Discovery, the following new identifiers are defined
in addition to those defined in TS 23.303 [3]:
**Application Level Container** : An application layer package opaque to the
3GPP networks.
**ProSe Code** : ProSe Code is allocated by the ProSe Function in the HPLMN
for Restricted Direct Discovery and is associated with one or more Restricted
ProSe App User IDs based on the policy of the ProSe Function that allocates
it. The ProSe Code is sent by the announcing UE over the air.
**ProSe Discovery UE ID** : A temporary identifier assigned by the ProSe
Function in the HPLMN to the UE for the restricted direct discovery service.
It includes the PLMN ID and a temporary identifier that uniquely identifies
the UE in the HPLMN.
**Restricted ProSe App User ID** : An identifier associated with the
Application Layer User ID in the ProSe Application Server in order to
hide/protect the application level user identity from the 3GPP layer. It
unambiguously identifies the user within a given application. The format of
this identifier is outside the scope of 3GPP.
Editor\'s note: The naming of the new identifiers and their relationship with
the existing identifiers will be reviewed when merging into TS 23.303 [3].
#### 5.1.2.2 General
The ProSe Protocol layer in the UE gets the ProSe Discovery UE ID during the
procedure of service authorisation for ProSe Direct Discovery, from the ProSe
Function of the HPLMN. The ProSe Discovery UE ID is stored in the ProSe
Function as part of the service authorization information, and is associated
with a validity timer.
NOTE: The signalling flows shown in the following clauses do not preclude any
further enhancement, e.g. on demand announcement.
#### 5.1.2.3 Restricted Direct Discovery Announce Request procedure
The operations for the announcing UE when roaming are presented in Figure
5.1.2.3.1 (changes from Open ProSe Discovery are highlighted in red). For the
non-roaming case, steps 4 and 5 are omitted.
Figure 5.1.2.3.1: Announce Request operation for Restricted Direct Discovery
(roaming)
0\. The user sets the permission for the restricted discovery using
application layer mechanism. In addition, the application client in the UE
retrieves the ProSe Discovery UE ID and provides it to the ProSe Application
Server. The ProSe Application Server allocates a Restricted ProSe App User ID
for that ProSe Discovery UE ID, stores the binding between the ProSe Discovery
UE ID and the Restricted ProSe App User ID and returns the Restricted ProSe
App User ID to the application client in the UE. The UE may optionally provide
metadata to be associated with the RPAUID, and the ProSe Application Server
stores the metadata. The application client in the UE stores the binding
between the ProSe Discovery UE ID and its own Restricted ProSe App User ID. If
the application client in the UE intends to use the ProSe service, it triggers
the UE to perform the announce procedure, providing its own Restricted ProSe
App User ID obtained by the ProSe Application Server.
NOTE 1: The procedures in step 0 are out of scope of 3GPP. However, it is
expected that the application client in the UE will be able to retrieve the
ProSe Discovery UE ID from the underlying ProSe Protocol layer.
1\. If the UE is authorized to announce in the serving PLMN and is triggered
by the application client to announce, it shall establish a secure connection
with the ProSe Function in HPLMN and send a Discovery Request message
(Restricted ProSe App User ID, UE Identity, command=announce, Discovery Type,
Application ID, Discovery Entry ID) for announcing. The Restricted ProSe App
User ID indicating what the UE is interested to announce was obtained in step
0. The UE Identity is set to IMSI. The Application ID represents a unique
identifier of the UE application that has triggered the transmission of the
Discovery Request message. The Discovery Type is set to \"restricted
discovery\".
2\. The ProSe Function checks for the authorization of the application
represented by the Application ID. If there is no associated UE context, the
ProSe Function shall check with HSS the authorisation for discovery and, if
necessary, create a new context for this UE that contains the subscription
parameters for this UE for the duration of the validity timer. The
authorisation information also contains the PLMNs that this UE is allowed to
perform discovery on. The HSS provides the MSISDN of the UE. The HSS also
provides the serving PLMN ID of where the UE is registered. If the UE does not
issue a new announce request within the duration of the validity timer the
ProSe Function shall remove the entry related to the requested Restricted
ProSe App User ID from the UE context.
2.a Optionally, the ProSe Function sends an Auth Request (Restricted ProSe App
User ID, indicator) to the ProSe Application Server. The ProSe Function
locates the ProSe Application Server based on the Application ID. The
indicator is set to \"restricted discovery/announce\".
2.b The ProSe Application Server returns an Auth Response (ProSe Discovery UE
ID, indicator) message. The ProSe Discovery UE ID corresponds to the
Restricted ProSe App User ID stored in the ProSe Application Server. The
indicator is set to \"restricted discovery/announce ack\".
The ProSe Function verifies that the received ProSe Discovery UE ID belongs to
the requesting UE.
NOTE 2: Whether steps 2.a and 2.b are executed depends on ProSe Function
configuration, or policy regarding the specific Application Server. For
example, if the ProSe Function can already verify the ownership locally, it
does not have to perform the two steps.
3\. The ProSe Function in HPLMN allocates a ProSe Code and the associated
validity timer. The ProSe Code corresponds to the Restricted ProSe App User ID
that was contained in the Discovery Request from the UE. The validity timer
shall indicate for how long this ProSe Code is going to be valid. The UE will
be authorised to announce this ProSe Code for the duration of validity timer
and if it remains in the same PLMN. The ProSe Function stores the Restricted
ProSe App User ID, the ProSe Code and the associated validity timer in the
user context.
NOTE 3: It is up to the policy in the ProSe Function whether to allocate the
same ProSe Code for all Restricted ProSe App User IDs or different ProSe Codes
for the different Restricted ProSe App User IDs.
Step 4 and 5 are executed only when the UE is roaming.
4\. If the Discovery Request is authorized and verified, the HPLMN ProSe
Function shall inform the ProSe Function in VPLMN with the Announce
Authorization (Restricted ProSe App User ID, Application ID, validity timer,
ProSe Code, UE Identity) message. The Restricted ProSe App User ID and
Application ID correspond to the request from the UE, whereas the ProSe Code
indicates the assigned code for this request. The request shall include the UE
identity information e.g. IMSI or MSISDN and validity timer in order to allow
the ProSe Function in VPLMN to perform charging. The validity timer indicates
for how long this ProSe Code is going to be valid.
5\. The ProSe Function in VPLMN authorizes the UE to perform Restricted ProSe
Discovery announcing.
6\. The ProSe Function in HPLMN responds to the UE with a Discovery Response
(ProSe Code, validity timer, Discovery Entry ID) message.
NOTE 4: The announcing UE may receive the same ProSe Code in different
Announce Request procedures.
Editor\'s note: The security details of this procedure will be studied in 3GPP
SA WG3. It is expected that the Discovery Response message may contain also
security material.
7\. The UE may start announcing the provided ProSe Code in the serving PLMN,
using the radio resources authorised and configured by E-UTRAN to be used for
ProSe as defined in RAN specifications.
NOTE 5: The ProSe Protocol layer in the UE may inform the application client
that it has started announcing. This is out of scope of 3GPP.
#### 5.1.2.4 Restricted Direct Discovery Monitor Request procedure
In Figure 5.1.2.4.1, an operation example for the Monitor Report procedure is
presented for the roaming case, but the same steps also apply for the non-
roaming case (changes from Open ProSe Discovery are highlighted in red).
Figure 5.1.2.4.1: Monitor Request operation for Restricted Direct Discovery
(roaming)
0\. In this step, the application client in the UE retrieves its own ProSe
Discovery UE ID and provides it to the ProSe Application Server. The ProSe
Application Server allocates a Restricted ProSe App User ID for that ProSe
Discovery UE ID, stores the binding between the ProSe Discovery UE ID and the
Restricted ProSe App User ID and returns the Restricted ProSe App User ID to
the application client in the UE. The application client in the UE stores the
binding between the ProSe Discovery UE ID and its own Restricted ProSe App
User ID.
When the application client in the UE intends to discover the announcing UE of
other users (e.g. friends in the application), it obtains the Restricted ProSe
App User ID of those users (Target Restricted ProSe App User IDs) from the
ProSe App Server and triggers the UE to perform the monitor procedure,
providing its own Restricted ProSe App User ID and the Target Restricted ProSe
App User IDs. The Target Restricted ProSe App User IDs of the UEs to be
monitored are passed in an Application Level Container.
NOTE 1: The procedures in step 0 are out of scope of 3GPP. However, it is
expected that the application client in the UE will be able to retrieve the
ProSe Discovery UE ID from the underlying ProSe Protocol layer.
1\. If the UE is authorised to monitor in at least one PLMN and is triggered
by the application client to monitor, it shall establish a secure connection
with the ProSe Function in HPLMN and it shall send a Discovery Request message
to get the Discovery Filter for monitoring (Restricted ProSe App User ID, UE
Identity, command=monitor, Discovery Type, Application ID, Application Level
Container, Discovery Entry ID). The Application Level Container contains the
Target Restricted ProSe App User IDs indicating what the UE is interested to
monitor. The Restricted ProSe App User ID indicates the identity the UE uses
to obtain the permission to monitor. The UE Identity is set to IMSI. The
Application ID represents a unique identifier of the application that has
triggered the transmission of the Discovery Request message. Discovery Type is
set to \"restricted discovery\".
2\. The ProSe Function checks for the authorization of the application
represented by the Application ID. If there is no associated UE context, the
ProSe Function shall check with HSS the authorisation for discovery and, if
necessary, create a new context for this UE that contains the subscription
parameters for this UE for the duration the Discovery Filters will be valid.
The authorisation information also contains the PLMNs that this UE is allowed
to perform discovery on. The HSS provides also the PLMN ID where the UE is
registered. The HSS provides the MSISDN of the UE. If the UE does not issue a
new monitor request within the duration the Discovery Filters are valid the
ProSe Function shall remove the entry related to the requested Restricted
ProSe App User ID from the UE context.
3\. The ProSe Function sends an Auth Request (Restricted ProSe App User ID,
indicator, Application Level Container) to the Application Server indicated by
the Application ID. The indicator is set to \"restricted discovery/monitor\".
4\. If, based on the permission setting, the Restricted ProSe App User ID is
allowed to discover at least one of the Target Restricted ProSe App User ID(s)
contained in the Application Level Container, the ProSe Application Server
returns an Auth Response (ProSe Discovery UE ID, indicator, N pairs of Target
ProSe Discovery UE ID - Target Restricted ProSe App User ID). The indicator is
set to \"restricted discovery/monitor ack\". Each Target ProSe Disc UE ID is
returned with the corresponding Target Restricted ProSe App User ID(s) that
the Restricted ProSe App User ID is allowed to discover. The ProSe Function
verifies that the returned ProSe Discovery UE ID belongs to the requesting UE.
Step 5 is executed only when the PLMN ID in the Target ProSe Disc UE ID
indicates the HPLMN.
5\. If the PLMN ID in the Target ProSe Discovery UE ID indicates the HPLMN and
at least one of received pair of Target ProSe Discovery UE ID \- Target
Restricted ProSe App User ID corresponds to a valid ProSe Code, the ProSe
Function in the HPLMN retrieves the ProSe Code corresponding to that Target
ProSe Discovery UE ID, Application ID and Target Restricted ProSe App User ID.
The Prose Function in the HPLMN stores, in the context of the announcing UE,
the Prose Discovery UE ID of the monitoring UE and the allocated validity
timer.
Steps 6-9 are executed only when the PLMN ID in the Target ProSe Disc UE ID
indicates a different PLMN.
6\. If the PLMN ID in the Target ProSe Disc UE ID indicates a PLMN different
from the HPLMN, the ProSe Function in the HPLMN contacts the ProSe Function in
that PLMN to retrieve the corresponding ProSe Code with a Monitor Request
(Restricted ProSe App User ID, UE Identity, Target ProSe Discovery UE ID,
Application ID, Target Restricted ProSe App User ID) message. The request
shall include the UE identity information e.g. IMSI or MSISDN in order to
allow the ProSe Function in that PLMN to perform charging.
7\. If the pair of Target ProSe Discovery UE ID - Target Restricted ProSe App
User ID received from the HPLMN ProSe Function corresponds to a valid ProSe
Code, the ProSe Function in the other PLMN retrieves the ProSe Code
corresponding to that Target ProSe Discovery UE ID, Application ID and Target
Restricted ProSe App User ID.
8.a Optionally, the ProSe Function in the other PLMN sends an Auth Request
(Restricted ProSe App User ID , indicator, Target Restricted ProSe App User
ID) to the Application Server indicated by the Application ID. The indicator
is set to \"restricted discovery/permission\".
8.b If, based on the permission setting, the Restricted ProSe App User ID is
allowed to discover the Target Restricted ProSe App User ID, the ProSe
Application Server acknowledges the Auth Request with an Auth Response (Target
ProSe Discovery UE ID, indicator). The indicator is set to \"restricted
discovery/permission ack\". The ProSe Function in the other PLMN verifies that
the returned Target ProSe Discovery UE ID corresponds to the UE to be
monitored.
NOTE 2: Whether steps 8.a and 8.b are executed depends on ProSe Function
configuration, or policy regarding the specific Application Server. For
example, if the ProSe Function can verify the permission locally, or the HPLMN
is trusted by the other PLMNs for permission control, these steps are not
needed.
9\. The ProSe Function in the other PLMN returns to the ProSe Function in the
HPLMN the ProSe Code and the corresponding residual validity timer with a
Monitor Response (ProSe Code, validity timer) message. The Prose Function in
the other PLMN also stores, in the context of the announcing UE, the Prose
Discovery UE ID of the monitoring UE and the allocated validity timer.
10\. If the ProSe Function in the HPLMN has retrieved at least a valid ProSe
Code, it builds the binding between ProSe Code with validity timer,
Application ID, Target Restricted ProSe App User ID and Target ProSe Discovery
UE ID and stores it into the user context of the monitoring UE. Based on the
ProSe Code and the associated validity timer the ProSe Function in the HPLMN
allocates a Discovery Filter with the corresponding TTL and returns a
Discovery Response (Discovery Filter, TTL, Discovery Entry ID) message to the
UE. The Discovery Filter includes the ProSe Code to be monitored. The TTL
indicates for how long the related ProSe Code in the Discovery Filter is valid
after it is received. If configured by the operator, the Target Restricted
ProSe App User ID(s) corresponding to the ProSe Code(s) may be included in the
Discovery Response message. The ProSe Function stores in the user context all
the parameters passed to the UE.
NOTE 3: When the Target Restricted ProSe App User ID, corresponding to the
ProSe Code in the Discovery Filter, is included in the Discovery Response
message, then the Match Report procedure may be skipped.
NOTE 4: The ProSe Code in different Discovery Filters may be the same, for
example, when the monitoring user is friend of the announcing user in more
than one application, in which the announcing user was allocated the same
ProSe Code.
Editor\'s note: The security and privacy details of this procedure will be
studied in 3GPP SA WG3. It is expected that the Discovery Response message may
contain also security material.
11\. The UE obtains the corresponding radio resources and starts to monitor
using the Discovery Filter.
NOTE 5: The ProSe Protocol layer in the UE may inform the application client
that it has started monitoring.
#### 5.1.2.5 Restricted Direct Discovery Match Report procedure
In the Figure 5.1.2.5.1, an operation example for the Match Report procedure
is presented, for the roaming case (changes from Open ProSe Discovery are
highlighted in red).
Figure 5.1.2.5.1: Match Report operation for Restricted Direct Discovery
(roaming)
1\. When the monitoring UE has received a ProSe Code over the air that matches
the Discovery Filter it obtained from monitoring Request procedure, and if the
UE does not have a corresponding Restricted ProSe App User ID associated with
it with a valid TTL, the UE sends a Match Report (Restricted ProSe App User
ID, UE Identity, Discovery Type, Application ID, ProSe Code) message to the
ProSe Function in the HPLMN to get the Target Restricted ProSe App User ID.
The Restricted ProSe App User ID is the identifier the monitoring UE used to
obtain the Discovery Filter from the Monitoring Request. The UE Identity is
set to e.g. IMSI. The Application ID represents a unique identifier of the
application that triggered the monitoring Request. Discovery Type is set to
\"restricted discovery\". The ProSe Code is the code received over the air.
NOTE 1: If the UE has received the Target Restricted ProSe App User ID
corresponding to the ProSe Code in the Discovery Filter in the Discovery
Response message, the Match Report procedure may be skipped.
2\. The HPLMN ProSe Function checks the authorization for the monitoring UE to
perform restricted discovery.
3\. The HPLMN ProSe Function analyses the ProSe Code and identifies in the UE
context of the monitoring UE the corresponding Target Restricted ProSe App
User ID.
4.a Optionally, the ProSe Function sends a Auth Request (Restricted ProSe App
User ID, Target Restricted ProSe App User ID, indicator) to the ProSe
Application Server. The ProSe Function locates the ProSe Application Server
based on the Application ID. The indicator is set to \"restricted
discovery/match\".
4.b If, based on the permission setting, the Restricted ProSe App User ID is
allowed to discover the Target Restricted ProSe App User ID, the ProSe
Application Server returns a Auth Response (ProSe Discovery UE ID, Target
ProSe Discovery UE ID, indicator, metadata(opt.)) message. The ProSe Discovery
UE ID corresponds to Restricted ProSe App User ID, the Target ProSe Discovery
UE ID corresponds to the Target Restricted ProSe App User ID stored in the
ProSe Application Server. The indicator is set to \"restricted discovery/match
ack\". This message may also contain certain metadata corresponding to the
Target ProSe Discovery UE ID e.g. welcome message, etc.
4.c The ProSe Function verifies that the returned ProSe Discovery UE ID
belongs to the requesting UE, and the Target ProSe Discovery UE ID is the same
as the stored Target ProSe Discovery UE ID.
NOTE 2: The content of Auth Request and Auth Response messages may vary
depending on the agreement between the operator and the owner of the
Application Server and are shown here just as an example.
NOTE 3: The Application logic triggered by the Auth Request message is out of
the scope of 3GPP.
5\. The ProSe Function in HPLMN returns a Match Report Ack (Application ID,
Target Restricted ProSe App User ID, validity timer, metadata(opt.)) to the
UE. The UE stores the mapping between the Restricted ProSe App User ID, the
ProSe Code and the Application ID for the duration of the validity timer.
NOTE 4: The application client is notified of the successful discovery either
by ProSe Protocol layer in the UE or by the Application Server with procedures
out of the scope of 3GPP.
6\. The ProSe Function in HPLMN may optionally send a Match Report Info
(Restricted ProSe App User ID, UE Identity, ProSe Code, Discovery Type) to the
ProSe Function of the announcing UE. Discovery Type is set to \"restricted
discovery\".
#### 5.1.2.6 Restricted Discovery Authorization Update
##### 5.1.2.6.1 General
A user may decide at any time to change the discovery permissions relating to
other users in a ProSe Application Server.
For example user A, while announcing the ProSe Code for a given Application
ID, may revoke the permission to be discovered by users B and C. However,
changes in the discovery permissions will not be effective until the validity
timer associated to the corresponding ProSe Code expires. In order to avoid
such a delay, the procedure in clause 5.1.2.6.2 is triggered by the ProSe
Application Server towards the ProSe Function serving user A.
NOTE: If users A and C stop being friends in a given application, i.e. users A
and C are no more allowed to discover each other, the corresponding ProSe
Application Server triggers the procedure in clause 5.1.2.6.2 or 5.1.2.6.3
towards both user A and user C ProSe Functions.
##### 5.1.2.6.2 Revocation of Discovery Filters procedure
Figure 5.1.2.6.2.1: Revocation of Discovery Filters
0\. User A, while announcing the ProSe Code for a given Application ID,
revokes discovery permissions relating to some other users in the ProSe
Application Server.
1\. The ProSe Application Server pushes to the ProSe Function serving user A
(identified by checking the ProSe Discovery UE ID of user A) an Authorization
Update (Restricted ProSe App User ID, indicator, N pairs of Banned Restricted
ProSe App User ID -- Banned ProSe Discovery UE ID) message. Restricted ProSe
App User ID identifies user A for the Application ID specific of that ProSe
Application Server. The indicator is set to \"restricted discovery/monitor
nack\". The N pairs of Banned Restricted ProSe App User ID -- Banned ProSe
Discovery UE ID are those that are no more allowed to discover the ProSe Code
corresponding to user A\'s Restricted ProSe App User ID for the Application ID
specific of that ProSe Application Server.
2\. The ProSe Function serving user A acknowledges the Authorization Update
message.
3\. The ProSe Function serving user A analyses the received N pairs of Banned
Restricted ProSe App User ID -- Banned ProSe Discovery UE ID.
Steps 4 - 5 are executed only when the PLMN ID in the Banned ProSe Discovery
UE ID indicates the same PLMN of user A (e.g. UE of user B).
4\. If the ProSe Function serving user A has previously allocated to a Banned
Restricted ProSe App User ID -- Banned ProSe Discovery UE (e.g. user B) a
Discovery Filter for monitoring the ProSe Code corresponding to the Restricted
ProSe App User ID and Application ID of user A, then the ProSe Function shall
send a Discovery Update Request (UE Identity, Discovery Entry ID, Update Info)
message to that UE (e.g. UE of user B). The UE identity is set to IMSI of the
UE. The Discovery Entry ID is set to the identifier of the corresponding
Discovery Entry that contains the Discovery Filter to be revoked. The Update
Info is optional and contains Discovery Filter ID(s) to be revoked, if the
ProSe Function decides to remove only certain filter(s) and not others.
NOTE 1: If the Update Info is not included, the UE shall remove all the
Discovery Filters corresponding to the Discovery Entry ID.
5\. The UE locates each Discovery Filter to be revoked, associated with the
Discovery Entry ID, removes it from the ProSe Discovery services operation and
sends back to the ProSe Function a Discovery Update Ack (Result, Discovery
Entry ID) message to confirm the corresponding operation.
Steps 6 - 11 are executed only when the PLMN ID in the Banned ProSe Disc UE ID
indicates a PLMN different from the PLMN of user A (e.g. UE of user C).
6\. If the ProSe Function serving user A has previously answered to a Monitor
Request coming from a ProSe Function in the PLMN of a Banned ProSe Discovery
UE ID, related to a Banned Restricted ProSe App User ID (e.g. user C), then
the ProSe Function serving user A sends to that ProSe Function a Monitor
Update (ProSe Code, Application ID, Banned Restricted ProSe App User ID,
Banned ProSe Discovery UE ID) message. The ProSe Code is the code the UE of
user A is announcing and for which is requested the revocation of the
corresponding Discovery Filter. Banned Restricted ProSe App User ID and Banned
ProSe Discovery UE ID identify the UE that is using the Discovery Filter to be
revoked (e.g. UE of user C).
7\. The ProSe Function in the other PLMN acknowledges the Monitor Update
message.
8\. Upon receiving the ProSe Function a Monitor Update, the ProSe Function in
the other PLMN shall send a Discovery Update Request (UE Identity, Discovery
Entry ID, Update Info) message to that UE (e.g. UE of user C). The UE identity
is set to IMSI of the UE. The Discovery Entry ID is set to the identifier of
the corresponding Discovery Entry that contains the Discovery Filter to be
revoked. The Update Info is optional and contains Discovery Filter ID(s) to be
revoked, if the ProSe Function decides to remove only certain filter(s) and
not others.
NOTE 2: If the Update Info is not included, the UE shall remove all the
Discovery Filters corresponding to the Discovery Entry ID.
9\. The UE locates each Discovery Filter to be revoked, associated with the
Discovery Entry ID, removes it from the ProSe Discovery services operation and
sends back to the ProSe Function a Discovery Update Ack (Result, Discovery
Entry ID) message to confirm the corresponding operation.
10\. After a time configured by the operator the ProSe Function in the other
PLMN sends a Monitor Update Result (ProSe Code, Application ID, Banned
Restricted ProSe App User ID, Banned ProSe Discovery UE ID, Result) message to
the ProSe Function serving user A to report the result of the corresponding
operation.
11\. The ProSe Function serving user A acknowledges the Monitor Update Result
message.
12\. After a time configured by the operator, the ProSe Function serving user
A sends an Authorization Update Result (Restricted ProSe App User ID,
indicator, N pairs of Banned Restricted ProSe App User ID - Banned ProSe
Discovery UE ID with Result) message to the ProSe Application Server. The
pairs Banned Restricted ProSe App User ID - Banned ProSe Discovery UE ID are
those received from the ProSe Application Server in step 1. For each pair the
Result indicates whether the permission to discover the ProSe Code
corresponding to user A Restricted ProSe App User ID for the Application ID
specific of that ProSe Application Server has been successfully revoked or
not.
13\. The ProSe Application Server acknowledges the Authorization Update Result
message.
##### 5.1.2.6.3 Allocation of a new ProSe Code and update of Discovery Filters
procedure
Based on local policies the ProSe Function serving user A may decide that in
certain scenarios it is more convenient to allocate a new ProSe Code to the
user A and provide new corresponding Discovery Filters to the monitoring UEs
that are still allowed to perform discovery of user A (e.g. UE of user D),
rather than revoking the Discovery Filters from the monitoring UEs whose
discovery permissions for user A have been revoked.
In such a case the procedure is executed as shown in Figure 5.1.2.6.3.1.
Figure 5.1.2.6.3.1: Allocation of a new ProSe Code and update of Discovery
Filters
Steps 0 - 3 are the same as in Figure 5.1.2.6.2.1.
4\. As step 3 in clause 5.1.2.3.1 with the following change: the ProSe
Function stores the new ProSe Code and the associated validity timer in the
user context and removes the old ProSe Code.
Steps 5 and 6 are executed only when the UE of user A is roaming.
5\. As step 4 in clause 5.1.2.3.1 with the following change: the Announce
Authorization message contains both the old ProSe Code and the new ProSe Code.
6\. As step 5 in clause 5.1.2.3.1.
7\. The ProSe Function serving user A shall send a Discovery Update Request
(UE Identity, Discovery Entry ID, Update Info) message to the UE of user A.
The UE identity is set to IMSI of the UE. The Discovery Entry ID is set to the
identifier of the corresponding Discovery Entry that contains the ProSe Code
to be replaced. The Update Info contains the new ProSe Code and the associated
validity timer that should be used.
8\. The UE locates the ProSe Code to be replaced, associated with the
Discovery Entry ID, replaces it and sends back to the ProSe Function a
Discovery Update Ack (Result, Discovery Entry ID) message to confirm the
corresponding operation.
9\. If Discovery Filters for monitoring the ProSe Code corresponding to the
Restricted ProSe App User ID and Application ID of user A has been previously
allocated to a Target Restricted ProSe App User ID - Target ProSe Disc UE
still allowed to discover user A (e.g. user D), then those monitoring UEs are
updated as described in figure 5.1.2.6.2.1, with the following changes: the
newly allocated ProSe Code and validity timer are additionally delivered to
the ProSe Function(s) serving the monitoring UEs(e.g. the user D) by the
Monitor Update message, and are used by the ProSe Function(s) to build the new
Discovery Filters that conveyed in the Update Info information element of the
Discovery Update Request messages, and are used by the monitoring UEs to
replace the old Discovery Filters. The ProSe Application Server is finally
updated with the results of the overall procedure.
### 5.1.3 Impact on Existing Entities and Interfaces
Editor\'s note: Impacts on existing nodes or functionality will be added.
## 5.2 Solution for Restricted ProSe Direct Discovery (Model B)
### 5.2.1 Functional Description
The solution for Restricted ProSe Discovery via Model B follows the following
principles:
\- The Model B discovery shall allow direct exchange of ProSe Query Code and
ProSe Response Code between Discoverer UE and Discoveree UE, where the ProSe
Response Code is obtained by Discoveree UE before it receives the ProSe Query
Code.
\- The discoveree UE applies the Discovery filter from the ProSe function to
determine which ProSe Code is to be responded to. The Discovery filter is
associated with the identity of the target group which the discoverer UE wants
to discover.
\- The Discoveree UE needs to obtain a Discovery Filter before it can
participate in the discovery operation.
\- For each of the ProSe Query Code, the Discoverer UE needs to be configured
with one or more Discovery Filters for processing the ProSe Response Code.
\- Authorization requirements for Model B Open and Restricted discovery are
the same as those for Model A, and the checking of authorization is carried
out at the Discoverer side via signalling with the ProSe Function.
\- The Match Report procedure for both Models A and are initiated at the
Monitoring/Discoverer UE side.
\- The Discoveree UE perform both the monitoring operation and announcing
operation. The Discoveree UE uses the Discovery Request procedure as defined
in TS 23.303 [3], with the following extensions:
\- Model B discovery is indicated.
\- ProSe Response operation is indicated.
\- Both ProSe (Response) Code and Discovery Filter are allocated; Multiple
Discovery Filters may be returned.
\- Discoveree UE performs a monitoring operation before the announcing
operation.
\- The Discoverer UE perform both the monitoring operation and announcing
operation. The Discoverer UE uses the Discovery Request procedure as defined
in TS 23.303 [3], with the following extensions:
\- Model B discovery is indicated.
\- ProSe Query operation is indicated.
\- Both ProSe (Query) Code and Discovery Filter are allocated; Multiple
Discovery Filters may be returned.
\- Discoverer UE performs an announcing operation before the monitoring
operation.
\- The Discoverer UE can use the Match Report procedure as defined in TS
23.303 [3], after receiving the ProSe Response Code from Discoveree UE.
\- No new network entities are needed to support Model B discovery, and
existing PC3 and PC6/7 interfaces can be enhanced to support the Model B
discovery.
\- Radio layer enhancements to support Model B discovery - if any are needed--
are handled by RAN WGs.
NOTE: The above principles also apply to Open discovery via Model B.
### 5.2.2 Procedures
#### 5.2.2.1 Identifier definitions for On-Demand Discovery
For the On-Demand Discovery, the following new identifiers are defined in
addition to those defined in TS 23.303 [3]:
**ProSe Query Code** : The ProSe Query Code is allocated by the ProSe Function
in the HPLMN to the Discoverer UE for Model B discovery. The ProSe Code is
sent by the Discoverer UE over the air.
**ProSe Response Code** : The ProSe Response Code is allocated by the ProSe
Function in the HPLMN to the Discoveree UE for Model B discovery. The ProSe
Code is sent by the Discoveree UE over the air upon receiving a ProSe Query
Code matching the Discovery Filter.
#### 5.2.2.2 Discoveree UE procedure
Figure 5.2.2.2.1: Discoveree UE procedures for Model B discovery (roaming)
0\. The Discoveree UE is configured with Restricted ProSe Application User ID
using mechanisms that are out of scope of 3GPP. This is the same as step 0 of
5.1.2.3.
1\. If the Discoveree UE is authorised to use Model B discovery in the serving
PLMN, it shall establish a secure connection with the ProSe Function and send
a Discovery Request (Discovery Model, Restricted ProSe Application User ID, UE
Identity, command, Application ID) message. The Discovery Model indicates that
Model B is used. The ProSe Application ID indicates what the UE is interested
to announce. The UE Identity is set to e.g. IMSI. The command indicates that
this is for ProSe Response operation, i.e. for a Discoveree UE. The
Application ID represents a unique identifier of the UE application that has
triggered the transmission of the Discovery Request message. This request is
always sent to the ProSe Function in HPLMN.
2\. As in TS 23.303 [3].
2.a and 2.b are only used when the Discovery Type indicates Restricted
Discovery. They are identical to those of clause 5.1.2.3.
3a. The ProSe Function allocates a ProSe Response Code and a ProSe Discovery
Filter.
3\. If the Discovery Request is authorised then the HPLMN ProSe Function shall
inform the ProSe Function in VPLMN with the Announce Authorisation (Restricted
ProSe Application User ID, Application ID, ProSe Response Code, validity
timer, UE Identity) message. The Restricted ProSe Application User ID
corresponds to the request from the UE, whereas the ProSe Response Code
indicates the assigned code for this request. The request also includes the UE
identity information e.g. IMSI or MSISDN in order to allow the ProSe Function
in VPLMN to perform charging. The validity timer indicates for how long this
ProSe Response Code is going to be valid.
4\. The ProSe Function in VPLMN authorizes the UE to perform ProSe Direct
Discovery announcing.
5\. The ProSe Function in HPLMN responds with a Discovery Response (Discovery
Model, Discovery Filter, ProSe Response Code, validity timer) message. The
Discovery Model indicates that Model B is used. Multiple Discovery Filters may
be returned. The Discovery Filter provides the filter for the Discoveree UE to
determine if a received ProSe Query Code over the air should trigger sending
of the ProSe Response Code. The ProSe Response Code is provided by the ProSe
Function and corresponds to the Restricted ProSe Application User ID that was
contained in the Discovery Request. The validity timer indicates for how long
this ProSe Response Code is going to be valid. When the validity timer expires
or the UE changes its registered PLMN, the UE needs to request a new ProSe
Response Code.
6\. The UE may start to obtain the radio resources to monitor using the
Discovery Filter, as authorised and configured by E-UTRAN for ProSe as defined
in RAN specifications.
NOTE: When allowed by authorization configuration, the UE may perform
monitoring in local PLMNs other than the RPLMN.
#### 5.2.2.3 Discoverer UE procedure before discovery
Figure 5.2.2.3.1: Discoverer UE procedures for Model B discovery (roaming)
0\. The Discoverer UE are configured with Restricted ProSe Application User
IDs using mechanisms that are out of scope of 3GPP. This is the same as that
of 5.1.2.4.
1\. If the Discoverer UE is authorised to use Model B discovery in the serving
PLMN, it shall establish a secure connection with the ProSe Function and send
a Discovery Request (Discovery Model, Discovery Type, Restricted ProSe
Application User ID, UE Identity, command, Application ID, Application
Transparent Container) message. The Discovery Model indicates that Model B is
used. The command indicates this is for ProSe Query operation, i.e. for a
Discoverer UE. The UE Identity is set to e.g. IMSI. The Application ID
represents a unique identifier of the UE application that has triggered the
transmission of the Discovery Request message. This request is always sent to
the ProSe Function in HPLMN.
2\. As in TS 23.303 [3].
2.a and 2.b are identical to steps 3 and 4 of clause 5.1.2.4.
3\. If the Discovery Request is authorized, and the PLMN ID in the Target
ProSe Discovery UE ID indicates a different PLMN, the ProSe Function contacts
the indicated PLMN\'s ProSe Function to obtain the necessary information with
a Discovery Request (Restricted ProSe App User ID, UE Identity, Target ProSe
Discovery UE ID, Application ID, Target Restricted ProSe App User ID).
3.a and 3.b are identical to steps 8.a and 8.b of the clause 5.1.2.4.
4\. Based on the Target ProSe Discovery UE ID, Application ID, and Target
Restricted ProSe App User ID, the ProSe Function locates the Discoveree UE(s)
context, and responds with a Discovery Response (ProSe Query Code(s), ProSe
Response Code, validity timer). The ProSe Query Code is the code used by the
ProSe Function to build the Discovery Filter of step 3a of clause 5.2.2.2,
such that it can trigger the Discoveree UE to send the response. The ProSe
Response Code is that allocated to the Discoveree UE in step 3a of clause
5.2.2.2. The validity timer indicates for how long a ProSe Query Code and
ProSe Response Code are going to be valid.
5\. The HPLMN ProSe Function shall inform the ProSe Function in VPLMN with the
Announce Authorisation (Restricted ProSe Application User ID, Application ID,
ProSe Query Code(s), validity timer, UE Identity) message. The Restricted
ProSe Application User ID corresponds to the request from the UE, whereas the
ProSe Query Code is that obtained in step 4. The request also includes the UE
identity information e.g. IMSI or MSISDN in order to allow the ProSe Function
in VPLMN to perform charging. The validity timer indicates for how long this
ProSe Query Code is going to be valid.
6\. The ProSe Function in VPLMN authorizes the UE to perform ProSe Direct
Discovery announcing.
7\. The ProSe Function shall respond with a Discovery Response (Discovery
Model, Discovery Filter(s), ProSe Query Code(s), validity timer) message. The
Discovery Model indicates the model B is used. Multiple Discovery Filters may
be returned. The Discovery Filter is generated by the ProSe Function based on
the ProSe Response Code of step 4. The ProSe Query Code is that received in
step 4. The validity timer indicates for how long a ProSe Query Code and
Discovery Filter pair are going to be valid. When the validity timer expires
the UE needs to request a new ProSe Query Code and Discovery Filter.
8\. The UE may start to obtain the radio resources to announce the ProSe Query
Code, as authorised and configured by E-UTRAN for ProSe as defined in RAN
specifications.
#### 5.2.2.4 Match Report procedure for Discoverer UE
The same procedures as in clause 5.1.2.5 of the present TR for Restricted
Discovery can be used for Model B Discoverer UE after the ProSe Response Code
is received.
### 5.2.3 Impact on Existing Entities and Interfaces
PC3, PC6, and PC7 interfaces need to be upgraded to support model B discovery.
No new entities or interfaces are needed.
### 5.2.4 Topics for further study
### 5.2.5 Conclusions on Restricted Direct Discovery (Model B)
The solution for Restricted Direct Discovery Model B is complete, and
normative work should be carried out following conclusions in clause 5.7.
## 5.3 Restricted Discovery with application-controlled extension (non-public
safety use)
### 5.3.1 Functional description for Restricted Discovery with application-
controlled extension
To support Restricted Discovery with application-controlled extension, the
ProSe Code contains a prefix, which is assigned by the ProSe Function, and a
suffix, which is application-controlled.
Editor\'s note: The lengths of the ProSe Code prefix and suffix are FFS.
The following identifiers are defined:
**ProSe Code Prefix** : In Discovery with application-controlled extension, a
part of the ProSe Code that is assigned by the ProSe Function.
**ProSe Code Suffix** : In Discovery with application-controlled extension, a
part of the ProSe Code that is under the control of the announcing
application. The ProSe Code Suffix represents application specific information
pertaining to the application that is indicated in the Restricted ProSe App
User ID.
The following principles are followed:
\- The UE should indicate in the Announce Request procedure whether it desires
Restricted Discovery with application-controlled extension.
\- The ProSe Function should indicate in the Monitor Request procedure whether
the requested Restricted ProSe App User ID should be used in Restricted
Discovery with application-controlled extension.
#### 5.3.2 Procedures for Restricted Discovery with application-controlled
extension
##### 5.3.2.1 Announce Request procedure
The operations for the announcing UE when roaming are presented in figure
5.3.2.1.1 (changes from Restricted ProSe Discovery are highlighted in red).
For the non-roaming case, steps 4 and 5 are omitted.
`
Figure 5.3.2.1.1: Announce Request with application controlled extension
(roaming)
0\. As in clause 5.1.2.3.
1\. As in clause 5.1.2.3, with the following change: The Discovery Request
message also include the Application Level Container. The Application Level
Container contains the information that the UE is interested to announce in
the ProSe Code Suffix. The Discovery Type is set to \"Restricted Discovery
with application-controlled extension.
2 As in clause 5.1.2.3.
2.a As in clause 5.1.2.3, but with the indicator is set to \"Restricted
Discovery with application-controlled extension /announce\". The allowed
suffix number indicates how many suffixes the ProSe Application Server can
provide to the UE.
NOTE 1: The Allowed Suffix Number is set by the ProSe Function based on
operator policy and local regulation requirements.
2.b As in clause 5.1.2.3, with the following change: The indicator is set to
\"Restricted Discovery with application-controlled extension, /announce ack\".
The ProSe Code Suffix Pool is also included in the Auth Response message. The
ProSe Code Suffix Pool contains the Suffix(es) allocated by the ProSe
Application based on the inputs in 2.a.
NOTE 2: The length of the ProSe Code Suffix is chosen by the ProSe Application
Server from a set of allowable lengths (e.g. 8 bits, 24 bits, 48 bits). This
choice is per application, so that all UEs announcing ProSe Codes assigned for
Restricted ProSe Application User IDs from that Application ID use the same
Suffix length (which may be zero if no application-controlled extension is
allowed for this Application).
NOTE 3: The ProSe Code Suffix Pool needs to support the indication of a large
amount of or a range of ProSe Code Suffixes.
3\. As in clause 5.1.2.3, with the following change: The ProSe Function in
HPLMN allocates a ProSe Code Prefix based on the Application ID and/or the
Restricted ProSe App User ID.
4\. As in clause 5.1.2.3, with the following change: The ProSe Code is
replaced by the ProSe Code Prefix. The ProSe Code Suffix Pool is also included
in the message.
5\. As in clause 5.1.2.3.
6\. As in clause 5.1.2.3, with the following change: The ProSe Code is
replaced by the ProSe Code Prefix. The ProSe Code Suffix Pool is also included
in the message. The UE appends a ProSe Code Suffix from the ProSe Code Suffix
Pool to the ProSe Code Prefix to form a ProSe Code.
NOTE 4: When ProSe Code Suffix Pool contains multiple suffixes, the UE may use
different suffixes from the ProSe Code Suffix Pool to form different ProSe
Codes to announce, without having to contact the ProSe Function as long as the
ProSe Code Prefix is valid.
Editor\'s note: It\'s FFS that it\'s aligned with the LI requirement that the
UE is able to announce different ProSe Codes without contacting the ProSe
Function.
7\. As in clause 5.1.2.3.
#### 5.3.2.2 Monitor Request procedure
In Figure 5.3.2.2.1, an operation example for the Monitor Report procedure is
presented for the roaming case, but the same steps also apply for the non-
roaming case (changes from Open ProSe Discovery are highlighted in red).
Figure 5.3.2.2.1: Monitor Request with application controlled extension
(roaming)
0\. As in clause 5.1.2.4.
1\. As in clause 5.1.2.4, with the following change: Besides the Target
Restricted ProSe App User IDs, the Application Level Container may also
include some information corresponding to the ProSe Code Suffix, e.g. group
information or user information such as age and height. The Discovery Type is
set to \"Restricted Discovery with application-controlled extension.
2\. As in clause 5.1.2.4.
3\. As in clause 5.1.2.4, the Discovery Type set to \"Restricted Discovery
with application-controlled extension /monitor\".
4\. As in clause 5.1.2.4, with the following change: the indicator set to
\"Restricted discovery with application-controlled extension /monitor \".The
Auth Response may also include the mask(s) for the ProSe Code Suffix(es)
corresponding to each of the Target Restricted ProSe App User ID(s).
5\. As in clause 5.1.2.4, with the ProSe Code replaced by ProSe Code Prefix.
6\. As in clause 5.1.2.4
7\. As in clause 5.1.2.4, with the ProSe Code replaced by ProSe Code Prefix.
8-9. As in clause 5.1.2.4.
10\. As in clause 5.1.2.4, with the following change: The ProSe Code is
replaced by ProSe Code Prefix. Besides the ProSe Code(s), the Discovery Filter
may also contain the mask(s) for the ProSe Code Suffix, which is/are obtained
in from ProSe Application Server in step 4.
11\. As in clause 5.1.2.4.
#### 5.3.2.3 Match Report procedure
The UE may initiate a Match Report procedure on the ProSe Code as in clause
5.1.2.5 if either there is match on the ProSe Code Prefix, or there is a match
on the ProSe Code Suffix, but the ProSe Protocol layer in the UE doesn\'t have
the ProSe Restricted App User ID corresponding to the ProSe Code Prefix stored
locally. Once the ProSe Protocol layer in the UE has got the ProSe Restricted
App User ID corresponding to the ProSe Code Prefix stored locally, the ProSe
Code Suffix is passed to the application in the UE.
## 5.4 Solution for Restricted ProSe Direct Discovery (on demand announcing)
### 5.4.1 Functional Description
The solution for Restricted ProSe Direct Discovery (on demand announcing) is
the enhancement on the restricted ProSe Direct discovery procedure which is
defined in clause 5.1. In this enhancement the Announcing UE begins to
announce the ProSe Code only when there are ongoing monitoring request.
The procedures are enhanced as follows:
\- Announce Request procedure:
\- Indication of announcing type \"on demand\";
\- \"on demand\" announcing is authorized and enabled;
\- ProSe Code, validity timer and Announcing Authorization are allocated and
stored by the ProSe Function but only validity timer and Announcing
Authorization are initially returned to the UE.
\- Monitor Request procedure:
\- Triggers the announcing UE to announce.
NOTE: The Match report procedure does not require any enhancement.
\- Addition of Announcing Alert procedure which is used to trigger announcing.
### 5.4.2 Procedures
#### 5.4.2.1 Restricted Direct Discovery(on demand announcing) Announce
Request procedure
{width="6.678472222222222in" height="4.147916666666666in"}
Figure 5.4.2.1.1: Announce Request operation for Restricted Direct Discovery
with on demand announcing (roaming)
0\. Same as the clause 5.1.2.3 step 0.
1\. If the UE is authorized to announce in the serving PLMN and is triggered
by the application client to announce, it shall establish a secure connection
with the ProSe Function in HPLMN and send a Discovery Request message
(Restricted ProSe App User ID, UE Identity, command=announce, Discovery Type,
Announcing Type, Application ID) for announcing. The Restricted ProSe App User
ID indicating what the UE is interested to announce was obtained in step 0.
The UE identity is set to IMSI. The Application ID represents a unique
identifier of the UE application that has triggered the transmission of the
Discovery Request message. The Discovery Type is set to \"restricted
discovery\". Announcing type is set to \"on demand\" to indicate the on demand
announcement mechanism is requested by UE for the indicated application.
2\. Same as the clause 5.1.2.3 step 2.
2.a Same as the clause 5.1.2.3 step 2.a.
2.b Same as the clause 5.1.2.3 step 2.b.
3\. The ProSe Function in HPLMN allocates a ProSe Code and the associated
validity timer. The ProSe Code corresponds to the Restricted ProSe App User ID
that was contained in the Discovery Request from the UE. The validity timer
shall indicate for how long this ProSe Code is going to be valid. The UE will
be authorised to announce this ProSe Code for the duration of validity timer
and if it remains in the same PLMN.
If the \"on demand\" announcing is requested by the UE, the ProSe Function
determines if \"on demand\" announcing can be authorized and enabled based on
the Application ID and operator\'s configuration.
The ProSe Function stores the Restricted ProSe App User ID, the ProSe Code and
the associated validity timer and, the corresponding Announcing Enabled if
\"on demand\" announcing is authorized and enabled, in the user context.
NOTE: Whether the ProSe code is allocated at this step or it can be postponed
to step 5 or step 7 in clause 5.4.2.2 can be defined in the normative phase.
4\. Same as the clause 5.1.2.3 step 4.
5\. Same as the clause 5.1.2.3 step 5.
6\. The ProSe Function in HPLMN responds to the UE with a Discovery Response
(validity timer, Announcing Enabled) message.
7\. The UE starts waiting for an Announcing Alert Request message from network
as define in clause 5.4.2.3.
#### 5.4.2.2 Restricted Direct Discovery (on demand announcing) Monitor
Request procedure
Figure 5.4.2.2.1: Monitor Request operation for Restricted Direct Discovery
with on demand announcing (roaming)
0\. Same as the clause 5.1.2.4 step 0.
1\. Same as the clause 5.1.2.4 step 1.
2\. Same as the clause 5.1.2.4 step 2.
3\. Same as the clause 5.1.2.4 step 3.
4\. Same as the clause 5.1.2.4 step 4.
5\. If the PLMN ID in the Target ProSe Disc UE ID indicates the HPLMN and at
least one of received pair of Target ProSe Discovery UE ID - Target Restricted
ProSe App User ID corresponds to a valid ProSe Code, the ProSe Function in the
HPLMN retrieves the ProSe Code corresponding to that Target ProSe Discovery UE
ID, Application ID and Target Restricted ProSe App User ID.
If the Announcing Enabled is stored in the UE context, the ProSe Function of
HPLMN shall trigger the Announcing Alert procedure (see clause 5.1.2.3) to
notify the UE to perform announcing.
6\. Same as the clause 5.1.2.4 step 6.
7\. If the pair of Target ProSe Discovery UE ID - Target Restricted ProSe App
User ID received from the HPLMN ProSe Function corresponds to a valid ProSe
Code, the ProSe Function in the other PLMN retrieves the ProSe Code
corresponding to that Target ProSe Discovery UE ID, Application ID and Target
Restricted ProSe App User ID.
If the Announcing Enabled is stored in the UE context, the ProSe Function of
HPLMN shall trigger the Announcing Alert procedure (see clause 5.1.2.3) to
notify the UE to perform announcing.
8.a Same as the clause 5.1.2.4 step 8.a.
8.b Same as the clause 5.1.2.4 step 8.b.
9\. Same as the clause 5.1.2.4 step 9.
10\. Same as the clause 5.1.2.4 step 10.
11\. Same as the clause 5.1.2.4 step 11. .
#### 5.4.2.3 Restricted Direct Discovery(on demand announcing) Announcing
Alert Procedure
Figure 5.4.2.3.1 Announcing Alert for Restricted Direct Discovery with on
demand announcing
Announcing Alert procedure is triggered when the ProSe Function in the HPLMN
of announcing UE receives a Monitor Request from a UE which is in the vicinity
of the announcing UE and detects the associated Announcing Enabled indication
is stored in the UE context.
1\. The HPLMN ProSe Function informs the announcing UE with the Announcing
Alert Request (Restricted ProSe App User ID, Application ID, ProSe Code)
message. The Restricted ProSe App User ID indicating what the UE is interested
to announce which was obtained in step 0 of Announce Request procedure in
clause 5.4.2.1. The Application ID represents a unique identifier of the UE
application that has triggered the transmission of the Discovery Request
message. The ProSe Code is retrieved from the UE context.
2\. The UE responds with an Announce Alert Response message to the ProSe
Function. Upon receiving the Announce Alert Response message the ProSe
Function removes the Announcing Enabled indication associated to that ProSe
Code from the user context.
3\. The UE may start announcing the provided ProSe Code in the serving PLMN,
using the radio resources authorised and configured by E-UTRAN to be used for
ProSe as defined in RAN specifications.
### 5.4.3 Impact on Existing Entities and Interfaces
PC3 need to be enhanced to support the on demand announcing Restrict
discovery.
No new entities or interfaces are needed.
## 5.5 Enhancement to the ProSe service authorization and provisioning
### 5.5.1 General
Based on the current agreed solutions, the existing procedures defined in
clause 5.2 of TS 23.303 [3] are sufficient to support one-to-one ProSe Direct
Communication and Restricted ProSe Direct Discovery.
However, it is expected that the service authorization and provisioning
information would require some enhancement to support the information
required.
### 5.5.2 Enhancements required for ProSe Restricted Direct Discovery
The following new configurations need to be provisioned for ProSe Restricted
Direct Discovery authorisation:
1) ProSe Restricted Direct Discovery monitoring authorisation policy:
\- PLMNs in which the UE is authorised to perform ProSe Restricted Direct
Discovery monitoring.
2) ProSe Restricted Direct Discovery announcing authorisation policy:
\- PLMNs in which the UE is authorized to perform Restricted Direct Discovery
announcing.
\- Authorised discovery range for announcing per PLMN.
3) ProSe Restricted Direct Discovery Model B authorization policy:
\- PLMNs in which the UE is authorized to perform Model B Discoverer
operation;
\- PLMNs in which the UE is authorized to perform Model B Discoveree
operation;
4) ProSe Discovery UE ID configuration for Restricted Direct Discovery:
\- ProSe Discovery UE ID.
These configurations will be associated with validity timers.
## 5.6 Topics for further study for restricted Direct Discovery
Editor\'s note: Topics `FFS will be collected for this particular
functionality.
Following issues need to be resolved:
\- It is FFS how to adapt the Restricted ProSe Direct Discovery for Public
Safety use, e.g. when real time interaction with the ProSe Function is not
possible.
\- It is FFS how to support partial matching for Restricted Discovery ProSe
Codes.
## 5.7 Conclusions on restricted ProSe Direct Discovery (non-public safety
use)
Editor\'s note: Conclusions will be collected for this particular
functionality
Normative work for the basic operation of Restricted ProSe Direct Discovery
needs to proceed in as follows:
\- The Announce Request procedure based on what is defined in clause 5.1.2.3.
\- The Monitor Request procedure based on what is defined in clause 5.1.2.4.
\- The Match Report procedure based on what is defined in clause 5.1.2.5.
Normative work for the Restricted ProSe Direct Discovery Model B needs to
proceed in as follows:
  * The general principles defined in 5.2.1 should be followed.
  * The Discoveree UE procedure based on clause 5.2.2.2.
  * The Discoverer UE procedures based on clause 5.2.2.3.
Normative work for the operation of Restricted ProSe Direct Discovery (on
demand announcing) needs to proceed as follows:
\- The Announce Request procedure based on what is defined in clause 5.4.2.1.
\- The Monitor Request procedure based on what is defined in clause 5.4.2.2.
\- The Announcing Alter procedure based on what is defined in clause 5.4.2.3.
Normative work for the operation of restricted ProSe Direct Discovery
authorization update needs to proceed as follows:
\- The Revocation of Discovery Filters procedure based on what is defined in
clause 5.1.2.6.2.
\- The Allocation of a new ProSe Code and update of Discovery Filters
procedure based on what is defined in clause 5.1.2.6.3.
# 6 Direct discovery (public safety use)
Editor\'s note: This clause is intended to document the agreed architecture
solution for Direct Discovery (public safety use).
## 6.1 Solution for Direct Discovery (public safety use)
### 6.1.1 Functional Description
#### 6.1.1.1 General
Both Model A and Model B discovery are supported:
\- Model A uses a single discovery protocol message (Announcement).
\- Model B uses two discovery protocol messages (Solicitation and Response).
Public Safety discovery for ProSe UE-Network Relay discovery and Group Member
discovery uses the PC5-D protocol stack that is depicted in figure 6.1.1.1-1.
Additional information not directly used for discovery can be also advertised
using Discovery Transport, like relayed TMGIs, the ECGI of the service cell,
in a single or separate discovery messages of type \"Relay Discovery
Additional Information\".
Figure 6.1.1.1-1: PC5 \"Discovery Plane\" stack (PC5-D)
New PC5-D ProSe Protocol messages will need to be defined in TS 24.334: \- UE-
to-Network Relay Discovery Announcement message (Model A):
\- UE-to-Network Relay Discovery Solicitation message (Model B)
\- UE-to-Network Relay Discovery Response message (Model B)
\- Group Member Discovery Announcement message (Model A)
\- Group Member Discovery Solicitation message (Model B)
\- Group Member Discovery Response message (Model B)
### 6.1.2 Procedures
#### 6.1.2.1 General
The following use cases for public safety discovery are supported:
\- UE-to-Network Relay Discovery.
\- Determination is needed regarding within the ProSe Communication which
user(s) are in ProSe Communication range at any given time (shortly referred
to as \"Group Member Discovery\").
\- UE-to-UE Relay Discovery.
The following parameters are common to all of UE-to-Network Relay Discovery,
Group Member Discovery and UE-to-UE Relay Discovery:
\- Message type: Announcement (Model A) or Solicitation/Response (Model B) ,
Relay Discovery Additional Information (Model A).
\- Discovery type: indicates whether this is UE-to-Network Relay Discovery,
Group Member Discovery or UE-to-UE Relay Discovery.
The following parameters are used in the UE-to-Network Relay Discovery
Announcement message (Model A):
\- ProSe Relay UE ID: link layer identifier that is used for direct
communication and is associated with a Relay Service Code.
\- Announcer info: provides information about the announcing user.
\- Relay Service Code: parameter identifying a connectivity service the ProSe
UE-to-Network Relay provides to Public Safety applications. The Relay Service
Codes are configured in a ProSe UE-to-Network relay for advertisement.
Additionally, the Relay Service Code also identifies authorized users the
ProSe UE-to-Network relay would offer service to, and may select the related
security policies or information e.g. necessary for authentication and
authorization between the Remote UE and the ProSe UE-to-Network Relay (e.g. a
Relay Service Code for relays for police members only would be different than
a Relay Service code for relays for Fire Fighters only, even though
potentially they provided connectivity to same APN e.g. to support Internet
Access). The definition of values of the Relay Service Code are out of scope
of ProSe specification.
\- Radio Layer Information: contains information about the radio layer
information, e.g. radio conditions between the eNB and the UE-to-Network
Relay, to assist the Remote UE selecting the proper UE-to-Network Relay.
Editor\'s Note: The details of Radio Layer Information parameters are to be
identified and if agreed then to be defined by RAN WGs.
NOTE 1: A ProSe Relay UE ID should be uniquely associated with a Relay Service
Code.
NOTE 2: ProSe Relay UE ID in the announcement message does not imply that the
ProSe UE-to-Network Relay has established the indicated connectivity to the
network.
The following parameters are used in the UE-to-Network Relay Discovery
Solicitation message (Model B):
\- Discoverer info: provides information about the discoverer user.
\- Relay Service Code: information about connectivity that the discoverer UE
is interested in. The Relay Service Codes are configured in the Prose Remote
UEs interested in related connectivity services.
The following parameters are used in the UE-to-Network Relay Discovery
Response message (Model B):
\- ProSe Relay UE ID: link layer identifier that is used for direct
communication and is associated with a Relay Service Code.
NOTE 3: It is up to stage 3 specifications how the ProSe UE-to-Network Relay
indicates in the response message which Relay Service Code it can support.
NOTE 4: a ProSe Relay UE ID should be uniquely associated with a Relay Service
Code.
NOTE 5: ProSe Relay UE ID in the response message does not imply that the
ProSe UE-to-Network Relay has established the indicated connectivity to the
network.
\- Discoveree info: provides information about the discoveree.
\- Radio Layer Information: contains information about the radio layer
information, e.g. radio conditions between the eNB and the UE-to-Network
Relay, to assist the Remote UE selecting the proper UE-to-Network Relay.
Editor\'s note: The details of Radio Layer Information parameters are to be
identified and if agreed then to be defined by RAN WGs.
The following parameters are used in the Group Member Discovery Announcement
message (Model A):
\- ProSe UE ID: link layer identifier that is used for subsequent direct
communication.
\- Announcer info: provides information about the announcing user.
The following parameters are used for Group Member Discovery Solicitation
message (Model B):
\- Discoverer info: provides information about the discoverer user.
\- Target Info: provides information about the targeted discoverees (single
user or group).
The following parameters are used for Group Member Discovery Response message
(Model B):
\- ProSe UE ID: link layer identifier that is used for subsequent direct
communication.
\- Discoveree info: provides information about the discoveree.
The following parameters are used for UE-to-UE Relay Discovery:
\- ProSe UE ID: link layer identifier that is used for direct communication.
\- Announcer/Discoverer info: provides information about the announcing or
discoverer user.
\- Remote User Info: provides information about the user of a Remote UE.
\- Discoveree info (Model B): provides information about the discoveree.
The following parameters can be used in Relay Discovery Additional
Information:
\- ProSe Relay UE ID: link layer identifier that is used for direct
communication and is associated with a Relay Service Code.
\- Announcer info: provides information about the announcing user.
\- TMGI: indicates the MBMS service the ProSe UE-Network Relay is relaying
\- ProSe Layer-2 Group ID: link layer identifier of the group that transmits
the MBMS traffic corresponding to the TMGI.
\- ECGI: indicates the ECGI of the serving cell of the ProSe UE-Network Relay
A single Relay Discovery Additional Information Message may carry:
\- the EGCI that the ProSe UE-Network Relay is camped on or;
\- one or more advertised TMGIs and their corresponding ProSe Layer-2 Group
IDs up to the maximum allowed message size or;
\- the EGCI that the ProSe UE-Network Relay is camped on and one or more
advertised TMGIs and their corresponding ProSe Layer-2 Group IDs up to the
maximum allowed message size.
The following parameters have a fixed size of maximum 64 bits: Announcer Info,
Discoverer Info, Discoveree Info and Target Info. The definition of these
parameters is out of ProSe scope.
NOTE 6: The size of these parameters is to be reviewed during Stage 3 work.
NOTE 7: Any mapping between application layer user identifiers of larger size
to the fixed size of Announcer/ Discoverer/ Discoveree Info or Target Info is
out of ProSe scope.
The Announcer Info, Discoverer Info and Discoveree Info refer to the same
parameter that takes on a different name depending on the Public Safety
Discovery message. It is provided to the UE during provisioning time (e.g.
similar to how ProSe Layer-2 Groups are provisioned in Rel-12).
The Relay Service Code(s) are provided to the UE and ProSe UE-to-Network Relay
during provisioning time (e.g. similar to how ProSe Layer-2 Groups are
provisioned in Rel-12). It is assumed that the remote UEs are provisioned in
advance with the Relay Service Codes corresponding to the ProSe UE-Network
Relays they are allowed to access.
The following are the provisioning options for Announce Info/Discoverer
Info,/Discoveree Info and Relay Service Code:
\- Configuration in the UICC.
\- Provisioning in the ME from the Direct Provisioning Function (DPF).
\- Provisioning in the ME from a 3rd party public safety provider application
server (e.g. GCS AS as in TS 23.468 [15]). If UE receives the same set of data
from AS that has been previously provided by DPF then UE uses the data set
provided by AS.
The Target Info parameter is not provisioned in the UE. It is provided by the
application layer in the UE (e.g. manually selected by the user from a
contacts list).
#### 6.1.2.2 UE-Network Relay discovery
##### 6.1.2.2.1 Model A
Depicted in figure 6.1.2.2.1.1 is the procedure for Relay discovery Model A.
Figure 6.1.2.2.1.1: Relay discovery with Model A
Step 1:
\- Type = Announcement
\- Discovery Type = UE-NW Relay Discovery
##### 6.1.2.2.2 Model B
Depicted in figure 6.1.2.2.2.1 is the procedure for Relay discovery Model B.
Figure 6.1.2.2.2.1: Relay discovery with Model B
Step 1:
\- Type = Solicitation
\- Discovery Type = UE-NW Relay Discovery
Step 2:
\- Type = Response
\- Discovery Type = UE-NW Relay Discovery
#### 6.1.2.3 Group member discovery
##### 6.1.2.3.1 Model A
Depicted in figure 6.1.2.3.1.1 is the procedure for group member discovery
Model A.
Figure 6.1.2.3.1.1: Group member discovery with Model A
Step 1:
\- Type = Announcement
\- Discovery Type = Group Member Discovery
##### 6.1.2.3.2 Model B
Depicted in figure 6.1.2.3.2.1 is the procedure for group member discovery
Model B.
Figure 6.1.2.3.2.1: Group member discovery with Model B
Step 1:
\- Type = Solicitation
\- Discovery Type = Group Member Discovery
Step 2:
\- Type = Response
\- Discovery Type = Group Member Discovery
#### 6.1.2.4 UE-to-UE Relay discovery
##### 6.1.2.4.1 Model A
Depicted in figure 6.1.2.4.1.1 is the procedure for UE-to-UE Relay discovery
Model A.
Figure 6.1.2.4.1.1: UE-to-UE Relay discovery with Model A
1\. UE-1 (\"this UE\") performs the Group Member Discovery procedure as
described in figure 6.1.2.3.1.1 (Model A) or figure 6.1.2.3.2.1 (Model B). In
the process UE-1 discovers UE-R as its only neighbour.
2\. UE-R (\"the potential relay\") also performs the Group Member Discovery
procedure described in figure 6.1.2.3.1.1 (Model A) or figure 6.1.2.3.2.1
(Model B). In the process UE-R discovers two UEs in vicinity: UE-1 and UE-2.
NOTE 1: The execution of the Group Member Discovery procedure in steps 1 and 2
is a pre-requisite for the execution of the UE-to-UE Relay discovery procedure
proper that only starts at step 3.
3\. UE-R decides that it can act as a UE-to-UE Relay and announces this by
periodically transmitting an Announcement message including the following
parameters:
\- Type = Announcement
\- Discovery Type = UE-to-UE Relay Discovery
\- Announcer Info (i.e. an upper layer identifier for the UE-R user)
\- ProSe UE ID of UE-R (i.e. link-layer identifier of UE-R)
\- A list of \"Remote User Info\" parameters (including users of UE-1 and
UE-2) that have been gathered during Group Member Discovery in step 2.
\"Remote User Info\" is an upper layer parameter identifying the remote user.
4\. Based on the information received in the previous step, UE-1 decides to
establish a one-to-one link with UE-R as described in clause 7.1 and engage in
communication with UE-2 via UE-R (case of stateful relay selection).
##### 6.1.2.4.2 Model B
Depicted in figure 6.1.2.4.2.1 is the procedure for UE-UE Relay discovery
Model B.
Figure 6.1.2.4.2.1: UE-to-UE Relay discovery with Model B
1\. UE-1 (\"this UE\") performs the Group Member Discovery procedure described
in figure 6.1.2.3.1.1 (Model A) or figure 6.1.2.3.2.1 (Model B). In the
process UE-1 discovers UE-R as its only neighbour.
2\. UE-R (\"the potential relay\") also performs the Group Member Discovery
procedure described in figure 6.1.2.3.1.1 (Model A) or figure 6.1.2.3.2.1
(Model B). In the process UE-R discovers two UEs in vicinity: UE-1 and UE-2.
NOTE: The execution of the Group Member Discovery procedure in steps 1 and 2
is a pre-requisite for the execution of the UE-to-UE Relay discovery procedure
proper that only starts at step 3.
3\. Having discovered its neighbours, UE-1 realises that the group member of
interest (\"remote user\") is not within direct range. UE-1 then (in the role
of Discoverer) solicits potential UE-to-UE Relays by transmitting the
Solicitation message including the following parameters:
\- Type = Solicitation
\- Discovery Type = UE-to-UE Relay Discovery
\- Discoverer Info (i.e. an upper layer identifier for the UE-1 user)
\- ProSe UE ID of UE-1 (i.e. link-layer identifier of UE-1)
\- A list of \"Remote User Info\" parameters corresponding to the remote
user(s) of interest (in this case it is the user of UE-2). \"Remote User
Info\" is an upper layer parameter identifying the \"remote user\" of
interest.
4\. Upon reception of the Solicitation message, UE-R (in the role of
Discoveree) realises that it can act as a UE-to-UE Relay and replies with a
Response message including the following parameters:
\- Type = Response
\- Discovery Type = UE-to-UE Relay Discovery
\- Discoveree Info (i.e. an upper layer identifier for the UE-R user)
\- ProSe UE ID of UE-R (i.e. link-layer identifier of UE-R)
\- A list of \"Remote User Info\" parameters corresponding to the remote
user(s) of interest (in this case it is the user of UE-2). The latter have
been gathered during Group Member Discovery in step 2.
5\. Based on the information received in the previous step, UE-1 decides to
establish a one-to-one link with UE-R as described in clause 7.1 and engage in
communication with UE-2 via UE-R (case of stateful relay selection).
### 6.1.3 Impact on Existing Entities and Interfaces
Editor\'s note: Impacts on existing nodes or functionality will be added.
## 6.2 Topics for further study for Direct Discovery (public safety use)
The transport aspects of Direct Discovery for ProSe UE-UE Relay Discovery
(e.g. signalling protocol over ProSe direct communication or adaptation of
ProSe direct discovery for out-of-coverage and Model B support) are FFS,
including how the messages are sent (broadcast, groupcast, unicast).
Resolution: ProSe UE-UE Relay Discovery is not supported in this release.
It is FFS whether the definition of Announcer/ Discoverer/ Discoveree Info is
in the scope of 3GPP.
Resolution: The definition of Announcer Info, Discoverer Info, Discoveree Info
and Target Info is out of ProSe scope.
## 6.3 Conclusions on Direct Discovery (public safety use)
Both Model A and Model B discovery are supported:
\- Model A uses a single discovery protocol message (Announcement);
\- Model B uses two discovery protocol messages (Solicitation and Response).
Public Safety discovery for ProSe UE-Network Relay and Group Member Discovery
uses PC5-D protocol stack.
Editor\'s note: The use of PC5-D transport option for Public Safety is the
working assumption and needs to be reconfirmed subject to LS response from SA
WG1 and SA WG3.
As indicated by RAN with PC5-D discovery the minimum supported one-way latency
is 320ms, if further enhancements are required, this should be addressed by
RAN WGs.
# 7 ProSe Direct Communication enhancements
Editor\'s note: This clause is intended to document the agreed architecture
solutions for ProSe Direct Communication enhancements.
## 7.1 Solution for one-to-one ProSe Direct Communication
Editor\'s note: This clause is intended to document the agreed architecture
solution for one-to-one ProSe Direct Communication.
### 7.1.1 Functional Description
Editor\'s note: General description, assumptions, and principles of the
solution.
#### 7.1.1.1 General
ProSe direct communication one-to-one is realised by establishing a secure
layer-2 link over PC5 between two UEs.
Each UE has a Layer-2 ID for unicast communication that is included in the
Source Layer-2 ID field of every frame that it sends on the layer-2 link and
in the Destination Layer-2 ID of every frame that it receives on the layer-2
link.
NOTE: Conflicts between Destination Layer-2 ID for unicast and one-to-many
communication will be resolved by RAN2 WG.
The UE needs to ensure that the Layer-2 ID for unicast communication is at
least locally unique. So the UE should be prepared to handle Layer-2 ID
conflicts with adjacent UEs using unspecified mechanisms (e.g. self-assign a
new Layer-2 ID for unicast communication when a conflict is detected).
The layer-2 link for ProSe direct communication one-to-one is identified by
the combination of the Layer-2 IDs of the two UEs. This means that the UE can
engage in multiple layer-2 links for ProSe direct communication one-to-one
using the same Layer-2 ID.
#### 7.1.1.2 PC5 Signalling Protocol
A PC5 Signalling Protocol is used for control plane signalling over PC5. The
PC5 Signalling Protocol stack is illustrated in figure 7.1.1.2.1. The SDU Type
field (3 bits) in the PDCP header is used to discriminate between IP, ARP and
\"PC5 Signalling Protocol\".
Editor\'s note: The use of PC5 Signalling Protocol as described in this clause
is a working assumption and needs to be reconfirmed.
Figure 7.1.1.2.1: PC5 Signalling Protocol stack
PC5 Signalling Protocol messages may be sent on a unicast Destination Layer-2
ID.
The following functionality is enabled by the PC5 Signalling Protocol:
**\- 1:1 ProSe Communication** : Direct Communication Request message (Step 1
in figure 7.1.2.1.1), potentially including the subsequent messages.
**\- TMGI advertisement and eMBMS traffic relay** : defined in clause 7.2.2.2,
and specifically, TMGI Monitoring Request and Response messages
**\- Cell ID announcement procedure:** defined in clause 7.2.2.3, and
specifically Cell ID Announcement Request /Response messages.
### 7.1.2 Procedures
Editor\'s note: Describes the high-level operation, procedures and information
flows for the solution.
ProSe direct communication one-to-one is composed of the following procedures:
\- Establishment of a secure layer-2 link over PC5.
\- IP address/prefix assignment.
\- Layer-2 link maintenance over PC5.
\- Layer-2 link release over PC5.
#### 7.1.2.1 Establishment of secure layer-2 link over PC5
Depicted in figure 7.1.2.1.1 is the procedure for establishment of secure
layer-2 link over PC5. The message includes the User Info-1 parameter that is
used to assert the identity of the UE-1\'s user. UEs engaged in isolated (non-
relay) one to one communication may negotiate the link-local address to be
used for subsequent communication.
Figure 7.1.2.1.1: Establishment of secure layer-2 link over PC5
1\. UE-1 sends a Direct Communication Request message to UE-2 in order to
trigger mutual authentication. If link local address is used, UE 1 includes
the configured link-local address in the Direct Communication Request message.
UE 1 may include both an IPv4 address and an IPv6 address in the message to
facilitate that UE 2 can choose the address of the IP version it supports,
NOTE 1: The link initiator (UE-1) needs to know the Layer-2 ID of the peer
(UE-2) in order to perform step 1. As an example, the link initiator may learn
the Layer-2 ID of the peer by executing a discovery procedure first or by
having participated in ProSe one-to-many communication including the peer.
NOTE 2: \"Secure layer-2 link\" implies at least mutual authentication between
the two users. Whether bearer level confidentiality or integrity protection
over PC5 is mandatory or not is in SA WG3 scope.
2\. UE-2 initiates the procedure for mutual authentication. As part of this
step UE-2 includes the User Info-2 parameter that is used to assert the
identity of the UE-2\'s user. The successful completion of the authentication
procedure indicates the establishment of the secure layer-2 link over PC5. UE
2 checks whether it supports the link local address of IP version indicated in
step 1. If it supports, UE 2 responds a Direct Communication Response (link-
local address of UE 2) message.
Editor\'s note: It is FFS whether User Info parameter used in this procedure
is the same as the Announcer/ Discoverer/ Discoveree Info parameter used in
the Public Safety Discovery procedures. It depends on the asserted identity
that will be defined in the security procedures in SA WG3.
#### 7.1.2.2 IP address assignment
At least the following standard IETF mechanisms are used for IP address/prefix
assignment:
\- DHCP based IP address configuration for assignment of IPv4 address.
\- IPv6 Stateless Address auto configuration specified in RFC 4862 [6] for
assignment of IPv6 prefix.
One of the two UEs acts as DHCP server or IPv6 default router.
In the ProSe UE-NW Relay case the relay acts as DHCP server or IPv6 default
router for all Remote UEs that connect to it over a secure layer-2 link over
PC5, detail procedures are described in clause 7.2.2.1.
UEs engaging in isolated (non-relay) one-to-one communication may also use
link-local addresses. UE auto-configures link-local address using procedures
as defined in RFC 4862 in case of IPv6 and in RFC 3927 in case of IPv4.
#### 7.1.2.3 Layer-2 link maintenance over PC5
The PC5 Signalling Protocol shall support keep-alive functionality that is
used to detect that when the UEs are not in ProSe Communication range, so that
they can proceed with implicit layer-2 link release.
NOTE: It is left to Stage 3 to determine how and when the keepalive messages
are used.
#### 7.1.2.4 Layer-2 link release over PC5
Depicted in figure 7.1.2.4.1 is layer-2 link release procedure over PC5. This
procedure can be also used to release the layer-2 link between the Remote UE
and the UE-to-Network Relay, initiated by either the Remote UE or the Relay
e.g. due to temporary loss of connectivity to the network, battery running low
of the relay, etc.
Figure 7.1.2.4.1: Layer-2 link release over PC5
1\. UE-1 sends a Disconnect Request message to UE-2 in order to release the
layer-2 link and deletes all context data associated with.
2\. Upon reception of the Disconnect Request message UE-2 responds with a
Disconnect Response message and deletes all context data associated with the
layer-2 link.
### 7.1.3 Impact on Existing Entities and Interfaces
Support for following PC5 functionality:
\- PC5 Signalling Protocol and procedures.
\- Additional mechanisms for IP address assignment.
### 7.1.4 Topics for further study for one-to-one ProSe Direct Communication
It is FFS whether the Direct Communication Request message (step 1 in figure
7.1.2.1.1) and the authentication messages (step 2 in figure 7.1.2.1.1) belong
to the same or different protocols.
Resolution: PC5 signalling protocol is used for both Direct Communication
Request message and authentication messages.
It is FFS whether there is a need for other mechanisms for IP address
assignment (e.g. to assist service continuity between the direct path and the
infrastructure path between the two UEs, or for the case of an isolated (i.e.
non-relay) one-to-one communication).
Resolution: service continuity between the direct path and the infrastructure
path is not supported.
It is FFS whether one-to-one communication requires real-time network
authorisation when the two UEs are in coverage.
Resolution: in SA WG3 scope
It is FFS how Layer-2 ID for unicast communication is assigned to the UE,
whether the same Layer-2 ID can be used for multiple layer-2 links for one-to-
one communication and whether the same Layer-2 ID can be used for Source
Layer-2 ID of both one-to-one and one-to-many communication. This FFS applies
to both cases when bearer level security as defined by TS 33.303 [11] is used
and when it is not.
Layer-2 ID for unicast communication is provided to the UE during provisioning
time according to the provisioning options described in clause 6.1.2.1.
The same Layer-2 ID can be used for multiple layer-2 links for one-to-one
communication. The same Layer-2 ID can be used for Source Layer-2 ID of both
one-to-one and one-to-many communication. Whether and how bearer layer
security is applied is in SA WG3 scope.
The Layer-2 ID can also be self-assigned by the UE (e.g. to avoid Layer-2 ID
conflict with adjacent UEs, or for ProSe UE-to-Network Relay operation).
The Layer-2 ID used as the Source Layer-2 ID in one-to-one ProSe Direct
Communication frames sent from UE-1 to UE-2 is used as the Destination Layer-2
ID in the frames sent from UE-2 to UE-1.
### 7.1.5 Conclusions on one-to-one ProSe Direct Communication
The PC5 transport for signalling and user plane should follow the same per
packet priority treatment defined in clause 7.5.1.
## 7.2 Solution for ProSe UE-Network Relays
Editor\'s note: This clause is intended to document the agreed architecture
solution for ProSe UE-Network Relays.
### 7.2.1 Functional Description
#### 7.2.1.1 General
The UE-to-Network Relay function will be specified based upon an evolution of
the ProSe functionality already documented in TS 23.303 [3].
#### 7.2.1.2 Unicast relaying
The ProSe UE-to-Network Relay function includes support for the relay of
unicast traffic (UL and DL) between Remote UEs that are not served by E-UTRAN
and the network. The ProSe UE-to-Network Relay provides generic L3 forwarding
function that can relay any type of IP traffic that is relevant for public
safety communication. The ProSe UE-Network Relay is a Layer-3 relay (figure
7.2.1.2.1).
Figure 7.2.1.2.1: ProSe UE-to-Network Relay
The One-to-One Communication between Remote UE and ProSe UE-Network Relay is
described in clause 7.1.
The ProSe UE-Network Relay uses the uplink TFTs to select the uplink EPS
bearers for relayed uplink packets independently from the ProSe Per Pocket
Priority applied over PC5.
The ProSe UE-Network Relay maps the EPS bearer\'s QCI into a ProSe Per Packet
Priority value to be applied for the downlink relayed unicast packets over
PC5. The mapping rules are configured in the ProSe UE-Network Relay UE.
#### 7.2.1.3 eMBMS relay support
The UE-to-Network Relay function will include support for the relay of eMBMS
to Remote UEs served by the UE-to-Network Relay. This functionality allows for
the relaying of eMBMS traffic related to specific TMGIs as requested by served
Remote UEs. As part of this functionality:
\- The UE-to-Network Relay shall advertise the availability of specific TMGIs
when this has been requested by served Remote UEs.
\- UEs that request the relay to advertise the availability of a certain TMGI
and to relay the related traffic need to keep alive a soft state in the Relay
so that the relay can continue to perform TMGI monitoring and the related
traffic forwarding. When this soft state is not kept alive for a given TMGI,
the UE-to-Network Relay stops advertising availability of the TMGI and stops
the relaying of the related eMBMS traffic.
\- The UE-to-Network Relay shall send the eMBMS traffic over a one to many
direct communication link to the Remote UEs, using as a destination Layer 2
address a ProSe Layer 2 Group ID which will have been previously provided by
the relay to the Remote UEs.
\- The ProSe UE-to-Network Relay does not terminate eMBMS or higher layer
security procedures used to secure the media transmitted over the eMBMS
bearers. The UE-to-Network Relay just transparently transfers, over the PC5
one-to-many link, the traffic it receives.
#### 7.2.1.4 Support of ECGI announcement
Some applications require the knowledge of the ECGI of the cell serving the
UE, e.g. to perform counting of UEs served by the same cell.
For the purpose of these applications, when a UE is behind a ProSe UE-to-
Network relay (so it is a Remote UE for this ProSe UE-to-Network relay), the
serving cell of this Remote UE is the cell serving the ProSe UE-to-Network
relay. So, the announcement of the ECGI by a ProSe UE-to-Network relay allows
Remote UEs served by a ProSe UE-to-Network relay to receive the value of the
ECGI of the cell serving the ProSe UE-to-Network relay. This enables the
reporting of this ECGI for these applications.
An example of an application requirement may be the dynamic activation of
eMBMS in the cell where the ProSe UE-to-Network relay is camping, if there is
a sufficient number of devices behind the ProSe UE-to-Network relay, in order
to avoid e.g. unicast distribution of multiple application streams of the same
content in unicast mode to different devices under the same ProSe UE-to-
Network relay (note that aggregation of unicast streams at an agent in the
ProSe UE-to-Network relay is not possible when the relay is behaving as Layer
3 device).
The ECGI obtained by a relay should be used by applications that can handle it
appropriately (e.g. impact on location service relaying on ECGI should be
understood and alternate location methods may be more appropriate in certain
domain of application). So, it is application dependent whether the ECGI
obtained by a relay can be used or not and how the application reports it to
the server (i.e. whether an explicit indication is needed this is obtained by
a relay, or not).
Editor\'s note: This feature needs to be supported if the dynamic activation
of eMBMS content distribution based on application layer ECGI reporting is
supported in Relâ€‘13. The interaction between the dynamic establishment of
eMBMS based on application layer ECGI reporting and any potential RAN-level
counting needs to be studied as part of the work on dynamic activation of
eMBMS content distribution based on application layer ECGI reporting.
### 7.2.2 Procedures
Editor\'s note: Describes the high-level operation, procedures and information
flows for the solution.
#### 7.2.2.1 Relay Discovery and one-to-one communication establishment
The ProSe UE-Network Relay may attach to the network (if not already attached)
and establish a PDN connection that can be used for relaying of traffic
to/from Remote UEs.
Figure 7.2.2.1: Call flow for ProSe UE-Network Relay
1\. The ProSe UE-Network Relay performs initial E-UTRAN Attach (if not already
attached) and/or establishes a PDN connection for relaying (if no appropriate
PDN connection for this relaying exists). In case of IPv6, the ProSe UE-
Network Relay obtains IPv6 prefix via prefix delegation function from the
network as defined in TS 23.401 [7].
2\. The Remote UE performs discovery of a ProSe UE-Network Relay using Model A
or Model B discovery. The details of this procedure are described in clause 6.
3\. The Remote UE selects a ProSe UE-Network Relay and establishes a
connection for One-to-One Communication. The details of this procedure are
described in clause 7.1.
NOTE 1: Whether the authentication of the Remote UE involves the EPC will be
decided by SA WG3.
4\. When IPv6 is used on PC5 the Remote UE performs IPv6 Stateless Address
auto-configuration, the Remote UE shall send a Router Solicitation message
(step 4a) to the network using as Destination Layer-2 ID the Layer-2 ID of the
Relay in order to solicit a Router Advertisement message (step 4b) as
specified in IETF RFC 4862 [6]. The Router Advertisement messages shall
contain the assigned IPv6 prefix. After the Remote UE receives the Router
Advertisement message, it constructs a full IPv6 address via IPv6 Stateless
Address auto-configuration in accordance with IETF RFC 4862 [6]. However, the
Remote UE shall not use any identifiers defined in TS 23.003 [8] as the basis
for generating the interface identifier. For privacy, the Remote UE may change
the interface identifier used to generate the full IPv6 address, as defined in
TS 23.221 [9] without involving the network. The Remote UE shall use the auto-
configured IPv6 address while sending packets.
5\. When IPv4 is used on PC5 the Remote UE uses DHCPv4 [10]. The Remote UE
shall send DHCPv4 Discovery (step 5a) message using as Destination Layer-2 ID
the Layer-2 ID of the Relay. The ProSe UE-Network Relay acting as a DHCPv4
Server sends the DHCPv4 Offer (step 5b) with the assigned Remote UE IPv4
address. When the Remote UE receives the lease offer, it sends a DHCP REQUEST
message containing the received IPv4 address (step 5c). The ProSe UE-Network
Relay acting as DHCPv4 server sends a DHCPACK message to the Remote UE (step
5d) including the lease duration and any other configuration information that
the client might have requested. On receiving the DHCPACK message, the Remote
UE completes the TCP/IP configuration process.
NOTE 2: The DHCPv4 client may skip the DHCPv4 Discovery phase, and send DHCPv4
Request message in broadcast as the first message in accordance with the
DHCPv4 renewal process.
#### 7.2.2.2 TMGI advertisement and eMBMS traffic relay
The following procedure illustrated in figure 7.2.2.2.1 here below is used by
a ProSe-enabled Public safety UE to request a ProSe UE-to-Network Relay to
start monitoring a specific TMGI availability and that the ProSe UE-to-Network
Relay broadcasts this TMGI by using Relay Discovery Additional Information
sent on the discovery transport, when it is detected on the MCCH of the
serving cell. The eMBMS traffic related to this TMGI, if available, is also
forwarded to the remote UE\'s served by the relay over a one-to-many link
identified by a specific ProSe Layer-2 Group ID provided by the Relay when the
procedure is executed.
Figure 7.2.2.2.1: TMGI monitoring request procedure
1) The UE has successfully discovered the ProSe UE to Network Relay and has
obtained (perhaps after a one to one communication sessions with the relay)
from a Group communication application the related service description that
contains the TMGI, radio frequencies, and MBMS SAIs the UE should use to
receive related eMBMS content. The UE obtains the user service description it
is interested in either by static configuration or by interaction with the
Group Communication Application. This interaction can happen before or after
the UE has joined the relay.
2) The UE sends to the ProSe UE-to-Network Relay a TMGI Monitoring
Request(TMGI, MBMS SAIs) where TMGI value and MBMS SAIs are obtained at step
1.
NOTE 1: The UE sends to the ProSe UE-to-Network Relay a TMGI Monitoring
Request message even if it already knows the ProSe Layer-2 Group ID_traffic
for the corresponding TMGI.
3) The ProSe UE-to-Network Relay retrieves the MBMS SAI list from the
broadcast of the cell camped on as specified in 3GPP TS 36.331 [14] and checks
whether at least one of the MBMS SAIs obtained at step 2 is included in the
MBMS SAI list.
4) Upon detection of at least one of the MBMS SAIs, the ProSe UE-to-Network
Relay acknowledges receipt of the request in step 2 with a TMGI Monitoring
Response( ProSe Layer 2 Group ID_traffic, TMGI_Monitoring_Refresh Timer). The
ProSe Layer 2 Group ID_traffic is used to forward to Remote UEs the eMBMS
content related to the TMGI value received at step 2. The
TMGI_Monitoring_Refresh Timer (configurable in the ProSe UE-to-Network Relay)
is provided to the UE so that when this timer elapses the UE shall execute the
TMGI monitoring request procedure if it still needs to monitor the TMGI. If a
UE does not execute the TMGI Monitoring Request procedure when this
TMGI_Monitoring_Refresh Timer expires in the UE and no other UE in executes
the refresh procedure for this TMGI, then when the TMGI_Monitoring_Refresh
Timer for the TMGI expires in the relay, the relay shall stop monitoring the
TMGI and also to forward any related content if it was doing so. It is assumed
that bearer level security is not applied to PC5 ProSe one-to-may link for
MBMS traffic relay.
5) The ProSe UE-to-Network Relay detects the TMGI it has been requested to
monitor.
NOTE 2: The action applicable when the UE is unable to simultaneously receive
eMBMS and unicast services (e.g. eMBMS and unicast services use different
frequencies) is up to UE implementation.
6) Upon detection of the TMGI, the ProSe UE-to-Network Relay broadcasts
availability of the TMGI and the corresponding ProSe Layer 2 Group ID_traffic
by sending a TMGI Announcement(TMGI, ProSe Layer 2 Group ID_traffic) message
using an Relay Discovery Additional Information announcement on discovery
transport. This is repeated with a configurable (in the ProSe UE to Network
Relay) repetition interval which should normally be smaller than the
TMGI_Monitoring_Refresh Timer. The value of the TMGI may be used by devices
discovering the UE-to-Network Relay as a preference criterion for Relay
selection, if they are interested in the TMGI the relay is advertising.
7) The UE detects the announcement of step 6 and subsequently starts to
receive the broadcast content on the PC5 ProSe one-to-many link associated to
the Prose Layer-2 Group ID_traffic defined at step 4, and may release unicast
distribution leg if any was being used.
NOTE 3: The UE belonging to an announced TMGI may receive the relayed eMBMS
traffic via ProSe Layer-2 Group ID_traffic even if the UE does not yet
complete the TMGI monitoring request/response procedure.
8) Upon detection of loss of TMGI, the ProSe UE-to-Network Relay stops
broadcasting availability of the TMGI. It may also (optionally) send a
positive indication of loss of TMGI so as to accelerate loss of TMGI detection
in the UE (not shown in the procedure). The UE may request a unicast
distribution leg from the GCS AS
9) The UE stops receiving the broadcast content on the PC5 ProSe one-to-many
link associated to the Prose Layer Group-2 ID_traffic defined at step 4.
NOTE 4: The relative ordering between step 8 and 9 may be dependent on when
the eMBMS content becomes unavailable in the cell.
#### 7.2.2.3 Cell ID announcement procedure
The following procedure outlined in figure 7.2.2.3.1 allows an authorized
public safety UE, based on application requirements outside the scope of the
present procedure, to request a ProSe UE-to-Network Relay to announce the
EUTRAN Cell Global ID (ECGI) of the Cell serving the ProSe UE-to-Network
Relay.
Figure 7.2.2.3.1: Cell ID announcement request procedure
1) A UE has discovered a ProSe UE-to-Network relay and an application requires
serving cell ECGI reporting even when it is behind a relay (i.e. the
application benefits from this value even if it is the value of the cell
serving the relay and not the UE directly).
2) The UE sends to the ProSe UE-to-Network relay a Cell ID Announcement
Request() to support the needs of such application
3) The ProSe UE-to-Network relay acknowledges receipt of the request in step 2
with a Cell ID Announcement Request (ECGI_Announcement_Request_Refresh Timer).
The ECGI_Announcement_Request_Refresh Timer, (configurable in the ProSe UE to
network relay) is provided to the UE so that when this timer elapses the UE
shall repeat the Cell ID Announcement Request procedure if it still needs
obtain the ECGI. If a UE does not execute the Cell ID Announcement Request
procedure when this ECGI_Announcement_Request_Refresh Timer expires and no
other UE request ECGI announcement before the
ECGI_Announcement_Request_Refresh timer expires in the UE-to-Network relay,
then the relay shall stop announcing the ECGI of the serving cell.
4) The ProSe UE-to-Network Relay announces the ECGI of the serving cell by
sending a Cell ID Announcement (ECGI) using a Relay Discovery Additional
Information announcement on discovery transport. This is repeated periodically
with a configurable frequency (normally Higher than the one related to the
ECGI_Announcement_Request_Refresh Timer) until there is no UE requesting to
announce the ECGI as determined by the ECGI_Announcement_Request_Refresh Timer
running in the ProSe UE-to-Network relay.
5) The ProSe UE-to-Network Relay may at any time detect the ECGI of a new
serving cell it is happening to be camping on
6) Step 5 triggers the ProSe UE-to-Network Relay to announce the ECGI of the
serving cell immediately and repeat it periodically with a configurable
frequency as in step 4 until there is no UE requesting to announce the ECGI as
determined by the ECGI_Announcement_Request_Refresh Timer running in the ProSe
UE-to-Network relay.
#### 7.2.2.4 Multicast/Broadcast traffic support using IP Multicast on Relay
This procedure may be used as an alternative to that of clause 7.2.2.2, or as
the result of the ProSe UE-to-Network Relay not supporting that procedure
and/or the network not providing eMBMS service to the ProSe UE-to-Network
relay.
There may be multiple ProSe UEs (\"Remote UEs\") belonging to the same group
in contact with one ProSe UE-to-Network Relay. To enable battery (and radio)
efficient transmissions from the ProSe UE-to-Network Relay for this group the
steps presented in Figure 7.2.2.4.1 occur:
Figure 7.2.2.4.1: Multicast/Broadcast traffic support using IP Multicast on
Relay
0) While in network coverage the \"Remote UE\" is configured with the contact
name (URL) or IP address of the Control Plane part of Group Call Service
Application Server.
NOTE The Control Plane and User Plane parts of the GCS AS can be combined in
one node.
1) The ProSe Relay UE is authorised to act as a PS Relay (or rejected) by its
MME when it attempts to activate the ProSe Relay PDN. The ProSe Relay PDN is
an intranet. When the ProSe Relay UE activates the ProSe Relay PDN, the PCO
carries an indication as to whether it supports IP Multicast. This indication
is transferred to the Control Plane part of the GCS AS. The mechanism to do
this is FFS. By configuration, the GCS AS knows whether or not the ProSe Relay
PDN\'s PDN GW supports IP Multicast.
2) After the Remote UE contacts the ProSe UE-to-Network Relay, the ProSe UE-
to-Network Relay allocates the Remote UE a locally significant IP address.
3) The Remote UE contacts the Control Plane part of GCS AS and is authorised
and authenticated (or rejected).
4a) The Control Plane part of GCS AS informs the Remote UE of the IP Multicast
address(es) that the Remote UE\'s group is using (and - to avoid tracking
-those IP multicast addresses that will be used by the group in the short term
future). The IP Multicast Address(es) identify the User Plane part of the GCS
AS that is performing the Unicast Bridging of the group communication.
4b) The GCS AS notes that the Remote UE is using this ProSe UE-to-Network
Relay and (until step 10) uses unicast to distribute data to this Remote UE
(this is in case the ProSe UE-to-Network relay or PDN GW do not support IP
Multicast).
5) The Remote UE sends an IGMP Membership Report (MLD Multicast Listener
Report in case of IPv6) to the ProSe UE-to-Network Relay.
6) The ProSe UE-to-Network Relay shall act as an IGMP Proxy (MLD proxy in case
of IPv6) as specified in RFC 4605 [12]. If the ProSe UE-to-Network Relay is
not already a member of that IP multicast group, the ProSe UE-to-Network Relay
sends the IGMP Membership Report (MLD Multicast Listener Report in case of
IPv6) to the PDN GW serving the ProSe Relay PDN to join the multicast group.
7) If not already a member of that IP multicast group that PDN GW performs the
necessary steps (e.g. using Protocol Independent Multicast mechanisms) to
receive that group\'s media from the User Plane part of the GCSâ€‘GW. The ProSe
UE-to-Network Relay is added to the PDN GW\'s (ProSe UE-to-Network Relay\'s)
IP multicast distribution tree.
8) The User Plane part of the GCS AS sends the media on both the IP unicast
and IP multicast paths to the Remote UE.
9) When the ProSe UE-to-Network Relay receives IP packets on the Relay PDN
containing an IP multicast address, it checks whether it has any Remote UEs
for that group, and if it has one or more, the Relay then transmits that
packet on the radio interface towards the Remote UE(s). During the forwarding
there is no need to perform NATting as it is described in RFC 5135 [13].
The ProSe UE-to-Network Relay transmits the packet using a ProSe Layer-2 Group
ID that corresponds to the 24 low order bits of the IP multicast address.
Having received the IP multicast address in step 4a, the Remote UEs filter out
the received frames based on the ProSe Layer-2 Group ID contained in the
Destination Layer-2 ID and deliver the enclosed packet to the upper layers.
The IP stack further filters the received packets based on the Group IP
multicast address.
The \"Remote UE\" may also have been configured with security parameters
corresponding to this ProSe Layer-2 Group ID using existing procedures defined
in TS 33.303 [11].
Editor\'s note: The exact mechanism to associate the IP multicast address with
the ProSe layer 2 Group ID is FFS. Also the above security mechanism is FFS,
Alternative(s) e.g. involving PC5 control plane signalling may be proposed.
10) When a Remote UE receives its group\'s media on the IP multicast address,
the Remote UE informs the Control Plane part of GCS AS that it has
successfully joined the multicast group.
11) The User Plane part of the GCS AS then sends the media for that group for
that Remote UE only on the IP multicast address.
### 7.2.3 Impact on Existing Entities and Interfaces
Editor\'s note: Impacts on existing nodes or functionality will be added.
\- The proposed solution in clause 7.2.2.1 requires:
\- depending on security aspects on establishment of connection for one-to-one
communication, UE or EPC entities could be impacted. (in scope of SA WG3)
\- The proposed solution in clause 7.2.2.4 requires:
\- the ProSe Relay PDN\'s PDN GW supports IP multicasting in downlink
direction;
\- the ProSe UE-to-Network Relay supports forwarding of IP multicast packets
in downlink direction, and IGMP and/or MLD proxy;
\- GCS AS supports IP multicast
### 7.2.4 Topics for further study for ProSe UE-Network Relays
The following issues need to be resolved:
\- It is FFS whether a security association between the UE and the UE-to
Network relay is per UE or per ProSe Application Group.
Resolution: this is in scope of SA WG3.
\- It is FFS if the IP Address preservation is supported when the Remote UE
moves out of the ProSe UE-Network Relay coverage
Resolution: IP address preservation is not supported when the Remote UE moves
out of the ProSe UE-Network Relay coverage
\- It is FFS whether for IPv4 the Prose UE-to-Network relay will have to
implement NAT functionality.
Resolution: NAT shall be supported by Relays supporting IPv4.
\- It is FFS whether and how the EPC is aware of the remote UE\'s presence
(e.g. for the purpose of authorisation, QoS, LI, etc.) in absence of direct
NAS signalling connection between the Remote UE and the MME.
\- It is FFS how a ProSe UE-to-Network Relay performs priority handling of
Remote UEs, as part of the broader topic on how to handle priority for ProSe
communications in general.
Resolution: The PC5 transport for signalling and user plane between the Remote
UE and the ProSe UE-Network Relay should use the same ProSe Priority and QoS
mechanisms for PC5 defined in clause 7.5.1.
\- It is FFS how the ProSe UE-to-Network relay applies per packet priority to
the downlink traffic.
Resolution for unicast traffic: ProSe UE-Network Relay maps the QCI of the EPS
bearer into a ProSe Per Packet Priority value to be applied for the downlink
relayed unicast packets over PC5. The mapping rules are provisioned in the
Relay UE.
Editor\'s note: For downlink unicast traffic it is FFS whether for determining
of ProSe Per Packet Priority of downlink packets the Relay UE needs to use
additional information.
Final decision between these options will depend on analysis of the PCC
impacts for ProSe UE-Network Relay and RAN feedback on PDCP/MAC impacts.
### 7.2.5 Conclusions on ProSe UE-Network Relays
The ProSe UE-Network Relay is a Layer-3 relay (i.e. an IP router), as agreed
in Rel-12 ProSe.
The MBMS Relay information, TMGI, and ECGI, is sent in a Relay Discovery
Additional Information Discovery message
A Relay UE supporting eMBMS traffic may transmit multiple discovery messages
that contain ECGI and/or the TMGIs .
The triggering of TMGI advertisement, ECGI advertisement and establishment of
the ProSe one-to-one communications links are based on the PC5 Signalling
Protocol introduced in clause 7.1.1.2.
The Relay selection and reselection procedure needs to consider both the upper
layer discovery information defined in clause 6.1.2.1 and the radio layer
information that will be defined by RAN. The interactions between these
considerations at different layers are implementation specific. The ProSe
Function shall be able to configure the Remote UE with a set of radio layer
selection criteria for using the radio layer information in UE-to-Network
Relay selection. Relay reselection when required is performed using relay
selection procedure.
NOTE: The radio level information and radio layer selection criteria will be
specified by RAN WGs. Relay selection/reselection may need to be evaluated
based on RAN2 work.
ProSe UE-Network Relay procedure based on what is defined in the sub-clause
7.2.2.1 should proceed to the normative work except authentication part which
would be done by SA WG3.
The solution for multicast/broadcast traffic support using IP multicast on
relay described in clause 7.2.2.4 is not considered for specification in
Rel-13.
## 7.3 Solution for ProSe UE-UE Relays (stateful relay selection)
Editor\'s note: This clause is intended to document the agreed architecture
solution for ProSe UE-UE Relays.
### 7.3.1 Functional Description
Editor\'s note: General description, assumptions, and principles of the
solution.
When a public safety UE (i.e. the initiator) needs to communicate with another
public safety UE (i.e. the target) which is not in proximity, the initiator
may try to communicate with the target via a UE-to-UE Relay. The solution for
ProSe UE-UE Relay includes the following principles:
\- The selection of a ProSe UE-UE Relay shall be based on ProSe Direct
Discovery on the PC5 interface.
### 7.3.2 Procedures
Editor\'s note: Describes the high-level operation, procedures and information
flows for the solution.
### 7.3.3 Impact on Existing Entities and Interfaces
Editor\'s note: Impacts on existing nodes or functionality will be added.
### 7.3.4 Topics for further study on ProSe UE-UE Relays (stateful relay
selection)
Editor\'s note: Topics for FFS will be collected for this particular
functionality.
The following issues need to be resolved:
\- It is FFS which information is considered for ProSe UE-UE Relay selection.
\- It is FFS whether the QoS is supported on PC5 interface and how to support
QoS on PC5 interface.
### 7.3.5 Conclusions on ProSe UE-UE Relays (stateful relay selection)
Editor\'s note: Conclusions will be collected for this particular
functionality.
## 7.4 Solution for ProSe UE-UE Relays (stateless forwarding)
### 7.4.1 Functional Description
There is no single target UE in a point-to-multipoint group communication,
instead there will be a potentially large population of UEs (users) that will
want to receive communications for the Group concerned. Likewise, the source
UE for group traffic packets will change as different users request to talk.
For any given listening (receiving) UE (UErx1), an appropriate relay node
given an initial source (transmitting) UE (UEtx1) will not necessarily be an
effective relay node when the right to talk changes to a different UE (UEtx2).
Typical MCPTT communication will involve multiple, and often frequent, changes
of the source point of the traffic. At any point in time voice packets
generated at the current source UE will (ideally) need to be communicated to
all other UEs affiliated to the relevant communications group and using one-
to-many ProSe Direct Communication in that geographic location. The discovery
and establishment of static or semi-static point-to-point relay relationships
will not address the fluid nature of the relationships between UEs, due to
their mobility, nor will it address the frequent and unpredictable change of
source UE.
Given the mobility of UEs and the frequent change of data source a different
approach is required in order to provide effective UE-to-UE relay support for
a population of users at an incident location engaging in group communication.
### 7.4.2 Procedures
#### 7.4.2.1 Forwarding of ProSe Group Communications by Stateless ProSe UE-UE
Relay (without UE-UE Relay discovery)
Figure 7.4.2.1.1: Forwarding of ProSe Group Communications by Stateless ProSe
UE-UE Relay
1\. UE-1, if it desires the communication to be relayed, sets the
TTL(IPv4)/Hop Limit(IPv6) in the IP multicast packet to \"2\" and sends the IP
data to the IP multicast address using the ProSe Layer-2 Group ID as
Destination Layer-2 ID as defined in clause 5.4.2 One-to-many ProSe Direct
Communication transmission of TS 23.303 [3]. If no relaying is desired UE-1
will set it to \"1\".
UE-2 receives the IP data sent by UE-1 as defined in clause 5.4.3 One-to-many
ProSe Direct Communication reception of TS 23.303 [3].
2\. UE-2 is enabled or configured as a Stateless UE-to-UE Relay for the ProSe
Layer-2 Group ID of the received packet and if the TTL (IPv4)/Hop Limit(IPv6)
is >1 then it decides to relay the packet.
Editor\'s note: It is FFS how the amount of flooding can be reduced beyond the
one-hop forwarding limitation. With the current proposal if there are X UEs
that are all within each other\'s range and are all enabled or configured to
act as a UE-to-UE Relay there will be (X-1) redundant retransmissions.
3\. UE-2 forwards the IP packet received from UE-1 using the ProSe Layer-2
Group ID as Destination Layer-2 ID as defined in clause 5.4.2 One-to-many
ProSe Direct Communication transmission of TS 23.303 [3], after setting the
TTL(IPv4)/Hop Limit(IPv6) in the IP multicast packet to \"1\". The Source
Layer-2 ID is set to the ProSe UE ID (i.e. link-layer identifier) of UE-2.
UE-3 receives the IP data forwarded by UE-2. If a UE receives the same packet
via multiple ProSe UE-to-UE Relays or from a ProSe UE-to-UE Relay and the
original source, the UE application discards any received duplicate data
packet(s) based on application layer mechanisms.
7.4.3 Impact on Existing Entities and Interfaces
Editor\'s note: Impacts on existing nodes or functionality will be added.
7.4.4 Topics for further study on ProSe UE-UE Relays (stateless forwarding)
Editor\'s note: Topics for FFS will be collected for this particular
functionality.
The following issues need to be resolved:
\- It is FFS whether approaches to limiting the forwarding of packets, by
ProSe UE-to-UE Relays, which are especially applicable to group communications
should be considered.
\- It is FFS whether neighbour discovery protocols (e.g. such as MANET-NHDP
RFC 6130) to perform neighbour discovery and relay self-selection in a self-
organising manner, should be employed.
\- It is FFS whether all UEs must be UE-to-UE Relay capable and authorized or
whether some UEs may benefit from the relay support without themselves
offering relay support. If so, appropriates procedures need to be specified.
\- Assessment of impact on power consumption and radio resource due to
flooding by multiple Stateless ProSe UE-to-UE Relays which are in
communication range of the original source.
7.4.5 Conclusions on ProSe UE-UE Relays (stateless forwarding)
Editor\'s note: Conclusions will be collected for this particular
functionality.
## 7.5 Other ProSe Direct Communication related aspects
Editor\'s note: This clause will contain the solutions for other communication
related aspects such as service continuity, QoS enhancements/premption etc as
listed in objective ix of eProSe_Ext WID
### 7.5.1 Solution for ProSe Priority and QoS
#### 7.5.1.1 Functional Description
Editor\'s note: General description, assumptions, and principles of the
solution.
The Priority of a ProSe communication transmission is selected by the
application layer based on criteria that are not in scope of ProSe
specifications.
The design of the way the application layer and the ProSe communication lower
layers interact should be neutral to the way the UE is accessing the medium
i.e. whether scheduled, or autonomous transmission modes are used.
When requesting any transmission (i.e. either using one-to-one or one-to-many
transport), the UE upper layers provide the lower layers a ProSe Per-Packet
Priority from a range of possible values. ProSe Per-Packet Priority of the
transmission is independent of the destination address.
The access stratum uses this ProSe Per-Packet Priority associated with the
protocol data unit as received from upper layers to prioritise in respect with
other intra-UE transmissions (i.e. protocol data units associated with
different priorities awaiting transmission inside the same UE) and inter-UE
transmissions (where possible). Priority queues (both intra-UE and inter-UE
(where possible)) are expected to be served in strict priority order i.e. the
scheduler in UE or eNB serves all packets associated with ProSe Per-Packet
Priority N before serving packets associated with priority N+1 (lower number
meaning higher priority).
The way the medium is accessed in scheduled or autonomous transmission modes,
while respecting the ProSe Per-Packet Priority selected by applications, is in
scope of RAN WGs.
Support of 8 levels for the ProSe Per-Packet Priority should be sufficient to
support a wide range of applications.
#### 7.5.1.2 Procedures
Editor\'s note: Describes the high-level operation, procedures and information
flows for the solution.
#### 7.5.1.3 Impact on Existing Entities and Interfaces
Editor\'s note: Impacts on existing nodes or functionality will be added.
UE
\- Supports an interface allowing the Application layer to indicate,
independent of the transmission mode ProSe Per-Packet Priority.
eNB
\- Support appropriate prioritization scheme(s) for both scheduled and
autonomous transmission modes as defined by RAN WGs
### 7.5.2 Solution for service continuity
#### 7.5.2.1 Functional Description
Editor\'s note: General description, assumptions, and principles of the
solution.
Editor\'s note: It is FFS whether service continuity for switching between EPC
path and ProSe Communication path, as well as service continuity when UE loses
direct connection with the network and re-connects via a ProSe UE-to-Network
Relay, need to be addressed as part of eProSe-Ext or MCPTT or both.
#### 7.5.2.2 Procedures
Editor\'s note: Describes the high-level operation, procedures and information
flows for the solution.
#### 7.5.2.3 Impact on Existing Entities and Interfaces
Editor\'s note: Impacts on existing nodes or functionality will be added.
### 7.5.3 Topics for further study on other communication related aspects
Editor\'s note: Topics for FFS will be collected for this particular
functionality.
The following issues need to be resolved:
\- The exact number of ProSe Per-Packet Priorities (assumed 8 at the moment)
needs to be confirmed with SA WG1, RAN WGs and SA WG6.
\- Whether the E-UTRAN needs to be able to validate/limit per UE the maximum
ProSe Per-Packet Priority that may be granted to the UE is FFS.
\- Whether a framework for defining mapping of certain application traffic
types to specific values of ProSe Per-Packet Priority will be defined by e.g.
SA WG6 specifications is FFS.
### 7.5.4 Conclusions on other communication related aspects
Editor\'s note: Conclusions will be collected for this particular
functionality
# 8 Enhancements to Open ProSe Direct Discovery
Editor\'s note: This clause is intended to document architecture solutions for
enhancements to the existing procedure for Open ProSe Direct Discovery. Since
more than one enhancement solutions may be selected for normative work for
this particular objective this clause could document multiple candidate
solutions.
## 8.1 Candidate enhancement solutions
### 8.1.1 Enhancement Solution 1: Open ProSe Direct Discovery procedure
enhancements
#### 8.1.1.1 Functional Description
In Relâ€‘13, the following new operation procedures for Direct Discovery are
introduced:
\- the ProSe Function initiated update/revocation of previously allocated
ProSe App Code, or Discovery Filters.
#### 8.1.1.2 Procedures
##### 8.1.1.2.1 Enhancements to the ProSe Discovery Request procedures
Figure 8.1.1.2.1.1: Discovery Request procedure for announcing UE (roaming)
This operation procedure is identical to that of clause 5.3.3.3 of TS 23.303
[3], with the additional Discovery Entry ID element in the Discovery Request
and Discovery Response message.
For non-roaming procedure, the step 3 and 4 are not executed.
Figure 8.1.1.2.1.2: General operation procedure for monitoring UE (roaming)
This operation procedure is identical to that of clause 5.3.3.5 of TS 23.303
[3], with the additional Discovery Entry ID element in the Discovery Request
and Discovery Response message.
The non-roaming procedure is similar, with the UE located in HPLMN.
When the Discovery Entry ID in the Discovery Request message does not contain
a valid value, the ProSe Function will create new UE context entry for this
request, and return the corresponding identifier in the Discovery Response
message.
##### 8.1.1.2.2 Discovery Update procedure
Figure 8.1.1.2.2.1: Discovery update procedure from ProSe Function
The ProSe Function can update or revoke the corresponding entry at the UE side
with this procedure.
0\. The ProSe Function is triggered to update or revoke the ProSe Application
Code previously allocated to an announcing UE (or the Discovery Filters
allocated to a monitoring UE).
1\. The ProSe Function sends a Discovery Update Request (UE Identify,
Discovery Entry ID, Update Info) message to the UE. The UE identity is set to
IMSI of the UE. The Discovery Entry ID is set to the identifier of the
corresponding Discovery Entry that contains the ProSe App Code (or Discovery
Filters) to be updated or revoked. The Update Info is optional, and contains
the ProSe App Code and validity timer for an announcing UE, or Discovery
Filters for a monitoring UE. If the Update Info is not included, the UE shall
remove the ProSe App Code or Discovery Filters corresponds to the Discovery
Entry ID.
2\. The UE respond with a Discovery Update Ack (Result, Discovery Entry ID) to
the ProSe Function to confirm the corresponding operation.
3\. UE adjusts the corresponding radio resources after the revocation. For
example, if there is no other code to announce, the UE can instruct the radio
layer to release the corresponding radio resources.
#### 8.1.1.3 Impact on Existing Entities and Interfaces
Impacts to the existing interfaces:
\- PC3 reference point needs update to support the Discovery Entry ID in
Discovery Request/Response message.
\- PC3 reference point needs to be enhanced to support the Discovery Update
procedure initiated from ProSe Function.
Impacts to the existing entities:
\- ProSe Function needs to support allocation of the Discovery Entry ID, and
retrieve the corresponding context entry using the identifier.
\- UE needs to store the Discovery Entry ID, and support the Discovery Update
procedure.
Interoperate with the Release 12 ProSe Function and UEs:
\- A Release 12 UE does not insert Discovery Entry ID in the Discovery Request
message, and therefore, the ProSe Function will not return the Discovery Entry
ID in the Discovery Response message. Release 12 operation will be followed.
\- A Release 12 ProSe Function ignores the Discovery Entry ID received in the
Discovery Request, and therefore, no Discovery Entry ID will be returned in
the Discovery Response message. The Release 13 UE would fall back to Release
12 logic.
#### 8.1.1.4 Solution Evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 will be
evaluated.
### 8.1.2 Enhancement Solution 2: ProSe Open Discovery for Dynamic Metadata
#### 8.1.2.1 Functional Description
A ProSe Open Discovery Extension procedure supports an announcing ProSe-
enabled UE to request the update of metadata, without updating the Discovery
Filter(s) of the monitoring UEs.
The following principles are followed:
\- Optionally, the Announcing UE can send the metadata along with the
Discovery Request Message.
\- When the ProSe Function allocates ProSe Application Code to the announcing
UE, the ProSe Application Code contains a Metadata Index that reflects the
version of the metadata, if the metadata is included in the Discovery Request
Message.
\- The Announcing UE broadcasts the ProSe Application Code that contains the
Metadata Index.
\- The ProSe Function provides a Metadata Index Mask to the Monitoring UE in
the Match Report Ack, to indicate the bits used for the Metadata Index.
\- If the UE finds a locally stored ProSe Application ID associated with a
received ProSe Application Code, but the Metadata Index(s) of the stored and
received codes are different, the UE may send a Match Report to retrieve the
new metadata
#### 8.1.2.2 Identifier definitions
For the Open Discovery, the following new identifiers are defined in addition
to those defined in TS 23.303 [3]:
**Metadata Index:** Some bits within the ProSe Application Code that reflects
the current metadata version. It is allocated and updated by the Home ProSe
Function when a new metadata is uploaded and stored in the ProSe Function for
a ProSe Application ID. How the HPLMN ProSe Function decides the length and
value of the Metadata Index is out of scope of 3GPP.
**Metadata Index Mask** : A bit mask used to indicate the bits used for the
Metadata Index in the ProSe Application Code. It is sent to the monitoring UE
by the ProSe Function if the ProSe Application Codes in the Match Report
contains the Metadata Index.
#### 8.1.2.3 Procedures
##### 8.1.2.3.1 Announce Request (roaming)
Figure 8.1.2.3.1-1: Announce request procedure (roaming)
This operation procedure is identical to that of clause 5.3.3.3 of TS 23.303
[3], except the following addition:
1\. Optionally, metadata is included in the Discovery Request message.
NOTE: The ProSe Function stores the metadata with associated the ProSe
Application ID, and maintains a local version number for it.
3\. The metadata is also included in the Announce Auth message if provided by
the UE.
5\. If the metadata is provided by the UE in step 1, the ProSe Function
includes a Metadata Index reflecting the current metadata version in the ProSe
Application Code.
6\. The UE broadcasts over PC5 the ProSe Application Code, which contains the
Metadata Index.
##### 8.1.2.3.2 Monitor Request (roaming)
This operation procedure is identical to that of clause 5.3.3.5 of TS 23.303
[3].
##### 8.1.2.3.3 Match Report (roaming)
Figure 8.1.2.3.3-1: Announce request procedure (roaming)
This operation procedure is identical to that of clause 5.3.4.2 of TS 23.303
[3], except the following addition:
1\. If the UE finds ProSe Application Code(s) that matches the Discovery
Filters, it checks if there is any ProSe Application ID(s) already locally
stored that correspond to this ProSe Application Code(s), or these ProSe
Application Code(s) excluding the Metadata Index are stored in the UE context
with the corresponding ProSe Application ID(s). If the UE cannot locate a
locally stored ProSe Application ID(s) in the above check, the UE triggers a
Match Report. If the ProSe Application ID(s) are found but the Metadata
Index(s) of the stored and received codes are different, the UE may send a
Match Report to retrieve the new metadata.
3\. The ProSe Function in the HPLMN selects the proper metadata(s) by the
Metadata Index(s) in the ProSe Application Code(s).
5\. The ProSe Function(s) in the other PLMN(s) select the proper metadata(s)
by the Metadata Index(s) in the ProSe Application Code(s).
6\. The metadata(s) and the Metadata Index Mask corresponding to the ProSe
Application Code(s) are sent along the Match Report message(s).
7\. The metadata(s) and the corresponding Metadata Index Mask are sent to the
UE in the Match Report Acknowledgment message. The UE stores the Metadata
Index Mask with the corresponding ProSe Application Code(s) and ProSe
Application ID(s).
NOTE: How to handle the Metadata Index value rollover is left to UE
implementation.
##### 8.1.2.3.4 Metadata Update Procedure (roaming)
This operation procedure is identical to 8.1.2.3.1, except the following
addition:
1\. The metadata is included in the Discovery Request message and the command
is set to metadata_update.
2\. The ProSe Function allocates a new Metadata Index in the ProSe Application
Code to reflect the current metadata version, while the other portion of ProSe
Application Code remaining unchanged.
### 8.1.3 Enhancement Solution 3: UE initiated Open ProSe Direct Discovery
procedure enhancements
#### 8.1.3.1 Functional Description
In Relâ€‘13, the following new operation procedures for Direct Discovery are
introduced:
\- the UE initiated renew/removal of a previously created Discovery Entry.
#### 8.1.3.2 Procedures
##### 8.1.3.2.1 Enhancements to the ProSe Discovery Request procedures
Figure 8.1.3.2.1-1: Enhanced discovery request procedure for announcing UE
(roaming)
This operation procedure is similar to that of 8.1.1.2.1.1, with the
additional optional Requested Timer element in the Discovery Request.
For non-roaming procedure, the step 3 and 4 are not executed.
The ProSe Function takes the Requested Timer into consideration when deciding
on the Validity Timer. When the Requested Timer is set to zero, the ProSe
Function should remove the Discovery Entry indicated by the Discovery Entry
ID, and free the associated resources.
Figure 8.1.3.2.1.2: Enhanced discovery request operation procedure for
monitoring UE (roaming)
This operation procedure is identical to that of 8.1.1.2.1.2, with the
additional optional Requested Timer element in the Discovery Request.
The non-roaming procedure is similar, with the UE located in HPLMN.
When the Monitoring UE wants to stop monitoring before the TTL for a Discovery
Filter expires, it issues a Discovery Request with the Requested Timer set to
zero to enable the ProSe Function to remove the Discovery Entry indicated by
the Discovery Entry ID, and free the associated resources.
#### 8.1.3.2 Impact on Existing Entities and Interfaces
Impacts to the existing interfaces:
\- PC3 reference point needs an update to support the new parameter
\"Requested Timer\" in the Discovery Request message.
Impacts to the existing entities:
\- The ProSe Function needs be able to take the \"Requested Timer\" into
consideration when deciding on the Validity Timer for the UE, and delete the
Discovery Entry when the \"Requested Timer\" is set to zero.
\- UE needs to be able to set the \"Requested Timer\" properly depending on
the application needs.
Interoperate with the Release 12 ProSe Function and UEs:
\- A Release 12 UE will not include the \"Requested Timer\" in the Discovery
Request message, and therefore, the Rel. 13 ProSe Function will handle the
operation as defined in Rel-12 specification;
\- A Release 12 ProSe Function will ignore any \"Requested Timer\" IE received
in the Discovery Request, and Rel-12 operation will be followed. In that case,
the UE will note that the values of the Validity Timer or TTL are different
from the one requested.
#### 8.1.3.4 Solution Evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 will be
evaluated.
## 8.2 Topics for further study on enhancements to Open ProSe Direct Discovery
Editor\'s note: Topics for FFS will be collected for this particular
functionality.
## 8.3 Conclusions on enhancements to Open Direct Discovery
Normative work for enhancements to Open Direct Discovery needs to proceed as
follows:
\- The ProSe Function initiated update/revocation procedure based on what is
defined in clause 8.1.1;
\- The dynamic metadata upload procedure based on what is defined in clause
8.1.2;
\- The UE initiated renew/removal procedure based on what is defined in clause
8.1.3.
# 9 Enhancements to support proximity estimation
Editor\'s note: This clause is intended to document candidate architecture
solutions to support proximity estimation as listed in objective x) of the
eProSe_Ext WID. Since more than one enhancement solutions may be selected for
normative work for this particular objective this clause could document
multiple candidate solutions.
## 9.1 Candidate enhancement solutions
### 9.1.1 Enhancement Solution 1: Estimation based on inclusion of coordinates
in discovery message over PC5
#### 9.1.1.1 Functional Description
Editor\'s note: General description, assumptions, and principles of the
solution.
In this option, the distance is estimated based on the relative location of
the Announcing and Monitoring UE that is determined using existing LBS
techniques e.g. SUPL, GPS etc. The location of the announcing UE is conveyed
to the monitoring directly in the discovery message over PC5.
{width="5.100694444444445in" height="1.9125in"}
Figure 9.1.1.1-1 Discovery message including location info
#### 9.1.1.2 Procedures
Editor\'s note: Describes the high-level operation, procedures and information
flows for the solution.
This solution requires the following steps:
1\. The UE determines its location based on existing location sources e.g. GPS
etc. How the location info is obtained in out of scope of 3GPP.
2\. The announcing UE when using Model A or the discoveree UE when using Model
B includes its location as part of the discovery message e.g. using a special
message type following direct discovery procedures. Assuming the ProSe range
is limited to e.g. 500m, only a small number of the least significant bits of
the coordinates needs to be included. The format of the location bits has to
be well-known.
3\. The monitoring UE when using Model A or the discoverer UE when using Model
B that is authorised receive and decode the discovery message determines the
announcing/discoveree UE\'s location by decoding the least significant bits
that are included in the message and then uses the most significant bits of
its own location in order to compile a full location information suitable for
application use.
4\. The monitoring/discoverer UE estimates the proximity between the two UEs.
#### 9.1.1.3 Impact on Existing Entities and Interfaces
Editor\'s note: Impacts on existing nodes or functionality will be added.
This solution only impacts the UE.
#### 9.1.1.4 Solution Evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 will be
evaluated.
This solution requires the location info to be included in the discovery
messages over PC5. This would mean that the size of the ProSe Code will have
to include space for the location info. In case of restricted discovery this
may not be a problem given the size of the temp ID can be reduced, but this
may be a problem for open discovery where due to the hierarchical nature the
size of the temp ID needs to be large (currently 160 bits). However, one may
argue that many open-discovery UEs are stationary anyway.
### 9.1.2 Enhancement Solution 2: Estimation based on inclusion of coordinates
in Match Report Ack over PC3
#### 9.1.2.1 Functional Description
Editor\'s note: General description, assumptions, and principles of the
solution.
In this option, the distance is estimated based on the relative location of
the Announcing and Monitoring UE that is determined using existing SUPL
procedures used for EPC-level discovery. The location of the announcing UE is
conveyed to the monitoring UE over PC3 in the Match Report Ack.
#### 9.1.2.2 Procedures
Editor\'s note: Describes the high-level operation, procedures and information
flows for the solution.
This solution involves the following different steps compared to the
procedures described in clause 5.1.2.5 of the present document:
Figure 9.1.2.2-1: Match report procedure extended for supporting location
estimation
1\. When the monitoring UE sends Match Report and requests to also determine
the distance and possibly direction from the Announcing UE, it includes a
\"location requested\" indication in the message.
2-5. Assuming the request is authorised, the ProSe Function uses \"EPC-level
discovery procedures\" to obtain the announcing UEs location information and
sends to the monitoring UE the ProSe Application ID (as normal) and also the
location of the announcing UE. The monitoring UE knows its own location and
estimates the proximity to the announcing UE.
#### 9.1.2.3 Impact on Existing Entities and Interfaces
Editor\'s note: Impacts on existing nodes or functionality will be added.
This option impacts the UE and the ProSe Function.
#### 9.1.2.4 Solution Evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 will be
evaluated.
This option requires the ProSe Function to support EPC-level discovery. Given
that the Match Report is currently optional in restricted discovery procedures
and is only required in any case once per the time the ProSe Code is valid
(for a given monitoring UE), the addition of location info in the Match Report
Ack will require the monitoring UE to send a new Match Report every time it
wants to \"refresh\" the location info of the announcing UE.
### 9.1.3 Enhancement Solution 3: Coarse proximity estimation based on path
loss
#### 9.1.3.1 Functional Description
When constructing the discovery message, the announcing UE retrieves from the
lower layers the actual transmit power used (based on the application
requested range class and radio conditions) and maps this value into a
transmit power category. The transmit power category is encoded in the
discovery type.
Editor\'s note: it is left to TSG RAN WG1 to determine the optimal split of
the possible transmit powers into transmit power categories.
When the monitoring UE detects a match, it extracts from the announced message
the transmit power category and retrieves from the lower layers the received
power. The monitoring UE calculates from the path loss a coarse proximity
estimation.
#### 9.1.3.2 Procedures
Editor\'s note: Describes the high-level operation, procedures and information
flows for the solution.
#### 9.1.3.3 Impact on Existing Entities and Interfaces
The PC5 interface will need to be upgraded to include the TX power category
information.
#### 9.1.3.4 Solution Evaluation
The solution fulfils the service requirement of being able to provide to the
monitoring UE an indication of the intended range the application in the
announcing UE has requested.
The solution is not expected to provide accurate information as the proximity
estimation is based on the radio propagation between announcing and monitoring
UE.
### 9.1.4 Enhancement Solution 4: Authorization for broadcasting and use of
location information over PC5
#### 9.1.4.1 Functional Description
This clause addresses both the authorization and privacy aspects related to
location estimation over PC5.
Authorization for Location Estimation over PC5
For authorization of location estimation over PC5, the following occurs for
restricted discovery.
\- For the announce procedure: as part of the authorization for restricted
discovery (over PC2), the ProSe Function in the HPLMN also verifies with the
ProSe App Server if the user is allowed to announce location information in
PC5 discovery messages.
\- For the match report procedure: during the match report, the ProSe Function
in the HPLMN also verifies if the user is authorized to get the location
information of the announcing user. This is done as part of the authorization
of restricted discovery with the ProSe App Server over PC2.
Privacy aspects for Location Estimation over PC5
\- For privacy of the users that announce location information, the solution
ensures that the location information sent over PC5 does not enable any
monitoring UE to get the actual location information of the announcing UE.
#### 9.1.4.2 Procedures
##### 9.1.4.2.1 Procedures for Authorization for Location Estimation over PC5
This clause addresses only authorization for location estimation over PC5, and
does not address privacy of the user\'s location information. The
authorization procedure may be used with any solution that uses location
information in PC5 discovery messages.
###### 9.1.4.2.1.1 Announce Request Procedure
This procedure only shows the additional required steps needed as part of the
announce procedure that is described in clause 5.1.2.3. The other steps of
clause 5.1.2.3 are the same and are not shown for simplicity.
Figure 9.1.4.2.1.1-1: Location estimation authorization procedure for an
Announcing UE
1\. The user sets the discovery preferences over the application layer e.g.
the user wants to include location information in discovery messages (this
step is out of 3GPP scope). At this step, the user may also indicate which
other users are allowed to get its location.
2.a As part of the Authorization Request procedure, the ProSe Function checks
with ProSe App Server if the user is authorized to send its location
information in the discovery message.
2.b The ProSe Application Server notifies the ProSe Function if the UE is
allowed to include location information in the discovery messages.
###### 9.1.4.2.1.2 Match Report Procedure
This procedure only shows the additional required steps needed as part of the
announce procedure that is described in clause 5.1.2.3. The other steps of
clause 5.1.2.3 are the same and are not shown for simplicity.
Figure 9.1.4.2.1.2-1: Location authorization procedure for a Monitoring UE
1\. Same as steps 1 to 3 of the match report procedure of clause 5.1.2.5.
2.a As part of the Authorization Request the ProSe Function requests the ProSe
Application Server to verify if the user is authorized to use location
information.
2.b As part of the Authorization Response, the Location authorization
information is sent to the ProSe Function.
##### 9.1.4.2.2 Location estimation using Offset Information while ensuring
user privacy
###### 9.1.4.2.2.1 General
The distance is estimated based on the relative location of the Announcing and
Monitoring UE that is determined using existing LBS techniques e.g. GPS etc.
How the location info is obtained in out of scope of 3GPP. The monitor UE
acquires the location of the announcing UE from the discovery message with
Location Offset Info over PC5 and the Match Report Ack message with Initial
Location Info over PC3 combination.
Figure 9.1.4.2.2.1-1 Discovery message including Location Offset Info
###### 9.1.4.2.2.2 Identifier definitions
For this procedure, the following new identifiers are defined:
**Initial Location Info** : The location when the announcing UE initials the
Announce Request procedure, this information is registered in the ProSe
Function during the Discovery Request Procedure.
**Location Offset Info** : The offset of the initial location info, which the
announcing UE broadcasts over PC5.
###### 9.1.4.2.2.3 Announce Request (Roaming)
Figure 9.1.4.2.2.3-1: Announce Request procedure extended for supporting
location estimation
This solution involves the following different steps compared to the
procedures described in clause 5.1.2.3 of the present document:
1\. If the proximity estimation is supported by the UE, when the announcing UE
sends a Discovery Request message to the ProSe Function in HPLMN for
announcing, it includes \"Initial Location Info\" in the message. The
\"Initial Location Info\" is the announcing UE current location info.
2a-2b. The authorization for announcing UE is described in 9.1.4.2.1.1.
3-6. Assuming the request is authorised, the ProSe Function in HPLMN stores
the \"Initial Location Info\" of the UE as a part of UE context and responds
to the UE with a Discovery Responses message.
7\. The announcing UE generates the discovery message with the Location Offset
Info including e.g. using a special message type following direct discovery
procedures. The Location Offset Info is the offset between the current
location and its \"Initial Location Info\". The Location Offset Information is
calculated by the announcing UE. The format of the location offset bits has to
be well-known. Then, the announcing UE starts announcing the discovery message
with the Location Offset Info in the serving PLMN, using the radio resources
used for ProSe are authorised and configured by E-UTRAN as defined in RAN
specifications.
###### 9.1.4.2.2.4 Match Report procedure (Roaming)
Figure 9.1.4.2.2.4-1: Match Report procedure extended for supporting location
estimation
This solution involves the following different steps compared to the
procedures described in clause 5.1.2.5 of the present document:
1\. If the Location Offset Info is included in the ProSe Code and the
proximity estimation is supported by the monitoring UE, when the monitoring UE
sends Match Report message and requests to also acquire the Initial Location
Info of the Announcing UE, it shall include a \"Location Request\" indication
in the Match Report message.
4a-4c. The authorization for monitoring UE is described in 9.1.4.2.1.2.
If the PLMN ID that assigned the Target ProSe Discovery UE ID is not assigned
by the HPLMN, then steps 5a-5b are executed:
5a. The ProSe Function in the HPLMN shall send a Location Request(Target ProSe
Discovery UE ID, UE Identity, Location Request) to the ProSe Function of the
PLMN that assigned the ProSe Discovery UE ID(i.e. the ProSe Function of the
HPLMN of the \"announcing UE\").
5b. If the ProSe Function in other PLMNs stores the Initial Location Info
corresponding to the Target ProSe Discovery UE ID, the ProSe Function in other
PLMNs shall send Location Response (Initial Location Information).
6\. The ProSe Function in HPLMN shall send the Initial Location Info of the
announcing UE to the monitoring UE. The monitoring UE estimates the proximity
to the announcing UE based on the combination of Initial Location Info and the
Location Offset Info.
#### 9.1.4.3 Impact on Existing Entities and Interfaces
This solution impacts the UE, ProSe Function and HSS. Therefore, the following
interfaces are impacted PC3, PC2, and the PC4a reference points.
#### 9.1.4.4 Solution Evaluation
##### 9.1.4.4.1 Authorization Solution Evaluation
The authorization solution ensures that the user preference for sharing
location information is taken into account. This is achieved by the ProSe
Function\'s authorization procedure with the ProSe App Server.
The solution does not require new interfaces. However, the existing interfaces
needs to be updated as follows:
\- For PC2 interface:
\- As part of the authorization verification with the application server, the
ProSe Function requests for verification to send/use location information by
an announcing/monitoring UE. As part of the response from the application
server, the ProSe Function is informed if the location information can be
sent/used by an announcing/monitoring UE.
##### 9.1.4.4.2 Privacy Solution Evaluation
The solution ensures that the privacy of the user with respect to location
information is preserved since unauthorized monitoring users do not have the
complete and exact location information when receiving offset location
information. Only authorized users will be provided with the full location
information.
The evaluation of clause 9.1.4.4.1 apply here. In addition, the following
interfaces need to be updated as follows:
\- For PC3 interface:
\- The announcing UE uploads it initial location information to the ProSe
Function.
\- The ProSe Function provides initial location information to a monitoring UE
during the match report.
\- For PC6 interface:
\- A new procedure is required to exchange location information between ProSe
Functions.
### 9.1.X Enhancement Solution X: \
#### 9.1.X.1 Functional Description
Editor\'s note: General description, assumptions, and principles of the
solution.
#### 9.1.X.2 Procedures
Editor\'s note: Describes the high-level operation, procedures and information
flows for the solution.
#### 9.1.X.3 Impact on Existing Entities and Interfaces
Editor\'s note: Impacts on existing nodes or functionality will be added.
#### 9.1.X.4 Solution Evaluation
Editor\'s note: The fulfilment of requirements in clause 4.2 will be
evaluated.
## 9.2 Topics for further study on support of proximity estimation
Editor\'s note: Topics for FFS will be collected for this particular
functionality.
The following issues need to be resolved:
\- The minimum size of the location info and whether it can fit in the
discovery message is FFS.
\- Privacy issues related to disclosing location information using PC5
discovery are FFS.
## 9.3 Conclusions on enhancements to proximity estimation
As an interim conclusion proximity estimation for ProSe Direct Discovery, e.g.
how near or how far a discovered UE is from the discovering UE, is not
supported in this release of specification based on solutions 1, 2 and 4.
Final conclusion on solution 3 is taken after answer is received from RAN WGs.
# 10 Solution for status determination and reporting (public safety use)
Editor\'s note: This clause is intended to document agreed architecture
solutions for status determination and reporting as listed in objective v) of
eProSe_Ext WID.
## 10.1 Solution for status determination and reporting
### 10.1.1 Functional Description
Editor\'s note: General description, assumptions, and principles of the
solution.
### 10.1.2 Procedures
Editor\'s note: Describes the high-level operation, procedures and information
flows for the solution.
### 10.1.3 Impact on Existing Entities and Interfaces
Editor\'s note: Impacts on existing nodes or functionality will be added.
## 10.2 Topics for further study for status determination and reporting
Editor\'s note: Topics for FFS will be collected for this particular
functionality.
## 10.3 Conclusions on status determination and reporting (public safety use)
Editor\'s note: Conclusions will be collected for this particular
functionality
# 11 Conclusions
Editor\'s note: This clause will capture agreed conclusions from the study
phase of the WID.
###### ### Annex A: Evaluation of transport options for Direct Discovery
(public safety use) functions & other non-discovery related procedures
# A.1 Transport Alternatives
## A.1.1 General
This Annex discusses possible transport options for Public Safety Discovery,
shortly referred to as PC5-D and PC5-S (PC5 Signalling Protocol option). These
options and any possible additional options are being documented in this Annex
for information purposes and in order to make final decisions on the way
forward.
There is a need to re-evaluate the Rel-12 PC5 reference point transport based
on the additional functions being discussed for Rel-13 ProSe enhancements.
The use cases and solutions identified for further work are based on the
following:
For Discovery:
\- UE-to-Network Relay Discovery (clause 6.1.2.2)
\- Group Member Discovery (clause 6.1.2.3)
\- UE-to-UE Relay Discovery (clause 6.1.2.4)
All cases involve procedures for existing Model A (which involves one UE
announcing \"I am here\") and new procedures for Model B (which involves one
UE asking \"who is there\" and/or \"are you there\" and other UEs responding
back).
The PC5 Signalling Protocol is used for enablement of other eProSe-Ext
functionality, such as establishment of secure layer-2 link for ProSe one-to-
one communication, or eMBMS relaying. Other potential uses of PC5-S Signalling
Protocol signalling include Cell ID signalling, QoS signalling and/or service
continuity as described in clause 7.1 \"Solution for one-to-one ProSe Direct
Communication\".
With this transport option the Announce and Solicitation messages can be
either broadcasted or groupcasted, whereas the Response message is typically
unicasted. Using groupcast allows for combining of discovery criteria (e.g.
support of relay discovery among group members only) or for confidentiality
(e.g. using Rel-12 bearer-level encryption defined for ProSe Direct
Communication one-to-many).
## A.1.2 PC5-D transport option
PC5-D refers to the Rel-12 protocol stack agreed discovery. It is depicted in
figure A.1.2-1.
Figure A.1.2-1: PC5 \"Discovery Plane\" stack (PC5-D)
In Relâ€‘12 the \"ProSe Protocol\" consists of single message: PC5_DISCOVERY,
depicted in table A.1.1.1 (which is a copy of TS 24.334 table 11.2.5.1.1).
Table A.1.2-1: PC5_DISCOVERY message content (copy of TS 24.334 table
11.2.5.1.1):
+------------------------+----------------+----------+---------------+ | Information Element | Type/Reference | Presence | Length (bits) | +------------------------+----------------+----------+---------------+ | Message Type | Message Type | M | 8 | | | | | | | | 12.2.2.10 | | | +------------------------+----------------+----------+---------------+ | ProSe Application Code | Binary | M | 184 | | | | | | | | 12.2.2.6 | | | +------------------------+----------------+----------+---------------+ | MIC | Binary | M | 32 | | | | | | | | 12.2.2.11 | | | +------------------------+----------------+----------+---------------+ | UTC-based Counter LSB | Binary | M | 8 | | | | | | | | 12.2.2.22 | | | +------------------------+----------------+----------+---------------+
## A.1.3 PC5-S transport option (PC5 Signalling Protocol)
The PC5-S transport option refers to a NAS-like protocol (PC5 Signalling
Protocol) and the protocol stack is depicted in figure A.1.3-1. The SDU Type
field (3 bits) in the PDCP header is used to discriminate between IP, ARP and
PC5 Signalling Protocol.
Figure A.1.3-1: PC5-S transport option (PC5 Signalling Protocol) stack
# A.2 Evaluation
Table A.2.1 contains an evaluation summary of the two transport options for
Direct Discovery (public safety use) described in clause A.1.
Table A.2-1: Evaluation of transport options for Public Safety Discovery
+----------------------+----------------------+----------------------+ | | PC5-D | PC5-S (PC5 | | | | Signalling Protocol) | +----------------------+----------------------+----------------------+ | **Extendibility** | Fixed and limited | Variable payload | | | payload size (184 | size limited only by | | | bits). All discovery | the maximum | | | information needs to | supported data | | | be tailored to fit | packet size. | | | within this limit. | | | | | The Announce/ | | | | Discoverer/ | | | | Discoveree info can | | | | be of any size, | | | | allowing Public | | | | Safety authorities | | | | to flexibly assign | | | | upper-layer user | | | | information. | | | | | | | | Allows for | | | | straight-forward | | | | addition of new | | | | discovery parameters | | | | in the future. | +----------------------+----------------------+----------------------+ | **Flexibility** | | | +----------------------+----------------------+----------------------+ | **Standardisation | | | | effort** | | | +----------------------+----------------------+----------------------+ | **Efficiency** | | | +----------------------+----------------------+----------------------+ | **Other** | | | +----------------------+----------------------+----------------------+
RAN WG1 (R1-150948) has provided the following input, additional feedback
expected:
RAN WG1 would like to note the following technical aspects based on the Rel-12
design for comparison of using Rel-12 discovery or Rel-12 communication as
transport channels for PS discovery.
Table A.2-2
+----------------------+----------------------+----------------------+ | | Discovery transport | Communication | | | channel | transport channel | +----------------------+----------------------+----------------------+ | Resource efficiency | Number of resources | Number of resources: | | | configurable between | 6 sub-frames (2 | | []{.underline} | 1 and 4 sub-frames | Control SFs with 1 | | | per period (2 RBs | RB each and 4 Data | | | per sub-frame). | SFs with at least 2 | | | | RBs for message size | | | | of 232 bits). | | | | Further, resources | | | | are assumed to be | | | | occupied for the | | | | entire control | | | | period. | +----------------------+----------------------+----------------------+ | Power efficiency | UEs stay awake | UEs stay awake | | | during discovery | during control | | []{.underline} | sub-frames. | sub-frames and also | | | | during the entire | | | | data period when | | | | control message of | | | | interest was | | | | received | +----------------------+----------------------+----------------------+ | Half duplex | Depends on resource | Depends on resource | | | configuration -- | configuration -- | | (Note: this refers | typical RAN1 | typical RAN1 | | to the problem that | simulations had half | simulations had half | | two UEs | duplex probability | duplex probability | | participating in | of 1/64 within a | of 1/6 within a | | discovery will not | period. | period. | | be able to listen to | | | | each other since | | | | they are | | | | transmitting at the | | | | same time). | | | +----------------------+----------------------+----------------------+ | Latency | Period configurable | Period configurable | | | between {320, | between {40, 80, | | (Note: due to | 640,1280, 2560, | 160, 320} ms | | interference, actual | 5120, 10240} ms | | | latency may be | | | | multiples of | | | | configured period) | | | +----------------------+----------------------+----------------------+ | Message size | Fixed -- 232 bits | Variable -- 40 bits | | | | to 25k bits | | | | | | | | (Note: larger | | | | resource and shorter | | | | range at higher | | | | message size) | +----------------------+----------------------+----------------------+
\- Note that in addition to power consumption for discovery message reception,
UE participating in D2D communication, will incur further power consumption
which may be different for the two approaches and may be discussed further in
RAN1.
\- RAN1 notes that the comparison above would apply both to Model-A and
Model-B discovery provided that such models, if supported, are transparent to
the access stratum.
\- Provided preliminary guidance that for public safety discovery and with
respect to potential support of Group Member Discovery, TMGI advertisement or
Cell ID announcement, if message size (232 bits), and minimum supported one-
way latency (320ms) are acceptable, then discovery may be more appropriate
solution. If lower latency or a larger message size are needed, then discovery
over communication may be a more appropriate solution. Some aspects of this
comparison may be studied further in RAN1 during the Relâ€‘13 WID. Note that
RAN1 may also consider other possibilities once the requirements from SA WG2
and other WGs become clearer.
\- Observe that the analysis above is not applicable for UE-Network relay
discovery.
Editor\'s note: RAN input is needed for certain evaluation criteria (e.g.
efficiency).
RAN WG1 LS R1-152422 further indicates:
\- For partial and outside network coverage discovery, PSDCH transmission is
supported when PSDCH resources are (pre)configured.
\- Relevant discovery pool parameters are preconfigured for out of coverage
operation
Details FFS
\- The transport block size on the PSDCH is 232 bits (excluding 24 CRC bits)
both for in and out of coverage operation
NOTE: From RAN WG1 perspective, this doesn\'t preclude a discovery payload
above L1 > 232 bits
RAN WG2 R2-151723 indicates:
RAN WG2 recognizes that if the size of the discovery messages for public
safety discovery procedure (i.e. Cause 6.1.2 in TR 23.713) can be restricted
to 232 bits (in total for upper layer and potential AS layer information still
under consideration in RAN WG2), the discovery transport (PC5-D) can be used.
If this restriction is not feasible, RAN WG2 did not agree on any further
guidance compared to what RAN WG1 already expressed in R1-150948.
For all the other procedures (i.e. TMGI advertisement and Cell ID announcement
procedures) RAN WG2 is still evaluating.
From RAN WG2 point of view, it would be desirable if the discovery message
size could be kept as low as possible.
#
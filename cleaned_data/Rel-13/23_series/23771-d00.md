# Foreword
This Technical Report has been produced by the 3^rd^ Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document studies the mechanisms needed to support IMS Emergency
sessions over WLAN (both in the Trusted -S2a - and in the untrusted -S2b-
cases)
The study is split up into 2 phases corresponding to 2 SID (FS_SEW1 and
FS_SEW2).
Topics to be studied in phase 1 (FS_SEW1) are:
\- Providing access to EPC over WLAN in order to support an emergency session
only in case of \"Valid\" UEs as in the case 1 in clause 4.3.12.1 of TS 23.401
[3]: the support of emergency session is only studied for UEs which (a) have
valid credentials to access EPC over WLAN and (b) are authorized to connect to
EPC over WLAN in the location where they initiate an emergency session.
\- Providing Location information (in particular for untrusted WLAN). Only
existing location determination mechanisms are considered i.e. location
determination mechanisms that should not require standard effort. No location
accuracy requirements are considered in phase 1.
Phase 1(FS_SEW1) will not consider solutions that imply specification
activities in other SDO(s).
Topics to be studied in phase 2 (FS_SEW2) correspond to all the features not
covered by phase 1, e.g.:
\- Support of other cases for the access to EPC over WLAN (e.g. the UE is
authenticated but is in a location where it is restricted from regular
service, or is unauthenticated or has no USIM).
\- Roaming cases (user not in his / her home country).
\- Support of session continuity of emergency sessions at inter-access
mobility.
\- TWAN access.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 22.101: \"Service aspects; Service principles\".
[3] 3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for
Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".
[4] 3GPP TS 23.167:\" IP Multimedia Subsystem (IMS) emergency sessions\".
[5] IEEE Std 802.11-2012: \"IEEE Standard for Information technology -
Telecommunications and information exchange between systems - Local and
metropolitan area networks - Specific requirements - Part 11: Wireless LAN
Medium Access Control (MAC) and Physical Layer (PHY) Specifications\".
[6] WiFi Alliance Technical Committee, Hotspot 2.0 Technical Task Group:
\"Hotspot 2.0 (Release 2) Technical Specification\", ver.5.00.
[7] 3GPP TS 23.402: \"Architecture enhancements for non-3GPP accesses\".
[8] 3GPP TS 23.237: \"IP Multimedia Subsystem (IMS) Service Continuity; Stage
2\".
[9] 3GPP TS 23.271: \"Functional stage 2 description of Location Services
(LCS)\".
[10] IETF RFC 7315: \"Private Header (P-Header) Extensions to the Session
Initiation Protocol (SIP) for the 3GPP\".
[11] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[12] 3GPP TS 24.229: \"IP multimedia call control protocol based on Session
Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".
[13] 3GPP TS 29.172: \"Location Services (LCS); Evolved Packet Core (EPC) LCS
Protocol (ELP) between the Gateway Mobile Location Centre (GMLC) and the
Mobile Management Entity (MME); SLg interface\".
[14] 3GPP TS 33.402: \"3GPP System Architecture Evolution (SAE); Security
aspects of non-3GPP accesses e\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply. A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
**Emergency Session Transfer Number for DRVCC** : A number used by the UE to
request the EATF AS to perform Session Transfer from PS to CS access. The
E-STN-DR is dynamically assigned by EATF during IMS emergency session
procedure with WLAN.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply.\ An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
E-STN-DR Emergency Session Transfer Number for DRVCC
# 4 Architectural assumptions
## 4.1 General architectural assumptions
General assumptions:
1 SEW solutions do not support pre Rel-13 devices and networks.
2 no new requirements are defined for the UE for undetected emergency calls.
3 In the case of S2b connectivity, the authentication mechanisms used by the
UE to authenticate with WLAN for local IP access are out of scope of the SEW
work. The SEW work does not consider the development of new authentication
mechanisms for this case.
4 During the establishment of connectivity for emergency services over WLAN,
the UE provides an indication that the connectivity request is for emergency
services. The mechanisms defined for LTE (i.e. specific request type and
mechanisms in the MME) are adopted, with an indication in the connectivity
request being added by the UE to the TWAG and the ePDG.
Editor\'s note: How the UE provides such indication is FFS and depends on the
connectivity mechanism (e.g. S2b vs. S2a).
5 A UE establishing connectivity for emergency services over WLAN does not
provide an emergency APN.
6 It is assumed that the same mechanisms adopted in the MME for PDN GW
selection for emergency services can be extended to connectivity establishment
for IMS emergency services over WLAN.
7 In SEW work no new mechanisms are defined for P-CSCF Selection for IMS
emergency services over WLAN.
8 In S2a case, mechanisms have been defined (as part Netloc_TWAN) to provide
location information from TWAG to IMS nodes upon bearer creation / deletion /
modification. No more work is assumed for the S2a procedures and flows in
order to support providing network asserted location information from TWAG to
IMS nodes. This does not preclude addition of relevant new information in TWAN
ID.
9 An UE shall select an ePDG of the local country when connecting to an ePDG
in order to issue an emergency session.
10 A PLMN should be able to determine whether a UE is at a location where an
emergency call can be supported by the PLMN (e.g. routed to the correct PSAP).
11 For UE detected emergency calls, a UE already registered to IMS for regular
IMS services (i.e. not emergency services) over WLAN shall:
11a. For S2b connectivity, establish a new PDN connection for emergency
services according the procedures defined for IMS emergency services over S2b,
and (re)register for emergency services to IMS.
11b. For S2a SCM connectivity, disconnect and reconnect to establish a PDN
connection for emergency services according the procedures defined for IMS
emergency services over S2a SCM, and (re)register for emergency services to
IMS.
11c. For S2a MCM connectivity, establish a new PDN connection for emergency
services according the procedures defined for IMS emergency services over S2a,
and (re)register for emergency services to IMS.
12 If the network detects a UE undetected emergency call, the IMS core shall
reject the call subject to local regulations for a UE already registered to
IMS for regular IMS services (i.e. not emergency services) over WLAN.
13 (for phase 2) An ePDG that supports Emergency sessions supports all kinds
of emergency sessions required by local regulations.
14 (for phase 2) A TWAN that supports Emergency sessions supports all kinds of
emergency sessions required by local regulations.
## 4.2 Architectural assumptions for phase 1
1 a UE will attempt emergency calls over WLAN only in case of unsuccessful
emergency call attempts over the cellular technologies supported by the UE.
2 WLAN selection for the establishment of IMS emergency calls over WLAN is
based on mechanisms defined in Rel-12, including ANDSF WLAN_NS, operator
configuration, WLAN configuration provided by RAN, and manual selection.
3 For the S2a case, the EAP-AKA\' authentication procedure specified in Rel-12
is used by the UE to authenticate with the TWAN to obtain access to the EPC
for IMS emergency services; no new authentication mechanisms are considered in
the SEW work for this case. This does not preclude addition of relevant new
parameters in EAP-AKA\'.
4 For the S2b case, the EAP-AKA authentication procedure specified in Rel-12
is used by the UE to authenticate with the ePDG to obtain access to the EPC
for IMS emergency services; no new authentication mechanisms are considered in
the SEW work for this case. This does not preclude addition of relevant new
parameters in EAP-AKA.
5 UE is assumed to be in its Home country.
6 Any local policy using location information at initial connection for voice
services will only be implemented by one of the network operator\'s IMS nodes.
# 5 Key issues
## 5.1 Key Issue #1: ePDG Selection for emergency services
A mechanism needs to be identified in order to allow a UE to select an ePDG
for emergency services when IMS emergency services over WLAN are available at
the UE Location.
For phase 2, the following requirements are applicable.
R1. The ePDG should be selected in the same country as the UE and enable
access to a PSAP in the same country as the UE.
R2. The selected ePDG should be capable of supporting emergency services by
providing access to a PSAP serving a geographic area in which the UE is
located, for any country in which PSAPs serve different geographic areas.
## 5.2 Key Issue 2: Providing priority to emergency services especially in
case of control plane congestion
The Key issue is to study how to provide priority to emergency services
especially in case of congestion (allowing fulfilment of requirements
expressed in 3GPP specifications about preferential treatment of emergency
services in case of Diameter or GTP-c congestion). No changes are foreseen to
GTP-c / Diameter protocols _._
## 5.3 Key Issue 3: providing location information to IMS nodes
Establishing emergency calls over WLAN requires the provision of location
information for the UE to the network. Specifically, the UE location may be
required in order to select the correct PSAP for the establishment of the
emergency call. Location information may also be required by the network in
order to provide a location to the PSAP that enables dispatch of emergency
responders to the location of the caller.
NOTE 1: No location accuracy requirements are considered in phase 1.
In S2a case, mechanisms have been defined (as part Netloc_TWAN) to provide
location information from TWAG to IMS nodes upon bearer creation / deletion /
modification. No more work is assumed for the S2a related procedures and flows
in order to support providing network asserted location information from TWAG
to IMS nodes.
The key issue is to define:
\- In S2b case,
\- How it is possible to provide location information to IMS nodes or PSAP.
\- What location information may be provided to IMS nodes or PSAP.
NOTE 2: The IMS Emergency Service procedures defined in TS 23.167 [4] foresee
the scenario where the UE knows its location information and sends it in the
SIP INVITE message (step 3 of TS 23.167 [4] figure 7.6-1) when it starts the
emergency service.
\- How the LRF can fetch the location of an UE that is currently camping over
WLAN. The key issue is to define how the LRF receives or retrieves the UE\'s
location. Both s2a and s2b cases shall be considered.
NOTE 3: The IMS Emergency Service procedures defined in TS 23.167 [4] foresee
the scenario when the LRF provides the UE\'s location information to IMS Core
or to Emergency Centre.
In Phase 1only existing location determination mechanisms are considered i.e.
location determination mechanisms that should not require standard effort.
## 5.4 Key Issue 4: Location Privacy
Many aspects of a UE\'s location need to be transferred to and sometimes
stored in a network operator\'s systems; however in many countries it is
regulatory required that the privacy of a user\'s location is protected by
network operators. Therefore any solution that transfers or stores location
information will need to do so in a manner (e.g. inside encrypted tunnels)
that protects the user from misuse or abuse of that location information.
Editor\'s note: SA WG3 will need to review any conclusions to ensure that
adequate privacy protections are described.
## 5.5 Key Issue 5: Location at Initial Connection for Voice Service
In many implementations it is outside the control of a network operator where
a WLAN Access Point is installed (particularly in the case of untrusted WLAN);
therefore it is possible that a WLAN Access Point is installed outside the
coverage area of a network operator\'s cellular network, and hence the
supporting infrastructure for emergency calls may not be present. Since it is
not possible to determine when a user registers for voice over WLAN service if
they will or will not make an emergency call in the future, the network needs
to apply local policies regarding normal voice calling when the device
connects for any voice service, not just emergency voice service (e.g. one
such policy would be to prevent registration for any voice services over WLAN
in a location where emergency calls are not possible).
Therefore, when a user connects to a service provider\'s network via WLAN for
voice service the network may need to perform local network policies dependant
on where the UE is located, thus the UE must supply its location to the
network when it first registers with an IMS network for voice service over
WLAN.
## 5.6 Key Issue 6: Determination of Emergency Call Support
A PLMN that receive as IMS emergency call request from a UE accessing a WLAN
may need to decide whether to accept or reject the emergency call request
based on whether the PLMN will be able to route the call to an appropriate
PSAP. For example, a PLMN that does not have access to the correct PSAPs in
the present location will not always be able to support an emergency call for
a UE outside the normal PLMN coverage. This can apply in both phase 1 (to the
HPLMN) and phase 2. The proposed ePDG selection procedure for phase 1 (i.e.
based on determining or assuming that the UE is in the home country)
guarantees the problem will sometimes arise for some PLMNs in the case of S2b
access. A similar problem for S2a access may arise if the TWAG is not
configured to filter emergency calls based on the TWAN location. Resolution of
issue 5 will not solve this issue in all cases since an emergency call can
still arise from a UE that not is yet attached to the HPLMN or VPLMN.
## 5.7 Key Issue 7: Determine if TWAN supports emergency service
This Key Issue is for Phase-2.
When connected to a TWAN the UE needs to know whether the TWAN supports
emergency services. The Key issue is to define how the UE knows whether the
TWAN it is connected to supports emergency services.
## 5.8 Key Issue 8: Support of unauthenticated emergency session over Trusted
WLAN
This Key Issue is for Phase-2.
Depending on local regulation, various kind of UE (e.g. UICCless UEs) may be
allowed to establish an emergency session over WLAN. A mechanism is needed to
support following cases:
a**. Only UEs that are authenticated are allowed.** These UEs must have a
valid IMSI. These UEs are authenticated and may be in a location where they
are restricted from regular service (e.g. roaming while their subscription
does not allow roaming). A UE that can not be authenticated will be rejected.
b. **IMSI required, authentication optional.** These UEs must have an IMSI. If
authentication fails, the UE is granted access and the unauthenticated IMSI
retained in the network for recording purposes. In this scenario it should be
studied which UE identity is used to identify the UE, for example the IMEI,
the MAC address, etc. IMEI only UEs will be rejected (e.g. UICCless UEs).
c. **All UEs are allowed.** Along with authenticated UEs, this includes UEs
with an IMSI that can not be authenticated and UEs with only an IMEI. If an
unauthenticated IMSI is provided by the UE, the unauthenticated IMSI is
retained in the network for recording purposes. In this scenario it should be
studied which UE identity is used to identify the UE, for example the IMEI,
the MAC address, etc.
## 5.9 Key Issue 9: Support of \"unauthenticated\" emergency session over
Untrusted WLAN
This Key Issue is for Phase-2.
In case of Untrusted access the authentication and authorization to access to
the WLAN AN is different from the authentication and authorization to access
to the EPC (i.e. establishment of connection to the ePDG and subsequent
establishment of PDN connection for IMS emergency session purposes). Thus this
key issue is divided into 2 parts:
1) Authentication and authorization to access to the EPC (i.e. to the ePDG and
to EPC).
2) Authentication and authorization to access to the WLAN AN.
### 5.9.1 Key Issue 9.1: Support of \"unauthenticated\" emergency session over
ePDG
This Key issue assumes that the UE has got WLAN access and uses this
connectivity to reach EPC. The same cases than described for Key issue 8
(\"Support of unauthenticated emergency session over Trusted WLAN\") need to
be covered.
### 5.9.2 Key Issue 9.2: Support of \"unauthenticated\" emergency session over
WLAN AN
The Key Issue is to study:
\- Whether it is in the 3GPP scope to work on the access to a WLAN AN of an UE
that does not have the necessary credentials or authorization to access to
that WLAN AN but that needs to establish an emergency session.
\- Whether there are possible requirements of WLAN impacting the support of
\"unauthenticated\" emergency session in key issue 9.1.
### 5.10 Key Issue 10: Support for IMS based Non-Voice Emergency Services
This Key Issue is for Phase-2.
Current capabilities (i.e. phase 1 of this study) only details the support for
emergency calls, however devices and networks may support other non-voice
emergency services over cellular access (as defined in TS 22.101 [2]); these
same capabilities need to be supported over WLAN if both the IMS network and
device support the feature.
## 5.11 Key Issue 11: Means by which the order in which an emergency session
is attempted over the available networks
This Key Issue is for Phase-2.
When a device could potentially attempt an emergency call over multiple
network types (e.g. 3GPP, WLAN), there needs to be a means by which the order
in which an emergency call (or session) is attempted over the available
networks. In some cases WLAN may be preferable to 3GPP and current (i.e. phase
1) solutions do not allow for WLAN to be used for emergency calls if any 3GPP
cellular coverage is available. There needs to be a means by which the network
preference (or order) in which emergency calls (or sessions) are attempted is
determined.
Since emergency calls are heavily regulated and the requirements of different
countries may be contradictory, the network selection preference (or order of
setup attempts) needs to reflect the local regulations, and the regulations of
the devices home network (if different).
In addition there are many factors (other than regulation) that may influence
the preference of network type (this includes; available networks,
registration status, network conditions, device capabilities, network
capabilities), and a flexible framework needs to be established that can
consider these factors when determining the network selection preference (or
order of setup attempts).
NOTE: This key issue applies to UE\'s that support simultaneous connections to
both WLAN and 3GPP networks (e.g. NBIFOM, IFOM, MAPCON, etc) as well as UE\'s
that can only support connections over either WLAN or 3GPP.
## 5.12 Key Issue 12: Handover Active Emergency call from WLAN to 3GPP
This Key Issue is for Phase-2.
Since the service area of a WLAN AP is considered to be much lower than that
of cellular macro cells, it is anticipated that an Emergency call (or Session)
established over WLAN may need to transition to the 3GPP network as the user
moves (or as conditions change). The network and UE need to support a means
for emergency calls (or sessions) to change radio access type, and as
seamlessly as possible move the calls (or sessions) from WLAN network to the
3GPP network.
NOTE 1: The key issue should consider the case where the UE moves from WLAN to
a 3GPP coverage that supports VoLTE and the case where the UE moves from WLAN
to a 3GPP coverage that does not support VoLTE.
NOTE 2: For CS RAT, this key issue should consider the case where the UE moves
from WLAN to 3GPP CS coverage where the UE has valid SIM.
## 5.13 Key Issue 13: Handover Active Emergency call from 3GPP to WLAN
This Key Issue is for Phase-2.
Since WLAN AP are often deployed as a means to overcome localized 3GPP service
limitations (e.g. augment areas with poor in-building coverage), it is
anticipated that an Emergency call (or Session) established over 3GPP may need
to transition to the WLAN network as the user moves (or as conditions change).
The network and UE need to support a means for emergency calls (or sessions)
to change radio access type, and as seamlessly as possible move the calls (or
sessions) from 3GPP network to the WLAN network.
NOTE 1: The key issue should consider the case where the UE moves from 3GPP
that supports VoLTE to WLAN and the case where the UE moves from 3GPP coverage
that does not support VoLTE to WLAN.
NOTE 2: For moving to CS RAT, this key issue should consider the case where
the UE has valid SIM.
## 5.14 Key Issue 14: Determine if ePDG supports emergency service
This Key Issue is for Phase-2.
When a network operator implements emergency calls over WLAN, it may either
deploy dedicated ePDG systems to support emergency calls and sessions, it may
have some common ePDG\'s enhanced to support emergency calls and sessions, or
it may enhance all ePDG\'s to support emergency calls and sessions - however a
UE using S2b procedures has no knowledge if the ePDG it is connected to
supports emergency calls and sessions. Without a means for the UE to determine
what emergency capabilities the ePDG supports it is necessary for the UE to
drop its current ePDG connection and re-select with an indicator that it wants
to connect with an ePDG that supports emergency services.
Therefore to enable optimization of the emergency procedures the UE needs a
means to determine if the ePDG it is currently connected to supports emergency
calls and sessions.
This information (i.e. if the ePDG the UE is connected to supports emergency
sessions) may also be useful to enhance or optimize other aspects of the
service (e.g. selecting between multiple connection types when more than one
is available) - therefore the UE should be able to know if the ePDG supports
emergency capability.
## 5.15 Key Issue 15: Stay connected to an ePDG that supports emergency
service
In order to support multiple ePDG deployment scenarios, the functionality
identified in phase 1 of this study for ePDG selection for emergency calls and
sessions requires that the current ePDG connection be dropped and ePDG
selection re-performed with an indicator to the network that this is an
emergency connection. This procedure is done even if the ePDG the UE is
connected to supports the emergency calls and sessions - this may delay the
emergency call setup, and cause unnecessary load to the network systems.
However, if the UE could remain connected to the existing ePDG the
establishment of the emergency call (or session) could be optimized.
Therefore if a UE is connected to an ePDG, and the UE knows that the ePDG
supports emergency calls and sessions, and the UE knows this ePDG is in the
current local country of the UE, the UE should stay connected to that ePDG
when the user initiates an emergency call or session.
## 5.16 Key issue 16: Determine Emergency Call Numbers
This key issue applies to phase 2.
The key issue is to define how the UE can determine the local Emergency Call
Numbers when connected over WLAN.
## 5.17 Key issue 17: IMEI check
The key issue is to study, for both cases of TWAN and Untrusted WLAN access,
how to carry out the IMEI check in case of emergency services. This includes
how to support Local policies controlling whether in case of emergency
services an IMEI check needs to be performed and whether the Emergency
procedure continues or is stopped in case of black-listed or grey-listed ME
(Mobile Equipment).
This applies to non-roaming and to roaming scenarios.
This key issue applies to SEW phase 2.
# 6 Solutions
## 6.1 Solution 1: ePDG selection when UE can detect being in the home country
This solution addresses the Key Issue on ePDG selection. The principles of the
solution are as follows:
The UE is configured by its Home operator with whether the HPLMN supports
emergency sessions over WLAN.
NOTE: To support emergency sessions over WLAN, a PLMN is assumed to have
deployed ePDG(s) that support SWu sessions for emergency services as well as
P-CSCF (s) / E-CSCF that support emergency sessions.
Editor\'s note: How this UE configuration is carried out is FFS.
When the UE has determined that it needs to set up a SWu session for emergency
services:
1) The UE determines whether it is in the Home country of the IMSI. Any
suitable information may be used. It is not intended to further describe how
the UE makes this determination.
Editor\'s note: The case of UE with multiple USIM is FFS.
2) The UE determines the FQDN of an ePDG of the HPLMN supporting emergency
sessions in the Home PLMN and issues a DNS query to get candidate IP addresses
of this / these ePDG.
Editor\'s note: Whether this FQDN is configured on the UE or whether it is
dynamically created by the UE based on a FQDN structure defined in TS 23.003
[11] is FFS. Whether a well known non PLMN specific FQDN is used is FFS.
Editor\'s note: What the UE does in case it detects it is not in its Home
country is FFS. Whether this is subject to normative specifications is also
FFS.
## 6.2 Solution 2: ePDG selection when the UE cannot know it is in Home
Country
This solution addresses the Key Issue on ePDG selection. The principles of the
solution are as follows:
1) The UE determines the FQDN of an ePDG of the HPLMN supporting emergency
sessions in the Home PLMN and issues a DNS query to get candidate IP addresses
of this / these ePDG.
Editor\'s note: Whether this FQDN is configured on the UE or whether it is
dynamically created by the UE based on a FQDN structure defined in TS 23.003
[11] is FFS. Whether a well known non PLMN specific FQDN is used is FFS.
Editor\'s note: With this solution, it may happen that even though the user is
not in its Home country, an ePDG of the HPLMN is selected and the UE attempts
procedures for emergency sessions in the Home PLMN. As such emergency session
should not be established, mechanisms should be defined to reject the UE IMS
requests for emergency session when the UE indicates it is served by a WLAN
access and the location information it provides does not correspond to a
location in the Home country.
Editor\'s note: What the UE does when its emergency session is rejected is
FFS. Whether this is subject to normative specifications is also FFS.
## 6.3 Solution 3 for key issue #3: UPLI via SIP for untrusted WLAN
### 6.3.1 Overview
1 The solution leverages an existing procedure whereby geolocation information
for any access can be conveyed at the IMS level from a UE to a P-CSCF and
E-CSCF in the serving VPLMN using mechanisms already defined in TS 24.229
[12], by which a UE shall include a geolocation header into the request for
the dialogue (e.g. a SIP INVITE) if available to the UE. This corresponds to
UPLI (User Provided Location Information) and is not trustable. In the case of
WLAN access, TS 24.229 [12] further defines that a PANI shall be included for
WLAN access and that the content of the PANI shall include the WLAN AP MAC
address for the serving (associated) WLAN AP. Therefore, information such as
the BSSID or HESSID can be included in \"\"i-wlan-node-id\" PANI parameter.
This is supported by current standards.
2 In the case of WLAN access, the Geolocation header field may contain:
\- The Venue type and the Venue name provided by the AP when both UE and AP
support Passpoint R2;
Editor\'s note: Whether venue type, venue name can actually be used to
determine (automatic process) the PSAP is FFS.
\- Its geographical coordinates (e.g. from GPS) if available at the time of
the emergency call initiation.
In current standards, the location information provided by the UE in SIP
signalling enables the entity that performs call routing (i.e. the E-CSCF or
the LRF have access to the serving/associated AP MAC address and/or the Venue
type, Venue name and/or the geographical coordinates, and can use this to
select a PSAP provided the serving VPLMN is configured with corresponding
routing or location related information. Any configured location information
for the serving/associated AP MAC address and/or the Venue type, Venue name
and/or the geographical coordinates may also be used to provide a location to
support PSAP dispatch.
## 6.4 Solution 4 for key issue #3: UPLI via EPC for untrusted WLAN
### 6.4.1 Overview
The solution leverages on information such as the BSSID that the UE can
provide via the EPC. It is based on the statement that EAP-AKA is mandatory
for untrusted WLAN as specified in TS 33.402 [14] clause 8.2.1.
\- The ePDG being unable to know (via the network) the BSSID or HESSID, venue
type, venue name and/or geographical coordinates of the WLAN Access Point the
UE is connected to, the solution consists in the UE providing one or more of
these information using EAP-AKA signalling (within IKEv2) to the AAA server,
which then provides it via SWm to the ePDG. This information is then delivered
by the ePDG to the PGW over S2b, to the PCRF over Gx and to the P-CSCF over
Rx;
\- This corresponds to UPLI (User Provided Location Information) and is not
trustable.
## 6.5 Solution 5 for key issue #3: UPLI via IKEV2 for untrusted WLAN
The solution addresses the location mechanisms to be used for the PSAP
discovery.
The ePDG is not able to know the BSSID of the WLAN where the UE is connected.
The UE shall use IKEv2 signalling to provide its location information.
Editor\'s note: It is FFS which IKEv2 parameters are used to signal the
location information to the ePDG.
Editor\'s note: Solution Y and solution U differ only by the mechanism used to
send the info to the ePDG (EAP-AKA for solution Y, Native IKE transfer in
solution U). They are mutually exclusive.
## 6.6 Solution 6 for key issue #3: UPLI to OMA server
According to TS 23.167 [4] (e.g. see clause 7.6.1 of TS 23.167 [4]), LRF
function can use the OMA SUPL procedure to obtain location information
directly from the UE. Initiation of a SUPL session to a calling UE by a SUPL
E-SLP is enabled for LTE access using UDP/IP (e.g. see TS 23.167 [4] clause
H.4). Similar initiation could be defined for WLAN access which would mean
that an E-SLP (and LRF) would only need the UE IP address to instigate a SUPL
session.
When SUPL is used to obtain information to support routing of an emergency
call, positioning may be based mainly or solely on visible WLAN AP MAC address
and/or IDs for visible cells to reduce delay in obtaining this information at
a UE and processing it at an E-SLP.
When SUPL is used to obtain accurate location information required by the
PSAP, the additional cellular and/or WLAN measurements may be used (e.g. RTT,
RSSI) and/or methods like A-GNSS and OTDOA.
The solution is mostly supported by current standards and requires only a new
requirement (e.g. new annex) in TS 23.167 [4] to define applicability of SUPL
location support for IMS emergency calls with WLAN access.
This solution only applies for UEs (and networks) supporting OMA SUPL
procedures.
## 6.7 Solution 7 for key issue #3: UPLI to OMA server (fallback use case)
There may be scenarios where there are no other visible WLAN APs or where the
serving network does not have location information (or reliable or accurate
location information) configured for other visible WLAN APs and where there
are no visible cells (or no visible macro cells associated with reliable
preconfigured location information).
The solution partly overcomes this limitation would be for a UE to provide the
most recently visible cell ID or the most recent serving cell ID - e.g. by
including a second PANI header in a SIP INVITE containing the cell ID.
\- This may be included for all emergency call requests since a UE will not
know in advance whether location information for the serving/associated WLAN
AP MAC address is or is not configured in the serving network.
\- The serving network (e.g. the LRF or E-CSCF) can still know that the call
originates from a WLAN AP and not from a cellular access type from the
presence of a PANI containing a WLAN AP MAC address which may be defined to be
present if and only if a UE is accessing a WLAN AP.
\- Possibly a time value or \"age\" for the last visible cell ID can be
included as well although this will impact the PANI syntax.
Editor\'s note: The age information may be needed for the PSAP determination /
PSAP dispatch to know whether the Cell-Id can or cannot be leveraged.
This solution needs not impact stage 3 signalling (if an \"age\" value is not
included) except for adding a second PANI header in a SIP INVITE.
## 6.8 Solution 8: Location information from LRF for s2a
### 6.8.1 Solution principles
The solution is based on following principles:
\- The IMS ES procedure defined in TS 23.167 [4] are applied.
\- The location information is retrieved via LRF.
\- Usage of existing LCS reference architecture defined in TS 23.271 [9] for
3GPP based on LRF is applied to N3GPP architecture defined in TS 23.402 [7].
\- The existing procedures defined for TWAN are used without any modification.
NOTE: The scenario when the location information is retrieved from PCRF by
P-CSCF remains unmodified in respect current Rel-12 specification.
### 6.8.2 Reference architecture
The reference architecture for EPC is describe in figure 6.8-1.
{width="6.002083333333333in" height="3.823611111111111in"}
Figure 6.8-1: Reference architecture for WLAN EPC with LRF
The LRF is defined in TS 23.237 [8] and in TS 23.167 [4] with the following
modification:
\- To support TWAN ID specified in TS 23.402 [7].
\- To be able to extract location information from the TWAN ID.
The reference point SLh and Lh are defined in TS 23.271 [9] with the following
modification:
\- To be able to transport TWAN ID specified in TS 23.402 [7].
### 6.8.3 LRF functionalities
As defined in TS 23.167 [4] clause 6.2.3 with the following modification:
\- When the UE is connected to Trusted WLAN access the LRF shall be able to
receive the TWAN ID and to derive the location information in the format
required by IMS Core or Emergency Centre.
### 6.8.4 HSS/AAA functionalities
The HSS shall be able to map the request from LRF on SLh/Lh with the request
to AAA for Trusted WLAN.
### 6.8.5 PDN GW functionalities
No modification is required in respect to Rel-12 feature.
### 6.8.6 PCRF functionalities
No modification is required in respect to Rel-12 feature.
### 6.8.7 UE functionalities
The UE detects its location as defined in Solution X.
Editor\'s note: The solution X is described in a different clause.
### 6.8.8 User provided and network provided UE location via LRF
The procedure for retrieval of user provided and network provided UE location
information by IMS Core or Emergency Centre is shown in figure 6.8-2.
Figure 6.8-2: User provided and network provided UE location information via
LRF for TWAN
1) UE perform Initial attach to TWAN as defined in clause 16.2.1 of TS 23.402
[7].
2) As in step 2 of procedure in clause 7.6.1 of TS 23.167 [4], the UE starts
an IMS Emergency Service. The UE if able sends its location in SIP INVITE.
3) As in step 4 of procedure in clause 7.6.1 of TS 23.167 [4]. If the LRF
performs the OMA SUPL or OMA UPL procedure to retrieve the location
information directly by the UE, the steps from 4 to 9 can be skipped.
NOTE: The definition of OMA SUPL/UPL is outside the 3GPP scope.
4) the LRF/GMLC request to HSS the UE capability and the UE location.
Steps from 5 to 8 as in procedure in clause 16.2.3 of TS 23.402 [7].
9) the HSS provides to the LRF the UE capability and the UE location received
TWAN.
10) As in step 6 of procedure in clause 7.6.1 of TS 23.167 [4].
11) as in steps from 7a to 8 of procedure in clause 7.6.1 of TS 23.167 [4].
12) As in step 9 of procedure in clause 7.6.1 of TS 23.167 [4].
13) as in steps from 4 to 9 above.
12) As in step 11 of procedure in clause 7.6.1 of TS 23.167 [4].
## 6.9 Solution 9: Handling of UE multiple provided location information
The current PANI header has limitations when it comes to supporting multiple
locations.
RFC 7315 [10] describes the PANI header and states \"_This header contains
information on the access network that the UA is using to get IP
connectivity._ \" It is clear that the PANI in its current form can only be
used to provide information about the access actually in use for the SIP
session.
In order to:
allow the UE to provide in SIP signalling additional location information
(e.g. last cell seen by the UE) which is not tied to **the used IP access**
but rather to **the device** hosting the SIP UA;
enable a clear distinction between the information associated to the used IP
access and additional information about the device;
it is proposed that mechanisms are provided in case of UE access over WLAN to
allow:
providing additional location Information in SIP signalling, that enables
distinguishing a location associated with a point of access not currently used
to transport SIP signalling (e.g. Cell ID) versus a location associated with a
point of access currently used to transport SIP signalling (i.e. WLAN); and
providing age information in SIP signalling for the additional UE-provided
location associated with a point of access when the additional location is not
current (e.g. last cell ID seen by a UE).
## 6.10 Solution 10: Location Information Included in SIP Register
### 6.10.1 Overview
Solution 3 (clause 6.3) details how UPLI information contained in SIP INVITE
messages for untrusted WLAN can be used for PSAP selection, in a similar
manner this information may be used for local policy application.
TS 24.229 [12] (clause 5.1.1.4.1) requires that for an IMS re-registration
request or an IMS registration request for an additional public user identity,
the UE shall include a P-Access-Network-Info (PANI) header field in the
registration request if the associated information is available. For WLAN
access, the PANI would include the AP MAC address. This requirement may be
extended to any IMS Registration Request (via a new impact to TS 24.229 [12]).
Similar to Solution 7 (clause 6.7), a UE may also include a second PANI header
in an IMS registration request (which will be another impact to TS 24.229
[12]) that includes the identity of a visible cell or a recently visible cell.
Both types of PANI header refer to UPLI and are not fully trustworthy.
Therefore it is possible for an IMS node performing local policy controls when
a device first registers for IMS voice to have available the location related
information as described in solution 3 (clause 6.3.1) if the UE populates this
information. Either the P-CSCF, S-CSCF, HSS or AS can apply local policy
controls based on the UPLI location related information elements provided by
the UE when a user first registers for IMS voice service; the local policy may
decide to accept or reject the registration, or may trigger implementation
specific actions.. For example: a P-CSCF may reject an IMS registration
request if the UPLI and/or NPLI indicate WLAN access from a non-supported
location.
NOTE: The inclusion of UPLI information in the SIP Register is subject to
local privacy regulations.
## 6.11 Solution 11: Determine Emergency Call Numbers
### 6.11.1 Solution description
This solution applies for phase 2 and is related with Key Issue 16.
When the UE receives over 3GPP access, a list of local Emergency Call Numbers
(e.g. the \"Emergency number list\" received via 24.301 signalling) it stores
this list and keeps its local storage even though it is detached from the
PLMN; The UE needs to keeps only one list i.e. the list received from the last
registered PLMN
To determine the list of Emergency Call Numbers that apply where the UE is
located, the UE proceeds as follows:
\- When the user initiates a session and the UE needs to determine whether the
session is for an emergency, it proceeds as follows:
\- When the UE has a list of local Emergency Call Numbers received on a 3GPP
access and can determine that it is still in the same country than the PLMN
from which it has receives this list, the UE uses this list.
NOTE: The way for the UE to determine that it is still in the same country
than the country of its last registered access to 3GPP coverage is FFS. It may
e.g. leverage solution 13.
\- Otherwise the UE uses the list of local Emergency Call Numbers received
using mechanism described in clause 6.11.2.
\- Otherwise the UE uses any pre-configured list of local Emergency Call
Numbers.
### 6.11.2 Retrieve the list of Emergency Call Numbers from a WLAN AP
The UE may retrieve from a WLAN AP the list of Emergency Call Numbers that are
used in the geographic location of the AP. This list can be retrieved via ANQP
procedures either prior or after association with the AP. Each Emergency Call
Number provided by AP is a [URN, URI] pair, e.g. [urn:service:sos.fire,
tel:112;sip:+15555551002\@fire.com] (see IEEE Std 802.11-2012 [5]). The UE may
(a) forward the retrieved Emergency Call Numbers to the application which
initiates the emergency sessions or (b) may use them to identify emergency
session requests.
## 6.12 Solution 12: Select a WLAN for Emergency Services
When the UE is not connected to any WLAN and wants to select a WLAN for
initiating IMS emergency services, then:
\- The UE selects a WLAN based on user preferences (if any); otherwise:
\- If the UE supports the Access Network Discovery & Selection Function
(ANDSF) and it is provisioned with WLANSP rules from HPLMN and/or VPLMN, the
UE shall select a WLAN access network based on the WLAN selection procedures
specified in TS 23.402 [7], clause 4.8. In addition, the following selection
criteria may be applied:
\- If multiple WLANs fulfil the selection criteria in the active WLANSP rule,
the UE may select one of those WLANs that support QoS and Expedited Bandwidth
Request (EBR) (IEEE Std 802.11-2012 [5]). The UE determines which WLAN APs
support QoS and EBR by using the applicable procedures in IEEE Std 802.11-2012
[5].
\- If the UE does not support the Access Network Discovery & Selection
Function (ANDSF) or the UE supports ANDSF but is not provisioned with WLANSP
rules from either HPLMN or VPLMN, the UE shall select a WLAN access network
based on its own implementation-specific criteria. These implementation-
specific criteria may give precedence to WLANs that support QoS and Expedited
Bandwidth Request (EBR) (see IEEE Std 802.11-2012 [5]).
If the UE determines that it cannot connect to an available WLAN because it
lacks the necessary authentication credentials (e.g. the UE has no USIM or the
UE has a USIM but no WLAN supports interworking with HPLMN, or with an
equivalent home service provider, or with a preferred roaming partner of
HPLMN) then the UE shall attempt unauthenticated access to WLAN. In this case,
the UE shall determine which WLANs support unauthenticated access for
emergency services (by using the applicable procedures in IEEE Std 802.11-2012
[5]) and shall associate with one of these WLANs with an emergency services
association (specified in IEEE Std 802.11-2012 [5]).
Editor\'s note: What kind of restrictions the AP applies to UE\'s traffic when
the UE associates with an emergency services association is FFS for both S2a
and S2b cases.
## 6.13 Solution 13: Determine Location & Country Info
If the UE needs to provide location information when requesting an emergency
session, the UE may determine its location by using its own implementation-
specific means (e.g. by using its GPS receiver). If, however, the UE cannot
determine its location by its own means, the UE may retrieve its location from
a WLAN AP, prior or after association with the AP. This location information
can be retrieved via ANQP, by requesting the Civil Location and/or Geospatial
Location ANQP elements (see IEEE Std 802.11-2012 [5]). The Extended
Capabilities IE included in the beacon frames of an AP indicates if the AP
provides Civic and/or Geospatial location.
The UE may determine the country it is located in either by implementation-
specific means or by receiving the Country IE included in the beacon frames of
available WLAN APs (see IEEE Std 802.11-2012 [5]). The Country IE is
transmitted by all HS2.0 compliant APs, as specified in _Hotspot 2.0 (Release
2)_ [6]. The country information can be utilized by the UE during emergency
procedures over WLAN, e.g. for ePDG selection.
## 6.14 Solution 14: Overall procedure
NOTE: The text of this clause is not meant to correspond to actual normative
text.
### 6.14.1 Network settings to support Emergency services over WLAN
To support emergency services, an ePDG is configured with Emergency
Configuration Data similar to what is described in TS 23.401 [3] for the MME
case.
NOTE: To support emergency sessions over WLAN, a PLMN is assumed to have
deployed ePDG(s) that support SWu sessions for emergency services, as well as
P-CSCF(s) and E-CSCF(s) that support IMS emergency sessions.
### 6.14.2 Conditions for UE to set up an Emergency service over WLAN
In this release of the specification, a UE attempts emergency calls over WLAN
only in case of:
\- Previous Unsuccessful (or impossibility to issue) UE detected or UE un-
detected, emergency call attempts over the cellular technologies supported by
the UE, and
\- The UE is not aware that it is located in a different country than the
country of its HPLMN.
NOTE 1: How the UE can determine that it is located in a different country
than its HPLMN is implementation dependent.
NOTE 2: How the UE detects that the target URI or that the digits dialled by
the User correspond to an emergency call is not defined in this release. As an
example, the UE may use the list of emergency call numbers it last received
over 3GPP access.
### 6.14.3 Overview
When an UE is requested to set-up an emergency session, the UE
\- releases any PDN connection it may have over WLAN (SWu)
NOTE 1: This induces the release of the existing IP connectivity services.
\- selects an ePDG for emergency services.
\- sets-up a PDN connection for emergency as described in clauses 6.14.4.
The UE gets the identity of suitable P-CSCF as currently defined in TS 23.167
[4].
Then the UE needs to REGISTER (for emergency services) over IMS before it can
issue IMS signalling related to emergency services.
The set up of IMS sessions takes place as currently described in TS 23.167 [4]
with following modification:
\- In IMS signalling the UE may add as User Provided Location Information
multiple elements of location information. The exact list of User Provided
Location Information that the UE may add in IMS signalling corresponds to
information listed in solution 3, 7, \" Base Solution to Key issue 3: Handling
of UE multiple provided location information\".
NOTE 2: The P-CSCF may add Network provided location information when it can
get such information from the PCRF. The Network provided location information
may be un-trusted when it corresponds to the SWu outer IP address and port as
detected by the ePDG
NOTE 3: The IMS signalling is sent in an encrypted way over the WLAN radio
(using SWu ciphering) thus protecting user location information from
eavesdropping.
NOTE 4: Any node that stores user location information (3GPP AAA server,
P-CSCF, etc.) needs to take care that this information cannot be accessed by
un-authorized persons (protecting the privacy of the end-user).
The solution \"Location Information Included in SIP Register\" applies to
normal IMS registrations over WLAN.
### 6.14.4 EPC access for emergency services in S2b case
In the S2b case, the UE gets WLAN access from any WLAN AP.
No specific mechanisms are defined to support access to a WLAN AP for
emergency services except that in case a 3GPP AAA server is used to
authenticate the UE for the WLAN access, this 3GPP AAA server stores any
trustable location information it may get from a WLAN AN.
NOTE 1: This corresponds to the case where the UE gets IP connectivity from an
access whose location information is trusted by the HPLMN (e.g. the HPLMN
trusts the Wireline provider but the Wireline provider has not deployed a
TWAN) and then the UE uses an ePDG to reach IMS.
If the UE cannot determine it is in a different country from its home country,
the UE needs to select an ePDG that supports emergency services. For this
purpose it shall be possible to configure the UE with address(es) of ePDG that
supports emergency services in its HPLMN. This ePDG address can take the
format of:
\- An FQDN.
\- An IP address.
If the UE is not locally configured with address(es) of ePDG that supports
emergency services in its HPLMN, the UE may use a dedicated FQDN related with
emergency services that is built based on its HPLMN Id . The format of this
FQDN needs to be defined in TS 23.003 [11].
NOTE 2: When the UE does not know whether it is in a different country, this
may lead the UE to connect to an ePDG in the HPLMN while roaming. When the UE
knows it is in a foreign country, it does not issue emergency sessions over
WLAN.
NOTE 3: How the UE determines its location is for implementation.
Editor\'s note: The solution for ePDG selection may need to be enhanced during
the normative phase.
The PDN connection setup procedure as described in steps A.1-E.1 in TS 23.402
[7] clause 7.2.4 applies with the following additions:
\- the UE adds an emergency indication in order to indicate that the EPC
access is requested to support emergency services.
\- Any APN indication that the UE may add in its signalling to the ePDG is
ignored by the network. For an access associated with an emergency indication,
the ePDG considers that the target APN is the APN configured within its
Emergency Configuration Data and the ePDG does not check whether this APN is
part of the subscription of the UE.
\- The emergency indication is also used by the 3GPP AAA server and ePDG to
give precedence to this service in case of (control plane) congestion reported
via GTP-c and/or Diameter.
\- The UE local IP address and optionally UDP source port number (if NAT is
detected) are included by the ePDG in the Create Session Request message. The
UE local IP address and optionally UDP source port number (if NAT is detected)
are forwarded by the PDN GW to the PCRF in IP-CAN Session Establishment
procedure.
NOTE 4: This is a way to provide location information to the P-CSCF via the
PCRF. Nevertheless this information cannot be trusted (as the UE may spoof its
IP @) and is not used when more reliable location information is available.
The ePDG forwards to the PGW any (trusted) location information it has got
from the 3GPP AAA server. This information is propagated to the PCRF via the
IP-CAN Session Establishment procedure and then to the P-CSCF upon receiving
an P-CSCF request for Access Network.
## 6.15 Solution 15: Authenticated UE leveraging indication of ePDG/TWAN
support for emergency services
### 6.15.1 Overview
This solution is meant for SEW phase 2.
This solution assumes that NOT all ePDG/TWAN in a network support emergency
services.
NOTE 1: This solution assumes that NOT all TWAN support emergency services.
The TWAN may belong to a trusted Fixed Broadband provider and different Fixed
Broadband providers may have different levels of support of emergency
services.
NOTE 2: This solution assumes that NOT all ePDG support emergency services.
This solution relies on providing the UE with an indication of TWAN/ePDG
support of emergency sessions. This indication is sent even for regular
service of Non 3GPP access to EPC. When a UE receives an indication that the
ePDG / TWAG that serves this UE supports emergency services, this means that
via this ePDG / TWAG:
\- The UE may request emergency bearers: the TWAG / ePDG is configured with
Emergency Configuration Data that define the data e.g. APN, QoS, etc. to use
in the local PLMN for Emergency services.
\- The UE may reach P-CSCF, E-CSCF, etc. that support emergency services.
NOTE 3: In this solution, indication of TWAN support of emergency session does
not mean any specific support by the WLAN AN.
Thus, if later on the UE needs to set up an emergency session and the ePDG /
TWAG is located in the same country than the UE (local country), the UE can
reuse the same ePDG/TWAN for emergency services.
This allows the UE to keep its regular IMS registration while issuing an
emergency session. The regular IMS registration is useful for PSAP call back
services.
NOTE 4: The TWAN is always located in the local country.
Editor\'s note: How the UE detects its current serving ePDG is in the local
country is FFS. This could rely e.g. on solution 13 for the UE to determine in
which country it is located.
The choice of the access (3GPP / WLAN) to use to set up an emergency session
is not described in this solution and is assumed to be described as part of
another solution.
This solution is only used for emergency services delivered to \"valid UE\"
(i.e. in case the UE gets an authenticated and authorised access to EPC via
and ePDG/TWAN). For the other cases of IMS emergency sessions (e.g. UE without
SIM or UE with no authorization to access to EPC) the UE is assumed NOT to
have a regular access to EPC via a TWAG/ePDG!
When the UE using an ePDG that does not support emergency services needs to
set up an emergency session, then the UE detaches from this ePDG in order to
attach to another ePDG that supports emergency services.
NOTE 5: How to find such an ePDG is to be defined by another solution.
### 6.15.2 Way to provide the indication of emergency bearer support in case
of Untrusted access
In case of Untrusted access, the ePDG notifies the UE whether it supports
emergency services in IKE signalling.
### 6.15.3 UE getting added IP Connectivity for emergency services over an
ePDG
If the UE is not already connected to an ePDG that supports emergency
services, the UE needs to select such an ePDG. Then the UE requests an
emergency PDN connection from this ePDG leveraging the procedure of \"Initial
Attach on S2b\" specified in TS 23.402 [7] clause 7.2. This case is not
further described in that clause.
If the UE is already connected to an ePDG that supports emergency services,
and the UE has decided to use WLAN access to set-up an emergency session, the
UE requests an (additional) emergency PDN connection from this ePDG using the
procedure specified in TS 23.402 [7] clause 7.6 with a few modifications
described below.
The modifications to the procedure specified in TS 23.402 [7] clause 7.6 (UE
requests of an additional (emergency) PDN connection from a ePDG) correspond
to the same mechanisms than defined as part of SEW phase 1 for the Initial
attach to an ePDG for emergency services e.g. (non exclusive list):
\- The UE adds an emergency indication in IKE signalling in order to indicate
that the EPC access is requested to support emergency services. This
indication is the same than the one defined in Rel-13.
\- EAP-AKA authentication currently (3GPP Rel-13) specified in TS 33.402 [14]
is used by the UE to authenticate with the network via the ePDG ; No procedure
for additional authentication and authorisation with an external AAA Server as
specified in RFC 4739 [50] and in TS 33402 [45] is expected.
\- Any APN received by the ePDG from the UE is ignored as the ePDG uses its
Emergency Configuration Data to determine the APN (and QoS) to be associated
with the emergency PDN connection and possibly to determine the PDN GW to use.
\- No parameter sent in the Create Session Request message is related with the
user subscription. Parameters in the Emergency Configuration Data are used
instead.
\- The ePDG adds in the Create Session Request location information it may
have about the UE:
\- WLAN Location Information it may have received from the AAA server about
the UE.
\- The UE local IP address and optionally UDP source port number (if NAT is
detected).
### 6.15.4 Way to provide the indication of emergency bearer support in case
of trusted access
In case of trusted access, the TWAN notifies the UE whether it supports
emergency services as follows:
\- The TWAG indicates (via the TWAP) to the 3GPP server AAA server whether it
supports emergency sessions.
\- The AAA server relays this information in EAP signalling sent to the UE.
NOTE: The transfer of the information is indirect (via 3GPP AAA server) but
allows not to modify the WLAN AN to support this capability.
### 6.15.5 UE Request for PDN connectivity for emergency services in case of
trusted access in MCM
When the UE is connected to a trusted WLAN supporting emergency services and
the multi-connection mode has been selected, the UE uses the PDN connectivity
request procedure in order to establish a PDN connection for emergency
services. In case of a PDN connection for emergency services the procedure
described in TS 23.402 [7] clause 16.8 takes place with following exceptions:
\- The UE adds an emergency request indication in the WLCP PDN Connection
Request sent to the TWAG
\- When the WLCP PDN Connection Request contains an emergency request
indication, the TWAG ignores any APN received from the UE in that message,
considers that the target APN is the APN configured within its Emergency
Configuration Data and does not check whether this APN is part of the
subscription of the UE.
## 6.16 Solution 16: Support of emergency services by TWAN
### 6.16.1 Overview
Editor\'s note: This version of the solution describes only the case of a duly
authenticated UE. The Support of emergency services by TWAN for other cases is
FFS (to be provided in later meetings)
When an UE that needs to set-up an emergency session over WLAN is already
attached to a TWAN in SCM mode but not for emergency services, then the UE
detaches from the TWAN in order to re-attach for emergency services (as
described in clause 6.16.2).
NOTE: This induces the release of the existing IP connectivity services.
(as described in solution 6.15 \"Authenticated UE leveraging indication of
ePDG/TWAN support for emergency services\") When an UE that needs to set-up an
emergency session over WLAN is aware that it is already attached in MCM mode
to a TWAN that supports emergency services, the UE does not need to issue an
attach for emergency services but issues a request for PDN connectivity for
emergency services.
When an UE that needs to set-up an emergency session over WLAN is not attached
to a TWAN:
\- the UE attaches for emergency services (SCM).
\- the UE attaches for emergency services and triggers the \"UE Initiated PDN
connectivity request procedure in WLAN on S2a\" procedure.
This is further described in clause 6.16.2.
In S2a case, the TWAN-ID (trusted location information) is propagated as
defined in TS 23.402 [7] clause 16 and in TS 23.228 Annexes R and T:
\- From TWAG to the PCRF (and to the P-CSCF) (via S2a, Gx and Rx).
\- From TWAG to AS via the 3GPP AAA server and the HSS.
NOTE: The HSS retrieval of the TWAN-ID is not possible in case of SIM less
emergency session.
### 6.16.2 UE Attach to TWAN for emergency services (for emergency services
that require authenticated UE)
In order to obtain access to the EPC for IMS emergency services in the S2a
case, the EAP-AKA\' authentication procedures specified in TS 23.402 [7]
clause 16 and in TS 33.402 [14] are used by the UE to authenticate with the
TWAN. When the UE attach is for emergency services, the UE adds an emergency
request in EAP-AKA\' signalling sent to the 3GPP AAA server. The 3GPP AAA
server uses locally this emergency request information and forwards it to the
TWAN over STa.
The emergency request information is used by the 3GPP AAA server and TWAP/TWAG
to give precedence to this EPC access in case of congestion reported via GTP-c
and/or Diameter.
The TWAN also adds in the signalling sent to the 3GPP AAA server (over STa) an
indication of
1) whether it supports emergency services.
2) whether the VPLMN accepts emergency services from authenticated UE being in
a location where they are restricted from service.
NOTE 1: The indication in bullet 2) above is to cover situations like the
following: an UE is allowed to issue an emergency session in the VPLMN even
though the UE has no roaming right to access to EPC in that VPLMN. In that
case the 3GPP AAA server shall not reject the EPC access even though the UE is
not allowed to roam in the VPLMN.
NOTE 2: The rest of this clause assumes the TWAN has indicated it supports
emergency services. Otherwise the 3GPP AAA server rejects the UE access for
emergency services.
NOTE 3: A AAA signalling chain has to exist between the TWAN and the 3GPP AAA
server in HPLMN.
When the 3GPP AAA server detects that the UE is in a location where it is
restricted from service and the TWAN has indicated it accepts emergency
services for authenticated UE being in a location where they are restricted
from service and the UE has indicated an emergency request in EAP-AKA\'
signalling, the 3GPP AAA server accepts the access request (the attach
procedure) and provides no authorization data (e.g. list of allowed APN) to
the TWAN.
The 3GPP AAA server also indicates to the TWAN that NSWO is only allowed for
the UE to be able to exchange WLCP signalling with the TWAG..
When the UE is in a location where it is NOT restricted from service, the 3GPP
AAA server provides authorization data (e.g. list subscribed APN) to the TWAN
as per existing (Rel-13) specifications.
NOTE 4: This means that once the emergency PDN connection is released the UE
does not need to re-Attach to benefit from regular services.
The selection of the mode (SCM / MCM) is done according to existing (Rel-13)
specifications.
In MCM mode once the Attach procedure is completed, the UE triggers the \"UE
Initiated PDN connectivity request procedure in WLAN on S2a\" procedure,
indicating that the PDN connection is for emergency services.
The network has to prevent an UE from attaching for emergency services and
then issuing regular PDN connection request
\- in MCM, when the UE is attached for emergency services, the TWAG shall only
allow emergency PDN connections. Especially the IP address / prefix provided
to the UE to carry WLCP signalling shall not allow the UE to exchange other
kind of traffic.
\- In SCM the TWAG simply ignores any APN value sent by the UE in Attach
request and activates a PDN connection based on the information in its
Emergency Configuration Data.
When the EPC access is associated with an emergency indication, the UE does
not need to send an APN to the network. Anyhow any APN indication that the UE
may add in EAP-AKA\' request (SCM) or in WLCP signalling (MCM) is ignored by
the network as the TWAN considers that the target APN is the APN configured
within its Emergency Configuration Data and the TWAN does not check whether
this APN is part of the subscription of the UE.
The PGW behaviour is according to procedures already defined for emergency
services e.g.:
\- The PGW derives the data related with emergency services from the APN value
received in Create Session Request from the TWAN.
\- The TWAG forwards to the PGW any Network Provided location information
(TWAN Id) it has got (in Create Session Request, in Delete Session request and
in responses to PGW requests such as Create Bearer Request). This information
is propagated to the PCRF via the IP-CAN Session Establishment procedure or
the PCRF has requested Access Network Information.
## 6.17 Solution 17: Support of Mobility with 3GPP access (EPC).
### 6.17.1 Overview of the possible solutions
This clause only applies for SEW phase 2.
This clause is applicable to key issues 12 and 13 (Handover of Active
Emergency call between WLAN and 3GPP accesses). It addresses only PS hand-Over
(not the Hand-Over implying CS domain).
EPC mechanisms currently exist to support mobility between 3GPP and Non 3GPP
access for regular PDN connections. They rely on updating the HSS, at the
creation of the PDN connection, with the identity of the PGW serving a given
UE for an APN. Then when the UE connects onto a target access where it may be
willing to Hand-Over the PDN connection, the HSS provides the identity of this
PGW to the (target) serving node (e.g. TWAG / ePDG / MME) of the target
access. This identity is used e.g. when a PDN connection with the Hand-Over
indication is set-up via the (target) serving node.
Reuse of these mechanisms requires some care as emergency sessions may be set
up for UE without an USIM. In this case the HSS of the UE is unknown. In case
of duly authenticated UE, the HSS of the UE can be determined but the HSS (in
the HPLMN) may have no knowledge of the APN being used for emergency services
in a VPLMN (as the HPLMN and the VPLMN are using different APN values for
emergency services).
Following alternatives may be considered:
1) To configure in the Emergency Configuration data of the serving nodes (TWAG
/ ePDG / MME) of a PLMN a static PGW identity (with possibly a fall back
identity to cope with the failure of the active PGW) that applies to any
Emergency PDN connection. No HSS data storage of the PGW used for emergency
services is needed.
2) To configure in the Emergency Configuration data of the serving nodes (TWAG
/ ePDG / MME) of a PLMN as follows:
a) a static PGW identity (with possibly a fall back identity to cope with the
failure of the active PGW) is configured for Emergency PDN connections related
with a non authenticated UE.
b) Multiple PGW in the local PLMN may support Emergency PDN connections
related with authenticated UE.
For this case, the actual PGW to use for a given PDN connection is selected
based on DNS look up for the local APN related with emergency services. HSS
data storage of the PGW used for emergency services is needed as well as
retrieval of this PGW by the (target) serving node (e.g. TWAG / ePDG / MME).
This requires the HSS to have a dedicated data storage for the PGW being used
by emergency services of an user (as there is no APN subscription for the APN
used by emergency services possibly in a VPLMN ) and thus requires an explicit
signalling with MME/3GPP AAA server (S6a/d, SWx) to indicate a PGW for
emergency services.
This is further detailed in clause 6.17.3.
3) Multiple PGW in the local PLMN may support Emergency PDN connections
related with authenticated UEs, unauthenticated UEs and UEs without USIM. When
a PDN Connection for emergency services is established, the serving node (TWAG
/ ePDG / MME) provides the PGW identity together with the UE location
information and other parameters to the LRF / Location Server. The LRF/GMLC
stores the PGW identity together with the other information already stored by
LRF/GMLC (e.g. UE identity). Later, when the UE makes a handover attach in
another access (3GPP access or WLAN access), the serving node (TWAG / ePDG /
MME) the UE provides the UE location information to LRF/GMLC and the LRF/GMLC
provides the PGW identity in use together with the reply to the serving node.
Further details are provided in 6.17.2 below.
### 6.17.2 Solution based on retrieving PGW ID from LRF/GMLC
This solution is applicable to key issues 12 and 13 (Handover of Active
Emergency call between WLAN and 3GPP accesses).
The solution relies on the LRF/GMLC for storing the PGW Identity when the UE
makes initial attach, and retrieving the PGW Identity from the LRF/GMLC as the
UE makes handover from 3GPP access to WLAN access, or from WLAN access to 3GPP
access. The solution supports mobility for both authenticated UEs and
unauthenticated UEs (including UEs without USIM) as well as both non-roaming
and roaming UEs.
The solution assumes that an interface to LRF/GMLC is available when the UE
connects in untrusted WLAN access (e.g.an interface from ePDG as suggested in
solution 18) and when the UE connects in trusted WLAN access (e.g. an
interface to LRF/GMLC from TWAG). And interface from MME to LRF/GMLC is
already supported as per existing specifications.
A call flow for initial attach in untrusted WLAN access, and a subsequent
handover to 3GPP access is shown below. A similar call flow would apply in the
reverse handover direction.
At handover attach the serving node (MME, SGSN, ePDG, TWAG) fetches the PGW
info from the GMLC/LRF. In case the serving node also supports location
reporting towards GMLC/LRF, two solution variants are possible:
1\. Location Reporting during Handover Attach is performed at the same time
the PGW info is requested, i.e. early during the Handover Attach procedure as
shown in Alt 1 below. This option allows a single round-trip with GMLC/LRF and
only adds PGW Identity information to current location reporting signalling.
The GMLC/LRF remembers the old (source access) location for a while even after
the new (target access) has reported the new location information. In case the
handover attach fails for some reason, the new (target access) cancels its
location with the GMLC/LRF and the GMLC/LRF reverts back to the old location
information.
2\. Request for PGW Identity information from GMLC/LRF is performed separately
from Location Reporting, as shown in Alt 2 below. This introduces an extra
round-trip compared to today. The Location Reporting is kept independent of
the attach procedure and may be performed after the attach procedure has been
successfully completed.
As described in TS 23.271 [9], it is assumed that a single LRF is used by an
operator for all IMS emergency calls.
Figure 6.17.2-1
1\. A PDN Connection for emergency calling is established over untrusted WLAN
access.
2a. The ePDG provides the LRF/GMLC with UE location information, the UE
identity (IMSI/IMEI) as well as the PWG Identity information.
2b. The LRF/GMLC stores the information received (e.g. UE identity PGW
identity) and provides a reply to the ePDG.
3\. Later, the UE makes handover attach in 3GPP access, and also provides an
indication that the request is to receive emergency services.
4a. The MME requests the PGW Identity information from the GMLC/LRF. In case
location reporting is supported, two variants are possible:
> Alt 1: As part of the handover of the PDN Connection, the MME contacts the
> LRF/GMLC to provide location information and to retrieve the PGW Identity.
>
> Alt 2: As part of the handover of the PDN Connection, the MME contacts the
> LRF/GMLC to retrieve the PGW Identity only (i.e. not reporting location
> information).
4b. The LRF/GMLC provides a reply to the MME containing the PGW Identity
information.
5\. The handover of the PDN Connection for emergency services is completed.
6\. In case Alt 2 was used in step 4a and location reporting is supported, the
MME may report the UE location to the GMCL/LRF separately.
### 6.17.3 Solution based on HSS storing the PGW for emergency PDN connection
This solution only applies for authenticated PDN connections for emergency
services. It targets both roaming and non roaming cases
In case of authenticated PDN connections for emergency services:
\- During an initial PDN connection for emergency services (no Hand-over
indication received from the UE) the PDN GW to use may be selected based on
DNS look up for the local APN related with emergency services (configured in
the Emergency data). The address of the PDN GW used for the emergency PDN
connection is provided to the HSS together with an indication that the PDN
connection is for emergency services (\"PDN GW currently in use for emergency
services\").
\- The \"PDN GW currently in use for emergency services\" information is
provided to the HSS by the MME over S6a or by the ePDG / TWAG via the 3GPP AAA
server (thus over SWm / STa and SWx).
\- The HSS stores the address of the PDN GW in a specific data \"PDN GW
currently in use for emergency services\". This data is not associated with
any APN.
\- During a PDN connection for emergency services with an Hand-over indication
received from the UE the PDN GW to use is the PDN GW provided by the HSS in
\"PDN GW currently in use for emergency services\".
\- The \"PDN GW currently in use for emergency services\" information is
provided by the HSS as part of the subscription information sent to the MME
over S6a or to the ePDG / TWAG via the 3GPP AAA server (thus over SWx and SWm
/ STa).
Steps 5 of TS 23.402 [7] Figure 7.2.5-1: \"Initial attachment for emergency
services over GTP based S2b\" is modified as follows (no modification to the
drawing, just provided for background information).
Figure 7.2.5-1: Initial attachment for emergency services over GTP based S2b
5) As in step C.1 of clause 7.2.4. with the following specificities:
\- An indication of a PDN connection for emergency service is provided on both
S6b and SWx. When the HSS receives such indication, it associates the PDN GW
address provided with this indication (\"PDN GW currently in use for emergency
services\" ) with the UE context for emergency services.
A similar modification is needed for TS 23.401 [3] e.g. on \"Figure 5.10.2-1:
UE requested PDN connectivity\" (no modification to the drawing, just provided
for background information):
Figure 7.2.5-2
15\. _Text unchanged [_ After the MME receives Modify Bearer Response in step
14, if Request type does not indicate handover and an EPS bearer was
established and if the subscription data indicates that the user is allowed to
perform handover to non-3GPP accesses and if this is the first PDN connection
associated with this APN and if the MME selected a PDN GW that is different
from the PDN GW identity which was previously indicated by the HSS in the PDN
subscription context, the MME shall send a Notify Request including the PDN GW
address and the APN to the HSS for mobility with non-3GPP accesses. The
message shall include information that identifies the PLMN in which the PDN GW
is located. ]
T _ext removed [_ If the Request Type of the UE requested connectivity
procedure indicates \"Emergency\", the MME shall not send any Notify Request
to the HSS. ]
_New text [_ In case the Request Type indicates \"Emergency\", the MME shall
send a Notify Request to the HSS including the \"PDN GW currently in use for
emergency services\" _.]_
The (new) procedure for Hand-Over attachment for emergency services over GTP
based S2b works as follows:
Figure 7.2.5-3: Hand-Over attachment for emergency services over GTP based S2b
2) ...
\- Upon a successful authorization by the 3GPP AAA server, the ePDG stores
subscription information received from the 3GPP AAA but does not use this
information for the emergency PDN connection apart from the \"PDN GW currently
in use for emergency services\" that is uses to send the Create Session
Request in step 3. If no \"PDN GW currently in use for emergency services\" is
received from the 3GPP AAA server, the ePDG instead uses Emergency
Configuration Data to get information on the APN and possibly on the PDN GW to
use to set-up the emergency PDN connection in step 3.
Editor\'s note: A similar procedure needs to be defined for the TWAN case.
## 6.18 Solution 18 for Key issue 3: ePDG Push of location information to
LRF/LS at emergency attachment/De-attachment
At emergency attachment to an ePDG, the ePDG shall push subscriber location
data to the LRF/LS. This requires ePDG to support the SLg reference point.
Two scenarios applicable to authenticated UEs can be distinguished in terms of
the location data to be provided by ePDG.
In one scenario, location information may correspond to WLAN Location
Information the ePDG may have received from the AAA server about the UE. This
information is provided by the ePDG when it is available (when the 3GPP AAA
server UE considers that location information coming from the WLAN AN is
trustable). In this scenario, the LRF can use WLAN Location Information to
identify subscriber location that allows it to select an appropriate PSAP
accordingly.
In the second scenario, location information includes only the UE local IP
address and optionally UDP source port number (if NAT is detected). The UE
local IP address on its own cannot identify a subscriber location, but can be
used in conjunction with a UPLI BSSID in the subscriber initiated emergency
session, and received by the LRF/LS later, to confirm an approximate
subscriber location.
For both of the above scenarios, subscriber location data shall include the UE
location information as described above, as well as the following information
in TS 29.172 [13]:
Table 6.18-1
* * *
Information element name Mapping to Diameter AVP Cat. Description Location
Event Location-Event M This Information Element shall contain the type of
event that caused the location procedure to be initiated. IMSI User-Name C If
present, this Information Element shall contain the IMSI of the user whose UE
is to be positioned (see Note1). MSISDN MSISDN C If present, this Information
Element shall contain the MSISDN of the user whose UE is to be positioned.
IMEI IMEI M This Information Element shall contain the IMEI of the UE to be
positioned . It is mandatory for authenticated and non-authenticated UEs. NOTE
1: For authenticated UE this is mandatory to enable NPLI be used to locate
PSAP where regulation mandates that.
* * *
For unauthenticated UEs, the information pushed by the ePDG to the LRF
includes only the UE local IP address and optionally UDP source port number
(if NAT is detected). The UE local IP address on its own cannot identify a
subscriber location, but can be used in conjunction with a UPLI BSSID in the
subscriber initiated emergency session, and received by the LRF/LS later, to
confirm an approximate subscriber location.
If an ePDG detected or became aware that a UE, whose location information has
been previously reported to an LRF/LS, left the WLAN coverage, the ePDG shall
report this to the LRF/LS. This enables the LRF/LS to maintain updated UE
location information.
NOTE: The LRF currently correlates UE location data received from ePDG with a
received emergency session received from E-CSCF using the MSISDN for that
purpose. This does not satisfy regulations where NPLI is required to be used
to locate PSA and where a UE has multiple devices sharing the same MSISDN.
Hence IMEI would therefore be mandatory.
## 6.19 Solution 19: Support of emergency services for un-authenticated UE
### 6.19.1 Overview
This solution is intended to apply to Key issue 8 and thus to SEW phase 2.
The solution assumes the TWAN and the ePDG supports emergency services
TS 23.401 [3] distinguishes 4 cases for the support of emergency services.
1\. Valid UEs only. No limited service state UEs are supported in the network.
2\. Only UEs that are authenticated are allowed. These UEs must have a valid
IMSI. These UEs are authenticated and may be in limited service state [in TWAN
case this corresponds to an UE that is not allowed to get TWAN access from the
VPLMN].
3\. IMSI required, authentication optional. These UEs must have an IMSI. If
authentication fails, the UE is granted access and the unauthenticated IMSI
retained in the network for recording purposes. The IMEI is used in the
network as the UE identifier. IMEI only UEs will be rejected (e.g., UICCless
UEs).
4\. All UEs are allowed. Along with authenticated UEs, this includes UEs with
an IMSI that cannot be authenticated and UEs with only an IMEI.
This solution covers cases 3 and 4 above (UE without IMSI and UE with IMSI
that cannot be authenticated). case 3\" and \"case 4\" within the solution
refer to the cases above.
Current procedures allowing an UE to attach to a TWAN rely on the UE and the
TWAN exchanging information via the 3GPP AAA server e.g. allowing the UE and
the TWAN to:
\- Negotiate the Connection Mode (SCM/MCM) and in MCM provide the UE with
information on how the address the TWAG over WLCP
\- In SCM exchange the parameters of the PDN connection (requested IP version,
allocated IP address, etc.)
\- etc.
This is because as long as the access has not been granted to the UE on the
WLAN AN (AP) the only way for the UE to communicate with the EPC is via EAP
signalling (and in SCM it is the only way for the UE to communicate with the
TWAN at all).
The solution for un-authenticated UE relies on the same mechanism than for the
case of authenticated UE i.e. a 3GPP AAA server is involved even though no
authentication is to take place. This renders the case of unauthenticated
access to a TWAN for emergency services similar to the case of authenticated
access to a TWAN for emergency services from UE, WLAN AN (AP) and TWAN view
point.
\- This allows the UE and the network to exchange parameters they exchange via
EAP-AKA\' in case of a regular authentication (e.g. request from the UE for an
IP version in SCM ; TWAN control plane address in MCM).
The access to an ePDG (in case 3. and 4. above) relies on the same mechanisms
i.e. a 3GPP AAA server is involved even though no authentication is to take
place. This renders the case of unauthenticated access to an ePDG for
emergency services similar to the case of authenticated access to an ePDG for
emergency services from UE, AAA and ePDG view point.
For an UE that needs to set-up an EPC access over WLAN in order to issue an
emergency session, when it receives from the authenticator a request to
provide its identity (as part of an EAP-Identity request):
\- (case 4) When the UE has got no credential to access to the EPC (the UE has
got no USIM), the UE sends a specific identity for Emergency Support purpose
in NAI format and that is built based on its IMEI and on a specific realm
dedicated to the support of emergency services within 3GPP networks.
\- (Case 3) When the UE has got credentials (USIM) but knows it can\'t get
authenticated (a previous authentication attempt has failed)the UE sends a
specific identity for Emergency Support purpose in NAI format and that is
built based on its IMSI and on a specific realm dedicated to the support of
emergency services within 3GPP networks. The network has to identify the UE
via its IMEI, so the network shall get the IMEI of the UE in order to store
the association between the IMSI and the IMEI and to then identify the UE by
its IMEI within the network.
\- When the UE has got credentials (USIM), it may have tried an authentication
for emergency service using the NAI based on PLMN derived from IMSI. If this
attempt has failed, the UE shall retry the authentication as described in
bullet 2 above.
This request is routed, based on the realm of the NAI, to a specific 3GPP AAA
server function that in networks where such kind of access for emergency
services is allowed always grants access but provides specific authorization
data that allow network access only for emergency services. This solution
works only when the WLAN AN is capable of resolving the specific realm
dedicated to the support of emergency services within 3GPP networks.
Apart from exceptions related with the absence of authentication and with the
computation of the MSK, the EAP-AKA\' /EAP-AKA and AAA procedures take place
as in the case of a regularly authenticated UE. Each of the UE and of the AAA
server locally computes the MSK.. The AAA procedure provides the TWAN /ePDG
with the MSK (Master Session Key) to be used for security on the radio
interface. The specification of derivation of MSK in this scenario if left to
SA WG3.
The solution assumes the TWAN supports emergency services.
### 6.19.2 Detailed solution for a TWAN access
#### 6.19.2.1 Emergency session over TWAN for an UE with USIM but that but
can\'t get authenticated (case 3)
For the case where the UE has got an USIM but knows it can\'t get
authenticated (the local network does not have a AAA relationship (direct or
indirect) with the HPLMN of the UE and thus cannot proceed with the
authentication of the UE), the UE creates a NAI with the same specific realm
than in case of an UE without USIM but uses an IMSI (and not an IMEI) in the
user name part of the NAI provided as an answer to an EAP-Identity initiated
by the authenticator.
This corresponds to an UE with an USIM that needs to set-up an emergency
session but does not find any suitable WLAN network allowing it to get
authenticated by its HPLMN or whose authentication request has been previously
rejected by the network.
The rest of the procedure is the same than the procedure for a SIMless UE,
apart from the following points:
\- the network has to identify the UE via its IMEI, the dedicated 3GPP AAA
server shall get the IMEI of the UE and to provide it to the TWAN in order for
the TWAN to store the association between the IMSI and the IMEI and to then
identify the UE by its IMEI within the network. When the UE has a USIM. the
IMSI is used instead of the IMEI to derive the MK and thus the MSK as
described in clause 6.19.2.3.
In case 3, since IMSI is required and the authentication is optional, the 3GPP
AAA server may accept the request from a UE for which WLAN does not supports
interworking with HPLMN, or with an equivalent home service provider, or with
a preferred roaming partner of HPLMN or IMSI is not valid. If the IMSI is not
provided, the 3GPP AAA shall reject the request.
#### 6.19.2.2 Call flow for an emergency session over TWAN in SCM in case of
an un-authenticated UE
The behaviours that are specific to the solution are underlined and correspond
to differences with Annex A.2-1 of TS 29.273.
NOTE: Whether the full authentication procedure or a reduced procedure (e.g.
re-authentication, immediate indication of EAP-Success) shall be performed is
left to SA WG3.
The procedure covers both scenarios of case 3 and case 4 for SIMless UE and UE
with USIM that can\'t be authenticated described in clause 6.19.2.1.
Figure 6.19.2.2: TWAN Access for SCM -Unauthenticated emergency session
1\. A connection is established between the UE and the TWAN, using a specific
procedure based on IEEE 802.11.
2\. The TWAN sends an EAP Request/Identity to the UE.
3\. The UE sends an EAP Response/Identity message to the TWAN. The identity
being provided:
\- supports the NAI format: The identity shall take the form of a NAI, and
shall have the form username\@realm as specified in clause 2.1 of IETF RFC
4282
\- If the UE has a USIM, the NAI contains the IMSI (case 3), while if the UE
has no USIM (i.e. SIMless UE) the NAI (case 4)
\- contains a specific domain for unauthenticated emergency access in the
realm part of the NAI. This domain indicates the support of unauthenticated
emergency services for 3GPP terminals. This domain/realm is to be defined by
3GPP (e.g. in TS 23.003 [11]).
4\. When local policies (related with local regulations) allow unauthenticated
emergency sessions, the TWAN forwards the EAP payload received from the UE to
the 3GPP AAA Server serving the specific domain for unauthenticated emergency
access and also indicates the supported TWAN connection modes in the DER
message.
In case 4 for SIMless UE and in case 3 for UE with USIM, this dedicated 3GPP
AAA server shall be located in the same country than the TWAN. No AAA entity
in the \"HPLMN\" can be contacted since the realm of the NAI does not include
information on HPLMN and thus the local network cannot determine a HPLMN for
the UE.
When local policies (related with local regulations) do not allow
unauthenticated emergency sessions, no AAA server can be contacted for the
domain for unauthenticated emergency access and the Authentication request
shall be rejected.
If the 3GPP AAA server is configured for IMSI required and authentication
optional and IMSI is not provided the AAA rejects authentication.
5\. Void (no retrieval of authentication information from the HSS).
6\. The 3GPP AAA Server sends an EAP Request/AKA\'-Challenge in which it
indicates to the UE the TWAN connection modes supported by the network (e.g.
TSCM, SCM and MCM) and that this is an access for limited service with no
authentication. The Result-Code AVP in the DEA message is set to
DIAMETER_MULTI_ROUND_AUTH. The TWAN-S2a-Connectivity Indicator is not set in
the DEA-Flags AVP.
In case 3 (IMSI available but not possible to authenticate it), the 3GPP AAA
Server shall request the IMEI from the UE (via EAP) and pass it in a further
STa message to the TWAN. The 3GPP AAA server detects that case 3 applies when
the NAI identifying the UE contains the IMSI the user part and the specific
domain for unauthenticated emergency access in the realm part of the NAI.
7\. The TWAN forwards the EAP payload to the UE. The UE shall not try to
authenticate the network.
8\. The UE sends the EAP Response/AKA\'-Challenge in which it indicates the
requested connection mode. If the UE requests SCM, the UE also indicates the
requested parameters for the session: indicator of an emergency service, the
PDN Type (no APN is provided in the case of an access for emergency services),
the PDN type (IPv4 or IPv6), Initial Attach/Handover indication and/or PCO.
If requested by 3GPP AAA the UE provides the IMEI.
9\. The TWAN forwards the EAP payload to 3GPP AAA Server.
10\. The 3GPP AAA server bypasses usual authorization checks (e.g. against
subscribed APNs, against locations where the UE may request a non 3GPP access
to EPC, against whether the user has a non-3GPP access subscription, etc.).
For an Emergency Attach, the IMEI check to the EIR may be performed. If the
IMEI is blocked, operator policies determine whether the Emergency Attach
procedure continues or is stopped.
11\. In the case of this figure the 3GPP AAA Server authorizes the SCM for EPC
access for the UE. The 3GPP AAA Server includes the UE requested parameters
for the session (PDN type, Initial Attach/Handover indication and/or PCO)
together with an indicator of emergency service (already mentioned in
solutions for TWAN access in case of authenticated UE), in the DEA message
with the Result-Code AVP set to DIAMETER_MULTI_ROUND_AUTH. The 3GPP AAA Server
also sets the TWAN-S2a-Connectivity Indicator in the DEA-Flags AVP to request
the TWAN to proceed with the establishment of the S2a connectivity. The TWAN
does not take into account any APN received from the UE but uses its Emergency
Configuration data to determine the PDN GW to contact to set up the PDN
connection.
12\. The TWAN sends a Create Session Request/PBU message to the PDN GW to
initiate the S2a tunnel establishment. As the TWAN has received from the AAA
server an indicator of emergency service, the TWAG shall establish a PDN
connection for emergency services. The TWAG provides the IMEI as UE identity.
It also indicates that the identity has not been authenticated.
13\. The PDN GW informs (S6b Authorization Request) the 3GPP AAA Server of its
PDN GW identity and the APN corresponding to the UE\'s PDN Connection and of
the Permanent User Identity (NAI with the specific domain for unauthenticated
emergency). The AAA Server authorizes the request for an emergency PDN
connection without any further check.
Editor\'s note: Whether the S6b procedure applies in case of an
Unauthenticated Emergency session is FFS (related with the choice on solution
17).
14\. The PDN GW returns a Create Session Response/PBA message to the TWAN,
including the IP address(es) allocated for the UE.
15\. The TWAN includes the provided Connectivity Parameters received from the
PDN GW and sets the TWAN-S2a-Connectivity Indicator in the DER-Flags AVP in
the DER message to the 3GPP AAA Server. The 3GPP AAA Server ignores the EAP
payload included in the DER message.
16\. The 3GPP AAA Server includes the PDN connectivity parameters in the
AKA\'-Notification and sends the DEA message to the TWAN. The Result-Code AVP
in the DEA message is set to DIAMETER_MULTI_ROUND_AUTH. The
TWAN-S2a-Connectivity Indicator is not set in the DEA-Flags AVP.
17\. The TWAN forwards the EAP payload to the UE.
18-19. The UE responds with an EAP-RSP/AKA\'-Notification message that the
TWAN forwards to the 3GPP AAA Server.
20-21. The 3GPP AAA Server sends an EAP Success message that the TWAN forwards
to the UE. The Result-Code AVP in the DEA message is set to DIAMETER_SUCESS.
#### 6.19.2.3 Call flow for an emergency session over TWAN in MCM in case of
an UE without USIM
The behaviours that are specific to the solution are underlined and correspond
to differences with Annex A.3-1 of TS 29.273.
The procedure covers both scenarios of case 3 and case 4 for SIMless UE and UE
with USIM that can\'t be authenticated described in clause 6.19.2.1.
Figure 6.19.2.2: TWAN Access in MCM -Unauthenticated emergency session
1\. Steps 1. to 10. are as in Figure 6.19.2.2.
11\. In the case of this figure the 3GPP AAA Server authorizes the MCM for EPC
access for the UE. The 3GPP AAA Server includes the information required for
the MCM in the AKA\'-Notification as specified in 3GPP TS 24.302 (NSWO
authorization set to \"UE is not authorized to use NSWO\", TWAG control plane
address). The AAA servers sends a DEA message to the TWAN that contains this
AKA\'-Notification together with an indicator of an emergency service, The
Result-Code AVP in the DEA message is set to DIAMETER_MULTI_ROUND_AUTH. The
TWAN-S2a-Connectivity Indicator is not set in the DEA-Flags AVP.
Editor\'s note: Whether the S6b procedure applies in case of an
Unauthenticated Emergency session is FFS (related with the choice on solution
17).
12\. The TWAN forwards the EAP payload to the UE.
13-14. The UE responds with an EAP-RSP/AKA\'-Notification message that the
TWAN forwards to the 3GPP AAA Server.
15-16. The 3GPP AAA Server sends an EAP Success message that the TWAN forwards
to the UE. The Result-Code AVP in the DEA message is set to DIAMETER_SUCCESS.
The DEA message also indicates to the TWAN the selected connected mode (MCM),
no user\'s subscription information, that the user is authorized for EPC but
not for non-seamless WLAN offload, and the WLCP key for WLCP signalling
protection.
Based on the fact that the session is for emergency services, the TWAG
allocates an IPv4 address or an IPv6 prefix to the UE (allowing the UE to
exchange WLCP signalling with the TWAG) but as non-seamless WLAN offload is
not allowed, the TWAG sets policies to only allow traffic related with WLCP
signalling.
The UE subsequently initiates using WLCP the establishment of a PDN connection
to access emergency services as defined in TS 23.402 [7] clause 16.8.1 with
the following modifications:
\- As the TWAN has received from the AAA server an indicator of emergency
service (in step10), the TWAG shall only accept WLCP requests from the UE for
a PDN connection for emergency services. The TWAG uses its locally configured
Emergency Configuration Data (instead of using the connectivity parameters
provided by the UE) to determine the parameters of the PDN connection to
establish.
\- In Create Session request for emergency attached UEs IMSI is included if
available and if the IMSI cannot be authenticated then the IMSI shall be
marked as unauthenticated.
#### 6.19.2.4 Determination of the MSK in case of an un-authenticated UE
The determination of MSK and the procedure for passing the MSK from 3GPP AAA
to TWAN shall allow to usage of the usage of an un-modified WLAN AN.
The determination of the MSK is left to SA WG3.
This may be e.g. because the regular 3GPP AAA servers are out of service,
congested or out of reach.
The local policies depend on whether the local regulations accept un-
authenticated emergency sessions
In that case the same procedure applies than described clause 6.19.2.2 and
clause 6.19.2.3: the UE is not actually authenticated and the MSK is
determined based on a pseudo-random function that takes into account a fixed
sequence of characters and the user Identity (IMSI) but NOT the ciphering keys
CK/IK output of the AKA based authentication process ; furthermore, the UE
shall not try to authenticate the network in that case.
As the UE cannot know in advance that no authentication will take place for
its EPC access for emergency services, the network indicates that this is an
access for limited service with no authentication in EAP-AKA\' signalling sent
to the UE and in AAA signalling sent to the authenticator.
### 6.19.3 Detailed solution for Untrusted WLAN access
#### 6.19.3.1 Overview
This solution addresses the Key Issue 9.1: Support of \"unauthenticated\"
emergency session over ePDG. It is meant for SEW2.
Refer to clause 6.19.1.
For normative work for untrusted WLAN the solutions described in clauses
6.19.3.2 and 6.19.3.3 will be considered, instead of the solution in clause
6.20.
#### 6.19.3.2 UE without IMSI and UE with IMSI that cannot be authenticated
This clause describes the unauthenticated Emergency Attach procedure on S2b.
This is used by UE that:
\- do not have an USIM (i.e. UICCless UEs) ( case 3) .
\- have an IMSI which however cannot be used for EAP-based authentication
causing failure of authentication tentative because no available WLAN supports
interworking with HPLMN, or with an equivalent home service provider, or with
a preferred roaming partner of HPLMN in case 4)
Unauthenticated Emergency Attach procedure is similar to initial attach for
emergency services over GTP based S2b procedure in TS 23.402 [7] clause 7.2.5,
with the following differences:
Figure 6.19.3: Unauthenticated Emergency attachment in WLAN on GTP S2b
\- Step 1: as in step1 of TS 23.402 [7] clause 7.2.5.
\- Step 2: as in step 2 of TS 23.402 [7] clause 7.2.5 with following
modifications:
\- The selection of the ePDG is described in another solution
\- During the IKE tunnel establishment procedure, the identity provided by the
UE in IKE_AUTH message to the ePDG is determined according to the text
describing step 3 of Figure 6.19.2.1 of 23.771 (this TR) using the same domain
as described in 6.19.2.1 of 23.771. When local policies (related with local
regulations) allow unauthenticated emergency sessions, the ePDG forwards the
EAP payload received from the UE to the 3GPP AAA Server serving the specific
domain for unauthenticated emergency access. The 3GPP AAA server is in VPLMN
in that case.
\- In case 3 of \"IMSI required, authentication optional\" (the UE shall have
an IMSI but may not get authenticated) the network has to identify the UE via
its IMEI, if the UE as provided the IMSI and not IMEI, the ePDG shall get the
IMEI of the UE in order to store the association between the IMSI and the IMEI
and to then identify the UE by its IMEI within the network. The IMEI is
provided by the ePDG to the 3GPP AAA server. The ePDG detects that case 3
applies when the NAI identifying the UE contains an IMSIin the user part and
the specific domain for unauthenticated emergency access in the realm part of
the NAI.
\- For an Emergency Attach, the IMEI check to the EIR may be performed. If the
IMEI is blocked, operator policies determine whether the Emergency Attach
procedure continues or is stopped
\- The SWm signalling may carry the enhancements for IMEI check described as
part of another Solution
\- When the 3GPP AAA indicates to the ePDG that the UE\'s Emergency Attach
request is accepted, it does not send any subscription data for the UE. It
provides a MSK determined as defined in clause 6.19.2.3 of this TR.
When local policies (related with local regulations) do not allow
unauthenticated emergency sessions or If the ePDG is not configured to support
Unauthenticated Emergency Attach the ePDG shall reject the Emergency Attach
request.
\- Step 3: as in step 3 of TS 23.402 [7] clause 7.2.5 with following
modifications:
\- The IMEI is used as the identifier of the UE.
\- For emergency attached UEs IMSI is included if available and if the IMSI
cannot be authenticated then the IMSI shall be marked as unauthenticated.
\- Step 4: as in step 4 of TS 23.402 [7] clause 7.2.5 , but the IMEI is used
as the identifier of the UE.
\- Step 5: as in step 4 of TS 23.402 [7] clause 7.2.5 , but the IMEI is used
as the identifier of the UE.
Editor\'s note: It is FFS whether this step is performed. It depends on the
solutions of key issue #12 and 13 (Handover Active Emergency call).
\- Step 6-8. As in same steps in clause 7.2.5 of TS 23.402 [7].
#### 6.19.3.3 Authenticated UE with no roaming rights (case 2)
Figure 7.2.5-1: Initial attachment for emergency services over GTP based S2b
(not modified, provided just for information)
Step2 of the procedure for attachment for emergency services over GTP based
S2b is modified as follows (text in _italics_):
\- The UE provides an indication that the EPC access is for emergency
services. The indication is used by the 3GPP AAA server to give precedence to
this session in case of signalling congestion (over SWx) _and to not carry out
roaming and location checks for this UE_. The indication is used by the ePDG
to apply specific policies related with emergency PDN connection (e.g. stored
in Emergency Configuration Data).
## 6.20 Solution 20: Support of emergency services for un-authenticated UE on
S2b
This solution addresses the Key Issue 9.1: Support of \"unauthenticated\"
emergency session over ePDG.
UEs that need to be perform emergency services over Untrusted WLAN but failed
to authenticate with the network initiate Emergency Attach procedure on S2b.
Also UEs do not have valid subscription (i.e. UICCless UEs) initiate Emergency
Attach procedure on S2b. Emergency Attach procedure is similar to initial
attach procedure in TS 23.402 [7] clause 7.2, with the following differences:
Figure 6.20.1: Emergency attachment in WLAN on GTP S2b
\- Step 1. The UE includes Emergency Attach indication in IKE signalling if
the access authentication procedure between UE and the 3GPP EPC is performed.
\- Step 2. During the IKE tunnel establishment procedure, the UE includes
Emergency Attach and Emergency Service indication in IKE signalling. If
Emergency Attach indication is included, the ePDG sends the signalling to the
3GPP AAA in the PLMN where the ePDG is located. If the 3GPP AAA decides to
accept the request, the AAA continues attach procedure even though the
authentication fails. The 3GPP AAA indicates to the ePDG that the UE\'s
Emergency Attach request is accepted. Then the ePDG shall use null encryption
algorithm when establishing IPsec. The UE and ePDG shall not check security
parameters and continue attach procedure.
If the ePDG is not configured to support Emergency Attach the ePDG shall
reject any Emergency Attach request.
\- Step 3. The ePDG applies the parameters from Emergency Configuration Data
configured in the ePDG for the emergency bearer establishment.
\- Step 4. As in step 4 of procedure in clause 7.2.1 of TS 23.402 [7].
\- Step 5. The ePDG informs the 3GPP AAA/HSS about the location of the UE.
Editor\'s note: It is FFS whether this step is performed. It depends on the
solutions of key issue #12 and 13(Handover Active Emergency call).
\- Step 6-9. As in step 6-9 of procedure in clause 7.2.1 of TS 23.402 [7].
Table 6.20-1: Emergency Configuration Data
* * *
Field Description Emergency Access Point Name (em APN) A label according to
DNS naming conventions describing the access point used for Emergency PDN
connection (wild card not allowed). Emergency QoS profile The bearer level QoS
parameter values for Emergency APN\'s default bearer (QCI and ARP). The ARP is
an ARP value reserved for emergency bearers. Emergency APN-AMBR The Maximum
Aggregated uplink and downlink MBR values to be shared across all Non-GBR
bearers, which are established for the Emergency APN, as decided by the PDN
GW. Emergency PDN GW identity The statically configured identity of the PDN GW
used for emergency APN. The PDN GW identity may be either an FQDN or an IP
address. 3GPP HO Emergency PDN GW identity The statically configured identity
of the PDN GW used for emergency APN when a PLMN supports handover to 3GPP
access. The PDN GW identity may be either an FQDN or an IP address.
* * *
Editor\'s note: It is FFS whether FQDN of 3GPP HO Emergency PDN GW identity
always resolves to one PDN GW. It depends on the solutions of key issue #12
and 13(Handover Active Emergency call).
## 6.21 Solution 21: Access Selection for Emergency Sessions
In order to fulfil the requirements of key issue 11 (\"Means by which the
order in which an emergency session is attempted over the available
networks\"):
1\. The UE shall be able to determine the regulatory domain (i.e. country) in
which the UE is located. This can be accomplished with the solution specified
in sub-clause 6.13 (\"Solution 13: Determine Location & Country Info\").
2\. It shall be possible to configure the UE with \"access selection for
emergency session\" information, that indicates which accesses, and in which
order, should be used for initiating emergency sessions in certain regulatory
domains. This information could be statically configured (by unspecified
means) in the UE or could be provided and updated over-the-air (e.g. with OMA-
DM).
3\. The UE shall select an access network (3GPP or WLAN) for initiating
emergency sessions by using the \"access selection for emergency sessions\"
information and by considering other applicable conditions such as the signal
strength of WLAN and 3GPP accesses. The \"access selection for emergency
sessions\" information in the UE shall override other traffic steering
information (e.g. ISRP rules or RAN rules) when the UE selects an access
emergency sessions.
The \"access selection for emergency sessions\" information includes a list of
records and each record contains a list of countries and the preferred
access(es) for emergency sessions in these countries. As an example, the
\"access selection for emergency sessions\" information could contain the
following records:
\- List-1 of country codes (e.g. FR, GR, ES, CA) **\-- >** WLAN access
(priority 1), 3GPP access (priority 2).
\- List-2 of country codes **\-- >** 3GPP access only.
\- All other countries **\-- >** 3GPP access (priority 1), WLAN access
(priority 2).
According to the first record, if the UE determines to be located in one of
the countries in List-1, then the UE should attempt emergency sessions first
over WLAN access and then (e.g. when WLAN is not available or when the WLAN
signal strength is too small) over 3GPP access. The second record indicates
that when the UE determines to be located in one of the countries in List-2,
then the UE should attempt emergency sessions over 3GPP access only.
NOTE 1: The UE uses the \"access selection for emergency sessions\"
information to select WLAN access or 3GPP access for initiating an emergency
session. If the UE selects the 3GPP access, then it can use the selection
rules specified in TS 23.167 [4] (see Table H.1) to select the CS domain or
the PS domain for initiating the emergency session. So, the \"access selection
for emergency sessions\" information and the selection rules specified in TS
23.167 [4] are not related and cannot provide conflicting information.
NOTE 2: It is FFS if the \"access selection for emergency sessions\"
information can be configured in USIM. This aspect will be solved during the
normative phase.
## 6.22 Solution 22: Local Emergency Numbers List over WLAN access
The ePDG/TWAG may send Local Emergency Numbers List which is configured in the
ePDG/TWAN at initial attach procedure based on operator configuration. This
mechanism makes sure that the UE has the Emergency Numbers List even if the UE
cannot receive emergency numbers over 3GPP access (e.g. no roaming agreement
to access EPC over 3GPP access). In Trusted WLAN access, the TWAG may send
Local Emergency Numbers List to the AAA via diameter protocol. The AAA server
relays the information in EAP signalling sent to the UE. In Untrusted WLAN
access, ePDG may send Local Emergency Numbers List to the UE using IKE
signalling. The UE shall store the Local Emergency Numbers List, as provided
by the network and use the information to detect emergency service.
## 6.23 Solution 23 for Key issue 3: Using the emergency signalling channel
for on-demand UE Location update mid-session.
The PSAP could request a UE updated location mid-emergency session, To that
effect; the PSAP initiates such a request to the LRF.The LRF sends a request
to that effect to the E-CSCF associated with the UE. The LRF establishes the
association during the emergency session establishment procedure. The E-CSCF
in turn, uses the established emergency signalling channel with the UE to send
a request to the UE to update its location. The UE provides its updated
location in the response to the LRF. The UE updated location can be a one or
more of geodetic location, Civic location, BSSID, IP address or similar. The
LRF proxies the received response to the PSAP.
The call flow in Figure 6.23-1 below depicts the above.
Figure 6.23-1: UE Updated location mid-emergency Session
1) In step 1a, the UE establishes an emergency session with the PSAP via the
E-CSCF.
2) In step 1b, the LRF stores the E-CSCF address information associated with
the UE during the emergency session establishment process.
3) In step 2a, the PSAP initiates a request to the LRF to provide a UE updated
location.
4) In step 2b, the LRF locates the address of the E-CSCF associated with the
UE.
5) In step 2c, the LRF initiates a request to the E-CSCF to fetch a UE updated
location.
6) In step 2d, the E-CSCF initiates a request to the UE to update its location
using the already existing emergency signalling channel established with the
UE.
7) In step 3a, the UE provides its updated location to the E-CSCF.
8) In step 3b, the E-CSCF proxies the response to the LRF.
9) In step 3c, the LRF proxies the response to the PSAP.
## 6.24 Solution 24: ePDG selection for emergency bearer services
NOTE: The text of this solution is described as a pseudo CR to TS 23.402 [7]
(even though it will not be possible to use directly this text in an actual
CR).
Editor\'s note: The Release-13 non-emergency ePDG selection procedure referred
in this solution is not finalized yet and is undergoing modifications to
support LI. This solution shall be revisited and aligned with the latest
status of the Release-13 non-emergency ePDG selection procedure.
##### [TS 23.402 [7] clause 4.5.4a.1 General]{.underline}
{#ts-23.402-7-clause-4.5.4a.1-general .H6}
The UE may select an ePDG for emergency bearer services either using
configured information as specified in clause 4.5.4a.2 or using dynamically
created FQDN generated by the UE as specified in clause 4.5.4a.3.
When the UE is located in the country of its HPLMN, the UE shall first attempt
ePDG selection based on configured information as described in clause
4.5.4a.2. If configured information as described in clause 4.5.4a.2 is not
available in the UE, the UE shall try to select ePDG as described in clause
4.5.4a.3.
When the UE is located in another country than the country of its HPLMN, the
UE shall try to select ePDG as described in clause 4.5.4a.3.
NOTE: The UE stops the establishment of emergency sessions via WLAN if it is
unable to select an ePDG for emergency bearer services.
##### [TS 23.402 [7] clause 4.5.4a.2 Static selection]{.underline}
{#ts-23.402-7-clause-4.5.4a.2-static-selection .H6}
It shall be possible to configure the UE (e.g. H-ANDSF, USIM, etc) with an
ePDG address that supports emergency bearer services in its HPLMN. The ePDG
address can take the format of:
1) An FQDN; or
2) An IP address.
The ePDG configuration information for emergency services shall be separate
from the configuration for regular services and exclusively used for the ePDG
selection of emergency services.
When the UE is statically configured with the IP address of an ePDG that
supports emergency bearer services, the UE initiates the IPsec tunnel
establishment towards this IP address.
If an FQDN is configured the UE employs the DNS server function to obtain the
IP address(es) of the ePDG(s). If the DNS server responds with:
a) At least one IP address: the UE selects an IP address from the list
returned in the DNS response, and the UE initiates the IPsec tunnel
establishment towards this IP address, If it fails it repeats the attempts to
set-up a SWu tunnel with the other IP addresses received from the DNS until it
either succeeds or there is no more available IP address; or
b) No IP address is returned then the UE shall stop the selection of an ePDG
for emergency services.
If the UE is not configured with an ePDG address for emergency services then
the UE shall use dynamic ePDG selection as described in clause 4.5.4a.3.
##### [TS 23.402 [7] clause 4.5.4a.3 Dynamic selection of an ePDG for
emergency services.]{.underline} {#ts-23.402-7-clause-4.5.4a.3-dynamic-
selection-of-an-epdg-for-emergency-services. .H6}
##### [TS 23.402 [7] clause 4.5.4a.3.1 Data configuration used by the
UE.]{.underline} {#ts-23.402-7-clause-4.5.4a.3.1-data-configuration-used-by-
the-ue. .H6}
Following points apply in case of the selection of an ePDG for authenticated
emergency services:
\- For the creation of an ePDG Operator Identifier FQDN for emergency
services: The ePDG FQDNs defined in TS 23.402 [7] clause 4.5.4.2 \"ePDG FQDNs
Construction\" are modified by the addition that the FQDN constructed shall
also contain an indication that the UE requires an ePDG that supports
emergency bearer services. The corresponding FQDN is defined in TS 23.003
[11].
\- Regardless of the indication (e.g. \"preferred\" / \"mandatory\") in a PLMN
entry of the ePDG selection information (defined in TS 23.402 [7] clause
4.5.4.3), during the selection of an ePDG for emergency services the UE
considers that the indication is set to \"mandatory\".
\- The ePDG identifier defined in point 1) of TS 23.402 [7] clause 4.5.4.3 is
not used.
##### [TS 23.402 [7] clause 4.5.4a.3.2 Dynamic selection of an ePDG for un-
authenticated emergency services.]{.underline}
{#ts-23.402-7-clause-4.5.4a.3.2-dynamic-selection-of-an-epdg-for-un-
authenticated-emergency-services. .H6}
NOTE 1: This clause assumes an UE without USIM and without any UE
Configuration By HPLMN such as defined in TS 23.402 [7] clause 4.5.4.3.
Editor\'s note: The case of a Dynamic selection of an ePDG for un-
authenticated emergency services for an UE that has an USIM is FFS.
1) If the UE can determine the country it is located in (and derive a
corresponding MCC), unless it has determined a list of local PLMN as part of
the process described in clause 4.5.4a.3, the UE needs to get a list of to
local PLMN(s) including those that have a different MCC than the one derived
based on UE determination of the country it is located in. The information is
retrieved by the UE from a public DNS.
NOTE 2: The way to achieve this is to be defined in stage 3. For example, the
UE could perform a DNS query on \"mcc\.local-plmn.pub.3gppnetwork.org\",
and retrieve a list of FQDN containing MCC and MNC of local PLMN in the
country identified by \.
2) For any PLMN determined as part of step 1) the UE should try to select an
ePDG for emergency services in that PLMN by constructing a corresponding
Operator Identifier FQDN for emergency services and using the DNS server
function to obtain the IP address(es) of the ePDG(s) in that PLMN. The UE
stops the process when it has successfully registered on an ePDG or has
exhausted the list of local PLMN(s).
##### [TS 23.402 [7] clause 4.5.4a.3.3 Dynamic selection of an ePDG for
authenticated emergency services.]{.underline}
{#ts-23.402-7-clause-4.5.4a.3.3-dynamic-selection-of-an-epdg-for-
authenticated-emergency-services. .H6}
The UE shall perform the selection of an ePDG for authenticated emergency
services by executing the steps below:
1) If the UE is attached via 3GPP access to a PLMN-x, then:
a) If the UE is configured with the ePDG selection information defined in
point 2) in TS 23.402 [7] clause 4.5.4.3 and there is an entry matching the
PLMN-x in the ePDG selection information, then the UE shall attempt to select
an ePDG in this PLMN-x. The UE shall construct an ePDG Operator Identifier
FQDN for emergency services in this PLMN-x as defined in TS 23.402 [7] clause
4.5.4.2, and shall use the DNS server function to obtain the IP address(es) of
the ePDG(s). In this case (emergency services) the UE ignores any indicator
associated with PLMN-x in the ePDG selection information and assumes the
indicator has the value \"Mandatory\".
2) If the UE is not attached via 3GPP access to any PLMN and the UE can
determine that the country it is located in the country of its HPLMN:
a) the UE shall attempt to select an ePDG in its HPLMN. The UE shall construct
an ePDG Operator Identifier FQDN for emergency services in its HPLMN as
defined in TS 23.402 [7] clause 4.5.4.2, and shall use the DNS server function
to obtain the IP address(es) of the ePDG(s).
b) Otherwise the UE needs to determine other local PLMN(s) that have deployed
ePDG via which the UE can get authenticated onto the HPLMN.
Editor\'s note: When previous steps have failed how to determine suitable
ePDG(s) in the local country is an issue common with the ePDG selection when
local LI requirement force the usage of a local ePDG. Both cases of local LI
requirements and emergency sessions should be addressed by similar solutions.
2 solutions may be considered:
\- ALTERNATIVE 1: the definition of ePDG selection information (TS 23.402 [7]
clause 4.5.4.3) is upgraded with the definition of a \"Not preferred\"
indicator supporting the case where the HPLMN accepts the usage of an ePDG in
a VPLMN but prefers to limit that to exceptional cases such as emergency
sessions or LI requirements.
\- ALTERNATIVE 2: the definition of ePDG selection information is not modified
and another means is needed for the UE to determine local PLMN(s) that have
deployed ePDG via which the UE can get authenticated onto the HPLMN.
/Start of ALTERNATIVE 1/
3) If previous steps failed and the UE can determine the country it is located
in (and derive a corresponding MCC), then:
a) The UE needs to get a list of to local PLMN(s) including those that have a
different MCC than the one derived based on UE determination of the country it
is located in. The information is retrieved by the UE from a public DNS.
NOTE 1: The way to achieve this is to be defined in stage 3. For example, the
UE could perform a DNS query on \"mcc\.local-plmn.pub.3gppnetwork.org\",
and retrieve a list of MCC and MNC of local PLMN in the country identified by
\.
b) If the UE is configured with ePDG selection information that includes one
or more PLMNs with the MCC corresponding to the country, then the UE should
select an ePDG in a PLMN in this country by constructing a corresponding
Operator Identifier FQDN for emergency services and using the DNS server
function to obtain the IP address(es) of the ePDG(s) in the PLMN. In this case
(emergency services) the UE ignores any indicator associated with a local PLMN
listed in the ePDG selection information and assumes the indicator has the
value \"Mandatory\".
/End of ALTERNATIVE 1/
/Start of ALTERNATIVE 2/
3) If previous steps failed and the UE can determine the country it is located
in (and derive a corresponding MCC), then:
a) If the UE is configured with ePDG selection information that includes one
or more PLMNs with the MCC corresponding to the country, then the UE should
select an ePDG in a PLMN in this country by constructing a corresponding
Operator Identifier FQDN for emergency services and using the DNS server
function to obtain the IP address(es) of the ePDG(s) in the PLMN. In this case
(emergency services) the UE ignores any indicator associated with a local PLMN
listed in the ePDG selection information and assumes the indicator has the
value \"Mandatory\".
b) The UE needs to get a list of to local PLMN(s) including those that have a
different MCC than the one derived based on UE determination of the country it
is located in. The information is retrieved by the UE from a public DNS.
NOTE 1: The way to achieve this is to be defined in stage 3. For example, the
UE could perform a DNS query on \"mcc\.local-plmn.pub.3gppnetwork.org\",
and retrieve a list of MCC and MNC of local PLMN in the country identified by
\.
c) The UE determines which of the local PLMN(s) determined as part of step b)
(and not used as part of step a) has ePDG that can authenticate users with its
HPLMN. The information is retrieved by the UE from a public DNS of each local
PLMN local PLMN(s) determined as part of step b) (and not used as part of step
a).
NOTE 2: The way to achieve this is to be defined in stage 3. For example, for
each local PLMN the UE performs a DNS query to the local PLMN\'s DNS with an
FQDN including the UE\'s HPLMN (hmnc\.hmcc\) and the VPLMN ID
(mnc\.mcc\.)
If it gets a positive answer from the DNS of a local PLMN, the UE knows this
local PLMN supports ePDG interworking with its HPLMN and gets a FQDN to use to
select an ePDG of that PLMN. Otherwise it knows it can skip this local PLMN.
NOTE 3: The procedure allows the local PLMN to direct the UE to different ePDG
based on their HPLMN. For example an American operator could use different
ePDG depending from whether the HPLMN corresponds to an Asian or to an
European country.
/End of ALTERNATIVE 2/
4) If previous steps failed, and the UE knows the country it is located in,
the UE should then try to issue an un-authenticated access to emergency
services over an ePDG of the local PLMN. The ePDG selection in that case is
defined in clause 4.5.4a.3.2.
5) If previous steps failed and the UE has an USIM and there is no other
possibility to issue an emergency session, the UE selects an ePDG for
emergency services in its HPLMN.
## 6.25 Solution 25 for Key issue 3: Network Initiated IKE-based WiFi Query
for on-demand UE Location mid-emergency session.
The PSAP could mid-emergency session request a UE updated location, To that
effect; the PSAP initiates such a request to the LRF. This LRF locates the
ePDG associated with the UE.
NOTE 1: This solution assumes the UE is still camped on WiFi.
The LRF proxies the UE location update request to the located ePDG. The ePDG,
in turn, queries the UE using IKE, to request an updated location. The UE
provides its updated location in the response to the ePDG. The UE updated
location can be a one or more of geodetic location, Civic location, BSSID, IP
address or similar. The ePDG returns the UE updated location to LRF, which in
turn returns it to the PSAP.
The call flows in Figure 6.25-1 below depicts the above.
Figure 6.25-1: UE Updated location mid-emergency Session
1) In step 2a, the PSAP initiates a request to the LRF to provide a UE updated
location; the request includes the UE IMEI/MSISDN.
2) In step 2b, the LRF locates the ePDG associated with the UE (see Solution
18).
3) In step 2c, the LRF proxies the request to the ePDG located in the previous
step.
4) In step 2d, the ePDG initiates a request to the UE to provide an updated
location. IKE INFORMATIONAL exchange can be used for that purpose.
NOTE 2: This requires extension to IKE INFORMATIONAL exchange.
5) In step 3a, the UE provides its updated location to the ePDG in the
response.
6) In step 3b, the ePDG proxies the received location to the LRF.
7) In step 3c, the LRF proxies the received location to the PSAP.
## 6.26 Solution 26 for Key Issue 1: ePDG Selection for emergency services
The ePDG selection for emergency services is based on the mechanism defined in
the TS 23.402 [7] clause 4.5.4, for non-emergency ePDG selection, with the
following extension:
Along with the Operator Identifier and Tracking/Location Area Identity ePDG
FQDNs, an additional Country Code ePDG FQDN format is supported. The Country
Code ePDG FQDN format will be defined based on either the MCC or the ISO
Country Code.
Editor\'s note: The choice between the MCC and ISO CC will be finalized with
consideration of the outcome of the Release-13 non-emergency ePDG selection
modifications - see the Editor\'s note 2.
The Country Code emergency ePDG FQDN is used by a UE establishing an emergency
connection when the UE knows the country it is located in and the UE\'s
emergency ePDG Selection Information list doesn\'t include a PLMN in that
country.
The use of Country Code ePDG FQDN allows establishing the emergency service
connection in the visited country independent of the emergency ePDG selection
configuration provided by the UE\'s home network operator. Country Code ePDG
FQDN resolves into the address(es) of ePDG(s) of the service provider
designated by country\'s regulator to provide emergency VoWiFi connections for
visiting UE from operators who e.g. don\'t have VoWiFi roaming agreements in
the visited country.
The Country Code FQDN may also be used as a fall-back in case of failure to
select emergency ePDG by using the Operator Identifier FQDN or
Tracking/Location Area Identity FQDN in a roaming partner\'s network.
Editor\'s note: The Release-13 non-emergency ePDG selection procedure referred
in this solution is not finalized yet and is undergoing modifications to
support LI. It may end up supporting the Country Code FQDN based ePDG
selection and become fully suitable for the emergency ePDG selection, as well.
In such case the solution presented here may just refer that procedure.
## 6.27 Solution 27 for Key issue 3: NPLI for Untrusted WiFi emergency
sessions
This procedure is applied to scenarios when a UE initiates an emergency
session via untrusted WiFi and when regulations require NPLI to be used to
locate a PSAP at emergency session initialization. It is equally applied mid-
session to provide a UE updated location when LRF is queried by PSAP for that
purpose. This procedure can be applied only when the UE is home and not
roaming.
In this procedure, the LRF relies on the cellular network to obtain a NPLI if
possible. To that effect, LRF initiates a query to HSS, using Sh for that
purpose, to identify the most recent or the current (configured through a
policy) cell-ID the UE was camped on. HSS in turn queries the appropriate
access to return requested information. The LRF can initiate multiple queries
to HSS for different accesses if configured through policies to do so.
It is also possible that HSS returns no information at all, in which case the
LRF may, if configured through policies, use UPLI as an alternative.
NOTE: There is no impact on the Sh reference pointThe call flows in Figure
6.27-1 depicts an example for the scenario when PSAP queries LRF mid-session
and policy configured in LRF points to the use of NPLI. The same logic applies
at session initialization as well.
Figure 6.27-1: NPLI UE Updated location mid-emergency Session
1) In step 1 the UE has successfully established an emergency session with a
PSAP.
2) In step 2, the PSAP initiates a request to the LRF to provide a UE updated
location; the request includes the UE MSISDN.
2) In step 3, the LRF identifies the UE and locates the UE associated record.
3) In step 4a, the LRF queries HSS based on configured policies to fetch an
NPLI for the UE. In this step, LRF queries HSS, which in turn queries the MSC
where the UE is registered if applicable.
NOTE 1: The order of querying accesses is configured in the LRF.
NOTE 2: Whether CS access is fetched before or after MME is configurable in
the LRF.
4) In step 4b, the MSC returns the response which is forwarded to LRF.
5) In step 5a, depending on the response received in step 4b, the LRF based on
configured policies optionally queries HSS for other 3GPP accesses. In this
example, HSS queries MME.
7) In step 5b, MME returns the response which is forwarded to LRF.
6) In step 6, depending on the received response the LRF may invoke other
procedures based on configured policies (e.g. fetch UPLI information).
7) In step 7, the LRF proxies the updated location to the PSAP.
## 6.28 Solution 28: ePDG Selection for emergency services in phase 2
Changes to the ePDG selection rules in TS 23.402 [7] that will support the
requirements for Key Issue #1 in subclause 5.1 are shown below. These are
based on enhancements to the current ePDG selection solution and to the ePDG
selection for emergency bearer services.
##### [TS 23.402 [7] clause 4.5.4 ePDG Selection]{.underline}
{#ts-23.402-7-clause-4.5.4-epdg-selection .H6}
##### [TS 23.402 [7] clause 4.5.4.1 General]{.underline}
{#ts-23.402-7-clause-4.5.4.1-general .H6}
The UE performs ePDG selection based on a set of information configured by the
HPLMN in the UE, and based on the UE\'s knowledge of the PLMN it is attached
to.
A UE connected to one or multiple PDN GWs uses a single ePDG.
##### [TS 23.402 [7] clause 4.5.4.2 ePDG FQDNs Construction]{.underline}
{#ts-23.402-7-clause-4.5.4.2-epdg-fqdns-construction .H6}
When the UE attempts to construct an FQDN for selecting an ePDG in a certain
PLMN-x (either a VPLMN or the HPLMN), then the UE shall construct one of the
following FQDN formats:
\- Operator Identifier FQDN: The UE constructs the FQDN by using the PLMN-x ID
as the Operator Identifier.
\- Tracking/Location Area Identity FQDN: The UE constructs the FQDN by using
the identity of the Tracking Area/Location Area it is located in (i.e. based
on PLMN-x ID and TAC/LAC). The Tracking/Location Area Identity FQDN is used to
support location-specific ePDG selection within a PLMN.
The ePDG FQDN formats are specified in TS 23.003 [11].
The UE selects one of the above FQDN formats as follows:
a) If the UE attempts to select an ePDG in the registered PLMN and the UE is
configured to use for this PLMN the Tracking/Location Area Identity FQDN as
defined in point 2) of clause 4.5.4.3; and
b) the UE knows the TAI/LAI of the area the UE it is located in (e.g. the
TAI/LAI from the most recent Attach or TAU/LAU),
then the UE constructs a Tracking/Location Area Identity FQDN. Otherwise the
UE constructs the Operator Identifier FQDN.
Also, the UE constructs the Operator Identifier FQDN as a fallback in the case
of failure of DNS resolution of a Tracking/Location Area Identity based FQDN.
##### [TS 23.402 [7] clause 4.5.4.3 UE Configuration By HPLMN]{.underline}
{#ts-23.402-7-clause-4.5.4.3-ue-configuration-by-hplmn .H6}
The UE may be configured (e.g. via H-ANDSF, USIM, etc.) by the HPLMN with the
following configuration, whose usage is defined in clause 4.5.4.4:
1) ePDG identifier configuration: It contains the FQDN or IP address of an
ePDG in the HPLMN.
NOTE: The FQDN in the ePDG identifier configuration may have a different
format than the one described in clause 4.5.4.2.
2) ePDG selection information: It contains a list of PLMNs which may include
the HPLMN and for each PLMN it indicates whether the selection of an ePDG in
this PLMN is preferred or mandatory. It also indicates if selection of an ePDG
in this PLMN should be based on Tracking/Location Area Identity FQDN or on
Operator Identifier FQDN, as specified in clause 4.5.4.4. It further indicates
whether the PLMN: does not support emergency bearer services over WLAN;
supports emergency bearer services over WLAN for the area within which the
PLMN supports 3GPP access; or supports emergency bearer services over WLAN for
the entire country in which the PLMN is located.
The ePDG selection information may include an \"any PLMN\" entry, which
matches any PLMN the UE is attached to except the HPLMN. The \"any PLMN\"
entry should indicate that emergency bearer services are not supported
according to point 2) to avoid selecting a PLMN for emergency bearer services
in a different country to the UE using the procedure in clause 4.5.4a.3. If
the ePDG selection information contains both the \"any PLMN\" and the PLMN the
UE is attached to, the UE shall give precedence to the latter.
##### [TS 23.402 [7] clause 4.5.4.4 UE ePDG Selection Procedure]{.underline}
{#ts-23.402-7-clause-4.5.4.4-ue-epdg-selection-procedure .H6}
When constructing an FQDN, the UE shall construct the FQDN as described in
clause 4.5.4.2.
The UE shall perform ePDG selection by executing the steps below:
1) If the UE is attached via 3GPP access to a PLMN-x, then:
a) If the UE is configured with the ePDG selection information defined in
point 2) in clause 4.5.4.3 and there is an entry matching the PLMN-x in the
ePDG selection information, then the UE shall attempt to select an ePDG in
this PLMN-x. The UE shall construct an ePDG FQDN for this PLMN-x as described
in clause 4.5.4.2, and shall use the DNS server function to obtain the IP
address(es) of the ePDG(s).
b) If the UE is configured with the ePDG selection information but there is no
entry matching PLMN-x in the ePDG selection information or if the UE is not
configured with the ePDG selection information thenand
i) If the UE is configured with the ePDG identifier defined in point 1) in
clause 4.5.4.3, the UE shall attempt to select in ePDG in the HPLMN. The UE
shall either use the configured FQDN and use the DNS server function to obtain
the IP address(es) of the ePDG(s) in the HPLMN, or the UE shall use the
configured IP address.
ii) If the UE is not configured with the ePDG identifier, the UE shall
construct an Operator Identifier FQDN for HPLMN and use the DNS server
function to obtain the IP address(es) of the ePDG(s) in the HPLMN.
2) If the UE is not attached via 3GPP access to any PLMN, then:
a) If the UE can determine the country it is located in and the UE is
configured with ePDG selection information that includes one or more PLMNs in
this country, then the UE should select an ePDG in a PLMN in this country by
constructing a corresponding Operator Identifier FQDN and using the DNS server
function to obtain the IP address(es) of the ePDG(s) in the PLMN.
NOTE 1: It is out of scope of the present specification to define how the UE
can identify the country it is located in when it\'s not attached to any PLMN.
NOTE 2: The detailed ePDG selection mechanism when the ePDG selection
information includes more than one PLMN in the country where the UE is located
is defined in stage 3 specifications.
3) In all other cases, the UE shall select the ePDG in the HPLMN as described
in points 1)b)i) and 1)b)ii) above.
NOTE 3: According to the steps above, the home operator can configure the UE
to always select an ePDG in the HPLMN, for example, by:
\- providing neither the ePDG identifier configuration nor the ePDG selection
information, in which case the UE always selects an ePDG in HPLMN by using the
Operator Identifier FQDN, according to step 1)b)ii) above; or
\- providing ePDG identifier configuration only, in which case the UE always
selects an ePDG in HPLMN based on the FQDN or IP address in the ePDG
identifier configuration, according to step 1)b)i) above.
NOTE 4: According to the steps above, the home operator can configure the UE
to attempt first to select an ePDG in the VPLMN, for example, by providing the
ePDG selection information containing the \"any PLMN\" entry and the
indication of \"preferred\".
If the UE fails to select an ePDG in a VPLMN, then:
\- If the ePDG selection information for this VPLMN contains the \"preferred\"
indication based on point 2) in clause 4.5.4.3, the UE shall select the ePDG
in the HPLMN as described in points 1bi) and 1bii) above.
\- If the PDG selection information for this VPLMN contains the \"mandatory\"
indication, the UE shall stop the ePDG selection.
When the UE fails to select an ePDG in the HPLMN, then:
\- The UE shall stop the ePDG selection.
NOTE 5: If the HPLMN entry in the ePDG selection information contains
\"preferred\" / \"mandatory\" indications, these indications are not used
during the selection of an ePDG in the HPLMN.
If a selected ePDG is not reachable from an untrusted non-3GPP access, the UE
shall attempt to reach the next discovered ePDG, if available.
##### [TS 23.402 [7] clause 4.5.4a ePDG selection for emergency bearer
services]{.underline} {#ts-23.402-7-clause-4.5.4a-epdg-selection-for-
emergency-bearer-services .H6}
##### [TS 23.402 [7] clause 4.5.4a.1 General]{.underline}
{#ts-23.402-7-clause-4.5.4a.1-general-1 .H6}
The UE may select an ePDG for emergency bearer services either using
configured information as specified in clause 4.5.4a.2 or using dynamically
created FQDN generated by the UE as specified in clause 4.5.4a.3. The UE shall
first attempt ePDG selection based on configured information as described in
clause 4.5.4a.2. If configured information is not available in the UE or does
not apply, the UE shall try to select ePDG as described in clause 4.5.4a.3.
NOTE: The UE stops the establishment of emergency calls if it is unable to
select an ePDG for emergency bearer services.
##### [TS 23.402 [7] clause 4.5.4a.2 Static selection]{.underline}
{#ts-23.402-7-clause-4.5.4a.2-static-selection-1 .H6}
It shall be possible to configure the UE (e.g. H-ANDSF, USIM, etc) with an
ePDG address that supports emergency bearer services in its HPLMN. The ePDG
address can take the format of:
1) An FQDN; or
2) An IP address.
The ePDG configuration information for emergency services shall be separate
from the configuration for regular services and exclusively used for the ePDG
selection of emergency services.
Static selection of an ePDG shall be used when and only when a UE is attached
via a 3GPP access to the HPLMN or can determine that it is in the same country
as the HPLMN or cannot determine the country it is in.
When the UE is statically configured with the IP address of an ePDG that
supports emergency bearer services, the UE initiates the IPsec tunnel
establishment towards this IP address.
If an FQDN is configured the UE employs the DNS server function to obtain the
IP address(es) of the ePDG(s). If the DNS server responds with:
a) At least one IP address: the UE selects an IP address from the list
returned in the DNS response, and the UE initiates the IPsec tunnel
establishment towards this IP address, If it fails it repeats the attempts to
set-up a SWu tunnel with the other IP addresses received from the DNS until it
either succeeds or there is no more available IP address; or
b) No IP address is returned then the UE shall stop the selection of an ePDG
for emergency services.
If the UE is not configured with an ePDG address for emergency services or if
static selection does not apply then the UE shall use dynamic ePDG selection
as described in clause 4.5.4a.3.
##### [TS 23.402 [7] clause 4.5.4a.3 Dynamic selection.]{.underline}
{#ts-23.402-7-clause-4.5.4a.3-dynamic-selection. .H6}
For the procedures described in this subclause, the UE dynamically constructs
an Operator Identifier FQDN as described in clause 4.5.4.2, with the addition
that the FQDN constructed shall also contain an indication that the UE
requires an ePDG that supports emergency bearer services. This FQDN is defined
in TS 23.003 [11].
For the FQDN format of ePDG address, the UE shall use the DNS server function
to obtain the IP address(es) of the ePDG(s). If the DNS query fails or does
not provide an IP address the UE shall stop the establishment of emergency
call.
The UE shall perform dynamic ePDG selection for emergency bearer services
using the steps below.
1) If the UE is attached via 3GPP access to a PLMN-x, then:
a) If the UE is configured with the ePDG selection information defined in
point 2) in clause 4.5.4.3 and there is an entry matching the PLMN-x in the
ePDG selection information and the entry does not indicate that emergency
bearer services are not supported by PLMN-x, then the UE shall attempt to
select an ePDG in this PLMN-x. The UE shall construct an ePDG FQDN for this
PLMN-x as described in this clause.
2) If the UE is not attached via 3GPP access to any PLMN or if the UE is
unable to select an ePDG according to point 1), then:
a) If the UE can determine the country it is located in and the UE is
configured with ePDG selection information defined in point 2) in clause
4.5.4.3 that includes entries for one or more PLMNs in this country that
indicate support for emergency bearer services for the entire country, then
the UE should select an ePDG in such a PLMN by constructing a corresponding
Operator Identifier FQDN as described in this clause.
NOTE: The UE should give priority to ePDG selection for the HPLMN when it
determines it is in the home country provided the conditions in point 2)a are
met.
3) In all other cases, if the UE can determine it is in the home country or
cannot determine the country is in, the UE shall select the ePDG in the HPLMN
as described in clause 4.5.4.4 points 1)b)i and 1)b)ii with FQDN construction
for point 1)b)ii modified as described in this clause.
## 6.29 Solution 29 for Key Issue 12: handover of an active emergency call
from WLAN to 3GPP CS with E-STN-DR
### 6.29.1 Procedures
> E-STN-DR is assigned by the EATF during the IMS emergency session
> establishment procedure (see figure 6.29-1).
Figure 6.29.1-1: E-STN-DR assignment to UE
1\. UE-1 initiates an IMS emergency registration as defined in TS 23.167.
2\. Emergency INVITE is forwarded to EATF with the same procedure as defined
TS 23.237 [8] clause 6c.1.
3\. EATF allocates an E-STN-DR for this session. The INVITE contains
information (PANI header) that this call is via WLAN access and this can be
used to trigger the E-STN-DR allocation.
4\. EATF continues to setup the session to PSAP using the existing procedure
as defined in TS 23.237 [8] clause 6c.1.
5\. EATF returns the allocated E-STN-DR to UE in the SIP response to step 2.
Handover procedure from WLAN to 3GPP CS is depicted in the following figure
6.29-2.
Figure 6.29.1-2: IMS level Call flow for DRVCC for IMS emergency session with
E-STN-DR
1\. UE has an active emergency session over WLAN and have received E-STN-DR
from IMS for this session. UE determines that handover to CS RAT is needed
(based on UE implementation).
2\. UE performs normal CS location update if it is not yet attached to the CS
domain.
3\. While the IMS emergency call is on-going/active, UE starts a normal CS
call setup using the E-STN-DR.
NOTE 1: It is known that this solution does not support the higher RRC level
priority for CS emergency setup using CS emergency setup procedure as defined
in TS 24.008 [yy]. However, this is a \"make before break\" procedure so UE
can retry on the CS domain if call fails while emergency call is maintained on
the WLAN side.
NOTE 2: It is FFS if there is any need to optimize the CS Setup procedure
handling in the MSC.
4-5 MSC Server initiates the session transfer with the E-STN-DR and follow the
same procedure as defined in TS 23.237 [8] clause 6c.2. As already defined in
TS 23.237 [8], clause 6.3.1.6, UE and the EATF only initiate the Session
Release procedure when the switch to the Target Access Leg is complete.
NOTE 3: Based on configuration, MSC Sever is aware the E-STN-DR is within a
range of numbers that are defined for dual radio emergency session continuity
procedure and can trigger priority call handling if needed.
### 6.29.2 Impacts on existing nodes and functionality
UE: receives E-STN-DR from IMS for session continuity procedure toward the CS
domain.
EATF: returns E-STN-DR for session continuity procedure toward the CS domain.
MSC: session continuity procedure toward the IMS using the E-STN-DR from the
UE. The only impact is to consider this session as a priority call (based on
the analysis of the called party Number).
### 6.29.3 Solution Evaluation
The advantage of this alternative is that most of required functionalities are
reused from regular DRVCC and SRVCC procedure as defined in TS 23.237 [8].
It is known that this solution does not support the higher RRC level priority
for CS emergency setup using CS emergency setup procedure as defined in TS
24.008. However, this is a \"make before break\" procedure so UE can retry on
the CS domain if call fails while emergency call is maintained on the WLAN
side.
## 6.30 Solution 30 for Key issue 3: TWAG Push of location information to
LRF/LS at emergency attachment/De-attachment
At emergency attachment to a TWAG, the TWAG shall push subscriber location
data to the LRF/LS. This solution requires TWAG to support SLg reference point
The TWAG UE location information may correspond to WLAN Location Information
the TWAG may have received from the AAA server about the UE. In this scenario,
the LRF can use WLAN Location Information to identify subscriber location that
allows it to select an appropriate PSAP accordingly.
This applies both to authenticated and unauthenticated UEs.
If a TWAG detected or became aware that a UE, whose location information has
been previously reported to an LRF/LS, left the WLAN coverage, the TWAG shall
report this to the LRF/LS. This enables the LRF/LS to maintain updated UE
location information.
In addition to the above UE location information provided by the TWAG to the
LRF, the TWAG shall also include the following information in TS 29.172 [13].
Table 6.30-1
* * *
Information element name Mapping to Diameter AVP Cat. Description Location
Event Location-Event M This Information Element shall contain the type of
event that caused the location procedure to be initiated. IMSI User-Name C If
present, this Information Element shall contain the IMSI of the user whose UE
is to be positioned (see Note 1) MSISDN MSISDN C If present, this Information
Element shall contain the MSISDN of the user whose UE is to be positioned.
IMEI IMEI M This Information Element shall contain the IMEI of the UE to be
positioned. This information is mandatory for authenticated and non-
authenticated UEs. NOTE 1: For authenticated UE this is mandatory to enable
NPLI be used to locate PASP where regulation mandates that.
* * *
## 6.31 Solution 31: EIR check reusing the same Principle than in case of
regular sessions
The solution reuses the same principles than IMEI check in case of a regular
EPC session with following modifications:
\- The Action (going on establishing the session or rejecting the EPC session
request) when IMEI check result indicates a grey-listed or black-listed UE may
depend on whether the access is for a regular EPC session or for an EPC
session for emergency services.
\- In case of EIR check for unauthenticated UE, the dedicated AAA server for
unauthenticated UE interfaces the local EIR.
## 6.32 Solution 32: High level principles for emergency ePDG selection
reusing the solution defined for regular ePDG selection
This solution addresses only ePDG selection for emergency services (the UE is
aware that the user has dialled an emergency number)
ePDG selection for emergency services follows the same mechanisms than ePDG
selection for regular (non emergency ) services with following changes
1\. The UE shall use an ePDG to access a PLMN in the country where the UE is.
2\. ePDG selection for emergency services is not needed when the UE is
currently connected to an ePDG in the local country that has indicated support
for emergency services.
3\. It shall be possible to configure (\"emergency ePDG identifier
configuration\") the UE (e.g. H-ANDSF, USIM, etc) with an ePDG address that
supports emergency bearer services in its HPLMN: the emergency ePDG identifier
configuration contains the FQDN or IP address of an ePDG in the HPLMN.
Following points apply in case emergency ePDG identifier configuration of an
ePDG for emergency services is not used:
4\. A similar procedure than described in TS 23.402 [7] clause 4.5.4.5 applies
with modifications described below
5\. A DNS query dedicated to emergency services thus different from the one
used for selection of an ePDG for regular services (\"The UE shall perform a
DNS query to determine if the visited country mandates the selection of ePDG
in this country\") is needed as the DNS query used in TS 23.402 [7] clause
4.5.4.5 \"ePDG Selection with DNS-based Discovery of Regulatory Requirements\"
provides output only if there are LI requirements in the local country and
furthermore does not indicate which PLMN have deployed ePDG for emergency
services.
\- Thus dedicated DNS records are used that indicate the PLMNs in a country
that have deployed ePDG supporting emergency services.
6\. Following part of TS 23.402 [7] clause 4.5.4.5 \"ePDG Selection with DNS-
based Discovery of Regulatory Requirements\" may be reused \"with following
modifications highlighted in italics\"
\- If the UE is registered via 3GPP access to a PLMN which is included in the
DNS response, then the UE shall first try to select an ePDG in this PLMN.
\- - (if the UE has got an UICC) If the UE is registered via 3GPP access to a
PLMN which is not included in the DNS response or the UE is not registered via
3GPP access to any PLMN, then the UE shall select an ePDG in one of the PLMNs
included in the DNS response The UE shall select one of the PLMNs included in
the DNS response based on the prioritized list of PLMNs in the ePDG selection
information (i.e. the UE shall select first the highest priority PLMN in the
ePDG selection information that is contained in the DNS response). If the ePDG
selection information does not contain any of the PLMNs in the DNS response or
the UE is not configured with the ePDG selection information, then the UE
shall select a PLMN included in the DNS response based on its own
implementation means.
NOTE 1: The PLMN in the list of PLMNs in the ePDG selection information have
roaming agreement for ePDG access with the HPLMN
\- If the UE cannot select an ePDG as described above or has got no UICC, then
the UE shall
\- If Unauthenticated emergency bearers are allowed in the local country, the
UE shall attempt an un-authenticated access to an ePDG of a PLMN included in
the DNS response. The UE selects a PLMN within this response based on its own
implementation policies.
\- If there has been no DNS response and the ePDG selection information
contains one or more PLMNs in the visited country, the UE shall select an ePDG
in one of these PLMNs. The UE shall consider these PLMNs based on their
priorities in the ePDG selection information.
\- If any of the previous procedures failed and the UE has got an USIM, the UE
may attempt an access to an ePDG of the HPLMN
7\. The FQDN constructed by the UE (based on the selected PLMN-Id) shall
contain an indication that the UE requires an ePDG that supports emergency
bearer services
The access (for regular or for emergency session) to an ePDG may be rejected
based on local policies related with where the UE is located.
NOTE 2: This may be used in some countries to prevent IMS access when the UE
is located in an area where this PLMN has no access to a local PSAP.
# 7 Overall evaluation
## 7.1 Overall evaluation for phase 1 (FS_SEW1)
Editor\'s note: This clause has not been used to reach conclusions for phase 1
(FS_SEW1).
## 7.2 Overall evaluation for phase 2 (FS_SEW2)
Editor\'s note: This clause will be used in phase 2 (FS_SEW2). It contains
evaluation only on a list of selected topics for which there are multiple
solutions
### 7.2.1 Evaluation on the solutions related with Determine Emergency Call
Numbers
This clause evaluates solutions to key issue 16 which is \"to define how the
UE can determine the local Emergency Call Numbers when connected over WLAN\".
2 solutions are proposed: in clause 6.11 (the local Emergency Call Numbers may
be received over 3GPP access / AP) and clause 6.22 (the local Emergency Call
Numbers may be received from TWAN/ePDG).
Procedures to provide the local Emergency Call Numbers over the 3GPP access
are already supported while new procedures (involving the ePDG, the TWAG, the
TWAP and the AAA server) would need to the defined when solution in clause
6.22 would be chosen.
Furthermore, when an UE is connected to an ePDG in the HPLMN, the UE cannot
get local emergency numbers in the VPLMN.
NOTE: AP advertising the ES numbers is a feature included in IEEE 8011-2012,
but there is currently no WFA certification, so basically the supports is not
guaranteed. IEEE 802.11-2012 (11u) includes additional features which may be
useful also for unauthenticated device, for indicating whether ES is
supported, etc, etc. During the normative phase these aspects will be further
considered, for example whether communicate to WFA and WBA the 3GPP decision
and requirements.
### 7.2.2 Evaluation on the solutions related with Support of Mobility with
3GPP access (EPC)
The issue is on how to make sure that the same PGW is used over 3GPP and WLAN
access.
In case of static PGW selection, the same PGW identity is configured in the
Emergency Data of the MME and of the ePDG/TWAG.
There are 2 solutions documented that are related with Support of Mobility
with 3GPP access (EPC) in case of a dynamic PGW allocation for emergency
services.
6.17.2 Solution based on retrieving PGW ID from LRF/GMLC.
6.17.3 Solution based on HSS storing the PGW for emergency PDN connection.
Both solutions assume that the nodes (MME/SGSN or ePDG/TWAG) serving the UE
before and after the mobility event belong to the same PLMN. Otherwise the PGW
in the source access would not understand that the APN received from the
serving node on a target access belonging to a different PLMN actually
corresponds to emergency services).
The solution 17.2 \"relies on the LRF/GMLC for storing the PGW Identity when
the UE makes initial attach, and retrieving the PGW Identity from the LRF/GMLC
as the UE makes handover from 3GPP access to WLAN access, or from WLAN access
to 3GPP access\". This solution requires:
\- A new interface between the ePDG / TWAG and the LRF/GMLC (to store / fetch
the PGW ID information).
\- Changes to the MME logic to contact the LRF before setting up the S5/S8 PDN
connection (Create Session Request) to the PGW.
This solution works in case of un-authenticated UE (identified by their IMEI).
The solution 17.3 \"Solution based on HSS storing the PGW for emergency PDN
connection\" reuses (with adaptations) the same mechanisms that have been
defined to propagate the PGW at Hand-Over between 3GPP and WLAN accesses:
\- Providing the address of the PDN GW used for the emergency PDN connection
to the HSS together with an indication that the PDN connection is for
emergency services (\"PDN GW currently in use for emergency services\").
\- Getting this address from the HSS as part of a specific subscription data.
This solution supports mobility in case of a dynamic PGW selection only in
case of authenticated UE (requires a HSS). This solution requires the HPLMN to
upgrade their HSS.
In case of unauthenticated UE, a fixed PGW is to be chosen.
Considering the evaluation in clause 7.2.2 and in clause 7.2.3:
\- In case of un-authenticated emergency session, a static PGW is allocated.
\- In case of authenticated emergency session, a dynamic PGW may be selected.
In that case the Solution documented in clause 6.17.3 (based on HSS storing
the PGW for emergency PDN connection) is selected to support mobility between
3GPP and WLAN access.
\- No interface is needed in this release between the ePDG/TWAG and the
LRF/GMLC.
### 7.2.3 Evaluation on the solutions related with LRF
In case of 3GPP access an interface has been defined between LRF/GMLC and MME
in order to provide finer grain location information than what can be provided
with the location reporting for NETLOC (reporting the ECGI from MME to the IMS
via GTP-c, Gx ,Rx and SIP signalling).
NOTE: Indeed the 3GPP RAN can support advanced network based LCS capabilities
to provide much finer location information than an ECGI (especially when the
UE is under a macro cell)
In case of WLAN access it is questionable whether the WLAN AN will provide
finer location information than what is being reported as part of NETLOC in
S2a/S2b case:
\- In S2b case, the WLAN AN may be totally unknown.
\- A WLAN AN range is much smaller than a 3GPP Cell Id.
Thus the need to create new reference points between the ePDG/TWAG and the
GMLC for the sake of getting / pushing advanced location information is
questionable.
### 7.2.4 Evaluation on the solutions related with Handover of an active
emergency call between WLAN and 3GPP CS
This clause evaluates solutions to key issue 12 and 13 with respect to the
3GPP CS domain.
For CS to WLAN handover:
\- Handover of an active emergency call from 3GPP CS to WLAN is not supported
in this release. When UE is moved outside the CS coverage and into WiFi
coverage where emergency call can be supported, the UE will have to re-
initiate the emergency session over WLAN as a new session. This direction, if
needed to be specified, would require a new study item to be created.
For WLAN to CS handover:
\- A solution which reuses many of the DRVCC and SRVCC features as defined in
TS 23.237 [8] is preferred. See 6.29 (E-STN-DR).
# 8 Conclusions
## 8.1 Conclusions for phase 1 (FS_SEW1)
The solutions in clauses 6.11, 6.12 and 6.13 will not be considered in phase
1.
The Key Issue 6 is not considered in phase 1.
There is will be no specification work to support of emergency services over
TWAN in phase 1. There will be no specification work to support LRF retrieval
of WLAN location information in phase 1.
Solution 14: \"Overall procedure\" is endorsed as the baseline for normative
work on phase 1 of the Support of Emergency services over WLAN together with
following other solutions:
\- \"Solution 3 for key issue #3: UPLI via SIP for untrusted WLAN\" in clause
6.3.
\- \"Solution 7 for key issue #3: UPLI to OMA server (fallback use case)\" in
clause 6.7, endorsing the transfer of a Cell-Id Age in UPLI.
\- \"Solution 9 Base Solution to Key issue 3: Handling of UE multiple provided
location information\" in clause 6.9.
\- \"Solution 10: Location Information Included in SIP Register\" in clause
6.10.
## 8.2 Conclusions for phase 2 (FS_SEW2)
Editor\'s note: This clause will be used in phase 2.
During the normative phase it will be determined whether, and if, the network
configuration for allowing or disallowing unauthenticated emergency service
via WLAN can be set with different permissions to the configuration that
performs the same function for cellular access.
It is concluded to base the normative phase of SEW2 on following solutions:
\- Solution 6.11 for the UE Determination of the numbers related with
Emergency services in a PLMN.
\- Solution 6.16 \"Support of emergency services by TWAN\" for authenticated
UEs.
\- Solution 6.19 for the EPC Access via TWAN/ePDG for emergency services in
the case of an UE without proper authentication credentials / authorization
rights (SIMless, no possibility to authenticate, no roaming rights, etc.).
\- Solution 6.15 for the Knowledge that a TWAN / an ePDG supports Emergency
services.
\- Solution 6.13 for the Determination of the local country.
\- Solution 6.32 \" High level principles for emergency ePDG selection reusing
the solution defined for regular ePDG selection\" for the Selection of an ePDG
that supports emergency services.
\- Solution \"Solution 31: EIR check reusing the same Principle than in case
of regular sessions\" for the IMEI check in case of Emergency services.
\- for the mobility at EPC level between WLAN and 3GP access (keeping the same
IP address for the UE).
\- In case of un-authenticated emergency session, a static PGW is allocated.
\- In case of authenticated emergency session, a dynamic PGW may be selected.
In that case Solution documented in clause 6.17.3 (based on HSS storing the
PGW for emergency PDN connection) is selected to support mobility between 3GPP
and WLAN access.
\- Solution 6.29 \"Handover of an active emergency call from WLAN to 3GPP CS
with E-STN-DR\" for the mobility from WLAN to CS domain on 3GP access (VCC
like solution).
\- For key issue 12 and 13 between WLAN and 3GPP CS, normative work will
proceed as described in clause 7.2.4.
\- Solution 27 \"for Key issue 3: NPLI for Untrusted WiFi emergency sessions\"
\- Solution 23 \"Solution 23 for Key issue 3: Using the emergency signalling
channel for on-demand UE Location update mid-session\".
Based on SA WG1 LS (TD S2-161389), the 3GPP access - when available - has
higher priority than WLAN access for emergency sessions. In this release no
procedure will be documented for a UE to attempt an emergency session over
WLAN if 3GPP access is available.
#
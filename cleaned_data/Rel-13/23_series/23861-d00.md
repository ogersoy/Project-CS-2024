# Foreword
This Technical Report has been produced by the 3rd Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
Y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
Release 8 EPS introduced a multi access 3GPP system where different
heterogeneous access systems are connected to a common core network. However,
in Release 8 EPS, the subscriber cannot communicate using multiple accesses
simultaneously. The subscriber can establish a single PDN connection or
multiple simultaneous PDN connections in Release 8 EPS, but all the traffic
exchanged by the subscriber, regardless of the PDN connection it belongs to,
is routed through the same access system. Similarly, Release 8 introduced
mobility enhancements to the I-WLAN architecture to support session continuity
for any application between 3GPP and I-WLAN accesses, but this will not be
further developed in Rel‑13.
Devices with multiple wireless interfaces (e.g. 3GPP , WLAN, etc.) are
becoming commonly available and the set of applications running in the mobile
devices is diversifying with some applications suited to run over 3GPP access
systems and other applications well suited to run over some other -
complementary - access systems (e.g. ftp transfer via WiFi in parallel to VoIP
over LTE).
The scope of this document is to study the scenarios, requirements and
solutions for UEs with multiple interfaces which will simultaneously connect
to 3GPP access and one, and only one, non-3GPP WLAN access.
The clause 7.1 refer to the study for the support of IP flow mobility for s2c
completed in Rel‑10 and the results have been transferred in TS 23.261. This
clause will not be modified nor maintained during Rel‑13 work. Solutions which
was studied includes the possibility of dynamically routeing to specific
accesses individual flows generated by the same or different applications
belonging to the same PDN connection. The study of solutions to support
routing of different PDN connections through different access systems is also
in the scope of this TR. This study item also investigates the mechanisms for
provisioning the UE with operator\'s policies for multi access PDN
connectivity and flow mobility.
The scope of Rel‑13 work is to identify the requirements and solutions for UEs
with multiple interfaces which are simultaneously connected to 3GPP access and
a WLAN access using a network-based mobility protocol, PMIP and GTP based S2a
and S2b access to EPS.
The solutions studied from Rel‑13 consider the following aspects:
\- The support of a PDN Connection active over multiple accesses
simultaneously.
\- The association of one or multiple IP flows belonging to a PDN connection
to an access system.
\- The movement of one or multiple IP flows belonging to a PDN connection
between different access systems.
\- The triggers for IP flow mobility in the UE and the network.
\- UE-initiated and network-initiated NBIFOM.
\- The impact and the relationship to 3GPP related policies (e.g. PCC, ANDSF,
ISRP, ISMP, RAN policy with no ANDSF etc.), if any, to support NBIFOM.
This work item doesn\'t include the scenario where the same IP flow is routed
via different access system simultaneously.
Scenarios and solutions described in this document are applicable
independently of whether IMS or non-IMS applications are used.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.402: \"Architecture enhancements for non-3GPP accesses\".
[3] 3GPP TS 23.327: \"Mobility between 3GPP-WLAN interworking and 3GPP
systems\".
[4] IETF Internet-Draft, draft-ietf-monami6-multiplecoa-11.txt, \"Multiple
Care-of Addresses Registration\", work in progress.
[5] IETF Internet-Draft, draft-ietf-mext-flow-binding-01.txt, \"Flow Bindings
in Mobile IPv6 and Nemo Basic Support\", work in progress.
[6] IETF Internet-Draft, draft-ietf-mext-nemo-v4traversal-07.txt, \"Mobile
IPv6 support for dual stack Hosts and Routers (DSMIPv6)\", work in progress.
[7] 3GPP TS 23.203: \"Policy and Charging Control Architecture\".
[8] 3GPP TS 23.401: \"General Packet Radio Service (GPRS) enhancements for
Evolved Universal Terrestrial Radio Access Network (E-UTRAN) access\".
[9] IETF Internet-Draft, draft-ietf-netext-pmipv6-flowmob-04.txt, \" **Proxy
Mobile IPv6 Extensions to Support Flow Mobility** \" , work in progress.
[10] IETF RFC 5996, _\"_ Internet Key Exchange Protocol Version 2 (IKEv2)_\"._
[11] 3GPP TS 33.402: \"3GPP System Architecture Evolution: Security aspects of
non-3GPP accesses\".
[12] 3GPP TS 29.275: \"Proxy Mobile IPv6 (PMIPv6) based Mobility and
Tunnelling protocols; Stage 3\"_._
[13] 3GPP TS 23.261: \" IP flow mobility and seamless Wireless Local Area
Network (WLAN) offload; Stage 2\"_._
_[14] 3GPP TS 23.060: \"_**General Packet Radio Service (GPRS); Service
description; Stage 2\".**
_[15] IETF RFC 7077: \"Update Notifications for Proxy Mobile IPv6\"._
_[16] 3GPP TS 36.413: \"Evolved Universal Terrestrial Radio Access Network
(E-UTRAN); S1 Application Protocol (S1 AP)\"._
[17] 3GPP TS 24.312: \"Access Network Discovery and Selection Function (ANDSF)
Management Object (MO)\"_._
[18] 3GPP TS 23.237: \"IP Multimedia Subsystem (IMS) Service Continuity; Stage
2\"_._
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
TR 21.905 [1] and the following apply.\ A term defined in the present document
takes precedence over the definition of the same term, if any, in TR 21.905
[1].
**Routing filter:** A set of packet flow IP header parameter values/ranges
used to identify IP flows for routing purposes.
**routing address** : A routable IP address. In DSMIPv6 this is either the CoA
(visited link case) or the HoA (in home link case).
**routing access type** : Type of access network (e.g. 3GPP or WLAN) that the
P-GW routes the UE\'s IP flow.
**routing rule:** The association of routing filter with a routing address or
routing access type.
**NBIFOM:** IFOM based on network mobility protocols (GTP or PMIP).
**UE-initiated NBIFOM:** IFOM based on network mobility protocols (GTP and
PMIP) where the UE initiates the IP flow mobility.
**Network-initiated NBIFOM:** IFOM based on network mobility protocols (GTP
and PMIP) where the network initiates the IP flow mobility.
**Multi-access PDN connection:** A PDN connection **whose traffic can be
routed** over **either a** 3GPP **access or** a WLAN access or both. **Each IP
flow is routed at any single time only over one access**.
NOTE: Application of NBIFOM to other non-3GPP access (e.g. CDMA) is not
precluded even though it is not defined in this release of the specification.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply.\ An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
NBIFOM Network-based IP flow mobility
MCM Multi-connection mode
SCM Single-connection mode
TSCM Transparent Single-connection mode
# 4 Use cases
## 4.1 Introduction
This clause describes some scenarios where the UE is connected to the EPS via
different accesses simultaneously, sending and receiving different IP flows
through different accesses.
NOTE: The following use cases are valid in the direction from 3GPP to non-3GPP
accesses and vice versa, even when not explicitly stated.
## 4.2 Use Case 1
Michael is at home where both 3GPP access and a trusted or untrusted non-3GPP
access are available. As an example, the non-3GPP access may be a domestic
WiFi hotspot. Michael is accessing different services with different
characteristics in terms of QoS requirements and bandwidth:
\- a Video Telephony call,
\- a media file synchronization (e.g. a podcast and downloading of a TV
series),
\- a non-conversational video streaming (e.g. IPTV), and
\- a p2p download.
Some of these flows may be from the same application (e.g. the Video Telephony
may be via a virtual private network tunnel). Based on operator\'s policies,
the user\'s preferences and the characteristics of the application and the
accesses, the IP flows are routed differently; as an example, the audio media
(conversational voice) of the VT call and the video streaming are routed via
3GPP access, while the video media (conversational video (live streaming)) of
the VT, the p2p download (best effort) and media file synchronization are
routed through the non-3GPP access. The scenario is depicted in Figure 4.2-1.
Figure 4.2-1: Routeing of different IP flows through different accesses
After a while Michael moves out of the home and loses the non-3GPP
connectivity. Triggered by this event, the IP flows need to be moved to the
3GPP access which is the only access available. Figure 4.2-2 shows how the IP
flows are redistributed when the non-3GPP access is no longer available.
Figure 4.2-2: UE moves out from non-3GPP access and the IP flows are moved to
3GPP
Later Michael goes back home, or moves to another location where both 3GPP and
non-3GPP connectivity are available. Triggered by this event, the video media
of the VT, the p2p download and the media file synchronization are moved back
to the non-3GPP access. As a result, the scenario depicted in Figure 4.2-1 is
restored.
## 4.3 Use Case 2
Michael is spending time by hanging out with an online friend via a multimedia
session. They have a VoIP session (conversational voice) combined with video
(conversational video). During the multimedia session Michael browses web
(best effort) and occasionally watches cool video clips (Non conversational
video). Based on the operator policy the VoIP flow and conversational video
are routed via 3GPP access, while the non conversational video and best effort
IP flows are routed via Non 3GPP. At 2am, Michael\'s device starts ftp file
synchronization with a backup server (best effort) (Figure 4.3-1).
Figure 4.3-1: Splitting of IP flows based on operator\'s policies
Due to the ftp synchronization, the non 3GPP access becomes congested and the
non conversational video flows are moved to 3GPP access. (Figure 4.3-2).
Figure 4.3-2: Movement of one IP flow due to network congestion
Later as the Http server response time for the web browsing session (best
effort) is detected to have increased, also the best effort web browsing is
moved to 3GPP access. Only the ftp file synchronization is left to Non 3GPP
access (Figure 4.3-3).
Figure 4.3-3: Further movement of IP flows due to network congestion
At 2:15am the ftp synchronization completes and the non conversation video and
Web browsing are moved back to Non 3GPP access (Figure 4.3-4).
Figure 4.3-4: Distribution of IP flows after network congestion is over
# 5 Service requirements
Editor\'s note: This clause is only applicable from Rel-13 onwards.
Based on the use cases discussed in the previous clause, the following
potential requirements, applying to EPS mobility, can be identified:
\- Service continuity should be provided when the UE moves from the 3GPP
access to WLAN access and vice versa.
\- If the UE is under the coverage of more than one access, including 3GPP and
WLAN accesses, it should be possible for the UE to communicate using multiple
accesses simultaneously for a PDN connection if the UE is authorized by
subscription to access all of the involved PDNs and all of the involved access
networks for this PDN connection.
\- It should be possible to select one access when a flow is started and re-
distribute the flows to/from a UE between accesses while connected.
\- It should be possible for the operator to enable and control the
simultaneous usage of multiple accesses.
\- It should be possible to distribute flows to/from a UE between available
accesses based on the characteristics of the flows and the capabilities of the
available accesses, subjected to user\'s preferences and operator\'s policies.
For example, when both 3GPP and WLAN accesses are available, flows with high
QoS requirements (e.g. voice) may not be routed through the WLAN access, in
order to prevent loss of service.
\- It should be possible for the operator to define policies for the control
of the distribution of IP flows between available accesses. Each policy shall
include a list of preferred accesses. Selection of the WLAN network is based
on TS 23.402 [2].
NOTE: The possibility of manual selection or user override is not precluded.
These policies may be defined per APN, per IP flow class under any APN or per
IP flow class under a specific APN. The IP flow class identifies a type of
service (e.g. IMS voice) or an operator defined aggregation of services.
The policies apply with the following priority order:
1\. Policies per IP flow class under a specific APN.
2\. Policies per IP flow class under any APN.
3\. Policies per APN.
\- Distribution of flows to/from a UE between available accesses based on the
characteristics of the flows and/or the capabilities of the available accesses
should be possible for flows exchanged by both operator controlled (e.g. IMS)
and non operator controlled (e.g. web and mail access) applications/services.
\- It should be possible to move all the flows to/from a UE out of a certain
access in case the UE loses connectivity with that access (e.g. UE moves out
of coverage of a non-3GPP access while maintaining connectivity through the
3GPP access).
\- Re-distribution of flows to/from a UE between accesses may be triggered by
changes to the characteristics of the flows (e.g. QoS requirements) or the
capabilities of the available accesses (e.g. due to network congestion,
mobility event, or UE discovers a new access) during the connection.
Simultaneous active mode of operation is an optional capability for multimode
UEs, which support 3GPP and WLAN accesses. UE supporting simultaneous active
mode of operation between one set of technologies may not be capable to
support simultaneous active mode of operation between a different technology
set (e.g. due to radio interference limitations).
# 6 Architectural requirements, assumptions, high level issues and design
considerations
Editor\'s note: This clause is only applicable from Rel-13 onward.
## 6.1 Architectural requirements
### 6.1.1 General
Multi Access PDN connectivity and IP flow mobility shall be possible both for
EPS architectures.
The impacts to the existing functionality and to the access systems shall be
minimized.
It should be possible for a multi-radio UE that is able to simultaneously
connect to a given PDN via different access systems, to move individual
service data flows from one radio access technology to another in a seamless
manner (i.e. without unnecessary disturbance of the user experience).
Editor\'s note: This requirement may overlap with the service requirements. It
needs to be clarified.
It should be possible for EPS mobility to support simultaneous access to a
single PDN via different access networks.
### 6.1.2 Additional requirements for network-based IP flow mobility support
With NBIFOM, a PDN connection may rely on two access links to connect to a
PGW. The network shall always be aware of whether all flows of the PDN
connection shall use the same access link or whether different IP flows of the
PDN connection may use different access links.
It should be possible to move individual service data flows from one (source)
to another (target) access link in a seamless manner, when policies determine
that these flows should be moved and the target access link is available for
the UE.
For downlink traffic: the PDN GW shall perform IP flow routing of traffic for
multi-access PDN connectivity, independent of the network-based mobility
protocol (i.e. GTP or PMIP) used on S5/S8, S2a or S2b.
For uplink traffic: the UE shall perform IP flow routing of traffic for multi-
access PDN connectivity.
## 6.2 Architectural assumptions
Figures 6.2-1 and 6.2-2 show the baseline architecture reference model for
multi access PDN connectivity and IP flow mobility when EPS is deployed in the
non roaming case. Figure 6.2-1 shows the EPS architecture when S2c is used and
the Figure 6.2-2 shows the EPS architecture when S2a or S2b are used for WLAN
access. Similar architectures in the roaming case for both LBO and non-LBO
traffic are available in TS 23.402 [2].
Figure 6.2-1: Non-Roaming Architecture within EPS using S5, S2c
Figure 6.2-2: Non-Roaming Architecture within EPS using S5, S2a, S2b
## 6.3 High level issues and design considerations
### 6.3.1 Network based mobility management issues
The following describes the design issues that are required to be considered
for NBIFOM.
**Issue #1:** Simultaneous support of a PDN connection over 3GPP access and
WLAN access.
In order to enable NBIFOM, it shall be possible for a UE to establish and
maintain a PDN connection both over 3GPP access and WLAN access
simultaneously. This shall be supported both in case of S2b and S2a
connectivity. While this is not supported by current specification.
**Issue#2:** Communication between the UE and the PGW to install the route
rules (if needed).
For NBIFOM, in current specification there is no direct communication support
between the UE and the PGW to install the routeing rules.
For NBIFOM, the following cases will be studied:
\- UE initiated NBIFOM: A signalling means allowing the UE to provide the PGW
with the desired mapping between IP flows and access links. The network may
either accept or reject UE\'s request for IP flow mobility, but does not
initiate IP flow mobility itself.
\- Network initiated NBIFOM: A signalling means allowing the PGW to provide
the UE with the desired mapping between IP flows and access links. The UE may
either accept or reject the network\'s request for IP flow mobility (e.g.
based on the suitability of the WLAN link conditions), but does not initiate
IP flow mobility itself.
**Issue #3:** The same IP address on multiple IP interfaces.
The assignment of IPv4 address, IPv6 prefix(es) and IPv6 interface
identifiers, handling of multicast packets, including signalling messages that
may be sent on a multicast link-local address (e.g. DHCPv6, RA/RS), etc. must
be analysed.
**Issue # 4:** Loss of WLAN access.
For a UE with active flows on both WLAN access and 3GPP access, if the WLAN
coverage is lost, a mechanism is needed to move the Service data Flows back to
3GPP access in order to minimise service disruption.
**Issue#5:** NBIFOM Capability discovery.
It shall be possible for the UE and the network to discover whether the
network and the UE respectively support NBIFOM.
**Issue#6:** Conflict resolution between UE-initiated and network-initiated
NBIFOM.
A mechanism is needed to avoid that the application of both UE initiated and
network initiated NBIFOM to a PDN connection leads to conflicts.
**Issue#7:** PCC policy for NBIFOM
The issue is to define PCC procedures required to support NBIFOM.
### 6.3.2 High level design principles
The following design principles apply to NBIFOM:
1\. Route rules installation is possible at any time during the life of a PDN
connection in order to enable IP flow mobility.
2\. The UE can add an access for a PDN connection even if traffic is not
immediately routed over the added access.
3\. Discovery of NBIFOM support in UE and PDN GW is on a per-PDN connection
basis.
4\. Discovery of NBIFOM support in UE and PDN GW happens at PDN connection
establishment.
# 7 Solutions for multi access PDN connectivity and IP flow mobility
Editor\'s note: This clause will describe the proposed solutions for the use
cases identified in clause 4.
## 7.1 IP flow mobility solutions for S2c/H1 (DSMIPv6)
### 7.1.1 Solution A: Routeing filters in DSMIPv6
#### 7.1.1.1 Overview
In Rel-8 _EPS_ and _I-WLAN Mobility_ the granularity of access system
connectivity and inter system mobility is per PDN connection basis. To handle
IP flow mobility the PDN connectivity (i.e. mobility of IP flows within one
single PDN connection) mobility would need to be handled per IP flows. Table
7.1.1-1 indicates the basic required enhancements:
Table 7.1.1-1
* * *
                                               Rel-8 system   System with IP Flow mobility
Inter-system mobility Per UE Per IP flows within PDN connection PCC logic &
IP-CAN specific PCC signalling Per IP-CAN Per IP flows within IP-CAN ANDSF
Inter System Mobility policies Per UE Per IP flow classes within UE
* * *
NOTE: Even though the S5/S8 GTP signalling is per bearer basis, and the inter-
system mobility signalling is per PDN connection basis, the granularity of the
intersystem mobility in Rel-8 is per UE basis (i.e. the UE moves always all
the entire PDN connections when handing over to one access). Annex A of the TR
presents the enhancements needed to have a PDN connection level inter-system
mobility.
This solution is based on enhancing the inter-system mobility signalling in
order to carry routeing filters. The extensions to DSMIPv6 mobility signalling
needed to carry routeing filters when the UE is connected to multiple accesses
simultaneously are specified in draft-ietf-monami6-multiplecoa [4] and draft-
ietf-mext-flow-binding [5] and are applicable to S2c and H1. The PCC
interactions are optional and applicable only to S2c. In this solution the
functional split between mobility signalling and PCC signalling is kept the
same as in Release 8:
\- Mobility signalling is used to provide routeing information for existing IP
flows.
\- PCC signalling is used to provide SDF level QoS rules to the appropriate
gateways based on the current routeing of IP flows.
The details of the ANDSF enhancements are discussed in clause 7.6.
#### 7.1.1.2 DSMIPv6 enhancements
In this solution, when a UE configures different IPv6 global addresses on
multiple accesses, it can register these addresses with the PDNGW/HA as CoAs
using multiple bindings as specified in draft-ietf-monami6-multiplecoa [4].
To register multiple bindings, the UE generates a Binding ID (BID) for each
CoA and stores the BID in the binding update list. The UE then registers its
CoAs by sending a Binding Update (BU) with a Binding Identifier mobility
option. The BID is included in the Binding Identifier mobility option.
When the PDNGW/HA receives the BU with a Binding Identifier mobility option,
it copies the BID from the mobility option to the corresponding field in the
Binding Cache entry. If there is an existing Binding Cache entry for the MN,
and if the BID in the BU does not match the one with the existing entry, the
HA creates a new Binding Cache entry for the new CoA and BID.
Based on this extension, a typical Binding Cache in PDNGW/HA according to this
specification is shown in Table 7.1.1-2.
NOTE: A BID is only unique for a given HoA, i.e. different mobile nodes can
use the same BID value.
Table 7.1.1-2: Binding Cache in PDNGW/HA supporting multiple CoAs registration
* * *
Home Address Care-of Address Binding ID HoA1 CoA1 BID1 HoA1 CoA2 BID2 ... ...
...
* * *
In order to route IP flows through one access, the UE needs to request to
store routeing filters for that access at the PGW/HA: the UE includes the
\'Flow Identification\' (FID) mobility option in the BU message as defined in
[5]. The routeing filters are unidirectional and can be different for uplink
and downlink traffic.
It is assumed that between UE and the Home Agent function there is always a
default routeing address via which packets not matching any specific routeing
filter are routed.
A typical Binding Cache in PDNGW/HA with routeing filters is shown in Table
7.1.1-3. Note that a FID is only unique for a given HoA, i.e. different PDN
connections can use the same FID value.
Table 7.1.1-3: Binding Cache in PDNGW/HA supporting flow bindings
* * *
Home Address Routeing Address Binding ID Flow ID Routeing Filter HoA1 CoA1
BID1 FID1 Description of IP flows... FID2 Description of IP flows... HoA1 CoA2
BID2 FID3 ...
* * *
#### 7.1.1.3 PCC Enhancements
Rel-8 PCC is designed to handle a single active access connection for each IP-
CAN. PCC enhanced for IP flow mobility must handle multiple simultaneous
access connections for a single IP CAN not only during the handover scenarios.
The main foreseen changes are:
\- Some of the IP-CAN level Gx signalling is enhanced to deliver SDF specific
routeing addresses instead of IP-CAN session specific routeing addresses.
\- PCRF is enhanced with the logic to associate multiple Gxx sessions with a
single Gx session, based on the SDF specific routeing addresses exchanged over
Gx.
The following principles apply for the interactions between routeing and SDFs:
\- PCRF informs PDN GW always when a new SDF is established via Gx (as in
Rel-8).
\- PDN GW keeps PCRF up to date about the current routeing addresses for each
IP flows by providing new and updated routing rules via Gx signalling.
\- PCRF keeps PCC and QoS rules up to date at appropriate gateways based on
the routing rules provided by the PDN GW.
\- When PCRF receives a new request from AF over Rx to establish resources
(i.e. network initiated resource establishment), PCRF checks the current
routing rules (including the default routing rule) to detect where the
respective IP flows will be routed. Based on this check, PCRF provides new or
updated PCC rules and QoS rules to gateways, if appropriate.
#### 7.1.1.4 Flows
##### 7.1.1.4.1 General
The flows in this clause are based on the flows specified in TS 23.402 [2].
The flows are applicable also to the I-WLAN mobility architecture: in this
case the PCC interactions are not implemented and the role of the PDN GW is
performed by the Home Agent.
##### 7.1.1.4.2 Addition of one access to the PDN connection
In this scenario, the UE is attached to one access, subsequently attaches to a
second access and starts using both accesses for the same PDN connection. As a
result the UE is simultaneously connected via both accesses and a set of
traffic flows are routed through one access while the remaining traffic flows
are routed through the other access.
Non-roaming, home routed roaming and Local Breakout cases are supported by
this procedure. The AAA proxy and vPCRF are only used in the case of home
routed roaming and Local Breakout. In non-roaming scenarios, the AAA proxy and
vPCRF are not involved.
The optional interaction steps between the gateways and the PCRF in the
procedures only occur if dynamic policy provisioning is deployed in EPC. These
steps are never present when the solution is applied to I-WLAN mobility
architecture according to TS 23.327 [3].
If the UE is first connected to a non-3GPP access using DSMIPv6 and
subsequently connects via a 3GPP access, the PDN GW which supports MAPIM shall
be configured not to send a Binding Revocation Indication message as described
in TS 23.402 [2], clause 8.4.1.
The below signalling flow shows in particular the case where the UE is first
connected to a 3GPP access which is configured as Home Link, and subsequently
connects via a non-3GPP access using DSMIPv6.
In case the solution is applied to I-WLAN, the Trusted non 3GPP IP Access is
replaced by the PDG, the EUTRAN/MME/SGW by the UTRAN/SGSN/GGSN and the PDN GW
by HA. As mentioned in case of I-WLAN the PCC interactions are not used.
Figure 7.1.2.2-1: Addition of one access to the PDN connection
1\. The UE performs an attach procedure to the 3GPP access as defined in TS
23.401 [8], clause 5.3.2. The UE may start exchanging data through the 3GPP
access.
2\. The UE discovers a non-3GPP access and performs the attach procedure as
per TS 23.402 [2], clause 8.4.2, steps 2-6.
3\. The UE sends a DSMIPv6 Binding Update ( HoA, CoA, Lifetime, BID, FID, flow
description) message to the PDN GW including the requested routeing rules via
the FID option with both the routeing filters and the BID (which includes the
routeing address) as specified in draft-ietf-mip6-nemo-v4traversal [6], draft-
ietf-monami6-multiplecoa [4] and draft-ietf-mext-flow-binding [5]. The UE can
include more than one routeing rule by including multiple FID options in the
Binding Update. The DSMIPv6 Binding Update also contains an indication which
indicates that the home link (3GPP access) is still connected and also the BID
options which identify that one binding is associated with the home address
(3GPP access) and the other with the Care-of-Address from the non-3GPP access.
The UE also indicates in the Binding Update which is the default binding where
the PDN GW should route packets not matching any FID.
4\. The PDN GW sends an IP-CAN session modification request to the PCRF. In
this request, the PDN GW provides the updated routeing rules to the PCRF. The
PCRF stores the mapping between each SDF and its routeing address.
5\. Based on the IP-CAN session modification request, the PCRF ensures that
the relevant QoS rules for the SDFs are installed in the target BBERF. This is
done by a GW control session and QoS rules provision procedure as specified in
TS 23.203 [7].
6\. Based on the successful establishment of resources at the BBERF, the PCRF
sends an acknowledgement to the PDN GW, including updated PCC rules if
appropriate.
7\. The PDN GW sends a Binding Acknowledgment (Lifetime, HoA, CoA, BID, FID)
as specified in draft-ietf-mip6-nemo-v4traversal [6], draft-ietf-
monami6-multiplecoa [4] and draft-ietf-mext-flow-binding [5], to indicate
which routeing rules requested by the UE are accepted.
8\. Appropriate 3GPP resource release procedures are executed for those
resources that were moved to the non-3GPP access. This procedure may be
triggered by the PCRF via a GW control session and QoS rules provision
procedure if PMIPv6 is used on S5 and it may be triggered by the PDN GW in
case GTP is used on S5.
##### 7.1.1.4.3 IP flow mobility
In this scenario, a new routeing rule is activated or an existing routeing
rule is modified by the UE in order to move one traffic flow from one access
to another access.
The optional interaction steps between the gateways and the PCRF in the
procedures only occur if dynamic policy provisioning is deployed in EPC. These
steps are never present when the solution is applied to I-WLAN mobility
architecture according to TS 23.327 [3].
In case the solution is applied to I-WLAN, the Trusted non 3GPP IP Access is
replaced by the PDG, the EUTRAN/MME/SGW by the UTRAN/SGSN/GGSN and the PDN GW
by HA. As mentioned in case of I-WLAN the PCC interactions are not used.
Figure 7.1.2.3-1: IP Flow Mobility
1\. The UE is simultaneously connected to a 3GPP and a non-3GPP access based
on the procedures described in clause 7.1.2.2. Based on current routeing rules
some traffic is routed through the 3GPP access and some other traffic through
the non-3GPP access.
2\. The UE sends a Binding Update ( HoA, BID, FID) to the PDN GW to install a
new routeing rule or to modify the routeing address of an existing routeing
rule to route the respective traffic (identified by the included FID) through
one particular access (identified by the included BID). In case of new
routeing rule with a new FID option, the UE includes the routeing filter
description.
NOTE: The UE can send the Binding Update either from the 3GPP or from the
non-3GPP access irrespective of which access the IP flow is moved to.
3\. The PDN GW sends an IP-CAN session modification request to the PCRF. In
this request the PDN GW provides the updated routeing rules to the PCRF. The
PCRF stores the updated mapping between routeing addresses and SDFs.
4\. Based on the IP-CAN session modification request, the PCRF ensures that
the relevant QoS rules are installed in the target BBERF. This is done by a GW
control session and QoS rules provision procedure as specified in TS 23.203
[7].
5\. Based on the successful establishment of resources at the BBERF, the PCRF
sends an acknowledgement to the PDN GW, including updated PCC rules if
appropriate.
6\. The PDN GW sends a Binding Acknowledgment (Lifetime, HoA, BID, FID) as
specified in draft-ietf-mip6-nemo-v4traversal [6], draft-ietf-
monami6-multiplecoa [4] and draft-ietf-mext-flow-binding [5], to indicate
which routeing rules requested by the UE are accepted.
7\. Appropriate EPS resource release procedures are executed for those
resources that were moved away from that access. This procedure may be
triggered by the PCRF via a GW control session and QoS rules provision
procedure if PMIPv6 is used on S5 and it may be triggered by the PDN GW in
case GTP is used on S5.
##### 7.1.1.4.4 Removal of one access from the PDN connection
In this scenario, the UE moves all traffic associated with one access to
another access and disconnects from the one access (e.g. due to loss of
coverage or by an explicit detach).
The optional interaction steps between the gateways and the PCRF in the
procedures only occur if dynamic policy provisioning is deployed in EPC. These
steps are never present when the solution is applied to I-WLAN mobility
architecture according to TS 23.327 [3].
In case the solution is applied to I-WLAN, the Trusted non 3GPP IP Access is
replaced by the PDG, the EUTRAN/MME/SGW by the UTRAN/SGSN/GGSN and the PDN GW
by HA. As mentioned in case of I-WLAN the PCC interactions are not used. The
below flow shows the case when the UE disconnects from the non-3GPP access and
remains connected only to the 3GPP access.
Figure 7.1.2.4-1: removal of one access from the PDN connection
The UE is simultaneously connected to a 3GPP and a non-3GPP accesses based on
the procedures described in clause 7.1.2.2. The UE is exchanging some traffic
flows through the 3GPP access and some other traffic flows through the
non-3GPP access. UE detects a condition triggering disconnection from the
non-3GPP access.
1\. The UE sends a Binding Update ( HoA, CoA, BID) to the PDN GW to update the
CoA for the BID previously associated with the non-3GPP access. As the 3GPP is
the home link, the CoA included in the Binding Update is set to the HoA. With
this Binding Update the UE requests also to move all traffic flows previously
associated with the non-3GPP access to the 3GPP access.
NOTE: In case the 3GPP is the home link, alternatively the UE may also send a
de-registration Binding Update. If PDN GW does not keep the BID and FID
associated with the non-3GPP access, the UE needs to perform the whole BID and
FID registrations from scratch as soon as it connects to a new non-3GPP access
again.
2\. The PDN GW performs an IP-CAN session modification procedure with the
PCRF. In this modification procedure the PDN GW indicates that a single
routeing address is used for all the SDFs.
3\. The PDN GW updates the Binding Cache and the routeing information and
sends a Binding Acknowledgement ( HoA, CoA, BID, Lifetime) to the UE.
4\. Based on the IP-CAN session modification, the PCRF ensures that the
relevant QoS rules are installed in the correct BBERF. This is done by a GW
control session and QoS rules provision procedure as specified in TS 23.203
[7].
5\. Appropriate resource release procedures are executed in the non-3GPP
access.
NOTE: Steps 1-4 are also performed when the UE disconnects from the 3GPP
access.
##### 7.1.1.4.5 Addition of one access for multiple PDN connections to the
same APN
When a UE having multiple PDN connections to the same APN via one access
attaches to a second access, the UE needs to decide which of the multiple PDN
connections the UE has would use both accesses simultaneously.
When the UE having multiple PDN connections to the same APN via 3GPP access
attaches to the non-3GPP access, the UE shall perform DSMIPv6 procedures only
for the PDN connections for which it will use IP flow mobility.
When the UE having multiple PDN connections to the same APN via a non-3GPP
access attaches to the 3GPP access, the UE should only establish the PDN
connections for which it will use IP flow mobility. However, due to the
restriction that the UE cannot indicate which PDN connection is to establish,
the UE shall repeat UE PDN Connectivity Request until the desired PDN
connections have been established and shall perform DSMIPv6 procedures for the
desired PDN connections.
#### 7.1.1.5 Routeing Filters
Routeing filters are a set of parameter values/ranges used to identify one or
more IP flows. The set of parameters that can be included as routeing filters
is the same as the ones that can be included in a Traffic Flow Template (TFT).
## 7.2 IP flow mobility solutions for S2a (PMIPv6)
### 7.2.1 Solution A: Routeing filters in PMIPv6
This solution is based on the same principles of solution A for DSMIPv6 but
PMIPv6 is used instead of DSMIPv6 as mobility protocol.
Due to the different nature of the PMIPv6 protocol, the routeing filters are
provided in the following way:
\- via access specific signalling used to perform attach and PDN connectivity
in 3GPP and non-3GPP accesses from the UE to the SGW/AGW.
\- via PMIPv6 signalling from the SGW/AGW and the PDN GW.
Editor\'s note: It is FFS if enhancements to PMIPv6 signalling is needed to
include the routeing filters or if PCO can be used.
#### 7.2.1.2 Addition of one access to the PDN connection
In this scenario, the UE is attached to one access, subsequently attaches to a
second access and starts using both accesses for the same PDN connection. As a
result the UE is simultaneously connected via both accesses and a set of IP
flows are routed through one access while the remaining IP flows are routed
through the other access.
Non-roaming, home routed roaming and Local Breakout cases are supported by
this procedure. The AAA proxy and vPCRF are only used in the case of home
routed roaming and Local Breakout. In non-roaming scenarios, the AAA proxy and
vPCRF are not involved.
The optional interaction steps between the gateways and the PCRF in the
procedures only occur if dynamic policy provisioning is deployed in EPC.
Figure 7.2.1.2-1: Addition of one access to the PDN connection
1\. The UE is attached to the 3GPP access and is connected to an PDN
connection.
2\. The UE discovers the trusted non-3GPP IP access system and determines to
transfer some IP flows from the currently used 3GPP Access to the discovered
trusted non-3GPP IP access system. The UE performs access authentication and
authorization in the non-3GPP access system as defined in TS 23.402 [2]. As
part of this procedure the AAA server provides the PDN GW identities to the
trusted non-3GPP access system as defined in TS 23.402 [2].
3\. After successful authentication and authorization, the L3 attach procedure
for a specific APN is triggered. In this step, the UE indicates the routing
filters for which the IP packets should be via the non-3GPP access. This
information is signalled to the non-3GPP access.
Editor\'s note: How this information is actually signalled from the UE to the
access network is FFS.
4\. The Trusted Non-3GPP IP Access initiates a Gateway Control Session
Establishment Procedure with the PCRF as specified in TS 23.203 [7].
Editor\'s note: It is FFS whether QoS rules are downloaded to the non-3GPP
access at this point.
5\. The entity in the Trusted non-3GPP IP Access acting as a MAG sends a Proxy
Binding Update message to the PDN GW as defined in TS 23.402 [2]. In addition
the Proxy Binding Update indicates the routing filters provided by the UE.
6\. The PDN GW sends an IP-CAN session modification request to the PCRF. In
this request, the PDN GW provides the updated routing rules to the PCRF. The
PCRF stores the mapping between each SDF and its routing address.
7\. Based on the IP-CAN session modification, the PCRF ensures that the
relevant QoS rules are installed in the correct BBERFs. This is done by a GW
control session and QoS rules provision procedure as specified in TS 23.203
[7]. This step may include update of the QoS rules both in the non 3GPP and
3GPP (if any) BBERF.
8\. The PDN GW responds with a PMIP Binding Acknowledgement message to the
Trusted Non-3GPP IP Access.
9\. L3 attach procedure is completed. The IP address assigned to the UE by the
PDN-GW is conveyed to the UE and the indication that the routing filters have
been installed at the PDN GW is provided.
The above flow describes the case where the UE is already attached to a 3GPP
access and then performs the attach procedure to a Trusted non-3GPP access. In
the case the UE is attached to a 3GPP access and connects to an untrusted
non-3GPP access or is attached to a non-3GPP access and then attaches to a
3GPP access, the procedure is conceptually the same.
Editor\'s note: In the case the UE attaches to 3GPP access as the second
access, it is FFS how the routing rules are provided, if in PCO or in actual
extensions to NAS and PMIPv6 signalling or using any other mechanism. From
this point of view the impacts to the MME and SGW are FFS.
#### 7.2.1.3 IP flow mobility
In this scenario, an IP flow is moved from one access to another access.
Figure 7.2.1.3-1 shows the case where one IP flow is added to the Trusted
non-3GPP IP access. This can be either a new IP flow or an IP flow which was
formerly routed through the 3GPP access.
The optional interaction steps between the gateways and the PCRF in the
procedures only occur if dynamic policy provisioning is deployed in EPC.
Figure 7.2.1.3-1: IP Flow Mobility
1\. The UE is simultaneously connected to a 3GPP and a non-3GPP access based
on the procedures described in clause 7.2.1.2 The UE is exchanging some IP
flows through the 3GPP access and some other IP flows through the non-3GPP
access.
2\. The UE sends an IP flow mobility trigger to the entity acting as a MAG in
the non-3GPP access including some routing rules. The IP flows request that
the IP flow(s) included in the request is routed through the non-3GPP access.
Editor\'s note: It is FFS how the IP flow mobility trigger and the routing
rules are provided to the MAG. Possible solutions include or access specific
signalling.
3\. The MAG in the non-3GPP access sends a Proxy Binding Update to the PDN GW
including the routing rules provided by the UE.
Editor\'s note: It is FFS how the routing rules are provided in PMIPv6,
whether in PCO or in actual extensions to PMIPv6 signalling.
4\. The PDN GW sends an IP-CAN session modification request to the PCRF. In
this request the PDN GW indicates how the mapping between SDFs and the
accesses has changed.
5\. The PDN GW sends an IP-CAN session modification request to the PCRF. In
this request the PDN GW provides the updated routing rules to PCRF. The PCRF
stores the updated mapping between routing addresses and SDFs.
6\. The PDN GW sends a Proxy Binding Acknowledgment to indicate that the
request has been accepted.
7\. The MAG sends an acknowledgement to the UE to indicate that the routing
filters request has been accepted.
Editor\'s note: It is FFS how the IP flow mobility acknowledge is provided to
the UE.
Editor\'s note: In the case the UE requests to move an IP flow to the 3GPP
access, it is FFS how the routing rules request is provided. Possible
approaches include Router Solicitation, extensions of existing NAS messages or
new NAS messages and PCO extensions. From this point of view the impacts to
the MME and SGW are FFS.
Editor\'s note: In the case the UE requests to move an IP flow to an untrusted
non-3GPP access, IKEv2 is used to provide the routing rules. The necessary
extensions to IKEv2 are FFS.
#### 7.2.1.4 Detaching from an Access
In this scenario, the UE moves all the IP flows associated with one access to
another access and disconnects from the one access (due to loss of coverage or
by an explicit detach).
The optional interaction steps between the gateways and the PCRF in the
procedures only occur if dynamic policy provisioning is deployed in EPC.
The below flow shows the case when the UE disconnects from the non-3GPP access
and remains connected only to the 3GPP access.
Figure 7.2.1.4-1: Detaching from an Access
The UE is simultaneously connected to a 3GPP and a non-3GPP access based on
the procedures described in clause 7.2.1.2 The UE is exchanging some IP flows
through the 3GPP access and some other IP flows through the non-3GPP access.
UE detects a condition triggering disconnection from the non-3GPP access.
If the UE is connected to multiple PDN connections via the access being
detached, the steps 2 to 6 will be performed for each PDN connection.
1\. The triggers either detach or disconnection from a specific PDN by an
access technology specific procedure.
2\. The Trusted Non-3GPP Access Network initiates the Gateway Control Session
Termination Procedure with the PCRF as specified in TS 23.203 [7].
3\. The MAG sends a Proxy Binding Update to the PDN GW with lifetime set to 0
indicating the de-registration.
4\. The PDN GW performs an IP-CAN session modification procedure with the
PCRF. In this modification procedure the PDN GW indicates that a single access
is used for all the SDFs.
5\. Based on the IP-CAN session modification, the PCRF ensures that the
relevant QoS rules are installed in the BBERF. This is done by a GW control
session and QoS rules provision procedure as specified in TS 23.203 [7].
6\. The PDN GW updates the routing information and sends a Proxy Binding
Acknowledgement to the MAG.
### 7.2.2 Solution B: IP flow mobility based on PCC for Network Based Mobility
Management Procedures
#### 7.2.2.1 Additional Simultaneous PDN Connectivity over Different Access
In this scenario the UE is attached to one access and has performed PDN
connection establishment to an APN. The UE subsequently performs attach to
another access for the same PDN for the same IP address. The UE shall perform
such simultaneous attach to another access by including multi-access
indication and associated parameters (if any) in the access specific
procedures. The access network shall pass such multi-access related
information to the PDN GW during Attach/PDN connection establishment
procedures. The PDN GW shall maintain multiple bindings for the PDN
connection, one for each of the attached accesses for the UE.
Multi-Access Indication and associated parameters shall be sent by the UE and
the access network in the Rel-8 specified IEs. Multi-Access Indication can be
carried in respective signalling messages either implicitly (e.g. another
enumerated value for the Attach Type IE), or explicitly within the PCO IE. The
choice of the preferred mechanism is FFS. Other multi-access related
parameters (if any) shall be carried in the PCO IE. It is FFS if other multi-
access related parameters can be used as Multi-Access Indication if they are
available.
IP Flow Mobility solution in this clause is based on PCC.
NOTE: This solution is applicable for flows known to the PCRF.
Editor\'s note: It is FFS how the flow mapping decisions for UL traffic are
delivered to the UE.
#### 7.2.2.2 Additional access Procedure to the PDN connection
##### 7.2.2.2.1 General
This clause is related to the case that the UE initiates the additional access
to the PDN connection from the second access network when the UE has attached
to the same PDN via the first access network. And the clause includes the
scenario of S2a for non-3GPP access and GTP-based S5/S8 and PMIP-based S5/S8
for 3GPP access.
##### 7.2.2.2.2 PCC Enhancements
PCC enhanced for IP flow mobility shall be able to handle multiple
simultaneous access connections for a single IP-CAN. The mainly foreseen
enhancements from Rel-8 PCC are:
1\. The PCRF and PCEF should maintain some PCC parameters with access
connection granularity instead of IP-CAN connection granularity.
2\. In the case of Network-initiated, the PCRF determines through which access
network the SDF shall be routed. The PCRF provides PCC rules including the
access network information to the PCEF.
##### 7.2.2.2.3 Additional access to the PDN connection with GTP-based S5 or
S8
The clause is to describe the additional access to the PDN connection from
3GPP access network when the UE has attached to the same PDN via a certain
non-3GPP access network. As a result the UE is simultaneously connected via
both accesses, a set of IP flows are routed through one access while the
remaining IP flows are routed through the other access. The S5/S8 interface in
the EPC is GTP-based.
The call flow is based on the E-UTRAN Attach procedure in TS 23.401 [8], and
the changes and enhancements are shown in this clause.
Non-roaming, home routed roaming and Local Breakout cases are supported by
this procedure. The AAA proxy and vPCRF are only used in the case of home
routed roaming and Local Breakout. In non-roaming scenarios, the AAA proxy and
vPCRF are not involved.
Figure 7.2.2.3.2-1: Additional access to the PDN connection with GTP-based S5
or S8
1\. The UE performs an attach procedure to the EPC using the specific non-3GPP
access system procedure using PMIP-based S2a interface. The UE may start
exchanging data through trusted non-3GPP access.
2\. The UE initiates the Attach procedure by the transmission of an Attach
Request message (PCO) to the eNodeB. PCO is used to transfer parameters
between the UE and the PDN GW, and is sent transparently through the MME and
the Serving GW. PCO here contains a MAPIM indicator, which is used to inform
that the P-GW should establish new GTP tunnel with S-GW while maintaining the
previous PMIPv6 tunnel with non-3GPP access.
The other parameters in this message and the function of the parameters can be
referred to TS 23.401 [8], clause 5.3.2.
The eNodeB forwards the Attach Request message to the MME.
Editor\'s note: It is FFS whether a new attach type value needs to be defined.
3\. This step can be referred to Steps 3-11 of E-UTRAN Initial Attach as
defined in TS 23.401 [8], clause 5.3.2.1.
4\. The MME selects a Serving GW and allocates an EPS Bearer Identity for the
Default Bearer associated with the UE. Then it sends a Create Default Bearer
Request (Protocol Configuration Options) message to the selected Serving GW.
The details of this step can be referred to TS 23.401 [8], clause 5.3.2.
5\. The Serving GW creates a new entry in its EPS Bearer table and sends a
Create Default Bearer Request (Protocol Configuration Options) message to the
PDN GW indicated by the PDN GW address received in the previous step. The
details of this step can be referred to TS 23.401 [8], clause 5.3.2.
6\. The P-GW sends an IP-CAN session modification request to the PCRF. In this
request, the PDN GW shall include the information of access network, and an
indication of Multi Access.
Editor\'s note: what is the information of access network and how the Multi
Access is indicated to the PCRF is FFS.
7\. Because the P-GW has received the MAPIM indicator from the PCO, The P GW
creates a new entry in its EPS bearer context table while update the former
binding information with the non-3GPP access network. The new entry allows the
P GW to route corresponding user plane PDUs between the S GW and the packet
data network, and to start charging, and the updated former entry allows the
P-GW to route corresponding user plane PDUs between non-3GPP access and the
PDN.
Editor\'s note: It is FFS how the PDG GW will route down link packet with the
2 tunnels.
The PDN GW returns a Create Default Bearer Response message to the S-GW.
When the MAPIM Indication is present, the PDN GW does not allocate a new IP
address to the UE, it will set the PDN address to the one that is allocated to
the UE in the non-3GPP access network in the Create Default Bearer Response.
The details of this step can be referred to TS 23.401 [8], clause 5.3.2.
8\. The Serving GW returns a Create Default Bearer Response message to the new
MME. The details of this step can be referred to TS 23.401 [8], clause 5.3.2.
9\. This step can be referred to Steps 17-26 of E-UTRAN Initial Attach as
defined in TS 23.401 [8], clause 5.3.2.
10\. Based on the IP-CAN session modification, the PCRF may provision to the
BBERF in the non 3GPP access with modified QoS rules. This is done by a GW
control session and QoS rules provision procedure as specified in TS 23.203
[7].
Editor\'s note: It is FFS whether the IP flows can be moved to the 3GPP access
during the above procedure.
##### 7.2.2.2.4 Additional access to the PDN connection with PMIP-based S5 or
S8
The clause is to describe the additional access to the PDN connection from
3GPP access network when the UE has attached to the same PDN via a certain
non-3GPP access network. As a result the UE is simultaneously connected via
both accesses, a set of IP flows are routed through one access while the
remaining IP flows are routed through the other access. The S5/S8 interface in
the EPC is PMIP-based.
The call flow is based on the clause 7.2.2.2.2, and the changes are shown in
this clause.
Non-roaming, home routed roaming and Local Breakout cases are supported by
this procedure. The AAA proxy and vPCRF are only used in the case of home
routed roaming and Local Breakout. In non-roaming scenarios, the AAA proxy and
vPCRF are not involved.
Figure 7.2.2.2.4-1: Additional access to the PDN connection with PMIP-based S5
or S8
1\. The Serving GW initiates the Gateway Control Session Establishment
Procedure with the PCRF, as specified in TS 23.203 [7]. The S‑GW provides the
information to the PCRF to correctly associate it with the IP‑CAN session to
be established in step 6.
2\. The Serving GW creates a new entry in its EPS Bearer table and sends a PBU
(Protocol Configuration Options) message to the PDN GW. The details of this
step can be referred to TS 23.402 [2], clause 5.2.
3\. The P-GW sends an IP-CAN session modification request to the PCRF. In this
request, the PDN GW shall include the information of access network.
Editor\'s note: What is the information of access network is FFS.
4\. Because the P-GW has received the MAPIM indicator from the PCO , the P‑GW
creates a BCE and update the former binding information with the non-3GPP
access network. The new binding entry allows the P‑GW to route corresponding
user plane PDUs between the S‑GW and the packet data network, and to start
charging, and the updated former binding entry allows the P-GW to route
corresponding user plane PDUs between non-3GPP access and the PDN.
Editor\'s note: It is FFS how the PDG GW will route down link packet with the
2 tunnels.
The PDN GW returns a PBA message to the Serving GW.
When the MAPIM Indication is present, the PDN GW does not allocate a new IP
address to the UE, it will set the PDN address to the one that is allocated to
the UE in the non-3GPP access network in PBA.
The details of this step can be referred to TS 23.402 [2], clause 5.2.
5\. In case the QoS rules have changed, the PCRF updates the QoS rules at the
S-GW by initiating the GW Control Session Modification Procedure, as specified
in TS 23.203 [7].
Editor\'s note: It is FFS whether the IP flows can be moved to the 3GPP access
during the above procedure.
##### 7.2.2.2.5 Additional access to the PDN connection from Trusted non-3GPP
access network with PMIP-based S2a
The clause is to describe the Additional access to the PDN connection from
Trusted non-3GPP access network as a second access network when the UE has
attached to the same PDN via 3GPP access network. As a result the UE is
simultaneously connected via both accesses and a set of IP flows are routed
through one access while the remaining IP flows are routed through the other
access. The S5/S8 interface in the EPC is PMIP-based and the S2a is PMIP-
based.
The call flow is based on the \"Initial Attach Procedure with PMIPv6 on S2a
and Anchoring in PDN GW\" procedure in TS 23.402 [2], clause 6.2.1, and the
changes and enhancements are shown in this clause.
Non-roaming, home routed roaming and Local Breakout cases are supported by
this procedure. The AAA proxy and vPCRF are only used in the case of home
routed roaming and Local Breakout. In non-roaming scenarios, the AAA proxy and
vPCRF are not involved.
Figure 7.2.2.2.5-1: Additional access to the PDN connection from Trusted
non-3GPP access network with PMIP-based S2a
1\. Refer to TS 23.402 [2], clause 5.2.
2\. The initial Non-3GPP access specific L2 procedures are performed. These
procedures are Non-3GPP access specific and are outside the scope of 3GPP.
Editor\'s note: It is FFS whether a new attach type value needs to be defined.
3\. The EAP authentication procedure is initiated and performed involving the
UE, Trusted Non-3GPP IP Access and the 3GPP AAA Server. The details of this
step can be referred to TS 23.402 [2], clause 6.2.1.
4\. After successful authentication and authorization, the non-3GPP access
specific L3 attach procedure is triggered. And the parameter PCO containing
the MAPIM indicator sent to P-GW is transported in these messages. PCO here
contains a MAPIM indicator, which is used to inform that the P-GW should
establish new PMIP tunnel with non-3GPP access GW while maintaining the
previous tunnel with S-GW.
5\. The Serving GW initiates the Gateway Control Session Establishment
Procedure with the PCRF, as specified in TS 23.203 [7]. The S‑GW provides the
information to the PCRF to correctly associate it with the IP‑CAN session to
be established in step 6.
6\. The MAG function of Trusted Non-3GPP IP Access sends a Proxy Binding
Update (PCO) message to PDN GW.
7\. The P-GW sends an IP-CAN session modification request to the PCRF. In this
request, the PDN GW shall include the information of access network.
Editor\'s note: What is the information of access network is FFS.
8\. Because the P-GW has received the MAPIM indicator from the PCO, so The
P-GW creates a new PMIP tunnel with the non-3GPP access GW while update the
former binding information with the 3GPP access network. The new tunnel allows
the P-GW to route corresponding user plane PDUs between the non-3GPP access GW
and the packet data network, and the updated former entry allows the P-GW to
route corresponding between the user plane PDUs non-3GPP access and the PDN.
Editor\'s note: It is FFS how the PDG GW will route down link packet with the
2 tunnels.
The PDN GW returns a PBA message to the Serving GW.
When the MAPIM Indication is present, the PDN GW does not allocate a new IP
address to the UE, it will set the PDN address to the one that is allocated to
the UE in the non-3GPP access network in the PBA.
The details of this step can be referred to TS 23.402 [2], clause 6.2.1.
9\. In case the QoS rules have changed, the PCRF updates the QoS rules at the
S-GW by initiating the GW Control Session Modification Procedure, as specified
in TS 23.203 [7].
10\. L3 attach procedure is completed via non-3GPP access specific trigger. IP
connectivity between the UE and the PDN GW is set for uplink and downlink
directions. At this step the IP address information is provided to the UE.
11\. Based on the IP-CAN session modification, the PCRF may provision to the
BBERF in the S-GW with modified QoS rules. This is done by a GW control
session and QoS rules provision procedure as specified in TS 23.203 [7].
Editor\'s note: It is FFS whether the IP flows can be moved to the trusted non
3GPP access network during the above procedure.
#### 7.2.2.3 UE initiated IP flow mobility
##### 7.2.2.3.1 General
This section is related to the case that the UE initiates IP flow mobility
from one access to another when the UE is simultaneously connected to the same
PDN via two access networks. And this section includes the scenario of S2a for
non-3GPP access and GTP-based S5/S8 and PMIP-based S5/S8 for 3GPP access.
Editor\'s note: This solution assumes that the packet filters provided via
access specific bearer modification procedures are not used only for bearer
selection but are also used to populate the IP stack routing table of the UE
and to perform routing decision between different interfaces. The impacts of
this assumption to the UE implementation are FFS. In this scenario, one or
more IP flows are moved from one access to another access.
Here lists three scenarios for the IP Flow mobility:
**Scenario 1:** IP flow mobility from trusted non-3GPP access with PMIP based
S2a to 3GPP access with GTP based S5/S8.
**Scenario 2:** IP flow mobility from trusted non-3GPP access with PMIP based
S2a to 3GPP access with PMIP based S5/S8.
**Scenario 3:** IP flow mobility from 3GPP access with GTP or PMIP based S5/S8
to non-3GPP access with PMIP based S2a.
##### 7.2.2.3.2 IP flow mobility from trusted non-3GPP access with PMIP based
S2a to 3GPP access with GTP based S5/S8
For this scenario, firstly, the UE initiates the dedicated bearer request
procedure for the IP flows that need to be moved in the 3GPP access network,
after the dedicated bearer is established/modified, the hPCRF will initiate
the dedicated bearer deactivation/modification procedure in the non-3GPP
access network.
Figure 7.2.2.3.2-1: IP flow mobility from trusted non-3GPP access with PMIP
based S2a to 3GPP access with GTP based S5/S8
1\. The UE is simultaneously connected to the same PDN via both a 3GPP and a
non-3GPP access network. The UE is exchanging some IP flows through the 3GPP
access and some other IP flows through the non-3GPP access.
2\. The UE decides to move some IP flows from non-3GPP access to 3GPP access.
The UE sends a Request Bearer Resource Modification to the MME and then MME
sends the same message to S-GW to request the dedicated bearer allocation to
move the IP flow(s) from non-3GPP access network to 3GPP access.
3\. The S-GW sends Request Bearer Resource Modification to the P-GW.
4\. The PDN GW interacts with PCRF using IP-CAN session modification procedure
to trigger the appropriate PCC decision. The PCRF checks whether the service
requested by UE exists in the non-3GPP access or not. If the service requested
by UE exists in the non-3GPP access, and the PCRF allows the movement of this
service from non-3GPP access to 3GPP access, then the PCRF triggers dedicated
bearer activation/modification in 3GPP access and the dedicated bearer
deactivation/modification in non-3GPP access (the dedicated bearer
deactivation /modification can be executed after step 8) . If the service
requested by UE does not exist in the non-3GPP access, the PCRF will treat
this requested service as a new service and initiates the dedicated bearer
activation/modification procedure in 3GPP access network only in the 3GPP
access network.
5\. The P-GW sends Create Dedicated Bearer Request to the S-GW to trigger the
3GPP access network to allocate the resource for the new service.
6\. Dedicated Bearer Activation Procedure is initiated, which can be referred
to Steps 3-10 of TS 23.401 [8], clause 5.4.1. During the dedicated bearer
activation/modification procedure, the UE is informed which bearer will be
used to transport the uplink IP flow(s) that has(have) been moved to the 3GPP
access.
Editor\'s note: It is FFS how this procedure is performed in case the packet
filters in the default bearer needs to be modified. In particular it is FFS
how additional packet filters are removed when a match-all packet filter is
present.
7\. The Serving GW acknowledges the bearer activation to the PDN GW by sending
a Create Dedicated Bearer Response message.
8\. The PDN GW indicates to the PCRF whether the requested PCC decision (QoS
policy) could be enforced or not, allowing the completion of IP‑CAN Session
Modification procedure.
9\. The PCRF sends a Gateway Control and QoS Rules Provision to the non-3GPP
access network to trigger the dedicated bearer deactivation/modification for
the service that has been moved to 3GPP access.
10\. A dedicated bearer deactivation/modification procedure is triggered by
the enforcement of the received policy rules, which can be referred to TS
23.402 [2], clause 6.6.1.
Editor\'s note: It is FFS how this procedure is performed in case the packet
filters in the default bearer needs to be modified. In particular it is FFS
how additional packet filters are removed when a match-all packet filter is
present.
11\. The non-3GPP‑GW indicates to the PCRF whether the requested QoS Rules
Provision could be enforced or not and thus completing the GW Control and QoS
Rules Provision procedure started in step 9. Optionally, if all the services
has been moved away or deleted in the non-3GPP access network, the non-3GPP
access of the PDN connection will be removed after this step.
##### 7.2.2.3.3 IP flow mobility from trusted non-3GPP access with PMIP based
S2a to 3GPP access with PMIP based S5/S8
For this scenario, firstly, the UE initiates the dedicated bearer request
procedure for the IP flows that need to be moved in the 3GPP access network,
after the dedicated bearer is established/modified, the hPCRF will initiate
the dedicated bearer deactivation/modification procedure in the non-3GPP
access network.
Figure 7.2.2.3.3-1: IP flow mobility from trusted non-3GPP access with PMIP
based S2a to 3GPP access with PMIP based S5/S8
A.1 The Serving GW initiates the Gateway Control and QoS Rules Request
Procedure as specified in TS 23.203 [7]. The PCRF checks whether the service
requested by UE exists in the non-3GPP access or not. If the service requested
by UE exists in the non-3GPP access, and the PCRF allows the movement of this
service from non-3GPP access to 3GPP access, then the PCRF triggers dedicated
bearer activation/modification in 3GPP access and the dedicated bearer
deactivation/modification in non-3GPP access (the dedicated bearer
deactivation/modification can be executed after step B.1). If the service
requested by UE does not exist in the non-3GPP access, the PCRF will treat
this requested service as a new service and initiates the dedicated bearer
activation/modification procedure only in the 3GPP access network..
B.1 The Serving GW indicates to the PCRF whether the requested QoS Rules
Provision could be enforced or not thus completing the GW Control and QoS
Rules Provision procedure started in step A.1.
B.2 The PCRF initiates the PCC Rules Provision Procedure as specified in TS
23.203 [7]. The PCRF provides updated PCC rules to the PCEF for enforcement by
means of an PCC Rules Provision procedure specified in TS 23.203 [7].
##### 7.2.2.3.4 IP flow mobility from 3GPP access with GTP or PMIP based S5/S8
to non-3GPP access with PMIP based S2a
For this scenario, firstly, the UE initiates the dedicated bearer request
procedure for the IP flows that need to be moved in the non-3GPP access
network, after the dedicated bearer is established/modified, the hPCRF will
initiate the dedicated bearer deactivation/modification procedure in the
non-3GPP access network.
Figure 7.2.2.3.4-1: IP flow mobility from 3GPP access with GTP or PMIP based
S5/S8 to non-3GPP access with PMIP based S2a
1\. The UE is simultaneously connected to the same PDN via both a 3GPP and a
non-3GPP access network. The UE is exchanging some IP flows through the 3GPP
access and some other IP flows through the non-3GPP access.
2\. The UE decides to move some IP flows from 3GPP access to non-3GPP access,
and optionally decides to deactivate some IP flows from the 3GPP system. The
UE initiates the non-3GPP specific Bearer Resource Modification procedure to
move the IP flow(s) from 3GPP access network to non-3GPP access.
3\. The non-3GPP‑GW initiates the Gateway Control and QoS Rules Request
Procedure as specified in TS 23.203 [7]. The PCRF checks whether the service
requested by UE exists in the 3GPP access or not. If the service requested by
UE exists in the 3GPP access, and the PCRF allows the movement of this service
from 3GPP access to non-3GPP access, then the PCRF triggers dedicated bearer
activation/modification in non-3GPP access and the dedicated bearer
deactivation/modification in 3GPP access. If the service requested by UE does
not exist in the 3GPP access, the PCRF will treat this requested service as a
new service and initiates the dedicated bearer activation/modification
procedure only in the non-3GPP access network.
4\. Dedicated Resource Request Procedure can be referred to Network-initiated
dynamic policy control procedure in Trusted Non-3GPP IP Access for S2a in
clause 6.6.1, TS 23.402 [2].
During the dedicated bearer activation/modification procedure, the UE is
informed which bearer will be used to transport the uplink IP flow(s) that
has(have) been moved to the non-3GPP access.
Editor\'s note: It is FFS how this procedure is performed in case the packet
filters in the default bearer needs to be modified. In particular it is FFS
how additional packet filters are removed when a match-all packet filter is
present.
Steps 5-7 describe the dedicated bearer deactivation/modification procedures
for the scenario of PMIP based S5/S8 in 3GPP access network, for the GTP based
S5/S8, the procedure can refer to clauses 5.4.2.1 and 5.4.3 in TS 23.401 [8].
5\. The PCRF sends a Gateway Control and QoS Rules Provision to S-GW to
trigger the dedicated bearer deactivation/modification for the service that
moved to non-3GPP access.
6\. Dedicated Bearer deactivation/modification Procedure are described in TS
23.402 [2], clauses 5.4.4 and 5.4.4.
Editor\'s note: It is FFS how this procedure is performed in case the packet
filters in the default bearer needs to be modified. In particular it is FFS
how additional packet filters are removed when a match-all packet filter is
present.
7\. The S-GW indicates to the PCRF whether the requested QoS Rules Provision
could be enforced or not and thus completing the GW Control and QoS Rules
Provision procedure started in step 5.
Optionally, if all the services has been moved away or deleted in the 3GPP
access network, the 3GPP access of the PDN connection will be removed after
this step which can be referred to TS 23.402 [2], clause 5.6.2.1
#### 7.2.2.4 UE initiated Removal of one access from the PDN connection
##### 7.2.2.4.1 General
This clause is related to the case that the multiple access is removed from
one access network when the UE is simultaneously connected to the same PDN via
more than one access network.
In this scenario, for some reasons, e.g. loss of coverage, or the UE\'s
battery is in low power, UE will not be able to connect to the P-GW via
multiple accesses and should terminate one access, the UE will remove one
access from the PDN connection. Certainly, if the UE has some services and
does not want to abandon the services in that access, the UE will initiate the
IP flow mobility procedures which can be referred to clause 7.2.2.3 firstly,
then UE will operate the procedure of removal of one access from the PDN
connection which is described in this clause.
##### 7.2.2.4.2 UE initiated Removal of 3GPP access from the PDN connection
(GTP-based)
In this scenario, the UE removes the 3GPP access and remains connected only to
the non-3GPP access.
Figure 7.2.2.4.2-1: UE initiated Multiple access Removal from 3GPP access
(GTP-based)
1\. The UE is simultaneously connected to the same PDN via both a 3GPP and a
non-3GPP access network. The UE is exchanging some IP flows through the 3GPP
access and some other IP flows through the non-3GPP access.
2\. The UE decides to remove the 3GPP access. The UE sends a Detach Request to
the MME and then MME sends the delete bearer request message to S-GW initiate
the removal of 3GPP access procedure.
3\. The S-GW sends delete bearer request to the P-GW to delete the GTP tunnel
with P-GW. The P-GW will find that there is still an access in non-3GPP access
network, so P-GW will only delete the GTP tunnel with S-GW and still remain
the binding with non-3GPP access, the IP address that is allocated to UE is
still valid.
4\. The PDN GW initiates the IP-CAN session modification procedure with PCRF.
The PDN GW shall include the information of access network.
Editor\'s note: What is the information of access network and how the Multi
Access is indicated to the PCRF is FFS.
5\. The PDN GW acknowledges with Delete Bearer Response.
6\. Detach Procedure can be referred to TS 23.401 [8], clause 5.3.8.2 Steps 3,
11-14.
7\. Because the PCRF has refreshed the PCC policy based on the event that UE
disconnects from 3GPP access, the PCRF sends a Gateway Control and QoS Rules
Provision to the non-3GPP access network to push the new PCC policy.
8\. Non-3GPP access enforces the new PCC policy.
The non-3GPP‑GW indicates to the PCRF whether the requested QoS Policy Rules
Provision could be enforced or not and thus completing the GW Control and QoS
Rules Provision procedure started in step 7
##### 7.2.2.4.3 UE initiated Removal of 3GPP access from the PDN connection
(PMIP-based)
In this scenario, the UE removes the 3GPP access and remains connected only to
the non-3GPP access.
Figure 7.2.2.4.3-1: UE initiated Multiple access Removal from 3GPP
access(PMIP-based)
A.1 The S-GW initiates the Gateway Control Session Termination Procedure as
specified in TS 23.203 [7].
A.2 The S-GW sends PBU with lifetime=0 to the P-GW to delete the PMIP binding
with P-GW. The P-GW will find that there is still an access in non-3GPP access
network, so P-GW will only delete the binding relationship with S-GW(MAG) and
still remain the binding with non-3GPP access, the IP address that is
allocated to UE is still valid.
A.3 The PDN GW initiates the IP-CAN session modification procedure with PCRF.
The PDN GW shall include the information of access network.
Editor\'s note: What is the information of access network and how the Multi
Access is indicated to the PCRF is FFS.
A.4 The PDN GW responds to the Serving GW with the result of the PDN
connection release with Proxy Binding Update Acknowledgement.
##### 7.2.2.4.4 UE initiated Removal of non-3GPP access from the PDN
connection (S2a PMIP-based)
In this scenario, the UE removes the non-3GPP access and remains connected
only to the 3GPP access.
Figure 7.2.2.4.4-1 UE initiated Multiple access Removal from non-3GPP
access(S2a PMIP-based)
1\. The UE is simultaneously connected to the same PDN via both a 3GPP and a
non-3GPP access network. The UE is exchanging some IP flows through the 3GPP
access and some other IP flows through the non-3GPP access.
2\. The UE decides to remove the non-3GPP access. The UE interacts with
non-3GPP access GW to initiate the removal procedure of non-3GPP access
network from the PDN connection.
3\. The BBERF in non-3GPP‑GW initiates the Gateway Control Session Termination
Procedure with PCRF as specified in TS 23.203 [7].
4\. The non-3GPP‑GW sends PBU with lifetime=0 to the P-GW to delete the PMIP
binding with P-GW. The P‑GW will find that there is still an access in 3GPP
access network, so P-GW will only delete the binding relationship with
non-3GPP MAG and still remain the binding with 3GPP access, the IP address
that is allocated to UE is still valid.
5\. The PDN GW interacts with PCRF to trigger the appropriate PCC decision.
The PDN GW shall include the information of access network.
Editor\'s note: What is the information of access network and how the Multi
Access is indicated to the PCRF is FFS.
6\. The PDN GW responds to the Serving GW with the result of the PDN
connection release with Proxy Binding Update Acknowledgement.
7\. Non-3GPP access network operates the specific Detach Procedure which is
out of this scope.
Steps 8-10 describe the policy enforcement procedures for the scenario of PMIP
based S5/S8 in 3GPP access network, for the GTP based S5/S8, the procedure can
refer to clause 5.4.3 in TS 23.401 [8].
8\. Because the PCRF has refreshed the PCC policy based on the event that UE
disconnects from non-3GPP access, the PCRF sends a Gateway Control and QoS
Rules Provision to the 3GPP access network to push the new PCC policy.
9\. 3GPP access enforces the new PCC policy.
10\. The S-GW indicates to the PCRF whether the requested QoS Rules Provision
could be enforced or not and thus completing the GW Control and QoS Rules
Provision procedure started in step 8.
#### 7.2.2.5 Network-initiated Dynamic PCC
##### 7.2.2.5.1 Network-initiated Dynamic PCC in non-3GPP access
If dynamic PCC is deployed, the procedure given in Figure 7.1.1.5.1.-1 is used
by the PCRF to provision rules to the Trusted non-3GPP IP access and for the
Trusted non-3GPP IP access to enforce the policy by controlling the resources
and configuration in the trusted non-3GPP access. The access specific
procedure executed in the trusted non-3GPP access is not within the scope of
this specification.
Figure 7.2.2.5.1-1: Network-initiated dynamic policy control procedure
This procedure concerns both the non-roaming and roaming case. In the roaming
case, the vPCRF in the VPLMN forwards messages between the Trusted Non-3GPP IP
Access and the hPCRF in the HPLMN. In the case of Local Breakout, the vPCRF
forwards messages sent between the PDN GW and the hPCRF. In the non-roaming
case, the vPCRF is not involved at all.
The optional interaction steps between the gateways and the PCRF in the
procedures only occur if dynamic policy provisioning is deployed. Otherwise
policy may be statically configured with the gateway.
1\. The UE is attached to the PDN GW via LTE access and trusted non-3GPP
access simultaneously.
2\. The PCRF receives the session information of new service, makes the policy
decision and determines the IP flow is transfer through trusted non-3GPP
access. The PCRF make this decision based on the characteristic of the
service, the characteristic of access networks the UE multi attaching and the
operator policy.
3\. The PCRF initiates the Gateway Control and QoS Rules Provision Procedure
specified in TS 23.203 [7] by sending a message with the QoS rules and Event
Trigger information to the Trusted non-3GPP access network.
4\. The Trusted Non-3GPP IP Access enforces the rules provisioned to it, and
establish all necessary resources and configuration in the non-3GPP access
system, for e.g. initiate a dedicated bearer activation, modification or
deactivation, if supported. The details of this step are out of the scope of
this specification.
Editor\'s note: It is FFS how this procedure is performed in case the packet
filters in the default bearer needs to be modified. In particular it is FFS
how additional packet filters are removed when a match-all packet filter is
present.
5\. The Trusted Non-3GPP IP Access responds to the PCRF indicating its ability
to enforce the rules provisioned to it in Step 1 and thus completing the GW
Control and QoS Rules Provision procedure started in step A.1.
6\. The PCRF initiates the PCC Rules Provision Procedure as specified in TS
23.203 [7]. The PCRF provides updated PCC rules to the PCEF for enforcement by
means of an PCC Rules Provision procedure specified in TS 23.203 [7]. In this
procedure PCRF shall indicates the PCC Rules are associated with Trusted
Non-3GPP Access.
NOTE: Step 6 may occur before step 3 or performed in parallel with steps 3 5
if acknowledgement of resource allocation is not required to update PCC rules
in PCEF. For details please refer to TS 23.203 [7].
##### 7.2.2.5.2 Network-initiated Dynamic PCC in 3GPP access
The procedure is similar to that in clause 7.1.1.5.1
## 7.3 IP flow mobility solutions for S2a (GTP)
Editor\'s note: The study of the GTP-based S2a support for trusted non-3GPP
access with seamless offload and flow mobility is deferred until the SaMOG
study is completed.
### 7.3.1 Issues and Design Considerations
### 7.3.2 Solution A: Control Plane signalling solution
The solution described here leverage control plane signalling to support UE-
initiated and Network-initiated NBIFOM mobility. The control plane signalling
transports the routing rules, coordinates the operation between the UE-
initiated and Network-initiated if both operations are initiated
simultaneously and resolves any conflicts, if necessary.
The key design aspects are:
A. Leveraging PCO to support NBIFOM capability discovery and negotiation
during the UE\'s initial attach.
B. Intermediate nodes (e.g. MME, SGW, SGSN, TWAG etc.) are enhanced to notify
PGW in a separate signalling IE for their support of NBIFOM irrespective the
UE requests NBIFOM feature during its initial attach.
C. Transporting routing rule in a separate bearer control procedure and not to
piggy back on the initial attach procedure for the case of MCM.
**Open Issue#1:** It is FFS to decide if routing rule can be included when
adding additional access. If no routing rules are signalled when adding an
access to a PDN Connection, it needs to be clarified if/how the UE and NW
agree on what access is the default access. In any case, the UE and NW may
exchange routing rules using a separate procedure immediately after addition
of an access.
D. The access can be added to a multi-access PDN connection without an
associated routing rule. The absence of routing rule on a given access (i.e.
3GPP or WLAN) does not imply the removal of such access for a multi-access PDN
connection.
In addition to the open issues above, the following are the additional open
issues that need to be addressed:
**Open Issue#3:** How should the routing rules be transported and represented?
i.e.
\- Should the routing rules as part of the PCC rules which are agnostic to the
access type? In other words, should the routing rules be specific to a given
access type (i.e. 3GPP vs. WiFi access)?
\- How much the routing rules concept from DSMIP IFOM can be applied to
NBIFOM?
\- How would the routing rules be transported over the Gx (i.e. should it be
logically separated from the PCC rules)?
\- Note that the terminology used in this solution description needs to be
aligned with the conclusion to this open issue.
**Open Issue#4:** In the case of SCM,
\- how should the routing rule be conveyed for network-initiated NBIFOM if EAP
is used, and how should the other side \"reject\" the routing rule?
\- how should the routing rule be updated when SCM is used and the 3GPP access
is not available, and if so how this is done
\- once the UE has successfully attached, what subsequent EAP message can be
used for the UE-initiated NBIFOM to provide the new routing rule?
**Open Issue#5:** It is FFS on the signalling procedures for the support of
the co-existence handling of UE-initiated and Network-initiated.
**Open Issue#6:** It is FFS on the co-existence support for network-initiated
IP flow mobility and ANDSF.
**Open Issue #7:** It is FFS how intra-3GPP access mobility to a target
MME/SGSN not supporting NBIFOM is handled, or whether it can be assumed that
all MME/SGSN support of NBIFOM. (Note that inter-TWAG mobility is not
supported as per eSaMOG solution in TS 23.402 [2]). If intra-3GPP access
mobility to a target MME/SGSN not supporting NBIFOM is supported, it is e.g.
FFS how the PDN GW discovers at an inter-MME or inter-SGSN mobility whether
the new serving node supports NBIFOM:
\- to send NBIFOM related indication to PCRF during IP-CAN Session
Modification procedure.
\- to receive Routing Rules from PCRF and send to Serving GW/TWAN via GTP
message.
#### 7.3.2.1 Overview
##### 7.3.2.1.1 General
A control plane signalling approach is used to support the Routing Rules
installation and navigate the IP flow mobility support.
##### 7.3.2.1.2 NBIFOM capability discovery/negotiation
During initial PDN connection establishment over first access, the UE includes
a NBIFOM capability indication in the PCO. If the network also supports
NBIFOM, the PGW confirms the NBIFOM support with the PCO. The intermediate
nodes (e.g. MME, SGSN, TWAG etc) indicate to PGW support for NBIFOM in Create
Session Request.
During PDN connection establishment over the additional access, the UE
indicates handover and NBIFOM in the PCO to the network.
##### 7.3.2.1.3 Routing rules considerations
A Routing Rule should contain the following parameters:
\- Routing Filter
\- Routing Access Type
\- Routing Rule Priority
\- Routing Rule identifier
A Routing Filter consists of IP header parameter values/ranges used to
identify one or more IP flows as defined in clause 3.1.
The Routing Access Type identifies the access network where the IP flow shall
be routed as defined in clause 3.1.
For the purpose of matching user traffic against routing rules, the filters
are applied in the order of the Routing Rule Priority.
The Routing Rule identifier uniquely identifies a Routing Rule for one PDN
Connection. The Routing Rule identifier is allocated by the entity creating
the routing rule, i.e. by the UE in UE-initiated NBIFOM mode and by the PGW in
NW-initiated NBIFOM mode.
It is assumed that between UE and the P-GW there is always a default routing
access type via which packets not matching any specific routing filter are
routed. The UE and the network can negotiate the default access during the
procedure of additional of one access to a PDN connection.
Note that the default access only applies to the multi-access PDN connection
when it is active over both 3GPP and WLAN access networks. When the
connectivity over one access is not active, the UE and the network shall
ignore the default access.
##### 7.3.2.1.4 Delivery of routing rules
The following principles are applied for routing rule delivery in this
solution:
\- In network-initiated NBIFOM, the PCRF triggers an update of a routing rule
by sending PCC rules to the PDN GW via an IP-CAN Session Modification
procedure. The PDN GW does not apply the new routing rules until the UE has
acknowledged them.
\- For NBIFOM mobility signalling via 3GPP access, the routing rules are sent
by the PDN GW to S-GW and the MME/SGSN via GTP-C/PMIP and further to the UE
via the 3GPP access specific signalling (i.e. NAS) procedure, the PDN GW
initiated bearer modification procedure (i.e. Attach Response, Activate
Default EPS Bearer Context etc.), as defined in TS 23.401 [8]. The same
mechanism is used by the PDN GW for NBIFOM mobility signalling via TWAN access
in SCM.
\- For NBIFOM mobility signalling via TWAN access in MCM, the routing rules
are sent by the PDN GW to the TWAG via S2a and then to the UE via WLCP
signalling over trusted TWAN as defined in TS 23.402 [2], clause 16. A new
WLCP procedure is defined to provide routing rules to the UE.
\- If the PDN GW receives a PCC rule update from the PCRF with access routing
information, and the corresponding PDN connection is routed over both 3GPP and
TWAN access in MCM, then the PDN GW sends the routing rules to the UE via the
access indicated in the PCC Rule.
\- In UE-initiated NBIFOM, the UE triggers an update of a routing rule and
sends this to the PDN GW. The UE does not apply these new routing rules until
the PDN GW has acknowledged them.
\- If the PDN connection is routed over both 3GPP and TWAN access in MCM, then
the UE sends the routing rules via the access contained in the routing rule
(the 3GPP or the TWAN access).
\- If the PDN connection is routed over both 3GPP and TWAN access in SCM, then
the UE sends the routing rules via the 3GPP access.
\- If updated routing rules result in that no IP flows left for a particular
access, the PDN GW should not release the PDN connection for that particular
access unless the PDN connection is explicitly torn down by the UE or by the
network as described in TS 23.261 [13], clause 5.5. The PDN GW may initiate
either a bearer modification or bearer release procedure.
##### 7.3.2.1.5 Co-existence of UE-initiated and Network-initiated handling
UE-initiated and Network-initiated modes are defined in clause 7.8.6 that also
describes the co-existence with ANDSF.
##### 7.3.2.1.6 PCC Interactions
Solutions for PCC aspects are captured in clause 7.7.3.
#### 7.3.2.2 System Impacts
##### 7.3.2.2.1 3GPP RAN
No impact on RAN.
##### 7.3.2.2.2 UE
UE is enhanced to indicate NBIFOM to the PDN GW in the PCO that the UE
supports NBIFOM and to receive indication in the PCO from the PDN GW that the
network supports NBIFOM during initial PDN connection establishment.
UE is enhanced to indicate handover and NBIFOM in the PCO when an access is
added for a PDN connection. The UE indicates only handover when the UE intends
to move the PDN connection to the target access.
The UE is enhanced to send and receive routing rules in 3GPP NAS over 3GPP
access and, if MCM is used, via WLCP signalling over TWAN. The UE sends and
receives routing rules in 3GPP NAS over 3GPP access also in case of SCM.
The UE is enhanced to route the IP flow(s) by referring also the routing
access type which is part of the routing rules.
For UE-initiated NBIFOM, if the PDN connection is routed over both 3GPP and
TWAN access in MCM, then the UE sends the routing rules via the access
indicated by the Routing Access Type in the routing rule. For example, the UE
would need to send separate messages in case it wants to provide routing rules
with different access types, one in each access.
UE supports both the UE-initiated and the NW-initiated IP flow mobility
procedures.
UE accepts or rejects NW-initiated IP flow mobility.
##### 7.3.2.2.3 MME
During the PDN connection establishment (over the first access and the
additional access), the MME provides an indication to the PGW for its support
for NBIFOM.
In addition, the MME is enhanced to forward the routing rules between the
network and the UE via NAS/GTP.
##### 7.3.2.2.4 S-GW
During the PDN connection establishment (over the first access and the
additional access), the Serving GW provides an indication to the PGW for its
support for NBIFOM.
Serving GW is modified to forward the routing rules between the network and
the UE.
The Serving GW forwards the Routing Rules between the PDN GW and the MME using
GTP message.
##### 7.3.2.2.5 TWAN
During the PDN connection establishment (over the first access and the
additional access) in the case of MCM, the TWAG indicates to the PGW that it
supports NBIFOM. In addition, the TWAN indicates if the PDN connection is
being established as SCM or if the UE is using MCM (as already supported in
stage 3).
TWAG is enhanced to receive and process a PDN connection establishment request
via WLCP to support with NBIFOM connectivity.
In the case of MCM support, the TWAG is enhanced to forward the routing rule
between the PDN GW and the UE via WCLP.
##### 7.3.2.2.6 P-GW
The PDN GW is modified to support:
\- the negotiation in PCO for the support of NBIFOM when the UE requests new
PDN connectivity over the first access and the additional access.
\- to support multi-access PDN connection.
\- to route the IP flow(s) by referring also the routing access type which is
part of the routing rules.
\- to send and receive routing rule updates over S5/S8 and S2a.
\- to receive an indication from the MME, SGW,SGSN or TWAG of whether they
support NBIFOM or not.
\- the ability, upon discovery that the serving MME or SGSN do not support
NBIFOM, to indicate to the UE that NBIFOM is not supported.
\- for network-initiated NBIFOM, when the PDN GW needs to create, delete, or
update Routing Rules based on PCC rules received from the PCRF, and the
corresponding multi-access PDN connection is routed over both 3GPP and TWAN
access in MCM based on the indication received at PDN establishment from the
TWAN, then the PDN GW sends the routing rules via the access indicated by the
Routing Access Type in the routing rule. For example, the PDN GW would need to
send separate messages in case it wants to provide routing rules with
different access types, one in each access. If the corresponding multi-access
PDN connection is routed over both 3GPP and TWAN access in SCM, then the PDN
GW sends the routing rules via the 3GPP access.
##### 7.3.2.2.7 SGSN
During the PDN connection establishment (over the first access and the
additional access,), the SGSN provides an indication to the PGW for its
support for NBIFOM.
For UE-initiated NBIFOM, the SGSN is also enhanced to transport routing rules
received from UE via NAS to the S-GW
For Network-initiated MCM support, the SGSN is enhanced to send routing rules
received from S-GW to the UE via NAS.
##### 7.3.2.2.8 PCC Enhancements
The PCC is enhanced with the following:
\- multiple IP-CAN types simultaneously associated with the same Gx session
and IP address for both TWAN and 3GPP access;
\- to extend the IP-CAN level Gx signalling to allow PCRF to send access type
routing information per SDF to the PDN GW;
\- for network-initiated NBIFOM, determine the desired access type routing
information for a flow and accordingly install / modify PCC rules to the PDN
GW;
\- for UE-initiated NBIFOM, enhance PCRF to receive update from PDN GW about
the current routing access type for each IP flow and accordingly install /
modify PCC rules;
\- PCRF to determine loss of access based on event triggers and act
accordingly.
NOTE: The terminology used in this solution description needs to be aligned
with the conclusion about PCC. More detailed solution alternatives for PCC
enhancements are captured in clause 7.7.
#### 7.3.2.3 Flows
##### 7.3.2.3.1 Initial PDN connection establishment over first access
##### 7.3.2.3.1.1 General {#general-6 .H6}
##### 7.3.2.3.1.2 PDN connection establishment over 3GPP access {#pdn-
connection-establishment-over-3gpp-access .H6}
Figure 7.3.2.3.1.2-1: PDN connection establishment over 3GPP access with GTP
based S5/S8
The UE performs the initial PDN connection establishment over EUTRAN access as
specified in TS 23.401 [8] clause 5.3.2.1 for Initial Attach, and the addition
of a new PDN connection as specified in TS 23.401 [8] clause 5.10.2 for UE
requested PDN connectivity, with the following additions:
\- The UE sends PDN Connectivity Request, including an NBIFOM indication in
the PCO
\- The MME and SGW notify PGW their support of NBIFOM
\- At the IP-CAN session establishment, the PDN GW informs the PCRF about the
UE and PDN GW IFOM capability and about the RAT type. The PCRF informs the PDN
GW about its IFOM capability.
\- If the PCRF, SGSN, SGW and the PDN GW support IFOM, then the PDN GW
indicates this in the PCO sent back to the UE.
The UE performs the initial PDN connection establishment over GERAN/UTRAN
access as specified in TS 23.060 [14] clause clause 9.2.2.1A (PDP context
activation using S4) and addition of a new PDN connection as specified in TS
23.060 [14] clause with the following additions:
\- The UE sends Activate PDP context Request, including an NBIFOM indication
in the PCO
\- The SGSN and S-GW inform the PDN GW their support of NBIFOM
\- At the IP-CAN session establishment, the PDN GW informs the PCRF about the
UE and PDN GW IFOM capability and about the RAT type. The PCRF informs the PDN
GW about its IFOM capability.
\- If the PCRF, SGSN, SGW and the PDN GW support IFOM, then the PDN GW
indicates this in the PCO sent back to the UE.
After successful establishment, the default access for this PDN connection is
the 3GPP access.
##### 7.3.2.3.1.3 PDN connection establishment over S2a {#pdn-connection-
establishment-over-s2a .H6}
This clause describes PDN connection establishment for SCM and MCM.
For SCM, a new PDN connection is established as described in TS 23.402 [2]
clause 16.2 for Initial Attach, with the following additions:
\- The UE negotiates single-connection mode during the EAP authentication
procedure and requests EPC access. The UE indicates NBIFOM in PCO.
\- At the IP-CAN session establishment, the PDN GW informs the PCRF about the
UE, TWAN and PDN GW support of NBIFOM capability and about the RAT type. The
PCRF informs the PDN GW about its NBIFOM capability.
\- If the PCRF, TWAN and the PDN GW support NBIFOM capability, then the PDN GW
indicates this in the PCO sent back to the UE.
Figure 7.3.2.3.1.3-1: PDN connection establishment procedure over TWAN access
for SCM
Figure 7.3.2.3.1.3-2: PDN connection establishment procedure over TWAN access
for MCM
For MCM, the UE attaches to TWAN using the procedure described in clause
16.2.1 of TS 23.402 [2] and negotiates for multi-connection mode. If multi-
connection mode is authorized by the network, the UE performs the procedure in
clause 16.8.1 of TS 23.402 [2] with the following additions:
\- The UE indicates NBIFOM in PCO in the WLCP PDN Connection Request to the
TWAN; the TWAN includes its NBIFOM support indication in the Create Session
Request/Proxy Binding Update to the PGW if the TWAN supports NBIFOM.
\- The PDN GW informs the PCRF about the UE, TWAN and PDN GW support of NBIFOM
capability and about the RAT type. The PCRF informs the PDN GW about whether
NBIFOM is supported within this PDN connection.
\- If the PCRF, TWAG and the PDN GW support NBIFOM, then the PDN GW indicates
this in the PCO that is sent back to the UE.
##### 7.3.2.3.2 Addition of one access to a PDN connection
##### 7.3.2.3.2.1 General {#general-7 .H6}
This clause specifies the additional procedures for adding an access to an
existing PDN connection over a 3GPP access or a TWAN access when the NBIFOM is
supported. In these flows it is assumed that the UE has performed a PDN
Connection establishment procedure through one access as specified in clause
7.3.2.3.1. Subsequently the UE attaches to a second access and starts using
both accesses for the same PDN connection. As a result the UE is
simultaneously connected via both accesses and a set of traffic flows are
routed through one access while the remaining traffic flows are routed through
the other access.
##### 7.3.2.3.2.2 Addition of an access using S2a {#addition-of-an-access-
using-s2a .H6}
The UE has established a PDN connection over a 3GPP access as described in
clause 7.3.2.3.1.2. In order to use the TWAN access for the same PDN
connection simultaneously, the UE now performs the procedure TS 23.402 [2]
clause 16.2 (Initial Attach) or TS 23.402 [2] clause 16.8 (UE Initiated PDN
connectivity request procedure in TWAN on S2a for Multi-connection Mode) with
the following additions:
\- The UE indicates handover and the same APN as for the PDN connection
established over the 3GPP access.
\- The UE also includes an NBIFOM indication in the PCO that procedure is for
addition of an access for the PDN connection. When the PGW receives this
indication, the PGW does not remove the bearers over 3GPP access for the
corresponding PDN connection. The same IP address is allocated for the PDN
connection as the one used in 3GPP access network
\- The TWAN selects the same PGW as the UE connects in 3GPP and indicates its
NBIFOM capability in the Create Session Request.
\- Instead of an IP-CAN Session Establishment procedure, the PDN GW performs
an IP-CAN Session Modification procedure. The PDN GW indicates to the PCRF of
addition of an access for the PDN connection and informs the PCRF about the
additional RAT type.
\- In UE-initiated mode, the UE cannot include routing rule(s) during the EAP
authentication procedure in single-connection mode. In multi-connection mode,
the UE can include the routing rule in the WLCP PDN Connection Request.
\- In network-initiated mode, the PCRF may indicate the default access to the
PDN GW. The PDN GW indicates the default access to the TWAG via S2a. The TWAG
indicates the new default access to the UE as part of the EAP authentication
procedure or in the WLCP PDN Connection Response.
\- If TWAN is the new default access, the PDN GW may perform one or more
bearer modification or bearer deactivation procedures on the 3GPP access.
\- In network-initiated NBIFOM mode, the network does not provide any routing
rules to the UE during this procedure. The reason is that there would be no
way for the UE to acknowledge the network-provided Routing Rules during the
addition of an access. Instead, Routing Rules need to be provided from the
network using a separate IP flow mobility procedure.
\- In UE-initiated NBIFOM mode, appropriate 3GPP resource release procedures
are executed for the resources associated with the flows that were moved away
from the 3GPP source access, based on the routing rules provided by the UE, as
specified in TS 23.402 [2].
##### 7.3.2.3.2.4 Addition of a 3GPP access {#addition-of-a-3gpp-access .H6}
The UE has established a PDN connection over TWAN as described in clause
7.3.2.3.1.3. Subsequently, the UE requests to establish a PDN connection using
the same APN on E-UTRAN, and attempts to use both accesses for the same PDN
connection simultaneously. The procedure is the same as specified in TS 23.401
[8] clause 5.3.2.1 or clause 5.10.2 with the following additions:
\- The UE indicates handover and NBIFOM indication for the same APN as for the
PDN connection established over the TWAN access.
\- The MME selects the same PDN GW as the UE connects in TWAN access network
and indicates its NBIFOM capability in the Create Session Request to the
Serving GW.
\- The Serving GW sends the Create Session Request to the PDN GW, including
its NBIFOM capability.
\- When the PDN GW receives handover and NBIFOM indication, the PDN GW does
not remove the bearers over the 3GPP access for the corresponding PDN
connection. The PDN GW initiates an IP-CAN Modification Procedure, notifies
the PCRF about the additional of TWAN access.
\- The same IP address is allocated for the PDN connection as the one used in
TWAN.
\- In UE-initiated mode, the UE may include Routing Rules and indicates the
default access to the PCRF via PDN GW during this procedure.
\- In network-initiated mode, the network does not provide any Routing Rules
to the UE during this procedure. The PCRF may indicate the default access to
the PDN GW. The PDN GW indicates the default access to the MME via SGW. The
MME indicates the default access to the UE in PDN Connectivity Accept message.
\- Appropriate 3GPP bearer setup or modification procedures are executed for
the resources associated with the flows that were moved onto the 3GPP access.
##### 7.3.2.3.3 IP flow mobility within a PDN connection
##### 7.3.2.3.3.1 General {#general-8 .H6}
##### 7.3.2.3.3.2 Network-initiated IP flow mobility with Routing Rules
signalled via 3GPP access {#network-initiated-ip-flow-mobility-with-routing-
rules-signalled-via-3gpp-access .H6}
In case of network-initiated IP flow mobility, the following procedures are
used for in multi-connection mode when target network is 3GPP access; they are
also used when the UE is connected over WLAN in single-connection mode.
In the following signalling flow, the PDN GW moves one or more IP flow(s) by
providing a Routing Rule with access type 3GPP. The routing rule is sent via
3GPP access in this case.
Figure 7.3.2.3.3.2.2-1: Network-initiated IP flow mobility within a PDN
connection via 3GPP access using GTP
1\. The UE is connected simultaneously to 3GPP and TWAN access and establishes
multiple IP flows of the same PDN connection.
2\. The PCRF provides some Routing Rule to the PDN GW during IP-CAN
modification procedure.
3\. The PDN GW decides to move one or more IP flows based on the received
Routing Rule. The PDN GW sends the Routing Rules within Create/ Update/Delete
Bearer Request to the MME via the Serving GW.
4\. The dedicated bearer activation or bearer modification or dedicated bearer
deactivation procedure between the MME and the UE is performed as described in
TS 23.401 [8]. The UE may accept or reject the Routing Rules. When the UE
rejects the Routing Rules, the UE provides a cause value indicating why the
request was rejected. This cause value may be used by the network to determine
when/if this IP flow mobility operation can be requested again. The UE applies
the accepted routing rules and acknowledges the applied rules in the message
sent to the MME.
5\. The MME sends Create/Update/Delete Bearer Response indicating the accepted
Routing Rules to the PDN GW via the Serving GW.
6\. The PDN GW indicates to the PCRF whether the Routing Rule could be
enforced or not. This corresponds to the completion of the PCEF-initiated
IP‑CAN session modification procedure as defined in TS 23.203 [7], proceeding
after the completion of IP‑CAN bearer signalling.
7\. Appropriate TWAN resource release/modification procedures are executed for
the resources associated with the flows that were removed in the TWAN access
as described in TS 23.402 [2].
##### 7.3.2.3.3.3 Network-initiated IP flow mobility with Routing Rules
signalled via trusted WLAN access {#network-initiated-ip-flow-mobility-with-
routing-rules-signalled-via-trusted-wlan-access .H6}
##### 7.3.2.3.3.3.1 Void {#void .H6}
##### 7.3.2.3.3.3.2 Multi-connection mode {#multi-connection-mode .H6}
In the following signalling flow, the PDN GW moves one or more IP flow(s) by
providing a Routing Rule with access type WLAN to update the routing rules via
GTP and WLCP procedures. The routing rule is sent via TWAN access in this
case.
Figure 7.3.2.3.3.3.2-1: Network-initiated IP flow mobility within a PDN
connection over TWAN access using GTP
1\. The UE is connected simultaneously to 3GPP and TWAN access and establishes
multiple IP flows of the same PDN connection.
2\. The PCRF may provide Routing Rules to the PDN GW during IP-CAN
modification procedure.
3\. The PDN GW decides to move one or more IP flows based on the received
Routing Policy. The PDN GW sends the Routing Rules within Create/Update/Delete
Bearer Request to the TWAN.
4\. The TWAN sends a new WLCP NBIFOM Request message to the UE, including the
Routing Rules.
5\. The UE may decide to accept or reject the Routing Rules. When the UE
rejects the Routing Rules the UE provides a cause value indicating why the
request was rejected. This cause value may be used by the network to determine
when/if this IP flow mobility operation can be requested again. The UE applies
the accepted routing rules and acknowledges the applied rules in a new WLCP
NBIFOM Response message to the TWAN.
6\. The TWAN sends Create/Update/Delete Bearer Response to the PDN GW.
7\. The PDN GW indicates to the PCRF whether the Routing Rules could be
enforced or not. This corresponds to the completion of the PCEF-initiated
IP‑CAN session modification procedure as defined in TS 23.203 [7], proceeding
after the completion of IP‑CAN bearer signalling.
8\. Appropriate 3GPP resource establishment/release/modification procedures
are executed for the resources associated with the flows that were
removed/added in the 3GPP access as described in TS 23.401 [8].
##### 7.3.2.3.3.4 UE-initiated IP flow mobility with Routing Rules signalled
via 3GPP access {#ue-initiated-ip-flow-mobility-with-routing-rules-signalled-
via-3gpp-access .H6}
In the following signalling flow, the UE moves one or more IP flow(s) by
providing a Routing Rule with access type 3GPP to update the routing rules via
NAS and GTPv2 procedures. The routing rule is sent via 3GPP access in this
case.
Figure 7.3.2.3.3.4.2-1: UE-initiated IP flow mobility within a PDN connection
using GTP
1\. The UE is connected simultaneously to 3GPP and non-3GPP accesses and
establishes multiple IP flows of the same PDN connection.
2\. The UE sends a Request Bearer Resource Modification message to the eNodeB,
which includes the Routing Rules requested by the UE.
3\. The eNodeB sends a Bearer Resource Command message to the MME, includes
the Routing Rules.
4-5.The MME forwards the Routing Rules to the PDN GW via the Serving GW.
6\. The PDN GW initiates an IP-CAN Modification procedure and provides the
Routing Rules to the PCRF. The PCRF may reject the IP flow mobility requests
from UE due to subscription limitations. When the network rejects an IP flow
mobility request, the network provides a certain cause value to the UE
indicating why the request was rejected. This cause value may be used by the
UE to determine when/if this IP flow mobility operation can be requested
again.
7\. The PDN GW performs the dedicated Bearer activation procedure or bearer
modification procedure as described in TS 23.401 [8], which acknowledge of the
Routing Rules.
8\. Appropriate TWAN resource release / modification procedures are executed
for the resources associated with the flows that were removed in the TWAN
access as described in TS 23.402 [2].
##### 7.3.2.3.3.5 UE-initiated IP flow mobility with Routing Rules signalled
via trusted WLAN access {#ue-initiated-ip-flow-mobility-with-routing-rules-
signalled-via-trusted-wlan-access .H6}
##### 7.3.2.3.3.5.1 Single-connection Mode {#single-connection-mode .H6}
In single-connection mode, the UE sends the routing rules over 3GPP access as
described in clause 7.3.2.3.3.4.
##### 7.3.2.3.3.5.2 Multi-connection Mode {#multi-connection-mode-1 .H6}
In the following signalling flow, the UE moves one or more IP flow(s) from
3GPP access to TWAN access by updating the routing rules via WLCP and GTPv2
procedures. The routing rule is sent via TWAN access in this case.
Figure 7.3.2.3.3.5.2-1: UE-initiated IP flow mobility within a PDN connection
from 3GPP access to TWAN access using GTP
1\. The UE is connected simultaneously to 3GPP and non-3GPP accesses and
establishes multiple IP flows of the same PDN connection.
2\. The UE sends a WLCP NBIFOM Request message to the TWAN, which includes the
Routing Rules requested by the UE.
3\. The TWAN sends a Bearer Resource Command message to the PDN GW. The
message includes the Routing Rules.
4\. The PDN GW initiates the IP-CAN Session Modification Procedure with the
PCRF. In this request, the PDN GW provides the Routing Rules to the PCRF. The
PCRF may reject the IP flow mobility requests from UE due to subscription
limitations. When the network rejects an IP flow mobility request, the network
provides a certain cause value to the UE indicating why the request was
rejected. This cause value may be used by the UE to determine when/if this IP
flow mobility operation can be requested again.
5\. The PDN GW sends to the TWAN an Update/Create Bearer Request which
acknowledge of the Routing Rules.
6\. The TWAN sends an Update/Create Bearer Response to the PDN GW.
7 The TWAN sends a WLCP Response to the UE which acknowledge of the Routing
Rules.
8\. A TWAN specific resource allocation/modification procedure may be executed
in this step. The details of this step are out of the scope of 3GPP.
9\. Appropriate 3GPP resource release / modification procedures are executed
for the resources associated with the flows that were removed in the 3GPP
access as described in TS 23.401 [8].
##### 7.3.2.3.3.6 UE Requested IP Flow Mapping via 3GPP access {#ue-requested-
ip-flow-mapping-via-3gpp-access .H6}
This procedure is only used in NW-initiated mode when the UE wants to request
the NW to apply a specific mapping of an IP flow to 3GPP access. The NW
provides Routing Rules to the UE for this IP flow unless the request from the
UE is not allowed by the subscription.
This procedure is similar to clause 7.3.2.3.3.4, with the following
differences:
\- The UE sends a Request Bearer Resource Modification message to the network,
which includes the mapping information of an IP flow to 3GPP access.
\- The PGW provides the requested mapping information to the PCRF during IP-
CAN Modification procedure.
\- The PCRF generates or modified PCC rule(s) for this IP flow according to
the mapping information, user subscription and operator policy and send the
PCC Rule(s) to the PGW.
\- The PGW sends corresponding Routing Rule to the UE.
##### 7.3.2.3.3.7 UE Requested IP Flow Mapping via WLAN access {#ue-requested-
ip-flow-mapping-via-wlan-access .H6}
##### 7.3.2.3.3.7.1 Single-connection Mode {#single-connection-mode-1 .H6}
Editor\'s note: It is FFS on how to support the mapping information and
routing rule transport in SCM. It depends on the conclusion of SCM solution.
##### 7.3.2.3.3.7.2 Multi-connection Mode {#multi-connection-mode-2 .H6}
This procedure is only used in NW-initiated mode when the UE wants to request
the NW to apply a specific mapping of an IP flow to TWAN access. The NW
provides Routing Rules to the UE for this IP flow.
This procedure is similar to 7.3.2.3.3.5.2, with the following differences:
\- The UE sends a WLCP Request Bearer Resource Modification message to the
network, which includes the mapping information of an IP flow to WLAN access.
\- The PGW provides the mapping information to the PCRF during IP-CAN
Modification procedure.
\- The PCRF generates or modifies PCC Rule(s) for this IP flow according to
the mapping information, user subscription and operator policy and send the
PCC Rule(s) to the PGW.
\- The PGW sends corresponding Routing Rule to the UE.
##### 7.3.2.3.4 Removal of an access from a PDN connection
##### 7.3.2.3.4.1 UE-initiated removal of 3GPP access from the PDN connection
{#ue-initiated-removal-of-3gpp-access-from-the-pdn-connection .H6}
When the UE disconnects from the 3GPP access and remains connected only to the
WLAN access, refer to TS 23.401 [8] clause 5.3.8.2.
NOTE: If the UE wants to keep the IP flows from an access to be detached from,
the procedure specified in clause 7.3.2.3.3.5 shall be performed before the UE
detaches from the old access.
##### 7.3.2.3.4.2 Network-initiated removal of 3GPP access from the PDN
connection {#network-initiated-removal-of-3gpp-access-from-the-pdn-connection
.H6}
Figure 7.3.2.3.4.2-1: Removal of 3GPP access from the PDN connection
1\. The UE is connected simultaneously to 3GPP and TWAN and establishes
multiple IP flows of the same PDN connection.
2\. MME initiates a release of the resources on 3GPP due to operator
intervention or other trigger (detach request from UE or radio link failure).
3\. MME sends a Delete Session Request to the SGW/PDN GW.
4\. PDN GW shall indicate to the PCRF the removal of 3GPP access, if the PCRF
has enabled this event trigger during the initial session establishment.
5\. PDN GW sends the Delete Session Response to the SGW/MME.
6\. MME performs EPS resource release procedures.
The optional interaction steps between the PGW and the PCRF in the procedures
only occur if dynamic policy provisioning is deployed in EPC.
##### 7.3.2.3.4.3 UE-initiated removal of WLAN access from the PDN connection
{#ue-initiated-removal-of-wlan-access-from-the-pdn-connection .H6}
When the UE disconnects from the WLAN access and remains connected only to the
3GPP access, refer to TS 23.402 [2] clause 7.4.3.
NOTE: If the UE wants to keep the IP flows from an access to be detached from,
the procedure specified in clause 7.3.2.3.3.4 shall be performed before the UE
detaches from the old access.
##### 7.3.2.3.4.4 Network-initiated removal of Trusted WLAN access from a PDN
Connection {#network-initiated-removal-of-trusted-wlan-access-from-a-pdn-
connection .H6}
When SCM is used and there is an established PDN connection over a 3GPP and
TWAN access simultaneously, then the UE or the TWAN may remove the TWAN access
from the PDN connection by the procedure in TS 23.402 [2] clause 16.3 (Detach
and PDN disconnection in TWAN on S2a).
When MCM is used, the UE may remove the TWAN access from a PDN Connection by
the procedure in TS 23.402 [2] clause 16.9 (UE/TWAN Initiated PDN
disconnection for Multi-connection Mode). When there is established PDN
connection(s) over a 3GPP and TWAN access using MCM simultaneously, then the
UE or the TWAN may remove the TWAN access from all PDN connection(s) by the
procedure in TS 23.402 [2] clause 16.7 (Detach in TWAN on S2a for Multi-
connection Mode).
Instead of performing the IP-CAN Session Termination procedure, the PDN GW
performs the IP-CAN Session Modification procedure indicating the RAT type
that is removed.
After removal of TWAN access, the 3GPP access becomes the default access for
this IFOM PDN connection.
The optional interaction steps between the gateways and the PCRF in the
procedures only occur if dynamic policy provisioning is deployed in EPC.
##### 7.3.2.3.5 An access of a PDN connection becomes unusable
##### 7.3.2.3.5.1 3GPP access of the PDN connection becomes unusable {#gpp-
access-of-the-pdn-connection-becomes-unusable .H6}
Editor\'s note: This procedure for SCM is FFS
When the UE detects that the 3GPP access becomes unusable, the UE shall report
this event to the network via WLAN access. The 3GPP access unusable procedure
is used when the UE determines that the 3GPP access is not usable anymore for
carrying the IP flows. The UE determines that the 3GPP link is not usable when
it detects loss of 3GPP coverage, or 3GPP radio quality preventing the usage
of this access based on UE implementation mechanism.
Figure 7.3.2.3.5.1-1: Procedure for 3GPP access becomes unusable for GTP S2a
1\. The UE is connected simultaneously to 3GPP and WLAN accesses and
establishes multiple IP flows of the same PDN connection.
2\. The UE detects that the 3GPP link is not usable.
3\. The UE sends the WLCP Request Bearer Resource Modification message
including a 3GPP unusable indication.
In UE-initiated mode, the UE may also include updated Routing Rules in the
WLCP Request Bearer Resource Modification message.
4\. The TWAN sends the indication to the PGW within a Bearer Resource Command.
In UE-initiated mode, the TWAN also forwards the updated Routing Rules to the
PGW if it receives any.
5\. When the PCRF has subscribed to such notification, thePGW sends the
indication to the PCRF. The PCRF may generate new Routing Rules later and
should not generate Routing Rules for 3GPP.
In NW-initiated mode, the PCRF may update the PCC rules, e.g. by changing the
Routing Access Type of PCC Rules and provide the updated PCC rules to the PGW.
The PCRF does not provide updated PCC rules for those IP flows which are
forbidden to be routed in the WLAN access.
In UE-initiated mode, the PGW also sends updated Routing Rules to the PCRF if
it receives any. The PCRF acknowledges the updated Routing Rules and may send
updated PCC rules to the PGW.
6\. The PGW moves all the IP flows from 3GPP to WLAN except those IP flows
which are forbidden to be routed via WLAN.
In NW-initiated mode, the PGW provides updated Routing Rules to the UE based
on the updated PCC rules received from PCRF.
In both UE-initiated and NW-initiated mode, the PGW may initiate dedicated
bearer activation and/or modification procedure in WLAN as described in TS
23.402 [2] according to if the IP flow shall be transported to new dedicated
bearer or to existing bearer. The PGW may release the resource in the 3GPP
access network for the IP flows which are moved to WLAN but does not release
the access from the multi-access PDN connection.
##### 7.3.2.3.5.2 TWAN access becomes unusable {#twan-access-becomes-unusable
.H6}
When the UE detects the TWAN access unusable, the UE shall report this event
to the network via 3GPP access. The TWAN access unusable procedure is used
when the UE determines that the TWAN access is not usable anymore for carrying
the IP flows. The UE determines that the TWAN link is not usable when it
detects loss of TWAN coverage, or TWAN radio quality preventing the usage of
this access based on UE implementation mechanism. The procedure is also used
in NW-initiated mode when the UE applies RAN-assisted WLAN interworking (i.e.
RAN Rules) and the RAN rule indicates that the UE shall move traffic from
WLAN.
Figure 7.3.2.3.5.2-1: Procedure for TWAN becomes unusable access for GTP S5/S8
1\. The UE is connected simultaneously to 3GPP and WLAN accesses and
establishes multiple IP flows of the same PDN connection.
2\. The UE detects that the WLAN link is not usable; Or the UE receives RAN
Rule indication \"move-traffic-from-WLAN\" from access stratum in NW-initiated
mode.
3\. The UE sends the Request Bearer Resource Modification message including a
WLAN unusable indication.
4-5. The MME sends the indication to the PGW via the SGW within a Bearer
Resource Command.
In UE-initiated mode, the MME also forwards the updated Routing Rules to the
PGW via the SGW if it receives any.
6\. When the PCRF has subscribed to such notification, the PGW sends the
indication to the PCRF. The PCRF may generate new Routing Rules later and
should not generate Routing Rules for WLAN.
In NW-initiated mode, the PCRF may update the PCC rules, e.g. by changing the
Routing Access Type of PCC Rules and provide the updated PCC rules to the PGW.
The PCRF does not provide updated PCC rules for those IP flows which are
forbidden to be routed in the 3GPP access.
In UE-initiated mode, the PGW also sends updated Routing Rules to the PCRF if
it receives any. The PCRF acknowledges the updated Routing Rules and may send
updated PCC rules to the PGW.
7\. The PGW moves all the IP flows from WLAN to 3GPP except those IP flows
which are forbidden to be routed via 3GPP.
In NW-initiated mode, the PGW provides updated Routing Rules to the UE based
on the updated PCC rules received from PCRF.
In both UE-initiated and NW-initiated mode, the PGW may initiate dedicated
bearer activation and/or modification procedure in 3GPP as described in TS
23.401 [8] according to if the IP flow shall be transported to new dedicated
bearer or to existing bearer. The PGW may release the resource in the WLAN
access network for the IP flows which are moved to 3GPP but does not release
the access from the multi-access PDN connection.
##### 7.3.2.3.6 An access for a PDN connection becomes usable
##### 7.3.2.3.6.1 3GPP access for the PDN connection becomes usable {#gpp-
access-for-the-pdn-connection-becomes-usable .H6}
When the UE detects that the 3GPP access becomes usable, the UE shall report
this event to the network via 3GPP access. The UE determines that the 3GPP
link is usable again when it detects recovery of 3GPP coverage, or 3GPP radio
quality allowing the usage of this access based on UE implementation
mechanism.
Figure 7.3.2.3.6.1-1: Procedure for 3GPP access becomes usable for GTP S5/S8
1\. The UE is connected simultaneously to 3GPP and WLAN accesses and the UE
has previously reported that the 3GPP access link is not usable for routing IP
flows.
2\. The UE detects that the 3GPP link becomes usable.
3\. The UE sends the Request Bearer Resource Modification message including a
3GPP usable indication.
In UE-initiated mode, the UE may also send updated Routing Rules to the
network.
4-5. The indication is sent to the PGW via the SGW within a Bearer Resource
Command.
In UE-initiated mode, the updated Routing Rules are also sent to the PGW.
6\. When the PCRF has subscribed to such notification, the PGW sends the
indication to the PCRF.
In NW-initiated mode, the PCRF updates the PCC rules, e.g. by changing the
Routing Access Type of PCC Rules and provides the updated PCC rules to the
PGW. The PCRF does not provide updated PCC rules for those IP flows which are
forbidden to be routed in the 3GPP access.
In UE-initiated mode, the updated Routing Rules are also sent to the PCRF. The
PCRF acknowledges the updated Routing Rules and sends updated PCC rules to the
PGW.
7\. In NW-initiated mode, the PGW provides updated Routing Rules to the UE
based on the updated PCC rules received from PCRF.
In both UE-initiated and NW-initiated mode, the PGW may initiate dedicated
bearer activation and/or modification procedure as described in TS 23.401 [8]
according to if the IP flow shall be transported to new dedicated bearer or to
existing bearer. In case IP flows are moved from WLAN access to 3GPP, the PGW
may release the resource in the WLAN access network but do not release the
access from the multi-access PDN connection.
##### 7.3.2.3.6.2 TWAN access for the PDN connection becomes usable {#twan-
access-for-the-pdn-connection-becomes-usable .H6}
Editor\'s note: This procedure for SCM is FFS.
When the UE detects that the TWAN access becomes usable, the UE shall report
this event to the network via WLAN access. The UE determines that the TWAN
link is usable again when it detects recovery of TWAN coverage, or TWAN radio
quality allowing the usage of this access based on UE implementation
mechanism. The procedure is also used in NW-initiated mode when the UE applies
RAN-assisted WLAN interworking (i.e. RAN Rules) and the RAN rule indicates
that the UE shall move traffic to WLAN.
Figure 7.3.2.3.6.2-1: Procedure for TWAN access becomes usable for GTP S2a
1\. The UE is connected simultaneously to 3GPP and TWAN accesses and has
previously reported that the 3GPP access link is not usable for routing IP
flows.
2\. The UE detects that the WLAN link is again usable for carrying IP flows.
Or the UE receives RAN Rule indication \"move-traffic-to-WLAN\" from access
stratum in NW-initiated mode.
3\. The UE sends the WLCP Request Bearer Resource Modification message
including a WLAN usable indication.
In UE-initiated mode, the UE may also include updated Routing Rules in the
Request Bearer Resource Modification message.
4\. The indication is sent to the PGW within a Bearer Resource Command.
In UE-initiated mode, the updated Routing Rules are also sent to the PGW.
5\. When the PCRF has subscribed to such notification, the PGW sends the
indication to the PCRF.
In NW-initiated mode, the PCRF updates the PCC rules, e.g. by changing the
Routing Access Type of PCC Rules and provides the updated PCC rules to the
PGW. The PCRF does not provide updated PCC rules for those IP flows which are
forbidden to be routed in the TWAN access.
In UE-initiated mode, the updated Routing Rules are also sent to the PCRF. The
PCRF acknowledges the updated Routing Rules and sends updated PCC rules to the
PGW.
6\. In NW-initiated mode, the PGW provides updated Routing Rules to the UE
based on the updated PCC rules received from PCRF.
In both UE-initiated and NW-initiated mode, the PGW may initiate dedicated
bearer activation and/or modification procedure as described in WLAN TS 23.402
[2] according to if the IP flow shall be transported to new dedicated bearer
or to existing bearer. In case IP flows are moved from 3GPP access to WLAN,
the PGW may release the resource in the 3GPP access network.
## 7.4 IP flow mobility solutions for S2b (PMIPv6)
### 7.4.1 Issues and Design Considerations
#### 7.4.1.1 Issues
### 7.4.2 Solution A: IP flow mobility routing rules negotiated via 3GPP
access specific signalling
#### 7.4.2.1 Overview
##### 7.4.2.1.1 General
This solution is based on the same principles of solution A for DSMIPv6 except
following considerations:
\- The routing rules are sent by the UE to the S-GW via the 3GPP access
specific signalling during the initial attach, UE requested PDN connectivity
and UE requested bearer resource modification procedure as defined in TS
23.401 [8].
Editor\'s note: The effect of the additional signalling traffic load in 3GPP
accesses is FFS.
\- The routing rules are sent from the S-GW to the P-GW via the GTP protocol
for the GTP-based S5/S8.
\- The routing rules are sent from the S-GW to PCRF and further to the P-GW
via PCC protocol for the PMIP-based S5/S8.
\- The NBIFOM support is negotiated during the initial attachment and UE
requested PDN connectivity procedures as defined in TS 23.401 [8].
**The proposed solution introduces no impact on the non-3GPP access network to
transport the routing rules between the UE and the EPC.**
Editor\'s note: Given the asymmetric nature of the signalling control over
3GPP access, how to deal with the 3GPP network congestion is FFS.
##### 7.4.2.1.2 Routing Rules
It is assumed that between UE and the P-GW there is always a default routing
access type via which packets not matching any specific routing filter are
routed. The UE provides a relative priority with each routing access type,
where the routing access type with the highest priority is the default route.
The UE may update the priority of a routing access type during IP flow
mobility procedures.
An example of a typical routing rule with routing filters is shown in Table
7.4.2.1.2-1.
Table 7.4.2.1.2-1: Routing rules
+----------+----------+----------+------+----------+----------+ | Routing | Routing | Routing | FID | FID | Routing | | Rule | Access | Access | | | Filter | | Name | Type | Type | | Priority | | | | | Priority | | | | +----------+----------+----------+------+----------+----------+ | Rule | 3GPP | x | FID1 | a | Des | | Name 1 | | | | | cription | | | | | | | of IP | | | | | | | flows... | +----------+----------+----------+------+----------+----------+ | Rule | 3GPP | x | FID2 | b | Des | | Name 2 | | | | | cription | | | | | | | of IP | | | | | | | flows... | +----------+----------+----------+------+----------+----------+ | Rule | WLAN | y | FID3 | c | Des | | Name 3 | | | | | cription | | | | | | | of IP | | | | | | | flows... | +----------+----------+----------+------+----------+----------+
NOTE: This clause above shows only a conceptual representation of the routing
rule. The format is FFS.
#### 7.4.2.2 System Impacts
##### 7.4.2.2.1 RAN
None.
##### 7.4.2.2.2 UE
UE is enhanced to send routing rules in NAS to be sent to the core network.
Editor\'s note: More study is needed to determine for which the NAS procedure
is impacted - e.g. moving the last IP Flow from one access to another could
result to detachment procedures rather than just the bearer resource
modification.
##### 7.4.2.2.3 MME
MME is enhanced to transport routing rules received from UE via NAS to the
S-GW.
##### 7.4.2.2.4 S-GW
The main foreseen change to support Network-based IP flow mobility is the
support for transporting routing rules sent from the MME to the P-GW.
##### 7.4.2.2.5 P-GW
The main foreseen changes to support Network-based IP flow mobility are:
\- the negotiation for the support of NBIFOM during the UE\'s initial attach
and during the UE requesting the PDN connectivity.
\- to keep both the GTP/PMIP tunnel with S-GW and PMIP tunnel with ePDG
simultaneously.
\- to route the IP flow(s) by referring also the routing access type which is
part of the routing rules.
##### 7.4.2.2.6 PCC Enhancements
The main foreseen changes to support Network-based IP flow mobility are:
\- to extend the IP-CAN level Gx signalling to indicate SDF specific routing
access type instead of IP-CAN session specific routing access type.
\- to enhance the PCRF with the logic to associate multiple Gxx sessions with
a single Gx session, based on the SDF specific routing access type exchanged
over Gx.
\- to enhance PCRF to receive update from PDN GW about the current routing
access type for each IP flows for the new and updated routing rules via Gx
signalling for the GTP-based S5/S8.
\- to enhance PCRF to receive update from S-GW about the current routing
access type for each IP flow for the new and updated routing rules via Gxx
signalling for the PMIP-based S5/S8.
Editor\'s note: It is expected that the above enhancements can be achieved by
re-using the PCC procedures defined for S2c-based IP flow mobility by
replacing routing address with routing access type.
#### 7.4.2.3 Flows
##### 7.4.2.3.1 PDN connection establishment over first access
##### 7.4.2.3.1.1 PDN connection establishment over 3GPP access {#pdn-
connection-establishment-over-3gpp-access-1 .H6}
The UE performs the initial PDN connection establishment to a 3GPP access as
shown in Figure 7.4.2.3.1.1-1 below. This procedure applies independently
whether the UE attaches to EPS or GPRS.
**Figure 7.4.2.3.1.1-1: PDN connection procedure over 3GPP access**
1\. The initial PDN establishment procedure is performed by the UE according
to TS 23.401 [8] or TS 23.060 [14], depending if the PDN connection
establishment is to EPS or GPRS, for the GTP-based S5/S8 or according to TS
23.402 [2] for the PMIP-based S5/S8. Additionally the UE includes the routing
rules in which the Routing Access type is set to \"3GPP access\" in the attach
request message. The eNodeB and MME forward the routing rules to the S-GW.
Then one of the two following scenario applies:
\- For the GTP-based S5/S8, the S-GW includes the routing rule in the Create
session request message to the P-GW. The P-GW installs the routing rules to
the PCRF and acknowledges the NBIFOM is enabled to the UE.
\- For the PMIP-based S5/S8, the S-GW includes the routing rules in the
Gateway Control Session establishment message and acknowledges the NBIFOM is
enabled to the UE. The PCRF then includes the routing rules in the IP-CAN
session establishment acknowledge message to install the routing rule in the
P-GW.
##### 7.4.2.3.1.2 PDN connection establishment over WLAN {#pdn-connection-
establishment-over-wlan .H6}
The UE performs the initial PDN connection establishment over WLAN which is
same as the procedure defined in clause 7.2.1 of TS 23.402 [2].
##### 7.4.2.3.2 Addition of one access
##### 7.4.2.3.2.1 Addition of WLAN access {#addition-of-wlan-access .H6}
After successfully attachment to 3GPP access, the UE has established a PDN
connection over 3GPP access as shown in Figure 7.4.2.3.1.1-1 above.
Subsequently the UE performs the WLAN attachment, and requests to establish a
PDN connection with the same APN, and attempts to use both accesses for the
same PDN connection simultaneously.
The UE realises such procedure by creating a virtual interface where a single
external IPv4 and/or IPv6 address is defined (appointed by the PDN-GW). On the
virtual interface, sub-interfaces can be defined based on the number of
accesses the UE is connected to. In this case the UE will have a sub-interface
for the WLAN and a sub-interface for 3GPP access. On the UE side applications
can bind sockets to a specific sub-interface which in effect binds the socket
to route the traffic via a particular access.
In the uplink direction, all IP packets are sent to the sub-interface based on
the routing access type contained on the routeing filter information.
In the downlink direction, the connection manager (i.e. virtual interface)
ensures that all IP packets are appended on the appropriate sub-interface
based on the access type where the IP packets were sent.
Figure 7.4.2.3.2.1-1: Addition of WLAN access to the PDN connection
1\. Initial attach with PMIP on S2b as defined in TS 23.402 [2], clause 7.2.1
is performed. Specifically, the UE shall include its address (IPv4 address or
IPv6 prefix /address or both), which was allocated during its attachment to
3GPP Access, into the CFG_Request sent to the ePDG during IKEv2 message
exchange to facilitate the ePDG to select the same PDN GW that is attached to
the UE over the 3GPP Access. Because NBIFOM is supported for the established
PDN connection over 3GPP access, the P-GW shall establish new PMIPv6 tunnel
with ePDG while maintaining the previous GTP/PMIPv6 tunnel with S-GW.
##### 7.4.2.3.2.2 Addition of 3GPP access {#addition-of-3gpp-access .H6}
After successfully attachment to Non-3GPP access, the UE has established a PDN
connection over Non-3GPP access as specified in clause 7.2.1 of TS 23.402 [2].
Subsequently the UE attaches to 3GPP access, and establishes a PDN connection
with the same APN. UE attempts to use both accesses for the same PDN
connection simultaneously.
Figure 7.4.2.3.2.2-1: Addition of 3GPP access to the PDN connection
1\. Step 1 of Figure 7.4.2.3.2.2-1 as shown in above clause is performed.
Specifically, the UE sets the Request Type to Handover to facilitate the MME
selects the same PDN GW as the UE connects in WLAN Access. If the P-GW has
been notified that the UE supports NBIFOM in this step, the P-GW shall
establish new GTP/PMIPv6 tunnel with S-GW while maintaining the previous PMIP
tunnel with ePDG.
##### 7.4.2.3.3 IP flow mobility
##### 7.4.2.3.3.1 General {#general-10 .H6}
In this scenario, an IP flow is moved from one access to another access.
Figure 7.4.2.3.3.2-1 and Figure 7.4.2.3.3.3-1 below describe the cases where
an IP flow is added to other access network. This can be either a new IP flow
or an IP flow which was formerly routed through one access.
##### 7.4.2.3.3.2 IP flow mobility(S5/S8-GTP) {#ip-flow-mobilitys5s8-gtp .H6}
Figure 7.4.2.3.3.2-1: IP Flow Mobility (S5/S8-GTP)
1\. The UE is simultaneously connected to a 3GPP and a non-3GPP access based
on the procedures described in Figure 7.4.2.3.2.1-1and Figure 7.4.2.3.2.2-1
above. The UE is exchanging some IP flows through the 3GPP access and some
other IP flows through the non-3GPP access.
2\. The UE sends a Request Bearer Resource Modification to MME including some
updated routing rules. UE can install a new routing rule or to modify the
routing access type of an existing routing rule to route the respective
traffic (identified by the included FID) through one particular access
(identified by the included BID) or to remove an existing routing rule. In
case of new routing rule with a new FID mobility option, the UE includes the
routing filter description.
3-4. MME sends Bearer Resource Command to PDN GW, forwarded by Serving GW,
including the updated routing rules.
5\. PDN GW sends IP-CAN Session Modification-begin to PCRF, including the
updated routing rules. The PCRF stores the updated routing rules. The PCRF
updates the PCC rule based on the updated routing rules and sends an
acknowledgement to the PDN GW, including updated PCC rules if appropriate.
6\. PDN GW implements Dedicated bearer activation as per Figure 5.4.1-1, from
step 2 to 11; or Bearer modification procedure as per Figure 5.4.2.1-1, from
step 2 to 11, or as per Figure 5.4.3-1, from step 2 to 9; or Dedicated bearer
deactivation procedure as per Figure 5.4.4.1-1, from step 2 to 9, in TS 23.401
[8].
7\. The PDN GW indicates to the PCRF whether the PCC decision could be
enforced or not.
##### 7.4.2.3.3.3 IP flow mobility(S5/S8-PMIP) {#ip-flow-mobilitys5s8-pmip
.H6}
Figure 7.4.2.3.3.3-1: IP Flow Mobility (S5/S8-PMIP)
1\. The UE is simultaneously connected to a 3GPP and a non-3GPP access based
on the procedures described in Figure 7.4.2.3.2.1-1and Figure 7.4.2.3.2.2-1
above. The UE is exchanging some IP flows through the 3GPP access and some
other IP flows through the non-3GPP access.
2\. The UE sends a Request Bearer Resource Modification to MME including some
updated routing rules. UE can install a new routing rule or to modify the
routing access type of an existing routing rule to route the respective
traffic (identified by the included FID) through one particular access
(identified by the included BID) or to remove an existing routing rule. In
case of new routing rule with a new FID mobility option, the UE includes the
routing filter description.
3\. MME sends Bearer Resource Command to Serving GW, including the updated
routing rules.
4\. Serving GW sends GW control session and QoS rules request as specified in
TS 23.203 [7] to PCRF, including the updated routing rules. The PCRF stores
the updated rules and makes a PCC decision based on routing rules. The PCRF
sends an acknowledgement to the S-GW, including the updated QoS rules if
needed.
5\. Either the Dedicated bearer activation/modification according to TS 23.401
[8], Figure 5.4.{1,2.1, 2.2, 3}-1 between Step A and B; or the Dedicated
bearer deactivation procedure as per Figure 5.4.4.1-1, from Step 3a to Step
8a, in TS 23.401 [8] is performed.
6\. The Serving GW indicates to the PCRF if the requested QoS Policy Rules
Provision could be enforced.
7\. The PCRF initiates the Policy and Charging Rules Provision Procedure as
specified in TS 23.203 [7] to update the PCC rules and routing rules in the
PDN GW.
a) 8-11．PDN GW updates the routing information in binding cache entry in ePDG
and S-GW for PMIP tunnel as specified in draft-ietf-netext-pmipv6-flowmob [9].
##### 7.4.2.3.4 Removal of one access
In this scenario, the UE moves all traffic from one access to another access
and detaches from the old access (e.g. due to loss of coverage or by an
explicit detach).
When the UE disconnects from the non-3GPP access and remains connected only to
the 3GPP access, refer to TS 23.402 [2] clause 7.4.1.
When the UE disconnects from the 3GPP access and remains connected only to the
non-3GPP access, refer to TS 23.401 [8] clause 5.3.8.2 or TS 23.402 [2] clause
5.3.
NOTE: If the UE wants to keep the IP flows from an access which is to be
detached, the procedure specified in Figure 7.4.2.3.3.2-1 or Figure
7.4.2.3.3.3-1 above shall be performed before the UE detaches from the old
access.
The optional interaction steps between the gateways and the PCRF in the
procedures only occur if dynamic policy provisioning is deployed in EPC.
##### 7.4.2.3.5 Addition of one access for multiple PDN connections to the
same APN
When a UE having multiple PDN connections to the same APN via one access
attaches to a second access, the UE needs to decide which of the multiple PDN
connections would use both accesses simultaneously.
When the UE having multiple PDN connections to the same APN via 3GPP access
attaches to the non-3GPP access, the UE shall perform IP flow mobility
procedures only for the PDN connections for which it will use IP flow
mobility.
When the UE having multiple PDN connections to the same APN via a non-3GPP
access attaches to the 3GPP access, the UE should only establish the PDN
connections for which it will use IP flow mobility. However, for the addition
of 3GPP access to the PDN connection case, due to the restriction that the UE
cannot indicate which PDN connection is to establish, the UE shall repeat UE
PDN Connectivity Request until the desired PDN connections have been
established and shall perform IP flow mobility procedures for the desired PDN
connections. For the addition of non-3GPP access to the PDN connection case,
UE can indicate the desired PDN connections by providing the IP address
allocated by the 3GPP access to the network.
### 7.4.3 Solution B: IP flow mobility routing rules negotiated in both WLAN
and 3GPP access
#### 7.4.3.1 Overview
##### 7.4.3.1.1 General
In this solution, routing rules are provided on both WLAN and 3GPP accesses.
For WLAN access, the routing rule is provided in the following way:
\- via IKEv2 procedure from the UE to the ePDG;
\- via PMIPv6 or GTP-c signalling from the ePDG to the PDN GW.
For 3GPP access, the routing rule is provided in the following way:
\- via 3GPP access specific signalling (e.g. Attach Request, Request Bearer
Resource Modification) from the UE to the MME and then over GTP-c to S-GW;
\- via PMIPv6 or GTP-c signalling from the S-GW to the PDN GW.
The solution is described assuming a PMIP based S2b as in case GTP based S2b
is used, the same concept is used as PMIP based S2b case and the main
difference is GTP is used over S2b to carry the routing rule to the PDN GW.
##### 7.4.3.1.2 Routing Rules
The routing rule is negotiated between the UE and the PDN GW. The PDN GW gets
the routing rule from the UE and generates the binding cache with the routing
address (i.e. MAG address) accordingly. The routing rule include, BID, BID
priority, FID, FID priority and Routing filter.
.If the routing rule is applied in WLAN access, after receiving from the UE
the IKE_AUTH request which includes the routing rule (e.g. using the
Configuration Payload), the ePDG send the routing rule in the PBU message to
the PDN GW. The routing filter is unidirectional and can be different for
uplink and downlink traffic. If the routing rule is applied in 3GPP access,
the routing rule is sent in NAS signalling from UE to the MME, and the MME
send this to the SGW/PGW.
When the PDN GW receives the PBU with the BID and FID mobility options, it
copies the BID and FID from the mobility option to the corresponding field in
the Binding Cache entry. An example of a typical Binding Cache in LMA (i.e.
PDN GW) with routing filters is shown in Table 7.4.3.1.2-1. Each BID/FID entry
contains a relative priority. It is assumed that between UE and the LMA there
is always a default routing address via which packets not matching any
specific routing filter are routed. The BID with the highest priority is the
default route.
Table 7.4.3.1.2-1: Binding Cache in LMA supporting flow bindings
* * *
Home Address Routing Address Binding ID BID Priority Flow ID FID Priority
Routing Filter HoA1 MAG Address1 BID1 x FID1 a Description of IP flows... FID2
b Description of IP flows... HoA1 MAG Address2 BID2 y FID3 ... ...
* * *
NOTE 1: This clause shows only a conceptual representation of the binding
cache. The actual format is implementation specific.
NOTE 2: BID and FID are only unique for a given PDN connection, i.e. different
mobile nodes can use the same BID or FID value.
If the IP flow mobility routing rule is to be applied in 3GPP access, it is
sent to the PDN GW via 3GPP access. If the IP flow mobility routing rule is be
applied in WLAN, it is sent to the PDN GW via WLAN access
Editor\'s note: Whether the BID is needed is FFS.
#### 7.4.3.2 System Impacts
Editor\'s note: To be completed.
#### 7.4.3.3 Flows
##### 7.4.3.3.1 PDN connection establishment over first access
##### 7.4.3.3.1.1 PDN connection establishment over 3GPP access {#pdn-
connection-establishment-over-3gpp-access-2 .H6}
The UE performs the initial PDN connection establishment over 3GPP access as
following flows which is specified in TS 23.402 [2] clause 5.2 with the
following additions:
Figure 7.4.3.3.1.1-1: Initial attach procedure
\- The UE includes the routing rule in the Attach Request. The packet filter
(TFT) can be used/extended to carry the routing filter. The MME forwards the
routing rule to the S-GW in the Create Session Request;
\- In step C.2, the S-GW sends the Proxy Binding Update message which includes
the routing rule to the PDN GW. The routing address for 3GPP access is the
S-GW IP address;
\- In step C.3. the PDN GW initiates the IP-CAN Session Establishment
Procedure with the PCRF. In this request, the PDN GW provides the routing
rules to the PCRF;
\- In step C.4, the PDN GW sends the Proxy Binding ACK message which includes
the accepted routing rule to the S-GW.
\- After step C, the S-GW sends the Create Session Response with the accepted
routing rule to the MME, and the MME forwards the accepted routing rule to the
UE in the Attach Accept.
##### 7.4.3.3.1.2 PDN connection establishment over WLAN {#pdn-connection-
establishment-over-wlan-1 .H6}
Figure 7.4.3.3.1.2-1: PDN connection establishment over WLAN access
1\. The UE discovers a WLAN, and may perform the authentication and
authorization procedure with 3GPP EPC via the WLAN access as specified in TS
23.402 [2] clause 7.2.1 step 1.
2\. IKEv2 authentication and tunnel setup procedure are performed via the WLAN
access between the UE, ePDG and 3GPP AAA Server/HSS as specified in TS 33.402
[11]. In addition, the UE sends in IKE_AUTH Request to the ePDG which include
routing rule .
3\. The ePDG sends a Proxy Binding Update message to the PDN GW as specified
in TS 23.402 [2]. In addition the PBU includes the routing rule.
4\. If dynamic PCC is supported, the PDN GW initiates the IP-CAN Session
Establishment Procedure with the PCRF. The PDN GW sends the routing rule to
the PCRF. The PCRF may modify the routing rules for the downlink and/or
uplink, and send the modified routing rule to the PDN GW.
5\. Step 5 is the same as step 5 of clause 7.2.1 in TS 23.402 [2].
6\. The PDN GW creates a PMIPv6 binding and installs the IP flow routing
rules. The PDN GW then sends a Proxy Binding Ack message to the ePDG as
specified in TS 23.402 [2]. In addition the PBA indicates which routing rules
requested by the UE are accepted by including the routing filter accepted by
the PDN GW.
7\. Step 7 is the same as step 7 of clause 7.2.1 in TS 23.402 [2].
8\. The ePDG sends to the UE the IKE_AUTH Response including the traffic
selector which carries the routing filter accepted by the PDN GW.
9\. IP connectivity from the UE to the PDN GW is now setup. Any packet in the
uplink direction complying with the traffic selector is tunnelled to the ePDG
by the UE using the IPSec tunnel. The ePDG then tunnels the packet to the PDN
GW. From the PDN GW normal IP-based routing takes place. In the downlink
direction, the packet for UE arrives at the PDN GW. The PDN GW tunnels the
packet to the ePDG based on the routing rule. The ePDG then tunnels the packet
to the UE via proper Ipsec tunnel.
##### 7.4.3.3.2 Addition of one access
##### 7.4.3.3.2.1 Addition of WLAN access {#addition-of-wlan-access-1 .H6}
The UE has successfully attached to 3GPP access and established a PDN
connection over 3GPP access using PMIPv6 as described in clause 7.4.3.3.1.1.
Subsequently the UE performs the WLAN attachment, and requests to establish a
PDN connection using the same APN, and attempts to use both accesses for the
same PDN connection simultaneously.
Figure 7.4.3.3.2.1-1: Addition of WLAN access to the PDN connection
The signalling flow above shows the particular case where the UE is first
connected to a 3GPP access and then it requests addition of a WLAN access.
1\. The UE discovers a WLAN, and may perform the authentication and
authorization procedure with 3GPP EPC via the WLAN access as specified in TS
23.402 [2] clause 7.2.1 step 1.
2\. IKEv2 authentication and tunnel setup procedure are performed via the WLAN
access between the UE, ePDG and 3GPP AAA Server/HSS as specified in TS 33.402
[11]. In addition, the UE sends in IKE_AUTH Request the routing rule, and PDN
connection indication which indicates the existing PDN connection to which the
IP flow(s) to be added, i.e. handover indication and/or UE home address (IPv4
Home address or IPv6 Home Network prefix) allocated when it is attached to
3GPP Access.
3\. The ePDG sends a Proxy Binding Update message to the PDN GW as specified
in TS 23.402 [2]. In addition the PBU includes the routing rule, i.e. the
routing filter derived from the traffic selector and the routing address. The
routing address is the link-local address of the ePDG to be allocated by the
PDN GW as specified in TS 29.275 [12].
4\. When the PDN GW receive routing rule from the ePDG, the PDN GW identify it
is a IFOM request, then the PDN GW will allocate the same IP address as that
for the PDN connection the UE has established over the 3GPP access and not
tear down the 3GPP bearers if there are still some routing filters for 3GPP
access works. If dynamic PCC is supported, the PDN GW initiates the IP-CAN
Session Modification Procedure with the PCRF. The PDN GW sends the routing
rule to the PCRF. The PCRF may modify the routing rules for the downlink
and/or uplink, and send the modified routing rule to the PDN GW.
5\. Step 5 is skipped since it is using an old PDN GW.
6\. The PDN GW processes the Proxy Binding Update and allocates to the UE the
same IP address as that for the PDN connection the UE has established over the
3GPP access. The PDN GW creates a PMIPv6 binding and installs the IP flow
routing rule. The PDN GW links the flow(s) established over WLAN access to the
(flow(s) of the same) PDN connection established over 3GPP access, i.e. using
the same binding cache entity, or creating a new binding cache entity and
linking these two bindings. The PDN GW then sends a Proxy Binding Ack message
to the ePDG as specified in TS 23.402 [2]. In addition the PBA indicates which
routing rules requested by the UE are accepted by including the routing filter
accepted by the PDN GW.
7\. Step 7 is the same as step 7 of clause 7.2.1 in TS 23.402 [2].
8\. The ePDG sends to the UE the IKE_AUTH Response including the traffic
selector which carries the routing filter accepted by the PDN GW.
9\. IP connectivity from the UE to the PDN GW is now setup. Any packet in the
uplink direction complying with the traffic selector is tunnelled to the ePDG
by the UE using the IPSec tunnel. The ePDG then tunnels the packet to the PDN
GW. From the PDN GW normal IP-based routing takes place. In the downlink
direction, the packet for UE arrives at the PDN GW. The PDN GW tunnels the
packet to the ePDG based on the routing rules. The ePDG then tunnels the
packet to the UE via proper Ipsec tunnel.
10\. Appropriate 3GPP resource release procedures are executed for the
resources associated with the flows that were moved away from the 3GPP source
access as specified in TS 23.402 [2].
##### 7.4.3.3.2.2 Addition of 3GPP access {#addition-of-3gpp-access-1 .H6}
After successfully attachment to WLAN access, the UE has established a PDN
connection over WLAN as described in clause 7.4.3.3.1.2.
Subsequently, the UE performs the initial attachment procedure over a 3GPP
access and establishes a PDN connection using the same APN. The procedure is
the same as specified in TS 23.402 [2] clause 5.2 with the following
additions:
\- The UE include the routing rule and UE home address (and/or HO indication)
in the Attach Request. The packet filter (TFT) can be used/extended to carry
the routing filter. The MME forwards the routing filter to the S-GW in the
Create Session Request;
\- In step C.2, the S-GW sends the Proxy Binding Update message which includes
the routing rule the PDN GW. The routing address for 3GPP access is the S-GW
IP address;
\- In step C.3. the PDN GW initiates the IP-CAN Session Establishment
Procedure with the PCRF. In this request, the PDN GW provides the routing
rules to the PCRF;
\- In step C.4, the PDN GW allocates to the UE the same IP address as that for
the PDN connection the UE has established over WLAN access. The PDN GW creates
a PMIPv6 binding and installs the IP flow routing rule. The PDN GW links the
flow(s) established over 3GPP access to the (flow(s) of the same) PDN
connection established over WLAN access, i.e. using the same binding cache
entity, or creating a new binding cache entity and linking these two bindings.
The PDN GW then sends the Proxy Binding ACK message which includes the
accepted routing rule to the S-GW;
\- After step C, the S-GW sends the Create Session Response with the accepted
routing rule to the MME, and the MME forwards the accepted routing rule to the
UE in the Attach Accept.
\- Appropriate 3GPP bearer setup or modification procedures are executed for
the resources associated with the flows that were moved onto the 3GPP access.
##### 7.4.3.3.3 IP flow mobility
##### 7.4.3.3.3.1 IP flow mobility within a PDN connection from 3GPP to WLAN
access {#ip-flow-mobility-within-a-pdn-connection-from-3gpp-to-wlan-access
.H6}
In the following signalling flow, the UE moves one or more IP flow(s) from
3GPP access to WLAN access by updating the routing rules via IKEv2 and PMIPv6
procedures. The routing rule is sent via WLAN access in this case.
Figure 7.4.3.3.3.1-1: IP flow mobility within a PDN connection initiated over
WLAN access
1\. The UE is connected simultaneously to 3GPP and non-3GPP accesses and
establishes multiple IP flows of the same PDN connection as described in
clauses 7.4.3.3.1 and 7.4.3.3.2.
2\. The UE sends to the ePDG the IKEv2 INFORMATIONAL request, which includes
the modified routing rule to indicate the updated routing rule requested by
the UE.
3\. Same as step 3 in Figure 7.4.3.3.2.1-1 with the difference that if the
ePDG supports multiple PDN connections to a single APN, the ePDG also includes
the PDN Connection ID based on the mapping between the Security Association
and the PDN connection, instead of allocating a new PDN Connection ID.
4\. Same as step 4 in Figure 7.4.3.3.2.1-1.
5\. Same as step 6 in Figure 7.4.3.3.2.1-1.
6\. The ePDG sends to the UE the IKEv2 INFORMATIONAL response which includes
the traffic selector which carries the routing filter accepted by the PDN GW.
7\. The non-3GPP specific resource modification may be performed based on the
modified traffic selector in non-3GPP access network, which can be initiated
by the UE.
8\. Appropriate 3GPP resource release/allocation procedures are executed for
the resources associated with the flows that were removed, modified or added
in the 3GPP access. The PDN GW or PCRF may initiates these procedures based on
the linking between the flows over non- 3GPP access and the flow(s) of the
same PDN connection over 3GPP access.
##### 7.4.3.3.3.2 IP flow mobility within PDN connection from WLAN access to
3GPP access {#ip-flow-mobility-within-pdn-connection-from-wlan-access-to-3gpp-
access .H6}
The UE can initiate moving one or more IP flow(s) from WLAN access to 3GPP
access as specified in TS 23.402 [2] clause 5.5 with the following additions,
in this case the routing rule is sent via 3GPP access:
\- The UE sends the modified routing rule in the Request Bearer Resource
Modification to the MME. The packet filter(s) with packet filter identifier(s)
and the changed packet filter information can be used/extended to indicate the
modified routing filter. The MME forwards the modified routing filter to the
S-GW in the Bearer Resource Command.
\- The S-GW sends the Proxy Binding Update message which includes the modified
routing rule (i.e. the modified routing filter and routing address) to the PDN
GW. The routing address for 3GPP access is the S-GW IP address;
\- The PDN GW initiates the IP-CAN Session Modification procedure and provides
the updated routing rules to the PCRF;
\- The PDN GW sends the Proxy Binding ACK message which includes the accepted
routing rule to the S-GW;
\- The S-GW sends the accepted routing rule to the UE via the MME using the
corresponding bearer modification procedure between step A and step B.
\- Appropriate 3GPP resource release/allocation procedures are executed for
the resources associated with the flows that were removed, modified or added
in the 3GPP access.
##### 7.4.3.3.4 Removal of one access
Editor\'s note: This procedure is FFS.
##### 7.4.3.3.5 Addition of one access for multiple PDN connections to the
same APN
When a UE having multiple PDN connections to the same APN via one access
attaches to a second access, the UE needs to decide which of the multiple PDN
connections the UE has would use both accesses simultaneously.
When the UE having multiple PDN connections to the same APN via a 3GPP access
attaches to a WLAN, the UE shall perform PMIPv6 procedures only for the PDN
connections for which it will use IP flow mobility.
When the UE having multiple PDN connections to the same APN via the WLAN
attaches to the 3GPP access, the UE should only establish the PDN connections
for which it will use IP flow mobility. However, due to the restriction that
the UE cannot indicate which PDN connection is to establish, the UE shall
repeat UE PDN Connectivity Request until the desired PDN connections have been
established and shall perform PMIPv6 procedures for the desired PDN
connections.
## 7.5 IP flow mobility solutions for S2b (GTP)
### 7.5.1 Issues and Design Considerations
### 7.5.2 Solution A: IP flow mobility routing rules negotiated via 3GPP
access specific signalling
#### 7.5.2.1 Overview
##### 7.5.2.1.1 General
Same as clause 7.4.2.1.1.
##### 7.5.2.1.2 Routing Rules
Same as clause 7.4.2.1.2.
#### 7.5.2.2 System Impacts
##### 7.5.2.2.1 RAN
Same as clause 7.4.2.2.1.
##### 7.5.2.2.2 UE
Same as clause 7.4.2.2.2.
##### 7.5.2.2.3 MME
Same as clause 7.4.2.2.3.
##### 7.5.2.2.4 S-GW
Same as clause 7.4.2.2.4.
##### 7.5.2.2.5 P-GW
Same as clause 7.4.2.2.5.
#### 7.5.2.3 Flows
##### 7.5.2.3.1 PDN connection establishment over first access
##### 7.5.2.3.1.1 PDN connection establishment over 3GPP access {#pdn-
connection-establishment-over-3gpp-access-3 .H6}
Same as clause 7.4.2.3.1.1.
##### 7.5.2.3.1.2 PDN connection establishment over WLAN {#pdn-connection-
establishment-over-wlan-2 .H6}
The UE performs the initial PDN connection establishment over WLAN which is
same as the procedure defined in clause 7.2.4 of TS 23.402 [2].
##### 7.5.2.3.2 Addition of one access
##### 7.5.2.3.2.1 Addition of WLAN access {#addition-of-wlan-access-2 .H6}
Refer to clause 7.4.2.3.2.1, the difference is that, GTP session is
established between ePDG and PDN GW.
Figure 7.5.2.3.2.1-1: Addition of WLAN access to the PDN connection
1\. Initial attach with GTP on S2b as defined in TS 23.402 [2], clause 7.2.4
is performed. Specifically, the UE shall include its address (IPv4 address or
IPv6 prefix /address or both), which was allocated during its attachment to
3GPP Access, into the CFG_Request sent to the ePDG during IKEv2 message
exchange to facilitate the ePDG to select the same PDN GW that is attached to
the UE over the 3GPP Access. Because NBIFOM is supported for the established
PDN connection over 3GPP access, the P-GW shall establish new GTP tunnel with
ePDG while maintaining the previous GTP/PMIPv6 tunnel with S-GW.
##### 7.5.2.3.2.2 Addition of 3GPP access {#addition-of-3gpp-access-2 .H6}
Refer to clause 7.4.2.3.2.2, the difference is that, GTP session is
established between ePDG and PDN GW.
##### 7.5.2.3.3 IP flow mobility
##### 7.5.2.3.3.1 General {#general-13 .H6}
In this scenario, an IP flow is moved from one access to another access. The
following clauses describe the cases where an IP flow is added to other access
network. This can be either a new IP flow or an IP flow which was formerly
routed through one access.
Editor\'s note: In the event when UE loses the 3GPP coverage, the decision for
which one of the two following approaches to recover is FFS.
> A. Non-seamless approach - UE to perform initial attach to non-3GPP access
> (i.e. no impact to existing protocol), or
>
> B. Seamless approach - Extending IKEv2 vendor specific option to support UE
> to signal the seamless handover with the routing rules info (i.e. require
> new IANA assignment for new code point).
##### 7.5.2.3.3.2 IP flow mobility(S5/S8-GTP) {#ip-flow-mobilitys5s8-gtp-1
.H6}
Figure 7.5.2.3.3.2-1: IP Flow Mobility (S5/S8-GTP)
1\. The UE is simultaneously connected to a 3GPP and a non-3GPP access based
on the procedures described in Figure 7.4.2.3.2.1-1and Figure 7.4.2.3.2.2-1
above. The UE is exchanging some IP flows through the 3GPP access and some
other IP flows through the non-3GPP access.
2\. The UE sends a Request Bearer Resource Modification to MME including some
updated routing rules. UE can install a new routing rule or to modify the
routing access type of an existing routing rule to route the respective
traffic (identified by the included FID) through one particular access
(identified by the included BID) or to remove an existing routing rule. In
case of new routing rule with a new FID mobility option, the UE includes the
routing filter description.
3-4. MME sends Bearer Resource Command to PDN GW, forwarded by Serving GW,
including the updated routing rules.
5\. PDN GW sends IP-CAN Session Modification-begin to PCRF, including the
updated routing rules. The PCRF stores the updated routing rules. The PCRF
updates the PCC rule based on the updated routing rules and sends an
acknowledgement to the PDN GW, including updated PCC rules if appropriate.
6\. PDN GW implements Dedicated bearer activation as per Figure 5.4.1-1, from
step 2 to 11; or Bearer modification procedure as per Figure 5.4.2.1-1, from
step 2 to 11, or as per Figure 5.4.3-1, from step 2 to 9; or Dedicated bearer
deactivation procedure as per Figure 5.4.4.1-1, from step 2 to 9, in TS 23.401
[8].
7\. PDN GW implements Dedicated S2b bearer activation as per Figure 7.10-1,
from step 2 to 3; or S2b Bearer modification procedure as per Figure
7.11.1-1-1, from step 2 to 3; or PDN GW Initiated bearer deactivation
procedure as per Figure 7.9.2-1, from step 2 to 4, in TS 23.402 [2].
8\. The PDN GW indicates to the PCRF whether the PCC decision could be
enforced or not.
##### 7.5.2.3.3.3 IP flow mobility(S5/S8-PMIP) {#ip-flow-mobilitys5s8-pmip-1
.H6}
Figure 7.5.2.3.3.3-1: IP Flow Mobility (S5/S8-PMIP)
Refer to the description in Figure 7.4.2.3.3.3-1, the difference is as
follows,
Step 10: PDN GW implements Dedicated S2b bearer activation as per Figure
7.10-1, from step 2 to 3; or S2b Bearer modification procedure as per Figure
7.11.1-1-1, from step 2 to 3; or PDN GW Initiated bearer deactivation
procedure as per Figure 7.9.2-1, from step 2 to 4, in TS 23.402 [2].
##### 7.5.2.3.4 Removal of one access
In this scenario, the UE moves all traffic from one access to another access
and detaches from the old access (e.g. due to loss of coverage or by an
explicit detach).
When the UE disconnects from the non-3GPP access and remains connected only to
the 3GPP access, refer to TS 23.402 [2] clause 7.4.3.
When the UE disconnects from the 3GPP access and remains connected only to the
non-3GPP access, refer to TS 23.401 [8] clause 5.3.8.2 or TS 23.402 [2] clause
5.3.
NOTE: If the UE wants to keep the IP flows from an access which is to be
detached, the procedure specified in clause 7.5.2.3.3.2 or clause 7.5.2.3.3.3
above shall be performed before the UE detaches from the old access.
The optional interaction steps between the gateways and the PCRF in the
procedures only occur if dynamic policy provisioning is deployed in EPC.
##### 7.5.2.3.5 Addition of one access for multiple PDN connections to the
same APN
Same as clause 7.4.2.3.5.
### 7.5.3 Solution B: IP flow mobility routing rules negotiated in both WLAN
and 3GPP accesses
#### 7.5.3.1 Overview
##### 7.5.3.1.1 General
Same as clause 7.4.3.1.1.
##### 7.5.3.1.2 Routing Rules
Same as clause 7.4.3.1.2
#### 7.5.3.2 System Impacts
Editor\'s note: To be completed.
#### 7.5.3.3 Flows
##### 7.5.3.3.1 PDN connection establishment over first access
##### 7.5.3.3.1.1 PDN connection establishment over 3GPP access {#pdn-
connection-establishment-over-3gpp-access-4 .H6}
The UE performs the initial PDN connection establishment over 3GPP access as
specified in TS 23.401 [8] clause 5.3.2 with the following additions:
\- The UE sends the routing rule in the Attach Request. The packet filter
(TFT) can be used/extended to carry the routing filter. The MME forwards the
routing filter to the S-GW in the Create Session Request;
\- The S-GW sends a Create Session Request which includes the routing rule the
PDN GW. The routing address for 3GPP access is the S-GW IP address;
\- The PDN GW initiates the IP-CAN Session Establishment Procedure with the
PCRF. In this request, the PDN GW provides the routing rules to the PCRF:
\- The PDN GW sends the Create Session Response which includes the accepted
routing rule to the S-GW.
\- The S-GW sends the Create Session Response with the accepted routing rule
to the MME, and the MME forwards the accepted routing rule to the UE in the
Attach Accept.7.5.2.3.1.2 PDN connection establishment over WLAN
##### 7.5.3.3.1.2 PDN connection establishment over WLAN access {#pdn-
connection-establishment-over-wlan-access .H6}
The procedures are the same as described in clause 7.4.3.3.1.2 of solution B
for PMIPv6 based S2b, with the following differences:
\- In step 3, instead of sending PBU, the ePDG sends a Create Session Request
to the PDN GW as specified in TS 23.402 [2] clause 7.2.4. In addition the
Create Session Request includes the routing rule
\- In step 6, the PDN GW creates a new entry with the routing rule in its
bearer context table. The PDN GW then sends a Create Session Response to the
ePDG, indicating which routing rules requested by the UE are accepted by
including the routing filter accepted by the PDN GW.
##### 7.5.3.3.2 Addition of one access
##### 7.5.3.3.2.1 Addition of WLAN access {#addition-of-wlan-access-3 .H6}
The UE has successfully attached to 3GPP access and established a PDN
connection over 3GPP access using GTP as described in clause 7.5.3.3.1.1.
Subsequently the UE performs the WLAN attachment, and requests to establish a
PDN connection using the same APN, and attempts to use both accesses for the
same PDN connection simultaneously.
Figure 7.5.3.3.2.1-1: Addition of WLAN access to the PDN connection
The signalling flow above shows the particular case where the UE is first
connected to a 3GPP access and then it requests addition of a WLAN access.
1-2. Same as steps 1-2 in Figure 7.4.3.3.2.1-1
3\. The ePDG sends a Create Session Request to the PDN GW as specified in TS
23.401 [8]. In addition the message includes the routing rules,. The packet
filter (TFT) can be used/extended to carry the routing rule. 4-5. Same as step
4-5 in Figure 7.4.3.3.2.1-1.
6\. The PDN GW allocates to the UE the same IP address as that for the PDN
connection the UE has established over the 3GPP access. The PDN GW records the
IP flow routing rule in its bearer context table. The PDN GW links the flow(s)
established over non-3GPP access to the (flow(s) of the same) PDN connection
established over 3GPP access, i.e. using the same entry in the EPS bearer
context table, or creating a new entry in the EPS bearer context table and
linking these two entries. The PDN GW then sends a Create Session Response to
the ePDG as specified in TS 23.401 [8]. In addition the Create Session
Response indicates which routing rules requested by the UE are accepted by
including the routing rule accepted by the PDN GW.
7\. Same as step 7 in Figure 7.4.3.3.2.1-1.
8\. The ePDG determines the traffic selector to be sent to the UE based on the
routing filter in the Create Session Response, and sends to the UE the
IKE_AUTH Response including the traffic selector.
9-10. Same as steps 9-10 in Figure 7.4.3.3.2.1-1.
##### 7.5.3.3.2.2 Addition of 3GPP access {#addition-of-3gpp-access-3 .H6}
After successfully attachment to WLAN access, the UE has established a PDN
connection over WLAN as described in clause 7.5.3.3.1.2.
Subsequently, the UE performs the initial attachment procedure over a 3GPP
access and establishes a PDN connection using the same APN. The procedure is
the same as specified in TS 23.401 [8] clause 5.3.2 with the following
additions:
\- The UE sends routing rule and UE home address (and/or HO indication) in the
Attach Request. The packet filter (TFT) can be used/extended to carry the
routing filter. The MME forwards the routing filter to the S-GW in the Create
Session Request;
\- The S-GW sends the Create Session Request which includes the routing rul to
the PDN GW. The routing address for 3GPP access is the S-GW IP address;
\- The PDN GW initiates the IP-CAN Session Modification Procedure with the
PCRF. In this request, the PDN GW provides the routing rules to the PCRF:
\- The PDN GW allocates to the UE the same IP address as that for the PDN
connection the UE has established over WLAN access. The PDN GW records the IP
flow routing rule in its bearer context table. The PDN GW links the flow(s)
established over 3GPP access to the (flow(s) of the same) PDN connection
established over WLAN access, i.e. using the same entry in the EPS bearer
context table, or creating a new entry in the EPS bearer context table and
linking these two entries. The PDN GW then sends the Create Session Response
which includes the accepted routing rule to the S-GW:
\- The S-GW sends the Create Session Response with the accepted routing rule
to the MME, and the MME forwards the accepted routing rule to the UE in the
Attach Accept.
\- Appropriate 3GPP bearer setup or modification procedures are executed for
the resources associated with the flows that were moved onto the 3GPP access.
##### 7.5.3.3.3 IP flow mobility
##### 7.5.3.3.3.1 IP flow mobility within a PDN connection from 3GPP access to
WLAN access {#ip-flow-mobility-within-a-pdn-connection-from-3gpp-access-to-
wlan-access .H6}
In the following signalling flow, the UE moves one or more IP flow(s) from
3GPP access to the WLAN access by updating the routing rules via IKEv2 and GTP
procedures. The routing rule is applied in WLAN access in this case.
Figure 7.5.3.3.3.1-1: IP flow mobility within a PDN connection initiated over
WLAN access
1\. The UE is connected simultaneously to 3GPP and non-3GPP accesses and
establishes multiple IP flows of the same PDN connection as described in
clauses 7.5.3.3.1 and 7.5.3.3.2.
2\. The UE sends to the ePDG the IKEv2 INFORMATIONAL request, which includes
the updated routing rule requested by the UE.
3\. The ePDG sends a Bearer Resource Command message to the PDN GW. The
message includes the updated routing rule. The ePDG includes the default EPS
bearer ID (i.e. Linked Bearer ID) based on the mapping between the Security
Association and the PDN connection. The ePDG send the updated routing rule to
the PDN GW.
4\. Same as step 4 in Figure 7.4.3.3.3.1-1.
5\. The PDN GW sends to the ePDG an Update Bearer Request which includes the
accepted routing rule.
6\. The ePDG sends an Update Bearer Response to the PDN GW.
7-9. Same as steps 6-8 in Figure 7.4.3.3.3.1-1.
##### 7.5.3.3.3.2 IP flow mobility within a PDN connection from WLAN access to
3GPP access {#ip-flow-mobility-within-a-pdn-connection-from-wlan-access-
to-3gpp-access .H6}
The UE can initiate moving one or more IP flow(s) from WLAN access to 3GPP
access as specified in TS 23.401 [8] clause 5.4.5 with the following
additions, the routing rule is applied via 3GPP access in this case:
\- The UE sends the routing rule and the changed packet filter information can
be used/extended to indicate the modified routing filter. The MME forwards the
modified routing filter to the S-GW in the Bearer Resource Command.
\- The MME sends the Bearer Resource Command including the modified routing
rule to the S-GW. The S-GW then sends the Bearer Resource Command which
includes the modified routing rule) to the PDN GW. The routing address for
3GPP access is the S-GW IP address;
\- The PDN GW initiates the IP-CAN Session Modification procedure and provides
the modified routing rules to the PCRF:
\- The PDN GW sends to the S-GW the accepted routing rule, which is forward to
UE by the S-GW via the MME using the corresponding bearer modification
procedure in step 5.
\- Appropriate 3GPP resource release/allocation procedures are executed for
the resources associated with the flows that were removed, modified or added
in the 3GPP access.
##### 7.5.3.3.4 Removal of one access
Editor\'s note: This procedure is FFS.
##### 7.5.3.3.5 Addition of one access for multiple PDN connections to the
same APN
When a UE having multiple PDN connections to the same APN via one access
attaches to a second access, the UE needs to decide which of the multiple PDN
connections the UE has would use both accesses simultaneously.
When the UE having multiple PDN connections to the same APN via a 3GPP access
attaches to a WLAN, the UE shall perform GTP procedures only for the PDN
connections for which it will use IP flow mobility.
When the UE having multiple PDN connections to the same APN via the WLAN
attaches to the 3GPP access, the UE should only establish the PDN connections
for which it will use IP flow mobility. However, due to the restriction that
the UE cannot indicate which PDN connection is to establish, the UE shall
repeat UE PDN Connectivity Request until the desired PDN connections have been
established and shall perform GTP procedures for the desired PDN connections.
### 7.5.4 Solution C -- Merged Control Plane signalling solution for GTP-based
S2b
#### 7.5.4.1 Overview
##### 7.5.4.1.1 General
In this solution, routing rules are provided on both WLAN and 3GPP accesses
via control plane signalling approach.
For the UE-initiated NBIFOM procedure, the routing rule can be provided via
both untrusted WLAN access and 3GPP access
\- For untrusted WLAN access, the routing rule is provided in the following
way:
\- via IKEv2 procedure from the UE to the ePDG;
\- via GTP-C signalling from the ePDG to the P-GW;
\- via Gx procedure from the P-GW to the PCRF.
\- For 3GPP access, the routing rule is provided in the following way:
\- via 3GPP access specific signalling (e.g. Attach Request, Request Bearer
Resource Modification) from the UE to the MME and then over GTP-C to S-GW;
\- via GTP-C signalling from the S-GW to the P-GW;
\- via Gx procedure from the P-GW to the PCRF.
For the network-initiated NBIFOM procedure, the routing rule also can be
provided via both WLAN access and 3GPP access.
\- For untrusted WLAN access, the routing rule is provided in the following
way:
\- via Gx procedure from PCRF to the P-GW;
\- via GTP-c signalling from the PDN-GW to the ePDG;
\- via IKEv2 procedure from the ePDG to the UE;
\- For 3GPP access, the routing rule is provided in the following way:
\- via Gx procedure from PCRF to the PDN GW;
\- via GTP-c signalling from the PDN GW to the SGW and from SGW to MME;
\- via existing NAS signalling (Attach Response, Activate Default EPS Bearer
Context etc.) from the MME to the UE.
The solution is described assuming both S5 and S2b are GTP based.
For the network-initiated NBIFOM procedure, the solution relies on the PCRF
making the decision on when and what flows should be moved to which access.
The PCRF learns of multiple accesses via event triggers from the PDN GW.
##### 7.5.4.1.2 Routing Rules
The consideration of Routing Rules is specified as clause 7.3.2.1.3.
##### 7.5.4.1.3 NBIFOM Capability Discovery over S2b
A NBIFOM capable UE shall perform NBIFOM capability discovery when performing
S2b initial attach procedure.
The UE shall use Configuration Payload in IKEv2 signalling to indicate NBIFOM
support. If the ePDG supports NBIFOM, the ePDG shall indicate its NBIFOM
support to the P-GW via APCO.
If the network decides that NBIFOM applies, the PGW shall confirm the NBIFOM
support to the ePDG and the ePDG shall forward the negotiation result of
NBIFOM support to the UE via Configuration Payload in IKEv2 signalling.
#### 7.5.4.2 System Impacts
##### 7.5.4.2.1 3GPP RAN
This solution has no impact to 3GPP RAN.
##### 7.5.4.2.2 UE
The UE is enhanced to:
\- send the indication of support NBIFOM via Configuration Payload in IKEv2
signalling over untrusted WLAN access during first and additional access for
multi-access PDN connection establishment;
\- send the indication of support NBIFOM via PCO over 3GPP access during first
and additional access for multi-access PDN connection establishment;
\- send routing rules in NAS to the core network;
\- send routing rules in IKEv2 to the core network;
\- receive routing rules in NAS from the core network;
\- receive routing rules in IKEv2 from the core network;
\- send an establishment cause for the PDN establishment indicating NBIFOM
when an access is added for a PDN connection;
\- route the IP flow(s) by referring also to the access type in the routing
rules;
\- for UE-initiated NBIFOM, if the PDN connection is routed over both 3GPP and
untrusted WLAN access, then the UE sends the routing rules via the access
indicated by the Routing Access Type in the routing rule. For example, the UE
would need to send separate messages in case it wants to provide routing rules
with different access types, one in each access.
#### 7.5.4.2.3 MME
The MME is enhanced as specified in clause 7.3.2.2.3.
##### 7.5.4.2.4 S-GW
The S-GW is enhanced as specified in clause 7.3.2.2.4.
##### 7.5.4.2.5 ePDG
The ePDG is enhanced to:
\- receive the UE indication to negotiate NBIFOM support in IKEv2
Configuration Payload during the initial and additional access for multi-
access PDN connection;
\- receive the negotiation result of NBIFOM support from the PGW and forward
it to the UE via IKEv2 signalling;
\- send the capability indication to the PGW for its support for NBIFOM;
\- transport routing rules received from UE via IKEv2 Configuration Payload to
the PGW or transport routing rules received from the PGW to the UE.
##### 7.5.4.2.6 PGW
The PGW is enhanced to:
\- send the negotiation result of NBIFOM support to the ePDG when the UE
requests multi-access PDN connectivity over S2b;
\- support multi-access PDN connection;
\- route the IP flow(s) by referring also the routing access type which is
part of the routing rules;
\- send and receive routing rule updates over S5/S8 and S2b;
\- receive an indication from the MME, SGW, SGSN or ePDG whether they support
NBIFOM or not;
\- receive the routing rules from the SGW/ePDG and send them to the PCRF;
\- receive the routing rules from the PCRF and send them to the S-GW/ePDG;
\- notify the PCRF when an additional access is added or removed for an
existing PDN;
\- for network-initiated NBIFOM, if the PDN GW receives a PCC rule update with
access information from the PCRF, and the corresponding PDN connection is
routed over both 3GPP and untrusted WLAN access, then the PDN GW generates
routing rule based on the PCC rule and sends the routing rules via the access
indicated by the Routing Access Type in the routing rule. For example, the PDN
GW would need to send separate messages in case it wants to provide routing
rules with different access types, one in each access.
##### 7.5.4.2.7 PCC Enhancements
The PCC is enhanced as specified in clause 7.3.2.2.8.
##### 7.5.4.2.8 SGSN
The SGSN is enhanced as specified in 7.3.2.2.7.
#### 7.5.4.3 Signalling Flows
##### 7.5.4.3.1 Initial PDN connection establishment over first access
##### 7.5.4.3.1.1 PDN connection establishment over 3GPP access {#pdn-
connection-establishment-over-3gpp-access-5 .H6}
The UE performs the initial PDN connection establishment to a 3GPP access as
specified in clause 7.3.2.3.1.2.
##### 7.5.4.3.1.2 PDN connection establishment over WLAN S2b {#pdn-connection-
establishment-over-wlan-s2b .H6}
Figure 7.5.4.3.1.2-1: PDN connection establishment over WLAN access
The procedures are the same as described in clause 7.2.4 of TS 23.402 [2],
with the following additions:
\- UE shall perform the NBIFOM capability discovery procedure as specified in
clause 7.5.4.1.3;
\- If the dynamic PCC is deployed, the P-GW sends the support of NBIFOM to the
PCRF. If PCRF supports the NBIFOM, the PCRF acknowledges the support of NBIFOM
to the P-GW. The P-GW forwards it to the UE via ePDG.
##### 7.5.4.3.2 Addition of one access to a PDN connection
##### 7.5.4.3.2.1 Addition of WLAN access {#addition-of-wlan-access-4 .H6}
The UE has successfully attached to 3GPP access and established a PDN
connection over 3GPP access using GTP as described in clause 7.5.4.3.1.1.
Subsequently the UE performs the WLAN attachment, and requests to establish a
PDN connection using the same APN, and attempts to use both accesses for the
same PDN connection simultaneously.
Figure 7.5.4.3.2.1-1: Addition of WLAN access to the PDN connection
Figure 7.5.4.3.2.1-1 shows the particular case when the UE is first connected
to a 3GPP access and then it requests addition of a WLAN access.
1\. The UE discovers a WLAN and performs the authentication and authorization
procedure with 3GPP EPC via the WLAN access as specified in TS 23.402 [2]
clause 7.2.1 step 1.
2\. IKEv2 authentication and tunnel setup procedure are performed via the WLAN
access between the UE, ePDG and 3GPP AAA Server/HSS as specified in TS 33.402
[11]. For IP address preservation, the UE includes the same address (IPv4
address or IPv6 prefix/address or both) that was allocated during its
attachment to 3GPP access. A new access can be added to a multi-access PDN
connection without an associated routing rule.
3\. If routing rules were included in step 2 above for UE-initiated NBIFOM
mode, the ePDG includes the routing rules and an NBIFOM indication in the
Create Session Request message to the PDN GW.
4\. Based on the presence of the NBIFOM indication in the Create Session
Request message, the PDN GW allocates the same IP address for the UE as for
the PDN connection the UE has established over the 3GPP access and establishes
a new GTP tunnel with the ePDG while maintaining the previous GTP tunnel with
the S-GW . If dynamic PCC is supported, the PDN GW initiates the IP-CAN
Session Modification Procedure with the PCRF. If routing rules were included,
thePDN GW sends the routing rules to the PCRF. The PCRF may modify the routing
rules for the downlink and/or uplink, and send the modified routing rules to
the PDN GW.
5\. The PDN GW sends a Create Session Response message to the ePDG that
includes the accepted routing rules by the PDN GW.
6\. The ePDG indicates to the UE that the authentication and authorization
with the external AAA server is successful.
7\. If routing rules were included in step 2 above and accepted by the PGW,
the ePDG sends the routing rules to theUE . In network-initiated NBIFOM
procedure, the network does not provide any routing rules and/or default
access to the UE during this procedure. The reason is that there would be no
way for the UE to acknowledge the network-provided Routing Rules and/or
default access during the addition of an access. Instead, Routing Rules and/or
default access need to be provided from the network using a separate IP flow
mobility procedure.
8\. IP connectivity from the UE to the PDN GW is now setup. Any packet in the
uplink direction complying with the routing rules is tunnelled to the ePDG by
the UE using the IPSec tunnel. The ePDG then tunnels the packet to the PDN GW.
From the PDN GW normal IP-based routing takes place. In the downlink
direction, the packet for UE arrives at the PDN GW. The PDN GW tunnels the
packet to the ePDG based on the routing rules. The ePDG then tunnels the
packet to the UE via the IPsec tunnel.
9\. If routing rules were included in step 2 above, the appropriate 3GPP
resource release procedures are executed for the resources associated with the
flows that were moved onto the WLAN access as specified in TS 23.402 [2].
##### 7.5.4.3.2.2 Addition of 3GPP access {#addition-of-3gpp-access-4 .H6}
Addition of 3GPP access is described in clause 7.3.2.3.2.4.
##### 7.5.4.3.3 IP flow mobility
##### 7.5.4.3.3.1 General {#general-16 .H6}
In this scenario, an IP flow is moved from one access to another access.
Figures 7.5.4.3.3.2.1-1 and 7.5.4.3.3.2.2-1 below describe the cases where UE
initiates the IP flow mobility. Figures 7.5.4.3.3.3.1-1 and 7.5.4.3.3.3.2-1
below describe the cases where Network initiates the IP flow mobility. An IP
flow can be either a new IP flow or an IP flow which was formerly routed
through one access. The routing rules can be sent via either 3GPP access or
WLAN access.
##### 7.5.4.3.3.2 UE-initiated IP flow mobility procedure {#ue-initiated-ip-
flow-mobility-procedure .H6}
In the following signalling flows, the UE initiates the IP flow mobility
procedure.
##### 7.5.4.3.3.2.1 IP flow mobility within a PDN connection with negotiation
via 3GPP access GTP-based S5/S8 {#ip-flow-mobility-within-a-pdn-connection-
with-negotiation-via-3gpp-access-gtp-based-s5s8 .H6}
In the following signalling flow, the UE moves one or more IP flow(s) from
WLAN access to 3GPP access by updating the routing rules via 3GPP access.
Figure 7.5.4.3.3.2.1-1: IP Flow Mobility (S5/S8-GTP)
1\. The UE is simultaneously connected to a 3GPP and a WLAN access based on
the procedures described in clauses 7.5.4.3.2.1and 7.5.4.3.2.2. The UE is
exchanging some IP flows through the 3GPP access and some other IP flows
through the WLAN access.
2\. The UE sends a Request Bearer Resource Modification to MME including some
updated routing rules. The UE can install a new routing rule or modify the
routing access type of an existing routing rule or remove an existing routing
rule.
3\. MME sends Bearer Resource Command S-GW, including the updated routing
rules.
4\. S-GW forwards to P-GW, including the updated routing rules.
5\. P-GW sends the IP flow mobility confirmation to the S-GW with the
indication of the successful installation of routing rules.
6\. S-GW sends the IP flow mobility confirmation to the MME with the
indication of the successful installation of routing rules.
7\. MME sends the IP flow mobility confirmation to the UE with the indication
of the successful installation of routing rules.
8\. P-GW sends IP-CAN Session Modification-begin to PCRF, including the
updated routing rules. The PCRF stores the updated routing rules. The PCRF may
reject the IP flow mobility requests from UE due to subscription limitations.
When the network rejects an IP flow mobility request, the network provides a
certain cause value to the UE indicating why the request was rejected. This
cause value may be used by the UE to determine when/if this IP flow mobility
operation can be requested again. The PCRF updates the PCC rule based on the
updated routing rules and sends an acknowledgement to the PDN GW, including
updated PCC rules if appropriate.
9\. P-GW implements Dedicated bearer activation as per Figure 5.4.1-1, from
step 2 to 11; or Bearer modification procedure as per Figure 5.4.2.1-1, from
step 2 to 11, or as per Figure 5.4.3-1, from step 2 to 9; or Dedicated bearer
deactivation procedure as per Figure 5.4.4.1-1, from step 2 to 9, in TS 23.401
[8].
10\. P-GW implements Dedicated bearer activation as per Figure 7.10-1, from
step 2 to 3; or Bearer modification procedure as per Figure 7.11.1-1, from
step 2 to 3, or Dedicated bearer deactivation procedure as per Figure 7.9.2-1,
from step 2 to 4 for GTP-based S2b.
11\. The P-GW indicates to the PCRF whether the PCC decision could be enforced
or not.
##### 7.5.4.3.3.2.2 IP flow mobility within a PDN connection with negotiation
via untrusted WLAN access {#ip-flow-mobility-within-a-pdn-connection-with-
negotiation-via-untrusted-wlan-access .H6}
The UE can move one or more IP flow(s) from the 3GPP access to the WLAN
access. The UE should update the routing rules via the WLAN access.
Figure 7.5.4.3.3.2.2-1: IP flow mobility within a PDN connection initiated
over WLAN access
1\. The UE is connected simultaneously to 3GPP and WLAN accesses and
establishes multiple IP flows of the same PDN connection as described in
clauses 7.5.4.3.2.1 and 7.5.4.3.2.2.
2\. The UE sends the IKEv2 INFORMATIONAL request to the ePDG, which includes
the updated routing rules requested by the UE.
3\. The ePDG sends a Bearer Resource Command message to the PDN GW. The
message includes the updated routing rules. The ePDG includes the default EPS
bearer ID (i.e. Linked Bearer ID) based on the mapping between the Security
Association and the PDN connection. The ePDG sends the updated routing rules
to the PDN GW.
4\. The PDN GW initiates the IP-CAN Session Modification Procedure with the
PCRF. In this request, the PDN GW provides the updated routing rules to the
PCRF. The PCRF may reject the IP flow mobility requests from UE due to
subscription limitations. When the network rejects an IP flow mobility
request, the network provides a certain cause value to the UE indicating why
the request was rejected. This cause value may be used by the UE to determine
when/if this IP flow mobility operation can be requested again.
5\. The PDN GW sends an Update/Create Bearer Request message to the ePDG which
includes the accepted routing rules.
6\. The ePDG sends an Update/Create Bearer Response message to the PDN GW.
7\. The ePDG sends the IKEv2INFORMATIONAL response to the UE that includes the
updated routing rules accepted by the PDN GW.
8\. Appropriate WLAN resource allocation procedures are executed for the
resources associated with the flows that were modified or added in the WLAN
access.
9\. Appropriate 3GPP resource release procedures are executed for the
resources associated with the flows that were modified or removed in the 3GPP
access.
10\. The PDN GW indicates to the PCRF whether the PCC decision could be
enforced or not.
##### 7.5.4.3.3.3 Network-initiated IP flow mobility procedure {#network-
initiated-ip-flow-mobility-procedure .H6}
In the following signalling flows, the network initiates the IP flow mobility
procedure.
##### 7.5.4.3.3.3.1 IP flow mobility within a PDN connection with negotiation
via WLAN access {#ip-flow-mobility-within-a-pdn-connection-with-negotiation-
via-wlan-access .H6}
In the following signalling flow, the PCRF identifies and moves specific flows
from 3GPP to WLAN.
Figure 7.5.4.3.3.3.1-1: IP flow mobility within a PDN connection with
negotiation via WLAN access
1\. The UE is connected simultaneously to 3GPP and WLAN accesses and
establishes multiple IP flows of the same PDN connection.
2\. PCRF determines based on policy information and current UE state that
session modification can be initiated to move specific flows. PCRF indicates
to the P-GW via PCC rules.
3\. The P-GW sends to the ePDG a Create/Update/Delete Bearer Request which
includes the new routing rules to be utilized for WLAN
4\. The ePDG sends a Create/Update/Delete Bearer Response to the PDN GW.
5\. The ePDG initiates a IKEv2 INFORMATIONAL request, which includes the
modified routing rule to indicate the updated routing rule to be used by the
UE. The UE may accept or reject the Routing Rules. When the UE rejects the
Routing Rules the UE provides a cause value indicating why the request was
rejected. This cause value may be used by the network to determine when/if
this IP flow mobility operation can be requested again.
6\. The UE responds with a IKEv2 INFORMATIONAL response, acknowledging the new
routing rules and applies the corresponding filters
7\. The non-3GPP specific resource release, setup or modification may be
performed based on the modified traffic selector in non-3GPP access network.
8\. Appropriate 3GPP resource release/allocation procedures are executed for
the resources associated with the flows that were removed, modified or added
in the 3GPP access.
##### 7.5.4.3.3.3.2 IP flow mobility within a PDN connection with negotiation
via 3GPP access {#ip-flow-mobility-within-a-pdn-connection-with-negotiation-
via-3gpp-access .H6}
Figure 7.5.4.3.3.3.2-1: IP flow mobility within a PDN connection with
negotiation via 3GPP access
1\. The UE is connected simultaneously to 3GPP and WLAN accesses and
establishes multiple IP flows of the same PDN connection.
2\. PCRF determines based on policy information and current UE state that
session modification can be initiated to move specific flows. PCRF indicates
to the P-GW via PCC rules.
3\. The P-GW sends to the S-GW a Create/Update/DeleteBearer Request which,
includes the new routing rules to be utilized for 3GPP.
4\. The S-GW sends to the MME a Create/Update/Delete Bearer Request which,
includes the new routing rules to be utilized for 3GPP.
5\. MME updates the UE with new routing rules. The UE may accept or reject the
Routing Rules. When the UE rejects the Routing Rules the UE provides a cause
value indicating why the request was rejected. This cause value may be used by
the network to determine when/if this IP flow mobility operation can be
requested again.
6\. MME sends an Update Bearer Response to the S-GW.
7\. The S-GW sends an Update Bearer Response to the P-GW.
8\. Based on the routing rules and optional PCC rules, P-GW makes the
determination to either release WLAN resources, setup or modify resources on
WLAN access and performs the appropriate bearer procedures as defined in TS
23.402 [2].
##### 7.5.4.3.3.4 UE Requested IP Flow Mapping via 3GPP access {#ue-requested-
ip-flow-mapping-via-3gpp-access-1 .H6}
UE Requested IP Flow Mapping via 3GPP access is described in clause
7.3.2.3.3.6.
##### 7.5.4.3.3.5 UE Requested IP Flow Mapping via WLAN access {#ue-requested-
ip-flow-mapping-via-wlan-access-1 .H6}
This procedure is only used in NW-initiated mode when the UE wants to request
the NW to apply a specific mapping of an IP flow to TWAN access. The NW
provides Routing Rules to the UE for this IP flow.
This procedure is similar to clause 7.5.4.3.3.2.2, with the following
differences:
\- The UE sends a IKEv2 INFORMATIONAL request to the network, which includes
the mapping information of an IP flow to WLAN access.
\- The PGW provides the mapping information to the PCRF during IP-CAN
Modification procedure.
\- The PCRF generates or modifies PCC Rule(s) for this IP flow according to
the mapping information, user subscription and operator policy and send the
PCC Rule(s) to the PGW.
\- The PGW sends corresponding Routing Rule to the UE.
##### 7.5.4.3.4 Removal of one access
In this scenario, the UE moves all traffic from one access to another access
and detaches from the old access (e.g. due to loss of coverage or by an
explicit detach).
##### 7.5.4.3.4.1 UE-initiated removal of 3GPP access from the PDN connection
{#ue-initiated-removal-of-3gpp-access-from-the-pdn-connection-1 .H6}
When the UE disconnects from the 3GPP access and remains connected only to the
WLAN access, refer to TS 23.401 [8] clause 5.3.8.2.
NOTE: If the UE wants to keep the IP flows from an access to be detached from,
the procedure specified in clause 7.5.4.3.3.2.2 shall be performed before the
UE detaches from the old access.
##### 7.5.4.3.4.2 Network-initiated removal of 3GPP access from the PDN
connection {#network-initiated-removal-of-3gpp-access-from-the-pdn-
connection-1 .H6}
Figure 7.5.4.3.4.2-1: Removal of 3GPP access from the PDN connection
1\. The UE is connected simultaneously to 3GPP and WLAN accesses and
establishes multiple IP flows of the same PDN connection.
2\. MME initiates a release of the resources on 3GPP due to operator
intervention or other trigger (detach request from UE or radio link failure)
3\. MME sends a Delete Session Request to the SGW
4\. SGW sends the Delete Session request to the PDN GW
5\. PDN GW shall indicate to the PCRF the removal of new 3GPP E-UTRAN RAT
Type, if the PCRF has enabled this event trigger during the initial session
establishment. PCRF determines based on policy information and current UE
state that session modification can be initiated to move specific flows. PCRF
indicates to the PDN GW routing rules with associated routing access type for
rules to be modified or installed. The PCRF may update corresponding PCC rules
according to the routing rules.
6\. PDN GW sends the Delete Session Response to the SGW
7\. SGW sends the Delete Session Response to the MME
8\. MME performs EPS resource release procedures
9\. Based on PCC rules, PGW makes the determination if any modification of
resources on WLAN access are needed and performs the appropriate bearer
procedures as defined in TS 23.402 [2] and sends to the ePDG an Update Bearer
Request which, includes the new routing rules to be utilized for 3GPP
10\. The ePDG sends an Update Bearer Response to the PDN GW.
11\. The ePDG initiates a IKEv2 INFORMATIONAL request, which includes the
modified routing rule to indicate the updated routing rule to be used by the
UE.
12\. The UE responds with a IKEv2 INFORMATIONAL response, acknowledging the
new routing rules and applies the corresponding filters
13\. The non-3GPP specific resource modification may be performed based on the
modified traffic selector in non-3GPP access network.
##### 7.5.4.3.4.3 UE-initiated removal of WLAN access from the PDN connection
{#ue-initiated-removal-of-wlan-access-from-the-pdn-connection-1 .H6}
When the UE disconnects from the WLAN access and remains connected only to the
3GPP access, refer to TS 23.402 [2] clause 7.4.3.
NOTE: If the UE wants to keep the IP flows from an access to be detached from,
the procedure specified in clause 7.5.4.3.3.2.1 shall be performed before the
UE detaches from the old access.
##### 7.5.4.3.4.4 Network-initiated removal of WLAN access from the PDN
connection {#network-initiated-removal-of-wlan-access-from-the-pdn-connection
.H6}
Figure 7.5.4.3.4.4-1: Removal of WLAN access from the PDN connection
1\. The UE is connected simultaneously to 3GPP and WLAN accesses and
establishes multiple IP flows of the same PDN connection.
2\. ePDG initiates a release of the resources on WLAN due to operator
intervention or other trigger (Dead Peer Detection or other scenarios)
Editor\'s note: It is FFS on the actual trigger possibilities for WLAN
connection loss and detection at ePDG
3\. ePDG sends a Delete Session Request to the SGW
4\. PDN GW shall indicate to the PCRF the removal of new WLAN RAT Type, if the
PCRF has enabled this event trigger during the initial session establishment.
PCRF determines based on policy information and current UE state that session
modification can be initiated to move specific flows. PCRF indicates to the
PDN GW routing rules. The PCRF may update corresponding PCC rules according to
the routing rules.
5\. PDN GW sends the Delete Session Response to the SGW
6\. If needed, ePDG performs WLAN resource release procedures
7\. Based on PCC rules, PGW makes the determination if any modification of
resources on 3GPP E-UTRAN access are needed and performs the appropriate
bearer procedures as defined in TS 23.401 [8] and sends an Update Bearer
Request to the SGW which, includes the new routing rules to be utilized for
3GPP
NOTE: It is possible that instead of resource modification, a resource removal
or setup can happen and the procedures are as defined in TS 23.401 [8].
8\. SGW forwards the Update Bearer Request to the MME.
9\. MME performs 3GPP EPS Resource Modification as defined in TS 23.401 [8].
10\. The MME sends an Update Bearer Response to the SGW.
The SGW sends an Update Bearer Response to the PGW.
##### 7.5.4.3.5 Loss of an access from a PDN connection in case of network-
initiated IP flow mobility
##### 7.5.4.3.5.1 Loss of 3GPP access from the PDN connection {#loss-of-3gpp-
access-from-the-pdn-connection .H6}
For network-initiated IP flow mobility procedure, when the UE detects the loss
of 3GPP coverage, the UE shall report this event to the network.
Figure 7.5.4.3.5.1-1: Procedure for loss of 3GPP access for GTP S2b
1\. The UE is connected simultaneously to 3GPP and ePDG and establishes
multiple IP flows of the same PDN connection.
2\. The UE detects that the 3GPP link is not suitable (e.g. loss of 3GPP
coverage, 3GPP radio condition degradation).
3\. The UE sends the IKEv2 INFOMATIONAL request including an indication that
the 3GPP link is not suitable. The UE also includes information to identify
the IP flows that need to be moved to the WLAN.
Editor\'s note: The information to identify the IP flows is FFS.
4\. The indication and the information to identify the IP flows are sent to
the PGW within a Bearer Resource Command.
5\. The PGW sends the indication to the PCRF. The PCRF may generate new
Routing Rules later and should not generate Routing Rules for 3GPP.
Editor\'s note: It is FFS whether the PGW notifies the PCRF about the
information to identify the IP flows that need to be moved to the untrusted
WLAN and whether the PCRF needs to update the PCC rules.
6\. The PGW moves all the IP flows from 3GPP to untrusted WLAN except those IP
flows which are forbidden to be routed via WLAN. The PGW may initiate
dedicated bearer activation and/or modification procedure as described in WLAN
TS 23.402 [2] according to if the IP flow shall be transported to new
dedicated bearer or to existing bearer. The PGW may release the resource in
the 3GPP access network but do not release the access from the multi-access
PDN connection.
Editor\'s note: The network behaviour is FFS if some IP flows are forbidden to
be routed in untrusted WLAN.
Editor\'s note: The Co-existence with RAN Rule solution is FFS.
Editor\'s note: Whether the UE sends the indication to the network when no
active IP flows are transferred via 3GPP is FFS.
##### 7.5.4.3.5.1 Loss of an access using S2b {#loss-of-an-access-using-s2b
.H6}
For network-initiated IP flow mobility procedure, when the UE detects the loss
of untrusted WLAN coverage, the UE shall perform the procedure as specified in
clause 7.3.2.3.5.2.
## 7.6 Solutions based on User-Plane signalling
### 7.6.1 Solution 1
#### 7.6.1.1 Overview - without exchanging routing rules
The solution specified in this clause enables UE-initiated and NW-IP flow
mobility without exchanging routing rules between the UE and the PGW.
##### 7.6.1.1.1 General
The solution is characterized by the following features:
1 The solution is applicable to deployments that utilize either an S2a
interface (GTP or PMIPv6) or an S2b interface (GTP or PMIPv6) for WLAN
interworking.
2 The solution has no impact to network functions other than PGW and PCRF.
3 The PGW can receive extended PCC rules via Gx. An extended PCC rule includes
the preferred access type for a certain service data flow.
4 The PGW can request NW-initiated IP flow mobility without receiving any
assistance information from the UE. The extended PCC rules in the PGW can be
used to determine when NW-initiated IP flow mobility should be requested.
5\. The UE or the PGW can request to transfer an IP flow from a source access
to a target access within a PDN connection without exchanging routing rules.
6\. The UE can transfer an IP flow from a source access to a target access
either (_a_) with _authorized transfer_ , i.e. after receiving authorization
from the network, or (_b_) with _autonomous transfer_ , i.e. without receiving
authorization from the network. The network can transfer an IP flow from a
source access to a target access only with _authorized transfer_ , i.e. after
receiving authorization from the UE.
\- The UE may use autonomous transfer when the UE can no longer transmit one
or more IP flows on the source access (e.g. due to loss of signal on the
source access, because the user has deactivated the source access, etc.). In
all other cases, the UE uses authorized transfer.
7\. When the UE uses autonomous transfer for one or more IP flows, the UE
simply transmits uplink traffic for these IP flows to the target access
(without a \"redirection\" packet). When the PGW observes that the UE has
autonomously transferred to a target access at least one IP flow, the PGW does
not transmit any more traffic to the source access. This is because an
autonomous transfer indicates to PGW that the source access is no longer
available in the UE.
8\. When the UE or the PGW use authorized transfer for an IP flow, the UE or
PGW transmit via the target access a \"redirection\" packet. An example for a
UE-initiated scenario is shown in Figure 7.6.1.1.1-1. The \"redirection\"
packet in this figure can be any packet of IP flow #1 (i.e. has the same
5-tuple with the packets of IP flow #1) but with TTL=1. The \"redirection\"
packet may have a short payload (e.g. \"NBIFOM\") to explicitly differentiate
it from other packets of IP flow #1 that may also have TTL=1. The PGW discards
this packet and responds as described in clause 7.6.1.1.7. In addition,
however, the PGW interprets the \"redirection\" packet as a request from the
UE to move IP flow #1 from 3GPP access to WLAN access. It is assumed that the
network does not charge the \"redirection\" packets.
Figure 7.6.1.1.1-1:
9\. When the PGW or the UE receives a \"redirection\" packet via a target
access, the UE or the PGW responds as specified in clause 7.6.1.1.7.
10\. When the PGW receives an ICMP Time-Exceeded packet and the PGW identifies
that this is a response to a \"redirection\" packet, the PGW locally discards
the ICMP Time-Exceeded packet (after updating its Flow Binding Table) and does
not forward this packet to Sgi. Similarly, when the UE receives an ICMP Time-
Exceeded packet that this is a response to a \"redirection\" packet, the UE
does not forward this packet to the upper layers.
11\. If the PGW accepts to transfer an IP flow to a target access, the PGW
transmits subsequent downlink packets for the IP flow via the target access.
Similarly, if the UE accepts to transfer an IP flow to a target access, the UE
transmits subsequent uplink packets for the IP flow via the target access.
12\. Both UE and PGW maintain a Flow Binding Table that indicates the access
via which a certain IP flow should be routed. The Flow Binding Tables in the
UE and PGW are synchronized so that uplink and downlink packets of an IP flow
are transmitted via the same access type. As an example, the Flow Binding
Table can include:
\- Record #1: IP flow A ‑> 3GPP access
\- Record #2: IP flow B ‑> WLAN access
13\. When a new IP flow is initiated at the UE, this IP flow is routed to 3GPP
or WLAN access according to the UE\'s routing rules. The UE does not transmit
a \"redirection\" packet before routing the new IP flow. If the network wants
to redirect the IP flow to a different access, it can trigger the network-
initiated IP flow mobility procedure specified in clause 7.6.1.3.3.2. When the
PGW receives an uplink packet of a new IP flow via a certain access, it adds
the IP flow in its Flow Binding Table and uses the same access to route
downlink packets for this IP flow. The same behaviour is followed for IP flows
initiated at the network side.
14\. This solution does not negotiate a common \"default\" access between the
UE and the PGW. New IP flows initiated at the UE are routed based on the
routing rules in the UE and new IP flows initiated at the network are routed
based on the routing rules in PGW.
##### 7.6.1.1.2 NBIFOM capability discovery/negotiation
This solution requires NBIFOM capability negotiation: The UE provides an
NBIFOM capability (e.g. as part of PCO) when it requests a new PDN connection
and wants to enable NBIFOM for this PDN connection. Similarly, the PGW
provides a NBIFOM capability when it accepts the PDN connection request and if
the PGW supports NBIFOM and wants to enable NBIFOM for this PDN connection. If
needed, the PGW may be configured to prohibit NBIFOM for certain APNs. In this
case, the PGW does not provide a NBIFOM capability when it accepts the PDN
connection request for one of these APNs.
When both the UE and the PGW have provided an NBIFOM capability for a PDN
connection, only then they can apply the IP flow mobility procedures specified
in this solution, i.e. only then they can add an additional access to the PDN
connection and to request UE-initiated and NW-initiated IP flow mobility
procedures over the established PDN connection.
##### 7.6.1.1.3 Routing rules considerations
This solution does not exchange any routing rules between the UE and the
network.
##### 7.6.1.1.4 Delivery of routing rules
This solution does not exchange any routing rules between the UE and the
network.
##### 7.6.1.1.5 Co-existence of UE-initiated and Network-initiated handling
This solution handles the co-existence of UE-initiated and NW-initiated IP
flow mobility based on the solution A in clause 7.8.2.
##### 7.6.1.1.6 PCC Interactions
Although the solution does not require the UE and the PGW to exchange routing
rules, it assumes that both the UE and the PGW maintain their own routing
rules: The UE may have ISRP for IFOM rules and the PGW may have extended PCC
rules from PCRF. The extended PCC rules define a preferred access type for a
certain service data flow (SDF).
The PCRF can provide updated/new PCC rules to PGW over Gx, e.g. when a new PDN
connection is established or when a new access is added to an existing PDN
connection. These PCC rules are used by the PGW to trigger NW-initiated IP
flow mobility.
In addition, when the PGW receives a UE-initiated IP flow mobility request
(i.e. when receiving a \"redirection\" packet), the PGW may request from PCRF
to accept or reject this request (via a session modification procedure). For
this purpose, the PGW sends to PCRF information indicating the requested IP
flow mobility (e.g. may construct and send a routing rule) and receives from
PCRF information indicating if the requested IP flow mobility is accepted or
not (e.g. new/updated PCC rules).
When the UE uses authorized transfer (as defined in bullet 6 of clause
7.6.1.1.1) for several IP flows, the UE transmits a \"redirection\" packet for
each one of these IP flows. This may trigger multiple PCC interaction over Gx,
i.e. one interaction per IP flow.
Editor\'s note: Since the solution requires one PCC interaction per IP flow,
it may experience scalability issues. It is FFS if such issues could be
mitigated.
##### 7.6.1.1.7 Response to \"Redirection\" Request
When the UE or PGW receives a \"redirection\" packet it responds by using one
of the following two alternative methods:
**Alternative A:**
The UE or the PGW responds to a \"redirection\" packet by sending an ICMP
Time-Exceeded packet to the source access or to the target access as follows:
\- If the redirection is accepted, the ICMP Time-Exceeded packet is sent to
the target access.
\- If the redirection is rejected, the ICMP Time-Exceeded packet is sent to
the source access.
**Alternative B:**
The UE or the PGW responds to a \"redirection\" packet by sending a second
\"redirection\" packet to the source access or to the target access as
follows:
\- If the redirection is accepted, the UE or PGW sends the second
\"redirection\" packet to the target access.
\- If the redirection is rejected, the UE or PGW sends the second
\"redirection\" packet to the source access.
Editor\'s note: It is FFS which one of the above alternative methods should be
used.
#### 7.6.1.2 System Impacts
This solution impacts only the UE, the PGW and the PCRF (when dynamic PCC is
deployed). Since the UE and PGW do not need to exchange routing rules, there
is no impact to other functional elements and there is no impact to S2a and
S2b interfaces.
The UE shall be able to:
\- Negotiate the NBIFOM capability when a new PDN connection is established;
\- Use its active ISRP for IFOM rules (if any) to trigger UE-initiated IP flow
mobility, as specified in clause 7.9.1;
\- Accept or reject NW-initiated IP flow mobility as specified in clause
7.9.1;
\- Support both the UE-initiated and the NW-initiated IP flow mobility
procedures.
\- Transmit a \"redirection\" packet for a UE-initiated scenario.
\- Receive a \"redirection\" packet and interpret it as a request from the
network for a NW-initiated scenario.
The PGW shall be able to:
\- Negotiate the NBIFOM capability when a new PDN connection is established;
\- Support the PCC interactions specified in clause 7.6.1.1.6;
\- Accept or reject UE-initiated IP flow mobility as specified in clause
7.6.1.1.5;
\- Support the UE-initiated and the NW-initiated IP flow mobility procedures;
\- Start a timer after requesting NW-initiated IP flow mobility, as specified
in clause 7.6.1.3.3.2.
The PCRF shall be able to:
\- Support extended PCC rules as specified in clause 7.6.1.1.6;
\- Support the PCC interactions specified in clause 7.6.1.1.6.
#### 7.6.1.3 Procedures
##### 7.6.1.3.1 Initial PDN connection establishment over first access
##### 7.6.1.3.1.1 General {#general-18 .H6}
The existing PDN connection establishment procedures are used. The only
additional requirement is that the UE and the PGW can indicate that they want
to enable the NBIFOM capability for the PDN connection. When both indicate
that they support and want to enable the NBIFOM capability, the UE
instantiates a logical interface and binds the PDN connection to this
interface.
##### 7.6.1.3.2 Addition of one access to a PDN connection
##### 7.6.1.3.2.1 General {#general-19 .H6}
The existing PDN connection establishment procedures are used. The only
additional requirement is that the UE includes an indication that indicates to
the network not to release the existing PDN connection. The UE does not
communicate any routing rules to PGW.
It is assumed that the additional PDN connection shares the same IP
address(es) with the initial PDN connection.
##### 7.6.1.3.3 IP Flow Mobility within a PDN connection
##### 7.6.1.3.3.1 General {#general-20 .H6}
##### 7.6.1.3.3.2 Network-initiated IP flow mobility {#network-initiated-ip-
flow-mobility .H6}
The PGW can decide to move an existing IP flow from WLAN access to 3GPP access
(or vice versa) at any moment, according to its own routing preferences and/or
according to extended PCC rules received from PCRF. The PGW is not required to
receive any kind of assistance information from the UE before requesting IP
flow mobility.
When the PGW wants to move an IP flow (e.g.) from 3GPP access to WLAN access:
1\. The PGW sends a \"redirection\" packet for this IP flow via the WLAN. This
\"redirection\" packet has the same 5-tuple as the associated IP flow and also
has TTL=1 so it is discarded by the UE before being delivered to the
associated application. The \"redirection\" packet may also have a short, pre-
defined payload (e.g. \"NBIFOM\") to distinguish it from other packets with
TTL=1.
2\. The \"redirection\" packet via WLAN access is perceived by the UE as a
request to transfer the IP flow to WLAN access. The UE determines whether to
accept or reject this redirection request (see clause 7.6.1.1.5).
3\. If the UE accepts the redirection request, it updates its Flow Binding
Table and responds as specified in clause 7.6.1.1.7. The UE transmits
subsequent uplink packets for the IP flow over WLAN access. When the PGW
determines that the redirection was accepted by the UE, it updates its own
Flow Binding Table and transmits subsequent downlink packets for the IP flow
over WLAN access. The PGW locally discards the ICMP Time-Exceeded packet (if
received) and does not forward it to Sgi. This completes the IP flow mobility
procedure.
4\. If the UE rejects the redirection request, it keeps using the 3GPP access
to transmit uplink packets for the IP flow and responds as specified in clause
7.6.1.1.7. When the PGW does not receive an uplink packet for the IP flow over
WLAN access (see NOTE 1 below), it determines that the redirection was
rejected by the UE so it keeps using the 3GPP access to transmit subsequent
downlink packets for the IP flow. The PGW marks the IP flow as non-
transferrable and follows the behaviour specified in clause 7.6.1.1.5.
NOTE: After sending the \"redirection\" packet, the PGW waits for a short time
period (a little longer than the round-trip time) to receive a response (see
clause 7.6.1.1.17). If the response is not received within this time period,
the PGW may resend the \"redirection\" packet.
##### 7.6.1.3.3.3 UE-initiated IP flow mobility {#ue-initiated-ip-flow-
mobility-1 .H6}
As specified in clause 7.6.1.1.1, when the UE wants to move one or more IP
flows to a target access, the UE can use either authorized transfer or
autonomous transfer. The UE uses authorized transfer for IP flows which can be
transmitted on the source access but, due to some routing rules in the UE,
these IP flows should preferably be transferred to a target access. On the
contrary, the UE uses autonomous transfer for IP flows which can no longer be
transmitted on the source access, e.g. because the source access becomes
unavailable.
**UE-initiated IP flow mobility with autonomous transfer**
When the UE uses autonomous transfer for one or more IP flows, there is no
signalling between the UE and the network. The UE simply moves the traffic of
the IP flows to the target access.
When the PGW observes that the UE has autonomously transferred to a target
access at least one IP flow, the PGW updates its Flow Binding Table and does
not transmit any more traffic to the source access. This is because an
autonomous transfer indicates to PGW that the source access is no longer
available in the UE.
Editor\'s note: In some scenarios, the UE may want to use autonomous transfer
but it has no uplink traffic to send to the target access. This is not a very
frequent scenario but could occur e.g. when the UE receives only a multicast /
broadcast IP flow via the source access. How autonomous transfer can be
executed in such scenario needs further study.
**UE-initiated IP flow mobility with authorized transfer**
When the UE uses authorized transfer to move an IP flow (e.g.) from 3GPP
access to WLAN access:
1\. The UE creates and sends a \"redirection\" packet for this IP flow via the
WLAN. This \"redirection\" packet has the same 5-tuple as the associated IP
flow and also has TTL=1 so it is discarded by the PGW before being forwarded
to Sgi interface. The \"redirection\" packet may also have a short, pre-
defined payload (e.g. \"NBIFOM\") to distinguish it from other packets with
TTL=1.
2\. The \"redirection\" packet via WLAN access is perceived by the PGW as a
request to transfer the IP flow to WLAN access. The PGW determines whether to
accept or reject this redirection request by performing the procedures
specified in clause 7.6.1.1.6 (PCC interactions) and in clause 7.6.1.1.5.
3\. If the PGW accepts the redirection request, it updates its Flow Binding
Table and responds as specified in clause 7.6.1.1.7. The PGW transmits
subsequent downlink packets for the IP flow over WLAN access. When the UE
determines that the redirection request was accepted, it updates its own Flow
Binding Table and transmits subsequent uplink packets for the IP flow over
WLAN access. The UE does not forward the ICMP Time-Exceeded packet (if
received) to upper layers (i.e. to the application associated with the IP
flow). This completes the IP flow mobility procedure.
4\. If the PGW rejects the redirection request, it keeps using the 3GPP access
to transmit downlink packets for the IP flow and responds as specified in
clause 7.6.1.1.7. When the UE determines that the redirection request was
rejected,, it keeps using the 3GPP access to transmit subsequent uplink
packets for the IP flow.
NOTE: After sending the \"redirection\" packet, the UE waits for a short time
period (a little longer than the round-trip time) to receive a response (see
clause 7.6.1.1.17). If the response is not received within this time period,
the UE may resend the \"redirection\" packet.
##### 7.6.1.3.4 Removal of an access from a PDN connection
The UE can remove an access from the existing PDN connection over WLAN and
3GPP access by applying the existing PDN connection release procedures.
##### 7.6.1.3.5 Loss of an access from a PDN connection
When the UE losses the WLAN connection, it shall use the UE-initiated IP flow
mobility procedure with autonomous transfer (see clause 7.6.1.3.3.3) to
transfer to 3GPP access all IP flows that were using the WLAN access. Note
that after the UE losses the WLAN connection, the PGW maintains the PDN
connection over WLAN for this UE for some time interval (until the TWAG or
ePDG initiates the release of the PDN connection over WLAN).
### 7.6.2 Solution 2 -- IP Flow Management Protocol
#### 7.6.2.1 Overview
The solution specified in this clause enables both the UE and the network to
trigger IP flow mobility using a user plane signalling protocol which is
supported between the UE and the P-GW.
##### 7.6.2.1.1 General
The solution is characterized by the following features:
1\. A new signalling protocol called IFMP (IP Flow Management Protocol) is
defined which is terminated in the UE and the P-GW. The protocol would be
specified by 3GPP and would be supported over UDP/IP or TCP/IP.
2\. The IFMP protocol is not a PDN connection establishment protocol (such as
DSMIPv6). The IFMP protocol is only used after a multi-access PDN connection
has been established (over 3GPP and WLAN accesses) in order to support UE
initiated and network initiated IP flow mobility over this multi-access PDN
connection.
3\. After a multi-access PDN connection has been established (over 3GPP and
WLAN accesses), the UE establishes an IFMP session with the P-GW. The IP
address of the P-GW is provided to the UE within the PCO during the PDN
connection establishment. During IFMP session setup the NBIFOM mode of
operation is negotiated. This mode can be (a) UE-controlled or (b) NW-
controlled.
4\. IFMP messages may be sent over either access technology according to the
preference of the initiating entity (UE or P-GW). This supports the capability
to always send IP flow routing rules over a \'target\' access technology in
the event of loss of coverage on one of the access technologies, even where
the target is using WLAN SCM.
5\. The use of IFMP can save specification and development effort and can
minimise the number of network elements impacted by the NB-IFOM feature.
6\. The solution is applicable to deployments that utilize either an S2a
interface (GTP or PMIPv6) or an S2b interface (GTP or PMIPv6) for WLAN
interworking.
7\. The solution places no extra demands on the AAA server (S2a SCM) or ePDG
(S2b) when moving flows between access technologies, in the case where bearer
configuration procedures do not need to be invoked. It can be noted that these
network elements may have been dimensioned, respectively for authentication
(EAP) and Ipsec tunnel management (IKEv2) and not for the potentially frequent
re-routing of IP flows which can be correlated with changing radio and load
conditions.
8\. It is an SA3 decision whether additional security is needed between the UE
and P-GW for the purposes of conveying IFMP messages. The IFMP signalling is
carried over a PDN connection so it can benefit from user plane security
mechanisms.
Editors note: It is an SA3 decision whether additional security is needed for
the purpose of conveying IFMP messages between the UE and P-GW and if so in
what form.
9\. IFMP messages are carried on the default bearer that is established on
each access, as is the case when carrying DHCP or DSMIPv6.
10\. To avoid charging or usage monitoring of IFMP packets, the PCC may be
configured to either avoid collecting charging data, prevent billing or
prevent usage monitoring for traffic associated with the IFMP port and P-GW IP
address.
11\. It is left to Stage 3 to decide if IFMP uses either a system port number,
a registered port or a dynamic port number. If IFMP uses a dynamic port
number, the port number is supplied to the UE along with IP address in PCO.
##### 7.6.2.1.2 NBIFOM capability discovery/negotiation
This solution requires NBIFOM capability negotiation: The UE provides an
NBIFOM capability (e.g. as part of PCO) when it requests a new PDN connection
and wants to enable NBIFOM for this PDN connection. Similarly, the PGW
provides a NBIFOM capability when it accepts the PDN connection request and if
the PGW supports NBIFOM and wants to enable NBIFOM for this PDN connection.
When both the UE and the PGW have provided an NBIFOM capability for a PDN
connection, only then do they apply the IP flow mobility procedures specified
in this solution, i.e. only then do they add an additional access to the PDN
connection and establish an IFMP session to support UE-initiated and NW-
initiated IP flow mobility procedures.
##### 7.6.2.1.3 Routing rules considerations
The format of the routing rules is as described in clause 7.7.3.5.2.
##### 7.6.2.1.4 Delivery of routing rules
Routing rules are exchanged between the UE and P-GW using IFMP.
##### 7.6.2.1.5 Co-existence of UE-initiated and Network-initiated handling
A choice is made between only allowing the UE to initiate IP flow mobility
(UE-controlled mode) or only allowing the network to initiate IP flow mobility
(NW-controlled mode). If the UE is provisioned with IFOM routing rules, the UE
requests UE-controlled mode during IFMP session setup. If the UE does not
request UE-controlled mode, the NW informs the UE that NW-controlled mode will
be used.
Editor\'s note: It is FFS if the network can override the UE\'s request for
UE-controlled mode.
##### 7.6.2.1.7 Co-existence with ANDSF traffic steering
The UE can use the ANDSF routing rules for IFOM when the UE-controlled mode is
negotiated. When the NW-controlled mode is negotiated, the UE does not use any
ANDSF routing rules (it uses the network-provided rules instead).
#### 7.6.2.2 System Impacts
This solution impacts only the UE, the PGW and the PCRF (when dynamic PCC is
deployed). In order to establish the IFMP session the IP address of the P-GW
is provided to the UE during PDN connection establishment.
If SA WG3 were to conclude that additional security needs to be put in place
between UE and P-GW then there would be additional architectural impact since
during establishment of the IFMP session the UE would need to establish a
security association with the P-GW. This would require the P-GW to exchange
signalling with an AAA server.
The UE shall be able to:
\- Negotiate the NBIFOM capability when a new PDN connection is established;
\- Trigger UE-initiated IP flow mobility;
\- Accept or reject NW-initiated IP flow mobility;
\- Support the UE-initiated and the NW-initiated IP flow mobility procedures;
\- The UE needs to support a new protocol, which may require additional
security protection, subject to SA WG3 decision.
The PGW shall be able to:
\- Negotiate the NBIFOM capability when a new PDN connection is established;
\- Support the PCC interactions;
\- Trigger network initiated IP flow mobility
\- Accept or reject UE-initiated IP flow mobility;
\- Support the UE-initiated and the NW-initiated IP flow mobility procedures;
\- The P-GW needs to support a new protocol, which may require additional
security protection, subject to SA WG3 decision
The PCRF shall be able to:
\- Support extended PCC rules.
#### 7.6.2.3 Procedures
##### 7.6.2.3.1 Overview of procedures
This clause provides description of how the IFMP protocol may be used in cases
where bearer establishment / modification is not required during IP flow
mobility.
The figure below presents an overview of the NBIFOM solution when the IFMP
protocol is applied.
Figure 7.6.2.3.1-1: Overview of NBIFOM with the IFMP protocol
The various steps in the figure are discussed below.
1\. The UE requests an initial PDN connection (e.g. via 3GPP access) by
including a requested APN and its NBIFOM capability. If the network supports
NBIFOM and if the network wants to activate NBIFOM procedures for the
requested APN, the network responds by including also an NBIFOM capability.
This indicates to UE that the PDN connection can (later) be converted to a
multi-access PDN connection by adding a second access. When the UE chooses to
add a second access is up to the UE implementation.
2\. At some point later, the UE decides to add a second access to the PDN
connection. Therefore, the UE sends a PDN connection request message (e.g. via
WLAN access) which includes a requested APN and an NBIFOM indication. This
indication informs the network that the request means to add a second access
to an existing PDN connection (not to handover an existing PDN connection).
The network response includes the IP address of the PGW associated with the
PDN connection. The UE is configured to allow traffic to this IP address only
from the IFMP process in the UE (this is a typical firewall configuration that
many UEs already support).
3\. After the multi-access connection is established, the UE initiates an IFMP
session with the PGW. This session can be over UDP/IP or TCP/IP and could be
secured with an appropriate scheme (e.g. UDP/DTLS, TCP/TLS). During the IFMP
session setup, the UE and the network negotiate an IFOM operating mode. The
IFMP session can be setup over any of the two accesses.
When the UE-initiated mode is negotiated:
4\. The UE is provisioned / configured with IFOM routing rules that can be
applied in the registered PLMN. Such rules are typically provided by H/V-ANDSF
or can be configured by the user.
5\. The UE determines the active IFOM rules (as specified in TS 23.402 [2], TS
24.312 [17]) and applies these active rules for routing uplink traffic across
the two accesses of the PDN connection. The UE also derives the associated
rules for downlink traffic routing and requests from PGW to install these
rules by using the IFMP protocol. The PGW is not expected to reject these
rules unless there are subscription limitations (e.g. the subscriber is not
allowed to route some traffic to 3GPP access). After the rules are installed
in the PGW, the UE and the PGW perform traffic steering based on the UE-
provided routing rules.
6\. At some point, the UE decides to move an active IP flow from a source
access to a target access. This is typically decided after an IFOM rule in the
UE changes e.g. because the UE enters a new tracking area, or the OPI value
received from RAN changes, etc. Since the UE has modified or new IFOM rules,
the UE updates the PGW with a modified or new set of associated rules for
downlink routing. After that, the UE and the PGW perform traffic steering
based on the modified / new rules and the IP flow is moved to the target
access.
7\. When the WLAN interface becomes unavailable in the UE (e.g. due to signal
loss, due to interface being disabled by the user, etc.), the UE sends an IFMP
message to PGW to inform it that WLAN has become unavailable. In this case,
the UE and the PGW will both use the 3GPP access only to route all traffic of
the PDN connection. If the WLAN access remains unavailable for a long time,
the network may decide to release the associated network resources (the
S2a/S2b bearers). In this case, the UE is informed by the network that the PDN
connection has only the 3GPP access active. This may be done with existing
session management signalling or with an IFMP message sent over the 3GPP
access.
8\. When the WLAN interface becomes available again, and assuming the WLAN
access is still active in the PDN connection, the UE sends another IFMP
message to inform the PGW that the WLAN access is available for traffic
routing. After that, the UE and the network perform again traffic steering
based on the previously installed routing rules and on the negotiated mode of
operation. If the IFOM rules changed in the UE when the WLAN interface was
unavailable, the UE updates the PGW with the new / modified rules.
When the NW-initiated mode is negotiated:
10\. When the NW-initiated mode is selected, the UE is not configured (by
HPLMN or user) with IFOM rules that can be applied in the registered PLMN. If
the UE is configured with IFOM rules by the VPLMN, the UE ignores these rules
when the NW-initiated mode is selected.
The PGW determines (e.g. receives from PCRF) a set of routing rules that
should be applied for traffic steering across 3GPP and WLAN access.
11\. By using the IFMP protocol, the PGW installs in the UE the corresponding
set of routing rules that should be used for uplink traffic steering. The UE
is not expected to reject these rules (assuming both accesses are available
and in good radio conditions). After that, both the UE and the PGW perform
traffic steering across 3GPP and WLAN access based on the PGW-provided set of
routing rules.
12\. At some point, the network decides to move an active IP flow from a
source access to a target access. This is typically decided by PCRF which can
push new/modified PCC rules to PGW (although not yet clear how the PCRF could
take such decisions without negatively impacting the user experience). After
the PCC rules in the PGW change, the PGW updates the UE with a corresponding
set of modified / new set of rules for uplink routing. After that, the UE and
the PGW perform traffic steering based on the modified / new rules and the IP
flow is moved to the target access.
13\. Same as step 7.
14\. Same as step 8.
##### 7.6.2.3.2 Detailed description of procedures
This clause includes a detailed description of procedures. It augments the
above overview clause by providing additional procedures explaining how IFMP
is used in conjunction with bearer establishment / modification procedures, as
may be relevant for example when moving an IP flow that requires a GBR bearer.
##### 7.6.2.3.2.1 Initial PDN connection establishment over first access
{#initial-pdn-connection-establishment-over-first-access-3 .H6}
##### 7.6.2.3.2.1.1 General {#general-22 .H6}
The existing PDN connection establishment procedures defined in TS 23.401 [8]
and TS 23.402 [2] are used. The only additional requirements are that:
\- The UE and the PGW can indicate and enable NBIFOM capability for the PDN
connection.
##### 7.6.2.3.2.2 Addition of second access to a PDN connection {#addition-of-
second-access-to-a-pdn-connection .H6}
##### 7.6.2.3.2.2.1 General {#general-23 .H6}
Figure 7.6.2.3.2.2.1-1: Addition of a second access technology for the PDN
connection
  1. The UE establishes PDN connectivity over the second access technology using the initial attach or UE initiated PDN connectivity request procedures specified in TS 23.401 [8] or TS 23.402 [2]. PCO is used to provide the IP address at the P-GW to be used by the UE when conveying messages using IFMP.
2-3. An IFMP session is established between the UE and PGW. During the IFMP
session establishment, the NBIFOM operating mode (e.g. UE-initiated or NW-
initiated) may be negotiated. Alternatively, the NBIFOM operating mode may be
negotiated during the establishment of the PDN connection, e.g. by using PCO.
The IFMP messages are carried within the established PDN connection and thus
utilize the security measures provided by the PDN connection. If additional
security measures are required for IFMP signalling and, if so, what security
procedures would be required, should be studied and decided by SA WG3.
4\. IP flow routing rules are exchanged using either the Network initiated IP
flow mobility procedure of clause 7.6.2.1.3.3.2 or using the UE initiated IP
flow mobility procedure of clause 7.6.2.1.3.3.3.
##### 7.6.2.3.2.3 IP Flow Mobility within a Multi-Access PDN connection {#ip-
flow-mobility-within-a-multi-access-pdn-connection .H6}
##### 7.6.2.3.2.3.1 General {#general-24 .H6}
##### 7.6.2.3.2.3.2 Network-initiated IP flow mobility {#network-initiated-ip-
flow-mobility-1 .H6}
Figure 7.6.2.3.2.3.2-1: IP flow mobility within a Multi-Access PDN connection
initiated by Network
1\. The UE has a multi-access PDN connection provided over both 3GPP and TWAN.
2\. The PCRF determines that the routing rules need updating and informs the
P-GW of the routing rules using the IP-CAN Session Modification procedure.
3\. The P-GW uses IFMP to send an Authorise Routing Rule Request message to
the UE which includes the new routing rules. This message also indicates to
the UE if the routing rules can be applied immediately or after receiving a
Move Flow Request message.
4\. The UE provides a response to the P-GW using an Authorise Routing Rule
Response message which is used to either acknowledge or reject the new routing
rules. Steps 5 and 6 below are required only when the Authorise Routing Rule
Request indicated that the routing rules can only be applied by the UE after
receiving a Move Flow Request message.
5\. The PDN GW may perform one or more bearer modification or bearer
deactivation procedures for those flows that were moved from the WLAN access
to the 3GPP access and/or for those flows that were moved from the 3GPP access
to the WLAN access according to existing procedures defined in TS 23.402 [2]
and TS 23.401 [8].
6\. The PGW instructs the UE to apply the new routing rules using the IFMP
Move Flow Request message, where these new routing rules were negotiated
previously in steps 3-4.
It would be left to Stage 3 to determine whether the UE should additionally
provide the P-GW with a response to the Move Flow Request message, e.g. to
confirm that the message has been received.
7\. The P-GW informs the PCRF of the completion of the IP‑CAN Session
Modification procedure.
##### 7.6.2.3.2.3.3 UE-initiated IP flow mobility {#ue-initiated-ip-flow-
mobility-2 .H6}
Figure 7.6.2.3.2.3.3-1 : IP flow mobility within a Multi-Access PDN connection
initiated by UE
1\. The UE has a multi-access PDN connection provided over both 3GPP and TWAN.
2\. The UE sends an Authorise Routing Rule Request message to the P-GW using
IFMP, which includes the routing rules requested by the UE.
3\. The PDN GW initiates the IP-CAN Session Modification Procedure with the
PCRF and provides the updated routing rules to the PCRF. The PCRF determines
whether the routing rules satisfy policy and if so the PCRF accepts the
updated routing rules and notifies the P-GW.
4\. The P-GW sends an Authorise Routing Rule Response message to the UE to
indicate acceptance of the rule. This message also indicates to the UE if the
routing rules can be applied immediately or after receiving a Move Flow
Request message. Steps 5 and 6 below are required only when the Authorise
Routing Rule Response indicates that the routing rules can only be applied by
the UE after receiving a Move Flow Request message.
5\. The PDN GW may perform one or more bearer modification or bearer
deactivation procedures for those flows that were moved from the WLAN access
to the 3GPP access and/or for those flows that were moved from the 3GPP access
to the WLAN access.
6\. The PGW instructs the UE to apply the new routing rules using the IFMP
Move Flow Request message, where these new routing rules were negotiated
previously in steps 3-4.
It would be left to Stage 3 to determine whether the UE should additionally
provide the P-GW with a response to the Move Flow Request message, e.g. to
confirm that the message has been received.
7\. The accepted routing rules are applied by the UE and PDN GW and the PCRF
is informed of the completion of the IP‑CAN Session Modification procedure.
##### 7.6.2.3.2.4 Loss of an access from a PDN connection {#loss-of-an-access-
from-a-pdn-connection-1 .H6}
When the UE loses connectivity on one access, it shall use IFMP to signal to
the PGW that one access is not available anymore. After that, the UE and the
PGW route all traffic on the remaining access. The routing rules in the UE and
PGW are not used but are not deleted. When connectivity is recovered on the
unavailable access, if the routing rules in the UE remained the same while
WLAN was unavailable, the UE shall use IFMP to signal to the PGW that the
access is again available. After that, the UE and the PGW route traffic based
on the routing rules that have been previously negotiated. If the routing
rules in the UE were changed while WLAN was unavailable, the UE shall update
the network with the new rules.
## 7.7 IP flow mobility policies
### 7.7.1 Introduction
The solutions for multi access PDN connectivity and IP flow mobility is
classified to DSMIP based case and PMIP based case. However, there are common
enhancements which are independent of the mobility protocol and can be used
for both DSMIP and PMIP based cases. This clause discusses the enhancements
that are needed for providing inter-system mobility policies for IP flow
mobility.
### 7.7.2 ANDSF enhancements
In Rel-8 the ANDSF is used to provide the UE with two sets of information:
\- Access Network Discovery;
\- Inter System Mobility policies.
Some enhancements are required for the inter system mobility policies so that
the operator can control through which access technology IP flows will be
routed.
NOTE 1: The enhancements defined in this clause are independent of the
mobility protocol used for IP flow mobility.
To enable IP flow level control IP flow class specific inter system mobility
policies are introduced. The inter-system mobility policies provided by the
operator can be defined per APN, per IP flow class under any APN or per IP
flow class under a specific APN. As described in clause 5, the policies apply
with the following priority order:
1\. Policies per IP flow class under a specific APN.
2\. Policies per IP flow class under any APN.
3\. Policies per APN.
The IP flow class can be identified either via the media type (e.g. audio) or
the IMS Communication Service Identifier (e.g. MMTEL) for IMS applications or
via the respective 5-tuple (IP source address, IP destination address, source
port, destination port, protocol type) for any type of application. Any
combination of these can also be possible. The 5-tuple can have also wildcard
values in any of the possible fields.
If a given IP flow matches more than one policy, the policy with higher
priority takes precedence.
NOTE 2: The policies indicate the list of prioritized accesses for the class
of IP flows. The list includes one or more accesses as the appropriate access
and may include one or more restricted accesses. For example the ANDSF may
indicate that 3GPP is the highest priority access for a given IP flow class
and WiFi is the highest priority access for another IP flow class.
NOTE 3: There is no intention to define a mechanism for informing the ANDSF
about the IP address(es) and port(s) used by the UE. When establishing the
connection with the ANDSF, the UE indicates to the ANDSF its capability to
support IP flow class specific inter system mobility policies.
Based on the policies provided by the ANDSF, the UE requests to the PDNGW/HA
to route IP flows to the appropriate access.
NOTE 4: The policies provided by the ANDSF do not preclude the UE to request
to route IP flows belonging to the same class of flows through different
accesses depending on their availability. For example, the routing can be
based on the dynamic availability of the access for a given IP flow (e.g.
network congestion as in case of the use case 2 described in clause 4.2).
Static policies can be configured in the UE if ANDSF is not deployed. How this
is done is out of the scope of this study.
### 7.7.3 PCC based mechanism
#### 7.7.3.1 Solution A: PCC rules related with the Access Type --
Notifications related with the Access Type
##### 7.7.3.1.1 Definitions
An access represents all the resources supporting a PDN connection over an
access e.g.
\- For an access over a 3GPP access: S5/S8 tunnels and the corresponding radio
bearers over a 3GPP radio. Any kind of 3GPP RAN (GERAN, UTRAN, E-UTRAN) may
support the 3GPP access of a Multi-access PDN connection.
\- For an access over a TWAN: S2a tunnels and the corresponding resources over
the TWAN.
\- For an access over a Non Trusted access: S2b tunnels and the corresponding
IKE/Ipsec resources.
A Multi-access PDN connection is a PDN connection that may simultaneously be
supported over multiple accesses (i.e. 3GPP and WLAN).
An Access Type (AT) corresponds to an IP-CAN-Type (3GPP-EPS versus Non3GPP-
EPS) possibly (in case of Non 3GPP access) refined by a RAT-Type (e.g. WLAN).
##### 7.7.3.1.2 Overview
This clause focuses on the PCC impacts of NBIFOM, i.e. on the key issue #7.
The PCC mechanisms that are described are meant to be applicable in following
cases:
\- Usage of either S2a or S2b as NBM reference point for the Non 3gpp access
of an IP-CAN session.
NOTE: The PCC interface is meant to be independent of the signalling means
between the PGW and the UE
\- UE-initiated NBIFOM and Network-initiated NBIFOM.
Editor\'s note: the current version of this solution focuses on GTP based NBM.
Impacts of PMIP based NBM are FFS
The content of this clause is meant to apply to both cases of User Plane based
signalling between UE and PGW about IP flow Routing and of Control Plane based
Routing Rules signalling between the UE and the network. It is assumed to act
as the baseline for other PCC related solutions.
Only one IP-CAN session (only one Gx session) is associated with a Multi-
access PDN connection regardless of the number of access it is using
Due to NBIFOM, the Policy control interface (Gx) between the PCRF and the PGW
is modified as follows:
\- The PCRF can control whether a given IP-CAN session may use NBIFOM (e.g. it
may reject the addition of an access to a PDN connection even though both the
UE and the network support NBIFOM)
\- For its decision related with NBIFOM, the PCRF decision may rely on network
capabilities, user subscription (SPR) and on local policies.
\- The PGW can notify the PCRF with which accesses currently supports an IP-
CAN session and for each of these accesses provides the PCRF with information
such as the IP-CAN Type, RAT-Type, the UE location Information. This mechanism
is controlled by the PCRF (event reports set by the PCRF)
\- The PCRF may decide that NBIFOM is no more possible for an IP-CAN session
(e.g. when some traffic threshold has been crossed on an access). When NBIFOM
is not possible, the PCRF indicates to the PGW the access to release. Proper
signalling is sent to the UE for the UE not to retry immediately adding the
access to the corresponding PDN connection.
\- The PCRF can provide the PGW with Access information. The Access
information may correspond to rules about the access over which to route some
traffic, but also with (e.g. charging and usage monitoring) requirements
associated with the usage of a given Access Type.
\- The PGW can provide the PCRF with notifications of UE requests for IP flow
mapping to an Access Type.
\- For Network-initiated NBIFOM:
\- the PCRF can control the access routing decisions for the IP flow(s) by
providing the PGW with PCC rules that include Access rule information for a
SDF.
\- the PGW/PCEF generates the signalling to the UE that corresponds to the
Access rule information for SDF (Routing Rules in case of Control Plane
Routing Rules signalling / User Plane based signalling ).
\- For UE-initiated NBIFOM:
\- when the PCRF has set the relevant event trigger, the action described in
the following are executed ,
\- the PGW notifies the PCRF with the mapping requested by the UE between IP
Flows and access .
\- the PCRF analyses and authorizes the requested mapping between IP Flows and
access and creates/modifies/deactivates corresponding PCC rules
\- the PCRF provides the PGW with PCC rules that includes the access rule
information for a IP-CAN session fulfilling the UE-initiated IP flow mobility
request
\- the PGW/PCEF generates the signalling to the UE that corresponds to the
Access rule information for SDF (Routing Rules in case of Control Plane
Routing Rules signalling / User Plane based signalling ).
\- Usage Monitoring: As per Rel-12 TS 23.203 [7], usage monitoring on Gx is
supported on a Monitoring Key (MK) granularity. This applies also for NBIFOM.
To support Usage Monitoring per Access Type the PCRF shall be able to set
different Usage Monitoring Keys for traffic exchanged on different Access.
The data model of an IP-CAN session is modified as follows:
The information handled over Gx is split up into:
\- Parameters associated with an IP-CAN session: IMSI, IP address / IPv6
Prefix, APN, APN-AMBR, etc.
\- Parameters associated with an access: IP-CAN Type, RAT-Type, Location
information (Cell Id, TWAN Id, etc.), etc.
\- Parameters associated with a PCC rule: SDF description, Rating group, QCI,
ARP, GBR, gate info.
PCC rules on Gx are evolved to include Access information to enable the
control over which access(s) of a Multi-access PDN connection IP traffic
corresponding to the SDF may be sent. The PCC rules are thus used to map
traffic both to the right access as well as to the right bearer.
The access over which IP traffic corresponding to the SDF may be sent is
identified by an Access Type (AT).
Upon reception of a Gx request related with a PCC rule containing Access
information, the PGW.
\- translates the Access information into signalling sent to the UE: via
Routing Rule related signalling in case of Control Plane Routing rules
Signalling, and via a Re-direct Packet in case of User Plane routing rules
signalling.
\- determines the target access(s) based on Access Type (AT) and IP flow
filter information in PCC rules.
The PGW shall obey to the PCC rules received from the PCRF. If Routing Rule
signalling exchanged with the UE imply that the SDF of a PCC rule cannot be
carried by any Access type(s) allowed by this PCC rule, then the PGW shall
report a failure of this PCC rule to the PCRF.
Access information transferred over Gx may be supported by following
alternatives.
1\. PCC rules associate a SDF with an allowed Access Type. When the
corresponding access is released, event reporting from PGW is needed to allow
the PCRF to change the corresponding PCC rules.
2\. PCC rules may associate a SDF with multiple allowed Access Types. When one
of the corresponding access is released, event reporting from PGW is not
required. This alternative is further described in clause 7.7.3.5.
Editor\'s note: Whether one (and which one) or both alternatives will be
standardized is FFS.
##### 7.7.3.1.3 Void
##### 7.7.3.1.4 Flows
NOTE: The whole clause focuses on the Gx additions related with NBIFOM.
##### 7.7.3.1.4.1 Set up of an IP-CAN session {#set-up-of-an-ip-can-session
.H6}
Figure 7.7.3.1.4.1-1: Set up of an IP-CAN session
1\. The GW/PCEF receives a request for creating a PDN Connection. The UE may
provide a request for NBIFOM. The GW/PCEF also receives indication(s) whether
the MME, SGSN, SGW are NBIFOM capable.
2\. The GW/PCEF sends a request for IP-CAN session establishment. The GW/PCEF
provides the IP-CAN-Type, RAT-Type, User Location Information and may provide
an indication about whether NBIFOM is supported by the UE and the network.
3\. The PCRF may download the subscription profile
4\. PCRF makes policy decisions including on whether NBIFOM may apply to the
PDN. These decisions may take into account UE and network to support of NBIFOM
but may consider other input (such as the APN, the IMSI range etc.).
5\. The PCRF sends an Acknowledge of IP‑CAN Session establishment) to the
GW/PCEF. The Acknowledge of IP‑CAN Session establishment may provide
\- PCC rules (in case when PCC rules associating a SDF with multiple allowed
Access Types as described in clause 7.7.3.1.4 containing Access information to
the PGW), and/or
\- subscription to Event Triggers related with NBIFOM such as events asking to
notify the PCRF of the addition / deletion of an access supporting an IP-CAN
session or asking to notify the PCRF of the UE requests for IP flow mapping to
an Access Type.
6\. The GW/PCEF replies to the request for creating a PDN Connection. When the
UE has indicated its support of NBIFOM, the PGW indicates to the UE the
network decision about the support of NBIFOM for the IP-CAN session. This is
relayed by the serving node (e.g. MME/SGSN and SGW, / TWAG / ePDG).
7\. The GW/PCEF creates bearers as required by the PCC rules received from the
PCRF. Furthermore if it has received Access information from the PCRF, the
PGW/PCEF generates the signalling to the UE that corresponds to the Access
information for SDF (Routing Rules in case of Control Plane Routing Rules
signalling).
8\. Step 17 of 7.2 of TS 23.203 [7] may apply if the PCRF has requested an
acknowledgement based on PCC rule operations: the GW (PCEF) sends the IP‑CAN
Session Establishment Acknowledgement to the PCRF in order to inform the PCRF
of the activated PCC rules result.
##### 7.7.3.1.4.2 Addition / removal of an access leg to an IP-CAN session
{#addition-removal-of-an-access-leg-to-an-ip-can-session .H6}
NOTE 1: This clause assumes this is neither the addition of the first access
leg nor the removal of the last Access leg. It also assumes NBIFOM is allowed
for the PDN connection / IP-CAN session.
Figure 7.7.3.1.4.2-1: Addition / removal of an access to an IP-CAN session
  1. The UE requests that an access is added / removed to the PDN connection. The PGW receives an indication that an access should be added / removed to the PDN Connection.
NOTE 2: No IP address / IPv6 Prefix allocation / de-allocation is carried out
when an access is added / removed to a PDN connection.
2\. When the PCRF has set the corresponding Event Trigger (as defined in
7.7.73.1.4.1), the PGW notifies the PCRF of the addition / removal of an
access with, in case of an access addition, an indication of the RAT-Type, IP-
CAN Type, Location information, etc. of this new access. Steps 3 and 4 below
apply only if step2 takes place.
3\. PCRF makes a policy decision which includes validation of whether NBIFOM
is allowed, and generates/modifies PCC rules with appropriate Access Type
values.
4\. The PCRF sends an Acknowledge of IP‑CAN Session modification to the
GW/PCEF The answer may contain new PCC rules including new Access rule
information determined based on the addition / removal of the access.
The PCRF may ask the PGW to release / not to accept the set-up of a specific
(IP-CAN Type, RAT Type) access supporting an IP-CAN session.
5\. The PGW sends an acknowledgement to the UE. In case of the addition of an
access, this indicates whether the addition of the access has been accepted by
the network (PCRF decision). In the case where this is because NBIFOM is not
allowed by the subscription, proper signalling (error cause) is sent to the UE
to prevent the UE from repeating its attempt to set NBIFOM. For example the UE
may not be allowed to retry adding an access on a PDN connection to this APN
until it reboots.
6\. The GW/PCEF creates / modifies / updates bearers as required by the PCC
rules received from the PCRF.
7\. If the PCRF has requested an acknowledgement based on PCC rule operations:
the GW (PCEF) sends the Notification of PCC rule activation to the PCRF in
order to inform the PCRF of the activated PCC rules result.
After the procedure of Addition / removal of an access to an IP-CAN session
has completed, the PGW/PCEF may generate the signalling to the UE (Routing
Rules in case of Control Plane Routing Rules signalling / User Plane based
signalling )that corresponds to the Access information received from the PCRF.
##### 7.7.3.1.4.3 NW-initiated IP Flow Mobility (PCRF-initiated IP-CAN Session
Modification) {#nw-initiated-ip-flow-mobility-pcrf-initiated-ip-can-session-
modification .H6}
Figure 7.7.3.1.4.3-1: NW-initiated IP Flow Mobility
1\. The PCRF makes a policy decision to initiate IP flow mobility
2\. The PCRF sends the Policy and Charging Rules Provision (PCC Rules, etc) to
the PCEF. The PCC rules may contain Access information.
3\. The GW/PCEF enforces the decision. The GW/PCEF generates Routing Rules as
applicable based on the received Access information within the PCC decision.
4\. Based on Access information received from the PCRF, the PGW/PCEF generates
the relevant signalling towards the network. This may include signalling to
the UE the Routing Rules and/or creation / modification / update of bearers on
S5/S8 and/or S2a/S2b as needed. The UE acknowledges or rejects the Routing
Rules
5\. The PCEF sends Acknowledge Policy and Charging Rules Provisioning (accept
or reject of the PCC rule operation(s)) to the PCRF
##### 7.7.3.1.4.4 UE-initiated IP Flow Mobility (PCEF-initiated IP-CAN Session
Modification) {#ue-initiated-ip-flow-mobility-pcef-initiated-ip-can-session-
modification .H6}
Figure 7.7.3.1.4.4-1: UE-initiated IP Flow Mobility
1\. The PGW receives a Routing Rule request from the UE (or an IP flow
mobility related signalling over the User plane).
2\. The GW/PCEF provides an event report to the PCRF (if PCRF had subscribed
to the corresponding event). The PCEF forwards the requested IP flow mapping
to an Access Type to the PCRF.
3\. PCRF analyses the information (requested IP flow mapping to an Access
Type), makes a policy decision and may generate/modifies PCC rules with
appropriate Access Type values.
4\. The PCRF sends an Acknowledge of IP‑CAN Session modification (PCC Rules
etc) to the GW/PCEF.
5\. The PGW sends an acknowledgement to the UE.
6\. The GW/PCEF creates/modifies/updates bearers on S5/S8 and/or S2a/S2b as
needed.
##### 7.7.3.1.5 Charging impacts
When one Gy session per IP-CAN session is applicable, the Charging interfaces
of the PGW are upgraded to support NBIFOM:
\- to support the notification to the charging entities (OCS/OFCS) that an IP-
CAN session is simultaneously associated with different access that correspond
to different values of parameters such as IP-CAN Type, RAT-Type, Location:
\- This means event reporting on Gy is defined for the PGW to be able to
report when an access is added to / removed from a Multi-access PDN
connection.
\- The CDR (\"Call Detailed Report\") associated with an IP-CAN session that
supports NBIFOM is updated to track when NBIFOM has occurred and to store the
corresponding parameters (IP-CAN Type, ...) of the various access supporting
the NBIFOM PDN connection.
Editor\'s notes: It is FFS whether this means that when one Gy session per IP-
CAN session is deployed, quota per Rating Group and access type needs to be
negotiated over Gy.
According to Rel‑12 TS 23.203 [7], the PCEF reports usage information for each
charging key (CK) value or each charging key/service identifier (CK/SI)
combination. This applies also for NBIFOM. If charging per PDN Connections is
used, traffic from different accesses may be included in the report for a CK
or combination of CK/SI. In order to separate usage according to access leg,
PCC rules for different access types need to have different CK or CK/SI.
According to Rel‑12 TS 23.203 [7], credit management operates on a per
charging key basis. This applies also for NBIFOM. Quota for a specific CK may
be consumed by traffic travelling on different accesses. In order to separate
quota management per access type if charging per PDN Connections is used,
different CK need to be used for different access types.
#### 7.7.3.2 Solution B: Support of Traffic sharing for a SDF
##### 7.7.3.2.1 Overview
This solution builds upon the solution described in clause 7.7.3.5 where the
IP traffic identified by Access information within a PCC rule may be
associated between different access types with a strict priority: all traffic
is sent on the allowed access type of the highest priority that is available)
with additions described in this section.
The IP traffic identified by Access information (within a PCC rule) may share
multiple access Types. When the IP traffic identified by a PCC rule may be
shared between multiple access types, this means that, at a given time,
different IP flows of the IP traffic identified by the rule may be carried
over different access.
Nevertheless an IP flow cannot be shared i.e. all packets of an IP flow shall
be sent on a single access.
NOTE: This is to avoid the reordering of the packets (of e.g. a TCP
connection) that may occur when different accesses correspond to different
transfer delays.
When IP traffic identified by a PCC rule may be shared between different
access, the PCRF sends \"traffic-distribution\" information to the PGW to
indicate \"traffic-distribution\" information. Such information:
\- Indicates per allowed access type, a \"nominal-weight\" that is used to
determine which proportion of the IP traffic identified by the PCC rule is to
be sent on the different access currently supporting an IP-CAN session. The IP
flows corresponding to a PCC rule (SDF) are spread over the different accesses
(that are currently established) with a proportion corresponding to the ratio
of the nominal weight associated with these accesses in the PCC rule.
NOTE: When IP traffic identified by an a PCC rule may be shared between
different access, PGW and UE decisions may lead to different access used in
the UL and in the DL direction.
When NBIFOM applies to an IPCAN session, a PCC rule associates a SDF with:
\- \"common\" (access type independent) parameters such as Rule Precedence,
QCI, ARP.
\- (Access information) parameters per Access Type such as the Rating Group, a
potential Monitoring Key and a weight for load sharing (between the
access(es)) of IP flows of the SDF. A weight of \"0\" indicates that the
Access Type is actually forbidden.
(Control Plane Routing Rules signalling) The routing rules provided to the UE
in case there is a Control Plane signalling of these routing rules to the UE
has following format.
Table 7.7.3.2.1-1: Routing rules
+-----------+-----------+-----------+--------+-----------+--------+ | Routing | Routing | Routing | Weight | Routing | Weight | | Rule | Filter | Access | | Access | | | | | Type-1 | | Type-2 | | | Priority | | | | | | +-----------+-----------+-----------+--------+-----------+--------+ | a | De | 3GPP | x | WLAN | 0 | | | scription | | | | | | | of IP | | | | | | | flows... | | | | | +-----------+-----------+-----------+--------+-----------+--------+ | b | De | 3GPP | x | WLAN | x | | | scription | | | | | | | of IP | | | | | | | flows... | | | | | +-----------+-----------+-----------+--------+-----------+--------+ | c | De | 3GPP | 0 | WLAN | x | | | scription | | | | | | | of IP | | | | | | | flows... | | | | | +-----------+-----------+-----------+--------+-----------+--------+
NOTE: In the example above, flows identified by the first Routing Rule cannot
be sent over WLAN, flows identified by the Third Routing Rule cannot be sent
over 3GPP while there is an even share of IP flows between 3GPP and WLAN for
flows identified by the second Routing Rule.
The Routing Rule priority in the Routing Rule sent to the UE is derived from
the PCC rule priority.
Editor\'s note: How in this solution the GBR associated with a PCC rule is
shared between GBR bearers on the different access is FFS.
#### 7.7.3.3 Solution C: Support of APN-AMBR per Access Type
##### 7.7.3.3.1 Overview
This solution builds upon the solution described in clause 7.7.3.1 with
additions described in this clause.
Two levels of DL APN-AMBR are defined for an IP-CAN session:
\- APN-AMBR per IP-CAN session that controls the overall DL traffic sent for
the IP-CAN session.
\- (new feature) APN-AMBR per access Type of an IP-CAN session that controls
the DL traffic sent over an Access type within the IP-CAN session.
The APN-AMBR per Access Type is defined at command level.
The PCRF may subscribe to the event associated with the APN-AMBR being reached
on a given access Type. The associated reporting from the PGW may allow the
PCRF to change policies with regard to the access selection for SDF.
#### 7.7.3.4 Solution D: Access Type depending on TWAN-Id
##### 7.7.3.4.1 Overview
This solution builds upon the solution described in clause 7.7.3.1 with
additions described in this clause.
It consists, for the case of TWAN, on the Access Type possibly referring to a
TWAN-Id (as defined in TS 23.402 [2] clause 16.1.7) on top on the information
listed in clause 7.7.3.1. The TWAN-Id information that may be used as part of
the Access Type is:
\- the SSID and / or
\- the TWAN PLMN-ID or on the TWAN Operator Name.
#### 7.7.3.5 Solution E: PCC rules associating a SDF with multiple allowed
Access Types
##### 7.7.3.5.1 Overview
This solution builds upon the solution described in clause 7.7.3.1 with
additions described in this clause.
As the lifetime a of a WLAN based access may be short and as the load/quality
conditions may often vary, when an IP-CAN session can support NBIFOM it is
more efficient for the PCRF to provide the PGW with PCC rules referring to
multiple allowed Access Types including access types that are not yet
established.
NOTE: This is to avoid the PCEF having to report to PCRF and PCRF having to
update Access information each time a WLAN access (leg) is added / removed or
each time the UE issues signalling related with changes of radio load/quality
conditions. This is further discussed in Annex C.
PCC rules may associate a SDF with multiple allowed Access Types, indicating a
relative priority between the different allowed Access Type. When the PGW
receives such a PCC rule, it generates the corresponding Routing Rule. If no
access identified by a rule is established, then the PGW rejects the
corresponding PCC rule.
Such PCC rule may have one set of parameters for e.g. charging and monitoring
control (Rating Group etc) that apply to all access types, or a set of
parameters per Access Type (e.g. Rating Group or Usage Monitoring per Access
Type).
When NBIFOM applies to an IPCAN session, a PCC rule associates a SDF with:
> \- \"common\" (i.e. access type independent) parameters such as Rule
> Precedence, QCI, ARP.
>
> \- Access information parameters per Access Type such as the Rating Group, a
> potential Monitoring Key and an access type priority.
When one of the accesses identified by a rule (referring to multiple Access
Types) is established or released, event reporting from PGW is not required
(but possible).
When the PCRF creates a PCC rule with multiple allowed Access Types, as long
as one access of an Access Type allowed by the PCC rule is established, the
PGW gets responsible to:
\- React upon failure / recovery of an access.
\- If the UE issues an IP flow mobility request (via Control Plane or User
plane Routing Rules signalling), the PGW may autonomously decide whether to
accept the UE request (e.g. depending on whether the UE request is compatible
with Access information in existing PCC rule).
When none of the accesses identified by a PCC rule is established any more,
the PGW reports a failure for this PCC rule.
The PGW is responsible of managing bearers according to SDF mobility (between
accesses allowed by the PCC rules): the PGW creates / modifies / deletes
bearers on the various accesses supporting the PDN connection to comply with
the QoS requirements for SDF and with Routing Rules negotiated with the UE. At
a given time a SDF is bound to only one bearer (while due to flow mobility
between accesses, the bearer a SDF is bound to may change upon time).
##### 7.7.3.5.2 Structure of the Routing Rule
(Control Plane Routing Rules signalling) The routing rules provided to the UE
in case there is an Control Plane signalling of these routing rules to the UE
has following format.
Table 7.7.3.5-1: Routing rules
+--------------+----------------+----------------+----------------+ | Routing Rule | Routing Filter | Routing Access | Routing Access | | | | Type-1 | Type-2 | | Priority | | | | +--------------+----------------+----------------+----------------+ | a | Description of | 3GPP | WLAN | | | IP flows... | | | +--------------+----------------+----------------+----------------+ | b | Description of | WLAN | 3GPP | | | IP flows... | | | +--------------+----------------+----------------+----------------+ | c | Description of | 3GPP | none | | | IP flows... | | | +--------------+----------------+----------------+----------------+
NOTE: In the example above, flows identified by the third Routing Rule cannot
be sent over WLAN, flows identified by the other Routing Rules may be sent
over either 3GPP or WLAN. 3GPP is the Preferred access Type for the flows
identified by the first Routing Rule while WLAN is the Preferred access Type
for the flows identified by the second Routing Rule.
Editor\'s note: whether this structure applies to UE initiated Routing Rule
negotiation is FFS.
##### 7.7.3.5.3 Negotiation of Routing rules between the UE and the PGW
When the PGW initiates a Routing Rule signalling with the UE, the UE decides
whether this request should be fully accepted, partially accepted or rejected.
When the Routing Rule issued by the PGW has been rejected the corresponding
PCC rule is assumed to have failed. Otherwise, even in case of a partial
acceptance the setting of the corresponding PCC rule is assumed to have
succeeded.
In case the request is not fully accepted, the UE answers back to the PGW,
with for each proposed Access Type a reason that indicates whether it is
related with \"semi-permanent\" UE policies or related with temporary
restrictions (typically radio quality/load, but the UE does not need to
indicate what the temporary restriction is). When conditions for both \"Semi-
permanent\" rejection and for temporary restrictions apply to an Access Type,
the \"Semi-permanent\" reason takes precedence (is signalled back to the PGW).
NOTE: Which UE policies are considered (ANDSF, User preferences, etc.) are to
be described in other parts of the TR.
If the partial acceptance is related with temporary restrictions (typically
radio quality/load) on an access type, the UE stores the full Routing Rule
received from the PGW (including the access with temporary restrictions) and
when the temporary restrictions do not apply anymore and the access preferred
by the network becomes available, the UE issues a Routing Rule request to
indicate its full support of the initial network request.
For example, if the Routing Rule sent by the network refers to a preferred
Access Type and to a fall-back Access Type:
\- When no Access Type sent by the network is allowed by UE policies and by
radio conditions, the UE answers with a rejection.
\- Otherwise when all Access Types sent by the network are allowed by UE
policies and by radio conditions, the UE answers with a full acceptance.
\- Otherwise the UE answers with a partial acceptance, indicating which access
type it rejects and why (\"semi-permanent\" or temporary restrictions\").
\- When the UE has accepted only the fall-back Access Type indicating
\"temporary restrictions\" for the other (preferred) Access Type the UE stores
the full Routing Rule received from the PGW. When the preferred Access Type
becomes available, the UE takes the initiative of a Routing Rule request to
bring back the preferred access type.
\- When the UE has indicated \"semi-permanent\" restriction for an Access
Type, the UE does not store the part of the Routing Rule received from the PGW
that corresponds to the restricted Access Type.
## 7.8 Co-existence of UE-initiated and Network-initiated
### 7.8.1 General
This clause contains alternative solutions that handle the issue of co-
existence of UE-initiated and NW-initiated IP flow mobility.
The UE may or may not have ISRP for IFOM rules. The UE and the PGW may utilize
separate and independently triggers for IP flow mobility.
### 7.8.2 Solution A
The UE may trigger UE-initiated IP flow mobility based on provisioned ISRP for
IFOM rules while the PGW may trigger NW-initiated IP flow mobility based on
extended PCC rules received from PCRF. The ISRP for IFOM rules in the UE and
the extended PCC rules in the PGW may be using different steering criteria:
The IFOM rules may use criteria based on the received OPI, measured signal
strength, location, etc. whereas the PCC rules may use subscription-related
criteria and/or congestion-related criteria. As a consequence, situations may
arise where the UE and the PGW have different steering preferences for the
same IP flow. This is especially true in roaming scenarios when the UE applies
ISRP for IFOM rules from VPLMN and has created a multi-access PDN connection
with a PGW in HPLMN.
To address the above situations, and to enable simultaneous support for UE-
initiated and NW-initiated IP flow mobility, the following procedures apply:
1\. When the PGW sends an IP flow mobility request, the UE decides if this
request should be accepted or rejected. If the request conflicts with the
active ISRP for IFOM rules in the UE or cannot be executed due to other
constraints (e.g. due to low signal strength on the target access or due to
low battery conditions), the UE rejects the IP flow mobility request.
Otherwise, the UE accepts the IP flow mobility request.
NOTE 1: When the UE does not have valid ISRP for IFOM rules, the UE is
expected to always accept a NW-initiated IP flow mobility request unless when
other constraints are present (e.g. the UE may prevent traffic on radio
interfaces with very low signal strength) or unless the request conflicts with
user preferences and Local Operating Environment.
2\. When the PGW determines that its IP flow mobility request was rejected by
the UE, the PGW marks the associated IP flow(s) as non-transferrable. The PGW
does not attempt to request IP flow mobility for a non-transferrable IP flow
until a preconfigured timer expires.
\- Optionally, the UE may mark an IP flow for which it rejected the
redirection as transfer-required. If the conditions that caused the rejection
by the UE are withdrawn within a certain time period, then the UE may initiate
IP flow mobility for this flow as prior requested by the PGW. This way, if the
UE rejects the PGW\'s request to redirect an IP flow due to temporary
constraints (e.g. due to low signal strength on the target access) the UE may
later satisfy PGW\'s request to redirect the IP flow if the temporary
constraints cease to exist.
3\. When the UE sends an IP flow mobility request, the PGW/PCRF is expected to
accept this request unless there are permanent limitations (e.g. subscription-
related limitations) that prevent the UE from using certain IP flows on a
certain access network.
NOTE 2: If the PGW/PCRF rejects a UE-initiated IP flow mobility request, the
IP flow may be terminated because the UE may not be able to sustain the flow
over the current access due to bad radio conditions. Even if the UE can
sustain the flow over the current access, if the UE-initiated IP flow mobility
request is rejected, it would render the UE incapable to enforce the
provisioned IFOM rules.
4\. When the UE determines that its IP flow mobility request was rejected by
the PGW, the UE marks the associated IP flow(s) as non-transferrable and does
not attempt to initiate IP flow mobility for this flow on the existing multi-
access PDN connection.
### 7.8.3 Solution B
In this solution, the conflict between UE-initiated and NW-initiated IP flow
mobility procedures are avoided by the negotiation for IP flow mobility
control mode. That is, there are two IP flow mobility control modes for
NBIFOM:
\- UE-only: UE initiates IP flow mobility between LTE and WLAN for a PDN
connection supporting NBIFOM.
\- NW-only: NW initiates IP flow mobility between LTE and WLAN for a PDN
connection supporting NBIFOM.
UE and NW negotiate the IP flow mobility control mode for a connection by
using session management procedure (e.g. access addition to a PDN connection).
That is, the UE indicate its preference between two IP flow mobility control
modes, by using PCO (Protocol Configuration Option) or new information element
in the session management request message. The UE may request UE-only mode of
operation and the NW selects the IP flow mobility control mode for the PDN
connection, in consideration of the request from the UE, the local
configuration, and the subscription data if available. The negotiated IP flow
mobility control mode is provided to the UE by using the response message.
If the negotiated operation mode is \"UE-only\" for the connection, the NW
does not initiate an IP flow mobility procedure for the connection. On the
other hand, in \"NW-only\" mode, the UE does not initiate an IP flow mobility
procedure for the connection unless the UE needs to move IP flows to another
access due to e.g. loss of coverage or degradation of the quality of the
connection. In such case, even in \"NW-only\" mode the UE is allowed to
request IP flow mobility by providing an indication of loss of coverage.
In the \"NW-only\" mode, the UE may reject a network request for IP flow
mobility due to e.g. loss of coverage or degradation of the quality of the
connection, and the UE includes an indication that the rejection is based on
loss of coverage.
The collision of UE-initiated and NW-initiated procedures is avoided since
only a single entity (i.e. either the UE or the NW) can initiate IP flow
mobility at a time, unless coverage conditions force the UE to initiate IP
flow mobility in NW-only mode.
### 7.8.4 Solution C
This solution for co-existence of UE-Initiated and network-initiated is
applicable to the solution for Control Plane based approach.
The network decides whether the Routing Rule provided by the network can be
modified by the UE based on the following principles:
\- For the services which the operator want to control the routing (regardless
of whether the routing rule is sent by the UE or by the network), the network
shall set the Routing Access Type as well as the Negotiation Indication to
\"forbidden\" in the Routing Rule. The UE shall not modify this Routing Rule
received from the network.
\- If a Routing Rule is sent by the network for other services, the network
shall set the Negotiation Indication to \"allowed\" in the Routing Rule.
\- If a Routing Rule is sent by the UE for other services, the network shall
accept it.
### 7.8.5 Solution D
The network decides whether the Routing Rule provided by the network can be
modified by the UE based on the following principles:
\- For the services for which the operator want to control the routing through
PCC (regardless of whether the routing rule is sent by the UE or by the
network), the network shall provide a Negotiation Indication set to
\"forbidden\" in the Routing Rule. The UE shall not modify this Routing Rule
received from the network. Alternatively, the network sets the Negotiation
Indication to \"allowed\" in the Routing Rule.
\- If a Routing Rule is sent by the UE for services for which the operator
does not want to control the routing through PCC, the network shall accept it.
In order to enable simultaneous support for UE-initiated and NW-initiated IP
flow mobility, the following applies:
1\. Both UE and NW are allowed to triggered IP flow mobility requests
2\. When the PGW sends an IP flow mobility request, the UE decides if this
request should be accepted or rejected. If the operator forbids the UE to
route certain IP flow(s) in the request on a certain access network, the
PGW/PCRF shall set the Negotiation Indication to \"forbidden\" in the Routing
Rule for the IP flow(s) to show that they can only be established or routed in
the access network indicated by the \"Routing Access Type\" in the Routing
Rule. If the request conflicts with the active ISRP for IFOM rules in the UE
or cannot be executed due to other constraints (e.g. due to low signal
strength on the target access or due to low battery conditions), the UE
rejects the IP flow mobility request. Otherwise, the UE accepts the IP flow
mobility request.
NOTE 1: When the UE does not have valid ISRP for IFOM rules, the UE is
expected to always accept a NW-initiated IP flow mobility request unless when
other constraints are present (e.g. the UE may prevent traffic on radio
interfaces with very low signal strength) or unless the request conflicts with
user preferences and Local Operating Environment.
\- If the UE receives a Routing Rule with Negotiation Indication set to
\"forbidden\", the UE shall not initiate NBIFOM procedure to route this IP
flow in the other access network later which will certainly be rejected.
\- When the UE rejects a network request, the UE includes a reason for the
rejection. Reasons include coverage issues (e.g. loss of coverage, low signal
strength, etc.), conflicting policies in the UE (which may include the type of
conflict, e.g. forbidden access, etc.).
Editor\'s note: It is FFS how to handle the priority between ANDSF rules and
PCC rules when the conflict is based on preferences of an access over another.
3\. When the PGW determines that its IP flow mobility request was rejected by
the UE, the PGW marks the associated IP flow(s) as non-transferrable depending
on the reason cause indicated by the UE. The PGW does not attempt to request
IP flow mobility for a non-transferrable IP flow until a preconfigured timer
expires or unless operator policy changes, e.g. the PGW has received new PCC
rules (the IP flow is forbidden to be routed via the existing access network),
or the UE changes the location or the RAT type (e.g. from LTE to UTRAN).
Editor\'s note: The detailed behaviour of the PGW upon receiving rejection
causes is FFS.
4\. When the UE sends an IP flow mobility request, the PGW/PCRF is expected to
accept this request unless there are permanent limitations (e.g. subscription-
related limitations) that prevent the UE from using certain IP flows on a
certain access network. The UE may provide a reason code in the request, e.g.
indicating coverage issues (e.g. low signal strength or loss of coverage), in
order to enable the PGW/PCRF to consider such situation when making policies
decisions (e.g. the PGW/PCRF may accept the UE request if the cause is loss of
coverage even if under different conditions the PGW/PCRF would reject such
request).
NOTE 2: If the PGW/PCRF rejects a UE-initiated IP flow mobility request (e.g.
if policies in PCRF forbids the traffic on the target access), the IP flow may
be terminated because the UE may not be able to sustain the flow over the
current access due to bad radio conditions. Even if the UE can sustain the
flow over the current access, if the UE-initiated IP flow mobility request is
rejected, it would render the UE incapable to enforce the provisioned IFOM
rules.
5\. When the PGW rejects the IP flow mobility request from the UE, the PGW
marks the rejection with a cause in order to limit the UE from retrying. The
cause can be a reason that the UE shall consider permanent (e.g. because IP
flow is forbidden to be routed via this access network the PGW/PCRF includes
the received Routing Rule, modifying the \"Routing Access Type\" to the other
access type and set the Negotiation Indication to \"forbidden\" in the
response message) until further indications are obtained from the network. The
cause can otherwise contain a temporary reason as well as conditions (e.g. UE
location, a timer, etc.). When the UE determines that its IP flow mobility
request was rejected by the PGW, if the PGW marked the rejection with a
permanent cause, then the UE marks the associated IP flow(s) as non-
transferrable and does not attempt to initiate IP flow mobility for this flow
on the existing multi-access PDN connection. If the PGW marks the rejection
with a temporary cause, the UE may attempt to initiate IP flow mobility for
this flow on the existing multi-access PDN connection at a later time when the
conditions associated with the cause are not true anymore (e.g. change of UE
location, expiration of the timer, etc.).
Editor\'s note: Conditions provided with rejection causes are FFS.
### 7.8.6 Solution-E: NBIFOM Operation Modes
#### 7.8.6.1 General
A multi-access PDN connection can operate either in UE-initiated mode or in
NW-initiated mode. This mode is selected when the PDN connection is
established and remains the same as long as the PDN connection is active. The
following clauses specify (a) how the operation mode is selected and (b) what
the functional characteristics of each mode are.
#### 7.8.6.2 Mode Selection
1\. When an NBIFOM-capable UE has both ANDSF rules and RAN rules, and the UE
requests a multi-access PDN connection, the operation mode of this PDN
connection is selected based on the flowchart of Figure 7.8.6.2-1.
NOTE 1: The part within the red frame is specified in TS 23.402 [2], clause
4.8.6.4.
The flowchart of Figure 7.8.6.2-1 also applies when the UE is roaming in a
VPLMN contained in the list of \"VPLMNs with preferred WLAN Selection Rules\".
In this case however the first condition checks if the \"UE has a valid ISRP
rule from VPLMN\".
2\. When an NBIFOM-capable UE has only ANDSF rules, and the UE requests a
multi-access PDN connection, the operation mode of this PDN connection is
selected based on Figure 7.8.6.2-1, starting from point A.
3\. When an NBIFOM-capable UE has only RAN rules, and the UE requests a multi-
access PDN connection, the operation mode of this PDN connection is selected
based on Figure 7.8.6.2-1, starting from point B.
4\. When an NBIFOM-capable UE has neither ANDSF rules nor RAN rules, and the
UE requests a multi-access PDN connection, the operation mode of this PDN
connection is selected based on Figure 7.8.6-1, starting from point C.
NOTE 2: Application level preferences settings on the UE (e.g. propose video-
share to the user only when over WLAN) are out of scope.
Figure 7.8.6.2-1: NBIFOM Mode Selection
##### 7.8.6.2.1 UE-Initiated Mode
In the UE-initiated mode the UE only controls the traffic routing within the
multi-access PDN connection by applying its ANDSF for IFOM rules and/or the
user-configured routing rules.
NOTE: If the UE has valid ANDSF rules for NSWO, for IARP and/or MAPCON, then
the UE can also control traffic routing outside the multi-access PDN
connection.
The UE can request to move selected IP flows from an old access to a new
access within the PDN connection by sending one or more routing rules to the
network. These routing rules specify the selected IP flows and the new access.
The network may reject IP flow mobility requests from UE e.g. due to
subscription limitations or when the user-configured routing rules conflict
with the network policy, etc. When the network rejects an IP flow mobility
request, the network shall provide to UE a certain cause value indicating why
the request was rejected. This cause value may be used by UE to determine
when/if this IP flow mobility operation can be requested again.
The network cannot request IP flow mobility. The IP flow mobility procedures
used in UE-initiated mode are described in clauses 7.3.2.3.3.4 and
7.3.2.3.3.5.
##### 7.8.6.2.2 NW-Initiated Mode
In the NW-initiated mode, the network controls the traffic routing within the
multi-access PDN connection.
NOTE: However, if the UE has valid ANDSF rules for NSWO, for IARP and/or
MAPCON, then the UE can still control traffic routing outside the multi-access
PDN connection.
In case the UE wants to request a mapping of IP flows to access type the UE
provides the requested mapping from IP flows to access types to the NW. This
is however not considered a routing rule provision. The network then provides
new or updated routing rules to the UE based on the request received from the
UE, unless the request is against what is allowed by the subscription.
The network can request to move selected IP flows from an old access to a new
access within the multi-access PDN connection by sending one or more routing
rules to the UE. These routing rules specify the selected IP flows and the new
access.
The UE may reject (e.g. due to low signal strength) an IP flow mobility
request from the network. When the UE rejects an IP flow mobility request from
the network, the UE shall provide a cause value indicating why the request was
rejected. This cause value may be used by the network to determine when/if
this IP flow mobility operation can be requested again.
The UE cannot request IP flow mobility. However, the UE can indicate to the
network when an access of a multi-access PDN connection can or cannot be used
for traffic routing. For example:
\- When the UE losses the WLAN signal and the UE has active IP flows over
WLAN, then the UE indicates to the network that WLAN cannot be used for
traffic routing. This triggers the network to stop sending downlink traffic
for these IP flows over WLAN access and provide updated routing rules to the
UE. The UE and the network re-route one or more of these IP flows to 3GPP
access, if the existing routing rules do not prevent them from using 3GPP
access.
\- When the UE recovers the WLAN signal and the existing routing rules in the
UE require some active IP flows to be routed over WLAN, the UE indicates to
the network that WLAN can again be used for traffic routing within the PDN
connection. The network provides updated routing rules to the UE for the IP
flows that are moved to WLAN access. The UE and the network re-route these
active IP flows to WLAN access.
\- The UE uses its local operating environment (as defined in TS 23.261 [13])
to decide when the above indications should be sent to the network.
If the UE uses RAN rules, i.e. if the UE receives RAN Assistance information
to determine when traffic should be routed to WLAN or to 3GPP access, then:
\- When the UE receives NBIFOM capability indication during addition of one
access to a PDN connection procedure, the UE shall ignore the WLAN
offloadability indication sent from the MME.
\- When RAN rules in the UE indicate that traffic should be moved to 3GPP
access, the UE indicates to the network that the WLAN access cannot be used
for traffic routing.
\- When RAN rules in the UE indicate that traffic should be moved to WLAN
access, the UE indicates to the network that the WLAN can be used for traffic
routing.
\- When RAN rules in the UE do not provide an offload preference (i.e. do not
indicate to move traffic to 3GPP or to WLAN), traffic routing within the PDN
connection is performed based on the routing rules provided by the network.
## 7.9 Co-existence with ANDSF IFOM rules
### 7.9.1 Co-existence with ANDSF for user-plane signalling solution and
control-plane signalling solution
The UE can simultaneously use the NBIFOM solution and ANDSF traffic steering
rules for IFOM (i.e. ISRP for IFOM rules). Specifically, the UE applies the
following behaviour:
\- The UE uses the active ISRP for IFOM rules to determine when UE-initiated
IP flow mobility should be requested (i.e. when to send a \"redirection\"
packet or when to send a routing rule). This applies to both non-roaming and
roaming scenarios and irrespectively of whether the UE uses ISRP for IFOM
rules from HPLMN or from VPLMN.
\- By using the active ISRP for IFOM rules to trigger UE-initiated IP flow
mobility, the UE is able to utilize the thresholds and parameters provided by
RAN (as part of the RAN assistance information) for initiating NBIFOM
operations. For example, the UE could send an IP flow mobility request when
the OPI value provided by RAN changes and an ISRP for IFOM rule becomes active
that requires an IP flow to change access.
\- When the UE receives a NW-initiated IP flow mobility request (i.e. when it
receives a \"redirection\" packet or when to send a routing rule), the UE
determines if the request is in line or in conflict with the active ISRP for
IFOM rules. The request is in conflict when, for example, it requests an IP
flow to be transferred to 3GPP access while the active ISRP for IFOM rules
require this IP flow over WLAN access (e.g. the 3GPP access is forbidden for
this IP flow). When the received NW-initiated IP flow mobility request is in
conflict with the active ISRP for IFOM rules, the UE rejects the NW-initiated
IP flow mobility request and provides the cause indicating the policy conflict
to the network.
\- By rejecting an NW-initiated IP flow mobility request that is in conflict
with the ISRP for IFOM rules, the UE makes sure that it can enforce the active
ISRP for IFOM rules, as required by the Rel‑12 specifications.
Editor\'s note: If using user-plane signalling solution, when the UE rejects a
NW-initiated IP flow mobility request, it is FFS if it should provide a cause
value to the network indicating why the request was rejected.
Editor\'s note: The conflict with ANDSF rules in roaming scenario is FFS.
### 7.9.2 Co-existence with ANDSF for Control-plane signalling solution
The UE can simultaneously use the NBIFOM solution and ANDSF traffic steering
rules for IFOM (i.e. ISRP for IFOM rules). The UE shall not route an IP flow
via one access network which is forbidden by the ANDSF policy or the network.
When the UE receives a NW-initiated IP flow mobility request, the UE may
determine if the request is in line or in conflict with the active ISRP for
IFOM rules. When the received NW-initiated IP flow mobility request is in
conflict with the active ISRP for IFOM rules, the UE may reject the NW-
initiated IP flow mobility request. If the Negotiation Indication in the
received Routing Rule is set to \"forbidden\" as described in clause 7.8.5,
the UE shall not reject this request unless other constraints exists (e.g. due
to low signal strength on the target access or due to user preference). The UE
shall not initiate NBIFOM procedure to route this IP flow in the forbidden
access network later which will certainly be rejected.
The UE may use the ANDSF traffic steering rules for IFOM (i.e. ISRP for IFOM
rules) to generate Routing Rules and triggers UE-initiated IP flow mobility
procedure. The behaviour of the network and the UE is the same as described in
clause 7.8.5.
Editor\'s note: The conflict with ANDSF rules in roaming scenario is FFS.
Editor\'s note: This solution is related to clause 7.8.5 Solution D.
# 8 Evaluation of the Solutions
## 8.1 Evaluation of solutions for client based IFOM
For S2c and H1 reference points, only the solution described in clause 7.1.1
has been proposed. The study of the solution can be considered completed and
no major open issues have been identified. The solution is based on IETF
documents draft-ietf-monami6-multiplecoa [4] and draft-ietf-mext-flow-binding
[5] which are mature and close to publication.
## 8.2 Evaluation of solutions for NBIFOM
Editor\'s note: This clause will contain the evaluation of each candidate
solutions which support NBIFOM.
### 8.2.1 High level description of the solutions
For evaluation, 4 aspects will be presented:
  1. Impacts to network entities.
ii) Impacts to Protocols.
iii) Impacts to other SDOs.
iv) Additional signalling load: Additional control plane traffic.
### 8.2.2 Evaluation of the solutions to support the negotiation between UE
and PGW for transferring IP flows between accesses
This clause evaluates following types of solutions to support the negotiation
between UE and PGW for transferring IP flows between accesses:
\- The \"Control Plane\" (CP) solutions (such as the one described in clause
7.3.2 and in clause 7.5.4)
\- The \"User plane / per flow\" (UP / per flow) solution as described in
clause 7.6.1
\- The \"User plane / dedicated protocol\" (UP / IFMP) solutions as described
in clause 7.6.2.
The 2 last solutions are collectively called UP solutions.
The User Plane (UP) negotiation between UE and PGW for the transfer of IP
flows between accesses has the advantage of:
\- Requiring no signalling load on MME / SGW / TWAG / ePDG for the transfer of
routing rules: the routing rules signalling are exchanged directly between the
UE and the PGW.
\- Allowing the usage of the same solution for transporting routing rule for
all access types (3GPP, S2b, S2a/SCM, S2a/MCM, GTP, PMIP).
\- All the UP solutions have following impacts: Packets used between UE and
PGW for the negotiation of the transfer of IP flows between accesses should be
taken into account by the PGW neither for charging nor for usage monitoring.
As the SGW/TWAG/ePDG will count these packets, this implies some slight
mismatch between PGW and SGW CDR.
\- Whether UP solutions provide a quicker negotiation path (when there is no
packet loss) than CP solutions depends on the length of the UP transfer queues
(for the radio interface) for the UE and whether or not a separate EPS bearer
is established for carrying the IFMP messages.
**Analysis of \"User plane / per flow\" (UP / per flow) solution**
The UP / per flow solution (clause 7.6.1) basically works as follows: to
transfer an IP Flow the requesting entity (resp. UE, PGW) sends a
\"redirection\" packet i.e. a packet of this IP flow (5-Tuple) with a TTL=1.
This \"redirection\" request is acknowledged by the other entity (resp. PGW,
UE) using an ICMP Time-Exceeded packet.
ICMP Time-Exceeded packets are used by the NBIFOM signalling protocol between
the PGW and the UE and are discarded by the NBIFOM layer. Genuine ICMP Time-
Exceeded (i.e. ICMP Time-Exceeded packets not triggered by a NBIFOM access
transfer) would also be discarded by the NBIFOM layer. The ICMP Time-Exceeded
packets used by the UP NBIFOM protocol need to be tagged in order that the
NBIFOM layer only discards these packets and not the genuine ICMP Time-
Exceeded packets.
The UP / per flow solution actually does not negotiate the transfer of
aggregated flows (identified by global filters using e.g. wildcarding /
ranges) but negotiates the transfer of individual IP flows: there needs to be
one negotiation per current IP flow on the link. No aggregate signalling is
possible and when a web application using multiple IP flows is to be
transferred to another access, there needs to be one context (state machine)
per IP flow of this web application to be transferred. As some web
applications may correspond to a large number of IP flows, this means
potentially a large number of IP flow transfer contexts.
**Observation 1: With UP / per flow solution, the PGW and UE need to maintain
table of existing IP flow, in order to be able to initiate an IP flow transfer
request per existing IP flow**
\"When the UE uses authorized transfer (...) for several IP flows, the UE
transmits a \"redirection\" packet for each one of these IP flows. This may
trigger multiple PCC interaction over Gx, i.e. one interaction per IP flow\".
Web applications using multiple IP flows are commonly used. Thus the UP
solution actually requires more signalling on Gx (one interaction per IP flow)
than the CP solution (one interaction per aggregate).
**Observation 2: Due to per IP flow negotiation, the UP / per flow solution
requires more Gx signalling for the transfer of a web application using
multiple IP flows.**
Both UP and CP solutions have to deal with packet loss; considering the case
of the UP solution, either the \"redirection\" packet (TTL=1) or its ack
(ICMP) may get lost. Thus the requesting entity (UE/PGW) needs to set a timer
per IP flow in order to repeat its \"redirection\" request when it has not
been acknowledged.
**Observation 3: Due to per IP flow negotiation, the UP / per flow solution
requires one timer per IP flow.**
The semantics of the signalling used by the UP solution (\"redirection\"
packet and ICMP ack) is fairly crude and appears like binary information:
\"please use this access, or please do not use this access\". When both the UE
and the network are allowed to issue requests for the transfer of IP flows
between accesses, more complex negotiation is needed to indicate whether the
request is related with UE subscription, with operator commands (i.e. semi-
permanent), or possibly transient (e.g. due to radio environment issues).
Theoretically, it would be possible to extend the user plane solution with
such finer grain negotiation (via adding causes in the \"redirection\" packet
and in the \"ICMP\" answer). This would actually mean a totally new protocol
and one could argue that at least a new ICMP message would need to be
defined).
**Observation 4: Due to the binary acknowledgment of the ICMP protocol, a
better reporting would require a completely new protocol.**
**Analysis of \"User plane / dedicated protocol\" (UP / IFMP) solution**
To overcome the issues listed above, a solution is to define a dedicated
protocol running in the User plane between the UE and the PGW. This protocol
can work on an aggregate IP flow level and have elaborate request / rejection
causes.
This solution removes signalling load in the Control Plane for the negotiation
of the RR between the UE and the PGW but requires the definition of a brand
new \"IFMP\" protocol.
For the purpose of carrying IFMP, the UE (source/destination) IP address would
be the same as that which is allocated for the PDN connection whilst the P-GW
(destination/source) IP address (and port) would be provided within the PCO
during the PDN connection establishment.
The security of this new protocol needs to be carefully analysed as it opens
up an IP interface between UE and the PGW. The IFMP solution makes the PGW
address known by the UE, but this is similar to DSMIP (where the UE gets the
HA address in the PGW). As the IFMP protocol runs in the PDN connection itself
the PGW can enforce that a UE request from this protocol can only apply to the
PDN connection where this request has been received . The PGW needs also to
enforce that traffic from the UE can only reach the PGW port dedicated to the
IFMP. It is also needed to make sure that the IFMP signalling cannot be
modified en-route between the UE and the PGW: security over the 3GPP/WLAN
radio is assumed but also NDS (Network Domain security) within the network
(e.g. between the ePDG/TWAG and the PGW) including on inter-operator
interfaces
The remaining point to be solved is to prevent another application in the UE
(potentially a malware) from sending IP traffic to the port of the IFMP
application in the PGW
When a dedicated bearer is needed to carry a set IP flow that are moved
between accesses, 2 actions need to be carried out: 1) exchange a request for
IP flow mobility between the UE and the network and 2) create / modify /
delete bearers. In the IFMP case, the request for IP flow mobility is carried
over the User Plane while the actions on the bearers are carried out in the
Control Plane. Thus mechanisms are needed to synchronize / correlate the 2
procedures. In the case of Control Plane protocol, an unique Control Plane
procedure can carry out both actions thus ensuring a natural synchronization
between these actions.
**Analysis of \"Control plane\" (CP) solution**
The Control Plane (CP) negotiation between UE and PGW for the transfer of IP
flows between accesses (RR negotiation) requires signalling on MME / SGW /
TWAG / ePDG to transport routing rules (and thus evolution of WLCP, NAS and
Swu/IKE) but
\- It allows aggregate signalling between the UE and the PGW. There is thus no
need to maintain a per IP flow table and a timer per IP flow in the PGW and in
the UE, and to have per IP flow signalling over Gx.
\- It supports proper negotiation in case both the UE and the network are
allowed to issue requests for the transfer of IP flows between accesses.
\- It inherits of all the security defined so far for the CP exchange between
the UE and the network (security of the NAS, WLCP, IKE,.. protocols).
### 8.2.3 Summary of Evaluation
Table 8.2.3-1: Signalling load
* * *
Solution Evaluation User plane / per flow solution - There is additional
signalling load on UE, P-GW and PCRF. Control plane solution (using
GTP-C/PMIP) - There is additional signalling load on UE, P-GW, PCRF, MME,
S-GW, TWAG, ePDG (User plane / IFMP) solution - There is additional signalling
load on UE, P-GW and PCRF.
* * *
Table 8.2.3-2: Impacts to network entities
* * *
Solution Evaluation User plane / per flow solution - UE, P-GW PCRF and ePDG
(NOTE) Control plane solution (using GTP-C/PMIP) - UE, P-GW, PCRF, MME, S-GW,
TWAG, ePDG, and potentially AAA (if S2a SCM supported) (User plane / IFMP)
solution - UE, P-GW, PCRF and ePDG (NOTE) NOTE: To negotiate NBIFOM over Swu
* * *
Table 8.2.3-3: Impacts to protocols
* * *
Solution Evaluation User plane / per flow solution - Specific usage of ICMP
and IP (TTL 1) including functionality to ensure the reliability of the
exchange between the UE and the PGW (to handle packet loss) Control plane
solution (using GTP-C/PMIP) - impact to GTP-C, WLCP, IKEv2, NAS and
potentially EAP-AKA (if S2a SCM supported) and PMIP (if supported). (User
plane / IFMP) solution - Requires a new protocol (IFMP) terminated in UE and
P-GW including functionality to ensure the reliability of the exchange between
the UE and the PGW (to handle packet loss)
* * *
Table 8.2.3-4: Other SDO impacts
* * *
Solution Evaluation User plane / per flow solution - None when the existing
ICMP can be used Control plane solution (using GTP-C/PMIP) - None (User plane
/ IFMP) solution - Requires new UDP/TCP assigned by IANA unless a dynamically
allocated port is used
* * *
All solutions impact IKEv2 and the ePDG to negotiate NBIFOM over IKEv2.
Table 8.2.3-5: Other evaluation aspects
+----------------------------------+----------------------------------+ | Solution | Evaluation | +----------------------------------+----------------------------------+ | User plane / per flow solution | - Single solution to transfer | | | routing rules over any target | | | network, including S2a SCM or in | | | a network utilising PMIP | | | | | | - Signalling is needed for each | | | IP flow that needs to be | | | re-routed. | | | | | | > \- Additional Gx interactions. | | | > | | | > \- Re-transmission timer | | | > required per IP flow | | | | | | - It is not possible to signal | | | the cause for IP flow re-routing | | | or reason for routing rule | | | rejection. | +----------------------------------+----------------------------------+ | Control plane solution (using | - Single procedure can move | | GTP-C/PMIP) | multiple IP flows. | | | | | | - Negotiation and rejection of | | | routing rules fully supported | | | | | | - No solution for sending | | | routing rules over a target WLAN | | | using S2a SCM without modifying | | | EAP. | | | | | | - Support for PMIP would | | | require additional effort | +----------------------------------+----------------------------------+ | (User plane / IFMP) solution | - Single procedure can move | | | multiple IP flows | | | | | | - Negotiation and rejection of | | | routing rules fully supported | | | | | | - Single solution to transfer | | | routing rules over any target | | | network, including S2a SCM or in | | | a network utilising PMIP | | | | | | - PGW would need to allow IFMP | | | traffic on a NBIFOM PDN | | | connection but not taking it | | | into account for its Charging | | | and Usage Monitoring counters. | | | | | | - NBIFOM control signalling in | | | the user plane may require | | | appropriate user-plane | | | QoS/prioritization of the | | | signalling (e.g. dedicated | | | bearers) | | | | | | - Proper Firewalling features | | | in the PGW are needed to ensure | | | that a misbehaving UE cannot | | | issue RR related with another UE | | | | | | - NDS is needed to ensure | | | integrity protection of IFMP | | | | | | - Security impacts to prevent a | | | malware from attacking the IFMP | | | stack in the PGW need to be | | | analyzed. This might require | | | further signalling to set-up the | | | security between the UE and PGW | | | | | | - mechanisms are needed to | | | synchronize / correlate the | | | following procedures: 1) | | | exchange a request for IP flow | | | mobility between the UE and the | | | network and 2) create / modify / | | | delete bearers | +----------------------------------+----------------------------------+
# 9 Conclusions
## 9.1 Conclusion of client based IFOM
The study on the use cases has been completed by SA1 and service requirements
have been identified.
The study for S2c and H1 reference points can be considered concluded with the
solution in clause 7.1.1 being the recommended solution.
## 9.2 Conclusion of NBIFOM
Editor\'s note: This clause will contain a conclusion on each candidate
solution which supports NBIFOM.
### 9.2.1 Working Assumptions
The following working assumptions have been agreed for the normative work of
NBIFOM:
1\. For S2a NBIFOM support, over 3GPP access and TWAN access, PCO is used to
support NBIFOM capability discovery and negotiation between UE and PGW during
the UE\'s initial attach. Other network entities (MME/SGW/TWAG/ePDG) indicate
their capability via other mechanisms in GTP signalling to PGW when
establishing PDN connection during the first access and the second access..
For S2b NBIFOM support, same as S2a, PCO is to be used for 3GPP access. For
over the untrusted WLAN access, the existing IKEv2 Configuration Payload in
CFG_REQ will be extended to transport NBIFOM parameters similar to S2b today.
Same as S2b GTP today, the APCO between the ePDG and PGW will be used for
transporting NBIFOM parameters.
2\. When PCC is deployed and supports NBIFOM, the PCRF provides the PGW with
Access information which is part of PCC rules. The Access information
corresponds to rules about the access over which to route some traffic.
3\. In case of network initiated NBIFOM, the PGW translates Access information
into Routing Rules for use between the UE and the PGW. In case of UE initiated
NBIFOM, the PGW can provide the PCRF with notifications of UE requests for IP
flow mapping to an Access Type. In that case, the PCRF analyses the received
information (requested IP flow mapping to an Access Type), makes a policy
decision and provides PCC rules to the PGW with corresponding Access Type
values.
Editor\'s note: Whether the PCRF can reject a UE-initiated request and the
conditions when this can happen is FFS and depends on the co-existence
solution selected.
4\. For a multi-Access PDN Connection, when GTP applies there is one default
bearer for each access.
5\. For a multi Access PDN connection there is always a default access.
\- In UE-initiated mode, the UE decides the default access and indicates to
the network.
\- In NW-initiated mode, the network decides the default access and indicates
to the UE.
6\. An access can be added to a multi-access PDN connection without any
associated routing rule. The absence of routing rule associated with a given
access (i.e. 3GPP or WLAN) does not imply the removal of such access for a
multi-access PDN connection.
7\. The control plane approach for NBIFOM with S2a GTP (clause 7.3.2 Solution
A: Control Plane signalling solution) and with S2b GTP (7.5.4 Solution C: IP
flow mobility support based on IKEv2 extensions) is adopted.
8\. In the case of the control plane approach, there is no need to include
routing rules during the initial attach; however, inclusion of routing rules
during the attachment of additional access could expedite the UE-initiated IP
flow mobility operation.
9\. For the control plane solution, in case of MCM/S2a and S2b, the Routing
Rules are sent on the destination access as indicated by the Routing Access
Type in the Routing Rule.
10\. When using SCM to support a NBIFOM PDN connection, no dedicated bearers
are supported on the S2a access of the PDN connection.
11\. The support of App ID for NBIFOM is outside the scope of Rel‑13.
12\. The following capabilities for NBIFOM are outside the scope of Rel‑13:
\- The support for inter-MME/SGSN IP Flow mobility within network that does
not support NBIFOM uniformly
\- The support for PMIP
13\. The inclusion of NBIFOM indication provided during the additional access
together with the \"Handover Indication\" in the enhanced handover procedure
are sufficient to differentiate the regular handover procedures from NBIFOM
additional access procedure.
NOTE: When NBIFOM is not supported by the intermediate node (e.g. MME/SGSN,
SGW, TWAG or ePDG) when adding the additional access to a PDN connection, the
network should reject the PDN connectivity request with the appropriate cause
value to indicate the failure of adding the additional access for NBIFOM.
However, the previously established PDN connection of the first access shall
be maintained.
### 9.2.2 NBIFOM Rel-13 Conclusions
The summary of the key features that have been concluded for Rel‑13 NBIFOM
study can be referred to clause 9.2.1. For more detailed descriptions, the
following shall be referred:
1\. Supporting multi-access PDN connection for 3GPP access with S2a-GTP and
with S2b-GTP
\- Referring to clause 7.3.2 for multi-access with S2a-GTP
\- Referring to clause 7.5.4 for multi-access with S2b-GTP
2\. Supporting IP flow mobility policies enhancement for PCC
\- Referring to clauses 7.7.1, 7.7.3.1
3\. NBIFOM modes of operations (i.e. UE-initiated and Network-initiated)
\- Referring to clause 7.8.6
The solution to indicate 3GPP access loss to P-GW in SCM/S2a, after the eNB
detects that the radio connection to the UE is lost as described in TS 36.413
[16], may be provided during the normative stage.
###### ### Annex A: Handling of multiple PDN connections
Editor\'s note: This clause provides a placeholder for documenting the
required solutions to enable full support for handling multiple PDN
connections in beyond Rel-8 EPC. I.e. solutions solving the following
limitation documented in Rel-8 TS 23.402 [2]:
_TS 23.402 [2], 8.3.0. clause 4.1.0:_
_\"The full support for connecting an UE simultaneously to the EPC via more
than one access network is out of the scope of this release of the
specification. This release supports simultaneous access from more than one
access network during handover between the access networks._
> _NOTE 2: Even though not explicitly supported by this specification, the
> mechanisms specified in this specification can be used to connect a UE in
> parallel to the EPC via 3GPP access network and a Non-3GPP access network
> towards different PDNs.\"_
# A.1 Multiple PDN connections to different APNs
## A.1.1 Basic principles for simultaneous connectivity over multiple accesses
A UE, that is capable of routeing different simultaneously active PDN
connections through different access systems, can do so if the UE is
authorized by subscription to access all of the involved PDNs and all of the
involved access systems.
## A.1.2 Scenarios
The UE may simultaneously connect to different PDNs through different access
systems. The access systems the UE can stay simultaneously connected with may
include one 3GPP RAT, like GERAN, UTRAN or E-UTRAN, and one and only on
non-3GPP access, like WiFi or WiMAX. The following scenarios are supported:
\- Establishment of PDN connections over multiple accesses. The UE opens a new
PDN connection on an access that was previously unused or on one of the
accesses it is already simultaneously connected with.
\- Selective transfer of PDN connections between accesses. Upon inter-system
handover the UE transfers a subset of the active PDN connections from the
source to the target access.
\- Transfer of all PDN connections out of a certain access system. The UE
moves all the active PDN connections from the source to target access, e.g. in
case the UE goes out of the coverage of the source access.
## A.1.3 Architectural principles
The UE selects the access system where to route a specific PDN connection
based on the user preferences and the inter-system mobility policies
statically pre-configured by the operator on the UE or provided by the ANDSF.
The inter-system mobility policies statically pre-configured by the operator
on the UE or provided by the ANDSF may be per APN. As an example, this allows
the operator to indicate to the UE that a certain access system shall be
preferred to another for connecting to a specific APN.
Upon inter-system handover the UE may transfer from the source to the target
access system only a subset of the active PDN connections.
For non-3GPP accesses that support re-connecting the UE to multiple PDNs, when
the UE connects to the non-3GPP access, the non-3GPP access must not reconnect
the UE to all the active PDNs, as indicated by the AAA/HSS during
authentication, if the UE provided an APN upon handover attach in the non-3GPP
access. That is in fact considered an implicit indication that the UE wants to
transfer to the target access only a subset of the active PDN connections.
## A.1.4 Description of the impacts on TS 23.402 [2]
For the UE to simultaneously connect to different PDNs through different
access systems the following clarifications should be added to the procedures
specified in TS 23.402 [2]:
\- **4.8: Network Discovery and Selection**
The inter-system mobility policies may be per APN.
\- **4.12: Multiple PDN support**
Exchange of IP traffic to multiple PDNs simultaneously over multiple accesses
is also supported in the EPS. Multiple PDN connections over multiple accesses
can be established to different APNs.
For multiple PDNs over multiple access the following principles apply:
> \- A UE that is detaching from the Evolved Packet System, e.g. a UE that is
> powering off, performs a UE-initiated detach on each of the access systems
> where it has active PDN connections.
>
> \- In order to disconnect from a specific access system, e.g. due to the
> correspondent radio interface being switched off, and preserve all or a
> subset (e.g. based on policies) of the active PDN connections that use that
> access, a UE that is simultaneously connected to multiple accesses should
> not use the UE-initiated detach procedure. The UE should instead transfer
> all or a subset of the active PDN connections out of the access system it is
> disconnecting from.
>
> \- If the UE is simultaneously connected to multiple accesses, a detach
> procedure initiated by the MME, SGSN, trusted non-3GPP access or ePDG, e.g.
> due to administrative reasons or detecting the UE\'s leaving by, causes the
> UE to be detached only from the access system that is triggering the request
> and causes either the active PDN connections on that access to be
> disconnected or to be handed over by the UE to the other access.
Editor\'s note: It is FFS how the PDN connections are handed over to the other
access.
> \- If the UE is simultaneously connected to multiple access systems, when
> the user\'s subscription is removed (or for other operator determined
> reasons), the HSS/AAA initiates a detach procedure on each of the access
> systems where the UE has active PDN connections.
>
> \- Once the MME, or SGSN, receives upon detach the Delete Bearer Response
> from the Serving GW, the MME, or SGSN, shall send a Notify Request to
> indicate that the HSS shall remove the APN and PDN GW identity pairs for
> this UE only for the PDNs routed over 3GPP access.
\- **5.2: Initial E-UTRAN Attach with PMIP-based S5 or S8**
This procedure is also used to establish a PDN connection over E-UTRAN with
PMIP based S5 or S8 when the UE already has active PDN connections over some
non-3GPP access network and wants to establish simultaneous PDN connections
over multiple accesses.
\- **5.6.1: UE requested PDN connectivity with PMIP-based S5 or S8**
This procedure is also used for establishment of new PDN connectivity or for
re-establishment of existing PDN connectivity when UE is transferring PDN
connections from another access to 3GPP access and where active PDN
connections over 3GPP access already exist.
\- **6.2.1: Initial Attach Procedure with PMIPv6 on S2a and Anchoring in PDN
GW**
This procedure is also used to establish a PDN connection over a trusted
non-3GPP access with S2a when the UE already has active PDN connections over a
3GPP access and wants to establish simultaneous PDN connections over multiple
accesses.
\- **6.2.3: Initial Attach procedure with MIPv4 FACoA on S2a and Anchoring in
PDN GW**
This procedure is also used to establish a PDN connection over a trusted
non-3GPP access with MIPv4 FA CoA on S2a when the UE already has active PDN
connections over a 3GPP access and wants to establish simultaneous PDN
connections over multiple accesses.
**\- 6.3: Initial Attach Procedure with DSMIPv6 on S2c in Trusted Non-3GPP IP
Access**
This procedure is also used to establish a PDN connection over a trusted
non-3GPP access with DSMIPv6 on S2c when the UE already has active PDN
connections over a 3GPP access and wants to establish simultaneous PDN
connections over multiple accesses.
**\- 6.8.1: UE-initiated Connectivity to Additional PDN with PMIPv6 on S2a**
This procedure is also used for establishment of new PDN connectivity or for
re-establishment of existing PDN connectivity when the UE is transferring PDN
connections from another access to a trusted non-3GPP access with PMIPv6 on
S2a and where active PDN connections over this trusted non-3GPP access already
exist.
This applies to both Non-Roaming, Home Routed Roaming and Local Breakout Case
and Chained PMIP-based S8-S2a Roaming Case.
**\- 6.8.2: UE-initiated Connectivity to Additional PDN with MIPv4 FACoA on
S2a**
These procedures are also used for establishment of new PDN connectivity or
for re-establishment of existing PDN connectivity when the UE is transferring
PDN connections from another access to a trusted non-3GPP access with MIPv4 FA
CoA on S2a and where active PDN connections over this trusted non-3GPP access
already exist.
**\- 7.2.1: Initial Attach with PMIPv6 on S2b**
This procedure is also used to establish a PDN connection over an untrusted
non-3GPP access with PMIPv6 on S2b when the UE already has active PDN
connections over a 3GPP access and wants to establish simultaneous PDN
connections over multiple accesses.
**\- 7.3: Initial Attach Procedure for S2c in Untrusted Non-3GPP IP Access**
This procedure is also used to establish a PDN connection over an untrusted
non-3GPP access with DSMIPv6 on S2c when the UE already has active PDN
connections over a 3GPP access and wants to establish simultaneous PDN
connections over multiple accesses.
**\- 7.6.1: UE-initiated Connectivity to Additional PDN with PMIPv6 on S2b**
This procedure is also used for establishment of new PDN connectivity or for
re-establishment of existing PDN connectivity when UE is transferring PDN
connections from another access to an untrusted non-3GPP access with PMIPv6 on
S2b and where active PDN connections over this untrusted non-3GPP access
already exist.
**\- 7.6.2: UE-initiated Connectivity to Additional PDN with DSMIPv6 on S2c**
This procedure is also used for establishment of new PDN connectivity or for
re-establishment of existing PDN connectivity when UE is transferring PDN
connections from another access to an untrusted non-3GPP access with DSMIPv6
on S2c and where active PDN connections over this untrusted non-3GPP access
already exists.
**\- 8.1: Common Aspects for Handover without Optimizations for Multiple
PDNs**
The procedures described in this clause can also be used by the UE to handover
a subset of PDN connections from one access to another as well as to transfer
all the PDN connections out of a certain access when UE is connected over
multiple accesses simultaneously.
**\- 8.2.1.1: Handover from Trusted or Untrusted Non-3GPP IP Access to 3GPP
Access on S2a/S2b, General Procedure for GTP based S5/S8 for E-UTRAN Access**
If the UE is connected to both 3GPP access and non-3GPP access before the
handover of PDN connections to 3GPP access is triggered, then the UE shall
skip steps 2 to 16 and only perform step 17 for each PDN connection that is
being transferred from non-3GPP access.
If the UE is connected only to non-3GPP access before the handover of PDN
connections to 3GPP access is triggered, then the UE shall perform steps 2 to
16. In step 3 the UE shall provide the APN corresponding to one of the PDN
connections that are being transferred from non-3GPP access. The UE shall then
perform step 17 for each of the remaining PDN connections that are being
transferred from non-3GPP access.
The UE shall perform step 18 for each PDN connection that is being transferred
from non-3GPP access.
**\- 8.2.1.2: Handover from Trusted or Untrusted Non-3GPP IP Access to 3GPP
Access on S2a/S2b, Using PMIP-based S5/S8**
If the UE is connected to both 3GPP access and non-3GPP access before the
handover of PDN connections to 3GPP access is triggered, then the UE shall
skip steps 2 to 16 and only perform step 17 for each PDN connection that is
being transferred from non-3GPP access.
If the UE is connected only to non-3GPP access before the handover of PDN
connections to 3GPP access is triggered, then the UE shall perform steps 2 to
16. In step 3 the UE shall provide the APN corresponding to one of the PDN
connections that are being transferred from non-3GPP access. The UE shall then
perform step 17 for each of the remaining PDN connections that are being
transferred from non-3GPP access.
The UE shall perform step 18 for each PDN connection that is being transferred
from non-3GPP access.
**\- 8.2.1.3: Handover from Trusted or Untrusted Non-3GPP IP Access to 3GPP
Access on S2a/S2b, General Procedure for GTP-based S5/S8 for UTRAN/GERAN**
If the UE is connected to both 3GPP access and non-3GPP access before the
handover of PDN connections to 3GPP access is triggered, then the UE shall
skip steps 2 to 6.
If the UE is connected only to non-3GPP access before the handover of PDN
connections to 3GPP access is triggered, then the UE shall perform steps 2 to
6.
The UE shall perform the steps after step 7 for each PDN connection that is
being transferred from non-3GPP access.
**\- 8.2.1.4: Handover from Trusted or Untrusted Non-3GPP IP Access to 3GPP
Access on S2a/S2b, Using PMIP-based S5/S8**
If the UE is connected to both 3GPP access and non-3GPP access before the
handover of PDN connections to 3GPP access is triggered, then the UE shall
skip steps 2 to 6.
If the UE is connected only to non-3GPP access before the handover of PDN
connections to 3GPP access is triggered, then the UE shall perform steps 2 to
6.
> The UE shall perform the steps after step 7 for each PDN connection that is
> being transferred from non-3GPP access.
**\- 8.2.2: 3GPP Access to Trusted Non-3GPP IP Access Handover with PMIPv6 on
S2a**
If the UE is connected to both 3GPP access and non-3GPP access before the
handover of PDN connections to trusted non-3GPP access is triggered, then the
UE shall skip steps 2 to 10 and only perform step 11 for each PDN connection
that is being transferred from 3GPP access.
If the UE is connected only to 3GPP access before the handover of PDN
connections to trusted non-3GPP access is triggered, then the UE shall perform
steps 2 to 10. In step 4 the UE shall provide an APN corresponding to one of
the PDN connections that are being transferred from 3GPP access. The UE shall
then perform step 11 for each of the remaining PDN connections that are being
transferred from 3GPP access.
The UE shall perform step 12 for each PDN connection that is being transferred
from 3GPP access.
The non-3GPP access shall not attempt to reconnect the UE to multiple PDNs if
the UE provides an APN in step 4, since that is considered an implicit
indication that the UE will establish connectivity with the remaining PDNs
using the UE-initiated procedure.
**\- 8.2.3: E-UTRAN to Untrusted Non-3GPP IP Access Handover with PMIPv6 on
S2b**
If the UE is connected over to 3GPP access and non-3GPP access before the
handover of PDN connections to untrusted non-3GPP access is triggered, then
the UE shall skip step 2.
If the UE is connected only to 3GPP access before the handover of PDN
connections to untrusted non-3GPP access is triggered, then the UE shall
perform step 2.
The UE shall perform steps 3 to 9 for each PDN connection that is being
transferred from 3GPP access.
**\- 8.4.1: Trusted or Untrusted Non-3GPP IP Access to 3GPP Access Handover
with DSMIPv6 over S2c**
If UE is connected to both 3GPP access and non-3GPP access before the handover
of PDN connections to 3GPP access is triggered, then the UE shall skip steps 2
to 16 of Figure 8.2.1.1-1 and only perform step 18 of Figure 8.2.1.1-1 for
each PDN connection that is being transferred from non-3GPP access.
If UE is connected only to non-3GPP access before the handover of PDN
connections to 3GPP access is triggered, then the UE shall perform steps 2 to
16 of Figure 8.2.1.1-1. In step 3 the UE shall provide the APN corresponding
to one of the PDN connections that are being transferred from non-3GPP access.
The UE shall then perform step 18 of Figure 8.2.1.1-1 for each of the
remaining PDN connections that are being transferred from non-3GPP access.
The UE shall perform steps 3 and 4 of Figure 8.4.1-1 for each PDN connection
that is being transferred from non-3GPP access.
**\- 8.4.2: 3GPP Access to Trusted Non-3GPP IP Access Handover with DSMIPv6
over S2c**
If the UE is connected to both 3GPP access and non-3GPP access before the
handover of PDN connections to trusted non-3GPP access is triggered, then the
UE shall skip steps 2 to 5.
If the UE is connected only to 3GPP access before the handover of PDN
connections to trusted non-3GPP access is triggered, then the UE shall perform
steps 2 to 5.
The UE shall perform steps 6 to 12 for each PDN connection that is being
transferred from 3GPP access.
**\- 8.4.3: 3GPP Access to Untrusted Non-3GPP IP Access Handover with DSMIPv6
over S2c**
If the UE is connected to both 3GPP access and non-3GPP access before the
handover of PDN connections to untrusted non-3GPP access is triggered, then
the UE shall skip steps 2 to 5.
If the UE is connected only to 3GPP access before the handover of PDN
connections to untrusted non-3GPP access is triggered, then the UE shall
perform steps 2 to 5.
The UE shall perform steps 6 to 12 for each PDN connection that is being
transferred from 3GPP access.
**\- 12: Interactions Between HSS and AAA Server**
A new procedure allowing the HSS/AAA to update the PDN context on the AGW/ePDG
when UE is simultaneously connected over 3GPP and non-3GPP accesses and the UE
adds, or removes, a PDN connection over the 3GPP access shall be added (see
clause A.1.6)
## A.1.5 Description of the impacts on TS 23.401
**\- 5.3.2.1 E-UTRAN Initial Attach**
This procedure is also used to establish a PDN connection over E-UTRAN with
GTP based S5 or S8 when the UE already has active PDN connections over some
non-3GPP access network and wants to establish simultaneous PDN connections
over multiple accesses.
**\- 5.3.2.2 UTRAN/GERAN Initial Attach**
This procedure along with PDP context activation is also used to establish a
PDN connection over UTRAN/GERAN when the UE already has active PDN connections
over some non-3GPP access network and wants to establish simultaneous PDN
connections over multiple accesses.
**\- 5.10.2 UE requested PDN connectivity**
This procedure is used for establishment of new PDN connectivity or for re-
establishment of existing PDN connectivity when UE is transferring PDN
connections from another access to 3GPP access with GTP based S5 or S8 and
where active PDN connections over this 3GPP access already exist.
## A.1.6 PDN GW Identity Notification to AGW/ePDG
For the case of initial attach, or UE requested PDN connectivity, in the 3GPP
access, the SGSN/MME updates the HSS with the PDN GW identity of the selected
PDN GW and the APN associated w\'th the UE\'s PDN connection. If a 3GPP AAA
Server is registered in the HSS for the same UE, the HSS provides the updated
APN and PDN GW identity information to the 3GPP AAA Server. If PMIPv6 is used
for establishing connectivity in the non-3GPP access, the 3GPP AAA Server
notifies the changes to the non-3GPP access network. This procedure can be
used for both PDN GW registration and de-registration.
Figure A.1.6-1: PDN GW address notification to AGW/ePDG
1\. The SGSN/MME sends a Notify Request (PDN GW Identity, APN, User Identity)
to the HSS.
2\. The HSS checks that the user is known and that the stored SGSN/MME is the
currently registered SGSN/MME for this same user. If this is successful, the
HSS returns a Notify Response.
3\. Steps 3-4 are only performed if the PDN GW identity information was
successfully modified in the HSS and a 3GPP AAA Server is registered in the
HSS for the same UE. In this case the HSS sends a Provide APN and PGW Identity
message to the 3GPP AAA Server. As a result, if PMIPv6 is used for
establishing connectivity in the non-3GP access, the 3GPP AAA Server updates
the non-3GPP access network with the new APN and PGW Identity data.
4\. The 3GPP AAA Server acknowledges by sending a Provide APN and PGW Identity
Ack messa\'e.
Editor\'s note: Possible optimizations to minimize the amount of extra
signalling between the HSS and the 3GPP AAA Server are FFS.
###### ### Annex B: Usage of IMS Service Continuity in conjunction with Multi
Access PDN Connectivity
This clause describes how to use IMS Service Continuity, as specified in TS
23.237 [18], in conjunction with Multi Access PDN Connectivity for
transferring IMS media flows between access systems connected to the EPS.
Relying on the extensions specified in Annex A, clause A.1, the UE may route
multiple simultaneously active PDN connections to different APNs over
different access systems. The operator has the chance to influence the
routeing decisions taken by the UE providing per APN inter-system mobility
policies that can be either pre-configured on the UE or delivered to the UE by
the ANDSF.
As a result, different APNs may use the available access systems, such a 3GPP
access and a set of domestic or public WiFi hotspots, according to different
policies. For example, the operator can set the inter-system mobility policies
so that APN #1 gives higher priority to 3GPP, while APN #2 gives higher
priority to WiFi. This ensures that, if the UE goes under the coverage of a
WiFi hotspot, the PDN connection towards APN #2 is transferred to WiFi, while
the PDN connection towards APN #1 continues to be routed over the 3GPP access.
This mechanism can be exploited by the operator to make sure that different
applications, or IMS media flows, use the available access systems
differently. To that purpose the operator should properly configure on the UE
a set of APN selection policies, that should be used by the UE to select the
APN where a specific application, or IMS media flow, has to be mapped. The APN
selection policies indicate:
\- The preferred APNs to be used for specific application types or IMS media
flows. For example the APN selection policies available on the UE may indicate
that APN #1 is the 144referred\" APN for \"IMS audio\", while APN #2 is the
preferred\" APN for \"IMS video\".
\- The APN to be used as the default choice for the application types or IMS
media flows for which no specific indications are provided.
The APN selection policies can be either pre-configured on the UE or delivered
to the UE in a more dynamic fashion.
Editor\'s note: The details of the mechanisms for delivering the APN selection
policies to the UE are FFS.
The foreseen behaviour of the UE is summarized below:
\- The UE selects the APN to be used for routeing a specific application, or
IMS media flow, based on the APN selection policies. In case of an IMS
application, the UE can use IMS Service Continuity to move different IMS media
flows (e.g. audio, video) between different APNs, as indicated by the APN
selection policies. Once IMS SC has been used to transfer the IMS media flow
to the correct APN, there is no more need to trigger IMS SC procedures, since
mobility between access systems is handled by the EPS.
Editor\'s note: The IMS SC aspects, e.g. how the APN selection policies in the
UE interact with the IMS SC decisions/policies, are FFS.
\- If the APN selection policies indicate that an application, or IMS media
flow, should be mapped to an APN for which the UE has no active PDN
connections, the UE should establish a PDN connection towards the APN
indicated by the APN selection policies. Therefore the UE does not need to
stay permanently connected to all the APNs listed in the APN selection
policies. The UE may disconnect from the unused APNs.
\- The UE routes each APN over the available access systems according to the
inter-system mobility policies.
By properly tuning the inter-system mobility policies and the APN selection
policies, the operator can influence the behaviour of the UE so that specific
applications or IMS media flows are off-loaded to a non-3GPP access, like
WiFi, whenever a non-3GPP access becomes available.
The following tables provide an example of APN selection policies and inter-
system mobility policies. With the policies indicated in the example, if the
UE enters a WiFi hotspot, the audio component of an on-going IMS session
remains on the 3GPP access, while the video flow of the IMS session and any
other application (e.g. browsing, ftp, media synchronization) is transferred
to the WiFi infrastructure.
Table B.1: Example of APN selection policies
* * *
Flow Type Preferred APN IMS audio APN #1 IMS video APN #2 Default APN #2
* * *
Table B.2: Example of inter-system mobility policies
* * *
APN Preferred Access APN #1 3GPP APN #2 WiFi
* * *
The proposed solution has the following characteristics:
\- Using IMS Service Continuity the UE can move the IMS media flows between
APNs at any time and independently of each other. Therefore, for IMS
applications, the UE has the complete freedom of changing the routeing of any
of the active IMS media flows at any time.
\- For non IMS applications, the UE can change the routeing of the entire
traffic aggregate mapped to the same APN. Instead, it is not possible for the
UE to change the routeing of a specific IP flow, while leaving all the others
unaffected.
###### ### Annex C: Access information mapping SDF onto multiple access types
# C.0 Overview
This annex assumes that PCRF policies allow an SDF to be mapped to different
access Types (Preferred Access Type and fallback Access Type), with
preferences for the usage of a Preferred Access Type.
# C.1 Access information mapping SDF onto a single access type
When the Access information (of a PCC rule) can only map a SDF to one and only
one Access Type, each time this Access Type becomes not available and later
becomes available again (e.g. Due to radio load/quality getting under and then
above some thresholds), Gx signalling is needed for the PCRF to be able to
change the mapping between the SDF and an access Type.
This is depicted by following diagram that takes the example Control Plane
signalling of Routing Rules between the UE and the PGW.
Figure C.1-1: Access information mapping SDF onto a single access type
The initial situation is a Multi Access PDN connection supported by 2 Accesses
(on Access Type AT1 and on Access Type AT2).
1 The PCRF makes a policy decision and as for a SDF, both the Preferred Access
Type (AT1) and the fallback Access Type (AT2) are acceptable, the PCRF issues
a PCC Rule mapping the SDF onto the Preferred Access Type (AT1).
2 The UE and the PGW exchange signalling about the Routing Rule mapping the
SDF to AT1.
3\. The traffic is now mapped to the Preferred Access Type (AT1).
4 The radio Load/Quality becomes no more acceptable on the Preferred Access
Type (AT1).
5 The UE issues Routing rule related signalling to warn the PGW that the IP
flows can no more be carried over the Preferred Access Type (AT1).
6 As the PCC rule requires the SDF to be mapped to AT1, the PGW cannot move
the IP flows to another Access Type (AT2) (especially the PCC rule is bound to
one single bearer, on AT1) and notifies the PCRF with the mapping requested by
the UE between IP Flows and access.
7 The PCRF makes a policy decision and updates the PCC rule with Access
information that maps the SDF to another (fallback) Access Type (AT2).
8 The PGW can answer to the Routing rule related signalling of the UE.
9 The traffic is now mapped to the (fallback) Access Type (AT2).
NOTE: The need to notify the PCRF has increased the delay for the network to
take into account the radio event
10 The radio Load/Quality becomes acceptable on the Preferred Access Type
(AT1).
11 The UE issues Routing rule related signalling to warn the PGW that the IP
flows again may be carried over the Preferred Access Type (AT\').
Editor\'s note: The trigger for the UE to issue such signalling is to be
determined \'s from UE\'s perspective the network has asked to map the IP
flows to the (fallback) Access Type (AT2)
12 The PGW notifies the PCRF with the mapping requested by the UE between IP
Flows and access.
13 The PCRF makes a policy decision and updates the PCC rule with Access
information that maps the SDF to the Preferred Access Type (AT1).
14 The PGW can answer to the Routing rule related signalling of the UE.
15 The traffic is now mapped to the Preferred Access Type (AT1).
# C.2 Access information mapping SDF onto a multiple access types
When the Access information (of a PCC rule) can map a SDF multiple Access
Types, the PCRF can send the PCC rule once and does not need to be any more
involved by access dependant events such as changes on radio load/quality.
This is depicted by following diagram that takes the example Control Plane
signalling of Routing Rules between the UE and the PGW.
Figure C.2-1: Access information mapping SDF onto a multiple access types
The initial situation is a Multi Access PDN connection supported by 2 Accesses
(on Access Type AT1 and on Access Type AT2):
1 The PCRF makes a policy decision and as for a SDF, both the Preferred Access
Type (AT1) and the fallback Access Type (AT2) are acceptable, the PCRF issues
a PCC Rule mapping the SDF onto both indicating the Preferred Access Type
(AT1) and the fallback Access Types (AT2).
2 The UE and the PGW exchange signalling about the Routing Rule mapping the
SDF to (AT1, AT2).
3\. The traffic is now mapped to the Preferred Access Type (AT1).
4\. The radio Load/Quality becomes no more acceptable on the Preferred Access
Type (AT1).
5\. The UE issues Routing rule related signalling to warn the PGW that the IP
flows can no more be carried over the Preferred Access Type (AT1).
As the PCC rule allows the SDF to be mapped to fallback Access Types (AT2),
the PGW can move the IP flows.
6\. The PGW answers to the Routing rule related signalling of the UE.
7\. The traffic is now mapped to the (fallback) Access Type (AT2).
8\. The radio Load/Quality becomes acceptable on the Preferred Access Type
(AT1).
9\. The UE issues Routing rule related signalling to warn the PGW that the IP
flows may again be carried over the Preferred Access Type (AT1).
NOTE: The UE can issue such signalling as the Routing Rule associate the IP
flows onto both Access Types
As the PCC rule allows the SDF to be mapped to Preferred Access Type (AT1),
the PGW can move the IP flows.
10\. The PGW answers to the Routing rule related signalling of the UE.
11\. The traffic is now mapped to the Preferred Access Type (AT1).
#
# Foreword
This Technical Specification has been produced by the 3rd Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# Introduction
Network sharing is a way for operators to share the heavy deployment costs for
mobile networks, especially in the roll-out phase. In the current mobile
telephony marketplace, functionality that enables various forms of network
sharing is becoming more and more important. These aspects have not really
been addressed before Release 6 in 3GPP UTRAN based access networks, before
Release 8 in 3GPP E-UTRAN based access networks and before Release 10 in 3GPP
GERAN based access networks, although there has been functionality that
supports a very basic type of network sharing since the Release 5 versions of
the 3GPP specifications.
To cope with 3GPP pre-Release 6 UTRAN UEs and with non supporting 3GPP GERAN
UEs, this specification describes extra functionality for MSCs, SGSNs, BSCs
and RNCs in order to provide network sharing functionality to \"non-supporting
UEs\".
In this Release of the specifications, all UTRAN and E-UTRAN capable UEs are
required to support the UTRAN and E-UTRAN network sharing requirements. Hence
the E-UTRAN and MMEs (which were introduced in 3GPP Release 8) do not need
functionality to handle \"non-supporting UEs\".
Scenarios and user requirements are described in TR 22.951 [1], while the
current document presents the stage 2 details and descriptions of how these
requirements are supported in a 3GPP GERAN, UTRAN and/or E-UTRAN based
network.
# 1 Scope
The present document covers the details of Network Sharing for GERAN, UTRAN
and E-UTRAN. It shows how several core network operators can share one radio
access network and details the impacts on the network architecture. All UEs
shall comply with existing requirements, among them PLMN selection and system
information reception. The present document also defines requirements for
network-sharing supporting UEs.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 22.951: \"Service Aspects and Requirements for Network Sharing\".
[2] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[3] 3GPP TS 25.331: \"RRC Protocol Specification\".
[4] 3GPP TS 23.122: \"NAS Functions related to Mobile Station (MS) in idle
mode\".
> [5] 3GPP TS 32.250: \"Telecommunication management; Charging management;
> Circuit Switched (CS) domain charging\".
[6] 3GPP TS 32.251: \"Telecommunication management; Charging management;
Packet Switched (PS) domain charging\".
[7] 3GPP TS 24.008: \"Mobile radio interface Layer 3 specification; Core
network protocols; Stage 3\".
[8] 3GPP TS 23.236: \"Intra-domain connection of Radio Access Network (RAN)
nodes to multiple Core Network (CN) nodes\".
[9] 3GPP TS 23.401: \"Technical Specification Group Services and System
Aspects; GPRS enhancements for E-UTRAN access\".
[10] 3GPP TS 36.300: \"Evolved Universal Terrestrial Radio Access (E-UTRA) and
Evolved Universal Terrestrial Radio Access (E-UTRAN); Overall description;
Stage 2\".
[11] 3GPP TS 36.331: \"Evolved Universal Terrestrial Radio Access (E-UTRA);
Radio Resource Control (RRC); Protocol specification\".
[12] 3GPP TS 24.301: \"Non-Access-Stratum (NAS) protocol for Evolved Packet
System (EPS); Stage 3\".
[13] 3GPP TS 25.413: \"UTRAN Iu interface, Radio Access Network Application
Part (RANAP) signalling\".
[14] 3GPP TS 36.413: \"Evolved Universal Terrestrial Radio Access Network
(E-UTRAN); S1 Application Protocol (S1AP)\".
[15] 3GPP TS 23.272: \"Circuit Switched (CS) fallback in Evolved Packet System
(EPS); Stage 2\".
[16] 3GPP TS 44.018: \"Radio Resource Control RRC Protocol Specification\".
[17] 3GPP TS 25.467: \"UTRAN architecture for 3G Home Node B (HNB); Stage 2\".
[18] 3GPP TS 22.042: \"Network Identity and Time Zone (NITZ); Service
description; Stage 1\".
[19] 3GPP TS 44.064: \"General Packet Radio Service (GPRS); Mobile Station -
Serving GPRS Support Node (MS SGSN) Logical Link Control (LLC) layer
specification\".
[20] 3GPP TS 23.041: \"Technical realization of Cell Broadcast Service
(CBS)\".
[21] 3GPP TS 29.280: \"3GPP Sv interface (MME to MSC, and SGSN to MSC) for
SRVCC\".
[22] 3GPP TS 23.060: \"General Packet Radio Service (GPRS); Service
description; Stage 2\".
[23] 3GPP TS 22.011: \"Service Accessibility\".
[24] 3GPP TS 48.018: \"General Packet Radio Service (GPRS); Base Station
System (BSS) - Serving GPRS Support Node (SGSN); BSS GPRS Protocol (BSSGP)\".
[25] 3GPP TS 48.008: \"Mobile-services Switching Centre Base Station System
(MSC BSS) interface; Layer 3 specification\".
[26] 3GPP TS 29.018: \"General Packet Radio Service (GPRS); Serving GPRS
Support Node (SGSN) Visitors Location Register (VLR); Gs interface layer 3
specification\".
[27] 3GPP TS 29.118: \"Mobility Management Entity (MME) - Visitor Location
Register (VLR) SGs interface specification\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the following terms and definition
below apply. Terms and definitions not defined below can be found in TR 21.905
[2].
**Conventional network:** A PLMN consisting of radio access network and core
network, by which only one serving operator provides services to its
subscriber. Subscribers of other operators may receive services by national or
international roaming.
**Common PLMN:** The PLMN-id indicated in the system broadcast information as
defined for conventional networks, which non-supporting UEs understand as the
serving operator.
**Core network operator:** An operator that provides services to subscribers
as one of multiple serving operators that share at least a radio access
network. Each core network operator may provide services to subscriber of
other operators by national or international roaming.
**Gateway Core Network** : A network sharing configuration in which parts of
the core network (MSCs/SGSNs/MMEs) are also shared.
**Multi-Operator Core Network** : A network-sharing configuration in which
only the RAN is shared.
**Non-supporting UE:** A UE that does not support network sharing in the sense
that it ignores the additional broadcast system information that is specific
for network sharing for 3GPP UTRAN and GERAN. In other specifications, the
term \"network sharing non-supporting UE\" may be used.
**Supporting UE:** A UE that supports network sharing in the sense that it is
able to select a core network operator as the serving operator within a shared
network. In other specifications, the term \"network sharing supporting UE\"
may be used.
**Anchor PLMN:** With regard to SRVCC from CS to PS, this Anchor PLMN points
to the PS domain operator in which the voice media is anchored in Access
Transfer Gateway as part of the SRVCC procedure.
## 3.2 Void
## 3.3 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[2] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [2].
BSC Base Station Controller
CN Core Network
E-UTRAN Evolved Universal Terrestrial Radio Access Network
eNodeB E-UTRAN NodeB
gsmSCF GSM Service Control Function
GERAN GSM/EDGE Radio Access Network
GUTI Globally Unique Temporary Identity
GWCN Gateway Core Network
HLR Home Location Register
HSS Home Subscriber Server
MCC Mobile Country Code
MME Mobility Management Entity
MNC Mobile Network Code
MOCN Multi-Operator Core Network
MSC Mobile Switching Centre
NITZ Network Identity and Time Zone
PLMN Public Land Mobile Network
RNC Radio Network Controller
SGSN Serving GPRS Support Node
TMSI Temporary Mobile Subscriber Identity
UE User Equipment
UTRAN Universal Terrestrial Radio Access Network
VLR Visitor Location Register
# 4 General Description
## 4.1 Overview
A network sharing architecture shall allow different core network operators to
connect to a shared radio access network. The operators do not only share the
radio network elements, but may also share the radio resources themselves. In
addition to this shared radio access network the operators may or may not have
additional dedicated radio access networks, like for example, 2G radio access
networks. There are two identified architectures to be supported by network
sharing. They are shown in the figures below.
In both architectures, the radio access network is shared. Figure 1 below
shows reference architecture for network sharing in which also MSCs and SGSNs
are shared. This configuration will be referred to as a Gateway Core Network
(GWCN) configuration.
Figure 1: A Gateway Core Network (GWCN) configuration for network sharing.\
Besides shared radio access network nodes, the core network operators also\
share core network nodes
Figure 2 below shows the reference architecture for network sharing in which
only the radio access network is shared, the Multi-Operator Core Network
(MOCN) configuration.
Figure 2: A Multi-Operator Core Network (MOCN) in which multiple CN nodes are\
connected to the same RNC and the CN nodes are operated by different operators
The UE behaviour in both of these configurations shall be the same. No
information concerning the configuration of a shared network shall be
indicated to the UE.
For the Evolved Packet System, only the PS domain of the above figures is
relevant. For E‑UTRAN access Figures 1 and 2 both apply but with the MME
replacing the SGSN, the eNodeB replacing the RNC, and the S1 reference point
replacing the Iu interface.
For GERAN access, both GWCN and MOCN are applicable but with the BSC replacing
the RNC and the A/Gb-Interfaces replacing the Iu interface.
## 4.2 Core Network Operator and Network Selection
Network sharing is an agreement between operators and shall be transparent to
the user. This implies that a supporting UE needs to be able to discriminate
between core network operators available in a shared radio access network and
that these operators can be handled in the same way as operators in non-shared
networks.
### 4.2.1 Core network operator identity
A core network operator is identified by a PLMN-id (MCC+MNC).
### 4.2.2 Broadcast system information for network sharing
If a shared RAN is configured to indicate available core network operators for
selection by UEs, each cell in shared radio access network shall in the
broadcast system information include information concerning available core
network operators in the shared network. The available core network operators
shall be the same for all cells of a Location Area in a shared UTRAN or GERAN
network. The available core network operators shall be the same for all cells
of a Tracking Area in a shared E‑UTRAN network. A supporting UE decodes the
broadcast system information and takes the information concerning available
core network operators into account in network and cell (re-)selection
procedures. Broadcast system information is specified in TS 44.018 [16] for
GERAN, TS 25.331 [3] for UTRAN and TS 36.331 [11] for E‑UTRAN.
### 4.2.3 Network selection in a shared network
#### 4.2.3.1 Behaviour of supporting UEs (GERAN, UTRAN and E-UTRAN)
In some sharing scenarios, the sharing operators require the UTRAN/GERAN to
broadcast, to non-supporting UEs, a PLMN ID that does not identify any of the
sharing core network operators. In this case, it is necessary that a
supporting UE does not select this \"common PLMN ID\".
In other sharing scenarios, the sharing operators may want the PLMN broadcast
to non-supporting UEs to be selectable by supporting UEs.
A supporting UE decodes the broadcast system information to determine
available core network operators in the shared network. The UE regards both
the core network operators indicated in the broadcast system information and
conventional networks as individual networks. The core network operators
together with all conventional networks are candidate PLMNs for the PLMN
selection procedure that shall be performed by the UE as specified in TS
23.122 [4].
In GERAN and UTRAN, non-supporting UEs use the broadcast \"common PLMN-id\" in
their PLMN (re)selection processes.
In UTRAN, supporting UEs shall use the PLMN-ids that are broadcast in the
Multiple PLMN ID List information element in their PLMN (re)selection
processes. UTRAN AS signalling permits the Multiple PLMN ID List to indicate
to supporting UEs whether to include or exclude the MCC+MNC of the \"common
PLMN-id\" in their network (re)selection processes.
For supporting UEs, GERAN provides equivalent functionality to UTRAN.
For E‑UTRAN, the UE uses all of the broadcast PLMN-ids in its PLMN
(re)selection processes.
#### 4.2.3.2 Behaviour of non-supporting UEs (GERAN, UTRAN)
Non-supporting UEs ignore the broadcast system information that is relevant
for network sharing. The common PLMN together with all conventional networks
are candidate PLMNs for the PLMN selection procedure that shall be performed
by the UE as specified in TS 23.122 [4].
It is recommended for the network and the UE to support the Network Identity
part of the Network Identity and Time Zone (NITZ) feature (see TS 22.042 [18])
for providing the UE with the name of the serving PLMN operator.
### 4.2.4 Assignment of core network operator and core network node
When a UE performs an initial access to a shared network, one of available CN
operators shall be selected to serve the UE. For non-supporting UEs, the
shared network selects an operator from the available CN operators. For
supporting UEs, the selection of core network operator by the UE shall be
respected by the network. Supporting UEs inform the BSC/RNC/eNodeB of the
network identity of the chosen core network operator.
In a UTRAN GWCN configuration, the RNC relays the chosen network identity to
the shared core network node (in UTRAN MOCN, the RNC indicates that the UE is
a \"supporting UE\" by relaying the chosen network identity to the core
network node). To permit GWCN operation, in E‑UTRAN, the eNodeB always relays
the chosen network identity to the shared MME. In a GERAN GWCN configuration,
the BSC relays the chosen network identity to the core network node (in GERAN
MOCN, the BSC indicates that the UE is a \"supporting UE\" by relaying the
chosen network identity to the core network node).
In a MOCN configuration, the RAN routes the UE\'s initial access to the shared
network to one of the available CN nodes. Supporting UEs shall inform the RAN
of the chosen core network operator so that the RAN can route correctly. For
non-supporting UEs the shared network selects an operator from the available
CN operators. A redirection to another CN operator may be required for non-
supporting UEs until an operator is found that can serve the UE. Redirection
is described in clause 7.1.4.
After initial access to the shared network the UE does not change to another
available CN operator as long as the selected CN operator is available to
serve the UE\'s location. Only the network selection procedures specified in
TS 23.122 [4] may cause a reselection of another available CN operator. Also
the network does not move the UE to another available CN operator, e.g. by
handover, as long as the selected CN operator is available to serve the UE\'s
location. Furthermore the UE does not change to another CN node as long as the
selected CN node is available to serve the UE\'s location.
In GERAN and UTRAN, when the network signals location/routing area identities
to supporting UEs, e.g. in location updating accept messages, these identities
shall contain the chosen core network operator identity. For non-supporting
UEs, they shall contain the common PLMN. The UE stores the received LAI/RAI on
the SIM/USIM, as already specified in TS 24.008 [7].
In E‑UTRAN, the chosen core network operator identity is included in the GUTI
in e.g. the Attach Accept message. The UE shall store the received GUTI on the
USIM according to the rules specified in TS 24.301 [12].
### 4.2.5 PS and CS domain registration coordination in UTRAN and GERAN
In conventional networks, the same CN operator always serves the UE in CS and
PS domains. In a shared network, supporting UEs shall behave as UEs in
conventional networks with respect to registration with CS and PS domains and
always register with the same operator for the CS and PS domains. CS/PS
coordination should be performed at registration when a redirect attempt flag
is included in A/Gb/Iu messages carrying the NAS registration message (see TS
48.008 [25], TS 48.018 [24], and TS 25.413 [13]). The term registration
includes attach, and LA and RA updates.
When multiple PLMNs are available and SRVCC from UTRAN/GERAN CS domain to
E-UTRAN/HSPA PS is deployed, the source BSC/RNC determines a core network
operator to be used in the target network based on current PLMN in use, Anchor
PLMN provided by PS core network, or other information present in the BSC/RNC.
The source BSC/RNC shall at handover indicate the selected core network
operator to the source core network node in the handover required message. The
anchor MSC Server shall forward the selected core network operator chosen by
the source BSC/RNC to the target MME/SGSN.
### 4.2.5a PS and CS domain registration coordination in E-UTRAN
When multiple core network operators share the E‑UTRAN using a GWCN
configuration, separate MSCs may still be used for the CS Fall Back
functionality. In this case the MME uses the \'selected network\' information
received from the E‑UTRAN to select an MSC from the already selected operator.
When multiple PLMNs are available for CS domain, the MME selects the MSC for
CS Fallback functionality based on the \'selected network\' information
received from the E‑UTRAN, current TAI, old LAI provided by the UE and
operator selection policies as specified in TS 23.272 [15]. In this case, the
selected PLMN-id for CS domain may be different to the PLMN-id for EPS domain.
If the selected MSC is shared network configured, the MME selects the CS
domain operator as specified in TS 23.272 [15]. If the UE is a GERAN network-
sharing non-supporting UE and the preferred RAT of the selected CS network is
GERAN with GWCN configuration, or the preferred RAT of the selected CS network
is shared network in GWCN configuration not offering the broadcast of
available Core Network operators for selection by the UE, the MME sends the
\'selected CS domain operator\' in addition to the Common PLMN-id included in
the LAI to the VLR. If the MSC is GWCN configured, the MSC applies local
policy (e.g. uses a fixed split of IMSI ranges or IMSI hash) to determines the
CN operator when the PLMN-id included in the LAI contains Common PLMN-id (i.e.
does not identify any CS domain operator) and the \'selected CS domain
operator\' is absent. Otherwise, the MSC accepts the CS domain operator
selected by the MME.
When multiple PLMNs are available for CS domain and SRVCC from E-UTRAN PS to
UTRAN/GERAN CS domain is deployed, the MME sends the Handover Restriction List
(see TS 23.401 [9]) to eNB including the currently serving PLMN and equivalent
PLMNs together with information about which PLMNs are preferred for SRVCC. The
eNB selects target PLMN for SRVCC from the list based on HRL and local policy
and constructs the Neighbour Cell list (NCL) based on this knowledge of the
target PLMN. The selected target core network PLMN should, if possible, be the
same as the one in use.
#### 4.2.5.1 Void
#### 4.2.5.2 Void
#### 4.2.5.3 CS/PS domain coordination and operator selection in GERAN and
UTRAN
At combined or non-combined registration by a non-supporting UE the BSC/RNC
routes the request to one of the available CN nodes. In all Attach
Request/Routeing Area Update Request/Location Area Update Request messages
from the BSC/RNC to CN a redirect attempt flag shall be included to indicate
that the CN should either return a Reroute Command or a Reroute Complete
message. If the BSC/RNC can determine that the UE is already served by a CN
operator in the opposite domain, then a CN node from this operator shall be
selected and the serving CN operator shall be indicated to the CN node
together with an indication that the selected CN operator is already serving
the UE in the opposite domain. If the BSC/RNC cannot determine a CN operator
this way, the selection of CN node by the BSC/RNC is based on the NRI if
provided by the UE. The RAN stores the NRI received from the UE.
If the UE is already served by the CN node that receives the registration
request and this CN node can continue to serve the UE (for example if there
are no regional roaming restrictions for the target area), or if the UE is a
non-roaming subscriber, or if the BSC/RNC indicated a BSC/RNC selected CN
operator and that the selected CN operator is serving the UE in the opposite
domain then the CN node accepts the registration attempt and completes the
registration procedure. Otherwise the CN node returns IMSI and a Reroute
Command message to the BSC/RNC with an indication that it is for coordination
purposes. The old LAI (for the CS domain) or old RAI (for the PS domain), or
an indication whether the UE is attaching shall also be included.
Based on information received from CN node (old LAI or old RAI), UE (CS-NRI or
PS-NRI, as stored in the RAN) and BSC/RNC internal configuration the BSC/RNC
concludes whether:
(i) The UE is \'under operator coordination\' i.e. if the UEs (CS-NRI, old
LAI) tuple for the CS domain or (PS-NRI, old RAI) tuple for the PS domain can
be used to uniquely identify one of the operators in the shared network. The
old RAI/PS-NRI can be \"native\" (i.e. no RAT change) or \"mapped\" (i.e. RAT
change).
(ii) The UE is not \'under operator coordination\' i.e. the UEs (CS-NRI, old
LAI) tuple for the CS domain or (PS-NRI, old RAI) tuple for the PS domain
cannot uniquely identify any operator in the shared network. The old RAI/PS-
NRI can be \"native\" (i.e. no RAT change) or \"mapped\" (i.e. RAT change).
(iii) The UE is attaching.
For case (i) the BSC/RNC selects serving CN operator based on the identified
operator and routes the request to the selected operator. The IMSI and the
BSC/RNC selected CN operator shall be indicated to the CN.
For case (ii) and (iii) the BSC/RNC shall for a (combined or non-combined)
registration attempt in the PS domain query its connected MSCs, whether the UE
is registered with any of the sharing operators in the CS domain. Similarly
for a registration attempt in the CS domain the BSC/RNC shall query its
connected SGSNs, whether the UE is registered at any of the sharing operators
in the PS domain. For a registration attempt in the CS domain this means that
the SGSNs on behalf of the BSC/RNC may be needed to query all MMEs that may
hold the UEs context of the sharing operators whether the UE is registered at
any of the MMEs of the sharing operators. Registration in MME but not in the
CS domain can e.g. occur at cell reselection from LTE for a UE that is not SGs
registered. If MMEs are not updated to support registration queries, it may
not be possible to guarantee CS/PS coordination in certain scenarios.
For case (ii) and (iii) and if the UE is found to be registered with one of
the sharing operators then that operator shall be selected by the BSC/RNC and
the registration message shall be forwarded to a CN node of this operator. The
BSC/RNC selected CN operator shall be indicated to the CN and the BSC/RNC
shall indicate that BSC/RNC selected CN operator is serving the UE in the
opposite domain.
For cases (ii) and (iii) and the UE is not found to be registered at one of
the sharing operators then the BSC/RNC routes the request to one of the
available CN operators. Selection of CN operator is done in the BSC/RNC by
IMSI analysis, e.g. using a fixed split of IMSI ranges or IMSI hash table
between operators, etc. The CN node / CN operator selection may result in that
the registration is sent back to the same CN node or CN operator again. At
non-combined registration CS/PS coordination is done in the BSC/RNC (without
memorising IMSI information for IDLE mode UEs) by applying the same IMSI
analysis for both CS and PS domains. The BSC/RNC selected CN operator shall be
indicated to the CN and IMSI shall be included to the CN node.
If a registration attempt is ongoing in the PS domain when a registration
attempt starts in the CS domain then the BSC/RNC selects operator as specified
below and the IMSI and the BSC/RNC selected CN operator shall be sent to the
CN node:
\- If for the CS domain case (i) applies then that operator shall be selected
for both domains.
\- If for the CS domain case (ii) or (iii) applies then depending on:
\- If for the PS domain case (i) applies then that operator shall be selected
for both domains
\- If for the PS domain case (ii) or (iii) applies then the BCS/RNC selects
operator for both domains based on IMSI analysis
Similar handling applies if a registration attempt is ongoing in the CS domain
when a registration attempt starts in the PS domain.
At combined registration the SGSN may indicate over Gs interface the selected
CN operator that serves the subscriber.
NOTE: Support for CS/PS domain coordination functionality as specified in this
release requires support in shared CN nodes (for GWCN) and non-shared CN nodes
(for MOCN) as well as in the shared RAN to achieve CS/PS coordination for UEs
in the shared network. If sufficient support is not available, CS/PS
coordination is performed as in pre- Release 13.
### 4.2.6 Attach/detach handling
To attach to the same core network operator from which it detached, a UE uses
information stored in the UE (e.g. on the SIM/USIM) when the UE was detached.
For a supporting UE in a shared network, the stored information indicates the
core network operator it detached from (as specified in clause 4.2.4). This
information enables a supporting UE to attach to the same core network
operator from which it detached. For non-supporting UEs in a shared network,
the stored information indicates the common PLMN.
## 4.3 Network Name Display for Supporting UEs
A supporting UE shows the name of the PLMN-id it has registered with. In case
of a shared network, it is the PLMN-id of the chosen core network operator.
The name stored in the UE for the PLMN-id is displayed except when the network
indicates to the UE a name to be displayed, as already specified for non-
supporting UEs.
## 4.4 HPLMN Support
The use of a shared VLR/SGSN/MME shall not result in service restrictions,
e.g. roaming restrictions. Since the HSS and gsmSCF derives whether the
subscriber roams in H- or V-PLMN from the VLR/SGSN/MME identifier, a shared
VLR/SGSN/MME in a GWCN shall be allocated a separate identifier from each
operator sharing that CN node, i.e. a shared VLR/SGSN/MME has multiple
identifiers. The VLR/SGSN/MME identifier of the user\'s serving CN operator
(either the one selected by a supporting UE, or, the one allocated by the
network for a non-supporting UE) shall be used in signalling with the HSS and
the gsmSCF.
In the roaming scenario, the VPLMN shall ensure that any PLMN ID that is
communicated to the HPLMN via any interface is that of the selected Core
Network Operator for supporting UEs, or that of the allocated Core Network
Operator for non-supporting UEs. An exception to this is that the HPLMN
operator may specify in the inter-operator roaming/sharing agreement that for
non-supporting UEs any PLMN ID that is communicated to the HPLMN is the Common
PLMN ID.
When the MME/SGSN and PGW/GGSN pertain to the same PLMN, i.e. in non-roaming
scenario and in roaming local breakout scenario, the Primary PLMN ID shall be
communicated in ECGI to the PGW, and the Common PLMN ID shall be communicated
in SAI/CGI to the PGW/GGSN for both supporting and non-supporting UEs.
## 4.5 Support of Cell Broadcast Services and Warning System
In shared networks Cell Broadcast and Warning System services are provided via
a single common CBC, which connects to GERAN/UTRAN as described in TS 23.041
[20] and connects to E-UTRAN as described in TS 23.401 [9]. The deployment and
configuration of the common CBC is per agreement between the sharing
operators. The sharing operators need to coordinate the broadcast services
between each other, e.g. how to provide Warning System services.
## 4.6 Support of Extended Access Barring
In shared networks, BSC/RNC/eNodeB shall provide independent support for the
barring of MSs configured for Extended Access Barring (as defined in TS 22.011
[23]) for each sharing operator. The BSC/RNC/eNodeB may initiate Extended
Access Barring for a specific sharing operator when all the SGSNs/MMEs
belonging to that sharing operator connected to this BSC/RNC/eNodeB request to
restrict the load for UEs configured for low access priority, or if requested
by O&M. Broadcast Extended Access Barring information is specified in TS
44.018 [16] for GERAN, TS 25.331 [3] for UTRAN and TS 36.331 [11] for E‑UTRAN.
## 4.7 Support of service identification for improved radio utilization for
GERAN
Service Class Indicator (SCI) for improved radio utilization for GERAN (see TS
23.060 [22]) is supported in shared network for A/Gb mode GERAN PS domain. The
A/Gb mode GERAN identifies the service class associated with downlink user
plane packets according to TS 23.060 [22]. When deciding whether to use or
discard the SCI information, the A/Gb mode GERAN may need to take the identity
of the MS\'s Core Network operator into account.
# 5 Functional description
The new behaviours of network nodes needed in order to describe network
sharing are described.
## 5.1 UE functions
A supporting UE operating in Idle mode selects the core network operator and
provides the PLMN-id of this operator to the network for routing purposes and
to indicate which of the core network operators is selected. A supporting
GERAN UE provides PLMN-index when establishing a connection with the MSC, and,
when sending GPRS LLC frames with a non-local TLLI.
A supporting GERAN UE, upon completion of a CS or PS handover, uses the PLMN
index received during the CS handover and PS handover procedure to indicate
the selected PLMN in the subsequent RAU in connected mode if the conditions
for performing a normal RAU are met, see 3GPP TS 24.008, when sending GPRS LLC
frames with a non-local TLLI. Normal RAU following a CS handover is performed
if the UE and the network support DTM and the conditions for RAU are met
whereas a RAU following a PS handover is performed if the conditions for
normal RAU are met.
## 5.2 RNC functions
Network sharing information, i.e. available core network operators in the
shared network, shall be transmitted in broadcast system information.
If system information relating to NAS is transmitted to a UE in dedicated
signalling, the RNC sends information for both supporting and non-supporting
UEs and the UE shall select the appropriate information to use.
The RNC shall indicate the UE selected core network operator to the CN for
supporting UEs when transferring initial layer 3 signalling. The selected CN
operator is (i) indicated by the UE in RRC signalling or (ii) known implicitly
from an already existing signalling connection. For non-supporting UEs, the
RNC selected core network operator shall, if available, be indicated by the
RNC to the CN. RNC selection of core network operator is described in clause
4.2.5.3.
In case of relocation to a shared network:
\- the source RNC determines a core network operator to be used in the target
network, including the selection of PLMN(s) to support SRVCC functionality
from CS domain to PS, based on available shared networks access control
information, current PLMN in use, Anchor PLMN, or similar information present
in the node, the source RNC shall at relocation indicate that selected core
network operator to the source core network node as part of the TAI/RAI sent
in Target ID in the Relocation Required message. The selected target core
network operator should be the same as the one in use. If the source core
network operator is not supported in the target cell the RNC selects the
target PLMN based on either (i) pre-configured information in the RNC, or (ii)
the SNA (Shared Network Area) Access Information IE (see TS 25.413 [13])
provided by the SGSN. When the RNC triggers the enhanced relocation and
selects a new PLMN, the selected PLMN is indicated to the SGSN during the
following RA update procedure.
\- In order to support SRVCC from CS to PS, the source RNC informs the target
RNC/BSC of the Anchor PLMN identity.
\- The target RNC may need to know whether or not the UE supports UTRAN
network sharing.
The behaviour of the RNC in relation to CS/PS coordination for non-supporting
UEs is described in clause 4.2.5.3.
NOTE: For PS-to-CS SRVCC, any SRVCC specific PLMN information should be pre-
configured in the RNC.
## 5.2a eNodeB functions
Network sharing information, i.e. available core network operators in the
shared network, shall be transmitted in broadcast system information.
The eNodeB shall indicate the selected core network operator when transferring
initial layer 3 signalling. The eNodeB uses the selected core network
information (provided by the UE at RRC establishment, or, provided by the
MME/source eNodeB at S1/X2 handover) to select target cells for future
handovers (and radio resources in general) appropriately.
In the case of handover to a shared network:
\- the source eNodeB determines a core network operator to be used in the
target network based on current PLMN in use, or other information present in
the eNodeB, the source eNodeB shall at handover indicate that selected core
network operator to the MME as part of the TAI/RAI sent in the HO required
message. The selected target core network operator should be the same as the
one in use. This is accomplished by not changing the serving PLMN if the PLMN
in use is supported in the target cell. If the PLMN in use is not supported in
the target cell the eNB selects the target PLMN based on either (i) pre-
configured information in the eNB, or (ii) the Equivalent PLMNs list (see TS
36.413 [14]) provided by the MME.
\- when multiple PLMNs are available for CS domain to support CS Fallback
functionality, the source eNodeB determines a core network operator to be used
in the target GERAN/UTRAN network based on the allocated LAI provided by the
MME as specified in TS 23.272 [15]. The source eNodeB shall at handover
indicate that selected core network operator to the MME as part of the Target
ID sent in the HO required message. If the selected PLMN for CS domain is not
supported in the target cell the eNodeB selects the target PLMN based on
either (i) pre-configured information in the eNodeB, or (ii) the Equivalent
PLMNs list (see TS 36.413 [14]) provided by the MME.
\- when multiple PLMNs are available for CS domain to support SRVCC
functionality, the source eNodeB determines a core network operator to be used
in the target GERAN/UTRAN network. If the currently serving PLMN is not
supported in the target cell, the eNodeB selects the target PLMN based local
configured information in the eNodeB along with the information provided by
the MME in HRL (see TS 36.413 [14]). The HRL provides the currently serving
PLMN and equivalent PLMNs together with information about which PLMNs are
preferred for SRVCC target cell selection. The source eNodeB shall at SRVCC
handover indicate the selected core network operator to the MME as part of the
Target ID sent in the HO required message.
\- the target eNodeB uses the selected core network information to select
target cells for future handovers appropriately.
In the case of dual connectivity (as described in TS 36.300 [10]):
\- the Master eNodeB uses the selected core network information to select any
Secondary Cell Group appropriately (e.g. to respect network sharing
agreements).
## 5.2b BSC functions
Network sharing information, i.e. available core network operators in the
shared network, shall be transmitted in broadcast system information.
If system information is transmitted to a supporting UE in dedicated
signalling e.g. to support handover to other RATs, the BSC shall indicate the
PLMN-id of the core network operator towards which the UE already has a
signalling connection (if a PLMN-id is included in the signalling). If the UE
is non-supporting, the BSC shall indicate the common PLMN (if a PLMN-id
identity is included in the signalling).
The BSC shall indicate the selected core network operator to the CN for
supporting UEs. The selected CN operator is:
i) indicated by the UE to the BSC as follows:
\- for the CS domain, in the Initial L3 message, a supporting UE shall send
the PLMN Index that corresponds to the position of the chosen PLMN in the
broadcast system information, as part of the Initial L3 message. The BSC shall
then derive the PLMN-id chosen by the UE from the indicated PLMN Index, select
the corresponding CN operator and inform the MSC of the chosen PLMN-id;
\- for the PS domain, when the UE has a non-local TLLI, a supporting UE shall
send the PLMN Index that corresponds to the position of the chosen PLMN in the
broadcast system information, as part of the AS signalling. The BSC shall then
derive the PLMN-id chosen by the UE from the indicated PLMN Index, select the
corresponding CN operator and inform the SGSN of the chosen PLMN-id;
or:
ii) known implicitly from an already existing signalling connection.
For non-supporting UEs, the BSC selected core network operator shall, if
available, be indicated by the BSC to the CN.
In the PS domain, when the UE has a local TLLI:
\- for MOCN, the BSC uses the NRI bits from within the TLLI to derive the
selected CN operator;
\- for GWCN, the SGSN passes the selected CN operator identity with the
downlink user data/signalling.
For handover to a shared network from GERAN:
\- the source BSC determines a core network operator to be used in the target
network, including the selection of PLMN(s) to support SRVCC functionality
from CS domain to PS, based on current PLMN in use, Anchor PLMN, or other
information present in the BSC. The selected target core network operator
should be the same as the one in use. If the source core network operator is
not supported in the target cell the BSC selects the target PLMN based on pre-
configured information in the BSC.
\- the source BSC shall indicate the target core network operator PLMN ID to
the source core network node as part of the TAI/RAI sent in the Target Cell
Identifier IE/Target RNC Identifier IE/Target eNodeB Identifier IE in the PS-
Handover-Required message (TS 48.018 [24]) and in the LAI sent in the Cell
Identifier List IE in the Handover Required message (TS 48.008 [25]).
\- In order to support SRVCC for CS to PS, the source BSC informs the target
RNC/BSC of the Anchor PLMN identity.
For handover to a GERAN shared network:
\- The target BSS needs to know whether or not the UE supports GERAN network
sharing.
\- the source RAN determines a core network operator to be used in the target
network and indicates the selected target core network operator PLMN ID to the
source core network node. The target MSC/SGSN indicates the selected target
core network operator to target BSC.
\- At CS handover the target BSC (BSS-B) shall, for a GERAN supporting UE,
provide PLMN index information corresponding to the selected target PLMN-id
via the source RAN. When the UE arrives in the target cell the target BSC
shall indicate the RAI corresponding to the selected PLMN.
\- At PS handover the target BSC (BSS-B) shall, for a GERAN supporting UE,
provide PLMN index information corresponding to the selected target PLMN-id
via the source RAN. The target BSC shall also via the source RAN indicate the
RAI corresponding to the selected PLMN.
\- At normal RAU in connected mode after completing a handover, the target BSC
is informed of the PLMN index corresponding to the selected target PLMN when
the UE appears in the target access.
In all other non handover signalling from the GERAN to the MSC/SGSN, unless
specified differently by stage 3 specifications, any PLMN ID sent is the
Common PLMN ID. In signalling from the Core Network to the GERAN, the BSS
shall accept signalling that uses any of the PLMN IDs that share the cell.
The behaviour of the BSC in relation to CS/PS coordination for non-supporting
UEs is described in clause 4.2.5.3.
## 5.3 MSC functions
When a UE accesses an MSC the first time, i.e. when there is no VLR entry for
this UE, the MSC retrieves the IMSI from another MSC/VLR or from the UE. For
GWCN, the MSC determines a serving CN operator based on the UE Selected
operator (PLMN) indicated by the RAN, or, for a non-supporting UE, based on
the RAN Selected CN operator (PLMN). The MSC/VLR shall also store the identity
of the serving core network operator.
In the case of a MOCN configuration, an MSC may not be able to provide service
to the UE. The UE may then have to be redirected to a MSC of another core
network operator. The MSC/VLR that finally serves the UE assigns a NRI to the
UE. This will allow the RAN to route any subsequent UE accesses to the serving
MSC/VLR.
The behaviour of the MSC in relation to CS/PS coordination for non-supporting
UEs is described in clause 4.2.5.3.
For supporting UEs, i.e. when a UE selected core network operator has been
indicated to the MSC by the RNC/BSC, the MSC indicates the selected core
network operator PLMN-id in the LAI signalled to the UE in dedicated
signalling.
For sharing scenarios with both E-UTRAN and GERAN/UTRAN access, where the
network also applies idle-mode signalling reduction (see TS 23.401 [9]), the
contents of the SNA Access Information IE (see TS 25.413 [13]) provided by the
MSC to the RNC for a specific UE guides the target PLMN selection if the UE\'s
registered PLMN is not available in the target cell. The SNA Access
Information IE should be configured such that for any target cell there is
only one PLMN-ID that can be selected for the cell.
Also, for the above scenario, in the routing areas and tracking areas between
which ISR may be activated the \"equivalent PLMNs\" list provided by the SGSN,
MSC and MME to a UE (see TS 24.008 [7]) should result in a single consistent
\"equivalent PLMNs\" list stored by the UE. The single \"equivalent PLMNs\"
list applies to all the UE\'s registered routing areas, location areas and
tracking areas.
In case of relocation to a GWCN or a MOCN:
\- There is no functionality in the source MSC to select a target core network
operator or to modify the target core network operator selected by the
RNC/BSC.
\- For handover to a shared UTRAN the source MSC shall forward the selected
core network operator chosen by the source RNC/BSC to the target MSC, which
relays this information unchanged to the target RNC so that the appropriate
PLMN-id can be signalled to the UE in dedicated system information signalling,
as described in clause 5.2.
\- For handover to a shared GERAN the source MSC shall forward the PLMN-ID
selected by the source RAN to the target MSC. Target MSC sends information of
selected operator to the target BSC.
\- For SRVCC from E-UTRAN PS to UTRAN/GERAN CS domain, in case of GWCN
configuration, the MSC selects the target PLMN based on the indication of the
selected target PLMN provided by the MME/SGSN in the PS-to-CS handover
command. The MSC receives the Anchor PLMN from the MME/SGSN and forwards that
information to the target BSC/RNC.
For SRVCC from UTRAN/GERAN CS domain to E-UTRAN/HSPA PS, the MSC selects the
MME based on selected target PLMN provided by the RNC/BSC in handover required
message and forwards the selected target PLMN to MME in the CS to PS handover
request.
In signalling to the HSS, the MSC shall ensure that any PLMN ID that is sent
is the ID of the selected Core Network Operator for supporting UEs, or that of
the allocated Core Network Operator for non-supporting UEs (unless the
exception to send the Common PLMN ID for a non-supporting UE (see clause 4.4)
is in use with that HPLMN).
## 5.4 SGSN functions
When a UE accesses an SGSN the first time, i.e. when the UE is not yet known
by the SGSN the SGSN retrieves the IMSI from another SGSN/MME or from the UE.
For GWCN, the SGSN determines a serving CN operator based on the Selected PLMN
indicated by the RAN, or, for a non-supporting UE, based on the RAN Selected
CN operator (PLMN). The SGSN shall store the identity of the serving core
network operator.
In the case of a MOCN configuration, a SGSN may not able to provide service to
the UE. The UE may then have to be redirected to a SGSN of another core
network operator. The SGSN that finally serves the UE assigns a NRI to the UE.
This will allow the RAN to route any subsequent UE accesses to the serving
SGSN.
The behaviour of the SGSN in relation to CS/PS coordination for non-supporting
UEs is described in clause 4.2.5.3.
For supporting UEs, i.e. when a UE selected core network operator has been
indicated to the SGSN by the RNC/BSC, the SGSN indicates the selected core
network operator PLMN-id in the LAI/RAI signalled to the UE in dedicated
signalling.
For sharing scenarios with both E-UTRAN and GERAN/UTRAN access, where the
network also applies idle-mode signalling reduction (see TS 23.401 [9]), the
contents of the SNA Access Information IE (see TS 25.413 [13]) provided by the
SGSN to the RNC for a specific UE guides the target PLMN selection if the
UE\'s registered PLMN is not available in the target cell. The SNA Access
Information IE should be configured such that for any target cell there is
only one PLMN-ID that can be selected for the cell.
Also, for the above scenario, in the routing areas and tracking areas between
which ISR may be activated the \"equivalent PLMNs\" list provided by the SGSN,
MSC and MME to a UE (see TS 24.008 [7]) should result in a single consistent
\"equivalent PLMNs\" list stored by the UE. The single \"equivalent PLMNs\"
list applies to all the UE\'s registered routing areas, location areas and
tracking areas.
At relocation/handover to a GWCN or a MOCN:
\- There is no functionality in the source SGSN to select a target core
network operator or to modify the target core network operator selected by the
RNC/BSC. Instead, the source SGSN uses the selected PLMN received from the
RNC/BSC to determine the target core network operator. The source SGSN shall
forward the selected core network operator chosen by the source RNC/BSC to the
target SGSN/MME.
\- For handover to a shared UTRAN the target SGSN indicates the selected core
network operator chosen by the source RNC/BSC/eNodeB to the target RNC so that
the appropriate PLMN-id can be signalled to the UE in dedicated system
information signalling, as described in clause 5.2.
\- For handover to a shared GERAN the source SGSN/MME shall forward the PLMN-
ID selected by the source RAN to the target SGSN. Target SGSN sends
information of selected operator to the target BSC.
\- For SRVCC from UTRAN PS to UTRAN/GERAN CS domain, the SGSN selects the MSC
based on the selected target PLMN indicated by the RNC. The SGSN includes the
indication of the selected target PLMN in the target CGI/RNC ID and Anchor
PLMN in the SRVCC PS-to-CS Request sent to the MSC (see TS 29.280 [21]).
In signalling to the GGSN/S-GW/P-GW and HSS, the SGSN shall ensure that any
PLMN ID that is sent is the ID of the selected Core Network Operator for
supporting UEs, or that of the allocated Core Network Operator for non-
supporting UEs (unless the exception to send the Common PLMN ID for a non-
supporting UE (see clause 4.4) is in use with that HPLMN).
## 5.5 MME functions
When a UE accesses an MME for the first time, i.e. when the UE is not yet
known by the MME, the MME verifies whether the UE is permitted to access the
selected PLMN. For that purpose the MME retrieves the IMSI from another
MME/SGSN or from the UE. The MME shall store the identity of the selected core
network operator.
The MME indicates the selected core network operator PLMN-id to the UE in the
GUTI.
For sharing scenarios with both E-UTRAN and GERAN/UTRAN access, where the
network also applies idle-mode signalling reduction (see TS 23.401 [9]), the
PLMN IDs included in the equivalent PLMN list (as defined in TS 24.008 [7])
provided by the MME to the eNB guides the target PLMN selection if the UE\'s
registered PLMN is not available in the target cell. The equivalent PLMN list
should be configured such that for any target cell there is only one PLMN-ID
that can be selected for the cell.
Also, for the above scenario, in the routing areas and tracking areas between
which ISR may be activated the \"equivalent PLMNs\" list provided by the SGSN,
MSC and MME to a UE (see TS 24.008 [7]) should result in a single consistent
\"equivalent PLMNs\" list stored by the UE. The single \"equivalent PLMNs\"
list applies to all the UE\'s registered routing areas, location areas and
tracking areas.
For sharing scenarios with both E-UTRAN and GERAN/UTRAN access, when multiple
PLMNs are available for CS domain to support CS Fallback functionality, the
MME provides the allocated LAI including the selected PLMN ID for CS domain
along with \"CS Fallback indicator\" to the eNodeB as specified in TS 23.272
[15], to guide the selection of the target GERAN/UTRAN network.
If the operator-configured preferred target RAT for CS Fallback is a shared
RAN not offering the broadcast of available Core Network operators for
selection by the UE, the MME shall always select the common PLMN broadcasted
in the shared RAN as the selected PLMN-id for the CS domain.
If the operator-configured preferred target RAT for CS Fallback is a shared
RAN offering the broadcast of available Core Network operators for selection
by the UE, the MME shall take into account the UE\'s capability of supporting
network sharing in the preferred target RAT when selecting the PLMN for the CS
domain for CS Fallback. For GERAN network sharing, the UE signals its
capability of GERAN network sharing support explicitly to the MME. If the UE
is a network-sharing non-supporting UE with respect to the preferred target
RAT, a common PLMN-id shall be selected, while if the UE is a network-sharing
supporting UE with respect to the preferred target RAT, one of the PLMN-IDs in
the broadcasted multiple PLMN-id list of the preferred target shared RAT shall
be selected as the PLMN-id for the CS domain.
The selected PLMN-id for the CS domain shall be included the allocated LAI
sent to the MSC/VLR as defined in TS 23.272 [15].
If the shared network is in GWCN configuration, MME sends the \'selected CS
domain operator\' as indicated in clause 4.2.5a.
The list of PLMN-ID(s) included in the handover restriction list (as defined
in TS 36.413 [14]), if provided by the MME to the eNB for the target PLMN
selection, shall be configured such that for any target GERAN/UTRAN cell, only
PLMN-ID(s) associated with the same CN operator as the one that the UE has
registered to in the CS domain can be selected by the eNB when one of the
following conditions apply:
\- the preferred RAT of the registered network is shared network not offering
the broadcast of available Core Network operators for selection by the UE, or,
\- the RAT preference for the UE is GERAN and the allocated LAI belongs to a
shared GERAN and the UE is a GERAN network-sharing non-supporting UE.
The list of PLMN-ID(s) included in the equivalent PLMN list sent to the UE
shall be configured to include the list of PLMN IDs in the handover
restriction list.
NOTE: When performing CS Fallback to GERAN/UTRAN cell, if the PLMN-ID(s) in
the equivalent PLMN list contains a CS CN operator(s) PLMN different from the
registered CS PLMN, then the UE may possibly select a CS CN operator it has
not registered to.
At handover/relocation to a GWCN or a MOCN:
\- The source MME uses the TAI/RAI information supplied by the eNodeB to
select the target MME/SGSN. There is no additional functionality in the source
MME to select a target core network operator or to modify the target core
network operator selected by the eNodeB. Instead, the source MME uses the
selected PLMN received from the eNodeB to determine the target core network
operator. The source MME shall forward the selected target core network
operator chosen by the source eNodeB to the target MME/SGSN.
\- The target MME indicates the selected target core network operator chosen
by the source eNodeB/RNC/BSC to the target eNodeB so that the eNodeB can
select target cells for future handovers appropriately. Subsequent Tracking
Area Update signalling is used to update the UE about any change of core
network operator.
\- At SRVCC from E-UTRAN PS to UTRAN/GERAN CS domain, the MME selects the MSC
based on the selected target PLMN indicated by the eNodeB. The MME includes
the indication of the selected target PLMN in the target CGI/RNC ID and Anchor
PLMN in the PS-to-CS Request sent to the MSC (see TS 29.280 [21]).
In signalling to the S-GW/P-GW and HSS, the MME shall ensure that any PLMN ID
that is sent is the ID of the selected Core Network Operator.
The behaviour of the MME in relation to CS/PS coordination in GERAN and UTRAN
for non-supporting UEs is described in clause 4.2.5.3.
# 6 Charging and accounting aspects
To support inter-operator accounting in a shared network, it shall be possible
to distinguish the share of usage of the shared core network node(s) between
the sharing partners. The identity of the serving core network operator (i.e.
the one selected by a supporting UE in a network broadcasting a multiple PLMN-
id list, or, the one allocated by the network for a non-supporting UE in a
network broadcasting a multiple PLMN-id list, or, the one allocated for any UE
in a shared network only broadcasting a common PLMN) and whether the core
network operator was selected by a supporting UE or allocated by the network
to a UE shall be included in MSC, SGSN, Serving GW and GGSN/PDN GW CDR types
as specified in TS 32.250 [5] (CS) and TS 32.251 [6] (GPRS/EPS). For handover
scenarios, it is up to operator configuration whether the core network
operator shall be indicated as selected or allocated to a UE in the CS domain
CDR. In CSFB scenario, the core network operator is allocated by the network
as specified in clause 4.2.5a, but the indication in the CS domain CDR is up
to operator configuration.
As specified in clause 4.4, for online charging, the gsmSCF can use the
identifier of the MSC/SGSN to determine the operator selected by a supporting
UE or the operator allocated to a UE. The MSC/SGSN shall inform gsmSCF as to
whether the UE selected, or the network allocated, the serving operator on
that RAT.
Whether the Core Network Operator was selected by a supporting UE or allocated
by the network to the UE shall be communicated to the Serving GW and the
GGSN/PDN GW and be included in MSC, SGSN, Serving GW and GGSN/PDN GW CDR types
as specified in TS 32.250 [5] (CS) and TS 32.251 [6] (GPRS/EPS).
# 7 Example signalling flows
## 7.1 Network selection
Signalling flows for manual and automatic network selection in a shared
network architecture for successful and unsuccessful registration attempts are
presented.
### 7.1.2 Non-supporting UEs in a GWCN configuration
This example shows network selection for a non-supporting UE in a shared
UTRAN/GERAN network. The UE is not a subscriber of any of the sharing
operators and is under operator coordination. The UE is not coming from
E-UTRAN i.e. the UE is not registered in any old MME. The UE is not served by
the shared SGSN nor by the shared MSC. After the first registration attempted
the operator accepts the UE after CS/PS coordination.
Figure 3: Network selection for a non-supporting UE in a shared UTRAN/GERAN
network
1\. The UE reads the broadcast system information in the shared RAN.
2\. A non-supporting UE cannot decode the shared network information in the
broadcast system information. The common PLMN is the only candidate to be
considered together with other PLMNs for network selection.
3\. The UE performs network selection among available PLMNs.
4a. The UE sends an ATTACH REQUEST/ROUTEING AREA UPDATE/LOCATION AREA UPDATE
message to the network. The RAN selects CN node based on NRI (valid or
invalid) if present or by random selection. A _redirect attempt flag_ is
included in the signalling from RAN to Core Network. The signalling from the
RAN to the Core Network enables the Core Network to determine that the UE did
not select a Core Network operator. The RAN stores the NRI received from the
UE.
4b. A _Reroute Command_ message is sent back to the RAN node with an
indication that it is for coordination purposes. The _Reroute Command_ message
includes the LAU/RAU /ATTACH REJECT message and the original ATTACH
REQUEST/ROUTING AREA UPDATE/LOCATION AREA UPDATE message received from the UE.
Included is also IMSI and old LAI (for the CS domain) or old RAI (for the PS
domain), or an indication whether the UE is attaching.
4c. At ROUTEING AREA UPDATE/LOCATION AREA UPDATE the RAN node concludes that
the UE is roaming under operator coordination and sends a ROUTEING AREA
UPDATE/LOCATION AREA UPDATE to the Core Network. The CN operator selected by
the RAN is included in the signalling from RAN to Core Network. IMSI and the
redirect attempt flag shall be included.
4d. At ATTACH REQUEST in PS domain the RAN node queries the MSCs in the CS
domain whether the UE (IMSI) is registered at any of the sharing operators in
the CS domain. At ATTACH REQUEST in CS domain the RAN node queries the SGSNs
in the PS domain whether the UE (IMSI) is registered at any of the sharing
operators in the PS domain. For PS domain the SGSNs may need to query all MMEs
that may hold the UEs context, refer to sub clause 7.1.6.
In this example the UE is yet neither registered in the CS domain nor in the
PS domain. Based on IMSI analysis the RAN node selects an operator. The RAN
node sends a ATTACH REQUEST/ to the Core Network. The CN operator selected by
the RAN is included in the signalling from RAN to Core Network. IMSI and the
_redirect attempt flag_ shall be included.
5\. The shared SGSN determines whether the UE is allowed to attach.
6\. The shared SGSN sends the appropriate ACCEPT message back to the UE.
### 7.1.3 Supporting UEs in a GWCN configuration
This example shows network selection for a supporting UE in a shared
E‑UTRAN/UTRAN/GERAN network.
Figure 4: Network selection for a supporting UE in a shared
E-UTRAN/UTRAN/GERAN network
1\. The UE reads the broadcast system information in the shared RAN.
2\. A supporting UE decodes the shared network information and supplies the
available core network operator PLMN-ids as candidates to the PLMN selection
procedure. Only PLMNs in the Multiple PLMN ID List are candidates for network
selection.
3\. The UE performs network selection among available PLMNs.
4\. The UE sends an ATTACH/ROUTEING AREA UPDATE/TRACKING AREA UPDATE/LOCATION
AREA UPDATE REQUEST message to the network indicating, to the RAN, the chosen
core network operator. The RAN converts the core network \'indicator\' into
the actual selected PLMN identity and sends this with the ATTACH/ROUTEING AREA
UPDATE/TRACKING AREA UPDATE/LOCATION AREA UPDATE REQUEST to the core network.
5\. The shared SGSN determines whether the UE is allowed to attach.
6\. The shared SGSN sends the appropriate ACCEPT/REJECT message back to the
UE.
### 7.1.4 Non-supporting UEs in a MOCN configuration
#### 7.1.4.1 UTRAN based MOCN configuration
An example of an information flow for redirection in UTRAN is shown below.
In this example an attach request from a non-supporting UE is directed to
three different CN operators. The UE is not a subscriber of any of the sharing
operators. The UE is not served by any shared SGSN nor by any shared MSC. The
UE is furthermore not under operator coordination. The first rejects since it
has no roaming agreement with the subscribers Home PLMN or rejects due to
CS/PS coordination required. The second rejects because of a roaming
restriction found in HLR. The third CN operator accepts and completes the
attach request. The different \"MSC/SGSNs\" in the example below shall be seen
as different CN operators. One specific CN operator may also have several
pooled MSCs/SGSNs connected to the RNC if Iu-flex is used.
Figure 5: Information flow for redirection in UTRAN
1) The RRC connection is established.
2) RNC receives an Initial Direct Transfer from an UE. The RNC is configured
to work in a Shared RAN MOCN, and therefore it forwards the NAS message in an
Initial UE message with an additional _redirect attempt flag_ set. The flag
indicates that the MSC/SGSN shall respond to the attach request with a
_Reroute Command_ or _Reroute Complete_ IE in the Direct Transfer message.
Selection of CN node is based on NRI (valid or invalid) if present in IDNNS or
by random selection.
A _redirect attempt flag_ could also simply be the fact that the Initial UE
message does not include any UE selected PLMN-ID, which a supporting UE would
include. Redirect is never done for supporting UEs.
3) The MSC/SGSN receives the Initial UE with the _redirect attempt flag_ set.
It then knows it shall answer with a _Reroute Command_ or _Reroute Complete_
IE in the Direct Transfer message.
4) The MSC/SGSN needs the IMSI of the UE. It is retrieved either from old MSC
/ old SGSN or from the UE as in this example. By comparing the IMSI with the
roaming agreements of the CN operator, the MSC/SGSN discovers that roaming is
not allowed or that roaming is allowed but CS/PS coordination required. Attach
procedure is aborted.
5a) A message is sent back to the RNC with two NAS messages, the attach reject
message and the original attach request message received from the UE
(alternatively the original NAS message may be stored in the RNC). The IMSI
and an indication that the UE is attaching is also included in the message,
plus a reject cause code to the RNC. The _Reroute Command_ IE is in the Direct
Transfer message.
5b) The RAN node concludes that UE is attaching. For attach in PS domain the
RAN node queries the MSCs in the CS domain whether the UE (IMSI) is served by
any of the sharing operators in the CS domain. For attach in CS domain the RAN
node queries the SGSNs in the PS domain whether the UE (IMSI) is served by any
of the sharing operators in the PS domain. For PS domain the SGSNs may need to
query all MMEs that may hold the UEs context, refer to clause 7.1.6.
In this example the UE is yet neither served by a node in the CS domain nor in
the PS domain. The signalling connection between RNC and MSC/SGSN A is
released. Based on deterministic IMSI analysis the RNC selects a MSC/SGSN in
the next step. If reject was due to CS/PS coordination required then the same
operator may be selected again. If reject was not due to CS/PS coordination
required then the already tried MSC/SGSNs is stored in the RNC during the
redirect procedure so that the same node is not selected twice.
6) The RNC sends a new Initial UE to the next selected MSC/SGSN with the
original NAS attach request message (in case of CS/PS coordination the Initial
UE may also be sent back to the first MSC/SGSN depending on the outcome of the
coordination). Redirect attempt flag is set and IMSI shall also be included to
avoid a second IMSI retrieval from UE or old MSC/SGSN and to indicate that
PS/CS domain coordination has been done in RNC. The CN operator selected by
the RAN is included in the signalling from RAN to Core Network The MSC/SGSN
receiving the message starts its attach procedure.
7) MSC/SGSN B does in general support roaming for the HPLMN of the IMSI and
hence authentication is done and RAN ciphering is established.
8) MSC/SGSN B updates the HLR and receives subscriber data from HLR.
9) The subscription data do not allow roaming (e.g. regional or 3G). MSC/SGSN
B sends a Reroute Command message including the attach reject message, a
reject cause code, the original attach request message and the N(SD) (for MSC
only). IMSI is included in Reroute Command message only if it was not included
in the Initial UE received by the MSC/SGSN.
The signalling connection between the RNC and the MSC/SGSN B is released. The
RNC then selects a new operator and a new MSC/SGSN based on deterministic IMSI
analysis as in step 5b.
10) The MSC/SGSN C receives an Initial UE (with the original NAS attach
request message) with the redirect attempt flag is set, an IMSI, and N(SD) (if
MSC). The MSC/SGSN C also receives the CN operator selected by the RAN. The
MSC/SGSN C starts the attach procedure and uses provided information (IMSI and
N(SD)).
11) MSC/SGSN C does in general support roaming for the HPLMN of the IMSI and
hence authentication is done and RAN ciphering is established.
12) MSC/SGSN C updates the HLR and receives subscriber data from HLR.
Subscriber data allows roaming, and the MSC/SGSN C completes the attach
procedure. This includes the assignment of a new TMSI/P-TMSI with an NRI that
can be used by RNC to route subsequent signalling between UE and correct
MSC/SGSN (Iu-flex functionality). The Update Location sent to HLR also
triggers a Cancel Location sent to the MSC/SGSN B.
13) A _Reroute Complete_ IE in the Direct Transfer message with the NAS Attach
accept message is sent to RNC. By this, the RNC knows that the redirect is
finished and can both forward the NAS message to the UE and clean up any
stored redirect data.
14) The Attach Accept is forwarded to the UE. The UE stores the TMSI/P-TMSI
with the Iu-flex NRI to be used for future signalling, even after power off.
15) UE responds with an Attach Complete message.
If the RNC finds no more MSC/SGSN to redirect to after receiving a Reroute
Command message, e.g. step 5 or step 9, it compares the cause code with cause
codes from other Reroute Command messages it has earlier received for this UE.
A cause code ranking is done and the \"softest\" cause code is chosen and the
corresponding saved NAS attach reject message is returned to the UE.
Each CN node that receives an Initial UE, shall run its own authentication
procedure. This may in some rare situations cause the UE to be authenticated
more than once, however the trust-model used is that one CN operator shall not
trust an authentication done by another CN operator. This will of course not
be an optimal usage of radio resources, but given the rare occurrence of this,
the increased signalling should not be of any significance.
During the redirect procedure the RNC keeps a timer, which corresponds to the
UE timer of releasing the RR connection (20 seconds). If the RNC when
receiving a Reroute Command message finds that there is not sufficient time
for another redirect, further redirect attempts are stopped (for this attach
request message). The UE will repeat its attach request four times (each time
waiting 15 seconds before it re-establishes the RR connection for another
try).
#### 7.1.4.2 GERAN based MOCN configuration
An example of an information flow for redirection in GERAN is shown below.
In this example an attach request from a non-supporting UE is directed to two
different CN operators. The UE is not a subscriber of any of the sharing
operators. The UE is not served by any shared SGSN nor by any shared MSC. The
UE is furthermore not under operator coordination. The first CN operator
rejects since it has no roaming agreement with the subscribers Home PLMN or
rejects due to CS/PS coordination required. The second CN operator accepts and
completes the attach request. The different \"MSC/SGSNs\" in the example below
shall be seen as different CN operators. One specific CN operator may also
have several pooled MSCs/SGSNs connected to the BSC if A/Gb-Flex is used.
Separate call flows are shown for CS domain and for PS domain.
Figure 6: Information flow for redirection in GERAN (CS domain)
1) The RRC connection is established.
2) BSC receives the Layer 3 message from an UE. The BSC is configured to work
in a Shared RAN MOCN, and therefore it forwards the message in a Complete
Layer 3 Information message with an additional redirect attempt flag set. The
flag indicates that the MSC shall respond to the attach request with a Reroute
Command message to inform the BSC that a redirection to another CN has to be
performed.
The selection of CN node is based on NRI (valid or invalid) or by random
selection. The same mechanism as defined for A-Flex in TS 23.236 [8] is used.
3) The MSC receives the Complete Layer 3 Information message with the redirect
attempt flag set. It then knows it may have to provide the BSC with a Reroute
Command message.
4) The MSC needs the IMSI of the UE. It is retrieved either from old MSC or
from the UE as in this example. By comparing the IMSI with the roaming
agreements of the CN operator, the MSC A discovers that roaming is not allowed
or that roaming is allowed but CS/PS coordination required. Attach procedure
is aborted.
5a) A Reroute Command message is sent back to the BSC with the attach reject
message and the original attach request message received from the UE. The IMSI
and an indication that the UE is attaching is also included in the message,
plus a reject cause code to the BSC.
5b) The BSC concludes that UE is attaching. The BSC node queries the SGSNs in
the PS domain whether the UE (IMSI) is served by any of the sharing operators
in the PS domain. The SGSNs may need to query all MMEs that may hold the UEs
context, refer to clause 7.1.6.
In this example the UE is yet not served by a node in the PS domain. The
signalling connection between BSC and MSC A is released. Based on
deterministic IMSI analysis the BSC selects a MSC B in the next step. If
reject was not due to CS/PS coordination required then the already tried MSC A
is stored in the BSC during the redirect procedure so that the same node is
not selected twice.
6) The BSC sends a new Complete Layer 3 Information to the next selected MSC B
with the original attach request message (in case of CS/PS coordination the
Complete Layer 3 Information may also be sent back to the first MSC depending
on the outcome of the coordination). Redirect attempt flag is set and IMSI
shall also be included to avoid a second IMSI retrieval from UE or old MSC and
to indicate that PS/CS domain coordination has been done in BSC. The CN
operator selected by the BSC is included in the signalling from BSC to Core
Network. The MSC B receiving the message starts its attach procedure.
7) MSC B does in general support roaming for the HPLMN of the IMSI and hence
authentication is done and RAN ciphering is established.
8) MSC B updates the HLR and receives subscriber data from HLR. Subscriber
data allows roaming, and the MSC B completes the attach procedure. This
includes the assignment of a new TMSI with an NRI that can be used by BSC to
route subsequent signalling between UE and correct MSC (A-Flex functionality).
9) The Attach Accept is forwarded to the UE. The UE stores the TMSI with the
A-Flex NRI to be used for future signalling, even after power off. This is
existing functionality.
10) UE responds with an Attach Complete message (TMSI (re-)allocation if not
already made in Attach accept).
11) A Reroute Complete message is sent to BSC. The BSC knows that the redirect
is completed and clean up any stored redirect data.
If the BSC finds no more MSC to redirect to after receiving a Reroute Command
message, it compares the cause code with cause codes from other Reroute
Command messages it has earlier received for this UE. A cause code ranking is
done and the \"softest\" cause code is chosen and the corresponding saved
attach reject message is returned to the UE.
Each CN node that receives a Complete Layer 3 Information shall run its own
authentication procedure. This may in some rare situations cause the UE to be
authenticated more than once, however the trust-model used is that one CN
operator shall not trust an authentication done by another CN operator. This
will of course not be an optimal usage of radio resources, but given the rare
occurrence of this, the increased signalling should not be of any
significance.
During the redirect procedure the BSC keeps a timer, which corresponds to the
UE timer of releasing the RR connection (20 seconds). If the BSC when
receiving a Reroute Command message finds that there is not sufficient time
for another redirect, further redirect attempts are stopped (for this attach
request message). The UE will repeat its attach request four times (each time
waiting 15 seconds before it re-establishes the RR connection for another
try).
Figure 7-1: Information flow for redirection in GERAN (PS domain)
1) The TBF is established.
2, 2a) BSC receives the LLC frame with foreign [or random] TLLI =X.
The BSC is configured to work in a Shared RAN MOCN, and therefore it forwards
the message in a BSSGP UL-UNITDATA message with an additional redirect attempt
flag set. The flag indicates that the SGSN shall respond to the attach request
with a BSSGP DL-UNITDATA message providing when relevant a redirection
indication flag set to inform the BSC that a redirection to another CN has to
be performed.
The selection of CN node is based on NRI (valid or invalid) or by random
selection. The same mechanism as defined for Gb-Flex in TS 23.236 [8] is used.
3) The SGSN receives the BSSGP UL-UNITDATA message with the redirect attempt
flag set. It then knows it may have to provide the BSC with a redirection
indication flag set or a redirection completed flag set.
4) The SGSN needs the IMSI of the UE. It is retrieved either from old SGSN or
from the UE as in this example. By comparing the IMSI with the roaming
agreements of the CN operator, the SGSN A discovers that roaming is not
allowed or that roaming is allowed but CS/PS coordination required. Attach
procedure is aborted.
5a) A BSSGP DL-UNITDATA message is sent back to the BSC with a redirection
indication flag set containing the reject cause, the attach reject message and
the original attach request message received from the UE. The V(U) used for
LLC-PDU setting (refer to TS 44.064 [19]) is included in the message. The IMSI
and an indication that the UE is attaching is also included in the message.
5b) The BSC node concludes that UE is attaching. The BSC node queries the MSCs
in the CS domain whether the UE (IMSI) is served by any of the sharing
operators in the CS domain.
In this example the UE is yet not served by any node in the CS domain. Based
on deterministic IMSI analysis the BSC selects a SGSN B in the next step. If
reject was not due to CS/PS coordination required then the already tried SGSN
A is stored in the BSC during the redirect procedure so that the same node is
not selected twice.
The BSC makes a short-lived binding between the TLLI =X and SGSN ID so that it
points to SGSN B.
6) The BSC sends a new BSSGP UL-UNITDATA to the next selected SGSN B with the
original attach request message (in case of CS/PS coordination the BSSGP UL-
UNITDATA may also be sent back to the first SGSN depending on the outcome of
the coordination). Redirect attempt flag is set and IMSI shall be included to
avoid a second IMSI retrieval from UE or old SGSN and to indicate that PS/CS
domain coordination has been done in BSC. The V(U) shall also be included in
the message. The CN operator selected by the BSC is included in the signalling
from BSC to Core Network. The SGSN B receiving the message starts its attach
procedure.
7) SGSN B does in general support roaming for the HPLMN of the IMSI and hence
authentication is done and RAN ciphering is established. The value of V(U) in
SGSN-B shall be set according to the received value from BSC.
Uplink LLC frames shall be routed to SGSN B despite the NRI of the TLLI=X
pointing to SGSN A.
8) SGSN B updates the HLR and receives subscriber data from HLR. Subscriber
data allows roaming, and the SGSN B completes the attach procedure. This
includes the assignment of a new P-TMSI with an NRI that can be used by BSC to
route subsequent signalling between UE and correct SGSN (Gb-Flex
functionality).
9) A BSSGP DL-UNITDATA Attach accept message is sent to BSC with the
redirection completed flag set . The BSC knows that the redirect is finished
and can both forward the Attach Accept message to the UE and clean up any
stored redirect data.
SGSN B is allowed to reset the XID parameter only after the attach request is
accepted.
10) The Attach Accept is forwarded to the UE. The UE stores the P-TMSI with
the Gb-Flex NRI to be used for future signalling, even after power off. This
is existing functionality.
11) UE responds with an Attach Complete message (P-TMSI (re-)allocation if not
already made in Attach Accept). The Attach Complete uses new TLLI. After this,
the BSS releases the binding between TLLI=X and SGSN B.
If the BSC finds no more SGSN to redirect to after receiving a BSSGP DL-
UNITDATA message with the redirection indication flag set, it compares the
cause code with cause codes from other BSSGP DL-UNITDATA messages it has
earlier received for this UE. A cause code ranking is done and the \"softest\"
cause code is chosen and the corresponding saved attach reject message is
returned to the UE.
Each CN node that receives a BSSGP UL-UNITDATA, shall run its own
authentication procedure. This may in some rare situations cause the UE to be
authenticated more than once, however the trust-model used is that one CN
operator shall not trust an authentication done by another CN operator. This
will of course not be an optimal usage of radio resources, but given the rare
occurrence of this, the increased signalling should not be of any
significance.
During the redirect procedure the BSC keeps a timer, which corresponds to the
UE timer of releasing the RR connection (20 seconds). If the BSC when
receiving a BSSGP DL-UNITDATA message with the redirection indication flag set
finds that there is not sufficient time for another redirect, further redirect
attempts are stopped (for this attach request message). The UE will repeat its
attach request four times (each time waiting 15 seconds before it re-
establishes the RR connection for another try).
#### 7.1.4.3 CS registration after PS Handover
An example of an information flow at registration in current domain when
already registered in opposite domain is shown below.
This example shows network selection for a non-supporting UE in a shared UTRAN
network. The UE is not a subscriber of any of the sharing operators. The UE is
not under operator coordination. Due to PS Handover the UE is registered in
the PS domain of the shared UTRAN network when the registration attempt for
the CS domain occurs.
Figure 7-2: Information flow for registration in CS domain after PS Handover
1) The RRC connection is established.
2) RNC receives an Initial Direct Transfer from an UE. The RNC is configured
to work in a Shared RAN MOCN, and therefore it forwards the NAS message in an
Initial UE message with an additional redirect attempt flag set. The flag
indicates that the MSC shall respond to the attach request with a Reroute
Command or Reroute Complete IE in the Direct Transfer message. Selection of CN
node is based on NRI (valid or invalid) if present in IDNNS or by random
selection. The RAN stores the NRI received from the UE.
3) The MSC receives the Initial UE with the redirect attempt flag set. It then
knows it shall answer with a Reroute Command or Reroute Complete IE in the
Direct Transfer message.
4) The MSC needs the IMSI of the UE. It is retrieved either from old MSC or
from the UE as in this example. By comparing the IMSI with the roaming
agreements of the CN operator, the MSC discovers that the UE has no
subscription in operator\'s network. The MSC concludes also that the UE is not
served by the MSC.
5) A Reroute Command message is sent back to the RNC with an indication that
it is for CSPS coordination purposes. The Reroute Command message includes the
IMSI, the LAU REJECT message and the original LOCATION AREA UPDATE message
received from the UE. Included is also old LAI. The Reroute Command IE is in
the Direct Transfer message.
6) The RNC concludes that the UE is not under operator coordination. The RNC
queries the SGSNs in the PS domain whether the UE (IMSI) is served by any of
the sharing operators in the PS domain. The SGSNs may need to query all MMEs
that may hold the UEs context, refer to clause 7.1.6.
7) In this example the UE is served by an SGSN node in the PS domain. The RNC
selects the same operator for the CS domain and sends the Initial UE to an MSC
belonging to the selected operator. The operator selected by the RNC is
included in the signalling from RNC to MSC. The redirect attempt flag and an
indication that the UE in the PS domain is served by the RNC selected operator
shall also be included.
8) The MSC determines whether the UE is allowed to attach.
9) The MSC sends the appropriate ACCEPT/REJECT message back to the UE.
### 7.1.5 Supporting UEs in a MOCN configuration
#### 7.1.5.1 UTRAN based MOCN configuration
Supporting UEs can make use of the additional information in the broadcast
system information. The UTRAN signalling flow is shown in the figure below.
Figure 8: Network selection by a supporting UE in a UTRAN MOCN
1\. The UE reads the broadcast system information in the shared RAN.
2\. A supporting UE decodes the shared network information and supplies the
available core network operator PLMN-ids as candidates to the PLMN selection
procedure. Only PLMNs in the Multiple PLMN ID List are candidates for network
selection.
3\. The UE performs network selection among available PLMNs.
4\. The UE sends an ATTACH REQUEST message to the network. It also indicates
to the RNC the chosen core network operator. The RNC uses the routing
information to determine which core network operator the message should be
routed to and the ATTACH REQUEST message is sent to the core network operator
chosen by the UE.
5\. The core network determines whether the UE is allowed to attach to the
network.
6\. The shared core network node sends the appropriate ACCEPT/REJECT message
back to the UE. In case of an ATTACH ACCEPT message, the core network assigns
the UE an appropriate TMSI/P-TMSI so that this identity can be used for any
further rerouting of messages by the RNC.
#### 7.1.5.2 GERAN based MOCN configuration
Supporting UEs can make use of the additional information in the broadcast
system information. The GERAN signalling flow is shown in the figure below.
Figure 9: Network selection by a supporting UE in a GERAN MOCN
1\. The UE reads the broadcast system information in the shared RAN.
2\. A supporting UE decodes the shared network information and supplies the
available core network operator PLMN-ids as candidates to the PLMN selection
procedure. Only PLMNs in the Multiple PLMN ID List are candidates for network
selection.
3\. The UE performs network selection among available PLMNs.
4\. The UE sends an ATTACH REQUEST message to the network. It also indicates
to the BSC the chosen core network operator (via Initial L3 message for CS
domain, via AS signalling for the PS domain). The BSC uses the routing
information to determine which core network operator the message should be
routed to and the ATTACH REQUEST message is sent to the core network operator
chosen by the UE together with the chosen PLMN-id.
5\. The core network determines whether the UE is allowed to attach to the
network.
6\. The core network node sends the appropriate ACCEPT/REJECT message back to
the UE. In case of an ATTACH ACCEPT message, the core network assigns the UE
an appropriate TMSI/P-TMSI so that this identity can be used for any further
rerouting of messages by the BSC.
### 7.1.6 Query to opposite domain
The RAN may query the CN nodes in the opposite domain whether the UE is served
by any of the sharing operators in the opposite domain. In the example below a
registration attempt is made in the CS domain and the query in the opposite
domain is sent to the PS domain i.e. the SGSNs and if not registered in the
SGSN the SGSN sends the query to all MMEs that may hold the UEs context. If
the registration attempt was made in the PS domain the query to opposite
domain is send to the CS domain i.e. the MSCs.
Figure 10: PS domain query
1) The SGSN receives a UE (IMSI) query from the RAN node including an
indication to also query MMEs if the UE is not served by the SGSN.
2) If the UE is not served by the SGSN the SGSN forwards the UE (IMSI) query
to all MMEs that may hold the UEs context of the same operator as the SGSN.
3) If the UE is not served by any node in E-UTRAN each MME replies with a
negative response to the UE query. If the UE is served by any of the MMEs,
this MME replies with a positive response.
4) If the SGSN or any MME serves the UE, the SGSN replies with a positive
response to the UE query from RAN. If the UE is not served by any SGSN or MME,
the SGSN replies with a negative response to RAN.
###### ## Annex A (informative): Network Resource Indicator (NRI) allocation
examples
This annex contains examples for NRI co-ordination for non-supporting UEs in
shared networks.
# A.1 NRI in shared UTRAN/GERAN networks
The Network Resource Identifier (NRI) is specified in Rel-5 for Intra Domain
Connection of RAN Nodes to Multiple CN nodes (see TS 23.236 [8]). NRI is part
of the temporary identity TMSI (CS domain) or P-TMSI (PS domain), which is
assigned by the serving CN node to the MS. This clause describes NRI usage in
MOCN.
Within the shared network NRIs has to be coordinated between the operators at
least due to following reasons:
\- to avoid redirection or CS/PS un-coordination when the non-supporting UE
performs LA/RA update.
\- to achieve that correct UE answers to paging (TMSI/P-TMSI shall be unique
within shared network).
\- to achieve that a non-supporting UE in visited PLMN will not change network
due to LA/RA update or Detach/Attach function.
\- to achieve that non-supporting UE in visited PLMN remains CS/PS coordinated
when the UE moves within shared network.
Operator coordination of CS-NRI and LAI tuple for the CS domain, and PS-NRI
and RAI tuple for the PS domain is also required between the shared network
and the dedicated networks of the sharing partners:
\- to achieve that non-supporting UE in visited PLMN remain registered in the
same operators network when the UE moves from dedicated network to a shared
network.
\- to achieve that non-supporting UE in visited PLMN remains CS/PS coordinated
when the UE moves from dedicated network to a shared network.
By coordinating the actual values of the CS-NRIs for the CS domain and the PS-
NRIs/MMECs for the PS domains between networks, additional signalling can be
avoided when handling LA/RA updates for subscribers of the sharing partners
since analysis of LAI/RAI will not be necessary.
Operator coordination of TAI and MMEC (mapped to PS-NRI) is also required
between shared UTRAN or GERAN and E-UTRANs of the sharing partners:
\- to achieve that non-supporting UE in visited PLMN remain registered in the
same operators network when the UE moves from dedicated network to a shared
network.
\- to achieve that non-supporting UE in visited PLMN becomes CS/PS coordinated
when the UE moves from EUTRAN to a shared UTRAN or GERAN network.
If CSFB is configured for a UE, the TAI and MMEC (mapped to PS-NRI) should be
operator coordinated so that additional signalling can be avoided. In any case
the TAI and MMEC (mapped to PS-NRI) coordinated with another operator than the
selected CS domain operator of the UE is not allowed.
CS/PS coordination is achieved by allocating to the UE, an NRI for the CS
domain and an NRI for the PS domain that together with LAI and RAI
respectively indicates the same operator in the shared network.
At LA/RA update the RNC/BSC routes the NAS message to the operator that is
defined by NRI, even if NRI is created in a PLMN different from Common PLMN.
In figure A.1 below operators A, B and C have both shared and dedicated
networks, operator D has only dedicated network and operator E only shared
network.
Figure A.1: Shared and Dedicated network example
In the above, one or more of the operators in the shared network may deploy
Iu-Flex or A/Gb-Flex between that shared radio access network and their core
networks. Additionally, operators may deploy Iu-Flex or A/Gb-Flex within their
dedicated core networks. For non-supporting UEs, operator coordination of the
CS-NRI and LAI tuple and PS-NRI/MMEC and RAI/TAI tuple is needed not only
within the shared network, but also between the shared network and the
dedicated networks.
# A.2 Alternatives for NRI split in UTRAN and GERAN
Sharing operators need to coordinate the used NRI, following alternatives are
considered:
1) even split of NRI space, 1...3 most significant bits of NRI is used to
identify the CN operator.
2) individual NRI values used to identify the CN operator.
**Alternative 1; even split of NRI space**
* * *
31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4
3 2 1 0 CS/PS \'VLR-restart\' CN operator ID Non shared NRI for CN operator
internal use.
* * *
A calculation for the possible number of subscribers in this scenario is:
\- With max 4 sharing CN operators, two most significant bits of NRI is
required to identify the CN operator.
\- 3 bits are used for the restart counter.
\- 5 bits of NRI allows 32 independent NRI values for each CN operator.
\- This leaves 20 bits for every MSC that is 1 M non-purged TMSI.
The following aspects need to be considered for this solution:
\- If more bits are needed for the restart counter or CN operator ID, each
additional bit reduces the available TMSI space half.
\- The basic configuration allows 32 M TMSI values for each CN operator, a lot
of TMSI values are wasted if some sharing partners have substantially less
subscribers than others.
\- It may not be feasible in large networks that use Iu-Flex or A/Gb-Flex for
load balancing (see Annex A, network configuration examples in TS 23.236 [8]).
\- The number of NRI bits used for CN operator ID may need to be fixed in the
initial planning. Otherwise configuration of all existing nodes must be
changed when new partners join the shared network.
**Alternative 2; individual NRI values used to identify the CN operator**
This could be considered in the case where a network is shared between one big
and many small CN operators.
* * *
31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9 8 7 6 5 4
3 2 1 0 CS/PS \'VLR-restart\' Shared NRI space
* * *
\- The biggest CN operator who needs more pool areas and TMSI space takes NRI
values 32...63, [1xxxxx], this means 32M TMSI values when 4 bit is used for
restart counter.
\- Rest of shared NRI space is allocated to other CN operators in blocks of 4M
TMSI values like NRI = 28 - 31 [0111xx], 24 - 27 [0110xx] .... 0 -- 3 [000xx].
Initially gaps can be left between allocated NRI range that can be used for
expansion.
Following aspects need to be considered for this solution:
\- If more bits are needed for the restart counter or NRI, each additional bit
reduces the available TMSI space half.
\- The initial planning of NRI length should take into account the pool area
configurations of all sharing operators.
**TMSI per LA:**
Taking the example configurations mentioned above but changing the TMSI
allocation per LA would result in an increase of the addressing space, then
the same TMSI value can be used multiple times in the same VLR. More
considerations with this TMSI per LA approach can be found in TS 23.236 [8].
# A.3 NRI and CS/PS coordination in GWCN
For GWCN, the BSC and RNC determines a serving CN operator for a non-
supporting UE based on the principles defined in clause 4.2.5.3, such that
determined CN operator outcome (deterministic outcome) is the same in CS and
PS domain.
When source network determines target CN operator in handover and CS fallback,
the NRI and MMEC coordination is required as for MOCN (see clause A.1) within
the shared network and operator coordination of the CS-NRI and LAI tuple and
PS-NRI/MMEC and RAI/TAI tuple between the shared network and the dedicated
networks of the sharing partners:
\- to achieve that a non-supporting UE in visited PLMN will not change network
due to LA/RA update;
\- to achieve that non-supporting UE in visited PLMN becomes CS/PS
coordinated.
# A.4 CSPS Coordination
In figure A.4-1 an example is given how the CSPS coordination can be handled,
see also clause 4.2.5.3.
Figure A.4-1: Flow diagram for CSPS Coordination
A. When the target RAN node receives an idle mode signalling (Attach
Request/Routeing Area Update Request/Location Area Update Request messages)
from a UE it routes the request to a CN node based on the NRI provided by the
UE. For MOCN an operator is thereby selected. For GWCN an operator is selected
by the CN node. The RAN stores the NRI received from the UE.
B. If the UE can be served by the selected CN operator the UE is kept. A
\'Redirection Completed\' indication shall then be included in the response to
the RAN node and the procedure ends. In the following cases the CN operator
can serve the UE:
1\. The UE is a non-roaming subscriber of the selected CN operator.
2\. The UE is already served by the selected CN operator (e.g. periodic
updates or mobility within a pool).
3\. The RAN node indicates a RAN selected CN operator and the selected CN
operator is serving the UE in the opposite domain.
C. If the UE is not kept by the selected CN operator then \'Redirection
Indication\' with \'CS/PS coordination Required\' and IMSI is included in the
response to the RAN node. Old LAI (for the CS domain) or old RAI (for the PS
domain) or an indication whether the UE is attaching in the current domain, is
also included in the response.
D. If the UE is under operator coordination, the RAN node selects a core node
of the identified operator and forwards the message accordingly. The procedure
ends.
NOTE 1: If the UE is under operator coordination and is both CS and PS
registered in the source network, this operator is kept and CS/PS coordination
is achieved.
However, in conditions valid for step E and if the UE lacks CS registration in
the source network (e.g. as with source LTE and no SGs registration) then
achieving a successful CS/PS coordination and keeping the same serving
operator as in the source network will be dependent upon the access to the
information about the source network PS domain registration. For that reason
it becomes necessary to check if the UE is registered in the PS domain (see
step E) and if so register with that operator also in the CS domain. For
example at cell reselection from a source LTE to a target GERAN network
without DTM there will, during CS registration, be no registration in the PS
domain within the shared target network. Therefore a check must also been done
in all possible source networks of the sharing operators otherwise users may
become CS/PS uncoordinated. The lack of CS registration in the source network
implies an initial CS attach in the target network and therefore step E will
be performed.
A similar situation can occur when the UE lacks PS registration (as with no
Data roaming for the UE) but for normal cases the UE is already registered in
the target shared network in the CS domain when the PS registration occur.
Checking in the source networks is then not necessary.
E. If the UE is not under operator coordination, or if the UE is making an
initial attach, the RAN node sends requests to all connected CN nodes or by a
possible optimization to one CN node per operator in the opposite domain in
the target shared network, to inquire if the UE is served by the opposite
domain. To not risk a change of serving operator for cases described in step D
(i.e. when attaching to CS domain) then it is also necessary to check in the
all MMEs that may hold the UEs context, of the sharing operators, if the UE is
registered in the PS domain. Checking the source MMEs is done by relaying
requests from target RAN via the CN in the target shared network. However in
deployments where these cases are not applicable (e.g. always CS registration
in source networks) or when it is sufficient to achieve CS/PS coordination,
then the source networks need not to be checked.
NOTE 2: Checking CN nodes in the opposite domain in the target shared network
is also used at e.g. CS and PS Handover when the UE is not under operator
coordination. For such cases the idle mode domain registration needs to select
the same operator as is already in use for the connected domain.
F1. If the UE is registered in the opposite domain then the RAN node retrieves
the PLMN of that registered operator and selects the same operator for the
current domain. The procedure ends.
F2. If the UE is not registered in the opposite domain then the RAN node
selects operator based on the IMSI analysis. The procedure ends.
If during execution of step D or E, a registration in the opposite domain
occurs, then the RAN node can optionally select as follows:
\- If the UE is registered in the opposite domain and is under operator
coordination and is not performing an initial attach, then the RAN node, for
both domains, selects serving operator based on the registration information
from the opposite domain.
\- If the UE is registered in the opposite domain and is not under operator
coordination or is attaching, but with regards to the current domain the UE:
\- is under operator coordination and is not performing an initial attach,
then the RAN node, for both domains, selects serving operator based on the
registration information applicable to the current domain.
\- is not under operator coordination or is attaching then the RAN node, for
both domains, selects serving operator based on IMSI analysis.
For parallel registrations in the CS and PS domains the above means that CS/PS
coordination is achieved and that serving operator is kept.
###### ## Annex B (normative): Interaction with other network capabilities
# B.1 General
The provision of services and service capabilities in a network should not be
restricted by the existence of network sharing. Therefore, all new features
(or enhancements to existing features) should be specified to work in network
sharing environments. If it is not possible to specify complete support for
Network Sharing (i.e. PLMNs in a Shared Network has the same
features/capabilities and the same operational situation as a stand alone
PLMN) then such deviations are documented in this Annex.
# B.2 Support for RAN sharing for CSG and hybrid cells
A cell with closed/hybrid access can only broadcast one CSG ID but may
broadcast several PLMN IDs. If a cell with closed/hybrid access broadcasts
several PLMNs (see clauses 5.2 and 5.2a) for a UE supporting shared network or
a non-supporting UE that performs the PLMN selection (see clause 4.2.3.2), it
is the operator responsibility to coordinate the CSG IDs between the
operators\' PLMNs.
For handover into a shared hybrid or shared CSG cell, the source RAN shall
determine a target core network operator for which the UE is a CSG member
since otherwise the handover is likely to fail. In case the UE is capable of
reporting the subset of the broadcasted PLMN IDs in the target cell to which
its CSG membership is verified, the source RAN bases its core network operator
selection on this information. If this information is not reported by the UE
the selection of a target core network operator is based on pre-configured
information in the RAN.
NOTE: To ensure that handovers do not fail due to the source RAN selecting a
core network operator for which the UE is not a CSG member in the case when
the UE only reports the Primary PLMN-ID (E-UTRAN) or no PLMN ID (UTRAN), the
following RAN configuration can be used. The source RAN is configured with all
broadcasted PLMN identities of neighbouring shared hybrid and closed access
mode CSG cells, so that this data can be retrieved based on the UE-provided
information (ECGI/TAC/CSG ID in E-UTRAN and Cell ID in UTRAN) of the target
H(e)NB. The source RAN determines a target PLMN ID from the Handover
Restriction List (HRL, see TS 36.413 [14]) in E-UTRAN or Shared Network Area
(SNA) access information (see TS 25.413 [13]) in UTRAN. If HRL or SNA are not
supported, local configuration in the RAN could be used. For a target cell,
the allowed PLMN identities according to CSG membership should be the same as
the allowed PLMN identities for handover because otherwise handovers can fail.
If the target is hybrid cell and the UE is not a CSG member, the handover may
be solved in the same way.
For further details on Closed Subscriber Group (CSG) and closed/hybrid access,
see TS 36.300 [10] and TS 25.467 [17].
#
# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
This 3GPP Technical Specification (TS) specifies:
1\. The interactions between the HSS (Home Subscriber Server) and the CSCF
(Call Session Control Functions), referred to as the Cx interface.
2\. The interactions between the CSCF and the SLF (Server Locator Function),
referred to as the Dx interface.
3\. The interactions between the SIP Core and the SIP database, referred to as
the Cx interface, for the Mission Critical Commjnication Services, where this
interface is named as AAA-1, as described in 3GPP TS 23.179 [28].
NOTE: In the 3GPP TS 23.179 [xx] the term SIP database is used for the HSS and
the term SIP Core is used for the P-CSCF, the I-CSCF and the S-CSCF when
compared to this specification.
The IP Multimedia (IM) Subsystem stage 2 is specified in 3GPP TS 23.228 [1]
and the signalling flows for the IP multimedia call control based on SIP and
SDP are specified in 3GPP TS 24.228 [2].
This document addresses the signalling flows for Cx and Dx interfaces.
This document also addresses how the functionality of Px interface is
accomplished.
The Presence Service Stage 2 description (architecture and functional
solution) is specified in 3GPP TS 23.141 [10].
# 2 References
[1] 3GPP TS 23.228: \"IP Multimedia (IM) Subsystem -- Stage 2\".
[2] 3GPP TS 24.228: \"Signalling flows for the IP multimedia call control
based on SIP and SDP\".
[3] 3GPP TS 33.203: \"Access security for IP-based services\".
[4] 3GPP TS 23.002: \"Network architecture\".
[5] 3GPP TS 29.229: \"Cx Interface based on Diameter -- Protocol details\".
[6] 3GPP TS 23.218: \"IP Multimedia (IM) Session Handling; IP Multimedia (IM)
call model\".
[7] IETF RFC 2045 \"Multipurpose Internet Mail Extensions (MIME) Part One:
Format of Internet Message Bodies\".
[8] 3GPP TS 24.229: \"IP Multimedia Call Control Protocol based on SIP and
SDP\" -- stage 3.
[9] IETF RFC 3588 \"Diameter Base Protocol\".
[10] 3GPP TS 23.141: \"Presence Service; Architecture and Functional
Description\".
> [11] IETF RFC 3261 \"SIP: Session Initiation Protocol\".
[12] IETF RFC 4566 \"SDP: Session Description Protocol\".
[13] IEEE 1003.1-2004, Part 1: Base Definitions.
[14] IETF RFC 2486 \"The Network Access Identifier\".
[15] IETF RFC 3966 \"The tel URI for Telephone Numbers\".
[16] IETF RFC 2617 \"HTTP Authentication: Basic and Digest Access
Authentication\".
[17] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[18] 3GPP TS 23.008: \"Organization of subscriber data\".
[19] 3GPP TS 23.380: \"IMS Restoration Procedures\".
[20] Void
[21] IETF RFC 4005: \"Diameter Network Access Server Application\".
[22] IETF RFC 4412: \"Communications Resource Priority for the Session
Initiation Protocol (SIP)\".
[23] 3GPP TS 23.167: \"IP Multimedia Subsystem (IMS) emergency sessions\".
[24] IETF RFC 7683: \"Diameter Overload Indication Conveyance\".
[25] 3GPP TS 22.153: \"Multimedia Priority Service\".
[26] ANSI X3.4: \"Coded Character Set - 7-bit American Standard Code for
Information Interchange\".
[27] IETF RFC 7944: \"Diameter Routing Message Priority\".
[28] 3GPP TS 23.179: \"Functional architecture and information flows to
support mission critical communication services\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the following terms and definitions
given in TS 23.003 [17] apply:
**Distinct Public Service Identity**
**Distinct Public User Identity**
**Public Service Identity**
**Public User Identity**
**Wildcarded Public Service Identity**
**Wildcarded Public User Identity**
For the purposes of the present document, the following terms and definitions
apply.
**Common Part** (of a user profile): Contains Initial Filter Criteria
instances that should be evaluated both for registered and unregistered Public
User Identities, or for unregistered Public Service Identities in the S-CSCF.
**Complete user profile** : Contains the Initial Filter Criteria instances of
all three different user profile parts; registered part, unregistered part and
common part.
**IP Multimedia session:** IP Multimedia session and IP Multimedia call are
treated as equivalent in this specification.
**Authentication pending flag** : A flag that indicates that the
authentication of a Public User Identity - Private User Identity pair is
pending and waiting for confirmation.
**Charging information: Data that is sent in the Charging-Information AVP.**
**Allowed WAF and/or WWSF identities: A list of network addresses identifying
WebRTC Authentication Functions (WAFs) and/or WebRTC Web Server Functions
(WWSFs) allowed for a subscription.**
**Implicitly registered Public User Identity set: A set of Public User
Identities, which are registered and de-registered simultaneously when any of
the Public User Identities belonging to that set is registered or de-
registered.**
**Not Registered State:** Public Identity is not Registered and has no S-CSCF
assigned.
**Private Identity:** Either a Private User Identity or a Private Service
Identity.
**Public Identity:** Either a Public User Identity or a Public Service
Identity.
**Registered Part** (of a user profile): Contains Initial Filter Criteria
instances that should be evaluated only for registered Public User Identities
in the S-CSCF. iFCs from the registered part need not be evaluated when the
Public Identity is unregistered.
**Registered State:** Public User Identity is Registered at the request of the
user and has an S-CSCF assigned.
**S-CSCF reassignment pending flag** : A flag that is handled only when IMS
Restoration Procedures are supported.and that indicates that the subscription
may be reassigned to a new S-CSCF (i.e. the current S-CSCF is not responding)
**Unregistered part** (of a user profile): Contains Initial Filter Criteria
instances that should be evaluated only for unregistered Public Identities in
the S-CSCF. iFCs from the unregistered part need not be evaluated when the
Public User Identity is registered.
**Unregistered State:** Public Identity is not Registered but has a serving
S-CSCF assigned to execute Unregistered state services as a consequence of a
terminating request, or an originating request from an AS on behalf of a user,
or there is an S-CSCF keeping the user profile stored.
**User information: The user related data that the S-CSCF requests from the
HSS or HSS pushes to the S-CSCF, e.g. user profile,charging information,
allowed WAF and/or WWSF identities and authentication information.**
**User profile: Data that is sent in the User-Data AVP.**
## 3.2 Abbreviations
For the purposes of the present document, the following abbreviations apply:
AVP Attribute Value Pair
C Conditional
CSCF Call Session Control Function
DRMP Diameter Routing Message Priority
GIBA GPRS-IMS-Bundled-Authentication
HSS Home Subscriber Server
IE Information Element
IP Internet Protocol
I-CSCF Interrogating CSCF
IM IP Multimedia
IMS IP Multimedia Subsystem
M Mandatory
MPS Multimedia Priority Service
NASS Network Attachment SubSystem
> O Optional
P-CSCF Proxy CSCF
SIP Session Initiation Protocol
SLF Server Locator Function
S-CSCF Serving CSCF
WAF WebRTC Authentication Function
WWSF WebRTC Web Server Function
# 4 Main Concept
This document presents the Cx interface related functional requirements of the
communicating entities.
It gives a functional classification of the procedures and describes the
procedures and message parameters.
Error handling flows, protocol version identification, etc. procedures are
also included.
# 5 General Architecture
This clause further specifies the architectural assumptions associated with
the Cx reference point, building on 3GPP TS 23.228 [1] and also the Px
reference point building upon 3GPP TS 23.141 [10].
## 5.1 Functional requirements of network entities
### 5.1.1 Functional requirements of P-CSCF
There is no requirement for the interaction between the P-CSCF and the HSS.
### 5.1.2 Functional requirements of I-CSCF
The I-CSCF communicates with the HSS over the Cx interface.
For functionality of the I-CSCF refer to 3GPP TS 23.002 [4].
### 5.1.3 Functional requirements of S-CSCF
The S-CSCF communicates with the HSS over the Cx interface.
For functionality of the S-CSCF refer to 3GPP TS 23.002 [4].
### 5.1.4 Functional requirements of HSS
The HSS communicates with the I-CSCF and the S-CSCF over the Cx interface.
For functionality of the HSS refer to 3GPP TS 23.002 [4].
### 5.1.5 Functional classification of Cx interface procedures
Operations on the Cx interface are classified in functional groups:
1\. Location management procedures
\- The operations regarding registration and de-registration.
\- Location retrieval operation.
2\. User data handling procedures
\- The download of user information during registration and to support
recovery mechanisms.
\- Operations to support the updating of user data and recovery mechanisms.
3\. User authentication procedures
4\. IMS Restoration Procedures (see 3GPP TS 23.380 [19]) to support S-CSCF
service interruption
### 5.1.6 Functional Requirements of the Presentity Presence Proxy
The interaction between the Presentity Presence Proxy and the HSS, referred to
as the Px interface, is handled using the mechanisms defined for the Cx
interface.
# 6 Procedure Descriptions
In the tables that describe the Information Elements transported by each
command, each Information Element is marked as (M) Mandatory, (C) Conditional
or (O) Optional in the Category \"Cat.\" column. The application level
specification overrides the ABNF defining the presence of the AVPs to be
included in the Diameter commands. The category defined by the Information
Element table shall always be the same, i.e. Optional; or more restrictive,
i.e. Mandatory or Conditional, than the presence requirements defined by the
ABNF syntax, e.g. a required AVP in the ABNF shall not be overridden by an
Optional IE but an Optional AVP in the ABNF may be overridden by the Mandatory
or Conditional IE Category.
\- A mandatory Information Element shall always be present in the command. If
this Information Element is absent, an application error occurs at the
receiver and an answer message shall be sent back to the originator of the
request with the Result-Code set to DIAMETER_MISSING_AVP. This message shall
also include a Failed-AVP AVP containing the missing Information Element i.e.
the corresponding Diameter AVP defined by the AVP Code and the other fields
set as expected for this Information Element.
\- A conditional Information Element (marked as (C) in the table) shall be
present in the command if certain conditions are fulfilled.
\- If the receiver detects that those conditions are fulfilled and the
Information Element is absent, an application error occurs and an answer
message shall be sent back to the originator of the request with the Result-
Code set to DIAMETER_MISSING_AVP. This message shall also include a Failed-AVP
AVP containing the missing Information Element i.e. the corresponding Diameter
AVP defined by the AVP Code and the other fields set as expected for this
Information Element.
\- If those conditions are not fulfilled, the Information Element shall be
absent. If however this Information Element appears in the message, it shall
not cause an application error and it may be ignored by the receiver if this
is not explicitly defined as an error case. Otherwise, an application error
occurs at the receiver and an answer message with the Result-Code set to
DIAMETER_AVP_NOT_ALLOWED shall be sent back to the originator of the request.
A Failed-AVP AVP containing a copy of the corresponding Diameter AVP shall be
included in this message.
\- An optional Information Element (marked as (O) in the table) may be present
or absent in the command, at the discretion of the application at the sending
entity. Absence or presence of this Information Element shall not cause an
application error and may be ignored by the receiver.
When a procedure is required to determine whether two S-CSCF names are equal,
the rules for SIP URI comparison specified in RFC 3261 chapter 19.1.4 shall
apply.
When a procedure is required to determine the Public Identity used for an
identity lookup in HSS and SLF, the HSS and SLF shall use the Public Identity
from the SIP URI or Tel URI as contained in the Public-Identity AVP that is in
canonical form as described by 3GPP TS 23.003 [17].
Unknown permanent failure error codes shall be treated in the same way as
DIAMETER_UNABLE_TO_COMPLY. For unknown transient failure error codes the
request may be repeated, or handled in the same way as
DIAMETER_UNABLE_TO_COMPLY.
## 6.1 Location management procedures
### 6.1.1 User registration status query
This procedure is used between the I-CSCF and the HSS during SIP
registrations. The procedure is invoked by the I-CSCF, corresponds to the
combination of the functional level operations Cx-Query and Cx-Select-Pull
(see 3GPP TS 23.228 [1]) and is used:
\- To authorize the registration of the distinct Public User Identity,
checking multimedia subsystem access permissions and roaming agreements.
\- To perform a first security check, determining whether the distinct Public
User Identity in the message is associated with the Private User Identity sent
in the message.
\- To obtain either the S-CSCF where the distinct Public User Identity is
registered or unregistered (i.e. registered as a consequence of an originating
or terminating request or there is a S-CSCF keeping the user profile stored),
or the list of capabilities that the S-CSCF has to support.
This procedure is mapped to the commands User-Authorization-Request/Answer in
the Diameter application specified in 3GPP TS 29.229 [5]. Tables 6.1.1.1 and
6.1.1.2 detail the involved information elements.
Table 6.1.1.1: User registration status query
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | Public User | Public-Identity | M | Public User | | Identity | | | Identity to be | | | | | registered | | (See 7.2) | | | | +-------------------+-------------------+------+-------------------+ | Visited Network | Visited-N | M | Identifier that | | Identifier | etwork-Identifier | | allows the home | | | | | network to | | (See 7.1) | | | identify the | | | | | visited network | +-------------------+-------------------+------+-------------------+ | Type of | User-A | C | Type of | | Authorization | uthorization-Type | | authorization | | | | | requested by the | | (See 7.14) | | | I-CSCF. | | | | | | | | | | If the request | | | | | corresponds to a | | | | | de-registration, | | | | | i.e. Expires | | | | | field or expires | | | | | parameter in | | | | | Contact field in | | | | | the REGISTER | | | | | method is equal | | | | | to zero, this AVP | | | | | shall be present | | | | | in the command | | | | | and the value | | | | | shall be set to | | | | | DE-REGISTRATION. | | | | | | | | | | If the request | | | | | corresponds to an | | | | | initial | | | | | registration or a | | | | | re-registration, | | | | | i.e. Expires | | | | | field or expires | | | | | parameter in | | | | | Contact field in | | | | | the REGISTER | | | | | method is not | | | | | equal to zero | | | | | then this AVP may | | | | | be absent from | | | | | the command. If | | | | | present its value | | | | | shall be set to | | | | | REGISTRATION. | | | | | | | | | | If the request | | | | | corresponds to an | | | | | initial | | | | | registration or a | | | | | re-registration | | | | | or a | | | | | de-registration | | | | | and the I-CSCF | | | | | explicitly | | | | | queries the | | | | | S-CSCF | | | | | capabilities, | | | | | then this AVP | | | | | shall be present | | | | | in the command | | | | | and the value | | | | | shall be set to | | | | | REGISTRATION_A | | | | | ND_CAPABILITIES. | | | | | The I-CSCF shall | | | | | use this value | | | | | when the S-CSCF | | | | | currently | | | | | assigned to the | | | | | Public User | | | | | Identity in the | | | | | HSS, cannot be | | | | | contacted and a | | | | | new S-CSCF needs | | | | | to be selected. | +-------------------+-------------------+------+-------------------+ | Private User | User-Name | M | Private User | | Identity | | | Identity | | | | | | | (See 7.3) | | | | +-------------------+-------------------+------+-------------------+ | Routing | Destination-Host, | C | If the I-CSCF | | Information (See | Destination-Realm | | knows HSS name | | 7.13) | | | Destination-Host | | | | | AVP shall be | | | | | present in the | | | | | command. | | | | | Otherwise, only | | | | | Destination-Realm | | | | | AVP shall be | | | | | present and the | | | | | command shall be | | | | | routed to the | | | | | next Diameter | | | | | node, e.g. SLF, | | | | | based on the | | | | | Diameter routing | | | | | table in the | | | | | I-CSCF. | +-------------------+-------------------+------+-------------------+ | UAR Flags | UAR-Flags | O | This Information | | | | | Element contains | | (See 7.19) | | | a set of | | | | | indications. See | | | | | 7.19 for the | | | | | content of the | | | | | information | | | | | element. | +-------------------+-------------------+------+-------------------+
Table 6.1.1.2: User registration status response
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | Result | Result-Code / | M | Result of the | | | Ex | | operation. | | (See 7.6) | perimental-Result | | | | | | | Result-Code AVP | | | | | shall be used for | | | | | errors defined in | | | | | the Diameter Base | | | | | Protocol. | | | | | | | | | | Ex | | | | | perimental-Result | | | | | AVP shall be used | | | | | for Cx/Dx errors. | | | | | This is a grouped | | | | | AVP which | | | | | contains the 3GPP | | | | | Vendor ID in the | | | | | Vendor-Id AVP, | | | | | and the error | | | | | code in the | | | | | Experim | | | | | ental-Result-Code | | | | | AVP. | +-------------------+-------------------+------+-------------------+ | S-CSCF | Se | O | Required | | capabilities | rver-Capabilities | | capabilities of | | | | | the S-CSCF to be | | (See 7.5) | | | assigned to the | | | | | IMS Subscription. | +-------------------+-------------------+------+-------------------+ | S-CSCF Name | Server-Name | C | Name of the | | | | | assigned Sâ€‘CSCF. | | (See 7.4) | | | | +-------------------+-------------------+------+-------------------+
#### 6.1.1.1 Detailed behaviour
The HSS shall, in the following order (if there is an error in any of the
following steps the HSS shall stop processing and return the corresponding
error code, see 3GPP TS 29.229 [5]):
0\. If the HSS supports WebRTC as described in 3GPP TS 23.228 [1] subclause
U.2.1.4, it shall check if the Private User Identity and the Public User
Identity are managed by a third party, if so the HSS continues in step 4.
NOTE : How the HSS identifies that the Private User Identity and the Public
User Identity are managed by a third party for WebRTC and how the HSS
identifies the corresponding user profile are implementation specific.
1\. Check that the Private User Identity and the Public User Identity exists
in the HSS. If not Experimental-Result-Code shall be set to
DIAMETER_ERROR_USER_UNKNOWN.
2\. Check that the Public User Identity matches a distinct Public User
Identity in the HSS. If it doesn't, the Experimental-Result-Code shall be set
to DIAMETER_ERROR_USER_UNKNOWN.
3\. Check that the Public User Identity received in the request is associated
with the Private User Identity received in the request. If not Experimental-
Result-Code shall be set to DIAMETER_ERROR _IDENTITIES_DONT_MATCH.
4\. Check whether the Public User Identity received in the request is barred
from the establishment of multimedia sessions.
\- If it is an IMS Emergency Registration (by checking the UAR Flags) or the
Public User Identity received in the request is not barred, continue to step
5.
\- Otherwise, the HSS shall check whether there are other non-barred Public
User Identities to be implicitly registered with that one.
\- If so, continue to step 5.
\- If not, Result-Code shall be set to DIAMETER_AUTHORIZATION_REJECTED.
5\. Check the User-Authorization-Type received in the request:
\- If it is REGISTRATION or if User-Authorization-Type is absent from the
request, the HSS shall check whether the UAR Flags indicate that this is an
IMS Emergency Registration:
> \- If it is not, and the Public User Identity is allowed to roam in the
> visited network (if not Experimental-Result-Code shall be set to
> DIAMETER_ERROR _ROAMING_NOT_ALLOWED) and authorized to register (if not
> Result-Code shall be set to DIAMETER_AUTHORIZATION_REJECTED) then continue
> to step 6.
>
> \- If it is an IMS Emergency Registration, authorization shall be granted
> and the HSS shall not perform any check regarding roaming. Continue to step
> 6.
\- If it is DE_REGISTRATION, the HSS may not perform any check regarding
roaming. Continue to step 6.
\- If it is REGISTRATION_AND_CAPABILITIES, the HSS shall check whether the UAR
Flags indicate that this is an IMS Emergency Registration:
> \- If it is not, and the Public User Identity is allowed to roam in the
> visited network (if not Experimental-Result-Code shall be set to
> DIAMETER_ERROR _ROAMING_NOT_ALLOWED) and authorized to register (if not
> Result-Code shall be set to DIAMETER_AUTHORIZATION_REJECTED). The HSS may
> return the Server-Capabilities AVP, which enables the I-CSCF to select an
> S-CSCF. The returned capabilities, if any, shall satisfy all the
> requirements of all the service profiles associated with the IMS
> Subscription. If Server-Capabilities AVP is absent, it indicates to the
> I-CSCF that it can select any available S-CSCF. If an S-CSCF is already
> assigned in the HSS and IMS Restoration Procedures are supported in the HSS,
> the HSS shall set the S-CSCF reassignment pending flag and shall allow
> overwriting of the S-CSCF name in the next SAR request. Result-Code shall be
> set to DIAMETER_SUCCESS. The HSS shall not return any S-CSCF name. Stop
> processing.
>
> \- If it is an IMS Emergency Registration, authorization shall be granted
> and the HSS shall not perform any check regarding roaming. The HSS may
> return the Server-Capabilities AVP, which enables the I-CSCF to select an
> S-CSCF. The returned capabilities, if any, shall satisfy all the
> requirements of all the service profiles associated with the IMS
> Subscription. The Server-Capabilities AVP may be absent, to indicate to the
> I-CSCF that it can select any available S-CSCF. Result-Code shall be set to
> DIAMETER_SUCCESS. The HSS shall not return any S-CSCF name. Stop processing.
6\. Check the state of the Public User Identity received in the request:
\- If it is registered, the HSS shall return the stored S-CSCF name. No S-CSCF
capabilities shall be present in the response. If User-Authorization-Type is
equal to REGISTRATION or is absent, Experimental-Result-Code shall be set to
DIAMETER_SUBSEQUENT_REGISTRATION. If User-Authorization-Type is equal to DE-
REGISTRATION, Result-Code shall be set to DIAMETER_SUCCESS.
\- If it is unregistered (i.e. registered as a consequence of an originating
or terminating request or there is an S-CSCF keeping the user profile stored)
and User-Authorization-Type is equal to DE-REGISTRATION, the HSS shall return
the stored S-CSCF name and the Result-Code shall be set to DIAMETER_SUCCESS.
If the User-Authorization-Type is equal to REGISTRATION or is absent, then the
HSS shall return the stored S-CSCF name and the Experimental-Result-Code set
to DIAMETER_SUBSEQUENT_REGISTRATION. The HSS shall not return any S-CSCF
capabilities.
\- If it is not registered yet, the HSS shall check the value of User-
Authorization-Type received in the request:
\- If the value of User-Authorization-Type is DE_REGISTRATION and the
Authentication pending flag is set, the HSS shall return the stored S-CSCF
name and Experimental-Result-Code set to DIAMETER_SUCCESS. The HSS shall not
return any S-CSCF capabilities. Otherwise, if Authentication pending flag is
not set, the HSS shall not return any S-CSCF name or S-CSCF capabilities. The
HSS shall set the Experimental-Result-Code to
DIAMETER_ERROR_IDENTITY_NOT_REGISTERED in the response.
\- If the value of User-Authorization-Type is REGISTRATION or is absent, then
the HSS shall check if there is at least one Public User Identity within the
IMS Subscription with an S-CSCF name assigned.
\- If there is at least one Public User Identity within the IMS Subscription
that is registered, the HSS shall return the S-CSCF name assigned for that
Public User Identity and Experimental-Result-Code set to
DIAMETER_SUBSEQUENT_REGISTRATION. The HSS shall not return any S-CSCF
capabilities.
\- If there is at least one Public User Identity within the IMS Subscription
that is unregistered (i.e registered as a consequence of an originating or
terminating request or there is an S-CSCF keeping the user profile stored),
then the HSS shall return the stored S-CSCF name and the Experimental-Result-
Code set to DIAMETER_SUBSEQUENT_REGISTRATION. The HSS shall not return any
S-CSCF capabilities.
\- If there is no identity of the user within the same IMS Subscription that
is registered or unregistered, the HSS shall check if there is an S-CSCF name
stored for the user (e.g. the user is being authenticated by the S-CSCF as
indicated by the Authentication pending flag). If it is, the HSS shall return
the stored S-CSCF name and Experimental-Result-Code set to
DIAMETER_SUBSEQUENT_REGISTRATION. The HSS shall not return any S-CSCF
capabilities.
\- If there is not any Public User Identity within the IMS Subscription with
an S-CSCF name assigned, then the HSS may return the Server-Capabilities AVP,
which enables the I-CSCF to select an S-CSCF. The returned capabilities, if
any, shall satisfy all the requirements of all the service profiles associated
with the IMS Subscription. The Server-Capabilities AVP may be absent, to
indicate to the I-CSCF that it may select any available S-CSCF. Experimental-
Result-Code shall be set to DIAMETER_FIRST_REGISTRATION. The HSS shall not
return any S-CSCF name.
If the HSS cannot fulfil received request, e.g. due to database error, it
shall set Result-Code to DIAMETER_UNABLE_TO_COMPLY. No S-CSCF name or S-CSCF
capabilities shall be present in the response.
### 6.1.2 S-CSCF registration/deregistration notification
This procedure is used between the S-CSCF and the HSS. The procedure is
invoked by the S-CSCF, corresponds to the combination of the operations Cx-Put
and Cx-Pull (see 3GPP TS 23.228 [1]) and is used:
\- To assign an S-CSCF to a Public Identity, or to clear the name of the
S-CSCF assigned to one or more Public Identities.
\- To download from HSS the relevant user information for the S-CSCF.
\- To backup and retrieve the S-CSCF Restoration Information (see 3GPP TS
23.380 [19]) in the HSS.
\- To provide a P-CSCF Restoration Indication to the HSS and trigger P-CSCF
Restoration mechanism.
This procedure is mapped to the commands Server-Assignment-Request/Answer in
the Diameter application specified in 3GPP TS 29.229 [5]. Tables 6.1.2.1 and
6.1.2.2 describe the involved information elements.
Table 6.1.2.1: S-CSCF registration/deregistration notification request
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | Public User | Public-Identity | C | Public Identity | | Identity / Public | | | or list of Public | | Service Identity | | | Identities. | | | | | | | (See 7.2 and | | | One and only one | | 7.2a) | | | Public Identity | | | | | shall be present | | | | | if the | | | | | Serve | | | | | r-Assignment-Type | | | | | is any value | | | | | other than | | | | | TIMEOUT | | | | | _DEREGISTRATION, | | | | | USER | | | | | _DEREGISTRATION, | | | | | DEREGISTRATION\ | | | | | _TOO_MUCH_DATA, | | | | | TIMEOUT_DE | | | | | REGISTRATION_STO | | | | | RE_SERVER_NAME, | | | | | USER_D | | | | | EREGISTRATION_ST | | | | | ORE_SERVER_NAME | | | | | or | | | | | ADMINISTRATIVE | | | | | _DEREGISTRATION. | | | | | | | | | | If | | | | | Serve | | | | | r-Assignment-Type | | | | | indicates | | | | | deregistration of | | | | | some type and | | | | | Private Identity | | | | | is not present in | | | | | the request, at | | | | | least one Public | | | | | Identity shall be | | | | | present. | +-------------------+-------------------+------+-------------------+ | S-CSCF Name | Server-Name | M | Name of the | | | | | S-CSCF. | | (See 7.4) | | | | +-------------------+-------------------+------+-------------------+ | Private User | User-Name | C | Private Identity. | | Identity / | | | | | Private Service | | | It shall be | | Identity | | | present if it is | | | | | available when | | (See 7.3 and | | | the S-CSCF issues | | 7.3a) | | | the request. | | | | | | | | | | It may be absent | | | | | during the | | | | | initiation of a | | | | | session to an | | | | | unregistered | | | | | Public Identity | | | | | (Serve | | | | | r-Assignment-Type | | | | | shall contain the | | | | | value | | | | | UN | | | | | REGISTERED_USER) | | | | | or after S-CSCF | | | | | recovery upon | | | | | originating | | | | | request different | | | | | than REGISTER | | | | | (Serve | | | | | r-Assignment-Type | | | | | shall contain the | | | | | value | | | | | NO_ASSIGNMENT). | | | | | | | | | | In case of | | | | | de-registration, | | | | | Serve | | | | | r-Assignment-Type | | | | | equal to | | | | | TIMEOUT | | | | | _DEREGISTRATION, | | | | | ADMINISTRATIVE | | | | | _DEREGISTRATION, | | | | | DEREGISTRATION | | | | | _TOO_MUCH_DATA | | | | | or | | | | | TIMEOUT_D | | | | | EREGISTRATION_ST | | | | | ORE_SERVER_NAME | | | | | if no | | | | | Public-Identity | | | | | AVPs are present | | | | | then User-Name | | | | | AVP shall be | | | | | present. | +-------------------+-------------------+------+-------------------+ | Server Assignment | Serve | M | Type of update, | | Type | r-Assignment-Type | | request or | | | | | notification that | | (See 7.8) | | | the S-CSCF | | | | | requests in the | | | | | HSS (e.g: | | | | | de-registration). | | | | | See 3GPP TS | | | | | 29.229 [5] for | | | | | all the possible | | | | | values. | +-------------------+-------------------+------+-------------------+ | User Data Already | User-Data- | M | This indicates if | | Available | Already-Available | | the user profile | | | | | and charging | | (See 7.16) | | | information and, | | | | | if supported and | | | | | present in the | | | | | subscription, | | | | | allowed WAF | | | | | and/or WWSF | | | | | identities are | | | | | already available | | | | | in the S-CSCF. | | | | | | | | | | In the case where | | | | | Serve | | | | | r-Assignment-Type | | | | | is not equal to | | | | | NO_ASSIGNMENT, | | | | | REGISTRATION, | | | | | RE_REGISTRATION | | | | | or | | | | | UN | | | | | REGISTERED_USER, | | | | | the HSS shall not | | | | | use User Data | | | | | Already Available | | | | | when processing | | | | | the request. | +-------------------+-------------------+------+-------------------+ | Routing | Destination-Host | C | If the S-CSCF | | Information (See | | | knows the HSS | | 7.13) | | | name, the | | | | | Destination-Host | | | | | AVP shall be | | | | | present in the | | | | | command. | | | | | | | | | | This information | | | | | is available if | | | | | the request | | | | | belongs to an | | | | | already existing | | | | | registration, | | | | | e.g. in case of | | | | | the | | | | | re-registration, | | | | | where the HSS | | | | | name is stored in | | | | | the S-CSCF. The | | | | | HSS name is | | | | | obtained from the | | | | | Origin-Host AVP, | | | | | which is received | | | | | from the HSS, | | | | | e.g. included in | | | | | the MAA command. | | | | | | | | | | This information | | | | | may not be | | | | | available if the | | | | | command is sent | | | | | as a consequence | | | | | of a session | | | | | termination for | | | | | an unregistered | | | | | Public Identity. | | | | | In this case the | | | | | Destination-Host | | | | | AVP is not | | | | | present and the | | | | | command is routed | | | | | to the next | | | | | Diameter node, | | | | | e.g. SLF, based | | | | | on the Diameter | | | | | routing table in | | | | | the S-CSCF. | +-------------------+-------------------+------+-------------------+ | Wildcarded Public | Wildcarde | O | If the request | | Identity (See | d-Public-Identity | | refers to a | | 7.2b) | | | Wildcarded PSI or | | | | | Wildcarded Public | | | | | User Identity, | | | | | and the | | | | | Serv | | | | | er-Asignment-Type | | | | | is set to | | | | | UN | | | | | REGISTERED_USER, | | | | | NO_ASSIGNMENT, | | | | | TIMEOUT_DE | | | | | REGISTRATION_STO | | | | | RE_SERVER_NAME, | | | | | ADMINISTRATIVE | | | | | _DEREGISTRATION, | | | | | DEREGISTRATION | | | | | _TOO_MUCH_DATA | | | | | or | | | | | TIMEOUT | | | | | _DEREGISTRATION, | | | | | the S-CSCF may | | | | | include the | | | | | corresponding | | | | | Wildcarded PSI or | | | | | Wildcarded Public | | | | | User Identity in | | | | | this information | | | | | element. | | | | | | | | | | If this element | | | | | is present, it | | | | | shall be used by | | | | | the HSS to | | | | | identify the | | | | | identity affected | | | | | by the request. | | | | | The terms Public | | | | | Identity or | | | | | Public Service | | | | | Identity in the | | | | | detailed | | | | | behaviour refer | | | | | then to the | | | | | Wildcarded Public | | | | | Identity. | +-------------------+-------------------+------+-------------------+ | S-CSCF | SCSCF | C | When the S-CSCF | | Restoration | -Restoration-Info | | supports IMS | | Information (See | | | Restoration | | 7.21) | | | Procedures, if | | | | | Serve | | | | | r-Assignment-Type | | | | | is REGISTRATION | | | | | or | | | | | RE_REGISTRATION, | | | | | and any of the | | | | | related | | | | | restoration | | | | | information | | | | | changed compared | | | | | to the previous | | | | | one, the S-CSCF | | | | | shall send this | | | | | information | | | | | element to the | | | | | HSS. This | | | | | information | | | | | allows a later | | | | | retrieval in case | | | | | of an S-CSCF | | | | | service | | | | | interruption. | +-------------------+-------------------+------+-------------------+ | Multiple-Regist | Multiple-Regist | C | When the S-CSCF | | ration-Indication | ration-Indication | | supports IMS | | | | | Restoration | | (See 7.23) | | | Procedures, if | | | | | Serve | | | | | r-Assignment-Type | | | | | is REGISTRATION | | | | | and the | | | | | registration is a | | | | | multiple | | | | | registration and | | | | | the Public User | | | | | Identity is not | | | | | stored as | | | | | registered with | | | | | the Private User | | | | | Identity as in | | | | | the request in | | | | | the S-CSCF, the | | | | | S-CSCF shall send | | | | | this information | | | | | element to the | | | | | HSS. | +-------------------+-------------------+------+-------------------+ | Session-Priority | Session-Priority | O | This information | | | | | element, if | | (See 7.24) | | | present, shall | | | | | indicate the | | | | | session\'s | | | | | priority to the | | | | | HSS. | +-------------------+-------------------+------+-------------------+ | SAR Flags | SAR-Flags | O | This Information | | | | | Element contains | | (See 7.28) | | | a set of | | | | | indications. See | | | | | 7.28 for the | | | | | content of the | | | | | information | | | | | element. | +-------------------+-------------------+------+-------------------+
Table 6.1.2.2: S-CSCF registration/deregistration notification response
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | Private User | User-Name | C | Private Identity. | | Identity / | | | | | Private Service | | | It shall be | | Identity | | | present if it is | | | | | available when | | (See 7.3 and | | | the HSS sends the | | 7.3a) | | | response. | | | | | | | | | | It may be absent | | | | | in the following | | | | | error case: when | | | | | the | | | | | Serve | | | | | r-Assignment-Type | | | | | of the request is | | | | | U | | | | | NREGISTERED_USER | | | | | and the received | | | | | Public Identity | | | | | is not known by | | | | | the HSS. | +-------------------+-------------------+------+-------------------+ | Registration | Result-Code / | M | Result of | | result | Ex | | registration. | | | perimental-Result | | | | (See 7.6) | | | Result-Code AVP | | | | | shall be used for | | | | | errors defined in | | | | | the Diameter Base | | | | | Protocol. | | | | | | | | | | Ex | | | | | perimental-Result | | | | | AVP shall be used | | | | | for Cx/Dx errors. | | | | | This is a grouped | | | | | AVP which | | | | | contains the 3GPP | | | | | Vendor ID in the | | | | | Vendor-Id AVP, | | | | | and the error | | | | | code in the | | | | | Experim | | | | | ental-Result-Code | | | | | AVP. | +-------------------+-------------------+------+-------------------+ | User Profile | User-Data | C | Relevant user | | | | | profile. | | (See 7.7) | | | | | | | | It shall be | | | | | present when | | | | | Serve | | | | | r-Assignment-Type | | | | | in the request is | | | | | equal to | | | | | NO_ASSIGNMENT, | | | | | REGISTRATION, | | | | | RE_REGISTRATION | | | | | or | | | | | U | | | | | NREGISTERED_USER | | | | | according to the | | | | | rules defined in | | | | | section 6.6. | | | | | | | | | | If the S-CSCF | | | | | receives more | | | | | data than it is | | | | | prepared to | | | | | accept, it shall | | | | | perform the | | | | | de-registration | | | | | of the Private | | | | | Identity with | | | | | Serve | | | | | r-Assignment-Type | | | | | set to | | | | | DEREGISTRATION | | | | | _TOO_MUCH_DATA | | | | | and send back a | | | | | SIP 3xx or 480 | | | | | (Temporarily | | | | | Unavailable) | | | | | response, which | | | | | shall trigger the | | | | | selection of a | | | | | new S-CSCF by the | | | | | I-CSCF, as | | | | | specified in 3GPP | | | | | TS 24.229 [8]. | +-------------------+-------------------+------+-------------------+ | Charging | Cha | C | Addresses of the | | Information (See | rging-Information | | charging | | 7.12) | | | functions. | | | | | | | | | | It shall be | | | | | present when the | | | | | User-Data AVP is | | | | | sent to the | | | | | S-CSCF according | | | | | to the rules | | | | | defined in | | | | | section 6.6. | | | | | | | | | | When this | | | | | parameter is | | | | | included, either | | | | | the | | | | | Primary | | | | | -Charging-Collect | | | | | ion-Function-Name | | | | | AVP or the | | | | | Pr | | | | | imary-Event-Charg | | | | | ing-Function-Name | | | | | AVP shall be | | | | | included. All | | | | | other elements | | | | | shall be included | | | | | if they are | | | | | available. | +-------------------+-------------------+------+-------------------+ | Associated | Asso | O | This AVP contains | | Private | ciated-Identities | | all Private | | Identities | | | Identities, which | | | | | belong to the | | | | | same IMS | | | | | subscription as | | | | | the Private | | | | | Identity or | | | | | Public Identity | | | | | received in the | | | | | SAR command. | | | | | | | | | | If the IMS | | | | | subscription | | | | | contains only | | | | | single Private | | | | | Identity this AVP | | | | | shall not be | | | | | present. | +-------------------+-------------------+------+-------------------+ | Loose-Route | Loose | C | This AVP | | Indication | -Route-Indication | | indicates to the | | | | | S-CSCF that | | | | | loose-route | | | | | mechanism shall | | | | | be applied to the | | | | | public identities | | | | | contained in the | | | | | user profile | | | | | received from the | | | | | HSS. | | | | | | | | | | If the | | | | | loose-route | | | | | mechanism is | | | | | required, this | | | | | AVP shall be | | | | | present and set | | | | | to | | | | | LOOSE\ | | | | | _ROUTE_REQUIRED. | | | | | | | | | | If the | | | | | Loose-Route | | | | | mechanism is not | | | | | required, this | | | | | AVP may be either | | | | | absent or | | | | | present. If | | | | | present, it shall | | | | | be set to | | | | | LOOSE_ROUT | | | | | E_NOT_REQUIRED. | +-------------------+-------------------+------+-------------------+ | S-CSCF | SCSCF | C | This information | | Restoration | -Restoration-Info | | shall be present | | Information (See | | | if it was stored | | 7.21) | | | by the S-CSCF in | | | | | the HSS and | | | | | Serve | | | | | r-Assignment-Type | | | | | is either | | | | | U | | | | | NREGISTERED_USER | | | | | or | | | | | NO_ASSIGNMENT. | | | | | | | | | | This information | | | | | shall also be | | | | | present if it was | | | | | stored by the | | | | | S-CSCF in the HSS | | | | | and the SAR | | | | | indicates it is | | | | | related to a | | | | | multiple | | | | | registration and | | | | | Serve | | | | | r-Assignment-Type | | | | | is REGISTRATION. | +-------------------+-------------------+------+-------------------+ | Associated | Associated-Regi | C | This AVP contains | | Registered | stered-Identities | | all Private | | Private | | | Identities that | | Identities | | | were registered | | | | | with the Public | | (See 7.22) | | | Identity received | | | | | in the SAR | | | | | command. | | | | | | | | | | The HSS shall | | | | | send this | | | | | information | | | | | element if the | | | | | IMS Restoration | | | | | Procedures are | | | | | supported and the | | | | | value of | | | | | Serve | | | | | r-Assignment-Type | | | | | in the request is | | | | | REGISTRATION or | | | | | RE_REGISTRATION | | | | | and there are | | | | | other Private | | | | | Identities | | | | | different from | | | | | the Private | | | | | Identity received | | | | | in the SAR | | | | | command being | | | | | registered with | | | | | the Public | | | | | Identity received | | | | | in the SAR | | | | | command. | | | | | | | | | | Otherwise, this | | | | | AVP shall not be | | | | | present. | +-------------------+-------------------+------+-------------------+ | S-CSCF Name | Server-Name | C | Name of the | | | | | assigned S-CSCF. | | (See 7.4) | | | | | | | | This AVP shall be | | | | | present, if the | | | | | requesting S-CSCF | | | | | name is different | | | | | from the | | | | | previously | | | | | assigned S-CSCF | | | | | name stored in | | | | | the HSS. | +-------------------+-------------------+------+-------------------+ | Wildcarded Public | Wildcarde | C | This AVP shall be | | Identity (See | d-Public-Identity | | present if: | | 7.2b) | | | | | | | | - the value of | | | | | Serve | | | | | r-Assignment-Type | | | | | in the request | | | | | was | | | | | U | | | | | NREGISTERED_USER | | | | | and | | | | | | | | | | - the | | | | | Wildcarde | | | | | d-Public-Identity | | | | | AVP in the | | | | | request was not | | | | | present and | | | | | | | | | | - the Public | | | | | Identity in the | | | | | request fell | | | | | within the range | | | | | of a Wildcarded | | | | | Public User | | | | | Identity in the | | | | | HSS whose state | | | | | is | | | | | registe | | | | | red/unregistered. | | | | | | | | | | If this element | | | | | is present, it | | | | | shall be used by | | | | | the S-CSCF to | | | | | identify the | | | | | identity affected | | | | | by the request. | +-------------------+-------------------+------+-------------------+ | P | Priviledged- | O | This AVP | | riviledged-Sender | Sender-Indication | | indicates if the | | Indication | | | Private User | | | | | Identity shall be | | (See 7.26) | | | considered as a | | | | | priviledged | | | | | sender. | | | | | | | | | | If not present, | | | | | it means that the | | | | | Private User | | | | | Identity is not | | | | | considered a | | | | | priviledged | | | | | sender. | +-------------------+-------------------+------+-------------------+ | Allowed WAF | Allowed-WA | C | Addresses of the | | and/or WWSF | F-WWSF-Identities | | WAFs and/or WWSFs | | Identities (See | | | the subscription | | 7.29) | | | is allowing to | | | | | use. This AVP | | | | | shall be present | | | | | if both | | | | | | | | | | a) it is | | | | | applicable for | | | | | the subscription | | | | | and\ | | | | | b) the User-Data | | | | | AVP is present. | +-------------------+-------------------+------+-------------------+
#### 6.1.2.1 Detailed behaviour
On registering/deregistering a Public Identity the S-CSCF shall inform the
HSS. The same procedure is used by the S-CSCF:
\- to get the user information which contains the user profile, the charging
information and the allowed WAF and/or WWSF Identities. The relevant user
profile downloaded is described in more detailed in sections 6.5.1 and 6.6.
\- to provide a P-CSCF Restoration Indication to the HSS when the S-CSCF,
supporting the HSS based P-CSCF restoration mechanism described in 3GPP TS
23.380 [19], has identified a P-CSCF failure for a given UE and then triggers
the P-CSCF Restoration mechanism execution for this UE.
The Public-Identity AVP and User-Data AVPs in this command pair shall contain
only one type of identities i.e. either only Public User Identities, or only
Public Service Identities. User initiated registration/deregistration
procedures (i.e. server-assignment-type is set to RE_REGISTRATION,
USER_DEREGISTRATION, etc.) shall only be allowed for distinct Public User
Identities.
The HSS holds information about the state of registration of all the
identities related to an IMS Subscription. The S-CSCF uses this procedure to
update such states. For Shared Public User Identities, the S-CSCF shall
initiate this procedure towards the HSS for each Private User Identity
undergoing a Registration or Deregistration related to the Shared Public User
Identity. For implicitly registered identities, the rules defined in Section
6.5.1 shall apply.
When the request message was received because of a terminating session
request, the HSS may prioritise the received request message according to
priority level received within the Session-Priority AVP.
NOTE 1: Refer to Annex J for HSS procedures associated with the handling of
both the Session-Priority AVP and DRMP AVP received in the request message.
The HSS shall, in the following order (in case of an error in any of the steps
the HSS shall stop processing and return the corresponding error code, see
3GPP TS 29.229 [5]):
1\. Check that the Public Identity and Private Identity exist in the HSS. If
not Experimental-Result-Code shall be set to DIAMETER_ERROR_USER_UNKNOWN.
2\. The HSS may check whether the Private and Public Identities received in
the request are associated in the HSS. If not Experimental-Result-Code shall
be set to DIAMETER_ERROR_IDENTITIES_DONT_MATCH.
3\. If more than one Public-Identity AVP is present and the Server-Assignment-
Type is one of the values defined in Table 6.1.2.1 as applying for only one
identity, then the Result Code shall be set to
DIAMETER_AVP_OCCURS_TOO_MANY_TIMES and no user information shall be returned.
4\. The HSS shall check the Public Identity type received in the request.
\- If the identity in the request is a distinct Public User Identity, continue
in step 5, otherwise the HSS shall check the server-assignment-type:
If it indicates REGISTRATION, RE_REGISTRATION, USER_DEREGISTRATION,
USER_DEREGISTRATION_STORE_SERVER_NAME, AUTHENTICATION_FAILURE or
AUTHENTICATION_TIMEOUT, Experimental-Result-Code shall be set to
DIAMETER_ERROR_IN_ASSIGNMENT_TYPE.
\- If the identity in the request is a Public Service Identity, then check if
the PSI Activation State for that identity is active. If not, then the
response shall contain Experimental-Result-Code set to
DIAMETER_ERROR_USER_UNKNOWN.
5\. Check the Server Assignment Type value received in the request:
\- If it indicates REGISTRATION or RE_REGISTRATION, the HSS shall check
whether the Public Identity is assigned for the S-CSCF requesting the data.
> If there is already an S-CSCF assigned to the user and the requesting S-CSCF
> is not the same as the previously assigned S-CSCF, and IMS restoration
> procedures are not supported or the S-CSCF reassignment pending flag is not
> set, the HSS shall include the name of the previously assigned S-CSCF in the
> response message and the Experimental-Result-Code shall be set to
> DIAMETER_ERROR_IDENTITY_ALREADY_REGISTERED.
>
> If there is already an S-CSCF assigned to the user and the requesting S-CSCF
> is not the same as the previously assigned S-CSCF and IMS restoration
> procedures are supported, and the S-CSCF reassignment pending flag is set,
> the HSS shall overwrite the S-CSCF name and shall reset the S-CSCF
> reassignment pending flag.
If there is no S-CSCF assigned to the user or the requesting S-CSCF is the
same as the previously assigned S-CSCF stored in the HSS, the HSS shall
download the relevant user information taking into consideration the value set
in the User-Data-Already-Available AVP (see sub-clause 6.6). The Result-Code
shall be set to DIAMETER_SUCCESS and the HSS shall set the registration state
of the Public User Identity as registered (if not already registered).If the
S-CSCF Restoration Information is included in the request and the HSS
implements IMS Restoration procedures, and if it is RE_REGISTRATION, the HSS
shall store this information. If the Public User Identity's authentication
pending flag which is specific for the Private User Identity is set, the HSS
shall clear it. If there are multiple Private User Identities, which belong to
the served IMS subscription the Associated-Identities AVP should be added to
the answer message and it shall contain all Private User Identities associated
to the IMS subscription. If the loose-route mechanism is required for the
registered Public User Identities, the Loose-Route-Indication AVP shall be
added to the answer message. If there are multiple Private User Identities
being registered with the Public Identity received in the request message, and
the IMS Restoration Procedures are supported in the HSS, the Associated-
Registered-Identities AVP shall be added to the answer message and it shall
contain all Private User Identities being registered with the Public Identity.
> If it is REGISTRATION and the HSS implements IMS Restoration procedures, if
> multiple registration indication is included in the request and the Public
> User Identity is stored as registered in the HSS, and there is restoration
> information related to the Private User Identity, the HSS shall not
> overwrite the stored S-CSCF Restoration Information, instead, it shall send
> the stored S-CSCF restoration information together with the user profile in
> the SAA. The Experimental-Result-Code shall be set to
> DIAMETER_ERROR_IN_ASSIGNMENT_TYPE. Otherwise, the HSS shall store the
> received S-CSCF restoration information. The Result-Code shall be set to
> DIAMETER_SUCCESS.
\- If it indicates UNREGISTERED_USER, the following applies.
> If the P-CSCF-Restoration-Indication is included in SAR-Flags AVP, the HSS
> supporting the P-CSCF-Restoration-mechanism feature shall check whether at
> least one of the serving node(s) for corresponding user support this
> feature. If none of the serving nodes support the feature, the HSS shall
> stop processing this request and the Result-Code shall be set to
> DIAMETER_ERROR_SERVING_NODE_FEATURE_UNSUPPORTED.
>
> The HSS shall check whether the Public Identity is assigned for the S-CSCF
> requesting the data:
\- If there is already an S-CSCF assigned to the user and the requesting
S-CSCF is not the same as the previously assigned S-CSCF, and IMS restoration
procedures are not supported or the S-CSCF reassignment pending flag is not
set and a P-CSCF-Restoration-Indication is not included in SAR-Flags AVP, the
HSS shall include the name of the previously assigned S-CSCF in the response
message and the Experimental-Result-Code shall be set to
DIAMETER_ERROR_IDENTITY_ALREADY_REGISTERED.
\- If there is already an S-CSCF assigned to the user and the requesting
S-CSCF is not the same as the previously assigned S-CSCF and IMS restoration
procedures are supported, and the S-CSCF reassignment pending flag is set, the
HSS shall overwrite the S-CSCF name and shall reset the S-CSCF reassignment
pending flag.
\- If there is no S-CSCF assigned to the user or the requesting S-CSCF is the
same as the previously assigned S-CSCF stored in the HSS, the HSS shall store
the S-CSCF name.
The HSS shall check the Public Identity registration state:
\- If the registration state of the Public Identity is not registered or
unregistered, the HSS shall set or keep the registration state of the Public
Identity as unregistered, i.e. registered as a consequence of an originating
or terminating request and if a P-CSCF-Restoration-Indication is not included
in SAR-Flags AVP download the relevant user information. The Result-Code shall
be set to DIAMETER_SUCCESS. If there are multiple Private User Identities
associated to the Public User Identity in the HSS, the HSS shall arbitrarily
select one of the Private User Identities and put it into the response
message.
\- If the registration state of the Public Identity is registered and IMS
restoration procedures are not supported, the HSS shall set the registration
state of the Public identity as unregistered, clear any S-CSCF Restoration
Information associated with the Public User Identity (if any) and if a P-CSCF-
Restoration-Indication is not included in SAR-Flags AVP download the relevant
user information. The Result-Code shall be set to DIAMETER_SUCCESS. If there
are multiple Private User Identities associated to the Public User Identity in
the HSS, the HSS shall arbitrarily select one of the Private User Identities
and put it into the response message.
NOTE 2: The case where S-CSCF Restoration Information is stored in the HSS
even though IMS Restoration Procedures are not supported corresponds to the
situation where the HSS supports IMS Restoration Procedures but a new assigned
S-CSCF does not, while the former S-CSCF supported this feature.
If the registration state of the Public Identity is registered and IMS
restoration procedures are supported and a P-CSCF-Restoration-Indication is
not included in SAR-Flags AVP, the HSS shall include in the response all
S-CSCF Restoration Information related with the Public User Identity. If there
is S-CSCF Restoration Information associated with several Private User
Identities, the HSS shall include all the S-CSCF Restoration Information
groups in the response. The Experimental-Result-Code shall be set to
DIAMETER_ERROR_IN_ASSIGNMENT_TYPE.
\- If the registration state of the Public Identity is Registered and IMS
Restoration Procedures are supported and a P-CSCF-Restoration-Indication is
included in SAR-Flags AVP, the HSS shall set the registration state of the
Public identity as Unregistered and clear any S-CSCF Restoration Information
associated with the Public User Identity (if any). The Result-Code shall be
set to DIAMETER_SUCCESS.
> If there are multiple Private User Identities, which belong to the served
> IMS subscription the Associated-Identities AVP should be added to the answer
> message and it shall contain all Private User Identities associated to the
> IMS subscription.
>
> If the S-CSCF receives a wildcarded public identity from the I-CSCF, the
> S-CSCF shall use this wildcarded public identity to fetch the user profile
> (i.e. by sending a Cx-SAR including Wildcarded-Public-Identity AVP if the
> profile is not available) and registration information locally stored.
>
> If the S-CSCF does not receive a wildcarded public identity, the S-CSCF
> shall not perform wildcarded public identity matching and shall use the
> public identity received instead to fetch the user profile (i.e. by sending
> a Cx-SAR without including Wildcarded-Public-Identity AVP if the profile is
> not available) and registration information.
NOTE 3: There may be SIP requests in which the S-CSCF does not receive
information of a wildcarded public identity, e.g. originating call from an AS
on behalf of a user.
NOTE 4: Since a distinct public identity falling into the range of a
wildcarded public identity can have a different service profile, the S-CSCF
does not perform the wildcarded public identity matching against the public
identity received to avoid using the wrong service profile.
> If the Wildcarded-Public-Identity AVP is not received and if the Public
> Identity falls within the range of a wildcarded public identity whose
> registration state is registered and a P-CSCF-Restoration-Indication is not
> included in SAR-Flags AVP, the HSS shall not overwrite the registration
> state. The Result-Code shall be set to DIAMETER_ERROR_IN_ASSIGNMENT_TYPE and
> the HSS shall include the Wildcarded-Public-Identity AVP in the response.
> Upon reception of this error, the S-CSCF should behave as if it has received
> a wildcarded public identity in the first place.
>
> If SAR-Flags AVP includes a P-CSCF-Restoration-Indication, the HSS
> supporting the P-CSCF-Restoration--mechanism feature shall send a P-CSCF
> restoration indication to the serving nodes where the IMSI associated to the
> received Private Identity is registered, i.e. SGSN and/or MME, using S6a/S6d
> IDR/IDA or Gr ISD request/answer as described in 3GPP TS 23.380 [19] clause
> 5.4. The Result-Code shall be set to DIAMETER_SUCCESS.
\- If it indicates TIMEOUT_DEREGISTRATION, USER_DEREGISTRATION,
DEREGISTRATION_TOO_MUCH_DATA or ADMINISTRATIVE_DEREGISTRATION, the following
applies.
> If it indicates ADMINISTRATIVE_DEREGISTRATION and if the P-CSCF-Restoration-
> Indication is included in SAR-Flags AVP, the HSS supporting the P-CSCF-
> Restoration-mechanism feature shall check whether at least one of the
> serving node(s) for corresponding user support this feature. If none of the
> serving nodes support the feature, the HSS shall stop processing this
> request and the Result-Code shall be set to
> DIAMETER_ERROR_SERVING_NODE_FEATURE_UNSUPPORTED.
>
> The HSS shall check the registration state for all the Public Identities in
> the request.
\- If a Private User Identity is present in the request, if the request did
not contain Public Identities the HSS shall check the registration state of
the Public Identities associated with the Private Identity identified in the
request. For each Public Identity:
\- If the registration state of the Public User Identity is Registered, the
HSS shall check if the Public User Identity is currently registered with one
or more Private User Identities.
\- If the Public User Identity is currently registered with only one Private
User Identity, the HSS shall set the registration state of the Public User
Identity to Not Registered and clear the S-CSCF name and any S-CSCF
Restoration Information associated with the Public User Identity.
\- If the Public User Identity is currently registered with more than one
Private User Identity, the HSS shall keep the registration state of the Public
User Identity as Registered and retain the S-CSCF name associated with the
Public User Identity. The HSS shall remove any S-CSCF Restoration Information
associated to the registration of this Public User Identity with this Private
User Identity.
\- If a Private User Identity is absent in the request, if the Public User
Identity is currently registered with more than one Private User Identity, the
HSS shall stop processing this request and shall set the Result-Code to
DIAMETER_MISSING_AVP.
\- if the registration state of the Public Identity is Unregistered, the HSS
shall set the registration state of the Public Identity to Not Registered and
clear the S-CSCF name associated with the Public Identity.
> In case of ADMINISTRATIVE_DEREGISTRATION, if SAR-Flags AVP includes a
> P-CSCF-Restoration-Indication, the HSS supporting the P-CSCF-Restoration-
> mechanism feature shall send a P-CSCF restoration indication to the serving
> nodes where the IMSI associated to the received Private Identity is
> registered, i.e. SGSN and/or MME, using S6a/S6d IDR/IDA or Gr ISD
> request/answer as described in 3GPP TS 23.380 [19] clause 5.4.
>
> The Result-Code shall be set to DIAMETER_SUCCESS
>
> \- If it indicates TIMEOUT_DEREGISTRATION_STORE_SERVER_NAME or
> USER_DEREGISTRATION_STORE_SERVER_NAME the HSS decides whether to keep the
> S-CSCF name associated to the Private User Identity stored or not for all
> the Public User Identities that the S-CSCF indicated in the request. If no
> Public User Identity is present in the request, the Private User Identity
> shall be present.
>
> \- If the HSS decides to keep the S-CSCF name stored the HSS shall keep the
> S-CSCF name stored for all the Public User Identities associated to the
> Private User Identity. The Result-Code shall be set to DIAMETER_SUCCESS.
>
> The HSS shall check if each Public User Identity in the request is currently
> registered with one or more Private User Identities. If the request did not
> contain Public User Identities the HSS shall check if each Public User
> Identity associated with the Private User Identity in the request is
> currently registered with one or more Private User Identities. For each
> Public User Identity;-
\- If only one Private User Identity associated with the Public User Identity
is currently registered with the Public User Identity, the HSS shall set the
registration state of the Public User Identity to Unregistered and clear any
S-CSCF Restoration Information associated with the Public User Identity
\- If more than one Private User Identity that shares that Public User
Identity is currently registered with the Public User Identity the HSS shall
keep the registration state of the Public User Identity as Registered. The HSS
shall remove any S-CSCF Restoration Information associated to the registration
of this Public User Identity with the Private User Identity in the request.
\- If the HSS decides not to keep the S-CSCF name the Experimental-Result
shall be set to DIAMETER_SUCCESS_SERVER_NAME_NOT_STORED.
> The HSS shall check if each Public User Identity in the request is currently
> registered with one or more Private User Identities. If the request did not
> contain Public User Identities the HSS shall check if each Public User
> Identity associated with the Private User Identity in the request is
> currently registered with one or more Private User Identities. For each
> Public User Identity;-
\- If only one Private User Identity associated with the Public User Identity
is currently registered with the Public User Identity, the HSS shall set the
registration state of the Public User Identity to Not Registered and clear the
S-CSCF name associated with Public User Identity.
\- If more than one Private User Identity that shares that Public User
Identity is currently registered with the Public User Identity the HSS shall
keep the registration state of the Public User Identity as Registered.
\- If it indicates NO_ASSIGNMENT, the HSS checks whether the Public Identity
is assigned for the S-CSCF requesting the data. If the requesting S-CSCF is
not the same as the assigned S-CSCF and the S-CSCF reassignment pending flag
is not set, the Result-Code shall be set to DIAMETER_UNABLE_TO_COMPLY,
otherwise the HSS shall download the relevant user information and the Result-
Code shall be set to DIAMETER_SUCCESS. If relevant S-CSCF Restoration
Information is stored in the HSS and IMS Restoration Procedures are supported,
it shall be added to the answer message. If there is S-CSCF Restoration
Information associated with several Private User Identities, the HSS shall
include all the S-CSCF Restoration Information groups in the response. If
there are multiple Private User Identities, which belong to the served IMS
subscription the Associated-Identities AVP should be added to the answer
message and it shall contain all Private User Identities associated to the IMS
subscription.
NOTE 5: the check of the S-CSCF reassignment pending flag is needed since an
S-CSCF supporting restoration procedures can receive a user initiated de-
registration for a Public Identity for which it does not have any registration
data (see 3GPP TS 23.380 [19]). In such case, the S-CSCF indicates
NO_ASSIGNMENT in Server-Assignment-Type to retrieve any possible restoration
information from the HSS.
\- If it indicates AUTHENTICATION_FAILURE (e.g. there is a mismatch in IP-
address secure binding information) or AUTHENTICATION_TIMEOUT (e.g. no
response to Digest challenge), the HSS shall keep the registration state of
the Public User Identity. The HSS shall check the registration state for the
Public User Identity in the request and only if the registration state of the
Public User Identity is Not Registered, the HSS shall clear the S-CSCF name
associated with the Public User Identity.
> If the Public User Identity's authentication pending flag which is specific
> for the Private User Identity is set, the HSS shall clear it. The Result-
> Code shall be set to DIAMETER_SUCCESS.
If the HSS cannot fulfil the received request, e.g. due to database error, it
shall set the Result-Code to DIAMETER_UNABLE_TO_COMPLY. The HSS shall not
modify any registration state nor download any Public Identity information to
the S-CSCF.
See chapter 8.1.2 and 8.1.3 for the description of the handling of the error
situations: reception of an S-CSCF name different from the one stored in the
HSS and reception of a Server-Assignment-Type value not compatible with the
registration state of the Public Identity.
### 6.1.3 Network initiated de-registration by the HSS, administrative
In case of network initiated de-registration of by the HSS, the HSS change the
state of the Public Identities to Not Registered and send a notification to
the S-CSCF indicating the identities that shall be de-registered. The
procedure is invoked by the HSS, corresponds to the functional level operation
Cx-Deregister (see 3GPP TS 23.228 [1]).
This procedure is mapped to the commands Registration-Termination-
Request/Answer in the Diameter application specified in 3GPP TS 29.229 [5].
Tables 6.1.3.1 and 6.1.3.2 describe the involved information elements.
Table 6.1.3.1: Network Initiated Deregistration by HSS request
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | Public User | Public-Identity | C | It contains the | | Identity / Public | | | list of Public | | Service Identity | | | Identities that | | | | | are | | (See 7.2 and | | | de-registered, in | | 7.2a) | | | the form of SIP | | | | | URL or TEL URL. | | | | | | | | | | Public-Identity | | | | | AVP shall be | | | | | present if the | | | | | de-registration | | | | | reason code is | | | | | NEW_ | | | | | SERVER_ASSIGNED. | | | | | It may be present | | | | | with the other | | | | | reason codes. | +-------------------+-------------------+------+-------------------+ | Private User | User-Name | M | It contains the | | Identity / | | | Private Identity | | Private Service | | | in the form of a | | Identity | | | NAI. The HSS | | | | | shall always send | | (See 7.3 and | | | a Private | | 7.3a) | | | Identity that is | | | | | known to the | | | | | S-CSCF based on | | | | | an earlier | | | | | SAR/SAA | | | | | procedure. | +-------------------+-------------------+------+-------------------+ | Reason for | Dere | M | The HSS shall | | de-registration | gistration-Reason | | send to the | | | | | S-CSCF a reason | | (See 7.11) | | | for the | | | | | de-registration. | | | | | The | | | | | de-registration | | | | | reason is | | | | | composed of two | | | | | parts: one | | | | | textual message | | | | | (if available) | | | | | that is intended | | | | | to be forwarded | | | | | to the user that | | | | | is de-registered, | | | | | and one reason | | | | | code (see 3GPP TS | | | | | 29.229 [5]) | | | | | that determines | | | | | the behaviour of | | | | | the S-CSCF. | +-------------------+-------------------+------+-------------------+ | Routing | Destination-Host | M | It contains the | | Information (See | | | name of the | | 7.13) | | | S-CSCF which | | | | | originated the | | | | | last update of | | | | | the name of the | | | | | multimedia server | | | | | stored in the HSS | | | | | for a given IMS | | | | | Subscription. The | | | | | address of the | | | | | S-CSCF is the | | | | | same as the | | | | | Origin-Host AVP | | | | | in the message | | | | | sent from the | | | | | S-CSCF. | +-------------------+-------------------+------+-------------------+ | Associated | Asso | O | This AVP contains | | Private | ciated-Identities | | Private | | Identities | | | Identities, which | | | | | belong to the | | | | | same IMS | | | | | subscription as | | | | | the Private | | | | | Identity in the | | | | | User-Name AVP and | | | | | should be | | | | | de-registered | | | | | together with | | | | | that one. | | | | | | | | | | If the IMS | | | | | subscription | | | | | contains only a | | | | | single Private | | | | | Identity, this | | | | | AVP shall not be | | | | | present. | +-------------------+-------------------+------+-------------------+
Table 6.1.3.2: Network Initiated Deregistration by HSS response
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | Result | Result-Code / | M | This information | | | Ex | | element indicates | | (See 7.6) | perimental-Result | | the result of | | | | | de-registration. | | | | | | | | | | Result-Code AVP | | | | | shall be used for | | | | | errors defined in | | | | | the Diameter Base | | | | | Protocol. | | | | | | | | | | Ex | | | | | perimental-Result | | | | | AVP shall be used | | | | | for Cx/Dx errors. | | | | | This is a grouped | | | | | AVP which | | | | | contains the 3GPP | | | | | Vendor ID in the | | | | | Vendor-Id AVP, | | | | | and the error | | | | | code in the | | | | | Experim | | | | | ental-Result-Code | | | | | AVP. | +-------------------+-------------------+------+-------------------+ | Associated | Asso | C | This AVP shall be | | Private | ciated-Identities | | present if the | | Identities | | | S-CSCF | | | | | de-registered | | | | | more than one | | | | | Private Identity | | | | | with the request. | | | | | It contains all | | | | | Private | | | | | Identities that | | | | | have been | | | | | deregistered | | | | | together with the | | | | | one in the | | | | | User-Name AVP of | | | | | the request. | +-------------------+-------------------+------+-------------------+ | Identities with | Id | C | This information | | Emergency | entity-with-Emerg | | element indicates | | Registration | ency-Registration | | a list of pairs | | | | | of private and | | (See 7.25) | | | public user | | | | | identities which | | | | | have not been | | | | | de-registered due | | | | | to emergency | | | | | registration. | +-------------------+-------------------+------+-------------------+
#### 6.1.3.1 Detailed behaviour
The HSS shall de-register the affected identities and invoke this procedure to
inform the S-CSCF. The S-CSCF shall remove all the information stored in the
S-CSCF for the affected identities.
The HSS may de-register:
\- One Public Identity or a list of Public Identities. HSS may include all
Public User Identities associated with the User-Name AVP to the request. This
option is applicable with all reason codes.
\- One or more Private Identities of the IMS Subscription with all associated
Public Identities. No Public-Identity AVPs shall be present in this case. This
option is applicable with reason codes PERMANENT_TERMINATION, SERVER_CHANGE,
and REMOVE_S-CSCF.
\- All Public Service Identities that match a Wildcarded Public Service
Identity. In this case the HSS may send one of the Public Service Identities
that was received in the Server Assignment Request for that Wildcarded Public
Service Identity and the associated Private Service Identity.
\- A Wildcarded Public User Identity. In this case the HSS shall send a
distinct Public User Identity that belongs to the same implicit registration
set as the Wildcarded Public User Identity and the associated Private User
Identity.
The HSS shall send in the Deregistration-Reason AVP the reason for the de-
registration, composed by a textual message (if available) aimed for the user
and a reason code that determines the action the S-CSCF has to perform. The
possible reason codes are:
\- PERMANENT_TERMINATION: The HSS indicates to the S-CSCF that the S-CSCF will
no longer be assigned to the Public Identity and associated implicitly
registered Public Identities for the Private Identity(ies) indicated in the
request (e.g. due to an IMS subscription modification or a removal of IP-
address secure binding information when GIBA is used).
> The HSS shall check the registration state of the Public Identities. If no
> Public Identities are involved, the HSS shall check the registration state
> of the Public Identities associated with the Private User Identity
> identified. For each Public Identity:
\- If the registration state of the Public Identity is Registered, the HSS
shall check if the Public User Identity is currently registered with one or
more Private User Identities.
\- If the Public User Identity is currently registered with only one Private
User Identity, the HSS shall check whether the Public User Identity is
included in the information element Identities with Emergency Registrations
returned by S-CSCF in the response.
\- If included, the HSS shall keep the S-CSCF name associated with the Public
User Identity and set the registration state of the Public User Identity to
Unregistered.
\- If not included, the HSS shall clear the S-CSCF name associated with the
Public User Identity, and set the registration state of the Public User
Identity to Not Registered The S-CSCF initiates the de-registration of the
Public User Identity unless it is emergency registered.
\- If the Public User Identity is currently registered with more than one
Private User Identity, the HSS shall keep the registration state of the Public
User Identity as Registered and retain the S-CSCF name associated with the
Public User Identity. The S-CSCF initiates the de-registration of the Public
User Identity unless it is emergency registered.
> \- If the registration state of the Public Identity is Unregistered, the HSS
> shall check whether this Public User Identity is included in the information
> element Identities with Emergency Registrations returned by S-CSCF in the
> response.
\- If included, the HSS shall keep the S-CSCF name associated with the Public
User Identity.
\- If not included, the HSS shall set the registration state of the Public
Identity to Not Registered and clear the S-CSCF name associated with the
Public Identity.
\- NEW_SERVER_ASSIGNED: The HSS indicates to the S-CSCF that a new S-CSCF has
been allocated to the IMS Subscription e.g. because the previous assigned
S-CSCF was unavailable during a registration procedure. The S-CSCF shall
remove all information for all of the Public Identities indicated in the
request.
\- SERVER_CHANGE: The HSS indicates to the S-CSCF that the de-registration is
requested to force the selection of new S-CSCF to assign to the IMS
Subscription (e.g. when the S-CSCF capabilities are changed in the HSS or when
the S-CSCF indicates that it has not enough memory for the updated User
Profile). The HSS shall set the registration state to \"Not Registered\" and
clear the S-CSCF name for all of the Public Identities affected by the
request. If the S-CSCF does not indicate in the response all the Private
Identities that were in the request, the HSS shall repeat this request for
each of the remaining Private Identities in the IMS Subscription that are
known to the S-CSCF. The S-CSCF should start the network initiated de-
registration towards the user, i.e. all registrations within the IMS
Subscription are de-registered and the user is asked to re-register to all
existing registrations.
\- REMOVE_S-CSCF: The HSS indicates to the S-CSCF that the S-CSCF will no
longer be assigned to an unregistered Public Identity(ies) (i.e registered as
a consequence of an originating or terminating request or there is a S-CSCF
keeping the user profile stored) for a given IMS Subscription.
> The HSS shall check if an emergency registration exists in the S-CSCF,
> checking for each Public Identity contained in the request whether it is
> present in the information element Identities with Emergency Registrations
> returned by S-CSCF.
\- If an emergency registration does not exist in S-CSCF, for each Public
Identity contained within the request, the HSS shall set the registration
state of the Public Identity to Not Registered and clear the S-CSCF name
associated with the Public Identity. The S-CSCF shall remove all information
related to the Public User Identity contained within the request.
\- If an emergency registration exists in S-CSCF for one or more Public User
Identities contained in the request, the S-CSCF should include the
corresponding Private Identity /Public User Identity pairs in the information
element Identities with Emergency Registrations in the answer. The HSS, when
receiving such an answer, shall not change the registration state of the
Public User Identities present in the information element Identities with
Emergency Registrations and shall keep unchanged the S-CSCF name associated
with these Public User Identities.
Public Identities which are emergency registered in the S-CSCF shall not be
de-registered when a Cx-Deregistration request with a -reason code of
PERMANENT_TERMINATION or REMOVE_S-CSCF is received from the HSS. In this case
\- if all to be de-registered identities are emergency registered, a Result-
Code set to DIAMETER_UNABLE_TO_COMPLY and a list of Private / Public Identity
pairs which are emergency registered shall be returned to the HSS
\- if a proper subset of the to be de-registered identities are emergency
registered, a Result-Code of DIAMETER_LIMITED_SUCCESS and a list of Private
Identity / Public Identity pairs which are emergency registered shall be
returned to the HSS.
NOTE 1: If the Public Identity that is emergency registered has normal
registration as well, then for the normal registration the S-CSCF will perform
the detailed de-registration procedures towards the UE for each reason code as
described in 3GPP TS 24.229 [8].
NOTE 2: It is assumed that Public Identities which are implicitly registered
along with an emergency registration are also emergency registered.
The detailed de-registration procedures performed by the S-CSCF are described
in 3GPP TS 24.229 [8].
### 6.1.4 User location query
This procedure is used between the I-CSCF and the HSS to obtain the name of
the S-CSCF assigned to a Public Identity, or the name of the AS hosting a PSI
for direct routing. The procedure is invoked by the I-CSCF, is performed per
Public Identity, and corresponds to the functional level operation Cx-
Location-Query (see 3GPP TS 23.228 [1]).
This procedure is mapped to the commands Location Info Request/Answer in the
Diameter application specified in 3GPP TS 29.229 [5]. Tables 6.1.4.1 and
6.1.4.2 detail the involved information elements.
Table 6.1.4.1: User Location query
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | Public User | Public-Identity | M | Public Identity | | Identity / Public | | | | | Service Identity | | | | | | | | | | (See 7.2 and | | | | | 7.2a) | | | | +-------------------+-------------------+------+-------------------+ | Routing | Destination-Host, | C | If the I-CSCF | | information (See | Destination-Realm | | knows HSS name | | 7.13) | | | Destination-Host | | | | | AVP shall be | | | | | present in the | | | | | command. | | | | | Otherwise, only | | | | | Destination-Realm | | | | | AVP shall be | | | | | present and the | | | | | command shall be | | | | | routed to the | | | | | next Diameter | | | | | node, e.g. SLF, | | | | | based on the | | | | | Diameter routing | | | | | table in the | | | | | I-CSCF. | +-------------------+-------------------+------+-------------------+ | Originating | Or | O | It indicates that | | Request | iginating-Request | | the request is | | | | | related to an | | (See 7.18) | | | originating SIP | | | | | message. | +-------------------+-------------------+------+-------------------+ | Type of | User-A | C | This information | | Authorization | uthorization-Type | | element shall be | | | | | present and set | | (See 7.14) | | | to | | | | | REGISTRATION_ | | | | | AND_CAPABILITIES | | | | | by the I-CSCF if | | | | | IMS Restoration | | | | | Procedures are | | | | | supported and the | | | | | S-CSCF currently | | | | | assigned to the | | | | | Public User | | | | | Identity in the | | | | | HSS cannot be | | | | | contacted. | +-------------------+-------------------+------+-------------------+ | Session Priority | Session-Priority | O | This information | | | | | element, if | | (See 7.24) | | | present, shall | | | | | indicate the | | | | | session\'s | | | | | priority to the | | | | | HSS. | +-------------------+-------------------+------+-------------------+
Table 6.1.4.2: User Location response
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | Result | Result-Code / | M | Result of the | | | Ex | | operation. | | (See 7.6) | perimental-Result | | | | | | | Result-Code AVP | | | | | shall be used for | | | | | errors defined in | | | | | the Diameter Base | | | | | Protocol. | | | | | | | | | | Ex | | | | | perimental-Result | | | | | AVP shall be used | | | | | for Cx/Dx errors. | | | | | This is a grouped | | | | | AVP which | | | | | contains the 3GPP | | | | | Vendor ID in the | | | | | Vendor-Id AVP, | | | | | and the error | | | | | code in the | | | | | Experim | | | | | ental-Result-Code | | | | | AVP. | +-------------------+-------------------+------+-------------------+ | S-CSCF Name / AS | Server-Name | C | Name of the | | name | | | assigned S-CSCF | | | | | for basic IMS | | (See 7.4 and | | | routing or the | | 7.4a) | | | name of the AS | | | | | for direct | | | | | routing. | +-------------------+-------------------+------+-------------------+ | S-CSCF | Se | O | It contains the | | capabilities | rver-Capabilities | | information to | | | | | help the I-CSCF | | (See 7.5) | | | in the selection | | | | | of the S-CSCF. | +-------------------+-------------------+------+-------------------+ | Wildcarded Public | Wildcarde | O | If the requests | | Identity (See | d-Public-Identity | | refers to a | | 7.2b) | | | Wildcarded PSI or | | | | | Wildcarded Public | | | | | User Identity | | | | | (the Public | | | | | Identity in the | | | | | request matches a | | | | | Wildcarded PSI or | | | | | Wildcarded Public | | | | | User Identity in | | | | | the HSS), the HSS | | | | | shall include the | | | | | corresponding | | | | | Wildcarded Public | | | | | Identity in this | | | | | information | | | | | element. | | | | | | | | | | The matching of | | | | | distinct Public | | | | | Identies takes | | | | | precedence over | | | | | the matching of | | | | | wildcarded public | | | | | identities. | +-------------------+-------------------+------+-------------------+ | LIA Flags | LIA-Flags | O | This information | | | | | element contains | | (See 7.27) | | | a bit mask. | | | | | | | | | | See 7.27 for the | | | | | meaning of the | | | | | bits. | +-------------------+-------------------+------+-------------------+
#### 6.1.4.1 Detailed behaviour
The HSS may prioritise the received request message according to priority
level received within the Session-Priority AVP.
NOTE 1: Refer to Annex J for HSS procedures associated with the handling of
both the Session-Priority AVP and DRMP AVP received in the request message.
The HSS shall, in the following order (if an error occurs in any of the ste
The HSS shall, in the following order (if an error occurs in any of the steps
the HSS shall stop processing and return the corresponding error code, see
3GPP TS 29.229 [5]):
1\. Check that the Public Identity is known. If not the Experimental-Result-
Code shall be set to DIAMETER_ERROR_USER_UNKNOWN.
2\. Check the type of the Public Identity contained in the request:
\- If this is a Public User Identity, continue to step 2a.
\- If this is a Public Service Identity:
\- Check if the PSI Activation State for that identity is active. If not, then
the response shall contain Experimental-Result-Code set to
DIAMETER_ERROR_USER_UNKNOWN.
\- Check if the name of the AS hosting the Public Service Identity is stored
in the HSS and that the request does not contain the Originating-Request AVP.
\- If this is the case, if IMS Restoration Procedures are supported, the HSS
shall check if User-Authorization-Type was received in the request, and if the
value is REGISTRATION_AND_CAPABILITIES:
\- If it is, the HSS shall reject the request with Result-Code set to
DIAMETER_UNABLE_TO_COMPLY.
\- Otherwise, the HSS shall return the AS name and the Result-Code AVP shall
be set to DIAMETER_SUCCESS. HSS may set PSI Direct Routing Indication bit in
LIA-Flags AVP, then I-CSCF shall not perform IMS Restoration Procedures (see
chapter 4.3.3 in 3GPP TS 23.380 [19]).
\- Otherwise, continue to step 2a.
> 2a. If IMS Restoration procedures are supported, the HSS shall check if
> User-Authorization-Type was received in the request, and if the value is
> REGISTRATION_AND_CAPABILITIES:
\- If it is, then the HSS may return the Server-Capabilities AVP. The returned
capabilities, if any, shall satisfy all the requirements of all the service
profiles associated with the IMS Subscription. If Server-Capabilities AVP is
absent, it indicates to the I-CSCF that it can select any available S-CSCF.
Also the HSS shall set the S-CSCF reassignment pending flag and allow
overwriting of the S-CSCF name in the next SAR request, which enables the
I-CSCF to select an S-CSCF. The Result-Code shall be set to DIAMETER_SUCCESS.
The HSS shall not return any S-CSCF name. Stop processing.
\- Otherwise, continue to step 3.
3\. Check the state of the Public Identity received in the request, and where
necessary, check if the Public Identity has terminating services related to
the unregistered state.
\- If it is registered, the HSS shall return the stored S-CSCF name. The
Server-Name AVP shall contain the SIP URI of the server. The Server-
Capabilities AVP shall not be present. The Result-Code AVP shall be set to
DIAMETER_SUCCESS.
\- If it is unregistered (i.e. registered as a consequence of an originating
or terminating request or there is a S-CSCF keeping the user profile stored)
the HSS shall return the S-CSCF name assigned for that Public Identity. The
Server-Name AVP shall contain the SIP URI of the server. The Server-
Capabilities AVP shall not be present. The Result-Code shall be set to
DIAMETER_SUCCESS.
\- If it is not registered, but either it has terminating services related to
unregistered state or the request contains the Originating-Request AVP, the
HSS shall check if there is at least one Public Identity within the IMS
Subscription with an S-CSCF name assigned:
> \- If this is the case the HSS shall return the S-CSCF name assigned for
> that Public Identity. The Server-Name AVP shall contain the SIP URI of the
> server. The Server-Capabilities AVP shall not be present. The Result-Code
> shall be set to DIAMETER_SUCCESS.
\- If there is not any S-CSCF name assigned to a Public Identity within the
IMS Subscription, the HSS may return information about the required S-CSCF
capabilities, which enables the I-CSCF to select an S-CSCF. The Server-
Capabilities AVP may be present. The HSS shall send the same server capability
set that is sent in the user registration status response during the
registration. If Server-Capabilities AVP is not present, the I-CSCF shall
understand that any S-CSCF is suitable for the IMS Subscription. The Server-
Name AVP shall not be present. The Experimental-Result-Code shall be set to
DIAMETER_UNREGISTERED_SERVICE.
\- If it is not registered or unregistered, and the Public Identity has no
terminating services related to the unregistered state and the request does
not contain the Originating-Request AVP, the response shall contain
Experimental-Result-Code set to DIAMETER_ERROR_IDENTITY_NOT_REGISTERED.
If the HSS cannot fulfil the received request, e.g. due to database error, it
shall set Result-Code to DIAMETER_UNABLE_TO_COMPLY. No S-CSCF name or S-CSCF
capabilities shall be present in the response.
## 6.2 User data handling procedures
### 6.2.1 User Profile download
As part of the registration procedure (3GPP TS 23.228 [1]) S-CSCF obtains user
data and service related information by means of the Cx-Put Resp operation
(see 6.1.2).
### 6.2.2 HSS initiated update of User Information
This procedure is initiated by the HSS to update at least one of the following
user information in S-CSCF:
\- User profile information and/or
\- Charging information and/or
\- Allowed WAF and/or WWSF Identities and/or
\- SIP Digest authentication information in the S-CSCF.
This procedure shall not be used by the HSS to add, delete, or update the
value of the IMSI.
This procedure corresponds to the functional level operation Cx-
Update_Subscr_Data (see 3GPP TS 23.228 [1]).
This procedure is mapped to the commands Push-Profile-Request/Answer in the
Diameter application specified in 3GPP TS 29.229 [5]. Tables 6.2.2.1 and
6.2.2.2 describe the involved information elements.
Table 6.2.2.1: User Profile Update request
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | Private User | User-Name | M | Private Identity. | | Identity / | | | | | Private Service | | | The HSS shall | | Identity | | | always send a | | | | | Private Identity | | (See 7.3 and | | | that is known to | | 7.3a) | | | the S-CSCF based | | | | | on an earlier | | | | | SAR/SAA | | | | | procedure. | +-------------------+-------------------+------+-------------------+ | User profile | User-Data | C | Updated user | | | | | profile (see | | (See 7.7) | | | sections 6.5.2.1 | | | | | and 6.6.1), with | | | | | the format | | | | | defined in | | | | | chapter 7.7. | | | | | | | | | | It shall be | | | | | present if the | | | | | user profile is | | | | | changed in the | | | | | HSS. If the | | | | | User-Data AVP is | | | | | not present, the | | | | | S | | | | | IP-Auth-Data-Item | | | | | or | | | | | Cha | | | | | rging-Information | | | | | AVP or | | | | | Allowed-WA | | | | | F-WWSF-Identities | | | | | AVP shall be | | | | | present. | +-------------------+-------------------+------+-------------------+ | Authentication | S | C | SIP Digest | | Data (See 7.9) | IP-Auth-Data-Item | | authentication | | | | | information. | | | | | | | | | | It shall be | | | | | present if the | | | | | used | | | | | authentication | | | | | scheme is SIP | | | | | Digest and when | | | | | password change | | | | | has occurred in | | | | | the HSS. | | | | | | | | | | If the | | | | | S | | | | | IP-Auth-Data-Item | | | | | AVP is not | | | | | present, the | | | | | Cha | | | | | rging-Information | | | | | or User-Data AVP | | | | | or | | | | | Allowed-WA | | | | | F-WWSF-Identities | | | | | AVP shall be | | | | | present. | | | | | | | | | | See Table 6.3.6 | | | | | for the contents | | | | | of this | | | | | information | | | | | element. | +-------------------+-------------------+------+-------------------+ | Charging | Cha | C | Addresses of the | | Information (See | rging-Information | | charging | | 7.12) | | | functions. | | | | | | | | | | It shall be | | | | | present if the | | | | | charging | | | | | addresses are | | | | | changed in the | | | | | HSS. If the | | | | | Cha | | | | | rging-Information | | | | | AVP is not | | | | | present, the | | | | | S | | | | | IP-Auth-Data-Item | | | | | or User-Data AVP | | | | | or | | | | | Allowed-WA | | | | | F-WWSF-Identities | | | | | AVP shall be | | | | | present. | | | | | | | | | | When this | | | | | parameter is | | | | | included, either | | | | | the | | | | | Primary | | | | | -Charging-Collect | | | | | ion-Function-Name | | | | | AVP or the | | | | | Pr | | | | | imary-Event-Charg | | | | | ing-Function-Name | | | | | AVP shall be | | | | | included. All | | | | | other charging | | | | | information shall | | | | | be included if it | | | | | is available. | +-------------------+-------------------+------+-------------------+ | Routing | Destination-Host | M | It contains the | | Information (See | | | name of the | | 7.13) | | | S-CSCF which | | | | | originated the | | | | | last update of | | | | | the name of the | | | | | multimedia server | | | | | stored in the HSS | | | | | for a given IMS | | | | | Subscription. The | | | | | address of the | | | | | S-CSCF is the | | | | | same as the | | | | | Origin-Host AVP | | | | | in the message | | | | | sent from the | | | | | S-CSCF. | +-------------------+-------------------+------+-------------------+ | Allowed WAF | Allowed-WA | C | Addresses of the | | and/or WWSF | F-WWSF-Identities | | WAFs and/or WWSFs | | Identities (See | | | the subscription | | 7.29) | | | is allowing to | | | | | use. | | | | | | | | | | It shall be | | | | | present if the | | | | | allowed WAF | | | | | and/or WWSF | | | | | identities are | | | | | changed in the | | | | | HSS. | +-------------------+-------------------+------+-------------------+
Table 6.2.2.2: User Profile Update response
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | Result | Result-Code / | M | This information | | | Ex | | element indicates | | (See 7.6) | perimental-Result | | the result of the | | | | | update of User | | | | | Profile in the | | | | | S-CSCF. | | | | | | | | | | Result-Code AVP | | | | | shall be used for | | | | | errors defined in | | | | | the Diameter Base | | | | | Protocol. | | | | | | | | | | Ex | | | | | perimental-Result | | | | | AVP shall be used | | | | | for Cx/Dx errors. | | | | | This is a grouped | | | | | AVP which | | | | | contains the 3GPP | | | | | Vendor ID in the | | | | | Vendor-Id AVP, | | | | | and the error | | | | | code in the | | | | | Experim | | | | | ental-Result-Code | | | | | AVP. | +-------------------+-------------------+------+-------------------+
#### 6.2.2.1 Detailed behaviour
The HSS shall make use of this procedure to update the relevant user
information to the S-CSCF. See chapters 6.5.2.1 and 6.6.1 for the rules of
user profile updating. See chapter 6.5.2.3 for the rules of Charging
Information update. See chapter 6.5.2.4 for the rules of SIP Digest
Authentication Data update. See chapter 6.5.2.5 for the rules of Allowed WAF
and/or WWSF Identities update.
If there are multiple registered Private User Identities associated to the
Public User Identity in the HSS, the HSS shall send only single request and
select arbitrarily one of the Private User Identities and put it into the
request. For updates of the profile of a Wildcarded Public Identity, the HSS
shall send only one single request. That request shall contain the Wildcarded
Public Identity.
The SIP-Auth-Data-Item AVP and/or Charging-Information AVP and/or the User-
Data AVP shall be present in the request.
If the User-Data AVP is present in the request, the S-CSCF shall overwrite,
for the Public Identities indicated in the User profile included in the
request, current information with the information received from the HSS,
except in the error situations detailed in table 6.2.2.1.1.
If the Charging-Information AVP is present in the request, the S-CSCF shall
replace the existing charging information with the information received from
the HSS.
The SIP-Auth-Data-Item AVP shall be present if the command is sent in order to
update SIP Digest authentication information due to a password change.
If the S-CSCF receives data that it can not recognise, unsupported user data
in a part of the request where it may not be ignored or more data than it can
accept, it shall return the corresponding error code to the HSS as indicated
in table 6.2.2.1.1. The S-CSCF shall not overwrite the data that it already
has to give service to the IMS Subscription. The HSS shall initiate a network-
initiated de-registration procedure towards the S-CSCF with Deregistration-
Reason set to SERVER_CHANGE, which will trigger the assignment of a new
S-CSCF.
If the HSS receives DIAMETER_ERROR_USER_UNKNOWN from the S-CSCF in the Push-
Profile-Answer, then the HSS shall re-send the request using another
arbitrarily selected registered Private Identity (if any). If restoration
procedures are not supported, the HSS shall set the unknown Private User
Identity\'s registration status to \"not registered\"; this will allow the
synchronization of the registration status in HSS and S-CSCF.
NOTE: If restoration procedures are supported, restoration procedures will
ensure synchronization of the registration status in HSS and S-CSCF, i.e. the
S-CSCF can either immediately retrieve the S-CSCF restoration information for
the registered Public User Identity (sending SAR with Server Assignment Type
set to NO_ASSIGNMENT), or wait for reception of a SIP request.
Table 6.2.2.1.1 details the valid result codes that the S-CSCF can return in
the response.
Table 6.2.2.1.1: User information update response valid result codes
* * *
Result-Code AVP value Condition DIAMETER_SUCCESS The request succeeded.
DIAMETER_ERROR_NOT_SUPPORTED_USER_DATA The request failed. The S-CSCF informs
the HSS that the received user information contained information, which was
not recognised or supported by the S-CSCF due to unsupported S-CSCF
capabilities. DIAMETER_ERROR_USER_UNKNOWN The request failed because the
Private Identity is not found in S-CSCF. DIAMETER_ERROR_TOO_MUCH_DATA The
request failed. The S-CSCF informs to the HSS that it tried to push too much
data into the S-CSCF. DIAMETER_UNABLE_TO_COMPLY The request failed.
* * *
## 6.3 Authentication procedures
This procedure is used between the S-CSCF and the HSS to exchange information
to support the authentication between the end user and the home IMS network.
The procedure is invoked by the S-CSCF, corresponds to the combination of the
operations Cx-AV-Req and Cx-AV-Req-Resp (see 3GPP TS 33.203 [3]) and is used:
\- To retrieve authentication vectors from the HSS.
\- To resolve synchronization failures between the sequence numbers in the UE
and the HSS for authentication schemes that support this capability (e.g. IMS-
AKA).
\- To promote the result of the NASS-level authentication to the IMS level.
> \- To [ ]{.underline} retrieve the IP-address secure binding information for
> GPRS-IMS-Bundled Authentication (GIBA) from the HSS.
This procedure is mapped to the commands Multimedia-Auth-Request/Answer in the
Diameter application specified in 3GPP TS 29.229 [5]. Tables 6.3.1 through
6.3.7 detail the involved information elements.
Table 6.3.1: Authentication Request
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | Public User | Public-Identity | M | This information | | Identity | | | element contains | | | | | the Distinct | | (See 7.2) | | | Public User | | | | | Identity of the | | | | | user | +-------------------+-------------------+------+-------------------+ | Private User | User-Name | M | This information | | Identity | | | element contains | | | | | the Private User | | (See 7.3) | | | Identity | +-------------------+-------------------+------+-------------------+ | Number | SIP- | M | This information | | Authentication | Number-Auth-Items | | element indicates | | Items | | | the number of | | | | | authentication | | (See 7.10) | | | vectors | | | | | requested. | | | | | Certain | | | | | authentication | | | | | schemes do not | | | | | support more than | | | | | one set of | | | | | authentication | | | | | vectors (e.g. SIP | | | | | Digest, GIBA). | +-------------------+-------------------+------+-------------------+ | Authentication | S | M | See Table 6.3.2 | | Data | IP-Auth-Data-Item | | for the contents | | | | | of this | | (See 7.9) | | | information | | | | | element. | +-------------------+-------------------+------+-------------------+ | S-CSCF Name | Server-Name | M | This information | | | | | element contains | | (See 7.4) | | | the name (SIP | | | | | URL) of the | | | | | S-CSCF. | +-------------------+-------------------+------+-------------------+ | Routing | Destination-Host | C | If the S-CSCF | | Information (See | | | knows the HSS | | 7.13) | | | name this AVP | | | | | shall be present. | | | | | | | | | | This information | | | | | is available if | | | | | the MAR belongs | | | | | to an already | | | | | existing | | | | | registration, | | | | | e.g. in case of | | | | | the | | | | | re-registration, | | | | | where the HSS | | | | | name is stored in | | | | | the S-CSCF. The | | | | | HSS name is | | | | | obtained from the | | | | | Origin-Host AVP, | | | | | which is received | | | | | from the HSS, | | | | | e.g. included in | | | | | the MAA command. | | | | | | | | | | This information | | | | | may not be | | | | | available if the | | | | | command is sent | | | | | in case of the | | | | | initial | | | | | registration. In | | | | | this case the | | | | | Destination-Host | | | | | AVP is not | | | | | present and the | | | | | command is routed | | | | | to the next | | | | | Diameter node, | | | | | e.g. SLF, based | | | | | on the Diameter | | | | | routing table in | | | | | the client. | +-------------------+-------------------+------+-------------------+
Table 6.3.2: Authentication Data content in Authentication Request
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | Authentication | SIP-Auth | M | This information | | Scheme | entication-Scheme | | element indicates | | | | | the | | (See 7.9.2) | | | authentication | | | | | scheme. | | | | | | | | | | See 3GPP TS | | | | | 29.229 [5] for | | | | | a list of values | +-------------------+-------------------+------+-------------------+ | Authentication | SIP-Authe | C | This information | | Context | ntication-Context | | element shall | | | | | contain | | (See 7.9.7) | | | authe | | | | | ntication-related | | | | | information | | | | | relevant for | | | | | performing the | | | | | authentication. | | | | | | | | | | It shall be | | | | | absent for | | | | | IMS-AKA | | | | | authentication | | | | | schemes. | +-------------------+-------------------+------+-------------------+ | Authorization | SIP-Authorization | C | This information | | Information | | | element shall | | | | | only be present | | (See 7.9.4) | | | for a request due | | | | | to an IMS-AKA | | | | | synchronization | | | | | failure. | | | | | | | | | | If present, only | | | | | IMS-AKA | | | | | authentication | | | | | schemes are | | | | | allowed. | +-------------------+-------------------+------+-------------------+
Table 6.3.3: Void
Table 6.3.4: Authentication Request Response
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | User Identity | Public-Identity | C | Public User | | | | | Identity. It | | (See 7.2) | | | shall be present | | | | | when the result | | | | | is | | | | | D | | | | | IAMETER_SUCCESS. | +-------------------+-------------------+------+-------------------+ | Private User | User-Name | C | Private User | | Identity | | | Identity. It | | | | | shall be present | | (See 7.3) | | | when the result | | | | | is | | | | | D | | | | | IAMETER_SUCCESS. | +-------------------+-------------------+------+-------------------+ | Number | SIP- | C | This information | | Authentication | Number-Auth-Items | | element indicates | | Items | | | the number of | | | | | authentication | | (See 7.10) | | | vectors delivered | | | | | in the | | | | | Authentication | | | | | Data information | | | | | element. | | | | | | | | | | It shall be | | | | | present when the | | | | | result is | | | | | D | | | | | IAMETER_SUCCESS. | | | | | | | | | | For SIP Digest, | | | | | NASS Bundled | | | | | authentication | | | | | and GIBA this AVP | | | | | shall be set to a | | | | | value of 1. | +-------------------+-------------------+------+-------------------+ | Authentication | S | C | If the | | Data | IP-Auth-Data-Item | | SIP- | | | | | Number-Auth-Items | | (See 7.9) | | | AVP is equal to | | | | | zero or it is not | | | | | present, then | | | | | this information | | | | | element shall not | | | | | be present. | | | | | | | | | | See Table 6.3.5 | | | | | for the contents | | | | | of this | | | | | information | | | | | element. | +-------------------+-------------------+------+-------------------+ | Result | Result-Code / | M | This information | | | Ex | | element indicates | | (See 7.6) | perimental-Result | | the result of the | | | | | operation. | | | | | | | | | | It shall be | | | | | mapped to | | | | | Result-Code AVP | | | | | for errors | | | | | defined in the | | | | | Diameter Base | | | | | Protocol. | | | | | | | | | | It shall be | | | | | mapped to | | | | | Ex | | | | | perimental-Result | | | | | AVP for Cx/Dx | | | | | errors. | | | | | | | | | | This information | | | | | element is mapped | | | | | to a grouped AVP | | | | | which contains | | | | | the 3GPP Vendor | | | | | ID in the | | | | | Vendor-Id AVP, | | | | | and the error | | | | | code in the | | | | | Experim | | | | | ental-Result-Code | | | | | AVP. | +-------------------+-------------------+------+-------------------+
Table 6.3.5: Authentication Data information element content in Authentication
Request Response
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | Item Number | SIP-Item-Number | C | This information | | | | | element shall | | (See 7.9.1) | | | only be present | | | | | for IMS-AKA | | | | | authentication | | | | | schemes. | | | | | | | | | | This information | | | | | element shall be | | | | | present when | | | | | there are | | | | | multiple | | | | | occurrences of | | | | | the | | | | | Authentication | | | | | Data information | | | | | element in the | | | | | Authentication | | | | | Request Response, | | | | | and the order in | | | | | which they should | | | | | be processed is | | | | | significant. | | | | | | | | | | In this scenario, | | | | | Authentication | | | | | Data information | | | | | elements with a | | | | | low Item Number | | | | | information | | | | | element value | | | | | should be | | | | | processed before | | | | | Authentication | | | | | Data information | | | | | elements with a | | | | | high Item Number | | | | | information | | | | | element value. | +-------------------+-------------------+------+-------------------+ | Authentication | SIP-Auth | M | This information | | Scheme | entication-Scheme | | element indicates | | | | | the | | (See 7.9.2) | | | authentication | | | | | scheme. | +-------------------+-------------------+------+-------------------+ | Authentication | SIP-Authenticate | C | This information | | Information | | | element shall | | | | | only be present | | (See 7.9.3) | | | for IMS-AKA | | | | | authentication | | | | | schemes. | +-------------------+-------------------+------+-------------------+ | Authorization | SIP-Authorization | C | This information | | Information | | | element shall | | | | | only be present | | (See 7.9.4) | | | for IMS-AKA | | | | | authentication | | | | | schemes. | +-------------------+-------------------+------+-------------------+ | Confidentiality | Co | C | This information | | Key | nfidentiality-Key | | element shall be | | | | | present for IMS | | (See 7.9.5) | | | AKA | | | | | authentication | | | | | schemes. | | | | | | | | | | It shall contain | | | | | the | | | | | confidentiality | | | | | key. | +-------------------+-------------------+------+-------------------+ | Integrity Key | Integrity-Key | C | This information | | | | | element shall | | (See 7.9.6) | | | only be present | | | | | for IMS-AKA | | | | | authentication | | | | | schemes. | | | | | | | | | | This information | | | | | element shall | | | | | contain the | | | | | integrity key. | +-------------------+-------------------+------+-------------------+ | Digest | SIP-Di | C | This information | | Authenticate | gest-Authenticate | | element shall | | | | | only be present | | (See 7.9.8) | | | for SIP Digest | | | | | authentication | | | | | scheme. | | | | | | | | | | See Table 6.3.7 | | | | | for contents of | | | | | this grouped AVP. | +-------------------+-------------------+------+-------------------+ | Line Identifier | Line-Identifier | C | This information | | | | | element shall | | (See 7.9.9) | | | only be present | | | | | for NASS Bundled | | | | | authentication | | | | | scheme. | | | | | | | | | | This information | | | | | element contains | | | | | fixed broadband | | | | | access line | | | | | identifier | | | | | associated to the | | | | | user. This | | | | | information | | | | | element can be | | | | | repeated. | +-------------------+-------------------+------+-------------------+ | Framed IP Address | Framed-IP-Address | C | This information | | | | | element shall | | (See 7.9.10) | | | only be present | | | | | for | | | | | GPRS-IMS-Bundled | | | | | authentication | | | | | scheme. | | | | | | | | | | If the IP Address | | | | | of the User is an | | | | | IPv4 address, | | | | | this AVP shall be | | | | | included. | +-------------------+-------------------+------+-------------------+ | Framed IPv6 | F | C | This information | | Prefix | ramed-IPv6-Prefix | | element shall | | | | | only be present | | (See 7.9.11) | | | for | | | | | GPRS-IMS-Bundled | | | | | authentication | | | | | scheme. | | | | | | | | | | If the IP Address | | | | | of the User is an | | | | | IPv6 address, | | | | | this AVP shall be | | | | | included. | +-------------------+-------------------+------+-------------------+ | Framed Interface | Fr | C | This information | | Id | amed-Interface-Id | | element shall | | | | | only be present | | (See 7.9.12) | | | for | | | | | GPRS-IMS-Bundled | | | | | authentication | | | | | scheme. | | | | | | | | | | If and only if | | | | | the IP Address of | | | | | the User is an | | | | | IPv6 address and | | | | | the | | | | | F | | | | | ramed-IPv6-Prefix | | | | | AVP alone is not | | | | | unique for the | | | | | user this AVP | | | | | shall be | | | | | included. | +-------------------+-------------------+------+-------------------+
Table 6.3.6: Void
Table 6.3.7: Digest Authenticate information element content -- Response for
SIP Digest
+-------------------+-------------------+------+-------------------+ | Information | Mapping to | Cat. | Description | | element name | Diameter AVP | | | +-------------------+-------------------+------+-------------------+ | Digest Realm | Digest-Realm | M | This information | | | | | element | | (See 7.9.8.1) | | | corresponds to | | | | | the Realm | | | | | parameter as | | | | | defined in IETF | | | | | RFC 2617 [16]. | +-------------------+-------------------+------+-------------------+ | Digest Algorithm | Digest-Algorithm | O | This information | | | | | element contains | | (See 7.9.8.3) | | | the algorithm as | | | | | defined in IETF | | | | | RFC 2617 [16]. | | | | | | | | | | If this | | | | | information | | | | | element is not | | | | | present, then | | | | | \"MD5\" is | | | | | assumed. | | | | | | | | | | If this | | | | | information | | | | | element is | | | | | present it shall | | | | | contain \"MD5\". | +-------------------+-------------------+------+-------------------+ | Digest QoP | Digest-QoP | M | This information | | | | | element contains | | (See 7.9.8.4) | | | the QoP as | | | | | defined in IETF | | | | | RFC 2617 [16]. | | | | | This information | | | | | element shall be | | | | | set to a value of | | | | | \"auth\" by the | | | | | HSS. | +-------------------+-------------------+------+-------------------+ | Digest HA1 | Digest-HA1 | M | This information | | | | | element contains | | (See 7.9.8.5) | | | the H(A1) as | | | | | defined in IETF | | | | | RFC 2617 [16]. | +-------------------+-------------------+------+-------------------+
Table 6.3.8: Void
Table 6.3.9: Void
### 6.3.1 Detailed behaviour
The HSS shall, in the following order (in case of an error in any of the steps
the HSS shall stop processing and return the corresponding error code, see
3GPP TS 29.229 [5]):
1\. Check that the Private User Identity and the Public User Identity exist in
the HSS. If not Experimental-Result-Code shall be set to
DIAMETER_ERROR_USER_UNKNOWN.
2\. Check that the Public User Identity matches a distinct Public User
Identity in the HSS. If it doesn't, the Experimental-Result-Code shall be set
to DIAMETER_ERROR_USER_UNKNOWN.
3\. Check whether the Private and Public User Identities in the request are
associated in the HSS. If not Experimental-Result-Code shall be set to
DIAMETER_ERROR_IDENTITIES_DONT_MATCH.
4\. Check the authentication scheme indicated in the request, and
\- if it is \"Unknown\", check the authentication scheme stored in HSS. If it
is neither NASS-Bundled authentication nor SIP Digest authentication,
Experimental-Result-Code shall be set to
DIAMETER_ERROR_AUTH_SCHEME_NOT_SUPPORTED.
\- if not, check that the authentication scheme indicated in the request is
supported. If not Experimental-Result-Code shall be set to
DIAMETER_ERROR_AUTH_SCHEME_NOT_SUPPORTED.
This step is only applicable for IMS-AKA authentication. If the request
indicates there is a synchronization failure, the HSS shall compare the S-CSCF
name received in the request to the S-CSCF name stored in the HSS:
\- If they are identical the HSS shall process AUTS as described in 3GPP TS
33.203 [3] and return the requested authentication information. The Result-
Code shall be set to DIAMETER_SUCCESS.
5\. Check the registration status of the Public User Identity received in the
request:
\- If it is registered, the HSS shall compare the S-CSCF name received in the
request to the S-CSCF name stored in the HSS:
\- If they are different, the HSS shall overwrite the S-CSCF name. If IMS
restoration procedures are supported and the S-CSCF reassignment pending flag
is set, the HSS shall reset the flag and keep the S-CSCF restoration
information associated with the Public User Identity. The HSS shall download
SIP-Auth-Data-Item stored up to a maximum specified in SIP-Number-Auth-Items
received in the command Multimedia-Auth-Request. If authentication scheme is
neither NASS-Bundled nor GIBA, the HSS shall set the Public User Identity's
authentication pending flag which is specific to the Private User Identity
received in the request. The Result-Code shall be set to DIAMETER_SUCCESS.
\- If they are identical, the HSS shall download SIP-Auth-Data-Item stored up
to a maximum specified in SIP-Number-Auth-Items received in the command
Multimedia-Auth-Request. The Result-Code shall be set to DIAMETER_SUCCESS.
\- If it is unregistered (i.e. registered as a consequence of an originating
or terminating request or there is an S-CSCF keeping the user profile stored)
or not registered, the HSS shall compare the S-CSCF name received in the
request to the S-CSCF name stored in the HSS:
\- If they are different or if there is no S-CSCF name stored in the HSS for
any Public User Identity of the IMS subscription, the HSS shall store the
S-CSCF name. The HSS shall download SIP-Auth-Data-Item stored up to a maximum
specified in SIP-Number-Auth-Items received in the command Multimedia-Auth-
Request. If authentication scheme is neither NASS-Bundled nor GIBA, the HSS
shall set the Public User Identity's authentication pending flag which is
specific to the Private User Identity which was received in the request. The
Result-Code shall be set to DIAMETER_SUCCESS.
> \- If they are identical, the HSS shall download SIP-Auth-Data-Item stored
> up to a maximum specified in SIP-Number-Auth-Items received in the command
> Multimedia-Auth-Request. If authentication scheme is neither NASS-Bundled
> nor GIBA, the HSS shall set the Public User Identity's authentication
> pending flag which is specific to the Private User Identity that was
> received in the request. The Result-Code shall be set to DIAMETER_SUCCESS.
Exceptions to the cases specified here shall be treated by HSS as error
situations, the Result-Code shall be set to DIAMETER_UNABLE_TO_COMPLY. No
authentication information shall be returned.
## 6.4 User identity to HSS resolution
The User identity to HSS resolution mechanism enables the I-CSCF and the
S-CSCF to find the identity of the HSS, that holds the subscriber data for a
given Public Identity when multiple and separately addressable HSSs have been
deployed by the network operator. The resolution mechanism is not required in
networks that utilise a single HSS. An example for a single HSS solution is
server farm architecture.
The resolution mechanism described in 3GPP TS 23.228 [1] shall use a
Subscription Locator Function (SLF) or a Diameter Proxy Agent.
The I-CSCF and the S-CSCF accesses the SLF via the Dx interface. The Dx
interface shall always be used in conjunction with the Cx interface. The Dx
interface shall be based on Diameter. The SLF functionality shall use the
routing mechanism provided by an enhanced Diameter redirect agent.
The SLF or the Diameter Proxy Agent shall be able to determine the HSS
identity.
To get the HSS identity the I-CSCF and the S-CSCF shall send the Cx request
normally destined to the HSS to a pre-configured Diameter address/name.
\- If this Cx Request is received by an SLF (acting as a Diameter redirect
agent), the SLF shall determine the HSS identity and sends to the I-CSCF or
S-CSCF a notification of redirection towards the HSS identity, in response to
the Cx request. Multiple HSS identities may be included in the response, as
specified in IETF RFC 3588 [9]. In such a case, the I-CSCF or the S-CSCF shall
send the Cx Request to the first HSS identity in the ordered list received in
the Cx Response from the SLF. If the I-CSCF or S-CSCF does not receive a
successful response to the Cx Request, the I-CSCF or S-CSCF shall send a Cx
Request to the next HSS identity in the ordered list. This procedure shall be
repeated until a successful response from an HSS is received.
\- If this Cx Request is received by the Diameter Proxy Agent, the Diameter
Proxy Agent shall determine the HSS identity and shall forward the Cx request
directly to the HSS. The I-CSCF and S-CSCF shall determine the HSS identity
from the response to the Cx request received from the HSS.
While the I-CSCF is stateless, the S-CSCF shall store the HSS
identity/name/Realm, as specified in 3GPP TS 23.228 [1] and shall use it in
further Cx requests associated to the same IMS Public Identity.
In networks where the use of the user identity to HSS resolution mechanism is
required, each I-CSCF and S-CSCF shall be configured with the address/name of
the SLF or the Diameter Proxy Agent to enable use of these resolution
mechanisms.
## 6.5 Implicit registration
Implicit registration is the mechanism by which a user is allowed to register
simultaneously more than one of his/her Public User Identities. The HSS knows
the identities that are to be implicitly registered when it receives the
indication of the registration of an individual identity.
What follows is an extension of the affected basic procedures.
### 6.5.1 S-CSCF initiated procedures
The result of the S-CSCF initiated procedures affects all the Public User
Identities that are configured in the HSS to be in the same implicitly
registered Public User Identity set with the targeted individual Public User
Identity. Where the S-CSCF initiated procedure affects the Registration state
of the targeted Public User Identity, the Registration states of the Public
User Identities in the associated implicitly registered Public User Identity
set are affected in the same way.
#### 6.5.1.1 Registration
The notification of a registration of a Public User Identity implies the
registration of the corresponding implicitly registered Public User Identity
set. The user information downloaded in the response contains the Public User
Identities of the implicitly registered Public User Identity set with the
associated service profiles. This allows the S-CSCF to know which Public User
Identities belong to the implicitly registered Public User Identity set. The
S-CSCF shall take from the set of implicitly registered Public User Identities
the first identity which is not barred, and use this as the default Public
User Identity. The default Public User Identity shall be a distinct Public
User Identity.
#### 6.5.1.2 De-registration
The de-registration of a Public User Identity implies the de-registration of
the corresponding implicitly registered Public User Identity set, both in the
HSS and in the S-CSCF. The S-CSCF shall include in the request a single Public
User Identity to deregister all the Public User Identities that belong to the
corresponding implicitly registered Public User Identity set.
The de-registration of a Private User Identity implies the de-registration of
all the corresponding Public User Identities, both in the HSS and in the
S-CSCF.
#### 6.5.1.3 Authentication
Setting the authentication pending flag for a Public User Identity implies
setting the authentication pending flag for each corresponding implicitly
registered Public User Identity in the HSS.
#### 6.5.1.4 Downloading the user profile
If the S-CSCF requests to download a user profile from HSS, the user profile
in the response shall contain the Public User Identities of the corresponding
implicitly registered Public User Identity set with the associated service
profiles.
#### 6.5.1.5 Initiation of a session to a non-registered user
The change of a Public User Identity to the Unregistered state due to the
initiation of a session from/to a Public Identity that was in Not Registered
state and the opposite change from Unregistered state to Not Registered state
implies the same change for all the Public User Identities in the same
Implicit Registration Set.
### 6.5.2 HSS initiated procedures
#### 6.5.2.1 Update of User Profile
A request sent by the HSS to update the user profile shall include only the
Public User Identities of the implicitly registered Public User Identity set,
with the associated service profiles (even if not updated). If other Public
User Identities not associated with the implicitly registered Public User
Identity set are affected, they shall be downloaded in separate commands.
This procedure shall be used by the HSS to add a newly provisioned or Not
Registered Public User Identity or Identities to an existing implicitly
registered Public User Identity set that is in the state Registered or
Unregistered. The added Public User Identity gets the registration state of
the set it is added to.
The HSS shall use this procedure if a Public User Identity or Identities are
removed from the implicitly registered Public User Identity set that is in a
state Registered or Unregistered. In practise, this is done by sending a PPR
for the set without the removed identities. The S-CSCF shall remove all
information stored in the S-CSCF for the removed identities.
The HSS shall not use this procedure if there is no Public User Identities
left in the implicitly registered Public User Identity set after the removal.
In that case HSS shall use the RTR command instead.
The HSS shall not use this procedure to change the default Public User
Identity of the implicitly registered Public User Identity set that is in a
state Registered. In that case the HSS shall use the RTR command to de-
register the Public User Identity set.
Moving of a Public User Identity or Identities from one implicitly registered
Public User Identity set to another set shall be done in two steps: First the
identity or identities are removed from the \"old\" set as described above,
then the identity or identities are added to the \"new\" set as described
above.
#### 6.5.2.2 De-registration
A request sent by the HSS to de-register any of the identities included in an
implicitly registered Public User Identity set shall affect all the Public
User Identities of the deregistered set.
The de-registration of a Private User Identity implies the de-registration of
all the corresponding Public User Identities, both in the HSS and in the
S-CSCF.
#### 6.5.2.3 Update of the Charging information
A request sent by the HSS to update the charging information shall include the
Private User Identity for whom the charging information changed.
If corresponding Public Identity is registered or unregistered (i.e.
registered as a consequence of an originating or terminating request or there
is a S-CSCF keeping the user profile stored) and charging information is
changed, the HSS should immediately push this information to the S-CSCF.
#### 6.5.2.4 Update of the SIP Digest Authentication Data
A request sent by the HSS to update the authentication data shall include the
Private User Identity for whom the authentication data changed.
If corresponding Public Identity is registered and authentication data is
changed, the HSS should immediately push this information to the S-CSCF.
If corresponding Public Identity is either not registered or unregistered
(i.e. registered as a consequence of an originating or terminating request or
there is a S-CSCF keeping the user profile stored), authentication pending
flag is set and authentication data is changed, the HSS should immediately
push this information to the S-CSCF.
#### 6.5.2.5 Update of the Allowed WAF and/or WWSF Identities
A request sent by the HSS to update the WAF and/or WWSF identities allowed for
the subscription shall include the Private User Identity for whom this
information changed.
If corresponding Public Identity is registered and allowed WAF and/or WWSF
identities are changed, the HSS should immediately push this information to
the S-CSCF.
## 6.6 Download of the Relevant User Profile and Charging Information and
Allowed WAF and/or WWSF Identities
The download of the relevant user profile, charging information and, if
supported and part of subscription, allowed WAF and/or WWSF identities from
the HSS to the S-CSCF depends on whether the user profile, charging
information and, if supported and part of subscription, allowed WAF and/or
WWSF identities are already stored in the S-CSCF. If the SiFC feature is
supported by the HSS and S-CSCF, the HSS shall download the identifiers of the
shared iFC sets. If either the HSS or the S-CSCF does not support the SiFC
feature, the HSS shall download the complete iFCs, and SiFC identifiers shall
not be downloaded by the HSS. The SiFC feature is defined in 3GPP TS 29.229
[5].
If User-Data-Already-Available is set to USER_DATA_NOT_AVAILABLE the HSS shall
download the requested user profile, charging information and, if supported
and part of subscription, allowed WAF and/or WWSF identities. If the Public
User Identity in the request is included in an implicitly registered Public
User Identity set, the HSS shall include in the response the service profiles
associated with all Public User Identities within the implicitly registered
Public User Identity set to which the received Public User Identity belongs.
If User-Data-Already-Available is set to USER_DATA_ALREADY_AVAILABLE, the HSS
should not return any user profile or charging information data or allowed WAF
and/or WWSF identities. The HSS may override User-Data-Already-Available set
to USER_DATA_ALREADY_AVAILABLE and download the user profile, charging
information and, if supported and part of subscription, allowed WAF and/or
WWSF identities.
## 6.6.1 HSS initiated update of User Profile
The request to update the user profile in the S-CSCF includes only the Public
User Identities of the implicitly registered Public User Identity set with the
associated service profiles. See 6.5.2.1.
If the Public Identity is registered or unregistered (i.e. registered as a
consequence of an originating or terminating request or there is a S-CSCF
keeping the user profile stored) and there are changes in the user profile,
the HSS should immediately push the complete user profile to the S-CSCF.
### 6.6.2 S-CSCF operation
At deregistration of a Public User Identity, the S-CSCF shall store the user
information if it sends Server-Assignment-Request command including Server-
Assignment-Type AVP set to value USER_DEREGISTRATION_STORE_SERVER_NAME or
TIMEOUT_DEREGISTRATION_STORE_SERVER_NAME and the HSS responds with
DIAMETER_SUCCESS. Otherwise the S-CSCF shall not keep user information.
## 6.7 S-CSCF Assignment
The list of mandatory and optional capabilities received by an I-CSCF from the
HSS allows operators to distribute users between S-CSCFs, depending on the
different capabilities (e.g. features, role, geographical location) that each
S-CSCF may have. Alternatively, an operator has the possibility to steer users
to certain S-CSCFs.
The operator shall define (possibly based on the functionality offered by each
S-CSCF installed in the network) the exact meaning of the S-CSCF mandatory and
optional capabilities available in his network. It is an operator task to
allocate a unique value to represent a single capability (e.g. support of
\"wildcarded PSI\") or a set of capabilities (e.g. support of \"alias\" and
\"Shared IFC sets\" and \"wildcarded PSI\") and to use these values to
identify capabilities that are mandatory and/or optional to support for a
given subscription. It is a configuration task for the operator to ensure that
the I-CSCF has a correct record of the capabily values received from the HSS
for each S-CSCF available in his network. The I-CSCF and the HSS do not need
to know the semantic of these values. This semantic is exclusively an operator
issue.
As a first choice, the I-CSCF shall select an S-CSCF that has all the
mandatory and optional capabilities for the user. Only if that is not possible
shall the I-CSCF apply a 'best-fit' algorithm. If more than one S-CSCF is
identified that supports all mandatory capabilities the I-CSCF may then
consider optional capabilities in selecting a specific S-CSCF. The 'best-fit'
algorithm is implementation dependent and out of the scope of this
specification.
It is the responsibility of the operator to ensure that there are S-CSCFs
which have mandatory capabilities indicated by the HSS for any given user.
However, configuration errors may occur. If such errors occur and they prevent
the I-CSCF from selecting an S-CSCF which meets the mandatory capabilities
indicated by the HSS, the I-CSCF shall inform the operator via the O&M
subsystem.
As an alternative to selecting an S-CSCF based on the list of capabilities
received from the HSS, it is possible to steer users to certain S-CSCFs. To do
this, the operator may include one or more S-CSCF names as part of the
capabilities of the user profile. The reason for the selection (e.g. all the
users belonging to the same company/group could be in the same S-CSCF to
implement a VPN service) and the method of selection are operator issues and
out of the scope of this specification. If this alternative is chosen, the HSS
shall include Server-Name AVPs in the Server-Capabilities AVP and should not
include Mandatory-Capability AVPs or Optional-Capability AVPs in the Server-
Capabilities AVP, and the I-CSCF when receiving Server-Name AVPs within the
Server-Capabilities AVP shall discard any Mandatory-Capability AVP and any
Optional-Capability AVP received within the Server-Capabilities AVP.
The following table is a guideline for operators that records S-CSCF
capabilities that need to be supported by an S-CSCF in order to serve a user
or a service (identified by a Public User Identity or Public Service
Identity), that cannot be served by an S-CSCF which is only compliant to a
previous 3GPP release.
Table 6.7: Guidelines for S-CSCF Capabilities
+----------------------+----------------------+----------------------+ | Capability | Mandatory or | Description | | | Optional (NOTE 1) | | +----------------------+----------------------+----------------------+ | Support of | M | This capability | | \"Wildcarded PSI\" | | indicates that the | | | | assigned S-CSCF | | | | shall support the | | | | handling of | | | | Wildcarded PSIs. | +----------------------+----------------------+----------------------+ | Support of | M | This capability | | \"OrigUnreg SPT\" | | indicates that the | | | | assigned S-CSCF | | | | shall be able to | | | | process iFCs with a | | | | Session Case | | | | \"Origina | | | | ting_Unregistered\" | | | | received from the | | | | HSS in the user | | | | profile. | +----------------------+----------------------+----------------------+ | Support of | M | This capability | | \"OrigCDIV SPT\" | | indicates that the | | | | assigned S-CSCF | | | | shall be able to | | | | process iFCs with a | | | | Session Case | | | | \ | | | | "Originating_CDIV\" | | | | received from the | | | | HSS in the user | | | | profile. | +----------------------+----------------------+----------------------+ | Support of \"Shared | O | This capability | | iFC sets\" | | indicates that the | | | | assigned S-CSCF may | | | | support the \"SiFC\" | | | | feature defined in | | | | the 3GPP TS 29.229 | | | | [5]. | +----------------------+----------------------+----------------------+ | Support of \"Display | O | This capability | | Name\" | | indicates that the | | | | assigned S-CSCF may | | | | support the handling | | | | of \"Display Name\". | | | | The behaviour of the | | | | S-CSCF related to | | | | this missing data is | | | | the same as if the | | | | HSS did not send the | | | | Display Name. | +----------------------+----------------------+----------------------+ | Support of \"Alias\" | O | This capability | | | | indicates that the | | | | assigned S-CSCF may | | | | support the | | | | \"AliasInd\" feature | | | | defined in 3GPP TS | | | | 29.229 [5]. | +----------------------+----------------------+----------------------+ | Support of \"SIP | M | This capability | | Digest | | indicates that the | | Authentication\" | | assigned S-CSCF | | | | shall support the | | | | handling of SIP | | | | Digest | | | | Authentication. | +----------------------+----------------------+----------------------+ | Support of \"NASS | M | This capability | | Bundled | | indicates that the | | Authentication\" | | assigned S-CSCF | | | | shall support the | | | | handling of NASS | | | | Bundled | | | | Authentication. | +----------------------+----------------------+----------------------+ | Support of | M | This capability | | \"Wildcarded IMPUs\" | | indicates that the | | | | assigned S-CSCF | | | | shall support the | | | | handling of | | | | Wildcarded Public | | | | User Identities. | +----------------------+----------------------+----------------------+ | Support of | M | This capability | | \"Loose-Route \" | | indicates that the | | | | assigned S-CSCF | | | | shall support the | | | | loose-route | | | | mechanism. | +----------------------+----------------------+----------------------+ | Support of | M | This capability | | \"Priority Service\" | | indicates that the | | | | S-CSCF shall support | | | | a network default | | | | pre-configured | | | | namespace (e.g. | | | | "wps") and the | | | | associated Service | | | | Priority Level. See | | | | IETF RFC 4412 [22] | | | | and 3GPP TS 24.229 | | | | [8]. | +----------------------+----------------------+----------------------+ | Support of | M | This capability | | \"Extended Priority | | indicates that the | | \" | | S-CSCF shall support | | | | the Priority | | (NOTE 2) | | Namespaces and their | | | | associated Priority | | | | Levels. See IETF RFC | | | | 4412 [22] and 3GPP | | | | TS 24.229 [8]. | +----------------------+----------------------+----------------------+ | Support of \"Early | M | This capability | | IMS Security\" | | indicates that the | | | | assigned S-CSCF | | | | shall support GIBA. | +----------------------+----------------------+----------------------+ | Support of | M | This capability | | \"Reference | | indicates that the | | Location\" | | assigned S-CSCF | | | | shall support the | | | | handling of | | | | reference location | | | | as defined in 3GPP | | | | TS 23.167 [23]. | +----------------------+----------------------+----------------------+ | Support of | M | This capability | | \" | | indicates that the | | Priviledged-Sender\" | | S-CSCF shall support | | | | priviledged sender. | | | | See 3GPP TS 24.229 | | | | [8]. | +----------------------+----------------------+----------------------+ | Support of \"IMSI\" | M | This capability | | | | indicates that the | | | | assigned S-CSCF | | | | shall support the | | | | handling of the | | | | IMSI. | +----------------------+----------------------+----------------------+ | Support of \"Maximum | M | This capability | | Number of allowed | | indicates that the | | simultaneous | | assigned S-CSCF | | registrations\" | | shall support the | | | | handling of maximum | | | | number of allowed | | | | simultaneous | | | | registrations per | | | | user as received | | | | from the HSS. | +----------------------+----------------------+----------------------+ | NOTE 1: Mandatory | | | | (M) corresponds to a | | | | Mandatory Capability | | | | that shall be | | | | supported by the | | | | assigned S-CSCF for | | | | a given user. The | | | | I-CSCF shall not | | | | select an S-CSCF | | | | that does not meet a | | | | mandatory | | | | capability. The | | | | selection of a | | | | S-CSCF not | | | | supporting this | | | | capability would | | | | lead to an | | | | unspecified network | | | | behaviour. | | | | | | | | Optional (O) | | | | corresponds to an | | | | Optional Capability | | | | that may be | | | | supported by the | | | | assigned S-CSCF for | | | | a given user. The | | | | selection of a | | | | S-CSCF that would | | | | not support this | | | | capability will not | | | | significantly affect | | | | the network | | | | behaviour. | | | | | | | | NOTE 2: Support of | | | | \"Extended Priority | | | | \" is backward | | | | compatible with | | | | continued support of | | | | the \"Priority | | | | Service\". | | | +----------------------+----------------------+----------------------+
# 7 Information element contents
## 7.1 Visited Network Identifier
This information element contains the domain name of the visited network.
## 7.2 Public User Identity
This information element contains the Public User Identity. For definition of
a Public User Identity, see 3GPP TS 23.003 [17].
When GPRS-IMS-Bundled Authentication (GIBA) is used, a Temporary Public User
Identity is derived from the IMSI used for bearer network access according to
the rules in 3GPP TS 23.003 [17].
## 7.2a Public Service Identity
This information element contains a Public Service Identity (PSI) that is
hosted by an application server. For definition of a PSI, see 3GPP TS 23.003
[17].
## 7.2b Wildcarded Public Identity
This information element contains a Wildcarded PSI that is hosted by an
application server or a Wildcarded Public User Identity. For definition of a
Wildcarded PSI and a Wildcarded Public User Identity, see 3GPP TS 23.003 [17].
## 7.2c Void
## 7.3 Private User Identity
This information element contains the Private User Identity. For definition of
a Private User Identity, see 3GPP TS 23.003 [17].
When GPRS-IMS-Bundled Authentication (GIBA) is used, the Private User Identity
is derived from the IMSI as specified in 3GPP TS 33.203 [3].
## 7.3a Private Service Identity
This information element contains the Private Service Identity. For definition
of a Private Service Identity, see 3GPP TS 23.003 [17].
## 7.4 S-CSCF Name
This information element contains the S-CSCF Name of the S-CSCF assigned to an
IMS Subscription. For definition of a S-CSCF Name, see 3GPP TS 23.008 [18].
## 7.4a AS Name
This information element contains the AS Name of the AS hosting a Public
Service Identity. For definition of AS Name, see 3GPP TS 23.008 [18].
## 7.5 S-CSCF Capabilities
This information element carries information to assist the I-CSCF during the
process of selecting an S-CSCF for a certain IMS Subscription.
## 7.6 Result
This information element contains result of an operation. See 3GPP TS 29.229
[5] for the possible values.
## 7.7 User Profile
This information element contains the user profile in XML format. The user
profile XML shall be valid against the user profile XML schema defined in
Annex E.
Annex B specifies the UML logical model of the user profile downloaded via the
Cx interface.
Annex D contains and informative, high level representation, of the wire
representation of user profile data.
## 7.8 Server Assignment Type
Indicates the type of server assignment. See 3GPP TS 29.229 [5] for the list
of existing values.
## 7.9 Authentication Data
This information element is composed of the following sub-elements.
### 7.9.1 Item Number
This information element indicates the order in which the authentication
vectors are to be consumed. See 3GPP TS 29.229 [5] for coding details.
### 7.9.2 Authentication Scheme
This information element contains the authentication scheme, which is used to
encode the authentication parameters. See 3GPP TS 29.229 [5] for a list of
values.
### 7.9.3 Authentication Information
This information element is used to convey the challenge and authentication
token used during the authentication procedure, see 3GPP TS 33.203 [3] for
more information. See 3GPP TS 29.229 [5] for coding details.
### 7.9.4 Authorization Information
This information element is used, in an authentication request, to indicate a
failure of synchronization. In a response, it is used to convey the expected
response to the challenge used to authenticate the user, see 3GPP TS 33.203
[3] for more information. See 3GPP TS 29.229 [5] for coding details.
### 7.9.5 Confidentiality Key
This information element contains the confidentiality key, see 3GPP TS 33.203
[3] for more information. See 3GPP TS 29.229 [5] for coding details.
### 7.9.6 Integrity Key
This information element contains the integrity key, see 3GPP TS 33.203 [3]
for more information. See 3GPP TS 29.229 [5] for coding details.
### 7.9.7 Authentication Context
This information element contains authentication-related information relevant
for performing the authentication but that is not part of the SIP
authentication headers. Some mechanisms (e.g. PGP, digest with quality of
protection set to authint defined in IETF RFC 2617 [16], digest with
predictive nonces or sip access digest) request that part or the whole SIP
request (e.g. the SIP method) is passed to the entity performing the
authentication. In such cases the SIPAuthentication-Context AVP shall be
carrying such information.
See 3GPP TS 29.229 [5] for coding details.
### 7.9.8 Digest Authenticate
This information element is composed of the following sub-elements.
#### 7.9.8.1 Digest Realm
This information element is part of the Digest authentication challenge, and
corresponds to the Realm parameter as defined in IETF RFC 3261 [11]. This
information element is used to convey the Realm to the S-CSCF during the SIP
Digest authentication procedure. See 3GPP TS 29.229 [5] for coding details.
#### 7.9.8.2 Void
#### 7.9.8.3 Digest Algorithm
This information element is part of the Digest authentication challenge,
defined in IETF RFC 2617 [16]. See 3GPP TS 29.229 [5] for coding details.
#### 7.9.8.4 Digest QoP
This information element is part of the Digest authentication challenge,
defined in IETF RFC 2617 [16]. It provides the Quality of Protection
indication and has an effect on the digest computation. See 3GPP TS 29.229 [5]
for coding details.
#### 7.9.8.5 Digest HA1
This information element is part of the Digest authentication challenge,
defined in IETF RFC 2617 [16]. See 3GPP TS 29.229 [5] for coding details.
### 7.9.9 Line Identifier
This information element contains the line identifier of the user\'s network
termination. See 3GPP TS 29.229 [5] for coding details.
### 7.9.10 Framed IP Address
See 3GPP TS 29.229 [5] for more information.
### 7.9.11 Framed IPv6 Prefix
See 3GPP TS 29.229 [5] for more information.
### 7.9.12 Framed Interface Id
See 3GPP TS 29.229 [5] for more information.
#### 7.9.8.1 Digest Realm
This information element is part of the Digest authentication challenge, and
corresponds to the realm parameter as defined in IETF RFC 3261 [11]. This
information element is used to convey the realm to the S-CSCF during the SIP
Digest authentication procedure.
#### 7.9.8.2 Void
#### 7.9.8.3 Digest Algorithm
This information element is part of the Digest authentication challenge,
defined in IETF RFC 2617 [16].
#### 7.9.8.4 Digest QoP
This information element is part of the Digest authentication challenge,
defined in IETF RFC 2617 [16]. It provides the Quality of Protection
indication and has an effect on the digest computation.
#### 7.9.8.5 Digest HA1
This information element is part of the Digest authentication challenge,
defined in IETF RFC 2617 [16].
#### 7.9.9 Line Identifier
This information element contains the line identifier of the user\'s network
termination.
## 7.10 Number Authentication Items
This information element contains the number of authentication vectors
requested or delivered.
## 7.11 Reason for de-registration
This information element contains the reason for a de-registration procedure.
## 7.12 Charging information
Addresses of the charging functions. See 3GPP TS 29.229 [5].
## 7.13 Routing information
Information to route requests.
## 7.14 Type of authorization
Type of authorization requested by the I-CSCF. See 3GPP TS 29.229 [5] for a
list of values.
## 7.15 Void
Void
## 7.16 User Data Already Available
This information element indicates to the HSS if the user profile is already
available in the S-CSCF. See 3GPP TS 29.229 [5] for a list of values.
## 7.17 Associated Private Identities
This information element indicates to the S-CSCF the Private Identities, which
belong to the same IMS Subscription as the Private Identity received in the
request command. See 3GPP TS 29.229 [5].
## 7.18 Originating-Request
This information element indicates to the HSS that the request is related to
an originating SIP message. See 3GPP 29.229 [5].
## 7.19 User Authorization Request Flags
This information element carries the following indication (see 3GPP 29.229 [5]
for coding details):
\- IMS Emergency Registration.
## 7.20 Loose-Route Indication
This information element indicates to the S-CSCF that the loose-route
mechanism shall be applied to the public identities contained in the user
profile received from the HSS. See 3GPP TS 29.229 [5]. This information is
static data for the duration of the subscription or the validity of the IMS
identity. Modification of this data result in Network Initiated Deregistration
(SERVER_CHANGE); see section 6.1.3.1.
## 7.21 S-CSCF Restoration Information
This information element contains information for the S-CSCF to handle traffic
for a registered user. It i[s]{.underline} associated with the Private User
Identity and the Implicit Registration Set that is affected by the SAR
request. See 3GPP TS 29.229 [5] for the contents of this information element.
## 7.22 Associated Registered Private Identities
This information element indicates to the S-CSCF the Registered Private
Identities, which were registered with the Public Identity received in the
request command. See 3GPP TS 29.229 [5].
## 7.23 Multiple Registration Indication
This information element indicates to the HSS that this is related to a
multiple registration. See 3GPP TS 29.229 [5].
## 7.24 Session-Priority
This information element indicates the session\'s priority level to the HSS.
See 3GPP TS 29.229 [5].
## 7.25 Identities with Emergency Registration
This information element indicates to the HSS a list of pairs of Private /
Public Identities that are emergency registered. See 3GPP TS 29.229 [5].
## 7.26 Priviledged-Sender Indication
This information element indicates to the S-CSCF that the Private User
Identity shall be considered as a priviledged sender, as described in 3GPP TS
24.229 [8].
## 7.27 LIA Flags
This information element carries the following indications. See 3GPP TS 29.229
[5] for coding details.
\- PSI Direct Routing Indication
## 7.28 Server Assignment Request Flags
This information element carries the following indication (see 3GPP 29.229 [5]
for coding details):
\- P-CSCF Restoration Indication
## 7.29 Allowed WAF and/or WWSF Identities
Addresses of the WebRTC Authentication Functions and/or **WebRTC Web Server
Functions allowed for a subscription**. See 3GPP TS 33.203 [3].
# 8 Error handling procedures
## 8.1 Registration error cases
This section describes the handling of error cases, which can occur during the
registration process. If the new and previously assigned S-CSCF names sent in
the Multimedia-Auth-Request command are different and the Multimedia-Auth-
Request is not indicating synchronisation failure (i.e. the request does not
contain auts parameter), then the HSS shall overwrite the S-CSCF name.
If the new and previously assigned S-CSCF names sent in a command other than
the Multimedia-Auth-Request command are different and the S-CSCF reassignment
pending flag is not set, then the HSS shall not overwrite the S-CSCF name;
instead it shall send a response to the S-CSCF indicating an error.
### 8.1.1 Cancellation of the old S-CSCF
It is possible that in certain situations the HSS receives a Multimedia-Auth-
Request (MAR) command including a S-CSCF name, which is not the same as the
previously assigned S-CSCF for the user. This can happen e.g. in case the new
S-CSCF is selected due to a failure in the re-registration if the previously
assigned S-CSCF does not respond to REGISTER message sent from the I-CSCF
after a timeout.
In this case, the new S-CSCF is assigned for the user and if registrations in
the previously assigned S-CSCF exist for the user, these registrations in the
old S-CSCF are handled locally in the old S-CSCF, e.g. re-registration timers
in the old S-CSCF shall cancel the registrations.
Additionally, the HSS should de-register the registrations in the old S-CSCF
by using the Registration-Termination-Request command. In this case, the HSS
shall first check whether the deregistration is really required by comparing
the Diameter client address of the newly assigned S-CSCF received in the MAR
command to the Diameter client address stored in the HSS. If the Diameter
client addresses match, the deregistration shall not be initiated. Otherwise
the deregistration should be initiated for all the registered Public User
Identities for the corresponding IMS Subscription. HSS shall check whether IMS
Restoration Procedures are supported to perform deregistration:
\- If supported, Registration-Termination-Request shall be sent for all Public
User Identities (with their associated Private User Identities), with
Deregistration-Reason AVP value set to NEW_SERVER_ASSIGNED.
\- Otherwise, Registration-Termination-Request shall be sent with different
Deregistration-Reason AVP values, in the following order:
1\. Deregistration-Reason AVP value set to NEW_SERVER_ASSIGNED, for the Public
User Identity (with its associated Private User Identity), which is registered
in the new S-CSCF.
2\. Deregistration-Reason AVP value set to SERVER_CHANGE, for the user Public
User Identities (with their associated Private User Identities), which are not
yet registered in the new S-CSCF.
### 8.1.2 Error in S-CSCF name
If the S-CSCF name sent in the Server-Assignment-Request command and the
previously assigned S-CSCF name stored in the HSS are different and the S-CSCF
reassignment pending flag is not set, then the HSS shall not overwrite the
S-CSCF name. If the Server Assignment Type indicates NO_ASSIGNMENT, the HSS
shall send a response to the S-CSCF with Result-Code value set to
DIAMETER_UNABLE_TO_COMPLY. For all other Server Assignment Types, the HSS
shall send a response to the S-CSCF with Experimental-Result-Code value set to
DIAMETER_ERROR_IDENTITY_ALREADY_REGISTERED.
If the S-CSCF name sent in the Server-Assignment-Request command and the
previously assigned S-CSCF name stored in the HSS are different and IMS
Restoration Procedures are supported and the S-CSCF reassignment pending flag
is set, then the HSS shall allow overwriting of the S-CSCF name and proceed
with the processing of the SAR command as defined in section 6.1.2.
### 8.1.3 Error in S-CSCF assignment type
If the Server-Assignment-Type in the Server-Assignment-Request command sent by
the S-CSCF to the HSS is not allowed (**i.e if the** Server-Assignment-Type
**is not applicable based on the user state or it is not applicable based on
the user identity type**), the HSS shall send a response to the S-CSCF with
the Experimental-Result-Code value set to DIAMETER_ERROR_IN_ASSIGNMENT_TYPE.
# 9 Protocol version identification
See 3GPP TS 29.229 [5].
# 10 Operational Aspects
See 3GPP TS 29.229 [5].
###### ## Annex A (normative): Mapping of Cx operations and terminology to
Diameter
# A.1 Introduction
This appendix gives mappings from Cx to Diameter protocol elements. Diameter
protocol elements are defined in 3GPP TS 29.229 [5].
# A.2 Cx message to Diameter command mapping
The following table defines the mapping between stage 2 operations and
Diameter commands:
Table A.2.1: Cx message to Diameter command mapping
* * *
Cx message Source Destination Command-Name Abbreviation Cx-Query + Cx-Select-
Pull I-CSCF HSS User-Authorization-Request UAR Cx-Query Resp + Cx-Select-Pull
Resp HSS I-CSCF User-Authorization-Answer UAA Cx-Put + Cx-Pull S-CSCF HSS
Server-Assignment-Request SAR Cx-Put Resp + Cx-Pull Resp HSS S-CSCF Server-
Assignment-Answer SAA Cx-Location-Query I-CSCF HSS Location-Info-Request LIR
Cx-Location-Query Resp HSS I-CSCF Location-Info-Answer LIA Cx-AuthDataReq
S-CSCF HSS Multimedia-Authentication-Request MAR Cx-AuthDataResp HSS S-CSCF
Multimedia-Authentication-Answer MAA Cx-Deregister HSS S-CSCF Registration-
Termination-Request RTR Cx-Deregister Resp S-CSCF HSS Registration-
Termination-Answer RTA Cx-Update_Subscr_Data HSS S-CSCF Push-Profile-Request
PPR Cx-Update_Subscr_Data Resp S-CSCF HSS Push-Profile-Answer PPA
* * *
# A.3 Cx message parameters to Diameter AVP mapping
The following table gives an overview about the mapping:
Table A.3.1: Cx message parameters to Diameter AVP mapping
* * *
Cx parameter AVP Name Visited Network Identifier Visited-Network-Identifier
Public Identity Public-Identity Private Identity User-Name S-CSCF Name Server-
Name AS Name  
S-CSCF capabilities Server-Capabilities Result Result-Code Experimental-
Result-Code User profile User-Data Server Assignment Type Server-Assignment-
Type Authentication data SIP-Auth-Data-Item Item Number SIP-Item-Number
Authentication Scheme SIP-Authentication-Scheme Authentication Information
SIP-Authenticate Authorization Information SIP-Authorization Confidentiality
Key Confidentiality-Key Integrity Key Integrity-Key Number Authentication
Items SIP-Number-Auth-Items Reason for de-registration Deregistration-Reason
Charging Information Charging-Information Routing Information Destination-Host
Type of Authorization Authorization-Type Associated Private Identities
Associated-Identities Digest Authenticate SIP-Digest-Authenticate Digest Realm
Digest-Realm Digest Algorithm Digest-Algorithm Digest QoP Digest-QoP Digest
HA1 Digest-HA1 Line Identifier Line-Identifier Wildcarded Public Identity
Wildcarded-Public Identity Loose-Route Indication Loose-Route-Indication
S-CSCF Restoration Information SCSCF-Restoration-Info Multiple Registration
Indication Multiple-Registration-Indication Priviledged-Sender Indication
Priviledged-Sender-Indication LIA Flags LIA-Flags Allowed WAF and/or WWSF
Identities Allowed-WAF-WWSF-Identities
* * *
# A.4 Message flows
The following message flows give examples regarding which Diameter messages
shall be sent in scenarios described in 3GPP TS 23.228 [1].
## A.4.1 Registration-- user not registered
{width="5.996527777777778in" height="7.2875in"}
Figure A.4.1.1: Registrati**o** n -- user not registered
## A.4.2 Registration -- user currently registered
{width="4.927083333333333in" height="3.375in"}
Figure A.4.2.1: Re-registration
## A.4.3 UE initiated de-registration
{width="5.702083333333333in" height="3.69375in"}
Figure A.4.3.1: UE initiated de-registration
## A.4.4 Network initiated de-registration
### A.4.4.1 Registration timeout
{width="3.8256944444444443in" height="2.0972222222222223in"}
Figure A.4.4.1.1: Network initiated de-registration -- registration timeout
### A.4.4.2 Administrative de-registration
{width="5.041666666666667in" height="1.8854166666666667in"}
Figure A.4.4.2.1: Network initiated de-registration -- administrative de-
registration
### A.4.4.3 De-registration initiated by service platform
{width="5.061805555555556in" height="3.1145833333333335in"}
Figure A.4.4.3.1: Network initiated de-registration -- initiated by service
platform
## A.4.5 UE Terminating SIP session set-up
{width="3.21875in" height="2.6041666666666665in"}
Figure A.4.5.1: UE Terminating SIP session set-up
## A.4.6 Initiation of a session to a non-registered user
Figure A.4.6.1: Initiation of a session to a non-registered user
## A.4.6a AS originating session on behalf of a non-registered user
Figure A.4.6a.1: AS originating session on behalf of a non-registered user
## A.4.7 User Profile update
{width="2.933333333333333in" height="2.0229166666666667in"}
Figure A.4.7.1: User profile update
###### ## Annex B (informative): User profile UML model
The purpose of this UML model is to define in an abstract level the structure
of the user profile downloaded over the Cx interface and describe the purpose
of the different information classes included in the user profile.
# B.1 General description
The following picture gives an outline of the UML model of the user profile,
which is downloaded from HSS to S-CSCF:
Figure B.1.1: User Profile
IMS Subscription class contains as a parameter the private user identity of
the user in NAI format and the IMSI of the user, if available, as defined in
3GPP TS 23.003 [17].
Each instance of the IMS Subscription class contains zero or several instances
of the class Reference Location Information.
Each class of Reference Location Information contains zero or one attribute
AccessType, zero or one attribute AccessInfo, and zero or one attribute
AccessValue.
The attribute AccessType indicates the type of access for which the reference
location of the user is defined (e.g. ADSL). The attribute AccessInfo
indicates the type of the access information defined for the reference
location of the user (e.g. dsl-location). The attribute AccessValue contains
the location information (e.g. line identifier in fixed access networks) as
configured by the operator.
Each instance of the IMS Subscription class contains one or several instances
of the class Service Profile.
# B.2 Service profile
The following picture gives an outline of the UML model of the Service Profile
class:
Figure B.2.1: Service Profile
Each instance of the Service Profile class consists of one or several
instances of the class Public Identification. Public Identification class
contains the Public Identities associated with that service profile. The
information in the Core Network Service Authorization, Initial Filter
Criteria, and Shared iFC Set classes apply to all Public Identification
instances, which are included in one Service profile class.
Each instance of the Service Profile class contains zero or one instance of
the class Core Network Service Authorization. If no instance of the class Core
Network Service Authorization is present, no filtering related to subscribed
media or restriction on IMS Communication Service Identifiers applies in
S-CSCF.
Each instance of the class Service Profile contains zero or several instances
of the class Initial Filter Criteria.
Each instance of the class Service Profile contains zero or more instances of
the class Shared iFC Set. A Shared iFC Set points to a set of Initial Filter
Criteria locally administered and stored at the S-CSCF. Shared iFC Sets may be
shared by several Service Profiles.
## B.2.1 Public Identification
The following picture gives an outline of the UML model of Public
Identification class:
Figure B.2.1.1: Public Identification
The attribute BarringIndication is of type Boolean. If it is absent, or if it
is present and set to FALSE, the S-CSCF shall not restrict the use of that
public user identity in any IMS communications. If it is present and set to
TRUE, the S-CSCF shall prevent that public identity from being used in any IMS
communication except registrations and re-registrations, as specified in 3GPP
TS 24.229 [8].
Public Identification class can contain an Identity attribute. The attribute
IdentityType indicates the type of identity contained in each case. It could
be either:
\- A distinct Public User Identity
\- A distinct Public Service Identity
\- A Wildcarded Public Service Identity
\- A non distinct Public User Identity, i.e. not explicitly provisioned in
HSS[.]{.underline}
\- A Wildcarded Public User Identity
If the identity type is not present, it is assumed to be a distinct Public
User Identity.
The attribute WildcardedPSI may be present (when IdentityType is
WildcardedPSI) and contains the Wildcarded Public Service Identity that
matched the Public Service Identity. This Wildcarded Public Service identity
shall be sent as stored in the HSS, that is, including the delimiter described
in 3GPP TS 23.003 [17].
The attribute DisplayName allows a name to be associated with a Public
Identity.
The attribute AliasIdentityGroupID indicates the Alias Public User Identity
Set to which the Public User Identity belongs. If the \"AliasInd\" feature is
supported, all Public User Identities shall have an AliasIdentityGroupID
allocated. Within an IMS subscription Public User Identities that have the
same AliasIdentityGroupID allocated shall be in the same implicit registration
sets, and shall share their service profile and the same service data for each
and every service, and shall be regarded as aliases of each other, as defined
in the3GPP TS 23.008 [18]. If the \"AliasInd\" feature is not supported, all
Public User Identities within an IMS subscription that are within the same
implicit registration set and share their service profile shall be regarded
aliases of each other.
The attribute WildcardedIMPU shall be present when IdentityType is a non
distinct IMPU or it may be optionally present when IdentityType is a
Wildcarded IMPU. It contains the Wildcarded Public User Identity that matched
the Public User Identity. This Wildcarded Public User identity shall be sent
as stored in the HSS, that is, including the delimiter described in 3GPP TS
23.003 [17].
The attribute ServiceLevelTraceInfo provides the Service Level Tracing
Information that is related to the Public User Identity. If the
ServiceLevelTraceInfo is present, service level tracing shall be enabled in
the S-CSCF for the related Public User Identity according to the configuration
data received. If the ServiceLevelTraceInfo is not present, service level
tracing is disabled in the S-CSCF for the related Public User Identity.
The attribute ServicePriorityLevel provides the Priority Level allowed for the
Public User Identity, which can be used by the S-CSCF and other network
elements for Priority Service.
The attribute PriorityNamespace provides the Namespace as specified in IETF
RFC 4412 [22] and to which the Extended Priority refers.
The attribute PriorityLevel provides the Priority Level allowed for the Public
User Identity, for the Extended Priority. Its value depends on the
PriorityNamespace.
The attribute MaxNumOfAllowedSimultRegs provides the maximum number of allowed
simultaneous registrations for the Public User Identity.
## B.2.1A Core Network Service Authorization
The following picture gives an outline of the UML model of Core Network
Service Authorization class:
Figure B.2.1A.1: Core Network Service Authorization
Each instance of the Core Network Service Authorization class contains zero or
one instance of the class Subscribed Media Profile Id. If no instance of the
class Subscribed Media Profile Id is present, no filtering related to
subscribed media applies in S-CSCF. The Subscribed Media Profile Id is of type
Integer and identifies a media profile in the S-CSCF for the authorization of
media parameters.
Each instance of the Core Network Service Authorization class contains zero or
one instance of the class List of Service Ids. If no instance of the class
List of Service Ids is present, no restriction on IMS Communication Service
Identifiers related applies in S-CSCF. Each instance of the class List of
Service Ids contains zero or more instances of the class Service Id. The
Service Id is of type String and identifies an IMS Communication Service
Identifier that the subscriber is authorized to use.
## B.2.2 Initial Filter Criteria
The following picture gives an outline of the UML model of Initial Filter
Criteria class:
{width="5.679861111111111in" height="3.217361111111111in"}
Figure B.2.2.1.1: Initial Filter Criteria
Each instance of the Initial Filter Criteria class is composed of zero or one
instance of a Trigger Point class and one instance of an Application Server
class. Priority indicates the priority of the Filter Criteria. The higher the
Priority Number the lower the priority of the Filter Criteria is; i.e., a
Filter Criteria with a higher value of Priority Number shall be assessed after
the Filter Criteria with a smaller Priority Number have been assessed. The
same priority shall not be assigned to more than one initial Filter Criterion.
ProfilePartIndicator attribute is an enumerated type, with possible values
\"REGISTERED and UNREGISTERED, indicating if the iFC is a part of the
registered or unregistered user profile. If ProfilePartIndicator is missing
from the iFC, the iFC is considered to be relevant to both the registered and
unregistered parts of the user profile, i.e. belongs to the common part of the
user profile.
Trigger Point class describes the trigger points that should be checked in
order to find out if the indicated Application Server should be contacted or
not. Each TriggerPoint is a boolean expression in Conjunctive or Disjunctive
Normal form (CNF of DNF). The absence of Trigger Point instance will indicate
an unconditional triggering to Application Server.
The attribute ConditionTypeCNF attribute defines how the set of SPTs are
expressed, i.e. either an Ored set of ANDed sets of SPT statements or an ANDed
set of Ored sets of statements. Individual SPT statements can also be negated.
These combinations are termed, respectively, Disjunctive Normal Form (DNF) and
Conjunctive Normal Form (CNF) for the SPT (see Annex C). Both DNF and CNF
forms can be used. ConditionTypeCNF is a boolean that is TRUE when the Trigger
Point associated with the FilterCriteria is a boolean expression in
Conjunctive Normal Form (CNF) and FALSE if the Trigger Point is expressed in
Disjunctive Normal Form (DNF) (see Annex C).
Each Trigger Point is composed by 1 to n instances of the class Service Point
Trigger.
Application Server class defines the application server, which is contacted,
if the trigger points are met. Server Name is the SIP URL of the application
server to contact. Default Handling determines whether the dialog should be
released if the Application Server could not be reached or not; it is of type
enumerated and can take the values: SESSION_CONTINUED or SESSION_TERMINATED.
The Application Server class contains zero or one instance of the Service
Information class, zero or one instance of the Include Register Request class
and zero or one instance of the Include Register Response class. The Service
Information class allows to download to S-CSCF information that is to be
transferred transparently to an Application Server when the trigger points of
a filter criterion are satisfied. ServiceInformation is a string conveying
that information. See 3GPP TS 23.218 [7] for a description of the use of this
information element. The Include Register Request class indicates to the
S-CSCF that the incoming SIP REGISTER request is to be transferred to an
Application Server when the trigger points of a filter criterion are
satisfied. See 3GPP TS 23.218 [7] for a description of the use of this
information element. The Include Register Response class indicates to the
S-CSCF that the final SIP response to the incoming SIP REGISTER request is to
be transferred to an Application Server when the trigger points of a filter
criterion are satisfied. See 3GPP TS 23.218 [7] for a description of the use
of this information element.
## B.2.3 Service Point Trigger
The following picture gives an outline of the UML model of Service Point
Trigger class:
Figure B.2.3.1: Service Point Trigger
The attribute Group of the class Service Point Trigger allows the grouping of
SPTs that will configure the sub-expressions inside a CNF or DNF expression.
For instance, in the following CNF expression (A+B).(C+D), A+B and C+D would
correspond to different groups.
In CNF, the attribute Group identifies the ORed sets of SPT instances. If the
SPT belongs to different ORed sets, SPT can have more than one Group values
assigned. At least one Group must be assigned for each SPT.
In DNF, the attribute Group identifies the ANDed sets of SPT instances. If the
SPT belongs to different ANDed sets, SPT can have more than one Group values
assigned. At least one Group must be assigned for each SPI.
The attribute ConditionNegated of the class Service Point Trigger defines
whether the individual SPT instance is negated (i.e. NOT logical expression).
NOTE: The operator should be aware that a negated Session Case implies that
all other available session cases are set. The list of session cases depends
on the release and can even be increased in the future, then a negated Session
Case may end up triggering ASs unexpectedly (e.g. NOT ORIGINATED_REGISTERED
may trigger only TERMINATING_UNREGISTERED and TERMINATING_REGISTERED, or as
well ORIGINATING_UNREGISTERED and ORIGINATING_CDIV).
The attribute RegistrationType of the class Service Point Trigger is relevant
only to the SIP Method SPT with a value of \"REGISTER\" and its\' support is
optional in the HSS and in the S-CSCF. The RegistrationType may contain a list
of values that define whether the SPT matches to REGISTER messages that are
related to initial registrations, re-registrations, and/or de-registrations.
If RegistrationTypes are given, the SIP Method SPT with a value of
\"REGISTER\" shall match if any of the RegistrationTypes match and the S-CSCF
supports the RegistrationType attribute. If the SIP Method SPT contains value
\"REGISTER\", and no RegistrationType is given, or if the S-CSCF does not
support the RegistrationType attribute, the SIP Method SPT matches to all
REGISTER messages. The attribute RegistrationType may be discarded if it is
present in an SPT other than SIP Method with value \"REGISTER\".
Request-URI class defines SPT for the Request-URI. Request-URI contains
attribute RequestURI.
SIP Method class defines SPT for the SIP method. SIP Method contains attribute
Method which holds the name of any SIP method.
SIP Header class defines SPT for the presence or absence of any SIP header or
for the content of any SIP header. SIP Header contains attribute Header which
identifies the SIP Header, which is the SPT, and the Content attribute defines
the value of the SIP Header if required.
The absence of the Content attribute and ConditionNegated = TRUE indicates
that the SPT is the absence of a determined SIP header.
Session Case class represents an enumerated type, with possible values
\"Originating\", \"Terminating_Registered\", \"Terminating_Unregistered\",
\"Originating_Unregistered\", \"Originating_CDIV\" indicating whether the
filter should be used by the S-CSCF handling the Originating, Terminating for
a registered end user, Terminating for an unregistered end user, Originating
for an unregistered end user, or Originating after Call Diversion services.
Session Description Information class defines SPT for the content of any SDP
field within the body of a SIP Method. The Line attribute identifies the line
inside the session description. Content is a string defining the content of
the line identified by Line.
###### ## Annex C (informative): Conjunctive and Disjunctive Normal Form
A Trigger Point expression is constructed out of atomic expressions (i.e.
Service Point Trigger) linked by Boolean operators AND, OR and NOT. Any
logical expression constructed in that way can be transformed to forms called
Conjunctive Normal Form (CNF) and Disjunctive Normal Form (DNF).
A Boolean expression is said to be in Conjunctive Normal Form if it is
expressed as a conjunction of disjunctions of literals (positive or negative
atoms), i.e. as an AND of clauses, each of which is the OR of one of more
atomic expressions.
Taking as an example the following trigger:
Method = \"INVITE\" OR Method = \"MESSAGE\" OR (Method=\"SUBSCRIBE\" AND NOT
Header = \"from\" Content = \"joe\")
The trigger can be split into the following atomic expressions:
Method=\"INVITE\"
Method=\"MESSAGE\"
Method=\"SUBSCRIBE\"
NOT header=\"from\" Content =\"joe\"
Grouping the atomic expressions, the CNF expression equivalent to the previous
example looks like:
(Method=\"INVITE\" OR Method = \"MESSAGE\" OR Method=\"SUBSCRIBE\") AND
(Method=\"INVITE\" OR Method = \"MESSAGE\" OR (NOT Header = \"from\" Content =
\"joe\"))
This result in two \"OR\" groups linked by \"AND\" (CNF):
(Method=\"INVITE\" OR Method = \"MESSAGE\" OR Method=\"SUBSCRIBE\")
(Method=\"INVITE\" OR Method = \"MESSAGE\" OR (NOT Header = \"from\" Content =
\"joe\"))
The XML representation of the trigger is:
\
\
\IMPI1\@homedomain.com\
\
\
\1\
\ sip:IMPU1\@homedomain.com \
\
\
\ sip:IMPU2\@homedomain.com \
\
\
\0\
\
\1\
\
\0\
\0\
\INVITE\
\
\
\0\
\0\
\MESSAGE\
\
\
\0\
\0\
\SUBSCRIBE\
\
\
\0\
\1\
\INVITE\
\
\
\0\
\1\
\MESSAGE\
\
\
\1\
\1\
\
\From\
\\"joe\"\
\
\
\
\
\sip:AS1\@homedomain.com\
\0\
\
\
\
\
A Boolean expression is said to be in Disjunctive Normal Form if it is
expressed as a disjunction of conjunctions of literals (positive or negative
atoms), i.e. as an OR of clauses, each of which is the AND of one of more
atomic expressions.
The previous example is already in DNF, composed by the following groups:
Method=\"INVITE\"
Method=\"MESSAGE\"
Method=\"SUBSCRIBE\" AND (NOT header=\"from\" Content =\"joe\")
The XML representation of the trigger is:
\
\
\IMPI1\@homedomain.com\
\
\
\1\
\ sip:IMPU1\@homedomain.com \
\
\
\ sip:IMPU2\@homedomain.com \
\
\
\0\
\
\0\
\
\0\
\0\
\INVITE\
\
\
\0\
\1\
\MESSAGE\
\
\
\0\
\2\
\SUBSCRIBE\
\
\
\1\
\2\
\
\From\
\\"joe\"\
\
\
\
\
\sip:AS1\@homedomain.com\
\0\
\
\
\
\
###### ## Annex D (informative): High-level format for the User Profile
The way the information shall be transferred through the Cx interface can be
seen from a high-level point of view in the following picture:
Figure D.1: Example of in-line format of user profile
If more than one service profile is created, for example to assign a different
set of filters to public identifiers 1 and 2 and public identity 3, the
information shall be packaged in the following way:
Figure D.2: Example of in-line format of user profile
###### ## Annex E (normative): XML schema for the Cx interface user profile
The file CxDataType_Rel11.xsd, attached to this specification, contains the
XML schema for the user profile that is sent over the Cx interface. The user
profile XML schema defines that are used in the user profile XML. The data
that is allowed to be sent in the user profile may vary depending on the
features supported by the Diameter end points, see 3GPP TS 29.229 [5]. The
user profile XML schema file is intended to be used by an XML parser. The
version of the Cx application sending the user profile XML shall be the same
as the version of the sent user profile XML and thus it implies the version of
the user profile XML schema to be used to validate it.
Table E.1 describes the data types and the dependencies among them that
configure the user profile XML schema.
Table E.1: XML schema for the Cx interface user profile: simple data types
+-----------------+-----------------+------------+-----------------+ | Data type | Tag | Base type | Comments | +-----------------+-----------------+------------+-----------------+ | tPriority | Priority | integer | >= 0 | +-----------------+-----------------+------------+-----------------+ | tProfi | Profi | enumerated | Possible | | lePartIndicator | lePartIndicator | | values: | | | | | | | | | | 0 (REGISTERED) | | | | | | | | | | 1 | | | | | (UNREGISTERED) | +-----------------+-----------------+------------+-----------------+ | tSharedIFCSetID | SharedIFCSetID | integer | >= 0 | +-----------------+-----------------+------------+-----------------+ | tGroupID | Group | integer | >= 0 | +-----------------+-----------------+------------+-----------------+ | tR | R | enumerated | Possible | | egistrationType | egistrationType | | values: | | | | | | | | | | 0 | | | | | (**INITIAL_ | | | | | REGISTRATION**) | | | | | | | | | | 1 | | | | | (R | | | | | E-REGISTRATION) | | | | | | | | | | 2 | | | | | (D | | | | | E-REGISTRATION) | +-----------------+-----------------+------------+-----------------+ | t | DefaultHandling | enumerated | Possible | | DefaultHandling | | | values: | | | | | | | | | | 0 | | | | | (SESS | | | | | ION_CONTINUED) | | | | | | | | | | 1 | | | | | (SESSI | | | | | ON_TERMINATED) | +-----------------+-----------------+------------+-----------------+ | tDir | SessionCase | enumerated | Possible | | ectionOfRequest | | | values: | | | | | | | | | | 0 | | | | | (ORIGINATI | | | | | NG_REGISTERED) | | | | | | | | | | 1 | | | | | TERMINAT | | | | | ING_REGISTERED | | | | | | | | | | 2 | | | | | (TERMINATING | | | | | _UNREGISTERED) | | | | | | | | | | 3 | | | | | (ORIGINATING | | | | | _UNREGISTERED) | | | | | | | | | | 4 | | | | | (ORI | | | | | GINATING_CDIV) | +-----------------+-----------------+------------+-----------------+ | tPrivateID | PrivateID | anyURI | Syntax | | | | | described in | | | | | IETF RFC 2486 | | | | | [14] | +-----------------+-----------------+------------+-----------------+ | tSIP_URL | Identity | anyURI | Syntax | | | | | described in | | | | | IETF RFC 3261 | | | | | [11] or 3GPP | | | | | TS 23003 (See | | | | | Note 1) | +-----------------+-----------------+------------+-----------------+ | tTEL_URL | Identity | anyURI | Syntax | | | | | described in | | | | | IETF RFC 3966 | | | | | [15] or 3GPP | | | | | TS 23003 (See | | | | | Note 1) | +-----------------+-----------------+------------+-----------------+ | tIdentity | Identity | (union) | Union of | | | | | tSIP_URL, and | | | | | tTEL_URL | +-----------------+-----------------+------------+-----------------+ | tIdentityType | IdentityType | enumerated | Possible | | | | | values: | | | | | | | | | | 0 (DISTINCT | | | | | PUBLIC_ | | | | | USER_IDENTITY) | | | | | | | | | | 1 | | | | | (DISTINCT_PSI) | | | | | | | | | | 2 | | | | | (W | | | | | ILDCARDED_PSI) | | | | | (See Note 2) | | | | | | | | | | 3 | | | | | (NON_ | | | | | DISTINCT_IMPU) | | | | | (See Note 3) | | | | | | | | | | 4 | | | | | (WI | | | | | LDCARDED_IMPU) | | | | | (See Note 4) | +-----------------+-----------------+------------+-----------------+ | tServiceInfo | ServiceInfo | string | | +-----------------+-----------------+------------+-----------------+ | tString | RequestURI, | string | | | | Method, Header, | | | | | Content, Line, | | | | | AccessType, | | | | | AccessInfo, | | | | | AccessValue | | | +-----------------+-----------------+------------+-----------------+ | tBool | Co | boolean | Possible | | | nditionTypeCNF, | | values: | | | Co | | | | | nditionNegated, | | 0 (false) | | | Ba | | | | | rringIndication | | 1 (true) | +-----------------+-----------------+------------+-----------------+ | tSubscribe | Subscribe | integer | >=0 | | dMediaProfileId | dMediaProfileId | | | +-----------------+-----------------+------------+-----------------+ | * | **DisplayName** | **string** | | | _tDisplayName_ _| | | | +-----------------+-----------------+------------+-----------------+ |__tAliasId |__AliasId |__string_ _| | | entityGroupID_ _| entityGroupID_ _| | | +-----------------+-----------------+------------+-----------------+ |__tServiceL |__ServiceL |__string_ _| Not used in | | evelTraceInfo_ _| evelTraceInfo_ _| | this release | +-----------------+-----------------+------------+-----------------+ |__tService |__Service | enumerated | Possible | | PriorityLevel_ _| PriorityLevel_ _| | values: | | | | | | | | | | 0 (Highest | | | | | priority) | | | | | | | | | | 1 | | | | | | | | | | 2 | | | | | | | | | | 3 | | | | | | | | | | 4 (Lowest | | | | | priority) | +-----------------+-----------------+------------+-----------------+ | tPr | Pr | string | Possible values | | iorityNamespace | iorityNamespace | | are those of | | | | | the namespaces | | | | | that are | | | | | defined in IETF | | | | | RFC 4412 [22] | | | | | or defined | | | | | according to | | | | | the IANA | | | | | registration | | | | | procedure | | | | | described in | | | | | IETF RFC 4412 | | | | | [22] for | | | | | Re | | | | | source-Priority | | | | | Namespaces. | +-----------------+-----------------+------------+-----------------+ |__t | ** | string | Possible values | | PriorityLevel_ _| PriorityLevel_ _| | depend on the | | | | | Pr | | | | | iorityNamespace | | | | | and are | | | | | specified with | | | | | the associated | | | | | namespace that | | | | | is defined in | | | | | IETF RFC 4412 | | | | | [22] or | | | | | defined | | | | | according to | | | | | the IANA | | | | | registration | | | | | procedure | | | | | described in | | | | | IETF RFC 4412 | | | | | [22] for | | | | | Re | | | | | source-Priority | | | | | Namespaces | +-----------------+-----------------+------------+-----------------+ |__tIMSI_ _|__IMSI_ * | string | Syntax | | | | | described in | | | | | 3GPP TS 23.003 | | | | | [17]. ASCII | | | | | encoded | | | | | according to | | | | | ANSI X3.4 | | | | | [26]. | +-----------------+-----------------+------------+-----------------+ | tMaxN | MaxN | integer | >= 1 | | umOfAllowedSimu | umOfAllowedSimu | | | | ltRegistrations | ltRegistrations | | | +-----------------+-----------------+------------+-----------------+ | NOTE 1: Only | | | | | when the | | | | | "Identity" tag | | | | | is a Wildcarded | | | | | Identity the | | | | | syntax is | | | | | described in | | | | | 3GPP TS 23.003. | | | | | It applies to | | | | | both | | | | | W | | | | | ILDCARDED_IMPU | | | | | and | | | | | W | | | | | ILDCARDED_PSI. | | | | | | | | | | NOTE 2: | | | | | Wildcarded PSI | | | | | could | | | | | optionally be | | | | | included as | | | | | well in | | | | | tPublicIde | | | | | ntityExtension. | | | | | | | | | | NOTE 3: The | | | | | IMPU is not | | | | | explicitly | | | | | provisioned in | | | | | HSS. In this | | | | | case, | | | | | corresponding | | | | | Wildcarded IMPU | | | | | is included in | | | | | tPublicIden | | | | | tityExtension3. | | | | | | | | | | NOTE 4: | | | | | W | | | | | ILDCARDED_IMPU | | | | | indicates that | | | | | the content of | | | | | the identity in | | | | | the "Identity" | | | | | tag is a | | | | | Wildcarded | | | | | Public User | | | | | Identity. In | | | | | this case, | | | | | Wildcarded IMPU | | | | | could | | | | | optionally be | | | | | included as | | | | | well in | | | | | tPublicIden | | | | | tityExtension3. | | | | +-----------------+-----------------+------------+-----------------+
Table E.2: XML schema for the Cx interface user profile: complex data types
+-----------+-----------+-----------+-----------+-----------+---+ | Data type | Tag | Compound | | | | | | | of | | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | Tag | Type | Ca | | | | | | | rdinality | | +-----------+-----------+-----------+-----------+-----------+---+ | tIMSSub | IMSSub | PrivateID | t | 1 | | | scription | scription | | PrivateID | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | Servi | tServi | (1 to n) | | | | | ceProfile | ceProfile | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | **Ex | ** |**(0 to | | | | | tension**| t** IMSSub | 1)**| | | | | | scription | | | | | | | Extension | | | +-----------+-----------+-----------+-----------+-----------+---+ | tIMSSub | Extension | IMSI | tIMSI | (0 to 1) | | | scription | | | | | | | Extension | | | | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | Extension |** t | (0 to 1) | | | | | | **IMSSubs | | | | | | | criptionE | | | | | | | xtension2 | | | +-----------+-----------+-----------+-----------+-----------+---+ | tIMSSubs | Extension | R | tR | (0 to n) | | | criptionE | | eferenceL | eferenceL | | | | xtension2 | | ocationIn | ocationIn | | | | | | formation | formation | | | +-----------+-----------+-----------+-----------+-----------+---+ | tR | R | A | tString | (0 to 1) | | | eferenceL | eferenceL | ccessType | (NOTE 4) | | | | ocationIn | ocationIn | | | | | | formation | formation | | | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | A | tString | (0 to 1) | | | | | ccessInfo | (NOTE 4) | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | Ac | tString | (0 to 1) | | | | | cessValue | (NOTE 4) | | | +-----------+-----------+-----------+-----------+-----------+---+ | tServi | Servi | Publi | tPubli | (1 to n) | | | ceProfile | ceProfile | cIdentity | cIdentity | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | CoreN | CoreN | (0 to 1) | | | | | etworkSer | etworkSer | | | | | | vicesAuth | vicesAuth | | | | | | orization | orization | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | Ini | tIni | (0 to n) | | | | | tialFilte | tialFilte | | | | | | rCriteria | rCriteria | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | Extension | tServi | (0 to 1) | | | | | | ceProfile | | | | | | | Extension | | | +-----------+-----------+-----------+-----------+-----------+---+ | tServi | Extension | Share | tShare | (0 to n) | | | ceProfile | | dIFCSetID | dIFCSetID | | | | Extension | | | | | | +-----------+-----------+-----------+-----------+-----------+---+ | tCoreN | CoreN | Subscr | tSubscr | (0 to 1) | | | etworkSer | etworkSer | ibedMedia | ibedMedia | | | | vicesAuth | vicesAuth | ProfileId | ProfileId | | | | orization | orization | | | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | Extension | tCNSer | (0 to 1) | | | | | | vicesAuth | | | | | | | orization | | | | | | | Extension | | | +-----------+-----------+-----------+-----------+-----------+---+ | tPubli | Publi | BarringI | tBool | (0 to 1) | | | cIdentity | cIdentity | ndication | | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | Identity | tIdentity | 1 | | +-----------+-----------+-----------+-----------+-----------+---+ | | | Extension | tPubli | (0 to 1) | | | | | | cIdentity | | | | | | | Extension | | | +-----------+-----------+-----------+-----------+-----------+---+ | tIni | Ini | Priority | tPriority | 1 | | | tialFilte | tialFilte | | | | | | rCriteria | rCriteria | | | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | Tri | tTrigger | (0 to 1) | | | | | ggerPoint | | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | Applicat | tApplicat | 1 | | | | | ionServer | ionServer | | | +-----------+-----------+-----------+-----------+-----------+---+ | | |** Prof | **tProf |**(0 to | | | | | ilePartIn | ilePartIn | 1)**| | | | | dicator** | dicator**| | | +-----------+-----------+-----------+-----------+-----------+---+ | tTrigger | Tri | Conditi | tBool | 1 | | | | ggerPoint | onTypeCNF | | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | SPT | tSePoTri | (1 to n) | | +-----------+-----------+-----------+-----------+-----------+---+ | tSePoTri | SPT | Conditi | tBool | (0 to 1) | | | | | onNegated | | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | Group | tGroupID | (1 to nï€© | | +-----------+-----------+-----------+-----------+-----------+---+ | | | Choice of | R | tString | 1 | | | | | equestURI | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | | Method | tString | 1 | +-----------+-----------+-----------+-----------+-----------+---+ | | | | SIPHeader | tHeader | 1 | +-----------+-----------+-----------+-----------+-----------+---+ | | | | Se | t | 1 | | | | | ssionCase | Direction | | | | | | | OfRequest | | +-----------+-----------+-----------+-----------+-----------+---+ | | | | SessionDe | t | 1 | | | | | scription | SessionDe | | | | | | | scription | | +-----------+-----------+-----------+-----------+-----------+---+ | | |** Ex | **t |**(0 to | | | | | tension**| SePoTriEx | 1)** | | | | | | tension**| | | +-----------+-----------+-----------+-----------+-----------+---+ | tSePoTri | Extension | Registr | tRegistr | (0 to 2) | | | Extension | | ationType | ationType | | | +-----------+-----------+-----------+-----------+-----------+---+ | tHeader | SIPHeader | Header | tString | 1 | | +-----------+-----------+-----------+-----------+-----------+---+ | | | Content | tString | (0 to 1) | | +-----------+-----------+-----------+-----------+-----------+---+ | t | SessionDe | Line | tString | 1 | | | SessionDe | scription | | | | | | scription | | | | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | Content | tString | (0 to 1) | | +-----------+-----------+-----------+-----------+-----------+---+ | tApplicat | Applicat | S | tSIP_URL | 1 | | | ionServer | ionServer | erverName | | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | Defaul | tDefaul | (0 to 1) | | | | | tHandling | tHandling | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | Se | tSe | (0 to 1) | | | | | rviceInfo | rviceInfo | | | +-----------+-----------+-----------+-----------+-----------+---+ | | |** Ex | **tA |**(0 to | | | | | tension**| pplicatio | 1)** | | | | | | nServerEx | | | | | | | tension** | | | +-----------+-----------+-----------+-----------+-----------+---+ | tApplicat | Extension | Incl | tIncl | (0 to 1) | | | ionServer | | udeRegist | udeRegist | | | | Extension | | erRequest | erRequest | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | Inclu | tInclu | (0 to 1) | | | | | deRegiste | deRegiste | | | | | | rResponse | rResponse | | | +-----------+-----------+-----------+-----------+-----------+---+ | tIncl | Incl | (NOTE 2) | (NOTE 2) | (0 to 1) | | | udeRegist | udeRegist | | | | | | erRequest | erRequest | | | | | +-----------+-----------+-----------+-----------+-----------+---+ | tInclu | tInclu | (NOTE 2) | (NOTE 2) | (0 to 1) | | | deRegiste | deRegiste | | | | | | rResponse | rResponse | | | | | +-----------+-----------+-----------+-----------+-----------+---+ | tPubli | Extension | Ide | tIde | (0 to 1) | | | cIdentity | | ntityType | ntityType | | | | Extension | | | | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | Wild | anyURI | (0 to 1) | | | | | cardedPSI | (NOTE 3) | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | Extension | tPublic | (0 to 1) | | | | | | IdentityE | | | | | | | xtension2 | | | +-----------+-----------+-----------+-----------+-----------+---+ | tPublic | Extension | Di | tDi | (0 to 1) | | | IdentityE | | splayName | splayName | | | | xtension2 | | | | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | Al | tAl | (0 to 1) | | | | | iasIdenti | iasIdenti | | | | | | tyGroupID | tyGroupID | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | Extension | tPublic | (0 to 1) | | | | | | IdentityE | | | | | | | xtension3 | | | +-----------+-----------+-----------+-----------+-----------+---+ | tPublic | Extension | Wildc | anyURI | (0 to 1) | | | IdentityE | | ardedIMPU | (NOTE 3) | | | | xtension3 | | | | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | Ser | tSer | (0 to 1) | | | | | viceLevel | viceLevel | | | | | | TraceInfo | TraceInfo | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | Se | Se | (0 to 1) | | | | | rvicePrio | rvicePrio | | | | | | rityLevel | rityLevel | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | Extension | tPublic | (0 to 1) | | | | | | IdentityE | | | | | | | xtension4 | | | +-----------+-----------+-----------+-----------+-----------+---+ | tPublic | Extension | Extende | tExtende | (0 to n) | | | IdentityE | | dPriority | dPriority | | | | xtension4 | | | | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | Extension | tPublic | (0 to 1) | | | | | | IdentityE | | | | | | | xtension5 | | | +-----------+-----------+-----------+-----------+-----------+---+ | tPublic | Extension | MaxNumO | tMaxNumO | (0 to 1) | | | IdentityE | | fAllowedS | fAllowedS | | | | xtension5 | | imultRegi | imultRegi | | | | | | strations | strations | | | +-----------+-----------+-----------+-----------+-----------+---+ | tExtende | Extende | Priority | tPriority | 1 | | | dPriority | dPriority | Namespace | Namespace | | | +-----------+-----------+-----------+-----------+-----------+---+ | | | Prio | tPrio | 1 | | | | | rityLevel | rityLevel | | | +-----------+-----------+-----------+-----------+-----------+---+ | tCNSer | Extension | ListOfS | tListOfS | (0 to 1) | | | vicesAuth | | erviceIds | erviceIds | | | | orization | | | | | | | Extension | | | | | | +-----------+-----------+-----------+-----------+-----------+---+ | tListOfS | ListOfS | ServiceId | tString | (0 to n) | | | erviceIds | erviceIds | | | | | +-----------+-----------+-----------+-----------+-----------+---+ | NOTE 1: | | | | | | | \"n\" | | | | | | | shall be | | | | | | | in | | | | | | | terpreted | | | | | | | as | | | | | | | non | | | | | | | -bounded. | | | | | | | | | | | | | | NOTE 2: | | | | | | | empty | | | | | | | cells | | | | | | | shall be | | | | | | | in | | | | | | | terpreted | | | | | | | as | | | | | | | complex | | | | | | | XML | | | | | | | elements | | | | | | | without | | | | | | | defined | | | | | | | content. | | | | | | | | | | | | | | NOTE 3: | | | | | | | the | | | | | | | syntax of | | | | | | | W | | | | | | | ildcarded | | | | | | | Public | | | | | | | User | | | | | | | Identity | | | | | | | and | | | | | | | W | | | | | | | ildcarded | | | | | | | Service | | | | | | | Identity | | | | | | | shall be | | | | | | | as | | | | | | | described | | | | | | | in 3GPP | | | | | | | TS 23.003 | | | | | | | [17]. | | | | | | | | | | | | | | NOTE 4: | | | | | | | the | | | | | | | syntax of | | | | | | | Ac | | | | | | | cessType, | | | | | | | A | | | | | | | ccessInfo | | | | | | | and | | | | | | | Ac | | | | | | | cessValue | | | | | | | is as | | | | | | | described | | | | | | | in 3GPP | | | | | | | TS 24.229 | | | | | | | [8] for | | | | | | | P-A | | | | | | | ccess-Net | | | | | | | work-Info | | | | | | | header | | | | | | | fields: | | | | | | | A | | | | | | | ccessType | | | | | | | co | | | | | | | rresponds | | | | | | | to the | | | | | | | \"acce | | | | | | | ss-type\" | | | | | | | field | | | | | | | whereas | | | | | | | A | | | | | | | ccessInfo | | | | | | | and | | | | | | | Ac | | | | | | | cessValue | | | | | | | c | | | | | | | orrespond | | | | | | | to the | | | | | | | type and | | | | | | | a | | | | | | | ssociated | | | | | | | value | | | | | | | defined | | | | | | | for the | | | | | | | \"acce | | | | | | | ss-info\" | | | | | | | field. | | | | | | +-----------+-----------+-----------+-----------+-----------+---+
###### ## Annex F (normative): Definition of parameters for service point
trigger matching
Table F.1 defines the parameters that are transported in the user profile XML.
Table F.1: Definition of parameters in the user profile XML
* * *
Tag Description RequestURI RequestURI tag shall include a regular expression
in a form of Extended Regular Expressions (ERE) as defined in chapter 9 in
IEEE 1003.1-2004 Part 1 [13]. For SIP URI, the regular expression shall be
matched against the hostport of the SIP-URI. For definition of SIP-URI and
hostport, see IETF RFC 3261 [11]. For Tel URI, the regular expression shall be
matched against the telephone-subscriber of the telephone-uri. For definition
of telephone-subscriber and telephone-uri, see IETF RFC 3966 [15]. SIPHeader A
SIP Header SPT shall be evaluated separately against each header instance
within the SIP message. The SIP Header SPT matches if at least one header
occurrence matches the SPT. Header (of SIPHeader) Header tag shall include a
regular expression in a form of Extended Regular Expressions (ERE) as defined
in chapter 9 in IEEE 1003.1-2004 Part 1 [13]. The regular expression shall be
matched against the header-name of the SIP header. For definition of header
and header-name, see IETF RFC 3261 [11]. Before matching the header-name to
the pattern, all SWSs shall be removed from the header-name and all LWSs in
the header-name shall be reduced to a single white space character (SP). For
definition of SWS and LWS, see IETF RFC 3261 [11]. Content (of SIPHeader)
Content tag shall include a regular expression in a form of Extended Regular
Expressions (ERE) as defined in chapter 9 in IEEE 1003.1-2004 Part 1 [13]. The
regular expression shall be matched against the header-value of the SIP
header. For definition of header and header-value, see IETF RFC 3261 [11]. If
the SIP header contains several header-values in a comma-separated list, each
of the header-value shall be matched against the pattern for the Content
separately. Before matching the header-value to the pattern, all SWSs shall be
removed from the header-value and all LWSs in the header-value shall be
reduced to a single white space character (SP). For definition of SWS and LWS,
see IETF RFC 3261 [11]. SessionDescription A Session Description SPT shall be
evaluated separately against each SDP field instance within the SIP message.
The Session Description SPT matches if at least one field occurrence matches
the SPT. Line (of SessionDescription) Line tag shall include a regular
expression in a form of Extended Regular Expressions (ERE) as defined in
chapter 9 in IEEE 1003.1-2004 Part 1 [13]. The regular expression shall be
matched against the type of the field inside the session description. For
definition of type, see chapter 6 in IETF RFC 4566 [12]. Content (of
SessionDescription) Content tag shall include a regular expression in a form
of Extended Regular Expressions (ERE) as defined in chapter 9 in IEEE
1003.1-2004 Part 1 [13]. The regular expression shall be matched against the
value of the field inside the session description. For definition of value,
see chapter 6 in IETF RFC 4566 [12].
* * *
###### ## Annex G (normative): Emergency registrations
S-CSCF and HSS shall handle emergency registrations as normal registrations
with the following considerations:
\- Upon emergency registration, following cases apply:
\- If a normal registration for the same user does not exist, the S-CSCF shall
download corresponding user profile from HSS, ensure that the HSS allocates
S-CSCF name to this subscriber and the registration status is set to
UNREGISTERED.
\- Otherwise, the S-CSCF shall ensure that the registration status of the user
is not changed in the HSS.
\- Upon deregistration or expiration of the last normal session, if an
emergency registration is still active for this subscriber, the S-CSCF shall
ensure that the HSS keeps S-CSCF name allocated to this subscriber and the
registration status is set to UNREGISTERED.
\- Upon expiration of an emergency registration, the S-CSCF shall ensure the
registration status of the user is not changed in the HSS if there are other
normal registrations of the user. Otherwise, the S-CSCF may send SAR to the
HSS to remove its name and set the registration status of the user to NOT
REGISTERED.
\- IMS Restoration procedures do not apply for IMS emergency sessions.
###### ## Annex H (normative): Diameter overload control mechanism
## H.1 General
Diameter overload control mechanism is an optional feature.
IETF RFC 7683 [24] specifies a Diameter overload control mechanism which
includes the definition and the transfer of related AVPs between Diameter
nodes.
It is recommended to make use of IETF RFC 7683 02 [24] on the Cx interface
where, when applied, the I/S-CSCF shall behave as reacting nodes and the HSS
as a reporting node.
Depending on regional/national requirements and network operator policy,
priority traffic (e.g. MPS as described in 3GPP TS 22.153 [25]) shall be
exempted from throttling due to Diameter overload control up to the point
where requested traffic reduction cannot be achieved without throttling the
priority traffic.
## H.2 HSS behaviour
The HSS requests traffic reduction from the I/S-CSCF when the HSS is in an
overload situation, including OC-OLR AVP in answer commands as described in
IETF RFC 7683 [24].
The HSS identifies that it is in an overload situation by implementation
specific means. For example, the HSS may take into account the traffic over
the Cx interfaces or other interfaces, the level of usage of internal
resources (CPU, memory), the access to external resources, etc.
The HSS determines the specific contents of OC-OLR AVP in overload reports and
the HSS decides when to send OC-OLR AVPs by implementation specific means.
## H.3 I/S-CSCF behaviour
The I/S-CSCF applies required traffic reduction received in answer commands to
subsequent applicable requests, as per IETF RFC 7683 [24].
The I/S-CSCF achieves requested traffic reduction by implementation specific
means. For example, the I/S-CSCF may implement message throttling with
prioritization or a message retaining mechanism for operations that can be
postponed.
Diameter requests related to priority traffic (e.g. MPS) and emergency,
detected via the presence of priority information (e.g., Resource-Priority
header field for MPS) in SIP messages as described in 3GPP TS 24.229 [8], have
the highest priority. Depending on regional/national regulatory and operator
policies, these Diameter requests shall be the last to be throttled, when the
I/S-CSCF has to apply traffic reduction. Relative priority amongst various
priority traffic (e.g. MPS) and emergency traffic is subject to
regional/national regulatory and operator policies.
###### ## Annex I (Informative): Diameter overload node behaviour
## I.1 Message prioritization
This clause describes possible behaviours of the I/S-CSCF regarding message
prioritisation in an informative purpose.
The I/S-CSCF may take the following into account when making throttling
decisions:
\- Identification of the procedures that can be deferred (e.g. Deregistration
Request), so to avoid to drop non deferrable procedures;
\- Prioritisation of certain types of request (e.g. between MAR and SAR for
S-CSCF, and between LIR and UAR for I-CSCF) according to the context of their
use, in particular:
\- Higher prioritisation of SAR commands for S-CSCF that are related to a
registered user for a service, so to avoid the interruption of the registered
service for the user;
\- Higher prioritisation of LIR commands for I-CSCF that are related to a
requested service different from registration or deregistration, so to get
more originating or terminating services provided to the user;
\- Skipping of optional authentication.
\- Priority level of a priority user (e.g., MPS user).
###### ## Annex J (normative): Diameter message priority mechanism
## J.1 General
IETF draft-ietf-drmp-02 [27] specifies a Diameter message priority mechanism
that allows Diameter nodes to indicate the relative priority of Diameter
messages. With this information, other Diameter nodes may leverage the
relative priority of Diameter messages into routing, resource allocation, and
also abatement decisions when overload control is applied.
## J.2 Cx/Dx interfaces
### J.2.1 General
The Diameter message priority mechanism is an optional feature.
It is recommended to make use of IETF draft-ietf-drmp-02 [27] over the Cx/Dx
interfaces of an operator network when the overload control defined in Annex H
is applied on these Cx/Dx interfaces.
### J.2.2 S-CSCF/I-CSCF behaviour
When the S-CSCF/I-CSCF supports the Diameter message priority mechanism, the
S-CSCF/I-CSCF shall comply with IETF RFC 7944 [27].
The S-CSCF/I-CSCF sending a request shall determine the required priority
according to its policies. When priority is required, the S-CSCF/I-CSCF shall
include the DRMP AVP indicating the required priority level in the request it
sends, and shall prioritise the request according to the required priority
level.
When the S-CSCF/I-CSCF receives the corresponding response, it shall
prioritise the received response according to the priority level received
within the DRMP AVP if present in the response, otherwise according to the
priority level of the corresponding request.
When the S-CSCF/I-CSCF receives a request, it shall handle the request
according to the received DRMP AVP priority level. For the response, it may
modify the priority level received in the DRMP AVP according to its policies
and shall handle the response according to the required priority level. If the
required priority level is different from the priority level received in the
request, it shall include the DRMP AVP in the response.
Diameter requests related to priority traffic (e.g. MPS as identified by the
S-CSCF/I-CSCF through SIP procedures, emergency) shall contain a DRMP AVP with
a high priority of which the level value is operator dependent.
When not-explicitly requested, the inclusion and priority value of the DRMP
AVP in Diameter messages are implementation specific.
### J.2.3 HSS/SLF behaviour
When the HSS/SLF supports the Diameter message priority mechanism, the HSS/SLF
shall comply with IETF RFC 7944 [27].
The HSS/SLF sending a request shall determine the required priority according
to its policies. When priority is required, the HSS/SLF shall include the DRMP
AVP indicating the required priority level in the request it sends, and shall
prioritise the request according to the required priority level.
When the HSS/SLF receives the corresponding response, it shall prioritise the
received response according to the priority level received within the DRMP AVP
if present in the response, otherwise according to the priority level of the
corresponding request.
When the HSS/SLF receives a request, it shall handle the request according to
the received DRMP AVP priority level. For the response, it may modify the
priority level received in the DRMP AVP according to its policies and shall
handle the response according to the required priority level. If the required
priority level is different from the priority level received in the request,
it shall include the DRMP AVP in the response.
When not-explicitly requested, the inclusion and priority value of the DRMP
AVP in Diameter messages are implementation specific.
### J.2.4 Interactions
If the HSS supporting the Diameter message priority mechanism receives the
request message containing both the Session-Priority AVP and DRMP AVP, the HSS
shall prioritize the request according to priority level received within the
DRMP AVP.
#
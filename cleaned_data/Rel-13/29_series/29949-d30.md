# Foreword
This Technical Report has been produced by the 3^rd^ Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document describes end-to-end use cases and signalling flows based
on the roaming architecture for voice over IMS with local breakout. It
summarizes the contents of existing 3GPP technical specifications which are
needed for roaming use cases. The scenarios used cover the following use
cases:
\- registration when roaming;
\- routeing from originating visited network to originating home network;
\- loopback routeing from originating home network to originating visited
network;
\- routeing when the originating and terminating user reside in the same home
network;
\- routeing from the originating home network to the terminating home network;
\- routeing from the originating visited network to the terminating home
network;
\- routeing in terminating home network when user resides in this network;
\- routeing from terminating home network to the terminating visited network;
\- insertion of service related media in the originating home network;
\- routeing through transit networks; and
\- access transfer scenarios (SRVCC).
Editor\'s note: It is ffs if the call forwarding service invocation in a Call
Deflection case will be considered.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or non‑specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.002: \"Network architecture\".
[3] 3GPP TS 23.228: \"IP multimedia subsystem; Stage 2\".
[4] 3GPP TS 24.229: \"IP multimedia call control protocol based on Session
Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".
[5] 3GPP TS 29.079: \"Optimal Media Routeing within the IP Multimedia
Subsystem; Stage 3\".
[6] 3GPP TS 29.165: \"Inter-IMS Network to Network Interface (NNI)\".
[7] 3GPP TR 23.850: \"Study on roaming architecture for voice over IP
Multimedia Subsystem (IMS) with local breakout\" (Release 11).
[8] GSMA IR.92: \"IMS Profile for Voice and SMS\".
[9] IETF RFC 3261: \"SIP: Session Initiation Protocol\".
[10] IETF RFC 1594: \"FYI on Questions and Answers to Commonly asked \"New
Internet User\" Questions\".
[11] Void.
[12] 3GPP TS 23.218: \"IP Multimedia (IM) Session Handling; IM call model\".
[13] IETF RFC 3263: \"Session Initiation Protocol (SIP): Locating SIP
Servers\".
[14] 3GPP TS 29.228: \"IP Multimedia (IM) Subsystem Cx and Dx Interfaces;
Signalling flows and message contents\".
[15] GSMA IR.88: \"LTE Roaming Guidelines\".
[16] 3GPP TS 23.003: \"Numbering, addressing and identification\".
[17] IETF RFC 4282: \"The Network Access Identifier\".
[18] IETF RFC 3966: \"The tel URI for Telephone Numbers\".
[19] IETF RFC 4122: \"A Universally Unique IDentifier (UUID) URN Namespace\".
[20] 3GPP TS 24.237: \"IP Multimedia Subsystem (IMS) Service Continuity; Stage
3\".
[21] IETF RFC 6809: \"Mechanism to Indicate Support of Features and
Capabilities in the Session Initiation Protocol (SIP)\".
[22] 3GPP TS 24.628: \"Common Basic Communication procedures using IP
Multimedia (IM)\".
[23] IETF RFC 3455: \"Private Header (P-Header) Extensions to the Session
Initiation Protocol (SIP) for the 3rd-Generation Partnership Project (3GPP)\".
[24] IETF RFC 2782: \"A DNS RR for specifying the location of services (DNS
SRV)\".
[25] 3GPP TS 32.260: \"Telecommunication management; Charging management; IP
Multimedia Subsystem (IMS) charging\".
[26] IETF RFC 7549: \"3GPP SIP URI Inter Operator Traffic Leg parameter\".
[27] IETF RFC 3323: \"A Privacy Mechanism for the Session Initiation Protocol
(SIP)\".
[28] IETF RFC 3325: \"Private Extensions to the Session Initiation Protocol
(SIP) for Asserted Identity within Trusted Networks\".
[30] 3GPP TS 29.212: \"Policy and Charging Control (PCC); Reference Points\".
[31] 3GPP TS 29.214: \"Policy and charging control over Rx reference Point\".
[32] IETF RFC 3262 (June 2002): \"Reliability of provisional responses in
Session Initiation Protocol (SIP)\".
[33] IETF RFC 3312 (October 2002): \"Integration of resource management and
Session Initiation Protocol (SIP)\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1] and the following apply. A term defined in the present
document takes precedence over the definition of the same term, if any, in
3GPP TR 21.905 [1].
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 24.229 [4] apply:
**Entry point** : In the case that \"border control concepts\", as specified
in 3GPP TS 23.228 [3], are to be applied in an IM CN subsystem, then these are
to be provided by capabilities within the IBCF, and the IBCF acts as an entry
point for this network (instead of the I-CSCF). In this case the IBCF and the
I-CSCF can be co-located as a single physical node. If \"border control
concepts\" are not applied, then the I-CSCF is considered as an entry point of
a network. If the P‑CSCF is in the home network, then the I-CSCF is considered
as an entry point for this document.
**Exit point** : If operator preference requires the application of \"border
control concepts\" as specified in 3GPP TS 23.228 [3], then these are to be
provided by capabilities within the IBCF, and requests sent towards another
network are routed via a local network exit point (IBCF), which will then
forward the request to the other network (discovering the entry point if
necessary).
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.228 [3] subclauses 3.1, 4.3.3.1, 4.3.6, 4.6, 4.13, 5.2,
5.4.12.1 and 5.10 apply:
**Border control concepts**
**Geo-local service number**
**Home local service number**
**Implicit registration set**
**Interconnection Border Control Function (IBCF)**
**Interrogating-CSCF (I-CSCF)**
**IMS Application Level Gateway (IMS-ALG)**
**IMS application reference**
**IMS Application Reference Identifier (IARI)**
**IMS communication service**
**IMS Communication Service Identifier (ICSI)**
**Local service number**
**IP-Connectivity Access Network (IP-CAN)**
**Policy and Charging Rule Function (PCRF)**
**Private user identity**
**Proxy-CSCF (P-CSCF)**
**Public Service Identity (PSI)**
**Public user identity**
**Serving-CSCF (S-CSCF)**
**Statically pre-configured PSI**
For the purposes of the present document, the following terms and definitions
given in IETF RFC 1594 [10] apply:
**Fully-Qualified Domain Name (FQDN)**
For the purposes of the present document, the following terms and definitions
given in IETF RFC 3261 [9] apply:
**Client**
**Dialog**
**Final response**
**Header**
**Header field**
**Loose routeing**
**Method**
**Option-tag**
**Provisional response**
**Proxy, proxy server**
**Recursion**
**Redirect server**
**Registrar**
**Request**
**Response**
**Server**
**Session**
**(SIP) transaction**
**Stateful proxy**
**Stateless proxy**
**Status-code**
**Tag**
**Target Refresh Request**
**User agent client (UAC)**
**User agent server (UAS)**
**User agent (UA)**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.002 [2] clause 4.1.1.1 and clause 4a.7 apply:
**Breakout Gateway Control Function (BGCF)**
**Call Session Control Function (CSCF)**
**Home Subscriber Server (HSS)**
**Location Retrieval Function (LRF)**
**Media Gateway Control Function (MGCF)**
**MSC Server enhanced for IMS centralized services**
**Multimedia Resource Function Controller (MRFC)**
**Multimedia Resource Function Processor (MRFP)**
**Subscription Locator Function (SLF)**
For the purposes of the present document, the following terms and definitions
given in 3GPP TS 23.218 [12] clause 3.1 apply:
**Filter criteria**
**Initial filter criteria**
**Initial request**
**Standalone transaction**
**Subsequent request**
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply. An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
AS Application Server
ATCF Access Transfer Control Function
ATGW Access Transfer Gateway
ATU-STI Access Transfer Update -- Session Transfer Identifier
B2BUA Back-to-Back User Agent
BGCF Breakout Gateway Control Function
CdPty Called Party
C‑MSISDN Correlation MSISDN
EATF Emergency Access Transfer Function
E-CSCF Emergency CSCF
ENUM E.164 telephone NUmber Mapping
FQDN Fully Qualified Domain Name
IARI IMS Application Reference Identifier
IBCF Interconnection Border Control Function
IC Interconnection
ICID IM CN subsystem Charging Identifier
I-CSCF Interrogating CSCF
ICSI IMS Communication Service Identifier
IMS IP Multimedia core network Subsystem
IMSI International Mobile Subscriber Identity
IOI Inter Operator Identifier
LIA Location Information Answer
LIR Location Information Request
LRF Location Retrieval Function
MCC Mobile Country Code
MGCF Media Gateway Control Function
MMTEL Multimedia Telephony
MNC Mobile Network Code
MOC Mobile Originating Call
MPS Multimedia Priority Service
MRFC Multimedia Resource Function Controller
MRFP Multimedia Resource Function Processor
OMR Optimal Media Routeing
PCRF Policy and Charging Rules Function
P-CSCF Proxy CSCF
PS Packed Switched
PSAP Public Safety Answering Point
PSI Public Service Identity
SLA Service Level Agreement
SLF Subscription Locator Function
SCC AS Service Centralization and Continuity AS
S-CSCF Serving CSCF
SRVCC Single Radio Voice Call Continuity
STN-SR Session Transfer Number -- Single Radio
TDM Time Division Multiplex
TRF Transit and Roaming Function
UA User Agent
UAC User Agent Client
UAS User Agent Server
URN Uniform Resource Name
VoLTE Voice over LTE
# 4 Overview
## 4.1 General
This clause summarizes the contents of existing 3GPP technical specifications
relevant for roaming architecture and procedures, describes how to format the
Inter Operator Identifiers in the P-Charging-Vector header field, gives
examples of used identities within the roaming use case and describes how to
determine the II-NNI traversal scenario type.
## 4.2 3GPP specifications relevant for roaming architecture and procedures
This clause describes 3GPP specifications which are relevant for the
implementation of VoLTE IMS roaming.
  1. 3GPP TR 23.850 [7] investigated solutions for the provision of > voice over IMS in roaming scenarios that facilitate the > realization of a charging model that replicates the principles of > CS model. The conclusions of this study were baseline for the > roaming implementation in the 3GPP specifications. This document > has now informational character.
  2. 3GPP TS 23.002 [2] describes the common architecture and the > related interfaces.
  3. 3GPP TS 23.228 [3] describes the IP multimedia subsystem. The > relevant sections which describes the roaming relevant stage 2 > requirements are clause 4.2.3 (support of roaming users), > clause 4.15a (roaming architecture for voice over IMS with local > breakout), clause 5.6.1 ((MO#1) mobile origination, roaming), > clause 5.7.1 ((MT#1) mobile termination, roaming) and > clause 5.7.2a ((MT#3) mobile termination, CS domain roaming).
  4. 3GPP TS 24.229 [4] especially describes the SIP and SDP signalling > procedures for the IMS. The whole document distinguishes within > the text if the procedures are relevant for roaming or non roaming > cases or generally valid. Main sections which are mentioned to be > specific to roaming additions are clause 5.7.1.16 (support of > roaming architecture for voice over IMS with local breakout) and > annex I (additional routeing capabilities in support of transit, > roaming and interconnection traffics in IM CN subsystem).
  5. 3GPP TS 29.079 [5] describes the optimised media routing. Some > roaming scenarios are described in clause 5.7 (roaming > architecture for voice over IMS with local breakout) and in annex > A different roaming scenarios with OMR are shown. Especially > clause A.6 shows roaming case with loopback.
  6. 3GPP TS 29.165 [6] describes the behaviour at the Inter-IMS > Network to Network Interface (II-NNI) consisting of Ici and Izi > reference points between IMS networks in order to support > end-to-end service interoperability. This interface is essential > for roaming.
  7. GSMA IR.92 [8] describes the GSMA profile between UE and network > based on 3GPP specifications.
8\. 3GPP TS 22.153 [29] describes the service requirements for Multimedia
Priority Service (MPS). MPS allows the ability to deliver calls or complete
sessions of a high priority nature from mobile to mobile networks, mobile to
fixed networks, and fixed to mobile networks. For roaming, appropriate
priority information (e.g., marking with the Resource-Priority header field)
across various interfaces is required in IMS CN and between IMS networks in
order to support end-to-end MPS calls. The stage 3 in support of MPS is
specified in (but not limited to): 3GPP TS 24.229 [4], 3GPP TS 29.165 [6],
3GPP TS 29.212 [30] and 3GPP TS 29.214 [31]. In particular, 3GPP TS 24.229 [4]
describes the priority mechanisms and required priority information in SIP for
MPS.
## 4.3 Consideration of SIP header fields and elements
### 4.3.1 Inter Operator Identifier
#### 4.3.1.1 Type of IOI\'s
There are three types of IOI:
1\. type 1 IOI, between the visited network and the home network:
\- between the P-CSCF and the S-CSCF;
\- between the S-CSCF and the TRF;
> \- between the BGCF and the TRF;
>
> \- between the MSC server and the I-CSCF; and
>
> \- between the SCC AS and the ATCF;
2\. type 2 IOI, between the originating network and the terminating network:
\- between the S-CSCF and the S-CSCF;
\- between the S-CSCF and the MGCF when a call/session is terminated at the
PSTN/PLMN;
\- between the MGCF and the S-CSCF of the home terminating network when a
call/session is originated from the PSTN/PLMN;
> NOTE: This includes all scenarios with a PSI AS when accessed across I-CSCF.
\- between the TRF and the S-CSCF;
\- between the E-CSCF and the MGCF or the IBCF where the request is routed to
a PSAP; and
\- between the E-CSCF and the S-CSCF or the IBCF when receiving an emergency
request; and
3\. type 3 IOI:
\- between the S-CSCF or the I-CSCF of the home operator network and any AS;
\- between the E-CSCF and the LRF;
\- between the E-CSCF and the EATF; and
\- between the transit function and the AS.
#### 4.3.1.2 Format of IOI\'s
According to 3GPP TS 24.229 [4] clause 7.2A.5.2.1 the SIP entity generating
type 1 and type 3 IOI values express the \"orig-ioi\" and \"term-ioi\" header
field parameters in the format of a quoted string as specified in IETF RFC
3455 [23] with a specific string prefix being \"Type 1\" and \"Type 3\"
respectively to indicate the type of IOI. For the type 2 IOI, no string prefix
is used. The receiving SIP entity does not perform syntactic checking of the
contents of the IOI values (the IOI value is passed unmodified to the charging
entities).
The following table shows some examples how to format IOI\'s.
Table 4.3.1.2-1: Examples for the format of IOI\'s
* * *
Example Type of IOI Prefix of IOI value Example P-CSCF -- IBCF Type 1 \"Type
1\" \"Type 1visited-A.net\" S-CSCF -- IBCF (terminating path) Type 2 none
\"home-A.net\" S-CSCF - AS Type 3 \"Type 3\" \"Type 3home-A.net\" originating
home network to terminating home network Type 2 none \"home-A.net\"
* * *
#### 4.3.1.3 Basic IMS roaming scenario without loopback
Within this basic approach 3 traversal scenarios exist which are shown in
table 4.3.1.3‑1.
Table 4.3.1.3-1: Traversal scenarios for basic IMS roaming scenario without
loopback
* * *
Traversal scenario Type of IOI Originating visited network -- originating home
network Type 1 Originating home network -- terminating home network Type 2
Terminating home network -- terminating visited network Type 1
* * *
Figure 4.3.1.3-1: IOI information exchange for the \"Basic IMS\" roaming case
with home routing of media
In order to meet the requirements of 3GPP TS 24.229 [4] there needs to be an
IOI exchange including originating IOI, transit IOIs, and terminating IOI for
each of the three signalling paths crossing network boundaries.
#### 4.3.1.4 Originating visited network with loopback routeing scenario
Within the loopback approach 4 traversal scenarios exist which are shown in
table 4.3.1.4‑1.
Table 4.3.1.4-1: Traversal scenarios for \"Originating visited network with
loopback routeing scenario\"
* * *
traversal scenario Type of IOI Originating visited network -- originating home
network Type 1 Originating home network -- originating visited network Type 1
Originating visited network -- terminating home network Type 2 Terminating
home network -- terminating visited network Type 1
* * *
For roaming with loopback the \"Originating visited network with loopback
routing scenario\" introduces the case where the SIP signalling and the media
are routed from the originating visited network to the destination and where
the SIP signalling is first routed to the originating home network for a
service execution and then back to the originating visited network to allow
the originating visited network to route both SIP signalling and media to the
destination.
The complete sequence of IOI exchanges for the IMS roaming scenario with
originating visited network routing option is depicted in figure 4.3.1.4‑1.
Figure 4.3.1.4‑1: IOI exchange for IMS roaming with originating visited
network with loopback routing
In order to meet the requirements of 3GPP TS 24.229 [4] there needs to be an
IOI exchange including originating IOI, transit IOIs, and terminating IOI for
each of four signalling paths crossing network boundaries.
#### 4.3.1.5 Rules for transit-ioi
3GPP TS 24.229 [4] describes that for transit networks based on local policy
the additional routeing function in the transit network adds in requests and
in responses the P-Charging-Vector header field a \"transit-ioi\" header field
parameter with an entry which identifies the operator network which the
request or response is transiting or with a void entry.
When the index is calculated then \"void\" entries are taken into account.
Based on local policy the additional routeing function deletes or void in
requests and in responses in the P-Charging-Vector header field any received
\"transit-ioi\" header field parameter value.
Specific ruling may also apply to IBCF:
1\. IBCF acting as entry point:
Based on local policy, the IBCF acting as an entry point adds in requests in
the P-Charging-Vector header field a \"transit-ioi\" header field parameter
with an entry which identifies the operator network which the request is
transiting or with a void entry.
Based on local policy the IBCF deletes or void in requests in the P-Charging-
Vector header field any received \"transit-ioi\" header field parameter value.
Only one \"transit-ioi\" header field parameter entry is added per transit
network.
2\. IBCF acting as exit point:
Based on local policy, the IBCF acting as an exit point adds in responses in
the P-Charging-Vector header field a \"transit-ioi\" header field parameter
with an entry which identifies the operator network which the response is
transiting or with a void entry.
Based on local policy the IBCF deletes or void in responses in the P-Charging-
Vector header field any received \"transit-ioi\" header field parameter value.
Considering figure 4.3.1.5‑1 either the IBCF-entryA1 in combination with the
IBCF-exitA1 or the transit function can do the setting of the transit-ioi. But
also due to 3GPP TS 24.229 [4], subsection 4.5.4A, the transit function can
control if a transit-ioi will be deleted or voided.
Figure 4.3.1.5‑1: IOI exchange for IMS roaming transit
1\. The IBCF-entryA1 receives an INVITE request containing the \"transit-ioi\"
header field parameter in the P-Charging-Vector header field and sends the
INVITE request towards the transit function.
NOTE 1: If no \"transit-ioi\" header field parameter is included or if the
included \"transit-ioi\" header field parameter is missing a preceeding
interconnection network and the preceding network is an interconnection
network, the IBCF-entryA1 can based on local policy, add the transit-ioi\"
header field parameter with an entry identifying the preceding interconnection
network.
2\. The transit function stores and removes the \"transit-ioi\" header field
parameter from the P-Charging-Vector header field, adds the Relayed-Charge
header field with the content received in the \"transit-ioi\" and forwards the
INVITE request to the AS.
3\. The AS stores the content of the Relayed-Charge header field and sends the
INVITE request to the transit function.
4\. The transit function removes the Relayed-Charge header field and includes
the stored \"transit-ioi\" header field parameter in the P-Charging-Vector
header field. The transit function also appends an entry in the \"transit-
ioi\". Based on local policy, the appended entry can identify the
interconnection network or be set to void. The INVITE request is sent to the
IBCF-exitA1.
NOTE 2: Based on local policy, the transit function can also void entries in
the received \"transit-ioi\" header field parameter.
5\. Upon receipt of a provisional response (in this case the 183 (Session
Progress) response) containing the P-Charging-Vector header field, the IBCF-
exitA1 sends the response to the transit function.
NOTE 3: If no \"transit-ioi\" header field parameter is included or if the
included \"transit-ioi\" header field parameter is missing a preceding
interconnection network and the preceding network is an interconnection
network, the IBCF-exitA1 can based on local policy, add the transit-ioi\"
header field parameter with an entry identifying the preceding interconnection
network.
6\. The transit function stores and removes the \"transit-ioi\" header field
parameter from the P-Charging-Vector header field, adds the Relayed-Charge
header field with the content received in the \"transit-ioi\" and forwards the
183 (Session Progress) response to the AS.
7\. The AS stores the content of the Relayed-Charge header field and sends the
183 (Session Progress) response to the transit function.
8\. The transit function removes the Relayed-Charge header field and includes
the stored \"transit-ioi\" header field parameter in the P-Charging-Vector
header field. The transit function also appends an entry in the \"transit-
ioi\". Based on local policy, the appended entry can identify the
interconnection network or be set to void. The 183 (Session Progress) response
is sent to the IBCF-entryA1.
NOTE 4: Based on local policy, the transit function can also void entries in
the received \"transit-ioi\" header field parameter.
### 4.3.2 Naming of URIs
#### 4.3.2.1 General
3GPP TS 23.003 [16] defines the principal purpose and the use of International
Mobile station Equipment Identities (IMEI) within the digital cellular
telecommunications system and the 3GPP system.
Within the 3GPP TS 23.003 [16] clause 13 the numbering, addressing and
identification within the IP multimedia core network subsystem are described.
This clause gives examples of used identities within the roaming use case. The
normative statements in 3GPP TS 23.003 [16] apply.
#### 4.3.2.2 Home Network Domain
The home network domain name is in the form of an internet domain name, e.g.
operator.com.
3GPP TS 23.003 [16] clause 13.2 describes how to build the home network
domain, if there is no ISIM application.
EXAMPLE: A home network domain name is: IMSI in use with 234150999999999
results in home network domain = ims.mnc015.mcc234.3gppnetwork.org.
#### 4.3.2.3 Private user identity
3GPP TS 23.003 [16] clause 13.3 describes the principles how to build a
private user identity.
The NAI as specified in IETF RFC 4282 [17] clause 2.1 for 3GPP systems with
ISIM application the private user identity is derived from the IMSI.
EXAMPLE: If the IMSI is 234150999999999 (MCC = 234, MNC = 15), the private
user identity then takes the form
\"234150999999999\@ims.mnc015.mcc234.3gppnetwork.org\".
#### 4.3.2.4 Public user identity
3GPP TS 23.003 [16] clause 13.4 describes the principles how to build a public
user identity.
The public user identity takes the form of either a SIP URI (see IETF RFC 3261
[9]) or a tel URI (see IETF RFC 3966 [18]).
According to 3GPP TS 29.165 [6] a global number as defined in IETF RFC 3966
[18] is used in a tel URI or in the user portion of a SIP URI with the
\"user=phone\" parameter when conveyed via a non-roaming II-NNI except when
agreement exists between the operators to also allow other kinds of numbers.
For a roaming II‑NNI no conventions are defined currently.
EXAMPLE 1: SIP URI: sip: +49892233445\@operator.com; user=phone
EXAMPLE 2: SIP URI: sip: +49892233445@ 192.0.2.4; user=phone
EXAMPLE 3: SIP URI: sip: bob\@operator.com
EXAMPLE 4: SIP: tel:+4687197378
#### 4.3.2.5 Instance-ID
3GPP TS 23.003 [16] clause 13.8 describes the principles how to build an
instance-id.
When an IMEI is available, the instance-id takes the form of an IMEI URN. An
example of such an instance-id is as follows:
EXAMPLE 1: urn:gsma:imei:90420156-025763-0
If no IMEI is available, the instance-id takes the form of a string
representation of a UUID as a URN as defined in IETF RFC 4122 [19]. An example
of such an instance-id is as follows:
EXAMPLE 2: urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6
For more information on the instance-id and when it is used, see 3GPP TS
24.229 [4].
### 4.4 Identifying the II-NNI traversal scenario
Dialog creating SIP request and standalone request can optionally contain an
\"iotl\" SIP URI parameter as specified in IETF RFC 7549 [26] and 3GPP TS
24.229 [4] in a Request-URI or in a Route header field. The \"iotl\" SIP URI
parameter can be used to identify the II-NNI traversal scenario. The \"iotl\"
SIP URI parameter is appended to the URI that represents the destination in
CDRs.
One example on how the \"iotl\" SIP URI parameter is included in the Route
header field by the P-CSCF in an originating visited network when sending a
request towards the originating home network is shown below.
EXAMPLE: Route: \,\
If neither the Request-URI nor any of the Route header fields included in the
SIP request contains the \"iotl\" SIP URI parameter, the II-NNI traversal
scenario type can be determined by analysing the content of the SIP request or
using a default II-NNI traversal scenario type. The recommended II-NNI
traversal scenario type default value is \"homeA-homeB\".
NOTE: How the content of the SIP request can be used to determine the II-NNI
traversal scenario is implementation dependent and outside the scope of this
document.
The example use cases in this document assumes that the visited and home
network supports the use of the \"iotl\" SIP URI parameter and the \"iotl\"
SIP URI parameter are included in all coding examples.
### 4.5 Use of preconditions in IMS networks
An IMS UE can use preconditions based on local policy. The preconditions are
defined within IETF RFC 3312 [33]. To process the preconditions IETF RFC 3262
[32] is needed. This IETF RFC 3262 [32] is describing the reliability of
provisional responses which is needed to allow the reliable exchange of an SDP
offer and SDP answer.
All use cases in this document are assuming preconditions. The similar call
flows can appear without the preconditions mechanism.
Since 3GPP TS 24.229 [4] is stating that \"100rel\" option tag are used in
circumstances of the use of preconditions the PRACK/200 OK is not sent in non
precondition cases. Also the UPDATE/200 OK (UPDATE) is not sent since these
messages are used to inform each other about the met resource reservation.
### 4.6 Loopback-indication header field parameter
When there is a desire to send the information that loopback has been applied
to an entity, then the loopback-indication parameter in the P-Charging-Vector
header field is used. This header field parameter can e.g. be evaluated when
processing the P-CSCF CDR and possibly the ATCF CDR to know whether or not to
attempt to locate a correlated TRF CDR even for the non-loopback scenario when
no such CDR exists.
# 5 Description of Scenarios
## 5.1 General
### 5.1.1 Methodology
#### 5.1.1.1 Key required to interpret signalling flow in message coding
examples
Message coding examples are used to describe the contents of SIP messages.
The message coding examples include protocol elements that are of some
interest for the interconnection use cases such as:
a) protocol elements that contain address information (e.g. the Contact header
field);
b) protocol elements that contain routeing information (e.g. the Route,
Record-Route and Via header fields);
c) protocol elements that can be used to identify the use case; and
d) protocol elements that contain particular information of the use case.
Protocol elements that do not fulfil the above criteria are not included in
the message coding examples, even if the protocol element is mandatory to be
included in the SIP message. However, for completeness one or more references
to 3GPP technical specifications are included at the end of the message coding
examples.
The following key (rules) has been applied to each message coding examples to
improve readability, reduce errors and increase maintainability:
a) where a header field in the SIP message coding examples show only the
header name including colon, the contents are identical to the received
request/response. The received request/response is identified as follows:
\- where a request is generated as a result of a received request (as at a
proxy), then the received request is that with the same method name and CSeq
header;
\- where a response is generated as a result of a received response (as at a
proxy), then the received response is that with the same method name and CSeq
header;
\- where the response is generated as a result of a received request or
response (as at an UA), then the received request is that with the same method
name and CSeq header; and
\- where the request is generated as a result of a received response (as at an
UA) then the received response is that immediately previously received;
To enhance readability an indication of the received request/response is
included in the method title, should the received request/response not be the
immediate preceding request/response.
b) the (...) sequence of characters is used to indicate that the Content-
Length field needs to be filled in, with the appropriate value i.e. the number
of bytes in the payload;
c) repeated headers within a message are listed on a single line, with a comma
used as delimiter. This convention is not mandatory but used in this
specification for improved readability;
d) Header fields are listed within a table in the following order:
1) end to end address information header fields (e.g. To and From);
2) header fields that do not include end to end address information (e.g. the
Route, Record-Route and P-Charging-Vector header fields); and
3) Via header fields.
This convention is not mandatory but used in this specification for improved
readability.
e) UDP is always described in the Via header fields as a transport protocol
even if the SIP message is actually longer than 1300 bytes. This convention is
for improving readability and maintainability.
NOTE: According to 3GPP TS 24.229 [4] clause 4.2A, if the SIP message is
longer than 1300 bytes, the IM CN subsystem entities transport the SIP message
using a congestion controlled transport protocol, such as TCP.
#### 5.1.1.2 Functional entities covered in example flows
The flows show the signalling exchanges between the following functional
entities:
\- User Equipment (UE);
\- Proxy‑CSCF (P‑CSCF);
\- Interrogating‑CSCF (I‑CSCF);
\- Serving‑CSCF (S‑CSCF);
\- Interconnection Border Control Function (IBCF);
\- Application Server (AS);
\- Service Centralization and Continuity Application Server (SCC AS);
\- Mobile Switching Centre (MSC);
\- Access Transfer Control Function (ATCF);
\- Transit and Roaming Function (TRF);
\- Media Gateway Control Function (MGCF);
\- Breakout Gateway Control Function (BGCF);
\- Home Subscriber Server (HSS); and
\- SIP proxy or SIP application level gateway (ALG) in interconnection
networks.
NOTE: The SIP proxy is assumed to have an additional routeing functionality
described in 3GPP TS 24.229 [4].
A number of the flows show a check against the filter criteria in the S-CSCF.
A successful check against the filter criteria will involve the introduction
of an application server into the path, operating in a number of different
modes depending on the service provided. This could affect the example flows
as follows:
\- by the addition of extra URLs to a number of header fields, e.g. Via,
Record‑Route, within the flow in which the evaluation of filter criteria
occurs;
\- by the addition of extra URLs to a number of header fields, e.g. Via, Route
in subsequent flows for the same dialog; and
\- by the inclusion of functionality provided by the application server in
this and subsequent flows.
#### 5.1.1.3 Notation conventions
##### 5.1.1.3.1 Introduction
This clause details the notation conventions used in the present document.
##### 5.1.1.3.2 Public user Identities, public service identities and IP
addresses
Table 5.1.1.3.2-1: The public user identities, public service identities and
IP addresses used in message coding examples
+----------------------+----------------------+----------------------+ | | IP address | Public user identity | | | | / public service | | | | identities | +----------------------+----------------------+----------------------+ | UE‑A | [555 | sip:userA_ | | | 5::aaa:bbb:ccc:ddd] | public1\@home-A.net\ | | | | tel:+1-237-555-1111 | | | | (NOTE 1) | +----------------------+----------------------+----------------------+ | Remote UE | [555 | tel:+4687197378 | | | 5::bbb:ccc:ddd:aaa] | | +----------------------+----------------------+----------------------+ | P-CSCF-vA1 | [555 | sip:p | | | 5::ddd:aaa:ccc:bbb] | -cscf\@visited-A.net | +----------------------+----------------------+----------------------+ | S-CSCF-hA1 | [555 | N/A | | | 5::aaa:ccc:eee:aaa] | | +----------------------+----------------------+----------------------+ | SCC AS | N/A | sip:ps2c | | | | s\@sccas1.home-A.net | | | | (NOTE 2) | +----------------------+----------------------+----------------------+ | ATCF | N/A | tel:+12375553333 | | | | (NOTE 3) | +----------------------+----------------------+----------------------+ | IBCF-vA1 | [555 | N/A | | | 5::aaa:bbb:ccc:dd1] | | +----------------------+----------------------+----------------------+ | IC-A1 | [555 | N/A | | | 5::aaa:bbb:ccc:dd2] | | +----------------------+----------------------+----------------------+ | IBCF-hA1 | [555 | N/A | | | 5::aaa:bbb:ccc:dd3] | | +----------------------+----------------------+----------------------+ | IC-T1 | [555 | N/A | | | 5::aaa:bbb:ccc:dd4] | | +----------------------+----------------------+----------------------+ | NOTE 1: The tel | | | | URI | | | | is also used as the | | | | C-MSISDN. | | | | | | | | NOTE 2: The SIP URI | | | | is used as the | | | | ATU-STI during PS to | | | | CS SRVCC access | | | | transfer. | | | | | | | | NOTE 3: The tel URI | | | | is used as the | | | | STN-SR during PS to | | | | CS SRVCC access | | | | transfer. | | | +----------------------+----------------------+----------------------+
##### 5.1.1.3.3 Network Entities
###### 5.1.1.3.3.1 Served user UE‑A\'s associated entities
Table 5.1.1.3.3.1-1: Domain name and FQDN used in message coding examples
* * *
Network Domain name Entity in the network FQDN UE‑A\'s home network home-A.net
S-CSCF serving UE-A scscf-hA1.home-A.net I-CSCF(between proxy and S-CSCF)
icscf-hA1.home-A.net IBCF acting as an entry and exit point between the UE-A's
visited network and the UE-A's home network ibcf-hA1.home-A.net IBCF acting as
an exit point between the UE-A's home network and the remote UE\'s home
network ibcf-hA2.home-A.net AS providing supplementary services as-
hA1.home-A.net AS providing the access transfer service sccas-hA1.home-A.net
UE-A\'s visited network visited-A.net P‑CSCF serving UE‑A pcscf-
vA1.visited-A.net IBCF acting as an entry and exit point between the UE-A's
visited network and the UE-A's home network and IBCF acting as an exit point
between the UE-A\'s visited network and the remote UE\'s home network. ibcf-
vA1.visited-A.net ATCF atcf-vA1.visited-A.net MSC server msc-vA1.visited-A.net
TRF trf-vA1.visited-A.net
* * *
###### 5.1.1.3.3.2 Remote user\'s associated entities
Table 5.1.1.3.3.2-1: Domain name and FQDN used in message coding examples
* * *
Network Domain name Entity in the network FQDN Remote UE\'s home network
home-R.net
* * *
###### 5.1.1.3.3.3 Interconnection networks associated entities
Table 5.1.1.3.3.3-1: Domain name and FQDN used in message coding examples
* * *
Network Domain name Entity in the network FQDN Interconnection network between
the visited network A and the home network A interconnection-A.net SIP proxy
ic-A1.interconnection-A.net Interconnection network between the visited
network A and the remote home network or between the home network A and the
remote home network R interconnection-T.net SIP proxy
ic-T1.interconnection-T.net
* * *
NOTE: Interconnection networks can also be SIP-unawre networks providing only
IP routeing. For the transit through such networks, no SIP proxies or SIP ALGs
in interconnection networks are used. SIP entities in interconnection networks
are shown with dotted lines in the flows to denote that they are optional.
#### 5.1.1.4 IOI values
The IOI names used in the message coding examples are shown in table
5.1.1.4-1.
Table 5.1.1.4-1: The IOI values used in message coding examples
+----------------------------------+----------------------------------+ | Network | IOI name (NOTE 1, NOTE 2, | | | NOTE 3, NOTE 4) | +----------------------------------+----------------------------------+ | Originating visited network | visited-a | +----------------------------------+----------------------------------+ | Originating home network | home-a | +----------------------------------+----------------------------------+ | Terminating visited network | visited-a | +----------------------------------+----------------------------------+ | Terminating home network | home-a | +----------------------------------+----------------------------------+ | Remote UE\'s home network | home-r | +----------------------------------+----------------------------------+ | IC network A | ICa | +----------------------------------+----------------------------------+ | IC network T | ICt | +----------------------------------+----------------------------------+ | NOTE 1: The values for | | | \"orig-ioi\" and \"term-ioi\" | | | header field parameters are | | | encoded in the format of a | | | quoted string. | | | | | | NOTE 2: The value for an entry | | | in \"transit-ioi\" header field | | | parameter contains an indexed | | | value. | | | | | | NOTE 3: The type 1 and type 3 | | | IOIs are prefixed with specific | | | strings (i.e. \"Type1\" and | | | \"Type3\"). | | | | | | NOTE 4: Since the same UE is | | | used as the UE in originating | | | and terminating coding examples | | | the IOI name between the home | | | and visited network will have | | | the same value. | | +----------------------------------+----------------------------------+
## 5.2 Registration when roaming
### 5.2.1 General
This clause describes the registration process of a roaming user including the
traversal of transit network between the visited and the originating home
network.
### 5.2.2 Registration via IC SIP proxies
The registration procedure between the visited network and the home network
uses an IC network which provides SIP proxy nodes to relay SIP traffic between
these networks.
For the registration the UE addresses an FQDN in the home network domain which
reflects the registrar (i.e. the S‑CSCF of the home network). With this FQDN
the IBCF acting as an exit point in the visited network chooses an IC provider
and routes to a SIP proxy of the selected IC provider.
The SIP layer signalling is served by the IC provider's SIP proxy. The SIP
proxy decides on the next SIP proxy towards the home network and routes to the
next SIP proxy or to the IBCF acting as an entry point in the home network, if
no further SIP proxy is required.
NOTE 1: The call flows just show scenarios with a single IC network and a
single SIP proxy.
The user A at UE-A is roaming into a visited network vA. The user A is a
subscriber of operator hA.
Figure 5.2.2-1: Message flow for Registration via IC SIP proxy
**[Call flow details:]{.underline}**
> **1\. REGISTER request (UE-A to P-CSCF-vA1) - see example in table
> 5.2.2-1.**
>
> The user A at UE-A initiates registration. The UE-A sends an initial
> REGISTER request to the P-CSCF‑vA1 according to 3GPP TS 24.229 [4].
Table 5.2.2-1: REGISTER request (UE-A to P-CSCF-vA1)
REGISTER sip:home-A.net SIP/2.0
P-Access-Network-Info: 3GPP-E-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
From: \;tag=4fa3
To: \
Contact: \;reg-id=1;
+sip.instance=\"\\";expires=600000
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
CSeq: 1 REGISTER
Supported: path
Other SIP header fields are set according to 3GPP TS 24.229 [4].
**Request-URI:** The Request-URI sip:home-A.net (the URI that follows the
method name, \"REGISTER\", in the first line) indicates the destination domain
of this REGISTER request which is the home network.
**From: Set to the SIP URI that is the default public user identity of the
user A i.e. userA_public1\@home-A.net.**
**To: Set to the SIP URI that is the default public user identity of the user
A i.e. userA_public1\@home-A.net.**
**Supported: The UE-A inserts the Supported header field containing the
option-tag \"path\".**
> **2\. REGISTER request (P-CSCF-vA1 to IBCF-vA1) - see example in table
> 5.2.2‑2.**
When the P-CSCF-vA1 receives the initial REGISTER request the P‑CSCF-vA1 adds
the P‑Visited‑Network‑ID header field containing the identifier of the P-CSCF
network. This may be the visited network domain name or any other identifier
that identifies the visited network at the home network.
The P-CSCF-vA1 needs to be in the path for all terminating requests for this
user. To ensure this, the P‑CSCF‑vA1 adds itself to the Path header field for
future requests.
The P-CSCF-vA1 selects an IBCF (IBCF-vA1) to be the IBCF acting as an exit
point towards the home network hA of the user A and sends the REGISTER request
according to 3GPP TS 24.229 [4] to IBCF-vA1.
Table 5.2.2-2: REGISTER request (P-CSCF-vA1 to IBCF-vA1)
REGISTER sip:home-A.net SIP/2.0
P-Access-Network-Info: 3GPP-E-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11,
3GPP-E-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11;network-provided;local-
time-zone=\"UTC+01:00\";daylight-saving-time=\"01\"
From:
To:
Contact:
CSeq:
Supported:
Require: path
Path: \
Route: \
P-Visited-Network-ID: \"Visited Network Number A\"
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 1visited-a\"
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565,
SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
...
Other SIP header fields are set according to 3GPP TS 24.229 [4].
**Route: P‑CSCF‑vA1 includes the selected IBCF-vA1 URI.**
**P-Charging-Vector:** The P-CSCF-vA1 provides an ICID value and adds a type 1
\"orig-ioi\" header field parameter with the IOI value identifying the visited
network **(i.e. \"visited‑a\")**.
**Path:** This is the address of the P-CSCF‑vA1 and is included to inform the
S-CSCF where to route terminating requests. The Path header field includes
traffic leg information in the \"iotl\" SIP URI parameter according to IETF
RFC 7549 [26].
**Require:** The P-CSCF-vA adds the Require header field **containing the
option-tag \"path\"** to ensure that the recipient correctly handles the Path
header field. If the recipient does not support the Path header field, a SIP
response will be received with a status code of 420 and an Unsupported header
field indicating **the option-tag** \"path\". Such a response indicates a
wrong configuration of the routing tables and the request has been routed
outside the IM CN subsystem.
**Via: The P‑CSCF‑vA1 adds a Via header field with the address to receive the
response to the REGISTER request.**
**P-Access-Network-Info:** The P-CSCF-vA1 adds a network provided location,
time-zone and daylight saving time. If it doesn\'t indicate that it is a
network provided location, the P-Access-Network-Info header field containing
the location provided by the UE-A is kept in the INVITE request.
> **3\. REGISTER request (IBCF-vA1 to IC-A1) - see example in table 5.2.2-3.**
The IBCF-vA1 receives the initial REGISTER request and analyses the request
line and forwards registration to preferred VoIP IC provider (i.e. to IC A).
The IBCF-vA1 determines the next hop IP address from the request URI either by
configured information or using a DNS query according to IETF RFC 3263 [13].
If the subsequent interconnection network is SIP-aware, the determined IP
address will belong to the SIP proxy IC-A1. Otherwise the determined IP
address will point to IBCF-hA1 and step 4 is skipped (not reflected in message
details below).
The IBCF-vA1 adds its own address to the Path header field.
Table 5.2.2-3: REGISTER request (IBCF-vA1 to IC-A1)
REGISTER sip:home-A.net SIP/2.0
P-Access-Network-Info:
From:
To:
Contact:
CSeq:
Supported:
Require:
Path: \,\
Route: \
P-Visited-Network-ID:
P-Charging-Vector:
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1,
SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565,
SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
...
Other SIP header fields are set according to 3GPP TS 24.229 [4].
**Path** : Based on topology hiding functionality the IBCF-vA1 will either
forward the Path header field with:
\- one visible IBCF-vA1 entry and the remaining collected entries as one
hidden entry. If the SIP URI in the bottommost hidden Path header field
contains an \"iotl\" SIP URI parameter then IBCF-vA1will append an \"iotl\"
SIP URI parameter with the same value to its own SIP URI in the Path header
field; or
\- one IBCF-vA1 entry and the whole content of already collected entries as
visible entries.
**Route: The IBCF-vA1 adds a Route header field identifying the selected node
in the IC network A.**
**Via** : Based on topology hiding functionality the IBCF-vA1 will either
forward the Via header field with:
\- one visible IBCF‑vA1 entry and the remaining collected entries as one
hidden entry; or
\- one IBCF-vA1 entry and the whole content of already collected entries as
visible entries.
> **4\. REGISTER request (IC-A1 to IBCF-hA1) - see example in table 5.2.2‑4.**
NOTE 2: If the subsequent interconnection network is SIP-unaware, step 4 is
skipped (not reflected in message details below).
The IC-A1 receives the initial REGISTER request and analyses the request line
and forwards registration to the IBCF-hA1 of the home network of user A. The
routing could either apply via DSN or any other routeing mechanism.
Table 5.2.2-4: REGISTER request (IC-A1 to IBCF-hA1)
REGISTER sip:home-A.net SIP/2.0
P-Access-Network-Info:
From:
To:
CSeq:
Supported:
Require:
Contact:
Path: \,\,\
Route: \
P-Visited-Network-ID:
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";
orig-ioi=\"Type 1visited-a\";transit-ioi=\"ICa.1\"
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.2,
SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1,
SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565,
SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
...
Other SIP header fields are set according to 3GPP TS 24.229 [4].
> **P-Charging-Vector: In this example the IC-A1 adds the identity of the
> IC-A1 VoIP provider (i.e. \"ICa\") in the \"transit-ioi\" header field
> parameter. However, if the REGISTER request is routed via more than one IC
> VoIP provider network each IC VoIP provider receiving the REGISTER request
> adds a \"transit-ioi\" header field entry containing the IC VoIP provider
> identity.**
>
> **Path:** Based on SLA between IC partners and roaming partners the address
> of the IC-A1 will be added or not added by IC-A1.
>
> **Route:** The IC-A1 adds a Route header field identifying the selected
> entry point in the home network hA.
>
> **Via:** The Via header field is added by each proxy in IC networks, in this
> example the Via header field is only added by IC-A1.
>
> **5\. REGISTER request (IBCF-hA1 to I-CSCF-hA1) - see example in table
> 5.2.2-5.**
The IBCF-hA1 receives the initial REGISTER request and analyses the request
line and forwards registration to the I-CSCF‑hA1. The IBCF-hA1 adds a Route
header field with the address of the I‑CSCF‑hA1 of the home network of user A.
In this example, the IBCF-hA1 does not add any \"transit-ioi\" header field
parameter in the P-Charging-Vector header field. However, the IBCF-hA1 adds
the \"transit-ioi\" header field parameter based on local policy, when the
\"transit-ioi\" identifying the preceding interconnection network is not
included in the received request (e.g. when the preceding interconnection
network is not an IMS transit network).
For performance reasons this I-CSCF‑hA1 could be used only for registration
traffic for roaming user which is due to local policy of the home network
operator.
Table 5.2.2-5: REGISTER request (IBCF-hA1 to I-CSCF-hA1)
REGISTER sip:home-A.net SIP/2.0
P-Access-Network-Info:
From:
To:
Contact:
CSeq:
Supported:
Require:
Path: \,\,\,\
Route: \
P-Visited-Network-ID:
P-Charging-Vector:
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.3,
SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.2,
SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1,
SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565,
SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
...
Other SIP header fields are set according to 3GPP TS 24.229 [4].
**Path:** The IBCF‑hA1 adds a Path header field with the address to receive
terminating dialog creating or stand‑alone requests**.**
**Route: The IBCF-hA1 adds a Route header field identifying the I‑CSCF‑hA1 of
the home network of user A.**
**Via: The IBCF-hA1 adds a Via header field.**
> **6\. REGISTER request (I-CSCF-hA1 to S-CSCF-hA1) - see example in table
> 5.2.2-6.**
The I-CSCF-hA1 receives the REGISTER request and makes a request for
information related to the subscriber registration status by sending the
private user identity, public user identity and visited domain name to the
HSS. The HSS returns the S-CSCF required capabilities and the I-CSCF‑hA1 uses
this information to select a suitable S-CSCF.
Due to the fact that the I-CSCF‑hA1 only identifies the home S-CSCF which is
responsible for the roaming user A, the I-CSCF‑hA1 is not needed for future
requests to be kept in the path, thus an I-CSCF entry is not needed within the
Path header field.
But for the response to the REGISTER message the I-CSCF‑hA1 has to be added in
the Via header field.
Table 5.2.2-6: REGISTER request (I-CSCF-hA1 to S-CSCF-hA1)
REGISTER sip:home-A.net SIP/2.0
P-Access-Network-Info:
From:
To:
Contact:
CSeq:
Supported:
Require:
Path:
Route: \
P-Visited-Network-ID:
P-Charging-Vector:
Via: SIP/2.0/UDP icscf-hA1.home-A.net;branch=z9hG4bK351g45.4,
SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.3,
SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.2,
SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1,
SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565,
SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
...
Other SIP header fields are set according to 3GPP TS 24.229 [4].
> **Route: The I‑CSCF‑hA1 adds the address of the selected S‑CSCF.**
>
> **Via:** The I‑CSCF‑hA1 adds a Via header field with the address to receive
> the response to the REGISTER request.
>
> **7\. 401 (Unauthorized) response (S-CSCF-hA1 to I-CSCF-hA1) - see example
> in table 5.2.2-7.**
As the REGISTER request arrived without integrity protection to the P-CSCF,
the S-CSCF‑hA1 shall challenge the request. For this, the S-CSCF‑hA1 requires
at least one authentication vector to be used in the challenge to the user. If
a valid authentication vector is not available, then the S-CSCF‑hA1 requests
at least one authentication vector from the HSS.
Table 5.2.2-7: 401 (Unauthorized) response (S-CSCF-hA1 to I-CSCF-hA1)
SIP/2.0 401 Unauthorized
Via: SIP/2.0/UDP icscf-hA1.home-A.net;branch=z9hG4bK351g45.4,
SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.3,
SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.2,
SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1,
SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565,
SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
From:
To: \;tag=5ef4
CSeq:
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 1visited-a\";term-ioi=\"Type 1home-a\"
WWW-Authenticate: Digest realm=\"registrar.home-A.net\",
**nonce=\"A34Cm+Fva37UYWpGNB34JP\"** , algorithm=AKAv1-MD5,
ik=\"00112233445566778899aabbccddeeff\",
ck=\"ffeeddccbbaa11223344556677889900\"
Other SIP header fields are set according to 3GPP TS 24.229 [4].
> **P-Charging-Vector:** The P-Charging-Vector header field containing the
> \"orig-ioi\" header field parameter, if received in the REGISTER request and
> a type 1 \"term-ioi\" header field parameter. The S‑CSCF‑hA1 shall set the
> type 1 \"term-ioi\" header field parameter to a value that identifies the
> sending network of the response and the \"orig-ioi\" header field parameter
> is set to the previously received value of \"orig-ioi\" header field
> parameter.\ **The \"icid-value\" header field parameter is set to the
> previously received value of \"icid‑value\" header field parameter in the
> request.**
>
> **WWW-Authenticate:** The S‑CSCF‑hA1 includes the **WWW-Authenticate header
> field** with:\ \- the \"realm\" header field parameter containing a globally
> unique name of the S‑CSCF‑hA1;\ \- the \"nonce\" header field parameter
> containing the quoted string, base64 encoded value of the concatenation of
> the RANDom challenge (RAND) and Authentication TokeN (AUTN) parameters and
> optional server specific data for the UE;\ \- the security mechanism in the
> \"algorithm\" header field parameter;\ \- the Integrity Key parameter for
> the P-CSCF in the \"ik\" header field parameter; and\ \- the Cipher Key
> parameter for the P-CSCF in the \"ck\" header field parameter.
NOTE 3: If the interconnection network is SIP-unaware, step 10 is skipped.
> **8-12. 401 (Unauthorized) response (I-CSCF-hA1 to UE‑A).**
Normal response routing procedure as described within 3GPP TS 24.229 [4]
applies. No specific roaming procedures apply.
NOTE 4: If the interconnection network is SIP-unaware, step 10 is skipped.
> **13-17. REGISTER request (UE-A to I-CSCF-hA1).**
The authentication challenge response is calculated by the UE-A and then put
into the Authorization header field and sent back to the registrar in the
REGISTER request. Procedures are described within 3GPP TS 24.229 [4].
UE‑A registers a second time with an authentication response.
With the exception of the Authorization header field, the CSeq header field
value and the ICID value in the P**‑** Charging**‑** Vector header field, the
REGISTER message will contain the same information and the Path header fields
and the Via header fields will be set as described within steps 1-5 of this
call flow.
NOTE 5: If the interconnection network is SIP-unaware, step 16 is skipped.
> **18\. REGISTER request (I-CSCF-hA1 to S-CSCF-hA1).**
I-CSCF‑hA1 queries IMS-HSS (LIR/LIA) as described within 3GPP TS 29.228 [14]
and routes to the previously assigned S-CSCF‑hA1. It is the same procedure as
described within step 6 of this call flow.
The Path header field will be set as described within step 6 of this call
flow.
> **19-22. 200 OK response (S-CSCF-hA1 to IBCF-vA1) - see example in table
> 5.2.2-19.**
S-CSCF‑hA1 confirms the registration as described within 3GPP TS 24.229 [4].
There are no roaming specific procedures that apply in addition.
The table 5.2.2-19 shows the content of the 200 (OK) response when sent by
S-CSCF‑hA1.
Table 5.2.2-19: 200 OK response (S-CSCF-hA1 to IBCF-vA1)
SIP/2.0 200 OK
Via: SIP/2.0/UDP icscf-hA1.home-A.net;branch=z9hG4bK351g45.4,
SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.3,
SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.2,
SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1,
SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565,
SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
From:
Service-Route: \
To:
CSeq: 2 REGISTER
Contact:
P-Associated-URI: \,\
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 1visited-a\";term-ioi=\"Type 1home-a\"
Path: \,
\,
\,
\
Other SIP header fields are set according to 3GPP TS 24.229 [4].
**Path:** List of Path header field received in the REGISTER request will be
included. (IBCF‑hA1, IC‑A1, IBCF-vA1, P-CSCF-vA1).
**P-Associated-URI:** Containing the list of the registered distinct public
user identity and its associated set of implicitly registered distinct public
user identities. The first URI in the list of public user identities supplied
by the HSS to the S-CSCF will indicate the default public user identity to be
used by the S**‑** CSCF.
**Service-Route:** Contains the SIP URI identifying the S-CSCF (S-CSCF-hA1)
containing an indication that subsequent requests routed via this service
route (i.e. from the P-CSCF to the S‑CSCF). In case network topology hiding is
required by the home network, a visible SIP URI identifying the IBCF
(IBCF‑hA1) will be added by the IBCF acting as an entry point as the topmost
entry and a hidden SIP URI identifying the S‑CSCF (S-CSCF-hA1) in the bottom.
The Service-Route header field includes traffic leg information in the
\"iotl\" SIP URI parameter according to IETF RFC 7549 [26].
**P-Charging-Vector:** The P-Charging-Vector header field containing the
\"orig-ioi\" header field parameter, if received in the REGISTER request and a
type 1 \"term-ioi\" header field parameter. The S‑CSCF‑hA1 shall set the type
1 \"term-ioi\" header field parameter to a value that identifies the sending
network of the response and the \"orig-ioi\" header field parameter is set to
the previously received value of \"orig**‑** ioi\" header field parameter.\
**The \"icid-value\" header field parameter is set to the previously received
value of \"icid‑value\" header field parameter in the request.**
> **23\. 200 OK response (IBCF-vA1 to P-CSCF-vA1).**
If topology hiding is required by the visited network and the IBCF-vA1 applied
topology hiding on the Path and Via header fields contained in the REGISTER
request, the IBCF-vA1 performs a decryption procedure on the received Path and
Via header fields, as described in clause 5.10.4.3of 3GPP TS 24.229 [4], and
inserts a \"+g.3gpp.thig-path\" Feature-Caps header field parameter set to the
same IBCF-vA1\'s SIP URI value as included in the Path header field of the
REGISTER request sent to the home network.
> **24\. 200 OK response (P-CSCF-vA1 to UE-A).**
The P-CSCF-vA1 stores the value of received \"+g.3gpp.thig-path\" Feature-Caps
header field parameter and removes the \"+g.3gpp.thig-path\" Feature-Caps
header field parameter before forwarding the 200 (OK) response to the UE-A.
### 5.2.3 Subscription to the registration-state event package
#### 5.2.3.1 General
After that the registration in clause 5.2.2 is successfully completed the UE
and the P-CSCF subscribes to the registration-state event package as described
in 3GPP TS 24.229 [4].
The difference between the UE-A subscription and the P-CSCF-vA1 subscription
is that the UE-A sends the SUBSCRIBE request using the registration path while
the P-CSCF-vA1 is using the NNI i.e. for the IC network A it will appear as
the SUBSCRIBE request sent by the P-CSCF-vA1 is between two home networks.
NOTE: The message flows in clause 5.2.3.2 and clause 5.2.3.3 are independent
and can be done in parallel.
#### 5.2.3.2 The UE subscribes to the registration-state event package
After that the registration in clause 5.2.2 is successfully completed the UE
subscribes to the registration-state event package as described in 3GPP TS
24.229 [4] clause 5.1.1.3.
Figure 5.2.3.2-1 shows how the UE-A sends the SUBSCRIBE request using the
registration path.
Figure 5.2.3.2-1: Subscription to the registration-state event package by the
UE-A
The steps of the flow are as follows:
**1.** The UE successfully registers as described in clause 5.2.2.
**2\. SUBSCRIBE request (UE-A to P-CSCF-vA1) - see example in table
5.2.3.2-2.**
The UE-A sends the SUBSCRIBE request as specified in 3GPP TS 24.229 [4] using
the registration path created by the registration in clause 5.2.2.
Table 5.2.3.2-2: SUBSCRIBE request (UE-A to P-CSCF-vA1)
SUBSCRIBE sip:userA_public1\@home-A.net SIP/2.0
From: \;tag=4fa3
To: \
Route: \,\
P-Preferred-Identity: \
Contact: \
CSeq: 1 SUBSCRIBE
Event: reg
Expires: 600000
Accept: application/reginfo+xml
P-Access-Network-Info: 3GPP-E-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Other SIP header fields are set according to 3GPP TS 24.229 [4].
> **Request-URI:** Set to the SIP URI that is the default public user identity
> of the user A i.e. userA_public1\@home-A.net.
>
> **From:** Set to the SIP URI that is the default public user identity of the
> user A i.e. userA_public1\@home-A.net.
>
> **To:** Set to the SIP URI that is the default public user identity of the
> user A i.e. userA_public1\@home-A.net.
>
> **Route:** The UE‑A builds a proper preloaded route set for the SUBSCRIBE
> dialog containing the IP address or the FQDN learnt through the P-CSCF
> discovery procedures and P‑CSCF port based on the security mechanism in use.
> In addition the values received in the Service-Route header field saved from
> the 200 (OK) response to the last registration or re-registration of the
> public user identity with associated contact address are added. The content
> of the received Service-Route header filed is due to operator policy. In
> this example only the S‑CSCF‑hA1 (including traffic leg information in the
> \"iotl\" SIP URI parameter according to IETF RFC 7549 [26]) will be
> included.
>
> **P-Preferred-Identity:** Set to the SIP URI that is the default public user
> identity of the user A i.e. userA_public1\@home-A.net.
>
> **Event:** The value of the Event header field is set **to the value \"reg\"
> to specify the use of the registration state package.**
**Accept:** The value of the Accept header field is set **to**
\"application/reginfo+xml\".
**3\. SUBSCRIBE request (P-CSCF-vA1 to IBCF-vA1) -- see example in table
5.2.3.2-3.**
When the P-CSCF-vA1 receives the SUBSCRIBE request and the P-CSCF‑vA1 verifies
that the resulting list of Route header fields matches the list of URIs
received in the Service‑Route header field (during the last successful
registration or re-registration). This verification is done on a per URI
basis, not as a whole string.
The P-CSCF-vA1 selects an IBCF (IBCF-vA1) to be the exit IBCF towards the home
network hA and sends the SUBSCRIBE request according to 3GPP TS 24.229 [4] to
IBCF-vA1.
Table 5.2.3.2-3: SUBSCRIBE request (P-CSCF-vA1 to IBCF-vA1)
SUBSCRIBE sip:userA_public1\@home-A.net SIP/2.0
From:
To:
P-Asserted-Identity: \
Route: \,\
Record-Route: \
Contact:
CSeq:
Event:
Expires:
Accept:
P-Access-Network-Info: 3GPP-E-UTRAN-TDD;utran-cell-id-3gpp=234151D0FCE11,
3GPP-E-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11;
network-provided;local-time-zone=\"UTC+01:00\";daylight-saving-time=\"01\"
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 1visited-a\"
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Other SIP header fields are set according to 3GPP TS 24.229 [4].
> **P-Asserted-Identity:** The value is set to the default public user
> identity i.e. userA_public1\@home-A.net.
>
> **P-Charging-Vector:** The P-CSCF-vA1 adds the P-Charging-Vector header
> field containing a new ICID value in the \"icid\" header field parameter and
> an \"orig-ioi\" header field parameter. The IOI value is of type 1 and
> identifies the visited network vA (i.e. visited-a).
**P-Access-Network-Info:** The P-CSCF adds a network provided location and
daylight saving information. If the received P-Access-Network-Info header
field doesn\'t indicate that it is a network provided location, the P-Access-
Network-Info header field containing the location provided by the UE-A is kept
in the INVITE request.
**Route:** The P-CSCF adds a Route header field identifying the selected IBCF-
vA1.
**Record-Route:** The P-CSCF adds a Record-Route header field.
**Via:** The P-CSCF adds a Via header field.
**4\. SUBSCRIBE request (IBCF-vA1 to IC-A1) -- see example in table
5.2.3.2-4.**
When the IBCF-vA1 receives the SUBSCRIBE request the IBCF-vA1 selects, based
on local policy, to route the SUBSCRIBE request via IC network A and sends the
SUBSCRIBE request according to 3GPP TS 24.229 [4] to the IC-A1. The IBCF-vA1
determines the next hop IP address from the URI in the first Route header
field entry either by configured information or using a DNS query according to
IETF RFC 3263 [13]. If the subsequent interconnection network is SIP-aware,
the determined IP address will belong to the SIP proxy IC-A1. Otherwise the
determined IP address will point to IBCF-hA1 and step 5 is skipped (not
reflected in message details below).
Table 5.2.3.2-4: SUBSCRIBE request (IBCF-vA1 to IC-A1)
SUBSCRIBE sip:userA_public1\@home-A.net SIP/2.0
From:
To:
P-Asserted-Identity:
Route: \,\
Record-Route:\,\
Contact:
CSeq:
Event:
Expires:
Accept:
P-Access-Network-Info:
P-Charging-Vector:
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Other SIP header fields are set according to 3GPP TS 24.229 [4].
**Route:** The IBCF-vA1 adds a Route header field identifying the selected
node in the IC network A.
**Record-Route:** Based on topology hiding functionality the IBCF-vA1 will
either forward the Record-Route header field with:
\- one visible IBCF-vA1 entry and the remaining collected entries as one
hidden entry; or
\- an IBCF-vA1 entry and whole content of already collected entries as visible
entries.
**Via:** Based on topology hiding functionality the IBCF-vA1 will either
forward the Via header field with:
\- one visible IBCF-vA1 entry and the remaining collected entries as one
hidden entry; or
\- an IBCF-vA1 entry and whole content of already collected entries as visible
entries.
**5\. SUBSCRIBE request (IC-A1 to IBCF-hA1) -- see example in table
5.2.3.2-5.**
NOTE 1: If the interconnection network is SIP-unaware, step 5 is skipped (not
reflected in message details below).
When the IC-A1 receives the SUBSCRIBE request the IC-A1 selects an entry point
(IBCF-hA1) of the home network hA and sends the SUBSCRIBE request according to
3GPP TS 24.229 [4] to the IBCF-hA1.
The IC-A1 can add a Route header field pointing to the entry point of the home
network hA. This is shown in the example in table 5.2.3-5.
Table 5.2.3.2-5: SUBSCRIBE request (IC-A1 to IBCF-hA1)
SUBSCRIBE sip:userA_public1\@home-A.net SIP/2.0
From:
To:
P-Asserted-Identity:
Route: \,\
Record-Route: \,\,\
Contact:
CSeq:
Event:
Expires:
Accept:
P-Access-Network-Info:
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 1visited-a\";transit-ioi=\"ICa.1\"
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.2
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Other SIP header fields are set according to 3GPP TS 24.229 [4].
> **P-Charging-Vector:** The IC-A1 adds the \"transit-ioi\" header field
> parameter identifying the interconnection network (i.e. ICa.1).
**Route:** The IC-A1 adds a Route header field identifying the selected entry
point in the home network hA.
**Record-Route:** Based on interconnection operator SLA the IC-A1 adds an
entry to the Record-Route header field or not.
**Via:** The IC-A1 adds a Via header field.
**6\. SUBSCRIBE request (IBCF-hA1 to S-CSCF-hA1) -- see example in table
5.2.3.2-6.**
When the IBCF-hA1 receives the SUBSCRIBE request the IBCF-hA1 sends the
SUBSCRIBE request according to 3GPP TS 24.229 [4] to the S-CSCF-hA1.
In this example, the IBCF-hA1 does not add any \"transit-ioi\" header field
parameter in the P-Charging-Vector header field. However, the IBCF-hA1 adds
the \"transit-ioi\" header field parameter based on local policy, when the
\"transit-ioi\" identifying the preceding interconnection network is not
included in the received request (e.g. when the preceding interconnection
network is not an IMS transit network).
Table 5.2.3.2-6: SUBSCRIBE request (IBCF-hA1 to S-CSCF-hA1)
SUBSCRIBE sip:userA_public1\@home-A.net SIP/2.0
From:
To:
P-Asserted-Identity:
Route: \
Record-Route: \,\,\,\
Contact:
CSeq:
Event:
Expires:
Accept:
P-Access-Network-Info:
P-Charging-Vector:
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.3
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.2
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Other SIP header fields are set according to 3GPP TS 24.229 [4].
> **Via:** The IBCF-hA1 adds a Via header field.
>
> **Record-Route:** The IBCF-hA1 adds a Record-Route header field.
**7-11. 200 (OK) response (S-CSCF-hA1 to UE-A).**
The S-CSCF-hA1 acknowledges a successful subscription to the registration-
state event package where:
\- the S-CSCF-hA1 includes a P-Charging-Vector header field containing the
same ICID value and \"orig-ioi\" header field parameter as received in the
SUBSCRIBE request. In addition the S-CSCF-hA1 adds the \"term**‑** ioi\"
header field parameter with the IOI value set to a value identifying the home
network A (i.e. home**‑** a).
\- the IC-A1 adds to the P-Charging-Vector header field the \"transit-ioi\"
set to a value identifying the interconnection network (i.e. ICa.1).
NOTE 2: If the interconnection network is SIP-unaware, step 9 is skipped.
**12\. NOTIFY request (S-CSCF-hA1 to IBCF-hA1) -- see example in table
5.2.3.2-12.**
The S-CSCF-hA1 immediately after sending the 200 (OK) to the SUBSCRIBE request
sends a NOTIFY request containing the registration-state event package in an
application/reginfo+xml MIME body.
The NOTIFY request is sent along the path created by the routes received in
the Record-Route header field.
Table 5.2.3.2-12: NOTIFY request (S-CSCF-hA1 to IBCF-hA1)
NOTIFY sip:[5555::aaa:bbb:ccc:ddd] SIP/2.0
To:\
From:\;tag=3fa5
Route:\,\,\,\
Call-ID:cb03a0s09a2sdfglkj490333
CSeq:25 NOTIFY
Contact:sip:[5555::aaa:ccc:eee:aaa]
Event:reg
Subscription-State:active;expires=600000
P-Charging-Vector:icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=45678901\";orig-
ioi=\"Type 1home-a\"
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK23456.1
Content-Type:application/reginfo+xml
Content-Length:(...)
For an example of the content of the SDP application/reginfo+xml see 3GPP TS
24.229 [4] subclause 5.4.2.1.2.
Other SIP header fields are set according to 3GPP TS 24.229 [4].
> **Request-URI:** The S-CSCF-hA1 uses the contact address of the UE received
> during registration as the Request-URI.
>
> **Route:** The routes in the Record-Route header field are used as the route
> set.
>
> **Event:** The S-CSCF-hA1 adds the Event header field **containing the**
> \"reg\" value.
>
> **Subscription-State:** The S-CSCF-hA1 adds the Subscription-State header
> field **set to** \"active\" and indicates the expiration time in the
> \"expires\" header field parameter.
>
> **P-Charging-Vector:** The S-CSCF-hA1 adds the P-Charging-Vector header
> field containing a new ICID value and the \"ioi-orig\" header field
> parameter set to a type 1 IOI value (i.e. home-A).
>
> **Via:** The S-CSCF-hA1 adds a Via header field.
>
> **Content-Type:** The S-CSCF-hA1 sets the value of the Content-Type header
> field **to** \"application/reginfo+xml\".
**13\. NOTIFY request (IBCF-hA1 to IC-A1) -- see example in table
5.2.3.2-13.**
The IBCF-hA1 sends the NOTIFY request according to 3GPP TS 24.229 [4] to the
IC-A1.
NOTE 3: If the subsequent interconnection network is SIP-unaware, the IBCF-hA1
sends the NOTIFY request according to 3GPP TS 24.229 [4] to the IBCF-vA1 (not
reflected in message details below).
Table 5.2.3.2-13: NOTIFY request (IBCF-hA1 to IC-A1)
NOTIFY sip:[5555::aaa:bbb:ccc:ddd] SIP/2.0
To:
From:
Route:\,\,\
Record-Route: \
Call-ID:
CSeq:
Contact:
Event:
Subscription-State:
P-Charging-Vector:
Via:SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK23456.2
Via:SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK23456.1
Content-Type:
Content-Length: (...)
For an example of the content of the SDP application/reginfo+xml see 3GPP TS
24.229 [4] subclause 5.4.2.1.2.
Other SIP header fields are set according to 3GPP TS 24.229 [4].
**Record-Route:** The IBCF-hA1 adds a Record-Route header field.
**Via:** Based on topology hiding functionality the IBCF-hA1 will either
forward the Via header field with:
\- one visible IBCF-hA1 entry and the remaining collected entries as one
hidden entry; or
\- an IBCF-hA1 entry and whole content of already collected entries as visible
entries.
**14\. NOTIFY request (IC-A1 to IBCF-vA1) -- see example in table
5.2.3.2-14.**
NOTE 4: If the interconnection network is SIP-unaware, step 14 is skipped (not
reflected in message details below).
The IC-A1 sends the NOTIFY request according to 3GPP TS 24.229 [4] to the
IBCF-vA1.
Table 5.2.3.2-14: NOTIFY request (IC-A1 to IBCF-vA1)
NOTIFY sip:[5555::aaa:bbb:ccc:ddd] SIP/2.0
To:
From:
Route:\,\
Record-Route: \,\
Call-ID:
CSeq:
Contact:
Event:
Subscription-State:
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=45678901\";orig-
ioi=\"Type 1home-a\";transit-ioi=\"ICa.1\"
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK23456.3
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK23456.2
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK23456.1
Content-Type:
Content-Length: (...)
For an example of the content of the SDP application/reginfo+xml see 3GPP TS
24.229 [4] subclause 5.4.2.1.2.
Other SIP header fields are set according to 3GPP TS 24.229 [4].
> **P-Charging-Vector:** The **IC-A1 adds the \"transit-ioi\" header field
> parameter identifying the interconnection network (i.e. ICa.1).**
**Record-Route:** The IC-A1 adds a Record-Route header field.
**Via:** The IC-A1 adds a Via header field.
**15\. NOTIFY request (IBCF-vA1 to P-CSCF-vA1) -- see example in table
5.2.3.2-15.**
The IBCF-vA1 sends the NOTIFY request according to 3GPP TS 24.229 [4] to the
P-CSCF-vA1.
In this example, the IBCF-**v** A1 does not add any \"transit-ioi\" header
field parameter in the P-Charging-Vector header field. However, the IBCF-**v**
A1 adds the \"transit-ioi\" header field parameter based on local policy, when
the \"transit-ioi\" identifying the preceding interconnection network is not
included in the received request (e.g. when the preceding interconnection
network is not an IMS transit network).
Table 5.2.3.2-15: NOTIFY request (IBCF-vA1 to P-CSCF-vA1)
NOTIFY sip:[5555::aaa:bbb:ccc:ddd] SIP/2.0
To:
From:
Route:\
Record-Route:\,\,\
Call-ID:
CSeq:
Contact:
Event:
Subscription-State:
P-Charging-Vector:
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK23456.4
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK23456.3
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK23456.2
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK23456.1
Content-Type:
Content-Length: (...)
For an example of the content of the SDP application/reginfo+xml see 3GPP TS
24.229 [4] subclause 5.4.2.1.2.
Other SIP header fields are set according to 3GPP TS 24.229 [4].
> **Record-Route: The** IBCF**-vA1 adds a Record-Route header field.**
>
> **Via:** The IBCF**-vA1** adds a Via header field.
**16\. NOTIFY request (P-CSCF-vA1 to UE-A) -- see example in table
5.2.3.2-16.**
The P-CSCF-vA1 removes the protocol elements that cannot be sent to outside
the trust domain (e.g. the P**‑** Charging**‑** Vector) and sends the NOTIFY
request according to 3GPP TS 24.229 [4] to the UE-A.
Table 5.2.3.2-16: NOTIFY request (P-CSCF-vA1 to UE-A)
NOTIFY sip:[5555::aaa:bbb:ccc:ddd] SIP/2.0
To:
From:
Record-Route:\,\,\,\
Call-ID:
CSeq:
Contact:
Event:
Subscription-State:
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net;branch=z9hG4bK23456.5
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK23456.4
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK23456.3
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK23456.2
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK23456.1
Content-Type:
Content-Length: (...)
For an example of the content of the SDP application/reginfo+xml see 3GPP TS
24.229 [4] subclause 5.4.2.1.2.
Other SIP header fields are set according to 3GPP TS 24.229 [4].
**Record-Route:** The P-CSCF-vA1 adds a Record-Route header field.
**Via:** The P-CSCF-vA1 adds a Via header field.
**17-21. 200 (OK) response (UE-A to S-CSCF-hA1).**
The UE-A acknowledges the receipt of the NOTIFY request where:
\- the P-CSCF-vA1 includes a P-Charging-Vector header field containing the
same ICID value and \"orig-ioi\" header field parameter as received in the
NOTIFY request. In addition the P-CSCF-vA1 adds the \"term-ioi\" header field
parameter with the IOI value set to a value identifying the visited network A
(i.e. visited-a).
\- the IC-A1 adds to the P-Charging-Vector header field the \"transit-ioi\"
set to a value identifying the interconnection network (i.e. ICa.1).
NOTE 5: If the interconnection network is SIP-unaware, step 20 is skipped.
#### 5.2.3.3 The P-CSCF subscribes to the registration-state event package
After that the registration in clause 5.2.2 is successfully completed the
P-CSCF-vA1 subscribes to the registration-state event package as described in
3GPP TS 24.229 [4] clause 5.2.3.
The information received in the registration-state event package can be used
by the P-CSCF to determine if a registration is still valid.
Figure 5.2.3.3-1 shows how the P-CSCF-vA1 sends the SUBSCRIBE request without
using the registration path hence it will appear as the SUBSCRIBE request is
sent between two home networks.
Figure 5.2.3.3-1: Subscription to the registration-state event package by the
P-CSCF-vA1
The steps of the flow are as follows:
**1.** The UE successfully registers as described in clause 5.2.2.
**2\. SUBSCRIBE request (P-CSCF-vA1 to IBCF-vA1) - see example in table
5.2.3.3-2.**
When the registration is successfully completed, i.e. the 200 (OK) to the
REGISTER request sent is to the UE-A) the P-CSCF-vA1 subscribes to the
registration-state event package in the home network hA.
The P-CSCF-vA1 selects an IBCF (IBCF-vA1) to be the IBCF acting as the exit
point towards the home network hA and forwards a SUBSCRIBE request according
to 3GPP TS 24.229 [4] to the IBCF-vA1.
Table 5.2.3.3-2: SUBSCRIBE request (P-CSCF-vA1 to IBCF-vA1)
SUBSCRIBE sip:userA_public1\@home-A.net;iotl=visitedA-homeA SIP/2.0
From:\;tag=4ea2
To:\
P-Asserted-Identity: \
Route: \
Contact:\
CSeq: 36 SUBSCRIBE
Event:reg
Expires:600000
Accept:application/reginfo+xml
P-Access-Network-Info:3GPP-E-UTRAN-TDD; utran-cell-
id-3gpp=234151D0FCE11;network-provided;local-time-zone=\"UTC+01:00\";daylight-
saving-time=\"01\"
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=5467327\";orig-
ioi=\"Type 1visited-a\"
Via: SIP/2.0/UDP [5555::ddd:aaa:ccc:bbb];branch=z9hG4bKnas12baad
Other SIP header fields are set according to 3GPP TS 24.229 [4].
> **Request-URI:** Set to the default public user identity of the user, i.e.
> userA_public1\@home-A.net. P-CSCF appends traffic leg information in the
> \"iotl\" SIP URI parameter according to IETF RFC 7549 [26].
>
> **From:** Set to the P-CSCF\'s SIP URI.
>
> **To:** Set to the SIP URI that is the default public user identity of the
> user i.e. userA_public1\@home-A.net.
>
> **P-Asserted-Identity:** Set to the value of the received \"+g.3gpp.thig-
> path\" Feature-Caps header field parameter if the received 200 (OK) response
> to the REGISTER request contained a \"+g.3gpp.thig-path\" Feature-Caps
> header field parameter or otherwise, as shown in this example, to the SIP
> URI of the P-CSCF, which was inserted into the Path header field during the
> registration of the user to whose registration state the P-CSCF subscribes
> to.
>
> **Event:** The value of the Event header field is set **to the value \"reg\"
> to specify the use of the registration state package.**
>
> **Accept:** The value of the Accept header field is set **to**
> \"application/reginfo+xml\".
>
> **P-Access-Network-Info:** The P-CSCF adds the P-Access-Network-Info header
> field with a network provided location and daylight saving information.
>
> **P-Charging-Vector:** The P-CSCF-vA1 includes an ICID value and a type 1
> \"orig-ioi\" header field parameter. The P-CSCF-vA1 shall set the type 1
> \"orig-ioi\" header field parameter to a value that identifies the sending
> network of the request (i.e. visited-A).
**3\. SUBSCRIBE request (IBCF-vA1 to IC-A1) - see example in table
5.2.3.3-3.**
When the IBCF-vA1 receives the SUBSCRIBE request the IBCF-vA1 selects, based
on local policy, to route the SUBSCRIBE request via IC network A and sends the
SUBSCRIBE request according to 3GPP TS 24.229 [4] to the IC-A1. The IBCF-vA1
determines the next hop IP address from the URI in the first entry of the
Route header field either by configured information or using a DNS query
according to IETF RFC 3263 [13]. If the subsequent interconnection network is
SIP-aware, the determined IP address will belong to the SIP proxy IC-A1.
Otherwise the determined IP address will point to IBCF-hA1 and step 4 is
skipped (not reflected in message details below).
Table 5.2.3.3-3: SUBSCRIBE request (IBCF-vA1 to IC-A1)
SUBSCRIBE sip:userA_public1\@home-A.net;iotl=visitedA-homeA SIP/2.0
From:
To:
P-Asserted-Identity:
Route: \
Record-Route:\
Contact:
CSeq:
Event:
Expires:
Accept:
P-Access-Network-Info:
P-Charging-Vector:
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bKnas12baad.1
Via: SIP/2.0/UDP [5555::ddd:aaa:ccc:bbb];branch=z9hG4bKnas12baad
Other SIP header fields are set according to 3GPP TS 24.229 [4].
> **Route:** The IBCF-vA1 adds a Route header field identifying the selected
> node in the IC network A.
>
> **Record-Route:** The IBCF-vA1 adds a Record-Route header field.
>
> **Via:** Based on topology hiding functionality the IBCF-vA1 will either
> forward the Via header field with:
\- one visible IBCF-vA1 entry and the remaining collected entries as one
hidden entry; or
\- one IBCF-vA1 entry and the whole content of already collected entries as
visible entries.
**4\. SUBSCRIBE request (IC-A1 - to IBCF-hA1) - see example in table
5.2.3.3-4.**
NOTE 1: If the interconnection network is SIP-unaware, step 4 is skipped (not
reflected in message details below).
The IC-A1 selects an entry point (IBCF-hA1) of the home network hA and sends
the SUBSCRIBE request according to 3GPP TS 24.229 [4] to the IBCF-hA1.
The IC-A1 may add a Route header field entry pointing to the entry point of
home network hA. This is shown in example in table 5.3.3.3-4.
Table 5.2.3.3-4: SUBSCRIBE request (IC-A1 - to IBCF-hA1)
SUBSCRIBE sip:userA_public1\@home-A.net;iotl=visitedA-homeA SIP/2.0
From:
To:
P-Asserted-Identity:
Route: \
Record-Route:\,\
Contact:
CSeq:
Event:
Expires:
Accept:
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=5467327\";orig-
ioi=\"Type 1visited-a\";transit-ioi=\"ICa.1\"
P-Charging-Vector:
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bKnas12baad.2
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bKnas12baad.1
Via: SIP/2.0/UDP [5555::ddd:aaa:ccc:bbb];branch=z9hG4bKnas12baad
Other SIP header fields are set according to 3GPP TS 24.229 [4].
> **P-Charging-Vector: The** IC-A1 **adds the \"transit-ioi\" header field
> parameter identifying the interconnection network (i.e. ICa.1).**
>
> **Route:** The IC-A1 adds a Route header field identifying the selected
> entry point in the home network hA.
>
> **Record-Route:** Based on interconnection operator SLA the IC-A1 adds an
> entry to the Record-Route header field or not.
>
> **Via:** The IC-A1 adds a Via header field.
**5\. SUBSCRIBE request (IBCF-hA1 to I-CSCF-hA1) - see example in table
5.2.3.3-5.**
The IBCF-hA1 receives the SUBSCRIBE request and analyses the request line and
the request to the I-CSCF‑hA1. The IBCF-hA1 adds a Route header field with the
address of the I‑CSCF‑hA1 of the home network of user A.
In this example, the IBCF-hA1 does not add any \"transit-ioi\" header field
parameter in the P-Charging-Vector header field. However, the IBCF-hA1 adds
the \"transit-ioi\" header field parameter based on local policy, when the
\"transit-ioi\" identifying the preceding interconnection network is not
included in the received request (e.g. when the preceding interconnection
network is not an IMS transit network).
Table 5.2.3.3-5: SUBSCRIBE request (IBCF-hA1 to I-CSCF-hA1)
SUBSCRIBE sip:userA_public1\@home-A.net;iotl=visitedA-homeA SIP/2.0
From:
To:
P-Asserted-Identity:
Route: \
Record-Route:\,\,\
Contact:
CSeq:
Event:
Expires:
Accept:
P-Access-Network-Info:
P-Charging-Vector:
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bKnas12baad.3
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bKnas12baad.2
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bKnas12baad.1
Via: SIP/2.0/UDP [5555::ddd:aaa:ccc:bbb];branch=z9hG4bKnas12baad
Other SIP header fields are set according to 3GPP TS 24.229 [4].
> **Via:** The IBCF-hA1 adds a Via header field.
>
> **Route:** The IBCF-hA1 adds a Route header field with the address of the
> I‑CSCF‑hA1 of the home network of user A.
>
> **Record-Route:** The IBCF-hA1 adds a Record-Route header field.
**6\. SUBSCRIBE request (I-CSCF-hA1 to S-CSCF-hA1) - see example in table
5.2.3.3-6.**
The I-CSCF-hA1 receives the SUBSCRIBE request and makes a request for
information related to the subscriber registration status by sending the
public user identity and visited domain name to the HSS. The HSS returns the
S**‑** CSCF address.
Due to the fact that the I-CSCF‑hA1 only identifies the home S-CSCF which is
responsible for the roaming user A, the I-CSCF‑hA1 is not needed for future
requests to be kept in the path, thus an I-CSCF entry is not needed within the
Record-Route header field.
But for the response to the SUBCRIBE request the I-CSCF‑hA1 has to be added in
the Via header field.
Table 5.2.3.3-6: SUBSCRIBE request (I-CSCF-hA1 to S-CSCF-hA1)
SUBSCRIBE sip:userA_public1\@home-A.net;iotl=visitedA-homeA SIP/2.0
From:
To:
P-Asserted-Identity:
Route: \
Record-Route:\,\,\
Contact:
CSeq:
Event:
Expires:
Accept:
P-Access-Network-Info:
P-Charging-Vector:
Via: SIP/2.0/UDP icscf-hA1.home-A.net;branch=z9hG4bKnas12baad.4
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bKnas12baad.3
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bKnas12baad.2
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bKnas12baad.1
Via: SIP/2.0/UDP [5555::ddd:aaa:ccc:bbb];branch=z9hG4bKnas12baad
Other SIP header fields are set according to 3GPP TS 24.229 [4].
> **Route: The I‑CSCF‑** hA1 **adds the address of the selected S‑CSCF.**
>
> **Via:** The I-CSCF-hA1 adds a Via header field.
**7-11. 200 (OK) response (S-CSCF to P-CSCF-vA1).**
The S-CSCF-hA1 acknowledges a successful subscription to the registration-
state event package where:
\- the S-CSCF-hA1 includes a P-Charging-Vector header field containing the
ICID value and \"orig-ioi\" header field parameter as received in the
SUBSCRIBE request. In addition the S-CSCF-hA1 adds the \"term-ioi\" header
field parameter with the IOI value set to a value identifying the home network
A (i.e. home-a); and
\- the IC-A1 adds to the P-Charging-Vector header field the \"transit-ioi\"
set to a value identifying the interconnection network (i.e. \"ICa.1\").
NOTE 2: If the interconnection network is SIP-unaware, step 10 is skipped.
**12\. NOTIFY request (S-CSCF-hA1 to IBCF-hA1) - see example in table
5.2.3.3-12.**
The S-CSCF-hA1 immediately after sending the 200 (OK) to the SUBSCRIBE request
sends a NOTIFY request containing the registration-state event package in an
application/reginfo+xml MIME body.
The NOTIFY request is sent along the path created by the routes received in
the Record-Route header field.
Table 5.2.3.3-12: NOTIFY request (S-CSCF-hA1 to IBCF-hA1)
NOTIFY sip:[5555::ddd:aaa:ccc:bbb] SIP/2.0
To:\;tag=4ea2
From:\;tag=3e1f
Route:\,\,\
CSeq:35 NOTIFY
Contact:\
Event:reg
Subscription-State:active;expires=600000
P-Charging-Vector:icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=45678901\";orig-
ioi=\"Type 1home-a\"
Via: SIP/2.0/UDP [5555::aaa:ccc:eee:aaa];branch=z9hG4bK23456
Content-Type:application/reginfo+xml
Content-Length:(...)
For an example of the content of the SDP application/reginfo+xml see 3GPP TS
24.229 [4] subclause 5.4.2.1.2.
Other SIP header fields are set according to 3GPP TS 24.229 [4].
> **Request-URI:** Set to the contact address of the P-CSCF-vA1.
>
> **Route:** The routes in the Record-Route header field are used as the route
> set.
>
> **Event:** The S-CSCF-hA1 adds the Event header field **containing the**
> \"reg\" value.
>
> **Subscription-State:** The S-CSCF-hA1 adds the Subscription-State header
> field **set to** \"active\" and indicates the expiration time in the
> \"expires\" header field parameter.
>
> **P-Charging-Vector:** A new ICID value (i.e. different from the ICID value
> in the SUBSCRIBE request) and a type 1 \"orig-ioi\" header field parameter.
> The S-CSCF-hA1 shall set the type 1 \"orig-ioi\" header field parameter to a
> value that identifies the sending network of the request (i.e. home-A).
>
> **Via:** The S-CSCF-hA1 adds a Via header field.
>
> **Content-Type:** The S-CSCF-hA1 sets the value of the Content-Type header
> field **to** \"application/reginfo+xml\".
**13\. NOTIFY request (IBCF-hA1 to IC-A1) - see example in table 5.2.3.3-13.**
The IBCF-hA1 sends the NOTIFY request according to 3GPP TS 24.229 [4] to the
IC-A1.
NOTE 3: If the subsequent interconnection network is SIP-unaware, the IBCF-hA1
sends the NOTIFY request according to 3GPP TS 24.229 [4] to the IBCF-vA1 (not
reflected in message details below).
Table 5.2.3.3-13: NOTIFY request (IBCF-hA1 to IC-A1)
NOTIFY sip:[5555::ddd:aaa:ccc:bbb] SIP/2.0
To:
From:
Route:\,\
Record-Route:\
CSeq:
Contact:
Event:
Subscription-State:
P-Charging-Vector:
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK23456.1
Via: SIP/2.0/UDP [5555::aaa:ccc:eee:aaa];branch=z9hG4bK23456
Content-Type:
Content-Length:(...)
For an example of the content of the SDP application/reginfo+xml see 3GPP TS
24.229 [4] subclause 5.4.2.1.2.
Other SIP header fields are set according to 3GPP TS 24.229 [4].
> **Record-Route:** **The IBCF-** hA1 **adds a Record-Route header field.**
>
> **Via:** Based on topology hiding functionality the IBCF-hA1 will either
> forward the Via header field with:
\- one visible IBCF-hA1 entry and the remaining collected entries as one
hidden entry; or
\- one IBCF-hA1 entry and the whole content of already collected entries as
visible entries.
**14\. NOTIFY request (IC-A1 to IBCF-vA1) - see example in table 5.2.3.3-14.**
NOTE 4: If the interconnection network is SIP-unaware, step 14 is skipped (not
reflected in message details below).
The IC-A1 sends the NOTIFY request according to 3GPP TS 24.229 [4] to the
IBCF-vA1.
Table 5.2.3.3-14: NOTIFY request (IC-A1 to IBCF-vA1)
NOTIFY sip:[5555::ddd:aaa:ccc:bbb] SIP/2.0
To:
From:
Route:\
Record-Route:\,\
CSeq:
Contact:
Event:
Subscription-State:
P-Charging-Vector:icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=45678901\";orig-
ioi=\"Type 1home-a\";transit-ioi=\"ICa.1\"
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK23456.2
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK23456.1
Via: SIP/2.0/UDP [5555::aaa:ccc:eee:aaa];branch=z9hG4bK23456
Content-Type:
Content-Length:(...)
For an example of the content of the SDP application/reginfo+xml see 3GPP TS
24.229 [4] subclause 5.4.2.1.2.
Other SIP header fields are set according to 3GPP TS 24.229 [4].
> **P-Charging-Vector:** The **IC-A1 adds the \"transit-ioi\" header field
> parameter identifying the interconnection network (i.e. ICa.1).**
>
> **Record-Route:** Based on interconnection operator SLA the IC-A1 adds an
> entry to the Record-Route header field or not.
>
> **Via:** The IC-A1 adds a Via header field.
**15\. NOTIFY request (IBCF-vA1 to P-CSCF-vA1) - see example in table
5.2.3.3-15.**
The IBCF-vA1 sends the NOTIFY request according to 3GPP TS 24.229 [4] to the
P-CSCF-vA1.
In this example, the IBCF-vA1 does not add any \"transit-ioi\" header field
parameter in the P-Charging-Vector header field. However, the IBCF-vA1 adds
the \"transit-ioi\" header field parameter based on local policy, when the
\"transit-ioi\" identifying the preceding interconnection network is not
included in the received request (e.g. when the preceding interconnection
network is not an IMS transit network).
Table 5.2.3.3-15: NOTIFY request (IBCF-vA1 to P-CSCF-vA1)
NOTIFY sip:[5555::ddd:aaa:ccc:bbb] SIP/2.0
To:
From:
Record-Route:\,\,\
CSeq:
Contact:
Event:
Subscription-State:
P-Charging-Vector:
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK23456.3
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK23456.2
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK23456.1
Via: SIP/2.0/UDP [5555::aaa:ccc:eee:aaa];branch=z9hG4bK23456
Content-Type:
Content-Length:(...)
For an example of the content of the SDP application/reginfo+xml see 3GPP TS
24.229 [4] subclause 5.4.2.1.2.
Other SIP header fields are set according to 3GPP TS 24.229 [4].
> **Record-Route:** The IBCF-vA1 adds a Record-Route header field entry.
>
> **Via:** The IBCF-vA1 adds a Via header field.
**16-19. 200 (OK) response (P-CSCF-vA1 to S-CSCF-hA1).**
The P-CSCF-vA1 acknowledges the receipt of the NOTIFY request where:
\- the P-CSCF-vA1 includes a P-Charging-Vector header field containing the
ICID value and \"orig-ioi\" header field parameter as received in the NOTIFY
request. In addition the P-CSCF-vA1 adds the \"term-ioi\" header field
parameter with the IOI value set to a value identifying the visited network A
(i.e. visited-a); and
\- the IC-A1 adds to the P-Charging-Vector header field the \"transit-ioi\"
set to a value identifying the interconnection network (i.e. ICa.1).
NOTE 5: If the interconnection network is SIP-unaware, step 18 is skipped.
## 5.3 Originating roaming without loopback
### 5.3.1 General
This clause describes routeing from the originating visited network to the
originating home network including the traversal of transit network between
the visited and the originating home network.
### 5.3.2 Call flow
In this scenario the originating home network decides to route the media
directly to the terminating home network. OMR is not executed.
Preconditions:
\- the user A is registered to the home network hA via the visited operator vA
network and the IC network A as described in clause 5.2. The IC network does
not store any registration information; and
\- the called user is located in another network either in PSTN or in IMS.
NOTE: For clarity, the SIP 100 (Trying) messages are not shown in the
signalling flow.
Figure 5.3.2‑1: MOC without loopback
The flow is based on the assumptions that the precondition mechanism is used
and that the UE‑A will indicate in the SDP offer sent within the INVITE
request the related local preconditions for QoS as not met.
The steps of the flow are as follows:
> **1\. INVITE request (UE-A to P-CSCF-vA1) - see example in table 5.3.2-1.**
>
> The user A at UE-A initiates a call. The UE-A sends an initial INVITE
> request to the P-CSCF‑vA1 according to 3GPP TS 24.229 [4].
Table 5.3.2-1: INVITE request (UE-A to P-CSCF-vA1)
INVITE tel:+4687197378 SIP/2.0
To: \
From: \;tag=4fa3
P-Preferred-Identity: \
P-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
Contact: \
CSeq: 1 INVITE
Supported: 100rel, precondition, 199
Route: \,\
P-Access-Network-Info: 3GPP-E-UTRAN-TDD;utran-cell-id-3gpp=234151D0FCE11
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Other SIP header fields and SDP according to 3GPP TS 24.229 [4]
> **P-Preferred-Identity:** The UE‑A inserts the P-Preferred-Identity header
> field with value set to the default public user identity i.e.
> userA_public1\@home-A.net.
>
> **P-Preferred-Service:** The UE‑A inserts the P-Preferred-Service header
> field with an ICSI value for a 3GPP defined IMS multimedia telephony
> communication service (MMTEL).
>
> **Supported:** The UE‑A inserts the Supported header field containing the
> option‑tag \"100rel\", the option‑tag \"precondition\" and the option‑tag
> \"199\" indicating support of the reliable provisional responses, the
> precondition mechanism and the 199 (Early Dialog Terminated) provisional
> responses, respectively.
>
> **Route:** The UE‑A builds a proper preloaded route set for all new dialogs
> and standalone transactions containing the IP address or the FQDN learnt
> through the P-CSCF discovery procedures and the P‑CSCF port based on the
> security mechanism in use. In addition the values received in the Service-
> Route header field saved from the 200 (OK) response to the last registration
> or re**‑** registration of the public user identity with associated contact
> address are added (including traffic leg information in an \"iotl\" SIP URI
> parameter according to IETF RFC 7549 [26]). The content of the received
> Service-Route header filed is due to operator policy. In this example only
> the S‑CSCF‑hA1 will be included.
**P-Access-Network-Info: The UE-A provides the access-type and access-info,
related to the serving access.**
> **Via:** The UE‑A inserts a Via header field with the respective contact
> address where the UE‑A expects to receive responses to the INVITE request.
>
> **2\. INVITE request (P-CSCF-vA1 to IBCF-vA1) - see example in table
> 5.3.2-2.**
When the P-CSCF-vA1 receives the initial INVITE request and, since the user A
is a roaming user, based on local policy and roaming agreement the P-CSCF‑vA1
adds the Feature-Caps header field with the \"g.3gpp.trf\" header field
parameter with the address to the TRF.
The P-CSCF-vA1 selects an IBCF (IBCF-vA1) to be the exit IBCF towards the home
IMS network hA of the user A and sends the INVITE request according to 3GPP TS
24.229 [4] to IBCF-v1A.
The received list of URIs in the Route header field within the INVITE will be
verified with the Route header field list constructed from the Service-Route
header field received during the last registration procedure.
Table 5.3.2-2: INVITE request (P-CSCF-vA1 to IBCF-vA1)
INVITE tel:+4687197378 SIP/2.0
To:
From:
P-Asserted-Identity: \
P-Preferred-Service:
Contact:
CSeq:
Supported:
Route: \,\
Record-Route: \
Feature-Caps:*;+g.3gpp.trf=\"\\"
P-Access-Network-Info: 3GPP-E-UTRAN-TDD;utran-cell-id-3gpp=234151D0FCE11,
3GPP-E-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11;network-provided;local-
time-zone=\"UTC+01:00\";daylight-saving-time=\"01\"
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 1visited-a\"
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Other SIP header fields and SDP according to 3GPP TS 24.229 [4].
> **P-Asserted-Identity:** The value is set to the default public user
> identity i.e. userA_public1\@home-A.net.
>
> **P-Charging-Vector:** The P-CSCF-vA1 adds the P-Charging-Vector header
> field containing a new ICID value in the \"icid\" header field parameter and
> an \"orig-ioi\" header field parameter. The IOI value is of type 1 and
> identifies the visited network vA (i.e. visited-a).
>
> **P-Access-Network-Info:** The P-CSCF-vA1 adds a network provided location
> and daylight saving time information. **If the received P-Access-Network-
> Info header field doesn\'t indicate that it is a network provided location,
> the P-Access-Network-Info header field containing the location provided by
> the UE-A is kept in the INVITE request.**
>
> **Route:** The P-CSCF-vA1 verifies that the received route set corresponds
> to the route set received in the Service-Route header field and adds a Route
> header field identifying the selected IBCF-vA1.
>
> **Record-Route:** The P-CSCF-vA1 adds a Record-Route header field.
>
> **Via:** The P-CSCF-vA1 adds a Via header field.
>
> **Feature-Caps:** The P-CSCF-vA1 adds a g.3gpp.trf feature-capability
> indicator in the Feature-Caps header field. The feature-capability indicator
> contains the address to a TRF-vA1 in the visited network and traffic leg
> information in an \"iotl\" SIP URI parameter according to IETF RFC 7549
> [26]. This address is needed if the call will result in a loopback to the
> visited network.
>
> **3\. INVITE request (IBCF-vA1 to IC-A1) - see example in table 5.3.2-3.**
When the IBCF-vA1 receives the initial INVITE request containing the
\"+g.3gpp.trf\" header field parameter in a Feature-Caps header field, the
IBCF-vA1 updates the SDP as described within 3GPP TS 29.079 [5].
The IBCF-vA1 selects, based on local policy, to route the INVITE request via
IC network A and sends the INVITE request according to 3GPP TS 24.229 [4] to
the IC-A1. The IBCF-vA1 determines the next hop IP address from the URI in the
first entry of the Route header field either by configured information or
using a DNS query according to IETF RFC 3263 [13]. If the subsequent
interconnection network is SIP-aware, the determined IP address will belong to
the SIP proxy IC-A1. Otherwise the determined IP address will point to IBCF-
hA1 and step 4 is skipped (not reflected in message details below).
Table 5.3.2-3: INVITE request (IBCF-vA1 to IC-A1)
INVITE tel:+4687197378 SIP/2.0
To:
From:
P-Asserted-Identity:
P-Preferred-Service:
Contact:
CSeq:
Supported:
Route: \,\
Record-Route: \,\
Feature-Caps:
P-Access-Network-Info:
P-Charging-Vector:
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Other SIP header fields and SDP according to 3GPP TS 24.229 [4] and 3GPP TS
29.079 [5].
**Route:** The IBCF-vA1 adds a Route header field identifying the selected
node in the IC network A.
> **Record-Route:** Based on topology hiding functionality the IBCF-vA1 will
> either forward the Record-Route header field with:
\- one visible IBCF-vA1 entry and the remaining collected entries as one
hidden entry; or
\- an IBCF-vA1 entry and whole content of already collected entries as visible
entries.
> **Via:** Based on topology hiding functionality the IBCF-vA1 will either
> forward the Via header field with:
\- one visible IBCF-vA1 entry and the remaining collected entries as one
hidden entry; or
\- an IBCF-vA1 entry and whole content of already collected entries as visible
entries.
> **4\. INVITE request (IC-A1 to IBCF-hA1) - see example in table 5.3.2-4.**
NOTE 1: If the interconnection network is SIP-unaware, step 4 is skipped (not
reflected in message details below).
When the IC-A1 receives the initial INVITE request and since the IC-A1
according to local policy allows itself to be bypassed by media then the IC-A1
updates the SDP as described within 3GPP TS 29.079 [5].
The IC-A1 selects an entry point (IBCF-hA1) of the home IMS network hA and
sends the INVITE request according to 3GPP TS 24.229 [4] to the IBCF-hA1.
> The IC-A1 may add a Route header field entry pointing to the entry point of
> home network hA. This is shown in example in table 5.3.2-4.
Table 5.3.2-4: INVITE request (IC-A1 to IBCF-hA1)
INVITE tel:+4687197378 SIP/2.0
To:
From:
P-Asserted-Identity:
P-Preferred-Service:
Contact:
CSeq:
Supported:
Route: \,\
Record-Route: \,\,
\
Feature-Caps:
P-Access-Network-Info:
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 1visited-a\"; transit-ioi=\"ICa.1\"
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.2
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Other SIP header fields and SDP according to 3GPP TS 24.229 [4] and
3GPP TS 29.079 [5].
> **P-Charging-Vector:** The IC-A1 adds the \"transit-ioi\" header field
> parameter identifying the interconnection network (i.e. ICa.1).
>
> **Route:** The IC-A1 adds a Route header field identifying the selected
> entry point in the home network hA.
>
> **Record-Route:** Based on interconnection operator SLA the IC-A1 adds an
> entry to the Record-Route header field or not.
>
> **Via:** The IC-A1 adds a Via header field.
>
> **5\. INVITE request (IBCF-hA1 to S-CSCF-hA1) - see example in table
> 5.3.2-5.**
When the IBCF-hA1 receives the initial INVITE request containing the
\"+g.3gpp.trf\" header field parameter in a Feature-Caps header field, the
IBCF-hA1 updates the SDP as described in 3GPP TS 29.079 [5].
The IBCF-hA1 sends the INVITE request according to 3GPP TS 24.229 [4] to the
S-CSCF-hA1.
In this example, the IBCF-hA1 does not add any \"transit-ioi\" header field
parameter in the P-Charging-Vector header field. However, the IBCF-hA1 adds
the \"transit-ioi\" header field parameter based on local policy, when the
\"transit-ioi\" identifying the preceding interconnection network is not
included in the received request (e.g. when the preceding interconnection
network is not an IMS transit network).
Table 5.3.2-5: INVITE request (IBCF-hA1 to S-CSCF-hA1)
INVITE tel:+4687197378 SIP/2.0
To:
From:
P-Asserted-Identity:
P-Preferred-Service:
Contact:
CSeq:
Supported:
Route: \
Record-Route: \,\,
\,\
Feature-Caps:
P-Access-Network-Info:
P-Charging-Vector:
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.3
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.2
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Other SIP header fields and SDP according to 3GPP TS 24.229 [4] and 3GPP TS
29.079 [5].
> **Via:** The IBCF-hA1 adds a Via header field.
>
> **Record-Route:** The IBCF-hA1 adds a Record-Route header field.
>
> **6\. INVITE request (S-CSCF-hA1 to AS-hA1) - see example in table
> 5.3.2-6.**
>
> The S-CSCF‑hA1 applies first filter criteria that is no specific procedures
> due to roaming. The case where an AS needs the involvement of media function
> is described in clause 5.10.
>
> The S-CSCF‑hA1 decides according to local policy that loopback routeing can
> be used and include a Feature‑Caps header field according to IETF RFC 6809
> [21] with the \"+g.3gpp.home-visited\" header field parameter set to the
> identifier of the visited network received in the P‑Visited‑Network‑ID
> header field in the original registration request.
>
> The S-CSCF-hA1 replaces the received \"orig-ioi\" header field parameter
> value in the P-Charging-Vector header field with the type 3 \"orig-ioi\"
> header field parameter with a value identifying the home network hA (i.e.
> \"home‑a\").
>
> If a service needs to be invoked according to the user A profile, a Route
> header field with an URI pointing to the AS‑hA1 and the URI pointing back to
> the S-CSCF‑hA1 is added.
Table 5.3.2-6: INVITE request (S-CSCF-hA1 to AS-hA1)
INVITE tel:+4687197378 SIP/2.0
To:
From:
P-Asserted-Identity:
P-Asserted-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
Contact:
CSeq:
Supported:
Route: \, \
Record-Route: \,\,
\,\,
\
Feature-Caps:*;+g.3gpp.home-visited=\"\\";+g.3gpp.trf=\"\\"
P-Access-Network-Info:
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 3home-a\"
Relayed-Charge: SCSCF:transit-ioi=\"ICa.1\"
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.4
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.3
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.2
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Other SIP header fields and SDP according to 3GPP TS 24.229 [4] and 3GPP TS
29.079 [5].
> **Route:** The S-CSCF-hA1 adds Route header field with an URI pointing to
> the AS‑hA1 and the URI pointing back to the S-CSCF‑hA1.
>
> **P-Charging-Vector:** The S-CSCF-hA1 replaces the type 1 IOI values
> received in the \"orig-ioi\" header field parameter with a type 3 IOI value
> identifying the home network hA.
>
> Relayed-Charge: The S-CSCF adds the \"relayed\" header field parameter set
> to the value of the \"transit-ioi\" header field parameter received in the
> INVITE request from the IBCF-Ah1. S-CSCF is set as the source.
>
> **Via:** The S-CSCF-hA1 adds a Via header field.
>
> **Record-Route:** The S-CSCF-hA1 adds a Record-Route header field.
>
> **Feature-Caps:** Since loopback is possible the S-CSCF-hA1 adds the
> g.3gpp.home-visited feature capability indicator in the Feature-Caps header
> field.
>
> **7\. INVITE request (AS-hA1 to S-CSCF-hA1) - see example in table
> 5.3.2-7.**
>
> AS‑hA1 applies the service and removes the first Route header field entry.
>
> The AS‑hA1 shall remove the \"orig-ioi\" header field parameter from the
> forwarded request and insert a type 3 \"orig‑ioi\" header field parameter.
> The AS‑hA1 shall set the type 3 \"orig-ioi\" header field parameter to the
> IOI value that identifies the service provider from which the request is
> sent. In this example the IOI value is the same as the home network operator
> identity.
>
> The specifics of the service provided by the AS‑hA1 require access to the
> media and the AS‑hA1 removes the \"+g.3gpp.home-visited\" Feature-Caps
> header field parameter. The absence of the \"+g.3gpp.home-visited\"
> Feature**‑** Caps header field parameter is an indication to S-CSCF-hA1 that
> a loopback routeing is not a viable option.
NOTE 2: The AS can either keep the OMR attributes in SDP or remove them
depending on if the AS supports OMR and local policy. In this example it is
assumed that the AS removes the OMR attributes.
> All other SIP headers are set due to procedures described within 3GPP TS
> 24.229 [4].
Table 5.3.2-7: INVITE request (AS-hA1 to S-CSCF-hA1)
INVITE tel:+4687197378 SIP/2.0
To:
From:
P-Asserted-Identity:
P-Asserted-Service:
Contact:
CSeq:
Supported:
Route: \
Record-Route: \,\,
\,\,
\,\
Feature-Caps:*;+g.3gpp.trf=\"\\"
P-Access-Network-Info:
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 3home-a\"
Relayed-Charge:
Via: SIP/2.0/UDP as-hA1.home-A.net;branch=z9hG4bK351g45.5
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.4
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.3
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.2
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Other SIP header fields and SDP according to 3GPP TS 24.229 [4] and 3GPP TS
29.079 [5].
> **P-Charging-Vector:** The AS-hA1 replaces the \"orig-ioi\" header field
> parameter. The AS-hA1 sets the type 3 \"orig-ioi\" header field parameter to
> a value that identifies the sending network (in the example the AS-hA1
> belongs to the same network as the S-CSCF-hA1 and thus the value is the same
> as the IOI value received from S-CSCF-hA1, i.e. \"home-a\"). The AS has to
> set itself a type 3 IOI if the AS is located within another domain (i.e. a
> 3^rd^ party service provider). If more than one AS is within the path the
> \"orig-ioi\" header field parameter values could be changed based on the
> relation between S‑CSCF‑hA1 and the related AS.
>
> **Record-Route:** The entries to this header field need to be added based on
> the related dip\'s to the AS. The AS could behave as B2BUA. In such case the
> AS could store the entries and setup a new Record**‑** Route header field
> only with the AS URI as an entry.
>
> **Via:** The AS-hA1 adds a Via header field.
>
> **8\. INVITE request (S-CSCF-hA1 to IBCF-hA2) - see example in table
> 5.3.2-8.**
When the S-CSCF‑hA1 receives the initial INVITE request back from the AS‑hA1
and if no further services apply then the S-CSCF‑hA1 decides according to
local policy if loopback routeing shall be used or not. In this use case
loopback will not apply. The S-CSCF‑hA1 removes the Feature-Caps header field
\"*;+g.3gpp.trf\" from the INVITE request.
If the domain of the called user is not the same home domain as from the
calling user then the S‑CSCF‑hA1 has to identify the home network of the
called user via ENUM/DNS as provided by local policy of the operator.
If the ENUM/DNS request fails the call will be forwarded to the BGCF or if
number portability applies and an rn parameter must be set up the call will be
also forwarded to the BGCF. In the case the FQDN needs to be addressed to MGCF
the INVITE request will be forwarded to the BGCF. In this use case the INVITE
request is sent directly to IBCF-hA2.
> The S-CSCF-hA1 replaces the received \"orig-ioi\" header field parameter
> value in the P-Charging-Vector header field with the type 2 \"orig-ioi\"
> header field parameter value identifying the home network hA (i.e.
> \"home‑a\").
>
> The Relayed-Charge header field is deleted.
Table 5.3.2-8: INVITE request (S-CSCF-hA1 to IBCF-hA2)
INVITE sip:+4687197378\@home-R.net;user=phone;iotl=homeA-homeB SIP/2.0
To:
From:
P-Asserted-Identity:
P-Asserted-Service:
Contact:
CSeq:
Supported:
Route: \
Record-Route: \,\,
\,\,
\,\,
\
P-Access-Network-Info:
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"home-a\"
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.6
Via: SIP/2.0/UDP as-hA1.home-A.net;branch=z9hG4bK351g45.5
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.4
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.3
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.2
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Other SIP header fields and SDP according to 3GPP TS 24.229 [4].
> **Request-URI:** The S-CSCF converts the received tel URI to a SIP URI (e.g.
> by means of ENUM) and appends traffic leg information in an \"iotl\" SIP URI
> parameter according to IETF RFC 7549 [26].
>
> **Route:** The S-CSCF-hA1 adds a Route header with the address of the
> selected IBCF-hA2.
>
> **Via:** The S-CSCF-hA1 adds a Via header field.
>
> **Record-Route:** The S-CSCF-hA1 adds a Record-Route header field.
>
> **P-Charging-Vector:** The S-CSCF-hA1 replaces the received type 3 IOI
> received from the AS-hA1 with a type 2 IOI value (i.e. home-a).
>
> **9-16. 183 (Session Progress) response (IBCF-hA2 to UE‑A via S-CSCF-hA1,
> AS-hA1, S-CSCF-hA1, IBCF‑hA1, IC-A1, IBCF-vA1 and P-CSCF-vA1) - see example
> in table 5.3.2-9.**
When the IBCF‑hA2 receives the 183 (Session Progress) response the IBCF‑hA2
sends the 183 (Session Progress) response according to 3GPP TS 24.229 [4]
towards the UE‑A via the S-CSCF‑hA1, AS‑hA1, IBCF‑hA1, IC‑A1, IBCF‑vA1,
P-CSCF‑vA1 path as described within 3GPP TS 24.229 [4].
> The table 5.3.2-9 shows the content of the 183 (Session Progress) response
> when sent by IBCF‑hA2.
Table 5.3.2-9: SIP 183 (Session Progress) response (IBCF-hA2 to UE-A) in step
9
SIP/2.0 183 Session Progress
To: \;tag=654a
From: \;tag=4fa3
P-Asserted-Identity:
\,\
Contact: \
CSeq: 1 INVITE
Require: 100rel, precondition
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.6
Via: SIP/2.0/UDP as-hA1.home-A.net;branch=z9hG4bK351g45.5
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.4
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.3
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.2
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Record-Route: \,\ \,\,
\,\,
\,\,
\,\
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"; orig-
ioi=\"home-a\"; transit-ioi=\"ICt.1\"; term-ioi=\"home-r\"
Other SIP header fields and SDP according to 3GPP TS 24.229 [4].
**Require:** The Require header field contains the option‑tag \"100rel\"
indicating reliable sending of the 183 (Session Progress) response and the
option‑tag \"precondition\" indicating the usage of the precondition
mechanism.
**P-Charging-Vector:** The settings of the IOI values are important:
**\- in** step **9 the \"term-ioi\" header field parameter includes a type 2
IOI value which identifies the home network of the remote user** (i.e.
**\"home‑r\"). The \"transit-ioi\" header field parameter including one or
more values identifying the transit networks passed**. The \"orig-ioi\" header
field parameter is set to the same type 2 IOI value that was included in the
initial INVITE request by the home network hA (i.e. **\"home‑a\")** towards
the terminating user;
\- in step 10 the \"**term-ioi\"** header field parameter **includes a type 3
IOI value (prefix \"Type 3\") which identifies the S-CSCF-hA1 network.** The
\"orig-ioi\" header field parameter is set to the same type 3 IOI value that
was included in the initial INVITE request from the AS-hA1 to the S-CSCF-hA1;
\- in step 11 the \"term-ioi\" header field parameter includes a type 3 IOI
value (prefix \"Type 3\") which identifies the AS-hA1 network. The \"orig-
ioi\" header field parameter is set to the same type 3 IOI value that was
included in the initial INVITE request from the S‑CSCF‑hA1 to the AS-hA1;
\- in steps 12-15 the \"term-ioi\" header field parameter includes a type 1
IOI value (prefix \"Type 1\") which identifies the home network hA. The
\"orig-ioi\" header field parameter is set to the same type 1 IOI value that
was included in the initial INVITE request from the visited network vA towards
the home network hA; and
\- in steps 14-15 the \"transit-ioi\" header field parameter includes one or
more values identifying the transit networks passed.
NOTE 3: If the interconnection network is SIP-unaware, step 14 is skipped.
**17\. PRACK requests (UE‑A to IBCF-hA2 via P-CSCF-vA1, IBCF-vA1, IC-A1, IBCF-
hA1, S-CSCF-hA1, AS‑hA1 and S-CSCF-hA1) and SIP 200 (OK) response to the SIP
PRACK request (IBCF-hA2 to UE-A via S-CSCF-hA1, AS-hA1, S-CSCF-hA1, IBCF-vA1,
IC-A1, IBCF-hA1 and P-CSCF-vA1).**
The PRACK request and the 200 (OK) response to the PRACK request are sent
without any SDP offer/SDP answer between the UE-A and the IBCF-hA2 according
to 3GPP TS 24.229 [4].
**18\. Resource reservation.**
**19\. UPDATE requests (UE‑A to IBCF-hA2 via P-CSCF-vA1, IBCF-vA1, IC-A1,
IBCF-hA1, S-CSCF-hA1, AS‑hA1 and S-CSCF-hA1) and SIP 200 (OK) response to the
SIP UPDATE request (IBCF-hA2 to UE-A via S-CSCF-hA1, AS-hA1, S-CSCF-hA1, IBCF-
hA1, IC-A1, IBCF-vA1 and P-CSCF-vA1).**
After a local resource reservation the UE‑A sends the UPDATE request with the
SDP offer containing an indication that the local preconditions for QoS are
fulfilled according to 3GPP TS 24.229 [4].
**20-27. 180 (Ringing) response to the SIP INVITE request (IBCF-hA2 to UE-A
via S-CSCF-hA1, AS-hA1, S‑CSCF-hA1, IBCF-hA1, IC-A1, IBCF-vA1 and P-CSCF-
vA1).**
NOTE 4: If the interconnection network is SIP-unaware, step 25 is skipped.
**28\. PRACK requests (UE‑A to IBCF-hA2 via P-CSCF-vA1, IBCF-vA1, IC-A1, IBCF-
hA1, S-CSCF-hA1, AS‑hA1 and S-CSCF-hA1) and SIP 200 (OK) response to the SIP
PRACK request (IBCF-hA2 to UE-A via S-CSCF-hA1, AS-hA1, S-CSCF-hA1, IBCF-hA1,
IC-A1, IBCF-vA1 and P-CSCF-vA1).**
The PRACK request and the 200 (OK) response to the PRACK request are sent
without any SDP offer/SDP answer between the UE-A and the IBCF-hA2 according
to 3GPP TS 24.229 [4].
**29-36. 200 (OK) response to the SIP INVITE request (IBCF-hA2 to UE-A via
S-CSCF-hA1, AS-hA1, S‑CSCF‑hA1, IBCF-hA1, IC-A1, IBCF-vA1 and P-CSCF-vA1).**
NOTE 5: If the interconnection network is SIP-unaware, step 34 is skipped.
**37-44. ACK requests (UE‑A to IBCF‑hA2 via P‑CSCF‑vA1, IBCF‑vA1, IC‑A1,
IBCF‑hA1, S‑CSCF‑hA1, AS‑hA1 and S‑CSCF‑hA1).**
The UE**‑** A sends the ACK request, which acknowledges the 200 (OK) final
response, to the IBCF**‑** hA2 according to 3GPP TS 24.229 [4].
NOTE 6: If the interconnection network is SIP-unaware, step 40 is skipped.
## 5.4 Originating roaming with loopback
### 5.4.1 General
This use case shows the loopback procedure that includes routeing from
originating visited network to originating home network and loopback routeing
from originating home network to originating visited network including the
traversal of transit network between the visited and the originating home
network.
Signalling is prepared to skip the loopback and route directly to the
terminating home network on demand of the originating home network, see the
use case provided by clause 5.3.
### 5.4.2 Call flow
In this scenario the originating home network decides to use loopback routeing
and OMR is used.
Preconditions:
\- the user A is registered to the home network hA via the visited operator vA
network and the IC network A as described in clause 5.2. The IC network does
not store any registration information;
\- the called user is located in another network either in PSTN or in IMS;
\- P-CSCF-vA1 and S-CSCF-hA1 support loopback routeing;
\- IBCF-vA1, IBCF-hA1 and IC-A1 supports OMR and all networks supports
loopback routeing; and
\- no B2BUA manipulating SDP is connected in the home operator hA network.
SDP behaviour for loopback including OMR is described within 3GPP TS 29.079
[5].
NOTE: For clarity, the SIP 100 (Trying) messages are not shown in the
signalling flow.
Figure 5.4.2-1: MOC with loopback
The flow is based on the assumptions that the precondition mechanism is used
and that the UE‑A will indicate in the SDP offer sent within the INVITE
request the related local preconditions for QoS as not met.
> The steps of the flow are as follows:
>
> **1\. INVITE request (UE-A to P-CSCF-vA1) - see example in table 5.4.2-1.**
>
> The user A at UE-A initiates a call. The UE-A sends an initial INVITE
> request to the P-CSCF-vA1 according to 3GPP TS 24.229 [4].
Table 5.4.2-1: INVITE request (UE-A to P-CSCF-vA1)
INVITE tel:+4687197378 SIP/2.0
To: \
From: \;tag=4fa3
P-Preferred-Identity: \
P-Preferred-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
Contact: \
CSeq: 1 INVITE
Supported: 100rel, precondition, 199
Route: \,\
P-Access-Network-Info: 3GPP-E-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Content-Type:application/sdp
Content-Length: (...)
c=IN IP6 [5555::aaa:bbb:ccc:ddd]
m=audio 16000 RTP/AVP 97 98
a=curr:qos local none
a=curr:qos remote none
a=des:qos mandatory local sendrecv
a=des:qos none remote sendrecv
Other SIP header fields and SDP according to 3GPP TS 24.229 [4].
> **P-Preferred-Identity:** The UE‑A inserts the P-Preferred-Identity header
> field with value set to the default public user identity i.e.
> userA_public1\@home-A.net.
>
> **P-Preferred-Service:** The UE‑A inserts the P-Preferred-Service header
> field with an ICSI value for a 3GPP defined IMS multimedia telephony
> communication service (MMTEL).
>
> **Supported:** The UE-A inserts the Supported header field containing the
> option‑tag \"100rel\", the option‑tag \"precondition\" and the option‑tag
> \"199\" indicating support of the reliable provisional responses, the
> precondition mechanism and the 199 (Early Dialog Terminated) provisional
> responses, respectively.
**Route:** The UE‑A builds a proper preloaded route set for all new dialogs
and standalone transactions containing the IP address or the FQDN learnt
through the P-CSCF discovery procedures and the P**‑** CSCF port based on the
security mechanism in use. In addition the values received in the Service**‑**
Route header field saved from the 200 (OK) response to the last registration
or re**‑** registration of the public user identity with associated contact
address are added (including traffic leg information in an \"iotl\" SIP URI
parameter according to IETF RFC 549 [26]). The content of the received
Service-Route header filed is due to operator policy. In this example only the
S‑CSCF‑hA1 will be included.
**P-Access-Network-Info: The UE** ‑**A provides the access** ‑**type and
access** ‑**info, related to the serving access.**
**Via:** The UE‑A inserts a Via header field with the respective contact
address where the UE‑A expects to receive responses to the INVITE request.
SDP: The UE-A add necessary information in an SDP offer. For readability
reasons only the parts of the SDP that will change due to the use of OMR is
shown. The rest is as described in 3GPP TS 24.229 [4].
> **2\. INVITE request (P-CSCF-vA1 to IBCF-vA1) - see example in table
> 5.4.2-2.**
>
> When the P-CSCF-vA1 receives the initial INVITE request, the P-CSCF‑vA1:
\- adds the Feature-Caps header field with the \"g.3gpp.trf\" header field
parameter with the address to the TRF; and
\- verifies that the resulting list of Route header fields matches the list of
URIs received in the Service‑Route header field (during the last successful
registration or re-registration). This verification is done on a per URI
basis, not as a whole string.
> The P-CSCF-vA1 selects an IBCF (IBCF-vA1) to be the exit IBCF towards the
> home IMS network hA and sends the INVITE request according to 3GPP TS 24.229
> [4] to IBCF-vA1.
NOTE 1: It is implementation dependent as to how the P-CSCF obtains the
address of the IBCF exit point.
Table 5.4.2-2: INVITE request (P-CSCF-vA1 to IBCF-vA1)
INVITE tel:+4687197378 SIP/2.0
To:
From:
P-Asserted-Identity: \
P-Preferred-Service:
Contact:
CSeq:
Supported:
Route: \,\
Record-Route: \
Feature-Caps:*;+g.3gpp.trf=\"\\"
P-Access-Network-Info: 3GPP-E-UTRAN-TDD;utran-cell-id-3gpp=234151D0FCE11,
3GPP-E-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11;
network-provided;local-time-zone=\"UTC+01:00\";daylight-saving-time=\"01\"
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 1visited-a\"
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Content-Type:
Content-Length: (...)
c=
m=
a=
a=
a=
a=
Other SIP header fields and SDP according to 3GPP TS 24.229 [4].
> **P-Asserted-Identity:** The value is set to the default public user
> identity i.e. userA_public1\@home-A.net.
>
> **P-Charging-Vector:** The P-CSCF-vA1 adds the P-Charging-Vector header
> field containing a new ICID value in the \"icid\" header field parameter and
> an \"orig-ioi\" header field parameter. The IOI value is of type 1 and
> identifies the visited network vA (i.e. visited-a).
>
> **P-Access-Network-Info:** The P-CSCF-vA1 adds a network provided location
> and daylight saving information. **If the received P-Access-Network-Info
> header field doesn\'t indicate that it is a network provided location, the
> P-Access-Network-Info header field containing the location provided by the
> UE-A is kept in the INVITE request.**
>
> **Route:** The P-CSCF-vA1 verifies that the received route set corresponds
> to the route set received in the Service-Route header field and adds a Route
> header field identifying the selected IBCF-vA1.
>
> **Record-Route:** The P-CSCF-vA1 adds a Record-Route header field.
>
> **Via:** The P-CSCF-vA1 adds a Via header field.
>
> **Feature-Caps:** The P-CSCF-vA1 adds a g.3gpp.trf feature-capability
> indicator in the Feature-Caps header field. The feature-capability indicator
> contains the address to a TRF in the visited network and traffic leg
> information in an \"iotl\" SIP URI parameter according to IETF RFC 7549
> [26]. This address is needed if the call will result in a loopback to the
> visited network.
>
> **3\. INVITE request (IBCF-vA1 to IC-A1) - see example in table 5.4.2-3.**
>
> When the IBCF-vA1 receives the initial INVITE request containing the
> \"+g.3gpp.trf\" header field parameter in a Feature-Caps header field, the
> IBCF-vA1 updates the SDP as described within 3GPP TS 29.079 [5].
>
> The IBCF-vA1selects to route the INVITE request via an IC network A and
> sends the INVITE request according to 3GPP TS 24.229 [4] to the IC-A1. The
> IBCF-vA1 determines the next hop IP address from the URI in the first entry
> of the Route header field either by configured information or using a DNS
> query according to IETF RFC 3263 [13]. If the subsequent interconnection
> network is SIP-aware, the determined IP address will belong to the SIP proxy
> IC-A1. Otherwise the determined IP address will point to IBCF-hA1 and step 4
> is skipped (not reflected in message details below).
NOTE 2: If the IBCF processes a request without a pre-defined route (e.g. the
subscription to \"reg\" event package originated by the P-CSCF), the next-hop
address can be either obtained as specified in IETF RFC 3263 [13] or be
provisioned in the IBCF.
Table 5.4.2-3: INVITE request (IBCF-vA1 to IC-A1)
INVITE tel:+4687197378 SIP/2.0
To:
From:
P-Asserted-Identity:
P-Preferred-Service:
Contact:
CSeq:
Supported:
Route: \,\
Record-Route: \,\
Feature-Caps:
P-Access-Network-Info:
P-Charging-Vector:
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Content-Type:
Content-Length: (...)
c=IN IP6 [5555::aaa:bbb:ccc:dd1]
m=audio 16002 RTP/AVP 97 98
a=
a=
a=
a=
a=visited-realm:1 visited-A1.net IN IP6 [5555::aaa:bbb:ccc:ddd] 16000
a=visited-realm:2 x.net IN IP6 [5555::aaa:bbb:ccc:dd1] 16002
Other SIP header fields and SDP according to 3GPP TS 24.229 [4] and 3GPP TS
29.079 [5].
**Route:** The IBCF-vA1 adds a Route header field identifying the selected
node in the IC network A.
> **Record-Route:** Based on topology hiding functionality the IBCF-vA1 will
> either forward the Record-Route header field with:
\- one visible IBCF-vA1 entry and the P-CSCF‑vA1 entry as one hidden entry; or
\- an IBCF-vA1 entry and the P-CSCF‑vA1 entry as visible entries.
**Via:** Based on topology hiding functionality the IBCF-vA1 will either
forward the Via header field with:
\- one visible IBCF-vA1 Via header field and the P-CSCF‑vA1 Via header field
as a hidden Via header field; or
\- an IBCF-vA1 Via header field and the P-CSCF‑vA1 Via header field as visible
entries.
SDP: As the first OMR capable node, the IBCF-vA1 add the \"a=visited-realm:1
visited-A1.net IN IP6 [5555::aaa:bbb:ccc:ddd] 16000\" representing the realm
instance of the UE-A. A second realm instance \"a=visited-realm:2 x.net IN IP6
[5555::aaa:bbb:ccc:dd1] 16002\" is added representing the external realm of
the IBCF-vA1. The c-line and the m-line are updated to reflect the resources
reserved in the TrGW of IBCF-vA1.
> **4\. INVITE request (IC-A1 to IBCF-hA1) - see example in table 5.4.2-4.**
NOTE 3: If the interconnection network is SIP-unaware, step 4 is skipped (not
reflected in message details below).
> When the IC-A1 receives the initial INVITE request and since the IC-A1
> according to local policy allows itself to be bypassed by media then the
> IC-A1 updates the SDP as described within 3GPP TS 29.079 [5].
>
> The IC-A1 selects an entry IBCF-hA1 of the home IMS network hA and sends the
> INVITE request according to 3GPP TS 24.229 [4] to the IBCF-hA1.
>
> The IC-A1 may add a Route header field entry pointing to the entry point of
> home network hA. This is shown in example in table 5.4.2-4.
Table 5.4.2-4: INVITE request (IC-A1 to IBCF-hA1)
INVITE tel:+4687197378 SIP/2.0
To:
From:
P-Asserted-Identity:
P-Preferred-Service:
Contact:
CSeq:
Supported:
Route: \,\
Record-Route: \,\,
\
Feature-Caps:
P-Access-Network-Info:
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 1visited-a\";transit-ioi=\"ICa.1\"
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.2
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Content-Type:
Content-Length: (...)
c=IN IP6 [5555::aaa:bbb:ccc:dd2]
m=audio 16004 RTP/AVP 97 98
a=
a=
a=
a=
a=visited-realm:1 visited-A1.net IN IP6 [5555::aaa:bbb:ccc:ddd] 16000
a=visited-realm:2 x.net IN IP6 [5555::aaa:bbb:ccc:dd1] 16002
a=visited-realm:3 x.net IN IP6 [5555::aaa:bbb:ccc:dd2] 16004
Other SIP header fields and SDP according to 3GPP TS 24.229 [4] and 3GPP TS
29.079 [5].
> **P-Charging-Vector:** The IC-A1 adds the \"transit-ioi\" header field
> parameter identifying the interconnection network (i.e. ICa.1).
**Route:** The IC-A1 adds a Route header field identifying the selected entry
point in the home network hA.
**Record-Route:** Based on interconnection operator SLA the IC-A1 adds an
entry to the Record-Route header field or not.
**Via:** The IC-A1 adds a Via header field.
SDP: A third realm instance \"a=visited-realm:3 x.net IN IP6
[5555::aaa:bbb:ccc:dd2] 16004\" is added representing the realm of the IC-A1.
The c-line and the m-line are updated to reflect the resources reserved in the
IC-A1.
> **5\. INVITE request (IBCF-hA1 to S-CSCF-hA1) - see example in table
> 5.4.2-5.**
>
> When the IBCF-hA1 receives the initial INVITE request containing the
> \"+g.3gpp.trf\" header field parameter in a Feature-Caps header field, the
> IBCF-hA1 updates the SDP as described within 3GPP TS 29.079 [5].
>
> In this example, the IBCF-hA1 does not add any \"transit-ioi\" header field
> parameter in the P-Charging-Vector header field. However, the IBCF-hA1 adds
> the \"transit-ioi\" header field parameter based on local policy, when the
> \"transit-ioi\" identifying the preceding interconnection network is not
> included in the received request (e.g. when the preceding interconnection
> network is not an IMS transit network).
>
> The IBCF-hA1 sends the INVITE request according to 3GPP TS 24.229 [4] to the
> S-CSCF‑hA1.
Table 5.4.2-5: INVITE request (IBCF-hA1 to S-CSCF-hA1)
INVITE tel:+4687197378 SIP/2.0
To:
From:
P-Asserted-Identity:
P-Preferred-Service:
Contact:
CSeq:
Supported:
Route: \
Record-Route: \,\,
\,\
Feature-Caps:
P-Access-Network-Info:
P-Charging-Vector:
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.3
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.2
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Content-Type:
Content-Length: (...)
c=IN IP6 [5555::aaa:bbb:ccc:dd3]
m=audio 16006 RTP/AVP 97 98
a=
a=
a=
a=
a=visited-realm:1 visited-A.net IN IP6 [5555::aaa:bbb:ccc:ddd] 16000
a=visited-realm:2 x.net IN IP6 [5555::aaa:bbb:ccc:dd1] 16002
a=visited-realm:4 home-A.net IN IP6 [5555::aaa:bbb:ccc:dd3] 16006
Other SIP header fields and SDP according to 3GPP TS 24.229 [4] and 3GPP TS
29.079 [5].
> **Via:** The IBCF-hA1 adds a Via header field.
>
> **Record-Route:** The IBCF-hA1 adds a Record-Route header field.
SDP: IBCF-hA1 detects, by inspecting the received set of OMR visited-realm
attributes, that the resources in IC-A1 can be bypassed. Since the realm of
the ougoing side is different than the realm of the incoming side, the IBCF-
hA1 adds the realm instance 4 representing the internal realm of the IBCF-hA1
and updates the c-line and the m-line to reflect the resources reserved in the
TrGW of the IBCF-hA1.
> **6\. INVITE request (S-CSCF-hA1 to AS-hA1) - see example in table
> 5.3.2-6.**
>
> The S-CSCF-hA1 applies the same procedure as in step 6 in clause 5.3.2. The
> OMR specific attributes are kept in the SDP as received from the IBCF-hA1.
>
> **7\. INVITE request (AS-hA1 to S‑CSCF‑hA1) - see example in table
> 5.4.2-7.**
AS‑hA1 applies the service of the originating user and removes the first Route
header field entry.
The AS‑hA1 removes the \"orig-ioi\" header field parameter from the INVITE
request and inserts a type 3 \"orig‑ioi\" header field parameter set to a
value that identifies the service provider from which the request is sent. In
this case the IOI value is the same as the home network operator identity.
The specifics of the service does not require access to a media and the
\"+g.3gpp.home-visited\" Feature-Caps header field parameter is kept in the
INVITE request. This is an indication to the S-CSCF‑hA1 that a loopback is a
viable option.
All other SIP headers are set due to procedures described within 3GPP TS
24.229 [4].
Editor\'s note: The behaviour of the transit-ioi value is currently discussed
and needs further consideration how the S-CSCF to AS correlation is describes.
Table 5.4.2-7: INVITE request (AS-hA1 to S-CSCF-hA1)
INVITE tel:+4687197378 SIP/2.0
To:
From:
P-Asserted-Identity:
P-Asserted-Service:
Contact:
CSeq:
Supported:
Route: \
Record-Route: \,\,
\,\,
\,\
Feature-Caps:*;+g.3gpp.home-visited=\"\\";+g.3gpp.trf=\"\\"
P-Access-Network-Info:
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 3home-a\"
Via: SIP/2.0/UDP as-hA1.home-A.net;branch=z9hG4bK351g45.5
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.4
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.3
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.2
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Content-Type:
Content-Length: (...)
c=
m=
a=
a=
a=
a=
a=
a=
a=
Other SIP header fields and SDP according to 3GPP TS 24.229 [4] and 3GPP TS
29.079 [5].
> **P-Charging-Vector:** The AS-hA1 replaces the \"orig-ioi\" header field
> parameter. The AS-hA1 sets the type 3 \"orig-ioi\" header field parameter to
> a value that identifies the sending network. In the example the AS-hA1
> belongs to the same network as the S-CSCF-hA1 and thus the value is the same
> as the IOI value received from S-CSCF-hA1, i.e. \"home-a\". If the AS is
> provided by a 3^rd^ Party Service Provider, the value will be different than
> the value received from S-CSCF-hA1 If more than one AS is within the path
> the \"orig-ioi\" header field parameter values could be changed based on the
> relation between S‑CSCF‑hA1 and the related AS.
>
> **Record-Route:** The entries to this header field need to be added based on
> the related dip\'s to the AS. The AS could behave as B2BUA. In such case the
> AS could store the entries and setup a new Record**‑** Route header field
> with the AS as the only entry.
>
> **Via:** The AS-hA1 adds a Via header field.
Editor\'s note: The behaviour of the transit-ioi value is currently discussed
and needs further consideration how the S-CSCF to AS correlation is describes.
> **8\. INVITE request (S-CSCF-hA1 to IBCF-hA1) - see example in table
> 5.4.2-8.**
>
> When the S-CSCF‑hA1 receives the initial INVITE request and the
> \"g.3gpp.home-visited\" Feature-Caps header field parameter is still in the
> request, the S-CSCF‑hA1 decides according to local policy that loopback
> routeing will be used.
>
> The S-CSCF‑hA1 includes:
\- the TRF URI included in the \"+g.3gpp.trf\" Feature-Caps header field
parameter in the Route header field;
\- a Feature-Caps header field with the \"+g.3gpp.loopback\" header field
parameter to indicate that loopback routeing is ongoing. The
\"+g.3gpp.loopback\" header field parameter can optionally contain the name of
the home network; and
\- the \"orig-ioi\" header field parameter within the P-Charging-Vector header
field will be replaced by a type 1 IOI which reflects the home network of user
A (i.e. \"home-a\"). Any \"transit-ioi\" header field parameter for the path
P-CSCF-vA1 to S-CSCF-hA1 will not be maintained after this point.
> The S-CSCF‑hA1 removes the \"+g.3gpp.home-visited\" and \"+g.3gpp.trf\"
> Feature-Caps header field parameters.
NOTE 4: Number normalization and ENUM translation is deferred to the visited
network according to local policy.
> The INVITE request is sent according to 3GPP TS 24.229 [4] to the IBCF-hA1.
Table 5.4.2-8: INVITE request (S-CSCF-hA1 to IBCF-hA1)
INVITE tel:+4687197378 SIP/2.0
To:
From:
P-Asserted-Identity:
P-Asserted-Service:
Contact:
CSeq:
Supported:
Route: \,\
Record-Route: \,\,
\,\,
\,\,
\
Feature-Caps:*;+g.3gpp.loopback=\"\\"
P-Access-Network-Info:
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 1home-a\"
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.6
Via: SIP/2.0/UDP as-hA1.home-A.net;branch=z9hG4bK351g45.5
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.4
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.3
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.2
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Content-Type:
Content-Length: (...)
c=
m=
a=
a=
a=
a=
a=
a=
a=
Other SIP header fields and SDP according to 3GPP TS 24.229 [4] and 3GPP TS
29.079 [5].
> **Route:** The S-CSCF-hA1 adds the Route header field received in the
> \"+g.3gpp.trf\" header field parameter as the bottom most Route header field
> (including traffic leg information in the received \"iotl\" SIP URI
> parameter). The Route header field with the address of the selected IBCF-hA2
> is added at the top.
>
> **Via:** The S-CSCF-hA1 adds a Via header field.
>
> **Record-Route:** The S-CSCF-hA1 adds a Record-Route header field.
>
> **Feature-Caps:** The S-CSCF-hA1 adds a Feature-Caps header field with the
> \"+g.3gpp.loopback\" header field parameter set to the identifier of the
> home network to indicate that loopback routeing is ongoing.
>
> **P-Charging-Vector:** The S-CSCF-hA1 replaces the type 3 IOI value received
> in the \"orig-ioi\" header field parameter from the AS-hA1 with a type 1
> \"orig-ioi\" header field parameter identifying the sending network (i.e.
> home network hA).\ Thus the \"orig-ioi\" header field parameter value is now
> different compared with the received INVITE at the IBCF‑hA1 from the visited
> network.
>
> **9\. INVITE request (IBCF-hA1 to IC-A1) - see example in table 5.4.2-9.**
>
> When the IBCF-hA1 receives the initial INVITE request containing the
> \"+g.3gpp.loopback\" header field parameter in a Feature-Caps header field,
> the IBCF-hA1 updates the SDP as defined within 3GPP TS 29.079 [5].
>
> The IBCF-hA1 selects to route the INVITE request via an IC network A and
> sends the INVITE request according to 3GPP TS 24.229 [4] to the IC-A1. From
> theory it could be also another IC network but that is due to SLA and
> operator policy. The IBCF-vA1 determines the next hop IP address from the
> URI in the first entry of the Route header field either by configured
> information or using a DNS query according to IETF RFC 3263 [13]. If the
> subsequent interconnection network is SIP-aware, the determined IP address
> will belong to the SIP proxy IC-A1. Otherwise the determined IP address will
> point to IBCF-vA1 and step 10 is skipped (not reflected in message details
> below).
Table 5.4.2-9: INVITE request (IBCF-hA1 to IC-A1)
INVITE tel:+4687197378 SIP/2.0
To:
From:
P-Asserted-Identity:
P-Asserted-Service:
Contact:
CSeq:
Supported:
Route: \,\
Record-Route: \,\,
\,\,
\,\,
\,\
Feature-Caps:
P-Access-Network-Info:
P-Charging-Vector:
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.7
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.6
Via: SIP/2.0/UDP as-hA1.home-A.net;branch=z9hG4bK351g45.5
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.4
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.3
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.2
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Content-Type:
Content-Length: (...)
c=IN IP6 [5555::aaa:bbb:ccc:dd1]
m=audio 16002 RTP/AVP 97 98
a=
a=
a=
a=
a=visited-realm:1 visited-A1.net IN IP6 [5555::aaa:bbb:ccc:ddd] 16000
a=visited-realm:2 x.net IN IP6 [5555::aaa:bbb:ccc:dd1 16002]
Other SIP header fields and SDP according to 3GPP TS 24.229 [4] and 3GPP TS
29.079 [5].
**Route:** The IBCF-hA1 adds a Route header field with the address of the
selected node in the IC network A.
**Record-Route:** The entries to this header field need to be added based on
operator policy. The example shows the possible Record-Route header field when
no restriction according to the operator policy applies. Based on topology
hiding functionality the IBCF‑hA1 will either forward the Record‑Route header
field with:
\- one visible IBCF‑hA1 entry and the remaining collected entries as one
hidden entry; or
\- an IBCF‑hA1 entry and whole content of already collected entries as visible
entries.
**Via** : Based on topology hiding functionality the IBCF‑hA1 will either
forward the Via header field with:
\- one visible IBCF‑hA1 Via header field and the remaining collected set of
Via header fields as one hidden Via header field; or
\- an IBCF‑hA1 Via header field and the whole set of already collected Via
header fields as visible entries.
**SDP:** IBCF-hA1 detects, by inspecting the received set of OMR visited-realm
attributes, that the resources in realm instance 4 (i.e. the IBCF-hA1 acting
as an entry IBCF in the home network) can be bypassed and removes the
\"a=visited-realm:4 home-A.net IN IP6 [5555::aaa:bbb:ccc:dd3]\" from the
outgoing SDP offer. The c-line and the m-line are updated to be the IP address
and port of the IBCF-vA1.
> **10\. INVITE request (IC-A1 to IBCF-vA1) - see example in table 5.4.2-10.**
NOTE 5: If the interconnection network is SIP-unaware, step 10 is skipped.
> When the IC-A1 receives the initial INVITE request the IC-A1 detects that an
> optimal media path avoiding media to be sent through the home IMS network hA
> is possible. The IC-A1 updates the SDP according to 3GPP TS 29.079 [5].
>
> The IC-A1 selects an entry IBCF in the visited network and sends the INVITE
> request according to 3GPP TS 24.229 [4] to the IBCF-vA1. Seen from principle
> point of view the IBCF could be any entry point (IBCF-vAx) of the visited
> network.
>
> The content of the Record-Route header field and the Via header field will
> be based on local policy and updated accordingly.
>
> IC-A1 detects that the IP address in the SDP offer is within the same realm
> as the on the outgoing side of IC-A1 and determines that the IC-A1 can be
> bypassed by media and uses the incoming SDP offer as the outgoing SDP offer.
Table 5.4.2-10: INVITE request (IC-A1 to IBCF-vA1)
INVITE tel:+4687197378 SIP/2.0
To:
From:
P-Asserted-Identity:
P-Asserted-Service:
Contact:
CSeq:
Supported:
Route: \,\
Record-Route: \
\,\,
\,\,
\,\,
\,\
Feature-Caps:
P-Access-Network-Info:
P-Charging-Vector:icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 1home-a\";transit-ioi=\"ICt.1\"
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.8
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.7
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.6
Via: SIP/2.0/UDP as-hA1.home-A.net;branch=z9hG4bK351g45.5
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.4
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.3
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.2
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Content-Type:
Content-Length: (...)
c=
m=
a=
a=
a=
a=
a=
a=
Other SIP header fields and SDP according to 3GPP TS 24.229 [4] and 3GPP TS
29.079 [5].
**Via:** The IC-A1 adds a Via header field.
**Route:** The IC-A1 adds a Route header field with the address of the
selected node in the visited network A.
**Record-Route:** The IC-A1 adds a Record-Route header field.
P-Charging-Vector: The IC-A1 adds the \"transit-ioi\" header field with a
value identifying the interconnection network A (i.e. \"ICt.1\").
> **11\. INVITE request (IBCF-vA1 to TRF‑vA1) - see example in table
> 5.4.2-11.**
>
> When the IBCF-vA1 receives the initial INVITE request containing the
> \"+g.3gpp.loopback\" header field parameter in a Feature-Caps header field,
> the IBCF-vA1 searches for a possible optimal media path and detects that an
> optimal media path within the visited network is possible. The IBCF‑vA1
> updates the SDP according to 3GPP TS 29.079 [5].
>
> The IBCF-vA1 sends the INVITE request according to 3GPP TS 24.229 [4] to the
> TRF-vA1.
>
> The content of the Record-Route header field and the Via header field will
> be based on local policy and updated accordingly.
>
> In this example, the IBCF-hA1 does not add any \"transit-ioi\" header field
> parameter in the P-Charging-Vector header field. However, the IBCF-hA1 adds
> the \"transit-ioi\" header field parameter based on local policy, when the
> \"transit-ioi\" identifying the preceding interconnection network is not
> included in the received request (e.g. when the preceding interconnection
> network is not an IMS transit network).
Table 5.4.2-11: INVITE request (IBCF-vA1 to TRF vA1)
INVITE tel:+4687197378 SIP/2.0
To:
From:
P-Asserted-Identity:
P-Asserted-Service:
Contact:
CSeq:
Supported:
Route: \
Record-Route: \
\
\,\,
\,\,
\,\,
\,\
Feature-Caps:
P-Access-Network-Info:
P-Charging-Vector:
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.9
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.8
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.7
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.6
Via: SIP/2.0/UDP as-hA1.home-A.net;branch=z9hG4bK351g45.5
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.4
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.3
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.2
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Content-Type:
Content-Length: (...)
c=IN IP6 5555::aaa:bbb:ccc:ddd
m=audio 16000 RTP/AVP 97 98
a=
a=
a=
a=
a=visited-realm:1 visited-A1.net IN IP6 5555::aaa:bbb:ccc:dd1 16000
Other SIP header fields and SDP according to 3GPP TS 24.229 [4] and 3GPP TS
29.079 [5].
**Via:** The IBCF-vA1 adds a Via header field.
**Record-Route:** The IBCF-vA1 adds a Record-Route header field.
**SDP:** IBCF-vA1 detects that the realm in the \"a=visited-realm:1
visited-A1.net IN IP6 [5555::aaa:bbb:ccc:ddd] 1600\" in the incoming SDP offer
is the same realm as on the outgoing side of IBCF-vA1 and determines that the
IBCF-vA1 \"a=visited-realm:2 x.net IN IP6 [5555::aaa:bbb:ccc:dd1] 16002\" can
be bypassed. The c-line and the m-line are updated to be the IP address and
port of the UE-A.
> **12\. INVITE request (TRF‑vA1 to IBCF-vA1).**
>
> When the TRF‑vA1 receives the initial INVITE request the TRF‑vA1:
\- performs number normalization (if used by local policy) and ENUM
translation and possibly updates the request-URI if necessary;
\- replaces an type 1 \"orig-ioi\" header field parameter value in the
P-Charging-Vector header field with a type 2 \"orig‑ioi\" header field
parameter value where the IOI value identifies the visited network;
\- possibly adds an additional Route header field pointing to the IBCF‑vA1 and
also to the IC in cases where the IBCF-vA1 has no routeing decision to do;
\- removes the \"+g.3gpp.loopback\" header field parameter from the Feature-
Caps header field of the outgoing request; and
\- appends the \"iotl\" SIP URI parameter with the value \"visitedA-homeB\" to
the Request-URI.
The TRF‑vA1 selects an IBCF to act as an exit point and sends the INVITE
request according to 3GPP TS 24.229 [4] to the IBCF-vA1 (which could be also
another IBCF e.g. IBCF‑vA2).
The content of the Record-Route header field and the Via header field will be
based on local policy and updated accordingly.
The OMR specific attributes in the SDP are kept as received from the IBCF-vA1.
> **13\. INVITE request (IBCF-vA1 to IC-T1) - see example in table 5.4.2-13.**
When the IBCF-vA1 receives the initial INVITE request the IBCF-vA1 selects the
IC-T1 if not already a Route header field exists pointing to the IC-T1. The
IBCF-vA1 determines the next hop IP address from the Request**‑** URI either
by configured information or using a DNS query according to IETF RFC 3263
[13]. If the subsequent interconnection network is SIP-aware, the determined
IP address will belong to the SIP proxy IC-T1. Otherwise the determined IP
address will point to an IBCF acting as an entry point in the remote home
network (not reflected in message details below).
Record-Route header field and Via header field will be based on local policy
and updated accordingly. The example in table 5.4.2-13 shows one example of
the content of the header fields and the text below the table explains other
possibilities.
The IBCF-vA1 removes all OMR specific attributes from the SDP offer.
Table 5.4.2-13: INVITE request (IBCF-vA1 to IC-T1)
INVITE sip:+4687197378\@home-R.net;user=phone;iotl=visitedA-homeB SIP/2.0
To:
From:
P-Asserted-Identity:
P-Asserted-Service:
Contact:
CSeq:
Supported:
Route: \
Record-Route: \,\,
\,\,
\,\,
\,\,
\,\,
\,\
P-Access-Network-Info:
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"visited-a\"
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.11
Via: SIP/2.0/UDP trf-vA1.visited-A.net;branch=z9hG4bK351g45.10
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.9
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.8
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.7
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.6
Via: SIP/2.0/UDP as-hA1.home-A.net;branch=z9hG4bK351g45.5
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.4
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.3
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.2
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Content-Type:
Content-Length: (...)
c=IN IP6 [5555::aaa:bbb:ccc:dd1]
m=audio 16016 RTP/AVP 97 98
a=
a=
a=
a=
Other SIP header fields and SDP according to 3GPP TS 24.229 [4] and 3GPP TS
29.079 [5].
**Route:** The IBCF-vA1 adds a Route header field with the address of the
selected node in the IC network B.
> **Record-Route:** Based on topology hiding functionality the IBCF-vA1 will
> either forward the Record-Route header field with:
\- one visible IBCF-vA1 entry and the remaining collected entries as one
hidden entry; or
\- an IBCF-vA1 entry and whole content of already collected entries as visible
entries.
**Via:** Based on topology hiding functionality the IBCF-vA1 will either
forward the Via header field with:
\- one visible IBCF-vA1 Via header field and the remaining collected set of
Via header fields as one hidden Via header field; or
\- an IBCF-vA1 Via header field and the whole set of already collected Via
header fields as visible entries.
**SDP:** The IBCF-vA1 anchor media and insert the IBCF-vA1 IP address and port
number.
> **14\. 183 (Session Progress) response (IC-T1 to IBCF-vA1) - see example in
> table 5.4.2-14.**
NOTE 6: If the interconnection network is SIP-unaware, step 14 is executed
between IBCF-hB and IBCF-vA1 instead.
IC-T1 forwards the received 183 (Session Progress) response to the IBCF-vA1
based on the Via header field.
Record-Route header field and Via header fields will be updated accordingly.
The example in table 5.4.2-14 shows one example of the content of the header
fields.
Table 5.4.2-14: SIP 183 (Session Progress) response (IC-T1 to IBCF-vA1)
SIP/2.0 183 Session Progress
To: \;tag=654a
From: \;tag=4fa3
P-Asserted-Identity:
\,\
Contact: \
CSeq: 1 INVITE
Require: 100rel, precondition
Record-Route: \,
\,
\,\,
\,\,
\,\,
\,\,
\,\,
\,\
P-Access-Network-Info:
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"visited-a\";term-ioi=\"home-r\";transit-ioi=\"ICt.1\"
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.11
Via: SIP/2.0/UDP trf-vA1.visited-A.net;branch=z9hG4bK351g45.10
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.9
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.8
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.7
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.6
Via: SIP/2.0/UDP as-hA1.home-A.net;branch=z9hG4bK351g45.5
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.4
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.3
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.2
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Content-Type: application/sdp
Content-Length: (...)
c=IN IP6 [5555::aaa:bbb:ccc:dd4]
m=audio 16511 RTP/AVP 97 98
a=curr:qos local none
a=curr:qos remote none
a=des:qos mandatory local sendrecv
a=des:qos none remote sendrecv
Other SIP header fields and SDP according to 3GPP TS 24.229 [4].
> **P-Charging-Vector:** The IC-T1 adds the \"transit-ioi\" header field
> parameter identifying the interconnection network (i.e. ICt.1).
>
> **Require:** The Require header field contains the option‑tag \"100rel\"
> indicating reliable sending of the 183 (Session Progress) response and the
> option‑tag \"precondition\" indicating the usage of the precondition
> mechanism.
>
> **SDP MIME body** The received SDP answer includes connection address
> information for the media line that is a valid IP address other than the
> unspecified address (i.e., IPv4: \"0.0.0.0\", IPv6: \"invalid.invalid\").
>
> **15\. 183 (Session Progress) response (IBCF-vA1 to TRF-vA1) - see example
> in table 5.4.2-15.**
In this example, the IBCF-**v** A1 does not add any \"transit-ioi\" header
field parameter in the P-Charging-Vector header field. However, the IBCF-**v**
A1 adds the \"transit-ioi\" header field parameter based on local policy, when
the \"transit-ioi\" identifying the preceding interconnection network is not
included in the received request (e.g. when the preceding interconnection
network is not an IMS transit network).
Table 5.4.2-15: SIP 183 (Session Progress) response (IBCF-vA1 to TRF-vA1)
SIP/2.0 183 Session Progress
To:
From:
P-Asserted-Identity:
Contact:
CSeq:
Require:
Record-Route: \,
\,
\,\,
\,\,
\,\,
\,\,
\,\,
\,\
P-Access-Network-Info:
P-Charging-Vector:
Via: SIP/2.0/UDP trf-vA1.visited-A.net;branch=z9hG4bK351g45.10
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.9
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.8
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.7
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.6
Via: SIP/2.0/UDP as-hA1.home-A.net;branch=z9hG4bK351g45.5
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.4
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.3
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.2
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Content-Type:
Content-Length: (...)
c=IN IP6 [5555::aaa:bbb:ccc:dd1]
t=0 0
m=audio 16511 RTP/AVP 97 98
a=
a=
a=
a=
a=visited-realm:1 visited-A1.net IN IP6 [5555::aaa:bbb:ccc:dd1] 16511
Other SIP header fields according to 3GPP TS 24.229 [4].
> **SDP MIME body: The IBCF-vA1 adds the** a=visited-realm according to 3GPP
> TS 29.079 [5] indicating that an optimal media route has occurred and
> replaces the received IP address with its own IP address.
>
> **16\. 183 (Session Progress) response (TRF-vA1 to IBCF-vA1) - see example
> in table 5.4.2-16.**
Table 5.4.2-16: SIP 183 (Session Progress) response (TRF-vA1 to IBCF-vA1)
SIP/2.0 183 Session Progress
To:
From:
P-Asserted-Identity:
Contact:
CSeq:
Require:
Record-Route: \,
\,
\,\,
\,\,
\,\,
\,\,
\,\,
\,\
P-Access-Network-Info:
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 1home-a\";term-ioi=\"Type 1visited-a\";loopback
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.9
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.8
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.7
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.6
Via: SIP/2.0/UDP as-hA1.home-A.net;branch=z9hG4bK351g45.5
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.4
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.3
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.2
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Content-Type:
Content-Length: (...)
c=
m=
a=
a=
a=
a=
a=
For the content of the SDP see table 5.4.2-15.
Other SIP header fields according to 3GPP TS 24.229 [4].
> **P-Charging-Vector: The** TRF-vA1 removes the **\"transit-ioi\" header
> field parameter and replaces the \"orig-ioi\" received from the IBCF-vA1
> with the \"orig-ioi\" received from the home network in the INVITE request
> and replaces the \"term-ioi\" with the received IOI type 2 value to a IOI
> type 1 value identifying the visited network vA. The TRF-vA1 adds the
> loopback-indication header field parameter.**
>
> **17\. 183 (Session Progress) response (IBCF-vA1 to IC-A1) - see example in
> table 5.4.2-17.**
When the IBCF-vA1 receives the 183 (Session Progress) response the IBCF-vA1
updates the SDP as follows:
\- The c=IN IP4 192.0.2.4 is replaced with an invalid IPv4 address, i.e. c=IN
IP4 0.0.0.0, since the IP realm on visited network side and the IC network
side are not the same hence the received IP address is not valid on the IC
side. The received SDP answer includes connection address information for the
media line that is a valid IP address other than the unspecified address
(i.e., IPv4: \"0.0.0.0\", IPv6: \"invalid.invalid\").
The IBCF-vA1 sends the 183 (Session Progress) response according to 3GPP TS
24.229 [4] towards the S**‑** CSCF**‑** hA via the IC-A1 and IBCF-hA1. Neither
the IC-A1 nor IBCF-hA1 updates the SDP.
NOTE 7: If the interconnection network is SIP-unaware, IC-A1 is omitted.
Table 5.4.2-17: SIP 183 (Session Progress) response (IBCF-vA1 to IC-A1)
SIP/2.0 183 Session Progress
To:
From:
P-Asserted-Identity:
Contact:
CSeq:
Require:
Record-Route: \,
\,
\,\,
\,\,
\,\,
\,\,
\,\,
\,\
P-Access-Network-Info:
P-Charging-Vector:
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.8
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.7
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.6
Via: SIP/2.0/UDP as-hA1.home-A.net;branch=z9hG4bK351g45.5
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.4
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.3
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.2
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Content-Type:
Content-Length: (...)
c=IN IP6 invalid.invalid
m=audio 16511 RTP/AVP 97 98
a=
a=a=
a=
a=visited-realm:1 visited-A1.net IN IP6 [5555::aaa:bbb:ccc:dd1]16511
Other SIP header fields and SDP according to 3GPP TS 24.229 [4].
> **SDP MIME body: The IBCF-vA1 detects that the realm is different towards
> the IC-A1 than in the \"** a=visited**‑** realm\" attribute and changes the
> IP address to c=IN IP6 invalid.invalid.
>
> **18\. 183 (Session Progress) response (IC-A1 to IBCF-hA1) - see example in
> table 5.4.2-18.**
NOTE 8: If the interconnection network is SIP-unaware, step 18 is skipped.
Table 5.4.2-18: SIP 183 (Session Progress) response (IC-A1 to IBCF-hA1)
SIP/2.0 183 Session Progress
To:
From:
P-Asserted-Identity:
Contact:
CSeq:
Require:
Record-Route: \,
\,
\,\,
\,\,
\,\,
\,\,
\,\,
\,\
P-Access-Network-Info:
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 1home-a\";term-ioi=\"Type 1visited-a\";transit-
ioi=\"ICa.1\";**loopback**
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.7
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.6
Via: SIP/2.0/UDP as-hA1.home-A.net;branch=z9hG4bK351g45.5
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.4
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.3
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.2
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Content-Type:
Content-Length: (...)
c=
m=
a=
a=
a=
a=
a=
For the content of the SDP see table 5.4.2-17.
Other SIP header fields and SDP according to 3GPP TS 24.229 [4].
> **P-Charging-Vector:** The IC-A1 adds the \"transit-ioi\" header field
> parameter identifying the interconnection network (i.e. ICa.1).
>
> **19-24. 183 (Session Progress) response (loop from IBCF-hA1 to IBCF-vA1 via
> S** ‑**CSCF** ‑**hA1, AS** ‑**hA1, S** ‑**CSCF** ‑**hA1, IBCF** ‑**hA1 and
> IC** ‑**A1) handling.**
The procedures of 3GPP TS 24.229 [4] apply. The main changes are:
\- the deduction of Via header field; and
\- the P-Charging-Vector is updated with IOI type values corresponding to the
INVITE request along the signalling path (see clause 4.3.1.4).
NOTE 9: If the interconnection network is SIP-unaware, step 24 is skipped.
The IBCF-hA1 and the IC-A1 releases resources reserved in the media gateway.
The content of the SDP answer is kept unchanged.
> **25\. 183 (Session Progress) response (IBCF-vA1 to P-CSCF-vA1) - see
> example in table 5.4.2-25.**
When the IBCF-vA1 receives the 183 (Session Progress) response the IBCF- vA1
updates the SDP.
The IBCF- vA1:
\- replaces the received invalid IPv6 address with the IP address received in
the visited-realm instance 1;
\- removes all OMR specific attributes since the SDP offer from P-CSCF-A did
not contain any OMR specific attributes;
\- releases resources reserved in the TrGW.
The IBCF-vA1 sends the 183 (Session Progress) response according to 3GPP TS
24.229 [4] to the P-CSCF-vA1.
Table 5.4.2-25: SIP 183 (Session Progress) response (IBCF-vA1 to P-CSCF-vA1)
SIP/2.0 183 Session Progress
To:
From:
P-Asserted-Identity:
Contact:
CSeq:
Require:
Record-Route: \,
\,
\,\,
\,\,
\,\,
\,\,
\,\,
\,\
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 1visited-a\";term-ioi=\"Type 1home-a\";transit-
ioi=\"ICa.1\";loopback
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Content-Type:
Content-Length: (...)
c=IN IP6 [5555::aaa:bbb:ccc:dd1]
m=audio 16511 RTP/AVP 97 98
a=
a=
a=
a=
Other SIP header fields and SDP according to 3GPP TS 24.229 [4].
> **26\. 183 (Session Progress) response (P-CSCF-vA1 to UE-A) - see example in
> table 5.4.2-26.**
Table 5.4.2-26: SIP 183 (Session Progress) response (P-CSCF-vA1 to UE-A)
SIP/2.0 183 Session Progress
To:
From:
P-Asserted-Identity:
Contact:
CSeq:
Require:
Record-Route: \,
\,
\,\,
\,\,
\,\,
\,\,
\,\,
\,\
Via: SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Content-Type:
Content-Length: (...)
c=
m=
a=
a=
a=
a=
Other SIP header fields and SDP according to 3GPP TS 24.229 [4].
> **27\. PRACK request (UE-A to IC-T1 via all intermediate nodes) and 200 OK
> response (IC-T1 to UE-A via all intermediate nodes).**
The PRACK request and the 200 (OK) response to the PRACK request are sent
without any SDP offer/SDP answer between the UE-A and the IC-T1 according to
3GPP TS 24.229 [4].
> **28\. Resource Reservation.**
>
> **29\. UPDATE request (UE-A to IC-T1 via all intermediate nodes) and 200 OK
> response (IC-T1 to UE-A via all intermediate nodes).**
The UPDATE request and the 200 (OK) response to the UPDATE request are sent
with the same SDP offer and SDP answer as in the initial SIP INVITE request
and the 183 (Session Progress) response but now indicating that resources are
reserved at the UE-A. The SDP updates are the same as in steps 1 -- 26.
> **30\. UPDATE request (IC** ‑**T1 to UE** ‑**A via all intermediate nodes)
> and 200 OK response (UE** ‑**A to IC** ‑**T1 via all intermediate nodes).**
The UPDATE request and the 200 (OK) response to the UPDATE request are sent
according to the rules described in 3GPP TS 29.079 [5].
## 5.5 Routeing when the originating and terminating user reside in the same
home network
This clause describes routeing when the originating and terminating user
reside in the same home network.
## 5.6 Routeing from originating home to terminating home network
The interconnection (IC) and routeing aspects of the originating home network
to the terminating home network including transit networks use case do not
differ from any other session set-up between any two wire-line or mobile
networks. The IC might be established via CS-IC or PS-IC. The routeing might
be based on the destination given by the SIP Request-URI or the Called Party
Number parameter in case of CS-IC.
## 5.7 Routeing from originating visited network to terminating home network
This clause describes routeing from an originating remote network to the
terminating home network A including transit network scenarios.
The signalling and the media path between the originating remote network and
the terminating home network A might be based on SIP/PS or CS/TDM
interconnection interfaces.
NOTE 1: This is different from some other IC scenarios discussed in this
document for which SIP/PS interconnection is a mandatory pre-requisite.
The scenario appears after the \"originating roaming without loopback\"
according to clause 5.3 or the \"originating roaming with loopback\" according
to clause 5.4 has taken place. I.e. the call has already been set-up from the
P**‑** CSCF in the originating visited network via IMS in the originating home
network back to the TRF in the originating visited network.
From viewpoint of the originating remote network it doesn't matter whether the
call originates from an own user served by an own S-CSCF or from a roaming
inbound user served by the TRF. In both cases the originating remote network
will set-up an outgoing call leg via an IBCF acting as an exit point (MGCF, if
CS IC applies) towards the terminating network A. Hereby the path might be
established via IC networks. The destination (i.e. in this case the address of
the terminating home network) used for routing is given by the request line
provided by the originating remote network (CdPty in case of CS IC).
From the viewpoint of the IC network and from the viewpoint of the terminating
home network A the routing and call handling does not differ from calls
originated in any other network. I.e. the fact that the call is originated by
a roamer is neither visible nor required/used for any proceeding.
NOTE 2: Even if a calling party identity (P-Asserted-Identity header field,
From header field) is present and not within the number range of the
originating visited network this does not indicate that the originating party
is an inbound roamer within the originating visited network which sets up the
call. Number portability and forwarding services might result in the same
effect. In any case a mismatch between the calling party identity and address
range of the originating visited network does not result in any deviating
routing procedures within IC or terminating home network.
## 5.8 Routeing in terminating home network when user resides in this network
This use case does not involve any interconnection network and is out of scope
of this technical report.
## 5.9 Routeing from terminating home network to the terminating visited
network
This clause describes routeing from the terminating home network to the
terminating visited network including the traversal of transit network between
the terminating home network and the terminating visited network.
Preconditions:
\- The UE-A is registered as described in clause 5.2.
\- In the originating side the call can be routed either as a call without
loopback as described in clause 5.3 or with loopback as described in clause
5.4.
\- The coding examples assume that the originating network, the
interconnection network and the terminating network are within the trust
domain.
Figure 5.9‑1: Mobile terminating call from terminating home network to
terminating visited network
The steps of the flow are as follows:
> **1\. INVITE request (IBCF-hA2 to I-CSCF-hA1) - see example in table
> 5.9-1.**
>
> An initial INVITE request is received by the IBCF-hA2. Due to bilateral
> agreement all relevant SIP header fields are included. The IBCF-hA2 removes
> any received Route header field pointing to itself and forwards the call to
> the I-CSCF‑hA1 according to 3GPP TS 24.229 [4].
Table 5.9-1: INVITE request (IBCF-hA2 to I-CSCF-hA1)
INVITE sip:+12375551111\@home-A.net;user=phone;iotl=homeA-homeB SIP/2.0
To: \
From: \;tag=4fa3
P-Asserted-Identity:
\,\;
P-Asserted-Service: urn:urn-7:3gpp-service.ims.icsi.mmtel
Contact: \
CSeq: 1 INVITE
Supported: 100rel,precondition
Route: \
Record-Route: \,\,\
P-Access-Network-Info: 3GPP-E-UTRAN-TDD;utran-cell-id-3gpp=234151D0FCE22,3GPP-
E-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE22;network-provided;local-time-
zone=\"UTC+01:00\";daylight-saving-time=\"01\"
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"home-r\";transit-ioi=\"ICt.1\"
Via: SIP/2.0/UDP ibcf-hA2.home-R.net;branch=z9hG4bK351g45.13
Via: SIP/2.0/UDP ic-T1.interconnection-T.net;branch=z9hG4bK351g45.12
Via: \
Other SIP header fields and SDP according to 3GPP TS 24.229 [4]
> **Request-URI:** Contains the destination address for the INVITE request. In
> this example a SIP URI with user=phone is used. It could be also a tel URI.
> The \"iotl\" SIP URI parameter indicates that this is call between two home
> networks and that the URI in the Request-URI is the destination. If the
> remote UE is roaming and loopback routeing is used, the \"iotl\" SIP URI
> parameter would be set to \"visitedA‑homeB\".
>
> **Supported:** The Supported header field contains the option-tag \"100rel\"
> indicating support of the reliable provisional responses and the option-tag
> \"precondition\" indicating support of the precondition mechanism.
>
> **P-Charging-Vector:** The P-Charging-Vector contains the type 2 \"orig-
> ioi\" of the call which is either the remote UE\'s home network or the
> remote UE\'s visited network when loopback applies. In this example the
> \"orig-ioi\" contains the remote UE\'s home network. Contains the \"transit-
> ioi\" header field parameter identifying the interconnection network.
>
> **Contact:** The Contact header field contains in this example the IP
> address of the remote UE. But due to network rules it could be also the IP
> address a downstream B2BUA.
>
> **Route:** The IBCF-hA2 adds a Route header field which points to I-CSCF‑hA1
> in the home network hA.
>
> **Record-Route:** Depending on the policy of the intermediate network the
> content of the Record-Route header field can vary. The Record-Route header
> field includes all entries included in the received INVITE request plus an
> entry of the incoming IBCF-hA2.
>
> **Via:** The Via header field includes all entries included in the received
> INVITE request plus the entry of the incoming IBCF-hA2.
>
> **2\. INVITE request (I-CSCF-hA1 to S-CSCF-hA1) - see example in table
> 5.9-2.**
When the I-CSCF-hA1 receives the initial INVITE request it queries the SLF/HSS
to identify the correct S**‑** CSCF where the call has to be routed to. Due to
normal routing procedures the S-CSCF will be allocated by the HSS procedures
as described in 3GPP TS 24.229 [4].
Table 5.9-2: INVITE request (I-CSCF-hA1 to S-CSCF-hA1)
INVITE tel:+12375551111 SIP/2.0
To:
From:
P-Asserted-Identity:
P-Asserted-Service:
Contact:
CSeq:
Supported:
Route: \
Record-Route: \,\,\
P-Access-Network-Info:
P-Charging-Vector:
or when loopback in the originating path apply then:
P-Charging-Vector:
Via: SIP/2.0/UDP icscf-hA1.home-A.net;branch=z9hG4bK351g45.13a
Via: SIP/2.0/UDP ibcf-hA2.home-A.net;branch=z9hG4bK351g45.13
Via: SIP/2.0/UDP ic-T1.interconnection-T.net;branch=z9hG4bK351g45.12
Via: \
Other SIP header fields and SDP according to 3GPP TS 24.229 [4].
> **Request-URI:** Contains the destination address for the INVITE request. In
> this case the I-CSCF-hA1 changes the URI from a SIP URI user=phone to a tel
> URI as described in 3GPP TS 24.229 [4].
>
> **Via:** The I-CSCF‑hA1 adds a Via header field.
>
> **3.-4. INVITE request (S-CSCF-hA1 to AS-hA1 to S-CSCF-hA1).**
The S-CSCF applies the filter criteria to involve the AS for terminating
services.
> **Record-Route:** The entries to this header field need to be added based on
> the related dip\'s to the AS. The AS could behave as B2BUA. In such case the
> AS could store the entries and setup a new Record**‑** Route header field
> only with the AS URI as an entry. Both the AS-hA1 and the S-CSCF-hA1 adds
> Record-Route header fields.
>
> **P-Charging-Vector:** Towards the AS‑hA1 the P-Charging-Vector header field
> contains the type 3 \"orig-ioi\" identifying the network of the S-CSCF-hA1
> sending the request. Towards the S‑CSCF‑hA1 the P-Charging-Vector header
> field contains the type 3 \"orig-ioi\" identifying the network of the AS‑hA1
> sending the request.
>
> **Route:** The S-CSCF-hA1 adds a Route header field identifying the selected
> AS-hA1 and S**‑** CSCF**‑** hA1 for routing back.
>
> **Via:** Both the AS‑hA1 and the S-CSCF-hA1 adds Via header fields.
Editor\'s note: The behaviour of the transit-ioi value is currently discussed
and needs further consideration how the S-CSCF to AS correlation is describes.
> **5\. INVITE request (S-CSCF-hA1 to IBCF-hA1) - see example in table
> 5.9-5.**
Since the call is a terminating call no further specific information is needed
for termination of the call.
The S-CSCF-hA1 sends the INVITE request according to 3GPP TS 24.229 [4] to the
IBCF-hA1.
Table 5.9-5: INVITE request (S-CSCF-hA1 to IBCF-hA1)
INVITE sip:[5555::ddd:aaa:ccc:bbb] SIP/2.0
To:
From:
P-Asserted-Identity:
P-Asserted-Service:
Contact:
CSeq:
Supported:
Route:\,
\,
\,
\
Record-Route: \,
\,\,
\,\,\
P-Access-Network-Info:
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 1home-a\"
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.16
Via: SIP/2.0/UDP as-hA1.home-A.net;branch=z9hG4bK351g45.15
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.14
Via: SIP/2.0/UDP icscf-hA1.home-A.net;branch=z9hG4bK351g45.13a
Via: SIP/2.0/UDP ibcf-hA2.home-A.net;branch=z9hG4bK351g45.13
Via: SIP/2.0/UDP ic-T1.interconnection-T.net;branch=z9hG4bK351g45.12
Via: \
Other SIP header fields and SDP according to 3GPP TS 24.229 [4].
> **Request-URI:** The S‑CSCF‑hA1 replaces the received tel URI with the SIP
> URI received in the Contact header field from the UE‑A during the
> registration.
>
> **Route:** The S‑CSCF includes a Route header field with the routeing
> information received in the Path header field during registration.
>
> **P-Charging-Vector:** The S-CSCF-hA1 replaces the received IOI type 3 value
> in the \"orig-ioi\" header field parameter with a IOI type 1 value
> identifying the home network of the UE-A.
>
> **Via:** The S-CSCF-hA1 adds a Via header field.
>
> **Record-Route:** The S-CSCF-hA1 adds a Record-Route header field.
>
> **6\. INVITE request (IBCF-hA1 to IC-A1) see example in table 5.9-6.**
The IBCF‑hA1 applies local policy which is dependent on the operator policy
for roaming calls with that specific visited network and the intermediate
transit network. Header fields can be deleted or anonymized.
The IBCF-hA1 selects, based on the Route header field as shown table 5.9-5 or
in cases where the Path header field received during registration only points
to the visited network, based on local policy, to route the INVITE request via
IC network A and sends the INVITE request according to 3GPP TS 24.229 [4] to
the IC-A1.
The IBCF-hA1 determines the next hop IP address from the URI in the first
entry of the Route header field either by configured information or using a
DNS query according to IETF RFC 3263 [13]. If the subsequent interconnection
network is SIP-aware, the determined IP address will belong to the SIP proxy
IC-A1. Otherwise the determined IP address will point to IBCF-vA1 and step 7
is skipped (not reflected in message details below).
The procedures apply to 3GPP TS 24.229 [4].
Table 5.9-6: INVITE request (IBCF-hA1 to IC-A1)
INVITE sip:[5555::ddd:aaa:ccc:bbb] SIP/2.0
To:
From:
P-Asserted-Identity:
P-Asserted-Service:
Contact:
CSeq:
Supported:
Route:\,
\,
\
Record-Route:\,
\,
\,\,
\,\,\
P-Access-Network-Info:
P-Charging-Vector:
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.17
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.16
Via: SIP/2.0/UDP as-hA1.home-A.net;branch=z9hG4bK351g45.15
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.14
Via: SIP/2.0/UDP icscf-hA1.home-A.net;branch=z9hG4bK351g45.13a
Via: SIP/2.0/UDP ibcf-hA2.home-A.net;branch=z9hG4bK351g45.13
Via: SIP/2.0/UDP ic-T1.interconnection-T.net;branch=z9hG4bK351g45.12
Via: \
Other SIP header fields and SDP according to 3GPP TS 24.229 [4].
> **Via:** The IBCF-hA1 adds a Via header field.
>
> **Record-Route:** The IBCF-hA1 adds a Record-Route header field.
>
> **7\. INVITE request (IC-A1 to IBCF-vA1) - see example in table 5.9-7.**
NOTE 1: If the interconnection network is SIP-unaware, step 7 is skipped (not
reflected in message details below).
Based on the Route header field, the IC-T1 selects an entry point (IBCF-vA1)
of the visited IMS network vA and sends the INVITE request according to 3GPP
TS 24.229 [4] to the IBCF-vA1.
In our example the entry point of visited network vA is already included in
the received Route header field. However, the IC- A1 can add a Route header
field entry pointing to the entry point of the visited network vA if the entry
point is missing.
Table 5.9-7: INVITE request (IC-A1 to IBCF-vA1)
INVITE sip:[5555::ddd:aaa:ccc:bbb] SIP/2.0
To:
From:
P-Asserted-Identity:
P-Asserted-Service:
Contact:
CSeq:
Supported:
Route:\,
\
Record-Route: \,
\,\,
\,\,
\,\,\
P-Access-Network-Info:
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 1home-a\";transit-ioi=\"ICa.1\"
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.18
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.17
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.16
Via: SIP/2.0/UDP as-hA1.home-A.net;branch=z9hG4bK351g45.15
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.14
Via: SIP/2.0/UDP icscf-hA1.home-A.net;branch=z9hG4bK351g45.13a
Via: SIP/2.0/UDP ibcf-hA2.home-A.net;branch=z9hG4bK351g45.13
Via: SIP/2.0/UDP ic-T1.interconnection-T.net;branch=z9hG4bK351g45.12
Via: \
Other SIP header fields and SDP according to 3GPP TS 24.229 [4].
> **P-Charging-Vector:** The IC-A1 adds the \"transit-ioi\" header field
> parameter identifying the interconnection network (i.e. ICa.1).
>
> **Via:** The IC-A1 adds a Via header field (i.e.
> ic-A1.interconnection-A.net).
>
> **Record-Route:** The IC-A1 adds a Record-Route header field (i.e.
> ic-A1.interconnection-A.net).
>
> **8\. INVITE request (IBCF-vA1 to P-CSCF-vA1) - see example in table
> 5.9-8.**
The IBCF-vA1 routes the call to the P-CSCF-vA1 as stated within the Route
header field.
IBCF-vA1 applies local policy based on trust relationship with the transit
network and SLA between home network carrier and visited network carrier.
If a \"transit-ioi\" header field parameter value exists within the
P-Charging-Vector header field then the values can be forwarded or made void.
In this example, the IBCF-vA1 does not add any \"transit-ioi\" header field
parameter in the P-Charging-Vector header field. However, the IBCF-vA1 adds
the \"transit-ioi\" header field parameter based on local policy, when the
\"transit-ioi\" identifying the preceding interconnection network is not
included in the received request (e.g. when the preceding interconnection
network is not an IMS transit network).
Table 5.9-8: INVITE request (IBCF-vA1 to P-CSCF-vA1)
INVITE sip:[5555::ddd:aaa:ccc:bbb] SIP/2.0
To:
From:
P-Asserted-Identity:
P-Asserted-Service:
Contact:
CSeq:
Supported:
Route:\
Record-Route: \,\,
\,\,
\,\,
\,
\,
\
P-Access-Network-Info:
P-Charging-Vector:
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.19
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.18
Via: SIP/2.0/UDP ibcf-hA2.home-A.net;branch=z9hG4bK351g45.17
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.16
Via: SIP/2.0/UDP as-hA1.home-A.net;branch=z9hG4bK351g45.15
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.14
Via: SIP/2.0/UDP icscf-hA1.home-A.net;branch=z9hG4bK351g45.13a
Via: SIP/2.0/UDP ibcf-hA2.home-A.net;branch=z9hG4bK351g45.13
Via: SIP/2.0/UDP ic-T1.interconnection-T.net;branch=z9hG4bK351g45.12
Via: \
Other SIP header fields and SDP according to 3GPP TS 24.229 [4].
> **Record-Route:** The IBCF-vA1 adds a Record-Route header field (i.e. IBCF-
> vA1).
>
> **Via:** The IBCF‑vA1 adds a Via header field (i.e. IBCF‑vA1).
>
> **9\. INVITE request (P-CSCF-vA1 to UE-A) - see example in table 5.9-9.**
>
> The P-CSCF-vA1 routes the call to the UE-A as stated within Request-URI
> which contains the address of the UE-A.
>
> Based on privacy settings within the INVITE request, the P-CSCF‑vA1 applies
> privacy according to IETF RFC 3323 [27] and IETF RFC 3325 [28].
>
> The P-CSCF‑vA1 applies trust domain according to 3GPP TS 24.229 [4] clause
> 4.4. This will result in that some header fields will be removed. In our
> example the P-Charging-Vector header field and the P**‑** Access**‑**
> Network**‑** Info header field are removed from the outgoing INVITE request.
>
> The P-CSCF‑vA1 sends the INVITE request according to 3GPP TS 24.229 [4] to
> the UE-A.
Table 5.9-9: INVITE request (P-CSCF-vA1 to UE-A)
INVITE sip:[5555::ddd:aaa:ccc:bbb] SIP/2.0
To:
From:
P-Asserted-Identity:
P-Asserted-Service:
Contact:
CSeq:
Supported:
Record-Route: \,
\,\,
\,\,
\,\,
\,
\,
\
Via: SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.19
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK351g45.18
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.17
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.16
Via: SIP/2.0/UDP as-hA1.home-A.net;branch=z9hG4bK351g45.15
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.14
Via: SIP/2.0/UDP icscf-hA1.home-A.net;branch=z9hG4bK351g45.13a
Via: SIP/2.0/UDP ibcf-hA2.home-A.net;branch=z9hG4bK351g45.13
Via: SIP/2.0/UDP ic-T1.interconnection-T.net;branch=z9hG4bK351g45.12
Via: \
Other SIP header fields and SDP according to 3GPP TS 24.229 [4].
> **Via:** The P-CSCF-vA1 adds a Via header field.
>
> **Record-Route:** The P-CSCF-vA1 adds a Record-Route header field.
>
> **10-18. 183 (Session Progress) response (UE-A to IBCF-hA2 via all
> intermediate nodes in the Via header fields) - see example in table
> 5.9-10.**
The UE-A sends a 183 (Session Progress) response since 100rel and
preconditions are supported by the remote UE.
The routing towards the IBCF-hA2 is based on the Via header fields received by
the UE‑A in the initial INVITE request.
When the IBCF‑hA2 receives the 183 (Session Progress) response, the IBCF‑hA2
sends the 183 (Session Progress) response according to 3GPP TS 24.229 [4]
towards the remote UE as described within clause 5.3 or clause 5.4 of this
document and regarding the rules defined in 3GPP TS 24.229 [4].
The table 5.9-10 shows the content of the 183 (Session Progress) response when
sent by IBCF-hA1.
Table 5.9-10: SIP 183 (Session Progress) response (UE-A to IBCF-hA1) in step
14
SIP/2.0 183 Session Progress
To: \;tag=654a
From: \;tag=4fa3
P-Asserted-Identity: \
Contact: \
CSeq: 1 INVITE
Require:100rel,precondition
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.16
Via: SIP/2.0/UDP as-hA1.home-A.net;branch=z9hG4bK351g45.15
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK351g45.14
Via: SIP/2.0/UDP icscf-hA1.home-A.net;branch=z9hG4bK351g45.13a
Via: SIP/2.0/UDP ibcf-hA2.home-A.net;branch=z9hG4bK351g45.13
Via: SIP/2.0/UDP ic-T1.interconnection-T.net;branch=z9hG4bK351g45.12
Via: \
Record-Route: \,
\,\,
\,\,
\,\,
\,\,
\
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 1home-a\";transit-ioi=\"ICa.1\";term-ioi=\"Type 1visited-a\"
Other SIP header fields and SDP according to 3GPP TS 24.229 [4].
**Require:** The UE-A inserts the Require header field containing the option-
tag \"100rel\" indicating reliable sending of the 183 (Session Progress)
response and the option-tag \"precondition\" indicating the usage of the
precondition mechanism.
**P-Charging-Vector:** The settings of the IOI values are important:
**\- in** step **11 the \"term-ioi\" header field parameter includes a type 1
IOI value which identifies the visited network of the terminating user** (i.e.
**\"visited‑a\").** The \"orig-ioi\" header field parameter is set to the same
type 1 IOI value that was included in the initial INVITE request by the home
network hA (i.e. **\"home‑a\")** towards the terminating user;
\- in step 12 no change of ioi values;
> \- in step 13-14 **the \"transit-ioi\" header field parameter includes one
> or more values identifying the transit networks passed between the visited
> network A and home network A** ; In our example only one value identifying
> the interconnect network A is included. If no \"transit-ioi\" header field
> parameter is included in step 13, the IBCF-hA1 can include a \"transit-ioi\"
> header field parameter value identifying the preceding inteconnect network.
>
> \- in step 15-16 the \"term-ioi\" header field parameter includes a type 3
> IOI value (prefix \"Type 3\") which identifies the AS-hA1 network. The
> \"orig-ioi\" header field parameter is set to the same type 3 IOI value that
> was included in the initial INVITE request from the S‑CSCF‑hA1 to the AS-
> hA1, the \"transit-ioi\" is deleted by the S-CSCF based on the operator
> policy; and
\- in steps 17-18 the \"term-ioi\" header field parameter includes a type 2
IOI value which identifies the home network hA. The \"transit-ioi\" header
field parameter is not appearing. The S-CSCF removes received \"transit**‑**
ioi\" values, the IOI Type 1 or Type 3 in \"orig-ioi\" and \"term-ioi\" header
field parameters. The \"orig**‑** ioi\" header field parameter is set to the
same type 2 IOI value that was included in the initial INVITE request from the
remote home network or, in case of loopback, from the remote visited network.
The \"term-ioi\" header field parameter is set to a Type 2 IOI value
identifying the home network A.
NOTE 2: If the interconnection network is SIP-unaware, step 13 is skipped.
**19\. PRACK requests (IBCF-hA2 to UE‑A via all intermediate nodes) and SIP
200 (OK) response to the SIP PRACK request (UE‑A to IBCF-hA2 via all
intermediate nodes).**
The PRACK request and the 200 (OK) response to the PRACK request are sent
without any SDP offer/SDP answer between the **IBCF-** hA2 **and the UE‑** A
according to 3GPP TS 24.229 [4]. The messages are sent via all intermediate
nodes with the exception of I**-** CSCF**-** hA1.
**20\. UPDATE requests (IBCF-hA2 to UE-A via all intermediate nodes) and SIP
200 (OK) response to the SIP UPDATE request (UE-A to IBCF-hA2 via all
intermediate nodes).**
When resources are reserved in the access network of the remote UE, the
IBCF‑hA2 receives an UPDATE request from the remote network. The IBCF-hA2
forwards the request towards the UE-A. The messages are sent via all
intermediate nodes with the exception of I-CSCF-hA1.
**22-30. 180 (Ringing) response to the SIP INVITE request (UE‑A to IBCF-hA2
via all intermediate nodes).**
NOTE 3: If the interconnection network is SIP-unaware, step 24 is skipped. The
messages are sent via all intermediate nodes including the I-CSCF-hA1.
**31\. PRACK requests (IBCF‑hA2 to UE‑A via all intermediate nodes) and SIP
200 (OK) response to the SIP PRACK request (UE-A to IBCF-hA2 via all
intermediate nodes).**
The PRACK request and the 200 (OK) response to the PRACK request are sent
without any SDP offer/SDP answer between the UE-A and the IBCF-hA2 according
to 3GPP TS 24.229 [4]. The messages are sent via all intermediate nodes with
the exception of I-CSCF-hA1.
**32-39. 200 (OK) response to the SIP INVITE request (IBCF-hA2 to UE-A).**
NOTE 4: If the interconnection network is SIP-unaware, step 34 is skipped.
**40-48. ACK requests (IBCF-hA2 to UE-A via all intermediate nodes).**
The IBCF-hA2 receives an ACK request which acknowledges the 200 (OK) final
response, from the remote network. The IBCF-hA2 forwards the ACK request to
the UE-A according to 3GPP TS 24.229 [4].
NOTE 5: If the interconnection network is SIP-unaware, step 46 is skipped.
## 5.10 Insertion of service related media in the originating home network
### 5.10.1 General
This clause describes insertion of a service related media in the originating
home network (i.e. invocation of MRFC/MRF).
3GPP TS 24.628 [22] describes how to include announcements into the path for
IMS. There are a couple of options which have to be considered for roaming.
The following sections are showing some examples where service related media
can be included. The examples will not cover all possible scenarios defined
within 3GPP.
### 5.10.2 Insertion of service related media in the originating home network
with loopback
Figure 5.10.2-1: Announcement started during the establishment of a
communication
The calling party initiates a communication by means of an INVITE request. The
INVITE request is forwarded toward the called party.
Along the signalling path, created by the INVITE request, some service logic
in an application server (AS) wants to send an announcement towards the
calling party.
The flow is based on the assumptions that the Supported header field includes
the option‑tag \"100rel\", option‑tag \"precondition\" and option‑tag \"199\"
indicating support of the reliable provisional responses, the precondition
mechanism and the 199 (Early Dialog Terminated) provisional responses,
respectively.
NOTE 1: If precondition mechanism is used, the procedures according to 3GPP TS
24.229 [4] apply.
The steps of the signalling flow are as follows:
**1-5. INVITE request (UE‑A to S-CSCF-hA1 via P-CSCF-vA1, IBCF-vA1, IC-A1 and
IBCF-hA1).**
> The INVITE request is sent as described within clause 5.4.2.
NOTE 2: Upon generating an initial INVITE request using the precondition
mechanism, the UE‑A will indicate the support for the precondition mechanism
and specify it using the Supported header field mechanism. If the desired QoS
resources have not been reserved at the UE‑A when constructing the SDP offer,
the UE‑A will indicate the related local preconditions for QoS as not met.
NOTE 3: If the interconnection network is SIP-unaware, step 4 is skipped.
**6\. Evaluation of initial filter criteria.**
The S-CSCF-hA1 validates the service profile of this subscriber and evaluates
the initial filter criteria. For this example, assume an application
server/MRFC involvement.
**7\. INVITE request (S-CSCF-hA1 to AS‑hA1 /MRFC) - see example in table
5.3.2-6.**
The S-CSCF-hA1 applies the same procedure as in step 6 in clause 5.3.2.
**8\. Service logic in AS‑hA1 /MRFC.**
Service logic in the AS‑hA1 decides to send an announcement to the calling
party. In such a case the AS**‑** hA1 acts as a B2BUA. Thus an early dialog
for the announcement and two dialogs will be created in the final call state
one from UE-A to the AS‑hA1 and one from the AS‑hA1 to the terminating UE
which allows end-to-end communication.
**9\. MRFC-MRFP interaction.**
The MRFC interacts with the MRFP in order to reserve resources for the
announcement. As part of the interaction with MRFP the AS‑hA1 receives the
necessary media parameters e.g. IP address and port numbers and provide the IP
address and port number for the calling party to the MRFP.
**10-15. 183 (Session Progress) response (AS‑hA1 to UE‑A via S-CSCF-hA1, IBCF-
hA1, IC-A1, IBCF-vA1 and P-CSCF-vA1).**
The AS‑hA1 sends a 183 (Session progress) response to S-CSCF‑hA1. The response
includes:
> a) an answer to the SDP received in the INVITE request;
NOTE 4: The AS‑hA1 will include in the 183 (Session progress) response the
Require header field with the option**‑** tag \"100rel\" to indicate reliable
sending of the 183 (Session Progress) response. If precondition mechanism is
used, the AS‑hA1 will include in the SDP answer an indication that the related
local preconditions for QoS are fulfilled and will include in the Require
header field the option-tag \"precondition\" to indicate the usage of the
precondition mechanism.
> b) a P-Early-Media header field set to \"sendonly\" in case where only
> announcement will be played. For invoking an interactive voice response
> system a P-Early-Media header field is set to \"sendrecv\"; and
>
> c) the Require header field set to \"100rel\".
NOTE 5: If the interconnection network is SIP-unaware, step 13 is skipped.
**16\. PRACK request /200 (OK) response to the PRACK request (UE‑A to AS‑hA1 /
AS‑hA1 to UE‑A).**
NOTE 6: If precondition mechanism is used and the UE‑A indicated in the
initial SDP offer the related local preconditions for QoS as not met the UE‑A
will include in the SDP offer sent within the PRACK request an indication that
the local preconditions for QoS are fulfilled. Otherwise, if local
preconditions for QoS are not fulfilled when sending the PRACK request, the
UE‑A will use the UPDATE request to send the SDP offer indicating that the
local preconditions for QoS are fulfilled, but that case is outside the scope
of the present example.
**17\. MRFC-MRFP interaction to start the announcement.**
The MRFC interacts with the MRFP in order to start the announcement.
**18\. Announcement sending (MRFP‑hA to UE‑A).**
The MRFP sends the announcement towards the calling party.
**19\. MRFC-MRFP interaction to stop the announcement.**
The complete announcement is sent and the MRFP interacts with the AS‑hA1/MRFC
in order to inform that the announcement is terminated.
**20\. MRFC-MRFP interaction to release the resources used for the
announcement.**
The MRFC interacts with the MRFP in order to release the resources used for
the announcement.
**21-26. 199 (Early Dialog Terminated) response (AS-hA1 to UE-A via S-CSCF-
hA1, IBCF-hA1, IC-A1, IBCF-vA1 and P-CSCF-vA1) (optional).**
If the originating UE‑A has indicated support of the 199 (Early Dialog
Terminated) response code, the AS**‑** hA1 sends a 199 (Early Dialog
Terminated) provisional response towards the originating UE‑A to terminate the
early dialog between itself and the UE‑A.
NOTE 7: If the interconnection network is SIP-unaware, step 24 is skipped.
**27\. INVITE request (AS-hA1 to S-CSCF‑hA1).**
The AS‑hA**1** sends the INVITE request towards the S-CSCF‑hA**1**. The INVITE
request contains the same information as the INVITE request shown in table
5.4.2.-7, see step 7 in clause 5.4.2.
**28-33. INVITE request (S-CSCF‑hA1 to IC-T1 via IBCF-hA1, IC-A1, IBCF-vA1,
TRF-vA1 and IBCF-vA1).**
The S-CSCF‑hA1 decides to loopback the INVITE request and forwards the call to
the terminating home network via the originating visited network vA.
The SDP contained within the INVITE will be manipulated along the signalling
path as shown in the example in 3GPP TS 29.079 [5] clause A.6.
NOTE 8: If the interconnection network is SIP-unaware, step 30 is skipped and
step 33 is executed between IBCF**‑** vA1 and IBCF-hB instead.
**34\. 180 (Ringing) response /200 (OK) response to the INVITE request / ACK
request (IC-T1 to UE‑A via IBCF-vA1, TRF-vA1, IBCF-vA1, IC-A1, IBCF-hA1,
S-CSCF-hA1, AS-hA1, S-CSCF-hA1, IBCF-hA1, IC‑A1, IBCF-vA1 and P-CSCF-vA1).**
When the UE‑A of the calling party receives the 200 (OK) response to the
INVITE request and optional steps 21- 26 were not performed, the UE‑A can
regard the early dialog created for the announcement between the UE‑A and the
AS‑hA1 as terminated. The UE‑A sends the ACK request to acknowledge the
reception of the 200 (OK) final response to the INVITE request.
NOTE 9: The loopback-indicaton header field parameter is included in the
P-Charging-Vector header field.
### 5.10.3 Insertion of service related media in the originating home network
without loopback
Figure 5.10.3-1: Announcement started during the establishment of a
communication
The calling party initiates a communication by means of an INVITE request. The
INVITE request is forwarded toward the called party.
Along the signalling path, created by the INVITE request, some service logic
in an application server (AS) wants to send an announcement towards the
calling party.
The flow is based on the assumptions that the Supported header field includes
the option‑tag \"100rel\", option‑tag \"precondition\" and option‑tag \"199\"
indicating support of the reliable provisional responses, the precondition
mechanism and the 199 (Early Dialog Terminated) provisional responses,
respectively.
NOTE 1: If precondition mechanism is used, the procedures according to 3GPP TS
24.229 [4] apply.
The steps of the signalling flow are as follows:
**1-5. INVITE request (UE‑A to S-CSCF-hA1 via P-CSCF-vA1, IBCF-vA1, IC-A1 and
IBCF-hA1).**
The INVITE request is sent as described within clause 5.3.2.
NOTE 2: Upon generating an initial INVITE request using the precondition
mechanism, the UE‑A will indicate the support for the precondition mechanism
and specify it using the Supported header field mechanism. If the desired QoS
resources have not been reserved at the UE‑A when constructing the SDP offer,
the UE‑A will indicate the related local preconditions for QoS as not met.
NOTE 3: If the interconnection network is SIP-unaware, step 4 is skipped.
**6\. Evaluation of initial filter criteria.**
The S-CSCF-hA1 validates the service profile of this subscriber and evaluates
the initial filter criteria. For this example, assume an application
server/MRFC involvement.
**7\. INVITE request (S-CSCF-hA1 to AS‑hA1 /MRFC) - see example in table
5.3.2-6.**
The S-CSCF-hA1 applies the same procedure as in step 6 in clause 5.3.2.
**8\. Service logic in AS‑hA1 /MRFC.**
Service logic in the AS‑hA1 decides to send an announcement to the calling
party. In such a case the AS**‑** hA1 acts as a B2BUA. Thus an early dialog
for the announcement and two dialogs will be created in the final call state
one from UE-A to the AS‑hA1 and one from the AS‑hA1 to the terminating UE
which allows end-to-end communication.
**9\. MRFC-MRFP interaction.**
The MRFC interacts with the MRFP in order to reserve resources for the
announcement. As part of the interaction with MRFP the AS‑hA1 receives the
necessary media parameters e.g. IP address and port numbers and provide the IP
address and port number for the calling party to the MRFP.
**10-15. 183 (Session Progress) response (AS-hA1 to UE-A via S-CSCF-hA1, IBCF-
hA1, IC-A1, IBCF‑vA1 and P-CSCF-vA1)).**
The AS‑hA1 sends a 183 (Session progress) response to the S-CSCF‑hA1. The
response includes:
a) an answer to the SDP received in the INVITE request;
NOTE 4: The AS‑hA1 will include in the 183 (Session progress) response the
Require header field with the option‑tag \"100rel\" to indicate reliable
sending of the 183 (Session Progress) response. If precondition mechanism is
used, the AS‑hA1 will include in the SDP answer an indication that the related
local preconditions for QoS are fulfilled and will include in the Require
header field the option‑tag \"precondition\" to indicate the usage of the
precondition mechanism.
b) a P-Early-Media header field set to \"sendonly\" in case where only
announcement will be played. For invoking an interactive voice response system
a P-Early-Media header field is set to \"sendrecv\"; and
c) the Require header field set to \"100rel\".
NOTE 5: If the interconnection network is SIP-unaware, step 13 is skipped.
**16\. PRACK request / 200 (OK) response to the PRACK request (UE‑A to AS‑hA1
/ AS-hA1 to UE-A).**
NOTE 6: If precondition mechanism is used and the UE‑A indicated in the
initial SDP offer the related local preconditions for QoS as not met the UE‑A
will include in the SDP offer sent within the PRACK request an indication that
the local preconditions for QoS are fulfilled. Otherwise, if local
preconditions for QoS are not fulfilled when sending the PRACK request, the
UE‑A will use the UPDATE request to send the SDP offer indicating that the
local preconditions for QoS are fulfilled, but that case is outside the scope
of the present example.
**17\. MRFC-MRFP interaction to start the announcement.**
The MRFC interacts with the MRFP in order to start the announcement.
**18\. Announcement sending (MRFP‑hA to UE‑A).**
The MRFP sends the announcement towards the calling party.
**19\. MRFC-MRFP interaction to stop the announcement.**
The complete announcement is sent and the MRFP interacts with the AS‑hA1/MRFC
in order to inform that the announcement is terminated.
**20\. MRFC-MRFP interaction to release the resources used for the
announcement.**
The MRFC interacts with the MRFP in order to release the resources used for
the announcement.
**21-26. 199 (Early Dialog Terminated) response (AS-hA1 to UE-A via S-CSCF-
hA1, IBCF-hA1, IC-A1, IBCF‑vA1 and P-CSCF-vA1) (optional).**
If the originating UE‑A has indicated support of the 199 (Early Dialog
Terminated) response code, the AS**‑** hA1 sends a 199 (Early Dialog
Terminated) provisional response towards the originating UE‑A to terminate the
early dialog between itself and the UE‑A.
NOTE 7: If the interconnection network is SIP-unaware, step 24 is skipped.
**27\. INVITE request (AS-hA1 to S-CSCF-hA1).**
The AS‑hA1 sends the INVITE request towards the S-CSCF‑hA1. The INVITE request
contains the same information as the INVITE request shown in table 5.3.2.-7,
see step 7 in clause 5.3.2.
**28\. INVITE request (S-CSCF-hA1 to IC-T1).**
The S-CSCF‑hA1 decides not to loopback the INVITE request and forwards the
call to the remote network.
**29\. 180 (Ringing) response / 200 (OK) response to the INVITE request / ACK
request (IC-T1 to UE-A via S‑CSCF-hA1, AS-hA1, S-CSCF-hA1, IBCF-hA1, IC-A1,
IBCF-vA1 and P-CSCF-vA1).**
When the UE‑A of the calling party receives the 200 (OK) response to the
INVITE request and optional steps 21- 26 were not performed, the UE can regard
the early dialog created for the announcement between the UE‑A and the AS‑hA1
as terminated. The UE‑A sends the ACK request to acknowledge the reception of
the 200 (OK) final response to the INVITE request.
## 5.11 PS to CS SRVCC access transfer scenarios
### 5.11.1 General
This clause describes PS to CS SRVCC access transfer scenarios including the
registration and the additional message flow due to PS to CS SRVCC.
For IMS roaming PS to CS SRVCC procedure with media anchoring in the ATGW of
the visited network and signalling anchored in the SCC AS of the home network
is used.
In case of PS to CS SRVCC the media path between the visited network and the
home network needs to be re-established since the SIP dialogue between the
ATCF in the visited network and the SCC AS in the home network is re-
established.
From viewpoint of the remote side the signalling anchors do not change due to
the PS to CS SRVCC. However, the media anchors changes due to the PS to CS
SRVCC in case of \"originating roaming to home network without loopback\" (see
clause 5.3) since the CS target access leg is created using a new IBCF.
From the viewpoint of the IC network between the visited network and the home
network this results in release of one connection and establishment of other
connection, whereby the IC network is not aware about any link between these
two connections. However, if the same IC network is used charging correlation
can be done by means of the \"related-icid\" header field parameter in the
P-Charging-Vector header field.
The 3GPP TS 24.237 [20] defines two types of MSC servers. One MSC server
enhanced for ICS and another MSC server enhanced for SIP supporting PS to CS
SRVCC. The message flows are the same if PS to CS SRVCC occurs so in the
following subclauses both variants of MSC servers are referred to as \"MSC
server\". The only difference between the two types is that when the MSC
server is enhanced for ICS, the MSC server will register the user following
the procedures in clause 5.2 when the PS to CS SRVCC access transfer procedure
is completed.
NOTE: Once the user is registered by the MSC server, calls initiated by the UE
will look the same as described in clause 5.3 and clause 5.4.
### 5.11.2 PS to CS SRVCC information transfer during registration
This clause describes the PS to CS SRVCC access transfer specifics during
registration.
Preconditions to this flow are:
\- the conditions in clause 5.2.2 are fulfilled; and
\- both the visited network support PS to CS access transfer and MSC servers
in the network are enhanced to use SIP signalling towards the IMS.
Figure 5.11.2-1 shows the message flow when a UE registers in IMS over PS
before SRVCC occurs as described in clause 5.11.3.
Figure 5.11.2-1: SRVCC information transfer during registration
The steps of the flow are as follows:
**1\. The UE-A registers in IMS and receives a 401 (Unauthorized) response.**
The flow is the same as in clause 5.2.2 with the exception that the ATCF is
included in the registration path.
**2\. REGISTER request (UE-A to P-CSCF-vA1) - see example in table 5.11.2-2.**
The UE-A sends a REGISTER request again (now with an authentication challenge
response included) as described clause 5.2.2.
Table 5.11.2-2: REGISTER request (UE-A to P-CSCF-vA1)
REGISTER sip:home-A.net SIP/2.0
From: \;tag=4fa3
To: \
P-Access-Network-Info: 3GPP-E-UTRAN-TDD;utran-cell-id-3gpp=234151D0FCE11
Supported: path
Contact: \;reg-
id=1;+sip.instance=\"\\";expires=600000;+g.3gpp.ics=\"principal\";+g.3gpp.accesstype=\"cellular1\"
CSeq: 10 REGISTER
Via:SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Other SIP header fields are set according to 3GPP TS 24.229 [4] and 3GPP TS
24.237 [20].
**Request-URI:** The Request-URI sip:home-A.net (the URI that follows the
method name, \"REGISTER\", in the first line) indicates the destination domain
of this REGISTER request which is the home network.
**From: Set to the SIP URI that is the default public user identity of the
user A i.e. userA_public1\@home-A.net.**
**To: Set to the SIP URI that is the default public user identity of the user
A i.e. userA_public1\@home-A.net.**
**Supported: The UE-A inserts the Supported header field containing the
option-tag \"path\".**
**3\. REGISTER request (P-CSCF-vA1 to ATCF-vA1) - see example in table
5.11.2-3.**
When the P-CSCF-vA1 receives the REGISTER request, the P-CSCF-vA1 forwards the
REGISTER request to an ATCF‑vA1 according to local policy. The content of the
REGISTER request is not different from the content of the REGISTER request in
clause 5.2.2.
Table 5.11.2-3: REGISTER request (P-CSCF-vA1 to ATCF-vA1)
REGISTER sip:home-A.net SIP/2.0
From:
To:
P-Access-Network-Info: 3GPP-E-UTRAN-TDD;utran-cell-id-3gpp=234151D0FCE11,3GPP-
E-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11;network-provided;local-time-
zone=\"UTC+01:00\";daylight-saving-time=\"01\"
Supported:
Contact:
CSeq:
Require: path
Route: \
Path: \
P-Visited-Network-ID: \"Visited Network Number A\"
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 1visited-a\"
Via:SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via:SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Other SIP header fields are set according to 3GPP TS 24.229 [4].
**P-Access-Network-Info:** The P-CSCF‑vA1 adds the network provided location
including the \"local-time-zone\" and \"daylight saving time\" header field
parameters. The location information received from the UE‑A is kept since it
does not indicate that it is network provided.
**Require:** The P-CSCF-vA1adds the Require header field **containing the
option-tag \"path\"** to ensure that the recipient correctly handles the Path
header field. If the recipient does not support the Path header field, a SIP
response will be received with a status code of 420 and an Unsupported header
field indicating **the option-tag** \"path\". Such a response indicates a
wrong configuration of the routing tables and the request has been routed
outside the IM CN subsystem.
**Route:** The P-CSCF-vA1 adds the Route header field with the address of the
**ATCF-vA1.**
**Path:** This is the address of the P-CSCF‑vA1 and is included to inform the
S-CSCF where to route terminating requests. The Path header field includes
traffic leg information in the iotl SIP URI parameter according to IETF RFC
7549 [26].
**P-Visited-Network-ID:** The P-CSCF‑vA1 adds the P‑Visited‑Network‑ID header
field containing the identifier of the P-CSCF network. This may be the visited
network domain name or any other identifier that identifies the visited
network at the home network.
**Via:** The P-CSCF-vA1 adds a Via header field in the REGISTER request.
**P-Charging-Vector:** The P-CSCF-vA1 provides an ICID value and adds a type 1
\"orig-ioi\" header field parameter with **the IOI value identifying the
visited network (i.e. \"visited‑a\").**
**4\. REGISTER request (ATCF-vA1 to IBCF-vA1) - see example in table
5.11.2-4.**
When the ATCF-vA1 receives the REGISTER request, the ATCF-vA1 updates its
database for registrations and selects an IBCF according to local policy for
routeing the REGISTER request towards the home network.
Table 5.11.2-4: REGISTER request (ATCF-vA1 to IBCF-vA1)
REGISTER sip:home-A.net SIP/2.0
From:
To:
P-Access-Network-Info:
Supported:
Contact:
CSeq:
Require:
Route: \
Path: \,\
P-Visited-Network-ID:
P-Charging-Vector:
Feature-Caps:*;+g.3gpp.atcf=\"\\";+g.3gpp.atcf-mgmt-
uri=\"\\";+g.3gpp.atcf-
path=\"\\";+g.3gpp.mid-
call;+g.3gpp.srvcc-alerting;+g.3gpp.ps2cs-srvcc-orig-pre-alerting
Via:SIP/2.0/UDP atcf-vA1.visited-A.net:5060;branch=z9hG4bKaa3689b
Via:SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via:SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Other SIP header fields are set according to 3GPP TS 24.229 [4] and 3GPP TS
24.237 [20].
**Route:** The **ATCF-vA1** adds the Route header field identifying the
selected IBCF-vA1**.**
**Path: The ATCF-vA1 adds its address for terminating requests in the Path
header field.**
**Feature-Caps: The ATCF-vA1 adds a number of feature-capability indicators in
the Feature-Caps header field.**
\- The g.3gpp.atcf capability-indicator includes the STN-SR that will be used
during PS to CS access transfer by the MSC server.
\- The g.3gpp.atcf-mgmt-uri feature-capability indicator includes the URI that
will be used by the SCC AS when sending the MESSAGE request with the PS to CS
SRVCC information to the ATCF-vA1 The URI includes an \"iotl\" SIP URI
parameter according to IETF RFC 7549 [26].
\- The g.3gpp.atcf-path feature-capability indicator is used by ATCF to
identify the registration in its database for registrations and will be
included by SCC AS in the MESSAGE request with the PS to CS SRVCC information
sent to the ATCF-vA1.
\- The g.3gpp.mid-call, g.3gpp.srvcc-alerting and g.3gpp.ps2cs-srvcc-orig-pre-
alerting feature-capability indicators are included to indicate which PS to CS
SRVCC features the visited network supports.
**Via: The ATCF-vA1 adds a Via header field in the REGISTER request.**
**5‑8. REGISTER request (IBCF-vA1 to S-CSCF-hA1 via IC-A1, IBCF-hA1 and
I-CSCF-hA1) - see example in table 5.11.2-8.**
When the IBCF-vA1 receives the REGISTER request, the IBCF-vA1 forwards the
REGISTER request in the same way as in clause 5.2.2. There is no more SRVCC
specific information added in the REGISTER request.
The table 5.11.2-8 shows the content of the REGISTER request when received in
the S-CSCF-hA1.
Table 5.11.2-8: REGISTER request (I-CSCF-hA1 to S-CSCF-hA1) in step 8
REGISTER sip:home-A.net SIP/2.0
From:
To:
P-Access-Network-Info:
Supported:
Contact:
CSeq:
Require:
Route: \
Path: \,\,\,\,\
P-Visited-Network-ID:
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 1visited-a\";transit-ioi=\"ICa.1\"
Feature-Caps:
Via:SIP/2.0/UDP icscf-hA1.home-A.net;branch=z9hG4bK351g45.3
Via:SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.2
Via:SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK78a3z
Via:SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1
Via:SIP/2.0/UDP atcf-vA1.visited-A.net:5060;branch=z9hG4bKaa3689b
Via:SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via:SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
Other SIP header fields are set according to 3GPP TS 24.229 [4].
**Path:** The address of the IBCF‑vA1 acting as an exit point added **by the
IBCF-vA1.\** Based on SLA between IC partners and roaming partners the address
of the IC-A1 added by IC-A1.\ The address of the **IBCF-hA1** acting as an
entry point added **by the IBCF-hA1.**
**Route: The I‑CSCF‑hA1 adds the address of the selected S‑CSCF.**
**Via: The IBCF-vA1 added a Via header field.\ The IC-A1 added a Via header
field.\ The IBCF-hA1 added a Via header field.\ The I-CSCF-vA1 added a Via
header field.**
**P-Charging-Vector: The \"transit-ioi\" header field parameter with an IOI
value identifying the transit network** (i.e. **\"ICa\")** added by IC-A1**.**
NOTE 1: If the interconnection network is SIP-unaware, step 6 is skipped.
**9-16. 200 (OK) response (S-CSCF-hA1 to UE-A).**
The S-CSCF‑hA1 acknowledges the REGISTER request by means of a 200 (OK)
response as described in clause 5.2.2. The 200 (OK) response does not contain
any SRVCC specific information more than that the ATCF-vA1 is included in the
Path header field and in the Via header field.
NOTE 2: If the interconnection network is SIP-unaware, step 13 is skipped.
**17\. REGISTER request (S-CSCF-hA1 to SCC AS-hA1) - see example in table
5.11.2-17.**
The S-CSCF-hA1 checks the iFC triggers and detects that the SCC AS-hA1 is
interested in registrations from this user. The S-CSCF-hA1 sends a 3^rd^ party
REGISTER request to the SCC AS-hA1. The S‑CSCF‑hA1 includes in the 3^rd^ party
REGISTER request the contents of the initial REGISTER request and the 200 (OK)
response to the initial REGISTER request in \"sip\" message bodies.
Table 5.11.2-17: REGISTER request (S-CSCF-hA1 to SCC AS-hA1)
REGISTER sip:sccas.home-A.net /2.0
To: \
From: \; tag=538ya
Contact: \; expires=600000
CSeq: 10 REGISTER
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 3home-a\"
Via: SIP/2.0/TCP scscf-hA1.home-A.net;branch=z9hG499ffhy
Content-Type: multipart/mixed;boundary=\"boundary1\"
Content-Length: (...)
\--boundary1
Content-Type: message/sip
REGISTER sip:home-A.net SIP/2.0
From: \;tag=4fa3
To: \
P-Access-Network-Info: 3GPP-E-UTRAN-TDD;utran-cell-id-3gpp=234151D0FCE11,3GPP-
E-UTRAN-TDD; utran-cell-id-3gpp=234151D0FCE11;network-provided;local-time-
zone=\"UTC+01:00\";daylight-saving-time=\"01\"
Supported: path
Contact: \;reg-
id=1;+sip.instance=\"\\";expires=600000;+g.3gpp.ics=\"principal\";+g.3gpp.accesstype=\"cellular1\"
CSeq: 12 REGISTER
Require: path
Path: \,
\,
\,
\,
\
P-Visited-Network-ID: \"Visited Network Number A\"
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 1visited-a\";transit-ioi=\"ICa.1\"
Feature-Caps:*;+g.3gpp.atcf=\"\\";+g.3gpp.atcf-mgmt-
uri=\"\\";+g.3gpp.atcf-
path=\"\\";+g.3gpp.mid-
call;+g.3gpp.srvcc-alerting;+g.3gpp.ps2cs-srvcc-orig-pre-alerting
Via:SIP/2.0/UDP icscf-hA1.home-A.net;branch=z9hG4bK351g45.3
Via:SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.2
Via:SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK78a3z
Via:SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1
Via:SIP/2.0/UDP atcf-vA1.visited-A.net:5060;branch=z9hG4bKaa3689b
Via:SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via:SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
\--boundary1
Content-Type: message/sip
SIP/2.0 200 OK
From: \;tag=4fa3
To: \;tag=5ef4
CSeq: 10 REGISTER
P-Associated-URI: \, \
Contact: \;reg-
id=1;+sip.instance=\"\\";expires=600000;+g.3gpp.ics=\"principal\";+g.3gpp.accesstype=\"cellular1\"
Service-Route: \
P-Charging-Vector: icid-value=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\";orig-
ioi=\"Type 1visited-a\";term-ioi=\"Type 1home-a\"
Relayed-Charge: SCSCF:transit-ioi=\"ICa.1\"
Path: \,
\,
\,
\,\
Via:SIP/2.0/UDP icscf-hA1.home-A.net;branch=z9hG4bK351g45.3
Via:SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bK351g45.2
Via:SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bK78a3z
Via:SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bK351g45.1
Via:SIP/2.0/UDP atcf-vA1.visited-A.net:5060;branch=z9hG4bKaa3689b
Via:SIP/2.0/UDP pcscf-vA1.visited-A.net:5060;branch=z9hG4bKnas56565
Via:SIP/2.0/UDP [5555::aaa:bbb:ccc:ddd];branch=z9hG4bKnashds7
\--boundary1---
Other SIP header fields are set according to 3GPP TS 24.229 [4].
> **P-Charging-Vector:** The S-CSCF-hA1 inserts the \"orig-ioi\" header field
> parameter with a type 3 IOI value identifying the home network hA.
>
> Relayed-Charge: The S-CSCF adds the Relayed-Charge header field set to the
> value received in the \"transit-ioi\" header field in the P-Charging-Vector.
> The S-CSCF is set as the source.
**Via:** The S-CSCF-hA1 adds a Via header field.
**18\. 200 (OK) response (SCC AS-hA1 to S-CSCF-hA1).**
The SCC AS-hA1 acknowledges the REGISTER request by means of a 200 (OK)
response. There is no specific SRVCC access transfer information added by SCC
AS-hA1 in the 200 (OK) response.
**19\. The SCC AS‑hA1 stores the STN-SR in HSS.**
The SCC AS‑hA1 stores the STN-SR () received in the \"+g.3gpp.atcf\" Feature-
Caps header field parameter in HSS. This information will later be transferred
to the MSC server when a PS to CS SRVCC access transfer occurs as described in
clause 5.11.3.
**20\. MESSAGE request (SCC AS-hA1 to IBCF-hA1) - see example in table
5.11.2-20.**
In order to inform about PS to CS SRVCC access transfer parameters necessary
for the ATCF-vA1 during PS to CS SRVCC access transfer, the SCC AS‑hA1 sends a
MESSAGE request to the IBCF-hA1.
Table 5.11.2-20: MESSAGE request (SCC AS-hA1 to IBCF-hA1)
MESSAGE sip:atcf-vA1.visited-A.net;iotl=homeB-visitedB SIP/2.0
From: \;tag=123e5
To: \
Cseq: 100 MESSAGE
P-Asserted-Identity: \
P-Charging-Vector: icid-value=\"BrtA76543y+403fg654tBf456fa=023551024\";orig-
ioi=\"Type 1home-a\"
Content-Length: (...)
Content-Type: application/vnd.3gpp.SRVCC-info+xml
Route: \
Via: SIP/2.0/UDP sccas-hA1.home-A.net:5060;branch=z9hG4bK78956a
\
\
\
\sip:sccas-hA1.home-A.net;iotl=visitedA-homeA\
\tel:+1-237-555-1111\
\
\
Other SIP header fields are set according to 3GPP TS 24.229 [4] and 3GPP TS
24.237 [20].
> **Request-URI/To: Contains the address received in the g.3gpp.atcf-mgmt-uri
> feature-capability indicator. including traffic leg information in an
> \"iotl\" SIP URI parameter according to IETF RFC 7549** [26].
**P-Asserted-Identity/From: Includes the SCC AS-hA1 address.**
> **P-Charging-Vector: The SCC AS-hA1 assigns a new ICID value and includes a
> type 1 IOI value in the \"orig‑ioi\"** header field parameter**. The type
> IOI value identifies the home network hA.**
>
> **Via: The SCC AS-hA1 adds a Via header field.**
**application/vnd.3gpp.SRVCC-info+xml:** Contains the PS to CS SRVCC specific
information that will be used by the ATCF-vA1 when SRVCC occurs as described
in clause 5.11.3.
\- The SRVCC-info ATCF-Path-URI identifies the registration in the ATCF-vA1.
\- The ATU-STI is the address of the SCC AS where the INVITE request will be
sent to in the event of a PS to CS SRVCC access transfer. The ATU-STI includes
**traffic leg information in an \"iotl\" SIP URI parameter according to IETF
RFC 7549** [26].
\- C-MSISDN is the public user identity of the user that the ATCF-vA1 is using
to identify the user in the event of a PS to CS SRVCC access transfer.
**21\. MESSAGE request (IBCF-hA1 to IC-A1) - see example in table 5.11.2-21.**
The IBCF-hA1selects to route the MESSAGE request via an IC network and sends
the MESSAGE request according to 3GPP TS 24.229 [4] to the IC-A1. The IBCF-hA1
determines the next hop IP address from the request URI either by configured
information or using a DNS query according to IETF RFC 3263 [13]. If the
subsequent interconnection network is SIP-aware, the determined IP address
will belong to the SIP proxy IC**‑** A1. Otherwise the determined IP address
will point to IBCF-vA1 and step 22 is skipped (not reflected in message
details below).
Table 5.11.2-21: MESSAGE request (IBCF-hA1 to IC-A1)
MESSAGE sip:atcf-vA1.visited-A.net;iotl=homeB-visitedB SIP/2.0
From:
P-Asserted-Identity:
To:
CSeq:
P-Charging-Vector:
Content-Length:
Content-Type:
Route: \
Via:SIP/2.0/UDP ibcf-hA1.home-A.net:5060;branch=z9hG4bK123456
Via:SIP/2.0/UDP sccas-hA1.home-A.net:5060;branch=z9hG4bK78956a
\
\
\
\sip:sccas-hA1.home-A.net\
\tel:+1-237-555-1111\
\
\
Other SIP header fields are set according to 3GPP TS 24.229 [4].
> **Route: The IBCF-hA1 adds a Route header field identifying the selected
> node in the IC network A.**
>
> **Via:** The IBCF-hA1 adds a Via header field.
**22\. MESSAGE request (IC-A1 to IBCF-vA1) - see example in table 5.11.2-22.**
The IC-A1 selects an IBCF acting as the entry point in the visited network vA
and sends the MESSAGE request according to 3GPP TS 24.229 [4] to the IBCF-vA1.
NOTE 3: If the interconnection network is SIP-unaware, step 22 is skipped.
Table 5.11.2-22: MESSAGE request (IC-A1 to IBCF-vA1)
MESSAGE sip:atcf-vA1.visited-A.net;iotl=homeB-visitedB SIP/2.0
From:
P-Asserted-Identity:
To:
CSeq:
P-Charging-Vector: icid-value=\"BrtA76543y+403fg654tBf456fa=023551024\";orig-
ioi=\"Type 1home-a\";transit-ioi=\"ICa.1\"
Content-Length: ...
Content-Type:
Route: \
Via:SIP/2.0/UDP ic-A1.interconnection-A.net:5060;branch=z9hG4bKasdfg
Via:SIP/2.0/UDP ibcf-hA1.home-A.net:5060;branch=z9hG4bK123456
Via:SIP/2.0/UDP sccas-hA1.home-A.net:5060;branch=z9hG4bK78956a
\
\
\
\sip:sccas-hA1.home-A.net;iotl=visitedA-homeA\
\tel:+1-237-555-1111\
\
\
Other SIP header fields are set according to 3GPP TS 24.229 [4].
> **P-Charging-Vector:** The **IC-A1** adds the \"transit-ioi\" header field
> parameter **with an IOI value identifying the transit network** (i.e.
> **\"ICa\")**.
>
> **Route The IC-A1 adds a Route header field identifying the selected entry
> point in the visited network vA.**
>
> **Via:** The IC-A1 adds a Via header field.
**23\. MESSAGE request (IBCF-vA1 to ATCF-vA1) - see example in table
5.11.2-23.**
When the IBCF-vA1 receives the MESSAGE request, the IBCF-vA1 retrieves the
address of the ATCF-vA1 (e.g. by performing a DNS query or using a local
database) and forwards the MESSAGE request to the ATCF-vA1.
In this example, the IBCF-vA1 does not add any \"transit-ioi\" header field
parameter in the P-Charging-Vector header field. However, the IBCF-vA1 adds
the \"transit-ioi\" header field parameter based on local policy, when the
\"transit-ioi\" identifying the preceding interconnection network is not
included in the received request (e.g. when the preceding interconnection
network is not an IMS transit network).
Table 5.11.2-23: MESSAGE request (IBCF-vA1 to ATCF-vA1)
MESSAGE sip:atcf-vA1.visited-A.net;iotl=homeB-visitedB SIP/2.0
From:
P-Asserted-Identity:
To:
CSeq:
P-Charging-Vector:
Content-Length: ...
Content-Type:
Via:SIP/2.0/UDP ibcf-vA1.visited-A.net:5060;branch=z9hG4bKlkjhg12
Via:SIP/2.0/UDP ic-A1.interconnection-A.net:5060;branch=z9hG4bKasdfg
Via:SIP/2.0/UDP ibcf-hA1.home-A.net:5060;branch=z9hG4bK123456
Via:SIP/2.0/UDP sccas-hA1.home-A.net:5060;branch=z9hG4bK78956a
\
\
\
\sip:sccas-hA1.home-A.net;iotl=visitedA-homeA\
\tel:+1-237-555-1111\
\
\
Other SIP header fields are set according to 3GPP TS 24.229 [4].
> **Via:** The IBCF-vA1 adds a Via header field.
**24-27. 200 (OK) response (ATCF-vA1 to SCC AS-hA1 via IBCF-vA1, IC-A1 and
IBCF-hA1) - see example in table 5.11.2-27.**
The ATCF-vA1 acknowledges the receipt of the MESSAGE request by means of a 200
(OK) response according to 3GPP TS 24.229 [4]. No SRVCC specific parameters
are included in the 200 (OK) response.
The table 5.11.2-27 shows the content of the 200 (OK) response when received
in the SCC AS-hA1.
Table 5.11.2-27: 200 (OK) response (IBCF-hA1 to SCC AS-hA1) in step 27
SIP/2.0 200 OK
P-Charging-Vector: icid-value=\"BrtA76543y+403fg654tBf456fa=023551024\";orig-
ioi=\"Type 1home-a\";term-ioi=\"Type 1visited-a\"; transit-ioi=\"ICa.1\"
From: \;tag=123e5
To: \;tag=678f9
CSeq: 100 MESSAGE
Via: SIP/2.0/UDP sccas-hA1.home-A.net:5060;branch=z9hG4bK78956a
Other SIP header fields are set according to 3GPP TS 24.229 [4] and 3GPP TS
24.237 [20].
> **P-Charging-Vector: The ATCF-vA1 added a P-Charging-Vector** header field
> **with the same \"icid-value\" and the same \"orig‑ioi\"** header field
> parameter **value as received in the MESSAGE request and a type 1 IOI value
> in a \"term‑ioi\"** header field parameter **identifying the visited network
> vA.**
>
> **The IC-A1 added the \"transit-ioi\" header field parameter with an IOI
> value identifying the transit network** (i.e. **\"ICa\").**
NOTE 4: If the interconnection network is SIP-unaware, step 26 is skipped.
### 5.11.3 PS to CS SRVCC access transfer for a call in the active phase
without loopback
This clause describes the PS to CS SRVCC access transfer of a call in the
active phase.
Preconditions to this call flow:
1\. a call is established between a UE-A and a remote UE as described in
clause 5.3. The UE-A is attached to a 4G radio access network (E-UTRAN);
2\. media is anchored in:
a. the P-CSCF-vA1, the ATCF-vA1 and IBCF-vA1 in the visited network vA;
b. the IC-A1 in the IC network A; and
c. the IBCF-hA1 and the IBCF-hA2 in the home network hA; and
3\. SIP signalling is anchored in SCC AS-hA1.
NOTE 1: The signalling flow is the same for PS to CS SRVCC access transfer for
a call in the active phase regardless if the UE-A or the remote UE initiated
the call.
Figure 5.11.3-1 shows the SIP message flow when PS to CS SRVCC access transfer
of a call in the active phase occurs.
NOTE: For clarity, the SIP 100 (Trying) messages are not shown in the
signalling flow.
Figure 5.11.3-1: SRVCC without loop back message flow
The steps of the flow are as follows:
**1\. A call is established as described in clause 5.3 between UE-A and a
remote UE.**
\- The remote UE can be a UE connected to IMS or an UE connected to CS and the
difference compared to the description in clause 5.3 and this PS to CS SRVCC
access transfer scenario is that an ATCF in the visited originated network
participated in the call establishment of the call and that the general AS-hA1
in figure 5.3.2**‑** 1 is replaced by the access transfer specific AS i.e. the
SCC AS-hA1.
\- The media path is UE-A -- P-CSCF-vA1 -- ATCF-vA1 -- IBCF-vA1 -- IC-A1 \--
IBCF-hA1 -- IBCF-hA2 -- remote network -- remote UE.
NOTE 2: If the interconnection network is SIP-unaware, or if IC-A1 is only a
SIP proxy rather than a SIP-ALG with attached SIP-AGW, IC-A1 is not in the
media path.
**2\. SRVCC handover occurs.**
During the ongoing call the UE-A is performing measurements on signalling
strength in neighbouring cells and sends continuously the measurement results
to the core network. Due to decreasing signalling strength in the 4G radio
access network the core network takes a decision that the UE shall be handed
over to a 3G radio access network and sends a PS to CS SRVCC request to the
MSC server-vA1.
**3\. INVITE request due to STN-SR (MSC server-vA1 to ATCF-vA1) - see example
in table 5.11.3-3.**
\- When the MSC server-vA1 receives the PS to CS SRVCC request from the core
network in the visited network, the MSC server-vA1 sends an INVITE request to
the ATCF-vA1. This INVITE request is referred to as an \"INVITE request due to
STN-SR\" in the 3GPP TS 24.237 [20].
Table 5.11.3-3: INVITE request due to STN-SR (MSC server-vA1 to ATCF-vA1)
INVITE tel:+1-237-555-3333 SIP/2.0
From: \;tag=171828
To: \
P-Asserted-Identity: \
P-Access-Network-Info: 3GPP-UTRAN-TDD;utran-cell-
id-3gpp=151234D0EAF22;network-provided;local-time-zone=\"UTC+01:10\";daylight-
saving-time=\"01\"
P-Charging-Vector: icid-value=\"023551024\"; orig-ioi=\"Type
1visited-a\";icid-generated-at=\"msc-vA1.visited-A.net\"
Contact: \;+g.3gpp.icsi-
ref=\"urn%3Aurn-7%3A3gpp-service.ims.icsi.mmtel\";+g.3gpp.srvcc-
alerting;+g.3gpp.mid-call;+ps2cs-srvss-orig-pre-alerting
CSeq: 11 INVITE
Accept: \"application/vnd.3gpp.state-and-event-info+xml\"
Recv-Info: g.3gpp.state-and-event
Supported:norefersub,100rel, precondition
Via:SIP/2.0/UDP msc-vA1.visited-A.net;branch=z9hG4bk7987fe
Other SIP header fields and SDP according to 3GPP TS 24.229 [4] and 3GPP TS
24.237 [20].
**Request-URI /To** : The tel URI (referred to as STN-SR) identifies the ATCF-
vA1. The STN-SR is stored by SCC AS-hA1 in HSS during registration of the user
as described in clause 5.11.2 and sent to the MSC server-vA1 in the PS to CS
SRVCC request from the core network.
**P-Access-Network-Info** : This header field identifies the location of the
UE in the 3G access network, the time‑zone and daylight saving on that
location.
**P-Charging-Vector:** The MSC server-vA1 adds the P-Charging-Vector header
field containing a new ICID value in the \"icid\", \"icid-generated-at\" and
\"orig-ioi\" header field parameters. The IOI value is of type 1 and
identifies the visited network vA.
**P-Asserted-Identity/From:** The P-Asserted identity and the From header
fields is the C-MSISDN and that is not necessary the same identity used in the
original call. For example: In the original call the P‑Asserted‑Identity
header field could be adam\@homenetwork.net.
**Contact:** The Contact header field can, additional to the contact address,
include a number of media feature tags. In this example the g.3gpp.icsi-ref
indicates that this is an MMTel call, the g.3gpp.srvcc-alerting indicates that
the MSC server-vA1 supports PS to CS access transfer for call in alerting
phase, the g.3gpp.mid-call indicates that the MSC server-vA1 supports transfer
of held calls and conference calls and the ps2cs‑srvss‑orig‑pre‑alerting
indicates that the MSC server-vA1 supports PS to CS SRVCC access transfer for
calls in the originating pre-alerting phase. The media-feature tags will be
used by the SCC AS-vA1 to determine which sessions to be transferred.
**Accept:** The MSC server-vA1 adds an Accept header field containing the MIME
type application/vnd.3gpp.state-and-event-info+xml**.**
**Recv-Info:** The MSC server-vA1 adds **a Recv-Info header field containing
the g.3gpp.state-and-event package name.**
**Supported: The MSC server indicates option tags to indicate supported
feature.**
**4\. 200 (OK) response (ATCF-vA1 to MSC server-vA1) -- see example in table
5.11.3-4.**
When the ATCF-vA1 receives the INVITE due to STN-SR the ATCF-vA1 checks if
there is a session that fulfils conditions for being transferred and detects
that there is a call in an active phase ongoing between UE-A and a remote UE.
To avoid speech gaps, the ATCF-vA1 returns a 200 (OK) response towards the MSC
server‑vA1 containing media parameters retrieved from the ATGW.
The ATCF-vA1 also adds the \"related-icid\" header field parameter containing
the \"icid-value\" header fields parameter used in the original call and can
be used for charging correlation of generated CDR records in the visited
network A **(i.e. \"visited‑a\")**.
Table 5.11.3-4: 200 (OK) response (ATCF-vA1 to MSC server-vA1)
SIP/2.0 200 OK
From: \;tag=171828
To: \;tag=271818
Record-Route: \
P-Charging-Vector: icid-value=\"023551024\";icid-generated-at=\"msc-
vA1.visited-A.net\";orig-ioi=\"Type 1visited-a\";term-ioi=\"Type
1home-a\";related-icid=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
Feature-Caps:*;+g.3gpp.srvcc-alerting,*;+g.3gpp.mid-call,*;+ps2cs-srvss-orig-
pre-alerting
Contact: \
CSeq: 11 INVITE
P-Asserted-Identity:
\,\
Via: SIP/2.0/UDP msc-vA1.visited-A.net;branch=z9hG4bk7987fe
Other SIP header fields and SDP according to 3GPP TS 24.229 [4] and 3GPP TS
24.237 [20].
**Record-Route:** The ATCF adds its own address in the header field which will
be used by the MSC server-vA1 for subsequent SIP requests.
**P-Charging-Vector:** The P-Charging-Vector contains the parameters received
in the INVITE due to STN-SR and the related-icid header field parameter
containing the ICID value received in the session to be transferred.
Editor\'s note: Whether the P-Charging-Vector shall contain term-ioi and/or
transit-ioi or not is FFS. At the moment the term-ioi and transit-ioi is not
currently specified in 3GPP TS 24.237 [20].
**Feature-Caps:** The feature-capability indicators as received on the home
leg in the session to be transferred.
**Contact:** The contact address of the remote UE is included.
**P-Asserted-Identity:** The public user identity of the remote UE is
included.
**5\. ACK request (MSC-vA1 to ATCF-vA1).**
The MSC server-vA1 sends the ACK to the ATCF-vA1 according to 3GPP TS 24.229
[4]. The ACK request does not contain any SRVCC specific information.
**6\. INVITE request due to ATU-STI (ATCF-vA1 to IBCF-vA1) - see example in
table 5.11.3-6.**
The ATCF-vA1 creates a new dialog towards SCC AS-hA1 by sending an INVITE due
to ATU-STI. Everything except the Request line and the Via header field is
copied from the received INVITE due to STN‑SR.
Table 5.11.3-6: INVITE request due to ATU-STI (ATCF-vA1 to IBCF-vA1)
INVITE sip:ps2cs\@sccas1.home-A.net;iotl=visitedA-homeA SIP/2.0
From: \;tag=171828
To: \
Route: \
P-Asserted-Identity: \
P-Access-Network-Info: 3GPP-UTRAN-TDD;utran-cell-
id-3gpp=151234D0EAF22;network-provided;
local-time-zone=\"UTC+01:10\";daylight-saving-time=\"01\"
P-Charging-Vector: icid-value=\"023551024\"; orig-ioi=\"Type 1visited-a\";
icid-generated-at=\"msc-vA1.visited-A.net\"
Record-Route: \
Contact: \;+g.3gpp.icsi-
ref=\"urn%3Aurn-7%3A3gpp-service.ims.icsi.mmtel\";+g.3gpp.srvcc-
alerting;+g.3gpp.mid-call;+ps2cs-srvss-orig-pre-alerting
CSeq: 11 INVITE
Accept: \"application/vnd.3gpp.state-and-event-info+xml\"
Recv-Info: g.3gpp.state-and-event
Target-Dialog: me03a0s09a2sdfgjkl491777; remote-tag=774321; local-tag=4fa3
Required: tdialog
Supported:norefersub
Via: SIP/2.0/UDP atcf-vA1.visited-A.net;branch=z9hG4bk731b87
Other SIP header fields and SDP according to 3GPP TS 24.229 [4] and 3GPP TS
24.237 [20].
> **Request-URI:** The SIP URI (referred to as ATU-STI) identifies the SCC AS-
> hA1. The ATU-STI is sent by SCC AS-hA1 to ATCF-vA1 during registration as
> described in clause 5.11.2. The Request-URI includes traffic information in
> an \"iotl\" SIP URI parameter according to IETF RFC 7549 [26].
>
> **Record-Route:** The address that the ATCF-vA1 wants to receive subsequent
> in-dialog requests from the SCC AS-hA1.
>
> **Target-Dialog:** The identity of the dialog selected by ATCF-vA1.
>
> **Required:** **The \"tdialog\" option tag indicates that the support for
> Target-Dialog header field is required**.
>
> **Via:** The ATCF-vA1 adds a Via header field.
**7\. INVITE request due to ATU-STI (IBCF-vA1 to IC-A1) - see example in table
5.11.3-7.**
When the IBCF-vA1 receives the INVITE due to ATU-STI, the IBCF-vA1 updates the
SDP as described within 3GPP TS 29.079 [5].
The IBCF-vA1 selects, based on local policy, to route the INVITE request due
to ATU-STI via interconnect network A and sends the request according to 3GPP
TS 24.229 [4] to the IC-A1. The IBCF-vA1 determines the next hop IP address
from the SIP request URI, either by configured information or using a DNS
query according to IETF RFC 3263 [13]. If the subsequent interconnection
network is SIP-aware, the determined IP address will belong to the SIP proxy
IC-A1. Otherwise the determined IP address will point to IBCF-vA1 and step 22
is skipped (not reflected in message details below).
Table 5.11.3-7: INVITE request due to ATU-STI (IBCF-vA1 to IC-A1)
INVITE sip:ps2cs\@sccas1.home-A.net;iotl=visitedA-homeA SIP/2.0
From:
To:
Route: \
P-Access-Network-Info:
P-Charging-Vector:
Record-Route: \,\
P-Asserted-Identity:
Contact:
CSeq:
Accept:
Recv-Info:
Target-Dialog:
Require:
Supported:
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bk79c54a
Via: SIP/2.0/UDP atcf-vA1.visited-A.net;branch=z9hG4bk7987fe
Other SIP headerfields and SDP according to 3GPP TS 24.229 [4] and 3GPP TS
29.079 [5].
> **Record-Route:** Based on topology hiding functionality the IBCF-vA1 will
> either forward the Record-Route header field with:
\- one visible IBCF-vA1 entry and the ATCF-vA1 entry as one hidden entry; or
\- both the IBCF-vA1 entry and the ATCF-vA1 entry as visible entries.
> **Via:** Based on topology hiding functionality the IBCF-vA1 will either
> forward the Via header fields with:
\- one visible IBCF-vA1 entry and the ATCF-vA1 entry as one hidden entry; or
\- both the IBCF-vA1 entry and the ATCF-vA1 entry as visible entries.
NOTE 3: In the example above both the IBCF-vA1 entry and the ATCF-vA1 entry
are forwarded as visible entries in the Via and Record-Route header fields.
**8\. INVITE request due to ATU-STI (IC-A1 to IBCF-hA1) - see example in table
5.11.3-8.**
NOTE 4: If the interconnection network is SIP-unaware, step 8 is skipped.
When the IC-A1 receives the initial INVITE request due to ATU-STI and since
the IC-A1 according to local policy allows itself to be bypassed by media then
the IC-A1 updates the SDP as described within 3GPP TS 29.079 [5].
The IC-A1 selects an entry point (IBCF-hA1) of the home IMS network hA and
sends the INVITE request according to 3GPP TS 24.229 [4] to the IBCF-hA1.
NOTE 5: The IC-A1 can add a Route header field entry pointing to the entry
point of home network hA. However, since this is not necessary for routeing
the call it is not shown in table 5.11.3-8.
Table 5.11.3-8: INVITE request due to ATU-STI (IC-A1 to IBCF-hA1)
INVITE sip:ps2cs\@sccas1.home-A.net;iotl=visitedA-homeA SIP/2.0
From:
To:
P-Access-Network-Info:
P-Charging-Vector: icid-value=\"023551024\";orig-ioi=\"Type 1visited-a\";
icid-generated-at=\"msc-vA1.visited-A.net\";transit-ioi=\"ICa.1\"
Target-Dialog:
Require:
Record-Route: \,\,
\
P-Asserted-Identity:
Contact:
CSeq:
Accept:
Recv-Info:
Supported:
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bk73eb11
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bk79c54a
Via: SIP/2.0/UDP atcf-vA1.visited-A.net;branch=z9hG4bk7987fe
Other SIP header fields and SDP according to 3GPP TS 24.229 [4] and 3GPP TS
29.079 [5].
> **P-Charging-Vector:** The IC-A1 adds the \"transit-ioi\" header field
> parameter **with an IOI value identifying the transit network** (i.e.
> **\"ICa\")**.
**Record-Route:** Based on interconnection operator SLA the IC-A1 adds an
entry to the Record-Route header field or not.
**Via:** The IC-A1 adds a Via header field.
**9\. INVITE request due to ATU-STI (IBCF-hA1 to SCC AS-hA1 via I-CSCF) - see
example in table 5.11.3-9.**
When the IBCF-hA1 receives the INVITE request due to ATU-STI the IBCF-hA1
updates the SDP as described in 3GPP TS 29.079 [5].
Since there is no Route header field guiding the IBCF-hA1 where to route the
call the IBCF-hA1 selects an I‑CSCF in the home network and sends the INVITE
request due to ATU-STI to the selected I-CSCF according to 3GPP TS 24.229 [4].
In this example, the IBCF-hA1 does not add any \"transit-ioi\" header field
parameter in the P-Charging-Vector header field. However, the IBCF-hA1 adds
the \"transit-ioi\" header field parameter based on local policy, when the
\"transit-ioi\" identifying the preceding interconnection network is not
included in the received request (e.g. when the preceding interconnection
network is not an IMS transit network).
The I-CSCF uses PSI routeing to route the call and sends the INVITE request
due to ATU-STI directly to SCC AS**‑** hA1.
The table 5.11.3.9 shows the content of the INVITE request due to ATU-STI when
received in the SCC AS‑hA1.
Table 5.11.3-9: INVITE request due to ATU-STI (IBCF-hA1 to SCC AS-hA1 via
I-CSCF)
INVITE sip:ps2cs\@sccas1.home-A.net;iotl=visitedA-homeA SIP/2.0
From:
To:
P-Access-Network-Info:
P-Charging-Vector:
Target-Dialog:
Require:
Record-Route: \,\,
\,\
P-Asserted-Identity:
Contact:
CSeq:
Accept:
Recv-Info:
Supported:
Via: SIP/2.0/UDP icscf-hA1.home-A.net;branch=z9hG4bk7e75ca1
Via: SIP/2.0/UDP ibcf-hA1.home-A.net;branch=z9hG4bk769aff3
Via: SIP/2.0/UDP ic-A1.interconnection-A.net;branch=z9hG4bk73eb11
Via: SIP/2.0/UDP ibcf-vA1.visited-A.net;branch=z9hG4bk79c54a
Via: SIP/2.0/UDP atcf-vA1.visited-A.net;branch=z9hG4bk7987fe
Other SIP header fields and SDP according to 3GPP TS 24.229 [4], 3GPP TS
24.237 [20] and 3GPP TS 29.079 [5].
> **Record-Route:** The IBCF-hA1 adds a Record-Route header field.
>
> **Via:** The IBCF-hA1 adds a Via header field.\ The I-CSCF-hA1 adds a Via
> header field.
**10\. INVITE request (SCC AS-hA1 to S-CSCF-hA1) - see example in table
5.11.3-10.**
When the SCC AS-hA1 receives the INVITE request due to ATU-STI the SCC AS-hA1
compares the received SDP with the SDP negotiated in the existing session. The
conclusion is that it differs so the SCC AS-hA1 needs to send a re-INVITE
request towards the remote UE.
NOTE 6: The AS can either remove the OMR attributes in the SDP or keep them
depending on if the AS supports OMR and local policy. In this example the OMR
attributes are removed.
NOTE 7: When a user is roaming and media is anchored in IBCF the IP addresses
will be different in the SDP received in the INVITE request due to ATU-STI
compared to those negotiated in the existing session towards the remote UE and
that will always result in that a re-INVITE request is needed towards the
remote UE.
Table 5.11.3-10: INVITE request (SCC AS-hA1 to S-CSCF-hA1)
INVITE sip:[5555::bbb:ccc:ddd:aaa] SIP/2.0
From: \;tag=4fa3
To: \;tag=987651
CSeq: 1000 INVITE
Route: \,\,\
Via: SIP/2.0/UDP sccas-hA1.home-A.net;branch=z9hG4bK3a4f92
Other SIP header fields and updated SDP according to 3GPP TS 24.229 [4] and
3GPP TS 24.237 [20].
**Request-URI: Set to the contact address of the remote UE.**
**From: Set to the SIP URI that is the default public user identity of the
user A i.e. userA_public1\@home-A.net.**
**To: Set to the public user identity of the remote UE.**
**Via: The SCC AS-hA1 adds a Via header field.**
**11\. INVITE request (S-CSCF-hA1 to IBCF-hA2) - see example in table
5.11.3-11.**
The S-CSCF-hA1 forwards the re-INVITE request according to procedures in 3GPP
TS 24.229 [4].
Table 5.11.3-11: INVITE request (S-CSCF-hA1 to IBCF-hA2)
INVITE sip:[5555::bbb:ccc:ddd:aaa] SIP/2.0
From:
To:
CSeq:
Route: \,\
Via: SIP/2.0/UDP scscf-hA1.home-A.net;branch=z9hG4bK354321
Via: SIP/2.0/UDP sccas-hA1.home-A.net;branch=z9hG4bK3a4f92
Other SIP header fields and updated SDP according to 3GPP TS 24.229 [4] and
3GPP TS 24.237 [20].
**Via:** The S-CSCF-hA1 adds a Via header field.
**12-13. 200 (OK) response (IBCF-hA2 to SCC AS-hA1 via S-CSCF-hA1).**
When the IBCF-hA2 receives the 200 (OK) response to the re-INVITE request sent
towards the remote UE, the IBCF-hA2 forwards the 200 (OK) response to SCC AS-
hA1 according to 3GPP TS 24.229 [4]. The 200 (OK) response does not contain
any SRVCC specific information**.**
**14-15. ACK request (SCC AS-hA1 to IBCF-hA2 via S-CSCF-hA1).**
The SCC AS-hA1 sends the ACK to the IBCF-hA2 according to 3GPP TS 24.229 [4].
The ACK request does not contain any SRVCC specific information.
**16-20. 200 (OK) response (SCC AS-hA1 to ATCF-vA1 via S-CSCF-hA1, IBCF-hA1,
IC-A1 and IBCF-vA1) - see example in table 5.11.3-20.**
The SCC AS-hA1 uses the received SDP response and sends a 200 OK response to
the INVITE request due to ATU-STI towards the ATCF-vA1.
The table 5.11.3-20 shows the content of the 200 (OK) response when received
in ATCF-vA1.
Table 5.11.3-20: 200 (OK) response (IBCF-vA1 to ATCF-vA1)
SIP/2.0 200 OK
From: \;tag=171828
To: \;tag=828171
CSeq: 11 INVITE
Record-Route: \,\,
\,\
P-Charging-Vector: icid-value=\"023551024\";orig-ioi=\"Type 1visited-a\";icid-
generated-at=\"msc-vA1.visited-A.net\";term-ioi=\"Type 1home-a\";related-
icid=\"AyretyU0dm+6O2IrT5tAFrbHLso=023551024\"
Via: SIP/2.0/UDP atcf-vA1.visited-A.net;branch=z9hG4bk7987fe
Other SIP header fields and SDP according to 3GPP TS 24.229 [4].
**P-Charging-Vector:** The SCC AS added the P-Charging-Vector with the \"icid-
value\", the \"orig-ioi\" value and the \"icid-generated-at\" as received in
the INVITE due to ATU-STI. Additionally the SCC AS**‑** hA1 added the
\"related-icid\" header field parameter. The \"related-icid\" header field
parameter contains the \"icid-value\" header field parameter of the original
call and can be used for charging correlation of generated CDR records in the
interconnect network A.
NOTE 8: If the interconnection network is SIP-unaware, step 19 is skipped.
**21-24. ACK request (ATCF-vA1 to SCC AS-hA1 via IBCF-vA1, IC-A1, IBCF-hA1 and
S-CSCF‑hA1).**
The ATCF-vA1 sends the ACK to the SCC AS-hA1 according to 3GPP TS 24.229 [4].
The ACK request does not contain any SRVCC specific information.
NOTE 9: If the interconnection network is SIP-unaware, step 22 is skipped.
### 5.11.4 PS to CS SRVCC access transfer for a call in the active phase with
loopback
This clause describes the PS to CS SRVCC access transfer of a call in the
active phase with loopback.
Preconditions to this call flow:
1\. A call is established between a UE-A and a remote UE as described in
clause 5.4. The UE-A is attached to a 4G radio access network (E-UTRAN);
NOTE 1: The signalling flow is the same for PS to CS SRVCC access transfer for
a call in the active phase regardless if the UE-A or the remote UE initiated
the call.
2\. The media is anchored in the P-CSCF-vA1, ATCF-vA1 and IBCF‑vA1 in the
visited network vA); and
3\. SIP signalling is anchored in SCC AS‑hA1.
Figure 5.11.4-1 shows the SIP message flow when PS to CS SRVCC access transfer
of a call in the active phase occurs.
NOTE: For clarity, the SIP 100 (Trying) messages are not shown in the
signalling flow.
Figure 5.11.4-1: SRVCC with loopback message flow
The steps of the flow are as follows:
**1\. A call is established between the UE-A and a remote UE as described in
clause 5.4.**
The remote UE can be a UE connected to IMS or an UE connected to CS and the
difference compared to the description in clause 5.4 and this PS to CS SRVCC
access transfer scenario is that an ATCF in the visited originated network
participated in the call establishment of the call and that the general AS-hA1
in figure 5.4.2**‑** 1 is replaced by the access transfer specific SCC AS-hA1.
The media path is UE-A -- P-CSCF-vA1 -- ATCF-vA1 -- IBCF-vA1 -- IC-T1 --
terminating network -- remote UE.
**2\. INVITE request due to STN-SR (MSC server-vA1 to ATCF-vA1).**
See step 3 in clause 5.11.3.
**3\. 200 (OK) response (ATCF-vA1 to MSC server-vA1).**
See step 4 in clause 5.11.3.
**4\. ACK request (MSC server-vA1 to ATCF-vA1).**
The MSC server acknowledges the receipt of the 200 (OK) response. No SRVCC
specific information is added.
**5-8. INVITE request due to ATU-STI (ATCF-vA1 to SCC AS-hA1 via IBCF-vA1,
IC-A1, IBCF‑hA1/I‑CSCF and S-CSCF‑hA1).**
See steps 6-9 in clause 5.11.3.
NOTE 2: If the interconnection network is SIP-unaware, step 7 is skipped.
**9-15. INVITE request (SCC AS-hA1 to IC-T1 via S-CSCF-hA1, IBCF-hA1, IC-A1,
IBCF‑vA1, TRF and IBCF‑vA1) - see example in table 5.11.4-9.**
When the SCC AS-hA1 receives the INVITE request due to ATU-STI the SCC AS-hA1
compares the received SDP with the SDP negotiated in the existing session. The
conclusion is that it differs so the SCC AS-hA1 needs to send a re-INVITE
request towards the remote UE.
The SCC AS-hA1 handles OMR attributes according to 3GPP TS 24.237 [20] clause
6A.4.4.
NOTE 3: When a user is roaming and media is anchored in IBCF the IP addresses
will be different in the SDP received in the INVITE request due to ATU-STI
compared to those negotiated in the existing session towards the remote UE and
that will always result in that a re-INVITE request is needed towards the
remote UE.
The table 5.11.4-9 shows the content of the INVITE request when sent by SCC
AS‑hA1.
Table 5.11.4-9: INVITE request (SCC AS-hA1 to IC-T1 via S-CSCF-hA1, IBCF-hA1,
IC-A1, IBCF‑vA1, TRF and IBCF‑vA1)
INVITE sip:[5555::bbb:ccc:ddd:aaa] SIP/2.0
From: \;tag=171828
To: \;tag=987651
CSeq: 111 INVITE
Route: \,\,
\
Via: SIP/2.0/UDP sccas-hA1.home-A.net;branch=z9hG4bK3a4f92
Other SIP header fields and updated SDP according to 3GPP TS 24.229 [4], 3GPP
TS 24.237 [20] and 3GPP TS 29.079 [5].
**Via:** Via header fields are added by SCC AS-hA1, S-CSCF-hA1, IBCF-hA1,
IC-A1, IBCF‑vA1, TRF and IBCF‑vA1.
NOTE 4: If the interconnection network is SIP-unaware, step 12 is skipped.
**16-22. 200 (OK) response (IC-T1 to SCC AS-hA1 via IBCF-vA1, TRF, IBCF-vA1,
IC-A1, IBCF-hA1 and S‑CSCF‑hA1).**
When receiving a 200 (OK) response to the re-INVITE request from the remote UE
the IC-T1 returns a 200 (OK) response. No SRVCC specific information is added.
NOTE 5: If the interconnection network is SIP-unaware, step 20 is skipped.
**23-29. ACK request (SCC AS-hA1 to IC-T1 via S-CSCF-hA1, IBCF-hA1, IC-A1,
IBCF-vA1, TRF and IBCF‑vA1).**
The SCC AS-hA1 acknowledges the receipt of the 200 (OK) response. No SRVCC
specific information is added.
NOTE 6: If the interconnection network is SIP-unaware, step 26 is skipped.
**30-34. 200 (OK) response (SCC AS-hA1 to ATCF-vA1 via S-CSCF‑hA1, IBCF-hA1,
IC‑A1 and IBCF-vA1).**
See steps 16-20 in clause 5.11.3.
NOTE 7: If the interconnection network is SIP-unaware, step 33 is skipped.
**35-39. ACK request (ATCF-vA1 to SCC AS-hA1 via IBCF-vA1, IC-A1, IBCF-
hA1/I-CSCF and S‑CSCF‑hA1).**
The ATCF-vA1 acknowledges the receipt of the 200 (OK) response. No SRVCC
specific information is added.
NOTE 8: If the interconnection network is SIP-unaware, step 37 is skipped.
## 5.12 Invocation and configuration of services during roaming in a visited
network
This case describes how the user within a visited network invokes services via
the Ut interface.
GSMA IR.88 [15] describes that the home operator must provide an APN to be
used by the UE for XCAP/Ut. For the UE details see GSMA IR.92 [8].
The IMS \"well-known\" APN must not be used as APN for XCAP/Ut as defined in
Section 6.3.2 of GSMA IR.88 [15].
In addition GSMA IR.92 [8] describes that for XCAP requests, the UE must be
preconfigured or provisioned by the home operator with the APN to be used for
XCAP requests.
Editor\'s note: It needs to be clarified and described which correlation
between the SIP Call Signalling and the http flows are existing.
Editor\'s note: It needs to be clarified and described which security
mechanisms are used.
#
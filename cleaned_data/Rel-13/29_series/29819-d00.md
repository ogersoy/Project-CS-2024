# Foreword
This Technical Report has been produced by the 3^rd^ Generation Partnership
Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The IETF RFC 3588 [2] specifying the Diameter base protocol has been obsoleted
by the IETF RFC 6733 [3]. This new version of the IETF RFC is not a new
version of the Diameter base protocol but a specification update intended to
fix issues discovered after early implementations of the protocol.
The aim of the Technical Report is to:
\- appraise the differences between the IETF RFC 6733 [3] and the IETF RFC
3588 [2];
\- analyze the possible impacts on the 3GPP specifications relying on the
Diameter base protocol and then;
\- provide guidelines regarding a general update of the normative reference
for Diameter base protocol.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] IETF RFC 3588: \"Diameter Base Protocol\".
[3] IETF RFC 6733: \"Diameter Base Protocol\".
[4] IETF RFC 4301: \"Security Architecture for the Internet Protocol\".
[5] IETF RFC 5246: \"The Transport Layer Security (TLS) Protocol Version
1.2\".
[6] IETF RFC 6083: \"Datagram Transport Layer Security (DTLS) for Stream
Control Transmission Protocol (SCTP)\".
[7] IETF RFC 3436: \"Transport Layer Security over Stream Control Transmission
Protocol\".
[8] IETF draft-ietf-aaa-diameter-cms-sec-04: \"Diameter CMS Security
Application\".
Editor\'s note: The above document cannot be formally referenced until it is
published as an RFC
[9] 3GPP TS 33.210: \"3G security; Network Domain Security (NDS); IP network
layer security\".
[10] IETF RFC 5719: \"Updated IANA Considerations for Diameter Command Code
Allocations\".
[11] IETF RFC 7423: \"Diameter Applications Design Guidelines\".
[12] IETF RFC 2165: \"Service Location Protocol\".
[13] IETF RFC 6408: \"Diameter Straightforward-Naming Authority Pointer
(S-NAPTR) Usage\".
[14] IETF RFC 6737: \"The Diameter Capabilities Update Application\".
[15] 3GPP TS 29.214: \"Policy and charging control over Rx reference point\".
[16] 3GPP TS 32.299: \"Telecommunication management; Charging management;
Diameter charging applications\".
# 3 Definitions, symbols and abbreviations
## 3.1 Definitions
For the purposes of the present document, the terms and definitions given in
3GPP TR 21.905 [1] and the following apply.
## 3.2 Abbreviations
For the purposes of the present document, the abbreviations given in 3GPP TR
21.905 [1] and the following apply.\ An abbreviation defined in the present
document takes precedence over the definition of the same abbreviation, if
any, in 3GPP TR 21.905 [1].
AVP Attribute-Value Pair
CCF Command Code Format
DNS Domain Name Server
DTLS Datagram Transport Layer Security
IPsec IP Security
IPX Internetwork Packet Exchange
NAPTR Naming Authority Pointer
S-NAPTR Straightforward-Naming Authority Pointer
SCTP Stream Control Transmission Protocol
SLP Service Location Protocol
SRV Service Record
SRVLOC Service Location
TLS Transport Layer Security
# 4 General
## 4.1 Introduction
The Diameter base protocol, as defined in the IETF RFC 3588 [2] edited in
September 2003, has been progressively adopted by 3GPP to provide various
signaling core interfaces in IP-based mobile networks, first for IMS and PCC,
to become nowadays one of the main core signaling protocols in LTE networks.
Therefore, numerous 3GPP technical specifications list the IETF RFC 3588 [2]
as normative reference.
Published in October 2012, the IETF RFC 6733 [3] obsoletes the IETF RFC 3588
[2]. This document is not intended to define a new version of the Diameter
base protocol but rather focus on fixing issues that have surfaced during
early implementations. It is aimed to be fully backward compatible with
previous implementations based on the obsoleted IETF RFC 3588 [2].
Since the publication of the IETF RFC 6733 [3], 3GPP has adopted a
conservative approach regarding the Diameter base Protocol and the IETF RFC
3588 [2] remains the normative reference in the 3GPP specifications, even if
has been officially obsoleted by IETF and, since, any new Diameter
implementation is supposed to be based on the IETF RFC 6733 [3]. This
conservative approach is explained by the fact that any update of an IETF
reference in the 3GPP specifications is conditioned by a study evaluating the
consequences of the changes in the new IETF document compared to the obsoleted
one, especially in term of backward compatibility with nodes already deployed
in the 3GPP networks.
## 4.2 Objectives
The objectives of this Technical Report are the following:
\- Identification of the changes in the Diameter base protocol specification
as defined in the IETF RFC 6733 [3] compared to the IETF RFC 3588 [2].
\- Evaluation of the potential issues regarding backward and onward
compatibility between Diameter implementations based on the IETF RFC 6733 [3]
and the IETF RFC 3588 [2].
\- Analysis of the impacts of an update of the reference of the Diameter base
protocol in existing 3GPP Diameter application specifications and other
specifications referencing the IETF RFC 3588 [2].
\- Provide recommendations on the document to use as reference of the Diameter
base protocol in existing and new 3GPP specifications.
The conclusions of this study will be used to decide whether or not it is
feasible to update the 3GPP specification to use the IETF RFC 6733 [3] instead
of the IETF RFC 3588 [2] as normative reference for the Diameter base
protocol.
# 5 Changes from IETF RFC 3588
## 5.1 Introduction
This clause shall detail the changes from the IETF RFC 3588 [2] to the IETF
RFC 6733 [3] and the possible impacts on 3GPP applications and/or 3GPP
specifications. The clause is divided into two parts:
\- The first part (see subclause 5.2) captures the changes from the IETF RFC
3588 [2] to the IETF RFC 6733 [3] that modify the design and the use of the
Diameter base protocol and may impact more deeply the 3GPP diameter
applications, e.g. change in the security model.
\- The second part (see subclause 5.3) captures the other changes from the
IETF RFC 3588 [2] to the IETF RFC 6733 [3] that does not modify the design and
the use of the Diameter base protocol but may still have some impacts on the
work on the definition of 3GPP diameter applications, e.g. enhancement of the
dynamic peer discovery mechanism.
## 5.2 Major Changes
### 5.2.1 Change in the Security Model
#### 5.2.1.1 Description of the change
##### 5.2.1.1.1 TLS/DTLS as mandatory to support
In the IETF RFC 3588 [2], the support of IPsec (see IETF RFC 4301 [4]) was
made mandatory for all Diameter nodes to protect Diameter connections between
peers. The support of TLS (see IETF RFC 5246 [5]) was optional for clients
while mandatory for Diameter servers to accommodate clients supporting only
TLS. The use of TLS was primarily foreseen to protect inter-domain Diameter
signaling, e.g. between Diameter edge agents interconnected via IPX networks,
whereas IPsec was recommended for securing connections between peers in intra-
domain, e.g. between GGSN/PGW and the local PCRF. Moreover, one single port
has been defined for listening Diameter incoming connection over TCP or SCTP,
meaning that TLS and IPsec connections were using the same port.
In the IETF RFC 6733 [3], the first change is that DTLS is now recommended to
secure SCTP connections as described in the IETF RFC 6083 [6], due to serious
limitations of the use of TCP on top of SCTP (as described in the IETF RFC
3436 [7]). Moreover, TLS and DTLS become the primary methods for securing
respectively Diameter TCP and SCTP connections, leaving IPsec only as possible
alternative security mechanism, among other solutions independent of Diameter
signaling, mainly for backward compatibility with existing deployment.
##### 5.2.1.1.2 Deprecating the use of the Inband-Security AVP
In the IETF RFC 3588 [2], when IPsec is not used to protect the transport
connection used for the Diameter signalling, the TLS security is bootstrapped
by the inclusion of the Inband-Security-ID AVP (set to the value \"TLS\") in
the CER/CEA exchange. This inclusion of the Inband-Security AVP implies
however that the CER/CEA messages are sent unprotected between peers. Moreover
the TLS handshake between peers moves the peer state machine to the \"Open\"
state for both peers.
As discussed above, the use of the Inband-Security-ID AVP implies that the
CER/CEA messages are not protected by any security mechanism that was in
contradiction with the requirement from the IETF RFC 3588 [2] not to use the
Diameter protocol without any security mechanism (IPsec or TLS). This was
creating a security breach for potential DoS attacks, using CER/CEA messages
with unprotected capabilities information and TLS handshake done in the
\"Open\" state in the peer state machine. To overcome this security issue, it
was decided in the IETF RFC 6733 [3] to define a well-known secured port to
use to initiate TLS/TCP and DTLS/SCTP connections between peers in \"Closed\"
state.
##### 5.2.1.1.3 Deprecating the E2E security framework
The IETF RFC 3588 [2] was assumed to be defined along with End-to-end security
services. This end-to-end security was supposed to be provided via a specific
extension of the Diameter base protocol, the Diameter CMS Security application
(see IETF draft-ietf-aaa-diameter-cms-sec-04 [8]), providing AVP integrity and
confidentiality at the command level. A specific flag in the AVP header, the
\'P\' bit, was intended to indicate, when set, that the AVP content was
protected by a digital signature providing authentication, integrity and data
origin authentication using a mixture of symmetric and asymmetric transforms.
Confidentiality was supposed to be provided by the encryption of AVPs carried
in specific security AVPs defined by the Diameter CMS Security application.
Included in all messages which use end-to-end protection, the E2E-Sequence AVP
was defined in the IETF RFC 3588 [2] to provide anti-replay protection for end
to end messages.
However, this solution was never completely specified by IETF and no other
mechanism was defined to support the Diameter E2E security framework.
The IETF RFC 6733 [3] simply acknowledges that no E2E security mechanism has
been finally defined for Diameter. As a consequence, the \'P\' bit in the AVP
flags is reserved for future use and the use of the E2E-Sequence AVP has been
obviously deprecated.
#### 5.2.1.2 Backward compatibility with IETF RFC 3588
The support of DTLS/SCTP is required only for IETF RFC 6733-based nodes. It is
then not expected that DTLS/SCTP connections can be initiated with IETF RFC
3588-based nodes in Open state. However, TLS/TCP and IPsec can still be used
to secure Diameter connections.
Whereas TLS/TCP and DTLS/SCTP become the mandatory security mechanism to
Diameter signaling between peers in the IETF RFC 6733 [3], IPsec remain a
possible alternative. As it was mandatory to be supported by all Diameter
nodes in the IETF RFC 3588 [2], IPsec remains a suitable solution to secure
connections between IETF RFC 6733-based nodes and IETF RFC 3588-based nodes.
If IPsec is not used to secure Diameter signaling between peers, TLS/TCP
connection attempts from IETF RFC 6733-based nodes with an IETF RFC 3588-based
node will fail because the latter ones are not configured with the well-known
secured port to initiate TLS/TCP handshake in the \"Closed\" state. However it
is still possible to fallback to a connection via TCP initiate the TLS/TCP
handshake when both ends are in the \"Open\" state. In such a case, the
CER/CEA exchange must include an Inband-Security-ID AVP with a value set to
\"TLS\" to indicate that TLS/TCP security is required. If the handshake is
successful, all further messages will be then sent via TLS/TCP. If the
handshake fails, both ends move back to the \"Closed\" state.
Regarding E2E security, there is no difference between the IETF RFC 3588 [2]
and the IETF RFC 6733 [3], even if it was supposed to be available in the
first version of the specification. Therefore, Diameter nodes are not supposed
to rely on any E2E security mechanism and use the \'P\' bit in the AVP header
nor the E2E-Sequence AVP.
#### 5.2.1.3 Impacts on 3GPP specifications
In 3GPP networks, the security of Diameter-based interfaces relies on the
security architecture for network domain IP based control planes defined in
the 3GPP TS 33 210 [9]. The architecture is depicted in the figure below.
Figure 1: NDS architecture for IP-based protocols
In this architecture, a security domain usually corresponds to the core
network of a single operator and core networks are separated by SEG. The Za-
interface covers all NDS/IP traffic between security domains and the Zb-
interface is located either between Security Gateways (SEG) and Network
Entities (NEs) or between NEs within the same security domain. On the Za-
interface, IPsec ESP is mandatory to provide authentication/integrity
protection whereas encryption is recommended but not required. On the Zb-
interface, IPsec ESP is optional to implement, depending on the operator
decision.
Considering both the IETF RFC 3588 [2] and the IETF RFC 6733 [3], the security
requirements defined by the 3GPP TS 33.210 [9] for protecting NDS/IP traffic,
including Diameter signaling, are not compliant with the security requirements
defined for securing Diameter messages. As per the IETF RFC 3588 [2] and
inherited by the IETF RFC 6733 [3], Diameter cannot be used without any
security mechanism, either IPsec or TLS for the IETF RFC 3588 [2], or TLS,
DTLS or IPsec for the IETF RFC 6733 [3]. Therefore the optional use of IPsec
over Zb-interface is not compliant. Moreover, in the IETF documents, when used
to protect signaling between Diameter peers, IPsec ESP must be used in
transport mode with non-null encryption and authentication algorithms to
provide per-packet authentication, integrity protection and confidentiality
whereas IPsec ESP is used in tunnel mode over Za-interface and Zb-interface
(if IPsec is implemented) and the encryption is not mandatory.
With the assumption that Diameter-based 3GPP entities were only relying on the
Diameter base protocol requirements to secure transport connections, moving
from the IETF RFC 3588 [2] to the IETF RFC 6733 [3] based implementation would
be seamless if 3GPP makes mandatory the support of IPsec for every node
deployed based on the IETF RFC 6733 [3] and implemented in 3GPP networks. With
such a specific 3GPP mandatory requirement, it is ensured that at least one
common security mechanism (i.e. IPsec) will be supported by any peer
interconnected with the 3GPP nodes.
The deprecation of the use of the Inband-Security AVP has no impact on the
3GPP specifications if IPsec is assumed to be the default mechanism for
securing Diameter connections in 3GPP networks.
As it was never deployed, deprecating the E2E security framework in the IETF
RFC 6733 [3] has no impact on the 3GPP specifications, except from a
documentation point of view: in tables describing the set of AVPs defined for
a specific application, a column was often added to indicate whether the AVP
could be encrypted. This indication becomes useless as an AVP cannot be
protected by any existing E2E security mechanism on top of Diameter.
#### 5.2.1.4 Conclusion
As described above, the IETF RFC 6733 [3] is backward compatible with the IETF
RFC 3588 [2] regarding the change of security model if IPsec is supported by
IETF RFC 6733 [3] based implementation as alternative security mechanism.
Assuming that Diameter implementations in mobile networks are compliant with
the security requirements defined in the 3GPP TS 33.210 [9], the change of
Diameter security model in the IETF RFC 6733 [3] does not really impact the
existing implementations as there are not compliant anyway with the security
requirements defined in the IETF RFC 3588 [2]. As long as the requirements
given in the 3GPP TS 33.210 [9] remain valid for Diameter-based interfaces
deployed in 3GPP networks, it is assumed that this security model prevails
over the security requirements defined by IETF for the protection of Diameter.
In any case, in the specifications referencing the new IETF RFC 6733 [3], the
3GPP can mandate the support of IPsec to ensure backward compatibility with
existing nodes based on the IETF RFC 3588 [2] deployed in the networks.
It is therefore concluded that there is no security concern when updating the
3GPP specification to indicate that the IETF RFC 6733 [3] is now the normative
reference for Diameter implementation as long as IPsec support is required.
TLS/TCP remains an alternative for connection with early implementations based
on IETF RFC 3588 [2] supporting both IPsec and TLS.
### 5.2.2 Use of the Vendor-Specific-Application-ID
#### 5.2.2.1 Description of the change
The Vendor-Specific-Application-Id AVP (AVP Code 260) is primarily defined by
the IETF RFC 3588 [2] as an AVP of type Grouped used to advertise support of a
vendor-specific Diameter Application. It is also stated that this AVP must
also be present in all experimental commands defined in the vendor-specific
application. As a consequence, most of the 3GPP command CCF specifications
include the Vendor-Specific-Application-Id AVP as required AVP, noted {AVP}.
In the IETF RFC 6733 [3], it is clarified that the Vendor-Specific-
Application-Id AVP is not required in new commands defined for vendor-specific
application as the application identifier present in the command header
already contains the Vendor-Specific-Application-Id AVP.
#### 5.2.2.2 Backward compatibility with IETF RFC 3588
As per the IETF RFC 6733 [3], the presence of the Vendor-Specific-Application-
Id AVP is not anymore required in vendor-specific commands. However, the
presence of this AVP in the command does not cause an error as long as the
command respects the corresponding CCF specification provided in the
specification defining the vendor-specific application. Therefore,
clients/proxies/servers supporting this type of vendor-specific application
will correctly generate and process commands including the Vendor-Specific-
Application-Id AVP, the nodes being based independently on the IETF RFC 3588
[2] or the IETF RFC 6733 [3]. In such a case, there is no backward
compatibility issue as long as the command CCF specification is kept
unchanged.
New vendor-specific application based on the IETF RFC 6733 [3] will not
include the Vendor-Specific-Application-Id AVP in vendor-specific commands.
Any node supporting this new application will generate commands that do not
include the Vendor-Specific-Application-Id AVP.
One issue might exist in the unlikely configuration in which an agent based on
the IETF RFC 3588 [2] in the signalling path would systematically check the
presence of the Vendor-Specific-Application-Id AVP in any vendor-specific
command. In such a case, the absence of the Vendor-Specific-Application-Id AVP
in vendor-specific commands would be considered as an error and the command
might be rejected or discarded. However, such a sanity check would be anyway
not compliant with the IETF RFC 3588 [2]. An agent inspecting the presence of
the Vendor-Specific-Application-Id AVP in vendor-specific commands cannot be a
relay or redirect agent since these Diameter agents \"do not examine or alter
non-routing AVPs\" as already stated in the IETF RFC 3588 [2]. Therefore, such
an agent inspecting the presence of the Vendor-Specific-Application-Id AVP in
vendor-specific commands must be a proxy agent and, by definition, a proxy
agent must be compliant to the vendor-specific application for which the
commands are used. As for this new application based on the IETF RFC 6733 [3],
vendor-specific commands without including the Vendor-Specific-Application-Id
AVP are correct and the commands must be successfully parsed by the proxy.
From a pure IETF point of view, the notion of version or release of a Diameter
application does not exist, as reinforced in the IETF RFC 6733 [3]. Therefore,
a node supporting and advertising an application is supposed to be always
compliant with the latest version of the specification describing this
application. There is no backward compatibility issue between nodes supporting
the same application.
#### 5.2.2.3 Impacts on 3GPP specifications
For existing applications defined with commands explicitly including the
Vendor-Specific-Application-Id AVP as required AVP in the command CCF
description, there is no need to modify the command\'s CCF specification to
remove (or make optional) this AVP in the command. It was and it will remain
useless information but this is not an issue. Any command received with the
Vendor-Specific-Application-Id AVP will not cause an error in a node based on
the IETF RFC 6733 [3]. Moreover, it is not possible to modify the set of
required AVP in a command\'s CCF specification without defining a new command.
It is therefore recommended not to modify the existing commands.
For existing applications defined with commands including the Vendor-Specific-
Application-Id AVP as optional AVP, it is possible to either modify the
command\'s CCF specification to remove it from the list of optional AVP to
include or add an informative note to indicate that its presence in the CCF
specification is due to historical reason but it is not used in this release
and onward. Even with the Vendor-Specific-Application-Id AVP set as required
in the command\'s CCF specifications, existing applications are compliant with
the IETF RFC 6733 [3]. The presence of this AVP in the command is not
incorrect but only useless.
For existing application for which nothing has been specified regarding the
presence of the Vendor-Specific-Application-Id AVP, it is assumed that
implementations rely on the Diameter base protocol and therefore on the IETF
RFC 3588 [2] for the time being. Therefore, the requirement on the mandatory
presence of the Vendor-Specific-Application-Id AVP applies. For those
applications, the same conclusions given for existing applications defined
with commands explicitly including the Vendor-Specific-Application-Id AVP
apply. In addition, if it is decided to move to the IETF RFC 6733 [3], it will
be required to add a note in the specification to indicate the Vendor-
Specific-Application-Id AVP should be including in the command in order to
remain backward compatible with earlier implementations based on the IETF RFC
3588 [2]. This note is required as long as these specifications do not
explicitly include the Vendor-Specific-Application-Id AVP as required AVP in
the command CCF description. Another option would be to modify the command CCF
description to include the Vendor-Specific-Application-Id AVP as required AVP.
For new application, it is recommended not to include the Vendor-Specific-
Application-Id AVP defined as required AVP in the command\'s CCF
specification.
#### 5.2.2.4 Conclusion
The deprecation of the use of the Vendor-Specific-Application-Id AVP in
commands defined for vendor-specific application has no impact on existing
applications or new application defined by 3GPP.
Existing applications based on the IETF RFC 3588 [2] already defined with the
Vendor-Specific-Application-Id AVP set as required in the command\'s CCF
specification have not to be modified to become compliant with the IETF RFC
6733 [3].
Existing applications based on the IETF RFC 3588 [2] with the Vendor-Specific-
Application-Id AVP defined as optional in the command\'s CCF specification
could be seamlessly updated to remove the Vendor-Specific-Application-Id AVP
the command\'s CCF specification, from a Diameter base protocol point of view.
However, it could be safer to keep the Vendor-Specific-Application-Id AVP
defined as optional in the command to overcome potential interoperability
issues with non-compliant Diameter nodes. This change is therefore not
required to remain compliant with the IETF RFC 6733 [3].
Existing applications based on the IETF RFC 3588 [2] not explicitly including
the Vendor-Specific-Application-Id AVP as required AVP in the command CCF
description will have to be updated to either add a note clarifying the
assumption about the presence of the Vendor-Specific-Application-Id AVP in the
commands or modify the command CCF description to include Vendor-Specific-
Application-Id AVP.
Any new command defined by 3GPP should be defined without the Vendor-Specific-
Application-Id AVP defined as required in the command\'s CCF specification.
### 5.2.3 Deprecated the exchange of CER/CEA messages in the \"Open\" state
#### 5.2.3.1 Description of the change
When two Diameter peers establish a transport connection, they exchange
Capabilities Exchange messages (CER/CEA commands). These messages allow the
discovery of a peer\'s identity and its supported capabilities (protocol
version number, the identifiers of supported Diameter applications, etc.).
The section 5.6 of the IETF RFC 3588 [2] describes the peer state machine that
must be supported by all diameter implementations.
An excerpt of the table describing the peer state machine is provided
hereafter:
Table 5.2.3-1: Excerpt of the Peer State Machine in IETF RFC 3588
* * *
State Event Comment Action Next State R-Open R-Rcv-CER A CER message from the
peer was received R-Snd-CEA R-Open R-Rcv-CEA A CEA message from the peer was
received Process-CEA  
I-Open I-Rcv-CER A CER message from the peer was received I-Snd-CEA I-Open
I-Rcv-CEA A CEA message from the peer was received Process-CEA
* * *
This table was implying that CER/CEA could have been received when the
connection was in \"Open\" state i.e. exchanging CER/CEA commands when both
ends have successfully established a transport connection and therefore after
the initial CER/CEA exchange has been already completed.
However, this possibility of capability exchange in open state is not
described anywhere else in the IETF RFC 3588 [2]. At the contrary, it is
assumed all over the document that the capabilities exchange process takes
place only once, at the set-up of a transport connection between a given pair
of peers.
Moreover, even if it was assumed somehow that this capability exchange in
\"Open\" state was actually permitted by the IETF RFC 3588 [2], this would
trigger interoperability issues regarding the handling of successive CER/CEA
messages with possible different sets of supported application identifiers,
which is not documented in the IETF RFC 3588 [2].
Along the revision of the IETF RFC 3588 [2], it appeared that the possibility
of capability exchange in \"Open\" state was at worst an error in the peer
state machine, at least an under specified option. It was then agreed to
correct the peer state machine and then formally deprecate the exchange of
CER/CEA messages in \"Open\" state in the IETF RFC 6733 [3].
If the use of CER/CEA was meant to allow the dynamic update of certain
Diameter peer capabilities over established peer connection, the Diameter
Capabilities Update Application (see IETF RFC 6737 [14]) defined by the IETF
must be used instead for this purpose.
#### 5.2.3.2 Backward compatibility with IETF RFC 3588
As indicated in the subclause 5.2.3.1, the use of CER/CEA commands in \"Open\"
state was either an error or at least an underspecified feature.
Interoperability issues were discovered on the field when nodes were sending
CER/CEA in open state to node accepting only CER/CEA commands the initiation
of the transport connections. The correction made in the IETF RFC 6733 [3] has
been done to actually solve this interoperability issue. It is therefore
recommended to correct the implementation of any Diameter node that would send
CER/CEA commands in \"Open\" state. This correction can be done as a defect
correction of Diameter implementations compliant to the IETF RFC 3588 [2].
Obviously, this correction can also be part of a more general upgrade to
support the IETF RFC 6733 [3].
#### 5.2.3.3 Impacts on 3GPP specifications
For all 3GPP applications, CER/CEA commands are obviously used for advertising
peer capabilities, in particular supported applications and vendor-ids, to
advertise over the different 3GPP Diameter-based interfaces.
However, in 3GPP specifications, the use of these CER/CEA commands is either
explicitly described as performed at the initiation of the transport
connection (e.g. see subclause 5.2 of 3GPP TS 29.214 [15]) or a simple
reference to the Diameter base protocol specification is given for more
details on the use of CER/CEA messages. There is no mention of the exchange of
CER/CEA commands in \"Open\" state. It is therefore concluded that there is no
such a functional requirement over 3GPP interfaces.
Based on the above considerations, the deprecation of CER/CEA exchange in the
\"Open\" state in the IETF RFC 6733 [3] has no impact on 3GPP specifications.
For Diameter nodes supporting 3GPP applications, the same (unlikely) potential
issues and proposed solutions discussed in subclause 5.2.3.2 apply. If there
are existing nodes deployed in 3GPP networks sending CER commands in \"Open\"
state, these nodes can be safely modified without introducing backward
compatibility issues regarding 3GPP specifications.
#### 5.2.3.4 Conclusion
Regarding the enhancement of the deprecation of CER/CEA exchange in \"Open\"
state, the reference to the IETF RFC 3588 [2] can be seamlessly updated to the
IETF RFC 6733 [3].
In future releases, if there is a specific functional requirements for dynamic
update of Diameter peer capabilities, the support of the Diameter Capabilities
Update Application (see IETF RFC 6737 [14]) is recommended.
## 5.3 Other Changes
### 5.3.1 Changes and Clarifications of the rules for Diameter Extensibility
#### 5.3.1.1 Description of the change
##### 5.3.1.1.1 New Policies for IANA\'s Command Code Assignment
The Diameter base protocol provides a number of ways to extend Diameter, with
new AVP values, new AVPs, new commands and new applications. The IETF RFC 3588
[2] describes the conditions that lead to the need to define a new Diameter
application or a new command code. Depending on the scope of the Diameter
extension, IETF actions may be necessary.
As per the IETF RFC 3588 [2], defining new vendor-specific Diameter
applications does not require IETF consensus: new application identifiers are
simply allocated by IANA under request on a first-come, first-served basis.
However, defining new Diameter commands requires IETF consensus i.e. any new
assignment is conditioned by the publication of an RFC approved by the IETF.
As a consequence, all the command pairs are defined as \"standard\" commands
with only two command pairs left for experimentation performed by vendors.
This has led other SDOs defining new applications (e.g. 3GPP) to abusively
reuse and twist existing commands in order to avoid the length procedure of
IETF RFC publication that can be seen as an overkill process when the aim is
to define a simple vendor-specific command pair.
Based on this deadlock, the IETF RFC 6733 [3] has relaxed the allocation
policy and enlarged the range of available code values for vendor-specific
applications. This was achieved by splitting the command code space into
ranges and providing different IANA allocation policies to them:
\- A range of standard Command Code values that are allocated via IETF Review;
\- A range of vendor-specific Command Code values that are allocated on a
first-come, first-served basis;
\- A range of values reserved only for experimental and testing purposes.
This new allocation policy for command codes has been incorporated in the IETF
RFC 6733 [3], while they were initially defined in the IETF RFC 5719 [10]
updating the IANA considerations in the IETF RFC 3588 [2].
##### 5.3.1.1.2 Clarifications the Diameter extensibility rules
The IETF RFC 6733 [3] clarifies the Diameter extensibility rules initially
defined in the IETF RFC 3588 [2]. In particular, it is clarified the notion of
mandatory/optional AVP according to the setting of the M-bit in the AVP flag
field of the AVP header and that this M-bit setting is per application and per
command. It is also reinforced that existing command cannot be extended by the
addition of any AVP with the M-bit set without resulting to the creation of a
new application.
About the criteria for creating a new Diameter application, there is the
following clarification in the IETF RFC 6733 [3]:
\"If the CCF definition of a command allows it, an implementation may
add arbitrary optional AVPs with the M-bit cleared (including vendor-
specific AVPs) to that command without needing to define a new
application. Please refer to [Section 11.1.1]{.underline} for details.\"
This statement only clarifies the rules regarding the extension of an existing
command. The extension of a command with new AVPs with the M-bit cleared does
not result in the need for the creation of a new application. This mechanism
allows the receiver to safely ignore unrecognized AVPs added to a command.
However, this text does not imply that a command can only be extended with
optional-to-understand AVP (e.g. with the M-bit cleared). An existing command
can be extended by the addition of AVPs already supported by the application
i.e. add in a command AVPs initially used in another command by the same
application.
When it is about adding into the command AVPs already supported by the
Diameter application, the AVPs can be safely added to the command with the
M-bit set. As long as the receiver supports the Diameter base protocol and a
specific application, the receiver will be able to successfully parse a
command including any additional AVP defined by the Diameter base protocol or
the specific application, with or without the M-bit set. The addition of AVPs
with the M-bit set into existing commands will therefore not cause an error.
Obviously, as these AVPs are not part of the original CCF specification
defined for this command, the processing of the command may cause an error at
the application level if the application specification has not been updated to
indicate how to handle these additional AVPs or if the receiver has not been
upgraded to support the new version of the specification. When the application
layer does not know how to handle these additional AVPs included into the
command, these AVPs will be safely ignored, as the application command has
been initially defined without these AVPs and they are de-facto not required
to correctly handle the command.
For Diameter Accounting Application introduced in the past based on the IETF
RFC 3588 [2], which followed the strong recommendation on re-using existing
ACR/ACA commands with Diameter Base Accounting (application Id =3):
\"The creation of a new accounting application should be viewed as a
last resort and MUST NOT be used unless a new command or additional
mechanisms (e.g., application defined state machine) is defined
within the application, or new mandatory AVPs are added to the ABNF.\"
Although this statement stated that the need for new mandatory AVPs were one
of the criteria for allowing the creation of a new accounting application
(instead of re-using application Id =3), it did not explicitly forbid re-using
Diameter Base Accounting ACR/ACA with new AVPs with M-bit set.
The IETF RFC 6733 [3] statement is slightly different regarding this
extensibility rule for new mandatory AVPs, as it clearly requires a new
application to be created when new mandatory AVPs:
\"However, a new Diameter application MUST be created when one or more
of the following criteria are met:
M-bit Setting
> An AVP with the M-bit in the MUST column of the AVP flag table is
>
> added to an existing Command/Application. An AVP with the M-bit
>
> in the MAY column of the AVP flag table is added to an existing
>
> Command/Application.\"
Since, the IETF RFC 6733 [3] has provided more details on the meaning of the
\"mandatory AVP\" and the M-bit setting in the AVP flag as long as their
impacts on existing applications.
To better help Diameter application designers, further clarifications have
been captured in a specific Best Current Practice (BCP) document (see IETF RFC
7423 [11]).
#### 5.3.1.2 Backward compatibility with IETF RFC 3588
The changes in the IANA allocation policies for command codes in the IETF RFC
6733 [3] and the clarifications on the Diameter extensibility rules given by
the IETF RFC 7423 [11] have no impact on the protocol itself. There should be
therefore no backward compatibility issue.
However, for Diameter Accounting application re-using the Diameter Base
Protocol Accounting (application Id =3) and ACR/ACA commands extended with
AVPs and M-bit set, there may be potential impact on Accounting application
level based on strengthen restrictions brought by the IETF RFC 6733 [3] if new
AVPs are still added to the existing commands with the M-bit set.
#### 5.3.1.3 Impacts on 3GPP specifications
Regarding the IANA allocation policies for command codes, the only impact on
3GPP specifications is administrative. When defining new commands for a new
application, it is easier for 3GPP to request IANA for the allocation of new
command codes.
Although reuse of existing commands is still recommended, SDOs including 3GPP
can now consider more easily defining a new command when it provides a
solution more suitable than the twisting of an existing command\'s use to fit
new functional requirements.
The new IANA command code allocation policies have been already taken into
consideration in the definition of new Diameter applications since the 3GPP
Release 11.
Regarding the clarifications on the Diameter extensibility rules given by the
IETF RFC 7423 [11], some mistakes have been made in the past in 3GPP
specifications regarding the design of new applications, reuse of existing
commands or the creation of new mandatory AVPs introduced in existing
applications. However, there is no need to modify the existing specifications
as they are already implemented and there is no interoperability issue. The
guidelines given in the IETF RFC 7423 [11] have to be followed only when
extending existing Diameter applications or creating new applications. And
this is already the case for 3GPP working groups defining Diameter
applications since Release 9.
#### 5.3.1.4 Conclusion
The changes in the IANA allocation policies for command codes in the IETF RFC
6733 [3] and the clarifications of the rules of Diameter extensibility has no
impact on 3GPP specifications, except for Diameter Accounting application
using the Diameter Base Protocol Accounting (application Id =3), such as
specified in the 3GPP TS 32.299 [16].
Regarding these changes, the reference to the IETF RFC 3588 [2] can be
seamlessly updated to IETF RFC 6733 [3] for most of the 3GPP applications. For
3GPP Diameter Accounting application using the Diameter Base Protocol
Accounting (application Id =3), such as specified in the 3GPP TS 32.299 [16],
further studies are required to evaluate how AVPs can be added to existing
commands with the M-bit cleared to avoid backward compatible issues.
### 5.3.2 Simplified Diameter peer discovery
#### 5.3.2.1 Description of the change
The Diameter base protocol allows for dynamic Diameter peer discovery for a
simpler and more robust deployment of Diameter services.
As per the IETF RFC 3588 [2], besides obvious manual configurations, peers can
rely on SLP/SRVLOC or DNS to discover another peer.
The SLP protocol (see IETF RFC 2165 [12]) was defined in the end of the 90\'s
but it has not been widely adopted, NAPTR and SRV DNS records being used
instead for the same purposes. In the IETF RFC 6733 [3], the possible use of
SLP has been then deprecated to ensure that the peer discovery mechanism will
only rely on discovery schemes widely supported by vendors.
Moreover, the dynamic peer discovery mechanism has been enhanced to support
Straightforward-Naming Authority Pointer (S-NAPTR) application service tag
that allows for the discovery of the supported applications before doing the
Diameter capability exchange between peers. The S-NAPTR application service
and application protocol tag values for the Diameter peer discovery have been
defined in the IETF RFC 6408 [13] as an update of the IETF RFC 3588 [2] and
then integrated in the IETF RFC 6733 [3].
#### 5.3.2.2 Backward compatibility with IETF RFC 3588
In the IETF RFC 3588 [2], only the manual configuration was mandatory to
support for the Diameter peer discovery. SLP and DNS-based schemes were
defined as optional. The SLP protocol has not been widely adopted by vendors
and was then not commonly supported by existing implementations. Moreover,
even if it was implemented, SLP can still be used if Directory/service agents
are deployed in the local network. The deprecation of the use of SLP has
therefore no impact on existing implementations.
The enhancement of the dynamic discovery mechanisms to support S-NAPTR
application service and application protocol tag values is something new to
support for implementations strictly based on the IETF RFC 3588 [2]. However,
because the DNS-based mechanism itself is optional to support, any node
supporting manual configuration for Diameter peer discovery remains compliant
with the IETF RFC 6733 [3].
It is then considered that there is no backward compatibility issue regarding
the evolution of the dynamic peer discovery mechanism.
#### 5.3.2.3 Impacts on 3GPP specifications
3GPP specifications defining 3GPP specific Diameter applications do not
usually address the question of discovery of Diameter peers, except when the
next peer is a server. For server selection, 3GPP relies on application-
specific procedures (e.g. SLF or DRA) and not on the Diameter base protocol.
For all the other cases, it is then assumed that Diameter nodes supporting
3GPP Diameter applications rely on the Diameter base protocol to discover
other peers.
As described in the subclause 5.3.2.2, the enhancement of the dynamic
discovery mechanisms in the IETF RFC 6733 [3] is backward compatible with the
IETF RFC 3588 [2]. There is therefore no impact on the 3GPP specifications.
#### 5.3.2.4 Conclusion
Regarding the enhancement of the dynamic discovery of Diameter peers, the
reference to the IETF RFC 3588 [2] can be seamlessly updated to the IETF RFC
6733 [3].
### 5.3.3 Changes in the Command\'s CCF specifications
#### 5.3.3.1 Description of the change
Some command\'s CCF specifications have been changed from the IETF RFC 3588
[2] to the IETF RFC 6733 [3]. The corresponding changes are indicated
hereafter:
a) *[AVP] is added in the CCF specification of the DPA, DWR and DWA commands
in the IETF RFC 6733 [3] to indicate that the commands could be extended by
the inclusion of optional AVPs;
b) Only one Failed-AVP AVP can be present in the command answer whereas it was
indicated that multiple instance could be present using the notation \"*[
Failed-AVP ]\".
c) The Error-Message AVP and the Failed-AVP AVP are added in the ACA
command\'s CCF specification.
d) The Destination-Host AVP is added as optional AVP in the ACR command\'s CCF
specification in the IETF RFC 6733 [3].
e) The CCF specification of answer command when the E bit is set is clarified
in section 7.2 of the IETF RFC 6733 [3].
#### 5.3.3.2 Backward compatibility with IETF RFC 3588
Regarding the changes in the IETF RFC 6733 [3] described in subclause 5.3.3.1,
there is no backward compatibility with the IETF RFC 3588 [2]. Most of the
corrections made in the IETF RFC 6733 [3] are either clarification or
corrections of issues already discovered with the IETF RFC 3588 [2].
The addition of the \"*[AVP]\" in the CCF specifications of the DPA, DWR and
DWA commands is just to correct documentation issue. From the Diameter base
protocol point of view, any command can be extended with optional AVP, since
the IETF RFC 3588 [2], as stated below:
An implementation MAY add arbitrary non-mandatory AVPs to any command
defined in an application, including vendor-specific AVPs without needing to
define a new application.
It is part of the extensibility mechanism provided by Diameter. This
correction is for alignment of the CCF specifications and is not changing the
definition of the commands as defined by IETF.
The same principle of documentation clean-up applies for the addition the
Error-Message AVP and the Failed-AVP AVP in the ACA command\'s CCF
specification. Both AVPs have been defined to be present in any answer
command. Therefore, any answer command must support these AVPs and the
corresponding CCF specifications should include these AVPs, at least in the
Diameter base protocol specification. However, it is not strictly required to
do it in all defined CCF specifications as any command is defined to include
any AVP defined by the application using the commands.
The Destination-Host AVP added in the ACR command\'s CCF specification is
clearly an omission in a Diameter request. This AVP must be present in the
request command if the request needs to be sent to a specific server in a
given domain. It is part of the overall request routing mechanism defined by
the Diameter base protocol.
The correction of the generic CCF specification of answer command when the E
bit is set is due to the clarification given above on the possible presence of
the Error-Message AVP.
The only potential concern would be about the change that only one Failed-AVP
AVP has to present in an error message. This change is based on the definition
of the Failed-AVP AVP that is an AVP of type Grouped as illustrated below:
\ ::= \
1* {AVP}
This format was selected to allow conveying one or more offending or missing
AVPs in the same Grouped AVP. There is therefore no reason to have more than
one Failed-AVP AVP in an error message.
It was acknowledged that the description of the use of the Failed-AVP AVP was
not consistent all across the IETF RFC 3588 [2]. And it was intended to
correct this inconsistency in the IETF RFC 6733 [3].
NOTE: There is still an error in the IETF RFC 6733 [3] in the definition of
the DIAMETER_CONTRADICTING_AVPS where it was said that \"One or more Failed-
AVP AVPs MUST be present (in the error message)\". An erratum has been
submitted and agreed to indicate that only one Failed-AVP AVP must be present
in error message, the Failed-AVP AVP containing all the contradicting AVPs.
Assuming that some existing implementations would send back multiple Failed-
AVP AVP, the receiving entity complying with the IETF RFC 6733 [3] could
detect that there are more instances of Failed-AVP AVP than expected. However,
the primary information for the receiving entity would remain the error code
value used in the Result-Code AVP or Experimental-Result AVP included in the
error message. The Failed-AVP AVP is only provided as debugging information as
already defined in the IETF RFC 3588 [2] and reinforced in the IETF RFC 6733
[3]. Multiple instances of the failed-AVP AVP should not cause an error at the
application level as the Failed-AVP AVP is primarily used at the Diameter base
protocol level. If this Failed-AVP AVP is used at the application and only one
is now expected due to alignment with the IETF RFC 6733 [3], only one of the
Failed-AVP AVPs will be used by the application. There is therefore no
backward compatibility issue regarding the correction on the presence of the
Failed-AVP AVP in the error messages.
#### 5.3.3.3 Impacts on 3GPP specifications
Based on the clarifications given in subclause 5.3.3.2, it is clear that the
following corrections have no impact on the 3GPP specification.
\- *[AVP] added in the CCF specification of the DPA, DWR and DWA commands;
\- The Error-Message AVP and the Failed-AVP AVP added in ACA command\'s CCF
specification.
\- The Destination-Host AVP added as optional AVP in the ACR command\'s CCF
specification.
\- The Error-Message AVP added to the generic CCF specification of answer
command when the E bit is set.
Based on the examples given in the IETF RFC 3588 [2] for Diameter base
protocol commands, some answer commands defined in existing 3GPP applications
may indicate in the corresponding specifications that multiple Failed-AVP AVP
can be present in the answer.
Even if the cardinality of the Failed-AVP AVP has been updated for Diameter
base protocol answer commands, there is no reason to change the existing CCF
specifications for 3GPP commands. Even if one Failed-AVP AVP is enough to
convey the offending/missing AVPs, answer commands received with multiple
Failed-AVP AVPs (if any) will remain valid according to the 3GPP
specifications defining the commands. The principle is valid even if the
normative reference for the Diameter base protocol is updated to the IETF RFC
6733 [3].
New applications reusing exiting 3GPP commands should not modify the
command\'s CCF specification to avoid the need for the allocation of a new
command code.
When reusing Diameter base protocol answer commands, existing 3GPP
specifications that use the IETF RFC 3588 [2] as normative reference will
still allow multiple Failed-AVP AVPs in the answers. Existing applications for
which it would be decided to update the normative reference for the Diameter
base protocol using the IETF RFC 6733 [3] would have to clarify that only one
Failed-AVP AVP is expected in the Diameter base protocol answer commands.
However, this change will not cause backward interoperability issue as
described in subclause 5.3.3.2.
Whatever the reference used for the Diameter base protocol (IETF RFC 3588 [2]
or IETF RFC 6733 [3]), new 3GPP Diameter applications defining new commands
should indicate that only one Failed-AVP AVP is expected in answer commands.
New applications reusing Diameter base protocol command should comply with the
command\'s CCF specification given in the normative reference used for the
Diameter base protocol i.e. IETF RFC 3588 [2] or IETF RFC 6733 [3].
#### 5.3.3.4 Conclusion
Regarding the changes on Diameter commands in subclause subclause 5.3.3.1, the
reference to the IETF RFC 3588 [2] can be seamlessly updated to the IETF RFC
6733 [3] for 3GPP specifications with the precautions and recommendations
given in subclause 5.3.3.3.
# 6 Conclusions and recommendations
## 6.1 Conclusions
The following table summarizes:
\- the changes in the Diameter base protocol specification between the IETF
RFC 6733 [3] and the obsoleted IETF RFC 3588 [2];
\- the conclusions of the evaluation of the potential issues regarding
backward and onward compatibility between Diameter implementations based on
the IETF RFC 6733 [3] and the IETF RFC 3588 [2];
\- The result of the analysis of the impacts of an update of the reference of
the Diameter base protocol in existing 3GPP Diameter application
specifications and other specifications referencing the IETF RFC 3588 [2].
Table 6.1-1: Summary of the main changes between IETF RFC 3588 and IETF RFC
6733
+----------+----------+----------+----------+----------+----------+ | Change | Des | Major | Backward | Impacts | Comments | | | cription | Changes | compa | on 3GPP | | | | in | | tibility | specif | | | | s | | | ications | | | | ubclause | | | | | +----------+----------+----------+----------+----------+----------+ | TLS/DTLS | 5 | Yes | Yes | No | IPsec | | as | .2.1.1.1 | | using | | can | | m | | | IPsec | | still be | | andatory | | | | | used | | to | | | | | | | support | | | | | TLS/TCP | | | | | | | when | | | | | | | D | | | | | | | TLS/SCTP | | | | | | | cannot | | | | | | | be used | +----------+----------+----------+----------+----------+----------+ | Dep | 5 | Yes | Yes if | No | Can | | recating | .2.1.1.2 | | IPsec | | still be | | the use | | | used | | used | | of the | | | | | with | | Inband- | | | | | TLS/TCP | | Security | | | | | if IPsec | | AVP | | | | | is not | | | | | | | used | +----------+----------+----------+----------+----------+----------+ | Dep | 5 | Yes | Yes | No | The E2E | | recating | .2.1.1.3 | | | | security | | the E2E | | | | | model | | security | | | | | was | | f | | | | | never | | ramework | | | | | used | +----------+----------+----------+----------+----------+----------+ | Use of | 5.2.2.1 | Yes | Yes if | Yes for | A note | | the | | | Vendor | existing | in the | | Vendor | | | -Specifi | app | speci | | -Specifi | | | c-Applic | lication | fication | | c-Applic | | | ation-Id | not | is | | ation-ID | | | AVP is | ex | required | | | | | included | plicitly | to | | | | | as | i | indicate | | | | | optional | ncluding | that the | | | | | AVP in | the | Vendor | | | | | the | Vendor | -Specifi | | | | | command | -Specifi | c-Applic | | | | | for | c-Applic | ation-Id | | | | | interope | ation-Id | AVP | | | | | rability | AVP as | should | | | | | | required | be | | | | | | AVP in | i | | | | | | the | ncluding | | | | | | command | in the | | | | | | CCF | command | | | | | | des | in order | | | | | | cription | to | | | | | | | remain | | | | | | | backward | | | | | | | co | | | | | | | mpatible | +----------+----------+----------+----------+----------+----------+ | De | 5.2.3.1 | Yes | No | No | Exchange | | precated | | | | | of | | the | | | | | CER/CEA | | exchange | | | | | in open | | of | | | | | state is | | CER/CEA | | | | | not used | | messages | | | | | in 3GPP | | in the | | | | | speci | | open | | | | | fication | | state | | | | | and the | | | | | | | change | | | | | | | would be | | | | | | | anyway | | | | | | | required | | | | | | | to solve | | | | | | | interope | | | | | | | rability | | | | | | | issues | +----------+----------+----------+----------+----------+----------+ | New | 5 | No | Yes | No | Admini | | Policies | .3.1.1.1 | | | | strative | | for | | | | | change | | IANA\'s | | | | | | | Command | | | | | | | Code | | | | | | | As | | | | | | | signment | | | | | | +----------+----------+----------+----------+----------+----------+ | Clarif | 5 | No | Yes | No | | | ications | .3.1.1.2 | | | | | | the | | | | | | | Diameter | | | | | | | exten | | | | | | | sibility | | | | | | | rules | | | | | | +----------+----------+----------+----------+----------+----------+ | Si | 5.3.2.1 | No | Yes | No | SL | | mplified | | | | | P/SRVLOC | | Diameter | | | | | was not | | peer | | | | | used. | | d | | | | | | | iscovery | | | | | DNS | | | | | | | based | | | | | | | solution | | | | | | | is only | | | | | | | optional | | | | | | | in | | | | | | | Diameter | | | | | | | and in | | | | | | | 3GPP | | | | | | | speci | | | | | | | fication | +----------+----------+----------+----------+----------+----------+ | Changes | 5.3.X.1 | No | Yes | Yes but | | | in the | | | | limited | | | Co | | | | impacts | | | mmand\'s | | | | | | | CCF | | | | | | | specif | | | | | | | ications | | | | | | +----------+----------+----------+----------+----------+----------+
As a general conclusion, it is considered that it is feasible to update the
3GPP specification to use the IETF RFC 6733 [3] instead of the IETF RFC 3588
[2] as normative reference for the Diameter base protocol.
Most of the changes introduced in the IETF RFC 6733 [3] are backward
compatible with implementations based on the IETF RFC 3588 [2] and have no
identified impact on 3GPP specifications.
On the change in the security model, the support of IPsec is mandated to
ensure backward compatibility with existing nodes deployed in an earlier
release and therefore based on the IETF RFC 3588 [2]. The requirements given
in the 3GPP TS 33.210 [9] remain valid for any Diameter-based interface
deployed in 3GPP networks
The deprecation of the use of the Vendor-Specific-Application-Id AVP in
commands defined for vendor-specific application based on the IETF RFC 6733
[3] has no impact on existing applications or new application defined by 3GPP.
## 6.2 Recommendations
Based on the analysis of the difference between the IETF RFC 6733 [3] and the
IETF RFC 3588 [2], the following recommendations are provided:
\- The IETF RFC 6733 [3] should be used as normative reference for the
Diameter base protocol instead of the IETF RFC 3588 [2] when defining new 3GPP
Diameter application.
\- The IETF RFC 3588 [2] can still be used as normative reference for the
Diameter base protocol for existing 3GPP Diameter applications. Updating the
reference to the IETF RFC 6733 [3] can be decided application per application.
\- For new 3GPP Diameter applications, the support of IPsec should be mandated
to ensure backward compatibility with existing nodes deployed in an earlier
release and therefore based on the IETF RFC 3588 [2] if required.
\- For new 3GPP Diameter commands, the Vendor-Specific-Application-Id AVP
should not be included in the command\'s CCF specification.
\- For existing application for which nothing has been specified regarding the
presence of the Vendor-Specific-Application-Id AVP in the command\'s CCF
specification, it should be assumed that the requirement on the mandatory
presence of the Vendor-Specific-Application-Id AVP applies. For those
applications, if the command\'s CCF specifications are not updated, an
informative note should be added to indicate that the Vendor-Specific-
Application-Id AVP is present in any command supported by the application.
\- When defining new application, the \"Diameter Applications Design
Guidelines\" document (see IETF RFC 7423 [11]) should be used as reference for
a better understanding of Diameter extensibility rules and guidelines for the
creation of new applications.
\- Any change in the security requirements for network domain IP based control
planes defined in the 3GPP TS 33 210 [9] should consider the security model
defined in the IETF RFC 6733 [3].
#
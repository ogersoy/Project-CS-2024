# Foreword
This Technical Specification has been produced by the 3^rd^ Generation
Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document analyses P-CSCF restoration enhancements for WLAN. After
reviewing existing P-CSCF restoration with their limitations, it defines the
objectives to fulfil and proposes solutions addressing trusted WLAN using S2a
interface and untrusted WLAN using S2b interface. The enhancements refer to
and complement the HSS based and PCRF based solutions for 3GPP accesses
specified in Rel12 and described in 3GPP TS 23.380 [2].
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
\- References are either specific (identified by date of publication, edition
number, version number, etc.) or nonâ€‘specific.
\- For a specific reference, subsequent revisions do not apply.
\- For a non-specific reference, the latest version applies. In the case of a
reference to a 3GPP document (including a GSM document), a non-specific
reference implicitly refers to the latest version of that document _in the
same Release as the present document_.
[1] 3GPP TR 21.905: \"Vocabulary for 3GPP Specifications\".
[2] 3GPP TS 23.380: \"IMS Restoration Procedures\".
[3] 3GPP TS 23.402: \"Architecture enhancements for non-3GPP accesses\".
[4] 3GPP TR 23.820: \"Study on IMS Restoration Procedures\".
[5] 3GPP TS 24.244: \"Wireless LAN control plane protocol for trusted WLAN
access to EPC; Stage 3\".
[6] 3GPP TS 24.229: \"IP multimedia call control protocol based on Session
Initiation Protocol (SIP) and Session Description Protocol (SDP); Stage 3\".
[7] 3GPP TR 29.806: \"Study on IP Multimedia Subsystem (IMS); Proxy Call
Session Control Function (P-CSCF); restoration procedures\".
[8] IETF RFC 7296: \"Internet Key Exchange Protocol Version 2 (IKEv2)\".
[9] IETF Draft draft-gundavelli-ipsecme-3gpp-ims-options-04: \"3GPP IMS Option
for IKEv2\".
[10] GSMA PRD IR 65: \"IMS Roaming and Interworking Guidelines, version
14.0\".
[11] 3GPP TS 23.008: \"Organization of subscriber data\".
[12] 3GPP TS 24.008: \"Mobile radio interface Layer 3 specification; Core
network protocols; Stage 3\".
[13] 3GPP TS 24.302: \"Access to the 3GPP Evolved Packet Core (EPC) via
non-3GPP access networks; Stage 3\".
[14] 3GPP TS 24.244: \"Wireless LAN control plane protocol for trusted WLAN
access to EPC; Stage 3\".
[15] 3GPP TS 29.273: \"Evolved Packet System (EPS); 3GPP EPS AAA interfaces\".
[16] 3GPP TS 29.274: \"3GPP Evolved Packet System (EPS); Evolved General
Packet Radio Service (GPRS) Tunnelling Protocol for Control plane (GTPv2-C);
Stage 3\".
[17] 3GPP TS 29.275: \"Proxy Mobile IPv6 (PMIPv6) based Mobility and
Tunnelling protocols; Stage 3\".
[18] GSMA PRD IR 92: \"IMS Profile for Voice and SMS, version 9.0\".
[19] GSMA PRD IR.51: \"IMS over Wi-Fi, version 1.0\".
# 3 Abbreviations
## 3.1 Abbreviations
For the purposes of the present document, the abbreviations given in TR 21.905
[1] and the following apply. An abbreviation defined in the present document
takes precedence over the definition of the same abbreviation, if any, in TR
21.905 [1].
AAA Authentication Authorization Answer
AAR Authentication Authorization Request
AKA Authentication and Key Agreement
APCO Additional Protocol Configuration Options
ASA Abort Session Answer
ASR Abort Session Request
EAP Extensible Authentication Protocol
EPC Evolved Packet Core Network
ePDG Evolved Packet Data Gateway
GW Gateway
IKEv2 Internet Key Exchange version 2
LMA Local Mobility Anchor
MCM Multi-Connection mode
NB-IFOM Network based IP flow mobility
PCO Protocol Configuration Options
PCRF Policy and Charging Rules Function
P-CSCF Proxy CSCF
P-GW PDN GW
PMIP Proxy Mobile IP
PPA Push-Profile-/Answer
PPR Push-Profile-Request
RAA Re-Authorization Answer
RAR Re-Authorization Request
SCM Single-Connection mode
S-CSCF Serving CSCF
VoLTE Voice over LTE
RCS Rich Communications Services
TSCM Transparent Single-Connection mode
TWAN Trusted WLAN Access Network
WLCP Wireless LAN control plane protocol
# 4 Existing P-CSCF restoration procedures with WLAN
## 4.1 Existing P-CSCF restoration procedures in 3GPP
This clause describes the existing Stage 3 P-CSCF restoration procedures when
using the EPC via WLAN to access IM CN subsystem.
a) In a first possibility, specified in Rel-11for WLAN, the UE may detect a
P-CSCF failure through a keep-alive mechanism or when there is no
responsiveness to a UE originating request. The UE then relies on the P-CSCF
discovery methods to get the addresses of the possible alternative P-CSCFs
that will replace the failed one.
3GPP TS 24.229 [6] clause R.2.2.1C describes the keep-alive based P-CSCF
restoration procedure in the following extract:
_A UE supporting the P-CSCF restoration procedure uses the keep-alive
procedures described in RFC 6223 [143]._
_If the P-CSCF fails to respond to keep-alive requests the UE shall acquire a
different P-CSCF address using any of the methods described in the subclause
R.2.2.1 and perform an initial registration as specified in subclause 5.1._
3GPP TS 24.229 [6] clause R.2.2.1 describes 4 methods for P-CSCF discovery
when using EPC via WLAN:
\- Method I: Use of DHCP;
\- Method II: Use of DNS;
\- Method III: List in P-CSCF management object;
\- Method IV: List of P-CSCF address(es) using signalling for access to the
EPC via WLAN. This Method was added in Rel13.
b) In a second possibility, specified in Rel-12, the PCRF based solution for
P-CSCF restoration, with its basic mechanism described in 3GPP TS 23.380 [2]
subclause 5.5.2, is applicable to 3GPP accesses and to WLANs. When the P-GW
receives a P-CSCF restoration indication, the P-GW releases the IMS PDN
connection resulting in its re-establishment and a new IMS registration by the
UE.
## 4.2 GSMA specifications related to P-CSCF restoration
GSMA PRD IR.51 [19] (February 2015) specifies a profile for IMS Voice, Video
and SMS over Wi-Fi. There is currently no statement regarding P-CSCF
restoration with WLAN accesses.
P-CSCF discovery is described in clause 4.9 in GSMA PRD IR.51 [19] as included
below, considering the inclusion of the approved CR 1007:
_4.9 P-CSCF Discovery_
_The UE and the network must support the procedures for P-CSCF discovery via
EPC via WLAN, as described in method IV of Annex R.2.2.1 of Release 13 3GPP TS
24.229 [5],_
_When establishing a PDN connection to the IMS well-known APN via WLAN, the UE
must discover the P-CSCF address(es) as described in method IV of Annex
R.2.2.1 of Release 13 3GPP TS 24.229 [5]. When an untrusted non-3GPP IP access
is used:_
_\- The UE must support and use the P-CSCF_IP6_ADDRESS attribute and the
P-CSCF_IP4_ADDRESS attribute as described in Release 13 3GPP TS 24.302 [6];
and_
_\- The network must support and use the P-CSCF_IP6_ADDRESS attribute, the
P-CSCF_IP4_ADDRESS attribute or both as described in Release 13 3GPP TS 24.302
[6]._
> _If P-CSCF address(es) were discovered using the method IV, the UE must use
> the P-CSCF address(es) discovered using the method IV as defined in section
> 5.1 and 3GPP TS 24.229 [5]._
## 4.3 Limitations and drawbacks
The hereafter limitations of the keep-alive mechanism are similar to those
identified in 3GPP TS 29.806 [7]:
\- A continuous extra signalling between the UEs and the P-CSCF, involving
resources in the WLAN access and in the CN;
\- A peak signalling when a P-CSCF failure occurs resulting in new IMS
registrations from UEs. A small signalling spread is observed as the IMS
registration signalling for a UE happens at the expiry of the keep-alive timer
which will be at a different time from an UE to another; nevertheless this
will depend of the duration of the keep-alive timer;
\- A limited loss of new terminating sessions when they occur between the
P-CSCF failure and the new IMS registration triggered by the expiration of the
keep-alive timer;
\- The keep-alive functionality is not supported in GSMA PRD IR.92 [18]; many
UEs may not support this mechanism, with the consequence to wait for the
expiry of the IMS registration timer to initiate a new registration.
The above limitations and drawbacks do not apply with the PCRF based solution
for P-CSCF restoration with WLAN. Nevertheless this solution implies a release
of the IMS PDN connection.
# 5 Objectives
The present document is expected to agree on a mechanism to enhance P-CSCF
restoration procedure for trusted and untrusted WLAN accesses,
Hereafter objectives are common with the enhanced P-CSCF restoration for 3GPP
access described in 3GPP TR 29.806 [7]:
**\- Avoid massive signalling over the core and radio networks.**
> This is of special importance when a P-CSCF handles a large number of UEs,
> since it may cause network overload.
**\- Improve reliability.**
> Avoid false positive or false negative detection scenarios, triggering
> P-CSCF restoration mechanism only when it is required.
**\- Do not impact existing GSMA compliant UE.**
> This objective assumes that such UEs support IMS service through trusted or
> untrusted WLAN accesses in compliance with GSMA recommendations. It is
> possible that some options of the enhanced P-CSCF restoration for WLAN have
> additional impacts to GSMA compliant UEs which should be minimized.
**\- Improve service availability.**
> Improve the perceived service availability for UEs.
  * Avoid losing new sessions establishments (e.g. voice, multimedia originating or terminating calls).
NOTE: There is some more flexibility for other services like SMS (it is
acceptable that the SMS may be delivered later) or for telepresence as an IMS
service it is acceptable to have some losses. In the same way, interruption of
IMS established sessions is accepted (according to 3GPP TR 23.820 [4] clause
4.3).
Other objectives are related to the existence of the enhanced P-CSCF
restoration mechanisms for 3GPP accesses described in 3GPP TS 23.380 [2] with
the HSS based and PCRF based solutions and are hereafter listed:
\- the HSS based solution and the PCRF based solution can, each, be used for
3GPP accesses and WLAN accesses, with, inside each solution, the maximum of
common parts. In particular the addition of the support of P-CSCF restoration
for WLAN access should not impact the IMS part of the existing HSS based and
PCRF based solutions.
\- the part specific to the WLAN access should be common to the HSS based and
the PCRF based solutions. Especially the UE should behave in the same way with
the HSS or the PCRF based solution for WLAN.
\- the part specific to the WLAN access, as for 3GPP accesses, should have a
basic mechanism having no impact on the WLAN involved interfaces and on the
UE. Optional improvements to the basic mechanism should minimize the protocol
impacts on the involved interfaces and on the UE and reuse the maximum of
existing procedures over these interfaces.
# 6 Solution alternatives
## 6.1 Introduction
The clause 6 and its subclauses describe various solutions to support P-CSCF
restoration with WLAN.
The subclause 6.2 describes a basic mechanism for the HSS based solution. A
basic mechanism for the PCRF based solution applicable for WLAN is already
specified in 3GPP TS 23.380 [2] subclause 5.2.2. The basic mechanism relies on
the release of the IMS PDN connection followed by its re-establishment to
trigger a new IMS registration by the UE.
The subclause 6.3 describes extended mechanisms to avoid the release of the
IMS PDN connection and to trigger a new IMS registration by the UE through
additional signaling over the IMS PDN connection. Trusted WLAN and untrusted
WLAN cases are analyzed separately, but with the objective of maximizing
common parts. The extended mechanisms between the UE and the P-GW are also
common to the HSS based and to the PCRF based solution, in order to not
introduce differences from the UE view.
## 6.2 Basic mechanism solution
### 6.2.1 Basic mechanism for HSS based solution
#### 6.2.1.1 Overview and principles
This solution extends the HSS based enhanced P-CSCF restoration mechanism
specified for 3GPP accesses (see 3GPP TS 23.380 [2] subclause 5.4.2), to
trusted and/or untrusted WLAN accesses and is based on the same principles.
If the UE is registered to a WLAN access and has an IMS APN subscription
permitting non-3GGP accesses, the HSS forwards a P-CSCF restoration indication
to the 3GPP AAA Server which transfers it to the P-GW. The P-GW initiates the
release of the IMS PDN connection towards the UE via the WLAN access.
Following the release of the IMS PDN connection, the UE will re-establish a
new IMS PDN connection and perform a new P-CSCF discovery (according to
existing procedures), and then register again to IMS.
#### 6.2.1.2 Description
This solution is described in figure 6.2.1.2-1.
Figure 6.2.1.2-1: HSS Based P-CSCF restoration with non-3GPP access
For a WLAN access, the basic mechanism to request the UE to do a new IMS
registration is to request a release of the IMS PDN connection over the
interface (S2a or S2b) through which the UE is connected. The solution avoids
disconnecting other PDN connections than the IMS PDN one.
NOTE 1: the UE may establish multiple PDN connections via untrusted WLAN and
trusted WLAN in multi-connection mode; while there is a single SWm Diameter
session per PDN connection, there is a unique STa Diameter session per UE.
Steps 1 to 5 are common with the steps 1 to 4 of 3GPP TS 23.380 [2] subclause
5.4.2.1.
6\. If the user has a non-3GPP access subscription with an IMS APN
configuration and if the user has a non-3GPP access registration in the HSS
for the WLAN access, the HSS forwards a P-CSCF restoration indication to the
3GPP AAA Server over SWx.
An existing command pair should be reused to convey this indication over SWx.
Push-Profile-Request/Answer (PPR/PPA) is proposed with a new flag in the PPR-
Flags AVP.
If the user has also an IMS APN configuration subscription for a 3GPP access
and is registered to a 3GPP access, the procedure described in 3GPP TS 23.380
[2] subclause 5.4.2.1 from step 5 onwards applies in addition. As the HSS is
not informed of the access the UE is actually using for its IMS PDN
connection, this may result in a procedure to the 3GPP AAA Server without a
P-CSCF restoration procedure being triggered via the WLAN access if the IMS
PDN connection is using a 3GPP access.
Steps 7a, 8a and 9a describe the variant \"a\" where the P-GW is triggered via
S6b:
7a. If the 3GPP AAA Server has the information that an IMS PDN connection is
established via a WLAN access for the user, the 3GPP AAA Server sends a P-CSCF
restoration indication to the P-GW over S6b, via a 3GPP AAA Proxy over SWd if
a VPLMN is involved, to proceed to the restoration of this IMS PDN connection.
NOTE 2: GSMA PRD IR.6 [10] clause 2.3 recommends one single IMS APN in case of
simultaneous usage of VoLTE and RCS. If there were two PDN connections with
the IMS APN, the reception of the P-CSCF restoration indication would result
in the release of the two IMS PDN connections although only the PDN connection
related to the failed P-CSCF should be released.
An existing command pair should be reused to convey this indication over S6b
and SWd. It is proposed to refer to the Service Authorization Information
Update Procedures described in 3GPP TS 29.273 [15] subclause 9.1.2.5. The 3GPP
AAA Server sends a Re-authorization Request (RAR) command with a new RAR flag
indicating a P-CSCF restoration. The P-GW does not sent back an AA-Request
(AAR) command to the 3GPP AAA server as it will send a Session Termination
Request (STR) in step 9a.
About using a new AVP or a flag to convey the P-CSCF restoration indication, a
flag in the RAR-Flags AVP is preferred as a normal use of such an AVP to
convey indications.
8a. To proceed with the release of the IMS PDN connection:
\- For a TWAN, the P-GW, over S2a, initiates a Delete Bearer Request procedure
(GTP) or a Proxy Mobile IPv6 LMA Initiated PDN Connection Deletion procedure
(PMIP) to the TWAN which then initiates:
\- a WLCP PDN Disconnection to the UE in multi connection mode;
\- a TWAN specific resource release procedure, in single connection mode or
transparent single connection mode;
\- For an untrusted WLAN, over S2b, the P-GW initiates a Delete Bearer Request
procedure (GTP) or aProxy Mobile IPv6 LMA Initiated PDN Connection Deletion
procedure (PMIP) to the ePDG which then initiates the release of the
associated IKEv2 tunnel.
This procedure does not explicitly request the UE to re-establish the IMS PDN
connection and do a new IMS registration. It is assumed that an IMS compliant
UE shall re-attempt to obtain IMS service soon after detached from the IMS
service. A cause \"reactivation requested\" (as supported over 3GPP accesses)
could possibly be added over GTP-C based S2a and WLCP.
9a. The P-GW indicates the termination of the associated session to the 3GPP
AAA Server by sending a Session Termination Request.
Steps 7b and 8b describe the variant \"b\" where the ePDG or the TWAN is
triggered over SWm or STa:
7b. If the 3GPP AAA Server has the information that an IMS PDN connection is
established for the user, the 3GPP AAA Server sends an indication to the ePDG
over SWm or to the TWAN over STa, via a 3GPP AAA Proxy over SWd if a VPLMN is
involved, to proceed to the release of the IMS PDN connection.
An existing command pair should be reused to convey this indication over SWm
or STa:
\- Re-Auth-Request/Answer (RAR/RAA) with a new AVP or a flag is proposed to be
used over STa to instruct the TWAN to initiate the release of the IMS PDN
connection. An Abort Session Request/Answer (ASR/ASA) cannot be used for that
purpose over STa as this would lead to tear down all the PDN connections of
the UE established via the TWAN;
\- for SWm,, an Abort Session Request/Answer (ASR/ASA) is proposed.
8b. The ePDG over S2b or the TWAN over S2a initiates the IMS PDN disconnection
towards the UE and the P-GW, using existing procedures.
Step10 is common to variants \"a\" and \"b\":
10\. As a result of the release of the IMS PDN connection, the UE re-
establishes the IMS PDN connection, and also performs a new P-CSCF discovery
(as the IMS PDN connection was lost). After discovering a new P-CSCF, the UE
will perform a new initial IMS registration towards IMS.
#### 6.2.1.3 Evaluation
Variant \"a\" has the following advantages and drawbacks:
\- pros:
a1) variant \"a\" has a common part (step 8a) with the PCRF based solution for
WLAN for S2a and S2b as described in 3GPP TS 23.380 [2] subclause 5.5.2;
a2) variant \"a\" allows to support the P-CSCF restoration extension for WLAN
over S2a and S2b, described in subclause 6.3, avoiding to release the IMS PDN
connection;
a3) variant \"a\" uses the same procedure between the 3GPP AAA Server and the
P-GW over S6b for trusted and untrusted WLAN;
\- cons:
a4) if the PGW does not support the new S6b enhancements (i.e. new P-CSCF
restoration indication), the IMS PDN connection will not be torn down and the
UE will not perform a new IMS registration. This means that signalling will
have been triggered uselessly from the S-CSCF to the HSS, 3GPP AAA Server (and
possibly Proxy) and the PGW, and may be repeated again by the S-CSCF e.g. at a
subsequent SIP INVITE targeting the user;
Variant \"b\" has the following advantages and drawbacks:
\- pros:
b1) the variant \"b\", by addressing network elements of the non-3GPP access,
has homogeneity with the HSS based solution for 3GPP access using the MME/SGSN
to release the IMS PDN connection;
\- cons:
b2) in the case of STa, if the TWAN does not support the new STa enhancements
(i.e. new indication to release the IMS PDN connection), the IMS PDN
connection will not be torn down and the UE will not perform a new IMS
registration. This means that signalling will have been triggered uselessly
from the S-CSCF to the HSS, 3GPP AAA Server (and possibly Proxy) and the
non-3GPP access network, and may be repeated again by the S-CSCF e.g. at a
subsequent SIP INVITE targeting the user;
b3) in the case of STa, the TWAN may be not under the responsibility of the
HPLMN operator or of the VPLMN operator, which would need additional
agreements.
Factors a2) and a3) are considered as key aspects of the solution. So from
these observations, it is preferred to rely on the variant \"a\".
## 6.3 Extended mechanism solutions
### 6.3.1 Solutions with a trusted WLAN
#### 6.3.1.1 Solution T1 -- PCO Based solution
##### 6.3.1.1.1 Overview and principles
The basic mechanism for P-CSCF restoration over WLAN is optionally extended
over TWAN in order to avoid the need to deactivate and reactivate the IMS PDN
connection.
This P-CSCF restoration extension for a TWAN is based on the possibility for
the P-GW to know whether or not the UE supports this P-CSCF restoration
extension for a TWAN, which is described in subclause 6.3.1.1.3, and that the
TWAN supports a new WLCP PDN connection modification procedure.
When the P-GW receives a P-CSCF restoration indication and if the P-CSCF
restoration extension for TWAN is supported by the UE, the TWAN supports the
new WLCP PDN connection modification procedure, and the UE is using the multi-
connection mode, the P-GW sends the updated list of the addresses of available
P-CSCFs as PCO parameters towards to the UE via the TWAN; this will trigger
the UE to initiate a new IMS registration towards an available P-CSCF.
Otherwise, the PGW initiates the release of the IMS PDN connection and
proceeds with the P-CSCF basic restoration mechanism.
##### 6.3.1.1.2 Description
The P-CSCF restoration extension for TWAN procedure is described in
figure.6.3.1.1.2-1. If the UE does not support this extension, or if the TWAN
does not support the new WLCP PDN connection modification procedure, or if the
UE is not using the multi-connection mode, the P-GW initiates the release of
the IMS PDN disconnection (see basic P-CSCF restoration mechanism).
Figure 6.3.1.1.2-1: UE supporting the PCO based P-CSCF restoration extension
for TWAN -- GTP-based S2a
For the HSS based solution, steps from 1 to 7 are the same as those explained
in subclause 6.2.1.2 for the P-CSCF restoration basic mechanism for WLAN with
the HSS based solution**.** In step 7, the 3GPP AAA Server, when receiving a
P-CSCF restoration indication from the HSS, transfers this indication to the
P-GW.
For the PCRF based solution, steps from 1 to 7 are the same as those explained
in 3GPP TS 23.380 [2] subclause 5.3.2 for the P-CSCF restoration basic
mechanism**.** In step 7, the PCRF transfers the P-CSCF restoration indication
to the P-GW.
Hereafter steps 8 to 11 are common to the HSS based solution and to the PCRF
based solution:
8\. If the P-GW has previously received the indication that the UE supports
the PCO based P-CSCF Restoration extension for TWAN and that the TWAN supports
the new WLCP PDN connection modification procedure and that the UE is
accessing the TWAN in multi-connection mode, the P-GW sends an Update Bearer
Request to the TWAN. This message includes a PCO IE with a list of available
P-CSCF addresses, similar to existing P-CSCF Restoration procedures. The
procedure continues with step 9.
If the UE does not support the PCO based P-CSCF Restoration extension for
TWAN, or if the TWAN does not support the new WLCP PDN connection modification
procedure, or if the UE is not accessing the TWAN in multi-connection mode,
the P-GW releases the IMS PDN connection by sending a Delete Bearer Request to
the TWAN (not described in the figure) and proceed with the P-CSCF restoration
basic mechanism for WLAN.
9\. The TWAN initiates a WLCP PDN connection modification request procedure
towards the UE to transparently forward the PCO IE received from the P-GW with
the list of available P-CSCF addresses.
This procedure is a new procedure to be specified in the WLCP protocol
described in 3GPP TS 24.244 [5] between the UE and the TWAN, and is similar to
the Modify EPS Bearer Context Request for 3GPP access. This procedure is an
extension to the existing PDN GW Initiated Bearer Modification procedure
specified in 3GPP TS 23.402 [3] subclause 16.6.1 (SA2 will need to be
informed).
10\. The UE answers to the TWAN which then answers to the P-GW.
11\. As per existing P-CSCF Restoration procedures described in 3GPP TS 24.229
[6], the UE selects one available P-CSCF from the received list and proceeds
with an IMS registration.
Per existing specifications, the TWAN already reports to the P-GW, during the
PDN connection establishment, whether the UE is accessing the TWAN in multi-
connection mode, single-connection mode or transparent single-connection mode.
The TWAN needs to report its support of the new WLCP PDN connection
modification procedure to the P-GW at the establishment of the IMS PDN
connection with an additional indicator. If the TWAN has not reported support
of this procedure or if the UE is not accessing the TWAN in multi-connection
mode, the P-GW restores the IMS PDN connection according to the basic P-CSCF
restoration mechanism.
The same call flow can apply to PMIP-based S2a, whereby, in step 8, the P-GW
initiates an LMA Initiated Update Notification procedure to provide the TWAN
with the available P-CSCF addresses.
##### 6.3.1.1.3 Method to indicate the UE support for PCO based P-CSCF
Restoration for TWAN to P-GW
The P-CSCF restoration extension for TWAN described in 6.3.1.1.2 is based on
the possibility for the P-GW to identify whether or not the UE supports the
PCO based P-CSCF Restoration procedures for TWAN.
The proposed method is that the UE indicates this UE capability to the P-GW at
the establishment of the IMS PDN connection, in a new PCO parameter.
This method has no impact on the TWAN as the PCO IE is transparently
transferred through the TWAN.
The capability to support the P-CSCF restoration extension for TWAN is a
different capability from the capability to support the P-CSCF restoration
extension over 3GPP access. It is also necessary to differentiate the
capability to support P-CSCF restoration for TWAN versus for untrusted WLAN
(as they imply different UE protocol impacts). The UE shall provide the P-GW
with its capability, if supported, regarding the current access it uses.
##### 6.3.1.1.4 Discussion about single and multi connection modes
The support of the extension, in particular, requires:
\- the UE to indicate the P-GW its UE capability to support the P-CSCF
restoration extension for TWAN;
\- the P-GW to indicate to the UE the list of available P-CSCFs addresses.
The solution proposes to use the transport of PCO information as defined over
S2a between the PGW and the TWAN, and within the WLCP protocol between the
TWAN and the UE. This way to proceed is already used for P-CSCF discovery;
this minimizes the impact of the support of the P-CSCF restoration extension
for TWAN.
The support of the WLCP protocol is only specified for the Multi-Connection
mode (MCM).
The Single-Connection mode (SCM) does not support means to exchange control
information between the UE and the P-GW, apart via EAP extensions between the
UE and the 3GPP AAA Server during the initial authentication/ authorization
procedure and STa extensions between the 3GPP AAA Server and the TWAN.
The Transparent Single-Connection mode (TSCM) does not support exchange of
control information between the UE and the P-GW.
So it is proposed to limit the applicability of the extension to the Multi-
Connection mode. Only the basic mechanism will be supported for SCM and TSCM.
##### 6.3.1.1.5 Roaming cases
The solution can be used in the VPLMN for roaming users with Local Breakout
without any further impact to the P-CSCF restoration basic mechanism applied
to WLAN for both HSS based and PCRF based solutions.
### 6.3.2 Solutions with an untrusted WLAN
#### 6.3.2.1 Solution U1 -- P-CSCF restoration extension for untrusted WLAN
##### 6.3.2.1.1 Overview and principles
The basic mechanism for P-CSCF restoration over WLAN is optionally extended
over untrusted WLAN in order to avoid the need to deactivate and reactivate
the IMS PDN connection.
This P-CSCF restoration extension for an untrusted WLAN is based on the
possibility for the P-GW to know whether or not the UE and ePDG support this
P-CSCF restoration extension for an untrusted WLAN, which is described in
subclause 6.3.2.1.3.
When the P-GW receives a P-CSCF restoration indication and if the P-CSCF
restoration extension for an untrusted WLAN is supported by the UE and the
ePDG, the P-GW sends the updated list of the addresses of available P-CSCFs
towards the UE via the ePDG; this will trigger the UE to initiate a new IMS
registration towards an available P-CSCF.
##### 6.3.2.1.2 Description
The P-CSCF restoration extension for an untrusted WLAN procedure is described
in figure 6.3.2.1.2-1. If the UE or the ePDG does not support this extension,
the P-GW initiates the release of the IMS PDN disconnection and proceeds with
the basic P-CSCF restoration mechanism applied to WLAN.
Figure 6.3.2.1.2-1: UE supporting the P-CSCF restoration extension over
untrusted WLAN - GTP based S2b
For the HSS based solution, steps from 1 to 7 are the same as those explained
in subclause 6.2.1.2 for the P-CSCF restoration basic mechanism for WLAN with
the HSS based solution**.** In step 7, the 3GPP AAA Server, when receiving a
P-CSCF restoration indication from the HSS, transfers this indication to the
P-GW.
For the PCRF based solution, steps from 1 to 7 are the same as those explained
in 3GPP TS 23.380 [2] subclause 5.3.2 for the P-CSCF restoration basic
mechanism**.** In step 7, the PCRF transfers the P-CSCF restoration indication
to the P-GW.
Hereafter steps 8 to 11 are common to the HSS based solution and to the PCRF
based solution.
8 If the PGW has previously received the indication that the UE and ePDG
support the P-CSCF Restoration extension for untrusted WLAN, the P-GW sends an
Update Bearer Request to the ePDG. This message includes a list of available
P-CSCF addresses, as per existing P-CSCF Restoration procedures. The procedure
continues with step 9.
If the UE or the ePDG does not support the P-CSCF Restoration extension for
untrusted WLAN, the P-GW releases the IMS PDN connection by sending a Delete
Bearer Request to the ePDG (not described in the figure) and proceeds with the
P-CSCF restoration basic mechanism applied to WLAN.
9 The ePDG initiates an IKEv2 informational exchange procedure towards the UE
to forward the list of available P-CSCF addresses received in the PCO IE from
the P-GW.
This IKEv2 procedure is specified in IETF RFC 5996 [8]. This procedure is an
extension to the existing PDN GW Initiated Bearer Modification procedure
specified in 3GPP TS 23.402 [3] subclause 7.11..1 (SA2 will need to be
informed).
In addition, there is the need to define the coding of the list of available
P-CSCFs addresses (Configuration attributes) which is addressed in 6.3.2.1.4
subclause.
10 The UE answers to the ePDG which then answers to the P-GW.
11 As per existing P-CSCF Restoration procedures described in 3GPP TS 24.229
[6], the UE selects one available P-CSCF from the received list and proceeds
with an IMS registration.
To apply the step 9, the support of the IKEv2 informational exchange procedure
with a Configuration Payload is not sufficient as the ePDG has to also do the
mapping between this payload and the PCO payload over S2b containing P-CSCF
restoration information, so the support of this capability by the ePDG is to
be indicated to the PGW at the IMS PDN connection. This is addressed in
subclause 6.3.2.1.3.
The same call flow can apply to PMIP-based S2b, whereby, in step 8, the P-GW
initiates an LMA Initiated Update Notification procedure to provide the ePDG
with the available P-CSCF addresses.
##### 6.3.2.1.3 Method to indicate the UE support of the P-CSCF restoration to
P-GW
The P-CSCF restoration extension over untrusted WLAN described in 6.3.2.1.3 is
based on the possibility for the P-GW to identify whether or not the UE
supports the PCO based P-CSCF Restoration procedures over untrusted WLAN.
The proposed method is that the UE indicates this UE capability in the
configuration payload of the IKEv2 message to the ePDG establishing the IMS
PDN connection. Then ePDG forwards this capability in a new PCO parameter to
the P-GW over S2b.
Receipt by the PGW of the UE capability indicating the support of P-CSCF
restoration in the APCO IE at PDN connection is also an indication that the
ePDG and the UE support the IKEv2 procedures with the corresponding mapping of
P-CSCF restoration information (i.e. UE capability and list(s) of available
P-CSCF addresses). i.e. there is no need to introduce a new additional
indication for ePDG support of this procedure.
The capability to support the P-CSCF restoration extension for untrusted WLAN
is a different capability from the capability to support the P-CSCF
restoration extension over 3GPP access. It is also necessary to differentiate
the capability to support P-CSCF restoration extension for TWAN vs. for
untrusted WLAN (as they imply different UE protocol impacts). The UE shall
provide the P-GW with its capability, if supported, regarding the current
access it uses.
The same method can apply to PMIP-based S2b at IMS PDN connection.
##### 6.3.2.1.4 Coding between the ePDG and the UE
As indicated in step 9 of subclause 6.3.2.1.2, and in subclause 6.3.2.1.3,
between the ePDG and the UE, IKEv2 messages are used with a configuration
payload containing P-CSCF restoration information ( i.e. the UE capability
indicating the support of P-CSCF restoration extension for untrusted WLAN and
list(s) of P-CSCF addresses).
The encoding of P-CSCF restoration information within the Configuration
Payload in IKEv2 (see IETF RFC 7296 [8]) needs to be specified.
The IETF Draft draft-gundavelli-ipsecme-3gpp-ims-options-04 [9] specifies
Configuration Attributes defining lists of P-CSCF addresses to be used for
P-CSCF discovery. It is relevant to use the same Configuration Attributes for
lists of P-CSCF addresses used for P-CSCF restoration and to convey them in
IKEv2 informational exchange procedures (see IETF RFC 7296 [8]). Nevertheless
the IETF Draft draft-gundavelli-ipsecme-3gpp-ims-options-04 [9] does not
specify the Configuration attributes for the other 3GPP parameters used for
P-CSCF restoration (i.e. UE capability for P-CSCF restoration extension for
untrusted WLAN).
There are two possible solutions to define the new IKEv2 Configuration
Attribute:
a) Define a new IKEv2 configuration attribute, P-CSCF_RESELECTION_SUPPORT
Configuration Attribute, to be used for carrying the UE capability indication
of the support of P-CSCF restoration specifically.
b) Define a new IKEv2 configuration attribute, 3GPP-IE Configuration
Attribute, which will be a generic container to carry new 3GPP parameters,
initially the UE capability one and then others expected in upcoming Rel-13 or
future. 3GPP parameters already conveyed via existing IETF extensions (e.g.
P-CSCF addresses) shall not be redefined using this generic container.
NOTE: the need to transfer new 3GPP parameters over IKEv2 is already
anticipated for several Rel-13 features: P-CSCF restoration, NB-IFOM and
Support of Emergency sessions over WLAN.
It is proposed to select the solution a) with the new IKEv2
P-CSCF_RESELECTION_SUPPORT Configuration Attribute.
##### 6.3.2.1.5 Roaming cases
The solution can be used in the VPLMN for roaming users with Local Breakout
without any further impact to the P-CSCF restoration basic mechanism applied
to WLAN for both HSS based and PCRF based solutions.
## 6.4 Supported features and capabilities
### 6.4.1 Introduction
The P-CSCF restoration mechanism for WLAN, compared to the 3GPP accesses,
requires new functionalities from the HSS, the 3GPP AAA Server, the PGW for
the basic mechanism and in addition from the TWAN, the ePDG and the UE for the
extended mechanism.
The support or not of the additional functionalities by the involved entities
has consequences on the applicability of the P-CSCF restoration mechanism,
e.g. between the use of the basic mechanism or the extended mechanism. In
particular roaming situations may change the supported features. The
advertisement of the related support over the interfaces is also addressed.
### 6.4.2 Feature support in the HSS and S-CSCF
The S-CSCF behaviour when triggering the HSS with a P-CSCF restoration
indication is independent of the 3GPP access or of the WLAN access that the UE
is using. No modification is foreseen to the signalling over the Cx interface
and on the S-CSCF behaviour.
If the HSS does not support P-CSCF restoration for WLAN, it behaves as a
Rel-12 HSS for P-CSCF restoration over a 3GPP access.
If the HSS supports P-CSCF restoration for WLAN, it checks if the user is
registered on a 3GPP AAA Server and
\- if the 3GPP AAA Server supports the P-CSCF restoration mechanism for WLAN,
the HSS behaves as described in step 6 of subclause 6.2.1.2;
\- if the 3GPP AAA Server does not support it, and if no other serving node
(MME/SGSN) on which the UE is registered supports P-CSCF restoration, the HSS
sends the DIAMETER_ERROR_SERVING_NODE_FEATURE_UNSUPPORTED error to the S-CSCF
as for Rel-12.
It is assumed and recommended that a HSS supporting the P-CSCF restoration
mechanism for WLAN supports the P-CSCF restoration mechanism for 3GPP access.
### 6.4.3 Feature support in the 3GPP AAA Server
The 3GPP AAA Server informs the HSS, at the user registration over SWx, if it
supports the P-CSCF restoration feature through a supported feature
indication, so to allow the HSS to correctly react to a P-CSCF restoration
indication received from the S-CSCF. Nevertheless this feature support does
not give an indication about the support of the P-CSCF restoration feature by
the PGW handling the IMS PDN connection.
NOTE: The user registration over SWx can result from the establishment of
another PDN connection via a different PGW, before the user sets up the IMS
PDN connexion. So, at the user registration, the 3GPP AAA Server does not know
if the PGW that will later handle the IMS PDN connection supports the P-CSCF
restoration feature.
In the hereafter paragraphs, it is assumed that the 3GPP AAA Server supports
the P-CSCF restoration mechanism.
When the PGW informs the 3GPP AAA Server over S6b that an IMS PDN connection
is established, the PGW also advertises the 3GPP AAA Server if the PGW
supports the P-CSF restoration mechanism for WLAN. The 3GPP AAA Server stores
this information.
When the 3GPP AAA Server receives a P-CSCF restoration indication from the
HSS:
\- if an IMS PDN connection is established and if the PGW supports the P-CSCF
restoration mechanism for WLAN, the 3GPP AAA Server behaves as described in
step 7a of subclause 6.2.1.2;
\- if an IMS PDN connection is established and if the PGW does not support the
P-CSCF restoration mechanism for WLAN, the 3GPP AAA Server ignores the P-CSCF
restoration indication received from the HSS;
\- if no IMS PDN connection is established, the 3GPP AAA Server ignores the
P-CSCF restoration indication received from the HSS.
### 6.4.4 Feature support in the PGW
A PGW supporting the basic P-CSCF restoration mechanism for both trusted and
untrusted WLANs indicates this support to the 3GGP AAA Server in the
Authorization Request message sent over S6b at the creation of the IMS PDN
connection.
The support of the extended mechanism by the PGW requires the support of the
basic mechanism. The extended mechanism is optionally supported by the PGW for
TWAN or for untrusted WLAN or for both,
### 6.4.5 Feature support in the TWAN
The TWAN advertises the support of the new WLCP PDN connection modification
request procedure over S2a at establishment (or handover) of the IMS PDN
connection with an additional indicator as described in subclause 6.3.1.1.2.
This is to allow the PGW to use the extended P-CSCF restoration mechanism on
this TWAN.
### 6.4.6 Feature support in the ePDG
As described in subclause 6.3.2.1.3 the ePDG indicates its support of the
extended P-CSCF restoration mechanism over S2b and over IKEv2 when sending the
UE capability in the APCO IE to the PGW at the IMS PDN connection. No new
indication is required.
### 6.4.7 Capability support in the UE
A UE may support the extended P-CSCF restoration mechanism for the 3GPP access
(e.g. a Rel-12 UE), the TWAN and/or the untrusted WLAN.
In consequence, a capability is defined for the support of the extended P-CSCF
restoration mechanism for each type of access, meaning three capabilities with
all the possible combinations.
During the set up (or handover) of the IMS PDN connection over a given type of
access, the UE announces its capability over this type of access and has no
need to announce its capabilities for the other types of accesses.
# 7 Conclusions and recommendations
It is agreed to standardize in 3GPP Rel-13 the P-CSCF restoration mechanisms
for WLANs on the basis of:
\- the solution described in subclause 6.2.1 regarding the basic mechanism for
the HSS based solution;
\- the variant \"a\" is recommended as according to subclause 6.2.1.3;
\- the solution T1 described in subclause 6.3.1.1 regarding the extended
mechanism for trusted WLAN which is applicable to both the HSS based and the
PCRF based solutions;
\- the solution U1 described in subclause 6.3.2.1 regarding the extended
mechanism for untrusted WLAN which is applicable to both the HSS based and the
PCRF based solutions.
Corresponding text of these subclauses will be the basis for the normative
text to the 3GPP TS 23.380 [2]. The subclause 6.4 text regarding the supported
features and capabilities in the involved functional entities will also be the
basis of a corresponding text in 3GPP TS 23.380 [2].
Table 7-1 summarizes the list of impacts and affected specifications.
Table 7-1: Summary of impacts to existing 3GPP specifications for the P-CSCF
restoration mechanism for WLANs
+----------------------------------+----------------------------------+ | Impacts | Impacted Specification | +----------------------------------+----------------------------------+ | Basic P-CSCF restoration | 3GPP TS 23.380 [2] | | mechanism for WLAN for HSS based | | | solution. | | | | | | Extended P-CSCF restoration | | | mechanism for trusted and | | | untrusted WLANs, applicable to | | | both HSS and PCRF based | | | solutions. | | +----------------------------------+----------------------------------+ | Transfer of P-CSCF restoration | 3GPP TS 29.273 [15] | | indication over SWx | | | | | | Supported Features over SWx | | | | | | Transfer of P-CSCF restoration | | | indication over S6b | | | | | | Supported Features over S6b | | +----------------------------------+----------------------------------+ | Basic mechanism handling over | 3GPP TS 29.274 [16] and | | S2a | 3GPP TS 29.275 [17] | | | | | Basic mechanism handling over | | | S2b | | | | | | P-CSCF restoration extended | | | mechanism over S2a | | | | | | P-CSCF restoration extended | | | mechanism over S2b | | +----------------------------------+----------------------------------+ | New WLCP PDN connection | 3GPP TS 24.244 [14] | | modification request procedure | | | to support transport of the | | | P-CSCF addresses over an | | | existing PDN connection | | +----------------------------------+----------------------------------+ | UE indication of the support of | | | the P-CSCF restoration extended | | | mechanism with trusted WLAN. | | +----------------------------------+----------------------------------+ | Indication of UE capability for | 3GPP TS 24.008 [12] | | the extended P-CSCF restoration | | | mechanism for trusted WLAN | | | access | | +----------------------------------+----------------------------------+ | Indication of UE capability for | 3GPP TS 24.302 [13] | | extended P-CSCF restoration | | | mechanism for untrusted WLAN | | | access | | +----------------------------------+----------------------------------+ | Support of 3GPP Information | IETF | | elements in Configuration | | | Payload over IKEv2 to transfer | | | the UE capability | | +----------------------------------+----------------------------------+ | Addition of support of P-CSCF | 3GPP TS 24.229 [6] | | restoration for WLAN accesses | | +----------------------------------+----------------------------------+ | Storage of UE and TWAN/ePDG | 3GPP TS 23.008 [11] | | support of the extended P-CSCF | | | restoration mechanism for WLAN | | +----------------------------------+----------------------------------+
#
# Foreword
This Technical Specification (TS) was been produced by ETSI Technical
Committee Telecommunications and Internet converged Services and Protocols for
Advanced Networking (TISPAN) and originally published as ETSI TS 183 029 [11].
It was transferred to the 3rd Generation Partnership Project (3GPP) in January
2008.
The contents of the present document are subject to continuing work within the
TSG and may change following formal TSG approval. Should the TSG modify the
contents of the present document, it will be re-released by the TSG with an
identifying change of release date and an increase in version number as
follows:
Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical
enhancements, corrections, updates, etc.
z the third digit is incremented when editorial only changes have been
incorporated in the document.
# 1 Scope
The present document specifies the stage three (protocol description) of the
Explicit Communication transfer (ECT) supplementary service, based on stage
one and two of the ISDN ECT supplementary service. It provides the protocol
details in the IP Multimedia (IM) Core Network (CN) subsystem based on the
Session Initiation Protocol (SIP) and the Session Description Protocol (SDP).
The present document is applicable to User Equipment (UE) and Application
Servers (AS) which are intended to support the ECT supplementary service.
# 2 References
The following documents contain provisions which, through reference in this
text, constitute provisions of the present document.
  * References are either specific (identified by date of publication, > edition number, version number, etc.) or nonâ€‘specific.
  * For a specific reference, subsequent revisions do not apply.
  * For a non-specific reference, the latest version applies. In the > case of a reference to a 3GPP document (including a GSM document), > a non-specific reference implicitly refers to the latest version > of that document _in the same Release as the present document_.
[1] 3GPP TS 24.229: \"Internet Protocol (IP) multimedia call control protocol
based on Session Initiation Protocol (SIP) and Session Description Protocol
(SDP); Stage 3\".
[2] IETF RFC 3515: \"The Session Initiation Protocol (SIP) Refer Method\".
[3] IETF RFC 3892: \"The Session Initiation Protocol (SIP) Referred-By
Mechanism\".
[4] IETF RFC 3891: \"The Session Initiation Protocol (SIP) \"Replaces\"
Header\".
[5] Void.
[6] IETF RFC 3261: \"SIP: Session Initiation Protocol\".
[7] 3GPP TS 29.228: \"IP Multimedia (IM) Subsystem Cx and Dx Interfaces;
Signalling flows and message contents\".
[7A] 3GPP TS 29.229: \"Cx and Dx interfaces based on the Diameter protocol;
Protocol details\".
[8] 3GPP TS 24.610: \"Communication HOLD (HOLD) using IP Multimedia (IM) Core
Network (CN) subsystem; Protocol specification\".
[9] 3GPP TS 24.605: \"Conference (CONF) using IP Multimedia (IM) Core Network
(CN) subsystem; Protocol specification\".
[10] 3GPP TS 24.628: \"Common Basic Communication procedures using IP
Multimedia (IM) Core Network (CN) subsystem; Protocol specification\".
[11] ETSI TS 183 029 V2.5.0: \"Telecommunications and Internet converged
Services and Protocols for Advanced Networking (TISPAN); PSTN/ISDN simulation
services: Explicit Communication Transfer (ECT); Protocol specification\".
[12] 3GPP TS 24.315: \"IP Multimedia Subsystem (IMS) Operator Determined
Barring (ODB); Stage 3\".
[13] IETF RFC 7090 (April 2014): \"Public Safety Answering Point (PSAP)
Callback\".
[14] IETF RFC 6665: \"SIP-Specific Event Notification\".
[15] IETF RFC 4538: \"Request Authorization through Dialog Identification in
the Session Initiation Protocol (SIP)\".
[16] IETF RFC 7647 (September 2015): \"Clarifications for the Use of REFER
with RFC6665\".
# 3 Definitions and abbreviations
## 3.1 Definitions
For the purposes of the present document, the following terms and definitions
apply:
**ECT session identifier URI:** PSI created and inserted by an ECT AS that
resolves to the AS itself
NOTE 1: If this URI contains correlation information it has to be constructed
in such a way that it does not reveal identity information about any party
involved in the transfer.
**transferee:** party being transferred to the transfer target
**transferor:** party initiating the transfer
**transfer target:** party that the existing communication is transferred to
NOTE 2: After transfer the transferee and the transfer target are in
communication with each other.
## 3.2 Abbreviations
For the purposes of the present document, the following abbreviations apply:
ACR **Anonymous Communication Rejection**
**AS** SIP Application Server
**CDIV** Communication DIVersion
**CONF** CONFerence
**CSCF** Call Session Control Function
ECT **Explicit Communication Transfer**
GRUU Globally Routable User agent URI
HOLD communication HOLD
**IETF Internet Engineering Task Force**
IFC **Initial Filter Criteria**
**ISDN** Integrated Services Digital Network
MCID Malicious Call IDentification
**MGCF** Media Gateway Control Function
OCB **Outgoing Communication Barring**
**ODB Operator Determined Barring**
OIP Originating Identification Presentation
OIR Originating Identification presentation Restriction
**PSAP Public Safety Answering Point**
**PSTN** Public Switch Telephone Network
**S-CSCF** Serving-CSCF
**SIP** Session Initiation Protocol
TIP Terminating Identification Presentation
TIR Terminating Identification presentation Restriction
UE User Equipment
# 4 Explicit Communication transfer (ECT)
## 4.1 Introduction
The service provides a party involved in a communication to transfer that
communication to a third party.
Procedures for the ECT AS regarding operator determined barring (ODB) are
defined in 3GPP TS 24.315 [12].
## 4.2 Description
### 4.2.1 General description
The explicit communication transfer (ECT) service provides a party involved in
a communication to transfer that communication to a third party.
There are three actors active in a transfer, they are acting in the following
roles:
**transferor:** the party that initiates the transfer of the active
communication that it has with the transferee;
**transferee:** the party which stays in the communication which is
transferred;
**transfer target:** the party which the communication is transferred to and
which replaces the transferor in the communication.
There are two initial situations in which transfer shall be possible:
\- the transferor has no ongoing consultation communication with the transfer
target (blind/assured transfer), then either:
a) the transferor wants to perform the transfer without any further action on
the transfer operation (blind transfer); or
b) the transferor wants to have a feedback on the transfer operation progress
with the possibility to retrieve the communication with the transferee
(assured transfer); or
\- the transferor has a consultation communication with the transfer target
(consultative transfer).
The transferor AS takes care that it remains in the signalling path even after
the communication is transferred, this allows:
\- classical charging models;
\- anonymization of the transfer target.
## 4.3 Operational requirements
### 4.3.1 Provision/withdrawal
The ECT service may be provided after prior arrangement with the service
provider or be generally available.
### 4.3.2 Requirements on the transferor network side
No specific requirements are needed in the network.
### 4.3.3 Requirements on the transferee network side
No specific requirements are needed in the network.
### 4.3.4 Requirements on the transfer target network side
No specific requirements are needed in the network.
## 4.4 Coding requirements
A user agent that wishes to use the ECT service (to act as a transferor):
\- Shall support the REFER method as a client as specified in RFC 3515 [2] as
updated by IETF RFC 6665 [14] and IETF RFC 7647 [16].
\- Shall support the Referred-By header field as specified in RFC 3892 [3].
\- Shall support the Target-Dialog header field as specified in RFC 4538 [15].
A user agent that is the transferred party in a communication transfer (acts
as the transferee):
\- Shall support the REFER method as a server as specified in RFC 3515 [2] and
updated by RFC 6665 [14].
\- Shall support the Referred-By header field as specified in RFC 3892 [3].
\- Shall support Replaces header field as a client as specified in RFC 3891
[4].
\- Shall support the Target-Dialog header field as specified in RFC 4538 [15].
A user agent that is the transfer target in a communication transfer:
\- May support the Referred-By header field as a server as specified in RFC
3892 [3].
\- May support the Replaces header field as a server as specified in RFC 3891
[4].
## 4.5 Signalling requirements
### 4.5.1 Activation/deactivation
The ECT service is activated at provisioning and deactivated at withdrawal.
### 4.5.1A Registration/erasure
The ECT service requires no registration. Erasure is not applicable.
### 4.5.1B Interrogation
Interrogation of ECT is not applicable.
### 4.5.2 Invocation and operation
#### 4.5.2.1 Actions at the transferor UE
A UE that has initiated an emergency call, shall not perform any transfer
operation involving the dialog associated with the emergency call.
A UE that initiates a transfer operation shall if the Contact address of the
transferee is a GRUU:
\- issue a REFER outside an existing dialog as specified in RFC 3515 [2] as
updated by IETF RFC 6665 [14] and IETF RFC 7647 [16], where:
a) the request URI shall contain the SIP URI of the transferee as received in
the Contact header field:
b) the Refer-To header field shall indicate the public address of the transfer
target;
c) in case of Consultative transfer, the transferor UE has a consultation
communication with the transfer target, a Replaces header field parameter
shall be added to the Refer-To URI together with a Require=replaces header
field parameter;
d) the Referred-By header field can be used to indicate the identity of the
transferor. When privacy was required in the original communications dialog
and a Referred-By header field is included, the UE shall include a Privacy
header field set to \"user\"; and
e) the Target-Dialog header field identifies the dialog to be transferred;
otherwise the UE shall:
\- issue a REFER request in the original communications dialog as specified in
RFC 3515 [2], where:
a) the request URI shall contain the SIP URI of the transferee as received in
the Contact header field;
b) the Refer-To header field shall indicate the public address of the transfer
target;
c) in case of consultative transfer, the transferor UE has a consultation
communication with the transfer target, a Replaces header field parameter
shall be added to the Refer-To URI together with a Require=replaces header
field parameter; and
d) the Referred-By header field can be used to indicate the identity of the
transferor. When privacy was required in the original communications dialog
and a Referred-By header field is included, the UE shall include a Privacy
header field set to \"user\".
If assured transfer is requested, the UE may include an Expires header field
in the Refer-To URI of the REFER request.
NOTE 1: The value of the Expires header field indicates the maximum duration
of the transfer attempt. If the transfer does not succeed within this
duration, the UE will receive a NOTIFY request indicating the transfer
failure.
After the REFER request is accepted by the other end with a 2xx response, the
transferor UE gets notifications of how the transferee\'s communication setup
towards the transfer Target is progressing.
When a NOTIFY request is received on the REFER dialog that indicates that the
transferee and the transfer Target have successfully setup a communication,
the transferor UE may terminate the original communication with the transferee
UE, by sending a BYE request on the original dialog.
If an assured transfer attempt is not completed (i.e. the UE has not received
a NOTIFY request with a \"message/sipfrag\" body's status line containing a
final response code indicating the end of the transfer operation), the UE may
request to terminate the transfer attempt by:
\- sending a REFER request in the same communications dialog as the previous
REFER request as specified in RFC 3515 [2] as updated by IETF RFC 6665 [14]
and IETF RFC 7647 [16], where:
a) the request URI shall contain the SIP URI of the transferee as received in
the Contact header field; and
b) the Refer-To header field shall indicate the public address of the transfer
target and shall contain the method parameter set to \"CANCEL\"; and
c) if applicable include a Target-Dialog header field that identifies the
dialog under transfer.
If the UE receives a NOTIFY request indicating that the assured transfer
attempt failed,followed by a re-INVITE or an UPDATE request taking the UE off
HOLD the UE may decide to retrieve the original communication by sending a re-
INVITE request in the original SIP dialog.
NOTE 2: If the user requests the retrieval of the original communication while
the transfer attempt has not been completed, the UE needs to first request the
termination of the transfer attempt before retrieving the original
communication via a re-INVITE request.
#### 4.5.2.2 Void
#### 4.5.2.3 Void
#### 4.5.2.4 Actions at the transferor AS
##### 4.5.2.4.1 Invocation of ECT service
###### 4.5.2.4.1.1 Prerequisite for invocation of the ECT service
For ECT to be provided to end users acting as transferors, the end user\'s AS
providing ECT shall be in the signalling path for all communications.
###### 4.5.2.4.1.2 Determine whether the ECT applies
The transferor AS is the one executing the ECT service logic, which is invoked
by the transferor sending a special REFER request.
###### # 4.5.2.4.1.2.1 REFER request received on a separate dialog
In order to know whether ECT service applies on a REFER request sent by the
served user, the following criteria shall apply before the ECT logic is
executed:
\- the Target-Dialog header field identifies an existing dialog towards the
transferee identified by the Request-URI;
\- the REFER request\'s Request-URI (transferee) is a GRUU targeted at the
same UE instance that is involved in the dialog identified by the Target-
Dialog header field; and
\- the REFER request\'s Refer-To header field contains a URI so that the
method constructed from the URI according to RFC 3261 [6] is equal to INVITE;
###### # 4.5.2.4.1.2.2 REFER request received in the to be transferred dialog
In order to know whether ECT service applies on a REFER request sent by the
served user, the following criteria shall apply before the ECT logic is
executed:
\- the REFER request\'s request-URI (transferee) is targeted at the same UE
instance that is involved in the dialog; and
\- the REFER request\'s Refer-To header field contains a URI so that the
method constructed from the URI according to RFC 3261 [6] is equal to INVITE.
Any REFER request that does not comply with these criteria shall not invoke
the ECT service and is depending on operator policy:
\- rejected;
\- handled by another service; or
\- proxied on.
If any of the following is true:
\- the initial INVITE request on the dialog on which the REFER request is
received was identified as a PSAP callback request; or
\- the Refer-To header field in the REFER request contains a URI with which
the referor is involved in a dialog where the initial INVITE request was
identified as a PSAP callback request.
the AS shall based on local policy on how to handle PSAP callbacks reject the
REFER request.
The mechanism to identify an INVITE request as a PSAP callback depends on
local policy and can be based on the PSAP callback indicator specified in IETF
RFC 7090 [13].
###### # 4.5.2.4.1.2.2A Procedures for call transfer with 3PCC
When a REFER request is received that invokes the call transfer service (see
subclause 4.5.2.4.1), the AS shall follow procedures specified in 3GPP TS
24.628 [10] for special REFER request handling using 3PCC procedures. An AS
supporting the assured transfer, shall put the INVITE dialog towards the
transferor on HOLD, following procedures in 3GPP TS 24.610 [8].
If the received REFER request contained an Expires header field in the Refer-
To URI, the AS shall start a timer set to the value received in the Expires
header field when the INVITE request is sent towards the transfer target, as
requested by the received REFER request. If this timer expires before the
transfer attempt is completed, the AS shall send a CANCEL request towards the
transfer target according to RFC 3261 [4].
For blind communication transfer, if required by local policy to do so, the AS
shall connect a media server to the transferee UE in order to provide in-band
announcement about the progress of the communication establishment with the
transfer target.
If the assured transfer attempt failsthe AS shall resume the INVITE dialog
with the transferor, following procedures in 3GPP TS 24.610 [8].
###### 4.5.2.4.1.2.3 Actions of ECT when invoked with a transfer request
When a REFER request is received that invokes the ECT service (see subclause
4.5.2.4.1), the ECT service shall perform the following actions:
1) Create a new ECT session identifier URI addressed to this AS. The URI shall
be created in such a way that a new dialog set up towards this URI can be
easily correlated with the current REFER dialog.
2) The AS stores the value of the Refer-To header field (transfer target URI)
from the REFER request and links it to the ECT Session Identifier URI.
3) The AS replaces the Refer-To header field with the ECT Session Identifier
URI (this ensures that the transferor AS remains in the loop when the
transferee sets up the communication with the transfer target).
NOTE: If a Replaces header field parameter and/or a Require=replaces header
field parameter are available in the URI contained in the Refer-To header
field, the above step implies that they are not forwarded to the transferee.
4) If a Referred-By header field is available in the request, the AS verifies
if the provided Referred-By header field contains a valid public identity of
the served user. If not it will replace the Referred-By header filed with a
valid value matching the REFER request\'s P-Asserted-Identity and if \"id\"
privacy was requested, include a Privacy header field set to \"user\". If the
Referred-By header field does not contain a valid public identity of the
served user and multiple valid public user identities are received in the
REFER request\'s P-Asserted-Identity header field, the AS shall select the
first one on the list. The AS then stores the Referred-by header field.
5) If no Referred-By header field is available in the request a Referred-By
header field is added that matches the REFER request\'s P-Asserted-Identity
and if \"id\" privacy was requested, include a Privacy header field set to
\"user\". If multiple valid public user identities are received in the REFER
request\'s P-Asserted-Identity header field, the AS shall select the first one
on the list.
6) The AS sends the REFER request on to the transferee using basic
communication procedures 3GPP TS 24.229 [1].
If the AS receives a 403 (Forbidden) or 501 (Not implemented) response to a
REFER request, the AS of the initiator of the REFER request may initiate the
special REFER handling procedures, according to 3GPP TS 24.628 [10].
If the AS receives a NOTIFY request with a sipfrag message body indicating a
420 (Bad Extension) as defined in RFC 3892 [3], the AS of the initiator of the
REFER request may initiate the special REFER handling procedures according to
3GPP TS 24.628 [10].
As a network option, the AS of the initiator of the REFER request that has
prior knowledge that the remote party is not allowed to receive or does not
support the REFER method, may initiate the special REFER handling procedures
directly, according to 3GPP TS 24.628 [10].
##### 4.5.2.4.2 Subsequent procedures
###### 4.5.2.4.2.1 Actions of ECT when invoked again by the transferred
communication
When an INVITE is received targeted at the ECT session identifier URI created
earlier when the served user requested transfer of an ongoing communication,
ECT shall perform the following actions:
0) If the stored transfer target URI linked to the ECT session identifier
contains a Replaces header field parameter, then the AS inserts the Replaces
header field in the INVITE request and:
a) If the INVITE request does not contain a Requires header field, then the AS
inserts a Requires header field in the INVITE request including a \"replaces\"
token; and
b) If the INVITE request does contain a Requires header field without a
\"replaces\" token, then the AS inserts a Requires header field in the INVITE
request including a \"replaces\" token.
1) strip all header field parameters and method parameter from the stored
transfer target URI and replace the request URI with the stripped version of
the stored transfer target URI linked to the specific ECT session identifier
URI;
2) if a Referred-By header field is available in the request, the AS verifies
if the provided Referred-By header field contains a valid identity of the
served user. If not it will replace the Referred-By header field with a valid
value matching the REFER request\'s P-Asserted-Identity and if \"id\" privacy
was requested, include a Privacy header field set to \"user\". If the
Referred-By header field does not contain a valid public identity of the
served user and multiple valid public user identities are received in the
REFER request\'s P-Asserted-Identity header field, the AS shall select the
first one on the list;
3) if no Referred-By header field is available in the request a Referred-By
header field is added that matches the REFER request\'s P-Asserted-Identity ,
and if \"id\" privacy was requested, include a Privacy header field set to
\"user\". If multiple valid public user identities are received in the REFER
request\'s P-Asserted-Identity header field, the AS shall select the first one
on the list; and
NOTE: If needed the AS can generate charging events to charge for the extra
leg.
4) the INVITE request is forwarded towards the transfer target using basic
communication procedures 3GPP TS 24.229 [1].
##### 4.5.2.4.2.2 Actions of ECT on failed REFER request {#actions-of-ect-on-
failed-refer-request .H6}
#### 4.5.2.5 Actions at the transferee UE
##### 4.5.2.5.1 Actions at the transferee UE (without 3PCC)
When a REFER request is received in the context of a call transfer scenario
(see subclause 4.5.2.4.1), the transferee UE shall perform the following
steps:
1) apply the procedure for holding the active communication with the
transferor as described in 3GPP TS 24.610 [8] subclause 4.5.2.1;
2) form a request as specified by the \"method\" URI parameter in the Refer-To
header field. If no \"method\" URI parameter is included an INVITE request
shall be formed in accordance with RFC 3261 [6];
3) send the request to the transfer target;
4) if the UE does not support the Assured transfer service, send a BYE request
on the INVITE dialog towards the transferor; and
5) act as a notifier in accordance with RFC 3515[2] as updated by RFC 6665
[14].
A UE supporting the assured transfer service shall keep the INVITE dialog
towards the transferor. If the request towards the transfer target fails, the
UE supporting the assured transfer service shall resume the session towards
the transferor as described in 3GPP TS 24.610 [8] subclause 4.5.2.1.
##### 4.5.2.5.2 Actions at the transferee UE (with 3PCC)
Apply normal re-INVITE procedures according to 3GPP TS 24.229 [1].
#### 4.5.2.6 Void
#### 4.5.2.7 Actions at the transferee AS
##### 4.5.2.7.0 Prerequisite for invocation of the ECT service
For ECT to be provided to end users acting as transferee, the end user\'s AS
providing ECT shall be in the signalling path for all communications of the
served user.
##### 4.5.2.7.1 Determine whether ECT applies
See subclause 4.5.2.4.1 on the criteria that determine that a REFER request is
to be treated as a request for transfer of an existing communication.
##### 4.5.2.7.2 Actions of the ECT AS when invoked with a transfer request
When a REFER request is received in the context of a call transfer scenario
(see subclause 4.5.2.4.1), the ECT AS shall perform the following steps:
1) Store the value of the Refer-To header field (used later to correlate the
new communication with this REFER dialog).
2) Optionally it may store the value of the Referred-By header field, if it
wants to ensure that the Referred-By is correct on the resulting INVITE
request.
3) Forward the request to the transferee according to basic communication
procedures 3GPP TS 24.229 [1].
##### 4.5.2.7.3 Actions of the ECT AS when invoked again by the transferred
communication
When an INVITE request is received targeted at the SIP URI stored earlier when
a transfer request was received targeted at the served user (transferee), the
AS shall perform the following actions:
0) Optionally check the following header fields in the received INVITE
request:
a) if a Referred-By header field is present in the INVITE request, the AS may
check if it matches the Referred-By header field of the REFER request stored
earlier. If it does not match, depending on the policy of the service
provider, the AS shall reject the INVITE request or replace the Referred-By
header field in the INVITE request with the value stored earlier; and
if a Referred-By header is absent in the INVITE, the AS shall insert a
Referred-By header with the value stored earlier.
1) optionally generate charging events:
a) to charge for the original communication between the transferee and the
transferor, in case the transferee was the originating party in the original
communication; and
b) to switch off charging in case the transferee was the terminating party in
the original communication; and
2) the INVITE is forwarded towards the transfer Target using basic
communication procedures 3GPP TS 24.229 [1].
#### 4.5.2.8 Void
#### 4.5.2.9 Void
#### 4.5.2.10 Void
#### 4.5.2.11 Void
#### 4.5.2.12 Void
#### 4.5.2.13 Void
#### 4.5.2.14 Void
#### 4.5.2.15 Actions at the transfer target\'s AS
Basic communication procedures according to 3GPP TS 24.229 [1] shall apply.
#### 4.5.2.16 Void
#### 4.5.2.17 Actions at the transfer target\'s UE
Basic communication procedures according to 3GPP TS 24.229 [1] shall apply.
## 4.6 Interaction with other services
### 4.6.1 Communication HOLD (HOLD)
No impact.
### 4.6.2 Terminating Identification Presentation (TIP)
No impact.
### 4.6.3 Terminating Identification Restriction (TIR)
No impact.
### 4.6.4 Originating Identification Presentation (OIP)
No impact.
### 4.6.5 Originating Identification Restriction (OIR)
Requirements relating to the Referred-By header field are described in
subclauses 4.5.2.4.1.2.3 and 4.5.2.4.2.1.
On the reception of an INVITE request from the transferee, the transferor AS
shall deduce the \"id\" related privacy requirement that the transferee has
indicated in the initial call between the transferee and the transferor; and
shall include a Privacy header field containing the according value in the
outgoing INVITE request.
For the transferee AS and the transfer Target AS there is no impact.
### 4.6.6 CONFerence Calling (CONF)
ECT shall not apply when the following criteria apply:
\- a REFER request is received in an INVITE dialog with a conference focus, or
a REFER request is received in an INVITE dialog and the Refer-to header field
of the REFER request indicates the public address of active dialog to
conference focus which is known by the AS providing ECT; and
\- the REFER request is originated by the conference controller, the
conference controller is the user that created and owns the conference.
An AS can determine that an established INVITE dialog is terminated at a
conference focus because according to 3GPP TS 24.605 [9] it either:
\- has received a 1xx or 2xx response to the INVITE request with an
\"isfocus\" feature parameter in the Contact header field; or
\- has received an INVITE with an \"isfocus\" feature parameter in the Contact
header field.
### 4.6.7 Communication DIVersion Services (CDIV)
No impact.
### 4.6.8 Malicious Communication IDentification (MCID)
No impact.
### 4.6.9 Anonymous Communication Rejection and Communication Barring (ACR/CB)
For the transferor AS the following applies:
\- The transferor AS shall not accept transfer requests with a transfer target
that is barred by the served users Outgoing Communication Barring (OCB) rules.
\- For the transferee AS and the transfer target AS there is no impact.
### 4.6.10 Explicit Communication Transfer (ECT)
#### 4.6.10.1 Determine whether a previously transferred communication is
transferred again
See subclause 4.5.2.4.1 on the criteria that determine that a REFER request is
to be treated as a request for transfer of an existing communication.
Additionally the following criteria should apply for this interaction case to
apply:
\- The INVITE dialog on which the REFER request is received is a previously
transferred communication, for which the current ECT instance had the
transferor role.
#### 4.6.10.2 Handling of transfer requests
When a REFER request is received and the criteria of subclause 4.6.10.1 apply,
then the AS shall perform the following steps:
1) Create a new ECT session identifier URI addressed to this AS. The URI shall
be created in such a way that a new dialog set up towards this URI can be
easily correlated with the current REFER dialog.
2) The AS stores the value of the Refer-To header field (transfer target) from
the REFER request and links it to the ECT session identifier URI.
3) The AS replaces the Refer-To header field with the ECT session identifier
URI from step 1). (This ensures that this AS remains in the loop when the
transferee sets up the communication with the transfer target.).
4) The AS forwards the REFER request to the transferee using basic
communication procedures in 3GPP TS 24.229 [1].
#### 4.6.10.3 Actions when this ECT instance is invoked again by the
transferred communication
When an INVITE is received targeted at the ECT session identifier URI created
earlier in subclause 4.6.10.2, the AS shall perform the following actions:
1) The AS replaces the request URI with the stored Refer-To header field value
linked to the specific ECT session identifier URI.
NOTE: If needed the AS may generate charging events to charge for the extra
leg.
2) The AS forwards the INVITE request towards the transfer target using basic
communication procedures in 3GPP TS 24.229 [1].
## 4.7 Interworking with other networks
### 4.7.1 Void
### 4.7.2 Void
### 4.7.3 Void
## 4.8 Parameter values (timers)
No specific timers are required.
## 4.9 Service configuration
Not applicable.
###### ## Annex A (informative): Signalling flows
# A.1 Blind transfer
Figure A.1 signalling flow shows a blind transfer scenario, whereby the REFER
request is forwarded the existing INVITE dialog between A and B.
Figure A.1: Blind transfer
1\. A multimedia session exists between A-B. B initiates transfer A to C, by
sending a REFER request with a Toheader field set to UE-A, a Referred-To
header field set to UE-C, a Referred-By header field set to UE-B. The REFER
request is sent in the existing dialog between A and B.
1.1 Upon reception of the REFER request, AS-B must check whether there is no
outgoing call barring active from B to C. Because B is charged for the call
from B-C when A is referred to C, when outgoing call barring is active from
B-C the REFER request is rejected.\ \ AS-B checks whether B is allowed to
transfer calls, if B is allowed to transfer the call then AS-B generates an
ECT session identifier URI, addressed to itself, with the new destination
information and billing information that will be needed for the new session.
It replaces the Refer-To header field value with the ECT session identifier
URI. This ensures that:\ \ AS-B will remain in the loop.
2\. The REFER request is forwarded to AS-A.
2.1 AS-A checks whether it is allowed to transfer A.
3\. The REFER request is forwarded to A by AS-A.
4\. The REFER request is accepted by A\'s UE.
4.1, 13.1, 31.1 AS-A can use result messages and notifications caused by the
REFER request to track success of the REFER request and take appropriate
actions. The AS-A can ensure that header fields that were replaced with other
content are recreated with the original content on the way back.
5.1, 8.1, 32.1 AS-B can use this to track success of the REFER request and
take appropriate actions. The AS-B can ensure that header fields that were
replaced with other content are recreated with the original content on the way
back.
7\. Since the REFER request was accepted in 6. UE-B terminates the existing
INVITE dialog by sending a BYE request to UE-A.
19\. UE-A initiates a new session by sending an INVITE request to AS-B\'s ECT
session identifier URI (which represents UE-C).
19.1 AS-A routes the INVITE request to AS-B using the AS-B\'s ECT session
identifier URI using normal SIP routing procedures. Normal charging from A to
B applies.
20.1 Upon receiving the INVITE request to the ECT session identifier URI that
was inserted by the AS-B, the AS-B replaces it with the Request URI of C and
creates an INVITE request targeted towards UE-C.\ \ In this scenario it can be
assumed that there is no active outgoing call barring towards UE-C, because
the REFER was accepted by AS-B. The ECT Session Identifier URI has a limited
validity time to ensure that no future barring is violated.\ \ Also the
Referred-By: header field is verified or filled in with the original
unmodified values. Then the INVITE request is forwarded to UE-C using normal
routing procedures.
21.1, 23.1 Normal terminating services apply for UE-C. The call will be
treated as a call from A-C regarding call policies.
25.1 AS-A. Normal response handling applies.
27.1 AS-A. Normal ACK handling applies.
28.1 AS-B replaces all modified values and ECT session identifier URI \'s with
stored values.
# A.2 Consultative transfer
Figure A.2 signalling flow shows a consultative transfer scenario.
Figure A.2: Consultative transfer
1\. Multimedia sessions exist between A-B and between B-C. B initiates
transfer of A to C, by sending a REFER request including a To header field set
to UE-A GRUU a Refer-To header field set to
UE-C?Replaces=dialog2&Require=replaces and a Referred-By header field set to
UE-B. The REFER request reuses the dialog that exists from A-B.
1.1 Upon reception of the REFER request AS-B must check whether there is no
outgoing call barring active from B to C. Because B is charged for the call
from B-C when A is referred to C, when outgoing call barring is active from
B-C the REFER is rejected.\ \ AS-B checks whether B is allowed to transfer
calls, if it is allowed to transfer the call then AS-B generates an ECT
session identifier URI, addressed to itself, with the new destination
information and billing information that will be needed for the new session.
It replaces the Refer-To header field value with the ECT session identifier
URI. This ensures that AS-B will remain in the loop.
2\. The REFER request is forwarded to AS-A.
2.1 AS-A checks whether it is allowed to transfer A.
3\. The REFER is forwarded to A by AS-A.
4.1, 7.1, 31.1 AS-A can use result messages and notifications caused by the
REFER request to track success of the REFER request and take appropriate
actions. The AS-A can ensure that header fields that where replaced with other
content are recreated with the original content on the way back.
5.1, 8.1, 32.1 AS-B can use this to track success of the REFER request and
take appropriate actions. The AS-B can ensure that header fields that where
replaced with other content are recreated with the original content on the way
back.
13\. UE-A initiates a new session by sending an INVITE to AS-B\'s ECT session
identifier URI (which represents UE-C).
13.1 AS-A checks whether A is allowed to use the Replaces extension and routes
the INVITE request to AS-B using the AS-B\'s ECT session identifier URI using
normal SIP routing procedures. Normal charging from A to B applies.
14.1 Upon receiving the INVITE request to the ECT session identifier URI that
was inserted by AS-B, AS-B replaces the Request URI and creates an INVITE
targeted towards UE-C. Further AS-B inserts a Replaces header field with the
value of the Replaces parameter of the stored transfer target URI if it is
available, which will allow the new session to replace the existing session
between B and C.\ In this scenario it can be assumed that there is no active
outgoing call barring towards UE-C, because UE-B was able to setup a call to
UE-C in the first place. However when there was no consultation call to UE-C,
there is an issue but this is solved at the initial reception of the REFER
from UE-C and not at this stage.\ The INVITE request is forwarded to UE-C
using normal routing procedures.
15.1, 17.1 Normal terminating services apply for UE-C. The call will be
treated as a call from A-C regarding call policies. AS-C checks whether the
Replaces mechanism is used.
19.1 AS-A. Normal response handling applies.
21.1 AS-A. Normal ACK handling applies.
22.1 AS-B replaces all codified values and the ECT session identifier URI with
stored values.
25\. UE-C terminates dialog 2 as consequence of normal Replaces procedures
according to RFC 3891 [4].
# A.3 Blind call transfer with third party call control
An example of a call flow where a media server is used is given in figure E.1
of 3GPP TS 24.628 [10]. In this call flow, the media server is involved in the
media path before transfer is received and remains involved after the call is
transferred. For blind communication transfer, the media server may be
connected only to the transferee (UE-B) after the REFER request is received
and be disconnected when the transfer target accepts the call.
An example of call flow where no media server is used is given in figure E.1
of 3GPP TS 24.628 [10].
# A.4 Consultative call transfer with third party call control
An example of a call flow is given in figure E.5 of 3GPP TS 24.628 [10].
###### ## Annex B (informative): Example of filter criteria
# B.1 Example of filter criteria for ECT
This annex provides an example of a filter criterion that triggers SIP
requests that are subject to initial filter criteria evaluation.
When the initial request matches the conditions of the next unexecuted IFC
rule for the served user which points to the ECT service, the communication is
forwarded to the AS.
An example of an Initial Filter Criteria (IFC) Trigger Point configurations
under the assumption that the ECT service is a standalone service that can be
invoked by a very specific trigger point active at the destination S-CSCF:
\- Method=\"INVITE\".
NOTE 1: The coding of the Initial Filter Criteria is described in 29.228 [7]
and 29.229 [7A].
NOTE 2: When the REFER is forwarded on an existing dialog, no IFC processing
will be performed, because this is a subsequent request on an existing dialog.
It follows that when this scenario is supported, all signalling has to
traverse through the AS.
An example of an IFC Trigger Point configuration where the S-CSCF does not
invoke the ECT AS for a PSAP callback:
\- Method=\"INVITE\" and not Priority header field with a \"psap-callback\"
header field value.
NOTE 3: Not invoking the ECT AS assumes that the ECT invocation request can be
handled elsewhere in the network, e.g. in the PSAP itself.
###### ## Annex C (informative): Example charging model
# C.1 Example of B REFER\'s A to C
This scenario is added to show that the solution presented in the present
document is able to support classical charging models. Assumption in this
scenario is that A originated the original call and is thus charged for the
initial A-B communication.
{width="6.235416666666667in" height="3.7555555555555555in"}
Figure C.1: Example of B REFER\'s A to C
Table C.1
* * *
Initial Session Initiated By Initial Session A-B Transferred Session\ Transfer
Target C
A=Transferee Transferee (A): A-B Transferee (A): A-B\ Transferor (B): B-C
A=Transferor Transferor (A): A-B Transferor (A): A-B\ Transferor (A): A-C
* * *
# C.2 Example of A REFER\'s B to C
This scenario is added to show that the solution presented in the present
document is able to support classical charging models. Assumption in this
scenario is that A originated the original call and is thus charged for
initial A-B communication.
{width="6.623611111111111in" height="4.308333333333334in"}
Figure C.2: Example of a REFER\'s B to C
Table C.2
+------------------------------+---------------------+---------------------+ | Initial Session Initiated By | Initial Session A-B | Transferred Session | | | | | | | | Transfer Target C | +------------------------------+---------------------+---------------------+ | A=Transferee | Transferee (A): A-B | Transferee (A): A-B | | | | | | | | Transferor (B): B-C | +------------------------------+---------------------+---------------------+ | A=Transferor | Transferor (A): A-B | Transferor (A): A-B | | | | | | | | Transferor (A): A-C | +------------------------------+---------------------+---------------------+
###### ## Annex D (informative): Void
#